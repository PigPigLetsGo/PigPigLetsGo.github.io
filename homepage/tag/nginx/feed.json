{
    "version": "https://jsonfeed.org/version/1",
    "title": "homepage • All posts by \"nginx\" tag",
    "description": "欢迎来我的博客空间",
    "home_page_url": "https://pigpigletsgo.github.io/homepage",
    "items": [
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/bug/%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%99/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/bug/%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%99/",
            "title": "Nginx启动报错",
            "date_published": "2024-04-02T04:07:17.296Z",
            "content_html": "<p>报错描述：</p>\n<pre><code>nginx报错：nginx: [alert] could not open error log file: open() “/usr/local/nginx/logs/error.log“ faile\n</code></pre>\n<p>解决方案：</p>\n<p>将 /user/local 目录下的 nginx 的目录和里面的东西全部授权权限</p>\n<p>如果 nginx 目录下没有 logs 那么需要创建一个并赋权限</p>\n<p><img src=\"%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%99_md_files/image_2023-01-28-09-47-13_20230225095659.png?v=1&amp;type=image&amp;token=V1:lTwAFSeS0Pgvsvzwmq9SkHkOcFx90LC_KvYFoA7LwnI\" alt=\"image_2023-01-28-09-47-13\"></p>\n<p>报错描述：</p>\n<pre><code>nginx: [emerg] bind() to 0.0.0.0:80 failed (13: Permission denied)\n</code></pre>\n<p>原因：当前用户对该位置没有写入权限所导致的，如果使用 sudo 来执行的话就不会抱任何错误</p>\n<p>解决方案：使用命令: <code>sudo chmod -R a+rw /usr/local/nginx</code></p>\n<ul>\n<li>在执行上面操作时所需要注意事项：个人学习，不考虑安全问题 <strong>重点</strong></li>\n</ul>\n<p><strong>如果要以非 root 用户或者权限启动 Nginx 则会出现报错：</strong>  <code>nginx: [emerg] bind() to 0.0.0.0:80 failed (13: Permission denied)</code></p>\n<p>解决方案：</p>\n<p>将 nginx 目录中的 conf/nginx.conf 文件中的 80 端口改为 1024 以上的端口号</p>\n<pre><code>server &#123;\n#      listen       80;\n       listen       8080;\n\n       server_name  localhost;\n\n       #charset koi8-r;\n\n       #access_log  logs/host.access.log  main;\n\n       location / &#123;\n           root   html;\n           index  index.html index.htm;\n  &#125;\n</code></pre>\n<p><img src=\"%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%99_md_files/image_2023-01-28-10-09-00_20230225095717.png?v=1&amp;type=image&amp;token=V1:feAXNVLs2aejsJjBkv909UX4jDcB1lbQpR5wPVmv62U\" alt=\"image_2023-01-28-10-09-00\"></p>\n<p>再次执行 <code>./nginx</code></p>\n<p><img src=\"%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%99_md_files/image_2023-01-28-10-09-16_20230225095733.png?v=1&amp;type=image&amp;token=V1:wLRT0CcH20I7fd25jX72vO_2KM3PtUVUO4EyqxJwFZ4\" alt=\"image_2023-01-28-10-09-16\"></p>\n",
            "tags": [
                "问题总汇",
                "nginx"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98/",
            "title": "解决跨域问题",
            "date_published": "2024-02-12T12:35:08.435Z",
            "content_html": "<h1 id=\"解决nginx跨域问题\"><a class=\"anchor\" href=\"#解决nginx跨域问题\">#</a> 解决 Nginx 跨域问题</h1>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">location</span> /</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">add_header</span> Access-Control-Allow-Origin *</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">add_header</span> Access-Control-Allow-Methods <span class=\"token string\">'GET, POST, OPTIONS'</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">add_header</span> Access-Control-Allow-Headers <span class=\"token string\">'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization'</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>这个配置做了以下几件事：</p>\n<ul>\n<li><a href=\"https://cloud.tencent.com/developer/article/1648860\"> <code>Access-Control-Allow-Origin *</code>  允许所有源站点访问本服务器的数据</a>。</li>\n<li><a href=\"https://cloud.tencent.com/developer/article/1648860\"> <code>Access-Control-Allow-Methods 'GET, POST, OPTIONS'</code>  允许 GET、POST 和 OPTIONS 这三种 HTTP 请求方法</a>。</li>\n<li><a href=\"https://cloud.tencent.com/developer/article/1648860\"> <code>Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization'</code>  允许这些 HTTP 请求头的字段</a>。</li>\n</ul>\n",
            "tags": [
                "nginx",
                "计算机学科"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/%E9%AB%98%E5%8F%AF%E7%94%A8%E9%85%8D%E7%BD%AE/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/%E9%AB%98%E5%8F%AF%E7%94%A8%E9%85%8D%E7%BD%AE/",
            "title": "高可用",
            "date_published": "2024-02-12T12:35:08.395Z",
            "content_html": "<h2 id=\"高可用配置\"><a class=\"anchor\" href=\"#高可用配置\">#</a> 高可用配置</h2>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-01-14-11-02_20230225142326.png\" alt=\"image_2023-02-01-14-11-02\" /></p>\n<h3 id=\"安装keepalived\"><a class=\"anchor\" href=\"#安装keepalived\">#</a> 安装 Keepalived</h3>\n<h4 id=\"编译安装\"><a class=\"anchor\" href=\"#编译安装\">#</a> 编译安装</h4>\n<p>下载地址:</p>\n<p><code>https://www.keepalived.org/download.html</code></p>\n<p>使用 <code>./configure</code>  编译安装</p>\n<p>如遇报错提示:</p>\n<pre><code>configure: error :\n!!! OpenSSL is not properly installed on your system !!!\n!!! Can not include OpenSSL headers files !!!\n</code></pre>\n<p>安装依赖</p>\n<pre><code>yum install openssl-devel\n</code></pre>\n<p><strong>yum 安装</strong></p>\n<pre><code>yum install keepalived\n</code></pre>\n<p><strong>配置</strong></p>\n<p>使用 yum 安装后配置文件在</p>\n<p><code>/etc/keepalived/Keepalived.conf</code></p>\n<p><strong>最小配置</strong></p>\n<p>第一台机器</p>\n<pre><code>! Configuration File for keepalived\n\nglobal_defs &#123;\n\trouter_id lb111\n&#125;\n#在内网当中通讯的协议 atguigu:实例名称\nvrrp_instance atguigu &#123;\n    state MASTER\n    interface ens33 #对应自己的网卡的名字\n    virtual_router_id 51\n    #主备竞选的的优先级高谁就是Master\n    priority 100 #优先级\n    advert_int 1 #间隔检测的时间\n    authentication &#123; #在内网当认证服务器,同一组要保持一致\n        auth_type PASS\n        auth_pass 1111\n    &#125;\n    virtual_ipaddress &#123; #虚拟的ip地址\n        192.168.244.200\n    &#125;\n&#125;\n</code></pre>\n<p>启动 Keepalived</p>\n<pre><code>systemctl start keepalived\n</code></pre>\n<p>查看 ip</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-01-21-27-59_20230225142344.png\" alt=\"image_2023-02-01-21-27-59\" /></p>\n<ul>\n<li>注意：使用 ip addr 来查看 ifconfig 查看不到</li>\n</ul>\n<p>第二台机器</p>\n<pre><code>! Configuration File for keepalived\n\nglobal_defs &#123;\n   router_id lb110\n&#125;\n\nvrrp_instance atguigu &#123;\n    state BACKUP #备机\n    interface ens33 \n    virtual_router_id 51\n    priority 50 #优先级要比Master低\n    advert_int 1\n    authentication &#123;\n        auth_type PASS\n        auth_pass 1111\n    &#125;\n    virtual_ipaddress &#123;\n        192.168.244.200\n    &#125;\n&#125;\n</code></pre>\n<p>ip add 查看</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-01-21-38-30_20230225142357.png\" alt=\"image_2023-02-01-21-38-30\" /></p>\n<p>只有一个 ip</p>\n<p>在 win 下 ping 一下虚拟 ip 查看效果:</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-01-21-40-23_20230225142409.png\" alt=\"image_2023-02-01-21-40-23\" /></p>\n<p>我们将这个 111 的给断开直接关机</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-01-21-42-13_20230225142420.png\" alt=\"image_2023-02-01-21-42-13\" /></p>\n<p>断了一下有重新 ping 上了查看下 110 的 ip 状态</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-01-21-43-20_20230225142431.png\" alt=\"image_2023-02-01-21-43-20\" /></p>\n<p>可以看到 110 用 IP add 既然查看到了虚拟 ip</p>\n<p>这就是 ip 飘逸通过 keepalived 飘逸</p>\n<p>访问页面时也是通过虚拟 ip 来访问</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-01-21-45-28_20230225142445.png\" alt=\"image_2023-02-01-21-45-28\" /></p>\n<h3 id=\"高可用场景及解决方案\"><a class=\"anchor\" href=\"#高可用场景及解决方案\">#</a> 高可用场景及解决方案</h3>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-01-14-11-16_20230225142457.png\" alt=\"image_2023-02-01-14-11-16\" /></p>\n<h3 id=\"选举方式\"><a class=\"anchor\" href=\"#选举方式\">#</a> 选举方式</h3>\n<p>优先级决定选举：谁的优先级高就越容易 Master</p>\n",
            "tags": [
                "nginx",
                "计算机学科"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/%E9%98%B2%E7%9B%97%E9%93%BE/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/%E9%98%B2%E7%9B%97%E9%93%BE/",
            "title": "防盗链",
            "date_published": "2024-02-12T12:35:08.378Z",
            "content_html": "<h2 id=\"防盗链\"><a class=\"anchor\" href=\"#防盗链\">#</a> 防盗链</h2>\n<ul>\n<li>http 协议中的 referer</li>\n</ul>\n<h3 id=\"nginx防盗链配置\"><a class=\"anchor\" href=\"#nginx防盗链配置\">#</a> nginx 防盗链配置</h3>\n<blockquote>\n<p>valid_referers none | bolcked | server_names | strings ... ;</p>\n</blockquote>\n<ul>\n<li>\n<p>none, 检测 Refere 头域不存在的情况</p>\n</li>\n<li>\n<p>bolcked, 检测 Refere 头域的值被防火墙或者代理服务器删除或者伪装的情况，这种情况该头域的值不以 &quot;http://&quot; 或 &quot;https://&quot; 开头</p>\n</li>\n<li>\n<p>server_names, 设置一个或多个 URL, 检测 Refere 头域的值是否是这些 URL 中的某一个</p>\n</li>\n</ul>\n<p>在需要防盗链的 location 中配置</p>\n<pre><code>valid_referers 192.168.44.101;\nif($invalid_referer)&#123;\n    return 403;\n&#125;\n</code></pre>\n<p><strong>使用 curl 测试</strong></p>\n<p><code>curl -I http://192.168.44.101/img/logo.png</code></p>\n<p><strong>带引用</strong></p>\n<p><code>curl -e &quot;http://baidu.com&quot; -I http://192.168.44.101/img/loggo.png</code></p>\n<blockquote>\n<p>演示</p>\n</blockquote>\n<p><strong>0 号 Linux 配置如下</strong></p>\n<pre><code>server &#123;\n        listen       8089;\n        server_name localhost;\n        location / &#123;\n            #httpds随便起的别名,但是要与upstream对应得上,upstream和server是同一级别的\n            proxy_pass http://192.168.244.139:8088;\n            #root 只能查找本机中根目录的项目\n            #root   http://www.qq.com;\n            index  index.html index.htm;\n        &#125;\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n\n        #正则中不区分大小写,使用格式:(x|x|x|x)\n        location ~*/(js|css|img|fonts) &#123;\n            valid_referers 192.168.244.128:8089;                                                                                                          \n            if ($invalid_referer) &#123;\n                return 403;\n            &#125;\n\n            root html;\n            index  index.html index.htm;\n        &#125;\n\n&#125;\n</code></pre>\n<ul>\n<li>在静态资源的 location 下配置防盗链，防盗链的方式为 ip 地址</li>\n</ul>\n<p>访问效果：</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-31-21-19-32_20230225141924.png\" alt=\"image_2023-01-31-21-19-32\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-31-21-21-10_20230225141935.png\" alt=\"image_2023-01-31-21-21-10\" /></p>\n<ul>\n<li>从控制台中点击图片查看情况</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-31-21-27-47_20230225141948.png\" alt=\"image_2023-01-31-21-27-47\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-31-21-28-21_20230225141959.png\" alt=\"image_2023-01-31-21-28-21\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-31-21-28-32_20230225142012.png\" alt=\"image_2023-01-31-21-28-32\" /></p>\n<p><strong>none</strong></p>\n<p>图片查看效果：</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-31-21-29-24_20230225142026.png\" alt=\"image_2023-01-31-21-29-24\" /></p>\n<h3 id=\"使用浏览器或curl检测\"><a class=\"anchor\" href=\"#使用浏览器或curl检测\">#</a> 使用浏览器或 curl 检测</h3>\n<p>测试命令: <code>curl http://192.168.244.128:8089</code></p>\n<p>效果</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-01-09-29-40_20230225142043.png\" alt=\"image_2023-02-01-09-29-40\" /></p>\n<p>测试命令: <code>curl -I http://192.168.244.128:8089</code></p>\n<p>效果</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-01-09-30-30_20230225142058.png\" alt=\"image_2023-02-01-09-30-30\" /></p>\n<p><strong>通过控制台查看图片</strong></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-01-09-33-20_20230225142111.png\" alt=\"image_2023-02-01-09-33-20\" /></p>\n<h3 id=\"返回错误码\"><a class=\"anchor\" href=\"#返回错误码\">#</a> 返回错误码</h3>\n<p>我们将连接复制下来，到 Xshell 中 curl -I 一下:</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-01-09-34-04_20230225142126.png\" alt=\"image_2023-02-01-09-34-04\" /></p>\n<p>标头返回的是 200 请求状态码，在控制台中状态码为：403</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-01-09-35-02_20230225142136.png\" alt=\"image_2023-02-01-09-35-02\" /></p>\n<p><strong>如果使用:curl -e 来用其它网站引用这个 图片不带 referer 查看下效果</strong></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-01-09-37-49_20230225142152.png\" alt=\"image_2023-02-01-09-37-49\" /></p>\n<p>返回的标头中状态码为：403 了</p>\n<h3 id=\"返回错误页面\"><a class=\"anchor\" href=\"#返回错误页面\">#</a> 返回错误页面</h3>\n<p>让限制的 ip 主机访问静态资源时转到自己定义的错误页面中</p>\n<p>0 号 Linux 配置如下:</p>\n<pre><code>server &#123;\n        listen       8089;\n        server_name localhost;\n        location / &#123;\n\t    #httpds随便起的别名,但是要与upstream对应得上,upstream和server是同一级别的\n     \t    proxy_pass http://192.168.244.139:8088;\n\t    #root 只能查找本机中根目录的项目\n            #root   http://www.qq.com;\n            index  index.html index.htm;\n        &#125;\n\t\n\t#正则中不区分大小写,使用格式:(x|x|x|x)\n        location ~*/(js|css|img|fonts) &#123;\n\t    valid_referers none 192.168.244.128:8089;\n\t    if ($invalid_referer) &#123;\n\t\treturn 401;\n\t    &#125;\n\n\t    root html;\n            index  index.html index.htm;\n        &#125;\n\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n\n        error_page   401 /401.html;\n        location = /401.html &#123;\n            root   html;\n        &#125;\n\n    &#125;\n</code></pre>\n<p>效果如下:</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-01-10-20-48_20230225142205.png\" alt=\"image_2023-02-01-10-20-48\" /></p>\n<p>跳转到的页面展示效果:</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-01-10-21-31_20230225142216.png\" alt=\"image_2023-02-01-10-21-31\" /></p>\n<p>解决中文乱码:</p>\n<p>配置错误页面:</p>\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;meta charset=&quot;utf-8&quot;&gt;\n&lt;title&gt;Error&lt;/title&gt;\n&lt;style&gt;\nhtml &#123; color-scheme: light dark; &#125;                                                                                                 \nbody &#123; width: 35em; margin: 0 auto;\nfont-family: Tahoma, Verdana, Arial, sans-serif; &#125;\n&lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1&gt;An error occurred.&lt;/h1&gt;\n&lt;p&gt;非法请求&lt;br/&gt;\nPlease try again later.&lt;/p&gt;\n&lt;p&gt;If you are the system administrator of this resource then you should check\nthe error log for details.&lt;/p&gt;\n&lt;p&gt;&lt;em&gt;Faithfully yours, nginx.&lt;/em&gt;&lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n<p>再次访问查看:</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-01-10-24-51_20230225142233.png\" alt=\"image_2023-02-01-10-24-51\" /></p>\n<h3 id=\"整合rewrite返回报错图片\"><a class=\"anchor\" href=\"#整合rewrite返回报错图片\">#</a> 整合 rewrite 返回报错图片</h3>\n<p>在 nginx/html 目录中创建一个 img 目录里面下载一个要显示的报错图片</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-01-11-11-48_20230225142248.png\" alt=\"image_2023-02-01-11-11-48\" /></p>\n<p>0 号 Linux 配置如下:</p>\n<pre><code>server &#123;\n        listen       8089;\n        server_name localhost;\n        location / &#123;\n            #httpds随便起的别名,但是要与upstream对应得上,upstream和server是同一级别的\n            proxy_pass http://192.168.244.139:8088;\n            #root 只能查找本机中根目录的项目\n            #root   http://www.qq.com;\n            index  index.html index.htm;\n        &#125;\n\n        #正则中不区分大小写,使用格式:(x|x|x|x)\n        location ~*/(js|css|img|fonts) &#123;\n            valid_referers none 192.168.244.128:8089;\n            if ($invalid_referer) &#123;\n                #目标匹配所有   到/img/x.jpg\n                rewrite ^/      /img/x.jpg break;\n                #return /401.html;\n            &#125;\n\n            root html;\n            index  index.html index.htm;\n        &#125;\n\n        error_page   500 502 503 504  /50x.html;                                                                                   \n        location = /50x.html &#123;\n            root   html;\n        &#125;\n\n        error_page   401 /401.html;\n        location = /401.html &#123;\n            root   html;\n        &#125;\n&#125;\n</code></pre>\n",
            "tags": [
                "nginx",
                "计算机学科"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/",
            "title": "反向代理",
            "date_published": "2024-02-12T12:35:08.361Z",
            "content_html": "<h2 id=\"反向代理\"><a class=\"anchor\" href=\"#反向代理\">#</a> 反向代理</h2>\n<p><strong>不持支反向代理 <code>https</code> </strong> 服务器因为它是要对应证书</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-16-06-35_20230225141146.png\" alt=\"image_2023-01-28-16-06-35\" /></p>\n<ul>\n<li><strong>lvs 模型</strong></li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20230129073941158_20230225141158.png\" alt=\"image-20230129073941158\" /></p>\n<h3 id=\"网关代理与反向代理\"><a class=\"anchor\" href=\"#网关代理与反向代理\">#</a> 网关，代理与反向代理</h3>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-16-06-45_20230225141210.png\" alt=\"image_2023-01-28-16-06-45\" /></p>\n<h3 id=\"反向代理在系统架构中的应用场景\"><a class=\"anchor\" href=\"#反向代理在系统架构中的应用场景\">#</a> 反向代理在系统架构中的应用场景</h3>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-16-40-11_20230225141223.png\" alt=\"image_2023-01-28-16-40-11\" /></p>\n<h3 id=\"负载均衡器\"><a class=\"anchor\" href=\"#负载均衡器\">#</a> 负载均衡器</h3>\n<ul>\n<li>需要被负载均衡的服务器我们称之为服务器的集群</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-16-51-19_20230225141235.png\" alt=\"image_2023-01-28-16-51-19\" /></p>\n<h3 id=\"nginx的反向代理配置\"><a class=\"anchor\" href=\"#nginx的反向代理配置\">#</a> Nginx 的反向代理配置</h3>\n<ul>\n<li><strong>关键字</strong>: <code>proxy_pass</code>\n<ul>\n<li>在 location 中配置而且与 root 二选一不能同时使用</li>\n</ul>\n</li>\n</ul>\n<pre><code>server &#123;\n#  listen       80;\n  listen       8080;\n  server_name  localhost;\n  location / &#123;\n      proxy_pass http://www.qq.com;\n      #root   html;\n      index  index.html index.htm;\n  &#125;\n  error_page   500 502 503 504  /50x.html;\n  location = /50x.html &#123;\n      root   html;\n  &#125;\n&#125;\n</code></pre>\n<h4 id=\"proxy_pass跳转外网网站\"><a class=\"anchor\" href=\"#proxy_pass跳转外网网站\">#</a> proxy_pass 跳转外网网站</h4>\n<ul>\n<li>当我们访问时就会访问到 qq 的官网里</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-29-09-46-14_20230225141251.png\" alt=\"image_2023-01-29-09-46-14\" /></p>\n<ul>\n<li>但我们将反向代理的域名写成 <code>qq.com</code>  时</li>\n</ul>\n<pre><code>server &#123;                      \n    listen       8080;\n    #server_name 192.168.244.128;\n    #server_name localhost;\n    #在win中浏览器输入Linux的IP也能访问到项目,但不能win中输入bogon,Linux的主机名这样访问不到\n    server_name bogon;\n    location / &#123;\n        #反向代理关键字:proxy_pass\n        proxy_pass http://qq.com;\n        #root 只能查找本机中根目录的项目\n        #root   http://www.qq.com;\n        index  index.html index.htm;\n    &#125;                         \n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html &#123;\n        root   html;\n    &#125;           \n&#125;\n</code></pre>\n<p>重启服务器后访问并查看网络情况</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-29-09-47-45_20230225141308.png\" alt=\"image_2023-01-29-09-47-45\" /></p>\n<p>可以看到 IP 域名请求时进行了重定向跳转到了 www.qq.com 页面中，我们 302 重定向会发送两次请求</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-29-09-49-51_20230225141319.png\" alt=\"image_2023-01-29-09-49-51\" /></p>\n<h4 id=\"proxy_pass跳转本地其它服务器中\"><a class=\"anchor\" href=\"#proxy_pass跳转本地其它服务器中\">#</a> proxy_pass 跳转本地其它服务器中</h4>\n<ul>\n<li>\n<p>跟 win 与 Linux 的原理一样，我们访问另一台服务器需要配置其 Linux 的 IP 地址</p>\n</li>\n<li>\n<p>访问到另一台服务器后另一台服务器访问自己本机中的项目</p>\n</li>\n</ul>\n<pre><code>server &#123;                      \n    listen       8080;\n    server_name bogon;        \n\n    location / &#123;\n        #反向代理关键字:proxy_pass\n        proxy_pass http://192.169.244.102;\n        #root 只能查找本机中根目录的项目\n        #root   http://www.qq.com;\n        index  index.html index.htm;\n    &#125;                         \n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html &#123;\n        root   html;\n    &#125;           \n&#125;\n</code></pre>\n<p>另一个服务器的配置文件</p>\n<pre><code>server &#123;                      \n    listen       8080;\n    server_name bogon;        \n\n    location / &#123;\n        #反向代理关键字:proxy_pass\n        proxy_pass http://www.qq.com;\n        #root 只能查找本机中根目录的项目\n        #root   http://www.qq.com;\n        index  index.html index.htm;\n    &#125;                         \n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html &#123;\n        root   html;\n    &#125;           \n&#125;\n</code></pre>\n<ol start=\"2\">\n<li>配置这两个 Linux 虚拟机让其保证可以访问到自己创建的 index 页面如下效果:</li>\n</ol>\n<ul>\n<li>虚拟机 1 号</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-29-14-25-12_20230225141336.png\" alt=\"image_2023-01-29-14-25-12\" /></p>\n<ul>\n<li>虚拟机 2 号</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-29-14-25-48_20230225141347.png\" alt=\"image_2023-01-29-14-25-48\" /></p>\n<ol start=\"2\">\n<li>在一个主的 nginx 虚拟机的 nginx 配置文件中配置</li>\n</ol>\n<ul>\n<li>虚拟机 0 号</li>\n</ul>\n<pre><code>server &#123;             \n   listen       8080;\n   server_name localhost;\n   \n   location / &#123;     \n       #反向代理关键字:proxy_pass http://后面为虚拟机1号的ip与端口号8080\n       proxy_pass http://192.168.244.138:8080;\n       #root 只能查找本机中根目录的项目\n       #root   http://www.qq.com;\n       index  index.html index.htm;\n   &#125;                \n   error_page   500 502 503 504  /50x.html;                                \n   location = /50x.html &#123;                                                  \n       root   html; \n   &#125;                \n&#125;  \n</code></pre>\n<ul>\n<li>虚拟机 1 号</li>\n</ul>\n<pre><code>server &#123;          \n   listen       8080;\n   server_name  localhost;\n                 \n   location / &#123;\n       root   /www;\n       index  index.html index.htm;\n   &#125;             \n                 \n   error_page   500 502 503 504  /50x.html;\n   location = /50x.html &#123;\n       root   html;\n   &#125;             \n                      \n&#125;\n</code></pre>\n<p>当使用虚拟机 0 号的 ip 来访问浏览器请求时会反向代理到虚拟机 1 号中的根目录的项目中，效果如下</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-29-14-32-52_20230225141555.png\" alt=\"image_2023-01-29-14-32-52\" /></p>\n<h3 id=\"基于反向代理的负载均衡-轮询一人一下\"><a class=\"anchor\" href=\"#基于反向代理的负载均衡-轮询一人一下\">#</a> 基于反向代理的负载均衡 (轮询):[一人一下]</h3>\n<ol>\n<li>安装至少三台 Linux 如果是虚拟机可以进行多开多安装</li>\n</ol>\n<ul>\n<li>在 0 号虚拟机的配置文件中配置如下:</li>\n</ul>\n<p>在 proxy_pass 后定义 http:// 别名，这个别名对应着 upstream 而 upstream 是和 server 同级的，在 upstream 中定义多个 (一组) 服务器</p>\n<pre><code>#别名的定义,定义一组服务器\n    #upstream和server是同一级别的\n    upstream httpds&#123;\n        server 192.168.244.138:8080;\n        server 192.168.244.139:8080;\n    &#125;\n\n    server &#123;\n        listen       8080;\n        server_name localhost;\n        location / &#123;\n            #httpds随便起的别名,但是要与upstream对应得上,upstream和server是同一级别的\n            proxy_pass http://httpds;\n            #root 只能查找本机中根目录的项目\n            #root   http://www.qq.com;\n            index  index.html index.htm;\n        &#125;\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n&#125;\n</code></pre>\n<p>浏览器请求效果如下:</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-29-16-09-07_20230225141610.png\" alt=\"image_2023-01-29-16-09-07\" /></p>\n<p>再次访问请求效果如下:</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-29-16-10-10_20230225141622.png\" alt=\"image_2023-01-29-16-10-10\" /></p>\n<h3 id=\"负载均衡策略\"><a class=\"anchor\" href=\"#负载均衡策略\">#</a> 负载均衡策略</h3>\n<p><strong>weight: 设置群众值</strong> (权重)</p>\n<p>通过群众分配比例，每台服务器多少请求转发过去</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-29-17-10-29_20230225141640.png\" alt=\"image_2023-01-29-17-10-29\" /></p>\n<ul>\n<li>0 号 Linux 的配置如下:</li>\n</ul>\n<pre><code>#别名的定义,定义一组服务器\n    #upstream和server是同一级别的\n    upstream httpds&#123;\n        server 192.168.244.138:8080 weight=8;\n        server 192.168.244.139:8080 weight=2;                                                                                                             \n    &#125;\n\n    server &#123;\n        listen       8080;\n        server_name localhost;\n        location / &#123;\n            #httpds随便起的别名,但是要与upstream对应得上,upstream和server是同一级别的\n            proxy_pass http://httpds;\n            #root 只能查找本机中根目录的项目\n            #root   http://www.qq.com;\n            index  index.html index.htm;\n        &#125;\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n&#125;\n</code></pre>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/test_20230225141658.gif\" alt=\"1\" /></p>\n<p>1 号 Linux 项目的请求转发几率比 2 号 Linux 大很多</p>\n<p><strong>down: 设置后不参与负载均衡器</strong></p>\n<ul>\n<li>在 weight 后面设置</li>\n</ul>\n<pre><code>#别名的定义,定义一组服务器\n    #upstream和server是同一级别的\n    upstream httpds&#123;\n        server 192.168.244.138:8080 weight=8 down;\n        server 192.168.244.139:8080 weight=2;\n    &#125;\n                                                                                                                    \n    server &#123;\n        listen       8080;\n        server_name localhost;\n        location / &#123;\n            #httpds随便起的别名,但是要与upstream对应得上,upstream和server是同一级别的\n            proxy_pass http://httpds;\n            #root 只能查找本机中根目录的项目\n            #root   http://www.qq.com;\n            index  index.html index.htm;\n        &#125;\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n&#125;\n</code></pre>\n<p>效果如下:</p>\n<ul>\n<li>无论怎么刷新都只会反向代理请求 2 号的项目，1 号已经不参与了</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-29-16-59-00_20230225141715.png\" alt=\"image_2023-01-29-16-59-00\" /></p>\n<p><strong>backup: 备用</strong></p>\n<p>没有任何可用的群众时使用，正常情况下不参与</p>\n<p>0 号 Linux 配置如下:</p>\n<pre><code>#别名的定义,定义一组服务器\n    #upstream和server是同一级别的\n    upstream httpds&#123;\n        server 192.168.244.138:8080 weight=8 down;\n        server 192.168.244.139:8080 weight=2 backup;                                                                                                      \n    &#125;\n\n    server &#123;\n        listen       8080;\n\n        server_name localhost;\n        location / &#123;\n                #httpds随便起的别名,但是要与upstream对应得上,upstream和server是同一级别的\n                proxy_pass http://httpds;\n                #root 只能查找本机中根目录的项目\n            #root   http://www.qq.com;\n            index  index.html index.htm;\n        &#125;\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n&#125;\n</code></pre>\n<p>效果如下:</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-29-17-03-46_20230225141730.png\" alt=\"image_2023-01-29-17-03-46\" /></p>\n<p><strong>ip_hash</strong></p>\n<p>根据客户端的 ip 地址转发同一台服务器，可以保持会话</p>\n<p><strong>least_conn</strong></p>\n<p>最少链接访问</p>\n<p><strong>url_hash</strong></p>\n<p>根据用户访问的 url 定向转发请求</p>\n<p><strong>fair</strong></p>\n<p>根据后端服务器响应时间转发请求</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-29-19-00-03_20230225141744.png\" alt=\"image_2023-01-29-19-00-03\" /></p>\n<h3 id=\"反向代理tomcat\"><a class=\"anchor\" href=\"#反向代理tomcat\">#</a> 反向代理 Tomcat</h3>\n<p>操作步骤:</p>\n<ol>\n<li>开启至少两台 Linux</li>\n</ol>\n<p><strong>0 号 Linux 的配置如下:</strong></p>\n<pre><code>#别名的定义,定义一组服务器\n    #upstream和server是同一级别的\n    upstream httpds&#123;\n        server 192.168.244.138:8080 weight=8 down;\n        server 192.168.244.139:8088 weight=2 backup;\n    &#125;\n\n    server &#123;\n        listen       8080;\n\n        server_name localhost;\n        location / &#123;\n                #httpds随便起的别名,但是要与upstream对应得上,upstream和server是同一级别的\n                proxy_pass http://httpds;\n                #root 只能查找本机中根目录的项目                                                                                                          \n            #root   http://www.qq.com;\n            index  index.html index.htm;\n        &#125;\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n&#125;\n</code></pre>\n<blockquote>\n<p>使用 upstream 负载均衡了两台 Linux 不过我们只使用 到了一个将 138 的 Linux 设置了 down 为不使用因为 1 号 Linux 的 nginx 端口号和 tomcat 的端口号有冲突问题所以 1 号 Linux 的 nginx 端口号我该为了 8088</p>\n</blockquote>\n<ul>\n<li>如下是 1 号 Linux 的配置:</li>\n</ul>\n<pre><code>server &#123;\n        listen       8088;\n        server_name  localhost;\n                                                                                                                                                          \n        location / &#123;\n            #这里配置的是访问Tomcat的ip地址\n            proxy_pass http://192.168.244.139:8080;\n            #root /www;\n            index  index.html index.htm;\n        &#125;\n\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n\n&#125;\n</code></pre>\n<p>浏览器请求效果如下：我们发送 0 号虚拟机的请求反向代理到我们的 1 号 Linux 中的 Tomcat 上</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-30-08-26-10_20230225141803.png\" alt=\"image_2023-01-30-08-26-10\" /></p>\n",
            "tags": [
                "nginx",
                "计算机学科"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB/",
            "title": "动静分离",
            "date_published": "2024-02-12T12:35:08.340Z",
            "content_html": "<h2 id=\"动静分离\"><a class=\"anchor\" href=\"#动静分离\">#</a> 动静分离</h2>\n<blockquote>\n<p>动静分离有一个比较常用的功能这个功能比较适用于中小型的网站，因为中小型网站的并发量不是很高而且需要分离出来的资源不是很多，需要将这些静态资源移动到前置的 Nginx 里</p>\n</blockquote>\n<p>为了提高网站的响应速度，减轻程序服务器 (Tomcat,Jboss 等) 的负载，对于静态资源，如图片，js,css 等文件，可以在反向代理服务器中进行缓存，这样浏览器在请求一个静态资源时，代理服务器就可以直接处理，而不用将请求转发给后端服务器，对于用户请求的动态文件，如 Servlet,jsp 则转发给 Tomcat,Jboss 服务器处理，这就是动静分离，即动态文件于静态文件的分离</p>\n<h3 id=\"使用动静分离的场景\"><a class=\"anchor\" href=\"#使用动静分离的场景\">#</a> 使用动静分离的场景</h3>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-29-19-25-18_20230225140701.png\" alt=\"image_2023-01-29-19-25-18\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-30-19-17-18_20230225140714.png\" alt=\"image_2023-01-30-19-17-18\" /></p>\n<p>动静分离可通过 location 对请求 url 进行匹配，将网站静态资源 (HTML,javaScript,CSS,img 等文件) 于后台应用分开部署，提高用户访问静态代码的速度，降低对后台应用访问，通常将静态资源放到 nginx 中，动态资源转发到 tomcat 服务器中</p>\n<p><strong>演示</strong></p>\n<p>0 号机 nginx 配置</p>\n<pre><code>server &#123;\n        listen       8080;\n\t\n        server_name localhost;\n        location / &#123;\n\t\t#httpds随便起的别名,但是要与upstream对应得上,upstream和server是同一级别的\n\t\tproxy_pass http://192.168.244.139:8088;\n\t\t#root 只能查找本机中根目录的项目\n            #root   http://www.qq.com;\n            index  index.html index.htm;\n        &#125;\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n&#125;\n</code></pre>\n<p>1 号机的配置如下:</p>\n<pre><code>server &#123;\n        listen       8088;\n        server_name  localhost;\n\n        location / &#123;\n\t    proxy_pass http://192.168.244.139:8080/ngintestday28/web/;\n\t    #root /www;\n            index  index.html index.htm;\n        &#125;\n\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n\n&#125;\n</code></pre>\n<p>1 号机中配置了 Tomcat</p>\n<p>访问浏览器效果如下:</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-30-13-48-12_20230225140736.png\" alt=\"image_2023-01-30-13-48-12\" /></p>\n<p>将 1 号机中项目的静态文件删除</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-30-13-49-42_20230225140748.png\" alt=\"image_2023-01-30-13-49-42\" /></p>\n<p>刷新页面</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-30-13-50-08_20230225140759.png\" alt=\"image_2023-01-30-13-50-08\" /></p>\n<p>变成了原始的样式</p>\n<p><strong>配置反向代理服务器上静态资源</strong></p>\n<p>在 0 号机中配置如下:</p>\n<pre><code> server &#123;\n        listen       8080;\n\n        server_name localhost;\n        location / &#123;\n                #httpds随便起的别名,但是要与upstream对应得上,upstream和server是同一级别的\n                proxy_pass http://192.168.244.139:8088;\n                #root 只能查找本机中根目录的项目\n            #root   http://www.qq.com;\n            index  index.html index.htm;\n        &#125;\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n\n        #uri地址\n        location /css &#123;\n            #root 只能查找本机中根目录的项目\n            #不需要加额外的目录,在访问时会指向根路径然后顺便加上uri的地址同时拼接\n            root   html;                                                                                                                                  \n            index  index.html index.htm;\n        &#125;\n&#125;\n</code></pre>\n<p>在 0 号机的 html 目录下传输过去项目的 css 样式</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-30-14-00-23_20230225140816.png\" alt=\"image_2023-01-30-14-00-23\" /></p>\n<p>重启服务 <code>systemctl restart nginx.service</code>  , 请求访问地址查看效果</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-30-14-07-33_20230225140826.png\" alt=\"image_2023-01-30-14-07-33\" /></p>\n<p>静态资源由 nginx 返回，主页由 tomcat 返回</p>\n<p>剩下我们加上其它的样式代码</p>\n<ul>\n<li>js</li>\n</ul>\n<pre><code>server &#123;\n        listen       8080;\n\n        server_name localhost;\n        location / &#123;\n                #httpds随便起的别名,但是要与upstream对应得上,upstream和server是同一级别的\n                proxy_pass http://192.168.244.139:8088;\n                #root 只能查找本机中根目录的项目\n            #root   http://www.qq.com;\n            index  index.html index.htm;\n        &#125;\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n\n        #uri地址\n        location /css &#123;\n            #root 只能查找本机中根目录的项目\n            #不需要加额外的目录,在访问时会指向根路径然后顺便加上uri的地址同时拼接\n            root   html;\n            index  index.html index.htm;\n        &#125;\n\n        #uri地址\n        location /js &#123;\n            #root 只能查找本机中根目录的项目\n            #不需要加额外的目录,在访问时会指向根路径然后顺便加上uri的地址同时拼接\n            root   html;\n            index  index.html index.htm;\n        &#125;                                                                                                                                                 \n&#125;\n</code></pre>\n<p>重启服务 <code>systemctl restart nginx.service</code>  , 刷新页面查看效果</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-30-14-11-35_20230225140843.png\" alt=\"image_2023-01-30-14-11-35\" /></p>\n<p>可以看到 js 加载成功了</p>\n<ul>\n<li>fonts</li>\n</ul>\n<pre><code>#uri地址\n        location /fonts &#123;\n            #root 只能查找本机中根目录的项目                                                                                                              \n            #不需要加额外的目录,在访问时会指向根路径然后顺便加上uri的地址同时拼接\n            root   html;\n            index  index.html index.htm;\n        &#125;\n</code></pre>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-30-14-12-50_20230225140902.png\" alt=\"image_2023-01-30-14-12-50\" /></p>\n<ul>\n<li>img</li>\n</ul>\n<pre><code>#uri地址\n        location /img &#123;\n            #root 只能查找本机中根目录的项目\n            #不需要加额外的目录,在访问时会指向根路径然后顺便加上uri的地址同时拼接                                                                         \n            root   html;\n            index  index.html index.htm;\n        &#125;\n</code></pre>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-30-14-13-41_20230225140916.png\" alt=\"image_2023-01-30-14-13-41\" /></p>\n<p>重启服务 <code>systemctl restart nginx.service</code>  刷新页面查看效果</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-30-14-15-12_20230225140929.png\" alt=\"image_2023-01-30-14-15-12\" /></p>\n<blockquote>\n<p>弊端：代码过多冗余度太大，下面为解决方式：使用正则表达式来解决问题</p>\n</blockquote>\n<ul>\n<li>\n<p>正则规则：以～* 开始在小括号中写入 (x|x|x)</p>\n</li>\n<li>\n<p>~ 根目录<em>任意：跟目录开始</em>任意的地方</p>\n</li>\n</ul>\n<pre><code>server &#123;\n        listen       8080;\n\t\n        server_name localhost;\n        location / &#123;\n\t\t#httpds随便起的别名,但是要与upstream对应得上,upstream和server是同一级别的\n\t\tproxy_pass http://192.168.244.139:8088;\n\t\t#root 只能查找本机中根目录的项目\n            #root   http://www.qq.com;\n            index  index.html index.htm;\n        &#125;\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n\t\n\t#正则中不区分大小写,使用格式:(x|x|x|x)\n        location ~*/(js|css|img|fonts) &#123;\n\t    root html;\n            index  index.html index.htm;\n        &#125;\n&#125;\n</code></pre>\n<ul>\n<li>重启服务后，刷新页面查看效果</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-30-14-25-44_20230225140952.png\" alt=\"image_2023-01-30-14-25-44\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-30-14-26-23_20230225141003.png\" alt=\"image_2023-01-30-14-26-23\" /></p>\n<p>正常访问</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-30-14-45-45_20230225141014.png\" alt=\"image_2023-01-30-14-45-45\" /></p>\n<p><strong>使用正则配置动静分离</strong></p>\n<p>常见的 Nginx 正则表达式</p>\n<pre><code>^:匹配输入字符串的起始位置\n$:匹配输入字符串的结束位置\n*:匹配前面字符零次或多次.如&quot;ol*&quot;能匹配&quot;o&quot;及&quot;ol&quot;,&quot;oll&quot;\n+:匹配前面的字符一次或多次.如&quot;ol+&quot;能匹配&quot;ol&quot;及&quot;oll&quot;,&quot;olll&quot;但不能匹配&quot;o&quot;\n?:匹配前面的字符零次或一次.如&quot;do(es)?&quot;能匹配&quot;do&quot;或者&quot;does&quot;,&quot;?&quot;等效于&quot;&#123;0,1&#125;&quot;\n.:匹配除&quot;\\n&quot;之外的任何单个字符,诺要匹配包括&quot;\\n&quot;在内的任意字符,请使用诸如&quot;[.\\n]&quot;之类的模式\n\\:将后面接着的字符标记为一个特殊字符或一个原意字符或一个向后引用,如&quot;\\n&quot;匹配一个换行符,而&quot;\\$&quot;则匹配&quot;$&quot;\n\\d:匹配纯数字\n&#123;n&#125;:重复n次\n&#123;n,&#125;:重复n次或更多次\n&#123;n,m&#125;重复n到m次\n[]:定义匹配的字符范围\n[c]:匹配单个字符c\n[a-z]:匹配a-z小写字母的任意一个\n[a-zA-Z0-9]:匹配所有大小写字母或数字\n():表达式开始和结束位置\n|:或运算符 //例如:(js|img|css)\n</code></pre>\n<p>location 正则:</p>\n<pre><code>//location大致可分为三类\n精准匹配:location = /&#123;&#125;\n一般匹配:location /&#123;&#125;\n正则匹配: location ~/&#123;&#125;\n//location常用的匹配规则\n=:进行普通字符精准匹配,也即是完全匹配\n^~:表示前缀字符串匹配(不是正则匹配,需要使用字符串),如果匹配成功,则不再匹配其它,location\n~:区分大小写的匹配(需要用正则表达式)\n~*:不区分大小写的匹配(需要使用正则表达式)\n!~:区分大小写的匹配取非(需要使用正则表达式)\n!~*:不区分大小写的匹配取非(需要使用正表达式)\n//优先级\n首先精准匹配 =\n其次匹配前缀匹配 ^~\n其次是按文件中顺序的正则匹配 ~或~*\n然后匹配不带任何修饰的前缀匹配\n最后是交给 / 通用匹配\n</code></pre>\n<p><strong>注意</strong></p>\n<ul>\n<li>\n<p>精准匹配: = , 后面的表达式中写的是纯字符串</p>\n</li>\n<li>\n<p>字符串匹配: ^~ 和 <code>字符串匹配</code> ，后面的表达式中写的是纯字符串</p>\n</li>\n<li>\n<p>正则匹配: <sub>和</sub><em>和！<sub> 和！</sub></em>, 后面的表达式中写的是正则表达式</p>\n</li>\n</ul>\n<pre><code> (1）location = / &#123;&#125;\n=为精确匹配 / ，主机名后面不能带任何字符串，比如访问 / 和 /data，则 / 匹配，/data 不匹配\n再比如 location = /abc，则只匹配/abc ，/abc/或 /abcd不匹配。若 location  /abc，则即匹配/abc 、/abcd/ 同时也匹配 /abc/。\n\n（2）location / &#123;&#125;\n因为所有的地址都以 / 开头，所以这条规则将匹配到所有请求 比如访问 / 和 /data, 则 / 匹配， /data 也匹配，\n但若后面是正则表达式会和最长字符串优先匹配（最长匹配）\n\n（3）location /documents/ &#123;&#125;\n匹配任何以 /documents/ 开头的地址，匹配符合以后，还要继续往下搜索其它 location\n只有其它 location后面的正则表达式没有匹配到时，才会采用这一条\n\n（4）location /documents/abc &#123;&#125;\n匹配任何以 /documents/abc 开头的地址，匹配符合以后，还要继续往下搜索其它 location\n只有其它 location后面的正则表达式没有匹配到时，才会采用这一条\n\n（5）location ^~ /images/ &#123;&#125;\n匹配任何以 /images/ 开头的地址，匹配符合以后，停止往下搜索正则，采用这一条\n\n（6）location ~* \\.(gif|jpg|jpeg)$ &#123;&#125;\n匹配所有以 gif、jpg或jpeg 结尾的请求\n然而，所有请求 /images/ 下的图片会被 location ^~ /images/ 处理，因为 ^~ 的优先级更高，所以到达不了这一条正则\n\n（7）location /images/abc &#123;&#125;\n最长字符匹配到 /images/abc，优先级最低，继续往下搜索其它 location，会发现 ^~ 和 ~ 存在\n\n（8）location ~ /images/abc &#123;&#125;\n匹配以/images/abc 开头的，优先级次之，只有去掉 location ^~ /images/ 才会采用这一条\n\n（9）location /images/abc/1.html &#123;&#125;\n匹配/images/abc/1.html 文件，如果和正则 ~ /images/abc/1.html 相比，正则优先级更高\n\n优先级总结：\n(location =) &gt; (location 完整路径) &gt; (location ^~ 路径) &gt; (location ~,~* 正则顺序) &gt; (location 部分起始路径) &gt; (location /)\n</code></pre>\n<p>实际网站使用中，至少有三个匹配规则定义:</p>\n<ul>\n<li>第一个匹配必选规则:</li>\n</ul>\n<p>直接匹配网站根，通过域名访问网站首页比较频繁，使用这个会加速处理，比如说官网，这里是直接转发给后端应用服务器了，也可以是一个静态首页</p>\n<pre><code>location = / &#123;\n    proxy_pass http://127.0.0.1:8080/; \n&#125;\n</code></pre>\n<ul>\n<li>第二个必选规则:</li>\n</ul>\n<p>处理静态文件请求，这是 nginx 作为 http 服务器的强项，有两种配置模式，目录匹配或后缀匹配，人选其一或搭配使用</p>\n<pre><code>location ^~ /static/ &#123;\n    root /webroot/static/;\n&#125;\n\nlocation ~* \\.(html|gif|jpg|jpeg|png|css|js|ico)$ &#123;\n    root /webroot/res/;\n&#125;\n</code></pre>\n<ul>\n<li>第三个规则:</li>\n</ul>\n<p>通用规则，用来转发动态请求到后端服务器</p>\n<pre><code>location /api/ &#123;\n    proxy_pass http://127.0.0.1:3000/api/\n&#125;\n</code></pre>\n<h4 id=\"urlrewrite\"><a class=\"anchor\" href=\"#urlrewrite\">#</a> URLRewrite</h4>\n<p>rewrite 是实现 URL 重写的关键指令，根据 regex (正则表达式) 部分内容，重定向到 repacement, 结尾是 flag 标记</p>\n<p>格式:</p>\n<p>rewrite         &lt;regex&gt;         &lt;replacement&gt;       &lt;flag&gt;</p>\n<p>关键字              正则                    替代内容               标记</p>\n<p>关键字：其中关键字 error_log 不能改变</p>\n<p>正则:perl 兼容正则表达式语句进行规则匹配</p>\n<p>替代内容：将正则匹配的内容替换成 replacement</p>\n<p>flag 标记:rewrite 支持的 flag 标记</p>\n<p>flag 标记说明:</p>\n<p>last: &lt;font color=&quot;red&quot;&gt;# 本条规则匹配完成后，继续向下匹配新的 location URI 规则 &lt;/font&gt;</p>\n<p>break: &lt;font color=&quot;red&quot;&gt;# 本条规则匹配完成即终止，不再匹配后面的任何规则 &lt;/font&gt;</p>\n<p>redirect: &lt;font color=&quot;red&quot;&gt;# 返回 302 临时重定向，浏览器地址会显示跳转后的 URL 地址 &lt;/font&gt;</p>\n<p>permanment: &lt;font color=&quot;red&quot;&gt;# 返回 301 永久重定向，浏览器地址栏会显示跳转后的 URL 地址 &lt;/font&gt;</p>\n<p>URLRewrite 的优缺点</p>\n<p>优点：掩藏真实的 url 以及 url 中可能暴漏的参数，以及隐藏 web 使用的编程语言，提高安全性便于搜索引擎收录</p>\n<p>缺点：降低效率，影响性能，如果项目是内网使用，比如公司内部软件，则没有必要配置</p>\n<h4 id=\"负载均衡urlrewrite\"><a class=\"anchor\" href=\"#负载均衡urlrewrite\">#</a> 负载均衡 + URLRewrite</h4>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-31-20-25-32_20230225141044.png\" alt=\"image_2023-01-31-20-25-32\" /></p>\n<p>开启 101 的防火墙</p>\n<pre><code>systemctl start firewalld\n</code></pre>\n<ul>\n<li>重载规则</li>\n</ul>\n<pre><code>firewalld-cmd --reload\n</code></pre>\n<ul>\n<li>查看已配置规则</li>\n</ul>\n<pre><code>firewalld-cmd --list-all\n</code></pre>\n<ul>\n<li>\n<p>设置规则需要注意的是:ip 为目标开放主机，端口号为本机要开放的端口号</p>\n</li>\n<li>\n<p>添加指定端口和 ip 访问（添加之后记得重新启动防火墙）</p>\n</li>\n</ul>\n<pre><code>firewalld-cmd --permanent --add-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;192.168.244.128&quot; port protocol=&quot;tcp&quot; port=&quot;8088&quot; accept&quot;\n</code></pre>\n<ul>\n<li>\n<p>ip: 为 0 号 Linux 的 ip</p>\n</li>\n<li>\n<p>port: 为 1 号 Linux 要开放的 Nginx 端口不需要开放 Tomcat 的端口号，也能访问到</p>\n</li>\n<li>\n<p>移除规则</p>\n</li>\n</ul>\n<pre><code>firewalld-cmd --permanent --remove-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;192.168.8.102&quot; port protocol=&quot;tcp&quot; port=&quot;8080&quot; accept&quot;\n</code></pre>\n<ul>\n<li>重启防火墙</li>\n</ul>\n<pre><code>firewalld-cmd --reload\n</code></pre>\n<p>测试:</p>\n<ul>\n<li>将 1 号 Linux 开启防火墙，然后通过 0 号 Linux 反向代理访问一下页面</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-31-16-00-49_20230225141102.png\" alt=\"image_2023-01-31-16-00-49\" /></p>\n<p>访问不到 Error 了</p>\n<p>执行命令让 1 号 Linux 不让内网访问到但是可以让 0 号 Linux 的 Nginx 访问到</p>\n<p>当我们配置如下配置后:</p>\n<ul>\n<li>0 号 Linux 配置如下:</li>\n</ul>\n<pre><code>server &#123;\n        listen       8089;\n        server_name localhost;\n        location / &#123;\n\t    #httpds随便起的别名,但是要与upstream对应得上,upstream和server是同一级别的\n     \t    proxy_pass http://192.168.244.139:8088;\n\t    #root 只能查找本机中根目录的项目\n            #root   http://www.qq.com;\n            index  index.html index.htm;\n        &#125;\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n\t\n\t#正则中不区分大小写,使用格式:(x|x|x|x)\n        location ~*/(js|css|img|fonts) &#123;\n\t    root html;\n            index  index.html index.htm;\n        &#125;\n\n    &#125;\n</code></pre>\n<ul>\n<li>1 号 Linux 配置如下:</li>\n</ul>\n<pre><code> server &#123;\n        listen       8088;\n        server_name  localhost;\n\n        location / &#123;\n\t    proxy_pass http://192.168.244.139:8080/ngintestday28/web/;\n\t    #root /www;\n            index  index.html index.htm;\n        &#125;\n\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n\n    &#125;\n</code></pre>\n<p>1 号 Linux 对 0 号 Linux 开放端口的设置信息如下:</p>\n<p><code>rule family=&quot;ipv4&quot; source address=&quot;192.168.244.128&quot; port port=&quot;8088&quot; protocol=&quot;tcp&quot; accept</code></p>\n<p>命令为如下:</p>\n<p><code>sudo firewall-cmd --permanent --add-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;目标机IP(访问机)&quot; port protocol=&quot;协议&quot; port=&quot;本机Nginx端口&quot; accept&quot;</code></p>\n<h5 id=\"urlrewirte应用场景\"><a class=\"anchor\" href=\"#urlrewirte应用场景\">#</a> URLRewirte 应用场景</h5>\n<h5 id=\"配置方式\"><a class=\"anchor\" href=\"#配置方式\">#</a> 配置方式</h5>\n<h3 id=\"动静分离原理\"><a class=\"anchor\" href=\"#动静分离原理\">#</a> 动静分离原理</h3>\n<p>/css 的优先级比 / 高</p>\n<pre><code>location / &#123;#优先级比/css低\n        #httpds随便起的别名,但是要与upstream对应得上,upstream和server是同一级别的\n        proxy_pass http://192.168.244.139:8088;\n        #root 只能查找本机中根目录的项目\n    #root   http://www.qq.com;\n    index  index.html index.htm;                                                                                                                  \n&#125;\nerror_page   500 502 503 504  /50x.html;\nlocation = /50x.html &#123;\n    root   html;\n&#125;\n\n#uri地址\nlocation /css &#123;#优先级比/高\n    #root 只能查找本机中根目录的项目\n    #不需要加额外的目录,在访问时会指向根路径然后顺便加上uri的地址同时拼接\n    root   html;\n    index  index.html index.htm;\n&#125;\n</code></pre>\n",
            "tags": [
                "nginx",
                "计算机学科"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/%E5%AE%89%E8%A3%85LNMP%E7%8E%AF%E5%A2%83%E9%98%B2%E7%81%AB%E5%A2%99%E9%85%8D%E7%BD%AE/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/%E5%AE%89%E8%A3%85LNMP%E7%8E%AF%E5%A2%83%E9%98%B2%E7%81%AB%E5%A2%99%E9%85%8D%E7%BD%AE/",
            "title": "安装LNMP环境防火墙配置",
            "date_published": "2024-02-12T12:35:08.296Z",
            "content_html": "<p><strong>网络术语</strong>:</p>\n<p><strong>LNMP</strong> 是指一组通常一起使用来运行动态网站或者服务器的自由软件名称首字母缩写，L 指 Linux,N 指 Nginx,M 一般指 MySQL, 也可以指 MariaDB,P 一般指 PHP, 也可以指 Perl 或 Python</p>\n<p>集成环境网站: <code>oneinstack.com</code></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-02-11-54-14_20230225140420.png\" alt=\"image_2023-02-02-11-54-14\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-02-11-54-55_20230225140432.png\" alt=\"image_2023-02-02-11-54-55\" /></p>\n<p>选择好要安装的后复制 wget 命令</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-02-11-56-36_20230225140443.png\" alt=\"image_2023-02-02-11-56-36\" /></p>\n<p>在 Linux 中直接执行命令即可安装</p>\n<p>安装完成后的软件位置</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-02-11-57-19_20230225140455.png\" alt=\"image_2023-02-02-11-57-19\" /></p>\n<p>如果访问不到 oneinstack 则如下操作:</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-02-12-01-03_20230225140508.png\" alt=\"image_2023-02-02-12-01-03\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-02-12-01-20_20230225140521.png\" alt=\"image_2023-02-02-12-01-20\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240212202537236.png\" alt=\"image-20240212202537236\" /></p>\n<p>再次访问 ip</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-02-12-02-48_20230225140544.png\" alt=\"image_2023-02-02-12-02-48\" /></p>\n<p>但是网站连接是不安全的</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240212202524096.png\" alt=\"image-20240212202524096\" /></p>\n<h3 id=\"修改nginx默认主页\"><a class=\"anchor\" href=\"#修改nginx默认主页\">#</a> 修改 Nginx 默认主页</h3>\n<p>从给出的路径 cd 到 Nginx 的 html 目录下</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-02-14-50-18_20230225140608.png\" alt=\"image_2023-02-02-14-50-18\" /></p>\n<p>配置到 html</p>\n",
            "tags": [
                "nginx",
                "计算机学科"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/%E5%AE%89%E8%A3%85Discuz%E4%B8%8E%E5%8D%8F%E8%AE%AE%E8%87%AA%E5%8A%A8%E8%B7%B3%E8%BD%AC/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/%E5%AE%89%E8%A3%85Discuz%E4%B8%8E%E5%8D%8F%E8%AE%AE%E8%87%AA%E5%8A%A8%E8%B7%B3%E8%BD%AC/",
            "title": "安装Discuz与协议自动跳转",
            "date_published": "2024-02-12T12:35:08.276Z",
            "content_html": "<p>访问官网地址:<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kaXNjdXoubmV0Lw==\">1</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-04-14-48-14_20230225140313.png\" alt=\"image_2023-02-04-14-48-14\" /></p>\n<p>上传到 Nginx 的 html 目录下</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-04-14-55-22_20230225140326.png\" alt=\"image_2023-02-04-14-55-22\" /></p>\n<p>解压缩: <code>unzip [压缩包名称]</code>  如果 unzip 报红，说明没有这个指令，执行命令查看包管理器中有没有该程序</p>\n<pre><code>yum list unzip\n</code></pre>\n<p>选择安装</p>\n<p>然后解压</p>\n<p><code>unzip [压缩包名]</code></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-04-12-13-23_20230225140340.png\" alt=\"image_2023-02-04-12-13-23\" /></p>\n<p>如果配置了安全证书那么，需要将显示的页面配置放到 443 安全证书配置的配置作用域下否则访问 https 443 端口不会走默认的 80 端口就不能访问到我们想要展示的页面了</p>\n<p>安装 Discuz</p>\n<p>如果上传了 upload 目录访问:</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly94bi0tY2VzNmF5NTFzenpkL3VwbG9hZC9pbnN0YWxs\">https:// 网站地址 /upload/install</span></p>\n<p>只上传了 upload 的目录内文件及访问</p>\n<p>浏览器访问 https:// 网站地址 /install</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-04-21-30-02_20230225140354.png\" alt=\"image_2023-02-04-21-30-02\" /></p>\n",
            "tags": [
                "nginx",
                "计算机学科"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/Nginx%E5%BC%80%E6%BA%90%E7%89%88%E5%AE%89%E8%A3%85/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/Nginx%E5%BC%80%E6%BA%90%E7%89%88%E5%AE%89%E8%A3%85/",
            "title": "nginx开源版安装",
            "date_published": "2024-02-12T12:35:08.255Z",
            "content_html": "<p>打开官网页面点击 <code>Download</code>  ，会跳转到一个下载的页面</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-09-02-32_20230225140136.png\" alt=\"image_2023-01-28-09-02-32\" /></p>\n<p>点击下载 Linux 版的 Nginx，之后上传到 Linux 中</p>\n<p>解压 Nginx</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-09-22-01_20230225140146.png\" alt=\"image_2023-01-28-09-22-01\" /></p>\n<p>解压完成后进入到解压后的目录中</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-09-23-03_20230225140157.png\" alt=\"image_2023-01-28-09-23-03\" /></p>\n<p>目录中有一个 <code>configure</code>  脚本，用这个脚本来安装，安装过程中需要一些依赖</p>\n<p>执行该脚本进行安装可能会报错提示需要的依赖没有找到的错误</p>\n<p>需要的依赖：</p>\n<ul>\n<li>gcc：执行命令 <code>sudo yum install -y gcc</code></li>\n</ul>\n<p>错误提示:</p>\n<pre><code>./configure: error: the HTTP rewrite module requires the PCRE library.\nYou can either disable the module by using --without-http_rewrite_module\noption, or install the PCRE library into the system, or build the PCRE library\nstatically from the source with nginx by using --with-pcre=&lt;path&gt; option.\n</code></pre>\n<p><strong>缺少 pcre</strong> 库</p>\n<ul>\n<li>pcre: 执行命令： <code>sudo yum install -y pcre pcre-devel</code></li>\n</ul>\n<p><strong>同样的报错可能缺少 <code>zlib库</code> </strong></p>\n<ul>\n<li>zlib: 执行命令： <code>sudo yum install -y zlib zlib-devel</code></li>\n</ul>\n<p>报错解决！！执行下一步操作</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-09-34-26_20230225140212.png\" alt=\"image_2023-01-28-09-34-26\" /></p>\n<p>执行 <code>make</code></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-09-36-32_20230225140226.png\" alt=\"image_2023-01-28-09-36-32\" /></p>\n<p>执行 <code>sudo make install</code></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-09-38-18_20230225140240.png\" alt=\"image_2023-01-28-09-38-18\" /></p>\n<p>安装成功</p>\n<p>启动 Nginx 进入 sbin 目录在这个目录中有一个可执行的文件为 <code>nginx</code></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-09-39-54_20230225140252.png\" alt=\"image_2023-01-28-09-39-54\" /></p>\n<p>启动 Nginx</p>\n",
            "tags": [
                "nginx",
                "计算机学科"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/Nginx%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/Nginx%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/",
            "title": "nginx基础配置",
            "date_published": "2024-02-12T12:35:08.239Z",
            "content_html": "<h3 id=\"最小配置文件\"><a class=\"anchor\" href=\"#最小配置文件\">#</a> 最小配置文件</h3>\n<p><strong>Worker_processes</strong></p>\n<p><code>Worker_processes  1;</code>  默认为 1, 表示开启一个业务进程</p>\n<p><strong>Worker_connections</strong></p>\n<p><code>Worker_connection  1024;</code>  单个业务进程可接受连接数</p>\n<p><strong>include  mime.types;</strong></p>\n<p><code>include   mime.types;</code>  引入 http mime 类型</p>\n<p><strong>default_type application/octet-stream</strong></p>\n<p><code>default_type application/octet-stream</code>  如果 mime 类型没匹配上，默认使用二进制流的方式传输</p>\n<p><strong>sendfile on</strong></p>\n<p><code>sendfile on</code>  使用 Linux 的 sendfile (socket,file,len) 高效网络传输，也就是数据 0 拷贝</p>\n<p>未开启 sendfile</p>\n<h3 id=\"核心配置-需要注意以下是购买的域名可以这样使用本地ip或者主机名不能这么玩\"><a class=\"anchor\" href=\"#核心配置-需要注意以下是购买的域名可以这样使用本地ip或者主机名不能这么玩\">#</a> 核心配置 需要注意 =&gt;:<mark> 以下是购买的域名可以这样，使用本地 IP 或者主机名不能这么玩</mark></h3>\n<pre><code>worker_processes  1;\t#开启n个进程\n\nevents &#123;\t#事件驱动模块\n    worker_connections  1024;\t#每个worker可以创建出多少个连接\n&#125;\n\nhttp &#123;\n    include       mime.types;\t#引入,将其它的配置文件引入到主的配置文件里\n    default_type  application/octet-stream;\t#如果mime.types中没有匹配类型则执行默认的方式传输给客户端\n\n    sendfile        on;\t#数据0拷贝\n\n    keepalive_timeout  65;\n\n#虚拟主机 vhost\n    server &#123;\n        listen       8080; #端口号\n        server_name  ~^[0-9]+\\.mmban\\.com$; #当前主机的主机名,域名\n        location / &#123;\n            root   /www/vod;\t#项目的跟目录\n            index  index.html index.htm;\n        &#125;\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n    &#125;\n&#125;\n</code></pre>\n<h3 id=\"虚拟主机配置\"><a class=\"anchor\" href=\"#虚拟主机配置\">#</a> 虚拟主机配置</h3>\n<ul>\n<li>~ 符号 ServerName 开始，写正则 ^ 开始 $ 结尾分号；ServerName 结尾</li>\n</ul>\n<pre><code>#虚拟主机 vhost\n    server &#123;\n        listen       8080; #端口号\n        server_name  ~^[0-9]+\\.mmban\\.com$; #当前主机的主机名,域名\n        location / &#123;\n            root   /www/vod;\t#项目的跟目录\n            index  index.html index.htm;\n        &#125;\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n    &#125;\n&#125;\n</code></pre>\n<h3 id=\"servername配置规则\"><a class=\"anchor\" href=\"#servername配置规则\">#</a> ServerName 配置规则</h3>\n<ul>\n<li>\n<p>本地 IP, 可以使用关键字反向代理 <code>proxy_pass</code></p>\n</li>\n<li>\n<p>servername 配置 Linux 的 hostname 这个 hostname 不能在 win 浏览器中被解析可在 Linux 本机被解析，因为它对应的是 Linux 本机的 ip 而 win 访问不到除非 win 在 hosts 文件中配置域名则可用配置的域名来访问</p>\n</li>\n</ul>\n<pre><code>server &#123;                                                                                                                                              \n    listen       8080;\n    #server_name 192.168.244.128;\n    #server_name localhost;\n    #在win中浏览器输入Linux的IP也能访问到项目,但不能win中输入bogon,Linux的主机名这样访问不到\n    server_name bogon;\n    location / &#123;\n            #反向代理关键字:proxy_pass\n            proxy_pass http://www.qq.com;\n            #root 只能查找本机中根目录的项目\n        #root   http://www.qq.com;\n        index  index.html index.htm;\n    &#125;\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html &#123;\n        root   html;\n    &#125;\n&#125;  \n</code></pre>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-29-08-49-45_20230225135924.png\" alt=\"image_2023-01-29-08-49-45\" /></p>\n<h4 id=\"在同一个servername中匹配多个域名\"><a class=\"anchor\" href=\"#在同一个servername中匹配多个域名\">#</a> 在同一个 ServerName 中匹配多个域名</h4>\n<ul>\n<li>小技巧：访问域名时在后面加上 /?xxx 就不会带有缓存来请求了</li>\n</ul>\n<pre><code>server &#123;\n   listen       8080; #端口号\n\n   server_name  www.mmban.com www1.mmban.com; #当前主机的主机名,域名\n\n   location / &#123;\n       root   /www/vod;\t#项目的跟目录\n       index  index.html index.htm;\n   &#125;\n\n   error_page   500 502 503 504  /50x.html;\n   location = /50x.html &#123;\n       root   html;\n   &#125;\n&#125;\n</code></pre>\n<h4 id=\"完整匹配\"><a class=\"anchor\" href=\"#完整匹配\">#</a> 完整匹配</h4>\n<ul>\n<li>顾名思义就是 <code>www.mmban.com</code></li>\n</ul>\n<h4 id=\"通配符匹配-可定义在www开头也可定义在com结尾\"><a class=\"anchor\" href=\"#通配符匹配-可定义在www开头也可定义在com结尾\">#</a> 通配符匹配，可定义在 www 开头也可定义在 com 结尾</h4>\n<pre><code>server &#123;\n    listen       8080; #端口号\n    server_name  *.mmban.com 或者 www.mmban.*; #当前主机的主机名,域名\n    location / &#123;\n        root   /www/vod;\t#项目的跟目录\n        index  index.html index.htm;\n    &#125;\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html &#123;\n        root   html;\n    &#125;\n&#125;\n</code></pre>\n<h4 id=\"正则匹配\"><a class=\"anchor\" href=\"#正则匹配\">#</a> 正则匹配</h4>\n<pre><code>server &#123;\n   listen       8080; #端口号\n   server_name  ~^[0-9]+\\.mmban\\.com$; #当前主机的主机名,域名\n   location / &#123;\n       root   /www/vod;\t#项目的跟目录\n       index  index.html index.htm;\n   &#125;\n   error_page   500 502 503 504  /50x.html;\n   location = /50x.html &#123;\n       root   html;\n   &#125;\n&#125;\n</code></pre>\n<h4 id=\"基于互联网的几种需求解析\"><a class=\"anchor\" href=\"#基于互联网的几种需求解析\">#</a> 基于互联网的几种需求解析</h4>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-21-52-38_20230225135941.png\" alt=\"image_2023-01-28-21-52-38\" /></p>\n<h4 id=\"配置多个站点\"><a class=\"anchor\" href=\"#配置多个站点\">#</a> 配置多个站点</h4>\n<p><strong>server_name 只能配置 localhost 或者 IP 地址 这两个不能使用 www. 或者.com 来拼接会访问不到</strong></p>\n<ol>\n<li>在跟目录下 / 创建一个 www 目录  因为 location 是从 / 跟目录开始的</li>\n</ol>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-20-24-20_20230225135954.png\" alt=\"image_2023-01-28-20-24-20\" /></p>\n<ol start=\"2\">\n<li>进入 www 目录中创建两个站点</li>\n</ol>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-20-26-10_20230225140006.png\" alt=\"image_2023-01-28-20-26-10\" /></p>\n<ol start=\"3\">\n<li>在进入两个站点分别创建不同的页面以区分</li>\n</ol>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-20-29-47_20230225140017.png\" alt=\"image_2023-01-28-20-29-47\" /></p>\n<ol start=\"4\">\n<li>在 nginx 配置文件中，配置两个站点</li>\n</ol>\n<p><strong>不同端口号</strong></p>\n<pre><code> server &#123;\n     listen       8080;\n     server_name  localhost;\n     location / &#123;\n         root   /www/www;\n         index  index.html index.htm;\n     &#125;\n     error_page   500 502 503 504  /50x.html;\n     location = /50x.html &#123;\n         root   html;\n     &#125;\n &#125;\n#1\n server &#123;\n     listen       8088;\n     server_name  localhost;\n     location / &#123;                                                                                                                                      \n         root   /www/vod;\n         index  index.html index.htm;\n     &#125;\n     error_page   500 502 503 504  /50x.html;\n     location = /50x.html &#123;\n         root   html;\n     &#125;\n &#125;\n</code></pre>\n<ol start=\"5\">\n<li>保存退出后重启 nginx 服务</li>\n</ol>\n<ul>\n<li>端口为：8080 的</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-20-35-52_20230225140032.png\" alt=\"image_2023-01-28-20-35-52\" /></p>\n<ul>\n<li>端口为：8088 的</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-20-36-23_20230225140052.png\" alt=\"image_2023-01-28-20-36-23\" /></p>\n",
            "tags": [
                "nginx",
                "计算机学科"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/Nginx%E5%A4%9A%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B%E5%92%8C%E5%9F%BA%E6%9C%AC%E8%AF%B7%E6%B1%82%E6%B5%81%E7%A8%8B/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/Nginx%E5%A4%9A%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B%E5%92%8C%E5%9F%BA%E6%9C%AC%E8%AF%B7%E6%B1%82%E6%B5%81%E7%A8%8B/",
            "title": "nginx多进程模型和基本请求流程",
            "date_published": "2024-02-12T12:35:08.224Z",
            "content_html": "<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-11-16-56_20230225135830.png\" alt=\"image_2023-01-28-11-16-56\" /></p>\n<p>当我们通过地址发送请求之后，Nginx 的主目录下有个 sbin/nginx 可执行文件，可执行文件启动之后开启 Master 主进程，这个主进程会把配置文件读取出来然后在进行一次校验，如果没有任何错误则会开启子进程</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-11-20-56_20230225135843.png\" alt=\"image_2023-01-28-11-20-56\" /></p>\n<p>主进程和子进程都启动完成之后</p>\n<ul>\n<li>总结</li>\n</ul>\n<ol>\n<li>\n<p>nginx 启动是多进程同时运行的由主进程 fork 出来的子进程，已经不单单是多线程了是多进程，主进程用于协调子进程</p>\n</li>\n<li>\n<p>Worker 读取配置文件</p>\n</li>\n</ol>\n",
            "tags": [
                "nginx",
                "计算机学科"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/https%E8%AF%81%E4%B9%A6%E9%85%8D%E7%BD%AE/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/https%E8%AF%81%E4%B9%A6%E9%85%8D%E7%BD%AE/",
            "title": "https证书配置",
            "date_published": "2024-02-12T12:35:08.210Z",
            "content_html": "<h1 id=\"https证书配置\"><a class=\"anchor\" href=\"#https证书配置\">#</a> https 证书配置</h1>\n<h3 id=\"不安全的http协议\"><a class=\"anchor\" href=\"#不安全的http协议\">#</a> 不安全的 http 协议</h3>\n<p><a href=\"./%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84http%E5%8D%8F%E8%AE%AE.md\">1</a></p>\n<h3 id=\"https原理\"><a class=\"anchor\" href=\"#https原理\">#</a> https 原理</h3>\n<h4 id=\"非对称加密算法原理\"><a class=\"anchor\" href=\"#非对称加密算法原理\">#</a> 非对称加密算法原理</h4>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-03-09-50-02_20230225135318.png\" alt=\"image_2023-02-03-09-50-02\" /></p>\n<p>浏览器将公钥 + 算法得到密文传输给服务器通过 443 端口下载浏览器传输过来的公钥然后私钥 + 算法进行解密得到明文，传输给浏览器后，同样浏览器得到私钥然后 + 算法得到明文</p>\n<p>公钥加密后不能使用公钥解密，如果可以则说明不够安全</p>\n<h4 id=\"同样不安全的非对称算法\"><a class=\"anchor\" href=\"#同样不安全的非对称算法\">#</a> 同样不安全的非对称算法</h4>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-04-11-20-35_20230225135333.png\" alt=\"image_2023-02-04-11-20-35\" /></p>\n<h4 id=\"ca机构\"><a class=\"anchor\" href=\"#ca机构\">#</a> CA 机构</h4>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-04-12-16-34_20230225135346.png\" alt=\"image_2023-02-04-12-16-34\" /></p>\n<ul>\n<li>https21 世纪最伟大的互联网发明</li>\n</ul>\n<h4 id=\"证书\"><a class=\"anchor\" href=\"#证书\">#</a> 证书</h4>\n<p>查看证书:</p>\n<p>win+R 执行命令: <code>certmgr.msc</code></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-02-10-15-51_20230225135400.png\" alt=\"image_2023-02-02-10-15-51\" /></p>\n<h4 id=\"客户端浏览器\"><a class=\"anchor\" href=\"#客户端浏览器\">#</a> 客户端 (浏览器)</h4>\n<h4 id=\"服务器端\"><a class=\"anchor\" href=\"#服务器端\">#</a> 服务器端</h4>\n<h3 id=\"openssl\"><a class=\"anchor\" href=\"#openssl\">#</a> OpenSSL</h3>\n<p>openssl 包含：SSL 协议库，应用程序以及密码算法库</p>\n<h3 id=\"自签名\"><a class=\"anchor\" href=\"#自签名\">#</a> 自签名</h3>\n<h4 id=\"openssl-2\"><a class=\"anchor\" href=\"#openssl-2\">#</a> OpenSSL</h4>\n<p>系统内置</p>\n<h4 id=\"图形化工具xca\"><a class=\"anchor\" href=\"#图形化工具xca\">#</a> 图形化工具 XCA</h4>\n<p>下载地址:<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaG9obnN0YWVkdC5kZS94Y2EvaW5kZXgucGhwL2Rvd25sb2Fk\">1</span></p>\n<h4 id=\"ca签名\"><a class=\"anchor\" href=\"#ca签名\">#</a> CA 签名</h4>\n<h3 id=\"证书字签名\"><a class=\"anchor\" href=\"#证书字签名\">#</a> 证书字签名</h3>\n<h3 id=\"在线证书申请\"><a class=\"anchor\" href=\"#在线证书申请\">#</a> 在线证书申请</h3>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-04-12-29-05_20230225135417.png\" alt=\"image_2023-02-04-12-29-05\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-04-12-30-13_20230225135428.png\" alt=\"image_2023-02-04-12-30-13\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-04-12-31-30_20230225135440.png\" alt=\"image_2023-02-04-12-31-30\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-04-12-32-05_20230225135453.png\" alt=\"image_2023-02-04-12-32-05\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-04-12-33-14_20230225135507.png\" alt=\"image_2023-02-04-12-33-14\" /></p>\n<p>密钥算法：RSA: 非对称算法</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-04-12-34-15_20230225135529.png\" alt=\"image_2023-02-04-12-34-15\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-04-12-37-10_20230225135540.png\" alt=\"image_2023-02-04-12-37-10\" /></p>\n<h3 id=\"将申请证书配置到nginx上\"><a class=\"anchor\" href=\"#将申请证书配置到nginx上\">#</a> 将申请证书配置到 Nginx 上</h3>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-04-12-40-56_20230225135551.png\" alt=\"image_2023-02-04-12-40-56\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-04-12-41-26_20230225135614.png\" alt=\"image_2023-02-04-12-41-26\" /></p>\n<p>解压缩后上传服务器上，传到 Nginx 得跟目录下</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-04-13-34-59_20230225135629.png\" alt=\"image_2023-02-04-13-34-59\" /></p>\n<h4 id=\"证书安装\"><a class=\"anchor\" href=\"#证书安装\">#</a> 证书安装</h4>\n<p>将如下配置到 Nginx 的 conf 文件中</p>\n<pre><code>server&#123;\n    listen  443 ssl;\n    server_name     aa.abc.com;\n    \n    ssl_certificate     /data/cert/server.crt;\n    ssl_certificate_key     /data/cert/server.key;\n&#125;\n</code></pre>\n<p>将两个解压缩后的文件放到 conf 目录下</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-04-14-44-58_20230225135642.png\" alt=\"image_2023-02-04-14-44-58\" /></p>\n<h3 id=\"http协议跳转https\"><a class=\"anchor\" href=\"#http协议跳转https\">#</a> http 协议跳转 https</h3>\n<p><code>return 301 https://$server_name$request_uri</code></p>\n",
            "tags": [
                "nginx",
                "计算机学科"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/Basics/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/02/12/computer-science/nginx/Basics/",
            "title": "Basics",
            "date_published": "2024-02-12T12:35:08.197Z",
            "content_html": "<h3 id=\"启动nginx\"><a class=\"anchor\" href=\"#启动nginx\">#</a> 启动 Nginx</h3>\n<p>进入安装好的目录 <code>/user/local/nginx/sbin</code></p>\n<pre><code>./nginx 启动\n./nginx -s stop 快速停止\n./nginx -s quit 优雅关闭，在退出前完成已经接收的连接请求\n./nginx -s reload 重新加载配置\n</code></pre>\n<p>nginx 启动后如果使用 kill -9 来进行关闭的话会很费劲所以不建议干这么蠢的事儿</p>\n<p>访问：浏览器输入自己 Linux 的 IP</p>\n<p>访问效果：</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20230128164349106_20230225095816.png\" alt=\"image-20230128164349106\" /></p>\n<p>如果不能访问的解决方案如下：</p>\n<ul>\n<li>查看是否开启了防火墙</li>\n</ul>\n<p>如果开启了就关闭防火墙</p>\n<ul>\n<li>查看自己上次是否改了端口号或者端口并不是 80 的话，80 是浏览器默认的端口所以访问时不用输入但是如果改了端口号那么需要在 ip 地址后加冒号：跟端口号我改的是 8080 所以要加上 8080 完整的访问地址为</li>\n</ul>\n<p><code>192.168.244.128:8080</code></p>\n<h2 id=\"安装成系统服务\"><a class=\"anchor\" href=\"#安装成系统服务\">#</a> 安装成系统服务</h2>\n<p>创建服务脚本</p>\n<p><code>vim /usr/lib/systemd/system/nginx.service</code></p>\n<p>服务脚本内容</p>\n<ul>\n<li>注意如果如下配置的路径与安装时的路径不匹配则需要更改否则不会生效因为会报错</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>Unit<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">Description</span><span class=\"token operator\">=</span>nginx - web server</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">After</span><span class=\"token operator\">=</span>network.target remote-fs.target nss-lookup.target</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>Service<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">Type</span><span class=\"token operator\">=</span>forking</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">PIDFile</span><span class=\"token operator\">=</span>/usr/local/nginx/logs/nginx.pid</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token assign-left variable\">ExecStartPre</span><span class=\"token operator\">=</span>/usr/local/nginx/sbin/nginx <span class=\"token parameter variable\">-t</span> <span class=\"token parameter variable\">-c</span> /usr/local/nginx/conf/nginx.conf</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token assign-left variable\">ExecStart</span><span class=\"token operator\">=</span>/usr/local/nginx/sbin/nginx <span class=\"token parameter variable\">-c</span> /usr/local/nginx/conf/nginx.conf</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">ExecReload</span><span class=\"token operator\">=</span>/usr/local/nginx/sbin/nginx <span class=\"token parameter variable\">-s</span> reload</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">ExecStop</span><span class=\"token operator\">=</span>/usr/local/nginx/sbin/nginx <span class=\"token parameter variable\">-s</span> stop</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token assign-left variable\">ExecQuit</span><span class=\"token operator\">=</span>/usr/local/nginx/sbin/nginx <span class=\"token parameter variable\">-s</span> quit</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">PrivateTmp</span><span class=\"token operator\">=</span>true</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">[</span>Install<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token assign-left variable\">WantedBy</span><span class=\"token operator\">=</span>multi-user.target</pre></td></tr></table></figure><p>重新加载系统服务</p>\n<pre><code>systemctl daemon-reload\n</code></pre>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-10-39-03_20230225095831.png\" alt=\"image_2023-01-28-10-39-03\" /></p>\n<p>可以看到之前启动的 Nginx 服务还在并没有停止，也是依旧可以访问得到的</p>\n<p>停止服务</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-10-41-02_20230225095841.png\" alt=\"mage_2023-01-28-10-41-02\" /></p>\n<p>停止 nginx 服务后，开启系统服务</p>\n<pre><code>systemctl start nginx.service\n</code></pre>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-10-42-31_20230225095856.png\" alt=\"image_2023-01-28-10-42-31\" /></p>\n<p>可以看到服务已经启动了说明我们配置的没有任何问题</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-01-28-10-43-31_20230225095916.png\" alt=\"image_2023-01-28-10-43-31\" /></p>\n<p>可以看到系统服务确实没有报错并开启了</p>\n<p>将系统服务设置为<strong>开启自启动</strong></p>\n<pre><code>systemctl enable nginx.service \n</code></pre>\n",
            "tags": [
                "nginx",
                "计算机学科"
            ]
        }
    ]
}