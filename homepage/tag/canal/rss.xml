<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>homepage • Posts by &#34;canal&#34; tag</title>
        <link>https://pigpigletsgo.github.io/homepage</link>
        <description>欢迎来我的博客空间</description>
        <language>zh-CN</language>
        <pubDate>Wed, 24 Jan 2024 18:48:46 +0800</pubDate>
        <lastBuildDate>Wed, 24 Jan 2024 18:48:46 +0800</lastBuildDate>
        <category>mybatis</category>
        <category>问题总汇</category>
        <category>linux</category>
        <category>jdk版本问题</category>
        <category>springboot</category>
        <category>读取配置文件</category>
        <category>报错</category>
        <category>编码问题</category>
        <category>JdbcTemplate</category>
        <category>MyBatisPlus</category>
        <category>版本问题</category>
        <category>Jwt</category>
        <category>nginx</category>
        <category>java</category>
        <category>vim</category>
        <category>输入法</category>
        <category>Swing</category>
        <category>hexo</category>
        <category>shoka</category>
        <category>计算机底层</category>
        <category>english</category>
        <category>math</category>
        <category>算法</category>
        <category>计算机学科</category>
        <category>C</category>
        <category>介绍</category>
        <category>基础</category>
        <category>mysql</category>
        <category>git</category>
        <category>web</category>
        <category>坑点</category>
        <category>tools</category>
        <category>idea</category>
        <category>项目</category>
        <category>nodeJs</category>
        <category>vscode</category>
        <category>windows</category>
        <category>密码管理</category>
        <category>database</category>
        <category>JDBC</category>
        <category>mongodb</category>
        <category>redis</category>
        <category>navicat</category>
        <category>集群</category>
        <category>知识点</category>
        <category>代码经验</category>
        <category>jvm</category>
        <category>config配置类</category>
        <category>数据结构与算法</category>
        <category>图</category>
        <category>递归</category>
        <category>链表</category>
        <category>队列</category>
        <category>栈</category>
        <category>数组</category>
        <category>多路查找树</category>
        <category>排序</category>
        <category>查找</category>
        <category>哈希表</category>
        <category>树结构</category>
        <category>程序员常用的10中算法</category>
        <category>maven</category>
        <category>编程题</category>
        <category>动态规划</category>
        <category>贪心算法</category>
        <category>二叉树</category>
        <category>层序遍历</category>
        <category>后序遍历</category>
        <category>广度优先搜索</category>
        <category>还原二叉树</category>
        <category>双指针</category>
        <category>快慢指针</category>
        <category>分而治之</category>
        <category>对称二叉树</category>
        <category>堆</category>
        <category>小顶堆</category>
        <category>单调栈</category>
        <category>大顶堆</category>
        <category>逆波兰表达式</category>
        <category>servlet</category>
        <category>spring</category>
        <category>工具类</category>
        <category>开源项目框架</category>
        <category>案例Demo</category>
        <category>菜单数据结构</category>
        <category>网络编程</category>
        <category>分页</category>
        <category>多线程</category>
        <category>lombok</category>
        <category>爬虫</category>
        <category>API的区别</category>
        <category>第三方库</category>
        <category>Minio</category>
        <category>Thymeleaf</category>
        <category>hutool</category>
        <category>七牛云</category>
        <category>设计模式</category>
        <category>vue3</category>
        <category>websocket</category>
        <category>前后端交互</category>
        <category>数据格式</category>
        <category>axios</category>
        <category>mybatisplus-join</category>
        <category>ORM</category>
        <category>二叉树搜索树</category>
        <category>avl树</category>
        <category>二叉树的遍历</category>
        <category>优先级队列</category>
        <category>完全二叉树</category>
        <category>heapify</category>
        <category>堆排序</category>
        <category>动态数组</category>
        <category>红黑树</category>
        <category>阻塞队列</category>
        <category>进阶</category>
        <category>SSM</category>
        <category>springcloud</category>
        <category>springmvc</category>
        <category>springsecurity</category>
        <category>JWT</category>
        <category>MD5</category>
        <category>thymeleaf</category>
        <category>源码</category>
        <category>拦截器</category>
        <category>整合jar包</category>
        <category>Junit</category>
        <category>IO</category>
        <category>String</category>
        <category>number</category>
        <category>lambda</category>
        <category>http</category>
        <category>stream流</category>
        <category>对象</category>
        <category>泛型</category>
        <category>集合</category>
        <category>js</category>
        <category>jquery</category>
        <category>Knife4j</category>
        <category>JSR303</category>
        <category>devtools</category>
        <category>Docker</category>
        <category>Elasticsearch</category>
        <category>Nacos</category>
        <category>RabbitMQ</category>
        <category>部署</category>
        <category>springboot高级</category>
        <category>OpenResty</category>
        <category>Canal</category>
        <category>Seata</category>
        <category>Sentinel</category>
        <category>持久化</category>
        <item>
            <guid isPermalink="true">https://pigpigletsgo.github.io/homepage/2024/01/24/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/canal/%E5%AE%89%E8%A3%85Canal/</guid>
            <title>安装和配置Canal</title>
            <link>https://pigpigletsgo.github.io/homepage/2024/01/24/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/canal/%E5%AE%89%E8%A3%85Canal/</link>
            <category>计算机学科</category>
            <category>基础</category>
            <category>springcloud</category>
            <category>Canal</category>
            <pubDate>Wed, 24 Jan 2024 18:48:46 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;安装和配置canal&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#安装和配置canal&#34;&gt;#&lt;/a&gt; 安装和配置 Canal&lt;/h1&gt;
&lt;p&gt;下面我们就开启 mysql 的主从同步机制，让 Canal 来模拟 salve&lt;/p&gt;
&lt;h1 id=&#34;1开启mysql主从&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#1开启mysql主从&#34;&gt;#&lt;/a&gt; 1. 开启 MySQL 主从&lt;/h1&gt;
&lt;p&gt;Canal 是基于 MySQL 的主从同步功能，因此必须先开启 MySQL 的主从功能才可以。&lt;/p&gt;
&lt;p&gt;这里以之前用 Docker 运行的 mysql 为例：&lt;/p&gt;
&lt;h2 id=&#34;11开启binlog&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#11开启binlog&#34;&gt;#&lt;/a&gt; 1.1. 开启 binlog&lt;/h2&gt;
&lt;p&gt;打开 mysql 容器挂载的日志文件，我的在 &lt;code&gt;/tmp/mysql/conf&lt;/code&gt;  目录:&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310210931806.png&#34; alt=&#34;image-20210813153241537&#34; /&gt;&lt;/p&gt;
&lt;p&gt;修改文件：&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;figcaption data-lang=&#34;sh&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token function&#34;&gt;vi&lt;/span&gt; /tmp/mysql/conf/my.cnf&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;添加内容：&lt;/p&gt;
&lt;figure class=&#34;highlight ini&#34;&gt;&lt;figcaption data-lang=&#34;ini&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token key attr-name&#34;&gt;log-bin&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token value attr-value&#34;&gt;/var/lib/mysql/mysql-bin&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# 数据库名称&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token key attr-name&#34;&gt;binlog-do-db&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token value attr-value&#34;&gt;dkx&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;配置解读：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;log-bin=/var/lib/mysql/mysql-bin&lt;/code&gt; ：设置 binary log 文件的存放地址和文件名，叫做 mysql-bin&lt;/li&gt;
&lt;li&gt;&lt;code&gt;binlog-do-db=dkx&lt;/code&gt; ：指定对哪个 database 记录 binary log events，这里记录 heima 这个库&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;最终效果：&lt;/p&gt;
&lt;figure class=&#34;highlight ini&#34;&gt;&lt;figcaption data-lang=&#34;ini&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token section&#34;&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token section-name selector&#34;&gt;mysqld&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;skip-name-resolve&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token key attr-name&#34;&gt;character_set_server&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token value attr-value&#34;&gt;utf8&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token key attr-name&#34;&gt;datadir&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token value attr-value&#34;&gt;/var/lib/mysql&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token key attr-name&#34;&gt;server-id&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token value attr-value&#34;&gt;1000&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token key attr-name&#34;&gt;log-bin&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token value attr-value&#34;&gt;/var/lib/mysql/mysql-bin&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token key attr-name&#34;&gt;binlog-do-db&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token value attr-value&#34;&gt;dkx&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;重启 mysql&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;figcaption data-lang=&#34;sh&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token function&#34;&gt;docker&lt;/span&gt; restart mysql&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;可以看到如下图中出现了指定文件表示成功！&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211007103.png&#34; alt=&#34;image-20231021100731994&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;12设置用户权限&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#12设置用户权限&#34;&gt;#&lt;/a&gt; 1.2. 设置用户权限&lt;/h2&gt;
&lt;p&gt;接下来添加一个仅用于数据同步的账户，出于安全考虑，这里仅提供对 heima 这个库的操作权限。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-mysql&#34;&gt;create user canal@&#39;%&#39; IDENTIFIED by &#39;canal&#39;;
GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT,SUPER ON *.* TO &#39;canal&#39;@&#39;%&#39; identified by &#39;canal&#39;;
FLUSH PRIVILEGES;
&lt;/code&gt;&lt;/pre&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;figcaption data-lang=&#34;SQL&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;USER&lt;/span&gt; canal IDENTIFIED &lt;span class=&#34;token keyword&#34;&gt;BY&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;canal&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;GRANT&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;REPLICATION&lt;/span&gt; SLAVE&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;REPLICATION&lt;/span&gt; CLIENT &lt;span class=&#34;token keyword&#34;&gt;ON&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;TO&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;canal&#39;&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;@&#39;%&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;GRANT&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;ALL&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;PRIVILEGES&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;ON&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;TO&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;canal&#39;&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;@&#39;%&#39;&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;FLUSH &lt;span class=&#34;token keyword&#34;&gt;PRIVILEGES&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;mysql 8.0.2 可以使用如下命令：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;figcaption data-lang=&#34;SQL&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;USER&lt;/span&gt; canal IDENTIFIED &lt;span class=&#34;token keyword&#34;&gt;BY&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;canal&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;GRANT&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;SHOW&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;VIEW&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;REPLICATION&lt;/span&gt; SLAVE&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;REPLICATION&lt;/span&gt; CLIENT &lt;span class=&#34;token keyword&#34;&gt;ON&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;TO&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;canal&#39;&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;@&#39;%&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;FLUSH &lt;span class=&#34;token keyword&#34;&gt;PRIVILEGES&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;重启 mysql 容器即可&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;docker restart mysql
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;测试设置是否成功：在 mysql 控制台，或者 Navicat 中，输入命令：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;show master status;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img data-src=&#34;https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211015054.png&#34; alt=&#34;image-20231021101552134&#34; /&gt;&lt;/p&gt;
&lt;h1 id=&#34;2安装canal&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#2安装canal&#34;&gt;#&lt;/a&gt; 2. 安装 Canal&lt;/h1&gt;
&lt;h2 id=&#34;21创建网络&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#21创建网络&#34;&gt;#&lt;/a&gt; 2.1. 创建网络&lt;/h2&gt;
&lt;p&gt;我们需要创建一个网络，将 MySQL、Canal、MQ 放到同一个 Docker 网络中：&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;figcaption data-lang=&#34;sh&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token function&#34;&gt;docker&lt;/span&gt; network create dkx&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;让 mysql 加入这个网络：&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;figcaption data-lang=&#34;sh&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token function&#34;&gt;docker&lt;/span&gt; network connect dkx mysql&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h2 id=&#34;23安装canal&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#23安装canal&#34;&gt;#&lt;/a&gt; 2.3. 安装 Canal&lt;/h2&gt;
&lt;p&gt;课前资料中提供了 canal 的镜像压缩包:&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211145229.png&#34; alt=&#34;image-20210813161804292&#34; /&gt;&lt;/p&gt;
&lt;p&gt;大家可以上传到虚拟机，然后通过命令导入：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;docker load -i canal.tar
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;然后运行命令创建 Canal 容器：&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;figcaption data-lang=&#34;sh&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token function&#34;&gt;docker&lt;/span&gt; run &lt;span class=&#34;token parameter variable&#34;&gt;-p&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;11111&lt;/span&gt;:11111 &lt;span class=&#34;token parameter variable&#34;&gt;--name&lt;/span&gt; canal &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token parameter variable&#34;&gt;-e&lt;/span&gt; &lt;span class=&#34;token assign-left variable&#34;&gt;canal.destinations&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;dkx1 &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token parameter variable&#34;&gt;-e&lt;/span&gt; &lt;span class=&#34;token assign-left variable&#34;&gt;canal.instance.master.address&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;192.168&lt;/span&gt;.249.128:3306  &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token parameter variable&#34;&gt;-e&lt;/span&gt; &lt;span class=&#34;token assign-left variable&#34;&gt;canal.instance.dbUsername&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;canal  &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token parameter variable&#34;&gt;-e&lt;/span&gt; &lt;span class=&#34;token assign-left variable&#34;&gt;canal.instance.dbPassword&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;canal  &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token parameter variable&#34;&gt;-e&lt;/span&gt; &lt;span class=&#34;token assign-left variable&#34;&gt;canal.instance.connectionCharset&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;UTF-8 &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token parameter variable&#34;&gt;-e&lt;/span&gt; &lt;span class=&#34;token assign-left variable&#34;&gt;canal.instance.tsdb.enable&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;true &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token parameter variable&#34;&gt;-e&lt;/span&gt; &lt;span class=&#34;token assign-left variable&#34;&gt;canal.instance.gtidon&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;false  &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token parameter variable&#34;&gt;-e&lt;/span&gt; &lt;span class=&#34;token assign-left variable&#34;&gt;canal.instance.filter.regex&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;dkx&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;..&lt;/span&gt;* &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token parameter variable&#34;&gt;--network&lt;/span&gt; dkx1 &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token parameter variable&#34;&gt;-d&lt;/span&gt; canal/canal-server:v1.1.5&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;说明:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-p 11111:11111&lt;/code&gt; ：这是 canal 的默认监听端口&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-e canal.instance.master.address=mysql:3306&lt;/code&gt; ：数据库地址 (同一网络可以使用容器名互联) 和端口，如果不知道 mysql 容器地址，可以通过 &lt;code&gt;docker inspect 容器id&lt;/code&gt;  来查看&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-e canal.instance.dbUsername=canal&lt;/code&gt; ：数据库用户名&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-e canal.instance.dbPassword=canal&lt;/code&gt;  ：数据库密码&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-e canal.instance.filter.regex=&lt;/code&gt; ：要监听的表名称&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;表名称监听支持的语法：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mysql 数据解析关注的表，Perl正则表达式.
多个正则之间以逗号(,)分隔，转义符需要双斜杠(\\) 
常见例子：
1.  所有表：.*   or  .*\\..*
2.  canal schema下所有表： canal\\..*
3.  canal下的以canal打头的表：canal\\.canal.*
4.  canal schema下的一张表：canal.test1
5.  多个规则组合使用然后以逗号隔开：canal\\..*,mysql.test1,mysql.test2 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;查看启动日志，查看是否启动成功了：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh·&#34;&gt;[root@localhost tmp]# docker logs -f canal
DOCKER_DEPLOY_TYPE=VM
==&amp;gt; INIT /alidata/init/02init-sshd.sh
==&amp;gt; EXIT CODE: 0
==&amp;gt; INIT /alidata/init/fix-hosts.py
==&amp;gt; EXIT CODE: 0
==&amp;gt; INIT DEFAULT
Generating SSH1 RSA host key: [  OK  ]
Starting sshd: [  OK  ]
Starting crond: [  OK  ]
==&amp;gt; INIT DONE
==&amp;gt; RUN /home/admin/app.sh
==&amp;gt; START ...
start canal ...
start canal successful
==&amp;gt; START SUCCESSFUL ...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;查看 canal 是否与 mysql 进行建立连接了&lt;/p&gt;
&lt;p&gt;步骤：&lt;/p&gt;
&lt;p&gt;1、进入 canal 内部&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;figcaption data-lang=&#34;sh&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;root@localhost tmp&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;# docker exec -it canal bash&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;root@a02803287608 admin&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;#&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;2、使用命令监控 canal 的日志信息&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;figcaption data-lang=&#34;sh&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;root@a02803287608 admin&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;# ll&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;total &lt;span class=&#34;token number&#34;&gt;8&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;-rwxr-xr-x. &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt; admin admin &lt;span class=&#34;token number&#34;&gt;3941&lt;/span&gt; Apr &lt;span class=&#34;token number&#34;&gt;19&lt;/span&gt;  &lt;span class=&#34;token number&#34;&gt;2021&lt;/span&gt; app.sh&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;drwxr-xr-x. &lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt; admin admin   &lt;span class=&#34;token number&#34;&gt;43&lt;/span&gt; Apr &lt;span class=&#34;token number&#34;&gt;19&lt;/span&gt;  &lt;span class=&#34;token number&#34;&gt;2021&lt;/span&gt; bin&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;drwxr-xr-x. &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt; admin admin   &lt;span class=&#34;token number&#34;&gt;66&lt;/span&gt; Apr &lt;span class=&#34;token number&#34;&gt;19&lt;/span&gt;  &lt;span class=&#34;token number&#34;&gt;2021&lt;/span&gt; canal-server&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;-rwxr-xr-x. &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt; admin admin  &lt;span class=&#34;token number&#34;&gt;670&lt;/span&gt; Apr &lt;span class=&#34;token number&#34;&gt;19&lt;/span&gt;  &lt;span class=&#34;token number&#34;&gt;2021&lt;/span&gt; health.sh&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;lrwxrwxrwx. &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt; admin admin   &lt;span class=&#34;token number&#34;&gt;44&lt;/span&gt; Apr &lt;span class=&#34;token number&#34;&gt;19&lt;/span&gt;  &lt;span class=&#34;token number&#34;&gt;2021&lt;/span&gt; node_exporter -&lt;span class=&#34;token operator&#34;&gt;&gt;&lt;/span&gt; /home/admin/node_exporter-0.18.1.linux-arm64&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;drwxr-xr-x. &lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt; admin admin   &lt;span class=&#34;token number&#34;&gt;56&lt;/span&gt; Jun  &lt;span class=&#34;token number&#34;&gt;5&lt;/span&gt;  &lt;span class=&#34;token number&#34;&gt;2019&lt;/span&gt; node_exporter-0.18.1.linux-arm64&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;root@a02803287608 admin&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;# tail -f canal-server/logs/canal/canal.log&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;打印日志如下&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;figcaption data-lang=&#34;sh&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token number&#34;&gt;2023&lt;/span&gt;-10-21 &lt;span class=&#34;token number&#34;&gt;10&lt;/span&gt;:31:37.324 &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;main&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; INFO  com.alibaba.otter.canal.deployer.CanalLauncher - &lt;span class=&#34;token comment&#34;&gt;## set default uncaught exception handler&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token number&#34;&gt;2023&lt;/span&gt;-10-21 &lt;span class=&#34;token number&#34;&gt;10&lt;/span&gt;:31:37.376 &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;main&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; INFO  com.alibaba.otter.canal.deployer.CanalLauncher - &lt;span class=&#34;token comment&#34;&gt;## load canal configurations&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token number&#34;&gt;2023&lt;/span&gt;-10-21 &lt;span class=&#34;token number&#34;&gt;10&lt;/span&gt;:31:37.392 &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;main&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; INFO  com.alibaba.otter.canal.deployer.CanalStarter - &lt;span class=&#34;token comment&#34;&gt;## start the canal server.&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token number&#34;&gt;2023&lt;/span&gt;-10-21 &lt;span class=&#34;token number&#34;&gt;10&lt;/span&gt;:31:37.466 &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;main&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; INFO  com.alibaba.otter.canal.deployer.CanalController - &lt;span class=&#34;token comment&#34;&gt;## start the canal server[172.22.0.3(172.22.0.3):11111]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token number&#34;&gt;2023&lt;/span&gt;-10-21 &lt;span class=&#34;token number&#34;&gt;10&lt;/span&gt;:31:39.126 &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;main&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; INFO  com.alibaba.otter.canal.deployer.CanalStarter - &lt;span class=&#34;token comment&#34;&gt;## the canal server is running now ......&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;可以看到启动没什么问题&lt;/p&gt;
&lt;p&gt;查看 mysql 连接的日志&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;figcaption data-lang=&#34;sh&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;root@a02803287608 admin&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;# tail -f canal-server/logs/dkx1/dkx1.log&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token function&#34;&gt;find&lt;/span&gt; start position successfully, EntryPosition&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;included&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;false,journalName&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;mysql-bin.000006,position&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;4&lt;/span&gt;,serverId&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1000&lt;/span&gt;,gtid&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;&amp;lt;&lt;/span&gt;null&lt;span class=&#34;token operator&#34;&gt;&gt;&lt;/span&gt;,timestamp&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1697857809000&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; cost &lt;span class=&#34;token builtin class-name&#34;&gt;:&lt;/span&gt; 521ms , the next step is binlog dump&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt; ]]></description>
        </item>
    </channel>
</rss>
