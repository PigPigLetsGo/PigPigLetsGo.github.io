{
    "version": "https://jsonfeed.org/version/1",
    "title": "homepage • All posts by \"database\" tag",
    "description": "欢迎来我的博客空间",
    "home_page_url": "https://pigpigletsgo.github.io/homepage",
    "items": [
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/%E7%9F%A5%E8%AF%86%E7%82%B9/%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84SKU%E4%B8%8ESPU%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E8%AE%BE%E8%AE%A1/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/%E7%9F%A5%E8%AF%86%E7%82%B9/%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84SKU%E4%B8%8ESPU%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E8%AE%BE%E8%AE%A1/",
            "title": "电商项目中的SKU与SPU的数据库表设计",
            "date_published": "2024-04-02T06:23:30.171Z",
            "content_html": "<h1 id=\"电商项目中的sku与spu的数据库表设计\"><a class=\"markdownIt-Anchor\" href=\"#电商项目中的sku与spu的数据库表设计\">#</a> 电商项目中的 SKU 与 SPU 的数据库表设计</h1>\n<h2 id=\"简介\"><a class=\"markdownIt-Anchor\" href=\"#简介\">#</a> 简介：</h2>\n<p>一般情况下我们使用 5 张表就可以解决基本的需求了:</p>\n<ol>\n<li>商品分类：category</li>\n<li>商品表 (即 SPU 表)：product</li>\n<li>商品规格表 (即 SKU 表)：product_specs</li>\n<li>属性 Key 表：attribute_key</li>\n<li>属性 Value 表：attribute_value</li>\n</ol>\n<h2 id=\"具体设计\"><a class=\"markdownIt-Anchor\" href=\"#具体设计\">#</a> 具体设计</h2>\n<p>spu 表和 sku 表实现不同商品的存储：spu 表使用 attribute_list 字段保存属性集合，查询时使用 product_id 和 product_spacs 去 sku 表中获取的具体的单品信息。spu 表中可以增加一些商品的公共信息字段，例如名称，发布的商家，发布日期，上架状态；sku 表中增加一些每个单品不同的字段，比如不同的单品有不同图片和名称或者详情说明等等，反正根据业务进行扩展。</p>\n<p>核心思路就是把弹性字段使用 json 存储，这样设计的有点是数据表结构稳定，不用在商品增加属性后增加字段，缺点是商品数据的解析复杂，弹性字段需要在业务代码中进行处理，增加了业务代码的复杂度。</p>\n<p>表结构示意图：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/ebc5536255314e829293b6bbbdfccb18.png\" alt=\"在这里插入图片描述\"></p>\n<h2 id=\"商品分类表tb_product_category\"><a class=\"markdownIt-Anchor\" href=\"#商品分类表tb_product_category\">#</a> 商品分类表：tb_product_category</h2>\n<p>该表主要是描述商品的分类。此表采用无限层级树状数据结构，程序使用递归算法来遍历分类下的所有子类，pid 是父级分类，pid=null 时说明是根节点，属于一级类别；</p>\n<p>属性：id，pid，name 等</p>\n<h2 id=\"商品表即spu表tb_product\"><a class=\"markdownIt-Anchor\" href=\"#商品表即spu表tb_product\">#</a> 商品表 (即 SPU 表)：tb_product</h2>\n<p>存储商品信息。表中关键字段是 category_id 和 attribute_list 两个字段</p>\n<ul>\n<li>category_id：记录商品属于哪个分类，用于通过分类进行商品搜索</li>\n<li>attribute_list：记录的是所有属性的集合，这个字段采用 json 格式存储，便于前端解析；前端解析后可以在页面显示出商品的所有属性，用户点击选择出属性组合后，前端可以拼接形成如：{“内存”:“2G”,“颜色”:“红色”,“尺寸”:“20cm”} 的 json 格式数据，加上商品 id (商品规格表 tb_product_specs) 就可以查询到具体的商品，随机获取到具体单品的库存和价格等信息；</li>\n</ul>\n<p>属性：id，category_id，name，attribute_list 等</p>\n<h2 id=\"商品规格表即sku表tb_product_specs\"><a class=\"markdownIt-Anchor\" href=\"#商品规格表即sku表tb_product_specs\">#</a> 商品规格表 (即 SKU 表)：tb_product_specs</h2>\n<p>存储商品的具体规格单品，即 sku，sku 表保存的是具体的单品信息，比如具体规格的库存和价格等，核心字段是 product_id 和 product_specs</p>\n<ul>\n<li>product_id：记录的是 spu 表中的商品 id</li>\n<li>product_specs：记录的是该单品具体的属性值 (规格值)</li>\n</ul>\n<p>属性：id，product_id，product_specs 等</p>\n<h2 id=\"属性key表tb_attribute_key\"><a class=\"markdownIt-Anchor\" href=\"#属性key表tb_attribute_key\">#</a> 属性 Key 表：tb_attribute_key</h2>\n<p>用于存储 sku 的属性，比如：机身颜色，存储容量</p>\n<p>属性 key 表和属性 value 表仅用于管理后台页面生成属性选项，管理员在发布新商品时勾选属性，方便规则的录入和保证正确性</p>\n<h2 id=\"属性value表tb_attribute_value\"><a class=\"markdownIt-Anchor\" href=\"#属性value表tb_attribute_value\">#</a> 属性 Value 表：tb_attribute_value</h2>\n<p>用于存储 sku 的属性值，比如：6+128G，8+128G，8+256G</p>\n<h2 id=\"总结\"><a class=\"markdownIt-Anchor\" href=\"#总结\">#</a> 总结</h2>\n<p>上述数据表设计方案用于商品类别差异不是很大情形，通过表的字段可以发现不同的商品之间变化的信息只有 attribute_list 字段，而这个字段通过 json 来存储各种不同的属性集合，同样 sku 表中变化的字段只有 product_specs 也是通过 json 来存储各种不同属性组合</p>\n<h2 id=\"改进方案\"><a class=\"markdownIt-Anchor\" href=\"#改进方案\">#</a> 改进方案</h2>\n<p>将 tb_product，tb_brand，tb_product_specs 表中的 info 字段分别抽取到单独的表中</p>\n<h2 id=\"sql\"><a class=\"markdownIt-Anchor\" href=\"#sql\">#</a> sql</h2>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> Navicat Premium Data Transfer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> Source Server         : localhost</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> Source Server Type    : MySQL</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> Source Server Version : 80025</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> Source Host           : localhost:3306</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> Source Schema         : test</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> Target Server Type    : MySQL</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> Target Server Version : 80025</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> File Encoding         : 65001</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> Date: 07/12/2021 11:19:44</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">SET</span> NAMES utf8mb4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">-- Table structure for tb_attribute_key</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_attribute_key<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_attribute_key<span class=\"token punctuation\">`</span></span>  <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'编号'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>attribute_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">22</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8 <span class=\"token keyword\">COLLATE</span> utf8_general_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'属性名'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>priority<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'优先级'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>category_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'类别编号'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>create_time<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>update_time<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'更新时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token keyword\">INDEX</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>category_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>category_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token keyword\">CONSTRAINT</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_attribute_key_ibfk_1<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">FOREIGN</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>category_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">REFERENCES</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product_category<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">DELETE</span> <span class=\"token keyword\">RESTRICT</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">RESTRICT</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> <span class=\"token operator\">=</span> utf8 <span class=\"token keyword\">COLLATE</span> <span class=\"token operator\">=</span> utf8_general_ci <span class=\"token keyword\">COMMENT</span> <span class=\"token operator\">=</span> <span class=\"token string\">'属性key表'</span> ROW_FORMAT <span class=\"token operator\">=</span> Dynamic<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">-- Records of tb_attribute_key</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">-- Table structure for tb_attribute_value</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_attribute_value<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_attribute_value<span class=\"token punctuation\">`</span></span>  <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'编号'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>attribute_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'属性编号'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>priority<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'优先级'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>attribute_value<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">22</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8 <span class=\"token keyword\">COLLATE</span> utf8_general_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'属性值'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>create_time<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>update_time<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'更新时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>  <span class=\"token keyword\">INDEX</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>category_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>attribute_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>  <span class=\"token keyword\">CONSTRAINT</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_attribute_value_ibfk_1<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">FOREIGN</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>attribute_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">REFERENCES</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_attribute_key<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">DELETE</span> <span class=\"token keyword\">RESTRICT</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">RESTRICT</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> <span class=\"token operator\">=</span> utf8 <span class=\"token keyword\">COLLATE</span> <span class=\"token operator\">=</span> utf8_general_ci <span class=\"token keyword\">COMMENT</span> <span class=\"token operator\">=</span> <span class=\"token string\">'属性value表'</span> ROW_FORMAT <span class=\"token operator\">=</span> Dynamic<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token comment\">-- Records of tb_attribute_value</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token comment\">-- Table structure for tb_brand</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_brand<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_brand<span class=\"token punctuation\">`</span></span>  <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'品牌编号'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">18</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8 <span class=\"token keyword\">COLLATE</span> utf8_general_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'品牌名称'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>logo<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">180</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8 <span class=\"token keyword\">COLLATE</span> utf8_general_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'品牌LOGO'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>info<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">220</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8 <span class=\"token keyword\">COLLATE</span> utf8_general_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'品牌描述'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>status<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">tinyint</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token number\">1</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'状态 1上架  2下架'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>create_time<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>update_time<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'更新时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> <span class=\"token operator\">=</span> utf8 <span class=\"token keyword\">COLLATE</span> <span class=\"token operator\">=</span> utf8_general_ci <span class=\"token keyword\">COMMENT</span> <span class=\"token operator\">=</span> <span class=\"token string\">'品牌表'</span> ROW_FORMAT <span class=\"token operator\">=</span> Dynamic<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre></pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token comment\">-- Records of tb_brand</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre></pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token comment\">-- Table structure for tb_product</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product<span class=\"token punctuation\">`</span></span>  <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'商品编号'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">28</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8 <span class=\"token keyword\">COLLATE</span> utf8_general_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'商品名称'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>attribute_list<span class=\"token punctuation\">`</span></span> json <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'商品属性列表'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>category_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'类别编号'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>brand_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'品牌编号'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>status<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">tinyint</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'状态 1上架  2下架'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>info<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">180</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8 <span class=\"token keyword\">COLLATE</span> utf8_general_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'备注'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>create_time<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">' 创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>update_time<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">' 更新时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>  <span class=\"token keyword\">INDEX</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>category_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>category_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>  <span class=\"token keyword\">INDEX</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>brand_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>brand_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>  <span class=\"token keyword\">CONSTRAINT</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product_ibfk_1<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">FOREIGN</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>category_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">REFERENCES</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product_category<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">DELETE</span> <span class=\"token keyword\">RESTRICT</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">RESTRICT</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>  <span class=\"token keyword\">CONSTRAINT</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product_ibfk_2<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">FOREIGN</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>brand_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">REFERENCES</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_brand<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">DELETE</span> <span class=\"token keyword\">RESTRICT</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">RESTRICT</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> <span class=\"token operator\">=</span> utf8 <span class=\"token keyword\">COLLATE</span> <span class=\"token operator\">=</span> utf8_general_ci <span class=\"token keyword\">COMMENT</span> <span class=\"token operator\">=</span> <span class=\"token string\">'商品表（SPU）'</span> ROW_FORMAT <span class=\"token operator\">=</span> Dynamic<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre></pre></td></tr><tr><td data-num=\"100\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre><span class=\"token comment\">-- Records of tb_product</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'IPHONE8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'&#123;\\\"商品简介\\\": &#123;\\\"品牌\\\": \\\"Apple\\\", \\\"系统\\\": \\\"iOS\\\", \\\"充电器\\\": \\\"其他\\\", \\\"分辨率\\\": \\\"其他\\\", \\\"支持IPv6\\\": \\\"支持IPv6\\\", \\\"商品产地\\\": \\\"中国大陆\\\", \\\"商品名称\\\": \\\"AppleiPhone 13\\\", \\\"商品毛重\\\": \\\"320.00g\\\", \\\"商品编号\\\": \\\"100014352501\\\", \\\"机身存储\\\": \\\"256GB\\\", \\\"运行内存\\\": \\\"其他\\\"&#125;, \\\"规格与包装\\\": &#123;\\\"主体\\\": &#123;\\\"品牌\\\": \\\"Apple\\\", \\\"上市年份\\\": \\\"2021年\\\", \\\"上市月份\\\": \\\"9月\\\", \\\"产品名称\\\": \\\"Apple iPhone 13 (A2634) 256GB 午夜色 支持移动联通电信5G 双卡双待手机\\\", \\\"入网型号\\\": \\\"A2634\\\", \\\"首销日期\\\": \\\"24日\\\"&#125;, \\\"基本信息\\\": &#123;\\\"机身材质\\\": \\\"以官网信息为准\\\", \\\"机身重量（g）\\\": \\\"173g\\\", \\\"机身厚度（mm）\\\": \\\"7.65mm\\\", \\\"机身宽度（mm）\\\": \\\"71.5mm\\\", \\\"机身长度（mm）\\\": \\\"146.7mm\\\"&#125;&#125;&#125;'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-12-07 10:52:15'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-12-07 10:52:15'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre></pre></td></tr><tr><td data-num=\"105\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre><span class=\"token comment\">-- Table structure for tb_product_category</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product_category<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product_category<span class=\"token punctuation\">`</span></span>  <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'类别编号'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">12</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8 <span class=\"token keyword\">COLLATE</span> utf8_general_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'类别名称'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>status<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">tinyint</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token number\">1</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'状态：1上架 2下架'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>priority<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'优先级'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>pid<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'父类别编号'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>create_time<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>update_time<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'更新时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>  <span class=\"token keyword\">INDEX</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>pid<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>pid<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>  <span class=\"token keyword\">CONSTRAINT</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product_category_ibfk_1<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">FOREIGN</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>pid<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">REFERENCES</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product_category<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">DELETE</span> <span class=\"token keyword\">RESTRICT</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">RESTRICT</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> <span class=\"token operator\">=</span> utf8 <span class=\"token keyword\">COLLATE</span> <span class=\"token operator\">=</span> utf8_general_ci <span class=\"token keyword\">COMMENT</span> <span class=\"token operator\">=</span> <span class=\"token string\">'商品类别表'</span> ROW_FORMAT <span class=\"token operator\">=</span> Dynamic<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre></pre></td></tr><tr><td data-num=\"122\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre><span class=\"token comment\">-- Records of tb_product_category</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product_category<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'aa'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-12-07 10:34:29'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-12-07 10:34:29'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product_category<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'bb'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-12-07 10:34:36'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-12-07 10:34:36'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product_category<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'cc'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-12-07 10:34:42'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-12-07 10:34:42'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product_category<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'dd'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-12-07 10:34:51'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-12-07 10:34:51'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre></pre></td></tr><tr><td data-num=\"130\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre><span class=\"token comment\">-- Table structure for tb_product_specs</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product_specs<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product_specs<span class=\"token punctuation\">`</span></span>  <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'规格编号'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>product_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'商品编号'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">24</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8 <span class=\"token keyword\">COLLATE</span> utf8_general_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'规格名称'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>sell_point<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">48</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8 <span class=\"token keyword\">COLLATE</span> utf8_general_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'卖点'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>product_specs<span class=\"token punctuation\">`</span></span> json <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'规格列表'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>price<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">decimal</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'售价'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>barcode<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">120</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8 <span class=\"token keyword\">COLLATE</span> utf8_general_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'条形码'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>img<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">120</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8 <span class=\"token keyword\">COLLATE</span> utf8_general_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'首图'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"143\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>pics<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8 <span class=\"token keyword\">COLLATE</span> utf8_general_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'图片列表'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>amount<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'库存'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>status<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">tinyint</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token number\">1</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'状态 1上架  2下架'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>info<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">180</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8 <span class=\"token keyword\">COLLATE</span> utf8_general_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'备注信息'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"147\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>create_time<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"148\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>update_time<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'更新时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"149\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"150\"></td><td><pre>  <span class=\"token keyword\">INDEX</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>product_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>product_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre>  <span class=\"token keyword\">CONSTRAINT</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product_specs_ibfk_1<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">FOREIGN</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>product_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">REFERENCES</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">DELETE</span> <span class=\"token keyword\">RESTRICT</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">RESTRICT</span></pre></td></tr><tr><td data-num=\"152\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> <span class=\"token operator\">=</span> utf8 <span class=\"token keyword\">COLLATE</span> <span class=\"token operator\">=</span> utf8_general_ci <span class=\"token keyword\">COMMENT</span> <span class=\"token operator\">=</span> <span class=\"token string\">'商品规格表（sku表）'</span> ROW_FORMAT <span class=\"token operator\">=</span> Dynamic<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre></pre></td></tr><tr><td data-num=\"154\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"155\"></td><td><pre><span class=\"token comment\">-- Records of tb_product_specs</span></pre></td></tr><tr><td data-num=\"156\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"157\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product_specs<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'IPHONE8 PLUS'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'贵,信号不好'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'&#123;\\\"版本\\\": \\\"128GB\\\", \\\"颜色\\\": \\\"红色\\\", \\\"购买方式\\\": \\\"公开版\\\"&#125;'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5999.00</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-12-07 10:59:18'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-12-07 10:59:18'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_product_specs<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'IPHONE8 MINI'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'轻，信号好'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'&#123;\\\"版本\\\": \\\"256GB\\\", \\\"颜色\\\": \\\"玫瑰金色\\\", \\\"增值保障\\\": \\\"2年259\\\", \\\"购买方式\\\": \\\"官方标配\\\"&#125;'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4200.00</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">12</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-12-07 10:59:30'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-12-07 11:01:37'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"159\"></td><td><pre></pre></td></tr><tr><td data-num=\"160\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"sql案例\"><a class=\"markdownIt-Anchor\" href=\"#sql案例\">#</a> sql 案例：</h2>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- 用户点击分类比如：手机，请求数据展示手机这个商品的所有的基本信息</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">SELECT</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\ttp<span class=\"token punctuation\">.</span>id 商品id<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\ttp<span class=\"token punctuation\">.</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> 商品名称<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\ttp<span class=\"token punctuation\">.</span>attribute_list 商品简介</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">FROM</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\ttb_product_category tpc</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> tb_product tp <span class=\"token keyword\">ON</span> tp<span class=\"token punctuation\">.</span>category_id <span class=\"token operator\">=</span> tpc<span class=\"token punctuation\">.</span>id</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">WHERE</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\ttpc<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">-- 用户点击了类别查询所当前类别的所有商品的基本信息</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">SELECT</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\ttps<span class=\"token punctuation\">.</span>id 商品id<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\ttps<span class=\"token punctuation\">.</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> 商品名称<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\ttp<span class=\"token punctuation\">.</span>attribute_list 商品简介<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\ttps<span class=\"token punctuation\">.</span>price 商品价格</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">FROM</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\ttb_product tp</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t<span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> tb_product_specs tps <span class=\"token keyword\">ON</span> tps<span class=\"token punctuation\">.</span>product_id <span class=\"token operator\">=</span> tp<span class=\"token punctuation\">.</span>id </pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">WHERE</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\ttp<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">-- 用户点击了某个基本信息的手机，请求数据查询出详细信息，用户选择类型时前端获取 数据以 json 传递后端，后端根据当前商品 id 和选择的类型 (json 数据) 进行查询数据库</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">SELECT</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\ttps<span class=\"token punctuation\">.</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> 商品名称<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\ttps<span class=\"token punctuation\">.</span>price 商品价格<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\ttps<span class=\"token punctuation\">.</span>img 首图<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\ttps<span class=\"token punctuation\">.</span>pics 图片列表<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\ttp<span class=\"token punctuation\">.</span>attribute_list 商品详细信息 </pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token keyword\">FROM</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\ttb_product_specs tps</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t<span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> tb_product tp <span class=\"token keyword\">ON</span> tp<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> tps<span class=\"token punctuation\">.</span>product_id </pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">WHERE</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\ttp<span class=\"token punctuation\">.</span>category_id <span class=\"token operator\">=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t<span class=\"token operator\">AND</span> tps<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t<span class=\"token operator\">AND</span> tps<span class=\"token punctuation\">.</span>product_specs <span class=\"token operator\">LIKE</span> <span class=\"token string\">'%&#123;\"版本\": \"128GB\", \"颜色\": \"红色\", \"购买方式\": \"公开版\"&#125;%'</span></pre></td></tr></table></figure>",
            "tags": [
                "计算机学科",
                "知识点",
                "database"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/%E7%9F%A5%E8%AF%86%E7%82%B9/%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%80%E6%9C%89%E8%A1%A8/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/%E7%9F%A5%E8%AF%86%E7%82%B9/%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%80%E6%9C%89%E8%A1%A8/",
            "title": "批量删除数据库所有表",
            "date_published": "2024-04-02T06:23:30.168Z",
            "content_html": "<h1 id=\"批量删除数据库所有表\"><a class=\"markdownIt-Anchor\" href=\"#批量删除数据库所有表\">#</a> 批量删除数据库所有表</h1>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">SELECT</span> concat<span class=\"token punctuation\">(</span><span class=\"token string\">'DROP TABLE IF EXISTS '</span><span class=\"token punctuation\">,</span> table_name<span class=\"token punctuation\">,</span> <span class=\"token string\">';'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">FROM</span> information_schema<span class=\"token punctuation\">.</span><span class=\"token keyword\">tables</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">WHERE</span> table_schema <span class=\"token operator\">=</span> <span class=\"token string\">'guan_duoduo'</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>执行后就会生成删除的结果集：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240401093220361.png\" alt=\"image-20240401093220361\"></p>\n<p>复制上面的所有结果集 然后再执行以下就会全部删除表了</p>\n",
            "tags": [
                "计算机学科",
                "知识点",
                "database"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/redis/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/redis/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/",
            "title": "redis-基础知识",
            "date_published": "2024-04-02T06:23:30.160Z",
            "content_html": "<p>redis 默认有<mark> 16 个</mark>数据库</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051433044.png\" alt=\"image-20240105143208746\"></p>\n<p>默认使用的是第 0 个</p>\n<p>可以使用<mark> select</mark> 进行切换数据库，<mark>dbsize</mark> 查看当前数据库大小</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token keyword\">select</span> <span class=\"token number\">3</span> <span class=\"token comment\">#切换数据库</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> dbsize <span class=\"token comment\">#查看当前 DB 大小</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span></pre></td></tr></table></figure><p>不同的数据库可以存储不同的值 (不互通) 1 中 不能访问到 2 中的数据</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token keyword\">select</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> dbsize</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">set</span> name dkx</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> dbsize</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> <span class=\"token keyword\">select</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get name</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">(</span>nil<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token keyword\">select</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> get name</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token string\">\"dkx\"</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span></pre></td></tr></table></figure><p>查看<mark>当前数据库</mark>所有的 key: <code> keys *</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> keys * <span class=\"token comment\">#这个库是空的下面的 key 都是测试工具测试的时候添加的</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"mylist\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"key:__rand_int__\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"counter:__rand_int__\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token keyword\">select</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> keys *</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"user\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span></pre></td></tr></table></figure><p>清空当前数据库: <code>flushdb</code>  (在数据库 3 中使用 flushdb, 数据库 3 中数据全被清除，数据库 0 中的数据不受影响)</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> flushdb</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> keys *</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>empty list or <span class=\"token builtin class-name\">set</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span></pre></td></tr></table></figure><p>接上命令我们在 3 号数据库中有数据我们切换到 0 使用命令: <code>flushall</code>  (清空所有数据库)</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> <span class=\"token keyword\">select</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> flushall</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token keyword\">select</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> keys *</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">(</span>empty list or <span class=\"token builtin class-name\">set</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span></pre></td></tr></table></figure><p>判断<mark>指定 key</mark> 是否存在: <code>exists</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> exists user</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> user lisi</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> exists user</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>设置 key 的过期时间: <code>expire</code>   (翻译 expire  :  到期) 过期后指定的 key 就会被删除</p>\n<p>查看 key 的有效期剩余秒数: <code>ttl</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> expire name <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> ttl name</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">6</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get name</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token string\">\"lisi\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> ttl name</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token parameter variable\">-2</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get name</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">(</span>nil<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>移动当前的 key 到指定数据库: <code>move</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> name a</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get name</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token string\">\"a\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> move name <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get name</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">(</span>nil<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token keyword\">select</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> get name</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token string\">\"a\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span></pre></td></tr></table></figure><p>查看<mark>当前 key 的数据类型</mark>: <code>type</code>  (查看 key 不存在返回 &quot;none&quot;)</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get name</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token string\">\"liusang\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">type</span> name</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>string</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p><font style=\"color:red\"><strong>incr,decr,incrby,decrby 只能用于 String 类型的 key</strong></font></p>\n<p>将数值加 1: <code>incr</code>  (直接使用可以创建一个 String 类型的 key 比如执行: incr ar 这里的 ar 并不存在，创建一个 1 的 number)</p>\n<p>将数值减 1: <code>decr</code>  (直接使用可以创建一个 String 类型的 key 比如执行: decr ar 这里的 ar 并不存在，创建一个 - 1 的 number)</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> number <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get number</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token string\">\"0\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> incr number</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get number</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token string\">\"1\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> decr number</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get number</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token string\">\"0\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>将数值增加指定数量: <code>incrby</code></p>\n<p>将数值减少指定数量: <code>decrby</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get number</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token string\">\"0\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> incrby number <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get number</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token string\">\"10\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> decrby number <span class=\"token number\">11</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get number</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token string\">\"-1\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><blockquote>\n<p>redis 是单线程的！</p>\n</blockquote>\n<p>明白 Redis 是很快的，官方表示，Redis 是基于内存操作，<mark>CPU 不是 Redis 性能瓶颈</mark>，Redis 的瓶颈是根据机器的<mark>内存和网络带宽</mark>，既然可以使用单线程来实现，就使用单线程了！所以就使用了单线程了</p>\n<p>Redis 是 C 语言写的，官方提供的数据为 100000 + 的 QPS, 说明完全不比同样是使用 key-value 的 Memecache 差！</p>\n<p><mark>Redis 为什么单线程还这么快？</mark></p>\n<p>1. 误区 1: 高性能的服务器一定是多线程的？</p>\n<p>2. 误区 2: 多线程 (CPU 上下文切换) 一定比单线程效率高</p>\n<p><code>CPU&gt;内存&gt;硬盘</code>   的速度</p>\n<p>核心:redis 是将所有的<mark>数据全部放在内存中</mark>，所以说使用<mark>单线程去操作效率就是最高</mark>的，多线程 (CPU 上下文切换:<mark> 耗时操作！！！</mark>), 对于<mark>内存系统来说，如果没有上下文切换效率就是最高</mark>的！多次<mark>读写都是在一个 CPU 上</mark>的，在内存情况下，这个就是最佳方案！</p>\n<h3 id=\"五大数据类型\"><a class=\"markdownIt-Anchor\" href=\"#五大数据类型\">#</a> 五大数据类型</h3>\n<h4 id=\"string字符串\"><a class=\"markdownIt-Anchor\" href=\"#string字符串\">#</a> String (字符串)</h4>\n<p>获取字符串的字符长度 <code>strlen</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> user <span class=\"token string\">\"liusang\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> strlen user</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">7</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>追加字符串 (<mark>如果当前 key 不存在那么就创建</mark>): <code>append key value</code>  (只能对 String 类型使用)</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get name</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token string\">\"liusang\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> append name <span class=\"token string\">\"shiwonanshen!\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get name</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token string\">\"liusangshiwonanshen!\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>截取指定区间的字符串范围 (start:0 end:-1 表示全部): <code>getrange</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> name liusangshiwonanshen</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get name</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token string\">\"liusangshiwonanshen\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> getrange name <span class=\"token number\">0</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token string\">\"liusa\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> getrange name <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token string\">\"liusangshiwonanshen\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>替换指定位置开始的字符串: <code>setrange</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get name</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token string\">\"liusangshiwonanshen\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> setrange name <span class=\"token number\">2</span> ****</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">19</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get name</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token string\">\"li****gshiwonanshen\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>设置过期时间: <code>setex</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> setex name <span class=\"token number\">10</span> <span class=\"token string\">\"hello\"</span>#设置hello10秒后过期</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> ttl name</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get name</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token string\">\"hello\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> ttl name</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token parameter variable\">-2</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get name</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">(</span>nil<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>不存在则创建，存在则不创建 (在分布式锁中会常常使用): <code>setnx</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> setnx myname zhangsan <span class=\"token comment\">#如果 myname 不存在则创建</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> setnx myname zhangsan <span class=\"token comment\">#myname 存在则创建失败</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get myname</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token string\">\"zhangsan\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>同时设置多个值: <code>mset</code></p>\n<p>同时获取多个值: <code>mget</code>   (不是只能同时获取 mset 创建的 key 其它的是 String 类型就可以)</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> keys *</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>empty list or <span class=\"token builtin class-name\">set</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> mset k1 v1 k2 v2 k3 v3 <span class=\"token comment\">#同时设置多个值</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> mget k1 k2 k3 <span class=\"token comment\">#同时获取多个值</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"v1\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"v2\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"v3\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> msetnx k1 v1 k4 v4 <span class=\"token comment\">#配合 setnx 如果有存在的 key 则条件不成立</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> mget k4 <span class=\"token comment\">#没有创建成功</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>nil<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><h4 id=\"对象\"><a class=\"markdownIt-Anchor\" href=\"#对象\">#</a> <mark>对象</mark></h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> user:1 <span class=\"token punctuation\">&#123;</span>name:lisi,age:18<span class=\"token punctuation\">&#125;</span> <span class=\"token comment\">#设置一个 user:1 对象 值为 json 字符串来保存一个对象</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get user:1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token string\">\"&#123;name:lisi,age:18&#125;\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#这里的 key 是一个巧妙的设计: user:&#123;id&#125;:&#123;filed&#125; , 如此设计在 Redis 中是完全 OK 了</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> mset user:1:name lisi user:1:age <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> mget user:1:name user:1:age</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"lisi\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"1\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>先获取再设置值: <code>getset</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> getset dkx niubi </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>nil<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get dkx</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token string\">\"niubi\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> getset dkx <span class=\"token number\">666</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token string\">\"niubi\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get dkx</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token string\">\"666\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>数据结构是相通的！</p>\n<p>String 类似的使用场景:  value 除了字符串还可以是数字！</p>\n<h4 id=\"list\"><a class=\"markdownIt-Anchor\" href=\"#list\">#</a> List</h4>\n<p>在 redis 中，我们可以把 list 玩成，<mark>栈，队列，阻塞队列</mark></p>\n<p>跟 String 语法类似，所有的 list 命令都是用 <strong>l , 字母 l</strong> 开头的，<font style=\"color:green\"><strong>添加 :lpush 前，rpush 后</strong></font> | <font style=\"color:red\"><strong>移除并返回 /lpop 前 /rpop 后</strong></font></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051432592.png\" alt=\"image-20240105143226491\"></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush list a</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush list b</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> rpush list c</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpop list</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token string\">\"b\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> rpop list</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token string\">\"c\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpop list</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token string\">\"a\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>通过索引获取值: <code>lindex</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush list a</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush list b</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush list c</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lindex list <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token string\">\"a\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>获取长度: <code>llen</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush name a</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> llen name</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>移除列表中的 key: <code>lrem key</code></p>\n<p>指定范围获取列表中的值: <code>lrange start end</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush name a</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush name b</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush name a</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange name <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"a\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"b\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"a\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrem name <span class=\"token number\">2</span> a</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange name <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"b\"</span></pre></td></tr></table></figure><p>截断，保留列表中截断的值: <code>ltrim  key  start  end</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush name a</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush name b</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush name c</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush name d</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> ltrim name <span class=\"token number\">1</span> <span class=\"token number\">2</span> <span class=\"token comment\">#通过下标截取指定的长度，这个 list 已经被改变了，截断了只剩下截取的元素！</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange name <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span> <span class=\"token comment\">#查看全部元素</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"c\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"b\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051432478.png\" alt=\"image-20240105143241383\"></p>\n<p>移除列表的最后一个元素，将它移动到新的列表中，如果移动到列表不存在则创建: <code>rpoplpush key source distination</code></p>\n<p>翻译: source (根源) , distination (目的地)</p>\n<ul>\n<li><font style=\"color:red\"><strong>只有: rpoplpush  格式没有 lpoprpush 或者 lpoplpush 的格式</strong></font></li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange name <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"c\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"b\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> rpoplpush name nametwo <span class=\"token comment\"># 移除并移动到指定列表中指定列表不存在则创建</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token string\">\"b\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange name <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span> <span class=\"token comment\"># 查看原来的列表</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"c\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange nametwo <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span> <span class=\"token comment\"># 查看新的列表</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"b\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>将列表中指定存在的下标的值替换为另外一个值.<strong> 更新操作</strong>: <code>lset  key  index  value</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> exists list <span class=\"token comment\"># 判断列表是否存在</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lset list <span class=\"token number\">0</span> a <span class=\"token comment\"># 视图向不存在的列表中添加值</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> ERR no such key</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush name a <span class=\"token comment\"># 向 list 中添加值</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange name <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span> <span class=\"token comment\"># 查看列表的值</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"a\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lset name <span class=\"token number\">0</span> liusang <span class=\"token comment\"># 通过 lset 指定下标替换值</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange name <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span> <span class=\"token comment\"># 查看列表的值</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"liusang\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lset name <span class=\"token number\">1</span> lisi <span class=\"token comment\"># 视图在存在的列表中设置不存在的索引值</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> ERR index out of range</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>将给定<mark> value 插入</mark>到指定 value 的<mark> before (之前)<mark> 或</mark>者 after (之后)</mark>: <code>linsert  key  [before|after]  pivot  value</code></p>\n<p>翻译:  (pivot : 支点)</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange name <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"a\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> linsert name before a niubi <span class=\"token comment\">#将 niubi 插入到 a 的之前</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange name <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"niubi\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"a\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> linsert name after a <span class=\"token number\">666</span> <span class=\"token comment\">#将 666 插入到 a 的之后</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange name <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"niubi\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"a\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"666\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><blockquote>\n<p>小结</p>\n</blockquote>\n<ul>\n<li>它实际上是一个链表，before Node after , left, right (<strong>前后，左右</strong>) 都可以插入值</li>\n<li>如果 key 不存在，插入的话就会创建新的列表</li>\n<li>如果 key 存在，插入的话就会新增内容</li>\n<li>如果移除了所有值，空列表，也代表不存在！</li>\n<li>在<u>两边<mark>插入</mark>或者改动值，效率最高！中间元素，相对来说效率会低</u>一点</li>\n</ul>\n<p><u>消息队列 (lpush rpop), 栈 (lpush lpop)</u></p>\n<h4 id=\"set集合set中的值是不能重复的\"><a class=\"markdownIt-Anchor\" href=\"#set集合set中的值是不能重复的\">#</a> Set (集合):set 中的值是<mark>不能重复</mark>的</h4>\n<p>单词: member (成员)</p>\n<p>向集合中添加元素: <code>sadd key value</code></p>\n<p>查看集合中所有元素: <code>smembers key</code></p>\n<p>查看集合中是否包含该元素: <code>sismember key value</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd myset liusang <span class=\"token comment\">#向集合中添加元素</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd myset niubi</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> smembers myset <span class=\"token comment\">#查看集合中所有元素</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"niubi\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"liusang\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sismember myset niubi <span class=\"token comment\">#查看集合中是否包含该元素</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sismember myset <span class=\"token number\">123</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>查看集合中元素个数: <code>scard key</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> smembers myset</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"niubi\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"liusang\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> scard myset</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>移除指定元素: <code>srem key value</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> smembers myset</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"bbb\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"aaa\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"liusang\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> srem myset aaa</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> smembers myset</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"bbb\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"liusang\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>随机抽取指定 count 个元素: <code>srandmember key count</code>  (默认只抽取一个出来)</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> smembers myset</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"aaa\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"ccc\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"bbb\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"liusang\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> srandmember myset</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token string\">\"ccc\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> srandmember myset</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token string\">\"ccc\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> srandmember myset</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token string\">\"liusang\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> srandmember myset</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token string\">\"ccc\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> srandmember myset</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token string\">\"liusang\"</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> srandmember myset</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token string\">\"ccc\"</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> srandmember myset</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token string\">\"liusang\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> srandmember myset</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token string\">\"ccc\"</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> srandmember myset</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token string\">\"liusang\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> srandmember myset</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token string\">\"liusang\"</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> srandmember myset</pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token string\">\"aaa\"</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> srandmember myset</pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token string\">\"ccc\"</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> srandmember myset <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"aaa\"</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"liusang\"</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> srandmember myset <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"bbb\"</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"ccc\"</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>随机弹出元素: <code>spop key</code>  (弹出列表后相当于从列表中删除)</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> smembers myset</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"aaa\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"ccc\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"bbb\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"liusang\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> spop myset</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token string\">\"liusang\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> spop myset</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token string\">\"aaa\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> spop myset</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token string\">\"bbb\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> smembers myset</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"ccc\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>将指定的元素移动到另外指定的数据库集合中: <code>smove source distination member</code>  (指定的数据库不存在则创建)</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> smembers myset</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"bbb\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"aaa\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"ccc\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> smove myset myset1 aaa</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> smembers myset</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"bbb\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"ccc\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> smembers myset1</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"aaa\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> keys * </pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"myset\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"myset1\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p><strong>差集: <code>sdiff</code> </strong> : 假设有集合 A 和 B, 所有属于 A 且不属于 B 的元素的集合被称为 A 与 B 的差集</p>\n<ul>\n<li><u>示例：对于集合 A={<mark>a</mark>,<font style=\"color:red\"> b</font>, <font style=\"color:red\">c</font>, <mark>d</mark>} 和集合 B={<font style=\"color:red\">b</font>, <font style=\"color:red\">c</font>, w}, 则 A 与 B 的差集为 {<mark>a</mark>, <mark>d</mark>}</u></li>\n</ul>\n<p><strong>交集: <code>sinter</code> </strong>: 两个集合之间相同的元素</p>\n<ul>\n<li><u>示例：对于集合 A={a,<font style=\"color:red\"> b</font>, <font style=\"color:red\">c</font>, d} 和集合 B={<font style=\"color:red\">b</font>, <font style=\"color:red\">c</font>, w}, 则 A 与 B 的交集为 {<mark>b</mark>,<mark>c</mark>}</u></li>\n</ul>\n<p><strong>并集: <code>sunion</code> </strong>: 合并两个集合中去除相同元素 (<u>并不是说删除，而是不算重复的保留一个</u>) 后的整合</p>\n<ul>\n<li><u>示例：对于集合 A={a,<font style=\"color:red\"> b</font>, <font style=\"color:red\">c</font>, d} 和集合 B={<font style=\"color:red\">b</font>, <font style=\"color:red\">c</font>, w}, 则 A 与 B 的交集为 {<mark>a</mark>,<mark>b</mark>,<mark>c</mark>,<mark>d</mark>,<mark>w</mark>}</u></li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd k1 a</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd k1 b</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd k1 c</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd k2 c</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd k2 d</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd k2 e</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token function\">sdiff</span> k1 k2</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"b\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"a\"</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sinter k1 k2</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"c\"</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sunion k1 k2</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"b\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"a\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"c\"</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"e\"</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"d\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><h4 id=\"hash哈希集合\"><a class=\"markdownIt-Anchor\" href=\"#hash哈希集合\">#</a> Hash (哈希集合)</h4>\n<p>Map 集合，key-Map 集合，值是 map 集合！本质和 String 类型没有太大区别，还是一个简单的 key-value 而，value 是可以由两个值组成</p>\n<p>向集合中添加一个字段值对: <code>hset key field value field1 value1 ...</code></p>\n<p>通过键字段获取值: <code>hget key field</code></p>\n<p>向集合中添加一个键多个字段值: <code>hmset key field value field1 value1 ...</code>  (默认的 hset 也可以添加多个)</p>\n<p>获取集合中多个值的键的值: <code>hmget key field field1 ...</code></p>\n<p>获取全部数据: <code>hgetall key</code></p>\n<p>删除指定键中指定的字段: <code>hdel key field field1 field2 ...</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hset h1 k1 niubi</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hget h1 k1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token string\">\"niubi\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hmset h1 k1 hello k2 <span class=\"token number\">666</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hmget h1 k1 k2</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hello\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"666\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hgetall h1</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"k1\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hello\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"k2\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"666\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hdel h1 k1</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hgetall h1</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"k2\"</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"666\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>获取元素个数，一对 field value 为一个个数: <code>hlen key</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hgetall h1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"k2\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"666\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"k3\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"niubi666\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hlen h1</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>判断集合指定的键中是否存在该字段: <code>hexists key field</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hexists h1 k1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hexists h1 k2</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> keys *</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"h1\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hgetall h1</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"k2\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"666\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"k3\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"niubi666\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>获取指定键中所有的 field: <code>hkeys key</code></p>\n<p>获取指定键中所有的 field 的 value: <code>hvals key</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hgetall h1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"k2\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"666\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"k3\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"niubi666\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hkeys h1</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"k2\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"k3\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hvals h1</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"666\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"niubi666\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>指定增加数量 (如果 count 给定为负数那么就是减): <code>hincrby key field count</code>  (如果 key 不存在则创建)</p>\n<p>判断如果不存在字段则添加，如果存在则不添加: <code>hsetnx key field value</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hset h1 k1 <span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hincrby h1 k1 <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">6</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hincrby h1 k1 <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hsetnx h1 k1 hello</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hget h1 k1</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token string\">\"5\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hsetnx h1 k2 hello</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hget h1 k2</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token string\">\"hello\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>hash 变更的数据 user, name, age, 尤其是用户信息之类的，经常变动的信息！<mark>hash 更适合于对象的存储</mark>，<mark>String 更适合字符串存储</mark></p>\n<h4 id=\"zset有序集合\"><a class=\"markdownIt-Anchor\" href=\"#zset有序集合\">#</a> Zset (有序集合)</h4>\n<p>向集合中添加元素: <code>zadd key NX|XX</code>  前者按编号排序，后者存储 value</p>\n<p>按照指定范围获取集合中的元素: <code>zrange key start end</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zadd h1 <span class=\"token number\">1</span> a</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zadd h1 <span class=\"token number\">2</span> b</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zadd h1 <span class=\"token number\">3</span> e</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zadd h1 <span class=\"token number\">4</span> c</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrange h1 <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"a\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"b\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"e\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"c\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>查询指定的键从最小值到最大值排序获取 (-inf 不能大于 + inf 否则报错 (+inf 可指定条件)):  <code>zrangebyscore</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zadd h1 <span class=\"token number\">5000</span> xiaogong <span class=\"token comment\">#添加三个用户分别有工资</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zadd h1 <span class=\"token number\">3500</span> dagong</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zadd h1 <span class=\"token number\">2500</span> liuhong</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zadd h1 <span class=\"token number\">500</span> dazuo</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrange h1 <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span> <span class=\"token comment\">#查询所有的用户，默认排序按降序</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"dazuo\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"liuhong\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"dagong\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xiaogong\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrangebyscore h1 <span class=\"token parameter variable\">-inf</span> +inf <span class=\"token comment\">#排序查询 从负∞ 到正∞</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"dazuo\"</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"liuhong\"</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"dagong\"</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xiaogong\"</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrangebyscore h1 <span class=\"token parameter variable\">-inf</span> <span class=\"token number\">2500</span> <span class=\"token comment\">#查询 从负∞ 到指定的 2500 的工资为止</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"dazuo\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"liuhong\"</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>通过键以升序获取元素 (反转查询结果): <code>zrevrange key start end</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrangebyscore h1 <span class=\"token parameter variable\">-inf</span> +inf withscores</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"dazuo\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"500\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"liuhong\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"2500\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xiaogong\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">6</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"5000\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrevrange h1 <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xiaogong\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"liuhong\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"dazuo\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>通过键获取元素并附带分数 (withscores): <code>zrangebyscore key -inf +inf withscores</code></p>\n<p>翻译：带分数 withscores</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrangebyscore h1 <span class=\"token parameter variable\">-inf</span> +inf withscores</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"dazuo\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"500\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"liuhong\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"2500\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xiaogong\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">6</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"5000\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>移除指定键中的 member: <code>zrem key member</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrange h1 <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"dazuo\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"liuhong\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"dagong\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xiaogong\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrem h1 dagong</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrange h1 <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"dazuo\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"liuhong\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xiaogong\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>通过键获取集合中的元素个数: <code>zcard key</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrange h1 <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"dazuo\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"liuhong\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xiaogong\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zcard h1</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>获取指定区间的成员数量: <code>zcount key start end</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrange h1 <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span> withscores</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"dazuo\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"500\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"liuhong\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"2500\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xiaogong\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">6</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"5000\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zcount h1 <span class=\"token number\">500</span> <span class=\"token number\">5000</span> <span class=\"token comment\">#从 500 到 5000 的存在的元素的个数</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><ul>\n<li>区分总结: set 与 zset 都是 value 不可重复的\n<ul>\n<li>其中 String , Hash 添加命令都是 set  而  Set , Zset 添加命令是 add</li>\n<li>其中获取元素个数:</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"三种特殊数据类型\"><a class=\"markdownIt-Anchor\" href=\"#三种特殊数据类型\">#</a> 三种特殊数据类型</h3>\n<h4 id=\"geospatial地理位置\"><a class=\"markdownIt-Anchor\" href=\"#geospatial地理位置\">#</a> geospatial 地理位置</h4>\n<p><strong><u>朋友的定位，附近的人，打车距离计算</u></strong></p>\n<p>Redis 的 Geo 在 Redis3.2 版本就推出了，这个功能可以<u><mark>推算地理位置的信息</mark>，<mark>两地之间的距离</mark>，<mark>方圆几里的人</mark></u></p>\n<blockquote>\n<p>geoadd</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#geoadd 添加地理位置</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#规则：两级无法直接添加，我们一般会下载城市数据，直接通过 java 程序一次性导入</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#参数: key  值 (经度，纬度，名称)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#有效的经度从 - 180 度到 180 度</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#有效的纬度从 - 85.05112878 度到 85.05112878 度</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#当坐标位置超出上述指定范围时，该命令将会返回一个错误，添加时注意以下的格式说明</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#\t\t\t\t\t\t\t\t\t\t\t  经度  | 纬度</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> geoadd china:city <span class=\"token number\">116.40</span> <span class=\"token number\">39.90</span> beijing</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><blockquote>\n<p>geopos</p>\n</blockquote>\n<p>获得当前定位：一定是一个坐标值</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#获取指定的城市的经度，纬度</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> geopos china:city beijing</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"116.39999896287918091\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"39.90000009167092543\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> geopos china:city beijing congqi</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"116.39999896287918091\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"39.90000009167092543\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"106.49999767541885376\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"29.52999957900659211\"</span></pre></td></tr></table></figure><blockquote>\n<p>geodist : 两个城市的直线距离</p>\n</blockquote>\n<p>返回两个给定位置之间的距离</p>\n<p>单位:</p>\n<ul>\n<li>m: 表示单位为米</li>\n<li>km: 表示单位为千米</li>\n<li>mi: 表示单位为英里</li>\n<li>ft: 表示单位为英尺</li>\n</ul>\n<p>北京与重庆默认的距离 (重庆拼音打错了)</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> geodist china:city beijing congqi</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token string\">\"1464070.8051\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> geodist china:city beijing congqi m <span class=\"token comment\">#北京到重庆的直线距离以米为单位</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token string\">\"1464070.8051\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> geodist china:city beijing congqi km <span class=\"token comment\">#北京到重庆的直线距离以千米为单位</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token string\">\"1464.0708\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> geodist china:city beijing congqi mi <span class=\"token comment\">#北京到重庆的直线距离以英里为单位</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token string\">\"909.7337\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> geodist china:city beijing congqi ft <span class=\"token comment\">#北京到重庆的直线距离以英尺为单位</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token string\">\"4803381.9063\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><blockquote>\n<p>georadius 以给定的经纬度为中心，找出某一半径内的元素</p>\n</blockquote>\n<p>我附近的人？(获得所有附近的人的地址，定位！) 通过半径来查询</p>\n<p>获得指定数量的人，200</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> georadius china:city <span class=\"token number\">110</span> <span class=\"token number\">30</span> <span class=\"token number\">1000</span> km <span class=\"token comment\">#获得以 110 , 30 这个经纬度为中心，方圆 1000km (千米) 内的城市</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"congqi\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hangzhou\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> georadius china:city <span class=\"token number\">110</span> <span class=\"token number\">30</span> <span class=\"token number\">1000</span> km withdist <span class=\"token comment\">#显示两个城市的直线距离</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"congqi\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"341.9374\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hangzhou\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"977.5143\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> georadius china:city <span class=\"token number\">110</span> <span class=\"token number\">30</span> <span class=\"token number\">1000</span> km withcoord <span class=\"token comment\">#显示两个城市的经度纬度</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"congqi\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"106.49999767541885376\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"29.52999957900659211\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hangzhou\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"120.1600000262260437\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"30.2400003229490224\"</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> georadius china:city <span class=\"token number\">110</span> <span class=\"token number\">30</span> <span class=\"token number\">1000</span> km withdist withcoord count <span class=\"token number\">1</span> <span class=\"token comment\">#限制显示数量</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"congqi\"</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"341.9374\"</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"106.49999767541885376\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"29.52999957900659211\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> georadius china:city <span class=\"token number\">110</span> <span class=\"token number\">30</span> <span class=\"token number\">1000</span> km withdist withcoord count <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"congqi\"</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"341.9374\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"106.49999767541885376\"</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"29.52999957900659211\"</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hangzhou\"</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"977.5143\"</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"120.1600000262260437\"</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"30.2400003229490224\"</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><blockquote>\n<p>georadiusbymember 以某一城市为中心，查找指定范围内的其它城市</p>\n</blockquote>\n<p>翻译:  radiusbymember 半径成员</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#以某一城市为中心，查找指定范围内的其它城市</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> georadiusbymember china:city beijing <span class=\"token number\">1300</span> km</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hangzhou\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"beijing\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> georadiusbymember china:city beijing <span class=\"token number\">1500</span> km</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"congqi\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hangzhou\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"beijing\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> georadiusbymember china:city beijing <span class=\"token number\">1000</span> km</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"beijing\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><blockquote>\n<p>geohash 返回一个或多个位置元素的 geohash 表示</p>\n</blockquote>\n<p>该命令将返回 11 个字符的 geohash 字符串</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#将二维的经纬度转换为一维的字符串，如果两个字符串越相似就代表越近</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> geohash china:city beijing hangzhou</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"wx4fbxxfke0\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"wtmkn31bfb0\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> geohash china:city beijing congqi hangzhou</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"wx4fbxxfke0\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"wm5xzrybty0\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"wtmkn31bfb0\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><ul>\n<li>geo 底层的实现原理其实就是 Zset, 我们可以使用 Zset 命令来操作 geo</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrange china:city <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span> <span class=\"token comment\">#查看地图中全部元素</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"congqi\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hangzhou\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"beijing\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrem china:city congqi <span class=\"token comment\">#将指定元素从地图中删除</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrange china:city <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hangzhou\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"beijing\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><h4 id=\"hyperloglog\"><a class=\"markdownIt-Anchor\" href=\"#hyperloglog\">#</a> Hyperloglog</h4>\n<blockquote>\n<p>什么是基数？</p>\n</blockquote>\n<p 1,=\"\" 3,=\"\" 5,=\"\" 7,=\"\" 8,=\"\" 7=\"\">A</p>\n<p 1,=\"\" 3,=\"\" 5,=\"\" 7,=\"\" 8=\"\">B</p>\n<p>基数 (不重复的元素):B {1, 3, 5, 7, 8} = 5 , 可以接受误差！</p>\n<blockquote>\n<p>简介</p>\n</blockquote>\n<p>Redis2.8.9 版本就更新了 Hyperloglog 数据结构</p>\n<p>Redis Hyperloglog 基数统计的算法</p>\n<p>优点：占用的内存是固定的，2^64 不同的元素的基数，只需要废 12KB 内存，如果要从内存角度来比较的话 Hyperloglog 首选！</p>\n<p><mark>网页的 UV (一个人访问一个网站多次，但是还是算作一个人)</mark>  <code>视频浏览量</code></p>\n<p>传统的方式，set 保存用户的 id, 然后就可以统计 set 中的元素数量作为标准判断</p>\n<p>这个方式如果保存大量的 id, 就会比较麻烦，我们的目的是为了计数，而不是保存用户 id</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> PFadd Hyper a b c d e <span class=\"token comment\">#创建第一组元素</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> PFadd Hyper1 f g h i j k  <span class=\"token comment\">#创建第二组元素</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> PFcount Hyper <span class=\"token comment\">#查看第一组元素个数</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> PFcount Hyper1 <span class=\"token comment\">#查看第二组元素个数</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">6</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> PFmerge Hyper2 Hyper Hyper1 <span class=\"token comment\">#将两组元素以基数进行合并</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> PFcount Hyper2 <span class=\"token comment\">#查看第一组与第二组合并后的数量</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">11</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> PFadd Hyper4 a b c i m k <span class=\"token comment\">#创建第三组元素</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> PFmerge Hyper5 Hyper Hyper4 <span class=\"token comment\">#将第一组与第三组以基数进行合并</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> PFcount Hyper5 <span class=\"token comment\">#查看合并后的数量</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">8</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>如果允许容错，那么一定可以使用 Hyperloglog</p>\n<p>如果不允许容错，就使用 set 或者自己的数据类型即可</p>\n<h4 id=\"bitmaps\"><a class=\"markdownIt-Anchor\" href=\"#bitmaps\">#</a> Bitmaps</h4>\n<blockquote>\n<p>位存储</p>\n</blockquote>\n<p>统计疫情感染人数: 0 1 0 1 0 : 1, 被感染 0, 正常</p>\n<p>统计用户信息，活跃，不活跃，登录，未登录，打卡，365 打卡，两个状态的都可以使用 Bitmaps</p>\n<p>Bitmaps 位图，数据结构！都是操作二进制来进行记录，就只有 0 和 1 两个状态！</p>\n<p>365 天 = 365bit 1 字节 = 8bit 接近用户一年的打卡情况为 46 个字节左右</p>\n<p>使用 bitmaps 来记录，周一到周日的打卡情况！</p>\n<p>周一：1 周二：1 周三：0 周四：1 周五：0 周六：0 周日：1</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> setbit sign <span class=\"token number\">0</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> setbit sign <span class=\"token number\">1</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> setbit sign <span class=\"token number\">2</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> setbit sign <span class=\"token number\">3</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> setbit sign <span class=\"token number\">4</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> setbit sign <span class=\"token number\">5</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> setbit sign <span class=\"token number\">6</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>查看某一天是否有打卡！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> getbit sign <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> getbit sign <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> getbit sign <span class=\"token number\">6</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>统计操作，统计 打卡的天数！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> bitcount sign <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> bitcount sign</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><h3 id=\"事务\"><a class=\"markdownIt-Anchor\" href=\"#事务\">#</a> 事务</h3>\n<p>Redis 事务本质：一组命令的集合！一个事务中的所有命令都会被序列化，在事务执行过程中，会按照顺序执行！</p>\n<p>一次性，顺序型，排它性！执行一系列的命令！</p>\n<pre><code>----队列 set set set 执行----\n</code></pre>\n<p>原子性：要么同时成功，要么同时失败</p>\n<p><font color='red'>Redis 事务没有隔离级别的概念</font></p>\n<p>所有的命令在事务中，并没有直接被执行，只有发起执行命令的时候才会执行！<font color='red' size=4>执行命令：Exec</font></p>\n<p><font color='red'>Redis 单条命令是保证原子性的但是 Redis 的事务是不保证原子性！</font></p>\n<p>Redis 的事务：每次执行完毕后事务就会消失，需要再次开启事务</p>\n<ul>\n<li>开启事务 (multi)</li>\n<li>命令入队 (…)</li>\n<li>执行事务 (exec)</li>\n</ul>\n<blockquote>\n<p>正常执行事务！</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> multi <span class=\"token comment\">#开启事务</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> k1 v1 <span class=\"token comment\">#添加键值</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>QUEUED <span class=\"token comment\"># 命令入队</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> k2 v2 <span class=\"token comment\">#添加键值</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get k2 <span class=\"token comment\">#通过键获取值</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> k3 v3 <span class=\"token comment\">#添加键值</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">exec</span> <span class=\"token comment\">#执行事务</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> OK</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> OK</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"v2\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> OK</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><blockquote>\n<p>discard 放弃事务！</p>\n</blockquote>\n<p>翻译: discard 丢弃</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> multi <span class=\"token comment\">#开启事务</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> k1 v1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> k2 v2</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> k3 v3</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> discard <span class=\"token comment\">#放弃事务</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get k1 <span class=\"token comment\">#事务队列中的命令都没有被执行</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">(</span>nil<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get k2</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">(</span>nil<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get k3</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">(</span>nil<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><blockquote>\n<p>编译型异常 (代码有问题！命令有错！), 事务中所有的命令都不会被执行！</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> multi</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> k1 v1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> k2 v2</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> getset k1</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> ERR wrong number of arguments <span class=\"token keyword\">for</span> <span class=\"token string\">'getset'</span> <span class=\"token builtin class-name\">command</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> k3 v3</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> k4 v4</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">exec</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> EXECABORT Transaction discarded because of previous errors.</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get k1</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">(</span>nil<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get k4</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">(</span>nil<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><blockquote>\n<p>运行时异常 (1/0), 如果事务队列中存在语法性，那么执行命令的时候，其它命令是可以正常执行的，错误命令抛出异常！</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> k1 v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> multi</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> incr k1 <span class=\"token comment\">#给一个字符串进行 + 1 执行的时候报错</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> k2 v2</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> k3 v3</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get k3</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">exec</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> ERR value is not an integer or out of range <span class=\"token comment\">#虽然第一条命令报错了，但是依旧正常执行流程成功了</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> OK</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> OK</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"v3\"</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get k2</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token string\">\"v2\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get k3</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token string\">\"v3\"</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><blockquote>\n<p>监控！Watch (乐观锁) (面试常问)</p>\n</blockquote>\n<h3 id=\"悲观锁\"><a class=\"markdownIt-Anchor\" href=\"#悲观锁\">#</a> 悲观锁:</h3>\n<ul>\n<li>很悲观，认为什么时候都会出现问题，无论做什么都会加锁</li>\n</ul>\n<h3 id=\"乐观锁\"><a class=\"markdownIt-Anchor\" href=\"#乐观锁\">#</a> 乐观锁:</h3>\n<ul>\n<li>\n<p>很乐观，认为什么时候都不会出现问题，所以一般不会加锁，更新数据的时候去判断一下，在此期间是否有人修改过这个数据</p>\n</li>\n<li>\n<p>获取 version</p>\n</li>\n<li>\n<p>更新的时候比较 version</p>\n</li>\n</ul>\n<blockquote>\n<p>Redis 监视测试</p>\n</blockquote>\n<p>正常执行成功！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> money <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> out <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token function\">watch</span> money <span class=\"token comment\">#监视 money 对象，事务执行完毕之后监控就会自动取消</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> multi <span class=\"token comment\">#事务正常结束，数据期间没有发生变动，这个时候就正常执行成功！</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> decrby money <span class=\"token number\">20</span> <span class=\"token comment\">#花掉 20 元</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> incrby out <span class=\"token number\">20</span> <span class=\"token comment\">#增加花掉记录 20 元</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">exec</span> <span class=\"token comment\">#执行事务命令</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>测试多 Terminal 修改值，使用 watch 可以当作 redis 的乐观锁操作！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#终端一号</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token function\">watch</span> money <span class=\"token comment\">#监视 money</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> multi <span class=\"token comment\">#开启事务</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> decrby money <span class=\"token number\">10</span> <span class=\"token comment\">#花掉 10 元</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> incrby out <span class=\"token number\">10</span> <span class=\"token comment\">#记录花掉 10 元</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#终端二号</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get money <span class=\"token comment\">#获取余额</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token string\">\"80\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> money <span class=\"token number\">1000</span> <span class=\"token comment\">#设置为 1000 元</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get money <span class=\"token comment\">#查看设置的余额</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token string\">\"1000\"</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">#终端一号</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">exec</span> <span class=\"token comment\">#执行事务命令</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">(</span>nil<span class=\"token punctuation\">)</span> <span class=\"token comment\">#exec 执行之前，另外一个线程，修改了我们的值，这个时候，就会导致事务执行失败！</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><ul>\n<li><u>unwatch 解开全部的乐观锁 watch, 当执行了 exec 或者 discard 后 watch 也会解锁</u></li>\n</ul>\n<p><font style=\"color:red\"><strong>如果不进行 watch, 使用多线程进行同样操作</strong></font></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#Terminal 一</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get monery</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token string\">\"100\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> multi</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> decrby monery <span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> incrby out  <span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">exec</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#Terminal 二</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get monery</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token string\">\"100\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> monery <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> </pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">#Terminal 一</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">exec</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get  monery</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token string\">\"80\"</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure>",
            "tags": [
                "计算机学科",
                "基础",
                "database",
                "redis"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96/",
            "title": "redis-持久化",
            "date_published": "2024-04-02T06:23:30.157Z",
            "content_html": "<h2 id=\"redis持久化\"><a class=\"markdownIt-Anchor\" href=\"#redis持久化\">#</a> Redis 持久化</h2>\n<p>面试和工作，持久化都是<mark>重点</mark>！</p>\n<blockquote>\n<p>Redis 是内存数据库，如果不将内存中的数据库状态保存到磁盘，那么一旦服务器进程退出，服务器中的数据库状态也会消失，所以 Redis 提供了持久化功能</p>\n</blockquote>\n<h3 id=\"rdbredis-database\"><a class=\"markdownIt-Anchor\" href=\"#rdbredis-database\">#</a> RDB(Redis DataBase)</h3>\n<p>在主从复制中，rdb 就是备用的，从机上面！</p>\n<blockquote>\n<p>什么是 RDB</p>\n</blockquote>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051426460.png\" alt=\"image-20240105142624377\"></p>\n<p>在指定的时间间隔内将内存中的数据集快照写入磁盘，也就是行话讲的 Snapshot 快照，它恢复时是将快照文件直接读到内存里.</p>\n<p>Redis 会单独创建 (fork), 一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件，整个过程中，主进程是不进行任何 IO 操作的，这就确保了极高的性能，如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那 RDB 方式要比 AOF 方式更加的高效，RDB 的缺点是最后一次持久化后的数据可能丢失。我们默认的就是 RDB, 一般情况下不需要修改这个配置！</p>\n<blockquote>\n<p>有时候在生产环境我们会将这个文件进行备份</p>\n</blockquote>\n<p><mark>rdb 保存的文件是 dump.rdb</mark> 都是在配置文件中的快照中进行配置的！</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051426756.png\" alt=\"image-20240105142652722\"></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051427482.png\" alt=\"image-20240105142725442\"></p>\n<blockquote>\n<p>rdb 触发机制</p>\n</blockquote>\n<p>1.save 的规则满足的情况下，会自动触发 rdb 规则</p>\n<p>2. 执行 flushall 命令，也会触发 rdb 规则</p>\n<p>3. 退出 redis, 也会产生 rdb 文件</p>\n<p>备份就自动生成一个  <code>dump.rdb</code>  文件</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051425051.png\" alt=\"image_2023-01-02-17-53-39\"></p>\n<blockquote>\n<p>如何恢复 rdb 文件</p>\n</blockquote>\n<p>1. 只需要将 rdb 文件放在我们 redis 启动目录就可以，redis 启动的时候会自动检查 dump.rdb</p>\n<p>2. 查看存在的位置</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> config get <span class=\"token function\">dir</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"dir\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"/usr/local/bin\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><blockquote>\n<p>几乎它自己默认的配置就够用了，但是我们还是需要去学习</p>\n</blockquote>\n<h4 id=\"优点\"><a class=\"markdownIt-Anchor\" href=\"#优点\">#</a> 优点</h4>\n<ol>\n<li>\n<p>适合大规模的数据恢复</p>\n</li>\n<li>\n<p>对数据的完整性要求不高</p>\n</li>\n</ol>\n<h4 id=\"缺点\"><a class=\"markdownIt-Anchor\" href=\"#缺点\">#</a> 缺点</h4>\n<ol>\n<li>\n<p>需要一定的时间间隔进程操作，如果 redis 意外宏基了，这个最后一次修改的数据就没了</p>\n</li>\n<li>\n<p>fork (分岔) 进程的时候，会占用一定的内存空间</p>\n</li>\n</ol>\n<h3 id=\"aofappend-only-file\"><a class=\"markdownIt-Anchor\" href=\"#aofappend-only-file\">#</a> AOF(Append only File)</h3>\n<p>将我们的所有命令都记录下来，类似与命令 <code>history</code> , 恢复的时候就把这个文件全部在执行一遍！</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051425675.png\" alt=\"image_2023-01-02-17-17-21\"></p>\n<p>以日志的形式来记录每个写操作，将 redis 执行过的所有指令记录下来 (读操作不记录), 只许追加文件但不可以改写文件，redis 启动之初会读取该文件重新构建数据，换言之，redis 重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作</p>\n<p><mark>Aof 保存的是 appendonly.aof 文件</mark></p>\n<blockquote>\n<p>APPEND</p>\n</blockquote>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051427331.png\" alt=\"image-20240105142742273\"></p>\n<p>默认是不开启的，我们需要手动进行配置更改为开启 yes</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051425208.png\" alt=\"image_2023-01-03-17-16-29\"></p>\n<p>一般每间隔一秒修改就好了</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051425787.png\" alt=\"image_2023-01-03-17-19-15\"></p>\n<blockquote>\n<p>重写规则说明</p>\n</blockquote>\n<p>aof 默认就是文件的无限追加，文件会越来越大</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051427580.png\" alt=\"image-20240105142755534\"></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051425123.png\" alt=\"image_2023-01-03-17-23-03\"></p>\n<p>如果 aof 文件大于 64mb, 就会 fork 一个新的进程来将我们的文件进行重写！</p>\n<p>测试 如果破坏 aof 文件会怎么样</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051425280.png\" alt=\"image_2023-01-03-19-14-06\"></p>\n<p><font style=\"color:red\"><u>报错：拒绝连接</u></font></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051425831.png\" alt=\"image_2023-01-03-19-15-50\"></p>\n<blockquote>\n<p>如果这个 aof 文件有错误，这时候 redis 是启动不起来的，我们需要修复这个 aof 文件<br>redis 给我们提供了一个工具 <code>redis-check-aof</code></p>\n</blockquote>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051426279.png\" alt=\"image_2023-01-03-19-20-44\"></p>\n<p>查看 aof 文件里面没有错误命令了</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051426997.png\" alt=\"image_2023-01-03-19-21-34\"></p>\n<p>再次重启后就可以正常启动了</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051426319.png\" alt=\"image_2023-01-03-19-23-33\"></p>\n<blockquote>\n<p>优点和缺点</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># appendfsync always #每次修改都会 sync, 消耗性能</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>appendfsync everysec <span class=\"token comment\">#每秒执行一次 sync, 可能会丢失这 1 秒的数据</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># appendfsync no #不执行 sync, 这个时候操作系统自动同步数据，速度最快</span></pre></td></tr></table></figure><p>优点:</p>\n<ol>\n<li>\n<p>每次修改都同步，文件的完整性会更好</p>\n</li>\n<li>\n<p>每秒修改同步一次，可能会丢失一秒的数据</p>\n</li>\n<li>\n<p>从不同步，效率最高</p>\n</li>\n</ol>\n<p>缺点:</p>\n<ol>\n<li>\n<p>相对于数据文件来说，aof 远远大于 rdb, 修复的速度也比 rdb 慢！</p>\n</li>\n<li>\n<p>aof 运行效率要比 rdb 慢，所以我们 redis 默认的配置就是 rdb 持久化！</p>\n</li>\n</ol>\n<p><mark>扩展</mark></p>\n<ol>\n<li>\n<p>rdb 持久化方式能够在指定的时间间隔内对你的数据进行快照存储</p>\n</li>\n<li>\n<p>aof 持久化方式记录每次对服务器写的操作，当服务器重启的时候会重新执行这些命令来恢复原始数据，aof 命令以 Redis 协议追加保存每次写的操作到文件末尾，Redis 还能对 aof 文件进行后台重写，使得 aof 文件的体积不至于过大</p>\n</li>\n<li>\n<p>只做缓存，如果你希望你的数据在服务器运行的时候存在，你也可以不适用任何持久化</p>\n</li>\n<li>\n<p>同时开启两种持久化方式</p>\n<ul>\n<li>在这种情况下，当 redis 重启的时候会优先载入 aof 文件来恢复原始的数据，因为在通常情况下 aof 文件保存的数据集要比 rdb 文件保存的数据集要完整</li>\n<li>rdb 的数据不实时，同时使用两者时服务器重启也只会找 aof 文件，那要不要只使用 aof 呢？作者不建议，因为 rdb 更适合用于备份数据库 (aof 在不断变化不好备份), 快速重启，而且不会有 aof 可能潜在的 bug, 留着作为一个万一的手段</li>\n</ul>\n</li>\n<li>\n<p>性能建议</p>\n<ul>\n<li>因为 rdb 文件只用作后背用途，建议只在 Slae 上持久化 rdb 文件，而且只要 15 分钟备份一次就够了，只保留 Save 900 1 这条规则</li>\n<li>如果 Enable AOF, 好处是在最恶劣的情况下也只会丢失不超过两秒数据，启动脚本较简单只 load 自己的 aof 文件就可以了，代价一是带来了持续的 IO, 二是 AOF rewrite 的最后将 rewrite 过程中产生的新数据写到新文件造成的阻塞几乎是不可避免的，只要硬盘许可，应该尽量减少 AOF rewrite 的频率，AOF 重写的基础大小默认值 64mb 太小了，可以设到 5G 以上，默认超过原大小 100% 大小重写可以改到适当的数值</li>\n<li>如果不 Enable AOF, 仅靠 Master-Slave Repllcation (主从复制) 实现高可用性也可以，能省掉一大笔 IO, 也减少了 rewrite 是带来的系统波动，代价是如果 Master/Slave 同时倒掉，会丢失十几分钟的数据，启动脚本也要比较两个 Master/Slave 中的 RDB 文件，载入较新的那个，微博就是这种架构</li>\n</ul>\n</li>\n</ol>\n",
            "tags": [
                "计算机学科",
                "database",
                "redis"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/redis/Redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/redis/Redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/",
            "title": "redis-发布订阅",
            "date_published": "2024-04-02T06:23:30.153Z",
            "content_html": "<h2 id=\"redis发布订阅\"><a class=\"markdownIt-Anchor\" href=\"#redis发布订阅\">#</a> Redis 发布订阅</h2>\n<p>Redis 发布订阅 (pub/sub) 是一种<mark>消息通信模式</mark>：发送者 (pub) 发送消息，订阅者 (sub) 接受消息</p>\n<p>Redis 客户端可以订阅任意数量的频道</p>\n<p>订阅 / 发布消息图:</p>\n<p>第一个：消息发送者，第二个：频道，第三个：消息订阅者</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051424264.png\" alt=\"image-20240105142437181\"></p>\n<p>下图展示了频道 channel1, 以及订阅这个频道的三个客户端–client2, client5 和 client1 之间的关系:</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051424633.png\" alt=\"image_2023-01-03-20-27-49\"></p>\n<p>当有新消息通过 PUBLISH 命令发送给频道 channel1 时，这个消息就会被发送给订阅它的三个客户端:</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051424455.png\" alt=\"image_2023-01-03-20-47-11\"></p>\n<blockquote>\n<p>命令</p>\n</blockquote>\n<p>这些命令被广泛用于构建即时通信应用，比如网络聊天室 (chatroom) 和实时广播，实时提醒等</p>\n<table>\n<thead>\n<tr>\n<th>序号</th>\n<th>命令及描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td><font color='red'>psubscribe</font> pattern[pattern …]<br>订阅一个或多个符合给定模式的频道</td>\n</tr>\n<tr>\n<td>2</td>\n<td><font color='red'>pubsub</font> subcommand[argument[argument…]]<br>查看订阅与发布系统状态</td>\n</tr>\n<tr>\n<td>3</td>\n<td><font color='red'>publish</font> channel message<br>将信息发送到指定的频道</td>\n</tr>\n<tr>\n<td>4</td>\n<td><font color='red'>punsubscribe</font> [pattern[pattern …]]<br>退订所有给定模式的频道</td>\n</tr>\n<tr>\n<td>5</td>\n<td><font color='red'>subscribe</font> channel[channel …]<br>订阅给定的一个或多个频道的信息</td>\n</tr>\n<tr>\n<td>6</td>\n<td><font color='red'>unsubscribe</font> [channel[channel …]]<br>指退订给定的频道</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>测试</p>\n</blockquote>\n<p><font style=\"color:red\"><strong><u>注意事项：要使用同一个 redis 也就是同一个端口号来进行测试 6379 订阅不能接收到 6380 发布的消息的只能接收到 6379 发布的消息，至于订阅后被阻塞还怎么发布消息这就看你自己的智商了</u></strong></font></p>\n<p>订阅一个频道的信息</p>\n<p>订阅端:</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051424362.png\" alt=\"image_2023-01-03-21-21-12\"></p>\n<p>将信息发送到指定的频道</p>\n<p>发送端:</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051424581.png\" alt=\"image_2023-01-03-21-48-46\"></p>\n<p>接受到的信息</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051424495.png\" alt=\"image_2023-01-03-21-47-59\"></p>\n<p>一次订阅多次发送</p>\n<blockquote>\n<p>原理</p>\n</blockquote>\n<p>Redis 是使用 C 实现的，通过分析 Redis 源码里的 pubsub.c 文件，了解发布和订阅机制的底层实现，籍此加深对 Redis 的理解</p>\n<p>Redis 通过 publish, subscribe 和 psubscribe 等命令实现发布和订阅功能</p>\n<p>通过 subscribe 命令订阅某频道后，redis-server 里维护了一个字典，字典的键就是一个个 channel, 而字典的值则是一个链表，链表中保存了所有订阅这个 channel 的客户端，subscribe 命令的关键，就是将客户端添加到给定 channel 的订阅链表中</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051424967.png\" alt=\"image_2023-01-03-22-11-29\"></p>\n<p>通过 publish 命令向订阅者发送消息，redis-server 会使用给定的频道作为键，在它所维护的 channel 字典中查找记录了订阅这个频道的所有客户端的链表，遍历这个链表，将消息发布给所有订阅者</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051424577.png\" alt=\"image_2023-01-03-22-32-20\"></p>\n<p>pub/sub 从字面上理解就是发布 (publish) 与订阅 (subscribe), 在 Redis 中，你可以设定对某一个 key 值进行消息发布及消息订阅，当一个 key 值上进行了消息发布后，所有订阅它的客户端都会收到响应的消息，这一功能最明显的用法就是用作实时消息系统，比如普通的即时聊天，群聊等功能</p>\n",
            "tags": [
                "计算机学科",
                "database",
                "redis"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/redis/Redis%E5%88%86%E7%89%87%E9%9B%86%E7%BE%A4/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/redis/Redis%E5%88%86%E7%89%87%E9%9B%86%E7%BE%A4/",
            "title": "redis-分片集群",
            "date_published": "2024-04-02T06:23:30.150Z",
            "content_html": "<h1 id=\"一-redis分片集群\"><a class=\"markdownIt-Anchor\" href=\"#一-redis分片集群\">#</a> 一、Redis 分片集群🎄</h1>\n<ul>\n<li>搭建分片集群</li>\n<li>散列插槽</li>\n<li>集群伸缩</li>\n<li>故障转移</li>\n<li>RedisTemplate 访问分片集群</li>\n</ul>\n<h2 id=\"11-分片集群结构\"><a class=\"markdownIt-Anchor\" href=\"#11-分片集群结构\">#</a> 1.1、分片集群结构</h2>\n<p>主从和哨兵可以解决高可用，高并发读的问题。但是依然有两个问题没有解决：</p>\n<p>1、海量数据存储问题</p>\n<p>2、高并发写的问题</p>\n<p>使用分片集群可以解决上述问题，分片集群特征：</p>\n<p>1、集群中有多个 master，每个 master 保存不同数据</p>\n<p>2、每个 master 都可以有多个 slave 节点</p>\n<p>3、master 之间通过 ping 监测彼此健康状态</p>\n<p>4、客户端请求可以访问集群任意节点，最终都会被转发到正确节点</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191007730.png\" alt=\"image-20231019100741294\"></p>\n<h1 id=\"二-搭建分片集群\"><a class=\"markdownIt-Anchor\" href=\"#二-搭建分片集群\">#</a> 二、搭建分片集群🎄</h1>\n<h2 id=\"41集群结构\"><a class=\"markdownIt-Anchor\" href=\"#41集群结构\">#</a> 4.1. 集群结构</h2>\n<p>分片集群需要的节点数量较多，这里我们搭建一个最小的分片集群，包含 3 个 master 节点，每个 master 包含一个 slave 节点，结构如下：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191017055.png\" alt=\"image-20210702164116027\"></p>\n<p>这里我们会在同一台虚拟机中开启 6 个 redis 实例，模拟分片集群，信息如下：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">IP</th>\n<th style=\"text-align:center\">PORT</th>\n<th style=\"text-align:center\">角色</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">192.168.150.101</td>\n<td style=\"text-align:center\">7001</td>\n<td style=\"text-align:center\">master</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">192.168.150.101</td>\n<td style=\"text-align:center\">7002</td>\n<td style=\"text-align:center\">master</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">192.168.150.101</td>\n<td style=\"text-align:center\">7003</td>\n<td style=\"text-align:center\">master</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">192.168.150.101</td>\n<td style=\"text-align:center\">8001</td>\n<td style=\"text-align:center\">slave</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">192.168.150.101</td>\n<td style=\"text-align:center\">8002</td>\n<td style=\"text-align:center\">slave</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">192.168.150.101</td>\n<td style=\"text-align:center\">8003</td>\n<td style=\"text-align:center\">slave</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"42准备实例和配置\"><a class=\"markdownIt-Anchor\" href=\"#42准备实例和配置\">#</a> 4.2. 准备实例和配置</h2>\n<p>删除之前的 7001、7002、7003 这几个目录，重新创建出 7001、7002、7003、8001、8002、8003 目录：</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 进入 /tmp 目录</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /tmp</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 删除旧的，避免配置干扰</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">rm</span> <span class=\"token parameter variable\">-rf</span> <span class=\"token number\">7001</span> <span class=\"token number\">7002</span> <span class=\"token number\">7003</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 创建目录</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token number\">7001</span> <span class=\"token number\">7002</span> <span class=\"token number\">7003</span> <span class=\"token number\">8001</span> <span class=\"token number\">8002</span> <span class=\"token number\">8003</span></pre></td></tr></table></figure><p>在 /tmp 下准备一个新的 redis.conf 文件，内容如下：</p>\n<figure class=\"highlight ini\"><figcaption data-lang=\"ini\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>port 6379</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 开启集群功能</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>cluster-enabled yes</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 集群的配置文件名称，不需要我们创建，由 redis 自己维护</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>cluster-config-file /tmp/6379/nodes.conf</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># 节点心跳失败的超时时间</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>cluster-node-timeout 5000</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 持久化文件存放目录</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>dir /tmp/6379</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># 绑定地址</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>bind 0.0.0.0</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># 让 redis 后台运行</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>daemonize yes</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># 注册的实例 ip</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>replica-announce-ip 192.168.150.101</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># 保护模式</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>protected-mode no</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># 数据库数量</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>databases 1</pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\"># 日志</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>logfile /tmp/6379/run.log</pre></td></tr></table></figure><p>将这个文件拷贝到每个目录下：</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 进入 /tmp 目录</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /tmp</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 执行拷贝</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token number\">7001</span> <span class=\"token number\">7002</span> <span class=\"token number\">7003</span> <span class=\"token number\">8001</span> <span class=\"token number\">8002</span> <span class=\"token number\">8003</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> <span class=\"token parameter variable\">-t</span> <span class=\"token parameter variable\">-n</span> <span class=\"token number\">1</span> <span class=\"token function\">cp</span> redis.conf</pre></td></tr></table></figure><p>修改每个目录下的 redis.conf，将其中的 6379 修改为与所在目录一致：</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 进入 /tmp 目录</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /tmp</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 修改配置文件</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">printf</span> <span class=\"token string\">'%s\\n'</span> <span class=\"token number\">7001</span> <span class=\"token number\">7002</span> <span class=\"token number\">7003</span> <span class=\"token number\">8001</span> <span class=\"token number\">8002</span> <span class=\"token number\">8003</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> -I<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span> <span class=\"token parameter variable\">-t</span> <span class=\"token function\">sed</span> <span class=\"token parameter variable\">-i</span> <span class=\"token string\">'s/6379/&#123;&#125;/g'</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>/redis.conf</pre></td></tr></table></figure><h2 id=\"43启动\"><a class=\"markdownIt-Anchor\" href=\"#43启动\">#</a> 4.3. 启动</h2>\n<p>因为已经配置了后台启动模式，所以可以直接启动服务：</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 进入 /tmp 目录</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /tmp</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 一键启动所有服务</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">printf</span> <span class=\"token string\">'%s\\n'</span> <span class=\"token number\">7001</span> <span class=\"token number\">7002</span> <span class=\"token number\">7003</span> <span class=\"token number\">8001</span> <span class=\"token number\">8002</span> <span class=\"token number\">8003</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> -I<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span> <span class=\"token parameter variable\">-t</span> redis-server <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>/redis.conf</pre></td></tr></table></figure><p>通过 ps 查看状态：</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ps</span> <span class=\"token parameter variable\">-ef</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> redis</pre></td></tr></table></figure><p>发现服务都已经正常启动：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191017466.png\" alt=\"image-20231019101756517\"></p>\n<p>如果要关闭所有进程，可以执行命令：</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ps</span> <span class=\"token parameter variable\">-ef</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> redis <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> <span class=\"token string\">'&#123;print $2&#125;'</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> <span class=\"token function\">kill</span></pre></td></tr></table></figure><p>或者（推荐这种方式）：</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">printf</span> <span class=\"token string\">'%s\\n'</span> <span class=\"token number\">7001</span> <span class=\"token number\">7002</span> <span class=\"token number\">7003</span> <span class=\"token number\">8001</span> <span class=\"token number\">8002</span> <span class=\"token number\">8003</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> -I<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span> <span class=\"token parameter variable\">-t</span> redis-cli <span class=\"token parameter variable\">-p</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span> <span class=\"token function\">shutdown</span></pre></td></tr></table></figure><h2 id=\"44创建集群\"><a class=\"markdownIt-Anchor\" href=\"#44创建集群\">#</a> 4.4. 创建集群</h2>\n<p>虽然服务启动了，但是目前每个服务之间都是独立的，没有任何关联。</p>\n<p>我们需要执行命令来创建集群，在 Redis5.0 之前创建集群比较麻烦，5.0 之后集群管理命令都集成到了 redis-cli 中。</p>\n<p>1）Redis5.0 之前</p>\n<p>Redis5.0 之前集群命令都是用 redis 安装包下的 src/redis-trib.rb 来实现的。因为 redis-trib.rb 是有 ruby 语言编写的所以需要安装 ruby 环境。</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 安装依赖</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>yum <span class=\"token parameter variable\">-y</span> <span class=\"token function\">install</span> zlib ruby rubygems</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>gem <span class=\"token function\">install</span> redis</pre></td></tr></table></figure><p>然后通过命令来管理集群：</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 进入 redis 的 src 目录</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /tmp/redis-6.2.4/src</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 创建集群</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>./redis-trib.rb create <span class=\"token parameter variable\">--replicas</span> <span class=\"token number\">1</span> <span class=\"token number\">192.168</span>.150.101:7001 <span class=\"token number\">192.168</span>.150.101:7002 <span class=\"token number\">192.168</span>.150.101:7003 <span class=\"token number\">192.168</span>.150.101:8001 <span class=\"token number\">192.168</span>.150.101:8002 <span class=\"token number\">192.168</span>.150.101:8003</pre></td></tr></table></figure><p>2）Redis5.0 以后</p>\n<p>我们使用的是 Redis6.2.4 版本，集群管理以及集成到了 redis-cli 中，格式如下：</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>redis-cli <span class=\"token parameter variable\">--cluster</span> create --cluster-replicas <span class=\"token number\">1</span> <span class=\"token number\">192.168</span>.249.128:6379 <span class=\"token number\">192.168</span>.249.128:6380 <span class=\"token number\">192.168</span>.249.128:6381 <span class=\"token number\">192.168</span>.249.128:6382 <span class=\"token number\">192.168</span>.249.128:6383 <span class=\"token number\">192.168</span>.249.128:6384</pre></td></tr></table></figure><p>命令说明：</p>\n<ul>\n<li><code>redis-cli --cluster</code>  或者 <code>./redis-trib.rb</code> ：代表集群操作命令</li>\n<li><code>create</code> ：代表是创建集群</li>\n<li><code>--replicas 1</code>  或者 <code>--cluster-replicas 1</code>  ：指定集群中每个 master 的副本个数为 1，此时 <code>节点总数 ÷ (replicas + 1)</code>  得到的就是 master 的数量。因此节点列表中的前 n 个就是 master，其它节点都是 slave 节点，随机分配到不同 master</li>\n</ul>\n<p>运行后的样子：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191017247.png\" alt=\"image-20210702181101969\"></p>\n<p>这里输入 yes，则集群开始创建：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191018254.png\" alt=\"image-20210702181215705\"></p>\n<pre><code>[ERR] Not all 16384 slots are covered by nodes.\n</code></pre>\n<p>如果出现上述错误则使用如下命令进行修复：</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>redis-cli <span class=\"token parameter variable\">--cluster</span> fix <span class=\"token number\">192.168</span>.249.128:6379</pre></td></tr></table></figure><p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191131144.png\" alt=\"image-20231019113101085\"></p>\n<p>通过命令可以查看集群状态：</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>redis-cli <span class=\"token parameter variable\">-p</span> <span class=\"token number\">7001</span> cluster nodes</pre></td></tr></table></figure><p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191018613.png\" alt=\"image-20210702181922809\"></p>\n<h2 id=\"45测试\"><a class=\"markdownIt-Anchor\" href=\"#45测试\">#</a> 4.5. 测试</h2>\n<p>尝试连接 7001 节点，存储一个数据：</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 连接</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>redis-cli <span class=\"token parameter variable\">-p</span> <span class=\"token number\">7001</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 存储数据</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">set</span> num <span class=\"token number\">123</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 读取数据</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>get num</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 再次存储</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token builtin class-name\">set</span> a <span class=\"token number\">1</span></pre></td></tr></table></figure><p>结果悲剧了：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191018645.png\" alt=\"image-20210702182343979\"></p>\n<p>集群操作时，需要给 <code>redis-cli</code>  加上 <code>-c</code>  参数才可以：</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>redis-cli <span class=\"token parameter variable\">-c</span> <span class=\"token parameter variable\">-p</span> <span class=\"token number\">7001</span></pre></td></tr></table></figure><p>这次可以了：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191018478.png\" alt=\"image-20210702182602145\"></p>\n<p>其中的 一段多余的信息是，重定向数据到 15495 插槽中了。这个插槽是根据 a 这个变量来计算的</p>\n<h1 id=\"三-散列插槽\"><a class=\"markdownIt-Anchor\" href=\"#三-散列插槽\">#</a> 三、散列插槽🎄</h1>\n<p>Redis 会把每一个 master 节点映射到 0 ~ 16383 共 16384 个插槽 (hash slot) 上，查看集群信息时就能看到：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191135050.png\" alt=\"image-20231019113551981\"></p>\n<p>数据 key 不是与节点绑定，而是与插槽绑定。Redis 会根据 key 的有效部分计算插槽值，分两种情况：</p>\n<p>1、key 中包含 “{}” 且 “{}” 中至少包含 1 个字符，“{}” 中的部分是有效部分</p>\n<p>2、key 中不包含 “{}” ，整个 key 都是有效部分</p>\n<p>例如：key 是 num，那么就根据 num 计算，如果是 {itcast} num，则根据 itcast 计算。计算方式是利用 CRC16 算法得到一个 hash 值，然后对 16384 取余，得到的结果就是 slot 值。</p>\n<blockquote>\n<p>为什么 key 要去跟插槽绑定，而不是跟节点绑定？</p>\n<p>因为 redis 主节点可能出现宕机的情况或者是集群扩容增加了节点再或者是删除节点。</p>\n<p>如果一个节点删除或者宕机了那么它上面的数据跟着丢了，而如果数据是跟插槽绑定的，当节点宕机时，我们可以将这个节点对应的插槽转移到活着的节点上。集群扩容时我们也可以将插槽进行转移。</p>\n<p>这样数据跟着插槽走，永远都能够找到数据所在位置，这就是数据跟插槽绑定的原因了。</p>\n</blockquote>\n<blockquote>\n<p><strong>总结</strong>：</p>\n<p>Redis 如何判断某个 kkey 应该在哪个实例？</p>\n<ul>\n<li>将 16384 个插槽分配到不同的实例</li>\n<li>根据 key 的有效部分计算哈希值，对 16384 取余</li>\n<li>余数作为插槽，寻找插槽所在实例即可</li>\n</ul>\n<p><strong>问题</strong>：</p>\n<p>如何将同一类数据固定的保存在同一个 Redis 实例？</p>\n<ul>\n<li>\n<p>这一类数据使用相同的有效部分，例如 key 都以 {typeId} 为前缀</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> a <span class=\"token number\">123</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>-<span class=\"token operator\">></span> Redirected to slot <span class=\"token punctuation\">[</span><span class=\"token number\">15495</span><span class=\"token punctuation\">]</span> located at <span class=\"token number\">192.168</span>.249.128:6383</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">192.168</span>.249.128:638<span class=\"token operator\"><span class=\"token file-descriptor important\">3</span>></span> <span class=\"token builtin class-name\">set</span> <span class=\"token punctuation\">&#123;</span>a<span class=\"token punctuation\">&#125;</span>num <span class=\"token number\">123</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">192.168</span>.249.128:638<span class=\"token operator\"><span class=\"token file-descriptor important\">3</span>></span> <span class=\"token builtin class-name\">set</span> num <span class=\"token number\">123</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>-<span class=\"token operator\">></span> Redirected to slot <span class=\"token punctuation\">[</span><span class=\"token number\">2765</span><span class=\"token punctuation\">]</span> located at <span class=\"token number\">192.168</span>.249.128:6381</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">192.168</span>.249.128:638<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span> <span class=\"token builtin class-name\">set</span> <span class=\"token punctuation\">&#123;</span>a<span class=\"token punctuation\">&#125;</span>num <span class=\"token number\">456</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>-<span class=\"token operator\">></span> Redirected to slot <span class=\"token punctuation\">[</span><span class=\"token number\">15495</span><span class=\"token punctuation\">]</span> located at <span class=\"token number\">192.168</span>.249.128:6383</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">192.168</span>.249.128:638<span class=\"token operator\"><span class=\"token file-descriptor important\">3</span>></span></pre></td></tr></table></figure></li>\n</ul>\n</blockquote>\n<h1 id=\"四集群伸缩\"><a class=\"markdownIt-Anchor\" href=\"#四集群伸缩\">#</a> 四，集群伸缩🎄</h1>\n<h2 id=\"41-添加一个节点到集群\"><a class=\"markdownIt-Anchor\" href=\"#41-添加一个节点到集群\">#</a> 4.1、添加一个节点到集群🌳</h2>\n<p><code>redis-cli --cluster</code>  提供了很多操作集群的命令，可以通过下面方式查看：</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost bin<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-cli --cluster help</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Cluster Manager Commands:</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  create         host1:port1 <span class=\"token punctuation\">..</span>. hostN:portN</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                 --cluster-replicas <span class=\"token operator\">&lt;</span>arg<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  check          host:port</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                 --cluster-search-multiple-owners</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  info           host:port</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  fix            host:port</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                 --cluster-search-multiple-owners</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                 --cluster-fix-with-unreachable-masters</pre></td></tr></table></figure><p>比如，添加节点命令：</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost bin<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-cli --cluster help</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>add-node       new_host:new_port existing_host:existing_port</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>                 --cluster-slave</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                 --cluster-master-id <span class=\"token operator\">&lt;</span>arg<span class=\"token operator\">></span></pre></td></tr></table></figure><h3 id=\"411-案例向集群中添加一个小新的master节点并向其中存储num-10\"><a class=\"markdownIt-Anchor\" href=\"#411-案例向集群中添加一个小新的master节点并向其中存储num-10\">#</a> 4.1.1、案例，向集群中添加一个小新的 master 节点，并向其中存储 num = 10</h3>\n<p><strong>需求</strong>：</p>\n<p>1、启动一个新的 redis 实例，端口为 7004</p>\n<p>2、添加 7004 到之前的集群，并作为一个 master 节点</p>\n<p>3、给 7004 节点分配插槽，使得 num 这个 key 可以存储到 7004 实例</p>\n<p>步骤：</p>\n<p>1、创建新 redis 实例的配置文件</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost bin<span class=\"token punctuation\">]</span><span class=\"token comment\"># cp configs/6379.conf configs/7004.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost bin<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls configs/</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">6379</span>.conf  <span class=\"token number\">6380</span>.conf  <span class=\"token number\">6381</span>.conf  <span class=\"token number\">6382</span>.conf  <span class=\"token number\">6383</span>.conf  <span class=\"token number\">6384</span>.conf  <span class=\"token number\">7004</span>.conf</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost bin<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>2、将 7004.conf 配置文件中的所有端口号改为 7004</p>\n<pre><code class=\"language-sh·\">[root@localhost bin]# sed -i s/6379/7004/g configs/7004.conf\n</code></pre>\n<p>2.1、查看修改情况</p>\n<pre><code># Accept connections on the specified port, default is 7004 (IANA #815344).\n# If port 0 is specified Redis will not listen on a TCP socket.\nport 7004\n</code></pre>\n<p>3、运行这个 redis 实例</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost bin<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim configs/7004.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost bin<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-server configs/7004.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost bin<span class=\"token punctuation\">]</span><span class=\"token comment\"># ps -ef | grep redis | grep -v grep</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>root      <span class=\"token number\">51922</span>      <span class=\"token number\">1</span>  <span class=\"token number\">0</span> Oct18 ?        00:00:19 redis-server *:6379 <span class=\"token punctuation\">[</span>cluster<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>root      <span class=\"token number\">51964</span>      <span class=\"token number\">1</span>  <span class=\"token number\">0</span> Oct18 ?        00:00:18 redis-server *:6380 <span class=\"token punctuation\">[</span>cluster<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>root      <span class=\"token number\">51983</span>      <span class=\"token number\">1</span>  <span class=\"token number\">0</span> Oct18 ?        00:00:23 redis-server *:6381 <span class=\"token punctuation\">[</span>cluster<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>root      <span class=\"token number\">52001</span>      <span class=\"token number\">1</span>  <span class=\"token number\">0</span> Oct18 ?        00:00:17 redis-server *:6382 <span class=\"token punctuation\">[</span>cluster<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>root      <span class=\"token number\">52025</span>      <span class=\"token number\">1</span>  <span class=\"token number\">0</span> Oct18 ?        00:00:23 redis-server *:6383 <span class=\"token punctuation\">[</span>cluster<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>root      <span class=\"token number\">52043</span>      <span class=\"token number\">1</span>  <span class=\"token number\">0</span> Oct18 ?        00:00:17 redis-server *:6384 <span class=\"token punctuation\">[</span>cluster<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>root     <span class=\"token number\">116920</span>      <span class=\"token number\">1</span>  <span class=\"token number\">0</span> 01:41 ?        00:00:00 redis-server *:7004 <span class=\"token punctuation\">[</span>cluster<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost bin<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>4、将 7004 这个新 redis 实例添加成为集群中的一个节点</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost bin<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-cli --cluster add-node 192.168.249.128:7004 192.168.249.128:6379</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">>></span><span class=\"token operator\">></span> Adding <span class=\"token function\">node</span> <span class=\"token number\">192.168</span>.249.128:7004 to cluster <span class=\"token number\">192.168</span>.249.128:6379</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">>></span><span class=\"token operator\">></span> Performing Cluster Check <span class=\"token punctuation\">(</span>using <span class=\"token function\">node</span> <span class=\"token number\">192.168</span>.249.128:6379<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>S: 74ea48fd9c233b0e4c46f52d00535f040917be36 <span class=\"token number\">192.168</span>.249.128:6379</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   slots: <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> slots<span class=\"token punctuation\">)</span> slave</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   replicates 022d61ad3fb65399d711408bcec5b54068a601b0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>S: 25b42825643381d41525c1951f112766b912baa7 <span class=\"token number\">192.168</span>.249.128:6380</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   slots: <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> slots<span class=\"token punctuation\">)</span> slave</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   replicates 8cae694bd787bad63ab9dab15f397c34131f2a12</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>S: c4d2d8841cb4c801f755e2d95559221229ba7649 <span class=\"token number\">192.168</span>.249.128:6382</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   slots: <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> slots<span class=\"token punctuation\">)</span> slave</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   replicates 74ea48fd9c233b0e4c46f52d00535f040917be36</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>M: 8cae694bd787bad63ab9dab15f397c34131f2a12 <span class=\"token number\">192.168</span>.249.128:6383</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token number\">1</span> additional replica<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>M: 022d61ad3fb65399d711408bcec5b54068a601b0 <span class=\"token number\">192.168</span>.249.128:6381</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">2</span> additional replica<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>S: 34d086276e2a3790b72503c5d877a2d2b26020ff <span class=\"token number\">192.168</span>.249.128:6384</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   slots: <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> slots<span class=\"token punctuation\">)</span> slave</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   replicates 022d61ad3fb65399d711408bcec5b54068a601b0</pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">[</span>OK<span class=\"token punctuation\">]</span> All nodes agree about slots configuration.</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token operator\">>></span><span class=\"token operator\">></span> Check <span class=\"token keyword\">for</span> <span class=\"token function\">open</span> slots<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token operator\">>></span><span class=\"token operator\">></span> Check slots coverage<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">[</span>OK<span class=\"token punctuation\">]</span> All <span class=\"token number\">16384</span> slots covered.</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token operator\">>></span><span class=\"token operator\">></span> Send CLUSTER MEET to <span class=\"token function\">node</span> <span class=\"token number\">192.168</span>.249.128:7004 to <span class=\"token function\">make</span> it <span class=\"token function\">join</span> the cluster.</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">[</span>OK<span class=\"token punctuation\">]</span> New <span class=\"token function\">node</span> added correctly.</pre></td></tr></table></figure><p>7004 成功的加入到了集群当中了</p>\n<p>5、将插槽重新分片</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost bin<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-cli --cluster reshard 192.168.249.128:6379</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">>></span><span class=\"token operator\">></span> Performing Cluster Check <span class=\"token punctuation\">(</span>using <span class=\"token function\">node</span> <span class=\"token number\">192.168</span>.249.128:6379<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>S: 74ea48fd9c233b0e4c46f52d00535f040917be36 <span class=\"token number\">192.168</span>.249.128:6379</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   slots: <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> slots<span class=\"token punctuation\">)</span> slave</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   replicates 022d61ad3fb65399d711408bcec5b54068a601b0</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>S: 25b42825643381d41525c1951f112766b912baa7 <span class=\"token number\">192.168</span>.249.128:6380</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   slots: <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> slots<span class=\"token punctuation\">)</span> slave</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   replicates 8cae694bd787bad63ab9dab15f397c34131f2a12</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>S: c4d2d8841cb4c801f755e2d95559221229ba7649 <span class=\"token number\">192.168</span>.249.128:6382</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   slots: <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> slots<span class=\"token punctuation\">)</span> slave</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   replicates 74ea48fd9c233b0e4c46f52d00535f040917be36</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>M: 34b1a846b72cbb3bdae35fb30567ddba8bf2d5d3 <span class=\"token number\">192.168</span>.249.128:7004</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   slots: <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> slots<span class=\"token punctuation\">)</span> master</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>M: 8cae694bd787bad63ab9dab15f397c34131f2a12 <span class=\"token number\">192.168</span>.249.128:6383</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> <span class=\"token number\">1</span> additional replica<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>M: 022d61ad3fb65399d711408bcec5b54068a601b0 <span class=\"token number\">192.168</span>.249.128:6381</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">2</span> additional replica<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>S: 34d086276e2a3790b72503c5d877a2d2b26020ff <span class=\"token number\">192.168</span>.249.128:6384</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   slots: <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> slots<span class=\"token punctuation\">)</span> slave</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   replicates 022d61ad3fb65399d711408bcec5b54068a601b0</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">[</span>OK<span class=\"token punctuation\">]</span> All nodes agree about slots configuration.</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token operator\">>></span><span class=\"token operator\">></span> Check <span class=\"token keyword\">for</span> <span class=\"token function\">open</span> slots<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token operator\">>></span><span class=\"token operator\">></span> Check slots coverage<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">[</span>OK<span class=\"token punctuation\">]</span> All <span class=\"token number\">16384</span> slots covered.</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\"># 移动插槽的数量</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>How many slots <span class=\"token keyword\">do</span> you want to move <span class=\"token punctuation\">(</span>from <span class=\"token number\">1</span> to <span class=\"token number\">16384</span><span class=\"token punctuation\">)</span>? <span class=\"token number\">3000</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\"># 接收插槽数据的 id</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>What is the receiving <span class=\"token function\">node</span> ID? 34b1a846b72cbb3bdae35fb30567ddba8bf2d5d3</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>Please enter all the <span class=\"token builtin class-name\">source</span> <span class=\"token function\">node</span> IDs.</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  Type <span class=\"token string\">'all'</span> to use all the nodes as <span class=\"token builtin class-name\">source</span> nodes <span class=\"token keyword\">for</span> the <span class=\"token builtin class-name\">hash</span> slots.</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  Type <span class=\"token string\">'done'</span> once you entered all the <span class=\"token builtin class-name\">source</span> nodes IDs.</pre></td></tr><tr><td data-num=\"32\"></td><td><pre> <span class=\"token comment\"># 发送插槽数据的 id</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>Source <span class=\"token function\">node</span> <span class=\"token comment\">#1: 8cae694bd787bad63ab9dab15f397c34131f2a12</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\"># 完成！</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>Source <span class=\"token function\">node</span> <span class=\"token comment\">#2: done</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>Ready to move <span class=\"token number\">3000</span> slots.</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  Source nodes:</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    M: 8cae694bd787bad63ab9dab15f397c34131f2a12 <span class=\"token number\">192.168</span>.249.128:6383</pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token number\">1</span> additional replica<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  Destination node:</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    M: 34b1a846b72cbb3bdae35fb30567ddba8bf2d5d3 <span class=\"token number\">192.168</span>.249.128:7004</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>       slots: <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> slots<span class=\"token punctuation\">)</span> master</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>  Resharding plan:</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    Moving slot <span class=\"token number\">0</span> from 8cae694bd787bad63ab9dab15f397c34131f2a12</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    Moving slot <span class=\"token number\">1</span> from 8cae694bd787bad63ab9dab15f397c34131f2a12</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\t\t\tMoving slot <span class=\"token number\">5217</span> from 8cae694bd787bad63ab9dab15f397c34131f2a12</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    Moving slot <span class=\"token number\">5218</span> from 8cae694bd787bad63ab9dab15f397c34131f2a12</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>Do you want to proceed with the proposed reshard plan <span class=\"token punctuation\">(</span>yes/no<span class=\"token punctuation\">)</span>? <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>Moving slot <span class=\"token number\">0</span> from <span class=\"token number\">192.168</span>.249.128:6383 to <span class=\"token number\">192.168</span>.249.128:7004:</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>Moving slot <span class=\"token number\">1</span> from <span class=\"token number\">192.168</span>.249.128:6383 to <span class=\"token number\">192.168</span>.249.128:7004:</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>Moving slot <span class=\"token number\">2</span> from <span class=\"token number\">192.168</span>.249.128:6383 to <span class=\"token number\">192.168</span>.249.128:7004:</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            <span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure><p>通过 get num 看出 它自动切换到了 6381 集群节点去了，set num 这时 num 就已经存在 7004 这个集群节点上了</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost bin<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-cli -c -p 7004</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:700<span class=\"token operator\"><span class=\"token file-descriptor important\">4</span>></span> <span class=\"token function\">ping</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>PONG</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:700<span class=\"token operator\"><span class=\"token file-descriptor important\">4</span>></span> get num</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>-<span class=\"token operator\">></span> Redirected to slot <span class=\"token punctuation\">[</span><span class=\"token number\">2765</span><span class=\"token punctuation\">]</span> located at <span class=\"token number\">192.168</span>.249.128:6381</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token string\">\"123\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">192.168</span>.249.128:638<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span> <span class=\"token builtin class-name\">set</span> num <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">192.168</span>.249.128:638<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span></pre></td></tr></table></figure><p>这就是说数据是跟着插槽走的</p>\n<h1 id=\"五故障转移\"><a class=\"markdownIt-Anchor\" href=\"#五故障转移\">#</a> 五，故障转移🎄</h1>\n<p>当集群中有一个 master 宕机会发生什么呢？</p>\n<pre><code class=\"language-sh·\">[root@localhost bin]# redis-cli -p 6380 shutdown\n[root@localhost bin]#\n</code></pre>\n<p>可以看到 6380 节点被停止后 7004 变成了主节点</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>74ea48fd9c233b0e4c46f52d00535f040917be36 <span class=\"token number\">192.168</span>.249.128:6379@16379 myself,slave 022d61ad3fb65399d711408bcec5b54068a601b0 <span class=\"token number\">0</span> <span class=\"token number\">1697697326000</span> <span class=\"token number\">10</span> connected</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>25b42825643381d41525c1951f112766b912baa7 <span class=\"token number\">192.168</span>.249.128:6380@16380 slave,fail 8cae694bd787bad63ab9dab15f397c34131f2a12 <span class=\"token number\">1697697296140</span> <span class=\"token number\">1697697292000</span> <span class=\"token number\">9</span> disconnected</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>c4d2d8841cb4c801f755e2d95559221229ba7649 <span class=\"token number\">192.168</span>.249.128:6382@16382 slave 74ea48fd9c233b0e4c46f52d00535f040917be36 <span class=\"token number\">0</span> <span class=\"token number\">1697697327000</span> <span class=\"token number\">1</span> connected</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>34b1a846b72cbb3bdae35fb30567ddba8bf2d5d3 <span class=\"token number\">192.168</span>.249.128:7004@17004 master - <span class=\"token number\">0</span> <span class=\"token number\">1697697326309</span> <span class=\"token number\">11</span> connected</pre></td></tr></table></figure><p>当它回来的时候就是 slave 了</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191437449.png\" alt=\"image-20231019143739426\"></p>\n<p>由此可以看出我们不需要哨兵，Redis 自动具备主从的故障切换</p>\n<p>这是自动的故障转移，有一个机器意外宕机了需要选出一个主。</p>\n<p>但是有的时候我们需要手动故障转移。比如说：机器升级</p>\n<h2 id=\"51-手动故障转移\"><a class=\"markdownIt-Anchor\" href=\"#51-手动故障转移\">#</a> 5.1、手动故障转移🌳</h2>\n<p>利用 cluster failover 命令可以手动让集群中的某个 master 宕机，切换到 cluster failover 命令的这个 slave 节点，实现无感知的数据迁移。其流程如下：</p>\n<p>手动的 Failover 支持三种不同模式：</p>\n<p>1、缺省：默认的流程，如图 1 ~ 6 步</p>\n<p>2、force：省略了对 offset 的一致性校验</p>\n<p>3、takeover：直接执行第 5 步，忽略数据一致性，忽略 master 状态和其它 master 的意见</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191444531.png\" alt=\"image-20231019144410200\"></p>\n<h2 id=\"52-案例在6380这个slave节点执行手动故障转移重新夺回master地位\"><a class=\"markdownIt-Anchor\" href=\"#52-案例在6380这个slave节点执行手动故障转移重新夺回master地位\">#</a> 5.2、案例，在 6380 这个 slave 节点执行手动故障转移，重新夺回 master 地位🌳</h2>\n<p>步骤如下：</p>\n<p>1、利用 redis-cli 连接 6380 这个节点</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost bin<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-cli -p 6380</span></pre></td></tr></table></figure><p>2、执行命令</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span> cluster failover</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span></pre></td></tr></table></figure><p>完成</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>25b42825643381d41525c1951f112766b912baa7 <span class=\"token number\">192.168</span>.249.128:6380@16380 master - <span class=\"token number\">0</span> <span class=\"token number\">1697698095838</span> <span class=\"token number\">12</span> connected</pre></td></tr></table></figure><h1 id=\"六redistemplate访问分配集群\"><a class=\"markdownIt-Anchor\" href=\"#六redistemplate访问分配集群\">#</a> 六，RedisTemplate 访问分配集群🎄</h1>\n<p>RedisTempalte 底层同样基于 lettuce 实现了分片集群的支持，而使用的步骤与哨兵模式基本一致：</p>\n<p>1、引入 redis 的 starter 依赖</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-data-redis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>2、配置分片集群地址</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">redis</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">cluster</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">nodes</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 指定分配集群的每一个节点信息</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token punctuation\">-</span> 192.168.249.128<span class=\"token punctuation\">:</span><span class=\"token number\">6379</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token punctuation\">-</span> 192.168.249.128<span class=\"token punctuation\">:</span><span class=\"token number\">6380</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">-</span> 192.168.249.128<span class=\"token punctuation\">:</span><span class=\"token number\">6381</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">-</span> 192.168.249.128<span class=\"token punctuation\">:</span><span class=\"token number\">6382</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">-</span> 192.168.249.128<span class=\"token punctuation\">:</span><span class=\"token number\">6383</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">-</span> 192.168.249.128<span class=\"token punctuation\">:</span><span class=\"token number\">6384</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">-</span> 192.168.249.128<span class=\"token punctuation\">:</span><span class=\"token number\">7004</span></pre></td></tr></table></figure><p>3、配置读写分离</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">LettuceClientConfigurationBuilderCustomizer</span> <span class=\"token function\">configurationBuilderCustomizer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">return</span> clientConfigurationBuilder <span class=\"token operator\">-></span> clientConfigurationBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">readFrom</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ReadFrom</span><span class=\"token punctuation\">.</span><span class=\"token constant\">REPLICA_PREFERRED</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>与哨兵模式相比，其中只有分片集群的配置方式略有差异，如下：</p>\n<p>测试获取数据</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>channel<span class=\"token operator\">=</span>0x1291f995, /192.168.249.1:6999 -<span class=\"token operator\">></span> /192.168.249.128:6379, <span class=\"token assign-left variable\">chid</span><span class=\"token operator\">=</span>0x9<span class=\"token punctuation\">]</span> Stack contains: <span class=\"token number\">1</span> commands</pre></td></tr></table></figure><p>测试设置数据</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>channel<span class=\"token operator\">=</span>0xff704bc2, /192.168.249.1:7000 -<span class=\"token operator\">></span> /192.168.249.128:6381, <span class=\"token assign-left variable\">chid</span><span class=\"token operator\">=</span>0xa<span class=\"token punctuation\">]</span> Stack contains: <span class=\"token number\">1</span> commands</pre></td></tr></table></figure>",
            "tags": [
                "计算机学科",
                "database",
                "redis",
                "集群"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/redis/Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/redis/Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/",
            "title": "redis-主从复制",
            "date_published": "2024-04-02T06:23:30.147Z",
            "content_html": "<h2 id=\"redis主从复制\"><a class=\"markdownIt-Anchor\" href=\"#redis主从复制\">#</a> Redis 主从复制</h2>\n<p><font size=4>概念</font></p>\n<p>主从复制，是指<font style=\"color:red\"><u><mark>将一台 Redis 的服务器的数据</mark>，<mark>复制到其它的 Redis 服务器</mark>，<mark>前者称为主节点 (master/leader)</mark> , <mark>后者称为从节点 (slave/follower)</mark>; <mark>数据的复制是单向的</mark>，<mark>只能由主节点到从节点</mark>，<mark>Master 以写为主，Slave 以读为主</mark></u></font></p>\n<p><font style=\"color:red\"><u>默认情况下，每台 Redis 服务器都是主节点</u>, <u>且一个主节点可以有多个从节点 (或没有从节点), 但一个从节点只能有一个主节点</u></font></p>\n<p>主从复制的作用主要包括:</p>\n<ol>\n<li>\n<p>数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据冗余方式</p>\n</li>\n<li>\n<p>故障恢复：当主节点出现问题时，可以由从节点服务器，实现快速的故障恢复，实际上是一种服务的冗余</p>\n</li>\n<li>\n<p>负载均衡：在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务 (即写 Redis 数据时应用连接主节点，读 Redis 数据时应用连接从节点), 分担服务器负载；尤其是在写少读多的场景下，通过多个从节点分担读负载，可以大大提高 Redis 服务器的并发量</p>\n</li>\n<li>\n<p>高可用 (集群) 基石：除了上述作用以外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制是 Redis 高可用的基础</p>\n</li>\n</ol>\n<p>一般来说，要将 Redis 运用于工程项目中，只使用一台 Redis 是万万不能的 (因为宕机就完了，一般要配三个就是：一主三从), 原因如下:</p>\n<ol>\n<li>\n<p>从结构上，单个 Redis 服务器会发生单点故障，并且一台服务器需要处理所有的请求负载，压力较大；</p>\n</li>\n<li>\n<p>从容量上，单个 Redis 服务器内存容量有限，就算一台 Redis 服务器内存容量为 256G, 也不能将所有内存用作 Redis 存储内存，一般来说，单台 Redis 最大使用内存不应该超过 20G</p>\n</li>\n</ol>\n<p>电商网站上的商品，一般都是一次上传，无数次浏览的，说专业点就是 &quot;多读少写&quot;, 对于这种场景，我们可以使如下这种架构:</p>\n<p>一主三从</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051409674.png\" alt=\"image-20240105140950566\"></p>\n<p>只要在公司中，主从复制就是必须要使用的，因为在真实的项目中不可能单机使用 <code>Redis</code>  !</p>\n<h3 id=\"环境配置\"><a class=\"markdownIt-Anchor\" href=\"#环境配置\">#</a> 环境配置</h3>\n<p>只配置从库，不用配置主库！(默认就是主库)</p>\n<p>查看当前库信息: <code>info replication</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> info replication <span class=\"token comment\">#查看当前库信息</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># Replication</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>role:master <span class=\"token comment\">#角色</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>connected_slaves:0 <span class=\"token comment\">#从机数量</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#随机生成的 id</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>master_replid:dae261b703d0f68b44c7b95cf50be33d8a3f0c50</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>master_replid2:0000000000000000000000000000000000000000</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>master_repl_offset:0</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>second_repl_offset:-1</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>repl_backlog_active:0</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>repl_backlog_size:1048576</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>repl_backlog_first_byte_offset:0</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>repl_backlog_histlen:0</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><blockquote>\n<p>测试单机多集群</p>\n</blockquote>\n<p>配置多个从库配置文件主要改: <code>port|pidfile|dbfilename|logfile</code>   <font style=\"color:red\"> <code>logfile</code>  <strong>配置文件如果文件不存在则自动创建</strong></font></p>\n<h4 id=\"操作步骤\"><a class=\"markdownIt-Anchor\" href=\"#操作步骤\">#</a> 操作步骤:</h4>\n<p>1. 拷贝出 3 个配置文件，伪集群我们需要开三台 redis 来进行实验</p>\n<p><img src=\"Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6_md_files/image-20230327154220388_20230327154614.png?v=1&amp;type=image&amp;token=V1:SNxXhfHSE20cGh0jieB-92RojNkNp9jz0k5M4JIB8ik\" alt=\"image-20230327154220388\"></p>\n<p>2. 配置<mark> 6379.conf</mark> 的信息主要配置: port     |     pidfile     |        dbfilename       |        logfile</p>\n<p><img src=\"Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6_md_files/image-20230327152554550_20230327154627.png?v=1&amp;type=image&amp;token=V1:klL1texdf3iJ6yjEFDkq7J8VqDpq-RSpxH5cdk2lPAQ\" alt=\"image-20230327152554550\"></p>\n<p>每个程序运行的 pid 都是不同的</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051411052.png\" alt=\"\"></p>\n<p>每个 redis 的数据库数据都是不同的</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051411429.png\" alt=\"\"></p>\n<p>每个 redis 的日志文件也是不同的</p>\n<p><img src=\"Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6_md_files/image-20230327152904341_20230327154709.png?v=1&amp;type=image&amp;token=V1:fxfntNKPHAj74z8a_wZSGJAODAGrMARZHA15kXnob3A\" alt=\"image-20230327152904341\"></p>\n<p>3. 配置<mark> 6380.conf</mark> 的信息</p>\n<p><img src=\"Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6_md_files/image-20230327153341866_20230327154723.png?v=1&amp;type=image&amp;token=V1:jnYNuO_P2RdhP1e_gybBBWx1NLpwr0ka1DoBvQmNPXI\" alt=\"image-20230327153341866\"></p>\n<p><img src=\"Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6_md_files/image-20230327153525882_20230327154734.png?v=1&amp;type=image&amp;token=V1:dyEjnJRk8ryXskMZoBq29xs6w3az5jTnad5D_Jc10Zc\" alt=\"image-20230327153525882\"></p>\n<p><img src=\"Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6_md_files/image-20230327153535221_20230327154746.png?v=1&amp;type=image&amp;token=V1:uQO8vtt2AGypUJ07at5K-7DEwKxUNtERKfkLaRZ22ns\" alt=\"image-20230327153535221\"></p>\n<p><img src=\"Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6_md_files/image-20230327153605193_20230327154758.png?v=1&amp;type=image&amp;token=V1:VM6f9q3E6oWXwyAsXwuaacVUvmpQ3rFLM7jbRhuigNM\" alt=\"image-20230327153605193\"></p>\n<p>4. 配置<mark> 6381.conf</mark> 的信息</p>\n<p><img src=\"Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6_md_files/image-20230327153804788_20230327154811.png?v=1&amp;type=image&amp;token=V1:B7632TiOjUzBa9T1eezMSTVQdGHO42vKIQwsJ0oDk1Q\" alt=\"image-20230327153804788\"></p>\n<p><img src=\"Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6_md_files/image-20230327153829068_20230327154821.png?v=1&amp;type=image&amp;token=V1:bKBSYdVEmfM8wA2AkSWffBaIzXqRFfTQUdaRJJ-eNNQ\" alt=\"image-20230327153829068\"></p>\n<p><img src=\"Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6_md_files/image-20230327153843176_20230327154833.png?v=1&amp;type=image&amp;token=V1:ijg9azq_Fb6FknmbIREeupwRe8-X_8i31nTqgKQ75wA\" alt=\"image-20230327153843176\"></p>\n<p><img src=\"Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6_md_files/image-20230327153903835_20230327154845.png?v=1&amp;type=image&amp;token=V1:cRI6xeHzkCiw2TrbsamGy07_H12ZCUroy-ag3r_yVLM\" alt=\"image-20230327153903835\"></p>\n<p>一次对应着配置文件启动 redis</p>\n<p><strong>启动后</strong> 为伪集群 redis 配置完成了</p>\n<p><img src=\"Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6_md_files/image-20230327154403607_20230327154857.png?v=1&amp;type=image&amp;token=V1:qySh2C_JQy12TXWSBLTHHpN96bEeEnI4yVeCGfkVAk8\" alt=\"image-20230327154403607\"></p>\n<p>其它配置确保是否后台开启 …</p>\n<p>修改完毕后启动三个 Redis 服务，可以通过 <code>ps -ef|grep redis</code>  查看进程</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051420779.png\" alt=\"image_2023-01-04-11-01-34\"></p>\n<p><font size=4>一主二从</font></p>\n<p><mark>默认情况下，每台 Redis 服务器都是主节点</mark> 我们一般情况下只用配置从机就好了</p>\n<p>一主 (79), 二从 (80, 81)</p>\n<p>从机认主机命令: <code>slaveof host port</code>  host: 主机的 ip , port: 主机中 redis 的端口</p>\n<p>从机</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span> slaveof <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6379</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span> info replication</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># Replication</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>role:slave <span class=\"token comment\">#角色 slave: 奴隶</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>master_host:127.0.0.1 <span class=\"token comment\">#主机的 ip</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>master_port:6379 <span class=\"token comment\">#主机的端口 port</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>master_link_status:up</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>master_last_io_seconds_ago:4</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>master_sync_in_progress:0</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>slave_repl_offset:56</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>slave_priority:100</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>slave_read_only:1</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>connected_slaves:0</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>master_replid:3ef9f108a1abe59116f3d4716364383f51414a19</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>master_replid2:0000000000000000000000000000000000000000</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>master_repl_offset:56</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>second_repl_offset:-1</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>repl_backlog_active:1</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>repl_backlog_size:1048576</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>repl_backlog_first_byte_offset:57</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>repl_backlog_histlen:0</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span></pre></td></tr></table></figure><p>主机</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> info replication</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># Replication</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>role:master <span class=\"token comment\">#角色 master: 主人</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>connected_slaves:2 <span class=\"token comment\">#连接的奴隶数量</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>slave0:ip<span class=\"token operator\">=</span><span class=\"token number\">127.0</span>.0.1,port<span class=\"token operator\">=</span><span class=\"token number\">6380</span>,state<span class=\"token operator\">=</span>online,offset<span class=\"token operator\">=</span><span class=\"token number\">70</span>,lag<span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token comment\">#奴隶 80 的 ip 与 port 和一些信息</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>slave1:ip<span class=\"token operator\">=</span><span class=\"token number\">127.0</span>.0.1,port<span class=\"token operator\">=</span><span class=\"token number\">6381</span>,state<span class=\"token operator\">=</span>online,offset<span class=\"token operator\">=</span><span class=\"token number\">70</span>,lag<span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token comment\">#奴隶 81 的 ip 与 port 和一些信息</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>master_replid:3ef9f108a1abe59116f3d4716364383f51414a19</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>master_replid2:0000000000000000000000000000000000000000</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>master_repl_offset:70</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>second_repl_offset:-1</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>repl_backlog_active:1</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>repl_backlog_size:1048576</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>repl_backlog_first_byte_offset:1</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>repl_backlog_histlen:70</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>真实的主从配置应该<mark>在配置文件中配置</mark>，这样的话<mark>是永久的</mark>，我们这里使用的是<mark>命令，暂时的 (重启后就没了)</mark></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051420523.png\" alt=\"image_2023-01-04-13-10-51\"></p>\n<blockquote>\n<p>细节</p>\n</blockquote>\n<p>主机可以写，从机只能读！主机中的所有信息和数据，都会自动被从机保存！</p>\n<p>主机</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> k1 v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get k1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token string\">\"v1\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><p>从机</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span> get k1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token string\">\"v1\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span> <span class=\"token builtin class-name\">set</span> k2 v2</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> READONLY You can't <span class=\"token function\">write</span> against a <span class=\"token builtin class-name\">read</span> only replica.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span></pre></td></tr></table></figure><p>如果主机断开了，从机依旧还是 <code>slave</code>  奴隶状态，依旧<mark>可以获取值</mark>，但是还是<mark>不能设置值</mark>，需要我们手动配置因为没有哨兵 [^ 下面有解释 (哨兵模式)]</p>\n<p><u>如果主机又连接回来了，主机写了一个值，从机还是可以读到的</u> <font style=\"color:red\"><strong>主机连接回来后还是主机从机会自动找主机认主</strong></font></p>\n<p>主机</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token function\">shutdown</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>not connected<span class=\"token operator\">></span> <span class=\"token builtin class-name\">exit</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> dkx@192  /usr/local/bin </pre></td></tr></table></figure><p>从机</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span> info replication</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># Replication</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>role:slave</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>master_host:127.0.0.1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>master_port:6379</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>master_link_status:down</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>master_last_io_seconds_ago:-1</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>master_sync_in_progress:0</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>slave_repl_offset:8452</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>master_link_down_since_seconds:12</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>slave_priority:100</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>slave_read_only:1</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>connected_slaves:0</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>master_replid:3ef9f108a1abe59116f3d4716364383f51414a19</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>master_replid2:0000000000000000000000000000000000000000</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>master_repl_offset:8452</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>second_repl_offset:-1</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>repl_backlog_active:1</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>repl_backlog_size:1048576</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>repl_backlog_first_byte_offset:1</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>repl_backlog_histlen:8452</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span></pre></td></tr></table></figure><p>从机</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span> get k1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token string\">\"v1\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span> <span class=\"token builtin class-name\">set</span> k3 v3</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> READONLY You can't <span class=\"token function\">write</span> against a <span class=\"token builtin class-name\">read</span> only replica.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span></pre></td></tr></table></figure><p>如果是使用命令行来配置的主从，这个时候如果重启了，就会变回主机 (也就是从机重启会变回主机状态)</p>\n<p>从机变回了主机必然是不能在读到 master 写的值了，我们在将其设置为之前 master 的 slave 后依旧可以读到主机的值</p>\n<blockquote>\n<p>复制原理</p>\n</blockquote>\n<p>Slave 启动成功连接到 <code>master</code>  后会发送一个 <code>syn</code>  命令</p>\n<p><code>Master</code>  接收到命令，启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令，在后台进程执行完毕之后，master 将传送整个数据文件到 slave, 并完成一次同步</p>\n<p><font color='green' size=4>全量复制</font>(只要连接则全部 <code>syn</code> ): 而 slave 服务在接收到数据库文件数据后，将其存盘并加载到内存中</p>\n<p><font color='green' size=4>增量复制</font>(连接后的依次读取): <code>Master</code>  继续将新的所有收集到的修改命令依次传给 slave, 完成同步</p>\n<p>但是只要是重新连接 <code>master</code>  , 一次完全同步 (全量复制) 将被自动执行！我们的数据一定可以在从机中看到！</p>\n<blockquote>\n<p>层级链路</p>\n</blockquote>\n<p>以链式的形式，完成主从复制但是还是只有一个主机，一旦主机宕机，从机也不能写只能读</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051421265.png\" alt=\"image-20240105142153186\"></p>\n<blockquote>\n<p>如果没有主人了，这时就会候选出一个老大</p>\n</blockquote>\n<p><mark>谋朝篡位</mark></p>\n<p>但是链式的只要 <code>master</code>  宕机了死掉了，我们可以让候选人来当老大依旧可以完成主从复制</p>\n<p>执行命令: <code>slaveof no one</code>  : 命令解释：奴隶说：没有老大了，我来当老大</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#当老大前</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span> info replication</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># Replication</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>role:slave <span class=\"token comment\">#角色为奴隶</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>master_host:127.0.0.1</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>master_port:6379</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>master_link_status:down</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>master_last_io_seconds_ago:-1</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>master_sync_in_progress:0</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>slave_repl_offset:420</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>master_link_down_since_seconds:13</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>slave_priority:100</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>slave_read_only:1</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>connected_slaves:1</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>slave0:ip<span class=\"token operator\">=</span><span class=\"token number\">127.0</span>.0.1,port<span class=\"token operator\">=</span><span class=\"token number\">6381</span>,state<span class=\"token operator\">=</span>online,offset<span class=\"token operator\">=</span><span class=\"token number\">420</span>,lag<span class=\"token operator\">=</span><span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>master_replid:08e30f50a346437d9ce38596868b3eb4a2d3765b</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>master_replid2:0000000000000000000000000000000000000000</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>master_repl_offset:420</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>second_repl_offset:-1</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>repl_backlog_active:1</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>repl_backlog_size:1048576</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>repl_backlog_first_byte_offset:1</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>repl_backlog_histlen:420</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">#当老大后</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span> slaveof no one</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span> info replication</pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\"># Replication</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>role:master <span class=\"token comment\">#角色为主人</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>connected_slaves:1</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>slave0:ip<span class=\"token operator\">=</span><span class=\"token number\">127.0</span>.0.1,port<span class=\"token operator\">=</span><span class=\"token number\">6381</span>,state<span class=\"token operator\">=</span>online,offset<span class=\"token operator\">=</span><span class=\"token number\">420</span>,lag<span class=\"token operator\">=</span><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>master_replid:5ceda312f5f005f7fed7c1e2e5bb1c787fcd267b</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>master_replid2:08e30f50a346437d9ce38596868b3eb4a2d3765b</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>master_repl_offset:420</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>second_repl_offset:421</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>repl_backlog_active:1</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>repl_backlog_size:1048576</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>repl_backlog_first_byte_offset:1</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>repl_backlog_histlen:420</pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span></pre></td></tr></table></figure><p>执行命令: <code>slaveof no one</code>  之后以链式的形式，第二个当了主人，而第三个第 n 个还是奴隶</p>\n<p>但是 如果主人 (主机) 被修复了又回来了，却不再是主人了手下的江山已经不再了已经是候选人的了，除非让候选人重新归顺于主机</p>\n<h3 id=\"哨兵模式\"><a class=\"markdownIt-Anchor\" href=\"#哨兵模式\">#</a> 哨兵模式</h3>\n<p>(自动选举老大的模式)</p>\n<blockquote>\n<p>概述</p>\n</blockquote>\n<p>主从切换技术的方法是：当主服务器宕机后，需要手动把一台服务器切换为主服务器，这就需要人工干预，费时费力，还会造成一段时间内服务不可用，这不是一种推荐的方式，更多时候，我们优先考虑哨兵模式，Redis 从 2.8 开始正式提供了 Sentinel (哨兵) 架构来解决这个问题</p>\n<p><font style=\"color:red\"><strong>谋朝篡位</strong></font>的自动版，能够后台监控主机是否故障，如果故障了根据票数自动将从库转为主库</p>\n<p>哨兵模式是一种特殊的模式，首先 Redis 提供了哨兵的命令，哨兵是一个独立的进程，作为进程，它会独立运行，其原理是哨兵通过发送命令，等待 Redis 服务器响应，从而监控运行的多个 Redis 实例</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051422206.png\" alt=\"image-20240105142231100\"></p>\n<p>这里的哨兵有两个作用</p>\n<ul>\n<li>\n<p>通过发送命令，让 Redis 服务器返回监控其运行状态，包括主服务器和从服务器</p>\n</li>\n<li>\n<p>当哨兵监测到 <code>master</code>  宕机，会自动将 slave 切换成 master, 然后通过发布订阅模式通知其它的从服务器，修改配置文件，让它们切换主机</p>\n</li>\n</ul>\n<p>然而一个哨兵进程对 Redis 服务器进行监控，可能会出现问题，为此，我们可以使用多个哨兵进行监控，各个哨兵之间还会进行监控，这样就形成了多哨兵模式</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051423496.png\" alt=\"image-20240105142300373\"></p>\n<p>假设主服务器宕机，哨兵 1 先检测到这个结果，系统并不会马上进行 failover (故障转移) 过程，仅仅是哨兵 1 主观的认为主服务器不可用，这个现象称为 <code>主观下线</code> ，当后面的哨兵也检测到主服务器不可用，并且数量达到一定值时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起，进行 failover [故障转移] 操作，切换成功后，就会通过发布订阅模式，让各个哨兵把自己监控的从服务器实现切换主机，这个过程称为<font size=4>客观下线</font></p>\n<blockquote>\n<p>测试</p>\n</blockquote>\n<p>我们目前的状态是 一主二从</p>\n<ol>\n<li>在 redisconfig 文件夹  (<u>如果没有则自己创建用于存放配置文件的</u>)  中创建 sentinel.conf 哨兵的配置文件进行配置</li>\n</ol>\n<p>基本的配置 (核心) sentinel 的配置远远不止这一行</p>\n<ul>\n<li>注意：如果 Redis 要设置密码都全有一致的密码否则都一致不要设置密码\n<ul>\n<li>原因：设置密码连接从库需要配置 masterauth 连接有密码的库可以但是不能连接没有密码的所有密码设置与不设置一致确保能连接成功</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#哨兵    检测   主机名 [随意起名] 被监控的 ip port 投票数</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>sentinel monitor myredis <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6379</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>sentinel auth-pass myredis dkx <span class=\"token comment\">#主机密码，如果主机设置了密码不配置这条命令连接不上</span></pre></td></tr></table></figure><p>后面的数据 1, 代表主机挂了，slave 投票看让谁接替成为主机，票数最多的，就会成为主机</p>\n<ol start=\"2\">\n<li>启动哨兵</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>dkx@192  /usr/local/bin  ./redis-sentinel redisconfig/sentinel.conf                                                    ✔  <span class=\"token number\">441</span>  01:57:29</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 01:57:38.739 <span class=\"token comment\"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 01:57:38.739 <span class=\"token comment\"># Redis version=5.0.4, bits=64, commit=00000000, modified=0, pid=38944, just started</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 01:57:38.739 <span class=\"token comment\"># Configuration loaded</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 01:57:38.740 <span class=\"token comment\"># You requested maxclients of 10000 requiring at least 10032 max file descriptors.</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 01:57:38.740 <span class=\"token comment\"># Server can't set maximum open files to 10032 because of OS error: Operation not permitted.</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 01:57:38.740 <span class=\"token comment\"># Current maximum open files is 4096. maxclients has been reduced to 4064 to compensate for low ulimit. If you need higher maxclients increase 'ulimit -n'.</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                _._                                                  </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>           _.-`<span class=\"token variable\"><span class=\"token variable\">`</span>__ <span class=\"token string\">''</span>-._                                             </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      _.-<span class=\"token variable\">`</span></span><span class=\"token variable\"><span class=\"token variable\">`</span>    <span class=\"token variable\">`</span></span><span class=\"token builtin class-name\">.</span>  <span class=\"token variable\"><span class=\"token variable\">`</span>_.  <span class=\"token string\">''</span>-._           Redis <span class=\"token number\">5.0</span>.4 <span class=\"token punctuation\">(</span>00000000/0<span class=\"token punctuation\">)</span> <span class=\"token number\">64</span> bit</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  .-<span class=\"token variable\">`</span></span><span class=\"token variable\"><span class=\"token variable\">`</span> .-<span class=\"token variable\">`</span></span>`<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token builtin class-name\">.</span>  <span class=\"token variable\">`</span></span>`<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token punctuation\">\\</span>/    _.,_ <span class=\"token string\">''</span>-._                                   </pre></td></tr><tr><td data-num=\"12\"></td><td><pre> <span class=\"token punctuation\">(</span>    '      ,       .-<span class=\"token variable\">`</span></span>  <span class=\"token operator\">|</span> <span class=\"token variable\"><span class=\"token variable\">`</span>,    <span class=\"token punctuation\">)</span>     Running <span class=\"token keyword\">in</span> sentinel mode</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> <span class=\"token operator\">|</span><span class=\"token variable\">`</span></span>-._<span class=\"token variable\"><span class=\"token variable\">`</span>-<span class=\"token punctuation\">..</span>.-<span class=\"token variable\">`</span></span> __<span class=\"token punctuation\">..</span>.-.`<span class=\"token variable\"><span class=\"token variable\">`</span>-._<span class=\"token operator\">|</span>'<span class=\"token variable\">`</span></span> _.-<span class=\"token string\">'|     Port: 26379</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> |    `-._   `._    /     _.-'</span>    <span class=\"token operator\">|</span>     PID: <span class=\"token number\">38944</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token variable\"><span class=\"token variable\">`</span>-._    <span class=\"token variable\">`</span></span>-._  <span class=\"token variable\"><span class=\"token variable\">`</span>-./  _.-<span class=\"token string\">'    _.-'</span>                                   </pre></td></tr><tr><td data-num=\"16\"></td><td><pre> <span class=\"token operator\">|</span><span class=\"token variable\">`</span></span>-._<span class=\"token variable\"><span class=\"token variable\">`</span>-._    <span class=\"token variable\">`</span></span>-.__.-<span class=\"token string\">'    _.-'</span>_.-<span class=\"token string\">'|                                  </pre></td></tr><tr><td data-num=\"17\"></td><td><pre> |    `-._`-._        _.-'</span>_.-<span class=\"token string\">'    |           http://redis.io        </pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  `-._    `-._`-.__.-'</span>_.-<span class=\"token string\">'    _.-'</span>                                   </pre></td></tr><tr><td data-num=\"19\"></td><td><pre> <span class=\"token operator\">|</span><span class=\"token variable\"><span class=\"token variable\">`</span>-._<span class=\"token variable\">`</span></span>-._    <span class=\"token variable\"><span class=\"token variable\">`</span>-.__.-<span class=\"token string\">'    _.-'</span>_.-'<span class=\"token operator\">|</span>                                  </pre></td></tr><tr><td data-num=\"20\"></td><td><pre> <span class=\"token operator\">|</span>    <span class=\"token variable\">`</span></span>-._<span class=\"token variable\"><span class=\"token variable\">`</span>-._        _.-<span class=\"token string\">'_.-'</span>    <span class=\"token operator\">|</span>                                  </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token variable\">`</span></span>-._    <span class=\"token variable\"><span class=\"token variable\">`</span>-._<span class=\"token variable\">`</span></span>-.__.-<span class=\"token string\">'_.-'</span>    _.-<span class=\"token string\">'                                   </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      `-._    `-.__.-'</span>    _.-<span class=\"token string\">'                                       </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>          `-._        _.-'</span>                                           </pre></td></tr><tr><td data-num=\"24\"></td><td><pre>              `-.__.-'                                               </pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 01:57:38.741 <span class=\"token comment\"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 01:57:38.742 <span class=\"token comment\"># Sentinel ID is 8ab32644bb1086cbb0bef3aa54b56016ca76422f</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 01:57:38.742 <span class=\"token comment\"># +monitor master myredis 127.0.0.1 6379 quorum 1</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 01:57:38.743 * +slave slave <span class=\"token number\">127.0</span>.0.1:6380 <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6380</span> @ myredis <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6379</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 01:57:38.744 * +slave slave <span class=\"token number\">127.0</span>.0.1:6381 <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6381</span> @ myredis <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6379</span></pre></td></tr></table></figure><p>我们将主机关闭</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051420959.png\" alt=\"image_2023-01-04-15-01-28\"></p>\n<p>过一会之后哨兵发现主机挂了，就会发起投票选举主机</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 02:01:43.540 <span class=\"token comment\"># +sdown master myredis 127.0.0.1 6379</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 02:01:43.540 <span class=\"token comment\"># +odown master myredis 127.0.0.1 6379 #quorum 1/1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 02:01:43.540 <span class=\"token comment\"># +new-epoch 1</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 02:01:43.540 <span class=\"token comment\"># +try-failover master myredis 127.0.0.1 6379</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 02:01:43.541 <span class=\"token comment\"># +vote-for-leader 8ab32644bb1086cbb0bef3aa54b56016ca76422f 1</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 02:01:43.541 <span class=\"token comment\"># +elected-leader master myredis 127.0.0.1 6379</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 02:01:43.541 <span class=\"token comment\"># +failover-state-select-slave master myredis 127.0.0.1 6379</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 02:01:43.604 <span class=\"token comment\"># +selected-slave slave 127.0.0.1:6381 127.0.0.1 6381 @ myredis 127.0.0.1 6379</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 02:01:43.604 * +failover-state-send-slaveof-noone slave <span class=\"token number\">127.0</span>.0.1:6381 <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6381</span> @ myredis <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6379</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 02:01:43.667 * +failover-state-wait-promotion slave <span class=\"token number\">127.0</span>.0.1:6381 <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6381</span> @ myredis <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6379</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 02:01:44.496 <span class=\"token comment\"># +promoted-slave slave 127.0.0.1:6381 127.0.0.1 6381 @ myredis 127.0.0.1 6379 #promoted-slave: 提升奴隶选举 81 为主机</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 02:01:44.496 <span class=\"token comment\"># +failover-state-reconf-slaves master myredis 127.0.0.1 6379</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 02:01:44.586 * +slave-reconf-sent slave <span class=\"token number\">127.0</span>.0.1:6380 <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6380</span> @ myredis <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6379</span> </pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 02:01:45.545 * +slave-reconf-inprog slave <span class=\"token number\">127.0</span>.0.1:6380 <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6380</span> @ myredis <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6379</span></pre></td></tr></table></figure><p>80</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span> info replication</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># Replication</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>role:slave</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>master_host:127.0.0.1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>master_port:6381</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>master_link_status:down</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>master_last_io_seconds_ago:-1</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>master_sync_in_progress:0</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>slave_repl_offset:17761</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>master_link_down_since_seconds:164</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>slave_priority:100</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>slave_read_only:1</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>connected_slaves:0</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>master_replid:b0b6ff7c006cb105240c9b032a9207481222ef21</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>master_replid2:0000000000000000000000000000000000000000</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>master_repl_offset:17761</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>second_repl_offset:-1</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>repl_backlog_active:1</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>repl_backlog_size:1048576</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>repl_backlog_first_byte_offset:1</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>repl_backlog_histlen:17761</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span></pre></td></tr></table></figure><p>81</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span> info replication</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># Replication</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>role:master</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>connected_slaves:0</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>master_replid:c490db106a8973cd53e490619faffa84d3085d78</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>master_replid2:b0b6ff7c006cb105240c9b032a9207481222ef21</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>master_repl_offset:27024</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>second_repl_offset:17762</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>repl_backlog_active:1</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>repl_backlog_size:1048576</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>repl_backlog_first_byte_offset:169</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>repl_backlog_histlen:26856</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span></pre></td></tr></table></figure><blockquote>\n<p>那主机又回来了呢？</p>\n</blockquote>\n<p>主机连接后 sentinel 又发布了一个新的消息，但是不幸的是主机被转为了奴隶:convert-to-slave: 转换为奴隶</p>\n<ul>\n<li>主机回来之后不再是 <code>master</code>  但是不一定会认候选出来的 <code>master</code>  作为主人，可能会选择候选人的候选人为主人</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">38944</span>:X 04 Jan <span class=\"token number\">2023</span> 02:10:20.662 * +convert-to-slave slave <span class=\"token number\">127.0</span>.0.1:6379 <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6379</span> @ myredis <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6381</span></pre></td></tr></table></figure><p>优点:</p>\n<ol>\n<li>\n<p>哨兵集群，基于主从复制模式，所有的主从配置优点，它全有</p>\n</li>\n<li>\n<p>主从可以切换，故障可以转移，系统的可用性会更好</p>\n</li>\n<li>\n<p>哨兵模式就是主从模式的升级，手动到自动，更加健壮</p>\n</li>\n</ol>\n<p>缺点:</p>\n<ol>\n<li>\n<p>Redis 不好在线扩容的，集群容量一旦到达上限，在线扩容就十分麻烦</p>\n</li>\n<li>\n<p>实现哨兵模式的配置其实是很麻烦的，里面有很多选择</p>\n</li>\n</ol>\n<blockquote>\n<p>哨兵模式的全部配置</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#Example sentinel.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#哨兵 sentinel 实例运行的端口 默认 26379</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>port <span class=\"token number\">26379</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#哨兵 sentinel 的工作目录</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">dir</span> /tmp</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#哨兵 sentinel 监控的 redis 主节点的 ip port</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#master-name 可以自己命名的主节点名称，只能由字母 A-z, 数字 0-9, 这三个字符 \".-_\" 组成</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#quorum 配置多少个 sentinel 哨兵统一认为 master 主节点失联，那么这时客观上认为主节点失联了</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#sentinel monitor &lt;master-name> &lt;ip> &lt;redis-port> &lt;quorum></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>sentinel monitor mymaster <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6379</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#当在 Redis 实例中开启 requirepass foobared 授权密码，这样所有连接 Redis 实例的客户端都要提供密码</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#设置哨兵 sentinel 连接主从的密码，注意必须为主从设置一样的验证密码</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#sentinel auth-pass &lt;master-name> &lt;password></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>sentinel auth-pass mymaster MySUPER--secret-0123password</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#指定多少毫秒之后 主节点没有应答哨兵 sentinel 此时，哨兵主观上认为主节点下线，默认 30 秒</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">#sentinel down-after-milliseconds &lt;master-name> &lt;milliseconds></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>sentinel down-after-milliseconds mymaster <span class=\"token number\">30000</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">#这个配置项指定了在发生 failover 主备切换时最多可以有多少个 slave 同时对新的 master 进行，同步</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">#这个数字越小，完成 failover 所需的时间就越长</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#但是如果这个数字越大，就意味着越多的 slave 因为 replication 而不可用</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#可以通过将这个值设为 1 来保证每次只有一个 slave 处于不能处理命令请求的状态</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">#Sentinel parallel-syncs &lt;master-name> &lt;numslaves></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>sentinel parallel-syncs mymaster <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">#故障转移的超时时间 failover-timeout 可以用在一下这些方面</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">#1. 同一个 sentinel 对同一个 master 两次 failover 之间的间隔时间</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#2. 当一个 slave 从一个错误的 master 那里同步数据开始计算时间，知道 slave 被纠正为正确的 master 那里同步数据时</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">#3. 当想要取消一个正在进行的 failover 所需要的时间</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">#4. 当进行 failover 时，配置所有 slaves 指向新的 master 所需的最大时间，不过，即使过了这个超时，slaves 依然会被正确配置为指向 master, 但是就不按 parallel-syncs 所配置的规则来了</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">#默认三分钟</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">#sentinel failover-timeout &lt;master-name> &lt;milliseconds></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>sentinel failover-timeout mymaster <span class=\"token number\">180000</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">#SCRIPTS EXECUTIOU</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">#配置当某一事件发生时所需执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知相关人员</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\">#对于脚本的运行结果有以下规则</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\">#若脚本执行后返回 1, 那么该脚本稍后将会被再次执行，重复次数目前默认为 10</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">#若脚本执行后返回 2, 或者比 2 更高一个返回值，脚本将不会重复执行</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">#如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为 1 时的行为相同</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">#一个脚本的最大执行时间为 60s, 如果超过这个时间，脚本将会被一个 SIGKILL 信号终止，之后重新执行</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">#通知型脚本：当 sentinel 有任何警告级别的事件发生时，(比如说 redis 实例的主管失效和客观失效等等), 将会去调用这个脚本，这时这个脚本应该通过邮件，SMS 等方式去通知系统管理员关于系统不正常运行的信息，调用该脚本时，将传递给脚本两个参数，一个是事件的类型，一个是事件的描述，如果 sentinel.conf 配置文件中配置了这个脚本路径，那么必须保证这个脚本存在与这个路径，并且是可执行的，否则 sentinel 无法正常启动成功</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">#通知脚本</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\">#shell 编程</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token comment\">#sentinel notification-script &lt;master-name> &lt;script-path></span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>sentinel norification-script mymaster /var/redis/nofity.sh</pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token comment\">#客户端重新配置主节点参数脚本</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token comment\">#当一个 master 由于 failover 而发生改变时，这个脚本将会被调用，通知相关的客户端关于 master 地址已经发生改变的信息</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token comment\">#以下参数将会在调用脚本时传递给脚本:</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token comment\">#&lt;master-name> &lt;role> &lt;state> &lt;from-ip> &lt;from-port> &lt;to-ip> &lt;to-port></span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token comment\">#目前 & lt;state > 总是 \"failover\"</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token comment\">#&lt;role > 是 \"leader\" 或者 \"observer\" 中的一个</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token comment\">#参数 from-ip, from-port, to-ip, to-port 是用来和旧的 master 和新的 master (即旧的 slave) 通信的</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token comment\">#这个脚本应该是通用的，能被多次调用，不是针对性的</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token comment\">#sentinel client-reconfig-script &lt;master-name> &lt;script-path></span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>sentinel client-reconfig-script mymaster /var/redis/reconfig.sh</pre></td></tr></table></figure><h4 id=\"注意\"><a class=\"markdownIt-Anchor\" href=\"#注意\">#</a> 注意:</h4>\n<p>配置哨兵模式后配置文件会发生变化可能导致一些问题具体发生变化的内容</p>\n<p><img src=\"Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6_md_files/image-20230327202721502_20230327202857.png?v=1&amp;type=image&amp;token=V1:6HAI1c2eHTs9H9Q4rGHs5PXrhYHhYHCq4vefJFxiQq4\" alt=\"image-20230327202721502\"></p>\n",
            "tags": [
                "计算机学科",
                "database",
                "redis"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/redis/Redis.config%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/redis/Redis.config%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/",
            "title": "redis-配置文件详解",
            "date_published": "2024-04-02T06:23:30.144Z",
            "content_html": "<h2 id=\"redisconfig配置文件详解\"><a class=\"markdownIt-Anchor\" href=\"#redisconfig配置文件详解\">#</a> Redis.Config 配置文件详解</h2>\n<p>启动的时候，就通过配置文件来启动</p>\n<p>工作中，一些小小的配置，可以让你脱颖而出</p>\n<p>行家有没有，出手就知道</p>\n<blockquote>\n<p>单位</p>\n</blockquote>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051429088.png\" alt=\"\"></p>\n<p>1. 配置文件 unit 单位，对大小写不敏感</p>\n<blockquote>\n<p>包含</p>\n</blockquote>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051429577.png\" alt=\"image-20240105142938522\"></p>\n<ul>\n<li>可以导入其它的配置文件</li>\n</ul>\n<blockquote>\n<p>网络</p>\n</blockquote>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051428712.png\" alt=\"image_2023-01-02-14-59-41\"></p>\n<ul>\n<li>\n<p>如果想要让 redis 可以远程连接则需要将 <code>bind</code>  更换为 redis 本机的 ip 地址或者 <code>bind *</code>  更换为通配符</p>\n</li>\n<li>\n<p>连接时输入 Linux 的 ip 即可连接</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>protected-mode <span class=\"token function\">yes</span> <span class=\"token comment\">#保护模式是否开启如果远程连接失败可以考虑将其设置为 no 如果考虑安全性则设为 yes</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>port <span class=\"token number\">6379</span> <span class=\"token comment\">#端口号</span></pre></td></tr></table></figure><blockquote>\n<p>GENERAL 通用</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>daemonize <span class=\"token function\">yes</span> <span class=\"token comment\">#是否守护进程开启 默认为 no , 我们希望退出后 server 还是运行的则需要设置为 yes</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>pidfile /var/run/redis_6379.pid <span class=\"token comment\">#如果以后台的方式运行，我们就需要指定一个 pid 文件！</span></pre></td></tr></table></figure><figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#日志</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># Specify the server verbosity level.</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># This can be one of:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># debug (a lot of information, useful for development/testing)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># verbose (many rarely useful info, but not a mess like the debug level)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># notice (moderately verbose, what you want in production probably) #生产环境适用</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># warning (only very important / critical messages are logged)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>loglevel notice</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>logfile <span class=\"token string\">\"/usr/local/bin/redis-log.log\"</span> <span class=\"token comment\">#日志文件的文件位置，这个日志文件是自己创建的信息会打印到这个文件中</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>databases <span class=\"token number\">16</span> <span class=\"token comment\">#默认的数据库数量</span></pre></td></tr></table></figure><figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>always-show-logo <span class=\"token function\">yes</span> <span class=\"token comment\">#是否显示 log, 下面为开启示例 默认开启</span></pre></td></tr></table></figure><p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051430154.png\" alt=\"image-20240105143005080\"></p>\n<blockquote>\n<p>SNAPSHOTTING 快照</p>\n</blockquote>\n<p>持久化，在规定的时间内，执行了多少次操作，则会持久化到文件 <code>.rdb</code>  ,  <code>.aof</code></p>\n<p>redis 是内存数据库，如果没有持久化，那么数据断电即失</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#如果 900 秒内，如果至少有一个 key 进行了修改，这个时候就进行持久化操作</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>save <span class=\"token number\">900</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#如果 300 秒内，如果至少有十个 key 进行了修改，这个时候就进行持久化操作</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>save <span class=\"token number\">300</span> <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#如果 300 秒内比如说高并发的时候，如果至少有 10000 个 key 进行了修改，这个时候就进行持久化操作</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>save <span class=\"token number\">60</span> <span class=\"token number\">10000</span></pre></td></tr></table></figure><ul>\n<li>我们之后学习持久化，会自己定义这个测试！</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>stop-writes-on-bgsave-error <span class=\"token function\">yes</span> <span class=\"token comment\">#持久化出现错误之后，是否继续进行工作，默认开启</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>rdbcompression <span class=\"token function\">yes</span> <span class=\"token comment\">#是否压缩 rdb 文件，默认开启，rdb 就是持久化的文件，开启需要消耗一些 CPU 的资源</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>rdbchecksum <span class=\"token function\">yes</span> <span class=\"token comment\">#保存 rdb 文件的时候进行 rdb 文件校验，如果出错了可以自定进行一些修复</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">dir</span> ./ <span class=\"token comment\">#rdb 默认保存目录</span></pre></td></tr></table></figure><blockquote>\n<p>REPLICATION 主从复制</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>replica-serve-stale-data <span class=\"token function\">yes</span> <span class=\"token comment\">#是否保存数据</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>replica-read-only <span class=\"token function\">yes</span> <span class=\"token comment\">#是否为只读</span></pre></td></tr></table></figure><blockquote>\n<p>SECURITY 安全</p>\n</blockquote>\n<p>设置密码默认没有密码</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051428738.png\" alt=\"image_2023-01-02-16-25-06\"></p>\n<p>密码为空</p>\n<p>如果我们使用命令来设置密码的话当我们重启 redis 后密码就会失效所以我们对配置文件进行修改就不会失效了</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051429088.png\" alt=\"image-20240105142900035\"></p>\n<ul>\n<li>\n<p>补充：命令设置密码为:config set requirepass “密码”</p>\n</li>\n<li>\n<p>获取:config get requirepass</p>\n</li>\n<li>\n<p>登入:auth “密码”</p>\n</li>\n<li>\n<p>注意：如果我们设置了密码那么可以看下是否可以 ping 如果可以就重启以下如果还可以就说明密码没有设置成功，有密码不登陆执行命令就会报错如下图</p>\n</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051428768.png\" alt=\"image_2023-01-02-16-36-45\"></p>\n<blockquote>\n<p>CLIENTS 客户端的限制</p>\n</blockquote>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051430304.png\" alt=\"image-20240105143019251\"></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>maxclients <span class=\"token number\">10000</span> <span class=\"token comment\">#设置能连接上客户端的数，最大 1w 个</span></pre></td></tr></table></figure><blockquote>\n<p>MEMORY MANAGEMENT 内存管理</p>\n</blockquote>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051430915.png\" alt=\"image-20240105143032841\"></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>maxmemory <span class=\"token operator\">&lt;</span>bytes<span class=\"token operator\">></span> <span class=\"token comment\">#redis 配置最大内存容量</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>maxmemory-policy noeviction <span class=\"token comment\">#内存达到上限后的处理策略</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">1</span>.volatile-lru:只对设置了过期时间的key进行LRU<span class=\"token punctuation\">(</span>默认值<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">2</span>.allkeys-lru:删除lru算法的key</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">3</span>.volatile-random:随机删除即将过期key</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">4</span>.allkeys-random:随机删除</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">5</span>.volatile-ttl:删除即将过期的</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">6</span>.noeviction:永不过期, 返回错误</pre></td></tr></table></figure><blockquote>\n<p>APPEND ONLY MODE aof 配置</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>appendonly no <span class=\"token comment\">#默认不开启，为什么不开启呢 因为默认使用的是 rdb 方式持久化的，在大部分情况下 rdb 完全够用</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>appendfilename <span class=\"token string\">\"appendonly.aof\"</span> <span class=\"token comment\">#持久化的文件的名称后缀名为.aof 而 rdb 后缀为.rdb</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># appendfsync always #每次修改都会 sync (同步), 消耗性能</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>appendfsync everysec <span class=\"token comment\">#每秒执行一次，sync (同步), 可能会丢失 1 秒的数据</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># appendfsync no #不执行 sync (同步), 这个时候操作系统自己同步数据，速度最快</span></pre></td></tr></table></figure>",
            "tags": [
                "计算机学科",
                "database",
                "redis"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/navicat/navicat%E6%A8%A1%E5%9E%8B-%E6%B8%85%E7%90%86%E8%A1%A8%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/navicat/navicat%E6%A8%A1%E5%9E%8B-%E6%B8%85%E7%90%86%E8%A1%A8%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB/",
            "title": "navicat模型-清理表之间的关系",
            "date_published": "2024-04-02T06:23:30.135Z",
            "content_html": "<h1 id=\"navicat模型-清理表之间的关系\"><a class=\"markdownIt-Anchor\" href=\"#navicat模型-清理表之间的关系\">#</a> navicat 模型 - 清理表之间的关系</h1>\n<p>当我们使用 navicat 中模型的时候，将我们需要看的表导入到模型中时如下图：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240331104125115.png\" alt=\"image-20240331104125115\"></p>\n<p>我们可以看到红线所标注的线两边有不同的图标，看了可能会一头雾水</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240331104349530.png\" alt=\"image-20240331104349530\"></p>\n<p>废话不多说，我们着重分析 user 与 order 表，两者是典型的一对多关系，那么 order 是多方，user 是一方。所以，你看懂了吗？order 是三个叉叉叉，user 是一个叉.</p>\n<p>如果在模型上的关系出邮件查看的话是，基数在订单上的是：零个或者多个，而在 user 上是零个或一个。</p>\n<p>这样你应该更加明白了。</p>\n<p>也就是说，一对多关系上，一方也就是父方是可以是 0 或者 1 个，而对应在 order 方（多方，子方）是 0 个或者多个。</p>\n<p>这样是不是更好的体现了一对多的关系呢？</p>\n<p>相信你已经懂。需要说明的是，如果要求很严格的话，这样设计是比较注重细节的，同样在此关系中，如果不注意弄成了唯一或者多个的话就不能十分准确的表现业务了</p>\n<p>单拿出来一个关系表进行分析：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240331105045467.png\" alt=\"image-20240331105045467\"></p>\n<p>如上图：tb_product_specs 就是设外键的一方，如下图：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240331105136558.png\" alt=\"image-20240331105136558\"></p>\n<p>添加数据时，由于 tb_product_specs 是从表，所以需要看主表：tb_product 是否有对应的 id，因为从表关联了主表的 id 字段所以要看主表的 id 数据，比如有 1 那么可以在从表添加如下数据：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240331105355411.png\" alt=\"image-20240331105355411\"></p>\n<p>还可以添加为 null 的数据，但是不能添加其它的数据</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240331105429776.png\" alt=\"image-20240331105429776\"></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240331105444853.png\" alt=\"image-20240331105444853\"></p>\n<p>PS: 这里补充一点，在关系上右键的前往目标和前往源指的是前往子父表。因为一个外键关键，关联表是源，被关联的表是目标</p>\n<blockquote>\n<p>这个会有三个标记，你图中出现了两个： 1，三叉的，表示设有外键的一方； 2，一叉的，表示一对一的关系； 3，还有一个等于号的标记，表示一对多的关系； ----------- 补充其他相关的概念： 1，主表 &amp; 从表的概念：一个 “公共关键字”，设为主键的表为 “父表”，否则为 “从表”；故该公共关键字为从表的 “外键”； 数据表的三种关系： 1，一对一：一个 A 表，只能对应一个 B 表； 2，一对多：一个 A 表，可以对应多个 B 表； 3，多对多：一个 A 表，可以对应多个 B 表；一个 B 表，也可以对应多个 A 表</p>\n</blockquote>\n",
            "tags": [
                "计算机学科",
                "database",
                "navicat"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mysql/MySQL%E5%AE%89%E8%A3%85/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mysql/MySQL%E5%AE%89%E8%A3%85/",
            "title": "Windows安装MySQL",
            "date_published": "2024-04-02T06:23:30.128Z",
            "content_html": "<h2 id=\"windows安装mysql\"><a class=\"markdownIt-Anchor\" href=\"#windows安装mysql\">#</a> Windows 安装 MySQL</h2>\n<ol>\n<li>首先找到 MySQL 的官网，点击下载后进入这个页面点击如下图所示</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031529779.png\" alt=\"\"></p>\n<ol start=\"2\">\n<li>有两个安装的路径它们的含义分别不同我们选择第二个离线安装</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031531541.png\" alt=\"image-20240103153114444\"></p>\n<ol start=\"3\">\n<li>这里我们直接点击下载</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031531098.png\" alt=\"image_2022-12-03-23-07-06\"></p>\n<ol start=\"4\">\n<li>\n<p>安装完成后我们进入下一个阶段：安装与配置</p>\n<ul>\n<li>\n<p>注意事项:</p>\n<ol>\n<li>确保电脑的 UserName (用户名) 中不含有中文，如果有需要重命名更改</li>\n</ol>\n</li>\n</ul>\n</li>\n<li>\n<p>右键安装包点击安装</p>\n</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031531431.png\" alt=\"image_2022-12-03-23-13-07\"></p>\n<ol start=\"6\">\n<li>稍等片刻后就会出现这样的一个页面</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031531334.png\" alt=\"image_2022-12-03-23-14-14\"></p>\n<ul>\n<li>\n<p>Developer Default: 安装 MySQL 服务器以及开发 MySQL 所需的工具</p>\n</li>\n<li>\n<p>Server only: 仅安装 MySQL 服务器</p>\n</li>\n<li>\n<p>Client only: 仅安装客户端</p>\n</li>\n<li>\n<p>Full: 安装 MySQL 所有可用组件</p>\n</li>\n<li>\n<p>Custom:(经典) 自定义安装</p>\n</li>\n</ul>\n<ol start=\"7\">\n<li>我们点击 Custom 进行自定义安装</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031534042.png\" alt=\"image_2022-12-03-23-18-32\"></p>\n<p>可以看到它让我们选择所需的 MySQL 工具，但是我们怎么知道要怎么选择呢不着急这样操作</p>\n<ol>\n<li>点击 back 退回去，并选中第一个</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031531954.png\" alt=\"image_2022-12-03-23-20-10\"></p>\n<ol start=\"2\">\n<li>点击 next</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031531061.png\" alt=\"image_2022-12-03-23-21-03\"></p>\n<ol start=\"3\">\n<li>再点击 back 退回</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031531888.png\" alt=\"image_2022-12-03-23-21-53\"></p>\n<ol start=\"4\">\n<li>选中 Custom 后点击 Next</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031532709.png\" alt=\"image-20240103153205611\"></p>\n<p>我们可以看到它既然帮我们自己选好了</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031531997.png\" alt=\"image_2022-12-03-23-23-00\"></p>\n<p>进行下一步操作，点击右侧的工具进行添加路径</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031531352.png\" alt=\"image_2022-12-03-23-25-54\"></p>\n<p>当然这两个路径需要自己提前创建好：D:\\MySQL 和 D:\\MySQLData</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031532910.png\" alt=\"image_2022-12-03-23-27-20\"></p>\n<p>再进行下一个同样的操作</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031532202.png\" alt=\"image_2022-12-03-23-28-59\"></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031533089.png\" alt=\"image_2022-12-03-23-30-11\"></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031533608.png\" alt=\"image_2022-12-03-23-31-55\"></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031534933.png\" alt=\"image_2022-12-03-23-32-34\"></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031533340.png\" alt=\"image_2022-12-03-23-33-25\"></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031533439.png\" alt=\"image_2022-12-03-23-34-27\"></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031534929.png\" alt=\"image_2022-12-03-23-35-14\"></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031533124.png\" alt=\"image_2022-12-03-23-35-47\"></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031533800.png\" alt=\"image_2022-12-03-23-36-09\"></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031533597.png\" alt=\"image_2022-12-03-23-36-33\"></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031533473.png\" alt=\"image_2022-12-03-23-36-58\"></p>\n<p>完成后点击 Next, 选择 yes</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031533394.png\" alt=\"image_2022-12-03-23-40-10\"></p>\n<p>点击 Execute</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031533453.png\" alt=\"image_2022-12-03-23-40-46\"></p>\n<p>完成后点击 next</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031534750.png\" alt=\"image-20240103153445664\"></p>\n<p>这里默认就行直接 next</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031534789.png\" alt=\"image_2022-12-03-23-43-03\"></p>\n<p>选择第二个</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031533869.png\" alt=\"image_2022-12-03-23-44-10\"></p>\n<p>设置管理员密码 一定要记住这个密码</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031533750.png\" alt=\"image_2022-12-03-23-46-58\"></p>\n<p>然后一路下一步就行了</p>\n<p>这里输入刚才设置的密码之后点击 check 验证然后通过 next</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031533690.png\" alt=\"image_2022-12-03-23-49-38\"></p>\n<p>安装成功后会弹出两个窗口我们关闭了，来查看下 MySQL 的目录</p>\n<p>这里是工具套件目录</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031533603.png\" alt=\"image_2022-12-03-23-52-12\"></p>\n<p>这里是我们安装的 MySQL 数据库目录</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031535512.png\" alt=\"image-20240103153521470\"></p>\n<p>我们可以切换到 D:\\MySQL\\MySQL Server8.0\\bin 这个目录下执行以下 cmd</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031534739.png\" alt=\"image_2022-12-03-23-58-16\"></p>\n<p>在 cmd 中输入 mysql -u root -p 然后输出刚才设置的密码就可以进入 mysql 了</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031534708.png\" alt=\"image_2022-12-03-23-59-55\"></p>\n<h2 id=\"配置环境变量\"><a class=\"markdownIt-Anchor\" href=\"#配置环境变量\">#</a> 配置环境变量</h2>\n<ol>\n<li>打开配置的页面，选择 path</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031534905.png\" alt=\"image_2022-12-04-00-02-16\"></p>\n<ol start=\"2\">\n<li>path 中新建输入 mysql 的 bin 目录的路径</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031534873.png\" alt=\"image_2022-12-04-00-04-41\"></p>\n<p>大功告成！查看下是否可以在 cmd 任意打开的位置都可以进入 mysql 了可以那么就是成功了</p>\n",
            "tags": [
                "计算机学科",
                "mysql",
                "database"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mybatis/%E4%BB%A3%E7%A0%81%E6%A1%88%E4%BE%8B/%E8%81%94%E8%A1%A8%E5%88%86%E9%A1%B5%E8%BF%94%E5%9B%9E%E5%88%B0VO%E7%B1%BB/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mybatis/%E4%BB%A3%E7%A0%81%E6%A1%88%E4%BE%8B/%E8%81%94%E8%A1%A8%E5%88%86%E9%A1%B5%E8%BF%94%E5%9B%9E%E5%88%B0VO%E7%B1%BB/",
            "title": "联表分页返回到VO类",
            "date_published": "2024-04-02T06:23:30.120Z",
            "content_html": "<h1 id=\"联表分页返回到vo类\"><a class=\"markdownIt-Anchor\" href=\"#联表分页返回到vo类\">#</a> 联表分页返回到 VO 类</h1>\n<p>创建数据库：</p>\n<p>class</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> Navicat Premium Data Transfer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> Source Server         : windows</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> Source Server Type    : MySQL</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> Source Server Version : 80028</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> Source Host           : localhost:3306</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> Source Schema         : mpj_test</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> Target Server Type    : MySQL</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> Target Server Version : 80028</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> File Encoding         : 65001</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> Date: 30/03/2024 10:56:43</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">SET</span> NAMES utf8mb4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">-- Table structure for tab_class</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span>  <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'课程表id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_0900_ai_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'课程名称'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> <span class=\"token operator\">=</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> <span class=\"token operator\">=</span> utf8mb4_0900_ai_ci ROW_FORMAT <span class=\"token operator\">=</span> Dynamic<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">-- Records of tab_class</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'数学'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'语文'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'英语'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'化学'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'生物'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'物理'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'政治'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'历史'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'地理'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>student</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> Navicat Premium Data Transfer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> Source Server         : windows</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> Source Server Type    : MySQL</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> Source Server Version : 80028</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> Source Host           : localhost:3306</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> Source Schema         : mpj_test</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> Target Server Type    : MySQL</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> Target Server Version : 80028</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> File Encoding         : 65001</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> Date: 30/03/2024 10:56:55</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">SET</span> NAMES utf8mb4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">-- Table structure for tab_studenttwo</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_studenttwo<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_studenttwo<span class=\"token punctuation\">`</span></span>  <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'学生id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_0900_ai_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'学生名称'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>age<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'学生年龄'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> <span class=\"token operator\">=</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> <span class=\"token operator\">=</span> utf8mb4_0900_ai_ci ROW_FORMAT <span class=\"token operator\">=</span> Dynamic<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">-- Records of tab_studenttwo</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_studenttwo<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'张三'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">18</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_studenttwo<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'李四'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">19</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_studenttwo<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'王五'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>cs</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> Navicat Premium Data Transfer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> Source Server         : windows</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> Source Server Type    : MySQL</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> Source Server Version : 80028</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> Source Host           : localhost:3306</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> Source Schema         : mpj_test</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> Target Server Type    : MySQL</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> Target Server Version : 80028</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> File Encoding         : 65001</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> Date: 30/03/2024 10:56:49</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">SET</span> NAMES utf8mb4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">-- Table structure for tab_cs</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span>  <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'中间表id(查询学生与课程的关系)'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>c_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'课程表id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>s_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'学生表id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> <span class=\"token operator\">=</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> <span class=\"token operator\">=</span> utf8mb4_0900_ai_ci ROW_FORMAT <span class=\"token operator\">=</span> Dynamic<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">-- Records of tab_cs</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>可参考 sql 语句：</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">SELECT</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tts<span class=\"token punctuation\">.</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> student_name<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tts<span class=\"token punctuation\">.</span>age student_age<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\ttcs<span class=\"token punctuation\">.</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> class_name</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">FROM</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\ttab_studenttwo ts</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> tab_cs tc <span class=\"token keyword\">ON</span> tc<span class=\"token punctuation\">.</span>s_id <span class=\"token operator\">=</span> ts<span class=\"token punctuation\">.</span>id</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> tab_class tcs <span class=\"token keyword\">ON</span> tcs<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> tc<span class=\"token punctuation\">.</span>c_id</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">WHERE</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tts<span class=\"token punctuation\">.</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> <span class=\"token operator\">=</span> <span class=\"token string\">'李四'</span></pre></td></tr></table></figure><p>查询结果：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240330150505499.png\" alt=\"image-20240330150505499\"></p>\n<h2 id=\"java代码\"><a class=\"markdownIt-Anchor\" href=\"#java代码\">#</a> java 代码</h2>\n<p>vo 类：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">StudentClassVO</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> studentName<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> studentAge<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> className<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>dao:</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Mapper</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">StudenttwoDao</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">MPJBaseMapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StudenttwoEntity</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">Page</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StudentClassVO</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Page</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StudentClassVO</span><span class=\"token punctuation\">></span></span> page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>daoxml:</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span>xml version<span class=\"token operator\">=</span><span class=\"token string\">\"1.0\"</span> encoding<span class=\"token operator\">=</span><span class=\"token string\">\"UTF-8\"</span><span class=\"token operator\">?</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> mapper <span class=\"token constant\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span> <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">&lt;</span>mapper namespace<span class=\"token operator\">=</span><span class=\"token string\">\"com.dkx.mpj.dao.StudenttwoDao\"</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token operator\">&lt;</span>select id<span class=\"token operator\">=</span><span class=\"token string\">\"getAll\"</span> resultType<span class=\"token operator\">=</span><span class=\"token string\">\"com.dkx.mpj.entity.vo.StudentClassVO\"</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token constant\">SELECT</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            ts<span class=\"token punctuation\">.</span>`name` student_name<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            ts<span class=\"token punctuation\">.</span>age student_age<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            tcs<span class=\"token punctuation\">.</span>`name` class_name</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token constant\">FROM</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            tab_studenttwo ts</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token constant\">LEFT</span> <span class=\"token constant\">JOIN</span> tab_cs tc <span class=\"token constant\">ON</span> tc<span class=\"token punctuation\">.</span>s_id <span class=\"token operator\">=</span> ts<span class=\"token punctuation\">.</span>id</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token constant\">LEFT</span> <span class=\"token constant\">JOIN</span> tab_class tcs <span class=\"token constant\">ON</span> tcs<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> tc<span class=\"token punctuation\">.</span>c_id</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token constant\">WHERE</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            ts<span class=\"token punctuation\">.</span>`name` <span class=\"token operator\">=</span> <span class=\"token char\">'李四'</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>select<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>mapper<span class=\"token operator\">></span></pre></td></tr></table></figure><p>serviceImpl:</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"studenttwoService\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@AllArgsConstructor</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">StudenttwoServiceImpl</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ServiceImpl</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StudenttwoDao</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">StudenttwoEntity</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">StudenttwoService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">StudenttwoDao</span> studenttwoDao<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">PageResult</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StudentClassVO</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PageParams</span> pageParams<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">Page</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StudentClassVO</span><span class=\"token punctuation\">></span></span> page <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Page</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>pageParams<span class=\"token punctuation\">.</span><span class=\"token function\">getPageNo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> pageParams<span class=\"token punctuation\">.</span><span class=\"token function\">getPageSize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">Page</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StudentClassVO</span><span class=\"token punctuation\">></span></span> all <span class=\"token operator\">=</span> studenttwoDao<span class=\"token punctuation\">.</span><span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StudentClassVO</span><span class=\"token punctuation\">></span></span> records <span class=\"token operator\">=</span> all<span class=\"token punctuation\">.</span><span class=\"token function\">getRecords</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">long</span> total <span class=\"token operator\">=</span> all<span class=\"token punctuation\">.</span><span class=\"token function\">getTotal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PageResult</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>records<span class=\"token punctuation\">,</span> total<span class=\"token punctuation\">,</span> pageParams<span class=\"token punctuation\">.</span><span class=\"token function\">getPageNo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> pageParams<span class=\"token punctuation\">.</span><span class=\"token function\">getPageSize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>controller:</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"list\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">PageResult</span> <span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PageParams</span> pageParams<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">return</span> studenttwoService<span class=\"token punctuation\">.</span><span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span>pageParams<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>请求结果：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240330151203163.png\" alt=\"image-20240330151203163\"></p>\n",
            "tags": [
                "mybatis",
                "计算机学科",
                "案例Demo",
                "分页",
                "database"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mybatis/plus/MyBatis-plus%E7%AE%80%E4%BB%8B/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mybatis/plus/MyBatis-plus%E7%AE%80%E4%BB%8B/",
            "title": "MyBatisPlus",
            "date_published": "2024-04-02T06:23:30.099Z",
            "content_html": "<h1 id=\"mybatis-plus简介\"><a class=\"markdownIt-Anchor\" href=\"#mybatis-plus简介\">#</a> MyBatis-Plus 简介</h1>\n<ul>\n<li>\n<p>MyBatisPlus (简称 MP) 是基于 MyBatis 框架基础上开发的增强型工具，指在简化开发，提高效率</p>\n</li>\n<li>\n<p>开发方式</p>\n<ul>\n<li>基于 MyBatis 使用 MyBatisPlus</li>\n<li>基于 Spring 使用 MyBatisPlus</li>\n<li><font style=\"color:red\">基于 SpringBoot 使用 MyBatisPlus</font></li>\n</ul>\n</li>\n</ul>\n<ol>\n<li>创建新模块，选择 Spring 初始化，并配置模块相关基础信息</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-03-11-16-59-42.png\" alt=\"image_2023-03-11-16-59-42\"></p>\n<ol start=\"2\">\n<li>选择当前模块需要使用的技术集 (仅保留 JDBC)</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-03-11-17-00-30.png\" alt=\"image_2023-03-11-17-00-30\"></p>\n<ol start=\"3\">\n<li>手工添加 MyBatis-Plus 起步依赖</li>\n</ol>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.baomidou<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>mybatis-plus-boot-starter<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>3.4.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>注意事项:</strong></p>\n<p>由于 MyBatis-Plus 并未被收录到 idea 的系统内置配置，无法直接选择加入</p>\n<ol start=\"4\">\n<li>设置 Jdbc 参数 (application.yml)</li>\n</ol>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> com.alibaba.druid.pool.DruidDataSource</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">driver-class-name</span><span class=\"token punctuation\">:</span> com.mysql.cj.jdbc.Driver</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> jdbc<span class=\"token punctuation\">:</span>mysql<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span>3306/mybatisplus<span class=\"token punctuation\">?</span>characterEncoding=utf<span class=\"token punctuation\">-</span>8<span class=\"token important\">&amp;serverTimezone=UTC</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> dkx</pre></td></tr></table></figure><p><strong>注意事项:</strong></p>\n<p>如果使用 Druid 数据源，需要导入对应坐标</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>druid<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.2.8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ol start=\"5\">\n<li>制作实体类与表结构 (类名与表名对应，属性名与字段名对应，否则查询出错)</li>\n</ol>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> plus <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">primary</span> <span class=\"token keyword\">key</span> <span class=\"token keyword\">auto_increment</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>password<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>age<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token keyword\">character</span> <span class=\"token keyword\">set</span> utf8<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Plus</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span>  name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> age<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> tel<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Plus</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span> age<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> tel<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>password <span class=\"token operator\">=</span> password<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age <span class=\"token operator\">=</span> age<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>tel <span class=\"token operator\">=</span> tel<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Long</span> <span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">return</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setId</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">return</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">return</span> password<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> password<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>password <span class=\"token operator\">=</span> password<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Integer</span> <span class=\"token function\">getAge</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token keyword\">return</span> age<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setAge</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> age<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age <span class=\"token operator\">=</span> age<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getTel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token keyword\">return</span> tel<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setTel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> tel<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>tel <span class=\"token operator\">=</span> tel<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"User&#123;\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                <span class=\"token string\">\"id=\"</span> <span class=\"token operator\">+</span> id <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                <span class=\"token string\">\", name='\"</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                <span class=\"token string\">\", password='\"</span> <span class=\"token operator\">+</span> password <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                <span class=\"token string\">\", age=\"</span> <span class=\"token operator\">+</span> age <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                <span class=\"token string\">\", tel='\"</span> <span class=\"token operator\">+</span> tel <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                <span class=\"token char\">'&#125;'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"6\">\n<li>定义数据接口，继承<font style=\"color:red\"><strong>BaseMapper<Plus></strong></font></li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Mapper</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserMapper</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseMapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Plus</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"7\">\n<li>测试类中注入 dao 接口，测试功能</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootTest</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">MavenMybstisplusDemoApplicationTests</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">UserMapper</span> userMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token keyword\">void</span> <span class=\"token function\">contextLoads</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Plus</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> userMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectList</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token constant\">RUN</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token punctuation\">.</span>   ____          _            __ _ _</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> <span class=\"token operator\">/</span>\\\\ <span class=\"token operator\">/</span> ___'_ __ _ <span class=\"token function\">_</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">)</span>_ __  __ _ \\ \\ \\ \\</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">)</span>\\___ <span class=\"token operator\">|</span> <span class=\"token char\">'_ | '</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span> '_ \\<span class=\"token operator\">/</span> _` <span class=\"token operator\">|</span> \\ \\ \\ \\</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> \\\\<span class=\"token operator\">/</span>  ___<span class=\"token punctuation\">)</span><span class=\"token operator\">|</span> <span class=\"token operator\">|</span>_<span class=\"token punctuation\">)</span><span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span>  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  '  <span class=\"token operator\">|</span>____<span class=\"token operator\">|</span> <span class=\"token punctuation\">.</span>__<span class=\"token operator\">|</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span>_<span class=\"token operator\">|</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span>_\\__<span class=\"token punctuation\">,</span> <span class=\"token operator\">|</span> <span class=\"token operator\">/</span> <span class=\"token operator\">/</span> <span class=\"token operator\">/</span> <span class=\"token operator\">/</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre> <span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">|</span>_<span class=\"token operator\">|=</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">|</span>___<span class=\"token operator\">/=</span><span class=\"token operator\">/</span>_<span class=\"token operator\">/</span>_<span class=\"token operator\">/</span>_<span class=\"token operator\">/</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> <span class=\"token operator\">::</span> <span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Boot</span> <span class=\"token operator\">::</span>                <span class=\"token punctuation\">(</span>v2<span class=\"token punctuation\">.</span><span class=\"token number\">7.9</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">03</span><span class=\"token operator\">-</span><span class=\"token number\">11</span> <span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">57</span><span class=\"token operator\">:</span><span class=\"token number\">06.629</span>  <span class=\"token constant\">INFO</span> <span class=\"token number\">15900</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>           main<span class=\"token punctuation\">]</span> <span class=\"token class-name\"><span class=\"token namespace\">c<span class=\"token punctuation\">.</span>m<span class=\"token punctuation\">.</span></span>MavenMybstisplusDemoApplicationTests</span> <span class=\"token operator\">:</span> <span class=\"token class-name\">Starting</span> <span class=\"token class-name\">MavenMybstisplusDemoApplicationTests</span> using <span class=\"token class-name\">Java</span> <span class=\"token number\">11.0</span><span class=\"token number\">.16</span><span class=\"token number\">.1</span> on <span class=\"token class-name\">Administrantor</span><span class=\"token operator\">-</span><span class=\"token class-name\">Dkx</span> <span class=\"token keyword\">with</span> <span class=\"token class-name\">PID</span> <span class=\"token number\">15900</span> <span class=\"token punctuation\">(</span>started by <span class=\"token class-name\">Administrator</span> in <span class=\"token class-name\">E</span><span class=\"token operator\">:</span>\\apache<span class=\"token operator\">-</span>maven<span class=\"token operator\">-</span><span class=\"token number\">3.6</span><span class=\"token number\">.3</span>\\maven<span class=\"token operator\">-</span>work<span class=\"token operator\">-</span>space\\space02\\maven<span class=\"token operator\">-</span>mybstisplus<span class=\"token operator\">-</span>demo<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">03</span><span class=\"token operator\">-</span><span class=\"token number\">11</span> <span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">57</span><span class=\"token operator\">:</span><span class=\"token number\">06.632</span>  <span class=\"token constant\">INFO</span> <span class=\"token number\">15900</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>           main<span class=\"token punctuation\">]</span> <span class=\"token class-name\"><span class=\"token namespace\">c<span class=\"token punctuation\">.</span>m<span class=\"token punctuation\">.</span></span>MavenMybstisplusDemoApplicationTests</span> <span class=\"token operator\">:</span> <span class=\"token class-name\">No</span> active profile set<span class=\"token punctuation\">,</span> falling back <span class=\"token keyword\">to</span> <span class=\"token number\">1</span> <span class=\"token keyword\">default</span> profile<span class=\"token operator\">:</span> <span class=\"token string\">\"default\"</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre> _ _   <span class=\"token operator\">|</span>_  _ _<span class=\"token operator\">|</span>_<span class=\"token punctuation\">.</span> ___ _ <span class=\"token operator\">|</span>    _ </pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span>\\<span class=\"token operator\">/</span><span class=\"token operator\">|</span>_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span>_\\  <span class=\"token operator\">|</span>_<span class=\"token punctuation\">)</span><span class=\"token operator\">||</span>_<span class=\"token operator\">|</span>_\\ </pre></td></tr><tr><td data-num=\"24\"></td><td><pre>     <span class=\"token operator\">/</span>               <span class=\"token operator\">|</span>         </pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                        <span class=\"token number\">3.4</span><span class=\"token number\">.1</span> </pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">03</span><span class=\"token operator\">-</span><span class=\"token number\">11</span> <span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">57</span><span class=\"token operator\">:</span><span class=\"token number\">12.878</span>  <span class=\"token constant\">INFO</span> <span class=\"token number\">15900</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>           main<span class=\"token punctuation\">]</span> <span class=\"token class-name\"><span class=\"token namespace\">c<span class=\"token punctuation\">.</span>m<span class=\"token punctuation\">.</span></span>MavenMybstisplusDemoApplicationTests</span> <span class=\"token operator\">:</span> <span class=\"token class-name\">Started</span> <span class=\"token class-name\">MavenMybstisplusDemoApplicationTests</span> in <span class=\"token number\">7.705</span> seconds <span class=\"token punctuation\">(</span><span class=\"token constant\">JVM</span> running <span class=\"token keyword\">for</span> <span class=\"token number\">11.473</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">03</span><span class=\"token operator\">-</span><span class=\"token number\">11</span> <span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">57</span><span class=\"token operator\">:</span><span class=\"token number\">14.296</span>  <span class=\"token constant\">INFO</span> <span class=\"token number\">15900</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>           main<span class=\"token punctuation\">]</span> <span class=\"token class-name\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>druid<span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span></span>DruidDataSource</span>   <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>dataSource<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> inited</pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">&#123;</span>id<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token char\">'Tom'</span><span class=\"token punctuation\">,</span> password<span class=\"token operator\">=</span><span class=\"token char\">'tom'</span><span class=\"token punctuation\">,</span> age<span class=\"token operator\">=</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tel<span class=\"token operator\">=</span>'<span class=\"token number\">12987345</span>'<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">&#123;</span>id<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token char\">'Jerry'</span><span class=\"token punctuation\">,</span> password<span class=\"token operator\">=</span><span class=\"token char\">'jerry'</span><span class=\"token punctuation\">,</span> age<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> tel<span class=\"token operator\">=</span>'<span class=\"token number\">1237568324</span>'<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">&#123;</span>id<span class=\"token operator\">=</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token char\">'Jock'</span><span class=\"token punctuation\">,</span> password<span class=\"token operator\">=</span><span class=\"token char\">'123456'</span><span class=\"token punctuation\">,</span> age<span class=\"token operator\">=</span><span class=\"token number\">41</span><span class=\"token punctuation\">,</span> tel<span class=\"token operator\">=</span>'<span class=\"token number\">867862342</span>'<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">&#123;</span>id<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token char\">'小日子-刘桑'</span><span class=\"token punctuation\">,</span> password<span class=\"token operator\">=</span>'it<span class=\"token operator\">-</span>小日子<span class=\"token operator\">-</span>刘桑'<span class=\"token punctuation\">,</span> age<span class=\"token operator\">=</span><span class=\"token number\">15</span><span class=\"token punctuation\">,</span> tel<span class=\"token operator\">=</span>'<span class=\"token number\">912837893759</span>'<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">03</span><span class=\"token operator\">-</span><span class=\"token number\">11</span> <span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">57</span><span class=\"token operator\">:</span><span class=\"token number\">16.463</span>  <span class=\"token constant\">INFO</span> <span class=\"token number\">15900</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>ionShutdownHook<span class=\"token punctuation\">]</span> <span class=\"token class-name\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>druid<span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span></span>DruidDataSource</span>   <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>dataSource<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> closing <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">03</span><span class=\"token operator\">-</span><span class=\"token number\">11</span> <span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">57</span><span class=\"token operator\">:</span><span class=\"token number\">16.473</span>  <span class=\"token constant\">INFO</span> <span class=\"token number\">15900</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>ionShutdownHook<span class=\"token punctuation\">]</span> <span class=\"token class-name\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>druid<span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span></span>DruidDataSource</span>   <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>dataSource<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> closed</pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token class-name\">Process</span> finished <span class=\"token keyword\">with</span> <span class=\"token namespace\">exit</span> code <span class=\"token number\">0</span></pre></td></tr></table></figure><h2 id=\"mybatisplus特性\"><a class=\"markdownIt-Anchor\" href=\"#mybatisplus特性\">#</a> MyBatisPlus 特性</h2>\n<ul>\n<li>\n<p>无侵入：只做增强不做改变，不会对现有工程产生影响</p>\n</li>\n<li>\n<p>强大的 CRUD 操作：内置通用 Mapper, 少量配置即可实现单表 CRUD 操作</p>\n</li>\n<li>\n<p>支持 Lambda: 编写查询条件无需担心字段写错</p>\n</li>\n<li>\n<p>支持主键自动生成</p>\n</li>\n<li>\n<p>内置分页插件</p>\n</li>\n<li>\n<p>…</p>\n</li>\n</ul>\n<h3 id=\"标准数据层开发\"><a class=\"markdownIt-Anchor\" href=\"#标准数据层开发\">#</a> 标准数据层开发</h3>\n<h4 id=\"标准数据层crud功能\"><a class=\"markdownIt-Anchor\" href=\"#标准数据层crud功能\">#</a> 标准数据层 CRUD 功能</h4>\n<table>\n<thead>\n<tr>\n<th>功能</th>\n<th>自定义接口</th>\n<th>MP 接口</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>新增</td>\n<td>boolean save(T t)</td>\n<td>int insert(T t)</td>\n</tr>\n<tr>\n<td>删除</td>\n<td>boolean delete(int id)</td>\n<td>int deleteById(Serializable id)</td>\n</tr>\n<tr>\n<td>修改</td>\n<td>boolean update(T t)</td>\n<td>int updateById(T t)</td>\n</tr>\n<tr>\n<td>根据 id 查询</td>\n<td>T getById(int id)</td>\n<td>T selectById(Serializable id)</td>\n</tr>\n<tr>\n<td>查询全部</td>\n<td>List<T> getAll()</td>\n<td>List<T> selectList()</td>\n</tr>\n<tr>\n<td>分页查询</td>\n<td>PageInfo<T> getAll(int page,int size)</td>\n<td>IPage<T> selectPage(IPage<T> page)</td>\n</tr>\n<tr>\n<td>按条件查询</td>\n<td>List<T> getAll(Condition condition)</td>\n<td>IPage<T> selectPage(Wrapper<T> queryWrapper)</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>\n<p>案例</p>\n</li>\n<li>\n<p>dao</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Mapper</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserMapper</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseMapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Plus</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>domain</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Plus</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span>  name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> age<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> tel<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>启动类</li>\n</ul>\n<p>[不展示了]</p>\n<ul>\n<li>测试代码</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootTest</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">MavenMybstisplusDemoApplicationTests</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">UserMapper</span> userMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t * 添加数据</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t */</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token keyword\">void</span> <span class=\"token function\">insertTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t<span class=\"token class-name\">Plus</span> plus <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Plus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\tplus<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"大佐-刘桑\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\tplus<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"刘桑\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\tplus<span class=\"token punctuation\">.</span><span class=\"token function\">setAge</span><span class=\"token punctuation\">(</span><span class=\"token number\">123</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\tplus<span class=\"token punctuation\">.</span><span class=\"token function\">setTel</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"967487236\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t<span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> userMapper<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>plus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t<span class=\"token class-name\">String</span> msg <span class=\"token operator\">=</span> i <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"执行成功\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"执行失败\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t * 通过 id 删除数据</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t */</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token keyword\">void</span> <span class=\"token function\">deleteTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t<span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> userMapper<span class=\"token punctuation\">.</span><span class=\"token function\">deleteById</span><span class=\"token punctuation\">(</span><span class=\"token number\">1634506345139843073L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t<span class=\"token class-name\">String</span> msg <span class=\"token operator\">=</span> i <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"执行成功\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"执行失败\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t<span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t * 通过 id 修改数据</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t */</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t<span class=\"token keyword\">void</span> <span class=\"token function\">updateTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t<span class=\"token class-name\">Plus</span> plus <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Plus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\tplus<span class=\"token punctuation\">.</span><span class=\"token function\">setId</span><span class=\"token punctuation\">(</span><span class=\"token number\">1L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">//\t\tplus.setName(\"Tom666\");</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\tplus<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Tom888\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\tplus<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tom888\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\t<span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> userMapper<span class=\"token punctuation\">.</span><span class=\"token function\">updateById</span><span class=\"token punctuation\">(</span>plus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\t<span class=\"token class-name\">String</span> msg <span class=\"token operator\">=</span> i <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"执行成功\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"执行失败\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t<span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t * 通过 id 查询数据</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t */</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t<span class=\"token keyword\">void</span> <span class=\"token function\">selectByIdTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t\t<span class=\"token class-name\">Plus</span> plus <span class=\"token operator\">=</span> userMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectById</span><span class=\"token punctuation\">(</span><span class=\"token number\">1L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>plus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>\t<span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\t * 查询所有用户信息</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\t */</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\t<span class=\"token keyword\">void</span> <span class=\"token function\">selectAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>\t\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Plus</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> userMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectList</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token constant\">RUN</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>  <span class=\"token punctuation\">.</span>   ____          _            __ _ _</pre></td></tr><tr><td data-num=\"66\"></td><td><pre> <span class=\"token operator\">/</span>\\\\ <span class=\"token operator\">/</span> ___'_ __ _ <span class=\"token function\">_</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">)</span>_ __  __ _ \\ \\ \\ \\</pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">)</span>\\___ <span class=\"token operator\">|</span> <span class=\"token char\">'_ | '</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span> '_ \\<span class=\"token operator\">/</span> _` <span class=\"token operator\">|</span> \\ \\ \\ \\</pre></td></tr><tr><td data-num=\"68\"></td><td><pre> \\\\<span class=\"token operator\">/</span>  ___<span class=\"token punctuation\">)</span><span class=\"token operator\">|</span> <span class=\"token operator\">|</span>_<span class=\"token punctuation\">)</span><span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span>  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>  '  <span class=\"token operator\">|</span>____<span class=\"token operator\">|</span> <span class=\"token punctuation\">.</span>__<span class=\"token operator\">|</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span>_<span class=\"token operator\">|</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span>_\\__<span class=\"token punctuation\">,</span> <span class=\"token operator\">|</span> <span class=\"token operator\">/</span> <span class=\"token operator\">/</span> <span class=\"token operator\">/</span> <span class=\"token operator\">/</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre> <span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">|</span>_<span class=\"token operator\">|=</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">|</span>___<span class=\"token operator\">/=</span><span class=\"token operator\">/</span>_<span class=\"token operator\">/</span>_<span class=\"token operator\">/</span>_<span class=\"token operator\">/</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre> <span class=\"token operator\">::</span> <span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Boot</span> <span class=\"token operator\">::</span>                <span class=\"token punctuation\">(</span>v2<span class=\"token punctuation\">.</span><span class=\"token number\">7.9</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">03</span><span class=\"token operator\">-</span><span class=\"token number\">11</span> <span class=\"token number\">20</span><span class=\"token operator\">:</span><span class=\"token number\">26</span><span class=\"token operator\">:</span><span class=\"token number\">44.900</span>  <span class=\"token constant\">INFO</span> <span class=\"token number\">10204</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>           main<span class=\"token punctuation\">]</span> <span class=\"token class-name\"><span class=\"token namespace\">c<span class=\"token punctuation\">.</span>m<span class=\"token punctuation\">.</span></span>MavenMybstisplusDemoApplicationTests</span> <span class=\"token operator\">:</span> <span class=\"token class-name\">Starting</span> <span class=\"token class-name\">MavenMybstisplusDemoApplicationTests</span> using <span class=\"token class-name\">Java</span> <span class=\"token number\">11.0</span><span class=\"token number\">.16</span><span class=\"token number\">.1</span> on <span class=\"token class-name\">Administrantor</span><span class=\"token operator\">-</span><span class=\"token class-name\">Dkx</span> <span class=\"token keyword\">with</span> <span class=\"token class-name\">PID</span> <span class=\"token number\">10204</span> <span class=\"token punctuation\">(</span>started by <span class=\"token class-name\">Administrator</span> in <span class=\"token class-name\">E</span><span class=\"token operator\">:</span>\\apache<span class=\"token operator\">-</span>maven<span class=\"token operator\">-</span><span class=\"token number\">3.6</span><span class=\"token number\">.3</span>\\maven<span class=\"token operator\">-</span>work<span class=\"token operator\">-</span>space\\space02\\maven<span class=\"token operator\">-</span>mybstisplus<span class=\"token operator\">-</span>demo<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">03</span><span class=\"token operator\">-</span><span class=\"token number\">11</span> <span class=\"token number\">20</span><span class=\"token operator\">:</span><span class=\"token number\">26</span><span class=\"token operator\">:</span><span class=\"token number\">44.902</span>  <span class=\"token constant\">INFO</span> <span class=\"token number\">10204</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>           main<span class=\"token punctuation\">]</span> <span class=\"token class-name\"><span class=\"token namespace\">c<span class=\"token punctuation\">.</span>m<span class=\"token punctuation\">.</span></span>MavenMybstisplusDemoApplicationTests</span> <span class=\"token operator\">:</span> <span class=\"token class-name\">No</span> active profile set<span class=\"token punctuation\">,</span> falling back <span class=\"token keyword\">to</span> <span class=\"token number\">1</span> <span class=\"token keyword\">default</span> profile<span class=\"token operator\">:</span> <span class=\"token string\">\"default\"</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre> _ _   <span class=\"token operator\">|</span>_  _ _<span class=\"token operator\">|</span>_<span class=\"token punctuation\">.</span> ___ _ <span class=\"token operator\">|</span>    _ </pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span>\\<span class=\"token operator\">/</span><span class=\"token operator\">|</span>_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span>_\\  <span class=\"token operator\">|</span>_<span class=\"token punctuation\">)</span><span class=\"token operator\">||</span>_<span class=\"token operator\">|</span>_\\ </pre></td></tr><tr><td data-num=\"77\"></td><td><pre>     <span class=\"token operator\">/</span>               <span class=\"token operator\">|</span>         </pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                        <span class=\"token number\">3.4</span><span class=\"token number\">.1</span> </pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">03</span><span class=\"token operator\">-</span><span class=\"token number\">11</span> <span class=\"token number\">20</span><span class=\"token operator\">:</span><span class=\"token number\">26</span><span class=\"token operator\">:</span><span class=\"token number\">50.892</span>  <span class=\"token constant\">INFO</span> <span class=\"token number\">10204</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>           main<span class=\"token punctuation\">]</span> <span class=\"token class-name\"><span class=\"token namespace\">c<span class=\"token punctuation\">.</span>m<span class=\"token punctuation\">.</span></span>MavenMybstisplusDemoApplicationTests</span> <span class=\"token operator\">:</span> <span class=\"token class-name\">Started</span> <span class=\"token class-name\">MavenMybstisplusDemoApplicationTests</span> in <span class=\"token number\">7.226</span> seconds <span class=\"token punctuation\">(</span><span class=\"token constant\">JVM</span> running <span class=\"token keyword\">for</span> <span class=\"token number\">10.072</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">03</span><span class=\"token operator\">-</span><span class=\"token number\">11</span> <span class=\"token number\">20</span><span class=\"token operator\">:</span><span class=\"token number\">26</span><span class=\"token operator\">:</span><span class=\"token number\">52.148</span>  <span class=\"token constant\">INFO</span> <span class=\"token number\">10204</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>           main<span class=\"token punctuation\">]</span> <span class=\"token class-name\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>druid<span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span></span>DruidDataSource</span>   <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>dataSource<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> inited</pre></td></tr><tr><td data-num=\"81\"></td><td><pre><span class=\"token class-name\">Plus</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token class-name\">Tom888</span><span class=\"token punctuation\">,</span> password<span class=\"token operator\">=</span>tom888<span class=\"token punctuation\">,</span> age<span class=\"token operator\">=</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tel<span class=\"token operator\">=</span><span class=\"token number\">12987345</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token class-name\">Plus</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token class-name\">Tom888</span><span class=\"token punctuation\">,</span> password<span class=\"token operator\">=</span>tom888<span class=\"token punctuation\">,</span> age<span class=\"token operator\">=</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> tel<span class=\"token operator\">=</span><span class=\"token number\">12987345</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Plus</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token class-name\">Jerry</span><span class=\"token punctuation\">,</span> password<span class=\"token operator\">=</span>jerry<span class=\"token punctuation\">,</span> age<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> tel<span class=\"token operator\">=</span><span class=\"token number\">1237568324</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Plus</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token class-name\">Jock</span><span class=\"token punctuation\">,</span> password<span class=\"token operator\">=</span><span class=\"token number\">123456</span><span class=\"token punctuation\">,</span> age<span class=\"token operator\">=</span><span class=\"token number\">41</span><span class=\"token punctuation\">,</span> tel<span class=\"token operator\">=</span><span class=\"token number\">867862342</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Plus</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span>小日子<span class=\"token operator\">-</span>刘桑<span class=\"token punctuation\">,</span> password<span class=\"token operator\">=</span>it<span class=\"token operator\">-</span>小日子<span class=\"token operator\">-</span>刘桑<span class=\"token punctuation\">,</span> age<span class=\"token operator\">=</span><span class=\"token number\">15</span><span class=\"token punctuation\">,</span> tel<span class=\"token operator\">=</span><span class=\"token number\">912837893759</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Plus</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">1634531132654465025</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span>大佐<span class=\"token operator\">-</span>刘桑<span class=\"token punctuation\">,</span> password<span class=\"token operator\">=</span>刘桑<span class=\"token punctuation\">,</span> age<span class=\"token operator\">=</span><span class=\"token number\">123</span><span class=\"token punctuation\">,</span> tel<span class=\"token operator\">=</span><span class=\"token number\">967487236</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>执行成功</pre></td></tr><tr><td data-num=\"84\"></td><td><pre>执行成功</pre></td></tr><tr><td data-num=\"85\"></td><td><pre>执行成功</pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">03</span><span class=\"token operator\">-</span><span class=\"token number\">11</span> <span class=\"token number\">20</span><span class=\"token operator\">:</span><span class=\"token number\">26</span><span class=\"token operator\">:</span><span class=\"token number\">54.572</span>  <span class=\"token constant\">INFO</span> <span class=\"token number\">10204</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>ionShutdownHook<span class=\"token punctuation\">]</span> <span class=\"token class-name\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>druid<span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span></span>DruidDataSource</span>   <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>dataSource<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> closing <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">03</span><span class=\"token operator\">-</span><span class=\"token number\">11</span> <span class=\"token number\">20</span><span class=\"token operator\">:</span><span class=\"token number\">26</span><span class=\"token operator\">:</span><span class=\"token number\">54.582</span>  <span class=\"token constant\">INFO</span> <span class=\"token number\">10204</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>ionShutdownHook<span class=\"token punctuation\">]</span> <span class=\"token class-name\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>druid<span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span></span>DruidDataSource</span>   <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>dataSource<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> closed</pre></td></tr><tr><td data-num=\"88\"></td><td><pre></pre></td></tr><tr><td data-num=\"89\"></td><td><pre><span class=\"token class-name\">Process</span> finished <span class=\"token keyword\">with</span> <span class=\"token namespace\">exit</span> code <span class=\"token number\">0</span></pre></td></tr></table></figure><h2 id=\"service-crud-接口\"><a class=\"markdownIt-Anchor\" href=\"#service-crud-接口\">#</a> Service CRUD 接口</h2>\n<p>文档入口：<a href=\"https://baomidou.com/pages/49cc81/#service-crud-%E6%8E%A5%E5%8F%A3\">https://baomidou.com/pages/49cc81/#service-crud - 接口</a></p>\n<p>介绍入口：<a href=\"https://blog.csdn.net/qq_44869121/article/details/124297999\">https://blog.csdn.net/qq_44869121/article/details/124297999</a></p>\n<blockquote>\n<p><span alt='solid'>说明</span>：</p>\n<ul>\n<li>通用 Service CRUD 封装 IService 接口，进一步封装 CRUD 采用  <code>get</code>  查询  <code>remove</code>  删除  <code>list</code>  查询集合  <code>page</code>  分页 前缀命名方式区分  <code>Mapper</code>  层避免混淆</li>\n<li>泛型  <code>T</code>  为任意实体对象</li>\n<li>建议如果存在自定义通用 service 方法的可能，请创建自己的 <code>IBaseService</code>  继承 <code>Mybatis-plus</code>  提供的基类</li>\n<li>对象 <code>Wrapper</code>  为 条件构造器</li>\n</ul>\n</blockquote>\n<p><strong>使用方式</strong>：</p>\n<ol>\n<li>\n<p>在 service 接口类中集成 IService &lt;实体类&gt;</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dkx<span class=\"token punctuation\">.</span>system<span class=\"token punctuation\">.</span>service</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>atguigu<span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span>system<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SysRole</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>baomidou<span class=\"token punctuation\">.</span>mybatisplus<span class=\"token punctuation\">.</span>extension<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IService</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">SysRoleService</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">IService</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SysRole</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>在 serviceImpl 实现类中集成 ServiceImpl 并实现 service 接口类</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dkx<span class=\"token punctuation\">.</span>system<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">.</span>impl</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>atguigu<span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span>system<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SysRole</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>baomidou<span class=\"token punctuation\">.</span>mybatisplus<span class=\"token punctuation\">.</span>extension<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">.</span>impl<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServiceImpl</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dkx<span class=\"token punctuation\">.</span>system<span class=\"token punctuation\">.</span>mapper<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SysRoleMapper</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dkx<span class=\"token punctuation\">.</span>system<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SysRoleService</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Service</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SysRoleServiceImpl</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ServiceImpl</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SysRoleMapper</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SysRole</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">SysRoleService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ol>\n<center>图片解释</center>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202309041113608.png\" alt=\"image-20230904111312304\"></p>\n<p>测试代码：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dkx<span class=\"token punctuation\">.</span>system</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>atguigu<span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span>system<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SysRole</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dkx<span class=\"token punctuation\">.</span>system<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SysRoleService</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>junit<span class=\"token punctuation\">.</span>jupiter<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Test</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Autowired</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>test<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SpringBootTest</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootTest</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SysRoleServiceTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">SysRoleService</span> sysRoleService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> testList <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SysRole</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> sysRoleService<span class=\"token punctuation\">.</span><span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SysRole</span> item <span class=\"token operator\">:</span> list<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>结果：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202309041114047.png\" alt=\"image-20230904111430807\"></p>\n<p>具体里面的一些操作的 CRUD 方法看官方文档。</p>\n",
            "tags": [
                "mybatis",
                "计算机学科",
                "database"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mybatis/orm/orm/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mybatis/orm/orm/",
            "title": "MyBatis-ORM",
            "date_published": "2024-04-02T06:23:30.093Z",
            "content_html": "<h1 id=\"mybatis什么是orm对象关系映射\"><a class=\"markdownIt-Anchor\" href=\"#mybatis什么是orm对象关系映射\">#</a> MyBatis 什么是 ORM (对象关系映射)</h1>\n<h2 id=\"一-什么是orm\"><a class=\"markdownIt-Anchor\" href=\"#一-什么是orm\">#</a> 一，什么是 ORM</h2>\n<p>对象关系映射 (Object Relational Mapping), 简称 ORM , 模式是一种<mark>为了解决面向对象与关系数据库存在的互补匹配的现象技术</mark></p>\n<hr>\n<p>怎么理解上面的那句话呢？</p>\n<p>在 Java 中我们使用 String 表示字符串，而 Oracle 中可以使用 varchar2,MySQL 中可以使用 varchar,SQLserver 可以使用 nvarchar, 完成对象与<font style=\"color:red\"><strong>关系数据库</strong></font>之间的映射时，我们往往需要手动转换，如下:</p>\n<p>代码 1:</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 将执行的 sql</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"select id, name, password from user\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 创建命令对象</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>preparedStatement <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">prepareStatement</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// 执行并获得结果集</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>resultSet <span class=\"token operator\">=</span> preparedStatement<span class=\"token punctuation\">.</span><span class=\"token function\">executeQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// 遍历结果集，将数据库中的数据转换成 Java 中的对象</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>resultSet<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token class-name\">String</span> name <span class=\"token operator\">=</span> resultSet<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token keyword\">int</span> id <span class=\"token operator\">=</span> resultSet<span class=\"token punctuation\">.</span><span class=\"token function\">getInt</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token class-name\">String</span> password <span class=\"token operator\">=</span> resultSet<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token class-name\">User</span> entity<span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span>id<span class=\"token punctuation\">,</span>age<span class=\"token punctuation\">,</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token class-name\">Users</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>entity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>很明显，这些代码是重复的且不好维护的，ORM 的出现是的上述的过程可以自动化</p>\n<h2 id=\"二-mybatis中orm的体现\"><a class=\"markdownIt-Anchor\" href=\"#二-mybatis中orm的体现\">#</a> 二，MyBatis 中 ORM 的体现</h2>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-03-18-20-17-19.png\" alt=\"image_2023-03-18-20-17-19\"></p>\n<p>简单的说，<mark>ORM 是通过使用描述对象和数据之间映射的元数据，将程序中的对象自动持久化到关系数据库中</mark></p>\n<hr>\n<p>在 MyBatis 中体现就是我们常说的 &quot;结果集映射&quot;, 可以说是一种半自动化的 ORM, 因为必须要自己写 sql</p>\n<p>代码 2:</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">&lt;</span>select id<span class=\"token operator\">=</span><span class=\"token string\">\"selUserByID\"</span> resultType<span class=\"token operator\">=</span><span class=\"token string\">\"stdpei.pojo.User\"</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        select id <span class=\"token punctuation\">,</span>name<span class=\"token punctuation\">,</span> passwd as pwd from `user` </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>select<span class=\"token operator\">></span></pre></td></tr></table></figure><p><font style=\"color:red\"><strong>代码 2</strong></font>就可以取代<font style=\"color:red\"><strong>代码 1</strong></font>, 这就是 MyBatis 给我们提供的 ORM, 不需要我们去写结果集的映射，当然要保证 User 中的属性名和 user 中的字段名相同，才可以 [^ 不相同也有其解决方式]</p>\n<hr>\n<p>由于 ORM 可以<strong>自动对 Entity 对象与数据库中的 Table 进行</strong><font style=\"color:red\"><strong>字段</strong></font><strong>与</strong><font style=\"color:red\"><strong>属性的映射</strong></font>, 所以我们实际可能已经<strong>不需要一个专用的，庞大的数据访问层</strong></p>\n<p>ORM 提供了对数据库的映射，不用 sql 直接编码，<strong> 能够像操作对象一样从数据库获取数据</strong></p>\n<h2 id=\"三-核心原则\"><a class=\"markdownIt-Anchor\" href=\"#三-核心原则\">#</a> 三，核心原则</h2>\n<ul>\n<li>\n<p><strong>简单：以最基本的形式建模数据</strong></p>\n</li>\n<li>\n<p><strong>传达性：数据库结构被任何人都能理解的语言文档化</strong></p>\n</li>\n<li>\n<p><strong>准确性：基于数据模型创建正确标准化了的结构</strong></p>\n</li>\n</ul>\n<h2 id=\"四-orm的优缺点\"><a class=\"markdownIt-Anchor\" href=\"#四-orm的优缺点\">#</a> 四，ORM 的优缺点</h2>\n<ol>\n<li><strong>会牺牲程序的执行效率</strong></li>\n</ol>\n<p>因为 ORM 是在原本的基础上加了一层，数据完全的面向对象，我们都知道，实现业务需求所经历的层数越多，那么效率就往往越低</p>\n<ol start=\"2\">\n<li><strong>固定思维模式</strong></li>\n</ol>\n<p>对于 &quot;框架&quot; 而言，往往都是 &quot;约定大于配置&quot;, 因为是通过配置文件实现的业务逻辑，所以个性化操作往往很受限制，我们要遵循设计者的思维模式</p>\n<ol start=\"3\">\n<li><strong>存在一般都有性能问题</strong></li>\n</ol>\n<p>在对对象做持久化时，ORM 一般会持久化所有的属性，如果用上了 ORM, 程序员很有可能将全部的数据提取到内存对象中，然后再进行过滤和加工处理，这样就容易产生性能问题</p>\n<h2 id=\"五-总结\"><a class=\"markdownIt-Anchor\" href=\"#五-总结\">#</a> 五，总结</h2>\n<p>数据库中的一张表，往往对应着面向对象中的一个实体类.</p>\n<p>在没有 ORM 时，我们需要手动写一些数据库中的字段与实体类中的属性的映射关系，这个操作是重复且不好维护的.</p>\n<p>ORM 出现之后，我们就省去了手动写映射关系的代码，我们只需要注重实体类以及 sql 语句的即可.</p>\n",
            "tags": [
                "mybatis",
                "计算机学科",
                "database",
                "ORM"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mybatis/mybatisplus-join/%E5%9F%BA%E6%9C%AC%E6%9F%A5%E8%AF%A2%E4%BD%BF%E7%94%A8/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mybatis/mybatisplus-join/%E5%9F%BA%E6%9C%AC%E6%9F%A5%E8%AF%A2%E4%BD%BF%E7%94%A8/",
            "title": "MyBatis-Plus-基本查询使用",
            "date_published": "2024-04-02T06:23:30.085Z",
            "content_html": "<h1 id=\"mybatis-plus-基本查询使用\"><a class=\"markdownIt-Anchor\" href=\"#mybatis-plus-基本查询使用\">#</a> MyBatis-Plus - 基本查询使用</h1>\n<p>创建数据库：</p>\n<p>student</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> Navicat Premium Data Transfer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> Source Server         : windows</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> Source Server Type    : MySQL</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> Source Server Version : 80028</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> Source Host           : localhost:3306</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> Source Schema         : mpj_test</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> Target Server Type    : MySQL</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> Target Server Version : 80028</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> File Encoding         : 65001</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> Date: 30/03/2024 09:50:08</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">SET</span> NAMES utf8mb4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">-- Table structure for tab_student</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_student<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_student<span class=\"token punctuation\">`</span></span>  <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'学生id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>teacher_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_0900_ai_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'学生名称'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>age<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'学生年龄'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>sex<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_0900_ai_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'学生性别'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> <span class=\"token operator\">=</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> <span class=\"token operator\">=</span> utf8mb4_0900_ai_ci ROW_FORMAT <span class=\"token operator\">=</span> Dynamic<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\">-- Records of tab_student</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_student<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'张三'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">18</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'男'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_student<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'李四'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'男'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_student<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'王五'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">14</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'男'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>teacher</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> Navicat Premium Data Transfer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> Source Server         : windows</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> Source Server Type    : MySQL</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> Source Server Version : 80028</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> Source Host           : localhost:3306</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> Source Schema         : mpj_test</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> Target Server Type    : MySQL</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> Target Server Version : 80028</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> File Encoding         : 65001</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> Date: 30/03/2024 09:50:16</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">SET</span> NAMES utf8mb4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">-- Table structure for tab_teacher</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_teacher<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_teacher<span class=\"token punctuation\">`</span></span>  <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'老师id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_0900_ai_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'老师名称'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>age<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'老师年龄'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>sex<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_0900_ai_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'老师性别'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> <span class=\"token operator\">=</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> <span class=\"token operator\">=</span> utf8mb4_0900_ai_ci ROW_FORMAT <span class=\"token operator\">=</span> Dynamic<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">-- Records of tab_teacher</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_teacher<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'小郭'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">19</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'男'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>创建对应的 VO 类</p>\n<p>工程结构：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240330095229805.png\" alt=\"image-20240330095229805\"></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">StudentVO</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> teacherId<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">TeacherEntity</span> teacher<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> sex<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">StudentVO1</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> studentId<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> teacherId<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> studentName<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> teacherName<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> studentSex<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> teacherSex<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TeacherVO</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> students<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> sex<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TeacherVO1</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StudentEntity</span><span class=\"token punctuation\">></span></span> students<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> sex<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"一对一-字段\"><a class=\"markdownIt-Anchor\" href=\"#一对一-字段\">#</a> 一对一 (字段)</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StudentVO1</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getSAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 实例化 MPJLambdaWrapper</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">MPJLambdaWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StudentEntity</span><span class=\"token punctuation\">></span></span> wrapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MPJLambdaWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 左连接联表查询，根据 teacher 的 id 和 student 的 teacher_id 进行联表查询</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TeacherEntity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TeacherEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getId</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">StudentEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getTeacherId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// 查询指定字段并设置别名 因为，数据的字段名都一样而我需要再 VO 类里面进行区别并查询出来</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectAs</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StudentEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getId</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"studentId\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectAs</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TeacherEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getId</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"teacherId\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectAs</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StudentEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getName</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"studentName\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectAs</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TeacherEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getName</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"teacherName\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectAs</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StudentEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getSex</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"studentSex\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectAs</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TeacherEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getSex</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"teacherSex\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token comment\">// 查询结果返回到 VO1 类</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token keyword\">return</span> studentDao<span class=\"token punctuation\">.</span><span class=\"token function\">selectJoinList</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StudentVO1</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> wrapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>打印结果</p>\n<pre><code>StudentVO1(studentId=1, teacherId=1, studentName=张三, teacherName=小郭, studentSex=男, teacherSex=男)\nStudentVO1(studentId=2, teacherId=1, studentName=李四, teacherName=小郭, studentSex=男, teacherSex=男)\nStudentVO1(studentId=3, teacherId=1, studentName=王五, teacherName=小郭, studentSex=男, teacherSex=男)\n</code></pre>\n<h2 id=\"一对一-对象\"><a class=\"markdownIt-Anchor\" href=\"#一对一-对象\">#</a> 一对一 (对象)</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StudentVO</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 实例化 MPJLambdaWrapper</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">MPJLambdaWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StudentEntity</span><span class=\"token punctuation\">></span></span> wrapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MPJLambdaWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 左连接联表查询 根据 teacher 的 id 和 student 的 teacher_id 来进行联查</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TeacherEntity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TeacherEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getId</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">StudentEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getTeacherId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// 查询 student 的所有字段的数据</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectAll</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StudentEntity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token comment\">// 查询 teacher 表用 StudentVO 中的 teacher 类来进行属性字段的关联</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectAssociation</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TeacherEntity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">StudentVO</span><span class=\"token operator\">::</span><span class=\"token function\">getTeacher</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token comment\">// 查询结果返回到 StudentVO 类中</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token keyword\">return</span> studentDao<span class=\"token punctuation\">.</span><span class=\"token function\">selectJoinList</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StudentVO</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> wrapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>打印结果：</p>\n<pre><code>StudentVO(id=1, teacherId=1, teacher=TeacherEntity(id=1, name=小郭, age=19, sex=男), name=张三, sex=男)\nStudentVO(id=2, teacherId=1, teacher=TeacherEntity(id=1, name=小郭, age=19, sex=男), name=李四, sex=男)\nStudentVO(id=3, teacherId=1, teacher=TeacherEntity(id=1, name=小郭, age=19, sex=男), name=王五, sex=男)\n</code></pre>\n<h2 id=\"一对多-字段\"><a class=\"markdownIt-Anchor\" href=\"#一对多-字段\">#</a> 一对多 (字段)</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TeacherVO</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 实例化 MPJLambdaWrapper</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">MPJLambdaWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TeacherEntity</span><span class=\"token punctuation\">></span></span> wrapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MPJLambdaWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 左连接链表查询 根据 teacher 的 id 和 student 的 id 进行联表查询</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StudentEntity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">StudentEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getTeacherId</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TeacherEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// 查询 teacher 的所有字段数据</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectAll</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TeacherEntity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token comment\">// 查询的结果返回的是 List 集合，而且通过 map.result 进行映射下结果 只要学生名称 如数据：[张三，李四，王五]</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectCollection</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StudentEntity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TeacherVO</span><span class=\"token operator\">::</span><span class=\"token function\">getStudents</span><span class=\"token punctuation\">,</span> map <span class=\"token operator\">-></span> map<span class=\"token punctuation\">.</span><span class=\"token function\">result</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StudentEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getName</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token comment\">// 返回查询结果到 VO 类</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token keyword\">return</span> teacherDao<span class=\"token punctuation\">.</span><span class=\"token function\">selectJoinList</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TeacherVO</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> wrapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>打印结果：</p>\n<pre><code>TeacherVO(id=1, students=[王五, 李四, 张三], name=小郭, sex=男)\n</code></pre>\n<h2 id=\"一对多-对象\"><a class=\"markdownIt-Anchor\" href=\"#一对多-对象\">#</a> 一对多 (对象)</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TeacherVO1</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 实例化 MPJLambdaWrapper</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">MPJLambdaWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TeacherEntity</span><span class=\"token punctuation\">></span></span> wrapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MPJLambdaWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 左连接联表查询，根据 teacher 的 id 和 student 的 teacher_id 进行联表查询</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StudentEntity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">StudentEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getTeacherId</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TeacherEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// 查询 teacher 的所有字段数据</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectAll</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TeacherEntity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token comment\">// 这里只是少了 map 去映射返回的结果，而我们这次得到的是多个对象</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectCollection</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StudentEntity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TeacherVO1</span><span class=\"token operator\">::</span><span class=\"token function\">getStudents</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token comment\">// 返回查询结果到 VO1 类</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token keyword\">return</span> teacherDao<span class=\"token punctuation\">.</span><span class=\"token function\">selectJoinList</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TeacherVO1</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> wrapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>打印结果：</p>\n<pre><code>TeacherVO1(id=1, students=[StudentEntity(id=3, teacherId=1, name=王五, age=14, sex=男), StudentEntity(id=2, teacherId=1, name=李四, age=20, sex=男), StudentEntity(id=1, teacherId=1, name=张三, age=18, sex=男)], name=小郭, sex=男)\n</code></pre>\n<h2 id=\"多对多查询\"><a class=\"markdownIt-Anchor\" href=\"#多对多查询\">#</a> 多对多查询</h2>\n<p>数据库表：</p>\n<p>class</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> Navicat Premium Data Transfer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> Source Server         : windows</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> Source Server Type    : MySQL</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> Source Server Version : 80028</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> Source Host           : localhost:3306</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> Source Schema         : mpj_test</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> Target Server Type    : MySQL</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> Target Server Version : 80028</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> File Encoding         : 65001</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> Date: 30/03/2024 10:56:43</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">SET</span> NAMES utf8mb4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">-- Table structure for tab_class</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span>  <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'课程表id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_0900_ai_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'课程名称'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> <span class=\"token operator\">=</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> <span class=\"token operator\">=</span> utf8mb4_0900_ai_ci ROW_FORMAT <span class=\"token operator\">=</span> Dynamic<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">-- Records of tab_class</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'数学'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'语文'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'英语'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'化学'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'生物'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'物理'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'政治'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'历史'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_class<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'地理'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>student</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> Navicat Premium Data Transfer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> Source Server         : windows</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> Source Server Type    : MySQL</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> Source Server Version : 80028</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> Source Host           : localhost:3306</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> Source Schema         : mpj_test</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> Target Server Type    : MySQL</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> Target Server Version : 80028</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> File Encoding         : 65001</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> Date: 30/03/2024 10:56:55</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">SET</span> NAMES utf8mb4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">-- Table structure for tab_studenttwo</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_studenttwo<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_studenttwo<span class=\"token punctuation\">`</span></span>  <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'学生id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_0900_ai_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'学生名称'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>age<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'学生年龄'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> <span class=\"token operator\">=</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> <span class=\"token operator\">=</span> utf8mb4_0900_ai_ci ROW_FORMAT <span class=\"token operator\">=</span> Dynamic<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">-- Records of tab_studenttwo</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_studenttwo<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'张三'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">18</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_studenttwo<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'李四'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">19</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_studenttwo<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'王五'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>cs</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> Navicat Premium Data Transfer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> Source Server         : windows</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> Source Server Type    : MySQL</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> Source Server Version : 80028</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> Source Host           : localhost:3306</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> Source Schema         : mpj_test</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> Target Server Type    : MySQL</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> Target Server Version : 80028</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> File Encoding         : 65001</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> Date: 30/03/2024 10:56:49</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">SET</span> NAMES utf8mb4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">-- Table structure for tab_cs</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span>  <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'中间表id(查询学生与课程的关系)'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>c_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'课程表id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>s_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'学生表id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> <span class=\"token operator\">=</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> <span class=\"token operator\">=</span> utf8mb4_0900_ai_ci ROW_FORMAT <span class=\"token operator\">=</span> Dynamic<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">-- Records of tab_cs</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tab_cs<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>联查参考 sql 语句：</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">SELECT</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tts<span class=\"token punctuation\">.</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> student_name<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tts<span class=\"token punctuation\">.</span>age student_age<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\ttcs<span class=\"token punctuation\">.</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> class_name</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">FROM</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\ttab_studenttwo ts</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> tab_cs tc <span class=\"token keyword\">ON</span> tc<span class=\"token punctuation\">.</span>s_id <span class=\"token operator\">=</span> ts<span class=\"token punctuation\">.</span>id</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> tab_class tcs <span class=\"token keyword\">ON</span> tcs<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> tc<span class=\"token punctuation\">.</span>c_id</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">WHERE</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tts<span class=\"token punctuation\">.</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> <span class=\"token operator\">=</span> <span class=\"token string\">'王五'</span></pre></td></tr></table></figure><p>查询结果：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240330105633348.png\" alt=\"image-20240330105633348\"></p>\n<h3 id=\"java代码\"><a class=\"markdownIt-Anchor\" href=\"#java代码\">#</a> java 代码</h3>\n<p>vo 类:</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">StudentClassVO</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> studentName<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> studentAge<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> className<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>serviceImpl:</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StudentClassVO</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">MPJLambdaWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StudenttwoEntity</span><span class=\"token punctuation\">></span></span> wrapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MPJLambdaWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CsEntity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CsEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getSId</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">StudenttwoEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ClassEntity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ClassEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getId</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CsEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getCId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectAs</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StudenttwoEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getName</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"studentName\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectAs</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StudenttwoEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getAge</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"studentAge\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectAs</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ClassEntity</span><span class=\"token operator\">::</span><span class=\"token function\">getName</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"className\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token keyword\">return</span> studenttwoDao<span class=\"token punctuation\">.</span><span class=\"token function\">selectJoinList</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StudentClassVO</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> wrapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>查询结果：</p>\n<pre><code>StudentClassVO(studentName=张三, studentAge=18, className=英语)\nStudentClassVO(studentName=张三, studentAge=18, className=语文)\nStudentClassVO(studentName=张三, studentAge=18, className=数学)\nStudentClassVO(studentName=李四, studentAge=19, className=化学)\nStudentClassVO(studentName=李四, studentAge=19, className=英语)\nStudentClassVO(studentName=李四, studentAge=19, className=语文)\nStudentClassVO(studentName=李四, studentAge=19, className=数学)\nStudentClassVO(studentName=王五, studentAge=20, className=物理)\nStudentClassVO(studentName=王五, studentAge=20, className=数学)\n</code></pre>\n",
            "tags": [
                "mybatis",
                "计算机学科",
                "database",
                "mybatisplus-join"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mybatis/%E5%9F%BA%E7%A1%80/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mybatis/%E5%9F%BA%E7%A1%80/",
            "title": "MyBatis基础",
            "date_published": "2024-04-02T06:23:30.077Z",
            "content_html": "<h1 id=\"mybatis\"><a class=\"markdownIt-Anchor\" href=\"#mybatis\">#</a> MyBatis</h1>\n<h2 id=\"简介\"><a class=\"markdownIt-Anchor\" href=\"#简介\">#</a> 简介</h2>\n<p>MyBatis 本是 <code>apache</code>  的一个开源项目<font style=\"color:blue\">iBatis</font>,2010 年这个项目由 <code>apache software foundation</code>  迁移到了 <code>google code</code>  , 并且改名为 <code>MyBatis</code></p>\n<ul>\n<li>2013 年 11 月迁移到<strong> Github</strong></li>\n</ul>\n<p>iBatis 一词来源于 &quot;internet&quot; 和 &quot;abatis&quot; 的组合，是一个基于 <code>java</code>  的持久层框架，iBatis 提供的持久层框架包括 SQL Maps 和 Data Access Objects (DAOs)</p>\n<h3 id=\"如何获取mybatis\"><a class=\"markdownIt-Anchor\" href=\"#如何获取mybatis\">#</a> 如何获取 MyBatis</h3>\n<ol>\n<li>maven</li>\n</ol>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.mybatis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>mybatis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>3.5.11<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ol start=\"2\">\n<li>github</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-12-20-37-09_20230224205354.png\" alt=\"image_2023-02-12-20-37-09\"></p>\n<p>github 地址:<a href=\"https://github.com/mybatis/mybatis-3/releases\"> 点击查看</a></p>\n<ol start=\"3\">\n<li>中文文档地址:<a href=\"https://mybatis.net.cn/\"> 点击查看</a></li>\n</ol>\n<h3 id=\"什么是mybatis\"><a class=\"markdownIt-Anchor\" href=\"#什么是mybatis\">#</a> 什么是 MyBatis</h3>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-12-17-24-01_20230224205410.png\" alt=\"image_2023-02-12-17-24-01\"></p>\n<ul>\n<li>\n<p>MyBatis 是一款优秀的<strong>持久层框架</strong></p>\n</li>\n<li>\n<p>它支持自定义 SQL、存储过程以及高级映射。</p>\n</li>\n<li>\n<p>MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。</p>\n</li>\n</ul>\n<p>MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。</p>\n<p>关键问题：什么是持久层</p>\n<h3 id=\"mybatis特性\"><a class=\"markdownIt-Anchor\" href=\"#mybatis特性\">#</a> MyBatis 特性</h3>\n<ol>\n<li>\n<p>MyBatis 是支持定化 SQL, 存储过程以及高级映射的优秀的持久层框架</p>\n</li>\n<li>\n<p>MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集</p>\n</li>\n<li>\n<p>MyBatis 可以使用简单的 XML 或注解用于配置和原始映射，将接口和 java 的 POJO (Plain Old Java Objects, 普通的 java 对象) 映射成数据库中的记录</p>\n</li>\n<li>\n<p>MyBatis 是一个半自动的 ORM (Object Relation Mapping) 框架</p>\n</li>\n</ol>\n<p><a href=\"https://pigpigletsgo.github.io/computer-science/database/mybatis/orm/orm/\">查看 orm 详解</a></p>\n<h3 id=\"和其它持久化层技术对比\"><a class=\"markdownIt-Anchor\" href=\"#和其它持久化层技术对比\">#</a> 和其它持久化层技术对比</h3>\n<ul>\n<li>\n<p>JDBC</p>\n<ul>\n<li>SQL 夹杂在 java 代码中耦合度高，导致硬编码内伤</li>\n<li>维护不易且实际开发需求中 SQL 有变化，频繁修改的情况多见</li>\n<li>代码冗长，开发效率低</li>\n</ul>\n</li>\n<li>\n<p>Hibernate 和 JPA</p>\n<ul>\n<li>操作简单，开发效率高</li>\n<li>程序中的长难复杂 SQL 需要绕过框架</li>\n<li>内部自动产生的 SQL, 不容易做特殊优化</li>\n<li>基于全映射的全自动框架，大量字段的 POJO 进行部分映射比较困难</li>\n<li>反射操作太多，导致数据库性能下降</li>\n</ul>\n</li>\n<li>\n<p>MyBatis</p>\n<ul>\n<li>轻量级，性能出色</li>\n<li>SQL 和 java 编码分开，功能边界清晰，java 代码专注业务，SQL 语句专注数据</li>\n<li>开发效率稍逊于 HIbernate, 但是完全能够接受</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"持久层\"><a class=\"markdownIt-Anchor\" href=\"#持久层\">#</a> 持久层</h4>\n<p><mark>数据持久化</mark></p>\n<p>持久化就是将程序的数据在持久状态和瞬时状态转化的过程</p>\n<ul>\n<li>\n<p>什么是持久状态：将数据持久性存储，比如：数据库 (Jdbc),io 文件持久化</p>\n</li>\n<li>\n<p>什么是瞬时状态：比如 内存:<font style=\"color:red\">断电即失</font></p>\n</li>\n<li>\n<p>生活中的持久化：冷藏，罐头 吃的时候取出来不吃的时候冻上不坏吃的时候在解冻吃</p>\n</li>\n</ul>\n<p><mark>持久层</mark></p>\n<p>Dao 层，Service 层，Controller 层 …</p>\n<ul>\n<li>\n<p>完成持久化工作的代码块</p>\n</li>\n<li>\n<p>层界限十分明显</p>\n</li>\n</ul>\n<p><mark>为什么需要 MyBatis</mark></p>\n<ul>\n<li>\n<p>帮助程序员将数据存入到数据库中</p>\n</li>\n<li>\n<p>方便</p>\n</li>\n<li>\n<p>传统的 JDBC 代码太复杂了，简化，框架，自动化</p>\n</li>\n<li>\n<p>优点:</p>\n<ul>\n<li>简单易学</li>\n<li>灵活</li>\n<li>sql 和代码的分离，提高了可维护性</li>\n<li>提供映射标签，支持对象与数据库的 orm 字段关系映射</li>\n<li>提供对象关系映射标签，支持对象关系组建维护</li>\n<li>提供 xml 标签，支持编写动态 sql</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"第一个mybatis程序\"><a class=\"markdownIt-Anchor\" href=\"#第一个mybatis程序\">#</a> 第一个 MyBatis 程序</h3>\n<p>思路：搭建环境 --&gt; 导入 MyBatis --&gt; 编写代码 --&gt; 测试！</p>\n<h4 id=\"搭建环境\"><a class=\"markdownIt-Anchor\" href=\"#搭建环境\">#</a> 搭建环境</h4>\n<p><strong>搭建数据库</strong></p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#MyBatis</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token keyword\">database</span> mybatis<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">use</span> mybatis<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> <span class=\"token keyword\">user</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">default</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>pwd<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">default</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">primary</span> <span class=\"token keyword\">key</span> ar<span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">engine</span><span class=\"token operator\">=</span><span class=\"token keyword\">innodb</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> <span class=\"token keyword\">user</span> <span class=\"token keyword\">values</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">'张三'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'123'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token string\">'李四'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'321'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token string\">'刘桑'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'456'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>新建 maven 项目</strong></p>\n<p>创建父子工程</p>\n<p>执行命令创建父工程</p>\n<ul>\n<li>mvn archetype:generate</li>\n</ul>\n<p>将该工程改为父工程，该配置文件中的 packaging 为 pom</p>\n<ul>\n<li>父工程</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>xsi</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2001/XMLSchema-instance<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>schemaLocation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modelVersion</span><span class=\"token punctuation\">></span></span>4.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modelVersion</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.dkx.mybatis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>maven-mybatis-fu<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.0-SNAPSHOT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>packaging</span><span class=\"token punctuation\">></span></span>pom<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>packaging</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>maven-mybatis-fu<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>url</span><span class=\"token punctuation\">></span></span>http://maven.apache.org<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>url</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project.build.sourceEncoding</span><span class=\"token punctuation\">></span></span>UTF-8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project.build.sourceEncoding</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencyManagement</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>mysql<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>mysql-connector-java<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>8.0.28<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.mybatis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>mybatis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>3.5.6<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencyManagement</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modules</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>module</span><span class=\"token punctuation\">></span></span>maven-mybatis-zi<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>module</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modules</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>创建子工程，在父工程的 pom 目录下，执行命令</p>\n<ul>\n<li>mvn archetype:generate</li>\n</ul>\n<p>创建好后父子工程的配置文件会自动配置好父子的配置标签</p>\n<ul>\n<li>子工程</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>schemaLocation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>xsi</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2001/XMLSchema-instance<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modelVersion</span><span class=\"token punctuation\">></span></span>4.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modelVersion</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.dkx.mybatis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>maven-mybatis-fu<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.0-SNAPSHOT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.dkx.mybatis01<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>maven-mybatis-zi<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.0-SNAPSHOT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>maven-mybatis-zi<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>url</span><span class=\"token punctuation\">></span></span>http://maven.apache.org<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>url</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project.build.sourceEncoding</span><span class=\"token punctuation\">></span></span>UTF-8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project.build.sourceEncoding</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.mybatis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>mybatis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>mysql<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>mysql-connector-java<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>junit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>junit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>4.12<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>在 main 目录同级的 resources 目录下创建配置文件:mybatis-config.xml</li>\n</ul>\n<p>配置内容如下:</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Config 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-config.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environments</span> <span class=\"token attr-name\">default</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environment</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>transactionManager</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JDBC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataSource</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POOLED<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>driver<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.mysql.cj.jdbc.Driver<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>jdbc:mysql://localhost:3306/mybatis?characterEncoding=utf-8<span class=\"token entity named-entity\" title=\"&amp;\">&amp;amp;</span>serverTimezone=UTC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>root<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dkx<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataSource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environments</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>在 Idea 上连接上数据库</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-14-11-58-18_20230224205440.png\" alt=\"image_2023-02-14-11-58-18\"></p>\n<ul>\n<li>测试连接成功后</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-14-12-02-54_20230224205455.png\" alt=\"image_2023-02-14-12-02-54\"></p>\n<ul>\n<li>展示全部的数据库，这个也可以连接好后 OK 然后在设置</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-14-12-04-14_20230224205510.png\" alt=\"image_2023-02-14-12-04-14\"></p>\n<ul>\n<li>或者只显示 mybatis 数据库 (自动创建好的)</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-14-12-05-49_20230224205528.png\" alt=\"image_2023-02-14-12-05-49\"></p>\n<p>如果因为时区连接不上则设置</p>\n<p>serverTimezone:Hongkong</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-14-11-56-51_20230224205543.png\" alt=\"image_2023-02-14-11-56-51\"></p>\n<p>将配置文件的信息写全</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Config 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-config.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">&lt;!--configuration 核心配置文件 --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environments</span> <span class=\"token attr-name\">default</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environment</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>transactionManager</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JDBC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataSource</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POOLED<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>driver<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.mysql.cj.jdbc.Driver<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>jdbc:mysql://localhost:3306/mybatis?characterEncoding=utf-8<span class=\"token entity named-entity\" title=\"&amp;\">&amp;amp;</span>serverTimezone=UTC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>root<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dkx<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataSource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environments</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h4 id=\"编写mybatis工具类\"><a class=\"markdownIt-Anchor\" href=\"#编写mybatis工具类\">#</a> 编写 MyBatis 工具类</h4>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dkx<span class=\"token punctuation\">.</span>mybatis<span class=\"token punctuation\">.</span>util</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>ibatis<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Resources</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>ibatis<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SqlSession</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>ibatis<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SqlSessionFactory</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>ibatis<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SqlSessionFactoryBuilder</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InputStream</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @2023/2/1414:20</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * @function</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * @comment</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> * sqlsessionfactory --> sqlsession</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MybatisUtils</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">SqlSessionFactory</span> sqlsessionfactory<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">static</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">//            使用 MyBatis 第一步，获取 SqlSessionFactory 对象</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token class-name\">String</span> resource <span class=\"token operator\">=</span> <span class=\"token string\">\"mybatis-config.xml\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token class-name\">InputStream</span> inputStream <span class=\"token operator\">=</span> <span class=\"token class-name\">Resources</span><span class=\"token punctuation\">.</span><span class=\"token function\">getResourceAsStream</span><span class=\"token punctuation\">(</span>resource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            sqlsessionfactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SqlSessionFactoryBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span>inputStream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">//    既然有了 sqlSessionFactory, 顾名思义，我们就可以从中获得 SqlSession 的实例了</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">//    SqlSession 完全包含了面向数据库执行，SQL 命令所需的所有方法</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">SqlSession</span> <span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">return</span> sqlsessionfactory<span class=\"token punctuation\">.</span><span class=\"token function\">openSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"编写代码\"><a class=\"markdownIt-Anchor\" href=\"#编写代码\">#</a> 编写代码</h4>\n<ul>\n<li>实体类</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dkx<span class=\"token punctuation\">.</span>mybatis<span class=\"token punctuation\">.</span>pojo</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @2023/2/1414:39</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * @function</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * @comment</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> pwd<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> pwd<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pwd <span class=\"token operator\">=</span> pwd<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Integer</span> <span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">return</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setId</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">return</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getPwd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token keyword\">return</span> pwd<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setPwd</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> pwd<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pwd <span class=\"token operator\">=</span> pwd<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"User&#123;\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token string\">\"id=\"</span> <span class=\"token operator\">+</span> id <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token string\">\", name='\"</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token string\">\", pwd='\"</span> <span class=\"token operator\">+</span> pwd <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token char\">'&#125;'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>Dao 接口</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dkx<span class=\"token punctuation\">.</span>mybatis<span class=\"token punctuation\">.</span>dao</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dkx<span class=\"token punctuation\">.</span>mybatis<span class=\"token punctuation\">.</span>pojo<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">User</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * @2023/2/1414:46</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * @function</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @comment</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserDao</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getUserList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>接口实现类</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dkx<span class=\"token punctuation\">.</span>mybatis<span class=\"token punctuation\">.</span>dao<span class=\"token punctuation\">.</span>impl</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dkx<span class=\"token punctuation\">.</span>mybatis<span class=\"token punctuation\">.</span>dao<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">UserDao</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dkx<span class=\"token punctuation\">.</span>mybatis<span class=\"token punctuation\">.</span>pojo<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">User</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * @2023/2/1414:48</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @function</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @comment</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserDaoImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserDao</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getUserList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>这是之前我们常写的写法，但是用 MyBatis 就不需要了，因为：MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集</p>\n<p>我们需要创建一个配置文件</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-14-15-10-02_20230224205605.png\" alt=\"image_2023-02-14-15-10-02\"></p>\n<ul>\n<li>使用 Mapper 配置文件来实现 UserDaoImpl 类的编写</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">mapper</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">&lt;!--namespace 绑定一个对应的 Dao (mapper) 接口 --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.dao.UserDao<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">&lt;!-- id: 重写 UserDao 接口的抽象方法 resultType: 返回类型通过反射找到 --></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getUserList<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.pojo.User<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 查询 sql 语句 --></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        select * from mybatis.user;</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h4 id=\"测试\"><a class=\"markdownIt-Anchor\" href=\"#测试\">#</a> 测试</h4>\n<p>测试的项目目录和正常工程目录要一致，规范</p>\n<ul>\n<li>注意点:org.apache.ibatis.binding.BindingException: Type interface com.dkx.mybatis01.dao.UserDao is not known to the MapperRegistry.</li>\n</ul>\n<p>翻译:</p>\n<p>org.apache.ibatis.binding.BindingException： 接口类型 com.dkx.mybatis01.dao.UserDao 不被 MapperRegistry 所知。</p>\n<p>解决方案:</p>\n<ul>\n<li>main 同级目录下的 resources 目录中的配置文件:mybatis-config.xml\n<ul>\n<li>原因：缺少了 mappers 配置标签</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Config 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-config.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environments</span> <span class=\"token attr-name\">default</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environment</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>transactionManager</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JDBC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataSource</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POOLED<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>driver<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.mysql.cj.jdbc.Driver<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>jdbc:mysql://localhost:3306/mybatis?characterEncoding=utf-8<span class=\"token entity named-entity\" title=\"&amp;\">&amp;amp;</span>serverTimezone=UTC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>root<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dkx<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataSource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environments</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">&lt;!--    每一个 Mapper.XML 都需要在 MyBatis 核心配置文件中注册！--></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com/dkx/mybatis/dao/UserDaoMapper.xml<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>报错:</p>\n<pre><code>java.lang.ExceptionInInitializerError\n\tat com.dkx.mybatis01.util.MybatisUtilsTest.test(MybatisUtilsTest.java:21)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n\tat org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)\n\tat org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)\n\tat org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)\n\tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)\n\tat org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)\n\tat org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)\n\tat org.junit.runners.ParentRunner.run(ParentRunner.java:363)\n\tat org.junit.runner.JUnitCore.run(JUnitCore.java:137)\n\tat com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)\n\tat com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:33)\n\tat com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:230)\n\tat com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:58)\nCaused by: java.lang.RuntimeException: org.apache.ibatis.exceptions.PersistenceException: \n### Error building SqlSession.\n### The error may exist in com/dkx/mybatis01/dao/UserMapper.xml\n### Cause: org.apache.ibatis.builder.BuilderException: Error parsing SQL Mapper Configuration. Cause: java.io.IOException: Could not find resource com/dkx/mybatis01/dao/UserMapper.xml\n\tat com.dkx.mybatis01.util.MybatisUtils.&lt;clinit&gt;(MybatisUtils.java:26)\n\t... 23 more\nCaused by: org.apache.ibatis.exceptions.PersistenceException: \n### Error building SqlSession.\n### The error may exist in com/dkx/mybatis01/dao/UserMapper.xml\n### Cause: org.apache.ibatis.builder.BuilderException: Error parsing SQL Mapper Configuration. Cause: java.io.IOException: Could not find resource com/dkx/mybatis01/dao/UserMapper.xml\n\tat org.apache.ibatis.exceptions.ExceptionFactory.wrapException(ExceptionFactory.java:30)\n\tat org.apache.ibatis.session.SqlSessionFactoryBuilder.build(SqlSessionFactoryBuilder.java:80)\n\tat org.apache.ibatis.session.SqlSessionFactoryBuilder.build(SqlSessionFactoryBuilder.java:64)\n\tat com.dkx.mybatis01.util.MybatisUtils.&lt;clinit&gt;(MybatisUtils.java:24)\n\t... 23 more\nCaused by: org.apache.ibatis.builder.BuilderException: Error parsing SQL Mapper Configuration. Cause: java.io.IOException: Could not find resource com/dkx/mybatis01/dao/UserMapper.xml\n\tat org.apache.ibatis.builder.xml.XMLConfigBuilder.parseConfiguration(XMLConfigBuilder.java:122)\n\tat org.apache.ibatis.builder.xml.XMLConfigBuilder.parse(XMLConfigBuilder.java:99)\n\tat org.apache.ibatis.session.SqlSessionFactoryBuilder.build(SqlSessionFactoryBuilder.java:78)\n\t... 25 more\nCaused by: java.io.IOException: Could not find resource com/dkx/mybatis01/dao/UserMapper.xml\n\tat org.apache.ibatis.io.Resources.getResourceAsStream(Resources.java:114)\n\tat org.apache.ibatis.io.Resources.getResourceAsStream(Resources.java:100)\n\tat org.apache.ibatis.builder.xml.XMLConfigBuilder.mapperElement(XMLConfigBuilder.java:375)\n\tat org.apache.ibatis.builder.xml.XMLConfigBuilder.parseConfiguration(XMLConfigBuilder.java:120)\n\t... 27 more\n</code></pre>\n<p>解决方案:</p>\n<p>maven 由于它的约定大于配置，我们之后可能遇到我们写的配置文件，无法被导出或者生效的问题，解决方案</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- 在 build 中配置 resources, 来防止我们资源导出失败的问题 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>build</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resources</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>directory</span><span class=\"token punctuation\">></span></span>src/main/resources<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>directory</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>includes</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>include</span><span class=\"token punctuation\">></span></span>**/*.properties<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>include</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>include</span><span class=\"token punctuation\">></span></span>**/*.xml<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>include</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>includes</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>filtering</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>filtering</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>directory</span><span class=\"token punctuation\">></span></span>src/main/java<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>directory</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>includes</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>include</span><span class=\"token punctuation\">></span></span>**/*.properties<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>include</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>include</span><span class=\"token punctuation\">></span></span>**/*.xml<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>include</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>includes</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>filtering</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>filtering</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resources</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>build</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h4 id=\"mapperregistry是什么\"><a class=\"markdownIt-Anchor\" href=\"#mapperregistry是什么\">#</a> MapperRegistry 是什么</h4>\n<p>核心配置文件中注册 mappers</p>\n<h3 id=\"队命名空间的一点补充\"><a class=\"markdownIt-Anchor\" href=\"#队命名空间的一点补充\">#</a> 队命名空间的一点补充</h3>\n<p>在之前版本的 MyBatis 中，<strong> 命名空间 (Namespaces)</strong> 的作用并不大，是可选的，但是现在，随着命名空间越发重要，你必须指定命名空间</p>\n<p>命名空间的作用有两个，一个是利用更长的全限定名来将不同的语句隔离开来，同时也实现了你上面见到的接口绑定，就算你觉得暂时用不到接口绑定，你也应该遵循这里的规定，以防哪天你改变了注意，长远来看，只要将命名空间置于适合的 java 包命名空间之中，你的代码会变得更加整洁，也有利于你更方便地使用 MyBatis</p>\n<p><strong>命名解析:</strong> 为了减少输入量，MyBatis 对所有具有名称的配置元素 (包括语句，结果映射，缓存等) 使用如下的命名解析规则</p>\n<ul>\n<li>\n<p>全限定名 (比如 “com.mypackage.MyMapper.selectAllThings”) 将被直接用于查找及使用</p>\n</li>\n<li>\n<p>短名称 (比如 “selectAllThings”) 如果全局唯一也可以作为一个单独的引用，有两个或两个以上的相同名称 (比如 &quot;com.foo.selectAllThings&quot; 和 &quot;com.bar.selectAllThings&quot;), 那么使用时就会产生 &quot;短名称不唯一&quot; 的错误，这种情况下必须使用全限定名</p>\n</li>\n</ul>\n<h3 id=\"作用域scope和生命周期\"><a class=\"markdownIt-Anchor\" href=\"#作用域scope和生命周期\">#</a> 作用域 (Scope) 和生命周期</h3>\n<p>理解我们之前讨论的不同作用域和生命周期类别是至关重要的，因为错误的使用会导致非常<font style=\"color:red\">严重</font>的<strong>并发问题</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-16-12-39-35_20230224205630.png\" alt=\"image_2023-02-16-12-39-35\"></p>\n<p><code>提示</code>  <strong>对象生命周期和依赖注入框架</strong></p>\n<blockquote>\n<p>依赖注入框架可以创建线程安全的，基于事务的 SqlSession 和映射器，并将它们直接注入到你的 bean 中，因此可以直接忽略它们的生命周期，如果对如何通过依赖注入框架使用 MyBatis 感兴趣，可以研究一个 MyBatis-Spring 或 MyBatis-Guice 两个子项目</p>\n</blockquote>\n<p><strong>SqlSessionFactoryBuilder</strong></p>\n<blockquote>\n<p>这里类可以被实例化，使用和丢弃，一旦创建了 SqlSessionFactory, 就不再需要它了，因此 SqlSessionFactory 实例的最佳作用域是方法作用域 (也就是局部方法变量) , 你可以重用 SqlSessionFactoryBuilder 来创建多个 SqlSessionFactory 实例，但最好还是不要一直保留着它，以保证所有的 XML 解析资源可以被释放给更重要的事情</p>\n</blockquote>\n<ul>\n<li>\n<p>一旦创建了 SqlSessionFctory, 就不再需要它了</p>\n</li>\n<li>\n<p>局部变量</p>\n</li>\n</ul>\n<p><strong>SqlSessionFactory</strong></p>\n<blockquote>\n<p>SqlSessionFactory 一旦被创建就应该在运行期间一直存在，没有任何理由丢弃它或重新创建另一个实例，使用 SqlSessionFactory 的最佳实践是在应用运行期间不要重复创建多次，多次重建 SqlSessionFactory 被视为一种代码 &quot;坏习惯&quot;, 因此 SqlSessionFactory 的最佳作用域是应用作用域，有很多方法可以做到，最简单的就是使用单列模式或者静态单列模式</p>\n</blockquote>\n<ul>\n<li>\n<p>说白了就是可以想象为：数据库连接池</p>\n</li>\n<li>\n<p>SqlSessionFactory 一旦被创建就应该在应用的运行期间一直存在，<strong> 没有任何理由丢弃它或重新创建另一个实例</strong></p>\n</li>\n<li>\n<p>因此 SqlSessionFactory 的最佳作用域是应用作用域</p>\n</li>\n<li>\n<p>最简单的就是<strong>单例模式</strong> 或者<strong>静态单例模式</strong></p>\n</li>\n</ul>\n<p><strong>SqlSession</strong></p>\n<blockquote>\n<p>每个线程都应该有它自己的 SqlSession 实例，SqlSession 的实例不是线程安全的，因此的是不能被共享的，所以它的最佳的作用域是请求或方法作用域，绝对不能将 SqlSession 实例的引用放在一个类的静态域，甚至一个类的实例变量也不行，也绝不能将 SqlSession 实例的应用放在任何类型的托管作用域中，比如 Server 框架中的 HttpSession, 如果你现在正在使用一种 WEB 框架，考虑将 SqlSession 放在一个和 HTTP 请求相似的作用域中，换句话说，每次收到 HTTP 请求，就可以打开一个 SqlSession, 返回一个响应后，就关闭它，这个关闭操作很重要，为了确保每次都执能执行关闭操作，你应该把这个关闭操作放到 finally 块中</p>\n</blockquote>\n<ul>\n<li>\n<p>连接到连接池的一个请求！</p>\n</li>\n<li>\n<p>SqlSession 的实例不是线程安全的，因此是不能被共享的，所以它的最佳的作用域是请求或方法作用域</p>\n</li>\n<li>\n<p>用完之后需要关闭，否则资源被占用</p>\n</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20230216130724127_20230224205650.png\" alt=\"image-20230216130724127\"></p>\n<p>这里面每一个 Mapper 就代表一个具体的业务</p>\n<p>下面的实例就是一个确保 SqlSession 关闭的标准模式:</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">try</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SqlSession</span> session <span class=\"token operator\">=</span> sqlSessionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">openSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token comment\">// 你的应用逻辑代码</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>在所有代码中都遵循这种使用模式，可以保证所有数据资源都能被正确地关闭</p>\n<h2 id=\"增删改查crud实现\"><a class=\"markdownIt-Anchor\" href=\"#增删改查crud实现\">#</a> 增删改查 (CRUD) 实现</h2>\n<h4 id=\"namespace\"><a class=\"markdownIt-Anchor\" href=\"#namespace\">#</a> namespace</h4>\n<p>namespace 中的包名要和 Dao/mapper 接口的包名一致</p>\n<h4 id=\"select\"><a class=\"markdownIt-Anchor\" href=\"#select\">#</a> select</h4>\n<p>选择，查询语句:</p>\n<ul>\n<li>\n<p>id: 就是对应的 namespace 中的方法名</p>\n</li>\n<li>\n<p>resultType:Sql 语句执行的返回值</p>\n</li>\n<li>\n<p>parameterType: 参数类型</p>\n</li>\n<li>\n<p>查询表的 count 的时候需要返回值 Integer 否则会报错</p>\n</li>\n</ul>\n<p><strong>工具类</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MybatisUtils</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">SqlSessionFactory</span> sqlsessionfactory<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">static</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token class-name\">String</span> resource <span class=\"token operator\">=</span> <span class=\"token string\">\"mybatis-config.xml\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token class-name\">InputStream</span> inputStream <span class=\"token operator\">=</span> <span class=\"token class-name\">Resources</span><span class=\"token punctuation\">.</span><span class=\"token function\">getResourceAsStream</span><span class=\"token punctuation\">(</span>resource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            sqlsessionfactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SqlSessionFactoryBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span>inputStream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">SqlSession</span> <span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">return</span> sqlsessionfactory<span class=\"token punctuation\">.</span><span class=\"token function\">openSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><font style=\"color:red\"><strong>主要提示：增删改的操作需要 commit 提交事务否则不会发生变化</strong></font></p>\n<p>SqlSession.commit();</p>\n<ol>\n<li>编写接口</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserDao</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//    查询所有用户</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getUserList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">//    根据 id 查询用户</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">User</span> <span class=\"token function\">getUserById</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">//    添加数据</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">int</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">//    修改数据</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">int</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">//    删除数据</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">int</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"2\">\n<li>编写对应的 mapper 中 sql 语句</li>\n</ol>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">mapper</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">&lt;!--namespace 绑定一个对应的 Dao (mapper) 接口 --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.dao.UserDao<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">&lt;!-- id: 重写 UserDao 接口的抽象方法 resultType: 返回类型通过反射找到 --></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getUserList<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.pojo.User<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 查询 sql 语句 --></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        select * from mybatis.user;</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getUserById<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>int<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.pojo.User<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        select * from mybatis.user where id = #&#123;id&#125;;</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">&lt;!--    对象中的属性可以直接取出来 --></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>insert</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>add<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.pojo.User<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        insert into mybatis.user (id,name,pwd) values(#&#123;id&#125;,#&#123;name&#125;,#&#123;pwd&#125;);</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>insert</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>update</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>update<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.pojo.User<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        update mybatis.user set pwd = #&#123;pwd&#125;,name = #&#123;name&#125; where id = #&#123;id&#125;;</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>update</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>delete</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>delete<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>int<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        delete from mybatis.user where id = #&#123;id&#125;;</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>delete</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ol start=\"3\">\n<li>测试</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserDaoTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">SqlSession</span> sqlSession <span class=\"token operator\">=</span> <span class=\"token class-name\">MybatisUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">//        更加简洁，清晰，类型安全的方式</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">//        推荐方式</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">UserDao</span> userdao <span class=\"token operator\">=</span> sqlSession<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserDao</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> userdao<span class=\"token punctuation\">.</span><span class=\"token function\">getUserList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> i<span class=\"token operator\">:</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">//        旧方式</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>         <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> list1 <span class=\"token operator\">=</span> sqlSession<span class=\"token punctuation\">.</span><span class=\"token function\">selectList</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"com.dkx.mybatis.dao.UserDao.getUserList\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>         <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> i<span class=\"token operator\">:</span>list1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>             <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token class-name\">SqlSession</span> sqlsession <span class=\"token operator\">=</span> <span class=\"token class-name\">MybatisUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">UserDao</span> userdao <span class=\"token operator\">=</span> sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserDao</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">User</span> list <span class=\"token operator\">=</span> userdao<span class=\"token punctuation\">.</span><span class=\"token function\">getUserById</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token class-name\">SqlSession</span> sqlsession <span class=\"token operator\">=</span> <span class=\"token class-name\">MybatisUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token class-name\">UserDao</span> userdao <span class=\"token operator\">=</span> sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserDao</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> userdao<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"李四\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"321\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"提交成功\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>         <span class=\"token class-name\">SqlSession</span> sqlsession <span class=\"token operator\">=</span> <span class=\"token class-name\">MybatisUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>         <span class=\"token class-name\">UserDao</span> u <span class=\"token operator\">=</span> sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserDao</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>         <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> u<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"张四\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"321\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"修改成功！！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test4</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token class-name\">SqlSession</span> sqlsession <span class=\"token operator\">=</span> <span class=\"token class-name\">MybatisUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token class-name\">UserDao</span> u <span class=\"token operator\">=</span> sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserDao</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> u<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"删除成功！！！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>mapper 中的 sql 语句</p>\n<p><strong>select 查询所有用户</strong></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getUserList<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.pojo.User<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 查询 sql 语句 --></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        select * from mybatis.user;</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>select id 根据 id 查询用户</strong></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getUserById<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>int<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.pojo.User<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        select * from mybatis.user where id = #&#123;id&#125;;</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>insert 添加数据</strong></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>insert</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>add<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.pojo.User<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        insert into mybatis.user (id,name,pwd) values(#&#123;id&#125;,#&#123;name&#125;,#&#123;pwd&#125;);</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>insert</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>update 更改数据</strong></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>update</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>update<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.pojo.User<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        update mybatis.user set pwd = #&#123;pwd&#125;,name = #&#123;name&#125; where id = #&#123;id&#125;;</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>       //或者</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        update mybatis.user set name = #&#123;name&#125; where id = #&#123;id&#125;;</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>update</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>delete 删除数据</strong></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>delete</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>delete<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>int<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        delete from mybatis.user where id = #&#123;id&#125;;</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>delete</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><font style=\"color:red\"><strong>注意点：再次提醒</strong> </font></p>\n<ul>\n<li>增删改  需要提交事务，调用 SqlSession 对象点 commit ();</li>\n</ul>\n<h4 id=\"map\"><a class=\"markdownIt-Anchor\" href=\"#map\">#</a> Map</h4>\n<p>假设，我们的实体类，或者数据库中的表，字段或者参数过多，我们应当考虑使用 Map</p>\n<ul>\n<li>接口</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserDao</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//    map 添加数据</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> <span class=\"token function\">addUsermap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>mapper.xml</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--    对象中的属性，可以直接取出来  传递 map 的 key--></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>insert</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>addUsermap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>map<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>#         map可以只列出我们想要操作的字段出来进行操作</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        insert into mybatis.user (id,pwd) values (#&#123;userId&#125;,#&#123;userPwd&#125;);</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>insert</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>测试类</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test5</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">SqlSession</span> sqlsession <span class=\"token operator\">=</span> <span class=\"token class-name\">MybatisUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">UserDao</span> userdao <span class=\"token operator\">=</span> sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserDao</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> m <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        m<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"userId\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        m<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"userPwd\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">333</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        userdao<span class=\"token punctuation\">.</span><span class=\"token function\">addUsermap</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Map 传递参数，直接在 sql 中取出 key 即可  [parameterType=“map”]</p>\n<p>对象传递参数，直接在 sql 中取对象的属性即可    [parameterType=“map”]</p>\n<p>只有一个基本类型参数的情况下，可以直接在 sql 中取到</p>\n<p>传送门<a href=\"https://pigpigletsgo.github.io/computer-science/database/mybatis/%E4%BB%A3%E7%A0%81%E6%A1%88%E4%BE%8B/1/\">点击</a></p>\n<p>多个参数用 Map, 或者注解</p>\n<p>传送门<a href=\"https://pigpigletsgo.github.io/computer-science/database/mybatis/%E4%BB%A3%E7%A0%81%E6%A1%88%E4%BE%8B/2/\">点击</a></p>\n<h4 id=\"like模糊查询\"><a class=\"markdownIt-Anchor\" href=\"#like模糊查询\">#</a> Like (模糊查询)</h4>\n<ol>\n<li>java 代码执行的时候，传递通配符 % %</li>\n</ol>\n<ul>\n<li>接口</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//    模糊查询</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getUserLike</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>UserMapper.xml</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--    模糊查询 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getUserLike<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.pojo.User<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        select * from mybatis.user where name like #&#123;name&#125;;</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>测试类</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test7</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">SqlSession</span> sqlsession <span class=\"token operator\">=</span> <span class=\"token class-name\">MybatisUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">UserDao</span> u <span class=\"token operator\">=</span> sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserDao</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> u<span class=\"token punctuation\">.</span><span class=\"token function\">getUserLike</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"李%\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> i <span class=\"token operator\">:</span> list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"配置解析\"><a class=\"markdownIt-Anchor\" href=\"#配置解析\">#</a> 配置解析</h2>\n<h4 id=\"1核心配置文件\"><a class=\"markdownIt-Anchor\" href=\"#1核心配置文件\">#</a> 1. 核心配置文件</h4>\n<ul>\n<li>\n<p>mybatis-config.xml (名字可随意起，官方建议为其名)</p>\n</li>\n<li>\n<p>mybatis 的配置文件包含了会深深影响 mybatis 行为的设置和属性信息</p>\n</li>\n</ul>\n<pre><code>configuration（配置）\nproperties（属性）\nsettings（设置）\ntypeAliases（类型别名）\ntypeHandlers（类型处理器）\nobjectFactory（对象工厂）\nplugins（插件）\nenvironments（环境配置）\nenvironment（环境变量）\ntransactionManager（事务管理器）\ndataSource（数据源）\ndatabaseIdProvider（数据库厂商标识）\nmappers（映射器）\n</code></pre>\n<h4 id=\"环境变量environments\"><a class=\"markdownIt-Anchor\" href=\"#环境变量environments\">#</a> 环境变量 (environments)</h4>\n<p>MyBatis 可以配置成适应多种环境，这种机制有助于将 SQL 映射应用于多种数据库之中，实现情况下有多种理由需要这么做，例如，开发，测试和生产环境需要有不同的配置，或者想在具有相同 Schema 的多个生产数据库中使用相同的 SQL 映射，还有许多类似的使用场景</p>\n<p><strong>不过要记住：尽管可以配置多个环境，但每个 SqlSessionFactory 实例只能选择一种环境</strong></p>\n<p>所以，如果你想连接两个数据库，就需要创建两个 SqlSessionFactory 实例，每个数据库对应一个，而如果十三个数据库，就需要三个实例，以此类推，记起来很简单；</p>\n<ul>\n<li><strong>每个数据库对应一个 SqlSessionFactory</strong> 实例</li>\n</ul>\n<p>为了指定创建哪种环境，只要将它作为可选的参数传递给 SqlSessionFactoryBuilder 即可</p>\n<p>具体看中文官方文档</p>\n<p>学会使用配置多套运行环境</p>\n<p>MyBatis 默认的事务管理器是：JDBC, 连接池：POOLED</p>\n<h4 id=\"属性properties\"><a class=\"markdownIt-Anchor\" href=\"#属性properties\">#</a> 属性 (properties)</h4>\n<p>我们可以通过 properties 属性来实现引用配置文件</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Config 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-config.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">&lt;!--    引用外部配置文件资源 --></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span> <span class=\"token attr-name\">resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>druid.properties<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>root<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">&lt;!-- 可以在 properties 中不写密码然后在 mapper.xml 中写也是可以的但是不能都不写 --></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dkx<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environments</span> <span class=\"token attr-name\">default</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environment</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>transactionManager</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JDBC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataSource</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POOLED<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>driver<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;driver&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;jdbcUrl&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;username&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;password&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataSource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environments</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token comment\">&lt;!--    每一个 Mapper.XML 都需要在 MyBatis 核心配置文件中注册！--></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com/dkx/mybatis/dao/UserDaoMapper.xml<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>这些属性都是可外部配置且可动态替换的，即可以在典型的 java 属性文件中配置，亦可通过 properties 元素的子元素来传递.[db.properties]</p>\n<p>编写一个 (properties) 配置文件</p>\n<p>druid.properties</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key attr-name\">driverClassName</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">com.mysql.cj.jdbc.Driver</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key attr-name\">url</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">jdbc:mysql://localhost:3306/day14?characterEncoding=utf-8&amp;serverTimezone=UTC</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key attr-name\">username</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">root</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key attr-name\">password</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">dkx</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key attr-name\">initialSize</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">10</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key attr-name\">minIdle</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">5</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key attr-name\">maxActive</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">20</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key attr-name\">maxWait</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">5000</span></pre></td></tr></table></figure><ul>\n<li>报错解析</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-16-09-47-50_20230224205726.png\" alt=\"image_2023-02-16-09-47-50\"></p>\n<p>在 xml 中，所有的标签都是可以规定其顺序的</p>\n<p>报错信息:</p>\n<pre><code>The content of element type &quot;configuration&quot; must match &quot;(properties?,settings?,typeAliases?,typeHandlers?,objectFactory?,objectWrapperFactory?,reflectorFactory?,plugins?,environments?,databaseIdProvider?,mappers?)&quot;.\n</code></pre>\n<p>翻译:</p>\n<pre><code>元素类型“configuration”的内容必须匹配“（属性？，设置？，类型别名？，类型处理程序？，对象工厂？，对象包装器工厂？，反射器工厂？，插件？，环境？，databaseIdProvider？，映射器？）”。\n</code></pre>\n<ul>\n<li>细节</li>\n</ul>\n<p>问题:properties 和 mapper.xml 里面都配置密码会优先走谁</p>\n<p>properties</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key attr-name\">driver</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">com.mysql.cj.jdbc.Driver</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key attr-name\">jdbcUrl</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">jdbc:mysql://localhost:3306/mybatis?characterEncoding=utf-8&amp;serverTimezone=UTC</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key attr-name\">password</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">dkx</span></pre></td></tr></table></figure><p>mapper.xml</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Config 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-config.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">&lt;!--    引用外部配置文件资源 --></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span> <span class=\"token attr-name\">resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>druid.properties<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>root<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">&lt;!--        错误密码 --></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>123dkx<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environments</span> <span class=\"token attr-name\">default</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environment</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>transactionManager</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JDBC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataSource</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POOLED<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>driver<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;driver&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;jdbcUrl&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;username&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;password&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataSource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environments</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token comment\">&lt;!--    每一个 Mapper.XML 都需要在 MyBatis 核心配置文件中注册！--></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com/dkx/mybatis/dao/UserDaoMapper.xml<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>运行结果</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-16-10-01-08_20230224205746.png\" alt=\"image_2023-02-16-10-01-08\"></p>\n<p>得出结论：优先走 properties 配置文件</p>\n<p><strong>测试另一种结果</strong></p>\n<p>将 properties 中 的密码改为错误的将 mapper.xml 中的密码改为正确的测试</p>\n<ul>\n<li>properties</li>\n</ul>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key attr-name\">driver</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">com.mysql.cj.jdbc.Driver</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key attr-name\">jdbcUrl</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">jdbc:mysql://localhost:3306/mybatis?characterEncoding=utf-8&amp;serverTimezone=UTC</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key attr-name\">password</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">123dkx</span></pre></td></tr></table></figure><ul>\n<li>mapper.xml</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Config 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-config.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">&lt;!--    引用外部配置文件资源 --></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span> <span class=\"token attr-name\">resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>druid.properties<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>root<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">&lt;!--        错误密码 --></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dkx<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environments</span> <span class=\"token attr-name\">default</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environment</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>transactionManager</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JDBC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataSource</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POOLED<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>driver<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;driver&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;jdbcUrl&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;username&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;password&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataSource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environments</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token comment\">&lt;!--    每一个 Mapper.XML 都需要在 MyBatis 核心配置文件中注册！--></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com/dkx/mybatis/dao/UserDaoMapper.xml<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>运行结果</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-16-10-04-09_20230224205804.png\" alt=\"image_2023-02-16-10-04-09\"></p>\n<p>将 properties 中的密码删除就只能走 mapper.xml 运行就会成功</p>\n<ul>\n<li>\n<p>可以直接引入外部文件</p>\n</li>\n<li>\n<p>可以在其中增加一些属性配置</p>\n</li>\n<li>\n<p>如果两个文件有同一个字段，优先使用外部配置文件</p>\n</li>\n</ul>\n<h4 id=\"类型别名typealiases\"><a class=\"markdownIt-Anchor\" href=\"#类型别名typealiases\">#</a> 类型别名 (typeAliases)</h4>\n<p>类型别名可为 java 类型设置一个缩写名称，它仅用于 xml 配置，意在降低冗余的全限定类名写</p>\n<ul>\n<li>\n<p>类型别名是为 java 类型设置一个短的名字</p>\n</li>\n<li>\n<p>存在的意义仅在于也用来减少类完全限定名的冗余</p>\n</li>\n</ul>\n<p>例如：</p>\n<ul>\n<li>实体类起别名</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--    给实体类起别名 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>typeAlias</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.pojo.User<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alias</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>User<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>\n<p>也可以指定一个包名，MyBatis 会在包名下面搜索需要的 Java Bean</p>\n</li>\n<li>\n<p>扫描实体类的包，它的默认别名就为这个类的 类名，首字母小写</p>\n</li>\n<li>\n<p>通过包起类别名</p>\n</li>\n</ul>\n<p>mybatis-config.xml</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--    通过包给实体类起别名，类名首字母小写 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>package</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.pojo<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>mapper.xml</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--    mybatis-config.xml 中配置了 com.dkx.mybatis.pojo 的包我们可以使用类名首字母小写来使用 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getUserList<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>user<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 查询 sql 语句 --></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        select * from mybatis.user;</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>测试</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-16-10-57-23_20230224205822.png\" alt=\"image_2023-02-16-10-57-23\"></p>\n<p><strong>演示</strong></p>\n<ul>\n<li>\n<p>mybatis-config.xml 配置文件</p>\n</li>\n<li>\n<p>typeAliases 必须写在第二行中</p>\n</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Config 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-config.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">&lt;!--    引用外部配置文件资源 --></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span> <span class=\"token attr-name\">resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>druid.properties<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>root<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">&lt;!--        错误密码 --></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dkx<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">&lt;!--    给实体类起别名 --></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>typeAlias</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.pojo.User<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alias</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>User<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environments</span> <span class=\"token attr-name\">default</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environment</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>transactionManager</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JDBC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataSource</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POOLED<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>driver<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;driver&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;jdbcUrl&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;username&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;password&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataSource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environments</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token comment\">&lt;!--    每一个 Mapper.XML 都需要在 MyBatis 核心配置文件中注册！--></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com/dkx/mybatis/dao/UserDaoMapper.xml<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>mapper.xml</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">mapper</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">&lt;!--namespace 绑定一个对应的 Dao (mapper) 接口 --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.dao.UserDaoMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">&lt;!-- id: 重写 UserDao 接口的抽象方法 resultType: 返回类型通过反射找到 --></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">&lt;!--   mybatis-config.xml 中已经配置了 com.dkx.mybatis.pojo.User 的别名我们可以直接使用别名 User--></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getUserList<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>User<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 查询 sql 语句 --></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        select * from mybatis.user;</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>测试类</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserDaoTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">SqlSession</span> sqlSession <span class=\"token operator\">=</span> <span class=\"token class-name\">MybatisUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">//        更加简洁，清晰，类型安全的方式</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">//        推荐方式</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">UserDaoMapper</span> userdao <span class=\"token operator\">=</span> sqlSession<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserDaoMapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> userdao<span class=\"token punctuation\">.</span><span class=\"token function\">getUserList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> i<span class=\"token operator\">:</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>运行结果</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-16-10-45-31_20230224205844.png\" alt=\"image_2023-02-16-10-45-31\"></p>\n<blockquote>\n<p>在实体类比较少的时候，使用第一种方式<br>如果实体类比较多，建议使用第二种</p>\n</blockquote>\n<p>区别:</p>\n<p>第一种可以 DIY (自定义)</p>\n<h4 id=\"使用注解方式\"><a class=\"markdownIt-Anchor\" href=\"#使用注解方式\">#</a> 使用注解方式</h4>\n<p>在实体类上加注解:@Alias (“别名”)</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-16-11-02-59_20230224205902.png\" alt=\"image_2023-02-16-11-02-59\"></p>\n<p>优先大于配置文件运行测试</p>\n<p>配置文件</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">mapper</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">&lt;!--namespace 绑定一个对应的 Dao (mapper) 接口 --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.dao.UserDaoMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">&lt;!-- id: 重写 UserDao 接口的抽象方法 resultType: 返回类型通过反射找到 --></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">&lt;!--   mybatis-config.xml 中已经配置了 com.dkx.mybatis.pojo.User 的别名我们可以直接使用别名 User--></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">&lt;!--    mybatis-config.xml 中配置了 com.dkx.mybatis.pojo 的包我们可以使用类名首字母小写来使用 --></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getUserList<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>user<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 查询 sql 语句 --></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        select * from mybatis.user;</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-16-11-03-44_20230224205919.png\" alt=\"image_2023-02-16-11-03-44\"></p>\n<p>将配置文件中改为实体类注解的别名</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getUserList<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>niubi<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 查询 sql 语句 --></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        select * from mybatis.user;</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>运行测试</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-16-11-06-10_20230224205936.png\" alt=\"image_2023-02-16-11-06-10\"></p>\n<p>下面是一些为常见的 java 类型内建的类型别名，它们都是不区分大小写的，注意，为了应对原始类型的命名重复，采取了特殊的命名风格</p>\n<p>只介绍部分，具体看文档</p>\n<p>地址:<a href=\"https://mybatis.org/mybatis-3/zh/configuration.html#typeAliasesH\"> 点击</a></p>\n<table>\n<thead>\n<tr>\n<th>别名</th>\n<th>映射的类型</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>_int</td>\n<td>int</td>\n</tr>\n<tr>\n<td>int</td>\n<td>Integer</td>\n</tr>\n<tr>\n<td>date</td>\n<td>Date</td>\n</tr>\n<tr>\n<td>map</td>\n<td>Map</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"设置\"><a class=\"markdownIt-Anchor\" href=\"#设置\">#</a> 设置</h4>\n<p>这是 MyBatis 中极为重要的调整设置，它们会改变 MyBatis 的运行时行为</p>\n<p>具体看文档中的设置标题</p>\n<p><a href=\"https://mybatis.org/mybatis-3/zh/configuration.html#settings\">点击查看</a></p>\n<h4 id=\"其它配置\"><a class=\"markdownIt-Anchor\" href=\"#其它配置\">#</a> 其它配置</h4>\n<ul>\n<li>\n<p>typeHandlers (类型处理器)</p>\n</li>\n<li>\n<p>objectFactory (对象工厂)</p>\n</li>\n<li>\n<p>plugins 插件</p>\n<ul>\n<li>mybatis-generator-core</li>\n<li>mybatis-plus</li>\n<li>通用 mapper</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"映射器mappers\"><a class=\"markdownIt-Anchor\" href=\"#映射器mappers\">#</a> 映射器 (mappers)</h4>\n<p>MapperRegistry: 注册绑定 Mapper 文件；</p>\n<p>方式一：使用相对于类路径的资源引用<font style=\"color:red\"><strong>推荐使用方式</strong></font></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--    每一个 Mapper.XML 都需要在 MyBatis 核心配置文件中注册！--></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">&lt;!--        使用相对于类路径的资源引用 --></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com/dkx/mybatis/dao/UserDaoMapper.xml<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>方式二：使用 class 文件绑定注册</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--    每一个 Mapper.XML 都需要在 MyBatis 核心配置文件中注册！--></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">&lt;!--        使用映射器接口实现类的完全限定类名 --></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.dao.UserDaoMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>注意点</strong></p>\n<ul>\n<li>\n<p>接口和它的 Mapper 配置文件必须同名</p>\n</li>\n<li>\n<p>接口和它的 Mapper 配置文件必须在同一个包下</p>\n</li>\n</ul>\n<p>方式三：使用扫描包进行注入绑定</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--    每一个 Mapper.XML 都需要在 MyBatis 核心配置文件中注册！--></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">&lt;!--        将包内的映射器接口全部注册为映射器 --></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>package</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.dao<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>注意点</strong></p>\n<ul>\n<li>\n<p>接口和它的 Mapper 配置文件必须同名</p>\n</li>\n<li>\n<p>接口和它的 Mapper 配置文件必须在同一个包下</p>\n</li>\n</ul>\n<h2 id=\"解决属性名和字段名不一致的问题\"><a class=\"markdownIt-Anchor\" href=\"#解决属性名和字段名不一致的问题\">#</a> 解决属性名和字段名不一致的问题</h2>\n<p>数据库中的字段</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-16-13-11-50_20230224205955.png\" alt=\"image_2023-02-16-13-11-50\"></p>\n<p>新建一个项目，拷贝之前的，测试实体类字段不一致的情况</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-16-14-11-11_20230224210010.png\" alt=\"image_2023-02-16-14-11-11\"></p>\n<p>运行结果</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-16-14-11-41_20230224210026.png\" alt=\"image_2023-02-16-14-11-41\"></p>\n<p>其运行找不到 pwd 的原理</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-16-14-18-02_20230224210040.png\" alt=\"image_2023-02-16-14-18-02\"></p>\n<ul>\n<li>解决方式：使用别名查询</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-16-14-29-13_20230224210053.png\" alt=\"image_2023-02-16-14-29-13\"></p>\n<ul>\n<li>Mapper.xml</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">mapper</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"https://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">&lt;!--namespace 绑定一个对应的 Dao (Mapper) 接口 --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.dao.UserMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">&lt;!--SQL 语句头标签 --></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">&lt;!--select: 查询语句，id: 对应接口的方法名，parameterType: 参数类型，resultType: 返回值类型 --></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getUserList<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>user<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        select id,name,pwd as password from mybatis.user;</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h3 id=\"使用resultmap解决字段不一致\"><a class=\"markdownIt-Anchor\" href=\"#使用resultmap解决字段不一致\">#</a> 使用 resultMap 解决字段不一致</h3>\n<ul>\n<li>实体类</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"User&#123;\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token string\">\"id=\"</span> <span class=\"token operator\">+</span> id <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token string\">\", name='\"</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token string\">\", password='\"</span> <span class=\"token operator\">+</span> password <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token char\">'&#125;'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>结果集映射</p>\n<pre><code>column:     id  name    pwd\nproperty:   id  name    password\n</code></pre>\n<ul>\n<li>Mapper.xml</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">mapper</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"https://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">&lt;!--namespace 绑定一个对应的 Dao (Mapper) 接口 --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.dao.UserMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">&lt;!--SQL 语句头标签 --></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">&lt;!--select: 查询语句，id: 对应接口的方法名，parameterType: 参数类型，resultType: 返回值类型 --></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">&lt;!--    结果集映射 --></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">&lt;!--    引入 id 为 resultMap 的 resultMap 返回类型为 User--></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resultMap</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>resultMap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>User<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">&lt;!--        column:mysql 中字段，property: 实体类的属性 --></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">&lt;!--        将 mysql 中的 id 字段映射为 id--></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">&lt;!--        将 mysql 的 name 字段映射为 name--></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">&lt;!--        将 mysql 的 pwd 映射为 password--></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pwd<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resultMap</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getUserList<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultMap</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>resultMap<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        select * from mybatis.user;</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>测试结果</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-16-14-47-05_20230224210113.png\" alt=\"image_2023-02-16-14-47-05\"></p>\n<ul>\n<li>\n<p>resultMap 元素是 MyBatis 中最重要最强大的元素</p>\n</li>\n<li>\n<p>resultMap 的设计思想是，对于简单的语句根本不需要配置显式的结果映射，而对于复杂一点的语句只需要描述它们的关系就行了</p>\n</li>\n<li>\n<p>resultMap 最优秀的地方在于，虽然你已经对它相当了解了，但是根据就不需要显式地用到它们</p>\n</li>\n</ul>\n<p>比方说：</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">mapper</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"https://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">&lt;!--namespace 绑定一个对应的 Dao (Mapper) 接口 --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.dao.UserMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">&lt;!--SQL 语句头标签 --></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">&lt;!--select: 查询语句，id: 对应接口的方法名，parameterType: 参数类型，resultType: 返回值类型 --></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">&lt;!--    结果集映射 --></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">&lt;!--    引入 id 为 resultMap 的 resultMap 返回类型为 User--></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resultMap</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>resultMap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>User<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">&lt;!--        column:mysql 中字段，property: 实体类的属性 --></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">&lt;!--        将 mysql 的 pwd 映射为 password--></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pwd<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resultMap</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getUserList<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultMap</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>resultMap<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        select * from mybatis.user;</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>多对一</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-16-15-13-48_20230224210135.png\" alt=\"image_2023-02-16-15-13-48\"></p>\n<h2 id=\"日志\"><a class=\"markdownIt-Anchor\" href=\"#日志\">#</a> 日志</h2>\n<p>如果一个数据库操作，出现了异常，我们需要排错，日志就是最好的助手</p>\n<p>曾经:sout,debug</p>\n<p>现在：日志工厂</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-16-16-06-23_20230224210154.png\" alt=\"image_2023-02-16-16-06-23\"></p>\n<ul>\n<li>\n<p>SLF4J</p>\n</li>\n<li>\n<p>LOG4J（3.5.9 起废弃）</p>\n</li>\n<li>\n<p>LOG4J2</p>\n</li>\n<li>\n<p>JDK_LOGGING</p>\n</li>\n<li>\n<p>COMMONS_LOGGING</p>\n</li>\n<li>\n<p>STDOUT_LOGGING [掌握]</p>\n</li>\n<li>\n<p>NO_LOGGING</p>\n</li>\n</ul>\n<p>在 Mybatis 中具体使用那个日志实现，在设置中设定</p>\n<p><strong>STDOUT_LOGGING 标准日志输出</strong></p>\n<p>在 mybatis 核心配置文件中，配置我们的日志</p>\n<ul>\n<li>mybatis-config.xml</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>settings</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>setting</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>logImpl<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>STDOUT_LOGGING<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>settings</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-16-16-33-59_20230224210219.png\" alt=\"mage_2023-02-16-16-33-59\"></p>\n<h3 id=\"log4j\"><a class=\"markdownIt-Anchor\" href=\"#log4j\">#</a> log4j</h3>\n<p>什么是 log4j?</p>\n<ul>\n<li>\n<p>Log4j 是<font style=\"color:blue\">Apache</font>的一个开源项目，通过使用 Log4j, 我们可以控制日志信息输送的目的地是<font style=\"color:blue\">控制台</font>, 文件，<font style=\"color:blue\">GUI</font>组件</p>\n</li>\n<li>\n<p>我们也可以控制每一条日志的输出格式</p>\n</li>\n<li>\n<p>通过定义每条日志信息的级别，我们能够更加细致地控制日志的生成过程</p>\n</li>\n<li>\n<p>通过一个<font style=\"color:blue\">配置文件</font>来灵活地进行配置，而不需要修改应用的代码</p>\n</li>\n</ul>\n<ol>\n<li>先导入 Log4j 的包</li>\n</ol>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/log4j/log4j --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>log4j<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>log4j<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.2.17<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ol start=\"2\">\n<li>log4j.properties</li>\n</ol>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#将等级为 DEBUG 的日志信息输出到 console 和 file 这两个目的地，console 和 file 的定义在下面的代码</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key attr-name\">log4j.rootLogger</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">DEBUG,console,file</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#控制台输出的相关设置</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key attr-name\">log4j.appender.console</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">org.apache.log4j.ConsoleAppender</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key attr-name\">log4j.appender.console.Target</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">System.out</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key attr-name\">log4j.appender.console.Threshold</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">DEBUG</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key attr-name\">log4j.appender.console.layout</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">org.apache.log4j.PatternLayout</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token key attr-name\">log4j.appender.console.layout.ConversionPattern</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">[%c]-%m%n</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#文件输出的相关设置</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token key attr-name\">log4j.appender.file</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">org.apache.log4j.RollingFileAppender</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token key attr-name\">log4j.appender.file.File</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">./log/kuang.log</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token key attr-name\">log4j.appender.file.MaxFileSize</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">10mb</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token key attr-name\">log4j.appender.file.Threshold</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">DEBUG</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token key attr-name\">log4j.appender.file.layout</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">org.apache.log4j.PatternLayout</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token key attr-name\">log4j.appender.file.layout.ConversionPattern</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">[%p][%d&#123;yy-MM-dd&#125;][%c]%m%n</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">#日志输出级别</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token key attr-name\">log4j.logger.org.mybatis</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">DEBUG</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token key attr-name\">log4j.logger.java.sql</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">DEBUG</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token key attr-name\">log4j.logger.java.sql.Statement</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">DEBUG</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token key attr-name\">log4j.logger.java.sql.ResultSet</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">DEBUG</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token key attr-name\">log4j.logger.java.sql.PreparedStatement</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">DEBUG</span></pre></td></tr></table></figure><ol start=\"3\">\n<li>配置 log4j 为日志实现</li>\n</ol>\n<p>mybatis-config.xml</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Config 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"https://mybatis.org/dtd/mybatis-3-config.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span> <span class=\"token attr-name\">resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>druid.properties<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>settings</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>setting</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>log4j<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>STDOUT_LOGGING<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>settings</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>typeAlias</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.pojo.User<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alias</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>H<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environments</span> <span class=\"token attr-name\">default</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environment</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>transactionManager</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JDBC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataSource</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POOLED<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>driver<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;driver&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;jdbcUrl&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;username&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;password&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataSource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environments</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com/dkx/mybatis/dao/UserMapper.xml<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>如果这里报错可以将 mybatis-config.xml 中的 settings 配置给注释掉，运行时也会导出日志文件的</li>\n</ul>\n<p>测试结果</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-17-10-47-19_20230224210242.png\" alt=\"image_2023-02-17-10-47-19\"></p>\n<h4 id=\"简单使用log4j\"><a class=\"markdownIt-Anchor\" href=\"#简单使用log4j\">#</a> 简单使用:log4j</h4>\n<ol>\n<li>\n<p>在要使用 Log4j 的类中，导入包 import org.apache.log4.Logger;</p>\n</li>\n<li>\n<p>生成日志对象，加载参数为当前类的 class</p>\n</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Logger</span> logger <span class=\"token operator\">=</span> <span class=\"token class-name\">Logger</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLogger</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserMapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>日志级别</li>\n</ul>\n<pre><code>logger.info(&quot;进入了:testlog4j方法&quot;);\nlogger.debug(&quot;Debug:进入了testlog4j方法&quot;);\nlogger.error(&quot;error:进入了testlog4j方法&quot;);\n</code></pre>\n<ol start=\"3\">\n<li>输出日志信息方法</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserMapperTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Logger</span> logger <span class=\"token operator\">=</span> <span class=\"token class-name\">Logger</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLogger</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserMapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testlog4j</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">//        信息</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        logger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"进入了:testlog4j方法\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        logger<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Debug:进入了testlog4j方法\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        logger<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"error:进入了testlog4j方法\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>运行后查看运行结果</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-17-11-01-35_20230224210300.png\" alt=\"image_2023-02-17-11-01-35\"></p>\n<p>查看生产出的 log 目录的日志文件</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-17-11-02-34_20230224210313.png\" alt=\"image_2023-02-17-11-02-34\"></p>\n<h2 id=\"分页\"><a class=\"markdownIt-Anchor\" href=\"#分页\">#</a> 分页</h2>\n<p><strong>思考:</strong> 为什么要分页？</p>\n<ul>\n<li>减少数据的处理量</li>\n</ul>\n<h3 id=\"limit分页\"><a class=\"markdownIt-Anchor\" href=\"#limit分页\">#</a> Limit 分页</h3>\n<p>案例操作步骤:</p>\n<ol>\n<li>接口</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserMapper</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//    分页查询</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getUserMyLimit</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"2\">\n<li>UserMapper.xmlx</li>\n</ol>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">mapper</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"https://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.dao.UserMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getUserMyLimit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>map<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>H<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        select * from mybatis.user limit #&#123;startIndex&#125;,#&#123;pageSize&#125;;</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ol start=\"3\">\n<li>测试</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test4</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token class-name\">SqlSession</span> sqlsession <span class=\"token operator\">=</span> <span class=\"token class-name\">MybatisUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">UserMapper</span> mapper <span class=\"token operator\">=</span> sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserMapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> map <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        map<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"startIndex\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        map<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pageSize\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> u <span class=\"token operator\">=</span> mapper<span class=\"token punctuation\">.</span><span class=\"token function\">getUserMyLimit</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> i <span class=\"token operator\">:</span> u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Run 结果</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-17-23-36-33_20230224210333.png\" alt=\"image_2023-02-17-23-36-33\"></p>\n<h3 id=\"rowbounds分页\"><a class=\"markdownIt-Anchor\" href=\"#rowbounds分页\">#</a> RowBounds 分页</h3>\n<p>不再使用 SQL 实现分页</p>\n<p>通过<font style=\"color:blue\">RowBounds</font>实现分页查询<font style=\"color:red\">(<strong>重要提醒：不推荐使用，一般公司不会使用</strong>)</font></p>\n<p>演示操作步骤:</p>\n<ul>\n<li>接口</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserMapper</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//    RowBounds 分页查询</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getUserMyRowBounds</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>UserMapper.xml</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getUserMyRowBounds<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>H<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        select * from mybatis.user;</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>测试代码</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test5RoBounds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token class-name\">SqlSession</span> sqlsession <span class=\"token operator\">=</span> <span class=\"token class-name\">MybatisUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//        RowBounds 实现分页查询</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">RowBounds</span> rowbounds <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RowBounds</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">//        通过 java 代码层面实现分页</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">selectList</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"com.dkx.mybatis.dao.UserMapper.getUserMyRowBounds\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>rowbounds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> i<span class=\"token operator\">:</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Run 结果</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-18-00-13-56_20230224210350.png\" alt=\"image_2023-02-18-00-13-56\"></p>\n<h3 id=\"分页插件\"><a class=\"markdownIt-Anchor\" href=\"#分页插件\">#</a> 分页插件</h3>\n<h4 id=\"mybatishelper\"><a class=\"markdownIt-Anchor\" href=\"#mybatishelper\">#</a> MyBatisHelper</h4>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-18-00-27-12_20230224210403.png\" alt=\"image_2023-02-18-00-27-12\"></p>\n<p>使用方式具体看文档介绍</p>\n<p>了解即可，万一以后公司的架构师，说要使用，你需要知道它是什么东西！</p>\n<h2 id=\"使用注解开发\"><a class=\"markdownIt-Anchor\" href=\"#使用注解开发\">#</a> 使用注解开发</h2>\n<h3 id=\"面向接口编程\"><a class=\"markdownIt-Anchor\" href=\"#面向接口编程\">#</a> 面向接口编程</h3>\n<ul>\n<li>\n<p>大家之前都学过面向对象编程，也学习过接口，但在真正的开发中，很多时候我们会选择面向接口编程</p>\n</li>\n<li>\n<p><strong>根本原因:   <mark>解耦</mark>，可扩展，可提高复用，分层开发中，上层不用管具体的实现，大家都遵守共同的标准，使得开发变得更容易，规范性更好</strong></p>\n</li>\n<li>\n<p>在一个面向对象的系统中，系统的各个功能是由许许多多的不同对象写作完成的，在这种情况下，各个对象内部是如何实现 自己的，对系统设计人员来讲就不那么重要了</p>\n</li>\n<li>\n<p>而各个对象之间的写作关系则成为系统设计的关键，小到不同类之间的通信，大到各模块之间的交互，在系统设计之初都是要着重考虑的，这也是系统设计的主要工作内容，面向接口编程就是按照这种思想来编程</p>\n</li>\n</ul>\n<h4 id=\"关于接口的理解\"><a class=\"markdownIt-Anchor\" href=\"#关于接口的理解\">#</a> <strong>关于接口的理解</strong></h4>\n<ul>\n<li>\n<p>接口从更深层次的理解，应是定义 (规范，约束) 与实现 (名实分离的原则) 的分离</p>\n</li>\n<li>\n<p>接口的本身反映了系统设计人员对系统的抽象理解</p>\n</li>\n<li>\n<p>接口应有两类:</p>\n<ul>\n<li>第一类是对一个个体的抽象，它可对应为一个抽象体 (abstract class)</li>\n<li>第二类是对一个个体某一方面的抽象，即形成一个抽象面 (interface)</li>\n</ul>\n</li>\n<li>\n<p>一个体有可能多个抽象面，抽象体与抽象面是有区别的</p>\n</li>\n</ul>\n<p>本质：反射机制实现</p>\n<p>底层：动态代理</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-18-16-49-52_20230224210421.png\" alt=\"mage_2023-02-18-16-49-52\"></p>\n<p><strong>MyBatis 执行流程</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-18-17-32-08_20230224210442.png\" alt=\"image_2023-02-18-17-32-08\"></p>\n<h4 id=\"代码演示\"><a class=\"markdownIt-Anchor\" href=\"#代码演示\">#</a> <strong>代码演示</strong></h4>\n<ul>\n<li>项目目录</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-18-16-07-06_20230224210457.png\" alt=\"image_2023-02-18-16-07-06\"></p>\n<p>去掉了 UserMapper.xml 文件</p>\n<ul>\n<li>接口</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserMapper</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select * from user\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getUserList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>实体类</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"User&#123;\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token string\">\"id=\"</span> <span class=\"token operator\">+</span> id <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token string\">\", name='\"</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token string\">\", password='\"</span> <span class=\"token operator\">+</span> password <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token char\">'&#125;'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>mybatis-config.xml 配置文件</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Config 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"https://mybatis.org/dtd/mybatis-3-config.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span> <span class=\"token attr-name\">resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>druid.properties<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>package</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.pojo<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environments</span> <span class=\"token attr-name\">default</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environment</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>transactionManager</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JDBC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataSource</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POOLED<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>driver<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;driver&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;jdbcUrl&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;username&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;password&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataSource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environments</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">&lt;!--    绑定配置文件 --></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">&lt;!--    &lt;mappers>--></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">&lt;!--        &lt;mapper resource=\"org/mybatis/example/BlogMapper.xml\"/>--></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">&lt;!--    &lt;/mappers>--></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">&lt;!--    绑定接口 --></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.dao.UserMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>Run 结果</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-18-16-08-50_20230224210518.png\" alt=\"image_2023-02-18-16-08-50\"></p>\n<p>由于实体类的字段和 mysql 的字段不一致导致获取不到 password 的值，这个问题在之前使用 UserMapper.xml 的时候只需要添加 <code>typeMap</code>  映射字段来解决，那使用注解方式并没有 UserMapper.xml 配置文件怎么解决呢？</p>\n<ul>\n<li>官方回答:</li>\n</ul>\n<blockquote>\n<p>使用注解来映射简单语句会使代码显得更加简洁，但对于稍微复杂一点的语句，java 注解不仅力不从心，还会让本就复杂的 SQL 语句更加混乱不堪，因此，如果你需要做一些很复杂的操作，最好用 XML 来映射语句。</p>\n</blockquote>\n<blockquote>\n<p>选择何种方式来配置映射，以及是否应该要统一映射语句定义的形式，完全取决于你和你的团队，换句话说，永远不要拘泥于一种方式，你可以很轻松地在基于注解和 XML 的语句映射方式间自由移植和切换</p>\n</blockquote>\n<ul>\n<li>总结：建议使用 XML 来解决这种字段不一致映射的问题</li>\n</ul>\n<h3 id=\"注解crud\"><a class=\"markdownIt-Anchor\" href=\"#注解crud\">#</a> 注解 CRUD</h3>\n<p>在工具类创建的时候实现自动提交事务</p>\n<ul>\n<li>MybatisUtils 工具类</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">SqlSession</span> <span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//        在构造器中设置 true 自动提交事务</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">return</span> sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">openSession</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"param参数注解\"><a class=\"markdownIt-Anchor\" href=\"#param参数注解\">#</a> @Param (&quot;&quot;) 参数注解</h4>\n<p>多个参数需要使用 @Param (&quot;&quot;) 注解，参数为字段名，一个参数可以不写该注解，多个参数必须写否则报错</p>\n<p>引用类型不需要使用 @param 比如，对象，Map 集合</p>\n<p><strong>错误示范</strong></p>\n<ul>\n<li>接口</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//    方法存在多个参数所有的参数前面必须使用 @Param (”“) 注解</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select * from user where id = #&#123;id&#125; and name = #&#123;name&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">User</span> <span class=\"token function\">getUserById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>Run 结果</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-18-18-49-06_20230224210536.png\" alt=\"image_2023-02-18-18-49-06\"></p>\n<p><strong>正确代码演示</strong></p>\n<ul>\n<li>接口</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//    方法存在多个参数所有的参数前面必须使用 @Param (”“) 注解</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select * from user where id = #&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">User</span> <span class=\"token function\">getUserById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>测试代码</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token class-name\">SqlSession</span> sqlsession <span class=\"token operator\">=</span> <span class=\"token class-name\">MybatisUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">UserMapper</span> mapper <span class=\"token operator\">=</span> sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserMapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">User</span> u <span class=\"token operator\">=</span> mapper<span class=\"token punctuation\">.</span><span class=\"token function\">getUserById</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>Run 结果</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-18-18-30-14_20230224210550.png\" alt=\"image_2023-02-18-18-30-14\"></p>\n<h4 id=\"让param注解参数与查询语句中参数不一致得出的以下情况\"><a class=\"markdownIt-Anchor\" href=\"#让param注解参数与查询语句中参数不一致得出的以下情况\">#</a> 让 @Param 注解参数与查询语句 #{} 中参数不一致得出的以下情况</h4>\n<ul>\n<li>Run 结果：报错！！！</li>\n</ul>\n<p>将 @Param 中的参数名更改</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//    方法存在多个参数所有的参数前面必须使用 @Param (”“) 注解</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    而查询语句中#<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>中的参数名为id</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select * from user where id = #&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    更改<span class=\"token annotation punctuation\">@Param</span>中的参数名</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">User</span> <span class=\"token function\">getUserById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"qid\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>两个参数名不一致查看下 Run 结果</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-18-18-33-06_20230224210603.png\" alt=\"image_2023-02-18-18-33-06\"></p>\n<p>同样的使用 UserMapper.xml 配置来实现 CRUD 在接口中的参数列表中使用 @Param 注解来定义参数名如果与 xml 中的 #{} 参数名不一致也会导致报错</p>\n<h4 id=\"使用usermapperxml的情况\"><a class=\"markdownIt-Anchor\" href=\"#使用usermapperxml的情况\">#</a> 使用 UserMapper.xml 的情况</h4>\n<ul>\n<li>接口</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">User</span> <span class=\"token function\">getUserById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>UserMapper.xml</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getUserById<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>H<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        select * from user where id = #&#123;id&#125;;</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>Run 结果</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-18-18-41-13_20230224210618.png\" alt=\"mage_2023-02-18-18-41-13\"></p>\n<p>更改接口中 @Param 注解中的参数名让其与 UserMapper.xml 中的参数不一致</p>\n<ul>\n<li>接口</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">User</span> <span class=\"token function\">getUserById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"qid\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>Run 结果</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-18-18-42-51_20230224210633.png\" alt=\"image_2023-02-18-18-42-51\"></p>\n<p>报错！</p>\n<h4 id=\"insert\"><a class=\"markdownIt-Anchor\" href=\"#insert\">#</a> Insert</h4>\n<p><font style=\"color:red\">使用注解来执行 insert 注解的写法为 @Insert, 其中 i 为大写</font></p>\n<ul>\n<li>接口</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Insert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"insert into user (id,name,pwd) values (#&#123;id&#125;,#&#123;name&#125;,#&#123;pwd&#125;)\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">int</span> <span class=\"token function\">addUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>测试代码</li>\n</ul>\n<p><font style=\"color:red\">因为在工具类 (MybatisUtils) 类中将 openSession 参数列表中赋值 true 为自动提交事务所以再次不需要手动的去提交事务了</font></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token class-name\">SqlSession</span> sqlsession <span class=\"token operator\">=</span> <span class=\"token class-name\">MybatisUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">UserMapper</span> mapper <span class=\"token operator\">=</span> sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserMapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> mapper<span class=\"token punctuation\">.</span><span class=\"token function\">addUser</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"小小明\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"7755\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"执行成功！！！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>Run 结果</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-18-19-06-25_20230224210650.png\" alt=\"image_2023-02-18-19-06-25\"></p>\n<p>查看 mysql 中 table 的数据</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-18-19-06-50_20230224210703.png\" alt=\"image_2023-02-18-19-06-50\"></p>\n<h4 id=\"update\"><a class=\"markdownIt-Anchor\" href=\"#update\">#</a> Update</h4>\n<p><font style=\"color:red\">使用注解来执行 update 注解的写法为 @Update, 其中 u 为大写</font></p>\n<ul>\n<li>接口</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Update</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"update user set name = #&#123;name&#125; where id = #&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">int</span> <span class=\"token function\">updateUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>测试代码</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token class-name\">SqlSession</span> sqlsession <span class=\"token operator\">=</span> <span class=\"token class-name\">MybatisUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">UserMapper</span> mapper <span class=\"token operator\">=</span> sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserMapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> mapper<span class=\"token punctuation\">.</span><span class=\"token function\">updateUser</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"大大明\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"7755\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"执行成功！！！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>Run 结果</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-18-19-20-24_20230224210718.png\" alt=\"image_2023-02-18-19-20-24\"></p>\n<p>mysql 中的结果</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-18-19-20-55_20230224210731.png\" alt=\"!mage_2023-02-18-19-20-55\"></p>\n<h4 id=\"关于param注解\"><a class=\"markdownIt-Anchor\" href=\"#关于param注解\">#</a> 关于 @Param (&quot;&quot;) 注解</h4>\n<ul>\n<li>\n<p>基本类型的参数或者 String, 需要加上</p>\n</li>\n<li>\n<p>引用类型 比如：对象，Map 集合 … 不需要加</p>\n</li>\n<li>\n<p>如果只有一个基本类型的话可以忽略，但是建议加上</p>\n</li>\n<li>\n<p>在 SQL 中引用的就是在 @Param (“id”) 中设定的属性名</p>\n</li>\n</ul>\n<h2 id=\"与-的区别\"><a class=\"markdownIt-Anchor\" href=\"#与-的区别\">#</a> #{} 与 ${} 的区别</h2>\n<p>具体查看<a href=\"https://pigpigletsgo.github.io/computer-science/database/mybatis/%E4%BB%A3%E7%A0%81%E6%A1%88%E4%BE%8B/3/\">点击</a></p>\n<h2 id=\"lombok\"><a class=\"markdownIt-Anchor\" href=\"#lombok\">#</a> Lombok</h2>\n<blockquote>\n<p>Project Lombok is a java library that automatically plugs into your editor and build tools, spicing up your java.<br>\nNever write another getter or equals method again, with one annotation your class has a fully featured builder, Automate your logging variables, and much more.</p>\n</blockquote>\n<p>Lombok 是一款 Java 开发插件，使得 Java 开发者可以通过其定义的一些注解来消除业务工程中冗长和繁琐的代码，尤其对于简单的 Java 模型对象 (POJO), 在开发环境中使用 Lombok 插件后，Java 开发人员可以节省出重复构建，诸如 hashCode 和 equals 这样的方法以及各种业务对象模型的 accessor 和 toString 等方法的大量时间，对于这些方法，它能够编译源代码期间自动帮我们生成这些方法，并没有如反射那样降低程序的性能</p>\n<p><font style=\"color:red\"><strong>偷懒专用插件</strong></font></p>\n<h3 id=\"lombok的优缺点\"><a class=\"markdownIt-Anchor\" href=\"#lombok的优缺点\">#</a> Lombok 的优缺点</h3>\n<p><strong>优点</strong></p>\n<ol>\n<li>\n<p>能通过注解的形式自动生成构造器，getter/setter,equals,hashcode,toString 等方法，提高了一定的开发效率</p>\n</li>\n<li>\n<p>让代码变得简洁，不用过多的去关注响应的方法</p>\n</li>\n<li>\n<p>属性做修改时，也简化了维护为这些属性所生成的 getter/setter 方法等</p>\n</li>\n</ol>\n<p><strong>缺点:</strong></p>\n<ol>\n<li>\n<p>不支持多种参数构造器的重载</p>\n</li>\n<li>\n<p>虽然省去了手动创建 getter/setter 方法的麻烦，但大大降低了源代码的可读性和完整性，降低了阅读源代码的舒适度</p>\n</li>\n</ol>\n<p><strong>总结</strong></p>\n<blockquote>\n<p>知乎上有位大神发表对 Lombok 的一些看法:<br>这是一种低级趣味的插件，不建议使用，Java 发展到今天，各种插件层出不穷，如何甄别各种插件的优劣？能从架构上优化你的设计的，能提高应用程序性能的，实现高度封装可扩展的…, 像 lombo 这种，像这种插件，已经不仅仅是插件了，改变了你如何编写源码，事实上，少去了的代码，你写上去又任何？如果 Java 家族到处充斥这样的东西，那只不过是一坨披着金属颜色的屎，今早会被其它的语言取代</p>\n</blockquote>\n<ul>\n<li>\n<p>java library</p>\n</li>\n<li>\n<p>plugs</p>\n</li>\n<li>\n<p>build tools</p>\n</li>\n<li>\n<p>with one annotation your class</p>\n</li>\n</ul>\n<p>使用步骤:</p>\n<ol>\n<li><font style=\"color:red\"><strong>在 IDEA 中安装 Lombok 插件</strong></font></li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-19-00-01-58_20230224210755.png\" alt=\"image_2023-02-19-00-01-58\"></p>\n<ol start=\"2\">\n<li><font style=\"color:red\"><strong>在项目中导入 Lombok 的 jar 包</strong></font></li>\n</ol>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.projectlombok<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>lombok<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.18.10<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ol start=\"3\">\n<li><font style=\"color:red\"><strong>在实体类上加注解即可</strong></font></li>\n</ol>\n<ul>\n<li>Lombok 中的注解</li>\n</ul>\n<pre><code>@NoArgsConstructor(access = AccessLevel.PRIVATE) 无参构造，指定访问级别为私有(private)\n@AllArgsConstructor(access = AccessLevel.PRIVATE) 有参构造，指定访问级别为私有(private)\n@Log, @Log4j, @Log4j2, @Slf4j, @XSlf4j, @CommonsLog, @JBossLog, @Flogger, @CustomLog\n@Data\n@Builder\n@SuperBuilder\n@Singular\n@Delegate\n@Value\n@Accessors\n@Wither\n@With\n@SneakyThrows\n@ToString(of = &#123;&quot;&quot;,&quot;&quot;&#125;) 生成toString方法，of指定重写要参与的字段\n@EqualsAndHashCode(of = &#123;&quot;&quot;,&quot;&quot;&#125;) 生成equals与hashCode重写方法，of指定要参与的字段\n</code></pre>\n<p>@Data：无参构造 (自带),get,set,toString,equals,hashcode</p>\n<p>@Value：</p>\n<ol>\n<li>所有的成员变量都是 private final 修饰的。</li>\n<li>只有 getter 方法，没有 setter 方法，因为普通方法无法修改 final 修饰的成员变量。</li>\n<li>适合加在值不希望被改变的类上，像是某个类的值当创建后就不希望被更改，只希望读它。</li>\n<li>提供带参数的构造器，根据传入的参数来初始化类里的成员变量。</li>\n<li>重写 hashCode 和 equals 方法。</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> pwd<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>效果</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-19-00-19-06_20230224210810.png\" alt=\"image_2023-02-19-00-19-06\"></p>\n<h2 id=\"多对一处理\"><a class=\"markdownIt-Anchor\" href=\"#多对一处理\">#</a> 多对一处理</h2>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-19-01-05-37_20230224210826.png\" alt=\"image_2023-02-19-01-05-37\"></p>\n<ul>\n<li>\n<p>多个学生，对应一个老师：多对一</p>\n</li>\n<li>\n<p>对于学生这边而言，<strong> 关联</strong> … 多个学生，关联一个老师</p>\n</li>\n<li>\n<p>对于老师而言:<strong> 集合</strong>。一个老师，有很多学生 [一对多]</p>\n</li>\n<li>\n<p><strong>association</strong> 一个复杂类型的关联，许多结果将包装成这种类型</p>\n<ul>\n<li>嵌套结果映射 - 关联本身可以是一个 <code>resultMap</code>  元素，或者从别处引用一个</li>\n</ul>\n</li>\n<li>\n<p><strong>collection</strong> 一个复杂类型的集合</p>\n<ul>\n<li>嵌套结果映射 - 集合本身可以是一个 <code>resultMap</code>  元素，或者从别处引用一个</li>\n</ul>\n</li>\n</ul>\n<p><strong>代码演示</strong></p>\n<ul>\n<li>实体类</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Teacher</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Student</span> student<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>mybatis-config.xml 配置文件</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Config 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"https://mybatis.org/dtd/mybatis-3-config.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span> <span class=\"token attr-name\">resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>druid.properties<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environments</span> <span class=\"token attr-name\">default</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environment</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>transactionManager</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JDBC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataSource</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POOLED<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>driver<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;driver&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;jdbcUrl&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;username&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;password&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataSource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environments</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">&lt;!--    错误写法 --></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">&lt;!--    &lt;mappers>--></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">&lt;!--        &lt;mapper class=\"com.dkx.mybatis.dao.*Mapper\"/>--></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">&lt;!--    &lt;/mappers>--></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">&lt;!--    正确写法 --></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.dao.StudentMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.dao.TeacherMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token comment\">&lt;!--    正确写法 --></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">&lt;!--    &lt;mappers>--></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">&lt;!--        &lt;package name=\"com.dkx.mybatis.dao\"/>--></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">&lt;!--    &lt;/mappers>--></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\">&lt;!--    错误写法 --></span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\">&lt;!--    &lt;mappers>--></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">&lt;!--        &lt;mapper class=\"com.dkx.mybatis.dao.StudentMapper\"/>--></span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">&lt;!--    &lt;/mappers>--></span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>\n<p>接口</p>\n</li>\n<li>\n<p>StudentMapper</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">StudentMapper</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select * from student where id = #&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Student</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>TeacherMapper</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">TeacherMapper</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select * from teacher where id = #&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Teacher</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>测试代码 Run 结果</p>\n<ul>\n<li>TeacherMapper</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-20-08-58-25_20230224210851.png\" alt=\"image_2023-02-20-08-58-25\"></p>\n<ul>\n<li>StudentMapper</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-20-08-58-59_20230224211449.png\" alt=\"image_2023-02-20-08-58-59\"></p>\n<h3 id=\"按照查询嵌套处理\"><a class=\"markdownIt-Anchor\" href=\"#按照查询嵌套处理\">#</a> 按照查询嵌套处理</h3>\n<ul>\n<li>TeacherMapper.xml</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">mapper</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"https://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">&lt;!--namespace 绑定一个对应的 Dao (Mapper) 接口 --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.dao.TeacherMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">&lt;!--    思路:</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        1. 查询所有老师的信息</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        2. 根据查询出来的老师的 tid，寻找对应的学生</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    --></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resultMap</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>studentTeacher<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>T<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">&lt;!--        复杂的属性：我们需要单独处理</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            对象：association</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            集合：collection</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>--></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>association</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>student<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tid<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">javaType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>S<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">select</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getStudent<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resultMap</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getTeacher<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultMap</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>studentTeacher<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        select * from teacher;</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getStudent<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>S<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        select * from student where id = #&#123;id&#125;;</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>查询 <code>TeacherMapper</code>  Run 结果</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-20-11-24-53_20230224211504.png\" alt=\"image_2023-02-20-11-24-53\"></p>\n<h3 id=\"按照结果嵌套处理\"><a class=\"markdownIt-Anchor\" href=\"#按照结果嵌套处理\">#</a> 按照结果嵌套处理</h3>\n<ul>\n<li>TeacherMapper.xml</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--    按照结果嵌套处理 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getTeacher1<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultMap</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>teacherstudent<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        select t.id as tid,t.name as tname,s.name as sname,s.id as sid from student s,teacher t where t.tid = s.id;</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resultMap</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tweacherstudent<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>T<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tid<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tname<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>association</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>student<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">javaType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>S<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sname<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sid<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>association</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resultMap</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>Run 结果</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-20-11-54-39_20230224211519.png\" alt=\"image_2023-02-20-11-54-39\"></p>\n<h2 id=\"一对多处理\"><a class=\"markdownIt-Anchor\" href=\"#一对多处理\">#</a> 一对多处理</h2>\n<p>比如：一个老师拥有多个学生</p>\n<p>对于老师而言，就是一对多的关系</p>\n<p><strong>实体类</strong></p>\n<ul>\n<li>Student</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">//    多个学生对应一个老师</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Teacher</span><span class=\"token punctuation\">></span></span> teachers<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>Teacher</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Teacher</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> tid<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>mybatis-config.xml</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Config 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"https://mybatis.org/dtd/mybatis-3-config.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span> <span class=\"token attr-name\">resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>druid.properties<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>typeAlias</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.pojo.Student<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alias</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>S<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>typeAlias</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.pojo.Teacher<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alias</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>T<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environments</span> <span class=\"token attr-name\">default</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environment</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>transactionManager</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JDBC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataSource</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POOLED<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>driver<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;driver&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;jdbcUrl&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;username&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;password&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataSource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environments</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.dao.StudentMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.dao.TeacherMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>StudentMapper.xml</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">mapper</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"https://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">&lt;!--namespace 绑定一个对应的 Dao (Mapper) 接口 --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.dao.StudentMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getStudent<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultMap</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>teacherstudent<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        select s.id as sid,s.name as sname,t.id as rid,t.name as tname,t.tid from student s,teacher t</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        where s.id = t.tid and s.id = #&#123;id&#125;;</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resultMap</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>teacherstudent<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>S<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sid<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sname<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">&lt;!--         集合中的泛型信息，使用 ofType 获取 --></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>collection</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>teachers<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ofType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>T<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rid<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tname<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tid<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tid<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>collection</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resultMap</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">&lt;!--==========================================================================================--></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getStudent1<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultMap</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>teacherstudent1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        select * from student where id = #&#123;id&#125;;</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resultMap</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>teacherstudent1<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>S<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>collection</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>teachers<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">javaType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ArrayList<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ofType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>T<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">select</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getTeacher<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>collection</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resultMap</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getTeacher<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>T<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        select * from teacher where tid = #&#123;tid&#125;;</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>接口</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">StudentMapper</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Student</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getStudent</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Student</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getStudent1</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Run 结果</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-20-15-50-21_20230224211538.png\" alt=\"image_2023-02-20-15-50-21\"></p>\n<p><strong>按照结果嵌套处理</strong></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getStudent<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultMap</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>teacherstudent<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        select s.id as sid,s.name as sname,t.id as rid,t.name as tname,t.tid from student s,teacher t</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        where s.id = t.tid and s.id = #&#123;id&#125;;</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resultMap</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>teacherstudent<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>S<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sid<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sname<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">&lt;!--         集合中的泛型信息，使用 ofType 获取 --></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>collection</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>teachers<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ofType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>T<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rid<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tname<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tid<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tid<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>collection</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resultMap</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>按照查询嵌套处理</strong></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getStudent1<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultMap</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>teacherstudent1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        select * from student where id = #&#123;id&#125;;</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resultMap</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>teacherstudent1<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>S<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>collection</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>teachers<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">javaType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ArrayList<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ofType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>T<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">select</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getTeacher<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>collection</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resultMap</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getTeacher<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>T<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        select * from teacher where tid = #&#123;tid&#125;;</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>总结:</p>\n<ul>\n<li>\n<p>对象使用 - (关联):association [多对一]</p>\n</li>\n<li>\n<p>集合使用 - (集合):collection  [一对多]</p>\n</li>\n<li>\n<p>javaType &amp; ofType</p>\n<ul>\n<li>javaType 用来指定实体类中属性的类型</li>\n<li>ofType 用来指定映射到 List 或者集合中的 pojo 类型，泛型中的约束类型</li>\n</ul>\n</li>\n</ul>\n<p><strong>注意点:</strong></p>\n<ul>\n<li>\n<p>保证 SQL 的可读性，尽量保证通俗易懂</p>\n</li>\n<li>\n<p>注意，一对多和多对一中，属性名和字段的问题！</p>\n</li>\n<li>\n<p>如果问题不好排查错误，可以使用日志，建议使用 log4j</p>\n</li>\n</ul>\n<h2 id=\"动态sql\"><a class=\"markdownIt-Anchor\" href=\"#动态sql\">#</a> 动态 SQL</h2>\n<p>什么是动态 SQL:</p>\n<blockquote>\n<p>动态 SQL 就是指根据不同条件生成不同的 SQL 语句</p>\n</blockquote>\n<p>利用动态 SQL 这一特性可以彻底摆脱这种痛苦</p>\n<p>动态 SQL 元素和 JSTL 或基于类似 XML 的文本处理器相似，在 MyBatis 之前的版本中，有很多元素需要花时间了解，MyBatis3 大大精简了元素种类，现在只需要学习原来一半的元素便可，MyBatis 采用功能强大的基于 OGNL 的表达式来淘汰其它大部分元素</p>\n<h3 id=\"if\"><a class=\"markdownIt-Anchor\" href=\"#if\">#</a> if</h3>\n<blockquote>\n<p>这条语句提供了可选查找文本功能，如果不传入 &quot;title&quot;, 那么所有处于 &quot;ACTIVE&quot; 状态的 BLOG 都会返回；如果传入了 &quot;title&quot; 参数，那么就会对 &quot;title&quot; 一列进行模糊查找并返回对应的 BLOG 结果 (细心的阅读者可能会发现，&quot;title&quot; 的参数值需要包含查找掩码或通配符字符)</p>\n</blockquote>\n<blockquote>\n<p>如果希望通过 &quot;title&quot; 和 &quot;author&quot; 两个参数进行可选搜索该怎么办呢？首先，我想先将名称修改成更名副其实的名称；接下来，只需要加入另一个条件即可</p>\n</blockquote>\n<p><a href=\"https://pigpigletsgo.github.io/computer-science/database/mybatis/%E4%BB%A3%E7%A0%81%E6%A1%88%E4%BE%8B/4/\">点击查看代码</a></p>\n<h3 id=\"choosewhenotherwise\"><a class=\"markdownIt-Anchor\" href=\"#choosewhenotherwise\">#</a> choose(when,otherwise)</h3>\n<h3 id=\"trimwhereset\"><a class=\"markdownIt-Anchor\" href=\"#trimwhereset\">#</a> trim(where,set)</h3>\n<h3 id=\"foreach\"><a class=\"markdownIt-Anchor\" href=\"#foreach\">#</a> foreach</h3>\n<h3 id=\"搭建环境-2\"><a class=\"markdownIt-Anchor\" href=\"#搭建环境-2\">#</a> 搭建环境</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> blog<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    id <span class=\"token keyword\">int</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    title <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    author <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    create_time <span class=\"token keyword\">datetime</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    views <span class=\"token keyword\">int</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token keyword\">character</span> <span class=\"token keyword\">set</span> utf8 <span class=\"token keyword\">collate</span> utf8mb3_bin<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>创建一个基础工程</p>\n<ol>\n<li>编写配置文件</li>\n</ol>\n<ul>\n<li>mybatis-config.xml</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Config 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"https://mybatis.org/dtd/mybatis-3-config.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span> <span class=\"token attr-name\">resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>druid.properties<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>typeAlias</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.pojo.Blog<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alias</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>B<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environments</span> <span class=\"token attr-name\">default</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environment</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>transactionManager</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JDBC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataSource</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POOLED<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>driver<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;driver&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;jdbcUrl&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;username&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;password&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataSource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environments</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com/dkx/mybatis/dao/BlogMapper.xml<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ol start=\"2\">\n<li>编写实体类</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Blog</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> title<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> author<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Date</span> create_time<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> views<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Blog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Blog</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> title<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> author<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Date</span> create_time<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span> views<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> title<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>author <span class=\"token operator\">=</span> author<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>create_time <span class=\"token operator\">=</span> create_time<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>views <span class=\"token operator\">=</span> views<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Integer</span> <span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">return</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setId</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getTitle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">return</span> title<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setTitle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> title<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> title<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getAuthor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token keyword\">return</span> author<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setAuthor</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> author<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>author <span class=\"token operator\">=</span> author<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Date</span> <span class=\"token function\">getCreate_time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token keyword\">return</span> create_time<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setCreate_time</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Date</span> create_time<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>create_time <span class=\"token operator\">=</span> create_time<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Integer</span> <span class=\"token function\">getViews</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token keyword\">return</span> views<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setViews</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> views<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>views <span class=\"token operator\">=</span> views<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"Blog&#123;\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                <span class=\"token string\">\"id=\"</span> <span class=\"token operator\">+</span> id <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                <span class=\"token string\">\", title='\"</span> <span class=\"token operator\">+</span> title <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                <span class=\"token string\">\", author='\"</span> <span class=\"token operator\">+</span> author <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                <span class=\"token string\">\", create_time=\"</span> <span class=\"token operator\">+</span> create_time <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                <span class=\"token string\">\", views=\"</span> <span class=\"token operator\">+</span> views <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                <span class=\"token char\">'&#125;'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"3\">\n<li>编写实体类对应的 Mapper 接口和 Mapper.xml 文件</li>\n</ol>\n<ul>\n<li>Blogmapper</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">BlogMapper</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//    插入数据</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> <span class=\"token function\">addblog</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Blog</span> blog<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">//    查询博客</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Blog</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">queryBlogIF</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Map</span> map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>BlogMapper.xml</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">mapper</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"https://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">&lt;!--namespace 绑定一个对应的 Dao (Mapper) 接口 --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.dao.BlogMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>insert</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>addblog<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>B<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>insert into blog</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    (id,title,author,create_time,views)</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    values</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>(#&#123;id&#125;,#&#123;title&#125;,#&#123;author&#125;,#&#123;createTime&#125;,#&#123;views&#125;)</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>insert</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">&lt;!--    动态 SQL--></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>queryBlogIF<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>map<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>B<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        select * from blog where 1=1</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>if</span> <span class=\"token attr-name\">test</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>title != null<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            and title = #&#123;title&#125;</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>if</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>if</span> <span class=\"token attr-name\">test</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>author != null<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            and author = #&#123;author&#125;</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>if</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>启用驼峰命名法解决 mysql 中 <code>_</code> 为大写的问题</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-21-09-16-42_20230224211604.png\" alt=\"image_2023-02-21-09-16-42\"></p>\n<p>具体看官方文档:<a href=\"https://mybatis.org/mybatis-3/zh/configuration.html#settings\"> 点击查看</a></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>settings</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">&lt;!--        开启驼峰命名法 --></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>setting</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mapUnderscoreToCamelCase<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>settings</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>Run 结果</p>\n<p>查询条件:</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>map<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"微服务如此简单\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-21-10-37-21_20230224211618.png\" alt=\"image_2023-02-21-10-37-21\"></p>\n<h4 id=\"where元素标签\"><a class=\"markdownIt-Anchor\" href=\"#where元素标签\">#</a> where 元素标签</h4>\n<blockquote>\n<p>where 元素只会在子元素返回任何内容的情况下才插入 &quot;WHERE&quot; 子句，而且，若子句的开头为 &quot;AND&quot; 或 &quot;OR&quot;,where 元素会将它们去除</p>\n</blockquote>\n<ul>\n<li>BlogMapper.xml</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--    动态 SQL--></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>queryBlogIF<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>map<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>B<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        select * from blog</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>where</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>if</span> <span class=\"token attr-name\">test</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>title != null<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            and title = #&#123;title&#125;</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>if</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>if</span> <span class=\"token attr-name\">test</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>author != null<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            and author = #&#123;author&#125;</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>if</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>where</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>Run 结果</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-21-11-33-13_20230224211632.png\" alt=\"image_2023-02-21-11-33-13\"></p>\n<p>正常情况下不适用 where 元素标签的话执行语句为:</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> blog <span class=\"token operator\">and</span> title <span class=\"token operator\">=</span> <span class=\"token comment\">#&#123;title&#125;</span></pre></td></tr></table></figure><p>这个语句会报错，使用 where 元素标签后会将用不到的 and 去除掉</p>\n<p>查询条件有两个时为以下 sql:</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> blog <span class=\"token operator\">and</span> title <span class=\"token operator\">=</span> <span class=\"token comment\">#&#123;title&#125; and author = #&#123;author&#125;</span></pre></td></tr></table></figure><p>如果什么条件都没有则为如下 sql:</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> blog</pre></td></tr></table></figure><h4 id=\"choose-when\"><a class=\"markdownIt-Anchor\" href=\"#choose-when\">#</a> choose when</h4>\n<p>类似于 java 中的 swithc 语句</p>\n<ul>\n<li>BlogMapper.xml</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>queryBlogChoose<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>map<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>B<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        select * from blog</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>where</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>choose</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">&lt;!--                当满足第一个之后不会执行第二个 --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">&lt;!--                类似于 java 中的 if else--></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>when</span> <span class=\"token attr-name\">test</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>title != null<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                    and title = #&#123;title&#125;</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>when</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>when</span> <span class=\"token attr-name\">test</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>author != null<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                    and author = #&#123;author&#125;</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>when</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>otherwise</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                    and views = #&#123;views&#125;</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>otherwise</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>choose</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>where</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h4 id=\"set\"><a class=\"markdownIt-Anchor\" href=\"#set\">#</a> Set</h4>\n<p>Set 元素会动态前置 Set 关键字，同时也会删掉无关的逗号</p>\n<ul>\n<li>BlogMapper.xml</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>update</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>updateBlog<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>map<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        update blog</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>set</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>if</span> <span class=\"token attr-name\">test</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>title != null<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                title = #&#123;title&#125;,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>if</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>if</span> <span class=\"token attr-name\">test</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>author != null<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                author = #&#123;author&#125;,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>if</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>if</span> <span class=\"token attr-name\">test</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>views != null<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                views = #&#123;views&#125;</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>if</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>set</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        where id = #&#123;id&#125;;</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>update</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>所谓的动态 SQL, 本质还是 SQL 语句，只是我们可以在 SQL 层面，去执行一个逻辑代码</strong></p>\n<h3 id=\"foreach-2\"><a class=\"markdownIt-Anchor\" href=\"#foreach-2\">#</a> Foreach</h3>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-21-16-37-49_20230224211648.png\" alt=\"image_2023-02-21-16-37-49\"></p>\n<ul>\n<li>BlogMapper.xml</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--    我们传递一个万能的 Map, 这个 Map 中可以存在一个集合 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getListBlog<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>map<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>B<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        select * from blog</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>where</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">&lt;!--                     集合            id      开始          结尾          分隔 --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>foreach</span> <span class=\"token attr-name\">collection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ids<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">item</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">open</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>and (<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">close</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>)<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">separator</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>or<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                id = #&#123;id&#125;</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>foreach</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>where</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>BlogMapper 接口</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Blog</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getListBlog</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Map</span> map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>测试代码</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test6</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token class-name\">SqlSession</span> sqlsession <span class=\"token operator\">=</span> <span class=\"token class-name\">MybatisUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">BlogMapper</span> mapper <span class=\"token operator\">=</span> sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BlogMapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">Map</span> map <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> ids <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        ids<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        ids<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        ids<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        map<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ids\"</span><span class=\"token punctuation\">,</span>ids<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Blog</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> mapper<span class=\"token punctuation\">.</span><span class=\"token function\">getListBlog</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Blog</span> i<span class=\"token operator\">:</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Run 结果</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-21-17-13-34_20230224211705.png\" alt=\"image_2023-02-21-17-13-34\"></p>\n<p><mark>动态 SQL 就是在拼接 SQL 语句，我们只要保证 SQL 的正确性，按照 SQL 的格式，去排列组合就可以了</mark></p>\n<p>建议:</p>\n<ul>\n<li>先在 MySQL 中写出完整的 SQL, 在对应的去修改成为我们的动态 SQL 实现通用即可</li>\n</ul>\n<h4 id=\"sql片段\"><a class=\"markdownIt-Anchor\" href=\"#sql片段\">#</a> SQL 片段</h4>\n<p>有时候我们可能会将一些公共的部分抽取出来，方便复用</p>\n<p>1. 使用 SQL 标签抽取公共的部分</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--    SQL 代码片段 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>sql</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>if-title-author<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>if</span> <span class=\"token attr-name\">test</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>title != null<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            and title = #&#123;title&#125;</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>if</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>if</span> <span class=\"token attr-name\">test</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>author != null<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            and author = #&#123;author&#125;</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>if</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>sql</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>2. 在需要使用的地方使用 <code>include</code>  标签引用即可</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getList<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>map<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>B<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        select * from blog</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>where</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">&lt;!--            在查询语句中引用 SQL 代码片段来进行语句拼接查询 --></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>include</span> <span class=\"token attr-name\">refid</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>if-title-author<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>include</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>where</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>注意事项:</strong></p>\n<ul>\n<li>\n<p>最好基于单表来定义 SQL 片段！</p>\n</li>\n<li>\n<p>不要存在 where 标签</p>\n</li>\n</ul>\n<h2 id=\"缓存\"><a class=\"markdownIt-Anchor\" href=\"#缓存\">#</a> 缓存</h2>\n<h3 id=\"简介-2\"><a class=\"markdownIt-Anchor\" href=\"#简介-2\">#</a> 简介</h3>\n<ol>\n<li>\n<p>什么是缓存 [Cache]?</p>\n<ul>\n<li>存在内存中的临时数据</li>\n<li>将用户经常查询的数据放在缓存 (内存) 中，用户去查询数据就不用从磁盘上 (关系型数据库文件) 查询，从缓存中查询，从而提高查询效率，解决了高并发系统的性能问题</li>\n</ul>\n</li>\n<li>\n<p>为什么使用缓存？</p>\n<ul>\n<li>减少和数据库的交互次数，减少系统开销，提高系统效率</li>\n</ul>\n</li>\n<li>\n<p>什么样的数据能使用缓存？</p>\n<ul>\n<li>经常查询并且不经常改变的数据</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"mybatis缓存\"><a class=\"markdownIt-Anchor\" href=\"#mybatis缓存\">#</a> MyBatis 缓存</h3>\n<ul>\n<li>\n<p>MyBatis 包含一个非常强大的查询缓存特性，它可以非常方便地定制和配置缓存，缓存可以极大的提升查询效率</p>\n</li>\n<li>\n<p>MyBatis 系统中默认定义了两级缓存:<font style=\"color:red\"><strong>一级缓存</strong></font>和<font style=\"color:red\"><strong>二级缓存</strong></font></p>\n<ul>\n<li>默认情况下，只有一级缓存开启.(SqlSession 级别的缓存，也成为本地缓存)</li>\n<li>二级缓存需要手动开启和配置，它是基于 namespace 级别的缓存</li>\n<li>为了提高扩展性，MyBatis 定义了缓存接口 Cache, 我们可以通过 Cache 接口来自定义二级缓存</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"一级缓存\"><a class=\"markdownIt-Anchor\" href=\"#一级缓存\">#</a> 一级缓存</h3>\n<ul>\n<li>一级缓存也叫本地缓存:\n<ul>\n<li>与数据库同一次会话期间查询到的数据会放在本地缓存中</li>\n<li>以后如果需要获取相同的数据，直接从缓存中拿，没必要再去查询数据库</li>\n</ul>\n</li>\n</ul>\n<p>测试步骤:</p>\n<ol>\n<li>\n<p>开启日志！</p>\n</li>\n<li>\n<p>测试在一个 Session 中查询两次相同记录</p>\n</li>\n<li>\n<p>查看日志</p>\n</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-21-20-41-22_20230224211725.png\" alt=\"image_2023-02-21-20-41-22\"></p>\n<p>缓存失效的情况:</p>\n<p>1. 查询不同的东西</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-21-20-58-11_20230224211738.png\" alt=\"image_2023-02-21-20-58-11\"></p>\n<p>2. 增删改的操作，可能会改变原来的数据，所以必定会刷新缓存！</p>\n<p>3. 查询不同的 Mapper.xml</p>\n<p>4. 手动清理缓存！</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-21-21-00-02_20230224211751.png\" alt=\"image_2023-02-21-21-00-02\"></p>\n<ol start=\"5\">\n<li></li>\n</ol>\n<p>小结:<strong> 一级缓存默认是开启的，只在一次 SqlSession 中有效，也就是拿到连接到关闭连接这个区间段！</strong></p>\n<h3 id=\"二级缓存\"><a class=\"markdownIt-Anchor\" href=\"#二级缓存\">#</a> 二级缓存</h3>\n<ul>\n<li>\n<p>二级缓存也叫全局缓存，一级缓存作用域太低了，所以诞生了二级缓存</p>\n</li>\n<li>\n<p>基于 namespace 级别的缓存，一个名称空间，对应一个二级缓存</p>\n</li>\n<li>\n<p>工作机制</p>\n<ul>\n<li>一个会话查询一条数据，这个数据就会被放在当前会话的一级缓存中</li>\n<li>如果当前会话关闭了，这个会话对应的一级缓存就没了，但我们想要的是，会话关闭了，一级缓存中的数据被保存到二级缓存中</li>\n<li>新的会话查询信息，就可以从二级缓存中获取内容</li>\n<li>不同的 mapper 查出的数据会放在自己对应的缓存 (map) 中</li>\n</ul>\n</li>\n</ul>\n<p>步骤:</p>\n<ol>\n<li>在 mybatis-config.xml 中开启全局缓存</li>\n</ol>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>settings</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">&lt;!--        显示的开启全局缓存 --></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>setting</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>cacheEnabled<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>settings</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ol start=\"2\">\n<li>在要使用二级缓存的 Mapper 中开启</li>\n</ol>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--    在当前 Mapper.xml 中，开启二级缓存 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>cache</span><span class=\"token punctuation\">/></span></span></pre></td></tr></table></figure><p>也可以自定义参数</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--    在当前 Mapper.xml 中，开启二级缓存 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>cache</span> <span class=\"token attr-name\">eviction</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>FIFO<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            <span class=\"token attr-name\">flushInterval</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>6000<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token attr-name\">size</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>512<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token attr-name\">readOnly</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr></table></figure><ol start=\"3\">\n<li>\n<p>测试</p>\n</li>\n<li>\n<p>问题：我们需要将实体类序列化！否则就会报错</p>\n</li>\n</ol>\n<p><code>Caused by: java.io.NotSerializableException: com.dkx.mybatis.pojo.User</code></p>\n<p>将实体类序列化</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> <span class=\"token class-name\">SerialVersionUID</span> <span class=\"token operator\">=</span> <span class=\"token number\">1L</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>创建两个对象来进行测试</strong></p>\n<ul>\n<li>UserMapperTest</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token class-name\">SqlSession</span> sqlsession <span class=\"token operator\">=</span> <span class=\"token class-name\">MybatisUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">UserMapper</span> mapper <span class=\"token operator\">=</span> sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserMapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">User</span> u <span class=\"token operator\">=</span> mapper<span class=\"token punctuation\">.</span><span class=\"token function\">queryUserById</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        sqlsession<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">SqlSession</span> sqlsession1 <span class=\"token operator\">=</span> <span class=\"token class-name\">MybatisUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">UserMapper</span> mapper1 <span class=\"token operator\">=</span> sqlsession1<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserMapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">User</span> u1 <span class=\"token operator\">=</span> mapper1<span class=\"token punctuation\">.</span><span class=\"token function\">queryUserById</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>u1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>u<span class=\"token operator\">==</span>u1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        sqlsession1<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Run 结果</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-21-21-50-14_20230224211810.png\" alt=\"image_2023-02-21-21-50-14\"></p>\n<p>创建了两次对象查询结果两次两个对象肯定是不同的</p>\n<p><strong>使用二级缓存，因为二级缓存在一级缓存死亡后会保存到二级缓存中</strong></p>\n<ul>\n<li>\n<p>UserMapperTest</p>\n<ul>\n<li>还是那个测试类</li>\n</ul>\n</li>\n<li>\n<p>UserMapper.xml</p>\n</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mybatis.dao.UserMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">&lt;!--    在当前 Mapper.xml 中，开启二级缓存 --></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">&lt;!--    只对一个 namespace.xml 文件生效 --></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>cache</span> <span class=\"token attr-name\">eviction</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>FIFO<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>           <span class=\"token attr-name\">flushInterval</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>6000<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>           <span class=\"token attr-name\">size</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>512<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>           <span class=\"token attr-name\">readOnly</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">&lt;!--                                                             手动的设置是否开启缓存 --></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>queryUserById<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>_int<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>U<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">useCache</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        select * from user where id = #&#123;id&#125;</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>Run 结果</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-21-21-53-53_20230224211826.png\" alt=\"image_2023-02-21-21-53-53\"></p>\n<p>查询为同一个</p>\n<p>小结:</p>\n<ul>\n<li>\n<p>只要开启了二级缓存，在同一个 Mapper 下就有效</p>\n</li>\n<li>\n<p>所有的数据都会先放在一级缓存中</p>\n</li>\n<li>\n<p>只有当会话提交，或者关闭的时候，才会提交到二级缓存中</p>\n</li>\n</ul>\n<h3 id=\"缓存原理\"><a class=\"markdownIt-Anchor\" href=\"#缓存原理\">#</a> 缓存原理</h3>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image_2023-02-22-09-15-03_20230224211841.png\" alt=\"image_2023-02-22-09-15-03\"></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--                                            不刷新缓存 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>update</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>updateUser<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>U<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">flushCache</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        update user set name=#&#123;name&#125;,pwd=#&#123;pwd&#125; where id=#&#123;id&#125;</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>update</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h2 id=\"ehcache自定义缓存\"><a class=\"markdownIt-Anchor\" href=\"#ehcache自定义缓存\">#</a> EhCache 自定义缓存</h2>\n<blockquote>\n<p>EhCache 是一个纯 Java 的进程内缓存框架，具有快速，精干等特点，是 Hibernate 中默认的 CacheProvider<br>Ehcache 是一种广泛使用的开源 Java 分布式缓存，主要面向通用缓存</p>\n</blockquote>\n<p>在程序中导包</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.mybatis.caches<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>mybatis-ehcache<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.1.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>在 mapper 中指定使用我们的 ehcache 缓存实现</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--    只对一个 namespace.xml 文件生效 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>cache</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.mybatis.caches.ehcache.EhcacheCache<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr></table></figure><p><strong>使用自定义缓存</strong></p>\n<p>除了上述自定义缓存的方式，你也可以通过实现你自己的缓存，或为其他第三方缓存方案创建适配器，来完全覆盖缓存行为</p>\n<h3 id=\"ehcachexml配置文件\"><a class=\"markdownIt-Anchor\" href=\"#ehcachexml配置文件\">#</a> ehcache.xml 配置文件</h3>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ehcache</span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>xsi</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2001/XMLSchema-instance<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>         <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>noNamespaceSchemaLocation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://ehcache.org/ehcache.xsd<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>         <span class=\"token attr-name\">updateCheck</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>diskStore</span> <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./tmpdir/Tmp_EhCache<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>defaultCache</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token attr-name\">eternal</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token attr-name\">maxElementsInMemory</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>10000<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token attr-name\">overflowToDisk</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token attr-name\">diskPersistent</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token attr-name\">timeToIdleSeconds</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1800<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token attr-name\">timeToLiveSeconds</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>259200<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token attr-name\">memoryStoreEvictionPolicy</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>LRU<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>cache</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>cloud_user<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token attr-name\">eternal</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token attr-name\">maxElementsInMemory</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>5000<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token attr-name\">overflowToDisk</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token attr-name\">diskPersistent</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token attr-name\">timeToIdleSeconds</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1800<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token attr-name\">timeToLiveSeconds</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1800<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token attr-name\">memoryStoreEvictionPolicy</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>LRU<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ehcache</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure>",
            "tags": [
                "mybatis",
                "计算机学科",
                "基础",
                "database"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mybatis/%E4%BD%BF%E7%94%A8MyBatis%E9%9C%80%E8%A6%81%E9%85%8D%E7%BD%AE%E7%9A%84%E9%85%8D%E7%BD%AE/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mybatis/%E4%BD%BF%E7%94%A8MyBatis%E9%9C%80%E8%A6%81%E9%85%8D%E7%BD%AE%E7%9A%84%E9%85%8D%E7%BD%AE/",
            "title": "使用Mybaits需要配置的配置内容",
            "date_published": "2024-04-02T06:23:30.071Z",
            "content_html": "<p>报错:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>java.lang.ExceptionInInitializerError</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tat com.dkx.mybatis01.util.MybatisUtilsTest.test<span class=\"token punctuation\">(</span>MybatisUtilsTest.java:21<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0<span class=\"token punctuation\">(</span>Native Method<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke<span class=\"token punctuation\">(</span>NativeMethodAccessorImpl.java:62<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke<span class=\"token punctuation\">(</span>DelegatingMethodAccessorImpl.java:43<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tat java.base/java.lang.reflect.Method.invoke<span class=\"token punctuation\">(</span>Method.java:566<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tat org.junit.runners.model.FrameworkMethod<span class=\"token variable\">$1</span>.runReflectiveCall<span class=\"token punctuation\">(</span>FrameworkMethod.java:50<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tat org.junit.internal.runners.model.ReflectiveCallable.run<span class=\"token punctuation\">(</span>ReflectiveCallable.java:12<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tat org.junit.runners.model.FrameworkMethod.invokeExplosively<span class=\"token punctuation\">(</span>FrameworkMethod.java:47<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tat org.junit.internal.runners.statements.InvokeMethod.evaluate<span class=\"token punctuation\">(</span>InvokeMethod.java:17<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tat org.junit.runners.ParentRunner.runLeaf<span class=\"token punctuation\">(</span>ParentRunner.java:325<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tat org.junit.runners.BlockJUnit4ClassRunner.runChild<span class=\"token punctuation\">(</span>BlockJUnit4ClassRunner.java:78<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tat org.junit.runners.BlockJUnit4ClassRunner.runChild<span class=\"token punctuation\">(</span>BlockJUnit4ClassRunner.java:57<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tat org.junit.runners.ParentRunner<span class=\"token variable\">$3</span>.run<span class=\"token punctuation\">(</span>ParentRunner.java:290<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tat org.junit.runners.ParentRunner<span class=\"token variable\">$1</span>.schedule<span class=\"token punctuation\">(</span>ParentRunner.java:71<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\tat org.junit.runners.ParentRunner.runChildren<span class=\"token punctuation\">(</span>ParentRunner.java:288<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tat org.junit.runners.ParentRunner.access<span class=\"token variable\">$000</span><span class=\"token punctuation\">(</span>ParentRunner.java:58<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tat org.junit.runners.ParentRunner<span class=\"token variable\">$2</span>.evaluate<span class=\"token punctuation\">(</span>ParentRunner.java:268<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tat org.junit.runners.ParentRunner.run<span class=\"token punctuation\">(</span>ParentRunner.java:363<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tat org.junit.runner.JUnitCore.run<span class=\"token punctuation\">(</span>JUnitCore.java:137<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tat com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs<span class=\"token punctuation\">(</span>JUnit4IdeaTestRunner.java:68<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\tat com.intellij.rt.junit.IdeaTestRunner<span class=\"token variable\">$Repeater</span>.startRunnerWithArgs<span class=\"token punctuation\">(</span>IdeaTestRunner.java:33<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\tat com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart<span class=\"token punctuation\">(</span>JUnitStarter.java:230<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\tat com.intellij.rt.junit.JUnitStarter.main<span class=\"token punctuation\">(</span>JUnitStarter.java:58<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>Caused by: java.lang.RuntimeException: org.apache.ibatis.exceptions.PersistenceException: </pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">### Error building SqlSession.</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">### The error may exist in com/dkx/mybatis01/dao/UserMapper.xml</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">### Cause: org.apache.ibatis.builder.BuilderException: Error parsing SQL Mapper Configuration. Cause: java.io.IOException: Could not find resource com/dkx/mybatis01/dao/UserMapper.xml</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\tat com.dkx.mybatis01.util.MybatisUtils.<span class=\"token operator\">&lt;</span>clinit<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>MybatisUtils.java:26<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t<span class=\"token punctuation\">..</span>. <span class=\"token number\">23</span> <span class=\"token function\">more</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>Caused by: org.apache.ibatis.exceptions.PersistenceException: </pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">### Error building SqlSession.</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">### The error may exist in com/dkx/mybatis01/dao/UserMapper.xml</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\">### Cause: org.apache.ibatis.builder.BuilderException: Error parsing SQL Mapper Configuration. Cause: java.io.IOException: Could not find resource com/dkx/mybatis01/dao/UserMapper.xml</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\tat org.apache.ibatis.exceptions.ExceptionFactory.wrapException<span class=\"token punctuation\">(</span>ExceptionFactory.java:30<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\tat org.apache.ibatis.session.SqlSessionFactoryBuilder.build<span class=\"token punctuation\">(</span>SqlSessionFactoryBuilder.java:80<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\tat org.apache.ibatis.session.SqlSessionFactoryBuilder.build<span class=\"token punctuation\">(</span>SqlSessionFactoryBuilder.java:64<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\tat com.dkx.mybatis01.util.MybatisUtils.<span class=\"token operator\">&lt;</span>clinit<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>MybatisUtils.java:24<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t<span class=\"token punctuation\">..</span>. <span class=\"token number\">23</span> <span class=\"token function\">more</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>Caused by: org.apache.ibatis.builder.BuilderException: Error parsing SQL Mapper Configuration. Cause: java.io.IOException: Could not <span class=\"token function\">find</span> resource com/dkx/mybatis01/dao/UserMapper.xml</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\tat org.apache.ibatis.builder.xml.XMLConfigBuilder.parseConfiguration<span class=\"token punctuation\">(</span>XMLConfigBuilder.java:122<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\tat org.apache.ibatis.builder.xml.XMLConfigBuilder.parse<span class=\"token punctuation\">(</span>XMLConfigBuilder.java:99<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\tat org.apache.ibatis.session.SqlSessionFactoryBuilder.build<span class=\"token punctuation\">(</span>SqlSessionFactoryBuilder.java:78<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t<span class=\"token punctuation\">..</span>. <span class=\"token number\">25</span> <span class=\"token function\">more</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>Caused by: java.io.IOException: Could not <span class=\"token function\">find</span> resource com/dkx/mybatis01/dao/UserMapper.xml</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\tat org.apache.ibatis.io.Resources.getResourceAsStream<span class=\"token punctuation\">(</span>Resources.java:114<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\tat org.apache.ibatis.io.Resources.getResourceAsStream<span class=\"token punctuation\">(</span>Resources.java:100<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\tat org.apache.ibatis.builder.xml.XMLConfigBuilder.mapperElement<span class=\"token punctuation\">(</span>XMLConfigBuilder.java:375<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\tat org.apache.ibatis.builder.xml.XMLConfigBuilder.parseConfiguration<span class=\"token punctuation\">(</span>XMLConfigBuilder.java:120<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t<span class=\"token punctuation\">..</span>. <span class=\"token number\">27</span> <span class=\"token function\">more</span></pre></td></tr></table></figure><p>解决方案:</p>\n<p>maven 由于它的约定大于配置，我们之后可能遇到我们写的配置文件，无法被导出或者生效的问题，解决方案</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- 在 build 中配置 resources, 来防止我们资源导出失败的问题 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>build</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resources</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>directory</span><span class=\"token punctuation\">></span></span>src/main/resources<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>directory</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>includes</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>include</span><span class=\"token punctuation\">></span></span>**/*.properties<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>include</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>include</span><span class=\"token punctuation\">></span></span>**/*.xml<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>include</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>includes</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>filtering</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>filtering</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>directory</span><span class=\"token punctuation\">></span></span>src/main/java<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>directory</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>includes</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>include</span><span class=\"token punctuation\">></span></span>**/*.properties<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>include</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>include</span><span class=\"token punctuation\">></span></span>**/*.xml<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>include</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>includes</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>filtering</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>filtering</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resources</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>build</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h3 id=\"mapperregistry是什么\"><a class=\"markdownIt-Anchor\" href=\"#mapperregistry是什么\">#</a> MapperRegistry 是什么</h3>\n<p>核心配置文件中注册 mappers</p>\n<h3 id=\"可能遇到的问题\"><a class=\"markdownIt-Anchor\" href=\"#可能遇到的问题\">#</a> 可能遇到的问题</h3>\n<ol>\n<li>\n<p>配置文件没有注册</p>\n</li>\n<li>\n<p>绑定接口错误</p>\n</li>\n<li>\n<p>方法名不对</p>\n</li>\n<li>\n<p>返回类型不对</p>\n</li>\n<li>\n<p>Maven 导出资源问题</p>\n</li>\n</ol>\n",
            "tags": [
                "mybatis",
                "计算机学科",
                "database"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mybatis/mybatis-config-xml/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mybatis/mybatis-config-xml/",
            "title": "Mapper-config.xml",
            "date_published": "2024-04-02T06:23:30.066Z",
            "content_html": "<p>resource 目录下的配置文件</p>\n<ul>\n<li>mybatis-config.xml</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Config 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token string\">\"https://mybatis.org/dtd/mybatis-3-config.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environments</span> <span class=\"token attr-name\">default</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environment</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>transactionManager</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JDBC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataSource</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POOLED<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>driver<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;driver&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;url&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;username&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;password&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataSource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environments</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org/mybatis/example/BlogMapper.xml<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>建议直接设置为模板</p>\n",
            "tags": [
                "mybatis",
                "计算机学科",
                "database"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mybatis/Mapper-xml/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mybatis/Mapper-xml/",
            "title": "Mapper.xml",
            "date_published": "2024-04-02T06:23:30.061Z",
            "content_html": "<p>Mapper.xml</p>\n<p>映射的 SQL 语句</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">mapper</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token string\">\"https://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">&lt;!--namespace 绑定一个对应的 Dao (Mapper) 接口 --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.mybatis.example.BlogMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">&lt;!--SQL 语句头标签 --></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">&lt;!--select: 查询语句，id: 对应接口的方法名，parameterType: 参数类型，resultType: 返回值类型 --></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>selectBlog<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>map<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Blog<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    select * from Blog where id = #&#123;id&#125;</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>建议直接设置为模板</p>\n",
            "tags": [
                "mybatis",
                "计算机学科",
                "database"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mongodb/%E6%A1%88%E4%BE%8BDemo/MongoDB%20%E5%88%86%E9%A1%B5/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mongodb/%E6%A1%88%E4%BE%8BDemo/MongoDB%20%E5%88%86%E9%A1%B5/",
            "title": "MongoDB 分页",
            "date_published": "2024-04-02T06:23:30.053Z",
            "content_html": "<h1 id=\"mongodb-分页\"><a class=\"markdownIt-Anchor\" href=\"#mongodb-分页\">#</a> MongoDB 分页</h1>\n<p>数据层：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Repository</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ArticleRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">MongoRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Article</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     * 分页</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     * @param pageable</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token class-name\">Page</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Article</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findAllBy</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Pageable</span> pageable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// 按照条件查询并分页</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// Page&lt;Article> findAllByState(String state, Pageable pageable);</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>业务层接口：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">EssayService</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">R</span> <span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Pageable</span> pageable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>业务层实现：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@AllArgsConstructor</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">EssayServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">EssayService</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token comment\">// 查询全部文章并分页</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">R</span> <span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Pageable</span> pageable<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"data\"</span><span class=\"token punctuation\">,</span> repository<span class=\"token punctuation\">.</span><span class=\"token function\">findAllBy</span><span class=\"token punctuation\">(</span>pageable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 第一个参数就是条件</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// return R.ok().put(\"data\", repository.findAllByState(MongoDels.EX.getCode(), pageable));</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>视图层：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/essay\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@AllArgsConstructor</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">EssayController</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     * 查询全部文章并分页</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"essayAll\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">R</span> <span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Pageable</span> pageable<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">return</span> service<span class=\"token punctuation\">.</span><span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span>pageable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>请求结果：</p>\n<pre><code>&#123;\n    &quot;code&quot;: 200,\n    &quot;data&quot;: &#123;\n        &quot;content&quot;: [\n            &#123;\n                &quot;id&quot;: &quot;660666210c39a27771d075fb&quot;,\n                &quot;content&quot;: &quot;ullamco&quot;,\n                &quot;tags&quot;: [\n                    &quot;ea33&quot;\n                ],\n                &quot;publishtime&quot;: &quot;2024-03-29 14:56:33&quot;,\n                &quot;userid&quot;: &quot;1&quot;,\n                &quot;nickname&quot;: &quot;123&quot;,\n                &quot;createdatatime&quot;: &quot;2024-03-29 14:56:33&quot;,\n                &quot;likenum&quot;: 0,\n                &quot;state&quot;: &quot;0&quot;\n            &#125;\n        ],\n        &quot;pageable&quot;: &#123;\n            &quot;sort&quot;: &#123;\n                &quot;empty&quot;: true,\n                &quot;sorted&quot;: false,\n                &quot;unsorted&quot;: true\n            &#125;,\n            &quot;offset&quot;: 0,\n            &quot;pageSize&quot;: 1,\n            &quot;pageNumber&quot;: 0,\n            &quot;unpaged&quot;: false,\n            &quot;paged&quot;: true\n        &#125;,\n        &quot;last&quot;: true,\n        &quot;totalPages&quot;: 1,\n        &quot;totalElements&quot;: 1,\n        &quot;size&quot;: 1,\n        &quot;number&quot;: 0,\n        &quot;sort&quot;: &#123;\n            &quot;empty&quot;: true,\n            &quot;sorted&quot;: false,\n            &quot;unsorted&quot;: true\n        &#125;,\n        &quot;numberOfElements&quot;: 1,\n        &quot;first&quot;: true,\n        &quot;empty&quot;: false\n    &#125;\n&#125;\n</code></pre>\n",
            "tags": [
                "计算机学科",
                "案例Demo",
                "database",
                "mongodb"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mongodb/MongoDB%E9%9B%86%E7%BE%A4%E5%92%8C%E5%AE%89%E5%85%A8/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mongodb/MongoDB%E9%9B%86%E7%BE%A4%E5%92%8C%E5%AE%89%E5%85%A8/",
            "title": "MongoDB集群和安全",
            "date_published": "2024-04-02T06:23:30.045Z",
            "content_html": "<h1 id=\"mongodb集群和安全\"><a class=\"markdownIt-Anchor\" href=\"#mongodb集群和安全\">#</a> MongoDB 集群和安全</h1>\n<p>学习目标：</p>\n<ul>\n<li>MongoDB 的副本集：操作，主要概念，故障转移，选举规则</li>\n<li>MongoDB 的分片集群：概念，有点，操作，分片策略，故障转移</li>\n<li>MongoDB 的安全认证</li>\n</ul>\n<h2 id=\"副本集-replica-sets\"><a class=\"markdownIt-Anchor\" href=\"#副本集-replica-sets\">#</a> 副本集 - Replica Sets</h2>\n<h3 id=\"简介\"><a class=\"markdownIt-Anchor\" href=\"#简介\">#</a> 简介</h3>\n<p>MongoDB 中的副本集 (Replica Set) 是一组维护相同数据集的 mongod 服务，副本集可提供冗余和高可用性，是所有生产部署的基础。</p>\n<p>也可以说，副本集类似于有自动故障恢复功能的主从集群，通俗的讲就是多台机器进行同一数据的异步同步，从而使多台机器拥有同一数据的多个副本，并且当主库宕掉时在不需要用户干预的情况下自动切换其它备份服务器做主库，而且还可以利用副本服务器做只读服务器，实现读写分离，提高负载</p>\n<p>1. 冗余和数据可用性</p>\n<p>复制提供冗余并提高数据可用性，通过在不同数据库服务器上提供多个数据副本，复制可提供一定级别的容错功能，以防丢失单个数据库服务器。</p>\n<p>在某些情况下，复制可以提供增加的读取性能，因为客户端可以将读取操作发送到不同的服务上，在不同数据中心维护数据副本可以增加分布式应用程序的数据位置和可用性，您还可以为专用目的维护其它副本，例如灾难恢复，报告或备份。</p>\n<p>2.MongoDB 中的复制</p>\n<p>副本集是一组维护相同数据集的 mongod 实例，副本集包含了多个数据承载节点和可选的一个仲载节点，在承载数据节点中，一个且仅一个成员被视为主节点，而其它节点被视为次要（从）节点。<br>\n主节点接受所有写操作，副本集只能有一个主要能够确认具有 {w:“most”} 写入关注的写入；虽然在某些情况下，另一个 mongod 实例可能暂时认为自己也是主要的，主要记录其操作日志中的数据集的所有更改，即 oplog。</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031657901.png\" alt=\"image-20230605120258300\"></p>\n<p>辅助 (副本) 节点复制主节点的 oplog 并将操作应用于其数据集，以使辅助节点的数据集反射主节点的数据集，如果主要人员不在，则符合条件的中学将举行选举以选出新的主要人员</p>\n<p>3. 主从复制和副本集区别</p>\n<p>主从集群和副本集最大的区别就是副本集没有固定的 &quot;主节点&quot;；整个集群会选出一个 &quot;主节点&quot;，当其挂掉后，又在剩下的从节点中选中其它节点为 &quot;主节点&quot;，副本集总有一个活跃点 (主，primary) 和一个或多个备份节点 (从，secondary)。</p>\n<h2 id=\"副本集的三个角色\"><a class=\"markdownIt-Anchor\" href=\"#副本集的三个角色\">#</a> 副本集的三个角色</h2>\n<p>副本集有两种类型三种角色</p>\n<p>两种类型：</p>\n<ul>\n<li>主节点 (primary) 类型：数据操作的主要连接点，可读写。</li>\n<li>次要 (辅助，从) 节点 (Secondaries) 类型：数据冗余备份节点，可以读或选举</li>\n</ul>\n<p>三种角色</p>\n<p>主要成员 (Primary)：主要接受所有写操作，就是主节点</p>\n<p>副本成员 (Replicate)：从主节点通过复制操作以维护相同的数据集，即备份数据，不可写操作，但可以读操作 (但需要配置)。是默认的一种从节点类型</p>\n<p>仲裁者 (Arbiter)：不保留任何数据的副本，只具有投票选举作用，当然也可以将仲载服务器维护为副本集的一部分，即副本成员同时也是仲载者，也是一种从节点类型</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031656412.png\" alt=\"image-20230605121334168\"></p>\n<p>一<mark>主</mark>一<mark>副</mark>一<mark>仲载</mark></p>\n<h2 id=\"副本集的创建\"><a class=\"markdownIt-Anchor\" href=\"#副本集的创建\">#</a> 副本集的创建</h2>\n<h3 id=\"第一步创建主节点\"><a class=\"markdownIt-Anchor\" href=\"#第一步创建主节点\">#</a> 第一步创建主节点</h3>\n<p>建立存放数据和日志的目录</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#----------myrs</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#主节点</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/replica_sets/myrs_27017/log <span class=\"token punctuation\">\\</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/replica_sets/myrs_27017/data/db</pre></td></tr></table></figure><p>新建或修改配置文件：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> /mongodb/replica_sets/myrs_27017/mongod.conf</pre></td></tr></table></figure><p>往配置文件中写入配置信息</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">systemLog</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token comment\">#MongoDB 发送所有日志输出的目标指定为文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\">#The path of the log file to which mongod or mongos should send all diagnostic logging information</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> <span class=\"token key atrule\">destination</span><span class=\"token punctuation\">:</span> file</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token comment\">#mongod 或 mongos 应向其发送所有诊断日志记录信息的日志文件的路径</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/mongodb/replica_sets/myrs_27017/log/mongod.log\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token comment\">#当 mongos 或 mongod 实例重新启动时，mongos 或 mongod 会将新条目附加到现有日志文件的末尾。</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> <span class=\"token key atrule\">logAppend</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token comment\">#mongod 实例存储其数据的目录。storage.dbPath 设置仅适用于 mongod。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> <span class=\"token comment\">#The directory where the mongod instance stores its data.Defaul value is \"/data/db\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> <span class=\"token key atrule\">dbPath</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/mongodb/replica_sets/myrs_27017/data/db\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> <span class=\"token key atrule\">journal</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token comment\">#启用或禁用持久性日志以确保数据文件保持有效和可恢复</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token key atrule\">processManagement</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token comment\">#启用在后台运行 mongos 或 mongod 进程的守护进程模式。</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> <span class=\"token key atrule\">fork</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre> <span class=\"token comment\">#指定用于保存 mongos 或 mongod 进程的进行 ID 的文件位置，其中 mongos 或 mongod 将写入其 PID</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre> <span class=\"token key atrule\">pidFilePath</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/mongodb/replica_sets/myrs_27017/log/mongod.pid\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token key atrule\">net</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token comment\">#服务实例绑定 IP，默认是 localhost</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre> <span class=\"token key atrule\">bindIp</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">,</span>192.168.244.142</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token comment\">#bindIp</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token comment\">#绑定的端口，默认是 27017</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">27017</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token key atrule\">replication</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre> <span class=\"token comment\">#副本集的名称</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre> <span class=\"token key atrule\">replSetName</span><span class=\"token punctuation\">:</span> myrs</pre></td></tr></table></figure><h3 id=\"第二步创建副本节点\"><a class=\"markdownIt-Anchor\" href=\"#第二步创建副本节点\">#</a> 第二步：创建副本节点</h3>\n<p>建立存放目录</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#----------myrs</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#主节点</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/replica_sets/myrs_27018/log <span class=\"token punctuation\">\\</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/replica_sets/myrs_27018/data/db</pre></td></tr></table></figure><p>新建或修改配置文件:</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> /mongodb/replica_sets/myrs_27018/mongod.conf</pre></td></tr></table></figure><p>往配置文件中写入配置信息</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">systemLog</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token comment\">#MongoDB 发送所有日志输出的目标指定为文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\">#The path of the log file to which mongod or mongos should send all diagnostic logging information</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> <span class=\"token key atrule\">destination</span><span class=\"token punctuation\">:</span> file</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token comment\">#mongod 或 mongos 应向其发送所有诊断日志记录信息的日志文件的路径</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/mongodb/replica_sets/myrs_27018/log/mongod.log\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token comment\">#当 mongos 或 mongod 实例重新启动时，mongos 或 mongod 会将新条目附加到现有日志文件的末尾。</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> <span class=\"token key atrule\">logAppend</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token comment\">#mongod 实例存储其数据的目录。storage.dbPath 设置仅适用于 mongod。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> <span class=\"token comment\">#The directory where the mongod instance stores its data.Defaul value is \"/data/db\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> <span class=\"token key atrule\">dbPath</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/mongodb/replica_sets/myrs_27018/data/db\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> <span class=\"token key atrule\">journal</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token comment\">#启用或禁用持久性日志以确保数据文件保持有效和可恢复</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token key atrule\">processManagement</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token comment\">#启用在后台运行 mongos 或 mongod 进程的守护进程模式。</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> <span class=\"token key atrule\">fork</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre> <span class=\"token comment\">#指定用于保存 mongos 或 mongod 进程的进行 ID 的文件位置，其中 mongos 或 mongod 将写入其 PID</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre> <span class=\"token key atrule\">pidFilePath</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/mongodb/replica_sets/myrs_27018/log/mongod.pid\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token key atrule\">net</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token comment\">#服务实例绑定 IP，默认是 localhost</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre> <span class=\"token key atrule\">bindIp</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">,</span>192.168.244.142</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token comment\">#bindIp</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token comment\">#绑定的端口，默认是 27017</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">27018</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token key atrule\">replication</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre> <span class=\"token comment\">#副本集的名称</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre> <span class=\"token key atrule\">replSetName</span><span class=\"token punctuation\">:</span> myrs</pre></td></tr></table></figure><h3 id=\"第三步创建仲载节点\"><a class=\"markdownIt-Anchor\" href=\"#第三步创建仲载节点\">#</a> 第三步：创建仲载节点</h3>\n<p>建立存放目录</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#----------myrs</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#主节点</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/replica_sets/myrs_27019/log <span class=\"token punctuation\">\\</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/replica_sets/myrs_27019/data/db</pre></td></tr></table></figure><p>新建或修改配置文件</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> /mongodb/replica_sets/myrs_27019/mongod.conf</pre></td></tr></table></figure><p>往配置中写入配置信息</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">systemLog</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token comment\">#MongoDB 发送所有日志输出的目标指定为文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\">#The path of the log file to which mongod or mongos should send all diagnostic logging information</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> <span class=\"token key atrule\">destination</span><span class=\"token punctuation\">:</span> file</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token comment\">#mongod 或 mongos 应向其发送所有诊断日志记录信息的日志文件的路径</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/mongodb/replica_sets/myrs_27019/log/mongod.log\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token comment\">#当 mongos 或 mongod 实例重新启动时，mongos 或 mongod 会将新条目附加到现有日志文件的末尾。</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> <span class=\"token key atrule\">logAppend</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token comment\">#mongod 实例存储其数据的目录。storage.dbPath 设置仅适用于 mongod。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> <span class=\"token comment\">#The directory where the mongod instance stores its data.Defaul value is \"/data/db\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> <span class=\"token key atrule\">dbPath</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/mongodb/replica_sets/myrs_27019/data/db\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> <span class=\"token key atrule\">journal</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token comment\">#启用或禁用持久性日志以确保数据文件保持有效和可恢复</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token key atrule\">processManagement</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token comment\">#启用在后台运行 mongos 或 mongod 进程的守护进程模式。</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> <span class=\"token key atrule\">fork</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre> <span class=\"token comment\">#指定用于保存 mongos 或 mongod 进程的进行 ID 的文件位置，其中 mongos 或 mongod 将写入其 PID</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre> <span class=\"token key atrule\">pidFilePath</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/mongodb/replica_sets/myrs_27019/log/mongod.pid\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token key atrule\">net</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token comment\">#服务实例绑定 IP，默认是 localhost</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre> <span class=\"token key atrule\">bindIp</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">,</span>192.168.244.142</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token comment\">#bindIp</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token comment\">#绑定的端口，默认是 27017</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">27019</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token key atrule\">replication</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre> <span class=\"token comment\">#副本集的名称</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre> <span class=\"token key atrule\">replSetName</span><span class=\"token punctuation\">:</span> myrs</pre></td></tr></table></figure><p>启动节点</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>dkx0@192<span class=\"token punctuation\">]</span>~% /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27017/log/mongod.conf </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>forked process: <span class=\"token number\">5300</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>dkx0@192<span class=\"token punctuation\">]</span>~% /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27018/log/mongod.conf </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>forked process: <span class=\"token number\">5367</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>dkx0@192<span class=\"token punctuation\">]</span>~% /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27019/log/mongod.conf </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>forked process: <span class=\"token number\">5434</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>dkx0@192<span class=\"token punctuation\">]</span>~%</pre></td></tr></table></figure><p>查看 mongod 进程</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>dkx0@192<span class=\"token punctuation\">]</span>~% <span class=\"token function\">ps</span> -ef<span class=\"token operator\">|</span><span class=\"token function\">grep</span> mongod<span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token parameter variable\">-v</span> <span class=\"token function\">grep</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>dkx0       <span class=\"token number\">5300</span>      <span class=\"token number\">1</span>  <span class=\"token number\">4</span> 03:05 ?        00:00:04 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27017/log/mongod.conf</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>dkx0       <span class=\"token number\">5367</span>      <span class=\"token number\">1</span>  <span class=\"token number\">5</span> 03:05 ?        00:00:04 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27018/log/mongod.conf</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>dkx0       <span class=\"token number\">5434</span>      <span class=\"token number\">1</span>  <span class=\"token number\">8</span> 03:05 ?        00:00:05 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27019/log/mongod.conf</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>dkx0@192<span class=\"token punctuation\">]</span>~%</pre></td></tr></table></figure><h3 id=\"第四步初始化配置副本集和主节点\"><a class=\"markdownIt-Anchor\" href=\"#第四步初始化配置副本集和主节点\">#</a> 第四步：初始化配置副本集和主节点</h3>\n<p>使用客户端命令连接任意一个节点，但这里尽量要连接主节点 (27017 节点)：</p>\n<p>在 mongodb 的 bin 目录下执行命令：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongo <span class=\"token parameter variable\">--host</span><span class=\"token operator\">=</span>Linux主机地址 <span class=\"token parameter variable\">--port</span><span class=\"token operator\">=</span><span class=\"token number\">27017</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>E:<span class=\"token punctuation\">\\</span>MongoDB<span class=\"token punctuation\">\\</span>mongodb-win32-x86_64-windows-5.0.17<span class=\"token punctuation\">\\</span>bin<span class=\"token operator\">></span>mongo <span class=\"token parameter variable\">--host</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.244.142 <span class=\"token parameter variable\">--port</span><span class=\"token operator\">=</span><span class=\"token number\">27017</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>MongoDB shell version v5.0.17</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>connecting to: mongodb://192.168.244.142:27017/?compressors<span class=\"token operator\">=</span>disabled<span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">gssapiServiceName</span><span class=\"token operator\">=</span>mongodb</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Implicit session: session <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"id\"</span> <span class=\"token builtin class-name\">:</span> UUID<span class=\"token punctuation\">(</span><span class=\"token string\">\"7149483c-b50d-4e69-8086-b2c913d293e3\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>MongoDB server version: <span class=\"token number\">5.0</span>.18</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Warning: the <span class=\"token string\">\"mongo\"</span> shell has been superseded by <span class=\"token string\">\"mongosh\"</span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">which</span> delivers improved usability and compatibility.The <span class=\"token string\">\"mongo\"</span> shell has been deprecated and will be removed <span class=\"token keyword\">in</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>an upcoming release.</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>For installation instructions, see</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>https://docs.mongodb.com/mongodb-shell/install/</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>---</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>The server generated these startup warnings when booting:</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token number\">2023</span>-06-06T03:05:22.021-04:00: Access control is not enabled <span class=\"token keyword\">for</span> the database. Read and <span class=\"token function\">write</span> access to data and configuration is unrestricted</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token number\">2023</span>-06-06T03:05:22.021-04:00: /sys/kernel/mm/transparent_hugepage/enabled is <span class=\"token string\">'always'</span><span class=\"token builtin class-name\">.</span> We suggest setting it to <span class=\"token string\">'never'</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token number\">2023</span>-06-06T03:05:22.021-04:00: /sys/kernel/mm/transparent_hugepage/defrag is <span class=\"token string\">'always'</span><span class=\"token builtin class-name\">.</span> We suggest setting it to <span class=\"token string\">'never'</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token number\">2023</span>-06-06T03:05:22.021-04:00: Soft rlimits <span class=\"token keyword\">for</span> <span class=\"token function\">open</span> <span class=\"token function\">file</span> descriptors too low</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token number\">2023</span>-06-06T03:05:22.021-04:00:         currentValue: <span class=\"token number\">1024</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token number\">2023</span>-06-06T03:05:22.021-04:00:         recommendedMinimum: <span class=\"token number\">64000</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>---</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token operator\">></span> show dbs</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>uncaught exception: Error: listDatabases failed:<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token string\">\"topologyVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                <span class=\"token string\">\"processId\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647edab0454f9ab55a0c8f43\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token string\">\"counter\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token string\">\"errmsg\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"not master and slaveOk=false\"</span>,</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token string\">\"code\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">13435</span>,</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token string\">\"codeName\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"NotPrimaryNoSecondaryOk\"</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token builtin class-name\">:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>_getErrorWithCode@src/mongo/shell/utils.js:25:13</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>Mongo.prototype.getDBs/<span class=\"token operator\">&lt;</span>@src/mongo/shell/mongo.js:145:19</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>Mongo.prototype.getDBs@src/mongo/shell/mongo.js:97:12</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>shellHelper.show@src/mongo/shell/utils.js:956:13</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>shellHelper@src/mongo/shell/utils.js:838:15</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>@<span class=\"token punctuation\">(</span>shellhelp2<span class=\"token punctuation\">)</span>:1:1</pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token operator\">></span> show tables</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>uncaught exception: Error: listCollections failed: <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token string\">\"topologyVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                <span class=\"token string\">\"processId\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647edab0454f9ab55a0c8f43\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                <span class=\"token string\">\"counter\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token string\">\"errmsg\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"not master and slaveOk=false\"</span>,</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token string\">\"code\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">13435</span>,</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token string\">\"codeName\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"NotPrimaryNoSecondaryOk\"</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token builtin class-name\">:</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>_getErrorWithCode@src/mongo/shell/utils.js:25:13</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>DB.prototype._getCollectionInfosCommand@src/mongo/shell/db.js:723:15</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>DB.prototype.getCollectionInfos@src/mongo/shell/db.js:771:16</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>shellHelper.show@src/mongo/shell/utils.js:943:9</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>shellHelper@src/mongo/shell/utils.js:838:15</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>@<span class=\"token punctuation\">(</span>shellhelp2<span class=\"token punctuation\">)</span>:1:1</pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>结果，连接上之后，很多命令无法使用，比如 <code>show dbs，show tables</code>  等，必须初始化副本集才行</p>\n<p>准备初始化新的副本集：</p>\n<p>语法：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rs.initiate<span class=\"token punctuation\">(</span>configuration<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>选项：</p>\n<table>\n<caption id=\"\" style=\"caption-side: bottom\">示例</caption>\n<thead>\n<tr>\n<th>Parameter</th>\n<th>Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>configuration</td>\n<td>document</td>\n<td>Optional.A document that specifiles configuration for the new replicaset. if a configuration is not specifiled,MongoDB uses a default replicaset configuration</td>\n</tr>\n</tbody>\n</table>\n<p>使用默认的配置来初始化副本集：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rs.initiate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>执行结果：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> rs.<span class=\"token function-name function\">initiate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string\">\"info2\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"no configuration specified. Using a default configuration for the set\"</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"me\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27017\"</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>提示：</p>\n<ol>\n<li>&quot;ok&quot; 的值为 1，说明创建成功</li>\n<li>命令行提示符发生变化，变成了一个从节点角色，此时默认不能读写，稍等片刻，回车，变成主节点。</li>\n</ol>\n<h3 id=\"第五步查看副本集的配置内容\"><a class=\"markdownIt-Anchor\" href=\"#第五步查看副本集的配置内容\">#</a> 第五步：查看副本集的配置内容</h3>\n<p>说明：</p>\n<p>返回包含当前副本集配置的文档</p>\n<p>语法：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rs.conf<span class=\"token punctuation\">(</span>configuration<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>提示：</p>\n<p><code>rs.config()</code>  是该方法的别名</p>\n<p>configuration：可选，如果没有位置，则使用默认主节点配置</p>\n<p>[示例]</p>\n<p>在 27017 上执行副本集中当前节点的默认节点配置</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> rs.<span class=\"token function-name function\">conf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myrs\"</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"version\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token string\">\"term\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token string\">\"members\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                        <span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27017\"</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                        <span class=\"token string\">\"arbiterOnly\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                        <span class=\"token string\">\"buildIndexes\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                        <span class=\"token string\">\"hidden\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                        <span class=\"token string\">\"priority\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                        <span class=\"token string\">\"tags\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                        <span class=\"token string\">\"secondaryDelaySecs\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                        <span class=\"token string\">\"votes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">]</span>,</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token string\">\"protocolVersion\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token string\">\"writeConcernMajorityJournalDefault\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token string\">\"settings\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token string\">\"chainingAllowed\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                <span class=\"token string\">\"heartbeatIntervalMillis\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2000</span>,</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token string\">\"heartbeatTimeoutSecs\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">10</span>,</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token string\">\"electionTimeoutMillis\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">10000</span>,</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token string\">\"catchUpTimeoutMillis\"</span> <span class=\"token builtin class-name\">:</span> -1,</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                <span class=\"token string\">\"catchUpTakeoverDelayMillis\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">30000</span>,</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token string\">\"getLastErrorModes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token string\">\"getLastErrorDefaults\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                        <span class=\"token string\">\"w\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                        <span class=\"token string\">\"wtimeout\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token string\">\"replicaSetId\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647edd5c454f9ab55a0c8fbf\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>说明：</p>\n<ol>\n<li><code>&quot;_id&quot;:&quot;myrs&quot;</code> ：副本集的配置数据存储的主键值，默认就是副本集的名字</li>\n<li><code>&quot;members&quot;</code> ：副本集成员数组，此时只有一个： <code>&quot;host&quot;:&quot;180.76.159.126:27017&quot;</code> ，该成员不是仲载节点 <code>&quot;arbiterOnly&quot;:false</code> ，优先级 (权重值)： <code>&quot;priority&quot;:1</code></li>\n<li><code>&quot;settings&quot;</code> ：副本集的参数配置。</li>\n</ol>\n<p>提示：副本集配置的查看命令，本质是查询的是 <code>system.replset</code>  的表中的数据</p>\n<h3 id=\"第六步查看副本集状态\"><a class=\"markdownIt-Anchor\" href=\"#第六步查看副本集状态\">#</a> 第六步：查看副本集状态</h3>\n<p>检查副本集状态</p>\n<p>说明：</p>\n<p>返回包含状态信息的文档 ，此输出使用从副本集的其它成员发送的心跳包中获得的数据反映副本集的当前状态。</p>\n<p>语法：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rs.status<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>[示例]</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> rs.<span class=\"token function-name function\">status</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string\">\"set\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myrs\"</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"date\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:27:48.740Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token string\">\"myState\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token string\">\"term\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token string\">\"syncSourceHost\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token string\">\"syncSourceId\"</span> <span class=\"token builtin class-name\">:</span> -1,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token string\">\"heartbeatIntervalMillis\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token string\">\"majorityVoteCount\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token string\">\"writeMajorityCount\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token string\">\"votingMembersCount\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token string\">\"writableVotingMembersCount\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token string\">\"optimes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token string\">\"lastCommittedOpTime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                        <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686036465</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                        <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token string\">\"lastCommittedWallTime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:27:45.336Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token string\">\"readConcernMajorityOpTime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                        <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686036465</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                        <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token string\">\"appliedOpTime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                        <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686036465</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                        <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token string\">\"durableOpTime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                        <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686036465</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                        <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token string\">\"lastAppliedWallTime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:27:45.336Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token string\">\"lastDurableWallTime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:27:45.336Z\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token string\">\"lastStableRecoveryTimestamp\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686036455</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token string\">\"electionCandidateMetrics\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token string\">\"lastElectionReason\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"electionTimeout\"</span>,</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token string\">\"lastElectionDate\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:16:45.057Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token string\">\"electionTerm\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token string\">\"lastCommittedOpTimeAtElection\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                        <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686035805</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                        <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span>-1<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token string\">\"lastSeenOpTimeAtElection\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                        <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686035805</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                        <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span>-1<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                <span class=\"token string\">\"numVotesNeeded\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token string\">\"priorityAtElection\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token string\">\"electionTimeoutMillis\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">10000</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token string\">\"newTermStartDate\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:16:45.091Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token string\">\"wMajorityWriteAvailabilityDate\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:16:45.106Z\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token string\">\"members\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                        <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27017\"</span>,</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                        <span class=\"token string\">\"health\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                        <span class=\"token string\">\"state\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                        <span class=\"token string\">\"stateStr\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"PRIMARY\"</span>,</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                        <span class=\"token string\">\"uptime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1348</span>,</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                        <span class=\"token string\">\"optime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                                <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686036465</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                                <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                        <span class=\"token string\">\"optimeDate\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:27:45Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                        <span class=\"token string\">\"lastAppliedWallTime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:27:45.336Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                        <span class=\"token string\">\"lastDurableWallTime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:27:45.336Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                        <span class=\"token string\">\"syncSourceHost\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span>,</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                        <span class=\"token string\">\"syncSourceId\"</span> <span class=\"token builtin class-name\">:</span> -1,</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                        <span class=\"token string\">\"infoMessage\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span>,</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                        <span class=\"token string\">\"electionTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686035805</span>, <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                        <span class=\"token string\">\"electionDate\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:16:45Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                        <span class=\"token string\">\"configVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                        <span class=\"token string\">\"configTerm\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                        <span class=\"token string\">\"self\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                        <span class=\"token string\">\"lastHeartbeatMessage\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>        <span class=\"token punctuation\">]</span>,</pre></td></tr><tr><td data-num=\"80\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"81\"></td><td><pre>        <span class=\"token string\">\"<span class=\"token variable\">$clusterTime</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>                <span class=\"token string\">\"clusterTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686036465</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"83\"></td><td><pre>                <span class=\"token string\">\"signature\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>                        <span class=\"token string\">\"hash\"</span> <span class=\"token builtin class-name\">:</span> BinData<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>,<span class=\"token string\">\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"85\"></td><td><pre>                        <span class=\"token string\">\"keyId\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"88\"></td><td><pre>        <span class=\"token string\">\"operationTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686036465</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>说明：</p>\n<ol>\n<li><code>&quot;set&quot;:&quot;myrs&quot;</code> ：副本集的名字</li>\n<li><code>&quot;myState&quot;:1</code> ：说明状态正常</li>\n<li><code>&quot;members&quot;</code> ：副本集成员数组，此时只有一个： <code>&quot;name&quot;:192.168.244.142:27017</code> ，该成员的角色是 <code>&quot;stateStr&quot;:&quot;PRIMARY&quot;</code> ，该节点是健康的： <code>&quot;health&quot;:1</code></li>\n</ol>\n<h3 id=\"第七步添加副本从节点\"><a class=\"markdownIt-Anchor\" href=\"#第七步添加副本从节点\">#</a> 第七步：添加副本从节点</h3>\n<p>在主节点添加从节点，将其它成员加入到副本集</p>\n<p>语法：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rs.add<span class=\"token punctuation\">(</span>host,arbiterOnly<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>选项：</p>\n<table>\n<thead>\n<tr>\n<th>Paraemter</th>\n<th>Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>host</td>\n<td>string or document</td>\n<td>要添加到副本集的新成员，指定为字符串或配置文档。1. 如果是一个字符串，则需要指定新成员的主机名和可选的端口号。2. 如果是一个文档，请指定在 members 数组中找到的副本集成员配置文档，您必须在成员配置文档中指定主机字段，有关文档配置字段的说明，详见下方文档：“主机成员的配置文档”</td>\n</tr>\n<tr>\n<td>arbiterOnly</td>\n<td>boolean</td>\n<td>可选的。仅在<host>值为字符串时适用。如果为 true，则添加的主机是仲载者</td>\n</tr>\n</tbody>\n</table>\n<p>主机成员的配置文档：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t_id: <span class=\"token operator\">&lt;</span>int<span class=\"token operator\">></span>,</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\thost: <span class=\"token operator\">&lt;</span>String<span class=\"token operator\">></span>,\t\t//required</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tarbiterOnly: <span class=\"token operator\">&lt;</span>boolean<span class=\"token operator\">></span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tbuildIndexes: <span class=\"token operator\">&lt;</span>boolean<span class=\"token operator\">></span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\thidden: <span class=\"token operator\">&lt;</span>boolean<span class=\"token operator\">></span>,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tpriority: <span class=\"token operator\">&lt;</span>number<span class=\"token operator\">></span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\ttags: <span class=\"token operator\">&lt;</span>document<span class=\"token operator\">></span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tslaveDelay: <span class=\"token operator\">&lt;</span>int<span class=\"token operator\">></span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tvotes: <span class=\"token operator\">&lt;</span>number<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>[示例]</p>\n<p>将 27018 的副本节点添加到副本集中：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> rs.add<span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.244.142:27018\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"<span class=\"token variable\">$clusterTime</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token string\">\"clusterTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686037410</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token string\">\"signature\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                        <span class=\"token string\">\"hash\"</span> <span class=\"token builtin class-name\">:</span> BinData<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>,<span class=\"token string\">\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                        <span class=\"token string\">\"keyId\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token string\">\"operationTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686037410</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>说明：</p>\n<ol>\n<li><code>&quot;ok&quot;:1</code> ：说明添加成功。</li>\n</ol>\n<p>查看副本集状态：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> rs.<span class=\"token function-name function\">status</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string\">\"set\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myrs\"</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"date\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:47:19.794Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token string\">\"myState\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token string\">\"term\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token string\">\"syncSourceHost\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token string\">\"syncSourceId\"</span> <span class=\"token builtin class-name\">:</span> -1,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token string\">\"heartbeatIntervalMillis\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token string\">\"majorityVoteCount\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token string\">\"writeMajorityCount\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token string\">\"votingMembersCount\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token string\">\"writableVotingMembersCount\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token string\">\"optimes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token string\">\"lastCommittedOpTime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                        <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686037635</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                        <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token string\">\"lastCommittedWallTime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:47:15.489Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token string\">\"readConcernMajorityOpTime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                        <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686037635</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                        <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token string\">\"appliedOpTime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                        <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686037635</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                        <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token string\">\"durableOpTime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                        <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686037635</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                        <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token string\">\"lastAppliedWallTime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:47:15.489Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token string\">\"lastDurableWallTime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:47:15.489Z\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token string\">\"lastStableRecoveryTimestamp\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686037605</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token string\">\"electionCandidateMetrics\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token string\">\"lastElectionReason\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"electionTimeout\"</span>,</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token string\">\"lastElectionDate\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:16:45.057Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token string\">\"electionTerm\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token string\">\"lastCommittedOpTimeAtElection\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                        <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686035805</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                        <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span>-1<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token string\">\"lastSeenOpTimeAtElection\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                        <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686035805</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                        <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span>-1<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                <span class=\"token string\">\"numVotesNeeded\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token string\">\"priorityAtElection\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token string\">\"electionTimeoutMillis\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">10000</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token string\">\"newTermStartDate\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:16:45.091Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token string\">\"wMajorityWriteAvailabilityDate\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:16:45.106Z\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token string\">\"members\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                        <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27017\"</span>,</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                        <span class=\"token string\">\"health\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                        <span class=\"token string\">\"state\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                        <span class=\"token string\">\"stateStr\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"PRIMARY\"</span>,</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                        <span class=\"token string\">\"uptime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2519</span>,</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                        <span class=\"token string\">\"optime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                                <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686037635</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                                <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                        <span class=\"token string\">\"optimeDate\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:47:15Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                        <span class=\"token string\">\"lastAppliedWallTime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:47:15.489Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                        <span class=\"token string\">\"lastDurableWallTime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:47:15.489Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                        <span class=\"token string\">\"syncSourceHost\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span>,</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                        <span class=\"token string\">\"syncSourceId\"</span> <span class=\"token builtin class-name\">:</span> -1,</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                        <span class=\"token string\">\"infoMessage\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span>,</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                        <span class=\"token string\">\"electionTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686035805</span>, <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                        <span class=\"token string\">\"electionDate\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:16:45Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                        <span class=\"token string\">\"configVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">3</span>,</pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                        <span class=\"token string\">\"configTerm\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                        <span class=\"token string\">\"self\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                        <span class=\"token string\">\"lastHeartbeatMessage\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"79\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>                        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"81\"></td><td><pre>                        <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27018\"</span>,</pre></td></tr><tr><td data-num=\"82\"></td><td><pre>                        <span class=\"token string\">\"health\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"83\"></td><td><pre>                        <span class=\"token string\">\"state\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"84\"></td><td><pre>                        <span class=\"token string\">\"stateStr\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"SECONDARY\"</span>,</pre></td></tr><tr><td data-num=\"85\"></td><td><pre>                        <span class=\"token string\">\"uptime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">229</span>,</pre></td></tr><tr><td data-num=\"86\"></td><td><pre>                        <span class=\"token string\">\"optime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>                                <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686037635</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"88\"></td><td><pre>                                <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"90\"></td><td><pre>                        <span class=\"token string\">\"optimeDurable\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>                                <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686037635</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"92\"></td><td><pre>                                <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"94\"></td><td><pre>                        <span class=\"token string\">\"optimeDate\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:47:15Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"95\"></td><td><pre>                        <span class=\"token string\">\"optimeDurableDate\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:47:15Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"96\"></td><td><pre>                        <span class=\"token string\">\"lastAppliedWallTime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:47:15.489Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"97\"></td><td><pre>                        <span class=\"token string\">\"lastDurableWallTime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:47:15.489Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"98\"></td><td><pre>                        <span class=\"token string\">\"lastHeartbeat\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:47:18.948Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"99\"></td><td><pre>                        <span class=\"token string\">\"lastHeartbeatRecv\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:47:19.436Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"100\"></td><td><pre>                        <span class=\"token string\">\"pingMs\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"101\"></td><td><pre>                        <span class=\"token string\">\"lastHeartbeatMessage\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span>,</pre></td></tr><tr><td data-num=\"102\"></td><td><pre>                        <span class=\"token string\">\"syncSourceHost\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27017\"</span>,</pre></td></tr><tr><td data-num=\"103\"></td><td><pre>                        <span class=\"token string\">\"syncSourceId\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"104\"></td><td><pre>                        <span class=\"token string\">\"infoMessage\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span>,</pre></td></tr><tr><td data-num=\"105\"></td><td><pre>                        <span class=\"token string\">\"configVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">3</span>,</pre></td></tr><tr><td data-num=\"106\"></td><td><pre>                        <span class=\"token string\">\"configTerm\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>        <span class=\"token punctuation\">]</span>,</pre></td></tr><tr><td data-num=\"109\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"110\"></td><td><pre>        <span class=\"token string\">\"<span class=\"token variable\">$clusterTime</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>                <span class=\"token string\">\"clusterTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686037635</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"112\"></td><td><pre>                <span class=\"token string\">\"signature\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>                        <span class=\"token string\">\"hash\"</span> <span class=\"token builtin class-name\">:</span> BinData<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>,<span class=\"token string\">\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"114\"></td><td><pre>                        <span class=\"token string\">\"keyId\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"117\"></td><td><pre>        <span class=\"token string\">\"operationTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686037635</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><h3 id=\"第八步添加仲载从节点\"><a class=\"markdownIt-Anchor\" href=\"#第八步添加仲载从节点\">#</a> 第八步：添加仲载从节点</h3>\n<p>添加一个仲载节点到副本集</p>\n<p>语法：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rs.addArb<span class=\"token punctuation\">(</span>host<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>将 27019 的仲载节点添加到副本集中：</p>\n<p>如果执行命令后没有反应解决办法如下：在主节点中:mys:PRIMARY 执行命令</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.adminCommand<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"setDefaultRWConcern\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,<span class=\"token string\">\"defaultWriteConcern\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"w\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> rs.addArb<span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.244.142:27019\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"<span class=\"token variable\">$clusterTime</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token string\">\"clusterTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686038253</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token string\">\"signature\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                        <span class=\"token string\">\"hash\"</span> <span class=\"token builtin class-name\">:</span> BinData<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>,<span class=\"token string\">\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                        <span class=\"token string\">\"keyId\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token string\">\"operationTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686038253</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>说明：</p>\n<ol>\n<li><code>&quot;ok&quot;:1</code> ：说明添加成功</li>\n</ol>\n<p>查看副本集情况：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> rs.<span class=\"token function-name function\">conf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myrs\"</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"version\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">4</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token string\">\"term\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token string\">\"members\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                        <span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27017\"</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                        <span class=\"token string\">\"arbiterOnly\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                        <span class=\"token string\">\"buildIndexes\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                        <span class=\"token string\">\"hidden\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                        <span class=\"token string\">\"priority\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                        <span class=\"token string\">\"tags\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                        <span class=\"token string\">\"secondaryDelaySecs\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                        <span class=\"token string\">\"votes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                        <span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27018\"</span>,</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                        <span class=\"token string\">\"arbiterOnly\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                        <span class=\"token string\">\"buildIndexes\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                        <span class=\"token string\">\"hidden\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                        <span class=\"token string\">\"priority\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                        <span class=\"token string\">\"tags\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                        <span class=\"token string\">\"secondaryDelaySecs\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                        <span class=\"token string\">\"votes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                        <span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27019\"</span>,</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                        <span class=\"token string\">\"arbiterOnly\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                        <span class=\"token string\">\"buildIndexes\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                        <span class=\"token string\">\"hidden\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                        <span class=\"token string\">\"priority\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                        <span class=\"token string\">\"tags\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                        <span class=\"token string\">\"secondaryDelaySecs\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                        <span class=\"token string\">\"votes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token punctuation\">]</span>,</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token string\">\"protocolVersion\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token string\">\"writeConcernMajorityJournalDefault\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token string\">\"settings\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token string\">\"chainingAllowed\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token string\">\"heartbeatIntervalMillis\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2000</span>,</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token string\">\"heartbeatTimeoutSecs\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">10</span>,</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token string\">\"electionTimeoutMillis\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">10000</span>,</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token string\">\"catchUpTimeoutMillis\"</span> <span class=\"token builtin class-name\">:</span> -1,</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token string\">\"catchUpTakeoverDelayMillis\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">30000</span>,</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                <span class=\"token string\">\"getLastErrorModes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                <span class=\"token string\">\"getLastErrorDefaults\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                        <span class=\"token string\">\"w\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                        <span class=\"token string\">\"wtimeout\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                <span class=\"token string\">\"replicaSetId\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647edd5c454f9ab55a0c8fbf\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>“arbiterOnly” : true, 说明是仲载节点</p>\n<p>查看状态：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> rs.<span class=\"token function-name function\">status</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string\">\"set\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myrs\"</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"date\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T08:04:25.601Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token string\">\"myState\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token string\">\"term\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token string\">\"syncSourceHost\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token string\">\"syncSourceId\"</span> <span class=\"token builtin class-name\">:</span> -1,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token string\">\"heartbeatIntervalMillis\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token string\">\"majorityVoteCount\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token string\">\"writeMajorityCount\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token string\">\"votingMembersCount\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">3</span>,</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token string\">\"writableVotingMembersCount\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token string\">\"optimes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token string\">\"lastCommittedOpTime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                        <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686038655</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                        <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token string\">\"lastCommittedWallTime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T08:04:15.625Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token string\">\"readConcernMajorityOpTime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                        <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686038655</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                        <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token string\">\"appliedOpTime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                        <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686038655</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                        <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token string\">\"durableOpTime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                        <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686038655</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                        <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token string\">\"lastAppliedWallTime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T08:04:15.625Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token string\">\"lastDurableWallTime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T08:04:15.625Z\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token string\">\"lastStableRecoveryTimestamp\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686038625</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token string\">\"electionCandidateMetrics\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token string\">\"lastElectionReason\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"electionTimeout\"</span>,</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token string\">\"lastElectionDate\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:16:45.057Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token string\">\"electionTerm\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token string\">\"lastCommittedOpTimeAtElection\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                        <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686035805</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                        <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span>-1<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token string\">\"lastSeenOpTimeAtElection\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                        <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686035805</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                        <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span>-1<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                <span class=\"token string\">\"numVotesNeeded\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token string\">\"priorityAtElection\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token string\">\"electionTimeoutMillis\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">10000</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token string\">\"newTermStartDate\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:16:45.091Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token string\">\"wMajorityWriteAvailabilityDate\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:16:45.106Z\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token string\">\"members\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                        <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27017\"</span>,</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                        <span class=\"token string\">\"health\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                        <span class=\"token string\">\"state\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                        <span class=\"token string\">\"stateStr\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"PRIMARY\"</span>,</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                        <span class=\"token string\">\"uptime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">3545</span>,</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                        <span class=\"token string\">\"optime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                                <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686038655</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                                <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                        <span class=\"token string\">\"optimeDate\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T08:04:15Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                        <span class=\"token string\">\"lastAppliedWallTime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T08:04:15.625Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                        <span class=\"token string\">\"lastDurableWallTime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T08:04:15.625Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                        <span class=\"token string\">\"syncSourceHost\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span>,</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                        <span class=\"token string\">\"syncSourceId\"</span> <span class=\"token builtin class-name\">:</span> -1,</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                        <span class=\"token string\">\"infoMessage\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span>,</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                        <span class=\"token string\">\"electionTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686035805</span>, <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                        <span class=\"token string\">\"electionDate\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T07:16:45Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                        <span class=\"token string\">\"configVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">4</span>,</pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                        <span class=\"token string\">\"configTerm\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                        <span class=\"token string\">\"self\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                        <span class=\"token string\">\"lastHeartbeatMessage\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"79\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>                        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"81\"></td><td><pre>                        <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27018\"</span>,</pre></td></tr><tr><td data-num=\"82\"></td><td><pre>                        <span class=\"token string\">\"health\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"83\"></td><td><pre>                        <span class=\"token string\">\"state\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"84\"></td><td><pre>                        <span class=\"token string\">\"stateStr\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"SECONDARY\"</span>,</pre></td></tr><tr><td data-num=\"85\"></td><td><pre>                        <span class=\"token string\">\"uptime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1254</span>,</pre></td></tr><tr><td data-num=\"86\"></td><td><pre>                        <span class=\"token string\">\"optime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>                                <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686038655</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"88\"></td><td><pre>                                <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"90\"></td><td><pre>                        <span class=\"token string\">\"optimeDurable\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>                                <span class=\"token string\">\"ts\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686038655</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"92\"></td><td><pre>                                <span class=\"token string\">\"t\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"94\"></td><td><pre>                        <span class=\"token string\">\"optimeDate\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T08:04:15Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"95\"></td><td><pre>                        <span class=\"token string\">\"optimeDurableDate\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T08:04:15Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"96\"></td><td><pre>                        <span class=\"token string\">\"lastAppliedWallTime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T08:04:15.625Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"97\"></td><td><pre>                        <span class=\"token string\">\"lastDurableWallTime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T08:04:15.625Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"98\"></td><td><pre>                        <span class=\"token string\">\"lastHeartbeat\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T08:04:24.037Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"99\"></td><td><pre>                        <span class=\"token string\">\"lastHeartbeatRecv\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T08:04:24.064Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"100\"></td><td><pre>                        <span class=\"token string\">\"pingMs\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"101\"></td><td><pre>                        <span class=\"token string\">\"lastHeartbeatMessage\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span>,</pre></td></tr><tr><td data-num=\"102\"></td><td><pre>                        <span class=\"token string\">\"syncSourceHost\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27017\"</span>,</pre></td></tr><tr><td data-num=\"103\"></td><td><pre>                        <span class=\"token string\">\"syncSourceId\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"104\"></td><td><pre>                        <span class=\"token string\">\"infoMessage\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span>,</pre></td></tr><tr><td data-num=\"105\"></td><td><pre>                        <span class=\"token string\">\"configVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">4</span>,</pre></td></tr><tr><td data-num=\"106\"></td><td><pre>                        <span class=\"token string\">\"configTerm\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"108\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>                        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"110\"></td><td><pre>                        <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27019\"</span>,</pre></td></tr><tr><td data-num=\"111\"></td><td><pre>                        <span class=\"token string\">\"health\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"112\"></td><td><pre>                        <span class=\"token string\">\"state\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">7</span>,</pre></td></tr><tr><td data-num=\"113\"></td><td><pre>                        <span class=\"token string\">\"stateStr\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"ARBITER\"</span>,</pre></td></tr><tr><td data-num=\"114\"></td><td><pre>                        <span class=\"token string\">\"uptime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">412</span>,</pre></td></tr><tr><td data-num=\"115\"></td><td><pre>                        <span class=\"token string\">\"lastHeartbeat\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T08:04:24.012Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"116\"></td><td><pre>                        <span class=\"token string\">\"lastHeartbeatRecv\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-06T08:04:24.055Z\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"117\"></td><td><pre>                        <span class=\"token string\">\"pingMs\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"118\"></td><td><pre>                        <span class=\"token string\">\"lastHeartbeatMessage\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span>,</pre></td></tr><tr><td data-num=\"119\"></td><td><pre>                        <span class=\"token string\">\"syncSourceHost\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span>,</pre></td></tr><tr><td data-num=\"120\"></td><td><pre>                        <span class=\"token string\">\"syncSourceId\"</span> <span class=\"token builtin class-name\">:</span> -1,</pre></td></tr><tr><td data-num=\"121\"></td><td><pre>                        <span class=\"token string\">\"infoMessage\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span>,</pre></td></tr><tr><td data-num=\"122\"></td><td><pre>                        <span class=\"token string\">\"configVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">4</span>,</pre></td></tr><tr><td data-num=\"123\"></td><td><pre>                        <span class=\"token string\">\"configTerm\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>        <span class=\"token punctuation\">]</span>,</pre></td></tr><tr><td data-num=\"126\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"127\"></td><td><pre>        <span class=\"token string\">\"<span class=\"token variable\">$clusterTime</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>                <span class=\"token string\">\"clusterTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686038655</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"129\"></td><td><pre>                <span class=\"token string\">\"signature\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>                        <span class=\"token string\">\"hash\"</span> <span class=\"token builtin class-name\">:</span> BinData<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>,<span class=\"token string\">\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"131\"></td><td><pre>                        <span class=\"token string\">\"keyId\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"134\"></td><td><pre>        <span class=\"token string\">\"operationTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686038655</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>PRIMARY：主节点，SECONDARY：从节点，ARBITER：仲载节点</p>\n<h2 id=\"副本集的数据读写操作\"><a class=\"markdownIt-Anchor\" href=\"#副本集的数据读写操作\">#</a> 副本集的数据读写操作</h2>\n<p>目标：测试三个不同角色的节点的数据读写情况</p>\n<p>登录主节点 27017，写入和读取数据：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> show dbs</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>admin   <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>config  <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">local</span>   <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> use articledb</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>switched to db articledb</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> db</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>articledb</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> try<span class=\"token punctuation\">&#123;</span>db.comment.insert<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"张三\"</span>,<span class=\"token string\">\"age\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"18\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span>catch<span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>print<span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>WriteResult<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nInserted\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> db.comment.<span class=\"token function-name function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647ee966333697b12ce7258a\"</span><span class=\"token punctuation\">)</span>, <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"张三\"</span>, <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"18\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>登录从节点 27018</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span> show dbs</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>uncaught exception: Error: listDatabases failed:<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string\">\"topologyVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                <span class=\"token string\">\"processId\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647edabd93b3e543a0258e7d\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token string\">\"counter\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token string\">\"errmsg\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"not master and slaveOk=false\"</span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token string\">\"code\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">13435</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token string\">\"codeName\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"NotPrimaryNoSecondaryOk\"</span>,</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token string\">\"<span class=\"token variable\">$clusterTime</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token string\">\"clusterTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686039005</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token string\">\"signature\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                        <span class=\"token string\">\"hash\"</span> <span class=\"token builtin class-name\">:</span> BinData<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>,<span class=\"token string\">\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                        <span class=\"token string\">\"keyId\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token string\">\"operationTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686039005</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token builtin class-name\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>_getErrorWithCode@src/mongo/shell/utils.js:25:13</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>Mongo.prototype.getDBs/<span class=\"token operator\">&lt;</span>@src/mongo/shell/mongo.js:145:19</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>Mongo.prototype.getDBs@src/mongo/shell/mongo.js:97:12</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>shellHelper.show@src/mongo/shell/utils.js:956:13</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>shellHelper@src/mongo/shell/utils.js:838:15</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>@<span class=\"token punctuation\">(</span>shellhelp2<span class=\"token punctuation\">)</span>:1:1</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>发现，不能读取集合的数据。当前从节点只是一个备份，不是奴隶节点，无法读取数据，写当然更不行，因为默认情况下，从节点是没有读写权限的，可以增加读的权限，但需要进行设置。</p>\n<p>设置读操作权限：</p>\n<p>说明：</p>\n<p>设置为奴隶节点，允许在从成员上运行读的操作</p>\n<p>语法：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> rs.slaveOk<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#或</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span> rs.slaveOk<span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#新版本中上面命令可能被弃用了，使用下面命令即可</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>rs.secondaryOk<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>提示：</p>\n<p>该命令是 db.getMongo ().setSlaveOk () 的简化命令。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span> rs.secondaryOk<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span> show dbs</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>admin      <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>articledb  <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>config     <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token builtin class-name\">local</span>      <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span> use articledb</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>switched to db articledb</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span> db.comment.<span class=\"token function-name function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647ee966333697b12ce7258a\"</span><span class=\"token punctuation\">)</span>, <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"张三\"</span>, <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"18\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>可以看到可以将主节点插入的数据同步过来</p>\n<p>但仍然不允许插入  <code> &quot;errmsg&quot; : &quot;not master&quot;</code></p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span> try<span class=\"token punctuation\">&#123;</span>db.comment.insert<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"李四\"</span>,<span class=\"token string\">\"age\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"20\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span>catch<span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>print<span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>WriteCommandError<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string\">\"topologyVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                <span class=\"token string\">\"processId\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647edabd93b3e543a0258e7d\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token string\">\"counter\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token string\">\"errmsg\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"not master\"</span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token string\">\"code\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">10107</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token string\">\"codeName\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"NotWritablePrimary\"</span>,</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token string\">\"<span class=\"token variable\">$clusterTime</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token string\">\"clusterTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686039875</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token string\">\"signature\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                        <span class=\"token string\">\"hash\"</span> <span class=\"token builtin class-name\">:</span> BinData<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>,<span class=\"token string\">\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                        <span class=\"token string\">\"keyId\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token string\">\"operationTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686039875</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>现在可实现了读写分离，让主插入数据，让从来读取数据</p>\n<p>如果要取消奴隶节点的读取权限：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> rs.secondaryOk<span class=\"token punctuation\">(</span>false<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span> rs.secondaryOk<span class=\"token punctuation\">(</span>false<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span> show dbs</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>uncaught exception: Error: listDatabases failed:<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"topologyVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token string\">\"processId\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647edabd93b3e543a0258e7d\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token string\">\"counter\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token string\">\"errmsg\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"not master and slaveOk=false\"</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token string\">\"code\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">13435</span>,</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token string\">\"codeName\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"NotPrimaryNoSecondaryOk\"</span>,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token string\">\"<span class=\"token variable\">$clusterTime</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token string\">\"clusterTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686039975</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token string\">\"signature\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                        <span class=\"token string\">\"hash\"</span> <span class=\"token builtin class-name\">:</span> BinData<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>,<span class=\"token string\">\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                        <span class=\"token string\">\"keyId\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token string\">\"operationTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686039975</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token builtin class-name\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>_getErrorWithCode@src/mongo/shell/utils.js:25:13</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>Mongo.prototype.getDBs/<span class=\"token operator\">&lt;</span>@src/mongo/shell/mongo.js:145:19</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>Mongo.prototype.getDBs@src/mongo/shell/mongo.js:97:12</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>shellHelper.show@src/mongo/shell/utils.js:956:13</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>shellHelper@src/mongo/shell/utils.js:838:15</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>@<span class=\"token punctuation\">(</span>shellhelp2<span class=\"token punctuation\">)</span>:1:1</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>仲载者节点，不存放任何业务数据的 (存放的是一些配置信息)，可以登录查看，就算设置了 <code>rs.secondaryOk()</code>  同样还是看不到数据</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:ARBITER<span class=\"token operator\">></span> show dbs</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>uncaught exception: Error: listDatabases failed:<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string\">\"topologyVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                <span class=\"token string\">\"processId\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647edaca021ba0c72e879407\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token string\">\"counter\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token string\">\"errmsg\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"not master and slaveOk=false\"</span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token string\">\"code\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">13435</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token string\">\"codeName\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"NotPrimaryNoSecondaryOk\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token builtin class-name\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>_getErrorWithCode@src/mongo/shell/utils.js:25:13</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>Mongo.prototype.getDBs/<span class=\"token operator\">&lt;</span>@src/mongo/shell/mongo.js:145:19</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>Mongo.prototype.getDBs@src/mongo/shell/mongo.js:97:12</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>shellHelper.show@src/mongo/shell/utils.js:956:13</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>shellHelper@src/mongo/shell/utils.js:838:15</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>@<span class=\"token punctuation\">(</span>shellhelp2<span class=\"token punctuation\">)</span>:1:1</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>myrs:ARBITER<span class=\"token operator\">></span></pre></td></tr></table></figure><p>我们想要查看的话就会提示不是 slaveOk 不能读取，但是我们设置仲载可读呢</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:ARBITER<span class=\"token operator\">></span> rs.secondaryOk<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>myrs:ARBITER<span class=\"token operator\">></span> show dbs</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>uncaught exception: Error: listDatabases failed:<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"topologyVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token string\">\"processId\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647edaca021ba0c72e879407\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token string\">\"counter\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token string\">\"errmsg\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"node is not in primary or recovering state\"</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token string\">\"code\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">13436</span>,</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token string\">\"codeName\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"NotPrimaryOrSecondary\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token builtin class-name\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>_getErrorWithCode@src/mongo/shell/utils.js:25:13</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>Mongo.prototype.getDBs/<span class=\"token operator\">&lt;</span>@src/mongo/shell/mongo.js:145:19</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>Mongo.prototype.getDBs@src/mongo/shell/mongo.js:97:12</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>shellHelper.show@src/mongo/shell/utils.js:956:13</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>shellHelper@src/mongo/shell/utils.js:838:15</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>@<span class=\"token punctuation\">(</span>shellhelp2<span class=\"token punctuation\">)</span>:1:1</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>myrs:ARBITER<span class=\"token operator\">></span></pre></td></tr></table></figure><p>报错提示翻译：节点未处于主状态或正在恢复状态</p>\n<h2 id=\"主节点的选举原则\"><a class=\"markdownIt-Anchor\" href=\"#主节点的选举原则\">#</a> 主节点的选举原则</h2>\n<p>MongoDB 在副本集中，会自动进行主节点的选举，主节点选举的触发条件：</p>\n<ol>\n<li>节点故障</li>\n<li>主节点网络不可达 (默认心跳信息为 10 秒)</li>\n<li>人工干预 (rs.stepDown (600))</li>\n</ol>\n<p>一旦触发选举，就要根据一定规则来选主节点</p>\n<p>选举规则是根据票数来决定谁获胜：</p>\n<ul>\n<li>\n<p>票数最高，且获得了 &quot;大多数&quot; 成员的投票支持的节点获胜</p>\n<p>&quot;大多数&quot; 的定义为：假设复制集内投票成员数量为 N，则大多数为 N/2 + 1，例如：3 个投票成员，则大多数的值是 2，当复制集内存活成员数量不足大多数时，整个复制集将无法选举出 Primary，复制集将无法提供写服务，处于只读状态</p>\n</li>\n<li>\n<p>若投票数相同，且都获得了 &quot;大多数&quot; 成员的投票支持的，数据新的节点获胜。</p>\n<p>数据的新旧是通过操作日志 oplog 来对比的</p>\n</li>\n</ul>\n<p>在获得票数的时候，优先级 (priority) 参数影响重大。</p>\n<p>可以通过设置优先级 (priority) 来设置额外票数，优先级即权重，取值为 0~1000，相当于可额外增加 0 <code>~</code> 1000 的票数，优先级的值越大，就越可能获得多数成员的投票 (votes) 数。指定较高的值可使成员更有资格成员主要成员，更低的值可使成员更不符合条件</p>\n<p>默认情况下，优先级的值是 1</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span> rs.<span class=\"token function-name function\">conf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myrs\"</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"version\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">4</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token string\">\"term\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token string\">\"members\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                        <span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27017\"</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                        <span class=\"token string\">\"arbiterOnly\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                        <span class=\"token string\">\"buildIndexes\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                        <span class=\"token string\">\"hidden\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                        <span class=\"token string\">\"priority\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                        <span class=\"token string\">\"tags\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                        <span class=\"token string\">\"secondaryDelaySecs\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                        <span class=\"token string\">\"votes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                        <span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27018\"</span>,</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                        <span class=\"token string\">\"arbiterOnly\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                        <span class=\"token string\">\"buildIndexes\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                        <span class=\"token string\">\"hidden\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                        <span class=\"token string\">\"priority\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                        <span class=\"token string\">\"tags\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                        <span class=\"token string\">\"secondaryDelaySecs\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                        <span class=\"token string\">\"votes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                        <span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27019\"</span>,</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                        <span class=\"token string\">\"arbiterOnly\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                        <span class=\"token string\">\"buildIndexes\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                        <span class=\"token string\">\"hidden\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                        <span class=\"token string\">\"priority\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                        <span class=\"token string\">\"tags\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                        <span class=\"token string\">\"secondaryDelaySecs\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                        <span class=\"token string\">\"votes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token punctuation\">]</span>,</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token string\">\"protocolVersion\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token string\">\"writeConcernMajorityJournalDefault\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token string\">\"settings\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token string\">\"chainingAllowed\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token string\">\"heartbeatIntervalMillis\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2000</span>,</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token string\">\"heartbeatTimeoutSecs\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">10</span>,</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token string\">\"electionTimeoutMillis\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">10000</span>,</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token string\">\"catchUpTimeoutMillis\"</span> <span class=\"token builtin class-name\">:</span> -1,</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token string\">\"catchUpTakeoverDelayMillis\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">30000</span>,</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                <span class=\"token string\">\"getLastErrorModes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                <span class=\"token string\">\"getLastErrorDefaults\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                        <span class=\"token string\">\"w\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                        <span class=\"token string\">\"wtimeout\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                <span class=\"token string\">\"replicaSetId\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647edd5c454f9ab55a0c8fbf\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>除了仲载节点其它 priority (优先级) 都是 1，仲载不能读写数据它只是一个参与投票的人，仲载不可能为王</p>\n<p>(要注意是，官方说了，仲载节点的优先级必须是 0，不能是别的值，即不具备选举权，但具有投票权)</p>\n<h3 id=\"修改优先级\"><a class=\"markdownIt-Anchor\" href=\"#修改优先级\">#</a> 修改优先级</h3>\n<p>比如，下面提升从节点的优先级：</p>\n<ol>\n<li>\n<p>先将配置导入 cfg 变量</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span> <span class=\"token assign-left variable\">cfg</span><span class=\"token operator\">=</span>rs.conf<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure></li>\n<li>\n<p>然后修改值 (ID 号默认从 0 开始)</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span> cfg.members<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>.priority<span class=\"token operator\">=</span><span class=\"token number\">2</span></pre></td></tr></table></figure><p>稍等片刻会重新开始选举</p>\n</li>\n</ol>\n<h2 id=\"故障测试\"><a class=\"markdownIt-Anchor\" href=\"#故障测试\">#</a> 故障测试</h2>\n<h3 id=\"副本节点故障测试\"><a class=\"markdownIt-Anchor\" href=\"#副本节点故障测试\">#</a> 副本节点故障测试</h3>\n<p>关闭 27018 副本节点：</p>\n<p>发现，主节点和仲载节点对 27018 的心跳失败。因为主节点还在，因此，没有触发投票选举。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>dkx0@192<span class=\"token punctuation\">]</span>~% <span class=\"token function\">ps</span> -ef<span class=\"token operator\">|</span><span class=\"token function\">grep</span> mongod<span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token parameter variable\">-v</span> <span class=\"token function\">grep</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>dkx0       <span class=\"token number\">5300</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> 03:05 ?        00:07:30 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27017/log/mongod.conf</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>dkx0       <span class=\"token number\">5367</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> 03:05 ?        00:07:57 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27018/log/mongod.conf</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>dkx0       <span class=\"token number\">5434</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> 03:05 ?        00:06:20 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27019/log/mongod.conf</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>dkx0@192<span class=\"token punctuation\">]</span>~% <span class=\"token function\">kill</span> <span class=\"token parameter variable\">-2</span> <span class=\"token number\">5367</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>dkx0@192<span class=\"token punctuation\">]</span>~% <span class=\"token function\">ps</span> -ef<span class=\"token operator\">|</span><span class=\"token function\">grep</span> mongod<span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token parameter variable\">-v</span> <span class=\"token function\">grep</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>dkx0       <span class=\"token number\">5300</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> 03:05 ?        00:07:31 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27017/log/mongod.conf</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>dkx0       <span class=\"token number\">5367</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> 03:05 ?        00:07:58 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27018/log/mongod.conf</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>dkx0       <span class=\"token number\">5434</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> 03:05 ?        00:06:20 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27019/log/mongod.conf</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>dkx0@192<span class=\"token punctuation\">]</span>~% <span class=\"token function\">ps</span> -ef<span class=\"token operator\">|</span><span class=\"token function\">grep</span> mongod<span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token parameter variable\">-v</span> <span class=\"token function\">grep</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>dkx0       <span class=\"token number\">5300</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> 03:05 ?        00:07:31 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27017/log/mongod.conf</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>dkx0       <span class=\"token number\">5434</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> 03:05 ?        00:06:21 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27019/log/mongod.conf</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>dkx0@192<span class=\"token punctuation\">]</span>~%</pre></td></tr></table></figure><p>kill -2 没有及时杀掉，证明了 - 2 是等待任务完成自动杀掉而不是暴力杀掉的。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>从节点被杀掉后按几下回车看下反应，已经没反应了。</p>\n<p>如果此时，在主节点写入数据。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> db.comment.insert<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"_id\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"3\"</span>,<span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"马保国\"</span>,<span class=\"token string\">\"age\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"22\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>再启动从节点并赋予可读权限，会发现，主节点写入的数据，会自动同步给从节点。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span> rs.secondaryOk<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span> use articledb</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>switched to db articledb</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span> db.comment.<span class=\"token function-name function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647ee966333697b12ce7258a\"</span><span class=\"token punctuation\">)</span>, <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"张三\"</span>, <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"18\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"3\"</span>, <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"马保国\"</span>, <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"22\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647f48485710428bcfbf9dbf\"</span><span class=\"token punctuation\">)</span>, <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"李四\"</span>, <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"23\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"123\"</span>, <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"23\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>可以看到数据同步过来了 &quot;马保国&quot;</p>\n<h3 id=\"主节点故障测试\"><a class=\"markdownIt-Anchor\" href=\"#主节点故障测试\">#</a> 主节点故障测试</h3>\n<p>关闭 27017 节点</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>dkx0@192<span class=\"token punctuation\">]</span>~% <span class=\"token function\">kill</span> <span class=\"token parameter variable\">-2</span> <span class=\"token number\">5300</span>                   </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>dkx0@192<span class=\"token punctuation\">]</span>~% <span class=\"token function\">ps</span> -ef<span class=\"token operator\">|</span><span class=\"token function\">grep</span> mongod<span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token parameter variable\">-v</span> <span class=\"token function\">grep</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>dkx0       <span class=\"token number\">5434</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> 03:05 ?        00:06:34 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27019/log/mongod.conf</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>dkx0      <span class=\"token number\">29707</span>      <span class=\"token number\">1</span>  <span class=\"token number\">3</span> <span class=\"token number\">11</span>:01 ?        00:00:06 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27018/log/mongod.conf</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>dkx0@192<span class=\"token punctuation\">]</span>~%</pre></td></tr></table></figure><p>发现，从节点和仲载节点对 27017 的心跳失败，当失败超过 10 秒，此时因为没有了主节点，会自动发起投票。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>27017 节点已挂</p>\n<p>而副本节点只有 27018，因此，候选人只有一个就是 27018，开始投票。</p>\n<p>27019 向 27018 投了一票，27018 本身自带一票，因此共两票，超过了 &quot;大多数&quot;</p>\n<p>27019 是仲载节点，没有选举权，27018 不向其投票，其票数是 0.</p>\n<p>最终结果，27018 成为主节点，具备读写功能。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>回车刷新状态</p>\n<p>在 27018 写入数据查看。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> db.comment.insert<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"_id\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"4\"</span>,<span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"弟中之弟\"</span>,<span class=\"token string\">\"age\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"123\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> db.comment.<span class=\"token function-name function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647ee966333697b12ce7258a\"</span><span class=\"token punctuation\">)</span>, <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"张三\"</span>, <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"18\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"3\"</span>, <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"马保国\"</span>, <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"22\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647f48485710428bcfbf9dbf\"</span><span class=\"token punctuation\">)</span>, <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"李四\"</span>, <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"23\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"123\"</span>, <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"23\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"4\"</span>, <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"弟中之弟\"</span>, <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"123\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>再启动 27017 节点，发现 27017 变成了从节点，27018 仍保持主节点。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>dkx0@192<span class=\"token punctuation\">]</span>~% /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27017/log/mongod.conf </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>forked process: <span class=\"token number\">30161</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>dkx0@192<span class=\"token punctuation\">]</span>~%</pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>E:<span class=\"token punctuation\">\\</span>MongoDB<span class=\"token punctuation\">\\</span>mongodb-win32-x86_64-windows-5.0.17<span class=\"token punctuation\">\\</span>bin<span class=\"token operator\">></span>mongo <span class=\"token parameter variable\">--host</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.244.142 <span class=\"token parameter variable\">--port</span><span class=\"token operator\">=</span><span class=\"token number\">27017</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>MongoDB server version: <span class=\"token number\">5.0</span>.18</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Warning: the <span class=\"token string\">\"mongo\"</span> shell has been superseded by <span class=\"token string\">\"mongosh\"</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">which</span> delivers improved usability and compatibility.The <span class=\"token string\">\"mongo\"</span> shell has been deprecated and will be removed <span class=\"token keyword\">in</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>an upcoming release.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>For installation instructions, see</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>https://docs.mongodb.com/mongodb-shell/install/</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>---</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>The server generated these startup warnings when booting:</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token number\">2023</span>-06-06T11:07:33.780-04:00: Access control is not enabled <span class=\"token keyword\">for</span> the database. Read and <span class=\"token function\">write</span> access to data and configuration is unrestricted</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token number\">2023</span>-06-06T11:07:33.781-04:00: /sys/kernel/mm/transparent_hugepage/enabled is <span class=\"token string\">'always'</span><span class=\"token builtin class-name\">.</span> We suggest setting it to <span class=\"token string\">'never'</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token number\">2023</span>-06-06T11:07:33.781-04:00: /sys/kernel/mm/transparent_hugepage/defrag is <span class=\"token string\">'always'</span><span class=\"token builtin class-name\">.</span> We suggest setting it to <span class=\"token string\">'never'</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token number\">2023</span>-06-06T11:07:33.781-04:00: Soft rlimits <span class=\"token keyword\">for</span> <span class=\"token function\">open</span> <span class=\"token function\">file</span> descriptors too low</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token number\">2023</span>-06-06T11:07:33.781-04:00:         currentValue: <span class=\"token number\">1024</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token number\">2023</span>-06-06T11:07:33.781-04:00:         recommendedMinimum: <span class=\"token number\">64000</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>---</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>登录 27017 节点，发现是从节点了需要赋予可读权限，数据自动从 27018 同步。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span> use articledb</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>switched to db articledb</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Error: error: <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token string\">\"topologyVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token string\">\"processId\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647f4bb2f95feeec6c69242c\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token string\">\"counter\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token string\">\"errmsg\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"not master and slaveOk=false\"</span>,</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token string\">\"code\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">13435</span>,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token string\">\"codeName\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"NotPrimaryNoSecondaryOk\"</span>,</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token string\">\"<span class=\"token variable\">$clusterTime</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token string\">\"clusterTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686064102</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token string\">\"signature\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                        <span class=\"token string\">\"hash\"</span> <span class=\"token builtin class-name\">:</span> BinData<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>,<span class=\"token string\">\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                        <span class=\"token string\">\"keyId\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token string\">\"operationTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686064102</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span> rs.secondaryOk<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span> db.comment.<span class=\"token function-name function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647ee966333697b12ce7258a\"</span><span class=\"token punctuation\">)</span>, <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"张三\"</span>, <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"18\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647f48485710428bcfbf9dbf\"</span><span class=\"token punctuation\">)</span>, <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"李四\"</span>, <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"23\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"123\"</span>, <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"23\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"3\"</span>, <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"马保国\"</span>, <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"22\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"4\"</span>, <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"弟中之弟\"</span>, <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"123\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>myrs:SECONDARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>从而实现了高可用。</p>\n<h3 id=\"仲载节点和主节点故障\"><a class=\"markdownIt-Anchor\" href=\"#仲载节点和主节点故障\">#</a> 仲载节点和主节点故障</h3>\n<p>先关掉仲载节点 27019</p>\n<p>关掉现在的主节点 27018</p>\n<p>登录 27017 后，发现，27017 仍然是从节点，副本集中没有主节点了，导致此时，副本集是只读状态，无法写入</p>\n<p>为啥不选举了？因为 27017 的票数，没有获得大多数，既没有大于等于 2，它只有默认的一票 (优先级是 1)</p>\n<p>如果要出发选举，随便加入一个成员即可。</p>\n<ul>\n<li>如果只加入 27019 仲载节点，则主节点一定是 27017，因为没得选了，仲载节点不参与选举，但参与投票</li>\n<li>如果只加入 27018，会发起选举，因为 27017 和 27018 都是两票，按照谁数据新，谁当主节点。</li>\n</ul>\n<h3 id=\"仲载节点和从节点故障\"><a class=\"markdownIt-Anchor\" href=\"#仲载节点和从节点故障\">#</a> 仲载节点和从节点故障</h3>\n<p>先关掉仲载节点 27019</p>\n<p>关掉现在的副本节点 27018</p>\n<p>10 秒后，27017 主节点自动降级为副本节点 (服务降级)</p>\n<p>副本集不可写数据了，已经故障了。</p>\n<h2 id=\"compass连接副本集\"><a class=\"markdownIt-Anchor\" href=\"#compass连接副本集\">#</a> Compass 连接副本集</h2>\n<p>如果使用云服务器需要修改配置中的主节点 IP</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>var config <span class=\"token operator\">=</span> rs.config<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> config.members<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>.host<span class=\"token operator\">=</span><span class=\"token string\">\"192.168.244.142:27017\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> rs.reconfig<span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>compass 连接：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031658537.png\" alt=\"image-20230606234834193\"></p>\n<p>输入后直接连接即可。</p>\n<p>注意：</p>\n<p>但是在 Compass 中即便连接的是 secondary 从节点但是还是可以插入数据的。</p>\n<h2 id=\"springdatamongodb连接副本集\"><a class=\"markdownIt-Anchor\" href=\"#springdatamongodb连接副本集\">#</a> SpringDataMongoDB 连接副本集</h2>\n<p>副本集语法：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongodb://host1,host2,host3/?connect<span class=\"token operator\">=</span>replicaSet<span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">secondaryOk</span><span class=\"token operator\">=</span>true<span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">replicaSet</span><span class=\"token operator\">=</span>副本集名字</pre></td></tr></table></figure><p>其中：</p>\n<ul>\n<li>secondaryOk=true：开启副本节点读的功能，实现读写分离。</li>\n<li>connect=replicaSet：自动到副本集中选择读写的主机，如果 secondaryOk 是打开的，则实现了读写分离</li>\n</ul>\n<p>[示例]</p>\n<p>连接 replica set 三台服务器 (端口 27017，27018，和 27019)，直接连接第一个服务器，无论是 replica set 一部分或者主服务器或者从服务器，写入操作应用在主服务器并且分布查询到从服务器。</p>\n<p>修改配置文件：application.yml</p>\n<p>连接副本集的时候就只能使用 uri 的格式了</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token comment\">#数据源配置</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">mongodb</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token comment\">#主机地址</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token comment\">#host: 192.168.244.142</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token comment\">#数据库</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token comment\">#database: articledb</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token comment\">#端口号</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token comment\">#port: 27017</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token comment\">#也可以使用 uri 连接</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token comment\">#uri: mongodb://192.168.244.142:27017/articledb</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token comment\">#副本集的连接字符串</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        mongodb<span class=\"token punctuation\">:</span>//192.168.244.142<span class=\"token punctuation\">:</span><span class=\"token number\">27017</span><span class=\"token punctuation\">,</span>192.168.244.142<span class=\"token punctuation\">:</span><span class=\"token number\">27018</span><span class=\"token punctuation\">,</span>192.168.244.142<span class=\"token punctuation\">:</span>27019/articledb<span class=\"token punctuation\">?</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        connect=replicaSet<span class=\"token important\">&amp;secondaryOk=true&amp;replicaSet=myrs</span></pre></td></tr></table></figure><p>测试是否可用：查询全部数据</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Comment</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> commentService<span class=\"token punctuation\">.</span><span class=\"token function\">findCommentList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Comment</span> i<span class=\"token operator\">:</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token constant\">RUN</span> <span class=\"token class-name\">Result</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token class-name\">Comment</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">647</span>ee966333697b12ce7258a<span class=\"token punctuation\">,</span> content<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> publishtime<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> userid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> nickname<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> createdatatim<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> likenum<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> replynum<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> state<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> parentid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> articleid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token class-name\">Comment</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> content<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> publishtime<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> userid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> nickname<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> createdatatim<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> likenum<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> replynum<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> state<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> parentid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> articleid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token class-name\">Comment</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">647f</span><span class=\"token number\">48485710428</span>bcfbf9dbf<span class=\"token punctuation\">,</span> content<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> publishtime<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> userid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> nickname<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> createdatatim<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> likenum<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> replynum<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> state<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> parentid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> articleid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token class-name\">Comment</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> content<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> publishtime<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> userid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> nickname<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> createdatatim<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> likenum<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> replynum<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> state<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> parentid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> articleid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token class-name\">Comment</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> content<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> publishtime<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> userid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> nickname<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> createdatatim<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> likenum<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> replynum<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> state<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> parentid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> articleid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token class-name\">Comment</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">647f</span><span class=\"token number\">5445f</span><span class=\"token number\">81</span>b0775f8f31924<span class=\"token punctuation\">,</span> content<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> publishtime<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> userid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> nickname<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> createdatatim<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> likenum<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> replynum<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> state<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> parentid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> articleid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token class-name\">Comment</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">647f</span><span class=\"token number\">54</span>b24cf08bc145fd6995<span class=\"token punctuation\">,</span> content<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> publishtime<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> userid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> nickname<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> createdatatim<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> likenum<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> replynum<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> state<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> parentid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> articleid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>id 能查出来就证明可用，其它为 null 是因为实体类与表结构</p>\n<p>注意：</p>\n<p>主机必须是副本集中所有的主机，包括主节点，副本节点，仲载节点。</p>\n<h2 id=\"分片集群-sharded-cluster\"><a class=\"markdownIt-Anchor\" href=\"#分片集群-sharded-cluster\">#</a> 分片集群 - Sharded Cluster</h2>\n<h3 id=\"分片概念\"><a class=\"markdownIt-Anchor\" href=\"#分片概念\">#</a> 分片概念</h3>\n<p>分片 (sharding) 是一种跨多台机器分布数据的方法，MongoDB 使用分片来支持具有非常大的数据集和高吞吐量操作的部署。</p>\n<p>换句话说：分片 (sharding) 是指将数据拆分，将其分散存在不同的机器上的过程，有时也用分区 (partitioning) 来表示这个概念，将数据分散道不同的机器上，不需要功能强大的大型计算机就可以存储更多的数据，处理更多的负载。</p>\n<p>具有大型数据集或吞吐量应用程序的数据库系统可以会挑战单个服务器的容量，例如，高查询率会耗尽服务器的 CPU 容量，工作集大小大于系统的 RAM 会强调磁盘驱动的 I/O 容量</p>\n<p>有两种解决系统增长的办法：垂直扩展和水平扩展。</p>\n<p>垂直扩展意味着增加单个服务器的容量，例如使用更强大的 CPU，添加更多 RAM 或增加存储空间量。可用技术的局限性可能会限制单个机器对于给定工作负载而言而言足够强大，此外，基于云 的提供商基于可用的硬件配置具有硬性上限，结果，垂直缩放有实际的最大值</p>\n<p>水平扩展意味着划分系统数据集并加载多个服务器，添加其他服务器以根据需要增加容量，虽然单个机器的总题速度或容量可能不高，但每台机器处理整个工作负载的子集，可能提供比单个高速大容量服务器更高的效率，扩展部署容量只需要根据需要添加额外的服务器，这可能比单个机器的高端硬件的总体成本更低，权衡是基础架构和部署维护的复杂性增加。</p>\n<p>MongoDB 支持通过分片进行水平扩展。</p>\n<h3 id=\"分片集群包含的组件\"><a class=\"markdownIt-Anchor\" href=\"#分片集群包含的组件\">#</a> 分片集群包含的组件</h3>\n<p>MongoDB 分片集群包含以下组件：</p>\n<ul>\n<li>分片 (存储)：每个分片包含分片数据的子集，每个分片都可以部署为副本集</li>\n<li>mongos (路由)：mongos 充当查询路由器，在客户端应用程序和分片集群之间提供接口</li>\n<li>config server (&quot;调度&quot; 的配置)：配置服务器存储群集的元数据和配置设置，从 MongoDB3.4 开始，必须将配置服务器部署为副本集 (CSRS)</li>\n</ul>\n<p>下图描述了分片集群中组件的交互：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031659686.png\" alt=\"image-20230607171021552\"></p>\n<p>MongoDB 在集合级别对数据库进行分片，将集合数据分布在集群中的分片上</p>\n<p>27018 if mongod is a shared member</p>\n<p>27019 if mongod is a config server member</p>\n<h3 id=\"分片集群架构目标\"><a class=\"markdownIt-Anchor\" href=\"#分片集群架构目标\">#</a> 分片集群架构目标</h3>\n<p>两个分片节点副本集 (3+3) + 一个配置节点副本集 (3) + 两个路由节点 (2) ，共 11 个服务节点。</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031659822.png\" alt=\"image-20230607171256122\"></p>\n<h3 id=\"分片存储节点副本集的创建\"><a class=\"markdownIt-Anchor\" href=\"#分片存储节点副本集的创建\">#</a> 分片 (存储) 节点副本集的创建</h3>\n<p>所有的配置文件都直接放到 sharded_cluster 的相应的子目录下，默认配置文件名字：mongod.conf</p>\n<h3 id=\"第一套副本集\"><a class=\"markdownIt-Anchor\" href=\"#第一套副本集\">#</a> 第一套副本集</h3>\n<p>准备存放数据和日志的目录</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/sharded_cluster/myshardrs01_27018/log <span class=\"token punctuation\">\\</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/sharded_cluster/myshardrs01_27018/data/db <span class=\"token punctuation\">\\</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/sharded_cluster/myshardrs01_27118/log <span class=\"token punctuation\">\\</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/sharded_cluster/myshardrs01_27118/data/db <span class=\"token punctuation\">\\</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/sharded_cluster/myshardrs01_27218/log <span class=\"token punctuation\">\\</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/sharded_cluster/myshardrs01_27218/data/db</pre></td></tr></table></figure><p><mark>第一个服务</mark></p>\n<p>新建或修改配置文件：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf</pre></td></tr></table></figure><p>配置文件内容：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemLog:</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token comment\">#MongoDB 发送所有日志输出的目标指定为文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\">#The path of the log file to which mongod or mongos should send all diagnostic logging information</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> destination: <span class=\"token function\">file</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token comment\">#mongod 或 mongos 应向其发送所有诊断日志记录信息的日志文件的路径</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> path: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27018/log/mongod.log\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token comment\">#当 mongos 或 mongod 实例重新启动时，mongos 或 mongod 会将新条目附加到现有日志文件的末尾。</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> logAppend: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>storage:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token comment\">#mongod 实例存储其数据的目录。storage.dbPath 设置仅适用于 mongod。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> <span class=\"token comment\">#The directory where the mongod instance stores its data.Defaul value is \"/data/db\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> dbPath: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27018/data/db\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> journal:</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token comment\">#启用或禁用持久性日志以确保数据文件保持有效和可恢复</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  enabled: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>processManagement:</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token comment\">#启用在后台运行 mongos 或 mongod 进程的守护进程模式。</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> fork: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre> <span class=\"token comment\">#指定用于保存 mongos 或 mongod 进程的进行 ID 的文件位置，其中 mongos 或 mongod 将写入其 PID</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre> pidFilePath: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27018/log/mongod.pid\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>net:</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token comment\">#服务实例绑定 IP，默认是 localhost</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre> bindIp: localhost,192.168.244.142</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token comment\">#bindIp</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token comment\">#绑定的端口，默认是 27017</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre> port: <span class=\"token number\">27017</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>replication:</pre></td></tr><tr><td data-num=\"28\"></td><td><pre> <span class=\"token comment\">#副本集的名称</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre> replSetName: myshardrs01</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>sharding:</pre></td></tr><tr><td data-num=\"31\"></td><td><pre> <span class=\"token comment\">#分片角色</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre> clusterRole: shardsvr</pre></td></tr></table></figure><p>sharding.clusterRole：</p>\n<table>\n<thead>\n<tr>\n<th>Value</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>configsvr</td>\n<td>Start this instance as a config server. The instance starts on port 27019 by default</td>\n</tr>\n<tr>\n<td>shardsvr</td>\n<td>Start this instance as a shard. The instance starts on port 27018 by default</td>\n</tr>\n</tbody>\n</table>\n<p>注意：</p>\n<p>设置 sharding.clusterRole 需要 mongod 实例运行复制，要将实例部署为副本即成员，请使用 replSetName 设置并制定副本集的名称。</p>\n<p><mark>第二个服务</mark></p>\n<p>新建或修改配置文件：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf</pre></td></tr></table></figure><p>配置文件内容：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemLog:</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token comment\">#MongoDB 发送所有日志输出的目标指定为文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\">#The path of the log file to which mongod or mongos should send all diagnostic logging information</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> destination: <span class=\"token function\">file</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token comment\">#mongod 或 mongos 应向其发送所有诊断日志记录信息的日志文件的路径</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> path: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27118/log/mongod.log\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token comment\">#当 mongos 或 mongod 实例重新启动时，mongos 或 mongod 会将新条目附加到现有日志文件的末尾。</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> logAppend: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>storage:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token comment\">#mongod 实例存储其数据的目录。storage.dbPath 设置仅适用于 mongod。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> <span class=\"token comment\">#The directory where the mongod instance stores its data.Defaul value is \"/data/db\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> dbPath: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27118/data/db\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> journal:</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token comment\">#启用或禁用持久性日志以确保数据文件保持有效和可恢复</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  enabled: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>processManagement:</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token comment\">#启用在后台运行 mongos 或 mongod 进程的守护进程模式。</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> fork: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre> <span class=\"token comment\">#指定用于保存 mongos 或 mongod 进程的进行 ID 的文件位置，其中 mongos 或 mongod 将写入其 PID</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre> pidFilePath: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27118/log/mongod.pid\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>net:</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token comment\">#服务实例绑定 IP，默认是 localhost</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre> bindIp: localhost,192.168.244.142</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token comment\">#bindIp</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token comment\">#绑定的端口，默认是 27017</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre> port: <span class=\"token number\">27118</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>replication:</pre></td></tr><tr><td data-num=\"28\"></td><td><pre> <span class=\"token comment\">#副本集的名称</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre> replSetName: myshardrs01</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>sharding:</pre></td></tr><tr><td data-num=\"31\"></td><td><pre> <span class=\"token comment\">#分片角色</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre> clusterRole: shardsvr</pre></td></tr></table></figure><p><mark>第三个服务</mark></p>\n<p>新建或修改配置文件：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf</pre></td></tr></table></figure><p>配置文件内容：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemLog:</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token comment\">#MongoDB 发送所有日志输出的目标指定为文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\">#The path of the log file to which mongod or mongos should send all diagnostic logging information</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> destination: <span class=\"token function\">file</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token comment\">#mongod 或 mongos 应向其发送所有诊断日志记录信息的日志文件的路径</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> path: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27218/log/mongod.log\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token comment\">#当 mongos 或 mongod 实例重新启动时，mongos 或 mongod 会将新条目附加到现有日志文件的末尾。</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> logAppend: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>storage:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token comment\">#mongod 实例存储其数据的目录。storage.dbPath 设置仅适用于 mongod。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> <span class=\"token comment\">#The directory where the mongod instance stores its data.Defaul value is \"/data/db\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> dbPath: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27218/data/db\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> journal:</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token comment\">#启用或禁用持久性日志以确保数据文件保持有效和可恢复</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  enabled: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>processManagement:</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token comment\">#启用在后台运行 mongos 或 mongod 进程的守护进程模式。</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> fork: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre> <span class=\"token comment\">#指定用于保存 mongos 或 mongod 进程的进行 ID 的文件位置，其中 mongos 或 mongod 将写入其 PID</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre> pidFilePath: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27218/log/mongod.pid\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>net:</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token comment\">#服务实例绑定 IP，默认是 localhost</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre> bindIp: localhost,192.168.244.142</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token comment\">#bindIp</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token comment\">#绑定的端口，默认是 27017</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre> port: <span class=\"token number\">27218</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>replication:</pre></td></tr><tr><td data-num=\"28\"></td><td><pre> <span class=\"token comment\">#副本集的名称</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre> replSetName: myshardrs01</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>sharding:</pre></td></tr><tr><td data-num=\"31\"></td><td><pre> <span class=\"token comment\">#分片角色</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre> clusterRole: shardsvr</pre></td></tr></table></figure><p>启动第一套副本集：一主一副一仲载</p>\n<p>依次启动三个 mongod 服务：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  / /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>forked process: <span class=\"token number\">2821</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>➜  / /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>forked process: <span class=\"token number\">2894</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>➜  / /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>forked process: <span class=\"token number\">2963</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>➜  /</pre></td></tr></table></figure><p>查看启动进程情况：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  / <span class=\"token function\">ps</span> -ef<span class=\"token operator\">|</span><span class=\"token function\">grep</span> mongod<span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token parameter variable\">-v</span> <span class=\"token function\">grep</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>dkx0       <span class=\"token number\">2821</span>      <span class=\"token number\">1</span>  <span class=\"token number\">7</span> 06:55 ?        00:00:03 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>dkx0       <span class=\"token number\">2894</span>      <span class=\"token number\">1</span> <span class=\"token number\">10</span> 06:55 ?        00:00:02 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>dkx0       <span class=\"token number\">2963</span>      <span class=\"token number\">1</span> <span class=\"token number\">16</span> 06:56 ?        00:00:02 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>➜  /</pre></td></tr></table></figure><p>1. 初始化副本集和创建主节点：</p>\n<p>使用客户端命令连接任意一个节点，但这里尽量要连接主节点：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ /usr/local/mongodb/bin/mongo  <span class=\"token parameter variable\">--host</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.244.142 <span class=\"token parameter variable\">--port</span><span class=\"token operator\">=</span><span class=\"token number\">27018</span></pre></td></tr></table></figure><p>执行初始化副本集命令：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> rs.<span class=\"token function-name function\">initiate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token string\">\"info2\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"no configuration specified. Using a default configuration for the set\"</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token string\">\"me\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27018\"</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>myshardrs01:SECONDARY<span class=\"token operator\">></span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>myshardrs01:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>添加从节点和仲载节点：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myshardrs01:PRIMARY<span class=\"token operator\">></span> rs.add<span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.244.142:27118\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>myshardrs01:PRIMARY<span class=\"token operator\">></span> rs.add<span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.244.142:27218\"</span>,true<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>查看副本集的配置情况：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myshardrs01:PRIMARY<span class=\"token operator\">></span> rs.<span class=\"token function-name function\">conf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs01\"</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token string\">\"version\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">3</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token string\">\"term\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token string\">\"members\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t<span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t<span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27018\"</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t<span class=\"token string\">\"arbiterOnly\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t<span class=\"token string\">\"buildIndexes\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t<span class=\"token string\">\"hidden\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t<span class=\"token string\">\"priority\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t<span class=\"token string\">\"tags\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t\t</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t<span class=\"token string\">\"slaveDelay\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t<span class=\"token string\">\"votes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t<span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t<span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27118\"</span>,</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t<span class=\"token string\">\"arbiterOnly\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\t<span class=\"token string\">\"buildIndexes\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t\t<span class=\"token string\">\"hidden\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\t<span class=\"token string\">\"priority\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t\t<span class=\"token string\">\"tags\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\t\t</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\t<span class=\"token string\">\"slaveDelay\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\t<span class=\"token string\">\"votes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\t<span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t\t<span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27218\"</span>,</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t\t<span class=\"token string\">\"arbiterOnly\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t\t<span class=\"token string\">\"buildIndexes\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t\t<span class=\"token string\">\"hidden\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t\t<span class=\"token string\">\"priority\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t\t<span class=\"token string\">\"tags\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\t\t\t</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\t\t<span class=\"token string\">\"slaveDelay\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t\t\t<span class=\"token string\">\"votes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t<span class=\"token punctuation\">]</span>,</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t<span class=\"token string\">\"protocolVersion\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t<span class=\"token string\">\"writeConcernMajorityJournalDefault\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t<span class=\"token string\">\"settings\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t\t<span class=\"token string\">\"chainingAllowed\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t\t<span class=\"token string\">\"heartbeatIntervalMillis\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2000</span>,</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t\t<span class=\"token string\">\"heartbeatTimeoutSecs\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">10</span>,</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t\t<span class=\"token string\">\"electionTimeoutMillis\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">10000</span>,</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\t\t<span class=\"token string\">\"catchUpTimeoutMillis\"</span> <span class=\"token builtin class-name\">:</span> -1,</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>\t\t<span class=\"token string\">\"catchUpTakeoverDelayMillis\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">30000</span>,</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\t\t<span class=\"token string\">\"getLastErrorModes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\t\t\t</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\t\t<span class=\"token string\">\"getLastErrorDefaults\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>\t\t\t<span class=\"token string\">\"w\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>\t\t\t<span class=\"token string\">\"wtimeout\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>\t\t<span class=\"token string\">\"replicaSetId\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"648128e18751ababd297a5f4\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>myshardrs01:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><h3 id=\"第二套副本集\"><a class=\"markdownIt-Anchor\" href=\"#第二套副本集\">#</a> 第二套副本集</h3>\n<p>创建存放数据和日志的目录：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/sharded_cluster/myshardrs01_27318/log <span class=\"token punctuation\">\\</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/sharded_cluster/myshardrs01_27318/data/db <span class=\"token punctuation\">\\</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/sharded_cluster/myshardrs01_27418/log <span class=\"token punctuation\">\\</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/sharded_cluster/myshardrs01_27418/data/db <span class=\"token punctuation\">\\</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/sharded_cluster/myshardrs01_27518/log <span class=\"token punctuation\">\\</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/sharded_cluster/myshardrs01_27518/data/db</pre></td></tr></table></figure><p><mark>第一个服务</mark></p>\n<p>新建或修改配置文件：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ <span class=\"token function\">vim</span> /mongodb/sharded_cluster/myshardrs01_27318/mongod.conf</pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemLog:</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token comment\">#MongoDB 发送所有日志输出的目标指定为文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\">#The path of the log file to which mongod or mongos should send all diagnostic logging information</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> destination: <span class=\"token function\">file</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token comment\">#mongod 或 mongos 应向其发送所有诊断日志记录信息的日志文件的路径</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> path: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27318/log/mongod.log\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token comment\">#当 mongos 或 mongod 实例重新启动时，mongos 或 mongod 会将新条目附加到现有日志文件的末尾。</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> logAppend: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>storage:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token comment\">#mongod 实例存储其数据的目录。storage.dbPath 设置仅适用于 mongod。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> <span class=\"token comment\">#The directory where the mongod instance stores its data.Defaul value is \"/data/db\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> dbPath: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27318/data/db\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> journal:</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token comment\">#启用或禁用持久性日志以确保数据文件保持有效和可恢复</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  enabled: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>processManagement:</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token comment\">#启用在后台运行 mongos 或 mongod 进程的守护进程模式。</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> fork: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre> <span class=\"token comment\">#指定用于保存 mongos 或 mongod 进程的进行 ID 的文件位置，其中 mongos 或 mongod 将写入其 PID</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre> pidFilePath: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27318/log/mongod.pid\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>net:</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token comment\">#服务实例绑定 IP，默认是 localhost</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre> bindIp: localhost,192.168.244.142</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token comment\">#bindIp</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token comment\">#绑定的端口，默认是 27017</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre> port: <span class=\"token number\">27318</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>replication:</pre></td></tr><tr><td data-num=\"28\"></td><td><pre> <span class=\"token comment\">#副本集的名称</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre> replSetName: myshardrs02</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>sharding:</pre></td></tr><tr><td data-num=\"31\"></td><td><pre> <span class=\"token comment\">#分片角色</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre> clusterRole: shardsvr</pre></td></tr></table></figure><p><mark>第二个服务</mark></p>\n<p>新建或修改配置文件：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ <span class=\"token function\">vim</span> /mongodb/sharded_cluster/myshardrs01_27418/mongod.conf</pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemLog:</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token comment\">#MongoDB 发送所有日志输出的目标指定为文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\">#The path of the log file to which mongod or mongos should send all diagnostic logging information</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> destination: <span class=\"token function\">file</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token comment\">#mongod 或 mongos 应向其发送所有诊断日志记录信息的日志文件的路径</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> path: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27418/log/mongod.log\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token comment\">#当 mongos 或 mongod 实例重新启动时，mongos 或 mongod 会将新条目附加到现有日志文件的末尾。</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> logAppend: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>storage:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token comment\">#mongod 实例存储其数据的目录。storage.dbPath 设置仅适用于 mongod。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> <span class=\"token comment\">#The directory where the mongod instance stores its data.Defaul value is \"/data/db\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> dbPath: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27418/data/db\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> journal:</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token comment\">#启用或禁用持久性日志以确保数据文件保持有效和可恢复</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  enabled: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>processManagement:</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token comment\">#启用在后台运行 mongos 或 mongod 进程的守护进程模式。</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> fork: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre> <span class=\"token comment\">#指定用于保存 mongos 或 mongod 进程的进行 ID 的文件位置，其中 mongos 或 mongod 将写入其 PID</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre> pidFilePath: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27418/log/mongod.pid\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>net:</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token comment\">#服务实例绑定 IP，默认是 localhost</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre> bindIp: localhost,192.168.244.142</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token comment\">#bindIp</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token comment\">#绑定的端口，默认是 27017</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre> port: <span class=\"token number\">27418</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>replication:</pre></td></tr><tr><td data-num=\"28\"></td><td><pre> <span class=\"token comment\">#副本集的名称</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre> replSetName: myshardrs02</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>sharding:</pre></td></tr><tr><td data-num=\"31\"></td><td><pre> <span class=\"token comment\">#分片角色</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre> clusterRole: shardsvr</pre></td></tr></table></figure><p><mark>第三个服务</mark></p>\n<p>新建或修改配置文件：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ <span class=\"token function\">vim</span> /mongodb/sharded_cluster/myshardrs01_27518/mongod.conf</pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemLog:</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token comment\">#MongoDB 发送所有日志输出的目标指定为文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\">#The path of the log file to which mongod or mongos should send all diagnostic logging information</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> destination: <span class=\"token function\">file</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token comment\">#mongod 或 mongos 应向其发送所有诊断日志记录信息的日志文件的路径</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> path: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27518/log/mongod.log\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token comment\">#当 mongos 或 mongod 实例重新启动时，mongos 或 mongod 会将新条目附加到现有日志文件的末尾。</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> logAppend: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>storage:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token comment\">#mongod 实例存储其数据的目录。storage.dbPath 设置仅适用于 mongod。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> <span class=\"token comment\">#The directory where the mongod instance stores its data.Defaul value is \"/data/db\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> dbPath: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27518/data/db\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> journal:</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token comment\">#启用或禁用持久性日志以确保数据文件保持有效和可恢复</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  enabled: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>processManagement:</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token comment\">#启用在后台运行 mongos 或 mongod 进程的守护进程模式。</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> fork: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre> <span class=\"token comment\">#指定用于保存 mongos 或 mongod 进程的进行 ID 的文件位置，其中 mongos 或 mongod 将写入其 PID</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre> pidFilePath: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27518/log/mongod.pid\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>net:</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token comment\">#服务实例绑定 IP，默认是 localhost</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre> bindIp: localhost,192.168.244.142</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token comment\">#bindIp</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token comment\">#绑定的端口，默认是 27017</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre> port: <span class=\"token number\">27518</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>replication:</pre></td></tr><tr><td data-num=\"28\"></td><td><pre> <span class=\"token comment\">#副本集的名称</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre> replSetName: myshardrs02</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>sharding:</pre></td></tr><tr><td data-num=\"31\"></td><td><pre> <span class=\"token comment\">#分片角色</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre> clusterRole: shardsvr</pre></td></tr></table></figure><p>启动服务：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27318/mongod.conf </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>forked process: <span class=\"token number\">5200</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>➜  ~ /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27418/mongod.conf </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>forked process: <span class=\"token number\">5268</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>➜  ~ /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27518/mongod.conf </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>forked process: <span class=\"token number\">5337</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>➜  ~</pre></td></tr></table></figure><p>查看进程：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ <span class=\"token function\">ps</span> -ef<span class=\"token operator\">|</span><span class=\"token function\">grep</span> mongod<span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token parameter variable\">-v</span> <span class=\"token function\">grep</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>dkx0       <span class=\"token number\">2291</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> <span class=\"token number\">20</span>:57 ?        00:00:52 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>dkx0       <span class=\"token number\">2368</span>      <span class=\"token number\">1</span>  <span class=\"token number\">2</span> <span class=\"token number\">20</span>:57 ?        00:01:11 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>dkx0       <span class=\"token number\">2443</span>      <span class=\"token number\">1</span>  <span class=\"token number\">2</span> <span class=\"token number\">20</span>:57 ?        00:01:08 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>dkx0       <span class=\"token number\">5200</span>      <span class=\"token number\">1</span>  <span class=\"token number\">4</span> <span class=\"token number\">21</span>:42 ?        00:00:03 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27318/mongod.conf</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>dkx0       <span class=\"token number\">5268</span>      <span class=\"token number\">1</span>  <span class=\"token number\">5</span> <span class=\"token number\">21</span>:42 ?        00:00:03 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27418/mongod.conf</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>dkx0       <span class=\"token number\">5337</span>      <span class=\"token number\">1</span>  <span class=\"token number\">5</span> <span class=\"token number\">21</span>:43 ?        00:00:02 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27518/mongod.conf</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>➜  ~</pre></td></tr></table></figure><p>初始化副本集和创建主节点：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ /usr/local/mongodb/bin/mongo <span class=\"token parameter variable\">--host</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.244.142 <span class=\"token parameter variable\">--port</span><span class=\"token operator\">=</span><span class=\"token number\">27318</span></pre></td></tr></table></figure><p>初始化副本集：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> rs.<span class=\"token function-name function\">initiate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token string\">\"info2\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"no configuration specified. Using a default configuration for the set\"</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token string\">\"me\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27318\"</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>myshardrs02:SECONDARY<span class=\"token operator\">></span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>myshardrs02:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>添加从节点和仲载节点：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myshardrs02:PRIMARY<span class=\"token operator\">></span> rs.add<span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.244.142:27418\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>myshardrs02:PRIMARY<span class=\"token operator\">></span> rs.add<span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.244.142:27518\"</span>,true<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>查看状态：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myshardrs02:PRIMARY<span class=\"token operator\">></span> rs.<span class=\"token function-name function\">conf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs02\"</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token string\">\"version\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">3</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token string\">\"term\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token string\">\"members\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t<span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t<span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27318\"</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t<span class=\"token string\">\"arbiterOnly\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t<span class=\"token string\">\"buildIndexes\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t<span class=\"token string\">\"hidden\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t<span class=\"token string\">\"priority\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t<span class=\"token string\">\"tags\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t\t</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t<span class=\"token string\">\"slaveDelay\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t<span class=\"token string\">\"votes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t<span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t<span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27418\"</span>,</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t<span class=\"token string\">\"arbiterOnly\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\t<span class=\"token string\">\"buildIndexes\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t\t<span class=\"token string\">\"hidden\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\t<span class=\"token string\">\"priority\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t\t<span class=\"token string\">\"tags\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\t\t</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\t<span class=\"token string\">\"slaveDelay\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\t<span class=\"token string\">\"votes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\t<span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t\t<span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27518\"</span>,</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t\t<span class=\"token string\">\"arbiterOnly\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t\t<span class=\"token string\">\"buildIndexes\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t\t<span class=\"token string\">\"hidden\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t\t<span class=\"token string\">\"priority\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t\t<span class=\"token string\">\"tags\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\t\t\t</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\t\t<span class=\"token string\">\"slaveDelay\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t\t\t<span class=\"token string\">\"votes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t<span class=\"token punctuation\">]</span>,</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t<span class=\"token string\">\"protocolVersion\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t<span class=\"token string\">\"writeConcernMajorityJournalDefault\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t<span class=\"token string\">\"settings\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t\t<span class=\"token string\">\"chainingAllowed\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t\t<span class=\"token string\">\"heartbeatIntervalMillis\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2000</span>,</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t\t<span class=\"token string\">\"heartbeatTimeoutSecs\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">10</span>,</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t\t<span class=\"token string\">\"electionTimeoutMillis\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">10000</span>,</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\t\t<span class=\"token string\">\"catchUpTimeoutMillis\"</span> <span class=\"token builtin class-name\">:</span> -1,</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>\t\t<span class=\"token string\">\"catchUpTakeoverDelayMillis\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">30000</span>,</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\t\t<span class=\"token string\">\"getLastErrorModes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\t\t\t</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\t\t<span class=\"token string\">\"getLastErrorDefaults\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>\t\t\t<span class=\"token string\">\"w\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>\t\t\t<span class=\"token string\">\"wtimeout\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>\t\t<span class=\"token string\">\"replicaSetId\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"648132fed44efefc463628be\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>myshardrs02:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>到此两个分片副本集就搭建完成了</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031659810.png\" alt=\"image-20230608095125494\"></p>\n<p>下面搭建配置服务</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031659497.png\" alt=\"image-20230608095211835\"></p>\n<h3 id=\"配置节点副本集的创建\"><a class=\"markdownIt-Anchor\" href=\"#配置节点副本集的创建\">#</a> 配置节点副本集的创建</h3>\n<p>创建存放数据和日志的目录：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/sharded_cluster/myshardrs01_27019/log <span class=\"token punctuation\">\\</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/sharded_cluster/myshardrs01_27019/data/db <span class=\"token punctuation\">\\</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/sharded_cluster/myshardrs01_27119/log <span class=\"token punctuation\">\\</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/sharded_cluster/myshardrs01_27119/data/db <span class=\"token punctuation\">\\</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/sharded_cluster/myshardrs01_27219/log <span class=\"token punctuation\">\\</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/sharded_cluster/myshardrs01_27219/data/db</pre></td></tr></table></figure><p><mark>第一个服务</mark></p>\n<p>新建或修改配置文件：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ <span class=\"token function\">vim</span> /mongodb/sharded_cluster/myshardrs01_27019/mongod.conf</pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemLog:</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token comment\">#MongoDB 发送所有日志输出的目标指定为文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\">#The path of the log file to which mongod or mongos should send all diagnostic logging information</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> destination: <span class=\"token function\">file</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token comment\">#mongod 或 mongos 应向其发送所有诊断日志记录信息的日志文件的路径</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> path: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27019/log/mongod.log\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token comment\">#当 mongos 或 mongod 实例重新启动时，mongos 或 mongod 会将新条目附加到现有日志文件的末尾。</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> logAppend: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>storage:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token comment\">#mongod 实例存储其数据的目录。storage.dbPath 设置仅适用于 mongod。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> <span class=\"token comment\">#The directory where the mongod instance stores its data.Defaul value is \"/data/db\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> dbPath: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27019/data/db\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> journal:</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token comment\">#启用或禁用持久性日志以确保数据文件保持有效和可恢复</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  enabled: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>processManagement:</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token comment\">#启用在后台运行 mongos 或 mongod 进程的守护进程模式。</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> fork: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre> <span class=\"token comment\">#指定用于保存 mongos 或 mongod 进程的进行 ID 的文件位置，其中 mongos 或 mongod 将写入其 PID</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre> pidFilePath: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27019/log/mongod.pid\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>net:</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token comment\">#服务实例绑定 IP，默认是 localhost</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre> bindIp: localhost,192.168.244.142</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token comment\">#bindIp</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token comment\">#绑定的端口，默认是 27017</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre> port: <span class=\"token number\">27019</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>replication:</pre></td></tr><tr><td data-num=\"28\"></td><td><pre> <span class=\"token comment\">#副本集的名称</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre> replSetName: myshardrs</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>sharding:</pre></td></tr><tr><td data-num=\"31\"></td><td><pre> <span class=\"token comment\">#分片角色</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre> clusterRole: configsvr</pre></td></tr></table></figure><p><mark>第二个服务</mark></p>\n<p>新建或修改配置文件：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ <span class=\"token function\">vim</span> /mongodb/sharded_cluster/myshardrs01_27119/mongod.conf</pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemLog:</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token comment\">#MongoDB 发送所有日志输出的目标指定为文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\">#The path of the log file to which mongod or mongos should send all diagnostic logging information</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> destination: <span class=\"token function\">file</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token comment\">#mongod 或 mongos 应向其发送所有诊断日志记录信息的日志文件的路径</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> path: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27119/log/mongod.log\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token comment\">#当 mongos 或 mongod 实例重新启动时，mongos 或 mongod 会将新条目附加到现有日志文件的末尾。</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> logAppend: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>storage:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token comment\">#mongod 实例存储其数据的目录。storage.dbPath 设置仅适用于 mongod。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> <span class=\"token comment\">#The directory where the mongod instance stores its data.Defaul value is \"/data/db\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> dbPath: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27119/data/db\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> journal:</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token comment\">#启用或禁用持久性日志以确保数据文件保持有效和可恢复</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  enabled: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>processManagement:</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token comment\">#启用在后台运行 mongos 或 mongod 进程的守护进程模式。</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> fork: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre> <span class=\"token comment\">#指定用于保存 mongos 或 mongod 进程的进行 ID 的文件位置，其中 mongos 或 mongod 将写入其 PID</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre> pidFilePath: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27119/log/mongod.pid\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>net:</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token comment\">#服务实例绑定 IP，默认是 localhost</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre> bindIp: localhost,192.168.244.142</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token comment\">#bindIp</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token comment\">#绑定的端口，默认是 27017</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre> port: <span class=\"token number\">27119</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>replication:</pre></td></tr><tr><td data-num=\"28\"></td><td><pre> <span class=\"token comment\">#副本集的名称</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre> replSetName: myshardrs</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>sharding:</pre></td></tr><tr><td data-num=\"31\"></td><td><pre> <span class=\"token comment\">#分片角色</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre> clusterRole: configsvr</pre></td></tr></table></figure><p><mark>第三个服务</mark></p>\n<p>新建或修改配置文件：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ <span class=\"token function\">vim</span> /mongodb/sharded_cluster/myshardrs01_27219/mongod.conf</pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemLog:</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token comment\">#MongoDB 发送所有日志输出的目标指定为文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\">#The path of the log file to which mongod or mongos should send all diagnostic logging information</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> destination: <span class=\"token function\">file</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token comment\">#mongod 或 mongos 应向其发送所有诊断日志记录信息的日志文件的路径</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> path: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27219/log/mongod.log\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token comment\">#当 mongos 或 mongod 实例重新启动时，mongos 或 mongod 会将新条目附加到现有日志文件的末尾。</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> logAppend: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>storage:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token comment\">#mongod 实例存储其数据的目录。storage.dbPath 设置仅适用于 mongod。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> <span class=\"token comment\">#The directory where the mongod instance stores its data.Defaul value is \"/data/db\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> dbPath: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27219/data/db\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> journal:</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token comment\">#启用或禁用持久性日志以确保数据文件保持有效和可恢复</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  enabled: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>processManagement:</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token comment\">#启用在后台运行 mongos 或 mongod 进程的守护进程模式。</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> fork: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre> <span class=\"token comment\">#指定用于保存 mongos 或 mongod 进程的进行 ID 的文件位置，其中 mongos 或 mongod 将写入其 PID</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre> pidFilePath: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs01_27219/log/mongod.pid\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>net:</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token comment\">#服务实例绑定 IP，默认是 localhost</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre> bindIp: localhost,192.168.244.142</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token comment\">#bindIp</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token comment\">#绑定的端口，默认是 27017</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre> port: <span class=\"token number\">27219</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>replication:</pre></td></tr><tr><td data-num=\"28\"></td><td><pre> <span class=\"token comment\">#副本集的名称</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre> replSetName: myshardrs</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>sharding:</pre></td></tr><tr><td data-num=\"31\"></td><td><pre> <span class=\"token comment\">#分片角色</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre> clusterRole: configsvr</pre></td></tr></table></figure><p>启动服务：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27019/mongod.conf </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>forked process: <span class=\"token number\">7659</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>➜  ~ /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27119/mongod.conf </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>forked process: <span class=\"token number\">7736</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>➜  ~ /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27219/mongod.conf </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>forked process: <span class=\"token number\">7808</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>➜  ~</pre></td></tr></table></figure><p>查看进程：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ <span class=\"token function\">ps</span> -ef<span class=\"token operator\">|</span><span class=\"token function\">grep</span> mongod<span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token parameter variable\">-v</span> <span class=\"token function\">grep</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#分片副本集</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>dkx0       <span class=\"token number\">2291</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> <span class=\"token number\">20</span>:57 ?        00:01:36 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>dkx0       <span class=\"token number\">2368</span>      <span class=\"token number\">1</span>  <span class=\"token number\">2</span> <span class=\"token number\">20</span>:57 ?        00:01:55 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>dkx0       <span class=\"token number\">2443</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> <span class=\"token number\">20</span>:57 ?        00:01:40 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>dkx0       <span class=\"token number\">5200</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> <span class=\"token number\">21</span>:42 ?        00:00:48 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27318/mongod.conf</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>dkx0       <span class=\"token number\">5268</span>      <span class=\"token number\">1</span>  <span class=\"token number\">2</span> <span class=\"token number\">21</span>:42 ?        00:00:49 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27418/mongod.conf</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>dkx0       <span class=\"token number\">5337</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> <span class=\"token number\">21</span>:43 ?        00:00:38 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27518/mongod.conf</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#配置副本集</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>dkx0       <span class=\"token number\">7659</span>      <span class=\"token number\">1</span>  <span class=\"token number\">3</span> <span class=\"token number\">22</span>:19 ?        00:00:08 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27019/mongod.conf</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>dkx0       <span class=\"token number\">7736</span>      <span class=\"token number\">1</span>  <span class=\"token number\">3</span> <span class=\"token number\">22</span>:19 ?        00:00:07 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27119/mongod.conf</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>dkx0       <span class=\"token number\">7808</span>      <span class=\"token number\">1</span>  <span class=\"token number\">3</span> <span class=\"token number\">22</span>:19 ?        00:00:07 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27219/mongod.conf</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>➜  ~</pre></td></tr></table></figure><p>初始化配置服务：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> rs.<span class=\"token function-name function\">initiate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token string\">\"info2\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"no configuration specified. Using a default configuration for the set\"</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token string\">\"me\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27019\"</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token string\">\"<span class=\"token variable\">$gleStats</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token string\">\"lastOpTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686191196</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token string\">\"electionId\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"000000000000000000000000\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token string\">\"lastCommittedOpTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686191196</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>myshardrs:SECONDARY<span class=\"token operator\">></span> </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>myshardrs:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>添加从节点，配置服务中没有仲载节点：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myshardrs:PRIMARY<span class=\"token operator\">></span> rs.add<span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.244.142:27119\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>myshardrs:PRIMARY<span class=\"token operator\">></span> rs.add<span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.244.142:27219\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>查看状态：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myshardrs:PRIMARY<span class=\"token operator\">></span> rs.<span class=\"token function-name function\">conf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs\"</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token string\">\"version\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">5</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token string\">\"term\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token string\">\"members\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t<span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t<span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27019\"</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t<span class=\"token string\">\"arbiterOnly\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t<span class=\"token string\">\"buildIndexes\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t<span class=\"token string\">\"hidden\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t<span class=\"token string\">\"priority\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t<span class=\"token string\">\"tags\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t\t</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t<span class=\"token string\">\"secondaryDelaySecs\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t<span class=\"token string\">\"votes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t<span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t<span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27119\"</span>,</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t<span class=\"token string\">\"arbiterOnly\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\t<span class=\"token string\">\"buildIndexes\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t\t<span class=\"token string\">\"hidden\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\t<span class=\"token string\">\"priority\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t\t<span class=\"token string\">\"tags\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\t\t</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\t<span class=\"token string\">\"secondaryDelaySecs\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\t<span class=\"token string\">\"votes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\t<span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t\t<span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"192.168.244.142:27219\"</span>,</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t\t<span class=\"token string\">\"arbiterOnly\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t\t<span class=\"token string\">\"buildIndexes\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t\t<span class=\"token string\">\"hidden\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t\t<span class=\"token string\">\"priority\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t\t<span class=\"token string\">\"tags\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\t\t\t</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\t\t<span class=\"token string\">\"secondaryDelaySecs\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t\t\t<span class=\"token string\">\"votes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t<span class=\"token punctuation\">]</span>,</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t<span class=\"token string\">\"configsvr\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t<span class=\"token string\">\"protocolVersion\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t<span class=\"token string\">\"writeConcernMajorityJournalDefault\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t<span class=\"token string\">\"settings\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t\t<span class=\"token string\">\"chainingAllowed\"</span> <span class=\"token builtin class-name\">:</span> true,</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t\t<span class=\"token string\">\"heartbeatIntervalMillis\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2000</span>,</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t\t<span class=\"token string\">\"heartbeatTimeoutSecs\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">10</span>,</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\t\t<span class=\"token string\">\"electionTimeoutMillis\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">10000</span>,</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>\t\t<span class=\"token string\">\"catchUpTimeoutMillis\"</span> <span class=\"token builtin class-name\">:</span> -1,</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\t\t<span class=\"token string\">\"catchUpTakeoverDelayMillis\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">30000</span>,</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\t\t<span class=\"token string\">\"getLastErrorModes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\t\t\t</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>\t\t<span class=\"token string\">\"getLastErrorDefaults\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>\t\t\t<span class=\"token string\">\"w\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>\t\t\t<span class=\"token string\">\"wtimeout\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>\t\t<span class=\"token string\">\"replicaSetId\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"64813c5c4c6469e9d2fe9264\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>myshardrs:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031700512.png\" alt=\"image-20230608102950142\"></p>\n<p>配置服务搭建完成！</p>\n<p>分片和配置副本集服务都搭建完成了下面搭建路由节点服务，注意它使用的不是 mongod 服务了而是 mongos 服务</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031700137.png\" alt=\"image-20230608103603425\"></p>\n<h3 id=\"路由节点的创建和操作\"><a class=\"markdownIt-Anchor\" href=\"#路由节点的创建和操作\">#</a> 路由节点的创建和操作</h3>\n<h4 id=\"第一个路由节点的创建和连接\"><a class=\"markdownIt-Anchor\" href=\"#第一个路由节点的创建和连接\">#</a> 第一个路由节点的创建和连接</h4>\n<p>路由的主要作用就是分发不会存储具体的数据，所以不需要 data 目录</p>\n<p>创建存放数据和日志的目录：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜ ~ <span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/sharded_cluster/myshardrs_27017/log</pre></td></tr></table></figure><p>新建或修改配置文件：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ <span class=\"token function\">vim</span> /mongodb/sharded_cluster/myshardrs_27017/mongos.conf</pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemLog:</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token comment\">#MongoDB 发送所有日志输出的目标指定为文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\">#The path of the log file to which mongod or mongos should send all diagnostic logging information</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> destination: <span class=\"token function\">file</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token comment\">#mongod 或 mongos 应向其发送所有诊断日志记录信息的日志文件的路径</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> path: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs_27017/log/mongod.log\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token comment\">#当 mongos 或 mongod 实例重新启动时，mongos 或 mongod 会将新条目附加到现有日志文件的末尾。</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> logAppend: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>processManagement:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token comment\">#启用在后台运行 mongos 或 mongod 进程的守护进程模式。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> fork: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> <span class=\"token comment\">#指定用于保存 mongos 或 mongod 进程的进行 ID 的文件位置，其中 mongos 或 mongod 将写入其 PID</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> pidFilePath: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs_27017/log/mongod.pid\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>net:</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token comment\">#服务实例绑定 IP，默认是 localhost</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre> bindIp: localhost,192.168.244.142</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token comment\">#bindIp</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token comment\">#绑定的端口，默认是 27017</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre> port: <span class=\"token number\">27017</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>sharding:</pre></td></tr><tr><td data-num=\"21\"></td><td><pre> <span class=\"token comment\">#指定配置节点副本集</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre> <span class=\"token comment\">#        副本集名称 / 主机地址与端口号</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre> configDB: myconfigrs/192.168.244.142:27019,192.168.244.142:27119,192.168.244.142:27219</pre></td></tr></table></figure><p>启动服务：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ /usr/local/mongodb/bin/mongos <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs_27017/mongos.conf </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>forked process: <span class=\"token number\">10092</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>➜  ~</pre></td></tr></table></figure><p>查看进程：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#分片副本集</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>➜  ~ <span class=\"token function\">ps</span> -ef<span class=\"token operator\">|</span><span class=\"token function\">grep</span> mongod<span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token parameter variable\">-v</span> <span class=\"token function\">grep</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>dkx0       <span class=\"token number\">2291</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> <span class=\"token number\">20</span>:57 ?        00:02:07 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>dkx0       <span class=\"token number\">2368</span>      <span class=\"token number\">1</span>  <span class=\"token number\">2</span> <span class=\"token number\">20</span>:57 ?        00:02:26 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>dkx0       <span class=\"token number\">2443</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> <span class=\"token number\">20</span>:57 ?        00:02:02 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>dkx0       <span class=\"token number\">5200</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> <span class=\"token number\">21</span>:42 ?        00:01:19 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27318/mongod.conf</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>dkx0       <span class=\"token number\">5268</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> <span class=\"token number\">21</span>:42 ?        00:01:19 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27418/mongod.conf</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>dkx0       <span class=\"token number\">5337</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> <span class=\"token number\">21</span>:43 ?        00:01:00 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27518/mongod.conf</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#配置服务副本集</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>dkx0       <span class=\"token number\">7659</span>      <span class=\"token number\">1</span>  <span class=\"token number\">2</span> <span class=\"token number\">22</span>:19 ?        00:00:53 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27019/mongod.conf</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>dkx0       <span class=\"token number\">7736</span>      <span class=\"token number\">1</span>  <span class=\"token number\">2</span> <span class=\"token number\">22</span>:19 ?        00:00:54 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27119/mongod.conf</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>dkx0       <span class=\"token number\">7808</span>      <span class=\"token number\">1</span>  <span class=\"token number\">2</span> <span class=\"token number\">22</span>:19 ?        00:00:53 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27219/mongod.conf</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#路由副本集</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>dkx0      <span class=\"token number\">10092</span>      <span class=\"token number\">1</span>  <span class=\"token number\">0</span> <span class=\"token number\">22</span>:53 ?        00:00:00 /usr/local/mongodb/bin/mongos <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs_27017/mongos.conf</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>➜  ~</pre></td></tr></table></figure><p>连接客户端：还是同样的操作，但是命令符提示为：mongos</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ /usr/local/mongodb/bin/mongo <span class=\"token parameter variable\">--host</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.244.142 <span class=\"token parameter variable\">--port</span><span class=\"token operator\">=</span><span class=\"token number\">27017</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>MongoDB shell version v5.0.18</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>connecting to: mongodb://192.168.244.142:27017/?compressors<span class=\"token operator\">=</span>disabled<span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">gssapiServiceName</span><span class=\"token operator\">=</span>mongodb</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Implicit session: session <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"id\"</span> <span class=\"token builtin class-name\">:</span> UUID<span class=\"token punctuation\">(</span><span class=\"token string\">\"f9216227-99d6-4270-bb3e-b47ab59e205b\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>MongoDB server version: <span class=\"token number\">5.0</span>.18</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Warning: the <span class=\"token string\">\"mongo\"</span> shell has been superseded by <span class=\"token string\">\"mongosh\"</span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">which</span> delivers improved usability and compatibility.The <span class=\"token string\">\"mongo\"</span> shell has been deprecated and will be removed <span class=\"token keyword\">in</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>an upcoming release.</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>For installation instructions, see</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>https://docs.mongodb.com/mongodb-shell/install/</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>---</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>The server generated these startup warnings when booting: </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token number\">2023</span>-06-07T22:53:18.509-04:00: Access control is not enabled <span class=\"token keyword\">for</span> the database. Read and <span class=\"token function\">write</span> access to data and configuration is unrestricted</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>---</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>mongos<span class=\"token operator\">></span></pre></td></tr></table></figure><p>此时，能查看数据库，但是不能写入数据否则报错：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongos<span class=\"token operator\">></span> show dbs</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>admin   <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>config  <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>mongos<span class=\"token operator\">></span> use aabb</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>switched to db aabb</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>mongos<span class=\"token operator\">></span> db</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>aabb</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>mongos<span class=\"token operator\">></span> db.aa.insert<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"刘桑\"</span>,<span class=\"token string\">\"age\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"22\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>WriteCommandError<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token string\">\"errmsg\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"Database aabb could not be created :: caused by :: No shards found\"</span>,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token string\">\"code\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">70</span>,</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token string\">\"codeName\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"ShardNotFound\"</span>,</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token string\">\"<span class=\"token variable\">$clusterTime</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t<span class=\"token string\">\"clusterTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686193139</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t<span class=\"token string\">\"signature\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t<span class=\"token string\">\"hash\"</span> <span class=\"token builtin class-name\">:</span> BinData<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>,<span class=\"token string\">\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t<span class=\"token string\">\"keyId\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token string\">\"operationTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686193139</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>mongos<span class=\"token operator\">></span></pre></td></tr></table></figure><p>报错信息：Database aabb could not be created :: caused by :: No shards found</p>\n<p>翻译：无法创建数据库 aabb ：： 由 ：： 未找到分片</p>\n<p>解释：</p>\n<blockquote>\n<p>我们新建路由节点的时候配置文件中只指定了配置服务副本集如下：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>sharding:</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token comment\">#指定配置节点副本集</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\">#        副本集名称 / 主机地址与端口号</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> configDB: myconfigrs/192.168.244.142:27019,192.168.244.142:27119,192.168.244.142:27219</pre></td></tr></table></figure><p>mongos 启动的时候指定了副本集代表路由和配置服务是联通的，但是没有分片不能存储数据，因为最终存储数据是分片</p>\n</blockquote>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031700965.png\" alt=\"image-20230608110542590\"></p>\n<h4 id=\"在路由节点上进行分片配置操作\"><a class=\"markdownIt-Anchor\" href=\"#在路由节点上进行分片配置操作\">#</a> 在路由节点上进行分片配置操作</h4>\n<p>使用命令添加分片：</p>\n<p>1. 添加分片：</p>\n<p>语法：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>sh.addShard<span class=\"token punctuation\">(</span><span class=\"token string\">\"IP:Port\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>将第一套分片副本集添加进来：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongos<span class=\"token operator\">></span> sh.addShard<span class=\"token punctuation\">(</span><span class=\"token string\">\"myshardrs01/192.168.244.142:27018,192.168.244.142:27118,192.168.244.142:27218\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token string\">\"shardAdded\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs01\"</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token string\">\"<span class=\"token variable\">$clusterTime</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t<span class=\"token string\">\"clusterTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686193852</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token string\">\"signature\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t<span class=\"token string\">\"hash\"</span> <span class=\"token builtin class-name\">:</span> BinData<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>,<span class=\"token string\">\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t<span class=\"token string\">\"keyId\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token string\">\"operationTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686193852</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>mongos<span class=\"token operator\">></span></pre></td></tr></table></figure><p>继续将第二套分片副本集添加进来：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongos<span class=\"token operator\">></span> sh.addShard<span class=\"token punctuation\">(</span><span class=\"token string\">\"myshardrs02/192.168.244.142:27318,192.168.244.142:27418,192.168.244.142:27518\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token string\">\"shardAdded\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs02\"</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token string\">\"<span class=\"token variable\">$clusterTime</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t<span class=\"token string\">\"clusterTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686194172</span>, <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token string\">\"signature\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t<span class=\"token string\">\"hash\"</span> <span class=\"token builtin class-name\">:</span> BinData<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>,<span class=\"token string\">\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t<span class=\"token string\">\"keyId\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token string\">\"operationTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686194172</span>, <span class=\"token number\">3</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>mongos<span class=\"token operator\">></span></pre></td></tr></table></figure><p>查看状态：可以看到 shards 中有两个分片副本集了</p>\n<p>“host” : “myshardrs01/192.168.244.142:27018,192.168.244.142:27118” 没有把仲载节点加进来</p>\n<p>因为仲载不存储数据所以分片的时候没必要知道它，但是使用 sh.addShard 的时候还是必须带上的</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongos<span class=\"token operator\">></span> sh.status<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>--- Sharding Status --- </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  sharding version: <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  \t<span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  \t<span class=\"token string\">\"minCompatibleVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">5</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  \t<span class=\"token string\">\"currentVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">6</span>,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  \t<span class=\"token string\">\"clusterId\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"64813c5c4c6469e9d2fe9269\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  shards:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs01\"</span>,  <span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs01/192.168.244.142:27018,192.168.244.142:27118\"</span>,  <span class=\"token string\">\"state\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,  <span class=\"token string\">\"topologyTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686193851</span>, <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs02\"</span>,  <span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs02/192.168.244.142:27318,192.168.244.142:27418\"</span>,  <span class=\"token string\">\"state\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,  <span class=\"token string\">\"topologyTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686194172</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  active mongoses:</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token string\">\"5.0.18\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  autosplit:</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        Currently enabled: <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  balancer:</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        Currently enabled: <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        Currently running: <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        Failed balancer rounds <span class=\"token keyword\">in</span> last <span class=\"token number\">5</span> attempts: <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        Migration results <span class=\"token keyword\">for</span> the last <span class=\"token number\">24</span> hours: </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token number\">55</span> <span class=\"token builtin class-name\">:</span> Success</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  databases:</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"articledb\"</span>,  <span class=\"token string\">\"primary\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs01\"</span>,  <span class=\"token string\">\"partitioned\"</span> <span class=\"token builtin class-name\">:</span> false,  <span class=\"token string\">\"version\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"uuid\"</span> <span class=\"token builtin class-name\">:</span> UUID<span class=\"token punctuation\">(</span><span class=\"token string\">\"b94e53c7-d498-49b8-8965-1aafcab2df18\"</span><span class=\"token punctuation\">)</span>,  <span class=\"token string\">\"timestamp\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686193851</span>, <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>,  <span class=\"token string\">\"lastMod\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"config\"</span>,  <span class=\"token string\">\"primary\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"config\"</span>,  <span class=\"token string\">\"partitioned\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                config.system.sessions</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                        shard key: <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                        unique: <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                        balancing: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                        chunks:</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                                myshardrs01\t<span class=\"token number\">969</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                                myshardrs02\t<span class=\"token number\">55</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                        too many chunks to print, use verbose <span class=\"token keyword\">if</span> you want to force print</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>mongos<span class=\"token operator\">></span></pre></td></tr></table></figure><p>提示：</p>\n<p>如果添加分片失败，需要先手动移除分片，检查添加分片的信息正确性后，再次添加分片</p>\n<p>移除分片参考：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>use admin</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>db.runcommand<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>removeShard:<span class=\"token string\">\"myshardrs02\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>注意： 如果只剩下最后一个 shard，是无法删除的</p>\n<p>移除时会自动转移分片数据，需要一个时间过程</p>\n<p>完成后，再次执行删除分片命令才能真正删除</p>\n<p>2. 开启分片功能：sh.enableSharding (“库名”)，sh.shardCollection (“库名。集合名”,{“key”:1}&quot;)</p>\n<p>在 mongos 上的 articledb 数据库配置 sharding:</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongos<span class=\"token operator\">></span> sh.enableSharding<span class=\"token punctuation\">(</span><span class=\"token string\">\"articledb\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token string\">\"<span class=\"token variable\">$clusterTime</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token string\">\"clusterTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686194695</span>, <span class=\"token number\">38</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t<span class=\"token string\">\"signature\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t<span class=\"token string\">\"hash\"</span> <span class=\"token builtin class-name\">:</span> BinData<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>,<span class=\"token string\">\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t<span class=\"token string\">\"keyId\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token string\">\"operationTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686194695</span>, <span class=\"token number\">38</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>mongos<span class=\"token operator\">></span></pre></td></tr></table></figure><p>查看分片状态：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongos<span class=\"token operator\">></span> sh.status<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>--- Sharding Status --- </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  sharding version: <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  \t<span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  \t<span class=\"token string\">\"minCompatibleVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">5</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  \t<span class=\"token string\">\"currentVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">6</span>,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  \t<span class=\"token string\">\"clusterId\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"64813c5c4c6469e9d2fe9269\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  shards:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs01\"</span>,  <span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs01/192.168.244.142:27018,192.168.244.142:27118\"</span>,  <span class=\"token string\">\"state\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,  <span class=\"token string\">\"topologyTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686193851</span>, <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs02\"</span>,  <span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs02/192.168.244.142:27318,192.168.244.142:27418\"</span>,  <span class=\"token string\">\"state\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,  <span class=\"token string\">\"topologyTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686194172</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  active mongoses:</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token string\">\"5.0.18\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  autosplit:</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        Currently enabled: <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  balancer:</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        Currently enabled: <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        Currently running: no</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        Failed balancer rounds <span class=\"token keyword\">in</span> last <span class=\"token number\">5</span> attempts: <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        Migration results <span class=\"token keyword\">for</span> the last <span class=\"token number\">24</span> hours: </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token number\">480</span> <span class=\"token builtin class-name\">:</span> Success</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  databases:</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"articledb\"</span>,  <span class=\"token string\">\"primary\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs01\"</span>,  <span class=\"token string\">\"partitioned\"</span> <span class=\"token builtin class-name\">:</span> true,  <span class=\"token string\">\"version\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"uuid\"</span> <span class=\"token builtin class-name\">:</span> UUID<span class=\"token punctuation\">(</span><span class=\"token string\">\"b94e53c7-d498-49b8-8965-1aafcab2df18\"</span><span class=\"token punctuation\">)</span>,  <span class=\"token string\">\"timestamp\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686193851</span>, <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>,  <span class=\"token string\">\"lastMod\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"config\"</span>,  <span class=\"token string\">\"primary\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"config\"</span>,  <span class=\"token string\">\"partitioned\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                config.system.sessions</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                        shard key: <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                        unique: <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                        balancing: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                        chunks:</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                                myshardrs01\t<span class=\"token number\">544</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                                myshardrs02\t<span class=\"token number\">480</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                        too many chunks to print, use verbose <span class=\"token keyword\">if</span> you want to force print</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>mongos<span class=\"token operator\">></span></pre></td></tr></table></figure><p>3. 集合分片</p>\n<p>对集合分片，你必须使用 sh.shardCollection () 方法指定集合的分片键。</p>\n<p>语法：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>sh.shardCollection<span class=\"token punctuation\">(</span>namespace,key,unique<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>参数：</p>\n<table>\n<thead>\n<tr>\n<th>Parameter</th>\n<th>Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>namespace</td>\n<td>string</td>\n<td>要 (分片) 共享的目标集合的命名空间，格式：<database>.<collection></td>\n</tr>\n<tr>\n<td>key</td>\n<td>document</td>\n<td>用作分片键的索引规范文档，shard 键决定 MongoDB 如何在 shard 之间分发文档，除非集合为空，否则索引必须在 shard collection 命令之前存在，如果集合为空，则 MongoDB 在对集合进行分片之前创建索引，前提是支持分片键的索引不存在，简单的说：由包含字段和该字段的索引遍历方向的文档组成</td>\n</tr>\n<tr>\n<td>unique</td>\n<td>boolean</td>\n<td>当值为 true 情况下，片键字段上会限制为确保是唯一索引，哈希策略片键不支持唯一索引，默认是 false</td>\n</tr>\n</tbody>\n</table>\n<p>对集合进行分片时，你需要选择一个片键 (Shard key),shard key 是每条记录都必须包含的，且建立了索引的单个字段或复合字段，MongoDB 按照片键将数据划分到不同的数据块中，并将数据块 均衡的分不到所有分片中，为了按照片键划分数据库 MongoDB 使用基于哈希的分片方式 (随机平均分配) 或者基于范围的分片方式 (数值大小分配)</p>\n<p>用什么字段当片键都可以，如：nickname 作为片键，但一定是必填字段</p>\n<p><mark>注意</mark>：MongoDB 只能通过一个字段给某个集合分片不能说一个集合即按哈希有按范围分片</p>\n<p>分片规则一：哈希策略</p>\n<p>对于基于哈希的分片，MongoDB 计算一个字段的哈希值，并用这个哈希值来创建数据块</p>\n<p>在使用基于哈希分片的系统中，拥有 &quot;相近&quot; 片键的文档，很可能不会存储在同一个数据块中，因此数据的分离性更好一些。</p>\n<p>使用 nickname 作为片键，根据其值的哈希值进行数据分片</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongos<span class=\"token operator\">></span> sh.shardCollection<span class=\"token punctuation\">(</span><span class=\"token string\">\"articledb.comment\"</span>,<span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"nickname\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"hashed\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token string\">\"collectionsharded\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"articledb.comment\"</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token string\">\"<span class=\"token variable\">$clusterTime</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t<span class=\"token string\">\"clusterTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686196321</span>, <span class=\"token number\">36</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token string\">\"signature\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t<span class=\"token string\">\"hash\"</span> <span class=\"token builtin class-name\">:</span> BinData<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>,<span class=\"token string\">\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t<span class=\"token string\">\"keyId\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token string\">\"operationTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686196321</span>, <span class=\"token number\">32</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>mongos<span class=\"token operator\">></span></pre></td></tr></table></figure><p>查看状态：</p>\n<p>shard key: {“nickname” : “hashed” } 分片策略哈希</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongos<span class=\"token operator\">></span> sh.status<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>--- Sharding Status --- </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  sharding version: <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  \t<span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  \t<span class=\"token string\">\"minCompatibleVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">5</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  \t<span class=\"token string\">\"currentVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">6</span>,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  \t<span class=\"token string\">\"clusterId\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"64813c5c4c6469e9d2fe9269\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  shards:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs01\"</span>,  <span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs01/192.168.244.142:27018,192.168.244.142:27118\"</span>,  <span class=\"token string\">\"state\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,  <span class=\"token string\">\"topologyTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686193851</span>, <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs02\"</span>,  <span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs02/192.168.244.142:27318,192.168.244.142:27418\"</span>,  <span class=\"token string\">\"state\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,  <span class=\"token string\">\"topologyTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686194172</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  active mongoses:</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token string\">\"5.0.18\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  autosplit:</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        Currently enabled: <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  balancer:</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        Currently enabled: <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        Currently running: no</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        Failed balancer rounds <span class=\"token keyword\">in</span> last <span class=\"token number\">5</span> attempts: <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        Migration results <span class=\"token keyword\">for</span> the last <span class=\"token number\">24</span> hours: </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token number\">512</span> <span class=\"token builtin class-name\">:</span> Success</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  databases:</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"articledb\"</span>,  <span class=\"token string\">\"primary\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs01\"</span>,  <span class=\"token string\">\"partitioned\"</span> <span class=\"token builtin class-name\">:</span> true,  <span class=\"token string\">\"version\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"uuid\"</span> <span class=\"token builtin class-name\">:</span> UUID<span class=\"token punctuation\">(</span><span class=\"token string\">\"b94e53c7-d498-49b8-8965-1aafcab2df18\"</span><span class=\"token punctuation\">)</span>,  <span class=\"token string\">\"timestamp\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686193851</span>, <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>,  <span class=\"token string\">\"lastMod\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                articledb.comment</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                        shard key: <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"hashed\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                        unique: <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                        balancing: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                        chunks:</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                                myshardrs01\t<span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                                myshardrs02\t<span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                        <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"<span class=\"token variable\">$minKey</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span> --<span class=\"token operator\">>></span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token string\">\"-4611686018427387902\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span> on <span class=\"token builtin class-name\">:</span> myshardrs01 Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1</span>, <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                        <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token string\">\"-4611686018427387902\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span> --<span class=\"token operator\">>></span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span> on <span class=\"token builtin class-name\">:</span> myshardrs01 Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                        <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span> --<span class=\"token operator\">>></span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token string\">\"4611686018427387902\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span> on <span class=\"token builtin class-name\">:</span> myshardrs02 Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1</span>, <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                        <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token string\">\"4611686018427387902\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span> --<span class=\"token operator\">>></span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"<span class=\"token variable\">$maxKey</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span> on <span class=\"token builtin class-name\">:</span> myshardrs02 Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1</span>, <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"config\"</span>,  <span class=\"token string\">\"primary\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"config\"</span>,  <span class=\"token string\">\"partitioned\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                config.system.sessions</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                        shard key: <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                        unique: <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                        balancing: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                        chunks:</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                                myshardrs01\t<span class=\"token number\">512</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                                myshardrs02\t<span class=\"token number\">512</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                        too many chunks to print, use verbose <span class=\"token keyword\">if</span> you want to force print</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>mongos<span class=\"token operator\">></span></pre></td></tr></table></figure><p>提示：</p>\n<p>报错：please create an index that starts with the shard key before sharding</p>\n<p>解决方式：判断分支是查找是否有可用的索引存在，当无可用的索引，并且表不为空时，就会出现这个错误信息。</p>\n<p>分片规则二：值范围策略</p>\n<p>对于基于范围的分片，MongoDB 按照片键的范围把数据分成不同部分，假设有一个数字的片键：想象一个从负无穷到正无穷的直线，每一个片键的值都在直线上画了一个点。MongoDB 把这条直线划分为更短的不重叠的片段，并称之为数据块，每个数据块包含了片键在一定范围内的数据。</p>\n<p>在使用片键做范围划分的系统中，拥有 &quot;相近&quot; 片键的文档很可能存储在同一个数据块中，因此也会存储在同一个分片中。</p>\n<p>如果使用作者年龄字段作为片键，按照点赞数的值进行分片：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongos<span class=\"token operator\">></span> sh.shardCollection<span class=\"token punctuation\">(</span><span class=\"token string\">\"articledb.author\"</span>,<span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"age\"</span>:1<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token string\">\"collectionsharded\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"articledb.author\"</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token string\">\"<span class=\"token variable\">$clusterTime</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t<span class=\"token string\">\"clusterTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686196802</span>, <span class=\"token number\">6</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token string\">\"signature\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t<span class=\"token string\">\"hash\"</span> <span class=\"token builtin class-name\">:</span> BinData<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>,<span class=\"token string\">\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"</span><span class=\"token punctuation\">)</span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t<span class=\"token string\">\"keyId\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token string\">\"operationTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686196802</span>, <span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>mongos<span class=\"token operator\">></span></pre></td></tr></table></figure><p>查看状态：</p>\n<p age:1=\"\">shard key:</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongos<span class=\"token operator\">></span> sh.status<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>--- Sharding Status --- </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  sharding version: <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  \t<span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  \t<span class=\"token string\">\"minCompatibleVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">5</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  \t<span class=\"token string\">\"currentVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">6</span>,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  \t<span class=\"token string\">\"clusterId\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"64813c5c4c6469e9d2fe9269\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  shards:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs01\"</span>,  <span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs01/192.168.244.142:27018,192.168.244.142:27118\"</span>,  <span class=\"token string\">\"state\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,  <span class=\"token string\">\"topologyTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686193851</span>, <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs02\"</span>,  <span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs02/192.168.244.142:27318,192.168.244.142:27418\"</span>,  <span class=\"token string\">\"state\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,  <span class=\"token string\">\"topologyTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686194172</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  active mongoses:</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token string\">\"5.0.18\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  autosplit:</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        Currently enabled: <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  balancer:</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        Currently enabled: <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        Currently running: no</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        Failed balancer rounds <span class=\"token keyword\">in</span> last <span class=\"token number\">5</span> attempts: <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        Migration results <span class=\"token keyword\">for</span> the last <span class=\"token number\">24</span> hours: </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token number\">512</span> <span class=\"token builtin class-name\">:</span> Success</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  databases:</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"articledb\"</span>,  <span class=\"token string\">\"primary\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs01\"</span>,  <span class=\"token string\">\"partitioned\"</span> <span class=\"token builtin class-name\">:</span> true,  <span class=\"token string\">\"version\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"uuid\"</span> <span class=\"token builtin class-name\">:</span> UUID<span class=\"token punctuation\">(</span><span class=\"token string\">\"b94e53c7-d498-49b8-8965-1aafcab2df18\"</span><span class=\"token punctuation\">)</span>,  <span class=\"token string\">\"timestamp\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686193851</span>, <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>,  <span class=\"token string\">\"lastMod\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                articledb.author</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                        shard key: <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                        unique: <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                        balancing: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                        chunks:</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                                myshardrs01\t<span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                        <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"<span class=\"token variable\">$minKey</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span> --<span class=\"token operator\">>></span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"<span class=\"token variable\">$maxKey</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span> on <span class=\"token builtin class-name\">:</span> myshardrs01 Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1</span>, <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                articledb.comment</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                        shard key: <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"hashed\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                        unique: <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                        balancing: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                        chunks:</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                                myshardrs01\t<span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                                myshardrs02\t<span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                        <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"<span class=\"token variable\">$minKey</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span> --<span class=\"token operator\">>></span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token string\">\"-4611686018427387902\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span> on <span class=\"token builtin class-name\">:</span> myshardrs01 Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1</span>, <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                        <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token string\">\"-4611686018427387902\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span> --<span class=\"token operator\">>></span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span> on <span class=\"token builtin class-name\">:</span> myshardrs01 Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                        <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span> --<span class=\"token operator\">>></span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token string\">\"4611686018427387902\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span> on <span class=\"token builtin class-name\">:</span> myshardrs02 Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1</span>, <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                        <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token string\">\"4611686018427387902\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span> --<span class=\"token operator\">>></span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"<span class=\"token variable\">$maxKey</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span> on <span class=\"token builtin class-name\">:</span> myshardrs02 Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1</span>, <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"config\"</span>,  <span class=\"token string\">\"primary\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"config\"</span>,  <span class=\"token string\">\"partitioned\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                config.system.sessions</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                        shard key: <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                        unique: <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                        balancing: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                        chunks:</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                                myshardrs01\t<span class=\"token number\">512</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                                myshardrs02\t<span class=\"token number\">512</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                        too many chunks to print, use verbose <span class=\"token keyword\">if</span> you want to force print</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>mongos<span class=\"token operator\">></span></pre></td></tr></table></figure><p>注意的是：</p>\n<ol>\n<li>一个集合只能指定一个片键，否则报错</li>\n<li>一旦对一个集合分片，分片键和分片值就不可改变，如：不能给集合选择不同的分片键，不能更新分片键的值</li>\n<li>根据 age 索引进行分配数据</li>\n</ol>\n<p>基于范围的分片方式与基于哈希的分片方式性能对比：</p>\n<p>基于范围的分片方式提供了更高效的范围查询，给定一个片键的范围，分发路由可以很简单的确定哪个数据块存储了请求需要的数据，并将请求转发到相应的分片中</p>\n<p>不过，基于范围的分片会导致数据在不同分片上的不均衡，有时候，带来的消极作用会大于查询性能的积极作用，比如，如果片键所在的字段是线性增长的，一定时间内的所有请求都会落到某个固定的数据块中，最终导致分布在同一个分片中，在这种情况下，一小部分分片承载了集群大部分的数据，系统并不能很好的进行扩展</p>\n<p>与此相比，基于哈希的分片方式已范围查询性能的损失为代价，保证了集群中数据的均衡，哈希值的随机性使数据随机分布在每个数据块中，因此也随机分布在不同分片中，但是也正由于随机性，一个范围查询很难确定应该请求哪些分片，通常为了返回需要的结果，需要请求所有分片</p>\n<p>如无特殊情况，一般推荐使用 Hash Sharding。</p>\n<p>而使用_id 作为片键是一个不错的选择，因为它是必有得，你可以使用数据文档 <code>_id</code>  的哈希作为片键。</p>\n<p>这个方案能够使读和写都能够平均分布，并且它能够保证每个文档都有不同的片键所以数据块能够很精细</p>\n<p>似乎还是不够完美，因为这样的话对多个文档的查询必将命中所有的分片，虽说如此，这也是一种比较好的方案了。</p>\n<p>理想化的 shard key 可以让 document 均匀的在集群分布：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031700375.png\" alt=\"image-20230608121323081\"></p>\n<p>显示集群的详细信息：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongos<span class=\"token operator\">></span> db.printShardingStatus<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongos<span class=\"token operator\">></span> db.printShardingStatus<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>--- Sharding Status --- </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  sharding version: <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  \t<span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  \t<span class=\"token string\">\"minCompatibleVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">5</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  \t<span class=\"token string\">\"currentVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">6</span>,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  \t<span class=\"token string\">\"clusterId\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"64813c5c4c6469e9d2fe9269\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  shards:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs01\"</span>,  <span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs01/192.168.244.142:27018,192.168.244.142:27118\"</span>,  <span class=\"token string\">\"state\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,  <span class=\"token string\">\"topologyTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686193851</span>, <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs02\"</span>,  <span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs02/192.168.244.142:27318,192.168.244.142:27418\"</span>,  <span class=\"token string\">\"state\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,  <span class=\"token string\">\"topologyTime\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686194172</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  active mongoses:</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token string\">\"5.0.18\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  autosplit:</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        Currently enabled: <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  balancer:</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        Currently enabled: <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        Currently running: no</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        Failed balancer rounds <span class=\"token keyword\">in</span> last <span class=\"token number\">5</span> attempts: <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        Migration results <span class=\"token keyword\">for</span> the last <span class=\"token number\">24</span> hours: </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token number\">512</span> <span class=\"token builtin class-name\">:</span> Success</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  databases:</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"articledb\"</span>,  <span class=\"token string\">\"primary\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myshardrs01\"</span>,  <span class=\"token string\">\"partitioned\"</span> <span class=\"token builtin class-name\">:</span> true,  <span class=\"token string\">\"version\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"uuid\"</span> <span class=\"token builtin class-name\">:</span> UUID<span class=\"token punctuation\">(</span><span class=\"token string\">\"b94e53c7-d498-49b8-8965-1aafcab2df18\"</span><span class=\"token punctuation\">)</span>,  <span class=\"token string\">\"timestamp\"</span> <span class=\"token builtin class-name\">:</span> Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1686193851</span>, <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>,  <span class=\"token string\">\"lastMod\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                articledb.author</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                        shard key: <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                        unique: <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                        balancing: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                        chunks:</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                                myshardrs01\t<span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                        <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"<span class=\"token variable\">$minKey</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span> --<span class=\"token operator\">>></span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"<span class=\"token variable\">$maxKey</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span> on <span class=\"token builtin class-name\">:</span> myshardrs01 Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1</span>, <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                articledb.comment</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                        shard key: <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"hashed\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                        unique: <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                        balancing: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                        chunks:</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                                myshardrs01\t<span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                                myshardrs02\t<span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                        <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"<span class=\"token variable\">$minKey</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span> --<span class=\"token operator\">>></span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token string\">\"-4611686018427387902\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span> on <span class=\"token builtin class-name\">:</span> myshardrs01 Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1</span>, <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                        <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token string\">\"-4611686018427387902\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span> --<span class=\"token operator\">>></span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span> on <span class=\"token builtin class-name\">:</span> myshardrs01 Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                        <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span> --<span class=\"token operator\">>></span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token string\">\"4611686018427387902\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span> on <span class=\"token builtin class-name\">:</span> myshardrs02 Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1</span>, <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                        <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> NumberLong<span class=\"token punctuation\">(</span><span class=\"token string\">\"4611686018427387902\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span> --<span class=\"token operator\">>></span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"<span class=\"token variable\">$maxKey</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span> on <span class=\"token builtin class-name\">:</span> myshardrs02 Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1</span>, <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span>  <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"config\"</span>,  <span class=\"token string\">\"primary\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"config\"</span>,  <span class=\"token string\">\"partitioned\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                config.system.sessions</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                        shard key: <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                        unique: <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                        balancing: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                        chunks:</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                                myshardrs01\t<span class=\"token number\">512</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                                myshardrs02\t<span class=\"token number\">512</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                        too many chunks to print, use verbose <span class=\"token keyword\">if</span> you want to force print</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>mongos<span class=\"token operator\">></span></pre></td></tr></table></figure><p>查看均衡器是否工作 (需要重新均衡时系统才会自动启动，不用管它)：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongos<span class=\"token operator\">></span> sh.isBalancerRunning<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>mongos<span class=\"token operator\">></span></pre></td></tr></table></figure><p>查看当前 Balancer 状态：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongos<span class=\"token operator\">></span> sh.getBalancerState<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>mongos<span class=\"token operator\">></span></pre></td></tr></table></figure><h3 id=\"分片后插入数据测试\"><a class=\"markdownIt-Anchor\" href=\"#分片后插入数据测试\">#</a> 分片后插入数据测试</h3>\n<p>测试一 (哈希规则)：登录 mongos 后，向 comment 循环插入 1000 条数据做测试：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongos<span class=\"token operator\">></span> use articledb</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>switched to db articledb</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>mongos<span class=\"token operator\">></span> db</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>articledb</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>mongos<span class=\"token operator\">></span> for<span class=\"token punctuation\">(</span>let <span class=\"token assign-left variable\">i</span><span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;=</span><span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>i++<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>db.comment.insert<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"_id\"</span>:i+<span class=\"token string\">\"\"</span>,<span class=\"token string\">\"nickname\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"BoBo\"</span>+i<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>WriteResult<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nInserted\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>mongos<span class=\"token operator\">></span> db.comment.count<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">1000</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>mongos<span class=\"token operator\">></span></pre></td></tr></table></figure><p>提示：js 的语法，因为 mongo 的 shell 是一个 javaScript 的 shell</p>\n<p>注意：从路由上插入的数据，必须包含片键，否则无法插入</p>\n<p>分别登陆两个片的主节点，统计文档数量</p>\n<p>第一个分片副本集：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myshardrs01:PRIMARY<span class=\"token operator\">></span> db</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>articledb</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>myshardrs01:PRIMARY<span class=\"token operator\">></span> db.comment.count<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">507</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>myshardrs01:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>第二个分片副本集：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myshardrs02:PRIMARY<span class=\"token operator\">></span> use articledb</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>switched to db articledb</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>myshardrs02:PRIMARY<span class=\"token operator\">></span> db</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>articledb</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>myshardrs02:PRIMARY<span class=\"token operator\">></span> db.comment.count<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">493</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>myshardrs02:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>可以看到，1000 条数据近似均匀的分不到了 2 个 shard 上，是根据片键的哈希值分配的。</p>\n<p>这种分配方式非常易于水平扩展：一旦数据存储需要更大空间，可以直接再增加分片即可，同时提升了性能使用 db.comment.stats () 查看单个集合的完整情况，mongos 执行该命令可以查看该集合的数据分片的情况。</p>\n<p>使用 sh.status () 查看本库内所有集合的分片信息。</p>\n<hr>\n<p>测试二 (值范围规则)：登录 mongos 后，向 comment 循环插入 1000 条数据做测试：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongos<span class=\"token operator\">></span> db</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>articledb</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>mongos<span class=\"token operator\">></span> for<span class=\"token punctuation\">(</span>let <span class=\"token assign-left variable\">i</span><span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;=</span><span class=\"token number\">2000</span><span class=\"token punctuation\">;</span>i++<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>db.author.save<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"BoBoBo\"</span>+i,<span class=\"token string\">\"age\"</span>:NumberInt<span class=\"token punctuation\">(</span>i%120<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>WriteResult<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nInserted\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>mongos<span class=\"token operator\">></span> db.author.count<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">2000</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>mongos<span class=\"token operator\">></span></pre></td></tr></table></figure><p>插入成功后，仍然要分别查看两个分片副本集的数据情况。</p>\n<p>分片效果：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>articledb.author</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>                        shard key: <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>                        unique: <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                        balancing: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                        chunks:</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                                myshardrs01\t<span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                        <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"<span class=\"token variable\">$minKey</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span> --<span class=\"token operator\">>></span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"age\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"<span class=\"token variable\">$maxKey</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span> on <span class=\"token builtin class-name\">:</span> myshardrs01 Timestamp<span class=\"token punctuation\">(</span><span class=\"token number\">1</span>, <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>提示：</p>\n<p>如果查看状态发现没有分片，则可能是由于以下原因造成了：</p>\n<ol>\n<li>\n<p>系统繁忙，正在分片中。</p>\n</li>\n<li>\n<p>数据块 (chunk) 没有填满，默认的数据块尺寸 (chunksize) 是 64M，填满后才会考虑向其它片的数据块填充数据，因此，为了测试，可以将其改小，这里改为 1M，操作如下：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongos<span class=\"token operator\">></span> use config</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>switched to db config</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>mongos<span class=\"token operator\">></span> db</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>config</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>mongos<span class=\"token operator\">></span> db.settings.save<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>_id:<span class=\"token string\">\"chunksize\"</span>,value:1<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>WriteResult<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nMatched\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>, <span class=\"token string\">\"nUpserted\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>, <span class=\"token string\">\"nModified\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>, <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"chunksize\"</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>mongos<span class=\"token operator\">></span></pre></td></tr></table></figure><p>测试完改回来：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongos<span class=\"token operator\">></span> db.settings.save<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>_id:<span class=\"token string\">\"chunksize\"</span>,value:64<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>注意：要先改小，再设置分片，为了测试，可以先删除集合，重新建立集合的分片策略，再插入数据测试即可。</p>\n</li>\n</ol>\n<h3 id=\"再增加一个路由节点\"><a class=\"markdownIt-Anchor\" href=\"#再增加一个路由节点\">#</a> 再增加一个路由节点</h3>\n<p>目录:</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ <span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mongodb/sharded_cluster/myshardrs_27117/log</pre></td></tr></table></figure><p>新建或修改配置文件：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ <span class=\"token function\">vim</span> /mongodb/sharded_cluster/myshardrs_27117/mongos.conf</pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemLog:</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token comment\">#MongoDB 发送所有日志输出的目标指定为文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\">#The path of the log file to which mongod or mongos should send all diagnostic logging information</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> destination: <span class=\"token function\">file</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token comment\">#mongod 或 mongos 应向其发送所有诊断日志记录信息的日志文件的路径</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> path: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs_27117/log/mongod.log\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token comment\">#当 mongos 或 mongod 实例重新启动时，mongos 或 mongod 会将新条目附加到现有日志文件的末尾。</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> logAppend: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>processManagement:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token comment\">#启用在后台运行 mongos 或 mongod 进程的守护进程模式。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> fork: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> <span class=\"token comment\">#指定用于保存 mongos 或 mongod 进程的进行 ID 的文件位置，其中 mongos 或 mongod 将写入其 PID</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> pidFilePath: <span class=\"token string\">\"/mongodb/sharded_cluster/myshardrs_27117/log/mongod.pid\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>net:</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token comment\">#服务实例绑定 IP，默认是 localhost</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre> bindIp: localhost,192.168.244.142</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token comment\">#bindIp</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token comment\">#绑定的端口，默认是 27017</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre> port: <span class=\"token number\">27117</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>sharding:</pre></td></tr><tr><td data-num=\"21\"></td><td><pre> <span class=\"token comment\">#指定配置节点副本集</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre> <span class=\"token comment\">#        副本集名称 / 主机地址与端口号</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre> configDB: myconfigrs/192.168.244.142:27019,192.168.244.142:27119,192.168.244.142:27219</pre></td></tr></table></figure><p>启动 mongos2：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ /usr/local/mongodb/bin/mongos <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs_27117/mongos.conf </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>forked process: <span class=\"token number\">27750</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>➜  ~</pre></td></tr></table></figure><p>使用 Mongo 客户端登录 27117，发现，第二个路由无需配置，因为分片配置都保存到了配置服务器中了</p>\n<h2 id=\"compass连接分片集群\"><a class=\"markdownIt-Anchor\" href=\"#compass连接分片集群\">#</a> Compass 连接分片集群</h2>\n<p>直接连接路由</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031700753.png\" alt=\"image-20230608143006151\"></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031700972.png\" alt=\"image-20230608143031512\"></p>\n<h2 id=\"springdatamongodb连接分片集群\"><a class=\"markdownIt-Anchor\" href=\"#springdatamongodb连接分片集群\">#</a> SpringDataMongoDB 连接分片集群</h2>\n<p>Java 客户端常用的是 SpringDataMongoDB，其连接的是 mongos 路由，配置和单机 mongod 的配置是一样的。</p>\n<p>多个路由的时候的 SpringDataMongoDB 的客户端配置参考如下：</p>\n<p>直接连接路由节点即可</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token comment\">#数据源配置</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">mongodb</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token comment\">#主机地址</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token comment\">#host: 192.168.244.142</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token comment\">#数据库</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token comment\">#database: articledb</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token comment\">#端口号</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token comment\">#port: 27017</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token comment\">#也可以使用 uri 连接</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token comment\">#uri: mongodb://192.168.244.142:27017/articledb</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token comment\">#副本集的连接字符串</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token comment\">#uri:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">#mongodb://192.168.244.142:27017,192.168.244.142:27018,192.168.244.142:27019/articledb?</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">#connect=replicaSet&amp;secondaryOk=true&amp;replicaSet=myrs</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token comment\">#连接路由字符串</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> mongodb<span class=\"token punctuation\">:</span>//192.168.244.142<span class=\"token punctuation\">:</span><span class=\"token number\">27017</span><span class=\"token punctuation\">,</span>192.168.244.142<span class=\"token punctuation\">:</span>27117/articledb</pre></td></tr></table></figure><p>通过日志发现，写入数据的时候，会选择一个路由写入：</p>\n<h2 id=\"安全认证\"><a class=\"markdownIt-Anchor\" href=\"#安全认证\">#</a> 安全认证</h2>\n<h3 id=\"mongodb的用户和角色权限简介\"><a class=\"markdownIt-Anchor\" href=\"#mongodb的用户和角色权限简介\">#</a> MongoDB 的用户和角色权限简介</h3>\n<p>默认情况下，MongoDB 实例启动运行时是没有启用用户访问权限控制的，也就是说，在实例本机服务器上都可以随意连接到实例进行各种操作，MongoDB 不会对连接客户端进行用户验证，这是非常危险的。</p>\n<p>mongoDB 官网上说，为了能保障 mongodb 的安全可以做以下几个步骤：</p>\n<ol>\n<li>使用新的端口，默认的 27017 端口如果一旦知道了 ip 就能连接上，不太安全</li>\n<li>设置 mongodb 的网络环境，最好将 mongodb 部署到公司服务器内网，这样外网是访问不到的，公司内部访问使用 vpn 等</li>\n<li>开启安全认证，认证要同时设置服务器之间的内部认证方式，同时要设置客户端连接到集群的账号密码认证方式</li>\n</ol>\n<p>为了强制开启用户访问控制 (用户验证)，则需要在 MongoDB 实例启动时使用选项–auth 或在指定启动配置文件中添加选项 auth=true</p>\n<p>在开始之前需要了解一下概念</p>\n<ol>\n<li>启用访问控制：</li>\n</ol>\n<p>MongoDB 使用的是基于角色的访问控制 (Role-Based Access Control,RBAC) 来管理用户対实例的访问，通过对用户授予一个或多个角色来控制用户访问数据库资源的权限和数据库操作的权限，在对用户分配角色之前，用户无法访问实例。</p>\n<p>在实例启动时添加选项–auth 或指定启动配置文件中添加选项 auth=true</p>\n<ol start=\"2\">\n<li>角色：</li>\n</ol>\n<p>在 MongoDB 中通过角色对用户授予相应数据库资源的操作权限，每个角色当中的权限可以显式指定，也可以通过继承其它角色的权限，或者两都存在的权限</p>\n<ol start=\"3\">\n<li>权限：</li>\n</ol>\n<p>权限由指定的数据库资源 (resource) 以及允许在指定资源上进行的操作 (action) 组成。</p>\n<ol>\n<li>资源 (resource) 包括：数据库，集合，部分集合和集群；</li>\n<li>操作 (action) 包括：对资源进行的增，删，改，查 (CRUD) 操作。</li>\n</ol>\n<p>在角色定义时可以包含一个或多个已存在的角色，新创建的角色会继承包含的角色所有的权限，在同一个数据库中，新创建角色可以继承其它角色的权限，在 admin 数据库中创建的角色可以继承在其它任意数据库中角色的权限。</p>\n<p>关于角色权限的查看，可以通过如下命令查询：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#查询所有角色权限 (仅用户自定义角色)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">></span> db.runCommand<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>rolesInfo:1<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#查询所有用户角色权限 (包含内置角色)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span> db.runCommand<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>rolesInfo:1,showBuiltinRoles:true<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#查询当前数据库中的某角色的权限</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">></span> db.runCommand<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>rolesInfo:<span class=\"token string\">\"&lt;rolename>\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#查询其它数据库中指定的角色权限</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">></span> db.runCommand<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>rolesInfo:<span class=\"token punctuation\">&#123;</span>role:<span class=\"token string\">\"&lt;rolename>\"</span>,db:<span class=\"token string\">\"&lt;database>\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#查询多个角色权限</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token operator\">></span> db.runCommand<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>rolesInfo:<span class=\"token punctuation\">[</span><span class=\"token string\">\"rolename\"</span>,<span class=\"token punctuation\">&#123;</span>role:<span class=\"token string\">\"&lt;rolename>\"</span>,db:<span class=\"token string\">\"database\"</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>常用的内置角色：</p>\n<ul>\n<li>数据库用户角色：read，readWrite；</li>\n<li>所有数据库用户角色：readAnyDatabase，readWriteAnyDatabase，userAdminAnyDatabase，dbAdminAnyDatabase</li>\n<li>数据库管理角色：dbAdmin，dbOwner，userAdmin；</li>\n<li>集群管理角色：clusterAdmin，clusterManager，clusterMonitor，hostManager；</li>\n<li>备份恢复角色：backup，restore；</li>\n<li>超级用户角色：root</li>\n<li>内部角色：system</li>\n</ul>\n<p>角色说明：</p>\n<table>\n<thead>\n<tr>\n<th>角色</th>\n<th>权限描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>read</td>\n<td>可以读取指定数据库中任何数据</td>\n</tr>\n<tr>\n<td>readWrite</td>\n<td>可以读写指定数据库中任何数据，包括创建，重命名，删除集合</td>\n</tr>\n<tr>\n<td>readAnyDatabase</td>\n<td>可以读取所有数据库中任何数据 (除了数据库 config 和 loacl 之外)</td>\n</tr>\n<tr>\n<td>readWriteAnyDatabase</td>\n<td>可以读写所有数据库中任何数据 (除了数据库 config 和 local 之外)</td>\n</tr>\n<tr>\n<td>userAdminAnyDatabase</td>\n<td>可以在指定数据库创建和修改用户 (除了数据库 config 和 local 之外)</td>\n</tr>\n<tr>\n<td>dbAdminAnyDatabase</td>\n<td>可以读取任何数据库以及对数据库进行清理，修改，压缩，获取统计信息，执行检查等操作 (除了数据库 config 和 local 之外)</td>\n</tr>\n<tr>\n<td>dbAdmin</td>\n<td>可以读取指定数据库以及对数据库进行清理，修怪，压缩，获取统计信息，执行检查等操作。</td>\n</tr>\n<tr>\n<td>userAdmin</td>\n<td>可以在指定数据库创建和修改用户</td>\n</tr>\n<tr>\n<td>clusterAdmin</td>\n<td>可以对整个集群或数据库系统进行管理操作</td>\n</tr>\n<tr>\n<td>backup</td>\n<td>备份 MongoDB 数据最小的权限</td>\n</tr>\n<tr>\n<td>restore</td>\n<td>从备份文件中还原恢复 MongoDB 数据 (除了 system.profile 集合) 的权限。</td>\n</tr>\n<tr>\n<td>root</td>\n<td>超级账号，超级权限</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"单实例环境\"><a class=\"markdownIt-Anchor\" href=\"#单实例环境\">#</a> 单实例环境</h2>\n<p>目标：对单实例的 MongoDB 服务开启安全认证，这里的单实例指定是未开启副本集或分片的 MongoDB 实例。</p>\n<h3 id=\"关闭已开启的服务可选\"><a class=\"markdownIt-Anchor\" href=\"#关闭已开启的服务可选\">#</a> 关闭已开启的服务 (可选)</h3>\n<p>增加 mongod 的单实例的安全认证功能，可以在服务搭建的时候直接添加，也可以在之前搭建好的服务上添加。</p>\n<p>本文使用之前搭建好的服务，因此，先停止之前的服务</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ <span class=\"token function\">ps</span> -ef<span class=\"token operator\">|</span><span class=\"token function\">grep</span> mongod<span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token parameter variable\">-v</span> <span class=\"token function\">grep</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>dkx0       <span class=\"token number\">2291</span>      <span class=\"token number\">1</span>  <span class=\"token number\">2</span> Jun07 ?        00:09:22 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>dkx0       <span class=\"token number\">2368</span>      <span class=\"token number\">1</span>  <span class=\"token number\">2</span> Jun07 ?        00:09:19 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>dkx0       <span class=\"token number\">2443</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> Jun07 ?        00:05:27 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>dkx0       <span class=\"token number\">5200</span>      <span class=\"token number\">1</span>  <span class=\"token number\">2</span> Jun07 ?        00:07:06 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27318/mongod.conf</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>dkx0       <span class=\"token number\">5268</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> Jun07 ?        00:06:37 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27418/mongod.conf</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>dkx0       <span class=\"token number\">5337</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> Jun07 ?        00:04:25 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27518/mongod.conf</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>dkx0       <span class=\"token number\">7659</span>      <span class=\"token number\">1</span>  <span class=\"token number\">3</span> Jun07 ?        00:09:26 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27019/mongod.conf</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>dkx0       <span class=\"token number\">7736</span>      <span class=\"token number\">1</span>  <span class=\"token number\">2</span> Jun07 ?        00:08:15 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27119/mongod.conf</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>dkx0       <span class=\"token number\">7808</span>      <span class=\"token number\">1</span>  <span class=\"token number\">2</span> Jun07 ?        00:08:11 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs01_27219/mongod.conf</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>dkx0      <span class=\"token number\">10092</span>      <span class=\"token number\">1</span>  <span class=\"token number\">0</span> Jun07 ?        00:02:23 /usr/local/mongodb/bin/mongos <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs_27017/mongos.conf</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>dkx0      <span class=\"token number\">27750</span>      <span class=\"token number\">1</span>  <span class=\"token number\">0</span> 02:22 ?        00:00:31 /usr/local/mongodb/bin/mongos <span class=\"token parameter variable\">-f</span> /mongodb/sharded_cluster/myshardrs_27117/mongos.conf</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>➜  ~</pre></td></tr></table></figure><p>停止服务的方式有两种：快速关闭和标准关闭，下面依次说明：</p>\n<ol>\n<li>快速关闭方式 (快速，简单，数据可能会出错)</li>\n</ol>\n<p>目标：通过系统的 kill 命令直接杀死进程：</p>\n<p>杀完要检查一下，避免有的没有杀掉。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#通过进程编号关闭节点</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>➜  ~ <span class=\"token function\">kill</span> <span class=\"token parameter variable\">-2</span> <span class=\"token number\">2291</span> <span class=\"token number\">2368</span> <span class=\"token number\">2443</span> <span class=\"token number\">5200</span> <span class=\"token number\">5268</span> <span class=\"token number\">5337</span> <span class=\"token number\">7659</span> <span class=\"token number\">7736</span> <span class=\"token number\">7808</span> <span class=\"token number\">10092</span> <span class=\"token number\">27750</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>➜  ~ <span class=\"token function\">ps</span> -ef<span class=\"token operator\">|</span><span class=\"token function\">grep</span> mongod<span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token parameter variable\">-v</span> <span class=\"token function\">grep</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>➜  ~</pre></td></tr></table></figure><p>[补充]</p>\n<p>如果一旦是因为数据损坏，则需要进行如下操作：</p>\n<ol>\n<li>\n<p>删除 lock 文件：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">rm</span> <span class=\"token parameter variable\">-f</span> /mongodb/single/data/db/*.lock</pre></td></tr></table></figure></li>\n<li>\n<p>修复数据：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>/usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">--repair</span> <span class=\"token parameter variable\">--dbpath</span><span class=\"token operator\">=</span>/mongodb/single/data/db</pre></td></tr></table></figure><p>2. 标准的关闭方法 (数据不容易出错，但是麻烦)</p>\n<p>目标：通过 mongo 客户端中的 shutdownServer 命令来关闭服务</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.shutdownServer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"添加用户和权限\"><a class=\"markdownIt-Anchor\" href=\"#添加用户和权限\">#</a> 添加用户和权限</h3>\n<p>​    1. 先按照普通无授权认证的配置，来配置服务端的配置文件 /mongodb/single/mongod.conf：(参考，复用之前的)</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemLog:</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token comment\">#MongoDB 发送所有日志输出的目标指定为文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\">#The path of the log file to which mongod or mongos should send all diagnostic logging information</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> destination: <span class=\"token function\">file</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token comment\">#mongod 或 mongos 应向其发送所有诊断日志记录信息的日志文件的路径</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> path: <span class=\"token string\">\"/mongodb/single/log/mongod.log\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token comment\">#当 mongos 或 mongod 实例重新启动时，mongos 或 mongod 会将新条目附加到现有日志文件的末尾。</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> logAppend: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>storage:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token comment\">#mongod 实例存储其数据的目录。storage.dbPath 设置仅适用于 mongod。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> <span class=\"token comment\">#The directory where the mongod instance stores its data.Defaul value is \"/data/db\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> dbPath: <span class=\"token string\">\"/mongodb/single/data/db\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> journal:</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token comment\">#启用或禁用持久性日志以确保数据文件保持有效和可恢复</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  enabled: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>processManagement:</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token comment\">#启用在后台运行 mongos 或 mongod 进程的守护进程模式。</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> fork: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>net:</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token comment\">#服务实例绑定 IP，默认是 localhost</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre> bindIp: localhost,192.168.244.142</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token comment\">#bindIp</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token comment\">#绑定的端口，默认是 27017</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre> port: <span class=\"token number\">27017</span></pre></td></tr></table></figure><p>2. 按之前为开启认证的方式 (不添加–auth 参数) 来启动 MongoDB 服务：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/single/log/mongod.conf </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>forked process: <span class=\"token number\">34342</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>➜  ~</pre></td></tr></table></figure><p>提示：</p>\n<p>在操作用户时，启动 mongod 服务时尽量不要开启授权</p>\n<p>3. 使用 Mongo 客户端登录：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ /usr/local/mongodb/bin/mongo <span class=\"token parameter variable\">--host</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.244.142 <span class=\"token parameter variable\">--port</span><span class=\"token operator\">=</span><span class=\"token number\">27017</span></pre></td></tr></table></figure><p>4. 创建两个管理员用户，一个是系统的超级管理员 myroot，一个是 admin 库的管理用户 myadmin：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#切换到 admin 库</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">></span> use admin</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#创建系统超级用户 myroot，设置密码 123456，设置角色 root</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span> db.createUser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>user:<span class=\"token string\">\"myroot\"</span>,pwd:<span class=\"token string\">\"123456\"</span>,roles:<span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"role\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"root\"</span>,<span class=\"token string\">\"db\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#或 上面指定了集合下面默认是当前所在集合都是 admin</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">></span> db.createUser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>user:<span class=\"token string\">\"myroot\"</span>,pwd:<span class=\"token string\">\"123456\"</span>,roles:<span class=\"token punctuation\">[</span><span class=\"token string\">\"root\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Successfully added user: <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"user\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myroot\"</span>, <span class=\"token string\">\"roles\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"root\"</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#创建专门用来管理 admin 库的账号 myadmin，只用来作为用户权限的管理</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token operator\">></span> db.createUser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>user:<span class=\"token string\">\"myadmin\"</span>,pwd:<span class=\"token string\">\"123456\"</span>,roles:<span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span>role:<span class=\"token string\">\"userAdminAnyDatabase\"</span>,db:<span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Successfully added user: <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token string\">\"user\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myadmin\"</span>,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token string\">\"roles\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t<span class=\"token string\">\"role\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"userAdminAnyDatabase\"</span>,</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t<span class=\"token string\">\"db\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"admin\"</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token operator\">></span> </pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#查看已经创建了的用户的情况：</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token operator\">></span> db.system.users.<span class=\"token function-name function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"admin.myroot\"</span>, <span class=\"token string\">\"userId\"</span> <span class=\"token builtin class-name\">:</span> UUID<span class=\"token punctuation\">(</span><span class=\"token string\">\"9ecafd01-cef1-43a4-85ad-4ec21e905f81\"</span><span class=\"token punctuation\">)</span>, <span class=\"token string\">\"user\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myroot\"</span>, <span class=\"token string\">\"db\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"admin\"</span>, <span class=\"token string\">\"credentials\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"SCRAM-SHA-1\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"iterationCount\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">10000</span>, <span class=\"token string\">\"salt\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"LefHopC8WY3knLfOVz56iw==\"</span>, <span class=\"token string\">\"storedKey\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"fFDpj6y1AZCw60aOTM8fBXzUwBc=\"</span>, <span class=\"token string\">\"serverKey\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"YvTH+hyBHN1XThjYnrotc57/hgs=\"</span> <span class=\"token punctuation\">&#125;</span>, <span class=\"token string\">\"SCRAM-SHA-256\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"iterationCount\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">15000</span>, <span class=\"token string\">\"salt\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"35I31t2xZ5NIK0wrw0LZajRGtnY8B8YLwjHfgg==\"</span>, <span class=\"token string\">\"storedKey\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"iy3/8WvkxrNDcKPJmFQ7rTAXxNvzDtjK7uMxzUkhgJ4=\"</span>, <span class=\"token string\">\"serverKey\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"V8Nhn6pBt50M5UsUNBNDGfaOU23f+CLYcYLnxBRTRy0=\"</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span>, <span class=\"token string\">\"roles\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"role\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"root\"</span>, <span class=\"token string\">\"db\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"admin\"</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"admin.myadmin\"</span>, <span class=\"token string\">\"userId\"</span> <span class=\"token builtin class-name\">:</span> UUID<span class=\"token punctuation\">(</span><span class=\"token string\">\"c8145c3a-b1a1-4be2-a226-39e067cbe9b0\"</span><span class=\"token punctuation\">)</span>, <span class=\"token string\">\"user\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myadmin\"</span>, <span class=\"token string\">\"db\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"admin\"</span>, <span class=\"token string\">\"credentials\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"SCRAM-SHA-1\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"iterationCount\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">10000</span>, <span class=\"token string\">\"salt\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"Gc9gasfekYv2F9njhAd/Sg==\"</span>, <span class=\"token string\">\"storedKey\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"vy3mzY/oer2ONiUO8nV0DRrLwUg=\"</span>, <span class=\"token string\">\"serverKey\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"oVgCRHfLt/HW4PslM3QCghvVHZ4=\"</span> <span class=\"token punctuation\">&#125;</span>, <span class=\"token string\">\"SCRAM-SHA-256\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"iterationCount\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">15000</span>, <span class=\"token string\">\"salt\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"vXE6XCPtMv2ErDmXM/21KlbiTlEQEQ89rmcIgQ==\"</span>, <span class=\"token string\">\"storedKey\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"MexKD1eAYxvws8ANYtvNPdDZajNTAjfJphlIDtvPn80=\"</span>, <span class=\"token string\">\"serverKey\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"Zzp84uYSusKlbNoMmTi/rPvskHl531RQDjQIjcdDGkY=\"</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span>, <span class=\"token string\">\"roles\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"role\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"userAdminAnyDatabase\"</span>, <span class=\"token string\">\"db\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"admin\"</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token operator\">></span> </pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">#删除用户</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token operator\">></span> db.dropUser<span class=\"token punctuation\">(</span><span class=\"token string\">\"myadmin\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token operator\">></span> db.system.users.<span class=\"token function-name function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"admin.myroot\"</span>, <span class=\"token string\">\"userId\"</span> <span class=\"token builtin class-name\">:</span> UUID<span class=\"token punctuation\">(</span><span class=\"token string\">\"9ecafd01-cef1-43a4-85ad-4ec21e905f81\"</span><span class=\"token punctuation\">)</span>, <span class=\"token string\">\"user\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"myroot\"</span>, <span class=\"token string\">\"db\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"admin\"</span>, <span class=\"token string\">\"credentials\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"SCRAM-SHA-1\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"iterationCount\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">10000</span>, <span class=\"token string\">\"salt\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"LefHopC8WY3knLfOVz56iw==\"</span>, <span class=\"token string\">\"storedKey\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"fFDpj6y1AZCw60aOTM8fBXzUwBc=\"</span>, <span class=\"token string\">\"serverKey\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"YvTH+hyBHN1XThjYnrotc57/hgs=\"</span> <span class=\"token punctuation\">&#125;</span>, <span class=\"token string\">\"SCRAM-SHA-256\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"iterationCount\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">15000</span>, <span class=\"token string\">\"salt\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"35I31t2xZ5NIK0wrw0LZajRGtnY8B8YLwjHfgg==\"</span>, <span class=\"token string\">\"storedKey\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"iy3/8WvkxrNDcKPJmFQ7rTAXxNvzDtjK7uMxzUkhgJ4=\"</span>, <span class=\"token string\">\"serverKey\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"V8Nhn6pBt50M5UsUNBNDGfaOU23f+CLYcYLnxBRTRy0=\"</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span>, <span class=\"token string\">\"roles\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"role\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"root\"</span>, <span class=\"token string\">\"db\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"admin\"</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token operator\">></span> </pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">#修改密码</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token operator\">></span> db.changeUserPassword<span class=\"token punctuation\">(</span><span class=\"token string\">\"myroot\"</span>,<span class=\"token string\">\"123456\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>提示：</p>\n<ol>\n<li>本案例创建了两个用户，分别对应超管和专门用来管理用户的角色，事实上，你只需要一个用户即可。如果你对安全要求很高，防止超管泄露，则不要创建超管用户。</li>\n<li>和其它数据库 (MySQL) 一样，权限的管理都差不多一样，也是将用户和权限信息保存到数据库对应的表中。MongoDB 存储所有的用户信息在 admin 数据库的集合 system.users 中，保存用户名，密码和数据库信息。</li>\n<li role:userAdminAnyDatabase,db:=\"\">如果不指定数据库，则创建的指定的权限的用户在所有的数据库上有效，如</li>\n</ol>\n<p>认证测试：</p>\n<p>测试添加的用户是否正确：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> use admin</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>switched to db admin</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#输入错误密码</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span> db.auth<span class=\"token punctuation\">(</span><span class=\"token string\">\"myroot\"</span>,<span class=\"token string\">\"1234\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Error: Authentication failed.</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#输入正确密码</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">></span> db.auth<span class=\"token punctuation\">(</span><span class=\"token string\">\"myroot\"</span>,<span class=\"token string\">\"123456\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>创建普通用户</p>\n<p>创建普通用户可以在没有开启认证的时候添加，也可以在开启认证之后添加，但开启认证之后，必须使用有操作 admin 库的用户登录认证后才能操作，底层都是将用户信息保存在了 admin 数据库的集合 system.users 中。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> use articledb</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>switched to db articledb</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span> db</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>articledb</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#创建用户，拥有 articledb 数据库的读写权限 readWrite，密码是 123456</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">></span> db.createUser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>user:<span class=\"token string\">\"bobo\"</span>,pwd:<span class=\"token string\">\"123456\"</span>,roles:<span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span>role:<span class=\"token string\">\"readWrite\"</span>,<span class=\"token string\">\"db\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"articledb\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Successfully added user: <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token string\">\"user\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"bobo\"</span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token string\">\"roles\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t<span class=\"token string\">\"role\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"readWrite\"</span>,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t<span class=\"token string\">\"db\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"articledb\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">#测试是否可用</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token operator\">></span> db.auth<span class=\"token punctuation\">(</span><span class=\"token string\">\"bobo\"</span>,<span class=\"token string\">\"123456\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>提示：</p>\n<p>如果开启了认证后，登录的客户端的用户必须使用 admin 库的角色，如拥有 root 角色的 myadmin 用户，再通过 myadmin 用户去创建其它角色的用户</p>\n<h3 id=\"服务端开启认证和客户端连接登录\"><a class=\"markdownIt-Anchor\" href=\"#服务端开启认证和客户端连接登录\">#</a> 服务端开启认证和客户端连接登录</h3>\n<ol>\n<li>\n<p>关闭已经启动的服务</p>\n</li>\n<li>\n<p>使用 linux 命令杀死进程：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ <span class=\"token function\">ps</span> -ef<span class=\"token operator\">|</span><span class=\"token function\">grep</span> mongod<span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token parameter variable\">-v</span> <span class=\"token function\">grep</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>dkx0      <span class=\"token number\">34342</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> 03:53 ?        00:00:29 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/single/log/mongod.conf</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>dkx0      <span class=\"token number\">34546</span>  <span class=\"token number\">34416</span>  <span class=\"token number\">0</span> 03:55 pts/1    00:00:00 /usr/local/mongodb/bin/mongo <span class=\"token parameter variable\">--host</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.244.142 <span class=\"token parameter variable\">--port</span><span class=\"token operator\">=</span><span class=\"token number\">27017</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>➜  ~ <span class=\"token function\">kill</span> <span class=\"token parameter variable\">-2</span> <span class=\"token number\">34342</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>➜  ~</pre></td></tr></table></figure></li>\n<li>\n<p>在 mongo 客户端中使用 shutdownServer 命令来关闭</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.shutdownServer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">shutdown</span> <span class=\"token builtin class-name\">command</span> only works with the admin database<span class=\"token punctuation\">;</span> try <span class=\"token string\">'use admin'</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span> use admin</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>switched to db admin</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">></span> db.shutdownServer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>server should be down<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>需要几个条件：</p>\n<ul>\n<li>必须是在 admin 库下执行该关闭命令</li>\n<li>如果没有认证，必须是从 localhost 登录的，才能执行关闭服务命令</li>\n<li>非 localhost 得，通过远程登录，必须有登录且必须登录用户有对 admin 操作权限才可以。</li>\n</ul>\n<p>2. 以开启认证的方式启动服务</p>\n<p>有两种方式开启权限认证启动服务：一种是参数方式，一种是配置文件方式 (推荐)。</p>\n<p>1. 参数方式</p>\n<p>在启动时指定参数–auth，如：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/single/log/mongod.conf <span class=\"token parameter variable\">--auth</span></pre></td></tr></table></figure><p>2. 配置文件方式</p>\n<p>在 single/mongod.conf 配置文件中加入:</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>security:</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token comment\">#开启授权认证</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> authorization: enabled</pre></td></tr></table></figure><p>启动时可不加–auth 参数该方式避免忘记加–auth 导致不安全问题发生：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/single/log/mongod.conf</pre></td></tr></table></figure><p>启动服务并连接客户端查看效果：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/single/log/mongod.conf </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>forked process: <span class=\"token number\">36759</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>➜  ~ </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>➜  ~ /usr/local/mongodb/bin/mongo <span class=\"token parameter variable\">--host</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.244.142 <span class=\"token parameter variable\">--port</span><span class=\"token operator\">=</span><span class=\"token number\">27017</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>MongoDB shell version v5.0.18</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>connecting to: mongodb://192.168.244.142:27017/?compressors<span class=\"token operator\">=</span>disabled<span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">gssapiServiceName</span><span class=\"token operator\">=</span>mongodb</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Implicit session: session <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"id\"</span> <span class=\"token builtin class-name\">:</span> UUID<span class=\"token punctuation\">(</span><span class=\"token string\">\"ea29ccf7-9d79-4fc5-9615-b26267842fd8\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>MongoDB server version: <span class=\"token number\">5.0</span>.18</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>Warning: the <span class=\"token string\">\"mongo\"</span> shell has been superseded by <span class=\"token string\">\"mongosh\"</span>,</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token function\">which</span> delivers improved usability and compatibility.The <span class=\"token string\">\"mongo\"</span> shell has been deprecated and will be removed <span class=\"token keyword\">in</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>an upcoming release.</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>For installation instructions, see</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>https://docs.mongodb.com/mongodb-shell/install/</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token operator\">></span> show dbs</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token operator\">></span> use articledb</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>switched to db articledb</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token operator\">></span> show tables</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>Warning: unable to run listCollections, attempting to approximate collection names by parsing connectionStatus</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>可以看到不能访问任何数据</p>\n</li>\n</ol>\n<p>登录 myroot 用户：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> use admin</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>switched to db admin</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span> db.auth<span class=\"token punctuation\">(</span><span class=\"token string\">\"myroot\"</span>,<span class=\"token string\">\"123456\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">></span> show dbs</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>admin      <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>articledb  <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>config     <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token builtin class-name\">local</span>      <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>登录 bobo 普通用户：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> show dbs</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">></span> db.auth<span class=\"token punctuation\">(</span><span class=\"token string\">\"bobo\"</span>,<span class=\"token string\">\"123456\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Error: Authentication failed.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">></span> use articledb</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>switched to db articledb</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">></span> db.auth<span class=\"token punctuation\">(</span><span class=\"token string\">\"bobo\"</span>,<span class=\"token string\">\"123456\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token operator\">></span> show dbs</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>articledb  <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token operator\">></span> show tables</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>comment</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p><mark>注意</mark>：哪个用户权限属于哪个集合就需要 use 到该集合中执行 db.auth 命令才行</p>\n<h3 id=\"springdatamongodb连接认证\"><a class=\"markdownIt-Anchor\" href=\"#springdatamongodb连接认证\">#</a> SpringDataMongoDB 连接认证</h3>\n<p>使用用户名和密码连接到 MongoDB 服务器，你必须使用 <code>username:password@hostname/dbname</code>  格式， <code>username</code>  为用户名， <code>password</code>  为密码</p>\n<p>目标：使用用户 bobo 使用密码 123456 连接到 MongoDB 服务上。</p>\n<p>application.yml</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">#数据源配置</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token key atrule\">mongodb</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t\t<span class=\"token comment\">#主机地址</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t<span class=\"token comment\">#host: 192.168.244.142</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t<span class=\"token comment\">#数据库</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t<span class=\"token comment\">#database: articledb</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t<span class=\"token comment\">#默认端口号</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t<span class=\"token comment\">#port: 27017</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t<span class=\"token comment\">#账号</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t<span class=\"token comment\">#username: bobo</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t<span class=\"token comment\">#密码</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t<span class=\"token comment\">#password: 123456</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t<span class=\"token comment\">#单机有认证的情况下，也是用字符串连接</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t<span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> mongodb<span class=\"token punctuation\">:</span>//bobo<span class=\"token punctuation\">:</span>123456@192.168.244.142<span class=\"token punctuation\">:</span>27017/articledb</pre></td></tr></table></figure><p>提示：</p>\n<p>分别测试用户名密码正确以及不正确的情况.</p>\n<p>Compass 连接需要指定用户名和密码否则连接不上</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031701928.png\" alt=\"image-20230608165514763\"></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031701801.png\" alt=\"image-20230608165613122\"></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031701100.png\" alt=\"image-20230608165629084\"></p>\n<h2 id=\"副本集环境\"><a class=\"markdownIt-Anchor\" href=\"#副本集环境\">#</a> 副本集环境</h2>\n<h3 id=\"前言\"><a class=\"markdownIt-Anchor\" href=\"#前言\">#</a> 前言</h3>\n<p>对于搭建好的 mongodb 副本集，为了安全，启动安全认证，使用账号密码登。</p>\n<p>副本集环境使用之前搭建好的，架构如下：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031701536.png\" alt=\"image-20230608165821185\"></p>\n<h3 id=\"关闭已开启的副本集服务\"><a class=\"markdownIt-Anchor\" href=\"#关闭已开启的副本集服务\">#</a> 关闭已开启的副本集服务</h3>\n<h3 id=\"通过主节点添加一个管理员账号\"><a class=\"markdownIt-Anchor\" href=\"#通过主节点添加一个管理员账号\">#</a> 通过主节点添加一个管理员账号</h3>\n<p>只需要在主节点上添加用户，副本集会自动同步</p>\n<p>开启认证之前，创建超管用户：myroot，密码：123456</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> use admin</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> db.createUser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>user:<span class=\"token string\">\"myroot\"</span>,pwd:<span class=\"token string\">\"123456\"</span>,roles:<span class=\"token punctuation\">[</span><span class=\"token string\">\"root\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>详细操作见单实例环境的 <code>添加用户和权限</code> 的相关操作。</p>\n<p>提示：</p>\n<p>该步骤也可以在开启认证之后，但需要通过 localhost 登录才允许添加用户，用户数据也会自动同步到副本集，后续再创建其它用户，都可以使用该超管用户创建。</p>\n<h3 id=\"创建副本集认证的key文件\"><a class=\"markdownIt-Anchor\" href=\"#创建副本集认证的key文件\">#</a> 创建副本集认证的 key 文件</h3>\n<p>第一步：生成一个 key 文件当当前文件夹中</p>\n<p>可以使用任何方法生成密钥文件，例如：以下操作使用 openssl 生成密码文件，然后使用 chmod 来 更改文件权限，仅为文件所有者提供读取权限</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ openssl rand <span class=\"token parameter variable\">-base64</span> <span class=\"token number\">90</span> <span class=\"token parameter variable\">-out</span> ./mongo.keyfile</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token function\">chmod</span> <span class=\"token number\">400</span> ./mongo.keyfile</pre></td></tr></table></figure><p>提示：</p>\n<p>所有副本集节点都必须要用同一份 keyfile，一般是在一台机器上生成，然后拷贝到其它机器上，且必须有读的权限，否则将来会报错：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>permissions on /mongodb/replica_sets/myrs_27017/mongo.keyfile are too</pre></td></tr></table></figure><p>一定要保证密钥文件一致，文件位置随便，但是为了方便查找，建议每台机器都放到一个固定位置，都放到和配置文件一起的目录中</p>\n<p>这里将该文件分别拷贝到多个目录中：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token function\">cp</span> mongo.keyfile /mongodb/replica_sets/myrs_27017</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token function\">cp</span> mongo.keyfile /mongodb/replica_sets/myrs_27018</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token function\">cp</span> mongo.keyfile /mongodb/replica_sets/myrs_27019</pre></td></tr></table></figure><h3 id=\"修改配置文件指定keyfile\"><a class=\"markdownIt-Anchor\" href=\"#修改配置文件指定keyfile\">#</a> 修改配置文件指定 keyfile</h3>\n<p>分别编辑几个服务的 mongod.conf 文件，添加相关内容：</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">security</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">#keyfile 签权文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token key atrule\">keyFile</span><span class=\"token punctuation\">:</span> /mongodb/replica_sets/myrs_27017/mongo.keyfile</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">#开启认证方式运行</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token key atrule\">authorization</span><span class=\"token punctuation\">:</span> enabled</pre></td></tr></table></figure><figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">security</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">#keyfile 签权文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token key atrule\">keyFile</span><span class=\"token punctuation\">:</span> /mongodb/replica_sets/myrs_27018/mongo.keyfile</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">#开启认证方式运行</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token key atrule\">authorization</span><span class=\"token punctuation\">:</span> enabled</pre></td></tr></table></figure><figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">security</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">#keyfile 签权文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token key atrule\">keyFile</span><span class=\"token punctuation\">:</span> /mongodb/replica_sets/myrs_27019/mongo.keyfile</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">#开启认证方式运行</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token key atrule\">authorization</span><span class=\"token punctuation\">:</span> enabled</pre></td></tr></table></figure><h3 id=\"重新启动副本集\"><a class=\"markdownIt-Anchor\" href=\"#重新启动副本集\">#</a> 重新启动副本集</h3>\n<p>如果副本集是开启状态，则先分别关闭副本集中的每个 mongod，从次节点开始，直到副本集的所有成员都离线，包括任何仲载者，主节点必须是最后一个成员关闭以避免潜在的回滚。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ <span class=\"token function\">kill</span> <span class=\"token parameter variable\">-2</span> <span class=\"token number\">2453</span> <span class=\"token number\">2224</span> <span class=\"token number\">2110</span> <span class=\"token number\">2013</span></pre></td></tr></table></figure><p>分别启动副本集节点：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27017/log/mongod.conf </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>forked process: <span class=\"token number\">3960</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>➜  ~ /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27018/log/mongod.conf</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>forked process: <span class=\"token number\">4043</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>➜  ~ /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27019/log/mongod.conf</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>forked process: <span class=\"token number\">4144</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>➜  ~</pre></td></tr></table></figure><p>查看进程：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜  ~ <span class=\"token function\">ps</span> -ef<span class=\"token operator\">|</span><span class=\"token function\">grep</span> mongod<span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token parameter variable\">-v</span> <span class=\"token function\">grep</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>dkx0       <span class=\"token number\">3960</span>      <span class=\"token number\">1</span>  <span class=\"token number\">9</span> <span class=\"token number\">22</span>:44 ?        00:00:03 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27017/log/mongod.conf</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>dkx0       <span class=\"token number\">4043</span>      <span class=\"token number\">1</span> <span class=\"token number\">10</span> <span class=\"token number\">22</span>:44 ?        00:00:03 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27018/log/mongod.conf</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>dkx0       <span class=\"token number\">4144</span>      <span class=\"token number\">1</span> <span class=\"token number\">11</span> <span class=\"token number\">22</span>:44 ?        00:00:02 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/replica_sets/myrs_27019/log/mongod.conf</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>➜  ~</pre></td></tr></table></figure><p>登录 myroot 用户查看</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> show dbs</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> use admin</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>switched to db admin</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> db.auth<span class=\"token punctuation\">(</span><span class=\"token string\">\"myroot\"</span>,<span class=\"token string\">\"123456\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> show dbs</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>admin      <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>articledb  <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>config     <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token builtin class-name\">local</span>      <span class=\"token number\">0</span>.001GB</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token builtin class-name\">test</span>       <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><h3 id=\"在主节点上添加普通账号\"><a class=\"markdownIt-Anchor\" href=\"#在主节点上添加普通账号\">#</a> 在主节点上添加普通账号</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#添加普通用户管理 articledb 集合</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span> db.createUser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>user:<span class=\"token string\">\"bobo\"</span>,pwd:<span class=\"token string\">\"123456\"</span>,roles:<span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span>role:<span class=\"token string\">\"readWrite\"</span>,db:<span class=\"token string\">\"articledb\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Successfully added user: <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token string\">\"user\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"bobo\"</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token string\">\"roles\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t<span class=\"token string\">\"role\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"readWrite\"</span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t<span class=\"token string\">\"db\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"articledb\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>myrs:PRIMARY<span class=\"token operator\">></span></pre></td></tr></table></figure><p>重新连接，使用普通用户 bobo 重新登录，查看数据</p>\n<p>注意：也要使用 rs.status () 命令查看副本集是否健康</p>\n<h3 id=\"springdatamongodb连接副本集-2\"><a class=\"markdownIt-Anchor\" href=\"#springdatamongodb连接副本集-2\">#</a> SpringDataMongoDB 连接副本集</h3>\n<p>使用用户名和密码连接到 MongoDB 服务器，必须使用 <code>username:password@hostname/dbname</code>  格式</p>\n<p>目标：使用用户 bobo 使用密码 123456 连接到 mongoDB 服务上</p>\n<p>application.yml</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token comment\">#数据源配置</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">mongodb</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token comment\">#主机地址</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token comment\">#host: 192.168.244.142</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token comment\">#数据库</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token comment\">#database: articledb</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token comment\">#端口号</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token comment\">#port: 27017</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token comment\">#也可以使用 uri 连接</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token comment\">#uri: mongodb://192.168.244.142:27017/articledb</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token comment\">#副本集的连接字符串</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        mongodb<span class=\"token punctuation\">:</span>//bobo<span class=\"token punctuation\">:</span>123456@192.168.244.142<span class=\"token punctuation\">:</span><span class=\"token number\">27017</span><span class=\"token punctuation\">,</span>192.168.244.142<span class=\"token punctuation\">:</span><span class=\"token number\">27018</span><span class=\"token punctuation\">,</span>192.168.244.142<span class=\"token punctuation\">:</span>27019/articledb<span class=\"token punctuation\">?</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        connect=replicaSet<span class=\"token important\">&amp;secondaryOk=true&amp;replicaSet=myrs</span></pre></td></tr></table></figure><h3 id=\"分片集群环境扩展\"><a class=\"markdownIt-Anchor\" href=\"#分片集群环境扩展\">#</a> 分片集群环境 (扩展)</h3>\n<h4 id=\"关闭已开启的集群服务\"><a class=\"markdownIt-Anchor\" href=\"#关闭已开启的集群服务\">#</a> 关闭已开启的集群服务</h4>\n<p>分片集群环境下的安全认证和副本集环境下基本上一样。</p>\n<p>但分片集群的服务器环境和架构较为复杂，建议在搭建分片集群的时候，直接加入安全认证和服务器间的签权，如果之前有数据，可先将之前的数据备份出来，再还原回去</p>\n<p>本文使用之前搭建好的集群服务，因此，先停止之前的集群服务</p>\n<p>依次杀死 mongod 路由，配置副本集服务，分片副本服务，从次节点开始，直到所有成员都离线，副本集杀的时候，建议先杀仲载者，再杀副本节点，最后是主节点，以避免潜在的回滚，杀完检查一下</p>\n",
            "tags": [
                "计算机学科",
                "database",
                "mongodb"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mongodb/MongoDB%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E5%90%AF%E7%94%A8/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mongodb/MongoDB%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E5%90%AF%E7%94%A8/",
            "title": "MongoDB的安装及启用",
            "date_published": "2024-04-02T06:23:30.042Z",
            "content_html": "<blockquote>\n<p>MongoDB 是一个开源，高性能，无模式的文档行数据库，NoSQL 数据库产品的一种，是最像关系型数据库的非关系型数据库</p>\n</blockquote>\n<h2 id=\"什么时候使用mongodb\"><a class=\"markdownIt-Anchor\" href=\"#什么时候使用mongodb\">#</a> <strong>什么时候使用 MongoDB</strong> .</h2>\n<ul>\n<li>淘宝用户数据\n<ul>\n<li>存储位置：数据库<br>\n特征：永久性存储，修改频度极低</li>\n</ul>\n</li>\n</ul>\n<img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031654494.png\" alt=\"image-20230508172121935\" style=\"zoom:67%;\" />\n<ul>\n<li>游戏装备数据，游戏道具数据\n<ul>\n<li>存储位置：数据库，MongoDB</li>\n<li>特征：永久性存储与临时存储相结合，修改频度较高</li>\n</ul>\n</li>\n</ul>\n<img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031654564.png\" alt=\"image-20230508172300193\" style=\"zoom:67%;\" />\n<p>可以记录一些数据库，并且这个数据有很高的修改频率这种数据不太适合进数据库，而比较适合进 MongoDB 中</p>\n<h2 id=\"mongodb的下载\"><a class=\"markdownIt-Anchor\" href=\"#mongodb的下载\">#</a> MongoDB 的下载</h2>\n<p>进入官网: <a href=\"https://www.mongodb.com/try/download/community-kubernetes-operator\">MongoDB</a></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031654073.png\" alt=\"image-20230514194355932\"></p>\n<p>下载完成后进行解压:</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031654323.png\" alt=\"image-20230514194620731\"></p>\n<p>进入解压后的文件夹中查看结构：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031654953.png\" alt=\"image-20230514194734924\"></p>\n<p>在 MongoDB 解压后的路面中创建一个存储数据的文件夹:data</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031655399.png\" alt=\"image-20230514194931585\"></p>\n<p>在创建一个数据存储相关的文件:db</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031655089.png\" alt=\"image-20230514195004382\"></p>\n<p>在 bin 中 MongoDB 的执行文件是: mongod.exe</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031655736.png\" alt=\"image-20230514195231717\"></p>\n<p>在 MongoDB 目录中打开在当前位置下的 Terminal (终端)</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031655531.png\" alt=\"image-20230514195607777\"></p>\n<p>在 Terminal 中输入指令：mongod [指定存储位置] --dbpath=…/data/db , 完整的指令如下：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongod <span class=\"token parameter variable\">--dbpath</span><span class=\"token operator\">=</span><span class=\"token punctuation\">..</span>/data/db</pre></td></tr></table></figure><p>执行指令后的情况如下：这是相关数据的创建过程，犹如启动 Redis 中的 redis-server 一样</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031655165.png\" alt=\"image-20230514195504118\"></p>\n<p>默认端口号为：27017</p>\n<p>再查看 db 文件夹下的情况如下：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031655245.png\" alt=\"image-20230514195841419\"></p>\n<h2 id=\"进入到mongodb中\"><a class=\"markdownIt-Anchor\" href=\"#进入到mongodb中\">#</a> 进入到 MongoDB 中</h2>\n<p>到 MongoDB 的 bin 目录下，执行指令：mongo 启动 MongoDB</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongo</pre></td></tr></table></figure><p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031655792.png\" alt=\"image-20230514200129070\"></p>\n<h2 id=\"方式2配置文件方式启动服务重要\"><a class=\"markdownIt-Anchor\" href=\"#方式2配置文件方式启动服务重要\">#</a> 方式 2：配置文件方式启动服务 (重要)</h2>\n<p>部署项目使用该方式，以上的启动方式便以调试使用</p>\n<p>在解压目录中新建 config 文件夹，该文件夹新建配置文件 mongod.conf，内容参考如下：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031656962.png\" alt=\"image-20230603091350281\"></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031656079.png\" alt=\"image-20230603091719879\"></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token comment\">#The directory where the mongod instance sotres its data.Default value is \"\\data\\db\" on Windows.</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token key atrule\">dbPath</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>配置路径，也就是到db目录的绝对路径<span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>注意：</p>\n<p>配置文件中如果使用双引号，比如路径地址，自动会将双引号的内容转义，如果不转义，则会报错：</p>\n<pre><code>error-parsing-yaml-config-file-yaml-cpp-error-at-line-3-column-15-unknown-escape-character-d\n</code></pre>\n<p>解决：</p>\n<ol>\n<li>对 <code>\\</code>  换成 <code>/</code>  或 <code>//</code></li>\n<li>如果路径中没有空格，则无需加引号</li>\n<li>配置文件中不能以 Tab 分割字段</li>\n</ol>\n<p>解决：</p>\n<p>将其转换成空格。</p>\n<p>启动方式：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongod <span class=\"token parameter variable\">-f</span> <span class=\"token punctuation\">..</span>/config/mongod.conf</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>或</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>mongod <span class=\"token parameter variable\">--config</span> <span class=\"token punctuation\">..</span>/config/mongod.conf</pre></td></tr></table></figure><p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031656411.png\" alt=\"image-20230603094012602\"></p>\n<p>更多参数配置：</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">systemLong</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token key atrule\">destination</span><span class=\"token punctuation\">:</span> file</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\">#The path of the log file to which mondod mongos should send all diagnostic logging information</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>mongod.log文件绝对路径地址<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token key atrule\">logAppend</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token key atrule\">journal</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre> <span class=\"token comment\">#The directory where the mongod instance storage its data.Default value is \"/data/db\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token key atrule\">dbPath</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>配置路径，也就是到db目录的绝对路径<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token key atrule\">net</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> <span class=\"token comment\">#bindIp: 127.0.0.1</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">27017</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token key atrule\">setParameter</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre> <span class=\"token key atrule\">enableLocalhostAuthBypass</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></pre></td></tr></table></figure><p>windows 配置如下：</p>\n<pre><code>systemLog:\n  destination: file\n  path: D:\\mongoDB\\mongodb-win32-x86_64-windows-5.0.26\\log\\mongod.log  # 实际日志文件路径\n  logAppend: true\n\nstorage:\n  dbPath: D:\\mongoDB\\mongodb-win32-x86_64-windows-5.0.26\\data  # 实际数据存储路径\n\nnet:\n  bindIp: 0.0.0.0\n  port: 27017  # MongoDB 默认端口号\n</code></pre>\n<h2 id=\"shell连接mongo命令\"><a class=\"markdownIt-Anchor\" href=\"#shell连接mongo命令\">#</a> Shell 连接 (mongo 命令)</h2>\n<p>在命令提示符输入以下 Shell 命令即可完成登录</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mongo</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>或</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>mongo <span class=\"token parameter variable\">--host</span><span class=\"token operator\">=</span><span class=\"token number\">127.0</span>.0.1 <span class=\"token parameter variable\">--port</span><span class=\"token operator\">=</span><span class=\"token number\">27017</span></pre></td></tr></table></figure><p>查看已经有的数据库</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> show databases</pre></td></tr></table></figure><p>退出 mongodb</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token builtin class-name\">exit</span></pre></td></tr></table></figure><p>更多参数可以通过帮助查看：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> mongo <span class=\"token parameter variable\">--help</span></pre></td></tr></table></figure><p>提示：</p>\n<p>MongoDB javascript Shell 是一个基于 javascript 的解释器，故是支持 js 程序的。</p>\n<h2 id=\"linux系统中的安装启动和连接\"><a class=\"markdownIt-Anchor\" href=\"#linux系统中的安装启动和连接\">#</a> Linux 系统中的安装启动和连接</h2>\n<p>目标：在 Linux 中部署一个单机的 MongoDB，作为生产环境下使用。</p>\n<p>提示：和 Windows 下操作差不多。</p>\n<p>步骤如下：</p>\n<ol>\n<li>先到官网下载压缩包：mongodb-linux-x86_64-4.0.10.tgz</li>\n<li>上传压缩包到 Linux 中 ，解压到当前目录</li>\n</ol>\n<pre><code>tar -xvf mongodb-linux-x86_64-4.0.10.tgz\n</code></pre>\n<ol start=\"3\">\n<li>移动解压后的文件夹到指定的目录中：</li>\n</ol>\n<pre><code>mv mongodb-linxu-x86_64-4.0.10 /usr/local/mongodb\n</code></pre>\n<ol start=\"4\">\n<li>新建几个目录，分别用来存储数据和日志：</li>\n</ol>\n<pre><code>#数据存储目录\nmkdir -p /mongodb/single/data/db\n#日志存储目录\nmkdir -p /mongodb/single/log\n</code></pre>\n<ol start=\"5\">\n<li>新建并修改配置文件</li>\n</ol>\n<pre><code>vi /mongodb/single/mongod.conf\n</code></pre>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemLog:</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token comment\">#MongoDB 发送所有日志输出的目标指定为文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\">#The path of the log file to which mongod or mongos should send all diagnostic logging information</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> destination: <span class=\"token function\">file</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token comment\">#mongod 或 mongos 应向其发送所有诊断日志记录信息的日志文件的路径</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> path: <span class=\"token punctuation\">[</span>mongod.log绝对路径<span class=\"token punctuation\">]</span>比如：<span class=\"token string\">\"/mongodb/single/log/mongod.log\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token comment\">#当 mongos 或 mongod 实例重新启动时，mongos 或 mongod 会将新条目附加到现有日志文件的末尾。</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> logAppend: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>storage:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token comment\">#mongod 实例存储其数据的目录。storage.dbPath 设置仅适用于 mongod。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> <span class=\"token comment\">#The directory where the mongod instance stores its data.Defaul value is \"/data/db\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> dbPath: <span class=\"token string\">\"/mongodb/single/data/db\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> journal:</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token comment\">#启用或禁用持久性日志以确保数据文件保持有效和可恢复</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  enabled: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>processManagement:</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token comment\">#启用在后台运行 mongos 或 mongod 进程的守护进程模式。</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  fork: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>net:</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token comment\">#服务实例绑定 IP，默认是 localhost</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  bindIp: localhost192.168.0.2</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token comment\">#bindIp</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token comment\">#绑定的端口，默认是 27017</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  port: <span class=\"token number\">27017</span></pre></td></tr></table></figure><p>6. 启动 MongoDB 服务</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>dkx0@localhost<span class=\"token punctuation\">]</span>/% /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/single/log/mongod.conf </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>about to fork child process, waiting <span class=\"token keyword\">until</span> server is ready <span class=\"token keyword\">for</span> connections.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>forked process: <span class=\"token number\">2708</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>child process started successfully, parent exiting</pre></td></tr></table></figure><p>注意：</p>\n<p>如果启动后不是 successfully，则是启动失败了。原因基本上就是配置文件有问题</p>\n<p>通过进程来查看服务是否启动了：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>dkx0@localhost<span class=\"token punctuation\">]</span>/% <span class=\"token function\">ps</span> <span class=\"token parameter variable\">-ef</span> <span class=\"token operator\">|</span><span class=\"token function\">grep</span> mongod<span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token parameter variable\">-v</span> <span class=\"token function\">grep</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>dkx0       <span class=\"token number\">2708</span>      <span class=\"token number\">1</span>  <span class=\"token number\">1</span> 03:30 ?        00:00:05 /usr/local/mongodb/bin/mongod <span class=\"token parameter variable\">-f</span> /mongodb/single/log/mongod.conf</pre></td></tr></table></figure><p>7. 分别使用 mongo 命令和 compass 工具来连接测试</p>\n<p>提示：如果远程连接不上，需要配置防火墙放行，或直接关闭 Linux 防火墙</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#查看防火墙状态</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>systemctl status firewalld</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#临时关闭防火墙</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>systemctl stop firewalld</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#开机禁止启动防火墙</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>systemctl disable firewalld</pre></td></tr></table></figure><p>8. 停止关闭服务</p>\n<p>停止服务的方式有两种：快速关闭和标准关闭，下面依次说明：</p>\n<p>一，快速关闭方法 (快速，简单，数据可能会出错)</p>\n<p>目标：通过系统的 kill -9 命令直接杀死进程</p>\n<p>杀完要检查一下，避免有的没有杀掉</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#通过进程编号关闭节点</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">kill</span> <span class=\"token parameter variable\">-2</span> <span class=\"token number\">54410</span></pre></td></tr></table></figure><p>[补充]</p>\n<p>如果一旦是因为数据损坏，则需要进行如下操作：</p>\n<p>1. 删除 lock 文件</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">rm</span> <span class=\"token parameter variable\">-f</span> /mongodb/single/data/db/*.lock</pre></td></tr></table></figure><p>2. 修复数据：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>/usr/local/mongdb/bin/mongod <span class=\"token parameter variable\">--repair</span> <span class=\"token parameter variable\">--dbpath</span><span class=\"token operator\">=</span>/mongodb/single/data/db</pre></td></tr></table></figure><p>二，标准的关闭方法 (数据不容易出错，但麻烦)</p>\n<p>目标：通过 mongo 客户端中的 shutdownServer 命令来关闭服务。</p>\n<p>主要的操作步骤参考如下：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#客户端登录服务，注意，这里通过 localhost 登录，如果需要远程登录，必须先登录认证才行</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>mongo <span class=\"token parameter variable\">--port</span> <span class=\"token number\">27016</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#切换到 admin 库</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>use admin</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#关闭服务</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>db.shutdownServer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>连接 linux 中的 mongo，指定 IP 和端口号即可。</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031656672.png\" alt=\"image-20230603154442420\"></p>\n",
            "tags": [
                "计算机学科",
                "database",
                "mongodb"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mongodb/MongoDB%E5%85%A5%E9%97%A8/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/mongodb/MongoDB%E5%85%A5%E9%97%A8/",
            "title": "MongoDB入门",
            "date_published": "2024-04-02T06:23:30.039Z",
            "content_html": "<h2 id=\"mongodb相关概念\"><a class=\"markdownIt-Anchor\" href=\"#mongodb相关概念\">#</a> MongoDB 相关概念</h2>\n<h3 id=\"业务应用场景\"><a class=\"markdownIt-Anchor\" href=\"#业务应用场景\">#</a> 业务应用场景</h3>\n<p>传统的关系型数据库 (如 MySQL)，在数据库操作的 &quot;三高&quot; 需求以及应对 Web2.0 的网站需求，显得力不从心</p>\n<p><strong>解释</strong>：“三高” <strong>需求</strong>：</p>\n<ul>\n<li>High performance - 对数据库高并发读写的需求。</li>\n<li>Huge Storage - 对海量数据的高效率存储和访问的需求。</li>\n<li>High Scalabillity &amp;&amp; High Availability - 对数据库的高可扩展性和高可用性的需求。</li>\n</ul>\n<p>而 MongoDB 可应对 &quot;三高&quot; 需求。</p>\n<p><strong>具体的应用场景如</strong>：</p>\n<ol>\n<li>社交场景，使用 MongoDB 存储用户信息，以及用户发表的朋友圈信息，通过地理位置索引实现附近的人，地点等功能。</li>\n<li>游戏场景，使用 MongoDB 存储游戏用户信息，用户的装备，积分等直接以内嵌文档的形式存储，方便查询，高效率存储和访问。</li>\n<li>物流场景，使用 MongoDB 存储订单信息，订单状态在运送过程中会不断更新，以 MongoDB 内嵌数据的形式来存储，一次查询就能将订单所有的变更读取出来。</li>\n<li>物联网场景，使用 MongoDB 存储所有接入的智能设备信息，以及设备汇报的日志信息，并对这些信息进行多维度的分析。</li>\n<li>视频直播，使用 MongoDB 存储用户信息，点赞互动信息等。</li>\n</ol>\n<p>这些应用场景中，数据操作方面的共同特点是：</p>\n<ol>\n<li>数据量大</li>\n<li>写入操作频繁 (读写很频繁)</li>\n<li>价值较低的数据，对事物要求性不高</li>\n</ol>\n<p>对于这样的数据，我们更适合使用 MongoDB 来实现数据的存储</p>\n<h3 id=\"什么时候选择mongodb\"><a class=\"markdownIt-Anchor\" href=\"#什么时候选择mongodb\">#</a> 什么时候选择 MongoDB</h3>\n<p>在构架选型上，除了上述的三个特点外，如果你还犹豫是否选择它，可以考虑以下的一些问题：</p>\n<p>应用不需要事务以及复杂 join 支持</p>\n<p>新应用，需求会变，数据模型无法确定，想快速迭代开发</p>\n<p>应用需要 2000~3000 以上的读写 QPS (更高也可以)</p>\n<p>应用需要 TB 甚至 PB 级别数据存储</p>\n<p>应用要求存储的数据不丢失</p>\n<p>应用需要 99.999% 高可用</p>\n<p>应用需要大量的地理位置查询，文本查询</p>\n<p>如果上述有 1 个符合，可以考虑 MongoDB，2 个以及的符合，选择 MongoDB 绝不会后悔</p>\n<p>思考：如果用 MySQL 呢？</p>\n<p>答：相对 MySQL，可以以更低的成本解决问题 (包括学习，开发，运维等成本)</p>\n<h3 id=\"mongodb简介\"><a class=\"markdownIt-Anchor\" href=\"#mongodb简介\">#</a> MongoDB 简介</h3>\n<p>MongoDB 是一个开源，高性能，无模式的文档型数据库，当初的设计就是用于简化开发和方便扩展，是 NoSQL 数据库产品的一种，是最像关系型数据库 (MySQL) 的非关系型数据库。</p>\n<p>它支持的数据结构非常松散，是一种类似于 JSON 的格式叫 BSON，所以它既可以存储比较复杂的数据类型，有相当灵活。</p>\n<p>MongoDB 中的记录是一个文档，它是一个由字段和值对 (field:value) 组成的数据结构，MongoDB 文档类似于 JSON 对象，即一个文档认为就是一个对象，字段的数据类型是字符串，它的值除了使用基本的一些类型外，还可以包括其它文档，普通数组和文档数组。</p>\n<h2 id=\"体系结构\"><a class=\"markdownIt-Anchor\" href=\"#体系结构\">#</a> 体系结构</h2>\n<p>MySQL 和 MongoDB 对比</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031701137.png\" alt=\"image-20230602204736615\"></p>\n<table>\n<thead>\n<tr>\n<th>SQL 术语 / 概念</th>\n<th>MongoDB 术语 / 概念</th>\n<th>解释 / 说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>database</td>\n<td>databse</td>\n<td>数据库</td>\n</tr>\n<tr>\n<td>table</td>\n<td>collection</td>\n<td>数据库表 / 集合</td>\n</tr>\n<tr>\n<td>row</td>\n<td>document</td>\n<td>数据记录行 / 文档</td>\n</tr>\n<tr>\n<td>column</td>\n<td>field</td>\n<td>数据字段 (列)/ 域 (字段)</td>\n</tr>\n<tr>\n<td>index</td>\n<td>index</td>\n<td>索引</td>\n</tr>\n<tr>\n<td>table joins</td>\n<td></td>\n<td>表连接，MongoDB 不支持</td>\n</tr>\n<tr>\n<td></td>\n<td>嵌入文档</td>\n<td>MongoDB 通过嵌入式文档来替代多表连接</td>\n</tr>\n<tr>\n<td>primary key</td>\n<td>primary key</td>\n<td>主键，MongoDB 自动将_id 字段设置为主键</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"数据模型\"><a class=\"markdownIt-Anchor\" href=\"#数据模型\">#</a> 数据模型</h2>\n<p>MongoDB 的最小存储单位就是文档 (document) 对象，文档 (document) 对象对应于关系型数据库的行，数据在 MongoDB 中以 BSON (Binary-JSON) 文档的格式存储在磁盘上。</p>\n<p>BSON (Binary Serialized Document Format) 是一种类似 json 的一种二进制形式的存储格式，简称 Binary JSON。</p>\n<p>BSON 和 JSON 一样，支持内嵌的文档对象和数组对象，但是 BSON 有 JSON 没有的一些数据类型，如 Date 和 BinData 类型。</p>\n<p>BSON 采用了类似于 C 语言结构体的名称，对表示方法，支持内嵌的文档对象和数组对象，具有轻量性，可遍历性，高效性的三个特点，可以有效描述非结构化数据的结构化数据。这种格式的优点是灵活性高，但它的缺点是空间利用率不是很理想。</p>\n<p>Bson 中，除了基本的 JSON 类型：string，integer，boolean，double，null，array 和 object，mongo 还是用了特殊的数据类型，这些类型包括 date，object，binary，data，regular，expression 和 code。每一个驱动都以特定语言的方式实现了这些类型，查看你的驱动的文档来获取详细信息。</p>\n<p>BSON 数据类型参考列表：</p>\n<table>\n<thead>\n<tr>\n<th>数据类型</th>\n<th>描述</th>\n<th>举例</th>\n</tr>\n</thead>\n<tbody>\n<tr x:foobar=\"\">\n<td>字符串</td>\n<td>UTF-8 字符串都可以表示为字符串类型的数据</td>\n<td></td>\n</tr>\n<tr x:ObjectId()=\"\">\n<td>对象 id</td>\n<td>对象 id 是文档的 12 字节的唯一 ID</td>\n<td></td>\n</tr>\n<tr>\n<td>布尔值</td>\n<td>真或者假：true 或者 false</td>\n<td>{“x”:true}+</td>\n</tr>\n<tr x:[a,b,c]=\"\">\n<td>数组</td>\n<td>值的集合或者列表可以表示成数组</td>\n<td></td>\n</tr>\n<tr>\n<td>32 位整数</td>\n<td>类型不可用，JavaScript 仅支持 64 位浮点数，所以 32 位整数会被自动转换</td>\n<td>shell 是不支持该类型的，shell 中默认会转换成 64 位浮点数</td>\n</tr>\n<tr x:3.14159,y:3=\"\">\n<td>64 位浮点数</td>\n<td>shell 中的数字就是一种类型</td>\n<td></td>\n</tr>\n<tr x:null=\"\">\n<td>null</td>\n<td>表示空值或者未定义的对象</td>\n<td></td>\n</tr>\n<tr x:undefined=\"\">\n<td>undefined</td>\n<td>文档中也可以使用未定义类型</td>\n<td></td>\n</tr>\n<tr>\n<td>符号</td>\n<td>shell 不支持，shell 会将数据库中的符号类型的数据自动转换成字符串</td>\n<td></td>\n</tr>\n<tr x:foobari=\"\">\n<td>正则表达式</td>\n<td>文档中可以包含正则表达式，采用 JavaScript 的正则表达式</td>\n<td></td>\n</tr>\n<tr>\n<td>代码</td>\n<td>文档中还可以包含 JavaScript 代码</td>\n<td>{“x”:function(){/* … */}}</td>\n</tr>\n<tr>\n<td>二进制数据</td>\n<td>二进制数据可以由任意字节的串组成，不过 shell 中无法使用</td>\n<td></td>\n</tr>\n<tr>\n<td>最大值 / 最小值</td>\n<td>BSON 包括一个特殊类型，表示可能的最大值 shell 中没有这个类型</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>提示：</p>\n<p>shell 默认使用 64 位浮点值。{“x”:3.14} 或 {“x”:3}。对于整型值，可以使用 NumberInt (4 个字节符号整数) 或 NumberLong (8 字节符号整数)，{“x”:NumberInt (“3”){“x”:NumberLong (“3”)}}</p>\n<h2 id=\"mongodb的特点\"><a class=\"markdownIt-Anchor\" href=\"#mongodb的特点\">#</a> MongoDB 的特点</h2>\n<p>MongoDB 主要有如下特点：</p>\n<p>1. 高性能</p>\n<p>MongoDB 提供高性能的数据持久性，特别是对嵌入式数据模型的支持减少了数据库系统上的 I/O 活动。</p>\n<p>索引支持更快的查询，并且可以包含来自嵌入式文档和数组的键。(文本索引解决搜索的要求，TTL 索引解决历史数据自动过期的需求，地理位置索引可用于构建各种 O2O 应用)</p>\n<p>mmapv1，wiredtiger，mongorocks (rocksdb)，in-memory 等多引擎支持满足各种场景需求。</p>\n<p>Gridfs 解决文件存储的需求。</p>\n<p>2. 高可用性</p>\n<p>MongoDB 的复制工具成为副本集 (replica set)，它可提供自动故障转移和数据冗余。</p>\n<p>3. 高扩展性</p>\n<p>MongoDB 提供了水平可扩展性作为其核心功能的一部分。</p>\n<p>分片将数据分布在一组集群的机器上。(海量数据存储，服务能力水平扩展)</p>\n<p>从 3.4 开始，MongoDB 支持基于片创建数据区域，在一个平衡的集群中，MongoDB 将一个区域所覆盖的读写只定向到该区域内的那些片。</p>\n<p>4. 丰富的查询支持</p>\n<p>MongoDB 支持丰富的查询语言，支持读和写操作 (CRUD)，比如数据聚合，文本搜索和地理空间查询等。</p>\n<p>5. 其它特点：如无模式 (动态模式)，灵活的文档模型</p>\n<h2 id=\"基本常用命令\"><a class=\"markdownIt-Anchor\" href=\"#基本常用命令\">#</a> 基本常用命令</h2>\n<h3 id=\"案例需求\"><a class=\"markdownIt-Anchor\" href=\"#案例需求\">#</a> 案例需求：</h3>\n<p>存放文章评论的数据存放到 MongoDB 中，数据结构参考如下：</p>\n<p>数据库：articledb</p>\n<table>\n<thead>\n<tr>\n<th>专栏文章评论</th>\n<th>comment</th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>字段名称</td>\n<td>字段含义</td>\n<td>字段类型</td>\n<td>备注</td>\n</tr>\n<tr>\n<td>_id</td>\n<td>ID</td>\n<td>ObjectId 或 String</td>\n<td>Mongo 的主键的字段</td>\n</tr>\n<tr>\n<td>articleid</td>\n<td>文章 ID</td>\n<td>String</td>\n<td></td>\n</tr>\n<tr>\n<td>content</td>\n<td>评论内容</td>\n<td>String</td>\n<td></td>\n</tr>\n<tr>\n<td>userid</td>\n<td>评论人 ID</td>\n<td>String</td>\n<td></td>\n</tr>\n<tr>\n<td>nickname</td>\n<td>评论人昵称</td>\n<td>String</td>\n<td></td>\n</tr>\n<tr>\n<td>createdatetime</td>\n<td>评论的日期时间</td>\n<td>Date</td>\n<td></td>\n</tr>\n<tr>\n<td>likenum</td>\n<td>点赞数</td>\n<td>int32</td>\n<td></td>\n</tr>\n<tr>\n<td>replynum</td>\n<td>回复数</td>\n<td>int32</td>\n<td></td>\n</tr>\n<tr>\n<td>state</td>\n<td>状态</td>\n<td>String</td>\n<td>0：不可见，1：可见</td>\n</tr>\n<tr>\n<td>parentid</td>\n<td>上级 ID</td>\n<td>String</td>\n<td>如果为 0 表示文章的顶级评论</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"数据库操作\"><a class=\"markdownIt-Anchor\" href=\"#数据库操作\">#</a> 数据库操作</h2>\n<h3 id=\"选择和创建数据库\"><a class=\"markdownIt-Anchor\" href=\"#选择和创建数据库\">#</a> 选择和创建数据库</h3>\n<p>选择和创建数据库的语法格式：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> use 数据库名称</pre></td></tr></table></figure><p>如果数据库不存在则自动创建，例如，以下语句创建 spitdb 数据库：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> use articledb</pre></td></tr></table></figure><p>查看有权限查看的所有数据库命令</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> show dbs</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>或</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span> show databases</pre></td></tr></table></figure><blockquote>\n<p>注意：在 MongoDB 中，集合只有在内容插入后才会创建！就是说，创建集合 (数据表) 后要再插入一个文档 (记录)，集合才会真正创建。</p>\n</blockquote>\n<p>查看当前正在使用的数据库命令</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db</pre></td></tr></table></figure><p>MongoDB 中默认的数据库为 test，如果你没有选择数据库，集合将存放在 test 数据库中。</p>\n<p>另外：</p>\n<p>数据库名可以是满足以下条件的任意 UTF-8 字符串。</p>\n<ul>\n<li>不能是空字符串 (&quot;&quot;)</li>\n<li>不得含有’ '(空格)，.，$，/，\\，和 \\0 (空字符)</li>\n<li>应全部小写</li>\n<li>最多 64 字节</li>\n</ul>\n<p>有一些数据库名是保留的，可以直接访问这些有特殊作用的数据库</p>\n<ul>\n<li>admin：从权限的角度来看，这是 &quot;roor&quot; 数据库，要是将一个用户添加到这个数据库，这个用户自动继承所有数据库的权限，一些特定的服务器端命令也只能从这个数据库运行，比如列出所有的数据库或者关闭服务器</li>\n<li>local：这个数据库的数据永远不会被复制，可以用来存储限于本地单台服务器的任意集合</li>\n<li>config：当 Mongo 用于分片设置时，config 数据库在内部使用，用于保存分片的相关信息</li>\n</ul>\n<p>创建数据库：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> show dbs</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>admin   <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>config  <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">local</span>   <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">></span> use articledb</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>switched to db articledb</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">></span> show dbs</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>admin   <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>config  <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token builtin class-name\">local</span>   <span class=\"token number\">0</span>.000GB</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>可以看到检查数据库时并没有 articledb 这是为什么呢，看如下解释：</p>\n<blockquote>\n<p>MongoDB 的存储分为两部分：当使用 use articledb 创建数据库时存放到了内存中了，没有持久化到磁盘所以使用 show dbs 是看不到的，当 articledb 中有一个集合的时候，不是一个空的数据库的时候就会自动持久化到磁盘中</p>\n</blockquote>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031701895.png\" alt=\"image-20230603161134922\"></p>\n<p>查看当前所在的数据库：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>articledb</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><h3 id=\"数据库的删除\"><a class=\"markdownIt-Anchor\" href=\"#数据库的删除\">#</a> 数据库的删除</h3>\n<p>MongoDB 删除数据库的语法格式如下：在要删除的数据库中执行</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.dropDatabase<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>提示：主要用来删除已经持久化的数据库</p>\n<h3 id=\"集合操作\"><a class=\"markdownIt-Anchor\" href=\"#集合操作\">#</a> 集合操作</h3>\n<p>集合，类似关系型数据库中的表</p>\n<p>可以显示的创建，也可以隐式的创建</p>\n<h3 id=\"集合的显示创建\"><a class=\"markdownIt-Anchor\" href=\"#集合的显示创建\">#</a> 集合的显示创建</h3>\n<p>基本语法格式：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.createCollection<span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>参数说明：</p>\n<ul>\n<li>name：要创建的集合名称</li>\n</ul>\n<p>例如：创建一个名为 mycollection 的普通集合</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.createCollection<span class=\"token punctuation\">(</span><span class=\"token string\">\"mycollection\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>查看当前数据库中的表：show tables 命令</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> show collections</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>或</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span> show tables</pre></td></tr></table></figure><p>集合的命名规范：</p>\n<ul>\n<li>集合名不能是空字符串</li>\n<li>集合名不能含有 \\0 字符 (空字符)，这个字符表示集合名的结尾</li>\n<li>集合名不能以 &quot;system.&quot; 开头，这是为系统集合保留的前缀</li>\n<li>用户创建的集合名字不能含有保留字符，有些驱动程序的确支持在集合名里面包含，这是因为某些系统生成的集合中包含该字符，除非你要访问这种系统创建的集合，否则千万不要在名字里出现 $</li>\n</ul>\n<h3 id=\"集合的隐式创建\"><a class=\"markdownIt-Anchor\" href=\"#集合的隐式创建\">#</a> 集合的隐式创建</h3>\n<p>当向一个集合插入一个文档的时候，如果集合不存在，则会自动创建集合。</p>\n<p>详见文档的插入 章节。</p>\n<p>提示：通常我们使用隐式创建文档即可。</p>\n<h3 id=\"集合的删除\"><a class=\"markdownIt-Anchor\" href=\"#集合的删除\">#</a> 集合的删除</h3>\n<p>集合的删除语法格式如下：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.collection.drop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>或</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span> db.集合.drop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><strong>返回值</strong></p>\n<p>如果成功删除选定集合，则 drop () 方法返回 true，否则返回 false</p>\n<p>例如：要删除 mycollection 集合</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.mycollection.drop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> show tables</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>name</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span> db.name.drop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">></span> show tables</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><h2 id=\"文档基本crud\"><a class=\"markdownIt-Anchor\" href=\"#文档基本crud\">#</a> 文档基本 CRUD</h2>\n<p>文档 (document) 的数据结构和 JSON 基本一样。</p>\n<p>所有存储在集合中的数据都是 BSON 格式</p>\n<h3 id=\"文档的插入\"><a class=\"markdownIt-Anchor\" href=\"#文档的插入\">#</a> 文档的插入</h3>\n<h4 id=\"1单个文档插入\"><a class=\"markdownIt-Anchor\" href=\"#1单个文档插入\">#</a> 1. 单个文档插入</h4>\n<p>使用 insert () 或 save () 方法向集合中插入文档，语法格式如下：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.collection.insert<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token operator\">&lt;</span>document or array of documents<span class=\"token operator\">></span>,</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\twriteConcern: <span class=\"token operator\">&lt;</span>document<span class=\"token operator\">></span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\tordered: <span class=\"token operator\">&lt;</span>boolean<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>参数：</p>\n<table>\n<caption id=\"\" style=\"caption-side: bottom\">示例</caption>\n<thead>\n<tr>\n<th>Parameter</th>\n<th>Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>document</td>\n<td>document or array</td>\n<td>要插入到集合中的文档或文档数组 (json 格式)</td>\n</tr>\n<tr>\n<td>writeConcern</td>\n<td>document</td>\n<td>Optional.A document expressing the write concern.Omit to use the<br>default write concern.See write <a href=\"http://Concern.Do\">Concern.Do</a> not explicitly set the write<br>concerrn for  the operation if run in a <a href=\"http://transaction.To\">transaction.To</a> use write concern<br>with transactions,see Transactions and Write Concern</td>\n</tr>\n<tr>\n<td>orrderd</td>\n<td>boolean</td>\n<td>可选，如果为真，则按顺序插入数组中的文档 ，如果其中一个文档出现错误，MongoDB 将返回而不处理数组中其余文档，如果为假，则执行无序插入，如果其中一个文档出现错误，则继续处理数组中的主文档，在版本 2.6 + 中默认为 true</td>\n</tr>\n</tbody>\n</table>\n<p>要向 comment 的集合 (表) 中插入一条测试数据：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.insert<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"articleid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"10000\"</span>,<span class=\"token string\">\"content\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"今天天气真好\"</span>,<span class=\"token string\">\"userid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1001\"</span>,<span class=\"token string\">\"nickname\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"Rose\"</span>,<span class=\"token string\">\"createdatetime\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"now Date()\"</span>,<span class=\"token string\">\"likenum\"</span>:NumberInt<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>,<span class=\"token string\">\"state\"</span>:null<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>提示：</p>\n<ol>\n<li>comment 集合如果不存在，则会隐式创建</li>\n<li>mongo 中的数字，默认情况下是 double 类型，如果要存储整型，必须使用函数 NumberInt (整型数字)，否则取出来就有问题了</li>\n<li>插入当前日期使用 now Date ()</li>\n<li>插入的数据没有指定_id，会自动生成主键值</li>\n<li>如果某字段没有值，可以赋值为 null，或不写该字段</li>\n</ol>\n<p>执行后，如下，说明插入一个数据成功了。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>WriteResult<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nInserted\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>现在数据库中没有任何的集合：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> show tables</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>向一个不存在的集合插入数据：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.insert<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>uncaught exception: Error: no object passed to insert<span class=\"token operator\">!</span> <span class=\"token builtin class-name\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>DBCollection.prototype.insert@src/mongo/shell/collection.js:275:15</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>@<span class=\"token punctuation\">(</span>db.comment.insert<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"articleid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1000\"</span>,<span class=\"token string\">\"content\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"今天天气真好\"</span>,<span class=\"token string\">\"useid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1001\"</span>,<span class=\"token string\">\"inckname\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"Rose\"</span>,<span class=\"token string\">\"createdatetime\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"now Date()\"</span>,<span class=\"token string\">\"likenum\"</span>:NumberInt<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>,<span class=\"token string\">\"state\"</span>:null<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>001<span class=\"token string\">\",\"</span>incknam<span class=\"token string\">\"&#125;)</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>WriteResult(&#123; \"</span>nInserted\" <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">></span> show tables</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>comment</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>查看集合中插入的数据：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.<span class=\"token function-name function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647b250656447c36332f1c37\"</span><span class=\"token punctuation\">)</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1000\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"今天天气真好\"</span>, <span class=\"token string\">\"useid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1001\"</span>, <span class=\"token string\">\"inckname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"Rose\"</span>, <span class=\"token string\">\"createdatetime\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"now Date()\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">10</span>, <span class=\"token string\">\"state\"</span> <span class=\"token builtin class-name\">:</span> null <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>不存在的集合就被隐式的创建了。</p>\n<p><mark>注意</mark>：</p>\n<ol>\n<li>文档中 的键 / 值对是有序的</li>\n<li>文档中的值不仅可以是在双引号里面的字符串，还可以是其它几种数据类型 (甚至可以是整个嵌入的文档)</li>\n<li>MongoDB 区分类型和大小写</li>\n<li>MongoDB 的文档不能有重复的键</li>\n<li>文档的键是字符串，除了少数例外情况，键可以使用任意 UTF-8 字符</li>\n</ol>\n<p>文档键命名规范：</p>\n<ul>\n<li>键不能含有 \\0 (空字符)，这个字符用来表示键的结尾。</li>\n<li>. 和 $ 有特别的意义，只有在特定环境下才能使用</li>\n<li>以下划线 &quot;_&quot; 开头的键是保留的 (不是严格要求的)</li>\n</ul>\n<h4 id=\"2批量插入\"><a class=\"markdownIt-Anchor\" href=\"#2批量插入\">#</a> 2. 批量插入</h4>\n<p>语法：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.collection.insertMany<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span>document <span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span>,<span class=\"token operator\">&lt;</span>document <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token punctuation\">]</span>,<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\twriteConcern: <span class=\"token operator\">&lt;</span>document<span class=\"token operator\">></span>,</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tordered: <span class=\"token operator\">&lt;</span>boolean<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>参数：</p>\n<table>\n<caption id=\"\" style=\"caption-side: bottom\">示例</caption>\n<thead>\n<tr>\n<th>Parameter</th>\n<th>Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>document</td>\n<td>document</td>\n<td>要插入到集合中的文档或文档数组 (json 格式)</td>\n</tr>\n<tr>\n<td>writeConcern</td>\n<td>document</td>\n<td>Optional.A document expressing the write concern.Omit to use the default write <a href=\"http://concern.Do\">concern.Do</a> not explicitly set the write concern for the operation if run in a transaction. To use write concern with<br>transactions,see Transactions and write concern</td>\n</tr>\n<tr>\n<td>ordered</td>\n<td>boolean</td>\n<td>可选，一个布尔值，指定 Mongod 示例执行有序插入还是无序插入，默认为 true</td>\n</tr>\n</tbody>\n</table>\n<p>批量插入多条文章评论：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.insertMany<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"_id\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1\"</span>,<span class=\"token string\">\"articleid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"10001\"</span>,<span class=\"token string\">\"contet\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我他\"</span>,<span class=\"token string\">\"userid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1002\"</span>,<span class=\"token string\">\"nickname\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"相忘于江湖\"</span>,<span class=\"token string\">\"createdatatime\"</span>:new Date<span class=\"token punctuation\">(</span><span class=\"token string\">\"2019-08-05T22:08:15.522Z\"</span>,<span class=\"token string\">\"likenum\"</span>:NumberInt<span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>,<span class=\"token string\">\"state\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"_id\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"2\"</span>,<span class=\"token string\">\"articleid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"10001\"</span>,<span class=\"token string\">\"contet\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"我夏天空腹喝凉开水，冬天喝温开水\"</span>,<span class=\"token string\">\"userid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1005\"</span>,<span class=\"token string\">\"nickname\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"伊人憔悴\"</span>,<span class=\"token string\">\"createdatatime\"</span>:new Date<span class=\"token punctuation\">(</span><span class=\"token string\">\"2019-08-05T22:58:51.485Z\"</span>,<span class=\"token string\">\"likenum\"</span>:NumberInt<span class=\"token punctuation\">(</span><span class=\"token number\">888</span><span class=\"token punctuation\">)</span>,<span class=\"token string\">\"state\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"_id\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"3\"</span>,<span class=\"token string\">\"articleid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"10001\"</span>,<span class=\"token string\">\"contet\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"我一直喝凉开水，冬天夏天都喝\"</span>,<span class=\"token string\">\"userid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1004\"</span>,<span class=\"token string\">\"nickname\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"杰克船长\"</span>,<span class=\"token string\">\"createdatatime\"</span>:new Date<span class=\"token punctuation\">(</span><span class=\"token string\">\"2019-08-05T22:05:51.485Z\"</span>,<span class=\"token string\">\"likenum\"</span>:NumberInt<span class=\"token punctuation\">(</span><span class=\"token number\">888</span><span class=\"token punctuation\">)</span>,<span class=\"token string\">\"state\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>提示：</p>\n<p>插入时指定了_id，则主键就是该值</p>\n<p>如果某条数据插入失败，将会终止插入，但已经插入成功的数据不会回滚掉</p>\n<p>因为批量插入由于数据较多容易出现失败，因为，可以使用 try catch 进行异常捕获处理，测试的时候可以不处理，如 (了解)：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> try<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tdb.comment.insertMany<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"_id\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1\"</span>,<span class=\"token string\">\"articleid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"10001\"</span>,<span class=\"token string\">\"contet\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我他\"</span>,<span class=\"token string\">\"userid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1002\"</span>,<span class=\"token string\">\"nickname\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"相忘于江湖\"</span>,<span class=\"token string\">\"createdatatime\"</span>:new Date<span class=\"token punctuation\">(</span><span class=\"token string\">\"2019-08-05T22:08:15.522Z\"</span>,<span class=\"token string\">\"likenum\"</span>:NumberInt<span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>,<span class=\"token string\">\"state\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"_id\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"2\"</span>,<span class=\"token string\">\"articleid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"10001\"</span>,<span class=\"token string\">\"contet\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"我夏天空腹喝凉开水，冬天喝温开水\"</span>,<span class=\"token string\">\"userid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1005\"</span>,<span class=\"token string\">\"nickname\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"伊人憔悴\"</span>,<span class=\"token string\">\"createdatatime\"</span>:new Date<span class=\"token punctuation\">(</span><span class=\"token string\">\"2019-08-05T22:58:51.485Z\"</span>,<span class=\"token string\">\"likenum\"</span>:NumberInt<span class=\"token punctuation\">(</span><span class=\"token number\">888</span><span class=\"token punctuation\">)</span>,<span class=\"token string\">\"state\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"_id\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"3\"</span>,<span class=\"token string\">\"articleid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"10001\"</span>,<span class=\"token string\">\"contet\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"我一直喝凉开水，冬天夏天都喝\"</span>,<span class=\"token string\">\"userid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1004\"</span>,<span class=\"token string\">\"nickname\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"杰克船长\"</span>,<span class=\"token string\">\"createdatatime\"</span>:new Date<span class=\"token punctuation\">(</span><span class=\"token string\">\"2019-08-05T22:05:51.485Z\"</span>,<span class=\"token string\">\"likenum\"</span>:NumberInt<span class=\"token punctuation\">(</span><span class=\"token number\">888</span><span class=\"token punctuation\">)</span>,<span class=\"token string\">\"state\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span>catch<span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tprint<span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> try<span class=\"token punctuation\">&#123;</span>db.comment.insertMany<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"_id\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1\"</span>,<span class=\"token string\">\"articleid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"10001\"</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"_id\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"2\"</span>,<span class=\"token string\">\"articleid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"10001\"</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"_id\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"3\"</span>,<span class=\"token string\">\"articleid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"10001\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span>catch<span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>print<span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"acknowledged\"</span> <span class=\"token builtin class-name\">:</span> true, <span class=\"token string\">\"insertedIds\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"3\"</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><ul>\n<li>测试 - 嫌麻烦添加了比较少的数据</li>\n</ul>\n<h2 id=\"文档的基本查询\"><a class=\"markdownIt-Anchor\" href=\"#文档的基本查询\">#</a> 文档的基本查询</h2>\n<p>查询数据的语法格式如下：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.collection.find<span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>query<span class=\"token operator\">></span>,<span class=\"token punctuation\">[</span>projection<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>参数：</p>\n<table>\n<caption id=\"\" style=\"caption-side: bottom\">示例</caption>\n<thead>\n<tr>\n<th>Parameter</th>\n<th>Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>query</td>\n<td>document</td>\n<td>可选，使用查询运算符指定选择筛选器，若要返回集合中的所有文档，请省略此参数或传递空文档 ({})</td>\n</tr>\n<tr>\n<td>projection</td>\n<td>document</td>\n<td>可选，指定要在与查询筛选器匹配的文档中返回的字段 (投影)，诺要返回匹配文档中的所有字段，请省略此参数</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"1查询所有\"><a class=\"markdownIt-Anchor\" href=\"#1查询所有\">#</a> 1. 查询所有</h3>\n<p>如果我们要查询 spit 集合的所有文档，我们输入以下命令：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>或</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>这里你会发现每条文档会有一个叫_id 的字段，这个相当于我们原来关系型数据库中表的主键，当你在插入文档记录时没有 指定该字段，MongoDB 会自动创建，其类型是 ObjectID 类型</p>\n<p>如果我们在插入文档记录时指定该字段也可以，其类型可以是 ObjectID 类型，也可以是 MongoDB 支持的任意类型</p>\n<p>如果我想按一定条件来查询，比如我想查询 userid 为 1003 的记录，怎么办？很简单！只要在 find () 中添加参数即可，参数也是 json 格式，如下：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"articleid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"10001\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"3\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"articleid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"10001\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token number\">2</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span> <span class=\"token punctuation\">&#125;</span><span class=\"token number\">3</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span> <span class=\"token punctuation\">&#125;</span><span class=\"token number\">4</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"3\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span> <span class=\"token punctuation\">&#125;</span><span class=\"token operator\"><span class=\"token file-descriptor important\">5</span>></span>db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>userid:<span class=\"token string\">'1003'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>如果你只需要返回符合条件的第一条数据，我们可以使用 findOne 命令来实现，语法和 find 一样。</p>\n<p>如：查询用户编号是 1003 的记录，但只最多返回符合条件的第一条记录：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.findOne<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"articleid\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"10001\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>2. 投影查询 (Projection Query)</p>\n<p>如果要查询结果返回部分字段，则需要使用投影查询 (不显示所有字段，只显示指定的字段)</p>\n<p>如：查询结果只显示 <code>_id，aticleid，nickname</code></p>\n<pre><code>&gt; db.comment.find(&#123;aticleid:&quot;10001&quot;&#125;,&#123;aticleid:1,nickname:1&#125;)\n&#123; &quot;_id&quot; : &quot;1&quot;, &quot;aticleid&quot; : &quot;10001&quot;, &quot;nickname&quot; : &quot;Rose&quot; &#125;\n&gt;\n</code></pre>\n<p>默认 <code>_id</code>  会显示</p>\n<p>如：查询结果只显示，aticleid，nickname，不显示 <code>_id</code>  :</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>aticleid:<span class=\"token string\">\"10001\"</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span>aticleid:1,nickname:1,_id:0<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"aticleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"Rose\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>再例如：查询所有数据，但只显示_id，aticleid，nickname；</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span>aticleid:1,nickname:1<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"aticleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"Rose\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><h2 id=\"文档的更新\"><a class=\"markdownIt-Anchor\" href=\"#文档的更新\">#</a> 文档的更新</h2>\n<p>更新文档的语法：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>db.collection.update<span class=\"token punctuation\">(</span>query,update,options<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>或</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>db.collection.update<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token operator\">&lt;</span>query<span class=\"token operator\">></span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token operator\">&lt;</span>update<span class=\"token operator\">></span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\tupsert: <span class=\"token operator\">&lt;</span>boolean<span class=\"token operator\">></span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\tmulti: <span class=\"token operator\">&lt;</span>boolean<span class=\"token operator\">></span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\twriteConcern: <span class=\"token operator\">&lt;</span>document<span class=\"token operator\">></span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\tcollation: <span class=\"token operator\">&lt;</span>document<span class=\"token operator\">></span>,</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\tarrayFilters: <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span>filterdocument<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span>,<span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\thint: <span class=\"token operator\">&lt;</span>document<span class=\"token operator\">|</span>string<span class=\"token operator\">></span> //Available starting <span class=\"token keyword\">in</span> MongoDB <span class=\"token number\">4.2</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>参数：</p>\n<table>\n<thead>\n<tr>\n<th>Parameter</th>\n<th>Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>query</td>\n<td>document</td>\n<td>更新的选择条件，可以使用与 find () 方法中相同的查询选择器，类似 sql update 查询内 where 后面的，在 3.0 版中进行了更改：当使用 upsert:true 执行 update () 时，如果查询使用点表示法存在_id 字段上指定条件，则 MongoDB 将拒绝插入新文档</td>\n</tr>\n<tr>\n<td>update</td>\n<td>document or pipeline</td>\n<td>要应用的修改，该值可以是：包含更新运算符表达式的文档，或仅包含<field1>: <value>对的替换文档，或在 MongoDB4.2 中启动聚合管道，管道可以由以下阶段组成：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mi>d</mi><mi>d</mi><mi>F</mi><mi>I</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>s</mi><mtext>及其别名</mtext><mi mathvariant=\"normal\">‘</mi></mrow><annotation encoding=\"application/x-tex\">addFIelds及其别名`</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">s</span><span class=\"mord cjk_fallback\">及</span><span class=\"mord cjk_fallback\">其</span><span class=\"mord cjk_fallback\">别</span><span class=\"mord cjk_fallback\">名</span><span class=\"mord\">‘</span></span></span></span> <code>set</code> <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">‘</mi><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mtext>及其别名</mtext><mi mathvariant=\"normal\">‘</mi></mrow><annotation encoding=\"application/x-tex\">`project及其别名`</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\">‘</span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">t</span><span class=\"mord cjk_fallback\">及</span><span class=\"mord cjk_fallback\">其</span><span class=\"mord cjk_fallback\">别</span><span class=\"mord cjk_fallback\">名</span><span class=\"mord\">‘</span></span></span></span> <code>unset</code> <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">‘</mi><mi>r</mi><mi>e</mi><mi>p</mi><mi>l</mi><mi>a</mi><mi>c</mi><mi>e</mi><mi>r</mi><mi>o</mi><mi>o</mi><mi>t</mi><mtext>及其别名</mtext><mi mathvariant=\"normal\">‘</mi></mrow><annotation encoding=\"application/x-tex\">`replaceroot及其别名`</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\">‘</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">t</span><span class=\"mord cjk_fallback\">及</span><span class=\"mord cjk_fallback\">其</span><span class=\"mord cjk_fallback\">别</span><span class=\"mord cjk_fallback\">名</span><span class=\"mord\">‘</span></span></span></span> <code>replaceWith，换句话说：它是update的对象和一些更新的操作符(如</code> <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">‘</mi><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">‘</mi></mrow><annotation encoding=\"application/x-tex\">`,`</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\">‘</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">‘</span></span></span></span>`inc…) 等，也可以理解为 sql update 查询内 set 后面的值</td>\n</tr>\n<tr>\n<td>upsert</td>\n<td>boolean</td>\n<td>可选，如果设置为 true，则在没有与查询条件匹配的文档时创建新文档，默认值为 false，如果找不到匹配项，则不会插入新文档</td>\n</tr>\n<tr>\n<td>multi</td>\n<td>boolean</td>\n<td>可选，如果设置为 true，则更新符合查询条件的多个文档，如果设置为 false，则更新一个文档，默认值为 fasle</td>\n</tr>\n<tr>\n<td>writeConcern</td>\n<td>document</td>\n<td>可选，表示写问题的文档，抛出异常的级别</td>\n</tr>\n<tr>\n<td>collation</td>\n<td>document</td>\n<td>可选<br>指定要用于操作的校对规则<br>校对规则允许用户为字符串比较指定特定与语言的规则，例如字母大小写和重音标记的规则<br>校对规则选项具有以下语句：<br>校对规则：{<br>区域设置:<string>,<br>caseLevel:<boolean>,<br>caseFirst:<string>,<br>强度:<int>,<br>numericordering:<boolean>,<br>替代:<string>,<br>最大变量:<string>,<br>向后:<boolean><br>}<br>指定校对规则时，区域设置字段是必须得，所有其它校对规则字段都是可选的，有关字段的说明，请参阅校对规则文档<br>如果未指定校对规则，但集合具有默认校对规则 (请参见 db.createCollection ())，则该操作将使用为集合指定的校对规则。<br>如果没有为集合或操作指定校对规则，MongoDB 将使用以前的版本中使用的简单二进制比较进行字符串比较，不能为一个操作指定多个校对规则，例如，不能为每个字段指定不同的校对规则，或者如果使用排序执行查找，则不能将一个校对规则用于查找，另一个校对规则用于排序<br>3.4 版新增</td>\n</tr>\n<tr>\n<td>arrayFilters</td>\n<td>array</td>\n<td>可选，一个筛选文档数组，用于确定要为数组字段上的更新操作修改那些数组元素，在更新文档中，使用 [ <code>$</code> <a href=\"\"></a>{}] 筛选的位置运算符来定义标识符，然后咋子数组过滤器文档中应用，如果标识符未包含在更新文档中，则不能有标识符的数组筛选器文档，注意，<identifier>必须以小写字母开头，并且只包含字母数字字符，您可以在更新文档中多次包含同一标识符：但是，对于 r 在更新文档中，每个不同的标识符 ( <code>$</code> [标识符]) 都必须指定一个对应的数组筛选器文档，也就是说，不能为同一个标识符指定多个数组筛选器文档，3.6 版 +</td>\n</tr>\n<tr>\n<td>hint</td>\n<td>Document or string</td>\n<td>可选，指定用于支持查询谓词的索引的文档或字符串，该选项可以采用索引规范文档或索引名称字符串，如果指定的索引不存在，则说明操作错误，例如：版本 4 中的 未更新操作指定提示</td>\n</tr>\n</tbody>\n</table>\n<p>提示：</p>\n<p>主要关注前四个参数即可</p>\n<p>[示例]</p>\n<h3 id=\"1覆盖的修改\"><a class=\"markdownIt-Anchor\" href=\"#1覆盖的修改\">#</a> 1. 覆盖的修改</h3>\n<p>如果我们想修改_id 为 1 的记录，点赞量为 1001，输入以下语句</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.update<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>_id:<span class=\"token string\">\"1\"</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span>likenum:NumberInt<span class=\"token punctuation\">(</span><span class=\"token number\">1001</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.update<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>_id:1<span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span>likenum:NumberInt<span class=\"token punctuation\">(</span><span class=\"token number\">1001</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>WriteResult<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nMatched\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>, <span class=\"token string\">\"nUpserted\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>, <span class=\"token string\">\"nModified\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#注意这里的_id 为 1 的我不小心设置为了数据型的，而_id 为 2 设置为字符串型更改时也要对应数据类型才能找得到</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1001</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">889</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>执行后，我们会发现，这条文档除了 likenum 字段其它字段都不见了</p>\n<h3 id=\"2局部修改\"><a class=\"markdownIt-Anchor\" href=\"#2局部修改\">#</a> 2. 局部修改</h3>\n<p>为了解决这个问题，我们需要使用修改器 <code>$</code> set 来实现，命令如下：</p>\n<p>我们想修改_id 为 2 的记录，浏览量为 889，输入以下语句：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.update<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>_id:2<span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$set</span>:<span class=\"token punctuation\">&#123;</span>likenum:NumberInt<span class=\"token punctuation\">(</span><span class=\"token number\">889</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.update<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>_id:<span class=\"token string\">\"2\"</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$set</span>:<span class=\"token punctuation\">&#123;</span>likenum:NumberInt<span class=\"token punctuation\">(</span><span class=\"token number\">889</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>WriteResult<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nMatched\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>, <span class=\"token string\">\"nUpserted\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>, <span class=\"token string\">\"nModified\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span> db.comment.<span class=\"token function-name function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"刘桑\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">889</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"小花\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>这样就 OK 了</p>\n<h3 id=\"3批量的修改\"><a class=\"markdownIt-Anchor\" href=\"#3批量的修改\">#</a> 3. 批量的修改</h3>\n<p>更新所有用户为 1003 的用户的昵称为 凯撒大帝</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#默认只修改第一条数据</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">></span> db.comment.update<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>userid:<span class=\"token string\">\"1003\"</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$set</span>:<span class=\"token punctuation\">&#123;</span>nickname:<span class=\"token string\">\"凯撒2\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#修改所有符合条件的数据</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span> db.comment.update<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>userid:<span class=\"token string\">\"1003\"</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$set</span>:<span class=\"token punctuation\">&#123;</span>nickname:<span class=\"token string\">\"凯撒大帝\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span>multi:true<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.update<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>userid:<span class=\"token string\">\"1003\"</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$set</span>:<span class=\"token punctuation\">&#123;</span>nickname:<span class=\"token string\">\"凯撒大帝\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span>multi:true<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>WriteResult<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nMatched\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>, <span class=\"token string\">\"nUpserted\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>, <span class=\"token string\">\"nModified\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span> db.comment.<span class=\"token function-name function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">889</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>提示：</p>\n<p>如果不加后面的参数，则只更新符合条件的第一条记录</p>\n<h3 id=\"3列值增长的修改\"><a class=\"markdownIt-Anchor\" href=\"#3列值增长的修改\">#</a> 3. 列值增长的修改</h3>\n<p>如果我们想实现对某列值在原有值的基础上进行增加或减少，可以使用 <code>$</code> inc 运算符来实现。</p>\n<p>需求：对 3 号数据的点赞数，每次递增 1</p>\n<pre><code>&gt; db.comment.update(&#123;_id:1&#125;,&#123;$inc:&#123;likenum:NumberInt(1)&#125;&#125;)\n</code></pre>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.update<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>_id:1<span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$inc</span>:<span class=\"token punctuation\">&#123;</span>likenum:NumberInt<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>WriteResult<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nMatched\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>, <span class=\"token string\">\"nUpserted\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>, <span class=\"token string\">\"nModified\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span> db.comment.<span class=\"token function-name function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1002</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">889</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.update<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>userid:<span class=\"token string\">\"1003\"</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$inc</span>:<span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"likenum\"</span>:NumberInt<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span>multi:true<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>WriteResult<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nMatched\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>, <span class=\"token string\">\"nUpserted\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>, <span class=\"token string\">\"nModified\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span> db.comment.<span class=\"token function-name function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1003</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10002\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">890</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><h2 id=\"删除文档\"><a class=\"markdownIt-Anchor\" href=\"#删除文档\">#</a> 删除文档</h2>\n<p>删除文档的语法结构：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.集合名称.remove<span class=\"token punctuation\">(</span>条件<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>以下语句可以将数据全部删除，请慎用</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.remove<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>如果删除_id=1 的记录，输入以下语句，删除条件有多个会删除多个</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.remove<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>_id:<span class=\"token string\">\"1\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.<span class=\"token function-name function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1003</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10002\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">890</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span> db.comment.remove<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>_id:<span class=\"token string\">\"1\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>WriteResult<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nRemoved\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">></span> db.comment.<span class=\"token function-name function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10002\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">890</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.<span class=\"token function-name function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10002\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">890</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1003</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span> db.comment.remove<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>userid:<span class=\"token string\">\"1003\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>WriteResult<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nRemoved\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><h2 id=\"文档的分页查询\"><a class=\"markdownIt-Anchor\" href=\"#文档的分页查询\">#</a> 文档的分页查询</h2>\n<h3 id=\"统计查询\"><a class=\"markdownIt-Anchor\" href=\"#统计查询\">#</a> 统计查询</h3>\n<p>统计查询使用 count () 方法，语法如下：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.collection.count<span class=\"token punctuation\">(</span>query,options<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>参数：</p>\n<table>\n<caption id=\"\" style=\"caption-side: bottom\">示例</caption>\n<thead>\n<tr>\n<th>Parameter</th>\n<th>Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>query</td>\n<td>document</td>\n<td>查询选择条件</td>\n</tr>\n<tr>\n<td>options</td>\n<td>document</td>\n<td>可选，用于修改统计数的额外选项</td>\n</tr>\n</tbody>\n</table>\n<p>1. 统计所有记录数：</p>\n<p>统计 comment 集合的所有的记录数：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.count<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>2. 按条件统计记录：</p>\n<p>例如：统计 userid 为 1003 的记录条数</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.count<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>userid:<span class=\"token string\">\"1003\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span> db.comment.count<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>_id:<span class=\"token string\">\"1\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">></span> db.comment.count<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>_id:<span class=\"token string\">\"2\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>提示：</p>\n<p>默认情况下 count () 方法返回符合条件的全部记录条数</p>\n<h3 id=\"分页列表查询\"><a class=\"markdownIt-Anchor\" href=\"#分页列表查询\">#</a> 分页列表查询</h3>\n<p>可以使用 limit () 方法来读取指定数量的数据，使用 skip () 方法来跳过指定数量的数据</p>\n<p>基本语法格式如下：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.COLLECTION_NAME.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>.limit<span class=\"token punctuation\">(</span>NUMBER<span class=\"token punctuation\">)</span>.skip<span class=\"token punctuation\">(</span>NUMBER<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>.limit<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>.skip<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10002\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">890</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>.limit<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>.skip<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>.limit<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>.skip<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1003</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10002\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">890</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>.limit<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>.skip<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1003</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>如果你想返回指定条数的记录，可以在 find 方法后调用 limit 来返回结果 (TopN)，默认值 20，例如：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>.limit<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>.limit<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1003</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10002\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">890</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>skip 方法同样接受一个数字参数作为跳过的记录条数，(前 N 个不要)，默认值是 0</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>.skip<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>.skip<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>.skip<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10002\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">890</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>分页查询：需求：每页 2 个，第二页开始：跳过前两条数据，接着值显示 3 和 4 条数据</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#第一页</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>.skip<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>.limit<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#第二页</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>.skip<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>.limit<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#第三页</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>.skip<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>.limit<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h2 id=\"排序查询\"><a class=\"markdownIt-Anchor\" href=\"#排序查询\">#</a> 排序查询</h2>\n<p>sort () 方法对数据进行排序，sort () 方法可以通过参数指定排序的字段，并使用 1 和 - 1 来指定排序方式，其中 1 为升序排列，而 - 1 是用于降序排列</p>\n<p>语法如下所示：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment_name.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>.sort<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>KEY:1<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>或</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span> db.集合名称.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>.sort<span class=\"token punctuation\">(</span>排序方式<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>例如：</p>\n<p>对 userid 降序排列，并对访问量进行升序排列</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>.sort<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>userid:1,likenum:1<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>.sort<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>userid:-1,likenum:1<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10002\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">890</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1003</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>提示：</p>\n<p>skip ()，limit ()，sort () 三个放在一起执行的时候，执行的顺序是先 sort () 然后是 skip () 最后是显示的 limit () 和命令编写顺序无关</p>\n<p>sort &gt; skip &gt; limit</p>\n<h2 id=\"文档的更多查询\"><a class=\"markdownIt-Anchor\" href=\"#文档的更多查询\">#</a> 文档的更多查询</h2>\n<h3 id=\"正则的复杂条件查询\"><a class=\"markdownIt-Anchor\" href=\"#正则的复杂条件查询\">#</a> 正则的复杂条件查询</h3>\n<p>MongoDB 的模糊查询是通过正则表达式的方式实现的，格式为：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.collection.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>field:/正则表达式/<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>或</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span> db.集合名称.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>字段:/正则表达式/<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>提示：正则表达式是 js 的语法，直接量的写法</p>\n<p>例如：我要查询评论内容包含 &quot;开水&quot; 的所有文档，代码如下：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>content:/开水/<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.<span class=\"token function-name function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1003</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"开水\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10002\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">890</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"专家表明\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"3\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10003\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">100</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"123\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"开水\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>content:/开水/<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1003</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"开水\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"3\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10003\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">100</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"123\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"开水\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>如果要查询评论的内容中以 &quot;专家&quot; 开头的，代码如下：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>content:/^专家/<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>content:/^专家/<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10002\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">890</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"专家表明\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><h2 id=\"比较查询\"><a class=\"markdownIt-Anchor\" href=\"#比较查询\">#</a> 比较查询</h2>\n<p>&lt;，&lt;=，&gt;，&gt;= 这个操作符也是很常用的，格式如下：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#大于：field > vlaue</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">></span> db.集合名称.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"field\"</span>:<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$gt</span>:value<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#小于：field &lt; value</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span> db.集合名称.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"field\"</span>:<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$lt</span>:value<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#大于等于：field >= value</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">></span> db.集合名称.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"field\"</span>:<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$gte</span>:value<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#小于等于：field &lt;= value</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">></span> db.集合名称.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"field\"</span>:<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$lte</span>:value<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#不等于：field != value</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token operator\">></span> db.集合名称.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"field\"</span>:<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$ne</span>:value<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>示例：查询评论带你赞数量大于 700 的记录</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>likenum:<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$gt</span>:NumberInt<span class=\"token punctuation\">(</span><span class=\"token number\">700</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>likenum:<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$gt</span>:NumberInt<span class=\"token punctuation\">(</span><span class=\"token number\">700</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1003</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"开水\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10002\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">890</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"专家表明\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><h2 id=\"包含查询\"><a class=\"markdownIt-Anchor\" href=\"#包含查询\">#</a> 包含查询</h2>\n<p>包含使用 $in 操作符</p>\n<p>示例：查询评论的集合中 userid 字段包含 1003 和 1004 的文档</p>\n<pre><code class=\"language-shll\">&gt; db.comment.find(&#123;userid:&#123;$in:[&quot;1003&quot;,&quot;1004&quot;]&#125;&#125;)\n</code></pre>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>userid:<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$in</span>:<span class=\"token punctuation\">[</span><span class=\"token string\">\"1003\"</span>,<span class=\"token string\">\"1004\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1003</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"开水\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10002\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">890</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"专家表明\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"3\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10003\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">100</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"开水\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><h2 id=\"条件连接查询\"><a class=\"markdownIt-Anchor\" href=\"#条件连接查询\">#</a> 条件连接查询</h2>\n<p>我们如果需要查询同时满足两个以上条件，需要使用 $and 操作符将条件进行关联 (相当于 SQL 的 and)</p>\n<p>格式为：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$and</span>:<span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>示例：查询评论集合中 likenum 大于等于 700 并且小于 2000 的文档</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$and</span>:<span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span>lienum:<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$gte</span>:NumberInt<span class=\"token punctuation\">(</span><span class=\"token number\">700</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span>likenum:<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$lt</span>:NumberInt<span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$and</span>:<span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span>likenum:<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$gte</span>:NumberInt<span class=\"token punctuation\">(</span><span class=\"token number\">700</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span>likenum:<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$lt</span>:NumberInt<span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1003</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"开水\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10002\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">890</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"专家表明\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>如果两个以上条件之间是或者的关系，我们使用操作符进行关联，与前面 and 的使用方式相同</p>\n<p>格式为：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$or</span>:<span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>示例：查询评论集合中 userid 为 1003，或者点赞数小于 1000 的文档记录</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$or</span>:<span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span>userid:<span class=\"token string\">\"1003\"</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span>likenum:<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$lt</span>:1000<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$or</span>:<span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span>userid:<span class=\"token string\">\"1003\"</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span>likenum:<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$lt</span>:1000<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1003</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"开水\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10002\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">890</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"专家表明\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"3\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10003\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">100</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"开水\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$and</span>:<span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span>userid:<span class=\"token string\">\"1003\"</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span>likenum:<span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$lt</span>:1000<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10002\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">890</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒大帝\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"专家表明\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"3\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10003\"</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">100</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"开水\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><h2 id=\"常用命令小结\"><a class=\"markdownIt-Anchor\" href=\"#常用命令小结\">#</a> 常用命令小结</h2>\n<p>选择切换数据库：use articledb</p>\n<p>插入数据：db.comment.insert ({bson 数据})</p>\n<p>查询所有数据：db.comment.find ()</p>\n<p>条件查询数据：db.cmoment.find ({条件})</p>\n<p>查询符合条件的第一条记录：db.comment.findOne ({条件})</p>\n<p>查询符合条件的前几条记录：db.comment.find ({条件}).limit (条数)</p>\n<p>查询符合条件的跳过的记录：db.comment.find ({条件}).skip (条数)</p>\n<p>修改数据：db.comment.update ({条件},{修改后的数据}) 或 db.comment.update ({条件},{$set:{要修改部分的字段：数据}})</p>\n<p>修改数据并自增某字段值：db.comment.update ({条件},{$inc:{自增的字段：步进值}})</p>\n<p>删除数据：db.comment.remove ({条件})</p>\n<p>统计查询：db.comment.count ({条件})</p>\n<p>模糊查询：db.comment.find ({字段名:/ 正则表达式 /})</p>\n<p>条件比较运算：db.comment.find ({字段名:{$gt: 值}})</p>\n<p>包含查询：db.comment.find ({字段名:{ <code>$</code> in:[值 1, 值 2]}}) 或 db.comment.find ({字段名:{ <code>$</code> nin:[值 1, 值 2]}})</p>\n<p>条件连接查询：db.comment.find ({ <code>$</code> and:[{条件 1},{条件 2}]}) 或 db.comment.find ({ <code>$</code> or:[{条件 1},{条件 2}])</p>\n<h2 id=\"索引的类型\"><a class=\"markdownIt-Anchor\" href=\"#索引的类型\">#</a> 索引的类型</h2>\n<h3 id=\"单字段索引\"><a class=\"markdownIt-Anchor\" href=\"#单字段索引\">#</a> 单字段索引</h3>\n<p>MongoDB 支持在文档的单个字段上创建用户定义的升序 / 降序索引，称为单字段索引 (Single Field Index)</p>\n<p>对于单个字段索引的排序操作，索引键的排序顺序 (即升序或降序) 并不重要，因为 MongoDB 可以在任何方向上遍历索引</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031702130.png\" alt=\"image-20230604161713948\"></p>\n<h3 id=\"其它索引\"><a class=\"markdownIt-Anchor\" href=\"#其它索引\">#</a> 其它索引</h3>\n<p>地理空间索引 (Geospatial Index)，文本索引 (Text Indexes)，哈希索引 (Hashed Indexes)</p>\n<h4 id=\"地理空间索引geospatial-index\"><a class=\"markdownIt-Anchor\" href=\"#地理空间索引geospatial-index\">#</a> 地理空间索引 (Geospatial Index)</h4>\n<p>为了支持对地理空间坐标数据的有效查询，MongoDB 提供了两种特殊的索引：返回结果是使用平面几何的二维索引和返回结果时使用球面几何的二维球面索引</p>\n<h4 id=\"文本索引text-indexes\"><a class=\"markdownIt-Anchor\" href=\"#文本索引text-indexes\">#</a> 文本索引 (Text Indexes)</h4>\n<p>MongoDB 提供了一种文本索引类型，支持在集合中搜索字符串内容，这些文本索引不存储特定于语言的停止词 (例如：“the”，“a”，“or”)，而将集合中的此作为词干，只存储跟词。</p>\n<h4 id=\"哈希索引hashed-indexes\"><a class=\"markdownIt-Anchor\" href=\"#哈希索引hashed-indexes\">#</a> 哈希索引 (Hashed Indexes)</h4>\n<p>为了支持基于散列的分片，MongoDB 提供了散列索引类型，它对字段值的散列进行索引，这些索引在其范围内的值分布更加随机，但只支持相等匹配，不支持基于范围的查询</p>\n<h3 id=\"索引的管理操作\"><a class=\"markdownIt-Anchor\" href=\"#索引的管理操作\">#</a> 索引的管理操作</h3>\n<h4 id=\"索引的查看\"><a class=\"markdownIt-Anchor\" href=\"#索引的查看\">#</a> 索引的查看</h4>\n<p>说明：</p>\n<p>返回一个集合中的所有索引的数组。</p>\n<p>语法：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.collection.getIndexes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>提示：该语法命令运行要求是 MongoDB 3.0+</p>\n<p>[示例]</p>\n<p>查看 comment 集合中所有的索引情况</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.getIndexes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.getIndexes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"v\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>, <span class=\"token string\">\"key\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span>, <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"_id_\"</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>结果中显示的是默认_id 索引</p>\n<p>默认_id 索引：</p>\n<p>MongoDB 在创建集合的过程中，在_id 字段上创建一个唯一的索引，默认名字为 <code>_id_</code> ，该索引可防止客户端插入两个具有相同值的文档，您不能在 <code>_id</code>  字段上删除此索引</p>\n<p>注意：该索引是唯一索引，因此值不能重复，即_id 值不能重复的，在分片集群中，通常使用 <code>_id</code>  作为片键</p>\n<h3 id=\"索引的创建\"><a class=\"markdownIt-Anchor\" href=\"#索引的创建\">#</a> 索引的创建</h3>\n<p>说明：</p>\n<p>在集合上创建索引</p>\n<p>语法：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.collection.createIndex<span class=\"token punctuation\">(</span>keys.options<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>参数：</p>\n<table>\n<thead>\n<tr>\n<th>Parameter</th>\n<th>Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>keys</td>\n<td>document</td>\n<td>包含字段和值对的文档，其中字段是索引键，值描述该字段的索引类型，对于字段上的升序索引，请指定值 1；对于降序索引，请指定值 - 1；比如：{字段：1 或 - 1}，其中 1 为指定按升序创建索引，如果你想按降序创建索引指定为 - 1 即可。另外 MongoDB 支持几种不同的索引类型，包括文本，地理空间和哈希索引</td>\n</tr>\n<tr>\n<td>options</td>\n<td>document</td>\n<td>可选，包含一组控制索引创建的选项的文档，有关详细信息，请参见选项详情列表</td>\n</tr>\n</tbody>\n</table>\n<p>options (更多选项) 列表：</p>\n<table>\n<thead>\n<tr>\n<th>Parameter</th>\n<th>Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>background</td>\n<td>Boolean</td>\n<td>键索引过程会阻塞其它数据库操作，background 可指定以后台方式创建索引，即增加 &quot;background&quot; 可选参数，&quot;background&quot; 默认值为 false</td>\n</tr>\n<tr>\n<td>unique</td>\n<td>Boolean</td>\n<td>建立的索引是否唯一，指定为 true 创建唯一索引，默认值为 false</td>\n</tr>\n<tr>\n<td>name</td>\n<td>string</td>\n<td>索引的名称，如果未指定，MongoDB 的通过连接索引的字段名和排序生成一个索引名称</td>\n</tr>\n<tr>\n<td>dropDups</td>\n<td>Boolean</td>\n<td>3.0 + 版本已经废弃，在建立唯一索引时是否删除重复记录，指定 true 创建唯一索引，默认值为 false</td>\n</tr>\n<tr>\n<td>sparse</td>\n<td>Boolean</td>\n<td>对文档中不存在的字段数据不启用索引；这个参数需要特别注意，如果设置为 true 的话，在索引字段中不会查询出不包含对应字段的文档，默认值为 false</td>\n</tr>\n<tr>\n<td>expireAfterSeconds</td>\n<td>integer</td>\n<td>指定一个以秒为单位的数值，完成 TTL 设定，设定集合的生存时间</td>\n</tr>\n<tr>\n<td>v</td>\n<td>index<br>version</td>\n<td>索引的版本号，默认的索引版本取决于 mongod 创建索引时运行的版本</td>\n</tr>\n<tr>\n<td>weights</td>\n<td>document</td>\n<td>索引权重值，数值在 1 到 99.999 之间，表示该索引相对于其它索引字段得分权重</td>\n</tr>\n<tr>\n<td>default_language</td>\n<td>string</td>\n<td>对于文本索引，该参数决定了停用词及词干和词器的规则的列表，默认为英语</td>\n</tr>\n</tbody>\n</table>\n<p>提示：</p>\n<p>注意在 3.0.0 版本前创建索引方法为： <code>db.collection.ensureIndex()</code> ，之后的版本使用了 <code>db.collection.createIndex()</code>  方法， <code>ensureIndex()</code>  还能用，但只是 <code>createIndex()</code>  的别名</p>\n<p>[示例]</p>\n<p>1. 单字段索引示例：对 <code>userid</code>  字段建立索引</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.createIndex<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>userid:1<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.createIndex<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>userid:1<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string\">\"numIndexesBefore\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"numIndexesAfter\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token string\">\"createdCollectionAutomatically\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>参数 1：按升序创建索引</p>\n<p>可以查看一下：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.getIndexes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                <span class=\"token string\">\"v\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token string\">\"key\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"_id_\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token string\">\"v\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token string\">\"key\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                        <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"userid_1\"</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>索引名字为： <code>userid_1</code></p>\n<p>compass 查看：</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031702245.png\" alt=\"image-20230604171621927\"></p>\n<p>复合索引：对 <code>userid</code>  和 <code>nickname</code>  同时建立复合 (Compound) 索引：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.createIndex<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>userid:1,nickname:-1<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.createIndex<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>userid:1,nickname:-1<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string\">\"numIndexesBefore\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"numIndexesAfter\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">3</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token string\">\"createdCollectionAutomatically\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>查看一下索引：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.getIndexes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                <span class=\"token string\">\"v\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token string\">\"key\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"_id_\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token string\">\"v\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token string\">\"key\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                        <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"userid_1\"</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token string\">\"v\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token string\">\"key\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                        <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                        <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"userid_1_nickname_-1\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><h3 id=\"索引的移除\"><a class=\"markdownIt-Anchor\" href=\"#索引的移除\">#</a> 索引的移除</h3>\n<p>说明：可以移除指定的索引，或移除所有索引</p>\n<h4 id=\"一指定索引的移除\"><a class=\"markdownIt-Anchor\" href=\"#一指定索引的移除\">#</a> 一，指定索引的移除</h4>\n<p>语法：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.collection.dropIndex<span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>参数：</p>\n<table>\n<caption id=\"\" style=\"caption-side: bottom\">示例</caption>\n<thead>\n<tr>\n<th>Parameter</th>\n<th>Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>index</td>\n<td>string or document</td>\n<td>指定要删除的索引，可以通过索引名称或索引规范文档指定索引，诺要删除文本索引，请指定索引名称</td>\n</tr>\n</tbody>\n</table>\n<p>删除 <code>comment</code>  集合中 <code>userid</code>  字段上的升序索引：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.dropIndex<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>userid:1<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>查看已经删除了</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.getIndexes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                <span class=\"token string\">\"v\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token string\">\"key\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"_id_\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token string\">\"v\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token string\">\"key\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                        <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"userid_1\"</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token string\">\"v\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token string\">\"key\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                        <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                        <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"userid_1_nickname_-1\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token operator\">></span> db.comment.dropIndex<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>userid:1<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"nIndexesWas\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">3</span>, <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token operator\">></span> db.comment.getIndexes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token string\">\"v\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token string\">\"key\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"_id_\"</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token string\">\"v\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token string\">\"key\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                        <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                        <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"userid_1_nickname_-1\"</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><h4 id=\"二所有索引的移除\"><a class=\"markdownIt-Anchor\" href=\"#二所有索引的移除\">#</a> 二，所有索引的移除</h4>\n<p>语法：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.collection.dropIndexes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>[示例]</p>\n<p>删除 skip 集合中所有索引</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.<span class=\"token function-name function\">dropIndexes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string\">\"nIndexesWas\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"msg\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"non-_id indexes dropped for collection\"</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>提示： <code>_id</code>  的字段的索引是无法删除的，只能删除非 <code>_id</code>  字段的索引</p>\n<p>查看索引：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.getIndexes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"v\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>, <span class=\"token string\">\"key\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span>, <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"_id_\"</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><h3 id=\"索引的使用\"><a class=\"markdownIt-Anchor\" href=\"#索引的使用\">#</a> 索引的使用</h3>\n<h4 id=\"执行计划\"><a class=\"markdownIt-Anchor\" href=\"#执行计划\">#</a> 执行计划</h4>\n<p>分析查询性能 (Analyze Query Performance) 通常使用执行计划，(解释计划，Explin Plan) 来查看查询的情况，如查询耗费的时间，是否基于索引查询等</p>\n<p>那么，通常，我们想知道，建立的索引是否有效，效果如何，都需要通过执行计划查看</p>\n<p>语法：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.collection.find<span class=\"token punctuation\">(</span>query,options<span class=\"token punctuation\">)</span>.explain<span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>[示例]</p>\n<p>查看根据 userid 查询数据的情况：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>userid:<span class=\"token string\">\"1003\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>.<span class=\"token function-name function\">explain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string\">\"explainVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"queryPlanner\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token string\">\"namespace\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"articledb.comment\"</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token string\">\"indexFilterSet\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token string\">\"parsedQuery\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                        <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                                <span class=\"token string\">\"<span class=\"token variable\">$eq</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token string\">\"queryHash\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"37A12FC3\"</span>,</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token string\">\"planCacheKey\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"4A7D843D\"</span>,</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token string\">\"maxIndexedOrSolutionsReached\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token string\">\"maxIndexedAndSolutionsReached\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token string\">\"maxScansToExplodeReached\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token string\">\"winningPlan\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                        <span class=\"token string\">\"stage\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"COLLSCAN\"</span>,</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                        <span class=\"token string\">\"filter\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                                <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                                        <span class=\"token string\">\"<span class=\"token variable\">$eq</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                        <span class=\"token string\">\"direction\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"forward\"</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token string\">\"rejectedPlans\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token string\">\"command\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                <span class=\"token string\">\"find\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"comment\"</span>,</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token string\">\"filter\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                        <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token string\">\"<span class=\"token variable\">$db</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"articledb\"</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token string\">\"serverInfo\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"localhost.localdomain\"</span>,</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token string\">\"port\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">27017</span>,</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token string\">\"version\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"5.0.18\"</span>,</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token string\">\"gitVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"796abe56bfdbca6968ff570311bf72d93632825b\"</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token string\">\"serverParameters\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                <span class=\"token string\">\"internalQueryFacetBufferSizeBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span>,</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                <span class=\"token string\">\"internalQueryFacetMaxOutputDocSizeBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span>,</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token string\">\"internalLookupStageIntermediateDocumentMaxSizeBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span>,</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                <span class=\"token string\">\"internalDocumentSourceGroupMaxMemoryBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span>,</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                <span class=\"token string\">\"internalQueryMaxBlockingSortMemoryUsageBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span>,</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                <span class=\"token string\">\"internalQueryProhibitBlockingMergeOnMongoS\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                <span class=\"token string\">\"internalQueryMaxAddToSetBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span>,</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token string\">\"internalDocumentSourceSetWindowFieldsMaxMemoryBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>查看出来的结果是文档的扫描是 5 条记录，数据是 5 条，扫描也是 5 条就代表全文档扫描</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031702609.png\" alt=\"image-20230604214503129\"></p>\n<p>想用上索引就需要给数据 加上索引</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.createIndex<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>userid:1<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string\">\"numIndexesBefore\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"numIndexesAfter\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token string\">\"createdCollectionAutomatically\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>userid:<span class=\"token string\">\"1003\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>.<span class=\"token function-name function\">explain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string\">\"explainVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"queryPlanner\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token string\">\"namespace\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"articledb.comment\"</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token string\">\"indexFilterSet\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token string\">\"parsedQuery\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                        <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                                <span class=\"token string\">\"<span class=\"token variable\">$eq</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token string\">\"queryHash\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"37A12FC3\"</span>,</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token string\">\"planCacheKey\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"3B74CBDE\"</span>,</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token string\">\"maxIndexedOrSolutionsReached\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token string\">\"maxIndexedAndSolutionsReached\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token string\">\"maxScansToExplodeReached\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token string\">\"winningPlan\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                        <span class=\"token string\">\"stage\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"FETCH\"</span>,</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                        <span class=\"token string\">\"inputStage\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                                <span class=\"token string\">\"stage\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"IXSCAN\"</span>,</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                                <span class=\"token string\">\"keyPattern\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                                        <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                                <span class=\"token string\">\"indexName\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"userid_1\"</span>,</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                                <span class=\"token string\">\"isMultiKey\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                                <span class=\"token string\">\"multiKeyPaths\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                                        <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                                <span class=\"token string\">\"isUnique\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                                <span class=\"token string\">\"isSparse\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                                <span class=\"token string\">\"isPartial\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                                <span class=\"token string\">\"indexVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                                <span class=\"token string\">\"direction\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"forward\"</span>,</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                                <span class=\"token string\">\"indexBounds\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                                        <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                                                <span class=\"token string\">\"[<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>1003<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>, <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>1003<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>]\"</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                                        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                <span class=\"token string\">\"rejectedPlans\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token string\">\"command\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token string\">\"find\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"comment\"</span>,</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                <span class=\"token string\">\"filter\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                        <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                <span class=\"token string\">\"<span class=\"token variable\">$db</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"articledb\"</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token string\">\"serverInfo\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"localhost.localdomain\"</span>,</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token string\">\"port\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">27017</span>,</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token string\">\"version\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"5.0.18\"</span>,</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token string\">\"gitVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"796abe56bfdbca6968ff570311bf72d93632825b\"</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token string\">\"serverParameters\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                <span class=\"token string\">\"internalQueryFacetBufferSizeBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span>,</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                <span class=\"token string\">\"internalQueryFacetMaxOutputDocSizeBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span>,</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                <span class=\"token string\">\"internalLookupStageIntermediateDocumentMaxSizeBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span>,</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                <span class=\"token string\">\"internalDocumentSourceGroupMaxMemoryBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span>,</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                <span class=\"token string\">\"internalQueryMaxBlockingSortMemoryUsageBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span>,</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                <span class=\"token string\">\"internalQueryProhibitBlockingMergeOnMongoS\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                <span class=\"token string\">\"internalQueryMaxAddToSetBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span>,</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                <span class=\"token string\">\"internalDocumentSourceSetWindowFieldsMaxMemoryBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>此时的 &quot;stage&quot; : &quot;FETCH&quot; 就变成了 FETCH</p>\n<p>此时文档的扫描就是 2 条数据了</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031703658.png\" alt=\"image-20230604215307694\"></p>\n<p>它是先通过 IXSCAN 查询索引里面的集合，索引也是一个小集合</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031703416.png\" alt=\"image-20230604215400607\"></p>\n<p>再通过抓取，去抓取指定查回来的 2 条数据</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031703567.png\" alt=\"image-20230604215440187\"></p>\n<h2 id=\"涵盖的查询\"><a class=\"markdownIt-Anchor\" href=\"#涵盖的查询\">#</a> 涵盖的查询</h2>\n<p>Convered Queries</p>\n<p>当查询条件和查询的投影仅包含索引字段时，MongoDB 直接从索引返回结果，而不扫描任何文档或将文档带入内存，这些覆盖的查询可以非常有效</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031703796.png\" alt=\"image-20230604220253854\"></p>\n<p>如果查询的数据在索引中已经有了就不会再去文档中去找了，而是直接从索引中 取</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031703030.png\" alt=\"image-20230604220509616\"></p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>userid:<span class=\"token string\">\"1003\"</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span>userid:1,_id:0<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>.<span class=\"token function-name function\">explain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string\">\"explainVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"queryPlanner\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token string\">\"namespace\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"articledb.comment\"</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token string\">\"indexFilterSet\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token string\">\"parsedQuery\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                        <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                                <span class=\"token string\">\"<span class=\"token variable\">$eq</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token string\">\"queryHash\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"8177476D\"</span>,</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token string\">\"planCacheKey\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"F842FA57\"</span>,</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token string\">\"maxIndexedOrSolutionsReached\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token string\">\"maxIndexedAndSolutionsReached\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token string\">\"maxScansToExplodeReached\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token string\">\"winningPlan\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                        <span class=\"token string\">\"stage\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"PROJECTION_COVERED\"</span>,</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                        <span class=\"token string\">\"transformBy\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                                <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                                <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                        <span class=\"token string\">\"inputStage\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                                <span class=\"token string\">\"stage\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"IXSCAN\"</span>,</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                                <span class=\"token string\">\"keyPattern\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                                        <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                                <span class=\"token string\">\"indexName\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"userid_1\"</span>,</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                                <span class=\"token string\">\"isMultiKey\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                                <span class=\"token string\">\"multiKeyPaths\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                                        <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                                <span class=\"token string\">\"isUnique\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                                <span class=\"token string\">\"isSparse\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                                <span class=\"token string\">\"isPartial\"</span> <span class=\"token builtin class-name\">:</span> false,</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                                <span class=\"token string\">\"indexVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>,</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                                <span class=\"token string\">\"direction\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"forward\"</span>,</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                                <span class=\"token string\">\"indexBounds\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                                        <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                                                <span class=\"token string\">\"[<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>1003<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>, <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>1003<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>]\"</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                                        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                <span class=\"token string\">\"rejectedPlans\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token string\">\"command\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                <span class=\"token string\">\"find\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"comment\"</span>,</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token string\">\"filter\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                        <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token string\">\"projection\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                        <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>,</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                        <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                <span class=\"token string\">\"<span class=\"token variable\">$db</span>\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"articledb\"</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        <span class=\"token string\">\"serverInfo\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                <span class=\"token string\">\"host\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"localhost.localdomain\"</span>,</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                <span class=\"token string\">\"port\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">27017</span>,</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                <span class=\"token string\">\"version\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"5.0.18\"</span>,</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                <span class=\"token string\">\"gitVersion\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"796abe56bfdbca6968ff570311bf72d93632825b\"</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        <span class=\"token string\">\"serverParameters\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                <span class=\"token string\">\"internalQueryFacetBufferSizeBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span>,</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                <span class=\"token string\">\"internalQueryFacetMaxOutputDocSizeBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span>,</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                <span class=\"token string\">\"internalLookupStageIntermediateDocumentMaxSizeBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span>,</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                <span class=\"token string\">\"internalDocumentSourceGroupMaxMemoryBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span>,</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                <span class=\"token string\">\"internalQueryMaxBlockingSortMemoryUsageBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span>,</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                <span class=\"token string\">\"internalQueryProhibitBlockingMergeOnMongoS\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>,</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                <span class=\"token string\">\"internalQueryMaxAddToSetBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span>,</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                <span class=\"token string\">\"internalDocumentSourceSetWindowFieldsMaxMemoryBytes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">104857600</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>        <span class=\"token string\">\"ok\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><h2 id=\"文章评论\"><a class=\"markdownIt-Anchor\" href=\"#文章评论\">#</a> 文章评论</h2>\n<h3 id=\"需求分析\"><a class=\"markdownIt-Anchor\" href=\"#需求分析\">#</a> 需求分析</h3>\n<p>某头条的文章评论业务如下：</p>\n<p>需要实现以下功能：</p>\n<ol>\n<li>基本增删改查 API</li>\n<li>根据文章 id 查询评论</li>\n<li>评论点赞</li>\n</ol>\n<h3 id=\"表结构分析\"><a class=\"markdownIt-Anchor\" href=\"#表结构分析\">#</a> 表结构分析</h3>\n<p>数据库：articledb</p>\n<table>\n<thead>\n<tr>\n<th>专栏文章评论</th>\n<th>comment</th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>字段名称</td>\n<td>字段含义</td>\n<td>字段类型</td>\n<td>备注</td>\n</tr>\n<tr>\n<td>_id</td>\n<td>ID</td>\n<td>ObjectId 或 String</td>\n<td>Mongo 的主键的字段</td>\n</tr>\n<tr>\n<td>articleid</td>\n<td>文章 ID</td>\n<td>String</td>\n<td></td>\n</tr>\n<tr>\n<td>content</td>\n<td>评论内容</td>\n<td>String</td>\n<td></td>\n</tr>\n<tr>\n<td>userid</td>\n<td>评论人 ID</td>\n<td>String</td>\n<td></td>\n</tr>\n<tr>\n<td>nickname</td>\n<td>评论人昵称</td>\n<td>String</td>\n<td></td>\n</tr>\n<tr>\n<td>createdatetime</td>\n<td>评论的日期时间</td>\n<td>Date</td>\n<td></td>\n</tr>\n<tr>\n<td>likenum</td>\n<td>点赞数</td>\n<td>int32</td>\n<td></td>\n</tr>\n<tr>\n<td>replynum</td>\n<td>回复数</td>\n<td>int32</td>\n<td></td>\n</tr>\n<tr>\n<td>state</td>\n<td>状态</td>\n<td>String</td>\n<td>0: 不可见；1: 可见；</td>\n</tr>\n<tr>\n<td>parentid</td>\n<td>上级 ID</td>\n<td>String</td>\n<td>如果为 0 表示文章的顶级评论</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"技术选型\"><a class=\"markdownIt-Anchor\" href=\"#技术选型\">#</a> 技术选型</h3>\n<p>mongodb-driver</p>\n<p>mongodb-driver 是 MongoDB 官方推出的 java 连接 mongoDB 的驱动包，相当于 JDBC 驱动，我们通过一个入门的案例来了解 mongodb-driver 的基本使用</p>\n<p>官方驱动说明和下载：<a href=\"https://mongodb.github.io/mongo-java-driver/\">https://mongodb.github.io/mongo-java-driver/</a></p>\n<p>官方驱动示例文档：<a href=\"https://mongodb.github.io/mongo-java-driver/3.8/driver/getting-started/quick-start/\">https://mongodb.github.io/mongo-java-driver/3.8/driver/getting-started/quick-start/</a></p>\n<h3 id=\"springdatamongodb\"><a class=\"markdownIt-Anchor\" href=\"#springdatamongodb\">#</a> SpringDataMongoDB</h3>\n<p>SpringData 家族成员之一，用于操作 MongoDB 的持久层框架，封装了底层的 MongoDB-Driver</p>\n<p>官方主页：<a href=\"https://spring.io/projects/spring-data-mongodb/\">https://spring.io/projects/spring-data-mongodb/</a></p>\n<p>我们十次方项目的吐槽微服务就采用 SpringDataMongoDB 框架</p>\n<p>1. 创建好 SpringBoot 的项目结构</p>\n<p>2. 导入相关依赖</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-data-mongodb<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>3. 配置 mongodb 连接配置</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token comment\">#数据源配置</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">mongodb</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token comment\">#主机地址</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> 192.168.244.142</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token comment\">#数据库</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token key atrule\">database</span><span class=\"token punctuation\">:</span> articledb</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token comment\">#端口号</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">27017</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token comment\">#也可以使用 uri 连接</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token comment\">#uri: mongodb://192.168.244.142:27017/articledb</span></pre></td></tr></table></figure><p>4. 启动 SpringBoot 查看是否有报错</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031703699.png\" alt=\"image-20230605084426815\"></p>\n<p>一切顺利</p>\n<h3 id=\"文章评论实体类的编写\"><a class=\"markdownIt-Anchor\" href=\"#文章评论实体类的编写\">#</a> 文章评论实体类的编写</h3>\n<p>创建实体类</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Getter</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Setter</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Id</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>mongodb<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">CompoundIndex</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>mongodb<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Indexed</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>mongodb<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>mapping<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Document</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>mongodb<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>mapping<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Field</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Serializable</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">LocalDateTime</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Date</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token annotation punctuation\">@Getter</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token annotation punctuation\">@Setter</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">// 对应 collection 名</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token annotation punctuation\">@Document</span><span class=\"token punctuation\">(</span>collection <span class=\"token operator\">=</span> <span class=\"token string\">\"comment\"</span><span class=\"token punctuation\">)</span><span class=\"token comment\">// 可以省略，如果省略，则默认使用类名小写映射集合</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">// 复合索引</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token annotation punctuation\">@CompoundIndex</span><span class=\"token punctuation\">(</span>def <span class=\"token operator\">=</span> <span class=\"token string\">\"&#123;'userid':1,'nickname':-1&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Comment</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">//    主键标识，该属性的值会自动对应 mongodb 的主键字段_id，如果该属性名就叫 id，则该注解可以省略，否则必须写</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token annotation punctuation\">@Id</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> id<span class=\"token punctuation\">;</span><span class=\"token comment\">// 主键</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">//    该属性对应 mongodb 的字段名字，如果一致，则无需该注解</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token annotation punctuation\">@Field</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"content\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> content<span class=\"token punctuation\">;</span><span class=\"token comment\">// 吐槽内容</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Date</span> publishtime<span class=\"token punctuation\">;</span><span class=\"token comment\">// 发布日期</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">//    添加了一个单字段的索引</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token annotation punctuation\">@Indexed</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> userid<span class=\"token punctuation\">;</span><span class=\"token comment\">// 发布人 ID</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> nickname<span class=\"token punctuation\">;</span><span class=\"token comment\">// 昵称</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LocalDateTime</span> createdatatime<span class=\"token punctuation\">;</span><span class=\"token comment\">// 评论的日期时间</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> likenum<span class=\"token punctuation\">;</span><span class=\"token comment\">// 点赞数</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> replynum<span class=\"token punctuation\">;</span><span class=\"token comment\">// 回复数</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> state<span class=\"token punctuation\">;</span><span class=\"token comment\">// 状态</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> parentid<span class=\"token punctuation\">;</span><span class=\"token comment\">// 上级 ID</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> articleid<span class=\"token punctuation\">;</span><span class=\"token comment\">// 文章 ID</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"文章评论的基本增删改查\"><a class=\"markdownIt-Anchor\" href=\"#文章评论的基本增删改查\">#</a> 文章评论的基本增删改查</h3>\n<p>创建数据访问接口</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dkx<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Comment</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>mongodb<span class=\"token punctuation\">.</span>repository<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MongoRepository</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 评论的持久层接口</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">CommentRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">MongoRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Comment</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>2. 创建业务逻辑类</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dkx<span class=\"token punctuation\">.</span>dao<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">CommentRepository</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dkx<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Comment</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Autowired</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Service</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CommentService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">CommentRepository</span> commentRepository<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>     * 保存一个评论</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>     * @param comment</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Comment</span> comment<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>         * 如果需要自定义主键，可以在这里指定主键；如果不指定主键，MongoDB 会自动生成主键</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>         * 设置一些默认初始值。。。</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>         * 调用 dao</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>         */</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        commentRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>comment<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>     * 更新评论</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>     * @param comment</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">updateComment</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Comment</span> comment<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token comment\">// 调用 dao</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        commentRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>comment<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>     * 根据 id 删除评论</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>     * @param id</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">deleteCommentById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token comment\">// 调用 dao</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        commentRepository<span class=\"token punctuation\">.</span><span class=\"token function\">deleteById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>     * 查询所有评论</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Comment</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findCommentList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token keyword\">return</span> commentRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>     * 根据 id 查询评论</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>     * @param id</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Comment</span> <span class=\"token function\">findCommentById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token keyword\">return</span> commentRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>测试代码：</p>\n<p>获取全部数据</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootTest</span><span class=\"token punctuation\">(</span>classes <span class=\"token operator\">=</span> <span class=\"token class-name\">App</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@RunWith</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SpringJUnit4ClassRunner</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">CommentService</span> commentService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Comment</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> commentService<span class=\"token punctuation\">.</span><span class=\"token function\">findCommentList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Comment</span> i<span class=\"token operator\">:</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token constant\">RUN</span> <span class=\"token class-name\">Result</span> <span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token class-name\">Comment</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> content<span class=\"token operator\">=</span>多喝凉水<span class=\"token punctuation\">,</span> publishtime<span class=\"token operator\">=</span><span class=\"token class-name\">Sat</span> <span class=\"token class-name\">Jan</span> <span class=\"token number\">02</span> <span class=\"token number\">08</span><span class=\"token operator\">:</span><span class=\"token number\">00</span><span class=\"token operator\">:</span><span class=\"token number\">00</span> <span class=\"token class-name\">CST</span> <span class=\"token number\">2021</span><span class=\"token punctuation\">,</span> userid<span class=\"token operator\">=</span><span class=\"token number\">1003</span><span class=\"token punctuation\">,</span> nickname<span class=\"token operator\">=</span>山海经<span class=\"token punctuation\">,</span> createdatatim<span class=\"token operator\">=</span><span class=\"token number\">2021</span><span class=\"token operator\">-</span><span class=\"token number\">01</span><span class=\"token operator\">-</span><span class=\"token number\">02</span><span class=\"token constant\">T08</span><span class=\"token operator\">:</span><span class=\"token number\">00</span><span class=\"token punctuation\">,</span> likenum<span class=\"token operator\">=</span><span class=\"token number\">10001</span><span class=\"token punctuation\">,</span> replynum<span class=\"token operator\">=</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> state<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> parentid<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> articleid<span class=\"token operator\">=</span><span class=\"token number\">1001</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>添加一条数据</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">Comment</span> comment <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Comment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        comment<span class=\"token punctuation\">.</span><span class=\"token function\">setId</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        comment<span class=\"token punctuation\">.</span><span class=\"token function\">setContent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"我天天喝\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        comment<span class=\"token punctuation\">.</span><span class=\"token function\">setPublishtime</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        comment<span class=\"token punctuation\">.</span><span class=\"token function\">setUserid</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1001\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        comment<span class=\"token punctuation\">.</span><span class=\"token function\">setNickname</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"凯撒\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        comment<span class=\"token punctuation\">.</span><span class=\"token function\">setCreatedatatim</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">LocalDateTime</span><span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        comment<span class=\"token punctuation\">.</span><span class=\"token function\">setLikenum</span><span class=\"token punctuation\">(</span><span class=\"token number\">10003</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        comment<span class=\"token punctuation\">.</span><span class=\"token function\">setReplynum</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        comment<span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        comment<span class=\"token punctuation\">.</span><span class=\"token function\">setParentid</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        comment<span class=\"token punctuation\">.</span><span class=\"token function\">setArticleid</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1001\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        commentService<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>comment<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token constant\">RUN</span> <span class=\"token class-name\">Result</span> <span class=\"token class-name\">Check</span> <span class=\"token class-name\">Terminal</span> <span class=\"token class-name\">Mongo</span> <span class=\"token class-name\">DataStatement</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token operator\">></span> db<span class=\"token punctuation\">.</span>comment<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"articleid\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"1001\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"content\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"多喝凉水\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"userid\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"1003\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"山海经\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"createdatatim\"</span> <span class=\"token operator\">:</span> <span class=\"token class-name\">ISODate</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2021-01-02T00:00:00Z\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"likenum\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"10001\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"replynum\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"3\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"state\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"parentid\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"publishtime\"</span> <span class=\"token operator\">:</span> <span class=\"token class-name\">ISODate</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2021-01-02T00:00:00Z\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"content\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"我天天喝\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"publishtime\"</span> <span class=\"token operator\">:</span> <span class=\"token class-name\">ISODate</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-05T02:26:15.397Z\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"userid\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"1001\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"凯撒\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"createdatatim\"</span> <span class=\"token operator\">:</span> <span class=\"token class-name\">ISODate</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-05T02:26:15.405Z\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"likenum\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">10003</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"replynum\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"state\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"parentid\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"articleid\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"1001\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"_class\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"com.dkx.domain.Comment\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><h3 id=\"根据上级id查询文章评论的分页列表\"><a class=\"markdownIt-Anchor\" href=\"#根据上级id查询文章评论的分页列表\">#</a> 根据上级 ID 查询文章评论的分页列表</h3>\n<p>1.CommentRepository 新增方法定义</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dkx<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Comment</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Page</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Pageable</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>mongodb<span class=\"token punctuation\">.</span>repository<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MongoRepository</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// 评论的持久层接口</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">CommentRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">MongoRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Comment</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">//    方法名必须是 findBy 语法 Parentid 对应集合的字段的不能写错或者乱写都是不行的</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token class-name\">Page</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Comment</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findByParentid</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> parentid<span class=\"token punctuation\">,</span><span class=\"token class-name\">Pageable</span> pageable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>2. 编写 service 代码</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 分页查询上级 ID</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @param parentid</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @param page</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @param size</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @return</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">Page</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Comment</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findCommentListByParentid</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> parentid<span class=\"token punctuation\">,</span><span class=\"token keyword\">int</span> page<span class=\"token punctuation\">,</span><span class=\"token keyword\">int</span> size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token keyword\">return</span> commentRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByParentid</span><span class=\"token punctuation\">(</span>parentid<span class=\"token punctuation\">,</span> <span class=\"token class-name\">PageRequest</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>page <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>3. 测试代码：</p>\n<p>先查看集合的数据</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> db.comment.<span class=\"token function-name function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1001\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"多喝凉水\"</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1003\"</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"山海经\"</span>, <span class=\"token string\">\"createdatatim\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2021-01-02T00:00:00Z\"</span><span class=\"token punctuation\">)</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"10001\"</span>, <span class=\"token string\">\"replynum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"3\"</span>, <span class=\"token string\">\"state\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"parentid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"0\"</span>, <span class=\"token string\">\"publishtime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2021-01-02T00:00:00Z\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2\"</span>, <span class=\"token string\">\"content\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"我天天喝\"</span>, <span class=\"token string\">\"publishtime\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-05T02:26:15.397Z\"</span><span class=\"token punctuation\">)</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1001\"</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"凯撒\"</span>, <span class=\"token string\">\"createdatatim\"</span> <span class=\"token builtin class-name\">:</span> ISODate<span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-05T02:26:15.405Z\"</span><span class=\"token punctuation\">)</span>, <span class=\"token string\">\"likenum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">10003</span>, <span class=\"token string\">\"replynum\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">4</span>, <span class=\"token string\">\"state\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"parentid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"articleid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1001\"</span>, <span class=\"token string\">\"_class\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"com.dkx.domain.Comment\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647d5340b50522086f5836bb\"</span><span class=\"token punctuation\">)</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1001\"</span>, <span class=\"token string\">\"parentid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"刘桑\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647d5340b50522086f5836bc\"</span><span class=\"token punctuation\">)</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1002\"</span>, <span class=\"token string\">\"parentid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"张三\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token builtin class-name\">:</span> ObjectId<span class=\"token punctuation\">(</span><span class=\"token string\">\"647d5340b50522086f5836bd\"</span><span class=\"token punctuation\">)</span>, <span class=\"token string\">\"userid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1004\"</span>, <span class=\"token string\">\"parentid\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"1\"</span>, <span class=\"token string\">\"nickname\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"李四\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">></span></pre></td></tr></table></figure><p>parentid 为 1 的数据有 4 条，测试代码中传入查询 2 条数据</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">Page</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Comment</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> commentService<span class=\"token punctuation\">.</span><span class=\"token function\">findCommentListByParentid</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Comment</span> i<span class=\"token operator\">:</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token constant\">RUN</span> <span class=\"token class-name\">Result</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token class-name\">Comment</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">647d</span><span class=\"token number\">5340</span>b50522086f5836bb<span class=\"token punctuation\">,</span> content<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> publishtime<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> userid<span class=\"token operator\">=</span><span class=\"token number\">1001</span><span class=\"token punctuation\">,</span> nickname<span class=\"token operator\">=</span>刘桑<span class=\"token punctuation\">,</span> createdatatim<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> likenum<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> replynum<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> state<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> parentid<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> articleid<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"mongotemplate实现评论点赞\"><a class=\"markdownIt-Anchor\" href=\"#mongotemplate实现评论点赞\">#</a> MongoTemplate 实现评论点赞</h3>\n<p>我们看一下以下点赞的临时示例代码：CommentService 新增 updateThumbup 方法</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 点赞 - 效率低</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Param id</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">updateCommentThumbupToIncrementingOld</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token class-name\">Comment</span> comment <span class=\"token operator\">=</span> <span class=\"token class-name\">CommentRepository</span><span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   comment<span class=\"token punctuation\">.</span><span class=\"token function\">setLikenum</span><span class=\"token punctuation\">(</span>comment<span class=\"token punctuation\">.</span><span class=\"token function\">getLikenum</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token class-name\">CommentRepository</span><span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>comment<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>以上方法虽然实现起来比较简单，但是执行效率并不高，因为我只需要将点赞数加 1 就可以了，没必要查询出所有字段修改后再更新所有字段 (蝴蝶效应)</p>\n<p>我们可以使用 MongoTemplate 类来实现对某列的操作</p>\n<p>1. 修改 CommentService</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">MongoTemplate</span> mongoTemplate<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">updateCommentLikenum</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token comment\">//        查询对象</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token class-name\">Query</span> query <span class=\"token operator\">=</span> <span class=\"token class-name\">Query</span><span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Criteria</span><span class=\"token punctuation\">.</span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"_id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">is</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token comment\">//        更新对象</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token class-name\">Update</span> update <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">//        递增 $inc</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   update<span class=\"token punctuation\">.</span><span class=\"token function\">inc</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"likenum\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>         * 参数 1：查询对象 query</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>         * 参数 2：更新对象 update</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>         * 参数 3：集合的名字或实体类的类型 Comment.class</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>         */</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   mongoTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">updateFirst</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">,</span>update<span class=\"token punctuation\">,</span><span class=\"token string\">\"comment\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>2. 测试代码：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test4</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   commentService<span class=\"token punctuation\">.</span><span class=\"token function\">updateCommentLikenum</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token constant\">RUN</span> <span class=\"token class-name\">Result</span> mongo <span class=\"token class-name\">Terminal</span> statment<span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>修改前</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"content\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"我天天喝\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"publishtime\"</span> <span class=\"token operator\">:</span> <span class=\"token class-name\">ISODate</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-05T02:26:15.397Z\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"userid\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"1001\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"凯撒\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"createdatatim\"</span> <span class=\"token operator\">:</span> <span class=\"token class-name\">ISODate</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-05T02:26:15.405Z\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"likenum\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">10003</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"replynum\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"state\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"parentid\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"articleid\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"1001\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"_class\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"com.dkx.domain.Comment\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>修改后</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"content\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"我天天喝\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"publishtime\"</span> <span class=\"token operator\">:</span> <span class=\"token class-name\">ISODate</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-05T02:26:15.397Z\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"userid\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"1001\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"nickname\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"凯撒\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"createdatatim\"</span> <span class=\"token operator\">:</span> <span class=\"token class-name\">ISODate</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2023-06-05T02:26:15.405Z\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"likenum\"</span> <span class=\"token operator\">:</span> <span class=\"token class-name\">NumberLong</span><span class=\"token punctuation\">(</span><span class=\"token number\">10004</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"replynum\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"state\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"parentid\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"articleid\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"1001\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"_class\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"com.dkx.domain.Comment\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "计算机学科",
                "database",
                "mongodb"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/JDBC/JdbcTemplate/%E8%AF%A6%E8%A7%A3%E6%96%87%E7%AB%A0/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/JDBC/JdbcTemplate/%E8%AF%A6%E8%A7%A3%E6%96%87%E7%AB%A0/",
            "title": "JdbcTemplate详解",
            "date_published": "2024-04-02T06:23:30.029Z",
            "content_html": "<h2 id=\"jdbctemplate详解\"><a class=\"markdownIt-Anchor\" href=\"#jdbctemplate详解\">#</a> JdbcTemplate 详解</h2>\n<h3 id=\"一jdbctemplate概念和准备\"><a class=\"markdownIt-Anchor\" href=\"#一jdbctemplate概念和准备\">#</a> 一，JdbcTemplate (概念和准备)</h3>\n<ol>\n<li>什么是 JdbcTemplate (Template 译为模板)\n<ul>\n<li>Sprint 框架对 JDBC 进行封装，使用 JdbcTemplate 方便实现对数据库操作</li>\n</ul>\n</li>\n<li>准备工作\n<ol>\n<li>引入相关 jar 包，我们还需要导入连接数据库的相关 jar 包，比如: <code>druid,mysql-connector-java</code></li>\n</ol>\n</li>\n</ol>\n<p><img src=\"https://gitee.com/Doukaixin/note_image/raw/master/https://gitee.com/doukaixin/note_image/image-20221217143453718.png\" alt=\"image-20221217143453718\"></p>\n<p>我们需要的是 <code>spring-jdbc-5.0.0.RELEASE.jar</code> , 除了要导入这个 jar 包外，还需要导入一个 <code>spring-tx-5.0.0.RELEASE.jar</code>  (它 是 和事务相关的)</p>\n<blockquote>\n<p>spring JDBC</p>\n</blockquote>\n<p>Spring 框架对 JDBC 的简单封装，提供了一个 JDBCTemplate 对象简化 JDBC 的开发</p>\n<ul>\n<li>步骤:\n<ol>\n<li>导入 jar 包</li>\n<li>创建 JdbcTemplate 对象，依赖于数据源 DataSource\n<ul>\n<li>JdbcTemplate template = new JdcbTemplate(ds);</li>\n</ul>\n</li>\n</ol>\n</li>\n</ul>\n<p>调用 JdbcTemplate 的方法来完成 CRUD 的操作</p>\n<ol>\n<li>\n<p>update (): 执行 DML 语句，增，删，改语句</p>\n</li>\n<li>\n<p>queryForMap (): 执行 DQL 查询结果将结果集封装为 map 集合</p>\n</li>\n<li>\n<p>queryForList (): 执行 DQL 查询结果将结果集封装为 list 集合</p>\n<ul>\n<li>将每一条记录封装为一个 Map 集合，再将 Map 集合装载到 List 集合中</li>\n</ul>\n</li>\n<li>\n<p>query (): 执行 DQL 查询结果，将结果封装为 JavaBean 对象</p>\n</li>\n<li>\n<p>queryForObject (): 执行 DQL 查询结果，将结果封装为对象</p>\n<ul>\n<li>一般用于聚合函数的查询</li>\n</ul>\n</li>\n</ol>\n<ul>\n<li>\n<p>案例:</p>\n</li>\n<li>\n<p>增</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">JdbcTemplate</span> jdbcTemplate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JdbcTemplate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JDBCUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"insert into user values(?,?)\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">int</span> update <span class=\"token operator\">=</span> jdbcTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"王五\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>update <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>       <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"执行成功!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>       <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"执行失败!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>删</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">JdbcTemplate</span> jdbcTemplate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JdbcTemplate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JDBCUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"delete from user where id=?\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> update <span class=\"token operator\">=</span> jdbcTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>update <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"执行成功!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"执行失败!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>改</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">JdbcTemplate</span> jdbcTemplate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JdbcTemplate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JDBCUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"update user set name='马牛逼' where id=?\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">int</span> update <span class=\"token operator\">=</span> jdbcTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>update <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"执行成功!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"执行失败!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>DQL</p>\n</blockquote>\n<ul>\n<li>queryForMap 查询单行</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">JdbcTemplate</span> jdbcTemplate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JdbcTemplate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JDBCUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"select * from user where id = ?\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> map <span class=\"token operator\">=</span> jdbcTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">queryForMap</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">,</span>  <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>queryForList 查询多行</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">JdbcTemplate</span> jdbcTemplate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JdbcTemplate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JDBCUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"select * from user where id = ? or id = ?\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Map</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> maps <span class=\"token operator\">=</span> jdbcTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">queryForList</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">,</span>  <span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>maps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>queryForObject 查询单行，返回对象 一般用于聚合函数的查询</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">JdbcTemplate</span> jdbcTemplate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JdbcTemplate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JDBCUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"select * from user where id = ?\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> jdbcTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">queryForObject</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BeanPropertyRowMapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">//===========================================================</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token class-name\">JdbcTemplate</span> jdbcTemplate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JdbcTemplate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JDBCUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"select count(id) from user\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> jdbcTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">queryForObject</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">,</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>query 查询多行，返回 JavaBean 对象并封装到 List 集合中</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">JdbcTemplate</span> jdbcTemplate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JdbcTemplate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JDBCUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"select * from user\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> jdbcTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BeanPropertyRowMapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure>",
            "tags": [
                "JdbcTemplate",
                "计算机学科",
                "基础",
                "database",
                "JDBC"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/JDBC/JDBC%E6%A8%A1%E5%BC%8F%E5%AE%9E%E7%8E%B0/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/JDBC/JDBC%E6%A8%A1%E5%BC%8F%E5%AE%9E%E7%8E%B0/",
            "title": "JDBC模式实现",
            "date_published": "2024-04-02T06:23:30.023Z",
            "content_html": "<ol>\n<li>创建 Java JDBC 接口规范</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>ar<span class=\"token punctuation\">.</span>www</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">JavaJDBC</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">getConnectot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">getClose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">getDlc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"2\">\n<li>创建 MySQL 模拟类并实现 Java 的 JDBC 接口规范</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>ar<span class=\"token punctuation\">.</span>www</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MySQL</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">JavaJDBC</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">getClose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"关闭MySQl数据库\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">getDlc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"对MySQL进行了增删改查\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">getConnectot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"连接了MySQL数据库\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"3\">\n<li>创建 test 类，模拟 MySQL 数据库连接 Java JDBC</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>ar<span class=\"token punctuation\">.</span>www</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JavaTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// 对 MySQl 数据库的操作</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">JavaJDBC</span> javajdbc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MySQL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        javajdbc<span class=\"token punctuation\">.</span><span class=\"token function\">getConnectot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        javajdbc<span class=\"token punctuation\">.</span><span class=\"token function\">getDlc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        javajdbc<span class=\"token punctuation\">.</span><span class=\"token function\">getDlc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"4\">\n<li>再创建一个 Orcale 数据库并实现 JDBC 规范</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>ar<span class=\"token punctuation\">.</span>www</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Orcale</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">JavaJDBC</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">getConnectot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"连接了Orcale数据库\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">getClose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"关闭了Orcale数据库\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">getDlc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"对Orcale数据库进行了增删改查\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"5\">\n<li>test 类</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>ar<span class=\"token punctuation\">.</span>www</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JavaTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// 对 MySQl 数据库的操作</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">JavaJDBC</span> javajdbc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MySQL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        javajdbc<span class=\"token punctuation\">.</span><span class=\"token function\">getConnectot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        javajdbc<span class=\"token punctuation\">.</span><span class=\"token function\">getDlc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        javajdbc<span class=\"token punctuation\">.</span><span class=\"token function\">getDlc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 对 Orcale 数据库的操作</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        javajdbc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Orcale</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        javajdbc<span class=\"token punctuation\">.</span><span class=\"token function\">getConnectot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        javajdbc<span class=\"token punctuation\">.</span><span class=\"token function\">getDlc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        javajdbc<span class=\"token punctuation\">.</span><span class=\"token function\">getClose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>执行结果:</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>连接了<span class=\"token class-name\">MySQL</span>数据库</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>对<span class=\"token class-name\">MySQL</span>进行了增删改查</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>对<span class=\"token class-name\">MySQL</span>进行了增删改查</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>连接了<span class=\"token class-name\">Orcale</span>数据库</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>对<span class=\"token class-name\">Orcale</span>数据库进行了增删改查</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>关闭了<span class=\"token class-name\">Orcale</span>数据库</pre></td></tr></table></figure>",
            "tags": [
                "计算机学科",
                "database",
                "JDBC"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/JDBC/JDBC%E6%A6%82%E8%BF%B0/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/JDBC/JDBC%E6%A6%82%E8%BF%B0/",
            "title": "JDBC概述",
            "date_published": "2024-04-02T06:23:30.020Z",
            "content_html": "<h2 id=\"jdbc概述\"><a class=\"markdownIt-Anchor\" href=\"#jdbc概述\">#</a> JDBC 概述</h2>\n<p>[TOC]</p>\n<blockquote>\n<ol>\n<li>JDBC 为访问不同的数据库提供了统一的接口，为使用者屏蔽了细节问题</li>\n<li>Java 程序员使用 JDBC, 可以连接任何提供了 JDBC 驱动程序的数据库系统，从而完成对数据库的各种操作</li>\n</ol>\n</blockquote>\n<p>示意图:</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051434272.png\" alt=\"image-20240105143447191\"></p>\n<h2 id=\"jdbc带来的好处\"><a class=\"markdownIt-Anchor\" href=\"#jdbc带来的好处\">#</a> JDBC 带来的好处:</h2>\n<p>示意图:</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051435106.png\" alt=\"image-20240105143459996\"></p>\n<blockquote>\n<p>说明:  JDBC 是 Java 提供一套用于数据库操作的接口 API,Java 程序员需要面向这套接口编程即可，不同的数据库厂商，需要针对这套接口，提供不同实现</p>\n</blockquote>\n<h2 id=\"jdbc-api概述\"><a class=\"markdownIt-Anchor\" href=\"#jdbc-api概述\">#</a> JDBC  API 概述:</h2>\n<p>示意图:</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051440767.png\" alt=\"image-20240105143511737\"></p>\n<blockquote>\n<p>JDBC   API 是一系列的接口，它统一规范了应用程序与数据库的链接，执行 SQL 语句，并得到返回结果等各类操作，相关类和接口在 java.sql 与 javax.sql 包中</p>\n</blockquote>\n<h3 id=\"jdbc链接数据库方式路径以linux为例\"><a class=\"markdownIt-Anchor\" href=\"#jdbc链接数据库方式路径以linux为例\">#</a> JDBC 链接数据库方式 (路径以 Linux 为例)</h3>\n<table>\n<thead>\n<tr>\n<th>方法</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Driver</td>\n<td>注册驱动</td>\n</tr>\n<tr>\n<td>Connection</td>\n<td>链接数据库</td>\n</tr>\n<tr>\n<td>ResultSet</td>\n<td>通过 next 将指针向下移动，通过 previous 将指针向上移动<br>类似于迭代器，用于访问循环的数据，比如 DQL</td>\n</tr>\n<tr>\n<td>PreparedStatement</td>\n<td>发送 SQL 到数据库，调用对应的 get 方法获取结果</td>\n</tr>\n<tr>\n<td>Class.forName</td>\n<td>Java 反射机制，记载类，返回 Class 类型对象</td>\n</tr>\n<tr>\n<td>DriverManager</td>\n<td>替代 Driver 进行统一管理，可以调用 registerDriver 将注册驱动的对象<br>传入构造器中，使期为自身<br>通过调用 getConnection 获取与 MySQL 连接</td>\n</tr>\n<tr>\n<td>Properties</td>\n<td>配置文件类，用于读取配置文件写出配置文件</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Java 连接数据库</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051435224.png\" alt=\"image-20240105143526160\"></p>\n<h2 id=\"1传统方式\"><a class=\"markdownIt-Anchor\" href=\"#1传统方式\">#</a> 1. 传统方式</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> test <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">// 方式一</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token comment\">// 注册驱动</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">Driver</span> driver <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Driver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">// 编写连接数据库的 url</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">String</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"jdbc:mysql://localhost:3306/Demo\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// 创建 Properties 配置文件类</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">Properties</span> properties <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Properties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 设置配置文件信息</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        properties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"root\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        properties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">// 创建 Connection 通过 Driver 对象调用 connect 添加 url 跟数据库的 user 和 password 连接数据库</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> driver<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span>properties<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">// 编写一条 sql 语句</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"update `Demo` set name = '刘桑' where id = 28\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// 将 sql 语句发送给 MySQL 数据库并返回其对象</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">Statement</span> statement <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createStatement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token comment\">// 通过返回对象调用 executeUpdate 返回一个 int 类型的值</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> statement<span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\">// 判断这个值如果大于 1 则说明执行成功，否则失败</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"连接成功\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"连接失败\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">// 关闭源，释放资源</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        statement<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"2使用反射机制\"><a class=\"markdownIt-Anchor\" href=\"#2使用反射机制\">#</a> 2. 使用反射机制</h2>\n<p>利用反射机制来实例化 Driver 对象从而注册驱动，然后向下转型即可调用 Driver 方法</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051435545.png\" alt=\"image-20240105143538463\"></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> testone <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">InstantiationException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IllegalAccessException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">Class</span> cls <span class=\"token operator\">=</span> <span class=\"token class-name\">Class</span><span class=\"token punctuation\">.</span><span class=\"token function\">forName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"com.mysql.jdbc.Driver\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">Driver</span> driver <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Driver</span><span class=\"token punctuation\">)</span>cls<span class=\"token punctuation\">.</span><span class=\"token function\">newInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">String</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"jdbc:mysql://localhost:3306/Demo\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">Properties</span> properties <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Properties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        properties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"root\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        properties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> driver<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span>properties<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Driver:\"</span><span class=\"token operator\">+</span>connection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"区别\"><a class=\"markdownIt-Anchor\" href=\"#区别\">#</a> 区别:</h4>\n<ul>\n<li>Driver driver = new Driver ( ); 直接使用 import.java.sql.Connection; 属于静态加载灵活性差依赖强</li>\n<li>Class cls = Class.forName (“com.mysql.jdbc.Driver”); 属于动态加载，灵活性强</li>\n</ul>\n<h2 id=\"3-使用drivermanager替代driver进行统一管理\"><a class=\"markdownIt-Anchor\" href=\"#3-使用drivermanager替代driver进行统一管理\">#</a> 3. 使用 DriverManager 替代 Driver 进行统一管理</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> testtwo <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">InstantiationException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IllegalAccessException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">//Java 反射机制实例化 Driver 类</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">Class</span> cls <span class=\"token operator\">=</span> <span class=\"token class-name\">Class</span><span class=\"token punctuation\">.</span><span class=\"token function\">forName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"com.mysql.jdbc.Driver\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// 向下转型</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">Driver</span> driver <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Driver</span><span class=\"token punctuation\">)</span>cls<span class=\"token punctuation\">.</span><span class=\"token function\">newInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">String</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"jdbc:mysql://localhost:3306/Demo\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">String</span> user <span class=\"token operator\">=</span> <span class=\"token string\">\"root\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">String</span> password <span class=\"token operator\">=</span> <span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 使用 DriverManager 注册给定的驱动程序，调用 resterDriver 使其为自身</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">DriverManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">registerDriver</span><span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 通过 Connection 提供 url,user,password 连接数据库</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token class-name\">DriverManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span>user<span class=\"token punctuation\">,</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Driver:\"</span><span class=\"token operator\">+</span>connection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"4使用反射机制加载driver类\"><a class=\"markdownIt-Anchor\" href=\"#4使用反射机制加载driver类\">#</a> 4. 使用反射机制加载 Driver 类</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> testsan <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">// 通过反射机制加载 Driver 类</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">Class</span><span class=\"token punctuation\">.</span><span class=\"token function\">forName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"com.mysql.jdbc.Driver\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">String</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"jdbc:mysql://localhost:3306/Demo\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">String</span> user <span class=\"token operator\">=</span> <span class=\"token string\">\"root\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">String</span> password <span class=\"token operator\">=</span> <span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// 通过 DriverManager 调用 getConnection 方法传入数据库的 url,user,password 连接到数据库</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token class-name\">DriverManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span>user<span class=\"token punctuation\">,</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"5在第四个方式上进行优化\"><a class=\"markdownIt-Anchor\" href=\"#5在第四个方式上进行优化\">#</a> 5. 在第四个方式上进行优化</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> testsi <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">// 实例化配置文件对象</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">Properties</span> properties <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Properties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// 向配置文件中添加信息</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        properties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"driver\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"com.mysql.jdbc.Driver\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        properties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"url\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"jdbc:mysql://localhost:3306/Demo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        properties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"root\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        properties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 通过调用 store 方法新建输出流将配置文件写出到指定位置中，第二个参数为注释</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        properties<span class=\"token punctuation\">.</span><span class=\"token function\">store</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"src//re.Properties\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"LinuxProperties\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 获取配置文件中的信息</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">String</span> driver <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"driver\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">String</span> url <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"url\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">String</span> password <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">String</span> user <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// 通过反射机制加载 Driver 类，虽然自动加载但是还是建议写上</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">Class</span><span class=\"token punctuation\">.</span><span class=\"token function\">forName</span><span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token comment\">// 实例化 Connection 类通过 DriverManager 调用 getConnection 方法传入连接数据库的数据</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token class-name\">DriverManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span>user<span class=\"token punctuation\">,</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\">// 编写一条 SQL 语句</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"select * from Demo\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">// 向数据库发送 SQL 语句，并返回其对象</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">Statement</span> statement <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createStatement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\">// 通过 Statement 对象调用 executeQuery 执行 SQL DQL 语句并返回给 ResultSet 对象</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token class-name\">ResultSet</span> resultset <span class=\"token operator\">=</span> statement<span class=\"token punctuation\">.</span><span class=\"token function\">executeQuery</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">// 因为不知道循环多少次，使用 while 循环来处理 resultset.next () 每次执行指向下一个</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">// 当没有可查询列后返回 false 即结束循环</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>resultset<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token comment\">//id 在第一列中为 int 类型</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token keyword\">int</span> id <span class=\"token operator\">=</span> resultset<span class=\"token punctuation\">.</span><span class=\"token function\">getInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token class-name\">String</span> name <span class=\"token operator\">=</span> resultset<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token class-name\">String</span> sex <span class=\"token operator\">=</span> resultset<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token class-name\">Date</span> date <span class=\"token operator\">=</span> resultset<span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token class-name\">String</span> dian <span class=\"token operator\">=</span> resultset<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">+</span><span class=\"token string\">\"\\t\"</span><span class=\"token operator\">+</span>name<span class=\"token operator\">+</span><span class=\"token string\">\"\\t\"</span><span class=\"token operator\">+</span>sex<span class=\"token operator\">+</span><span class=\"token string\">\"\\t\"</span><span class=\"token operator\">+</span>date<span class=\"token operator\">+</span><span class=\"token string\">\"\\t\"</span><span class=\"token operator\">+</span>dian<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token comment\">// 关闭源，释放资源</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        statement<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>\n<p><strong>提示:</strong></p>\n</li>\n<li>\n<ol>\n<li>\n<p>mysql 驱动 5.1.6 可以无需 Class.forName (“com.mysql.jdbc.Driver”);</p>\n</li>\n<li>\n<p>从 jdk1.5 以后使用了 jdbc4, 不再需要显示调用 Class.forName ( ); 注册驱动而是自动调用驱动 jar 包下 META-INF\\serverces\\java.sql.Driver 文件中的类名称去注册</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051435643.png\" alt=\"image-20240105143556571\"></p>\n</li>\n<li>\n<p>建议加上 Class.forName (“com.mysql.jdbc.Driver”); 更加明确</p>\n</li>\n</ol>\n<p>Debug 代码查看 ResultSet 对象结构:</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051436500.png\" alt=\"image-20240105143624437\"></p>\n</li>\n</ul>\n<h2 id=\"statement\"><a class=\"markdownIt-Anchor\" href=\"#statement\">#</a> Statement</h2>\n<ol>\n<li>Statement 对象用于执行静态 SQL 语句并返回其生成的结果对象</li>\n<li>在连接建立后，需要对数据库进行访问，执行命令或是 SQL 语句，可以通过</li>\n</ol>\n<ul>\n<li>Statement (存在 SQL 注入)</li>\n<li>PreparedStatement (预处理)</li>\n<li>CallableStatement (存储过程)</li>\n</ul>\n<ol start=\"3\">\n<li>Statement 对象执行 SQL 语句，存在 SQL 注入风险</li>\n<li>SQL 注入是利用某些系统没有对用户输入的数据进行充分的检查，而在用户输入数据中注入非法的 SQL 语句段或命令，恶意攻击数据库</li>\n<li>要防范 SQL 注入，只要用 PreparedStatement**(从 Statement 扩展而来)** 取代 Statement 就可以了</li>\n</ol>\n<h3 id=\"演示sql注入\"><a class=\"markdownIt-Anchor\" href=\"#演示sql注入\">#</a> 演示 SQL 注入:</h3>\n<p>表结构和数据:</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- auto-generated definition</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> admin</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    name <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">default</span> <span class=\"token string\">''</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    pwd  <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">default</span> <span class=\"token string\">''</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">collate</span> <span class=\"token operator\">=</span> utf8_bin<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>操作：将用户名和密码输入为 name = 1’ or password = or ‘1’ = ‘1  如果不成功建议按顺序打’-&gt;1-&gt;’</li>\n</ul>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 演示 SQL 注入</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 创建一张表</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> admin <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span> <span class=\"token keyword\">default</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>pwd<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span> <span class=\"token keyword\">default</span> <span class=\"token string\">''</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token keyword\">character</span> <span class=\"token keyword\">set</span> utf8 <span class=\"token keyword\">collate</span> utf8_bin<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 查找某个管理员是否存在，输入用户名为 '1' or' 输入密码为 'or = '1' = '1'</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> admin</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">where</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'1'</span> <span class=\"token operator\">or</span><span class=\"token string\">' and pwd = '</span><span class=\"token operator\">or</span> <span class=\"token string\">'1'</span> <span class=\"token operator\">=</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>Java 程序中演示</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Scanner</span> sc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"请输入用户名与密码\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"请输入用户名:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">String</span> zhang <span class=\"token operator\">=</span> sc<span class=\"token punctuation\">.</span><span class=\"token function\">nextLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"请输入密码:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">String</span> mima <span class=\"token operator\">=</span> sc<span class=\"token punctuation\">.</span><span class=\"token function\">nextLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">Properties</span> properties <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Properties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        properties<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"src//re.Properties\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">String</span> driver <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"driver\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">String</span> url <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"url\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">String</span> user <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">String</span> password <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">Class</span><span class=\"token punctuation\">.</span><span class=\"token function\">forName</span><span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"select * from admin where name = '\"</span><span class=\"token operator\">+</span>zhang<span class=\"token operator\">+</span><span class=\"token string\">\"'and pwd = '\"</span><span class=\"token operator\">+</span>mima<span class=\"token operator\">+</span><span class=\"token string\">\"'\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token class-name\">DriverManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span>user<span class=\"token punctuation\">,</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">Statement</span> statement <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createStatement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">ResultSet</span> resultset <span class=\"token operator\">=</span> statement<span class=\"token punctuation\">.</span><span class=\"token function\">executeQuery</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>resultset<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"登入成功\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"登入失败\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        statement<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>执行输入密码演示:</p>\n<p>输入正确密码</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051436182.png\" alt=\"image-20240105143641132\"></p>\n<p>输入错误密码或者是不存在的用户名</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051436670.png\" alt=\"image-20240105143654524\"></p>\n<p>使用万能密码演示:</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051440719.png\" alt=\"image-20240105143704277\"></p>\n<h2 id=\"preparedstatement\"><a class=\"markdownIt-Anchor\" href=\"#preparedstatement\">#</a> PreparedStatement</h2>\n<ol>\n<li>PreparedStatement 执行的 SQL 语句中的参数用问号 (?) 来表示，调用 PreparedStatement 对象的 setXxx (   ); 方法来设置这些参数，setXxx (   ); 方法有两个参数，第一个参数是要设置的 SQL 语句中的参数的索引 (从 1 开始), 第二个是设置的 SQL 语句中的参数的值</li>\n<li>调用 executeQuery ( ); 执行 DQL 语句，返回 ResultSet 对象</li>\n<li>调用 executeUpdate ( ); 执行 DML 语句，更新，包括增，删。改</li>\n</ol>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>String <span class=\"token keyword\">sql</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"select count(*) from admin where name = ? and password = ?\"</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"preparedstatement好处\"><a class=\"markdownIt-Anchor\" href=\"#preparedstatement好处\">#</a> PreparedStatement 好处</h3>\n<ol>\n<li>不再使用 + 拼接 SQL 语句，减少语句错误</li>\n<li>有效的解决了 SQL 注入问题</li>\n<li>大大减少了编译次数，效率较高</li>\n</ol>\n<p>代码：登入演示：(这个程序在使用万能密码的时候就不管用了)</p>\n<p>演示是否可以使用  <code>admin name 1' or admin password or '1' = '1</code></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dkx<span class=\"token punctuation\">.</span>xer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FileInputStream</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Properties</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Scanner</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">My_Connection</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> main <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ClassNotFoundException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">Scanner</span> sc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"请输入内容\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"请输入用户名:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">String</span> admin_name <span class=\"token operator\">=</span> sc<span class=\"token punctuation\">.</span><span class=\"token function\">nextLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"请输入密码:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">String</span> admin_neir <span class=\"token operator\">=</span> sc<span class=\"token punctuation\">.</span><span class=\"token function\">nextLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">Properties</span> properties <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Properties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        properties<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"src//re.Properties\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">String</span> driver <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"driver\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token class-name\">String</span> url <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"url\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">String</span> user <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">String</span> password <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token class-name\">Class</span><span class=\"token punctuation\">.</span><span class=\"token function\">forName</span><span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token comment\">//Connection 连接数据库</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token class-name\">DriverManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span>user<span class=\"token punctuation\">,</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// 得到 PreparedStatement</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">//1. 编写 SQL 语句 ？ 号相当于是一个占位符</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"select * from admin where name = ? and pwd = ?\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token comment\">//2.PreparedStatement 对象实现了 PreparedStatement 接口的实现类对象</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token class-name\">PreparedStatement</span> preparedstatement <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">prepareStatement</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token comment\">//3. 通过 PreparedStatement 给？赋值，进行了预处理</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">setString</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>admin_name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">setString</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span>admin_neir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token comment\">//4. 执行 select   DQL 语句使用 executeQuery ();</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token comment\">// 如果执行的是 DML (update,insert,delete) 则使用 executeUpdate ();</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token comment\">// 这里的参数中不能给 sql, 这里赋值 sql 对象的话，相当于将带有？号的语句给了这个对象就会发生报错</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token class-name\">ResultSet</span> resultset <span class=\"token operator\">=</span> preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">executeQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>resultset<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"登入成功\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"抱歉，登入失败！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        resultset<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"最常用-jdbc-api\"><a class=\"markdownIt-Anchor\" href=\"#最常用-jdbc-api\">#</a> <strong>最常用</strong> jdbc API</h2>\n<ul>\n<li>DriverManager 驱动管理类 —&gt; getConnection (url,user,password) 获取到链接</li>\n</ul>\n<hr>\n<ul>\n<li>Connection 接口 —&gt; createStatement 创建 Statement 对象</li>\n</ul>\n<p>​\t\t—&gt; preparedStatement (sql) 生成预处理对象</p>\n<hr>\n<ul>\n<li>Statement 接口 —&gt; executeUpdate (sql) 执行 DML 语句，返回影响的行数</li>\n</ul>\n<p>​\t\t—&gt; executeQuery (sql) 执行查询，返回 ResultSet 对象</p>\n<p>​\t\t—&gt; execute (sql) 执行任意的 sql, 返回布尔值一般用于创建表</p>\n<hr>\n<ul>\n<li>PreparedStatement 接口 —&gt; executeUpdate ([这里面不能写 sql]); 执行 DML (增删改查)</li>\n</ul>\n<p>​\t\t—&gt; executeQuery ([不能写 sql 对象]); 执行查询，返回 ResultSet   DQL</p>\n<p>​\t\t—&gt; execute ([不能写 sql 对象]); 执行任何 sql, 返回布尔值一般用于创建表</p>\n<p>​\t\t—&gt; setXxx (占位符索引，占位符的值); 解决 SQL 注入 [Xxx 为对应数据类型]</p>\n<p>​\t\t—&gt; setObject (占位符索引，占位符的值);</p>\n<hr>\n<ul>\n<li>ResultSet (结果集) —&gt; next ( ); 向下移动一行，同时如果没有下一行，返回 false</li>\n</ul>\n<p>​\t\t—&gt; previous ( ); 向上移动一行</p>\n<p>​\t\t—&gt; getXxx (列的索引  |  列名); 返回对应列的值，接口类型是 Xxx</p>\n<p>​\t\t—&gt; getObject (列的索引   |   列名); 返回对应列的值，接收类型为 Object 类型</p>\n<h2 id=\"封装jdbcutils\"><a class=\"markdownIt-Anchor\" href=\"#封装jdbcutils\">#</a> 封装 JDBCUtils</h2>\n<p>示意图:</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051440736.png\" alt=\"image-20240105143722652\"></p>\n<ul>\n<li>构建 JDBCUtils 工具类</li>\n</ul>\n<p>思路:</p>\n<blockquote>\n<ol>\n<li>编写属性 (4 个) 分别为 (driver,url,user,password) 并且声明字段为私有，静态类型成员变量</li>\n<li>编写一个 static 静态代码块，方法体中编写：Properties 对象，用于读取相关的属性，(driver,url,user,password), 将抛出的异常编写为运行时异常，这样，即可以选择处理也可以选择默认处理，比较方便</li>\n<li>编写连接数据库的 Connection 方法并且这个方法为返回值类型返回 Connection 类，命名为 getConnection, 方法体中编写 return 返回 DriverManager.getConnection (url,user,password); 抛出异常也为运行时异常</li>\n<li>关闭相关资源，编写方法四个参数分为在调用这个方法时关闭所需要关闭的流，如果有不需要关闭的则置为 null 即可</li>\n</ol>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dkx<span class=\"token punctuation\">.</span>jdbcutils</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FileInputStream</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Properties</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Jdbcutils</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// 定义相关的属性（4 个）因为只需要一份，因此，为 static</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> driver<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> url<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> user<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">Properties</span> properties <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Properties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        properties<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"src//re.Properties\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">// 读取相关的属性</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>             driver <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"driver\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>             url <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"url\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>             user <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>             password <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>             <span class=\"token comment\">// 注册驱动</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>             <span class=\"token class-name\">Class</span><span class=\"token punctuation\">.</span><span class=\"token function\">forName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"driver\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token comment\">// 在实际开发中，可以将编译异常转成运行时异常</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token comment\">// 调用者可以选择捕获该异常，也可以选择默认处理，比较方便</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token comment\">// 连接数据库，返回 Connection</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Connection</span> getConnection <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token class-name\">DriverManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span>user<span class=\"token punctuation\">,</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token comment\">// 关闭相关资源</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    1.ResultSet 结果集</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    2.Statement 或者 PreparedStatement</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    3.Connection</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    4. 如果需要关闭资源，就传入对象，否则传入 null</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> close <span class=\"token punctuation\">(</span><span class=\"token class-name\">ResultSet</span> set<span class=\"token punctuation\">,</span> <span class=\"token class-name\">PreparedStatement</span> preparestatement<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Connection</span> connection<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token comment\">// 判断是否为 null</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>set <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                set<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>preparestatement <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                preparestatement<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span><span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>编写执行 SQL 类</li>\n</ul>\n<p>思路:</p>\n<blockquote>\n<p>编写一个方法，方法体中编写</p>\n<ol>\n<li>得到连接创建 Connection 对象</li>\n<li>编写一条 SQL 执行语句</li>\n<li>编写 PreparedStatement 对象，执行 SQL 语句</li>\n<li>得到 PreparedStatement 对象返回的结果</li>\n<li>最后通过 JDBCUtils 类调用 close 方法来传入需要关闭的流没有则置为 null</li>\n</ol>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dkx<span class=\"token punctuation\">.</span>jdbcutils</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Connection</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">PreparedStatement</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Jdbcutils_use</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// 实例化对象</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">var</span> ar <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Jdbcutils_use</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 对象调用方法执行操作数据库</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        ar<span class=\"token punctuation\">.</span><span class=\"token function\">test_connector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> test_connector <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">//1. 得到连接</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">//2. 编写一条 SQL 语句</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"insert into admin values (?,?)\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">//3. 创建 PreparedStatement 对象，扩大 PrearedStatement 的作用域</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">PreparedStatement</span> preparedstatement <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            connection <span class=\"token operator\">=</span> <span class=\"token class-name\">Jdbcutils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            preparedstatement <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">prepareStatement</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">// 给占位符进行赋值</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">setString</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"张三\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">setString</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"123\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"添加成功~\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"添加失败!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">finally</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token comment\">// 关闭资源</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token class-name\">Jdbcutils</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>preparedstatement<span class=\"token punctuation\">,</span>connection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>总结:</p>\n<blockquote>\n<ul>\n<li>\n<p>编写两个类一个为工具类，一个为执行 SQL 语句的类</p>\n</li>\n<li>\n<p>工具类中定义静态成员变量，并私有化防止外部程序破坏，编写静态代码块用于在类被加载时加载一次，方法体中编写 Properties 读取配置文件中的相关信息，并返回给私有静态成员变量</p>\n</li>\n<li>\n<p>工具类中编写，读取配置文件类，并在静态代码块中注册驱动，编写连接数据库的方法，通过类名调用返回连接数据库的信息，编写关闭相关资源的方法，都为静态方法方便使用类名直接调用而不实例化类</p>\n</li>\n<li>\n<p>执行 SQL 语句类：编写一个方法，方法体中创建 Connection 对象由 JDBCUtils 工具类调用 getConnection 获取链接数据库的信息，编写 PreparedStatemen 执行 SQL,PreparedStatement 对象调用 setXxx 对占位符进行赋值，最后 fianlly 代码块中 JDBCUtils 工具类调用 close 方法传入需要关闭的相关资源</p>\n</li>\n</ul>\n</blockquote>\n<h2 id=\"事务\"><a class=\"markdownIt-Anchor\" href=\"#事务\">#</a> 事务</h2>\n<p><strong>基本介绍:</strong></p>\n<ol>\n<li>JDBC 程序中当一个 Connection 对象创建时，默认情况下是自动提交事务的：每次执行一个 SQL 语句时，如果执行成功，就会像数据库自动提交，而不能回滚</li>\n<li>JDBC 程序中为了让多个 SQL 语句作为一个整体执行，需要使用事务</li>\n<li>调用 Connection 的 setAutoCommit (false) 可以取消自动提交事务</li>\n<li>在所有的 SQL 语句都成功执行后，调用 commit ( ); 方法提交事务</li>\n<li>在其中某个操作失败或出现异常时，调用 rollback ( ); 方法回滚事务</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>方法</th>\n<th>功能声明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>setAutoCommit(false)</td>\n<td>开启或禁用事务的自动提交事务</td>\n</tr>\n<tr>\n<td>commit(  );</td>\n<td>使自上次提交 / 回滚以来所做的所有更改成为永久更改<br>并释放此 Connection 对象当前持有的所有数据库锁<br>仅在禁用自动提交模式时才应使用此方法</td>\n</tr>\n<tr>\n<td>rollback(  );</td>\n<td>撤销当前事务中所做的所有更改，并释放此 Connection<br>对象当前持有的所有数据库锁，仅在禁用自动提交模式时才<br>应使用此方法<br>异常 SQLException : 如果发生数据库访问错误，则在参与分布式<br>事务时调用此方法，此方法在已关闭的链接上调用，或者此<br>Connection 对象处于自动提交模式</td>\n</tr>\n<tr>\n<td>rollback(Savepoint savepoint);</td>\n<td>取消在设置给定的 Savepoint 对象后所做的所有更改<br>仅在禁用自动提交事务时才应使用此方法<br>异常 SQLException : 如果发生数据库访问错误，则在参与分布式事务时调用此方法，在关闭的链接上调用此方法，Savepoint 对象不再<br>有效，或者此 Connection 对象当前处于自动提交模式<br>SQLFeatureNotSupporedException - 如果 JDBC 驱动程序不<br>支持此方法</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>transaction</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>music<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">JDBCUtils</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Connection</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">PreparedStatement</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Scanner</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Salary_test</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">var</span> ar <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Salary_test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        ar<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> test <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">Scanner</span> sc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"转账金额:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">Double</span> salary <span class=\"token operator\">=</span> sc<span class=\"token punctuation\">.</span><span class=\"token function\">nextDouble</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">Scanner</span> sc1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"转账者:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token class-name\">String</span> name <span class=\"token operator\">=</span> sc1<span class=\"token punctuation\">.</span><span class=\"token function\">nextLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"收账者:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">String</span> name1 <span class=\"token operator\">=</span> sc1<span class=\"token punctuation\">.</span><span class=\"token function\">nextLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">PreparedStatement</span> preparedstatement <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"update `salary` set salary = salary - ? where name = ?\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token class-name\">String</span> sql1 <span class=\"token operator\">=</span> <span class=\"token string\">\"update `salary` set salary = salary + ? where name = ?\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            connection <span class=\"token operator\">=</span> <span class=\"token class-name\">JDBCUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 在默认情况下，Connection 是默认自动提交的</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token comment\">// 将 connection 设置为不自动提交事务</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            connection<span class=\"token punctuation\">.</span><span class=\"token function\">setAutoCommit</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 开启了事务</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            preparedstatement <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">prepareStatement</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">setDouble</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>salary<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">setString</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token comment\">// 程序报错...</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">/</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            preparedstatement <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">prepareStatement</span><span class=\"token punctuation\">(</span>sql1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">setDouble</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>salary<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">setString</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span>name1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            connection<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token operator\">?</span> <span class=\"token string\">\"转账成功\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"转账失败\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token comment\">// 这里我们可以进行回滚，即撤销执行的 SQL 操作</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token comment\">// 默认回滚到事务开始的状态</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"执行操作有错误,事务已经回滚\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                connection<span class=\"token punctuation\">.</span><span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> er<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                er<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">finally</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            <span class=\"token class-name\">JDBCUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">,</span>preparedstatement<span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"批处理\"><a class=\"markdownIt-Anchor\" href=\"#批处理\">#</a> 批处理:</h3>\n<p><strong>基本介绍:</strong></p>\n<ol>\n<li>\n<p>当需要成批插入或者更新新纪录时，可以采用 Java 的批量更新机制，这一机制允许多条 SQL 语句一次性提交给数据库批量处理，通常情况下单独提交处理更有效</p>\n</li>\n<li>\n<p>JDBC 的批量处理语句包括下面方法:</p>\n<p><font color = red> <code>addBatch(  );</code>  添加需要批量处理的语句</font></p>\n<p><font color = red> <code>executeBatch(  );</code>  执行批量处理语句</font></p>\n<p><font color = red> <code>clearBatch(  );</code>  清空批处理包的语句</font></p>\n</li>\n<li>\n<p>JDBC 连接 MySQL 时，如果要使用批处理功能，请再 url 中加参数？rewriteBatchedStatements=true</p>\n<p>批处理必须指定这个参数否则将会无效</p>\n</li>\n<li>\n<p>批处理往往和 PreparedStatement 一起搭配使用，可以既减少编译次数，又减少运行次数，效率大大提高</p>\n</li>\n</ol>\n<p>代码演示:</p>\n<p>时间对比:</p>\n<p>传统方式：执行用时：8423</p>\n<p>批量处理方式：执行用时：954</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> test <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">PreparedStatement</span> preparedstatement <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"insert into `salary` values (?,?)\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">long</span> start <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            connection <span class=\"token operator\">=</span> <span class=\"token class-name\">JDBCUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            preparedstatement <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">prepareStatement</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"添加中...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">&lt;</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">setString</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"张三\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">setDouble</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token operator\">+</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"添加完毕\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token keyword\">long</span> pause <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"执行用时:\"</span><span class=\"token operator\">+</span><span class=\"token punctuation\">(</span>pause <span class=\"token operator\">-</span> start<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 执行用时：8423</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">finally</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token class-name\">JDBCUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">,</span>preparedstatement<span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> test1 <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token class-name\">PreparedStatement</span> preparedstatement <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"insert into `salary` values (?,?)\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">long</span> start <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            connection <span class=\"token operator\">=</span> <span class=\"token class-name\">JDBCUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            preparedstatement <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">prepareStatement</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"添加中...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">&lt;</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">setString</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"张三\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">setDouble</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token operator\">+</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">addBatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">==</span> <span class=\"token number\">4999</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                    preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">executeBatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                    preparedstatement<span class=\"token punctuation\">.</span><span class=\"token function\">clearBatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"添加完毕\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token keyword\">long</span> pause <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"执行用时:\"</span><span class=\"token operator\">+</span><span class=\"token punctuation\">(</span>pause <span class=\"token operator\">-</span> start<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 执行用时：954</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"数据库连接池\"><a class=\"markdownIt-Anchor\" href=\"#数据库连接池\">#</a> 数据库连接池</h2>\n<p>传统获取 Connection 问题分析</p>\n<ol>\n<li>传统的 JDBC 数据库连接使用 DriverManager 来获取，每次向数据库建立连接的时候都要将 Connection 加载到内存中，再验证<font color = blue><strong>IP 地址</strong></font>,<font color = blue><strong>用户名</strong></font>和<font color = blue><strong>密码</strong></font>,(0.05s~1sTime), 需要数据库连接的时候，就向数据库要求一个，频繁的进行数据库连接操作将占用很多的系统资源，容易造成服务器崩溃</li>\n<li>每一次数据库连接，使用完后都得断开，如果程序出现异常而未能关闭，将导致数据库<font color =blue><strong>内存泄露</strong></font>, 最终将导致重启数据库</li>\n<li>传统获取连接的方式，不能控制创建的连接数量，如连接过多，也可能导致<font color =blue>内<strong>存泄露</strong></font>,MySQL 崩溃</li>\n<li>解决传统开发中的数据库连接问题，可以采用<font color = red><strong>数据库连接池技术 (connection pool)</strong></font></li>\n</ol>\n<hr>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051440613.png\" alt=\"image-20221027183545806\"></p>\n<h3 id=\"数据库连接池基本介绍\"><a class=\"markdownIt-Anchor\" href=\"#数据库连接池基本介绍\">#</a> 数据库连接池基本介绍</h3>\n<ol>\n<li>\n<p>预先在缓冲池中存放入一定数量的连接，当需要建立数据库连接时，只需从 &quot;缓冲池&quot; 中取出一个，使用完毕之后再放回去</p>\n</li>\n<li>\n<p>数据库连接池负责分配，管理和释放数据库链接，它允许应用程序<font color = red><strong>重复使用</strong></font>一个现有的数据库连接，而不是重新建立一个</p>\n</li>\n<li>\n<p>当应用程序向连接池请求的连接数超过最大连接数量时，这些请求将被加入到等待队列中</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051438797.png\" alt=\"image-20240105143808707\"></p>\n</li>\n</ol>\n<h3 id=\"数据库连接池种类\"><a class=\"markdownIt-Anchor\" href=\"#数据库连接池种类\">#</a> 数据库连接池种类</h3>\n<ol>\n<li>JDBC 的数据库连接池使用 javax.sql.DataSource 来表示，DataSource 只是一个接口，该接口通常由第三方提供实现</li>\n<li><font color = green>C3P0</font>数据库连接池，速度相对较慢，稳定性不错 (hibernate,spring)</li>\n<li>DBCP 数据库连接池，速度相对 C3P0 较快，但不稳定</li>\n<li>Proxool 数据库连接池，有监控连接池状态的功能，稳定性较 iCP 差一点</li>\n<li>BoneCP 数据库连接池，速度快</li>\n<li><font color = grenn>Druid (德鲁伊)</font> 是阿里提供的数据库连接池，集 DBCP,C3P0,Proxool 优点于一身的数据库连接池</li>\n</ol>\n<h3 id=\"c3p0使用\"><a class=\"markdownIt-Anchor\" href=\"#c3p0使用\">#</a> C3P0 使用:</h3>\n<ol>\n<li>将 c3p0-0.9.5.5.bin.zip 包解压，使用指令</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">unzip</span> c3p0-0.9.5.5.bin.zip</pre></td></tr></table></figure><ol start=\"2\">\n<li>\n<p>cd 进入解压后的 zip 包找到 lib 包进入找到 c3p0-0.9.5.5.jar 的包和 mchange-commons-java-0.2.19.jar 包</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051438556.png\" alt=\"image-20240105143827227\"></p>\n</li>\n<li>\n<p>copy 将这两个包都 paste 到 IDEA 的 libs 文件夹中</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051438827.png\" alt=\"image-20240105143840760\"></p>\n</li>\n<li>\n<p>再将 libs 文件夹导入到项目中</p>\n</li>\n</ol>\n<p>右键文件夹点击 Add as Library…</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051441766.png\" alt=\"image-20240105143907300\"></p>\n<p>确定好要导入的项目后点击 OK</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051441143.png\" alt=\"image-20240105143916710\"></p>\n<p>c3p0-0.9.5.5-config.xml 文件配置信息</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>c3p0-config</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">&lt;!-- 使用默认的配置读取连接池对象 --></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>named-config</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dkx_123<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token comment\">&lt;!--  连接参数 --></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>driverClass<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>com.mysql.jdbc.Driver<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span><span class=\"token comment\">&lt;!-- 这是你的数据库驱动 --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 这是你的数据库，当然如果是本地连接也可把 localhost:3303 给删掉 --></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>jdbcUrl<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>jdbc:mysql://localhost:3306/Demo?characterEncoding=utf-8<span class=\"token entity named-entity\" title=\"&amp;\">&amp;amp;</span>serverTimezone=UTC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 这是你的数据库账号 密码 --></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>user<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>root<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>root<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 连接池参数 --></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>initialPoolSize<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>5<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span><span class=\"token comment\">&lt;!-- 初始化连接数 --></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>maxPoolSize<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>10<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span><span class=\"token comment\">&lt;!-- 最大连接数 --></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>checkoutTimeout<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>3000<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span><span class=\"token comment\">&lt;!-- 超时时间      --></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>named-config</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">&lt;!-- 这是自定义的配置，如果想用这个配置        创建的时候这样写就好了    javax.sql.DataSource com  = new ComboPooledDataSource (\"outerc3p0\");--></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">&lt;!-- 这属性同上 --></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>named-config</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>otherc3p0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token comment\">&lt;!--  连接参数 --></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>driverClass<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>com.mysql.jdbc.Driver<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>jdbcUrl<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>jdbc:mysql://localhost:3306/mysql<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>user<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>root<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 连接池参数 --></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>initialPoolSize<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>5<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>maxPoolSize<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>checkoutTimeout<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>1000<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>named-config</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>c3p0-config</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>代码:</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>testconnection</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>mchange<span class=\"token punctuation\">.</span>v2<span class=\"token punctuation\">.</span>c3p0<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ComboPooledDataSource</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">PropertyVetoException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FileInputStream</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Connection</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SQLException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Properties</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">C3P0_test</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">PropertyVetoException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SQLException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// 方式 1: 相关参数，在程序中指定 user,url,password 等</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">ComboPooledDataSource</span> combopooleddatasource <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ComboPooledDataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// 通过配置文件 re.Properties 获取相关连接的信息</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">Properties</span> properties <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Properties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        properties<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"src//re.Properties\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token comment\">// 读取相关的属性值</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token class-name\">String</span> driver <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"driver\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">String</span> url <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"url\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">String</span> user <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token class-name\">String</span> password <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token comment\">// 给数据源 ComboPooledDataSource 设置相关参数</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\">// 注意：连接管理是由 ComboPooledDataSource 来管理</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        combopooleddatasource<span class=\"token punctuation\">.</span><span class=\"token function\">setDriverClass</span><span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        combopooleddatasource<span class=\"token punctuation\">.</span><span class=\"token function\">setJdbcUrl</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        combopooleddatasource<span class=\"token punctuation\">.</span><span class=\"token function\">setUser</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        combopooleddatasource<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token comment\">// 设置初始化连接数</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        combopooleddatasource<span class=\"token punctuation\">.</span><span class=\"token function\">setInitialPoolSize</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token comment\">// 设置最大连接数</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        combopooleddatasource<span class=\"token punctuation\">.</span><span class=\"token function\">setMaxPoolSize</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token comment\">// 测试连接池的效率   测试对 MySQL 操作 5000 次</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"连接成功...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token keyword\">long</span> start <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">&lt;</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token comment\">// 这个方法就是从 DataSource 接口实现</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> combopooleddatasource<span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">long</span> end <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token comment\">//C3P0 5000 次操作 执行耗时：1002</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"C3P0 5000 次操作 执行耗时:\"</span><span class=\"token operator\">+</span><span class=\"token punctuation\">(</span>end <span class=\"token operator\">-</span> start<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>使用配置文件连接</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> test <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">// 创建 ComboPooledDataSource 对象 构造器中赋值连接的 named-config : Name</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">ComboPooledDataSource</span> combopooleddatasource <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ComboPooledDataSource</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx_123\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"连接成功\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">long</span> start <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">&lt;</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token comment\">// 通过 ComboPooledDataSource 对象调用 getConnection 进行连接数据库</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> combopooleddatasource<span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token comment\">// 关闭数据库连接，释放资源</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">long</span> end <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// 执行耗时：966</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"执行耗时:\"</span><span class=\"token operator\">+</span><span class=\"token punctuation\">(</span>end <span class=\"token operator\">-</span> start<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"mysql8使用c3p0连接配置\"><a class=\"markdownIt-Anchor\" href=\"#mysql8使用c3p0连接配置\">#</a> Mysql8 使用 c3p0 连接配置</h3>\n<p>目录结构 (参考)</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240311151041197.png\" alt=\"image-20240311151041197\"></p>\n<p>编写 c3p0-config.xml 文件</p>\n<p>将该文件放到 src 目录下 (普通工程)</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>c3p0-config</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">&lt;!-- 使用默认的配置读取连接池对象 --></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>default-config</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 连接参数 --></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>driverClass<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>com.mysql.cj.jdbc.Driver<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>jdbcUrl<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>jdbc:mysql://localhost:3306/?characterEncoding=utf-8<span class=\"token entity named-entity\" title=\"&amp;\">&amp;amp;</span>serverTimezone=UTC<span class=\"token entity named-entity\" title=\"&amp;\">&amp;amp;</span>useUnicode=true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>user<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>root<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 连接池参数 --></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>initialPoolSize<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>5<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>maxPoolSize<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>10<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>checkoutTimeout<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>3000<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>default-config</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>c3p0-config</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>JdbcUtils 类</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JdbcUtils</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">//c3p0 数据库连接池对象属性</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ComboPooledDataSource</span> ds <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ComboPooledDataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 获取连接</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Connection</span> <span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token keyword\">return</span> ds<span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SQLException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// 释放资源</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">release</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AutoCloseable</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> ios<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">AutoCloseable</span> io <span class=\"token operator\">:</span> ios<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>io <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                    io<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token comment\">// 提交事务并释放资源</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">commitAndClose</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Connection</span> conn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>conn <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token comment\">// 提交事务</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                conn<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token comment\">// 释放资源</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                conn<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SQLException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token comment\">// 回滚事务并释放资源</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">rollbackAndClose</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Connection</span> conn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>conn <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token comment\">// 回滚事务</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                conn<span class=\"token punctuation\">.</span><span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                <span class=\"token comment\">// 释放资源</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                conn<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SQLException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"使用案例\"><a class=\"markdownIt-Anchor\" href=\"#使用案例\">#</a> 使用案例</h4>\n<p>dao</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccountDao</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// 转出</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">out</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> outUser<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> money<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"update account set money = money - ? where name = ?\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token class-name\">JdbcUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">PreparedStatement</span> pstm <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">prepareStatement</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">setInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">setString</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> outUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">JdbcUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">release</span><span class=\"token punctuation\">(</span>pstm<span class=\"token punctuation\">,</span> connection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// 转入</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">in</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> inUser<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> money<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"update account set money = money + ? where name = ?\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token class-name\">JdbcUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">PreparedStatement</span> pstm <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">prepareStatement</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">setInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">setString</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> inUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">JdbcUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">release</span><span class=\"token punctuation\">(</span>pstm<span class=\"token punctuation\">,</span> connection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>service</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccountService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// 转账</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> outUser<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> inUser<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> money<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">AccountDao</span> ad <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AccountDao</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token comment\">// 转出</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            ad<span class=\"token punctuation\">.</span><span class=\"token function\">out</span><span class=\"token punctuation\">(</span>outUser<span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token comment\">// 转入</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            ad<span class=\"token punctuation\">.</span><span class=\"token function\">in</span><span class=\"token punctuation\">(</span>inUser<span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SQLException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>main</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token comment\">// 模拟数据：Jack 给 Rose 转账 100 元</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">String</span> outUser <span class=\"token operator\">=</span> <span class=\"token string\">\"Jack\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">String</span> inUser <span class=\"token operator\">=</span> <span class=\"token string\">\"Rose\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">int</span> money <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token class-name\">AccountService</span> service <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AccountService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token keyword\">boolean</span> result <span class=\"token operator\">=</span> service<span class=\"token punctuation\">.</span><span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span>outUser<span class=\"token punctuation\">,</span> inUser<span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">==</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"转账失败\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"转账成功\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>执行结果：</p>\n<pre><code>转账成功\n</code></pre>\n<h3 id=\"druid使用\"><a class=\"markdownIt-Anchor\" href=\"#druid使用\">#</a> Druid 使用</h3>\n<p>druid.Properties 配置文件</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key attr-name\">driverClassName</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">com.mysql.jdbc.Driver</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key attr-name\">url</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">jdbc:mysql://localhost:3306/Demo?rewriteBathedStatements=true</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key attr-name\">username</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">root</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key attr-name\">password</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">dkx</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key attr-name\">initialSize</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">10</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key attr-name\">minIdle</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">5</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key attr-name\">maxActive</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">20</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key attr-name\">maxWait</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">5000</span></pre></td></tr></table></figure><p>如果使用上述的配置信息出现了无法创建连接则使用下面的配置信息</p>\n<p>原因：MySQL 版本问题</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key attr-name\">driverClassName</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">com.mysql.cj.jdbc.Driver</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key attr-name\">url</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">jdbc:mysql://localhost:3306/day14?characterEncoding=utf-8&amp;serverTimezone=UTC</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key attr-name\">username</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">root</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key attr-name\">password</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">dkx</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key attr-name\">initialSize</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">10</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key attr-name\">minIdle</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">5</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key attr-name\">maxActive</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">20</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key attr-name\">maxWait</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">5000</span></pre></td></tr></table></figure><ul>\n<li>Druid 连接与 C3P0 连接测试</li>\n<li>Druid: 执行耗时: 3629</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>testconnection</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>druid<span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DruidDataSourceFactory</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataSource</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FileInputStream</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Connection</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Properties</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Druid</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">//1. 加入 Druid.jar 包</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">//2. 加入配置文件 druid.Propertis, 将该文件拷贝项目的 src 目录</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">//3. 创建 Properties 对象，读取配置文件</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">Properties</span> properties <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Properties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        properties<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"src//druid.Properties\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">//4. 创建一个指定参数的数据库连接池</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">DataSource</span> druiddatasourcefactory <span class=\"token operator\">=</span> <span class=\"token class-name\">DruidDataSourceFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">createDataSource</span><span class=\"token punctuation\">(</span>properties<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">long</span> start <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">&lt;</span> <span class=\"token number\">5000000</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> druiddatasourcefactory<span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">long</span> end <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Druid执行耗时:\"</span><span class=\"token operator\">+</span><span class=\"token punctuation\">(</span>end <span class=\"token operator\">-</span> start<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//Druid 执行耗时：3629</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"执行结束!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>C3P0 执行耗时: 17491</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>testconnection</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>mchange<span class=\"token punctuation\">.</span>v2<span class=\"token punctuation\">.</span>c3p0<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ComboPooledDataSource</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Connection</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SQLException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">C3P0_test</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">ComboPooledDataSource</span> combopooleddatasource <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ComboPooledDataSource</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx_123\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"连接成功\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">long</span> start <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">5000000</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token comment\">// 通过 ComboPooledDataSource 对象调用 getConnection 进行连接数据库</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> combopooleddatasource<span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token comment\">// 关闭数据库连接，释放资源</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">long</span> end <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token comment\">// 执行耗时：966</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"执行耗时:\"</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>end <span class=\"token operator\">-</span> start<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 执行耗时：17491</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"resultset复用引出问题\"><a class=\"markdownIt-Anchor\" href=\"#resultset复用引出问题\">#</a> ResultSet 复用，引出问题</h2>\n<ol>\n<li>关闭 Connection 后，ResultSet 结果集无法使用</li>\n<li>ResultSet 不利于数据的管理</li>\n</ol>\n<p>示意图:</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051441188.png\" alt=\"image-20240105143932367\"></p>\n<h4 id=\"使用土办法完成封装来解决问题\"><a class=\"markdownIt-Anchor\" href=\"#使用土办法完成封装来解决问题\">#</a> 使用土办法完成封装来解决问题:</h4>\n<ul>\n<li>代码演示:</li>\n</ul>\n<p>JDBCUtils_Druid 工具类</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>druidtest</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>druid<span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DruidDataSourceFactory</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataSource</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FileInputStream</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Connection</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">PreparedStatement</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ResultSet</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Properties</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JDBCUtils_Druid</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">//        定义获取数据库连接对象</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">DataSource</span> druid<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token comment\">// 创建 Properties 类读取配置文件信息</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token class-name\">Properties</span> properties <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Properties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token comment\">// 读取指定位置的配置文件</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token class-name\">InputStream</span> in <span class=\"token operator\">=</span> <span class=\"token class-name\">JDBCUtils_Druid</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getClassLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getResourceAsStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"druid.Properties\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            properties<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token comment\">// 将读取到配置文件的信息赋值到 DataSource 对象中</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            druid <span class=\"token operator\">=</span> <span class=\"token class-name\">DruidDataSourceFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">createDataSource</span><span class=\"token punctuation\">(</span>properties<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token comment\">// 定义连接方法返回 Connection 连接</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Connection</span> getConnection <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token keyword\">return</span> druid<span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token comment\">// 关闭连接，如果没有需要关闭则赋值为 null</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Connection</span> connection<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ResultSet</span> resultset<span class=\"token punctuation\">,</span> <span class=\"token class-name\">PreparedStatement</span> set<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>resultset <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                resultset<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>set <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                set<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Actor 封装 ResultSet 结果集，解决 ResultSet 复用问题，因为 List 和 Connection 没有任何关联，所以该集合可以复用，即使关闭 Connection 连接，也不会影响到 List</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>druidtest</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Date</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">//Actor 对象对应 Demo 表</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Actor</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">//Javabean,DoJO,Domain 对象</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// 定义表中对应的字段信息</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> sex<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Date</span> borndata<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> phone<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Actor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token comment\">// 一定要给一个无参构造器 [底层反射需要]</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">// 创建一个有参构造用于获取字段的信息</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Actor</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> sex<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Date</span> borndata<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> phone<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sex <span class=\"token operator\">=</span> sex<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>borndata <span class=\"token operator\">=</span> borndata<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>phone <span class=\"token operator\">=</span> phone<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Integer</span> <span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">return</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setId</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">return</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Date</span> <span class=\"token function\">getBorndata</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">return</span> borndata<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setBorndata</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Date</span> borndata<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>borndata <span class=\"token operator\">=</span> borndata<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getPhone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token keyword\">return</span> phone<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setPhone</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> phone<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>phone <span class=\"token operator\">=</span> phone<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token comment\">// 重写 toString 返回字符串类型的对象信息</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"牛马：&#123;\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token string\">\"id=\"</span> <span class=\"token operator\">+</span> id <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token string\">\", name='\"</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token string\">\", sex='\"</span> <span class=\"token operator\">+</span> sex <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token string\">\", borndata=\"</span> <span class=\"token operator\">+</span> borndata <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token string\">\", phone='\"</span> <span class=\"token operator\">+</span> phone <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token char\">'&#125;'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>测试类</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>druidtest</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Connection</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Date</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">PreparedStatement</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ResultSet</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">LinkedList</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Druidtest_two</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">PreparedStatement</span> statement <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">ResultSet</span> resultset <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">// 创建一个 List 集合对象用于存储 ResultSet 获取到的字段的信息，解决 ResultSet 复用问题</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Actor</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LinkedList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// 编写一个 SQL 语句</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"select * from Demo\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span><span class=\"token comment\">//try 将可能存在的异常抛出</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token comment\">// 通过 JDBCUtils_Druid 类调用 getConnecion 方法获取连接返回 Connection 对象</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            connection <span class=\"token operator\">=</span> <span class=\"token class-name\">JDBCUtils_Druid</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token comment\">// 创建 PreparedStatement 对象将 SQL 语句发送给数据库</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            statement <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">prepareStatement</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token comment\">// 通过 PreparedStatement 对象调用 executeQuery 来获取返回的结果</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            resultset <span class=\"token operator\">=</span> statement<span class=\"token punctuation\">.</span><span class=\"token function\">executeQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>resultset<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span><span class=\"token comment\">//resultset 调用 next 每次执行指针向下移动获取下一个信息，如果没有信息则返回 false</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token comment\">// 通过调用 getXxx 获取对应的数据类型</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token class-name\">Integer</span> id <span class=\"token operator\">=</span> resultset<span class=\"token punctuation\">.</span><span class=\"token function\">getInt</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                <span class=\"token class-name\">String</span> name <span class=\"token operator\">=</span> resultset<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token class-name\">String</span> sex <span class=\"token operator\">=</span> resultset<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sex\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token class-name\">Date</span> date <span class=\"token operator\">=</span> resultset<span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"borndata\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token class-name\">String</span> phone <span class=\"token operator\">=</span> resultset<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"phone\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token comment\">// 把得到的 ResultSet 的记录，封装到 Actor 对象，放入到 List 集合中</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                list<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Actor</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span>name<span class=\"token punctuation\">,</span>sex<span class=\"token punctuation\">,</span>date<span class=\"token punctuation\">,</span>phone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Actor</span> i<span class=\"token operator\">:</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token comment\">// 通过封装可以完成随意取数据的效果</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token comment\">//                System.out.print(i.getId());</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">//                System.out.print(i.getName());</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">finally</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            <span class=\"token comment\">// 调用 JDBCUtils_Druid 的 close 方法传入需要关闭的连接对象，关闭流释放资源</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token class-name\">JDBCUtils_Druid</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">,</span>resultset<span class=\"token punctuation\">,</span>statement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>通过封装可以完成随意取数据的效果，在取数据的时候调用 Actor 类中的 get 方法来获取字段的信息</p>\n<p>下面介绍 Apche-DBUtils 工具类解决问题</p>\n<h2 id=\"apche-dbutils\"><a class=\"markdownIt-Anchor\" href=\"#apche-dbutils\">#</a> Apche-DBUtils</h2>\n<p><font color = blue><strong>基本介绍</strong></font></p>\n<ol>\n<li>commons-dbutils 是 Apche 组织提供的一个开源 JDBC 工具类库，它是对 JDBC 的封装，使用 dbutils 能极大简化 jdbc 编码的工作量</li>\n</ol>\n<p><font size = 4,font color ><strong>dbutils 类</strong></font></p>\n<ol>\n<li>QueryRunner 类：该类封装了 SQL 的执行，是线程安全的，可以实现增，删，改，查，批处理</li>\n<li>使用 QueryRunner 类实现查询</li>\n<li>ResultSetHandler 接口：该接口用于处理 java.sql.ResultSet , 将数据按要求转换为另一种形式</li>\n</ol>\n<p><font size = 4,font color = blue> <code>ArrayHandler:</code> </font>把结果集的第一行数据转换成对象数组</p>\n<p><font size = 4,font color = blue> <code>ArrayListHandler:</code> </font>把结果集中的每一行数据都转成一个数组，再存放到 List 中</p>\n<p><font size = 4,font color = blue> <code>BeanHandler:</code> </font>将结果集中的第一行数据封装到一个对应的 JavaBean 实例中</p>\n<p><font size = 4,font color = blue> <code>BeanListHandler:</code> </font>将结果集中的每一行数据都封装到一个对应的 JavaBean 实例中，存放到 List 中</p>\n<p><font size = 4,font color = blue> <code>ColumnListHandler:</code> </font>将结果集中某一列的数据存放到 List 中</p>\n<p><font size = 4,font color = blue> <code>KeyeHandler(name):</code> </font>将结果集中的每行数据都封装到 Map 里，再把这些 Map 再存到一个 Map 里，其 key 为指定的 key</p>\n<p><font size = 4,font color = blue> <code>MapHandler:</code> </font>将结果集中的第一行数据封装到一个 Map 里，Key 是列名，Value 就是对应的值</p>\n<p><font size = 4,font color = blue> <code>MapListHandler:</code> </font>将结果集中的每一行数据都封装到一个 Map 里，然后再存放到 List</p>\n<p><strong>按照之前的方式将 jar 包导入到编译器的 libs 包中</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051439095.png\" alt=\"image-20240105143950011\"></p>\n<p>右键 libs 包点击 Add as Library…</p>\n<ul>\n<li>代码演示:</li>\n</ul>\n<p><strong>JDBCUtils_Druid 工具类</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>druidtest<span class=\"token punctuation\">.</span>fuxi</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>druid<span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DruidDataSourceFactory</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataSource</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FileInputStream</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Connection</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">PreparedStatement</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ResultSet</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Properties</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>这是一个 JDBCUtils 工具类</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JDBCUtils_Druid</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">DataSource</span> druid<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">static</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token class-name\">Properties</span> properties <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Properties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            properties<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"src//druid.Properties\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            druid <span class=\"token operator\">=</span> <span class=\"token class-name\">DruidDataSourceFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">createDataSource</span><span class=\"token punctuation\">(</span>properties<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Connection</span> <span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token keyword\">return</span> druid<span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Connection</span> connection<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ResultSet</span> set<span class=\"token punctuation\">,</span> <span class=\"token class-name\">PreparedStatement</span> set1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>set <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                set<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>set1 <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                set1<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>Actor 实体类:</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>druidtest</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">LocalDateTime</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">//Actor 对象对应 Demo 表</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Actor</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">//Javabean,DoJO,Domain 对象</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// 定义表中对应的字段信息</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> sex<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LocalDateTime</span> borndata<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> phone<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Actor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token comment\">// 一定要给一个无参构造器 [底层反射需要]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// 创建一个有参构造用于获取字段的信息</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Actor</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> sex<span class=\"token punctuation\">,</span><span class=\"token class-name\">LocalDateTime</span> borndata<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> phone<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sex <span class=\"token operator\">=</span> sex<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>borndata <span class=\"token operator\">=</span> borndata<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>phone <span class=\"token operator\">=</span> phone<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Integer</span> <span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">return</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setId</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">return</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">LocalDateTime</span> <span class=\"token function\">getBorndata</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">return</span> borndata<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setBorndata</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">LocalDateTime</span> borndata<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>borndata <span class=\"token operator\">=</span> borndata<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getPhone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">return</span> phone<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setPhone</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> phone<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>phone <span class=\"token operator\">=</span> phone<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token comment\">// 重写 toString 返回字符串类型的对象信息</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"牛马：&#123;\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token string\">\"牛马id=\"</span> <span class=\"token operator\">+</span> id <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token string\">\", 牛马name='\"</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token string\">\", 牛马sex='\"</span> <span class=\"token operator\">+</span> sex <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token string\">\", 牛马borndata=\"</span> <span class=\"token operator\">+</span> borndata <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token string\">\", 牛马phone='\"</span> <span class=\"token operator\">+</span> phone <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token char\">'&#125;'</span><span class=\"token operator\">+</span><span class=\"token string\">\"真Tm的牛马报错就TM离谱\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>测试类:</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">comr<span class=\"token punctuation\">.</span>acx<span class=\"token punctuation\">.</span>dbutils</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>druidtest<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Actor</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>druidtest<span class=\"token punctuation\">.</span>fuxi<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">JDBCUtils_Druid</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>commons<span class=\"token punctuation\">.</span>dbutils<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">QueryRunner</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>commons<span class=\"token punctuation\">.</span>dbutils<span class=\"token punctuation\">.</span>handlers<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">BeanListHandler</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Connection</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DBUtils</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// 使用 Apache-DBUtils 工具类 + Druid 完成对表的 crud 操作</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> main <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">//1. 得到连接 (Druid)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            connection <span class=\"token operator\">=</span> <span class=\"token class-name\">JDBCUtils_Druid</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token comment\">//2. 使用 DBUtils 类和接口，先引入 DBUtils 相关的 jar, 加入到本 Project</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token comment\">//3. 创建 QueryRunner</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token class-name\">QueryRunner</span> queryrunner <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryRunner</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token comment\">// 编写 SQL 语句</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"select * from Demo where id >= ?\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">//4. 可以执行相关的方法，返回 ArrayList 结果集</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token comment\">//connection: 连接</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">//sql:SQL 语句</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token comment\">//new BeanListHandler&lt;>(Actor.class): 将 ResultSet -> Actor 对象 -> 封装到 ArrayList</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token comment\">// 底层使用反射机制，去获取 Actor 类的属性，然后进行封装</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token comment\">//49: 给 SQL 语句中的占位符 (?) 赋值，可以有多个值，因为是可变参数</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Actor</span><span class=\"token punctuation\">></span></span> query <span class=\"token operator\">=</span> queryrunner<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">,</span> sql<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BeanListHandler</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Actor</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Actor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">49</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Actor</span> i<span class=\"token operator\">:</span>query<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">finally</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token comment\">//ResultSet,PreparedStatement query 底层已经帮我们关闭了所以就不用再次关闭了</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token class-name\">JDBCUtils_Druid</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>查询单行单列 : <font color = blue size = 4> <code>ScalarHandler</code> </font></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">comr<span class=\"token punctuation\">.</span>acx<span class=\"token punctuation\">.</span>dbutils</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>druidtest<span class=\"token punctuation\">.</span>fuxi<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">JDBCUtils_Druid</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>commons<span class=\"token punctuation\">.</span>dbutils<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">QueryRunner</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>commons<span class=\"token punctuation\">.</span>dbutils<span class=\"token punctuation\">.</span>handlers<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ScalarHandler</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Connection</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DBUtils_Scalar</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token comment\">// 通过 JDBCUtils_Druid 调用 getConnection 方法获取连接</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            connection <span class=\"token operator\">=</span> <span class=\"token class-name\">JDBCUtils_Druid</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token comment\">// 创建 QueryRunner 实例</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token class-name\">QueryRunner</span> queryrunner <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryRunner</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token comment\">// 返回单行单列，返回的就是 Object</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"select name from Demo where id = ?\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token comment\">// 查询单行单列的结果使用 ScalarHandler</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token comment\">// 因为返回的是一个对象，使用 Handler 就是 ScalarHandler</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token class-name\">Object</span> query <span class=\"token operator\">=</span> queryrunner<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">,</span> sql<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ScalarHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">49</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">finally</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token comment\">//DBUtils 底层关闭了 ResultSet 和 PreparedStatement 只需要关闭 Connection</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token class-name\">JDBCUtils_Druid</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>执行 DML 语句 : <font size = 4 color = blue> <code>update</code> </font>(insert , delete , update)</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">comr<span class=\"token punctuation\">.</span>acx<span class=\"token punctuation\">.</span>dbutils</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>druidtest<span class=\"token punctuation\">.</span>fuxi<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">JDBCUtils_Druid</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>commons<span class=\"token punctuation\">.</span>dbutils<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">QueryRunner</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Connection</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DBUtils_DML</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token comment\">// 通过 JDBCUtils_Druid 调用 getConnection 方法获取连接</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            connection <span class=\"token operator\">=</span> <span class=\"token class-name\">JDBCUtils_Druid</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token comment\">// 创建 QueryRunner 实例</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token class-name\">QueryRunner</span> queryrunner <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryRunner</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token comment\">// 编写 SQL 语句，并添加占位符</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"insert into Demo values (?,?,?,?,?)\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token comment\">// 通过 QueryRunner 对象调用 update 传入参数并填写对应的占位符的信息</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> queryrunner<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">,</span>sql<span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"流桑\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"男\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"1998-12-11\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"111222000\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"添加成功\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"添加失败\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">finally</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token comment\">// 通过 JDBCUtils_Druid 调用 close 方法传入需要关闭的流对象</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token class-name\">JDBCUtils_Druid</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Apache-DBUtils</p>\n<ul>\n<li>表和 JavaBean 的类型映射关系</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051440858.png\" alt=\"image-20240105144004359\"></p>\n<h2 id=\"dao和增删改查通用方法-basicdao\"><a class=\"markdownIt-Anchor\" href=\"#dao和增删改查通用方法-basicdao\">#</a> DAO 和增删改查通用方法 - BasicDao</h2>\n<p>先分析一个问题</p>\n<p>Apache-DBUtils+Druid 简化了 JDBC 开发，但还有不足</p>\n<ol>\n<li>\n<p>SQL 语句是固定，不能通过参数传入，通用性不好，需要进行改进，更方便执行<font color = red size = 4>增删改查</font></p>\n</li>\n<li>\n<p>对于 <code>select</code>  操作，如果有返回值，返回类型不能固定，需要使用泛型</p>\n</li>\n<li>\n<p>将来的表很多，业务需求复杂，不可能只靠一个 Java 类完成</p>\n</li>\n</ol>\n<p><font color = blue size = 4>示意图:</font></p>\n<p><strong>DAO 和增删改查通用方法 - BasicDAO</strong></p>\n<p><strong>基本说明:</strong></p>\n<ol>\n<li>DAO : data access object 访问数据对象</li>\n<li>这样的通用类，称为 BasicDAO, 是专门和数据库交互的，即完成对数据库 (表) 的 crud 操作</li>\n<li>在 BasicDAO 的基础上，实现一张表，对应一个 DAO, 更好的完成功能，比如 Customer 表 - Customer.java 类 (JavaBean)-CustomerDAO.java</li>\n</ol>\n<ul>\n<li>定义 JDBCUtils_Druid 工具类</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">comr<span class=\"token punctuation\">.</span>acx<span class=\"token punctuation\">.</span>uti<span class=\"token punctuation\">.</span>utils</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>druid<span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DruidDataSourceFactory</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataSource</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FileInputStream</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Connection</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">PreparedStatement</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ResultSet</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Properties</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JDBCUtils_Druid</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>     * @comments 定义 DataSource 变量</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">DataSource</span> druid<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>     * @comments 定义静态代码块当类加载时加载这个方法执行 Properties 读取配置文件的信息</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">Properties</span> properties <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Properties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            properties<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"src//druid.Propeties\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            druid <span class=\"token operator\">=</span> <span class=\"token class-name\">DruidDataSourceFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">createDataSource</span><span class=\"token punctuation\">(</span>properties<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>     * @comments 创建连接方法</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>     * @return 返回连接结果</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Connection</span> <span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token keyword\">return</span> druid<span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>     * @comments 创建关闭需要关闭的流对象的方法</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>     * @param connection 关闭 Connection 对象流</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>     * @param set 关闭 ResultSet 对象流</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>     * @param statment 关闭 PreparedStatement 对象流</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Connection</span> connection<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ResultSet</span> set<span class=\"token punctuation\">,</span> <span class=\"token class-name\">PreparedStatement</span> statment<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>set <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                set<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>statment <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                statment<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>定义 BasicDAO 类</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">comr<span class=\"token punctuation\">.</span>acx<span class=\"token punctuation\">.</span>uti<span class=\"token punctuation\">.</span>dao</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">comr<span class=\"token punctuation\">.</span>acx<span class=\"token punctuation\">.</span>uti<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">JDBCUtils_Druid</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>commons<span class=\"token punctuation\">.</span>dbutils<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">QueryRunner</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>commons<span class=\"token punctuation\">.</span>dbutils<span class=\"token punctuation\">.</span>handlers<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">BeanHandler</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>commons<span class=\"token punctuation\">.</span>dbutils<span class=\"token punctuation\">.</span>handlers<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">BeanListHandler</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>commons<span class=\"token punctuation\">.</span>dbutils<span class=\"token punctuation\">.</span>handlers<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ScalarHandler</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Connection</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">//BasicDAO 是其它 DAO 的父类</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * @param &lt;T> 泛型</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BasicDAO</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">QueryRunner</span> que <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryRunner</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">// 通用的 DML 方法，针对任意的表</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>     * @param sql SQL 语句</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>     * @param parameters 为占位符赋值</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>     * @return 返回结果，返回执行成功的个数</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">DML</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> sql<span class=\"token punctuation\">,</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>parameters<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            connection <span class=\"token operator\">=</span> <span class=\"token class-name\">JDBCUtils_Druid</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            i <span class=\"token operator\">=</span> que<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">,</span>sql<span class=\"token punctuation\">,</span>parameters<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">finally</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token class-name\">JDBCUtils_Druid</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token keyword\">return</span> i<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token comment\">// 返回多个对象 (即查询的结果是多行的), 针对任意的表</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>     * @param sql SQL 语句，可以有占位符</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>     * @param clazz 传入一个类的 Class 对象，比如 Actor.class</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>     * @param parameters 传入占位符具体的值</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>     * @return 根据 Actor.class 类型返回 ArrayList 集合</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">DQLtwo</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> sql<span class=\"token punctuation\">,</span><span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> clazz<span class=\"token punctuation\">,</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>parameters<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            connection <span class=\"token operator\">=</span> <span class=\"token class-name\">JDBCUtils_Druid</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            list <span class=\"token operator\">=</span> que<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">,</span> sql<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BeanListHandler</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>clazz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> parameters<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">finally</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token class-name\">JDBCUtils_Druid</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token keyword\">return</span> list<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token comment\">// 查询单行结果 (i)</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>     * @param sql SQL 语句</pre></td></tr><tr><td data-num=\"65\"></td><td><pre>     * @param clazz 传入一个类的 Class 对象，比如 Actor</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>     * @param parameters 给占位符赋值</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>     * @return 返回泛型结果</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">T</span> <span class=\"token class-name\">DQLSingle</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> sql<span class=\"token punctuation\">,</span><span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> clazz<span class=\"token punctuation\">,</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>parameters<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token class-name\">T</span> i <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>            connection <span class=\"token operator\">=</span> <span class=\"token class-name\">JDBCUtils_Druid</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>            i <span class=\"token operator\">=</span> que<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">,</span>sql<span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BeanHandler</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>clazz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>parameters<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">finally</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>            <span class=\"token class-name\">JDBCUtils_Druid</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>        <span class=\"token keyword\">return</span> i<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>    <span class=\"token comment\">// 查询单列结果 (一个)</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"84\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"85\"></td><td><pre>     * @param sql SQL 语句</pre></td></tr><tr><td data-num=\"86\"></td><td><pre>     * @param parameters 为占位符赋值</pre></td></tr><tr><td data-num=\"87\"></td><td><pre>     * @return 返回结果</pre></td></tr><tr><td data-num=\"88\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token class-name\">DQLUniseriate</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> sql<span class=\"token punctuation\">,</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>parameters<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>        <span class=\"token class-name\">Object</span> query <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>            connection <span class=\"token operator\">=</span> <span class=\"token class-name\">JDBCUtils_Druid</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>            query <span class=\"token operator\">=</span> que<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">,</span> sql<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ScalarHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> parameters<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">finally</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>            <span class=\"token class-name\">JDBCUtils_Druid</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>        <span class=\"token keyword\">return</span> query<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>定义 Actor 实体类</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">comr<span class=\"token punctuation\">.</span>acx<span class=\"token punctuation\">.</span>uti<span class=\"token punctuation\">.</span>domain</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">LocalDateTime</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Actor</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     * 定义字段对应表的列类型</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> sex<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LocalDateTime</span> borndata<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> phone<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>     * 定义一个无参构造器初始化 [底层反射需要]</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Actor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>     * 定义有参构造器为字段进行赋值</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>     * @param id</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>     * @param name</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>     * @param sex</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>     * @param date</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>     * @param phone</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Actor</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span> sex<span class=\"token punctuation\">,</span><span class=\"token class-name\">LocalDateTime</span> date<span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span> phone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sex <span class=\"token operator\">=</span> sex<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>borndata <span class=\"token operator\">=</span> date<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>phone <span class=\"token operator\">=</span> phone<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>     *@Comment 定义 get,set 方法，方法的返回值类型和字段类型和名称都要对应表中的列数据不然获取不      * 到</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>     * @param id</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setId</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Integer</span> <span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token keyword\">return</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token keyword\">return</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setSex</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> sex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sex <span class=\"token operator\">=</span> sex<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getSex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token keyword\">return</span> sex<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setPhone</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> phone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>phone <span class=\"token operator\">=</span> phone<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getPhone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token keyword\">return</span> phone<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>     * @return 返回字符串类型的对象信息</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token string\">\"Actor&#123;\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>            <span class=\"token string\">\"id=\"</span> <span class=\"token operator\">+</span> id <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>            <span class=\"token string\">\", name='\"</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>            <span class=\"token string\">\", sex='\"</span> <span class=\"token operator\">+</span> sex <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>            <span class=\"token string\">\", borndata=\"</span> <span class=\"token operator\">+</span> borndata <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>            <span class=\"token string\">\", phone='\"</span> <span class=\"token operator\">+</span> phone <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>            <span class=\"token char\">'&#125;'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>创建 ActorDAO 类继承 BasicDAO 类</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">comr<span class=\"token punctuation\">.</span>acx<span class=\"token punctuation\">.</span>uti<span class=\"token punctuation\">.</span>dao</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">comr<span class=\"token punctuation\">.</span>acx<span class=\"token punctuation\">.</span>uti<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Actor</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ActorDAO</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BasicDAO</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Actor</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     * 1. 因为 ActorDAO 继承了 BasicDAO 就有 BasicDAO 所有的方法，可以使用方法完成相应的操作</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>     * 2. 如果业务比较复杂也可以再 ActorDAO 中写特有的方法，根据业务需要可以编写特有的方法</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>测试类</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ActorTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>       <span class=\"token comment\">// 创建 DAO 类</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">ActorDAO</span> dao <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ActorDAO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>       <span class=\"token comment\">// 编写 SQL 语句</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"select * from user where username = ? and password = ?\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> \t\t <span class=\"token comment\">// 通过 DAO 类对象名调用 QueryRunner.query (sql,clazz,parameter);</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Actor</span><span class=\"token punctuation\">></span></span> actor <span class=\"token operator\">=</span> <span class=\"token class-name\"><span class=\"token namespace\">dao<span class=\"token punctuation\">.</span></span>DQLtwo</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Actor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"superbaby\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"123\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>       <span class=\"token comment\">// 遍历出查询借故</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Actor</span> i <span class=\"token operator\">:</span> actor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>思路:</p>\n<ul>\n<li>JDBCUtils_Druid 工具类</li>\n</ul>\n<p>编写，读取配置文件方法，连接方法，关闭流方法</p>\n<ul>\n<li>Actor 实体类</li>\n</ul>\n<p>将从配置文件中读取到的信息赋值到字段中，解决 ResultSet 复用问题</p>\n<ul>\n<li>BasicDAO 所有 DAO 的父类</li>\n</ul>\n<p>定义操作方法，并定义 T 泛型因为不确定它的类型，它是所有 DAO 类的父类</p>\n<ul>\n<li>ActorDAO 继承 BasicDAO 的子类</li>\n</ul>\n<p>继承 BasicDAO 类，定义 BasicDAO 的泛型，可以根据业务需要在这个类中定义特有方法</p>\n<ul>\n<li>TestActor 测试类</li>\n</ul>\n<p>实例化 ActorDAO 即可编写 SQL 语句执行操作表 3</p>\n</blockquote>\n",
            "tags": [
                "计算机学科",
                "介绍",
                "database",
                "JDBC"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/JDBC/JDBC%E5%85%A5%E9%97%A8/",
            "url": "https://pigpigletsgo.github.io/homepage/2024/04/02/computer-science/database/JDBC/JDBC%E5%85%A5%E9%97%A8/",
            "title": "JDBC入门",
            "date_published": "2024-04-02T06:23:30.016Z",
            "content_html": "<p>将 mysql-connector-java-8.0.28-1.el7.noarch.rpm 传输到 Linux 后，使用命令解压</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">rpm</span> <span class=\"token parameter variable\">-zxvf</span> mysql-connector-java-8.0.28-1.el7.noarch.rpm</pre></td></tr></table></figure><p>一般解压后在路径: usr/java/mysql-connection-java.jar 中找到 jar 包然后进行下面的操作</p>\n<ol>\n<li>创建 libs 文件夹</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051443047.png\" alt=\"image-20240105144307979\"></p>\n<ol start=\"2\">\n<li>\n<p>找到 mysql-connector.jar 驱动，将其 copy 到 libs 文件夹中</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051443505.png\" alt=\"image-20240105144318634\"></p>\n</li>\n</ol>\n<p>拷贝到 libs 文件夹中，点击 ok</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051443763.png\" alt=\"image-20240105144329724\"></p>\n<ol start=\"3\">\n<li>右击 libs 文件夹选择 Add as Library…</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051442929.png\" alt=\"image-20221024194150947\"></p>\n<ol start=\"4\">\n<li>查看除了项目位置其它默认不用更改查看完毕后点击 ok</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051442703.png\" alt=\"image-20221024194254614\"></p>\n<ol start=\"5\">\n<li>代码</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>ar</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>mysql<span class=\"token punctuation\">.</span>jdbc<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Driver</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Connection</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SQLException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Statement</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Properties</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Jdbc_test</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 一，注册驱动</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">Driver</span> driver <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Driver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// 二，得到连接</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">// 解读:jdbc:mysql:// 规定好表示协议，通过 jdbc 连接 MySQL</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">//(1) local 表示主机地址，可以是 ip 地址</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">//(2) 3306 端口号，如果远程端口号发生了变化，那么这个端口号也需要改变</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">//(3) dkx 表示要连接到的数据库</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token comment\">//MySQL 的连接本质就是 sokcet 连接</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token class-name\">String</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"jdbc:mysql://localhost:3306/Demo\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\">// 将用户名和密码放入到 Properties 配置文件中</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">Properties</span> properties <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Properties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">//user 和 password 是规定好的，第二个值跟据实际情况</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token comment\">// 设置用户</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        properties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"root\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// 设置密码</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        properties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">// 跟据给定的 url 连接数据库</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connect <span class=\"token operator\">=</span> driver<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> properties<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token comment\">// 三，执行 sql 语句</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"insert into Demo values (null,'刘德华','男','1970-12-11','110')\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token comment\">//statement 用于执行静态 SQL 语句并返回其生成对象</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token class-name\">Statement</span> statement <span class=\"token operator\">=</span> connect<span class=\"token punctuation\">.</span><span class=\"token function\">createStatement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token comment\">// 返回是否添加成功结果</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> statement<span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"成功\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"失败\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token comment\">// 四，关闭连接资源</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        statement<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        connect<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><font color=red>** 示意图 **</font></p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051442727.png\" alt=\"image-20221024194843385\"></p>\n<p>执行完成后</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051442628.png\" alt=\"image-20221024194347938\"></p>\n<p>查看一下 MySQL 的变化</p>\n<p><img src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401051442386.png\" alt=\"image-20221024194417196\"></p>\n<p>完成！</p>\n",
            "tags": [
                "计算机学科",
                "基础",
                "database",
                "JDBC"
            ]
        }
    ]
}