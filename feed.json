{
    "version": "https://jsonfeed.org/version/1",
    "title": "D ã® Javaå°çª",
    "subtitle": "åˆ«æ€•è·¯é•¿æ¢¦è¿œ",
    "icon": "https://pigpigletsgo.github.io/images/favicon.ico",
    "description": "æ¬¢è¿æ¥æˆ‘çš„åšå®¢ç©ºé—´",
    "home_page_url": "https://pigpigletsgo.github.io",
    "items": [
        {
            "id": "https://pigpigletsgo.github.io/computer-science/linux/%E5%9F%BA%E7%A1%80/%E8%AE%BE%E7%BD%AE%E5%88%9D%E5%A7%8B%E5%8C%96root%E7%94%A8%E6%88%B7/",
            "url": "https://pigpigletsgo.github.io/computer-science/linux/%E5%9F%BA%E7%A1%80/%E8%AE%BE%E7%BD%AE%E5%88%9D%E5%A7%8B%E5%8C%96root%E7%94%A8%E6%88%B7/",
            "title": "è®¾ç½®/åˆå§‹åŒ–rootç”¨æˆ·",
            "date_published": "2024-03-14T06:32:17.227Z",
            "content_html": "<h1 id=\"è®¾ç½®åˆå§‹åŒ–rootç”¨æˆ·\"><a class=\"anchor\" href=\"#è®¾ç½®åˆå§‹åŒ–rootç”¨æˆ·\">#</a> è®¾ç½® / åˆå§‹åŒ– root ç”¨æˆ·</h1>\n<p>ã€è®¾ç½® root ç”¨æˆ·å¯†ç ã€‘<br />\né»˜è®¤å®‰è£…å¥½çš„ linux ç³»ç»Ÿæ˜¯æ²¡æœ‰è®¾ç½® root ç”¨æˆ·å¯†ç çš„ï¼Œä¸‹é¢ä»‹ç»å¦‚ä½•è®¾ç½® root ç”¨æˆ·çš„å¯†ç ã€‚</p>\n<p>ç”±äº Linux ç³»ç»Ÿé»˜è®¤æ˜¯æ²¡æœ‰æ¿€æ´» root ç”¨æˆ·çš„ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è¿›è¡Œæ“ä½œï¼Œæ­¥éª¤ä¹Ÿéå¸¸ç®€å•ï¼Œåœ¨å‘½ä»¤è¡Œç•Œé¢ï¼ˆç»ˆç«¯ï¼‰ä¸­è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">passwd</span> æˆ–è€… <span class=\"token function\">sudo</span> <span class=\"token function\">passwd</span> root</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Passwordï¼š ä½ å½“å‰ç”¨æˆ·çš„å¯†ç </pre></td></tr><tr><td data-num=\"4\"></td><td><pre> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Enter new UNIX passwordï¼š è®¾ç½®æ˜¯ root ç”¨æˆ·çš„å¯†ç </pre></td></tr><tr><td data-num=\"6\"></td><td><pre> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Retype new UNIX passwordï¼šé‡å¤ä»¥ä¸Š root ç”¨æˆ·çš„å¯†ç </pre></td></tr></table></figure>",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "linux",
                "åŸºç¡€",
                "linux",
                "è®¡ç®—æœºå­¦ç§‘"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/%E6%A1%88%E4%BE%8BDemo/SpringBoot+MultipartFile%E4%B8%8A%E4%BC%A0%E6%98%BE%E7%A4%BA%E5%A4%B4%E5%83%8F/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/%E6%A1%88%E4%BE%8BDemo/SpringBoot+MultipartFile%E4%B8%8A%E4%BC%A0%E6%98%BE%E7%A4%BA%E5%A4%B4%E5%83%8F/",
            "title": "SpringBootä¸Šä¼ å¤´åƒå›æ˜¾å¤´åƒåˆ°é¡µé¢",
            "date_published": "2024-03-14T01:53:04.679Z",
            "content_html": "<p>å·¥å…·ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Random</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">UUID</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UploadUtils</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     * è·å–æ–‡ä»¶çœŸå®åç§°</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     * ç”±äºæµè§ˆå™¨çš„ä¸åŒè·å–çš„åç§°å¯èƒ½ä¸º:c:/upload/1.jpg æˆ–è€… 1.jpg</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>     * æœ€ç»ˆè·å–çš„ä¸º  1.jpg</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>     * @param name ä¸Šä¼ ä¸Šæ¥çš„æ–‡ä»¶åç§°</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     * @return çœŸå®åç§°</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getRealName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">// è·å–æœ€åä¸€ä¸ª \"/\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">int</span> index <span class=\"token operator\">=</span> name<span class=\"token punctuation\">.</span><span class=\"token function\">lastIndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\\\\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> name<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span>index <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>     * è·å–éšæœºåç§°</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>     * @param realName çœŸå®åç§°</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>     * @return uuid éšæœºåç§°</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getUUIDName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> realName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token comment\">//realname  å¯èƒ½æ˜¯  1sfasdf.jpg   ä¹Ÿå¯èƒ½æ˜¯ 1sfasdf 1</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\">// è·å–åç¼€å</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">int</span> index <span class=\"token operator\">=</span> realName<span class=\"token punctuation\">.</span><span class=\"token function\">lastIndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>       <span class=\"token comment\">//        uuId ä¸­å–åˆ°çš„éšå³åå­—ä¸­å¸¦æœ‰ - å°†æ‰€æœ‰çš„ - å»é™¤æ‰</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>index <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token constant\">UUID</span><span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token constant\">UUID</span><span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> realName<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>     * è·å–æ–‡ä»¶ç›®å½•ï¼Œå¯ä»¥è·å– 256 ä¸ªéšæœºç›®å½•</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>     * @return éšæœºç›®å½•</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getDir</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token class-name\">String</span> s <span class=\"token operator\">=</span> <span class=\"token string\">\"0123456789ABCDEF\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token class-name\">Random</span> r <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token comment\">/// éšæœºåˆ°çš„å­—ç¬¦ / éšæœºåˆ°çš„å­—ç¬¦</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"/\"</span> <span class=\"token operator\">+</span> s<span class=\"token punctuation\">.</span><span class=\"token function\">charAt</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"/\"</span> <span class=\"token operator\">+</span> s<span class=\"token punctuation\">.</span><span class=\"token function\">charAt</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Mapper</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Mapper</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserMapper</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">int</span> <span class=\"token function\">updateAvatar</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Mapper.xml</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- é€šè¿‡ç”¨æˆ· id æ›´æ–°å¤´åƒ --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>update</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>updateAvatar<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.domain.User<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   update taobao.user set avatar = #&#123;avatar&#125; where id = #&#123;id&#125;</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>update</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>å¯¹åº” user è¡¨ç»“æ„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20230511091602576.png\" alt=\"image-20230511091602576\" /></p>\n<p>Service</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">boolean</span> <span class=\"token function\">updateAvatar</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ServiceImpl</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserMapper</span> mapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">updateAvatar</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">int</span> flag <span class=\"token operator\">=</span> mapper<span class=\"token punctuation\">.</span><span class=\"token function\">updateAvatar</span><span class=\"token punctuation\">(</span>u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">return</span> flag <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token boolean\">true</span> <span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Controller</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@Controller</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserService</span> service<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"/upload\"</span> <span class=\"token punctuation\">,</span> method <span class=\"token operator\">=</span> <span class=\"token class-name\">RequestMethod</span><span class=\"token punctuation\">.</span><span class=\"token constant\">POST</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">addAvatar</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MultipartFile</span> file<span class=\"token punctuation\">,</span><span class=\"token class-name\">HttpSession</span> session<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">//        è·å–æ–‡ä»¶çš„å†…å®¹</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">InputStream</span> is <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">//        è·å–åŸå§‹æ–‡ä»¶å</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">String</span> original <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span><span class=\"token function\">getOriginalFilename</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">String</span> fileName <span class=\"token operator\">=</span> original<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span>original<span class=\"token punctuation\">.</span><span class=\"token function\">lastIndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>original<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">// åˆ¤æ–­ç”¨æˆ·ä¼ å…¥çš„æ–‡ä»¶åç¼€åæ˜¯å¦æ˜¯å›¾ç‰‡</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>fileName<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".png\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> fileName<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".gif\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> fileName<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".jpg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">//        ç”Ÿæˆä¸€ä¸ª uuid åç§°</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token class-name\">String</span> uuidFileName <span class=\"token operator\">=</span> <span class=\"token class-name\">UploadUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getUUIDName</span><span class=\"token punctuation\">(</span>fileName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">//        ç”Ÿæˆéšæœºç›®å½•</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token class-name\">String</span> randomDir <span class=\"token operator\">=</span> <span class=\"token class-name\">UploadUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDir</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token class-name\">File</span> fileDir <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"D:/updatefiles\"</span><span class=\"token operator\">+</span>randomDir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">//        åˆ¤æ–­æ–‡ä»¶å¤¹ä¸å­˜åœ¨åˆ™åˆ›å»º</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>fileDir<span class=\"token punctuation\">.</span><span class=\"token function\">exists</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                fileDir<span class=\"token punctuation\">.</span><span class=\"token function\">mkdirs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">//        åˆ›å»ºæ–°çš„æ–‡ä»¶å¤¹</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token class-name\">File</span> newFile <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"D:/updatefiles\"</span><span class=\"token operator\">+</span>randomDir<span class=\"token punctuation\">,</span>uuidFileName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>           <span class=\"token comment\">// è¯¥æ–¹æ³•æ˜¯ SpringMVC ä¸­å°è£…çš„å‡½æ•°ï¼Œç”¨äºå°† MultipartFile å¯¹è±¡å†…çš„æ–‡ä»¶è¾“å‡ºåˆ°å¯¹åº”çš„è·¯å¾„ä¸­</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            file<span class=\"token punctuation\">.</span><span class=\"token function\">transferTo</span><span class=\"token punctuation\">(</span>newFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token class-name\">String</span> savePath <span class=\"token operator\">=</span> randomDir <span class=\"token operator\">+</span> <span class=\"token string\">\"/\"</span> <span class=\"token operator\">+</span> uuidFileName<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">//        è·å–å½“å‰çš„ user</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">)</span> session<span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">//        è®¾ç½®å¤´åƒè·¯å¾„</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            user<span class=\"token punctuation\">.</span><span class=\"token function\">setAvatar</span><span class=\"token punctuation\">(</span>savePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\">//        è°ƒç”¨ä¸šåŠ¡æ›´æ–°</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            service<span class=\"token punctuation\">.</span><span class=\"token function\">updateAvatar</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token string\">\"redirect:/user/userInfo\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"redirect:/user/userInfo\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token class-name\">ResourceLoader</span> resourceLoader<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/get/&#123;dir1&#125;/&#123;dir2&#125;/&#123;filename:.+&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token class-name\">String</span> dir1<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                              <span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token class-name\">String</span> dir2<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                              <span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token class-name\">String</span> filename<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token comment\">//1. æ ¹æ®ç”¨æˆ·åå»è·å–ç›¸åº”çš„å›¾ç‰‡</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token class-name\">Path</span> path <span class=\"token operator\">=</span> <span class=\"token class-name\">Paths</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"D:/updatefiles\"</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"/\"</span> <span class=\"token operator\">+</span> dir1 <span class=\"token operator\">+</span> <span class=\"token string\">\"/\"</span> <span class=\"token operator\">+</span> dir2<span class=\"token punctuation\">,</span> filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token comment\">//2. å°†æ–‡ä»¶åŠ è½½è¿›æ¥</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token class-name\">Resource</span> resource <span class=\"token operator\">=</span> resourceLoader<span class=\"token punctuation\">.</span><span class=\"token function\">getResource</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"file:\"</span> <span class=\"token operator\">+</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token comment\">// è¿”å›å“åº”å®ä½“</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span>resource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/userInfo\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">userInfo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSession</span> session<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token class-name\">User</span> u <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">)</span> session<span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>u <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token string\">\"taobao\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>html</p>\n<p>é€šè¿‡å½“å‰çš„ input æ ‡ç­¾ this å¯¹è±¡è°ƒç”¨ files [0] è·å–æ•°ç»„ç¬¬ 0 ç´¢å¼•çš„æ•°æ®æ¥åˆ¤æ–­æ˜¯å¦å¯ç”¨ä¸Šä¼ æŒ‰é’®</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/user/upload<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">enctype</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>multipart/form-data<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>row<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>         <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token special-attr\"><span class=\"token attr-name\">onchange</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value javascript language-javascript\"><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'undefined'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span><span class=\"token function\">en</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span><span class=\"token function\">di</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span></span><span class=\"token punctuation\">\"</span></span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>         <span class=\"token entity named-entity\" title=\"&nbsp;\">&amp;nbsp;</span><span class=\"token entity named-entity\" title=\"&nbsp;\">&amp;nbsp;</span><span class=\"token entity named-entity\" title=\"&nbsp;\">&amp;nbsp;</span><span class=\"token entity named-entity\" title=\"&nbsp;\">&amp;nbsp;</span>ğŸ‘†<span class=\"token entity named-entity\" title=\"&nbsp;\">&amp;nbsp;</span><span class=\"token entity named-entity\" title=\"&nbsp;\">&amp;nbsp;</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">title</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>è¯·é€‰æ‹©å›¾ç‰‡åæ‰èƒ½ä½¿ç”¨ä¸Šä¼ æŒ‰é’®<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>å¤´åƒ<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>an_tou<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">disabled</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn btn-primary<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>å¤´åƒ<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>æ˜¾ç¤º img</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>touxiang<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>|@&#123;/user/get&#125;$&#123;session.user.avatar&#125;|<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>img-circle img-thumbnail<span class=\"token punctuation\">\"</span></span> <span class=\"token special-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value css language-css\"><span class=\"token property\">width</span><span class=\"token punctuation\">:</span>100px<span class=\"token punctuation\">;</span><span class=\"token property\">height</span><span class=\"token punctuation\">:</span>100px</span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>å¯èƒ½é‡åˆ°é—®é¢˜ - ä¸Šä¼ æ–‡ä»¶å¤§å°å—é™åˆ¶ - è§£å†³æ–¹å¼å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token key atrule\">servlet</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t<span class=\"token key atrule\">multipart</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t\tmax<span class=\"token punctuation\">-</span>file<span class=\"token punctuation\">-</span>size=100MB</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t\tmax<span class=\"token punctuation\">-</span>request<span class=\"token punctuation\">-</span>size=1000MB</pre></td></tr></table></figure><p>å¦‚æœæƒ³ä¸è®©æ–‡ä»¶å¤§å°å—é™åˆ¶ï¼Œå°† spring.servlet.multipart.max-file-size è¿™ä¸ªå‚æ•°è®¾ç½®ä¸º -1</p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "æ¡ˆä¾‹Demo",
                "springboot",
                "java",
                "è®¡ç®—æœºå­¦ç§‘",
                "æ¡ˆä¾‹Demo"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/%E5%A4%9A%E7%BA%BF%E7%A8%8B/ThreadLocal%E4%BB%8B%E7%BB%8D/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/%E5%A4%9A%E7%BA%BF%E7%A8%8B/ThreadLocal%E4%BB%8B%E7%BB%8D/",
            "title": "ThreadLocalä»‹ç»",
            "date_published": "2024-03-13T14:22:36.673Z",
            "content_html": "<h1 id=\"ä¸€-threadlocalä»‹ç»\"><a class=\"anchor\" href=\"#ä¸€-threadlocalä»‹ç»\">#</a> ä¸€ã€ThreadLocal ä»‹ç»</h1>\n<h2 id=\"11-ä»‹ç»\"><a class=\"anchor\" href=\"#11-ä»‹ç»\">#</a> 1.1 ä»‹ç»</h2>\n<p>ä» Java å®˜æ–¹æ–‡æ¡£ä¸­çš„æè¿°ï¼šThreadLocal ç±»ç”¨æ¥æä¾›çº¿ç¨‹å†…éƒ¨çš„å±€éƒ¨å˜é‡ã€‚è¿™ç§å˜é‡åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è®¿é—® (é€šè¿‡ get å’Œ set æ–¹æ³•è®¿é—®) æ—¶èƒ½ä¿è¯å„ä¸ªçº¿ç¨‹çš„å˜é‡ç›¸å¯¹ç‹¬ç«‹äºå…¶å®ƒçº¿ç¨‹å†…çš„å˜é‡ã€‚ThreadLocal å®ä¾‹é€šå¸¸æ¥è¯´éƒ½æ˜¯ private static ç±»å‹çš„ï¼Œç”¨äºå…³è”çº¿ç¨‹å’Œçº¿ç¨‹ä¸Šä¸‹æ–‡ã€‚</p>\n<p>æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ ThreadLocal çš„ä½œç”¨æ˜¯ï¼šæä¾›çº¿ç¨‹å†…çš„å±€éƒ¨å˜é‡ï¼Œä¸åŒçš„çº¿ç¨‹ä¹‹é—´ä¸ä¼šç›¸äº’å¹²æ‰°ï¼Œè¿™ç§å˜é‡åœ¨çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå†…èµ·ä½œç”¨ï¼Œå‡å°‘åŒä¸€ä¸ªçº¿ç¨‹å†…å¤šä¸ªå‡½æ•°æˆ–ç»„ä»¶ä¹‹é—´ä¸€äº›å…¬å…±å˜é‡ä¼ é€’çš„å¤æ‚åº¦ã€‚</p>\n<p>æ€»ç»“ï¼š</p>\n<ol>\n<li>çº¿ç¨‹å¹¶å‘ï¼šåœ¨å¤šçº¿ç¨‹å¹¶å‘çš„åœºæ™¯ä¸‹</li>\n<li>ä¼ é€’æ•°æ®ï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡ ThreadLocal åœ¨åŒä¸€çº¿ç¨‹ï¼Œä¸åŒç»„ä»¶ä¸­ä¼ é€’å…¬å…±å˜é‡</li>\n<li>çº¿ç¨‹éš”ç¦»ï¼šæ¯ä¸ªçº¿ç¨‹çš„å˜é‡éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¼šäº’ç›¸å½±å“</li>\n</ol>\n<h2 id=\"12-åŸºæœ¬ä½¿ç”¨\"><a class=\"anchor\" href=\"#12-åŸºæœ¬ä½¿ç”¨\">#</a> 1.2 åŸºæœ¬ä½¿ç”¨</h2>\n<h3 id=\"121-å¸¸ç”¨æ–¹æ³•\"><a class=\"anchor\" href=\"#121-å¸¸ç”¨æ–¹æ³•\">#</a> 1.2.1 å¸¸ç”¨æ–¹æ³•</h3>\n<p>åœ¨ä½¿ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è®¤è¯†å‡ ä¸ª ThreadLocal çš„å¸¸ç”¨æ–¹æ³•</p>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•å£°æ˜</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ThreadLocal()</td>\n<td>åˆ›å»º ThreadLocal å¯¹è±¡</td>\n</tr>\n<tr>\n<td>public void set(T value)</td>\n<td>è®¾ç½®å½“å‰çº¿ç¨‹ç»‘å®šçš„å±€éƒ¨å˜é‡</td>\n</tr>\n<tr>\n<td>public T get()</td>\n<td>è·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„å±€éƒ¨å˜é‡</td>\n</tr>\n<tr>\n<td>public void remove()</td>\n<td>ç§»é™¤å½“å‰çº¿ç¨‹ç»‘å®šçš„å±€éƒ¨å˜é‡</td>\n</tr>\n</tbody>\n</table>\n<p>ä»£ç æ¡ˆä¾‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * éœ€æ±‚ï¼šçº¿ç¨‹éš”ç¦»</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> *      åœ¨å¤šçº¿ç¨‹å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸­çš„å˜é‡éƒ½æ˜¯äº’ç›¸ç‹¬ç«‹</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> *      çº¿ç¨‹ Aï¼šè®¾ç½® (å˜é‡ 1) è·å– (å˜é‡ 1)</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> *      çº¿ç¨‹ A ä¸­è®¾ç½®äº†å˜é‡ 1 åæ¥è·å–çš„åªèƒ½æ˜¯å˜é‡ 1 å®ƒä¸èƒ½è·å–çº¿ç¨‹ B çš„å˜é‡ 2</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> *      çº¿ç¨‹ Bï¼šè®¾ç½® (å˜é‡ 2) è·å– (å˜é‡ 2)</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyDemo01</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> content<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">return</span> content<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setContent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> content<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>content <span class=\"token operator\">=</span> content<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">MyDemo01</span> demo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MyDemo01</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token class-name\">Thread</span> thread <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                    <span class=\"token comment\">// æ¯ä¸ªçº¿ç¨‹éƒ½åœ¨åšï¼šå­˜ä¸€ä¸ªå˜é‡ï¼Œè¿‡ä¸€ä¼šå„¿å–å‡ºå˜é‡</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                    demo<span class=\"token punctuation\">.</span><span class=\"token function\">setContent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" çš„æ•°æ®\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-----------------------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"--->\"</span> <span class=\"token operator\">+</span> demo<span class=\"token punctuation\">.</span><span class=\"token function\">getContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            thread<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"çº¿ç¨‹\"</span> <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// çº¿ç¨‹ 0 ~ 4</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            thread<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<pre><code>-----------------------------\nçº¿ç¨‹0---&gt;çº¿ç¨‹2 çš„æ•°æ®\n-----------------------------\n-----------------------------\n-----------------------------\nçº¿ç¨‹2---&gt;çº¿ç¨‹3 çš„æ•°æ®\nçº¿ç¨‹3---&gt;çº¿ç¨‹3 çš„æ•°æ®\n-----------------------------\nçº¿ç¨‹1---&gt;çº¿ç¨‹3 çš„æ•°æ®\nçº¿ç¨‹4---&gt;çº¿ç¨‹3 çš„æ•°æ®\n</code></pre>\n<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰“å°çš„ç»“æœæ˜¯ä¹±çš„ï¼Œçº¿ç¨‹ 0 å» å–å‡ºäº†çº¿ç¨‹ 2 çš„æ•°æ®ã€‚è¿™å°±æ˜¯çº¿ç¨‹ä¸éš”ç¦»çš„æƒ…å†µ</p>\n<h3 id=\"122-é€šè¿‡threadlocalè§£å†³çº¿ç¨‹ä¸éš”ç¦»æƒ…å†µ\"><a class=\"anchor\" href=\"#122-é€šè¿‡threadlocalè§£å†³çº¿ç¨‹ä¸éš”ç¦»æƒ…å†µ\">#</a> 1.2.2 é€šè¿‡ ThreadLocal è§£å†³çº¿ç¨‹ä¸éš”ç¦»æƒ…å†µ</h3>\n<p>ä½¿ç”¨æ¡ˆä¾‹ï¼š</p>\n<p>è¿˜æ˜¯ä¸Šé¢çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬è¿›è¡Œä¿®æ”¹æ¥æ„Ÿå—ä¸€ä¸‹ ThreadLocal çº¿ç¨‹éš”ç¦»çš„ç‰¹ç‚¹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * éœ€æ±‚ï¼šçº¿ç¨‹éš”ç¦»</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> *      åœ¨å¤šçº¿ç¨‹å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸­çš„å˜é‡éƒ½æ˜¯äº’ç›¸ç‹¬ç«‹</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> *      çº¿ç¨‹ Aï¼šè®¾ç½® (å˜é‡ 1) è·å– (å˜é‡ 1)</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> *      çº¿ç¨‹ A ä¸­è®¾ç½®äº†å˜é‡ 1 åæ¥è·å–çš„åªèƒ½æ˜¯å˜é‡ 1 å®ƒä¸èƒ½è·å–çº¿ç¨‹ B çš„å˜é‡ 2</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> *      çº¿ç¨‹ Bï¼šè®¾ç½® (å˜é‡ 2) è·å– (å˜é‡ 2)</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> *      ThreadLocalï¼š</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> *          1.set ()ï¼šå°†å˜é‡ç»‘å®šåˆ°å½“å‰çº¿ç¨‹ä¸­</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> *          2.get ()ï¼šè·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„å˜é‡</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> *          ä¹Ÿå°±æ˜¯è¯´å°†æŸä¸ªçº¿ç¨‹ä¸ªå®ƒçš„å˜é‡ç»‘å®šæ­»äº†ï¼Œç­‰çº¿ç¨‹ n è·å–å˜é‡åªä¼šè·å–åˆ°å®ƒæ‰€ç»‘å®šçš„å˜é‡ n, å°±ä¸ä¼šçº¿ç¨‹ä¹±ä¸²äº†</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyDemo01</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token class-name\">ThreadLocal</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> threadLocal <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ThreadLocal</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> content<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">//  è·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„å˜é‡</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">return</span> threadLocal<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setContent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> content<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token comment\">// å°† content å˜é‡ç»‘å®šåˆ°å½“å‰çº¿ç¨‹ä¸Š</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        threadLocal<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">MyDemo01</span> demo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MyDemo01</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token class-name\">Thread</span> thread <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                    <span class=\"token comment\">// æ¯ä¸ªçº¿ç¨‹éƒ½åœ¨åšï¼šå­˜ä¸€ä¸ªå˜é‡ï¼Œè¿‡ä¸€ä¼šå„¿å–å‡ºå˜é‡</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                    demo<span class=\"token punctuation\">.</span><span class=\"token function\">setContent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" çš„æ•°æ®\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-----------------------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"--->\"</span> <span class=\"token operator\">+</span> demo<span class=\"token punctuation\">.</span><span class=\"token function\">getContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            thread<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"çº¿ç¨‹\"</span> <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// çº¿ç¨‹ 0 ~ 4</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            thread<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<pre><code>-----------------------------\n-----------------------------\n-----------------------------\nçº¿ç¨‹2---&gt;çº¿ç¨‹2 çš„æ•°æ®\n-----------------------------\nçº¿ç¨‹3---&gt;çº¿ç¨‹3 çš„æ•°æ®\n-----------------------------\nçº¿ç¨‹0---&gt;çº¿ç¨‹0 çš„æ•°æ®\nçº¿ç¨‹4---&gt;çº¿ç¨‹4 çš„æ•°æ®\nçº¿ç¨‹1---&gt;çº¿ç¨‹1 çš„æ•°æ®\n</code></pre>\n<h2 id=\"13-threadlocalç±»ä¸synchronizedå…³é”®å­—\"><a class=\"anchor\" href=\"#13-threadlocalç±»ä¸synchronizedå…³é”®å­—\">#</a> 1.3 ThreadLocal ç±»ä¸ synchronized å…³é”®å­—</h2>\n<h3 id=\"131-synchronizedåŒæ­¥æ–¹å¼\"><a class=\"anchor\" href=\"#131-synchronizedåŒæ­¥æ–¹å¼\">#</a> 1.3.1 synchronized åŒæ­¥æ–¹å¼</h3>\n<p>è¿™é‡Œå¯èƒ½æœ‰çš„æœ‹å‹ä¼šè§‰å¾—åœ¨ä¸Šè¿°ä¾‹å­ä¸­æˆ‘ä»¬å®Œå…¨å¯ä»¥é€šè¿‡åŠ é”æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸‹ç”¨ synchronized ä»£ç å—å®ç°çš„æ•ˆæœï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyDemo02</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> content<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token comment\">//  è·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„å˜é‡</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">return</span> content<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setContent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> content<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// å°† content å˜é‡ç»‘å®šåˆ°å½“å‰çº¿ç¨‹ä¸Š</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>content <span class=\"token operator\">=</span> content<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">MyDemo02</span> demo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MyDemo02</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token class-name\">Thread</span> thread <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                    <span class=\"token comment\">// æ¯ä¸ªçº¿ç¨‹éƒ½åœ¨åšï¼šå­˜ä¸€ä¸ªå˜é‡ï¼Œè¿‡ä¸€ä¼šå„¿å–å‡ºå˜é‡</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                    <span class=\"token comment\">// å¯¹å½“å‰ç±»è¿›è¡ŒåŠ é”ï¼Œè®©å…¶åŒæ­¥æ‰§è¡Œ</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                    <span class=\"token keyword\">synchronized</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MyDemo02</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                        demo<span class=\"token punctuation\">.</span><span class=\"token function\">setContent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" çš„æ•°æ®\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-----------------------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"--->\"</span> <span class=\"token operator\">+</span> demo<span class=\"token punctuation\">.</span><span class=\"token function\">getContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            thread<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"çº¿ç¨‹\"</span> <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// çº¿ç¨‹ 0 ~ 4</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            thread<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<pre><code>-----------------------------\nçº¿ç¨‹0---&gt;çº¿ç¨‹0 çš„æ•°æ®\n-----------------------------\nçº¿ç¨‹4---&gt;çº¿ç¨‹4 çš„æ•°æ®\n-----------------------------\nçº¿ç¨‹2---&gt;çº¿ç¨‹2 çš„æ•°æ®\n-----------------------------\nçº¿ç¨‹1---&gt;çº¿ç¨‹1 çš„æ•°æ®\n-----------------------------\nçº¿ç¨‹3---&gt;çº¿ç¨‹3 çš„æ•°æ®\n</code></pre>\n<h4 id=\"é—®é¢˜\"><a class=\"anchor\" href=\"#é—®é¢˜\">#</a> é—®é¢˜</h4>\n<p>è™½ç„¶è§£å†³äº†çº¿ç¨‹ä¹±å–å˜é‡çš„æƒ…å†µï¼Œä½†æ˜¯æˆ‘ä»¬å¤±å»äº†ç¨‹åºçš„æ€§èƒ½ï¼Œå› ä¸ºåŠ é”ä¼šé€ æˆç¨‹åºçš„æ€§èƒ½é™ä½ï¼Œä¹‹æ‰€ä»¥ä¼šé™ä½æ˜¯å› ä¸ºåŠ é”çš„ä»£ç çº¿ç¨‹åªèƒ½æ’é˜Ÿå»æ‰§è¡Œï¼Œè¿™æ ·ç¨‹åºä¹Ÿå¤±å»äº†å¹¶å‘æ€§</p>\n<p>è¿™å°±æ˜¯éå¸¸é‡è¦çš„åŒºåˆ«ï¼Œè¿™ä¹Ÿè¯æ˜äº†è¿™ä¸ªæ¡ˆä¾‹ä¸­æ˜¯ä¸åˆé€‚ä½¿ç”¨ synchronized å…³é”®å­—çš„ï¼Œåº”è¯¥ä½¿ç”¨ ThreadLocal</p>\n<h3 id=\"132-threadlocalä¸synchronizedçš„åŒºåˆ«\"><a class=\"anchor\" href=\"#132-threadlocalä¸synchronizedçš„åŒºåˆ«\">#</a> 1.3.2 ThreadLocal ä¸ synchronized çš„åŒºåˆ«</h3>\n<p>è™½ç„¶ ThreadLocal æ¨¡å¼ä¸ synchronized å…³é”®å­—éƒ½ç”¨äºå¤„ç†å¤šçº¿ç¨‹å¹¶å‘è®¿é—®å˜é‡çš„é—®é¢˜ï¼Œä¸è¿‡ä¸¤è€…å¤„ç†é—®é¢˜çš„è§’åº¦å’Œæ€è·¯ä¸åŒ</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>synchronized</th>\n<th>ThreadLocal</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>åŸç†</td>\n<td>åŒæ­¥æœºåˆ¶é‡‡ç”¨ &quot;ä»¥æ—¶é—´æ¢ç©ºé—´&quot; &lt;br /&gt; çš„æ–¹å¼ï¼Œåªæä¾›äº†ä¸€ä»½å˜é‡ï¼Œè®©ä¸åŒçš„çº¿ç¨‹æ’é˜Ÿè®¿é—®</td>\n<td>ThreadLocal é‡‡ç”¨ &quot;ä»¥ç©ºé—´æ¢æ—¶é—´&quot; &lt;br /&gt; çš„æ–¹å¼ï¼Œä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æä¾›äº†ä¸€ä»½å˜é‡çš„ &lt; br /&gt; å‰¯æœ¬ï¼Œä»è€Œå®ç°åŒæ—¶è®¿é—®è€Œäº’ä¸å¹²æ‰°</td>\n</tr>\n<tr>\n<td>åˆ™é‡ç‚¹</td>\n<td>å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥</td>\n<td>å¤šçº¿ç¨‹ä¸­è®©æ¯ä¸ªçº¿ç¨‹ä¹‹é—´çš„æ•°æ®ç›¸äº’éš”ç¦»</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"æ€»ç»“\"><a class=\"anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“ï¼š</h4>\n<blockquote>\n<p>åœ¨åˆšåˆšçš„æ¡ˆä¾‹ä¸­ï¼Œè™½ç„¶ä½¿ç”¨ ThreadLocal å’Œ synchronized éƒ½èƒ½è§£å†³é—®é¢˜ï¼Œä½†æ˜¯ä½¿ç”¨ ThreadLocal æ›´ä¸ºåˆé€‚ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥ä½¿ç¨‹åºæ‹¥æœ‰æ›´é«˜çš„å¹¶å‘æ€§ã€‚</p>\n</blockquote>\n<h1 id=\"äºŒ-è¿ç”¨åœºæ™¯-äº‹åŠ¡æ¡ˆä¾‹\"><a class=\"anchor\" href=\"#äºŒ-è¿ç”¨åœºæ™¯-äº‹åŠ¡æ¡ˆä¾‹\">#</a> äºŒã€è¿ç”¨åœºæ™¯ - äº‹åŠ¡æ¡ˆä¾‹</h1>\n<p>é€šè¿‡ä»¥ä¸Šä»‹ç»ï¼Œæˆ‘ä»¬å·²ç»åŸºæœ¬äº†è§£ ThreadLocal çš„ç‰¹ç‚¹ã€‚ä½†æ˜¯å®ƒå…·ä½“æ˜¯è¿ç”¨åœ¨ä»€ä¹ˆåœºæ™¯ä¸­å‘¢ï¼Ÿæ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªæ¡ˆä¾‹ï¼šäº‹åŠ¡æ“ä½œ</p>\n<h2 id=\"21-è½¬è´¦æ¡ˆä¾‹-å¸¸è§„è§£å†³æ–¹æ¡ˆ\"><a class=\"anchor\" href=\"#21-è½¬è´¦æ¡ˆä¾‹-å¸¸è§„è§£å†³æ–¹æ¡ˆ\">#</a> 2.1 è½¬è´¦æ¡ˆä¾‹ - å¸¸è§„è§£å†³æ–¹æ¡ˆ</h2>\n<h3 id=\"211-åœºæ™¯æ„å»º\"><a class=\"anchor\" href=\"#211-åœºæ™¯æ„å»º\">#</a> 2.1.1 åœºæ™¯æ„å»º</h3>\n<p>è¿™é‡Œæˆ‘ä»¬å…ˆæ„å»ºä¸€ä¸ªç®€å•çš„è½¬è´¦åœºæ™¯ï¼šæœ‰ä¸€ä¸ªæ•°æ®è¡¨ accountï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªè´¦æˆ· jack å’Œ roseï¼Œç”¨æˆ· jack ç»™ç”¨æˆ· rose è½¬è´¦ã€‚</p>\n<p>æ¡ˆä¾‹çš„å®ç°ä¸»è¦ç”¨ mysql æ•°æ®åº“ï¼ŒJDBC å’Œ C3P0 æ¡†æ¶ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†ä»£ç ï¼š</p>\n<ol>\n<li>\n<p>é¡¹ç›®ç»“æ„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240311150504806.png\" alt=\"image-20240311150504806\" /></p>\n<p>dao</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccountDao</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// è½¬å‡º</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">out</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> outUser<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> money<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"update account set money = money - ? where name = ?\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token class-name\">JdbcUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">PreparedStatement</span> pstm <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">prepareStatement</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">setInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">setString</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> outUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">JdbcUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">release</span><span class=\"token punctuation\">(</span>pstm<span class=\"token punctuation\">,</span> connection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// è½¬å…¥</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">in</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> inUser<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> money<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"update account set money = money + ? where name = ?\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token class-name\">JdbcUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">PreparedStatement</span> pstm <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">prepareStatement</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">setInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">setString</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> inUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">JdbcUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">release</span><span class=\"token punctuation\">(</span>pstm<span class=\"token punctuation\">,</span> connection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>service</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccountService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// è½¬è´¦</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> outUser<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> inUser<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> money<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">AccountDao</span> ad <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AccountDao</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token comment\">// è½¬å‡º</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            ad<span class=\"token punctuation\">.</span><span class=\"token function\">out</span><span class=\"token punctuation\">(</span>outUser<span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token comment\">// è½¬å…¥</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            ad<span class=\"token punctuation\">.</span><span class=\"token function\">in</span><span class=\"token punctuation\">(</span>inUser<span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>util</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JdbcUtils</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">//c3p0 æ•°æ®åº“è¿æ¥æ± å¯¹è±¡å±æ€§</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ComboPooledDataSource</span> ds <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ComboPooledDataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// è·å–è¿æ¥</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Connection</span> <span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token keyword\">return</span> ds<span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SQLException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">release</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AutoCloseable</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> ios<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">AutoCloseable</span> io <span class=\"token operator\">:</span> ios<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>io <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                    io<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token comment\">// æäº¤äº‹åŠ¡å¹¶é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">commitAndClose</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Connection</span> conn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>conn <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token comment\">// æäº¤äº‹åŠ¡</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                conn<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token comment\">// é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                conn<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SQLException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token comment\">// å›æ»šäº‹åŠ¡å¹¶é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">rollbackAndClose</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Connection</span> conn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>conn <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token comment\">// å›æ»šäº‹åŠ¡</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                conn<span class=\"token punctuation\">.</span><span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                <span class=\"token comment\">// é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                conn<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SQLException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>web</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccountWeb</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">// æ¨¡æ‹Ÿæ•°æ®ï¼šJack ç»™ Rose è½¬è´¦ 100 å…ƒ</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">String</span> outUser <span class=\"token operator\">=</span> <span class=\"token string\">\"Jack\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">String</span> inUser <span class=\"token operator\">=</span> <span class=\"token string\">\"Rose\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">int</span> money <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">AccountService</span> service <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AccountService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">boolean</span> result <span class=\"token operator\">=</span> service<span class=\"token punctuation\">.</span><span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span>outUser<span class=\"token punctuation\">,</span> inUser<span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">==</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è½¬è´¦å¤±è´¥\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è½¬è´¦æˆåŠŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p>\n<pre><code>è½¬è´¦æˆåŠŸ\n</code></pre>\n<p>æ•°æ®åº“ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240311150649176.png\" alt=\"image-20240311150649176\" /></p>\n<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰§è¡Œæ—¶æ²¡æœ‰ä»»ä½•æ¯›ç—…ï¼Œä½†æ˜¯æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ªæŠ¥é”™åœ¨è½¬è´¦çš„è¿‡ç¨‹ä¸­é—´</p>\n<p>æŠŠæ•°æ®åº“çš„ç”¨æˆ·é‡‘é¢æ•°æ®æ¢å¤ä¸€ä¸‹</p>\n<p>ä¿®æ”¹çš„ä»£ç ï¼š</p>\n<p>service</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccountService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// è½¬è´¦</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> outUser<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> inUser<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> money<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">AccountDao</span> ad <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AccountDao</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token comment\">// è½¬å‡º</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            ad<span class=\"token punctuation\">.</span><span class=\"token function\">out</span><span class=\"token punctuation\">(</span>outUser<span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token comment\">// ç®—æ•°å¼‚å¸¸ï¼Œæ¨¡æ‹Ÿè½¬å‡ºæˆåŠŸï¼Œè½¬å…¥å¤±è´¥åœºæ™¯</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token comment\">// è½¬å…¥</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            ad<span class=\"token punctuation\">.</span><span class=\"token function\">in</span><span class=\"token punctuation\">(</span>inUser<span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p>\n<pre><code>è½¬è´¦å¤±è´¥\n</code></pre>\n<p>æŸ¥çœ‹æ•°æ®åº“</p>\n<p>å¯ä»¥çœ‹åˆ°æ•°æ®åº“ä¸­ç”¨æˆ· Jack çš„é’±å°‘äº† ä½†æ˜¯ Rose çš„é’±å¹¶æ²¡æœ‰å¢å¤šï¼Œè¿™å°±å‡ºé—®é¢˜äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240311153423602.png\" alt=\"image-20240311153423602\" /></p>\n</li>\n</ol>\n<p>å­¦è¿‡æ•°æ®åº“çš„äº‹åŠ¡ç‰¹æ€§çš„å°±çŸ¥é“å¯ä»¥ä½¿ç”¨äº‹åŠ¡æ¥è§£å†³ï¼Œè®©è½¬è´¦çš„æ“ä½œå…·å¤‡åŸå­æ€§ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥</p>\n<p>JDBC ä¸­å…³äºäº‹åŠ¡çš„æ“ä½œ api</p>\n<table>\n<thead>\n<tr>\n<th>Connection æ¥å£çš„æ–¹æ³•</th>\n<th>ä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>void setAutoCommit(false)</td>\n<td>ç¦ç”¨äº‹åŠ¡è‡ªåŠ¨æäº¤ (æ”¹ä¸ºæ‰‹åŠ¨)</td>\n</tr>\n<tr>\n<td>void comit()</td>\n<td>æäº¤äº‹åŠ¡</td>\n</tr>\n<tr>\n<td>void rollback()</td>\n<td>å›æ»šäº‹åŠ¡</td>\n</tr>\n</tbody>\n</table>\n<ol start=\"2\">\n<li>\n<p>å¼€å¯äº‹åŠ¡çš„æ³¨æ„ç‚¹ï¼š</p>\n<ul>\n<li>ä¸ºäº†ä¿è¯æ‰€æœ‰çš„æ“ä½œåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œæ¡ˆä¾‹ä¸­ä½¿ç”¨çš„è¿æ¥å¿…é¡»æ˜¯åŒä¸€ä¸ªï¼šservice å±‚å¼€å¯äº‹åŠ¡çš„ connection éœ€è¦è·Ÿ dao å±‚è®¿é—®æ•°æ®åº“çš„ connection ä¿æŒä¸€è‡´</li>\n<li>çº¿ç¨‹å¹¶å‘æƒ…å†µä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹åªèƒ½æ“ä½œå„è‡ªçš„ connection</li>\n</ul>\n<p>service ä¸ dao éƒ½æœ‰è·å– connection å¯¹è±¡ï¼Œæˆ‘ä»¬è¦ä¿è¯è¿™ä¸¤ä¸ª connection å¯¹è±¡æ˜¯ä¸€è‡´çš„ï¼Œå› ä¸ºä¸ä¸€è‡´çš„è¯ï¼Œæˆ‘ç›¸å½“äºåœ¨ service å±‚å¼€å¯äº‹åŠ¡çš„è¿æ¥ä¸æ˜¯ dao å±‚è®¿é—®æ•°æ®åº“çš„è¿æ¥ï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡ä¸ä¸€æ ·çš„è¯æˆ‘ä»¬åœ¨ service å±‚è®¾ç½®çš„äº‹åŠ¡æ“ä½œå°±ç™½è®¾ç½®äº†ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åœ¨ dao å±‚ç”¨çš„è¿æ¥å¿…é¡»è¦å’Œ service å±‚çš„ connection å¯¹è±¡ä¿æŒä¸€è‡´</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240311172843875.png\" alt=\"image-20240311172843875\" /></p>\n<p>ä»£ç ï¼š</p>\n<p>dao</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * å¸¸è§„æ–¹æ¡ˆï¼š</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> *  1. æ–¹æ³•æ·»åŠ ä¸€ä¸ªå‚æ•° connection</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> *  2. ä¸èƒ½ä»è¿æ¥æ± ä¸­è·å–è¿æ¥ï¼Œç›´æ¥ä½¿ç”¨å‚æ•° connection</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> *  æ³¨æ„ï¼šdao å±‚ä¸èƒ½é‡Šæ”¾è¿æ¥</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccountDao</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// è½¬å‡º</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">out</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> outUser<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> money<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Connection</span> connection<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"update account set money = money - ? where name = ?\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// Connection connection = JdbcUtils.getConnection();</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">PreparedStatement</span> pstm <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">prepareStatement</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">setInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">setString</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> outUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// åœ¨ dao å±‚ä¸èƒ½é‡Šæ”¾è¿æ¥ï¼Œå¦åˆ™æŠ¥é”™</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// JdbcUtils.release(pstm, connection);</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">// è½¬å…¥</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">in</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> inUser<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> money<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Connection</span> connection<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"update account set money = money + ? where name = ?\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">// Connection connection = JdbcUtils.getConnection();</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">PreparedStatement</span> pstm <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">prepareStatement</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">setInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">setString</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> inUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">// JdbcUtils.release(pstm, connection);</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>service</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * äº‹åŠ¡çš„ä½¿ç”¨æ³¨æ„ç‚¹ï¼š</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> *  1.service å±‚å’Œ dao å±‚çš„è¿æ¥å¯¹è±¡éœ€è¦ä¿æŒä¸€è‡´</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> *  2. æ¯ä¸ªçº¿ç¨‹çš„ connection å¯¹è±¡å¿…é¡»å‰åä¸€è‡´ï¼Œçº¿ç¨‹éš”ç¦»</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * å¸¸è§„çš„è§£å†³æ–¹æ¡ˆ</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> *  1. ä¼ å‚ï¼šå°† service å±‚çš„ connection å¯¹è±¡ç›´æ¥ä¼ é€’åˆ° dao å±‚</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> *  2. åŠ é”</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccountService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// è½¬è´¦</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> outUser<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> inUser<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> money<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">AccountDao</span> ad <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AccountDao</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token keyword\">synchronized</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AccountService</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token comment\">// å¼€å¯äº‹åŠ¡</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                connection <span class=\"token operator\">=</span> <span class=\"token class-name\">JdbcUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token comment\">// è®¾ç½®äº‹åŠ¡ä¸ºæ‰‹åŠ¨æäº¤</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                connection<span class=\"token punctuation\">.</span><span class=\"token function\">setAutoCommit</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token comment\">// è½¬å‡º</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                ad<span class=\"token punctuation\">.</span><span class=\"token function\">out</span><span class=\"token punctuation\">(</span>outUser<span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">,</span> connection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token comment\">// ç®—æ•°å¼‚å¸¸ï¼Œæ¨¡æ‹Ÿè½¬å‡ºæˆåŠŸï¼Œè½¬å…¥å¤±è´¥åœºæ™¯</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token comment\">// è½¬å…¥</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                ad<span class=\"token punctuation\">.</span><span class=\"token function\">in</span><span class=\"token punctuation\">(</span>inUser<span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">,</span> connection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token comment\">// è¿è¡Œåˆ°è¿™é‡Œæ²¡æœ‰å‡ºç°å¼‚å¸¸æäº¤äº‹åŠ¡</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token comment\">// æäº¤å¹¶é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token class-name\">JdbcUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">commitAndClose</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token comment\">// å‘ç”Ÿé”™è¯¯äº†ï¼Œå›æ»šäº‹åŠ¡å¹¶é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token class-name\">JdbcUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">rollbackAndClose</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ol>\n<p>æ‰§è¡Œç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240312153122419.png\" alt=\"image-20240312153122419\" /></p>\n<p>å¦‚ä¸Šæ–¹å¼ç¡®å®å¯ä»¥è§£å†³çº¿ç¨‹åŒæ­¥æ“ä½œäº‹åŠ¡ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼æ˜¯å­˜åœ¨ç€ä¸€äº›å¼Šç«¯çš„</p>\n<h3 id=\"212-å¸¸è§„è§£å†³æ–¹æ¡ˆçš„å¼Šç«¯\"><a class=\"anchor\" href=\"#212-å¸¸è§„è§£å†³æ–¹æ¡ˆçš„å¼Šç«¯\">#</a> 2.1.2 å¸¸è§„è§£å†³æ–¹æ¡ˆçš„å¼Šç«¯</h3>\n<ol>\n<li>\n<p>æé«˜ä»£ç çš„è€¦åˆåº¦</p>\n<p>æˆ‘ä»¬ç›´æ¥å°† service çš„ connection å¯¹è±¡ä¼ é€’åˆ° dao å±‚ï¼Œè¿™å°±è®©ä¸¤å±‚ä»£ç å¤šè€¦åˆäº†ä¸€ä¸ª connection å¯¹è±¡</p>\n</li>\n<li>\n<p>é™ä½ç¨‹åºæ€§èƒ½</p>\n<p>åŠ é”é€ æˆçš„ï¼Œå› ä¸ºåŠ ä¸Šé”ä¹‹åè¿™æ®µä»£ç å°±å¤±å»äº†å¹¶å‘æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å¤šçº¿ç¨‹å¹¶å‘çš„æƒ…å†µä¸‹æˆ‘ä»¬è¿™æ®µä»£ç å®ƒä¹Ÿåªèƒ½ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œ</p>\n</li>\n</ol>\n<p>æˆ‘ä»¬è¦è§£å†³ä¸Šé¢çš„é—®é¢˜é‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨åˆ°æœ¬ç« çš„ä¸»è§’ ThreadLocal</p>\n<h2 id=\"22-è½¬è´¦æ¡ˆä¾‹-threadlocalè§£å†³æ–¹æ¡ˆ\"><a class=\"anchor\" href=\"#22-è½¬è´¦æ¡ˆä¾‹-threadlocalè§£å†³æ–¹æ¡ˆ\">#</a> 2.2 è½¬è´¦æ¡ˆä¾‹ - ThreadLocal è§£å†³æ–¹æ¡ˆ</h2>\n<p>æ€ä¹ˆä½¿ç”¨ ThreadLocal æŸ¥çœ‹å¦‚ä¸‹å›¾ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240312153939795.png\" alt=\"image-20240312153939795\" /></p>\n<p>æˆ‘ä»¬å¯ä»¥åœ¨ç¨‹åºå½“ä¸­å°† connectio ä½¿ç”¨ ThreadLocal è¿›è¡Œç®¡ç†ï¼ŒThreadLocal æ ¸å¿ƒä½œç”¨å°±æ˜¯å°†å˜é‡è¿›è¡Œçº¿ç¨‹é—´çš„éš”ç¦»</p>\n<p>ä½¿ç”¨ ThreadLocal çš„è¯å°±èƒ½è§£å†³äº†ï¼Œçº¿ç¨‹é—´çš„æ•°æ®ç›¸äº’éš”ç¦»çš„ç‰¹ç‚¹åˆé€šè¿‡ ThreadLocal è¿›è¡Œåœ¨é¡¹ç›®ä¸­æ¨¡å—ä¹‹é—´è¿›è¡Œäº†æ•°æ®ä¼ é€’</p>\n<p>ä»£ç ï¼š</p>\n<p>JdbcUtils</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JdbcUtils</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token class-name\">ThreadLocal</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Connection</span><span class=\"token punctuation\">></span></span> threadLocal <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ThreadLocal</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">//c3p0 æ•°æ®åº“è¿æ¥æ± å¯¹è±¡å±æ€§</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ComboPooledDataSource</span> ds <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ComboPooledDataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// è·å–è¿æ¥</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>     * åŸæœ¬ï¼šç›´æ¥ä»è¿æ¥æ± ä¸­è·å–è¿æ¥</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>     * ç°åœ¨ï¼š</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     *  1. ç›´æ¥è·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„è¿æ¥å¯¹è±¡</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>     *  2. å¦‚æœè¿æ¥å¯¹è±¡æ˜¯ç©ºçš„</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     *      2.1 å†å»è¿æ¥æ± ä¸­è·å–è¿æ¥</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>     *      2.2 å°†æ­¤è¿æ¥å¯¹è±¡è·Ÿå½“å‰çº¿ç¨‹è¿›è¡Œç»‘å®š</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Connection</span> <span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// ä» ThreadLocal ä¸­è·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„è¿æ¥å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> threadLocal<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">// åˆ¤æ–­æ˜¯å¦æœ‰ç»‘å®šè¿‡çš„è¿æ¥å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token comment\">// å¦‚æœæ²¡æœ‰å°±é€šè¿‡ ComboPooledDataSource è·å–ä¸€ä¸ªè¿æ¥å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                connection <span class=\"token operator\">=</span> ds<span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SQLException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token comment\">// å°†è·å–åˆ°çš„è¿æ¥å¯¹è±¡ç»‘å®šåˆ°å½“å‰çº¿ç¨‹ä¸­</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            threadLocal<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token comment\">// è¿”å›å½“å‰çº¿ç¨‹ç»‘å®šçš„è¿æ¥å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">return</span> connection<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token comment\">// é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">release</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AutoCloseable</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> ios<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">AutoCloseable</span> io <span class=\"token operator\">:</span> ios<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>io <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                    io<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token comment\">// æäº¤äº‹åŠ¡å¹¶é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">commitAndClose</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Connection</span> conn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>conn <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token comment\">// æäº¤äº‹åŠ¡</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                conn<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token comment\">// é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                conn<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SQLException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token comment\">// å›æ»šäº‹åŠ¡å¹¶é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">rollbackAndClose</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Connection</span> conn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>conn <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                <span class=\"token comment\">// å›æ»šäº‹åŠ¡</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                conn<span class=\"token punctuation\">.</span><span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                <span class=\"token comment\">// é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                conn<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SQLException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>service</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * äº‹åŠ¡çš„ä½¿ç”¨æ³¨æ„ç‚¹ï¼š</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * 1.service å±‚å’Œ dao å±‚çš„è¿æ¥å¯¹è±¡éœ€è¦ä¿æŒä¸€è‡´</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * 2. æ¯ä¸ªçº¿ç¨‹çš„ connection å¯¹è±¡å¿…é¡»å‰åä¸€è‡´ï¼Œçº¿ç¨‹éš”ç¦»</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * å¸¸è§„çš„è§£å†³æ–¹æ¡ˆ</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * 1. ä¼ å‚ï¼šå°† service å±‚çš„ connection å¯¹è±¡ç›´æ¥ä¼ é€’åˆ° dao å±‚</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * 2. åŠ é”</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccountService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// è½¬è´¦</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> outUser<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> inUser<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> money<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">AccountDao</span> ad <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AccountDao</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token comment\">// å¼€å¯äº‹åŠ¡</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            connection <span class=\"token operator\">=</span> <span class=\"token class-name\">JdbcUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token comment\">// è®¾ç½®äº‹åŠ¡ä¸ºæ‰‹åŠ¨æäº¤</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            connection<span class=\"token punctuation\">.</span><span class=\"token function\">setAutoCommit</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token comment\">// è½¬å‡º</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            ad<span class=\"token punctuation\">.</span><span class=\"token function\">out</span><span class=\"token punctuation\">(</span>outUser<span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token comment\">// ç®—æ•°å¼‚å¸¸ï¼Œæ¨¡æ‹Ÿè½¬å‡ºæˆåŠŸï¼Œè½¬å…¥å¤±è´¥åœºæ™¯</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">// è½¬å…¥</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            ad<span class=\"token punctuation\">.</span><span class=\"token function\">in</span><span class=\"token punctuation\">(</span>inUser<span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// è¿è¡Œåˆ°è¿™é‡Œæ²¡æœ‰å‡ºç°å¼‚å¸¸æäº¤äº‹åŠ¡</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token comment\">// æäº¤å¹¶é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token class-name\">JdbcUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">commitAndClose</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token comment\">// å‘ç”Ÿé”™è¯¯äº†ï¼Œå›æ»šäº‹åŠ¡å¹¶é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token class-name\">JdbcUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">rollbackAndClose</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>dao</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * å¸¸è§„æ–¹æ¡ˆï¼š</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * 1. æ–¹æ³•æ·»åŠ ä¸€ä¸ªå‚æ•° connection</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * 2. ä¸èƒ½ä»è¿æ¥æ± ä¸­è·å–è¿æ¥ï¼Œç›´æ¥ä½¿ç”¨å‚æ•° connection</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * æ³¨æ„ï¼šdao å±‚ä¸èƒ½é‡Šæ”¾è¿æ¥</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccountDao</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// è½¬å‡º</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">out</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> outUser<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> money<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"update account set money = money - ? where name = ?\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token class-name\">JdbcUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">PreparedStatement</span> pstm <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">prepareStatement</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">setInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">setString</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> outUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// åœ¨ dao å±‚ä¸èƒ½é‡Šæ”¾è¿æ¥ï¼Œå¦åˆ™æŠ¥é”™</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// JdbcUtils.release(pstm, connection);</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">// è½¬å…¥</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">in</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> inUser<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> money<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"update account set money = money + ? where name = ?\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token class-name\">JdbcUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">PreparedStatement</span> pstm <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">prepareStatement</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">setInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">setString</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> inUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        pstm<span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">// JdbcUtils.release(pstm, connection);</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p>\n<pre><code>è½¬è´¦å¤±è´¥\n</code></pre>\n<p>æ•°æ®åº“ç»“æœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240312214544525.png\" alt=\"image-20240312214544525\" /></p>\n<p>è½¬è´¦å¤±è´¥å é‡‘é¢æ²¡æœ‰æ‰£é™¤ï¼Œè¿™å°±è¯´æ˜ä¸Šé¢çš„äº‹åŠ¡è®¾ç½®ç»è¿‡ ThreadLocal çš„æ”¹é€ æˆåŠŸäº†</p>\n<p>ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼Œå°±åœ¨ service å±‚ä¸­æœ‰ä¸€ä¸ª commitAndClose å½“æ•°æ®åº“è®¿é—®å®Œæˆä¹‹åæˆ‘ä»¬éœ€è¦æäº¤å’Œé‡Šæ”¾è¿æ¥</p>\n<p>æˆ‘ä»¬éœ€è¦ç‚¹è¿›è¿™ä¸ªæ–¹æ³•åˆ° JdbcUtils ä¸­æ·»åŠ ä¸€ä¸ª remove () æ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// æäº¤äº‹åŠ¡å¹¶é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">commitAndClose</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Connection</span> conn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>conn <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>         <span class=\"token comment\">// æäº¤äº‹åŠ¡</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>         conn<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>         <span class=\"token comment\">// æ–°åŠ ä»£ç  -ã€‹</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>         <span class=\"token comment\">// è§£ç»‘å½“å‰çº¿ç¨‹ç»‘å®šçš„è¿æ¥å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>         <span class=\"token comment\">// è§£ç»‘å¯¹è±¡æ˜¯ä¸ºäº†é˜²æ­¢å†…å­˜æ³„æ¼</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>         threadLocal<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>         <span class=\"token comment\">// é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>         conn<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SQLException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿˜æœ‰ rollbackAndClose æ–¹æ³•ä¹Ÿéœ€è¦åŠ ä¸Š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å›æ»šäº‹åŠ¡å¹¶é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">rollbackAndClose</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Connection</span> conn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>conn <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>         <span class=\"token comment\">// å›æ»šäº‹åŠ¡</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>         conn<span class=\"token punctuation\">.</span><span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>         <span class=\"token comment\">// æ–°åŠ ä»£ç  -ã€‹</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>         <span class=\"token comment\">// è§£ç»‘å½“å‰çº¿ç¨‹ç»‘å®šçš„è¿æ¥å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>         <span class=\"token comment\">// è§£ç»‘å¯¹è±¡æ˜¯ä¸ºäº†é˜²æ­¢å†…å­˜æ³„æ¼</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>         threadLocal<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>         <span class=\"token comment\">// é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>         conn<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SQLException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"23-threadlocalæ–¹æ¡ˆçš„å¥½å¤„\"><a class=\"anchor\" href=\"#23-threadlocalæ–¹æ¡ˆçš„å¥½å¤„\">#</a> 2.3 ThreadLocal æ–¹æ¡ˆçš„å¥½å¤„</h2>\n<p>ä»ä¸Šè¿°çš„æ¡ˆä¾‹ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä¸€äº›ç‰¹å®šåœºæ™¯ä¸‹ï¼ŒThreadLocal æ–¹æ¡ˆæœ‰ä¸¤ä¸ªçªå‡ºçš„ä¼˜åŠ¿ï¼š</p>\n<ol>\n<li><strong>ä¼ é€’æ•°æ®</strong>ï¼šä¿å­˜æ¯ä¸ªçº¿ç¨‹ç»‘å®šçš„æ•°æ®ï¼Œåœ¨éœ€è¦çš„åœ°æ–¹å¯ä»¥ç›´æ¥è·å–ï¼Œé¿å…å‚æ•°ç›´æ¥ä¼ é€’å¸¦æ¥çš„ä»£ç è€¦åˆé—®é¢˜</li>\n<li><strong>çº¿ç¨‹éš”ç¦»</strong>ï¼šå„çº¿ç¨‹ä¹‹é—´çš„æ•°æ®ç›¸äº’éš”ç¦»å´åˆå…·å¤‡å¹¶å‘æ€§ï¼Œé¿å…åŒæ­¥æ–¹å¼å¸¦æ¥çš„æ€§èƒ½æŸå¤±</li>\n</ol>\n<h1 id=\"ä¸‰-threadlocalçš„å†…éƒ¨ç»“æ„\"><a class=\"anchor\" href=\"#ä¸‰-threadlocalçš„å†…éƒ¨ç»“æ„\">#</a> ä¸‰ã€ThreadLocal çš„å†…éƒ¨ç»“æ„</h1>\n<p>é€šè¿‡ä»¥ä¸Šçš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯¹ ThreadLocal çš„ä½œç”¨æœ‰äº†ä¸€å®šçš„è®¤è¯†ã€‚ç°åœ¨æˆ‘ä»¬ä¸€èµ·çœ‹ä¸€ä¸‹ ThreadLocal çš„å†…éƒ¨ç»“æ„ï¼Œæ¢ç©¶å®ƒèƒ½å¤Ÿå®ç°çº¿ç¨‹æ•°æ®éš”ç¦»çš„åŸç†ã€‚</p>\n<h2 id=\"31-å¸¸è§çš„è¯¯è§£\"><a class=\"anchor\" href=\"#31-å¸¸è§çš„è¯¯è§£\">#</a> 3.1 å¸¸è§çš„è¯¯è§£</h2>\n<p>é€šå¸¸ï¼Œå¦‚æœæˆ‘ä»¬ä¸å»çœ‹æºä»£ç çš„è¯ï¼Œæˆ‘çŒœ ThreadLocal æ˜¯è¿™æ ·å­è®¾è®¡çš„ï¼šæ¯ä¸ª ThreadLocal ç±»éƒ½åˆ›å»ºä¸€ä¸ª Mapï¼Œç„¶åç”¨çº¿ç¨‹ ID threadID ä½œä¸º Map çš„ Keyï¼Œè¦å­˜å‚¨çš„å±€éƒ¨å˜é‡ä¸º Map çš„ Valueï¼Œè¿™æ ·å°±èƒ½è¾¾åˆ°å„ä¸ªçº¿ç¨‹çš„å±€éƒ¨å˜é‡éš”ç¦»çš„æ•ˆæœã€‚è¿™æ˜¯æœ€ç®€å•çš„è®¾è®¡æ–¹æ³•ï¼ŒJDK æœ€æ—©å…¶çš„ ThreadLocal å°±æ˜¯è¿™æ ·è®¾è®¡çš„ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240312220913892.png\" alt=\"image-20240312220913892\" /></p>\n<h2 id=\"32-ç°åœ¨çš„è®¾è®¡\"><a class=\"anchor\" href=\"#32-ç°åœ¨çš„è®¾è®¡\">#</a> 3.2 ç°åœ¨çš„è®¾è®¡</h2>\n<p>ä½†æ˜¯ï¼ŒJDK åé¢ä¼˜åŒ–äº†è®¾è®¡æ–¹æ¡ˆï¼Œåœ¨ JDK8 ä¸­ ThreadLocal çš„è®¾è®¡æ˜¯ï¼šæ¯ä¸ª Thread ç»´æŠ¤ä¸€ä¸ª ThreadLocalMapï¼Œè¿™ä¸ª Map çš„ Key æ˜¯ ThreadLocal å®ä¾‹æœ¬èº«ï¼ŒValue æ‰æ˜¯çœŸæ­£è¦å­˜å‚¨çš„å€¼ Objectã€‚</p>\n<p>å…·ä½“çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>\n<ol>\n<li>æ¯ä¸ª Thread çº¿ç¨‹å†…éƒ¨éƒ½æœ‰ä¸€ä¸ª Map (ThreadLocalMap)</li>\n<li>Map é‡Œé¢éƒ½å­˜å‚¨ ThreadLocal å¯¹è±¡ (Key) å’Œçº¿ç¨‹çš„å˜é‡å‰¯æœ¬ (Value)</li>\n<li>Thread å†…éƒ¨çš„ Map æ˜¯ç”± ThreadLocal ç»´æŠ¤çš„ï¼Œç”± ThreadLocal è´Ÿè´£å‘ Map è·å–å’Œè®¾ç½®çº¿ç¨‹çš„å˜é‡å€¼ã€‚</li>\n<li>å¯¹äºä¸åŒçš„çº¿ç¨‹ï¼Œæ¯æ¬¡è·å–å‰¯æœ¬å€¼æ—¶ï¼Œåˆ«çš„çº¿ç¨‹å¹¶ä¸èƒ½è·å–åˆ°å½“å‰çº¿ç¨‹çš„å‰¯æœ¬å€¼ï¼Œå½¢æˆäº†å‰¯æœ¬çš„éš”ç¦»ï¼Œäº’ä¸å¹²æ‰°ã€‚</li>\n</ol>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240312221406799.png\" alt=\"image-20240312221406799\" /></p>\n<h3 id=\"321-jdk8è®¾è®¡æ–¹æ¡ˆçš„ä¸¤ä¸ªå¥½å¤„\"><a class=\"anchor\" href=\"#321-jdk8è®¾è®¡æ–¹æ¡ˆçš„ä¸¤ä¸ªå¥½å¤„\">#</a> 3.2.1 JDK8 è®¾è®¡æ–¹æ¡ˆçš„ä¸¤ä¸ªå¥½å¤„</h3>\n<ol>\n<li>æ¯ä¸ª Map å­˜å‚¨çš„ Entry æ•°é‡å˜å°‘</li>\n<li>å½“ Thread é”€æ¯çš„æ—¶å€™ ThreadLocal ä¹Ÿä¼šéšç€é”€æ¯å‡å°‘å†…å­˜çš„ä½¿ç”¨</li>\n</ol>\n<h1 id=\"å››-threadlocalçš„æ ¸å¿ƒæ–¹æ³•æºç \"><a class=\"anchor\" href=\"#å››-threadlocalçš„æ ¸å¿ƒæ–¹æ³•æºç \">#</a> å››ã€ThreadLocal çš„æ ¸å¿ƒæ–¹æ³•æºç </h1>\n<p>åŸºäº ThreadLocal çš„å†…éƒ¨ç»“æ„ï¼Œæˆ‘ä»¬ç»§ç»­åˆ†æå®ƒçš„æ ¸å¿ƒæ–¹æ³•æºç ï¼Œæ›´æ·±å…¥çš„äº†è§£å…¶æ“ä½œåŸç†ã€‚</p>\n<p>é™¤äº†æ„é€ æ–¹æ³•ä¹‹å¤–ï¼ŒThreadLocal å¯¹å¤–æš´æ¼çš„æ–¹æ³•æœ‰ä»¥ä¸‹ 4 ä¸ªï¼š</p>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•å£°æ˜</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>protected initialValue()</td>\n<td>è¿”å›å½“å‰çº¿ç¨‹å±€éƒ¨å˜é‡çš„åˆå§‹å€¼</td>\n</tr>\n<tr>\n<td>public void set(T value)</td>\n<td>è®¾ç½®å½“å‰çº¿ç¨‹ç»‘å®šçš„å±€éƒ¨å˜é‡</td>\n</tr>\n<tr>\n<td>public T get()</td>\n<td>è·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„å±€éƒ¨å˜é‡</td>\n</tr>\n<tr>\n<td>public void remove()</td>\n<td>ç§»é™¤å½“å‰çº¿ç¨‹ç»‘å®šçš„å±€éƒ¨å˜é‡</td>\n</tr>\n</tbody>\n</table>\n<p>ä»¥ä¸‹æ˜¯è¿™ 4 ä¸ªæ–¹æ³•çš„è¯¦ç»†æºç åˆ†æ (ä¸ºäº†ä¿è¯æ€è·¯æ¸…æ™°ï¼ŒThreadLocalMap éƒ¨åˆ†æš‚æ—¶ä¸å±•å¼€ï¼Œä¸‹ä¸€ä¸ªçŸ¥è¯†ç‚¹è¯¦è§£)</p>\n<h2 id=\"41-set\"><a class=\"anchor\" href=\"#41-set\">#</a> 4.1 set</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token comment\">// è·å–å½“å‰çº¿ç¨‹å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token class-name\">Thread</span> t <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token comment\">// è·å–æ­¤çº¿ç¨‹å¯¹è±¡ä¸­ç»´æŠ¤çš„ ThreadLocalMap å¯¹è±¡  </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token class-name\">ThreadLocalMap</span> map <span class=\"token operator\">=</span> <span class=\"token function\">getMap</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token comment\">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>map <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    map<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// 1) å½“å‰çº¿ç¨‹ Thread ä¸å­˜åœ¨ ThreadLocalMap å¯¹è±¡.</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// 2) åˆ™è°ƒç”¨ createMap è¿›è¡Œ ThreadLocalMap å¯¹è±¡åˆå§‹åŒ–.</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// 3) å¹¶å°† t å’Œ value (å¯¹åº”çš„å€¼) ä½œä¸ºç¬¬ä¸€ä¸ª entry å­˜æ”¾è‡³ ThreadLocalMap ä¸­</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token function\">createMap</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token class-name\">ThreadLocalMap</span> <span class=\"token function\">getMap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span> t<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token keyword\">return</span> t<span class=\"token punctuation\">.</span>threadLocals<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">createMap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span> t<span class=\"token punctuation\">,</span> <span class=\"token class-name\">T</span> firstValue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    t<span class=\"token punctuation\">.</span>threadLocals <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ThreadLocalMap</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> firstValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    æ€»ç»“ï¼š</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    A. é¦–å…ˆè·å–å½“å‰çº¿ç¨‹ï¼Œå¹¶æ ¹æ®å½“å‰çº¿ç¨‹è·å–ä¸€ä¸ª Map.</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    B. å¦‚æœè·å–çš„ Map ä¸ä¸ºç©ºï¼Œåˆ™å°†å‚æ•°è®¾ç½®åˆ° Map ä¸­ (å½“å‰ ThreadLocal ä½œä¸º key)</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    C. å¦‚æœ Map ä¸ºç©ºï¼Œåˆ™ç»™è¯¥çº¿ç¨‹åˆ›å»º Map, å¹¶è®¾ç½®åˆå§‹å€¼.</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>**/</span></pre></td></tr></table></figure><p>ä»£ç æ‰§è¡Œæµç¨‹ï¼š</p>\n<ol>\n<li>é¦–å…ˆè·å–å½“å‰çº¿ç¨‹ï¼Œå¹¶æ ¹æ®å½“å‰çº¿ç¨‹è·å–ä¸€ä¸ª Map</li>\n<li>å¦‚æœè·å–çš„ Map ä¸ä¸ºç©ºï¼Œåˆ™å°†å‚æ•°è®¾ç½®åˆ° Map ä¸­ (å½“å‰ ThreadLocal çš„å¼•ç”¨ä½œä¸º Key)</li>\n<li>å¦‚æœ Map ä¸ºç©ºï¼Œåˆ™ç»™è¯¥çº¿ç¨‹åˆ›å»º Mapï¼Œå¹¶è®¾ç½®åˆå§‹å€¼</li>\n</ol>\n<h2 id=\"42-get\"><a class=\"anchor\" href=\"#42-get\">#</a> 4.2 get</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">T</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token comment\">// è·å–å½“å‰çº¿ç¨‹å¯¹è±¡ å’Œ ThreadLocalMap;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">Thread</span> t <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">ThreadLocalMap</span> map <span class=\"token operator\">=</span> <span class=\"token function\">getMap</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// å¦‚æœ map å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å› map ä¸­ ThreadLocal å¯¹åº”çš„å€¼</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>map <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>     <span class=\"token class-name\">ThreadLocalMap<span class=\"token punctuation\">.</span>Entry</span> e <span class=\"token operator\">=</span> map<span class=\"token punctuation\">.</span><span class=\"token function\">getEntry</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>     </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">T</span> result <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">)</span>e<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>       <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>     <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token comment\">//map ä¸å­˜åœ¨ æˆ– map ä¸­æ²¡ set è¿‡</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token function\">setInitialValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">T</span> <span class=\"token function\">setInitialValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token comment\">// è°ƒç”¨ initialValue è·å–åˆå§‹åŒ–çš„å€¼</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token comment\">//initialValue å¯ä»¥è¢«å­ç±»é‡å†™ï¼Œå¦‚æœä¸é‡å†™ï¼Œé»˜è®¤è¿”å› null</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token class-name\">T</span> value <span class=\"token operator\">=</span> <span class=\"token function\">initialValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token comment\">// è·å–å½“å‰çº¿ç¨‹å¯¹è±¡ å’Œ ThreadLocalMap;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token class-name\">Thread</span> t <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token class-name\">ThreadLocalMap</span> map <span class=\"token operator\">=</span> <span class=\"token function\">getMap</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>map <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">//map å­˜åœ¨åˆ™è®¾ç½®é»˜è®¤å€¼</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    map<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token keyword\">else</span> </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token comment\">// 1) å½“å‰çº¿ç¨‹ Thread ä¸å­˜åœ¨ ThreadLocalMap å¯¹è±¡.</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token comment\">// 2) åˆ™è°ƒç”¨ createMap è¿›è¡Œ ThreadLocalMap å¯¹è±¡åˆå§‹åŒ–.</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token comment\">// 3) å¹¶å°† t å’Œ value (å¯¹åº”çš„å€¼) ä½œä¸ºç¬¬ä¸€ä¸ª entry å­˜æ”¾è‡³ ThreadLocalMap ä¸­</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token function\">createMap</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä»£ç æ‰§è¡Œæµç¨‹ï¼š</p>\n<ol>\n<li>é¦–å…ˆè·å–å½“å‰çº¿ç¨‹ï¼Œæ ¹æ®å½“å‰çº¿ç¨‹è·å–ä¸€ä¸ª Map</li>\n<li>å¦‚æœè·å–çš„ Map ä¸ä¸ºç©ºï¼Œåˆ™åœ¨ Map ä¸­ä»¥ ThreadLocal çš„å¼•ç”¨ä½œä¸º Key æ¥åœ¨ Map ä¸­è·å–å¯¹åº”çš„ Entryï¼Œå¦åˆ™è½¬åˆ°ç¬¬ 4 æ­¥</li>\n<li>å¦‚æœ e ä¸ä¸º nullï¼Œåˆ™è¿”å› e.valueï¼Œå¦åˆ™è½¬åˆ° ç¬¬ 4 æ­¥</li>\n<li>Map ä¸ºç©ºæˆ–è€… e ä¸ºç©ºï¼Œåˆ™é€šè¿‡ initialValue å‡½æ•°è·å–åˆå§‹å€¼ Valueï¼Œç„¶åç”¨ ThreadLocal çš„å¼•ç”¨å’Œ Value ä½œä¸º firstKey å’Œ firstValue åˆ›å»ºä¸€ä¸ªæ–°çš„ Map</li>\n</ol>\n<p>æ€»ç»“ï¼šå…ˆè·å–å½“å‰çº¿ç¨‹çš„ ThreadLocalMap å˜é‡ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å›å€¼ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºå¹¶è¿”å›åˆå§‹å€¼</p>\n<h2 id=\"43-removeæ–¹æ³•\"><a class=\"anchor\" href=\"#43-removeæ–¹æ³•\">#</a> 4.3 remove æ–¹æ³•</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token comment\">// è·å–å½“å‰çº¿ç¨‹ä¸­ä¿å­˜ ThreadLocalMap</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token class-name\">ThreadLocalMap</span> map <span class=\"token operator\">=</span> <span class=\"token function\">getMap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>map <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// å­˜åœ¨åˆ™è°ƒç”¨ map.remove æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    map<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä»£ç æ‰§è¡Œæµç¨‹ï¼š</p>\n<ol>\n<li>é¦–å…ˆåå»å½“å‰çº¿ç¨‹ï¼Œå¹¶æ ¹æ®å½“å‰çº¿ç¨‹è·å–ä¸€ä¸ª Map</li>\n<li>å¦‚æœè·å–çš„ Map ä¸ä¸ºç©ºï¼Œåˆ™ç§»é™¤å½“å‰ ThreadLocal å¯¹è±¡å¯¹åº”çš„ entry</li>\n</ol>\n<h2 id=\"44-initialvalueæ–¹æ³•\"><a class=\"anchor\" href=\"#44-initialvalueæ–¹æ³•\">#</a> 4.4 initialValue æ–¹æ³•</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  * è¿”å›å½“å‰çº¿ç¨‹å¯¹åº”çš„ ThreadLocal å˜é‡çš„ åˆå§‹å€¼.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  * æ­¤æ–¹æ³•çš„ç¬¬ä¸€æ¬¡è°ƒç”¨å‘ç”Ÿåœ¨ï¼Œå½“çº¿ç¨‹é€šè¿‡ get æ–¹æ³•è®¿é—®æ­¤çº¿ç¨‹çš„ ThreadLocal å˜é‡æ—¶</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  * é™¤éçº¿ç¨‹å…ˆè°ƒç”¨ set æ–¹æ³•ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒinitialValue æ‰ä¸ä¼šè¢« get æ–¹æ³•è°ƒç”¨</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  * é€šå¸¸æƒ…å†µä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹æœ€å¤šè°ƒç”¨ä¸€æ¬¡è¿™ä¸ªæ–¹æ³•</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  * &lt;p> è¿™ä¸ªæ–¹æ³•ä»…ä»…ç®€å•çš„è¿”å› null &#123;@code null&#125;</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  * å¦‚æœç¨‹åºå‘˜æƒ³ ThreadLocal çº¿ç¨‹å±€éƒ¨å˜é‡æœ‰ä¸ªé™¤ null ä»¥å¤–çš„åˆå§‹å€¼ï¼Œ</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  * å¿…é¡»é€šè¿‡å­ç±»ç»§æ‰¿ &#123;@code ThreadLocal&#125; çš„æ–¹å¼å»é‡å†™æ­¤æ–¹æ³•.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  * é€šå¸¸ï¼Œå¯ä»¥é€šè¿‡åŒ¿åç±»çš„æ–¹å¼å®ç°.</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  * @return å½“å‰ ThreadLocal çš„åˆå§‹å€¼</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  */</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token class-name\">T</span> <span class=\"token function\">initialValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ­¤æ–¹æ³•çš„ä½œç”¨æ˜¯è¿”å›è¯¥çº¿ç¨‹å±€éƒ¨å˜é‡çš„åˆå§‹å€¼</p>\n<ol>\n<li>è¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªå»¶è¿Ÿè°ƒç”¨æ–¹æ³•ï¼Œä»ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¾—çŸ¥ï¼Œåœ¨ set æ–¹æ³•è¿˜æœªè°ƒç”¨è€Œå…ˆè°ƒç”¨äº† get æ–¹æ³•æ—¶æ‰æ‰§è¡Œï¼Œå¹¶ä¸”ä»…æ‰§è¡Œ 1 æ¬¡</li>\n<li>è¿™ä¸ªæ–¹æ³•ç¼ºçœå®ç°ç›´æ¥è¿”å›ä¸€ä¸ª null</li>\n<li>å¦‚æœæƒ³è¦ä¸€ä¸ªé™¤ null ä¹‹å¤–çš„åˆå§‹å€¼ï¼Œå¯ä»¥é‡å†™æ¬¡æ–¹æ³•ã€‚(å¤‡æ³¨ï¼šè¯¥æ–¹æ³•æ˜¯ä¸€ä¸ª protected çš„æ–¹æ³•ï¼Œæ˜¾ç„¶æ˜¯ä¸ºäº†è®©å­ç±»è¦†ç›–è€Œè®¾è®¡çš„)</li>\n</ol>\n<h1 id=\"äº”-threadlocalmapæºç åˆ†æ\"><a class=\"anchor\" href=\"#äº”-threadlocalmapæºç åˆ†æ\">#</a> äº”ã€ThreadLocalMap æºç åˆ†æ</h1>\n<p>åœ¨åˆ†æ ThreadLocal æ–¹æ³•çš„æ—¶å€™ï¼Œæˆ‘ä»¬äº†è§£åˆ°äº† ThreadLocal çš„æ“ä½œå®é™…ä¸Šæ˜¯å›´ç»• ThreadLocalMap å±•å¼€çš„ã€‚</p>\n<p>ThreadLocalMap çš„æºç ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬ä»ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢è¿›è¡Œè®¨è®º</p>\n<h2 id=\"51-åŸºæœ¬ç»“æ„\"><a class=\"anchor\" href=\"#51-åŸºæœ¬ç»“æ„\">#</a> 5.1 åŸºæœ¬ç»“æ„</h2>\n<p>ThreadLocalMap æ˜¯ ThreadLocal çš„å†…éƒ¨ç±»ï¼Œæ²¡æœ‰å®ç° Map æ¥å£ï¼Œç”¨ç‹¬ç«‹çš„æ–¹å¼å®ç°äº† Map çš„åŠŸèƒ½ï¼Œå…¶å†…éƒ¨ Entry ä¹Ÿæ˜¯ç‹¬ç«‹å®ç°ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240313082856318.png\" alt=\"image-20240313082856318\" /></p>\n<h3 id=\"511-æˆå‘˜å˜é‡\"><a class=\"anchor\" href=\"#511-æˆå‘˜å˜é‡\">#</a> 5.1.1 æˆå‘˜å˜é‡</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * åˆå§‹å®¹é‡ï¼Œå¿…é¡»æ˜¯ 2 çš„æ•´æ•°æ¬¡å¹‚</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">INITIAL_CAPACITY</span> <span class=\"token operator\">=</span> <span class=\"token number\">16</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * å­˜æ”¾ table, Entry ç±»çš„å®šä¹‰åœ¨ä¸‹é¢åˆ†æ</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * åŒæ ·ï¼Œæ•°ç»„çš„é•¿åº¦å¿…é¡»æ˜¯ 2 çš„æ•´æ•°æ¬¡å¹‚</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">Entry</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> table<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * æ•°ç»„é‡Œé¢ entry çš„ä¸ªæ•°ï¼Œå¯ä»¥ç”¨äºåˆ¤æ–­ table å½“å‰çš„ä½¿ç”¨é‡æ˜¯å¦è¶…è¿‡é˜ˆå€¼</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> size <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> * è¿›è¡Œæ‰©å®¹çš„é˜ˆå€¼ï¼Œtable çš„ä½¿ç”¨é‡å¤§äºå®ƒçš„æ—¶å€™è¿›è¡Œæ‰©å®¹.</pre></td></tr><tr><td data-num=\"19\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> threshold<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>è·Ÿ HashMap ç±»ä¼¼ï¼ŒINITIAL_CAPACITY ä»£è¡¨è¿™ä¸ª Map çš„åˆå§‹å®¹é‡ï¼›table æ˜¯ä¸€ä¸ª Entry ç±»å‹çš„æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ•°æ®ï¼›size ä»£è¡¨è¡¨ä¸­çš„å­˜å‚¨æ•°ç›®ï¼›threshold ä»£è¡¨éœ€è¦æ‰©å®¹æ—¶å¯¹åº” size çš„é˜ˆå€¼</p>\n<h3 id=\"512-å­˜å‚¨ç»“æ„entry\"><a class=\"anchor\" href=\"#512-å­˜å‚¨ç»“æ„entry\">#</a> 5.1.2 å­˜å‚¨ç»“æ„ Entry</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Entry</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WeakRefernece</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ThreadLocal</span><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">Object</span> value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">Entry</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ThreadLocal</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> k<span class=\"token punctuation\">,</span> object v<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        value <span class=\"token operator\">=</span> v<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨ ThreadLocalMap ä¸­ï¼Œä¹Ÿæ˜¯ç”¨ Entry æ¥ä¿å­˜ K-V ç»“æ„æ•°æ®çš„ã€‚ä¸è¿‡ Entry ä¸­çš„ Key åªèƒ½æ˜¯ ThreadLocal å¯¹è±¡ï¼Œè¿™ç‚¹åœ¨æ„é€ æ–¹æ³•ä¸­å·²ç»é™å®šæ­»äº†ã€‚</p>\n<p>å¦å¤–ï¼ŒEntry ç»§æ‰¿ WeakReferenceï¼Œä¹Ÿå°±æ˜¯ Key (ThreadLocal) æ˜¯å¼±å¼•ç”¨ï¼Œå…¶ç›®çš„æ˜¯å°† ThreadLocal å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸè§£ç»‘ã€‚</p>\n<h2 id=\"52-å¼±å¼•ç”¨å’Œå†…å­˜æ³„æ¼\"><a class=\"anchor\" href=\"#52-å¼±å¼•ç”¨å’Œå†…å­˜æ³„æ¼\">#</a> 5.2 å¼±å¼•ç”¨å’Œå†…å­˜æ³„æ¼</h2>\n<p>æœ‰äº›ç¨‹åºå‘˜åœ¨ä½¿ç”¨ ThreadLocal çš„è¿‡ç¨‹ä¸­ä¼šå‘ç°æœ‰å†…å­˜æ³„æ¼çš„æƒ…å†µå‘ç”Ÿï¼Œå°±çŒœæµ‹è¿™ä¸ªå†…å­˜æ³„æ¼è·Ÿ Entry ä¸­ä½¿ç”¨äº†å¼±å¼•ç”¨çš„ KEy æœ‰å…³ç³»ã€‚è¿™ä¸ªç†è§£å…¶å®æ˜¯ä¸å¯¹çš„ã€‚</p>\n<p>æˆ‘ä»¬å…ˆæ¥å›é¡¾è¿™ä¸ªé—®é¢˜ä¸­æ¶‰åŠçš„å‡ ä¸ªåè¯æ¦‚å¿µï¼Œå†æ¥åˆ†æé—®é¢˜ã€‚</p>\n<h3 id=\"521-å†…å­˜æ³„æ¼ç›¸å…³æ¦‚å¿µ\"><a class=\"anchor\" href=\"#521-å†…å­˜æ³„æ¼ç›¸å…³æ¦‚å¿µ\">#</a> 5.2.1 å†…å­˜æ³„æ¼ç›¸å…³æ¦‚å¿µ</h3>\n<ul>\n<li>Memory overflowï¼šå†…å­˜æº¢å‡ºï¼Œæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜æä¾›ç”³è¯·è€…ä½¿ç”¨ã€‚</li>\n<li>Memoty leakï¼šå†…å­˜æ³„æ¼æ˜¯æŒ‡ç¨‹åºä¸­å·²åŠ¨æ€åˆ†é…çš„å †å†…å­˜ç”±äºæŸç§åŸå› ç¨‹åºæœªé‡Šæ”¾æˆ–æ— æ³•é‡Šæ”¾ï¼Œé€ æˆç³»ç»Ÿå†…å­˜çš„æµªè´¹ï¼Œå¯¼è‡´ç¨‹åºè¿è¡Œé€Ÿåº¦å‡æ…¢ç”šè‡³ç³»ç»Ÿå´©æºƒç­‰ä¸¥é‡åæœã€‚å†…å­˜æ³„æ¼çš„å †ç§¯ç»ˆå°†å¯¼è‡´å†…å­˜æº¢å‡ºã€‚</li>\n</ul>\n<h3 id=\"522-å¼±å¼•ç”¨ç›¸å…³æ¦‚å¿µ\"><a class=\"anchor\" href=\"#522-å¼±å¼•ç”¨ç›¸å…³æ¦‚å¿µ\">#</a> 5.2.2 å¼±å¼•ç”¨ç›¸å…³æ¦‚å¿µ</h3>\n<p>Java ä¸­çš„å¼•ç”¨æœ‰ 4 ç§ç±»å‹ï¼šå¼ºï¼Œè½¯ï¼Œå¼±ï¼Œè™šã€‚å½“å‰è¿™ä¸ªé—®é¢˜ä¸»è¦æ¶‰åŠåˆ°å¼ºå¼•ç”¨å’Œå¼±å¼•ç”¨ï¼š</p>\n<p><strong>å¼ºå¼•ç”¨</strong> (&quot;Strong&quot; Reference)ï¼šå°±æ˜¯æˆ‘ä»¬æœ€å¸¸è§çš„æ™®é€šå¯¹è±¡å¼•ç”¨ï¼Œåªè¦è¿˜æœ‰å¼ºå¼•ç”¨æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œå°±èƒ½è¡¨æ˜å¯¹è±¡è¿˜ &quot;æ´»ç€&quot;ï¼Œ åƒåœ¾å›æ”¶å™¨å°±ä¸ä¼šå›æ”¶è¿™ç§å¯¹è±¡ã€‚</p>\n<p><strong>å¼±å¼•ç”¨</strong> (WeakReference)ï¼šåƒåœ¾å›æ”¶å™¨ä¸€æ—¦å‘ç°äº†åªæ˜¯å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›å®ƒçš„å†…å­˜ã€‚</p>\n<h3 id=\"523-å¦‚æœkeyä½¿ç”¨å¼ºå¼•ç”¨\"><a class=\"anchor\" href=\"#523-å¦‚æœkeyä½¿ç”¨å¼ºå¼•ç”¨\">#</a> 5.2.3 å¦‚æœ Key ä½¿ç”¨å¼ºå¼•ç”¨</h3>\n<p>å‡è®¾ ThreadLocalMap ä¸­ Key ä½¿ç”¨äº†å¼ºå¼•ç”¨ï¼Œé‚£ä¹ˆä¼šå‡ºç°å†…å­˜æ³„æ¼å—ï¼Ÿ</p>\n<p>æ­¤æ—¶ ThreadLocal çš„å†…å­˜å›¾ (å®çº¿è¡¨ç¤ºå¼ºå¼•ç”¨) å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240313164858485.png\" alt=\"image-20240313164858485\" /></p>\n<ol>\n<li>\n<p>ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨äº† ThreadLocalï¼ŒThreadLocal Ref è¢«å›æ”¶äº†</p>\n</li>\n<li>\n<p>ä½†æ˜¯å› ä¸º ThreadLocalMap çš„ Entry å¼ºå¼•ç”¨äº† ThreadLocalï¼Œé€ æˆ ThreadLocal æ— æ³•è¢«å›æ”¶</p>\n</li>\n<li>\n<p>åœ¨æ²¡æœ‰æ‰‹åŠ¨åˆ é™¤è¿™ä¸ª Entry ä»¥åŠ CurrentThread ä¾ç„¶è¿è¡Œçš„å‰æä¸‹ï¼Œä½¿ç”¨æœ‰å¼ºå¼•ç”¨é“¾ thread Ref -&gt; current Thread -&gt; threadLocalMap -&gt; entryï¼Œentry å°±ä¸ä¼šè¢«å›æ”¶ (Entry å½“ä¸­åŒ…å«äº† ThreadLocal å®ä¾‹å’Œ value)ï¼Œå¯¼è‡´ Entry çš„å†…å­˜æ³„æ¼</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼šThreadLocalMap ä¸­çš„ Key ä½¿ç”¨äº†å¼ºå¼•ç”¨ï¼Œæ˜¯æ— æ³•é¿å…å†…å­˜æ³„æ¼çš„ã€‚</p>\n</li>\n</ol>\n<h3 id=\"524-å¦‚æœkeyä½¿ç”¨å¼±å¼•ç”¨\"><a class=\"anchor\" href=\"#524-å¦‚æœkeyä½¿ç”¨å¼±å¼•ç”¨\">#</a> 5.2.4 å¦‚æœ Key ä½¿ç”¨å¼±å¼•ç”¨</h3>\n<p>å½“ ThreadLocal ä¸­çš„ Key ä½¿ç”¨äº†å¼±å¼•ç”¨ï¼Œä¼šå‡ºç°å†…å­˜æ³„æ¼ä¹ˆï¼Ÿ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240313170442894.png\" alt=\"image-20240313170442894\" /></p>\n<ol>\n<li>\n<p>åŒæ ·å‡è®¾ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨äº† ThreadLocalï¼Œä¸” ThreadLocal Ref è¢«å›æ”¶äº†ã€‚</p>\n</li>\n<li>\n<p>ç”±äº ThreadLocalMap æ”¯æŒæœ‰ ThreadLocalMap çš„å¼±å¼•ç”¨ï¼Œæ²¡æœ‰ä»»ä½•å¼ºå¼•ç”¨æŒ‡å‘ ThreadLocal å®ä¾‹ï¼Œæ‰€ä»¥ ThreadLocal å°±å¯ä»¥é¡ºåˆ©è¢« GC å›æ”¶ï¼Œæ­¤æ—¶ Entry çš„ Key = null</p>\n</li>\n<li>\n<p>ä½†æ˜¯åœ¨æ²¡æœ‰æ‰‹åŠ¨åˆ é™¤è¿™ä¸ª Entry ä»¥åŠ CurrentThread ä¾ç„¶è¿è¡Œçš„å‰æä¸‹ï¼Œå­˜åœ¨å¼ºå¼•ç”¨é“¾ thread Ref -&gt; currentThread -&gt; threadLocalMap -&gt; entry -&gt; valueï¼Œvalue ä¸ä¼šè¢«å›æ”¶ï¼Œè€Œè¿™å— value æ°¸è¿œä¸ä¼šè¢«è®¿é—®åˆ°äº†ï¼Œå¯¼è‡´ value çš„å†…å­˜æ³„æ¼</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼šThreadLocalMap çš„ Key ä½¿ç”¨äº†å¼±å¼•ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚</p>\n</li>\n</ol>\n<h2 id=\"53-å‡ºç°å†…å­˜æ³„æ¼çš„çœŸå®åŸå› \"><a class=\"anchor\" href=\"#53-å‡ºç°å†…å­˜æ³„æ¼çš„çœŸå®åŸå› \">#</a> 5.3 å‡ºç°å†…å­˜æ³„æ¼çš„çœŸå®åŸå› </h2>\n<p>æ¯”è¾ƒä»¥ä¸Šä¸¤ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±ä¼šå‘ç°ï¼Œå†…å­˜æ³„æ¼çš„å‘ç”Ÿè·Ÿ ThreadLocalMap å½“ä¸­çš„ Key æ˜¯å¼ºè¿˜æ˜¯å¼±å¼•ç”¨æ²¡æœ‰å…³ç³»ï¼Œè€Œé€ æˆçœŸæ­£çš„å†…å­˜æ³„æ¼çš„åŸå› å¦‚ä¸‹ï¼š</p>\n<ol>\n<li>æ²¡æœ‰æ‰‹åŠ¨åˆ é™¤è¿™ä¸ª Entryï¼Œ(table æ•°ç»„æŒ‡å®šä½ç½®ç½®ä¸º nullï¼Œæ–­æ‰å¼ºå¼•ç”¨é“¾)</li>\n<li>CurrentThread ä¾ç„¶è¿è¡Œ (CurrentThread é”€æ¯ï¼Œåˆ™æŒ‡å‘ ThreadLocalMap çš„å¼•ç”¨é“¾å°±æ–­äº†ï¼Œè¿›è€Œå¼•å‘åç»­é“¾æ¡ä¸Šå…¨éƒ¨å¯¹è±¡ GC)</li>\n</ol>\n<p>ç»¼ä¸Šï¼šThreadLocal å†…å­˜æ³„æ¼çš„æ ¹æºæ˜¯ï¼š<mark>ç”±äº ThreadLocalMap çš„ç”Ÿå‘½å‘¨æœŸè·Ÿ Thread å¯¼è‡´çš„</mark> (å¦‚æœå­˜åœ¨çº¿ç¨‹æ± ï¼ŒThread å¤ç”¨ï¼Œåˆ™è¿™ä¸ª ThreadLocalMap æ°¸è¿œä¸ä¼šé”€æ¯æ‰)ï¼Œå¦‚æœæ²¡æœ‰æ‰‹åŠ¨åˆ é™¤å¯¹åº”çš„ Keyï¼Œå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p>\n<h2 id=\"54-ä¸ºä»€ä¹ˆå¼±å¼•ç”¨ä¼šå¯¼è‡´å†…å­˜æ³„æ¼è¿˜æ˜¯è¦ä½¿ç”¨å¼±å¼•ç”¨å‘¢\"><a class=\"anchor\" href=\"#54-ä¸ºä»€ä¹ˆå¼±å¼•ç”¨ä¼šå¯¼è‡´å†…å­˜æ³„æ¼è¿˜æ˜¯è¦ä½¿ç”¨å¼±å¼•ç”¨å‘¢\">#</a> 5.4 ä¸ºä»€ä¹ˆå¼±å¼•ç”¨ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œè¿˜æ˜¯è¦ä½¿ç”¨å¼±å¼•ç”¨å‘¢ï¼Ÿ</h2>\n<p>äº‹å®ä¸Šï¼ŒThreadLocalMap ä¸­çš„ set/getEntry æ–¹æ³•ä¸­ï¼Œä¼šå¯¹ Key ä¸º null (å³ ThreadLocal ä¸º null) è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœä¸º null çš„è¯ï¼Œé‚£ä¹ˆ value ä¹Ÿä¼šç½®ä¸º null</p>\n<p>è¿™å°±æ„å‘³ç€ä½¿ç”¨å®Œ ThreadLocalï¼ŒCurrentThread ä¾ç„¶è¿è¡Œçš„å‰æä¸‹ï¼Œå°±ç®—å¿˜è®°è°ƒç”¨ remove æ–¹æ³•ï¼Œå¼±å¼•ç”¨å¯ä»¥æ¯”å¼ºå¼•ç”¨å¤šä¸€å±‚ä¿éšœï¼šå¼±å¼•ç”¨çš„ ThreadLocal ä¼šè¢«å›æ”¶ï¼Œå¯¹åº”çš„ value åœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨ setï¼Œgetï¼Œremove ä¸­ä»»ä½•ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™ä¼šè¢«æ¸…é™¤ï¼Œä»è€Œé¿å…å†…å­˜æ³„æ¼</p>\n<h1 id=\"å…­-hashå†²çªçš„è§£å†³\"><a class=\"anchor\" href=\"#å…­-hashå†²çªçš„è§£å†³\">#</a> å…­ã€Hash å†²çªçš„è§£å†³</h1>\n<p>hash å†²çªçš„è§£å†³æ˜¯ Map ä¸­çš„ä¸€ä¸ªé‡è¦å†…å®¹ã€‚æˆ‘ä»¬ä»¥ hash å†²çªçš„è§£å†³æ–¹æ¡ˆä¸ºçº¿ç´¢ï¼Œæ¥ç ”ç©¶ä¸‹ ThreadLocalMap çš„æ ¸å¿ƒæºç ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240313203759499.png\" alt=\"image-20240313203759499\" /></p>\n<blockquote>\n<p><strong>æ„é€ æ–¹æ³•</strong>ï¼šThreadLocalMap (ThreadLocal&lt;?&gt; firstKey, Object value)</p>\n<p>æœ‰ä¸æ˜ç™½çš„åœ°æ–¹çœ‹ä¸‹è¿° ThreadLocalMap æ ¸å¿ƒæºç éƒ¨åˆ†çš„å½“ä¸­å…³äºæˆå‘˜å±æ€§çš„æè¿°</p>\n<p>æ„é€ å‡½æ•°é¦–å…ˆåˆ›å»ºä¸€ä¸ª 16 å¤§å° Entry æ•°ç»„ï¼Œç„¶åè®¡ç®—å‡º firstKey çš„ç´¢å¼•ï¼Œå­˜å‚¨åˆ° table ä¸­ï¼Œå¹¶è®¾ç½® size å’Œ threadold</p>\n</blockquote>\n<h2 id=\"61-threadlocalmapæ„é€ æ–¹æ³•\"><a class=\"anchor\" href=\"#61-threadlocalmapæ„é€ æ–¹æ³•\">#</a> 6.1 ThreadLocalMap æ„é€ æ–¹æ³•</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">ThreadLocalMap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ThreadLocal</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> firstKey<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// åˆå§‹åŒ– table</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    table <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ThreadLocal<span class=\"token punctuation\">.</span>ThreadLocalMap<span class=\"token punctuation\">.</span>Entry</span><span class=\"token punctuation\">[</span><span class=\"token constant\">INITIAL_CAPACITY</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// è®¡ç®—ç´¢å¼• (é‡ç‚¹)ï¼šè®¡ç®— fistKey è¿™ä¸ª ThreadLocal åœ¨ table ä¸­çš„å­˜æ”¾ä½ç½®</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> firstKey<span class=\"token punctuation\">.</span>threadLocalHashCode <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span> <span class=\"token constant\">INITIAL_CAPACITY</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// åˆ›å»º Entry å¹¶æ”¾ç½®åˆ° table</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    table<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ThreadLocal<span class=\"token punctuation\">.</span>ThreadLocalMap<span class=\"token punctuation\">.</span>Entry</span><span class=\"token punctuation\">(</span>firstKey<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    size <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// è®¾ç½®é˜ˆå€¼</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token function\">setThreshold</span><span class=\"token punctuation\">(</span><span class=\"token constant\">INITIAL_CAPACITY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>é‡ç‚¹åˆ†æï¼š <code>int i = firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - 1);</code>  è¿™ä¸€å¥ä¸­ hash è®¡ç®—</p>\n<ul>\n<li>å…³äº ThreadLocal.threadLocalhashCode</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> threadLocalHashCode <span class=\"token operator\">=</span> <span class=\"token function\">nextHashCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">nextHashCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">return</span> nextHashCode<span class=\"token punctuation\">.</span><span class=\"token function\">getAndAdd</span><span class=\"token punctuation\">(</span><span class=\"token constant\">HASH_INCREMENT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// è¿½åŠ </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// AutomicInteger æ˜¯ä¸€ä¸ªæä¾›åŸå­æ“ä½œçš„ Integer ç±»ï¼Œé€šè¿‡çº¿ç¨‹å®‰å…¨çš„æ–¹å¼æ“ä½œåŠ å‡ï¼Œé€‚åˆé«˜å¹¶å‘çš„æƒ…å†µä¸‹ä½¿ç”¨.</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">AutomicInteger</span> nextHashCode <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AutomicInteger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// ç‰¹æ®Šçš„ hash å€¼ï¼šå’Œæ–æ³¢æ‹‰å¥‘æ•°åˆ—ï¼Œé»„é‡‘åˆ†å‰²æ•°æ˜¯æœ‰å…³ç³»çš„ã€‚</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">HASH_INCREMENT</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x61c88647</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ª AutomicInteger ç±»å‹ï¼Œæ¯æ¬¡å½“å‰å€¼å¹¶åŠ ä¸Š HASH_INCREMENTï¼Œè¿™ä¸ª HASH_INCREMENT æ˜¯å’Œæ–æ³¢é‚£å¥‘æ•°åˆ— (é»„é‡‘åˆ†å‰²æ•°) æœ‰å…³ï¼Œå…¶ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†è®©å“ˆå¸Œç èƒ½å‡åŒ€çš„åˆ†å¸ƒåœ¨ 2 çš„ n æ¬¡æ–¹çš„æ•°ç»„é‡Œï¼Œä¹Ÿå°±æ˜¯ Entry [] table ä¸­ï¼Œè¿™æ ·åšå¯ä»¥å°½é‡é¿å… hash å†²çª</p>\n<ul>\n<li>\n<p>å…³äº &amp; (INITIAL_CAPACITY - 1)</p>\n<p>è®¡ç®—ç´¢å¼•ä½ç½®çš„æ—¶å€™é‡‡ç”¨äº† hashcode &amp; (size - 1) çš„æ–¹å¼ï¼Œç›¸å½“äºå–ä½™æ“ä½œ hashCode % size çš„ä¸€ä¸ªæ›´é«˜æ•ˆçš„å®ç°ï¼Œæ­£æ˜¯å› ä¸ºè¿™ç§ç®—æ³•ï¼Œæˆ‘ä»¬è¦æ±‚ size å¿…é¡»æ˜¯ 2 çš„æ•´æ•°æ¬¡å¹‚ï¼Œè¿™ä¹Ÿèƒ½<mark>ä¿è¯åœ¨ç´¢å¼•ä¸è¶Šç•Œçš„æƒ…å†µä¸‹ï¼Œä½¿å¾— hash å‘ç”Ÿå†²çªçš„æ¬¡æ•°å‡å°</mark>ã€‚</p>\n</li>\n</ul>\n<h2 id=\"62-threadlocalmapçš„setæ–¹æ³•\"><a class=\"anchor\" href=\"#62-threadlocalmapçš„setæ–¹æ³•\">#</a> 6.2 ThreadLocalMap çš„ set æ–¹æ³•</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ThreadLocal</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> key<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">ThreadLocal<span class=\"token punctuation\">.</span>ThreadLocalMap<span class=\"token punctuation\">.</span>Entry</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> tab <span class=\"token operator\">=</span> table<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> len <span class=\"token operator\">=</span> tab<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// è®¡ç®—ç´¢å¼•</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> key<span class=\"token punctuation\">.</span>threadLocalHashCode <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span>len <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>     * é‡ç‚¹ä»£ç ï¼šä½¿ç”¨çº¿æ€§æ¢æµ‹æ³•æŸ¥æ‰¾å…ƒç´ </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>     <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ThreadLocal<span class=\"token punctuation\">.</span>ThreadLocalMap<span class=\"token punctuation\">.</span>Entry</span> e <span class=\"token operator\">:</span> tab<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> e <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span> e <span class=\"token operator\">=</span> tab<span class=\"token punctuation\">[</span>i <span class=\"token operator\">=</span> <span class=\"token function\">nextIndex</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>         <span class=\"token class-name\">ThreadLocal</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> k <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>       </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>         <span class=\"token comment\">// ThreadLocal å¯¹åº”çš„ key å­˜åœ¨ï¼Œåˆ™è¦†ç›–ä¹‹å‰çš„å€¼</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>         <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>k <span class=\"token operator\">==</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>             e<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>             <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>       </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>         <span class=\"token comment\">//key ä¸º null, ä½†æ˜¯å€¼ä¸ä¸º null (æœªåŠæ—¶ remove, ä½†ä¹‹å‰æ”¾ç½®æ­¤ä½ç½® ThreadLocal è¢«å›æ”¶çš„æƒ…å†µ), å½“å‰æ•°ç»„ä¸­çš„ Entry æ˜¯ä¸€ä¸ªæˆæ—§çš„ (stale) å…ƒç´ .</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>         <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>k <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>             <span class=\"token comment\">// ç”¨æ–°çš„å…ƒç´ æ›¿æ¢æˆæ—§çš„å…ƒç´ ï¼Œè¿™ä¸ªè¿›è¡Œäº†ä¸å°‘çš„åƒåœ¾æ¸…ç†åŠ¨ä½œï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>             <span class=\"token function\">replaceStaleEntry</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>             <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>     <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token comment\">// ThreadLocal å¯¹åº”çš„ key ä¸å­˜åœ¨ï¼Œä¸”æ²¡æœ‰æ‰¾åˆ°é™ˆæ—§çš„å…ƒç´ ï¼Œåˆ™åœ¨ç©ºå…ƒç´ çš„ä½ç½®åˆ›å»ºä¸€ä¸ªæ–°çš„ Entry</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    tab<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Entry</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">int</span> sz <span class=\"token operator\">=</span> <span class=\"token operator\">++</span>size<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>     * cleanSomeSlots ç”¨äºæ¸…é™¤é‚£äº› e.get () == null çš„å…ƒç´ ï¼ˆå³ï¼Œkey ä¸º null çš„å…ƒç´ ï¼‰.</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>     * è¿™ç§æ•°æ® key å…³è”çš„å¯¹è±¡å·²ç»è¢«å›æ”¶äº†ï¼Œæ‰€ä»¥è¿™ä¸ª Entry (table [index]) å¯ä»¥è¢«ç½®ä¸º null,</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>     * å¦‚æœæ²¡æœ‰æ¸…é™¤ä»»ä½• entry, å¹¶ä¸”å½“å‰ä½¿ç”¨é‡çš„è¾¾åˆ°äº† è´Ÿè½½å› å­ æ‰€å®šä¹‰çš„ 2/3, é‚£ä¹ˆè¿›è¡Œ rehash (æ‰§è¡Œä¸€æ¬¡å…¨è¡¨çš„ï¼Œæ‰«ææ¸…ç†å·¥ä½œ)</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">cleanSomeSlots</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> sz<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> sz <span class=\"token operator\">>=</span> threshold<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token function\">rehash</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"43\"></td><td><pre> * è·å–ç¯å½¢ç´¢å¼•çš„ä¸‹ä¸€ä¸ªæ•°ç»„</pre></td></tr><tr><td data-num=\"44\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">nextIndex</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> len<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> i <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>\n<p>æ‰§è¡Œæµç¨‹ç®€è¿°ï¼š</p>\n<ol>\n<li>é¦–å…ˆæ ¹æ® key è®¡ç®—ç´¢å¼• iï¼Œç„¶åæŸ¥æ‰¾ i ä½ç½®çš„ä¸Š Entry</li>\n<li>è‹¥æ˜¯ Entry å·²ç»å­˜åœ¨ï¼Œå¹¶ä¸” key ç­‰äºä¼ å…¥çš„ keyï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ç›´æ¥ç»™è¿™ä¸ª Entry èµ‹æ–°çš„ value å€¼</li>\n<li>è‹¥æ˜¯ Entry å·²ç»å­˜åœ¨ï¼Œå¹¶ä¸” key ä¸º nullï¼Œåˆ™è°ƒç”¨çš„ replaceStaleEntry æ¥æ›´æ¢è¿™ä¸ª key ä¸ºç©º Entry</li>\n<li>ä¸æ–­å¾ªç¯æ£€æµ‹ï¼Œç›´åˆ°é‡è§ä¸º null çš„åœ°æ–¹ï¼Œè¿™ä¸ªæ—¶å€™è¦æ˜¯è¿˜æ²¡æœ‰åœ¨å¾ªç¯ä¸­ returnï¼Œé‚£ä¹ˆå°±åœ¨è¿™ä¸ª null çš„ä½ç½®æ–°å»ºä¸€ä¸ª Entryï¼Œå¹¶ä¸”æ’å…¥ size  + 1</li>\n<li>æœ€åè°ƒç”¨ cleanSomeSlotsï¼Œæ¸…ç† key ä¸º null çš„ Entryï¼Œæœ€åè¿”å›æ˜¯å¦æ¸…ç†äº† Entryï¼Œæ¥ä¸‹æ¥åˆ¤æ–­ sz æ˜¯å¦ &gt;= thresold è¾¾åˆ° rehash æ¡ä»¶ï¼Œè¾¾åˆ°çš„è¯å°±ä¼šè°ƒç”¨ rehash å‡½æ•°æ‰§è¡Œä¸€æ¬¡å…¨è¡¨çš„æ¸…ç†å·¥ä½œ</li>\n</ol>\n<p><strong>é‡ç‚¹åˆ†æ</strong>ï¼šThredLocalMap ä½¿ç”¨çº¿æ€§æ¢æµ‹æ³•æ¥è§£å†³ hash å†²çªï¼š</p>\n<p>è¯¥æ–¹æ³•ä¸€æ¬¡æ¢æµ‹ä¸€ä¸ªåœ°å€ï¼Œç›´åˆ°æœ‰ç©ºçš„åœ°å€åæ’å…¥ï¼Œè‹¥æ•´ä¸ªç©ºé—´éƒ½æ‰¾ä¸åˆ°ç©ºä½™çš„åœ°å€ï¼Œåˆ™äº§ç”Ÿæº¢å‡ºã€‚</p>\n<p>ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾å½“å‰çš„ tab é•¿åº¦ä¸º 16ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœè®¡ç®—å‡ºæ¥ key çš„ç´¢å¼•ä¸º 14ï¼Œå¦‚æœ table [14] ä¸Šå·²ç»æœ‰å€¼ï¼Œå¹¶ä¸” key ä¸å½“å‰ key ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆå°±å‘ç”Ÿäº† hash å†²çªï¼Œè¿™ä¸ªæ—¶å€™å°† 14 + 1 å¾—åˆ° 15 ï¼Œå– table [15] è¿›è¡Œåˆ¤æ–­ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœè¿˜æ˜¯å†²çªå°±ä¼šè¿”å› 0ï¼Œå– table [0]ï¼Œä»¥æ­¤ç±»æ¨ï¼ŒçŸ¥é“å¯ä»¥æ’å…¥ã€‚æŒ‰ç…§ä¸Šé¢è¿™ä¸ªæè¿°ï¼Œå¯ä»¥æŠŠ Entry [] table çœ‹æˆä¸€ä¸ªç¯å½¢æ•°ç»„ã€‚</p>\n</li>\n</ul>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "çŸ¥è¯†ç‚¹",
                "å¤šçº¿ç¨‹",
                "å¤šçº¿ç¨‹",
                "çŸ¥è¯†ç‚¹"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/%E5%9D%91%E7%82%B9/MybatisPlus%E4%B8%AD%E4%BD%BF%E7%94%A8SelectById%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E6%80%BB%E6%98%AFnull/",
            "url": "https://pigpigletsgo.github.io/computer-science/%E5%9D%91%E7%82%B9/MybatisPlus%E4%B8%AD%E4%BD%BF%E7%94%A8SelectById%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E6%80%BB%E6%98%AFnull/",
            "title": "MybatisPlusä¸­ä½¿ç”¨SelectByIdæŸ¥è¯¢æ•°æ®æ€»æ˜¯null",
            "date_published": "2024-03-12T05:40:26.197Z",
            "content_html": "<h1 id=\"mybatisplusä¸­ä½¿ç”¨selectbyidæŸ¥è¯¢æ•°æ®æ€»æ˜¯null\"><a class=\"anchor\" href=\"#mybatisplusä¸­ä½¿ç”¨selectbyidæŸ¥è¯¢æ•°æ®æ€»æ˜¯null\">#</a> MybatisPlus ä¸­ä½¿ç”¨ SelectById æŸ¥è¯¢æ•°æ®æ€»æ˜¯ null</h1>\n<p>ä»Šå¤©é‡åˆ°äº†ä¸€ä¸ªéå¸¸å‘çš„é—®é¢˜ï¼</p>\n<p>ä½¿ç”¨ MyBatisPlus æ¡†æ¶ å»æŸ¥è¯¢äº†ä¸€æ¡æ•°æ®å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240312110738645.png\" alt=\"image-20240312110738645\" /></p>\n<p>æ³¨æ„äº† ï¼Œè¿™ä¸ªè¡¨ä¸­æ˜æ˜æœ‰ id çš„å€¼ä½†æ˜¯æˆ‘ä»¬æŸ¥è¯¢çš„ä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">ShopOrder</span> <span class=\"token function\">getOne</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">ShopOrder</span> shopOrder <span class=\"token operator\">=</span> mapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectOne</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">LambdaQueryWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ShopOrder</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">eq</span><span class=\"token punctuation\">(</span>id <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ShopOrder</span><span class=\"token operator\">::</span><span class=\"token function\">getShopId</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>shopOrder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">return</span> shopOrder<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç»“æœæ€»æ˜¯æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®ä¸º null äºæ˜¯çœ‹äº†ä¸‹å­—æ®µå‘ç°äº†æœ‰ä¸ªé€»è¾‘åˆ é™¤ is_del æ²¡æœ‰è¢«èµ‹å€¼æ˜¯ä¸ª null æ”¹æˆäº† 0 ç»“æœå¯ä»¥è¢«æŸ¥è¯¢å‡ºæ¥äº†ï¼Œè®°å½•ä¸€ä¸‹ä»Šå¤©é‡åˆ°çš„å‘ã€‚</p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "å‘ç‚¹",
                "è®¡ç®—æœºå­¦ç§‘",
                "å‘ç‚¹"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/http/Java%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8%E6%8E%A5%E5%8F%A3(HttpClient%E8%AF%A6%E7%BB%86%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B)/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/http/Java%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8%E6%8E%A5%E5%8F%A3(HttpClient%E8%AF%A6%E7%BB%86%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B)/",
            "title": "Javaä½¿ç”¨ä»£ç è°ƒç”¨æ¥å£(HttpClientè¯¦ç»†ä½¿ç”¨å®ä¾‹)",
            "date_published": "2024-03-09T08:16:05.006Z",
            "content_html": "<h1 id=\"javaä½¿ç”¨ä»£ç è°ƒç”¨æ¥å£httpclientè¯¦ç»†ä½¿ç”¨å®ä¾‹\"><a class=\"anchor\" href=\"#javaä½¿ç”¨ä»£ç è°ƒç”¨æ¥å£httpclientè¯¦ç»†ä½¿ç”¨å®ä¾‹\">#</a> Java ä½¿ç”¨ä»£ç è°ƒç”¨æ¥å£ (HttpClient è¯¦ç»†ä½¿ç”¨å®ä¾‹)</h1>\n<p><strong>äº†è§£ä»€ä¹ˆæ˜¯ HttpClient</strong>ï¼š</p>\n<p>Java ä¸­çš„ HttpClient æ˜¯ç”¨äºè¿›è¡Œ HTTP è¯·æ±‚å’Œå“åº”çš„ç±»åº“ã€‚å®ƒæä¾›äº†ä¸€ç§<mark>ç®€å•ï¼Œçµæ´»ï¼Œå¯æ‰©å±•çš„æ–¹å¼æ¥å‘é€ HTTP è¯·æ±‚</mark> ==ï¼Œå¹¶å¤„ç† HTTP å“åº” ==ã€‚HttpClient çš„<mark>æ ¸å¿ƒ</mark>åŠŸèƒ½åŒ…æ‹¬<mark>åˆ›å»º HTTP è¯·æ±‚ï¼Œè®¾ç½®è¯·æ±‚å‚æ•°ï¼Œå‘é€è¯·æ±‚ï¼Œæ¥æ”¶å“åº”ï¼Œå¤„ç†å“åº”æ•°æ®ä»¥åŠå¤„ç†å¼‚å¸¸æƒ…å†µ</mark>ã€‚å®ƒä½¿å¾—åœ¨ Java åº”ç”¨ç¨‹åºä¸­å®ç°<mark> HTTP é€šä¿¡</mark>å˜å¾—æ›´åŠ <mark>æ–¹ä¾¿å’Œé«˜æ•ˆ</mark>ã€‚</p>\n<p><strong>HttpClient çš„ä¸»è¦åŠŸèƒ½</strong>ï¼š</p>\n<p>å®ç°äº†æ‰€æœ‰ HTTP çš„æ–¹æ³• (GET,POST,PUT,DELETE,HEAD,OPTIONS) ç­‰</p>\n<p>æ”¯æŒ HTTPS åè®®</p>\n<p>æ”¯æŒè‡ªåŠ¨ (è·³è½¬) è½¬å‘</p>\n<p>. . .</p>\n<h2 id=\"1-å¼•å…¥ä¾èµ–\"><a class=\"anchor\" href=\"#1-å¼•å…¥ä¾èµ–\">#</a> 1 å¼•å…¥ä¾èµ–</h2>\n<h3 id=\"11-å¼•å…¥httpclientçš„ä¾èµ–\"><a class=\"anchor\" href=\"#11-å¼•å…¥httpclientçš„ä¾èµ–\">#</a> 1.1 å¼•å…¥ HttpClient çš„ä¾èµ–</h3>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.apache.httpcomponents<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>httpclient<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>4.5.5<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h3 id=\"12-å¼•å…¥fastjsonä¾èµ–\"><a class=\"anchor\" href=\"#12-å¼•å…¥fastjsonä¾èµ–\">#</a> 1.2 å¼•å…¥ fastjson ä¾èµ–</h3>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>fastjson<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.2.47<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>PSï¼šæœ¬äººå¼•å…¥ä¾èµ–çš„ç›®çš„æ˜¯ï¼Œåœ¨åç»­å®ä¾‹ä¸­ï¼Œä¼šç”¨åˆ° &quot;å°†å¯¹è±¡è½¬åŒ–ä¸º json å­—ç¬¦ä¸²çš„åŠŸèƒ½&quot;ï¼Œä¹Ÿå¯ä»¥å¼•å…¶å®ƒæœ‰æ­¤åŠŸèƒ½çš„ä¾èµ–</p>\n<p>PSï¼šä½¿ç”¨çš„æ˜¯ SpringBoot å·¥ç¨‹é€šè¿‡ HttpClient å‘é€è¯·æ±‚åˆ° controller æ¥å£ï¼Œå¹¶å°† controller æ¥å£çš„å“åº”è¿”å›åˆ° HttpClient ä¸­æ¥æ¥æ”¶ã€‚</p>\n<h2 id=\"2-è¯¦ç»†ä½¿ç”¨ç¤ºä¾‹\"><a class=\"anchor\" href=\"#2-è¯¦ç»†ä½¿ç”¨ç¤ºä¾‹\">#</a> 2 è¯¦ç»†ä½¿ç”¨ç¤ºä¾‹</h2>\n<p>å£°æ˜ï¼šæ­¤ç¤ºä¾‹ä¸­ï¼Œä»¥ Java å‘é€ HttpClient (åœ¨ test é‡Œé¢å•å…ƒæµ‹è¯•å‘é€çš„)ï¼›ä¹Ÿæ˜¯ä»¥ Java æ¥æ”¶çš„ (åœ¨ controller é‡Œé¢æ¥æ”¶çš„)</p>\n<h3 id=\"21-getæ— å‚\"><a class=\"anchor\" href=\"#21-getæ— å‚\">#</a> 2.1 GET æ— å‚</h3>\n<p>HttpClient å‘é€ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">contextLoads</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\">// é€šè¿‡å»ºé€ è€…æ¨¡å¼ è·å– HttpClient å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">CloseableHttpClient</span> httpClient <span class=\"token operator\">=</span> <span class=\"token class-name\">HttpClientBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token comment\">// åˆ›å»º Get è¯·æ±‚æŒ‡å®šè¯·æ±‚è·¯å¾„</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token class-name\">HttpGet</span> httpGet <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpGet</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://localhost/doGetControllerOne\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token class-name\">CloseableHttpResponse</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token comment\">// å‘é€ Get è¯·æ±‚ å¾—åˆ°å“åº”å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      response <span class=\"token operator\">=</span> httpClient<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>httpGet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token comment\">// ä»å“åº”å¯¹è±¡ä¸­åå»å“åº”å®ä½“</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token class-name\">HttpEntity</span> responseEntity <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getEntity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å“åº”çŠ¶æ€ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getStatusLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>responseEntity <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>         <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å“åº”å†…å®¹é•¿åº¦ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> responseEntity<span class=\"token punctuation\">.</span><span class=\"token function\">getContentLength</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>         <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å“åº”å†…å®¹ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> <span class=\"token class-name\">EntityUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span>responseEntity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token comment\">// é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            response<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>httpClient <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            httpClient<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯¹åº”æ¥æ”¶ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TestDemo</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"doGetControllerOne\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">doGetControllerOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<pre><code>å“åº”çŠ¶æ€ä¸ºï¼šHTTP/1.1 200 \nå“åº”å†…å®¹é•¿åº¦ä¸ºï¼š5\nå“åº”å†…å®¹ä¸ºï¼šhello\n</code></pre>\n<h3 id=\"22-getæœ‰å‚æ–¹å¼ä¸€ç›´æ¥æ‹¼æ¥url\"><a class=\"anchor\" href=\"#22-getæœ‰å‚æ–¹å¼ä¸€ç›´æ¥æ‹¼æ¥url\">#</a> 2.2 GET æœ‰å‚ (æ–¹å¼ä¸€ï¼šç›´æ¥æ‹¼æ¥ URL)</h3>\n<p>HttpClient å‘é€ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\">// é€šè¿‡å»ºé€ è€…æ¨¡å¼ è·å– HttpClient å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">CloseableHttpClient</span> httpClient <span class=\"token operator\">=</span> <span class=\"token class-name\">HttpClientBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token comment\">// ä½¿ç”¨ SpringBuffer æ¥è¿›è¡Œå‚æ•°çš„æ‹¼æ¥</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token class-name\">StringBuffer</span> params <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token comment\">// ä½¿ç”¨ URLEncoder è¿›è¡Œç¼–ç é˜²æ­¢ä¸­æ–‡ä¹±ç </span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      params<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name=\"</span> <span class=\"token operator\">+</span> <span class=\"token class-name\">URLEncoder</span><span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Xxx\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      params<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&amp;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      params<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"age=24\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">UnsupportedEncodingException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token comment\">// åˆ›å»º Get è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token class-name\">HttpGet</span> httpGet <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpGet</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://localhost/doGetControllerTwo?\"</span> <span class=\"token operator\">+</span> params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token class-name\">CloseableHttpResponse</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token comment\">// é…ç½®è¯·æ±‚ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token class-name\">RequestConfig</span> requestConfig <span class=\"token operator\">=</span> <span class=\"token class-name\">RequestConfig</span><span class=\"token punctuation\">.</span><span class=\"token function\">custom</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>         <span class=\"token comment\">// é“¾æ¥è¶…æ—¶æ—¶é—´</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">setConnectTimeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">5000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>         <span class=\"token comment\">// è¯·æ±‚è¶…æ—¶æ—¶é—´</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">setConnectionRequestTimeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">5000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>         <span class=\"token comment\">//socket è¯»å†™è¶…æ—¶æ—¶é—´</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">setSocketTimeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">5000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>         <span class=\"token comment\">// æ˜¯å¦å…è®¸é‡å®šå‘</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">setRedirectsEnabled</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token comment\">// å°†é…ç½®ä¿¡æ¯æ·»åŠ åˆ° Get è¯·æ±‚ä¸­</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      httpGet<span class=\"token punctuation\">.</span><span class=\"token function\">setConfig</span><span class=\"token punctuation\">(</span>requestConfig<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token comment\">// æ‰§è¡Œ Get è¯·æ±‚è·å–å“åº”å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      response <span class=\"token operator\">=</span> httpClient<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>httpGet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token comment\">// è·å–å“åº”å®ä½“</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token class-name\">HttpEntity</span> entity <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getEntity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å“åº”çŠ¶æ€ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getStatusLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>entity <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>         <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å“åº”å†…å®¹é•¿åº¦ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> entity<span class=\"token punctuation\">.</span><span class=\"token function\">getContentLength</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>         <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å“åº”å†…å®¹ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> <span class=\"token class-name\">EntityUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span>entity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>         <span class=\"token comment\">// é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            response<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>httpClient <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            httpClient<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯¹åº”æ¥æ”¶ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"doGetControllerTwo\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">doGetControllerOne</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span> age<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token string\">\"ä»Šå¹´\"</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">+</span> <span class=\"token string\">\", å·²ç»\"</span> <span class=\"token operator\">+</span> age <span class=\"token operator\">+</span> <span class=\"token string\">\" å²äº†\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<pre><code>å“åº”çŠ¶æ€ä¸ºï¼šHTTP/1.1 200 \nå“åº”å†…å®¹é•¿åº¦ä¸ºï¼š26\nå“åº”å†…å®¹ä¸ºï¼šä»Šå¹´Xxx, å·²ç»24 å²äº†\n</code></pre>\n<h3 id=\"23-getæœ‰å‚æ–¹å¼äºŒä½¿ç”¨urlè·å¾—httpget\"><a class=\"anchor\" href=\"#23-getæœ‰å‚æ–¹å¼äºŒä½¿ç”¨urlè·å¾—httpget\">#</a> 2.3 GET æœ‰å‚ (æ–¹å¼äºŒï¼šä½¿ç”¨ URL è·å¾— HttpGet)</h3>\n<p>HttpClient å‘é€ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\">// é€šè¿‡å»ºé€ è€…æ¨¡å¼è·å– HttpClient å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">CloseableHttpClient</span> httpClient <span class=\"token operator\">=</span> <span class=\"token class-name\">HttpClientBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">URI</span> uri <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// åˆ›å»º List é›†åˆç±»å‹ä¸º ç”¨äºè¡¨ç¤ºé”®å€¼å¯¹çš„æ¥å£é€šå¸¸ç”¨äº HTTP è¯·æ±‚å’Œå“åº”çš„å‚æ•°</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">NameValuePair</span><span class=\"token punctuation\">></span></span> params <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">//  è®¾ç½®å‚æ•°</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   params<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BasicNameValuePair</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Xxx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   params<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BasicNameValuePair</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"age\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"18\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token comment\">// æ„å»º URI å¯¹è±¡çš„ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      uri <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URIBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">setScheme</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">setHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">setPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/doGetControllerTwo\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">setParameters</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">URISyntaxException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token comment\">// åˆ›å»º Get è¯·æ±‚ä¼ å…¥è¯·æ±‚ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   <span class=\"token class-name\">HttpGet</span> httpGet <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpGet</span><span class=\"token punctuation\">(</span>uri<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token comment\">// é…ç½®ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   <span class=\"token class-name\">RequestConfig</span> requestConfig <span class=\"token operator\">=</span> <span class=\"token class-name\">RequestConfig</span><span class=\"token punctuation\">.</span><span class=\"token function\">custom</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">setConnectTimeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">5000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">setConnectionRequestTimeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">5000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">setSocketTimeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">5000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">setRedirectsEnabled</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>   <span class=\"token comment\">// å°†é…ç½®ä¿¡æ¯ä¼ å…¥è¯·æ±‚ä¸­</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>   httpGet<span class=\"token punctuation\">.</span><span class=\"token function\">setConfig</span><span class=\"token punctuation\">(</span>requestConfig<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>   <span class=\"token class-name\">CloseableHttpResponse</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token comment\">// æ‰§è¡Œè¯·æ±‚è·å¾—å“åº”å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      response <span class=\"token operator\">=</span> httpClient<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>httpGet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token comment\">// é€šè¿‡å“åº”å¯¹è±¡è·å–å®ä½“</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token class-name\">HttpEntity</span> entity <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getEntity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å“åº”çŠ¶æ€ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getStatusLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>entity <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>         <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å“åº”å†…å®¹é•¿åº¦ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> entity<span class=\"token punctuation\">.</span><span class=\"token function\">getContentLength</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>         <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å“åº”å†…å®¹ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> <span class=\"token class-name\">EntityUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span>entity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      <span class=\"token comment\">// é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            response<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>httpClient <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            httpClient<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯¹åº”æ¥æ”¶ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"doGetControllerTwo\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">doGetControllerOne</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span> age<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token string\">\"ä»Šå¹´\"</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">+</span> <span class=\"token string\">\", å·²ç»\"</span> <span class=\"token operator\">+</span> age <span class=\"token operator\">+</span> <span class=\"token string\">\" å²äº†\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<pre><code>å“åº”çŠ¶æ€ä¸ºï¼šHTTP/1.1 200 \nå“åº”å†…å®¹é•¿åº¦ä¸ºï¼š26\nå“åº”å†…å®¹ä¸ºï¼šä»Šå¹´Xxx, å·²ç»18 å²äº†\n</code></pre>\n<h3 id=\"24-postæ— å‚\"><a class=\"anchor\" href=\"#24-postæ— å‚\">#</a> 2.4 POST æ— å‚</h3>\n<p>HttpClient å‘é€ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">CloseableHttpClient</span> httpClient <span class=\"token operator\">=</span> <span class=\"token class-name\">HttpClientBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">HttpPost</span> httpPost <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpPost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://localhost/doPostControllerOne\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">CloseableHttpResponse</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      response <span class=\"token operator\">=</span> httpClient<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>httpPost<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token class-name\">HttpEntity</span> entity <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getEntity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"çŠ¶æ€ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getStatusLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>entity <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>         <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è·å–å“åº”é•¿åº¦ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> entity<span class=\"token punctuation\">.</span><span class=\"token function\">getContentLength</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>         <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è·å–å“åº”å†…å®¹ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> <span class=\"token class-name\">EntityUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span>entity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            response<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>httpClient <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            httpClient<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯¹åº”æ¥æ”¶ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"doPostControllerOne\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">doPostControllerOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token string\">\"è¿™ä¸ªpostè¯·æ±‚æ²¡æœ‰ä»»ä½•å‚æ•°\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<pre><code>çŠ¶æ€ä¸ºï¼šHTTP/1.1 200 \nè·å–å“åº”é•¿åº¦ä¸ºï¼š34\nè·å–å“åº”å†…å®¹ä¸ºï¼šè¿™ä¸ªpostè¯·æ±‚æ²¡æœ‰ä»»ä½•å‚æ•°\n</code></pre>\n<h3 id=\"25-postæœ‰å‚æ™®é€šå‚æ•°\"><a class=\"anchor\" href=\"#25-postæœ‰å‚æ™®é€šå‚æ•°\">#</a> 2.5 POST æœ‰å‚ (æ™®é€šå‚æ•°)</h3>\n<p>PSï¼šPOST ä¼ é€’æ™®é€šå‚æ•°æ—¶ï¼Œæ–¹å¼ä¸ GET ä¸€æ ·å³å¯ï¼Œè¿™é‡Œä»¥ç›´æ¥åœ¨ URL åç¼€ä¸Šå‚æ•°çš„æ–¹å¼ç¤ºä¾‹</p>\n<p>HttpClient å‘é€ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test4</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\">// é€šè¿‡æ„é€ è€…æ¨¡å¼è·å– HttpClient å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">CloseableHttpClient</span> httpClient <span class=\"token operator\">=</span> <span class=\"token class-name\">HttpClientBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token comment\">// åˆ›å»ºå­—ç¬¦ç¼“å†²åŒºç”¨äºæ‹¼æ¥å‚æ•°</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token class-name\">StringBuffer</span> params <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      params<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name=\"</span> <span class=\"token operator\">+</span> <span class=\"token class-name\">URLEncoder</span><span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Xxx\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      params<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&amp;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      params<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"age=24\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">UnsupportedEncodingException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token comment\">// åˆ›å»º Post è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token class-name\">HttpPost</span> httpPost <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpPost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://localhost/doPostControllerTwo?\"</span> <span class=\"token operator\">+</span> params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token class-name\">CloseableHttpResponse</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token comment\">// æ‰§è¡Œè¯·æ±‚å¹¶è¿”å›å“åº”å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      response <span class=\"token operator\">=</span> httpClient<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>httpPost<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token comment\">// è·å–å®ä½“</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token class-name\">HttpEntity</span> entity <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getEntity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"çŠ¶æ€ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getStatusLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>entity <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>         <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å“åº”å†…å®¹é•¿åº¦ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> entity<span class=\"token punctuation\">.</span><span class=\"token function\">getContentLength</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>         <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å“åº”å†…å®¹ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> <span class=\"token class-name\">EntityUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span>entity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token comment\">// é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            response<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>httpClient <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            httpClient<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯¹åº”æ¥æ”¶ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"doPostControllerTwo\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">doPostControllerTwo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span> age<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token string\">\"ä»Šå¹´\"</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">+</span> <span class=\"token string\">\", å·²ç»\"</span> <span class=\"token operator\">+</span> age <span class=\"token operator\">+</span> <span class=\"token string\">\" å²äº†\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<pre><code>çŠ¶æ€ä¸ºï¼šHTTP/1.1 200 \nå“åº”å†…å®¹é•¿åº¦ä¸ºï¼š26\nå“åº”å†…å®¹ä¸ºï¼šä»Šå¹´Xxx, å·²ç»24 å²äº†\n</code></pre>\n<h3 id=\"26-postæœ‰å‚å¯¹è±¡å‚æ•°\"><a class=\"anchor\" href=\"#26-postæœ‰å‚å¯¹è±¡å‚æ•°\">#</a> 2.6 POST æœ‰å‚ (å¯¹è±¡å‚æ•°)</h3>\n<p>HttpClient å‘é€ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test5</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\">// é€šè¿‡æ„å»ºè€…æ¨¡å¼è·å– HttpClient å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">CloseableHttpClient</span> httpClient <span class=\"token operator\">=</span> <span class=\"token class-name\">HttpClientBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token comment\">// åˆ›å»º Post è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token class-name\">HttpPost</span> httpPost <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpPost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://localhost/doPostControllerThree\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token comment\">// åˆ›å»ºå¯¹è±¡å¹¶è®¾ç½®å±æ€§ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   user<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"åˆ˜æ¡‘\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   user<span class=\"token punctuation\">.</span><span class=\"token function\">setAge</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token comment\">// å°†å¯¹è±¡åºåˆ—åŒ–ä¸º JSON æ•°æ®</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token class-name\">String</span> jsonString <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSONString</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token comment\">// è®¾ç½® json æ•°æ®ä¸º utf-8 è¿”å› json å®ä½“</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token class-name\">StringEntity</span> entity <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringEntity</span><span class=\"token punctuation\">(</span>jsonString<span class=\"token punctuation\">,</span> <span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token comment\">// è®¾ç½®è¯·æ±‚çš„å®ä½“æ•°æ®</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   httpPost<span class=\"token punctuation\">.</span><span class=\"token function\">setEntity</span><span class=\"token punctuation\">(</span>entity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token comment\">// è®¾ç½®è¯·æ±‚çš„è¯·æ±‚å¤´ä¿¡æ¯ä¸º json æ•°æ®æ ¼å¼</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   httpPost<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Content-Type\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"application/json;charset=utf8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token class-name\">CloseableHttpResponse</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token comment\">// æ‰§è¡Œè¯·æ±‚å¹¶è¿”å›å“åº”å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      response <span class=\"token operator\">=</span> httpClient<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>httpPost<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token comment\">// è·å–å®ä½“</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token class-name\">HttpEntity</span> responseEntity <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getEntity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å“åº”çŠ¶æ€ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getStatusLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>responseEntity <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>         <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å“åº”å†…å®¹é•¿åº¦ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> responseEntity<span class=\"token punctuation\">.</span><span class=\"token function\">getContentLength</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>         <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å“åº”å†…å®¹ä¸º\"</span> <span class=\"token operator\">+</span> <span class=\"token class-name\">EntityUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span>responseEntity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token comment\">// é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            response<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>httpClient <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            httpClient<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯¹åº”æ¥æ”¶ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"doPostControllerThree\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">doPostControllerThree</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">return</span> user<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<pre><code>å“åº”çŠ¶æ€ä¸ºï¼šHTTP/1.1 200 \nå“åº”å†…å®¹é•¿åº¦ä¸ºï¼š-1\nå“åº”å†…å®¹ä¸º&#123;&quot;name&quot;:&quot;åˆ˜æ¡‘&quot;,&quot;age&quot;:20&#125;\n</code></pre>\n<h3 id=\"27-postæœ‰å‚æ™®é€šå‚æ•°-å¯¹è±¡å‚æ•°\"><a class=\"anchor\" href=\"#27-postæœ‰å‚æ™®é€šå‚æ•°-å¯¹è±¡å‚æ•°\">#</a> 2.7 POST æœ‰å‚ (æ™®é€šå‚æ•° + å¯¹è±¡å‚æ•°)</h3>\n<p>PSï¼šPOST ä¼ é€’æ™®é€šå‚æ•°æ—¶ï¼Œæ–¹å¼ä¸ GET ä¸€æ ·å³å¯ï¼Œè¿™é‡Œä»¥é€šè¿‡ URI è·å– HttpPost çš„æ–¹å¼ä¸ºä¾‹</p>\n<p>HttpClient å‘é€ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test6</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\">// é€šè¿‡æ„é€ è€…æ¨¡å¼è·å– HttpClient å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">CloseableHttpClient</span> httpClient <span class=\"token operator\">=</span> <span class=\"token class-name\">HttpClientBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token comment\">// åˆ›å»º List é›†åˆæ³›å‹ä¸º é”®å€¼å¯¹çš„å¯¹è±¡ç”¨å¸¸ç”¨äº HTTP è¯·æ±‚çš„å‚æ•°å’Œå“åº”çš„å‚æ•°</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">NameValuePair</span><span class=\"token punctuation\">></span></span> params <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   params<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BasicNameValuePair</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"flag\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"4\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   params<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BasicNameValuePair</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"meaning\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"è¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token class-name\">URI</span> uri <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token comment\">// åˆ›å»º URI å¯¹è±¡æ„å»º URI çš„è¯·æ±‚ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      uri <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URIBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">setScheme</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">setHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">setPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"doPostControllerFour\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">setParameters</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">URISyntaxException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token comment\">// åˆ›å»º Post è¯·æ±‚å¯¹è±¡å¹¶ä¼ å…¥è¯·æ±‚ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token class-name\">HttpPost</span> httpPost <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpPost</span><span class=\"token punctuation\">(</span>uri<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   <span class=\"token comment\">// åˆ›å»º User å¯¹è±¡å¹¶è®¾ç½®å±æ€§ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   user<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"åˆ˜æ¡‘\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   user<span class=\"token punctuation\">.</span><span class=\"token function\">setAge</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>   <span class=\"token comment\">// å°† User å¯¹è±¡åºåˆ—åŒ–ä¸º JSON æ•°æ®å¹¶è½¬æ¢ä¸º utf-8 æ ¼å¼çš„å®ä½“æ•°æ®</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token class-name\">StringEntity</span> entity <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringEntity</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSONString</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>   <span class=\"token comment\">// å°†å®ä½“æ•°æ®è®¾ç½®åˆ°è¯·æ±‚å®ä½“ä¸­</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>   httpPost<span class=\"token punctuation\">.</span><span class=\"token function\">setEntity</span><span class=\"token punctuation\">(</span>entity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>   <span class=\"token comment\">// è®¾ç½®è¯·æ±‚å¤´ä¿¡æ¯ä¸º json æ ¼å¼</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>   httpPost<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Content-Type\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"application/json;charset=utf8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>   <span class=\"token class-name\">CloseableHttpResponse</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token comment\">// æ‰§è¡Œè¯·æ±‚å¹¶è·å–å“åº”å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      response <span class=\"token operator\">=</span> httpClient<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>httpPost<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token comment\">// è·å–å®ä½“</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token class-name\">HttpEntity</span> responseEntity <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getEntity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"çŠ¶æ€ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getStatusLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>responseEntity <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>         <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å“åº”å†…å®¹é•¿åº¦ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> responseEntity<span class=\"token punctuation\">.</span><span class=\"token function\">getContentLength</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>         <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å“åº”å†…å®¹ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> <span class=\"token class-name\">EntityUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span>responseEntity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      <span class=\"token comment\">// é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            response<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>httpClient <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            httpClient<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯¹åº”æ¥æ”¶ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"doPostControllerFour\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">UserDto</span> <span class=\"token function\">doPostControllerFour</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span> flag<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> meaning<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">UserDto</span> userDto <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UserDto</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   userDto<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   userDto<span class=\"token punctuation\">.</span><span class=\"token function\">setAge</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getAge</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   userDto<span class=\"token punctuation\">.</span><span class=\"token function\">setFlag</span><span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   userDto<span class=\"token punctuation\">.</span><span class=\"token function\">setMeaning</span><span class=\"token punctuation\">(</span>meaning<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token keyword\">return</span> userDto<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<pre><code>çŠ¶æ€ä¸ºï¼šHTTP/1.1 200 \nå“åº”å†…å®¹é•¿åº¦ä¸ºï¼š-1\nå“åº”å†…å®¹ä¸ºï¼š&#123;&quot;name&quot;:&quot;åˆ˜æ¡‘&quot;,&quot;age&quot;:20,&quot;flag&quot;:4,&quot;meaning&quot;:&quot;è¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ&quot;&#125;\n</code></pre>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "çŸ¥è¯†ç‚¹",
                "http",
                "çŸ¥è¯†ç‚¹",
                "http"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/tools/idea/Idea%E6%8F%92%E4%BB%B6%E6%8E%A8%E8%8D%90/",
            "url": "https://pigpigletsgo.github.io/tools/idea/Idea%E6%8F%92%E4%BB%B6%E6%8E%A8%E8%8D%90/",
            "title": "Ideaæ’ä»¶æ¨è",
            "date_published": "2024-03-08T14:59:23.612Z",
            "content_html": "<h1 id=\"ideaæ’ä»¶æ¨è\"><a class=\"anchor\" href=\"#ideaæ’ä»¶æ¨è\">#</a> Idea æ’ä»¶æ¨è</h1>\n<ol>\n<li>AceJump</li>\n<li>Atom Material Icons</li>\n<li>Free MyBatis Tool</li>\n<li>Grep Console</li>\n<li>Idea Vim</li>\n<li>IdeaVim-EsayMotion</li>\n<li>IdeaVimExtension</li>\n<li>Maven Helper</li>\n<li>PMD</li>\n<li>RestfulTool</li>\n<li>PlantUML Integration</li>\n<li>Rainbow Brackets</li>\n</ol>\n",
            "tags": [
                "tools",
                "idea",
                "java",
                "tools",
                "idea"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/jsoup%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/jsoup%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/",
            "title": "jsoup",
            "date_published": "2024-03-08T10:01:04.121Z",
            "content_html": "<h1 id=\"ä¸€-jsoupæ¦‚è¿°\"><a class=\"anchor\" href=\"#ä¸€-jsoupæ¦‚è¿°\">#</a> ä¸€ã€jsoup æ¦‚è¿°</h1>\n<p>jsoup æ˜¯ä¸€æ¬¾åŸºäº Java çš„ HTML è§£æå™¨ï¼Œå®ƒæä¾›äº†ä¸€å¥—éå¸¸çœåŠ›çš„ APIï¼Œä¸ä½†èƒ½ç›´æ¥è§£ææŸä¸ª URL åœ°å€ã€HTML æ–‡æœ¬å†…å®¹ï¼Œè€Œä¸”è¿˜èƒ½é€šè¿‡ç±»ä¼¼äº DOMã€CSS æˆ–è€… jQuery çš„æ–¹æ³•æ¥æ“ä½œæ•°æ®ï¼Œæ‰€ä»¥ jsoup ä¹Ÿå¯ä»¥è¢«å½“åšçˆ¬è™«å·¥å…·ä½¿ç”¨ã€‚</p>\n<hr />\n<h1 id=\"äºŒ-ç›¸å…³æ¦‚å¿µç®€ä»‹\"><a class=\"anchor\" href=\"#äºŒ-ç›¸å…³æ¦‚å¿µç®€ä»‹\">#</a> äºŒã€ç›¸å…³æ¦‚å¿µç®€ä»‹</h1>\n<ul>\n<li><code>Document</code>  ï¼šæ–‡æ¡£å¯¹è±¡ã€‚æ¯ä»½ HTML é¡µé¢éƒ½æ˜¯ä¸€ä¸ªæ–‡æ¡£å¯¹è±¡ï¼ŒDocument æ˜¯ jsoup ä½“ç³»ä¸­æœ€é¡¶å±‚çš„ç»“æ„ã€‚</li>\n<li><code>Element</code> ï¼šå…ƒç´ å¯¹è±¡ã€‚ä¸€ä¸ª Document ä¸­å¯ä»¥ç€åŒ…å«ç€å¤šä¸ª Element å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ Element å¯¹è±¡æ¥éå†èŠ‚ç‚¹æå–æ•°æ®æˆ–è€…ç›´æ¥æ“ä½œ HTMLã€‚</li>\n<li><code>Elements</code> ï¼šå…ƒç´ å¯¹è±¡é›†åˆï¼Œç±»ä¼¼äº <code>List&lt;Element&gt;</code> ã€‚</li>\n<li><code>Node</code> ï¼šèŠ‚ç‚¹å¯¹è±¡ã€‚æ ‡ç­¾åç§°ã€å±æ€§ç­‰éƒ½æ˜¯èŠ‚ç‚¹å¯¹è±¡ï¼ŒèŠ‚ç‚¹å¯¹è±¡ç”¨æ¥å­˜å‚¨æ•°æ®ã€‚</li>\n<li><strong>ç±»ç»§æ‰¿å…³ç³»</strong>ï¼šDocument ç»§æ‰¿è‡ª Element ï¼ŒElement ç»§æ‰¿è‡ª Nodeã€‚</li>\n<li><strong>ä¸€èˆ¬æ‰§è¡Œæµç¨‹</strong>ï¼šå…ˆè·å– Document å¯¹è±¡ï¼Œç„¶åè·å– Element å¯¹è±¡ï¼Œæœ€åå†é€šè¿‡ Node å¯¹è±¡è·å–æ•°æ®ã€‚</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240308180038864.png\" alt=\"image-20240308180038864\" /></p>\n<hr />\n<h1 id=\"ä¸‰-è·å–æ–‡æ¡£document\"><a class=\"anchor\" href=\"#ä¸‰-è·å–æ–‡æ¡£document\">#</a> ä¸‰ã€è·å–æ–‡æ¡£ï¼ˆDocumentï¼‰</h1>\n<blockquote>\n<p>è·å¾—æ–‡æ¡£å¯¹è±¡ Document ä¸€å…±æœ‰ 4 ç§æ–¹æ³•ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒçš„è·å–æ–¹å¼ã€‚</p>\n</blockquote>\n<p>æ­£å¼å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¼å…¥æœ‰å…³ jar åŒ…ã€‚</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>xmlå¤åˆ¶ä»£ç <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.jsoup<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>jsoup<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.15.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>--</p>\n<h4 id=\"31ä»urlä¸­åŠ è½½æ–‡æ¡£å¯¹è±¡å¸¸ç”¨\"><a class=\"anchor\" href=\"#31ä»urlä¸­åŠ è½½æ–‡æ¡£å¯¹è±¡å¸¸ç”¨\">#</a> 3.1ï¼‰ä» URL ä¸­åŠ è½½æ–‡æ¡£å¯¹è±¡ï¼ˆå¸¸ç”¨ï¼‰</h4>\n<p>ä½¿ç”¨  <code>Jsoup.connect(String url).get()</code>  æ–¹æ³•è·å–ï¼ˆåªæ”¯æŒ http å’Œ https åè®®ï¼‰:</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>javaå¤åˆ¶ä»£ç <span class=\"token class-name\">Document</span> doc <span class=\"token operator\">=</span> <span class=\"token class-name\">Jsoup</span><span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://csdn.com/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token class-name\">String</span> title <span class=\"token operator\">=</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">title</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><code>connect(String url)</code>  æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„ Connection å¹¶é€šè¿‡ <code>.get()</code>  æˆ–è€… <code>.post()</code>  æ–¹æ³•è·å¾—æ•°æ®ã€‚å¦‚æœä»è¯¥ URL è·å– HTML æ—¶å‘ç”Ÿé”™è¯¯ï¼Œä¾¿ä¼šæŠ›å‡º IOExceptionï¼Œåº”é€‚å½“å¤„ç†ã€‚</p>\n<p><code>Connection</code>  æ¥å£è¿˜æä¾›ä¸€ä¸ªæ–¹æ³•é“¾æ¥è§£å†³ç‰¹æ®Šè¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‘é€è¯·æ±‚æ—¶å¸¦ä¸Šè¯·æ±‚çš„å¤´éƒ¨å‚æ•°ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>javaå¤åˆ¶ä»£ç <span class=\"token class-name\">Document</span> doc <span class=\"token operator\">=</span> <span class=\"token class-name\">Jsoup</span><span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://csdn.com\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"query\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Java\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">userAgent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Mozilla\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">cookie</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"auth\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"token\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">8000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>doc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>--</p>\n<h4 id=\"32ä»æœ¬åœ°æ–‡ä»¶ä¸­åŠ è½½æ–‡æ¡£å¯¹è±¡\"><a class=\"anchor\" href=\"#32ä»æœ¬åœ°æ–‡ä»¶ä¸­åŠ è½½æ–‡æ¡£å¯¹è±¡\">#</a> 3.2ï¼‰ä»æœ¬åœ°æ–‡ä»¶ä¸­åŠ è½½æ–‡æ¡£å¯¹è±¡</h4>\n<p>å¯ä»¥ä½¿ç”¨é™æ€çš„ <code>Jsoup.parse(File in, String charsetName)</code>  æ–¹æ³•ä»æ–‡ä»¶ä¸­åŠ è½½æ–‡æ¡£ã€‚å…¶ä¸­ <code>in</code>  è¡¨ç¤ºè·¯å¾„ï¼Œ <code>charsetName</code>  è¡¨ç¤ºç¼–ç æ–¹å¼ï¼Œç¤ºä¾‹ä»£ç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>javaå¤åˆ¶ä»£ç <span class=\"token class-name\">File</span> input <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/tmp/input.html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">Document</span> doc <span class=\"token operator\">=</span> <span class=\"token class-name\">Jsoup</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> <span class=\"token string\">\"UTF-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>doc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>--</p>\n<h4 id=\"33ä»å­—ç¬¦ä¸²æ–‡æœ¬ä¸­åŠ è½½æ–‡æ¡£å¯¹è±¡\"><a class=\"anchor\" href=\"#33ä»å­—ç¬¦ä¸²æ–‡æœ¬ä¸­åŠ è½½æ–‡æ¡£å¯¹è±¡\">#</a> 3.3ï¼‰ä»å­—ç¬¦ä¸²æ–‡æœ¬ä¸­åŠ è½½æ–‡æ¡£å¯¹è±¡</h4>\n<p>ä½¿ç”¨é™æ€çš„ <code>Jsoup.parse(String html)</code>  æ–¹æ³•å¯ä»¥ä»å­—ç¬¦ä¸²æ–‡æœ¬ä¸­è·å¾—æ–‡æ¡£å¯¹è±¡ Document ï¼Œç¤ºä¾‹ä»£ç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>javaå¤åˆ¶ä»£ç <span class=\"token class-name\">String</span> html <span class=\"token operator\">=</span> <span class=\"token string\">\"&lt;html>&lt;head>&lt;title>First parse&lt;/title>&lt;/head>\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token operator\">+</span> <span class=\"token string\">\"&lt;body>&lt;p>Parsed HTML into a doc.&lt;/p>&lt;/body>&lt;/html>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">Document</span> doc <span class=\"token operator\">=</span> <span class=\"token class-name\">Jsoup</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>doc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>--</p>\n<h4 id=\"34ä»bodyç‰‡æ–­ä¸­è·å–æ–‡æ¡£å¯¹è±¡\"><a class=\"anchor\" href=\"#34ä»bodyç‰‡æ–­ä¸­è·å–æ–‡æ¡£å¯¹è±¡\">#</a> 3.4ï¼‰ä» &lt;body&gt; ç‰‡æ–­ä¸­è·å–æ–‡æ¡£å¯¹è±¡</h4>\n<p>ä½¿ç”¨ <code>Jsoup.parseBodyFragment(String html)</code>  æ–¹æ³•.</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>javaå¤åˆ¶ä»£ç <span class=\"token class-name\">String</span> html <span class=\"token operator\">=</span> <span class=\"token string\">\"&lt;p>Lorem ipsum.&lt;/p>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">Document</span> doc <span class=\"token operator\">=</span> <span class=\"token class-name\">Jsoup</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseBodyFragment</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//doc æ­¤æ—¶ä¸ºï¼š&lt;body> &lt;p>Lorem ipsum.&lt;/p>&lt;/body></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token class-name\">Element</span> body <span class=\"token operator\">=</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">body</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><code>parseBodyFragment</code>  æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡æ¡£ï¼Œå¹¶æ’å…¥è§£æè¿‡çš„ HTML åˆ° <code>body</code>  å…ƒç´ ä¸­ã€‚å‡å¦‚ä½ ä½¿ç”¨æ­£å¸¸çš„  <code>Jsoup.parse(String html)</code>  æ–¹æ³•ï¼Œé€šå¸¸ä¹Ÿèƒ½å¾—åˆ°ç›¸åŒçš„ç»“æœï¼Œä½†æ˜¯æ˜ç¡®å°†ç”¨æˆ·è¾“å…¥ä½œä¸º body ç‰‡æ®µå¤„ç†æ˜¯ä¸ªæ›´å¥½çš„æ–¹å¼ã€‚</p>\n<p><code>Document.body()</code>  æ–¹æ³•èƒ½å¤Ÿå–å¾—æ–‡æ¡£ body å…ƒç´ çš„æ‰€æœ‰å­å…ƒç´ ï¼Œä¸  <code>doc.getElementsByTag(&quot;body&quot;)</code>  ç›¸åŒã€‚</p>\n<hr />\n<h1 id=\"å››-é€‰æ‹©å…ƒç´ element\"><a class=\"anchor\" href=\"#å››-é€‰æ‹©å…ƒç´ element\">#</a> å››ã€é€‰æ‹©å…ƒç´ ï¼ˆElementï¼‰</h1>\n<blockquote>\n<p>è§£ææ–‡æ¡£å¯¹è±¡å¹¶è·å–æ•°æ®ä¸€å…±æœ‰ 2 ç§æ–¹å¼ï¼Œåˆ†åˆ«ä¸º DOM æ–¹å¼ã€CSS é€‰æ‹©å™¨æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸€ç§è‡ªå·±å–œæ¬¢çš„æ–¹å¼å»è·å–æ•°æ®ï¼Œæ•ˆæœä¸€æ ·ã€‚</p>\n</blockquote>\n<h4 id=\"41domæ–¹å¼\"><a class=\"anchor\" href=\"#41domæ–¹å¼\">#</a> 4.1ï¼‰DOM æ–¹å¼</h4>\n<p>å°† HTML è§£ææˆä¸€ä¸ª <code>Document</code>  ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨ç±»ä¼¼äº DOM çš„æ–¹æ³•è¿›è¡Œæ“ä½œã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>javaå¤åˆ¶ä»£ç <span class=\"token comment\">// è·å– csdn é¦–é¡µæ‰€æœ‰çš„é“¾æ¥</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">Document</span> doc       <span class=\"token operator\">=</span> <span class=\"token class-name\">Jsoup</span><span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://csdn.com\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">Elements</span> elements  <span class=\"token operator\">=</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTag</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"body\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token class-name\">Elements</span> contents  <span class=\"token operator\">=</span> elements<span class=\"token punctuation\">.</span><span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTag</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Element</span> content <span class=\"token operator\">:</span> contents<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token class-name\">String</span> linkHref <span class=\"token operator\">=</span> content<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token class-name\">String</span> linkText <span class=\"token operator\">=</span> content<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span>linkText<span class=\"token operator\">+</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>linkHref<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong></p>\n<p><code>Elements</code>  è¿™ä¸ªå¯¹è±¡æä¾›äº†ä¸€ç³»åˆ—ç±»ä¼¼äº DOM çš„æ–¹æ³•æ¥æŸ¥æ‰¾å…ƒç´ ï¼ŒæŠ½å–å¹¶å¤„ç†å…¶ä¸­çš„æ•°æ®ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p>\n<p><strong>4.1.1ï¼‰æŸ¥æ‰¾å…ƒç´ </strong></p>\n<ul>\n<li><code>getElementById(String id)</code> ï¼šé€šè¿‡ id æ¥æŸ¥æ‰¾å…ƒç´ </li>\n<li><code>getElementsByTag(String tag)</code> ï¼šé€šè¿‡æ ‡ç­¾æ¥æŸ¥æ‰¾å…ƒç´ </li>\n<li><code>getElementsByClass(String className)</code> ï¼šé€šè¿‡ç±»é€‰æ‹©å™¨æ¥æŸ¥æ‰¾å…ƒç´ </li>\n<li><code>getElementsByAttribute(String key)</code>  ï¼šé€šè¿‡å±æ€§åç§°æ¥æŸ¥æ‰¾å…ƒç´ ï¼Œä¾‹å¦‚æŸ¥æ‰¾å¸¦æœ‰ href å…ƒç´ çš„æ ‡ç­¾ã€‚</li>\n<li><code>siblingElements()</code> ï¼šè·å–å…„å¼Ÿå…ƒç´ ã€‚å¦‚æœå…ƒç´ æ²¡æœ‰å…„å¼Ÿå…ƒç´ ï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºåˆ—è¡¨ã€‚</li>\n<li><code>firstElementSibling()</code> ï¼šè·å–ç¬¬ä¸€ä¸ªå…„å¼Ÿå…ƒç´ ã€‚</li>\n<li><code>lastElementSibling()</code> ï¼šè·å–æœ€åä¸€ä¸ªå…„å¼Ÿå…ƒç´ ã€‚</li>\n<li><code>nextElementSibling()</code> ï¼šè·å–ä¸‹ä¸€ä¸ªå…„å¼Ÿå…ƒç´ ã€‚</li>\n<li><code>previousElementSibling()</code> ï¼šè·å–ä¸Šä¸€ä¸ªå…„å¼Ÿå…ƒç´ ã€‚</li>\n<li><code>parent()</code> ï¼šè·å–æ­¤èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚</li>\n<li><code>children()</code> ï¼šè·å–æ­¤èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹ã€‚</li>\n<li><code>child(int index)</code> ï¼šè·å–æ­¤èŠ‚ç‚¹çš„æŒ‡å®šå­èŠ‚ç‚¹ã€‚</li>\n</ul>\n<p><strong>4.1.2ï¼‰è·å–å…ƒç´ æ•°æ®</strong></p>\n<ul>\n<li><code>attr(String key)</code> ï¼šè·å–å•ä¸ªå±æ€§å€¼</li>\n<li><code>attributes()</code> ï¼šè·å–æ‰€æœ‰å±æ€§å€¼</li>\n<li><code>attr(String key, String value)</code> ï¼šè®¾ç½®å±æ€§å€¼</li>\n<li><code>text()</code> ï¼šè·å–æ–‡æœ¬å†…å®¹</li>\n<li><code>text(String value)</code> ï¼šè®¾ç½®æ–‡æœ¬å†…å®¹</li>\n<li><code>html()</code> ï¼šè·å–å…ƒç´ å†…çš„ HTML å†…å®¹</li>\n<li><code>html(String value)</code> ï¼šè®¾ç½®å…ƒç´ å†…çš„ HTML å†…å®¹</li>\n<li><code>outerHtml()</code> ï¼šè·å–å…ƒç´ å¤– HTML å†…å®¹</li>\n<li><code>data()</code> ï¼šè·å–æ•°æ®å†…å®¹ï¼ˆä¾‹å¦‚ï¼šscript å’Œ style æ ‡ç­¾)</li>\n<li><code>id()</code> ï¼šè·å¾— id å€¼ï¼ˆä¾‹ï¼š <code>&lt;p id=&quot;goods&quot;&gt;è¡£æœ&lt;/p&gt;</code> ï¼‰</li>\n<li><code>className()</code> ï¼šè·å¾—ç¬¬ä¸€ä¸ªç±»é€‰æ‹©å™¨å€¼</li>\n<li><code>classNames()</code> ï¼šè·å¾—æ‰€æœ‰çš„ç±»é€‰æ‹©å™¨å€¼</li>\n<li><code>tag()</code> ï¼šè·å–å…ƒç´ æ ‡ç­¾</li>\n<li><code>tagName()</code> ï¼šè·å–å…ƒç´ æ ‡ç­¾åï¼ˆå¦‚ï¼š&lt;p&gt;ã€&lt;div &gt; ç­‰ï¼‰</li>\n</ul>\n<p><strong>4.1.3ï¼‰æ“ä½œ HTML æ–‡æœ¬</strong></p>\n<ul>\n<li><code>append(String html)</code> ï¼šåœ¨æœ«å°¾è¿½åŠ  HTML æ–‡æœ¬</li>\n<li><code>prepend(String html)</code> ï¼šåœ¨å¼€å¤´è¿½åŠ  HTML æ–‡æœ¬</li>\n<li><code>html(String value)</code> ï¼šåœ¨åŒ¹é…å…ƒç´ å†…éƒ¨æ·»åŠ  HTML æ–‡æœ¬ã€‚</li>\n</ul>\n<p>--</p>\n<h4 id=\"42cssé€‰æ‹©å™¨æ–¹å¼\"><a class=\"anchor\" href=\"#42cssé€‰æ‹©å™¨æ–¹å¼\">#</a> 4.2ï¼‰CSS é€‰æ‹©å™¨æ–¹å¼</h4>\n<p>å¯ä»¥ä½¿ç”¨ç±»ä¼¼äº CSS é€‰æ‹©å™¨çš„è¯­æ³•æ¥æŸ¥æ‰¾å’Œæ“ä½œå…ƒç´ ï¼Œå¸¸ç”¨çš„æ–¹æ³•ä¸º <code>select(String selector)</code> ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>javaå¤åˆ¶ä»£ç <span class=\"token class-name\">Document</span> doc <span class=\"token operator\">=</span> <span class=\"token class-name\">Jsoup</span><span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://csdn.com\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// è·å–å¸¦æœ‰ href å±æ€§çš„ a å…ƒç´ </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">Elements</span> elements <span class=\"token operator\">=</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a[href]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Element</span> content <span class=\"token operator\">:</span> elements<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token class-name\">String</span> linkHref <span class=\"token operator\">=</span> content<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token class-name\">String</span> linkText <span class=\"token operator\">=</span> content<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span>linkText <span class=\"token operator\">+</span> <span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>linkHref<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>4.2.1ï¼‰è¯´æ˜</strong></p>\n<p><code>select()</code>  æ–¹æ³•åœ¨ <code>Document</code> ã€ <code>Element</code>  æˆ– <code>Elements</code>  å¯¹è±¡ä¸­éƒ½å¯ä»¥ä½¿ç”¨ï¼Œè€Œä¸”æ˜¯ä¸Šä¸‹æ–‡ç›¸å…³çš„ï¼Œå› æ­¤å¯å®ç°æŒ‡å®šå…ƒç´ çš„è¿‡æ»¤ï¼Œæˆ–è€…é‡‡ç”¨é“¾å¼è®¿é—®ã€‚</p>\n<p><code>select()</code>  æ–¹æ³•å°†è¿”å›ä¸€ä¸ª <code>Elements</code>  é›†åˆï¼Œå¹¶æä¾›ä¸€ç»„æ–¹æ³•æ¥æŠ½å–å’Œå¤„ç†ç»“æœã€‚</p>\n<p><strong>4.2.2ï¼‰ <code>select(String selector)</code>  æ–¹æ³•å‚æ•°ç®€ä»‹</strong></p>\n<ul>\n<li><code>tagname</code> : é€šè¿‡æ ‡ç­¾æŸ¥æ‰¾å…ƒç´ ï¼Œä¾‹å¦‚é€šè¿‡ <code>&quot;a&quot;</code>  æ¥æŸ¥æ‰¾ <code>&lt;a&gt;</code>  æ ‡ç­¾ã€‚</li>\n<li><code>#id</code> : é€šè¿‡ ID æŸ¥æ‰¾å…ƒç´ ï¼Œæ¯”å¦‚é€šè¿‡ <code>#logo</code>  æŸ¥æ‰¾ <code>&lt;p id=&quot;logo&quot;&gt;</code> ã€‚</li>\n<li><code>.class</code> : é€šè¿‡ class åç§°æŸ¥æ‰¾å…ƒç´ ï¼Œæ¯”å¦‚é€šè¿‡ <code>.titile</code>  æŸ¥æ‰¾ <code>&lt;p class=&quot;titile&quot;&gt;</code> ã€‚</li>\n<li><code>ns|tag</code> : é€šè¿‡æ ‡ç­¾åœ¨å‘½åç©ºé—´æŸ¥æ‰¾å…ƒç´ ï¼Œæ¯”å¦‚ä½¿ç”¨  <code>fb|name</code>  æ¥æŸ¥æ‰¾  <code>&lt;fb:name&gt;</code>  ã€‚</li>\n<li><code>[attribute]</code> : åˆ©ç”¨å±æ€§æŸ¥æ‰¾å…ƒç´ ï¼Œæ¯”å¦‚é€šè¿‡ <code>[href]</code>  æŸ¥æ‰¾ <code>&lt;a href=&quot;...&quot;&gt;</code> ã€‚</li>\n<li><code>[^attribute]</code> : åˆ©ç”¨å±æ€§åå‰ç¼€æ¥æŸ¥æ‰¾å…ƒç´ ï¼Œæ¯”å¦‚ï¼šå¯ä»¥ç”¨ <code>[^data-]</code>  æ¥æŸ¥æ‰¾å¸¦æœ‰ HTML5 dataset å±æ€§çš„å…ƒç´ ã€‚</li>\n<li><code>[attribute=value]</code> : åˆ©ç”¨å±æ€§å€¼æ¥æŸ¥æ‰¾å…ƒç´ ï¼Œæ¯”å¦‚ï¼š <code>[width=500]</code> ã€‚</li>\n<li><code>[attribute^=value]</code> ,  <code>[attribute$=value]</code> ,  <code>[attribute*=value]</code> : åˆ©ç”¨åŒ¹é…å±æ€§å€¼å¼€å¤´ã€ç»“å°¾æˆ–åŒ…å«å±æ€§å€¼æ¥æŸ¥æ‰¾å…ƒç´ ï¼Œæ¯”å¦‚é€šè¿‡ <code>[href*=/path/]</code>  æ¥æŸ¥æ‰¾ <code>&lt;a href=&quot;a/path/c.html&quot;&gt;</code> ã€‚</li>\n<li><code>[attribute~=regex]</code> : åˆ©ç”¨å±æ€§å€¼åŒ¹é…<strong>æ­£åˆ™è¡¨è¾¾å¼</strong>æ¥æŸ¥æ‰¾å…ƒç´ ï¼Œæ¯”å¦‚é€šè¿‡  <code>img[src~=(?i)\\.(png|jpe?g)]</code>  æ¥åŒ¹é…æ‰€æœ‰çš„ png æˆ–è€… jpgã€jpeg æ ¼å¼çš„å›¾ç‰‡ã€‚</li>\n<li><code>*</code> : é€šé…ç¬¦ï¼ŒåŒ¹é…æ‰€æœ‰å…ƒç´ ã€‚</li>\n</ul>\n<p><strong>4.2.3ï¼‰å‚æ•°å±æ€§ç»„åˆä½¿ç”¨</strong></p>\n<ul>\n<li><code>el#id</code> : å…ƒç´  + IDï¼Œæ¯”å¦‚ï¼š  <code>div#logo</code></li>\n<li><code>el.class</code> : å…ƒç´  + classï¼Œæ¯”å¦‚ï¼š  <code>div.masthead</code></li>\n<li><code>el[attr]</code> : å…ƒç´  + classï¼Œæ¯”å¦‚  <code>a[href]</code>  åŒ¹é…æ‰€æœ‰å¸¦æœ‰ href å±æ€§çš„ a å…ƒç´ ã€‚</li>\n<li>ä»»æ„ç»„åˆï¼Œæ¯”å¦‚ï¼š <code>a[href].highlight</code>  åŒ¹é…æ‰€æœ‰å¸¦æœ‰ href å±æ€§ä¸” class=&quot;highlight&quot; çš„ a å…ƒç´ ã€‚</li>\n<li><code>ancestor child</code> : æŸ¥æ‰¾æŸä¸ªå…ƒç´ ä¸‹å­å…ƒç´ ï¼Œæ¯”å¦‚ï¼šå¯ä»¥ç”¨ <code>.body p</code>  æŸ¥æ‰¾åœ¨ &quot;body&quot; å…ƒç´ ä¸‹çš„æ‰€æœ‰  <code>p</code>  å…ƒç´ </li>\n<li><code>parent &gt; child</code> : æŸ¥æ‰¾æŸä¸ªçˆ¶å…ƒç´ ä¸‹çš„ç›´æ¥å­å…ƒç´ ï¼Œæ¯”å¦‚ï¼šå¯ä»¥ç”¨ <code>div.content &gt; p</code>  æŸ¥æ‰¾  <code>p</code>  å…ƒç´ ï¼Œä¹Ÿå¯ä»¥ç”¨ <code>body &gt; *</code>  æŸ¥æ‰¾ body æ ‡ç­¾ä¸‹æ‰€æœ‰ç›´æ¥å­å…ƒç´ </li>\n<li><code>siblingA + siblingB</code> : æŸ¥æ‰¾åœ¨ A å…ƒç´ ä¹‹å‰ç¬¬ä¸€ä¸ªåŒçº§å…ƒç´  Bï¼Œæ¯”å¦‚ï¼š <code>div.head + div</code></li>\n<li><code>siblingA ~ siblingX</code> : æŸ¥æ‰¾ A å…ƒç´ ä¹‹å‰çš„åŒçº§ X å…ƒç´ ï¼Œæ¯”å¦‚ï¼š <code>h1 ~ p</code></li>\n<li><code>el, el, el</code> : å¤šä¸ªé€‰æ‹©å™¨ç»„åˆï¼ŒæŸ¥æ‰¾åŒ¹é…ä»»ä¸€é€‰æ‹©å™¨çš„å”¯ä¸€å…ƒç´ ï¼Œä¾‹å¦‚ï¼š <code>div.masthead, div.logo</code></li>\n</ul>\n<p><strong>4.2.4ï¼‰ç‰¹æ®Šå‚æ•°ï¼šä¼ªé€‰æ‹©å™¨</strong></p>\n<ul>\n<li><code>:lt(n)</code> : æŸ¥æ‰¾å“ªäº›å…ƒç´ çš„åŒçº§ç´¢å¼•å€¼ï¼ˆå®ƒçš„ä½ç½®åœ¨ DOM æ ‘ä¸­æ˜¯ç›¸å¯¹äºå®ƒçš„çˆ¶èŠ‚ç‚¹ï¼‰å°äº nï¼Œæ¯”å¦‚ï¼š <code>td:lt(3)</code>  è¡¨ç¤ºå°äºä¸‰åˆ—çš„å…ƒç´ </li>\n<li><code>:gt(n)</code> : æŸ¥æ‰¾å“ªäº›å…ƒç´ çš„åŒçº§ç´¢å¼•å€¼å¤§äº <code>n``ï¼Œæ¯”å¦‚</code> ï¼š  <code>div p:gt(2)</code>  è¡¨ç¤ºå“ªäº› div ä¸­æœ‰åŒ…å« 2 ä¸ªä»¥ä¸Šçš„ p å…ƒç´ </li>\n<li><code>:eq(n)</code> : æŸ¥æ‰¾å“ªäº›å…ƒç´ çš„åŒçº§ç´¢å¼•å€¼ä¸ <code>n</code>  ç›¸ç­‰ï¼Œæ¯”å¦‚ï¼š <code>form input:eq(1)</code>  è¡¨ç¤ºåŒ…å«ä¸€ä¸ª input æ ‡ç­¾çš„ Form å…ƒç´ </li>\n<li><code>:has(seletor)</code> : æŸ¥æ‰¾åŒ¹é…é€‰æ‹©å™¨åŒ…å«å…ƒç´ çš„å…ƒç´ ï¼Œæ¯”å¦‚ï¼š <code>div:has(p)</code>  è¡¨ç¤ºå“ªäº› div åŒ…å«äº† p å…ƒç´ </li>\n<li><code>:not(selector)</code> : æŸ¥æ‰¾ä¸é€‰æ‹©å™¨ä¸åŒ¹é…çš„å…ƒç´ ï¼Œæ¯”å¦‚ï¼š  <code>div:not(.logo)</code>  è¡¨ç¤ºä¸åŒ…å« class=logo å…ƒç´ çš„æ‰€æœ‰ div åˆ—è¡¨</li>\n<li><code>:contains(text)</code> : æŸ¥æ‰¾åŒ…å«ç»™å®šæ–‡æœ¬çš„å…ƒç´ ï¼Œæœç´¢ä¸åŒºåˆ†å¤§ä¸å†™ï¼Œæ¯”å¦‚ï¼š  <code>p:contains(jsoup)</code></li>\n<li><code>:containsOwn(text)</code> : æŸ¥æ‰¾ç›´æ¥åŒ…å«ç»™å®šæ–‡æœ¬çš„å…ƒç´ </li>\n<li><code>:matches(regex)</code> : æŸ¥æ‰¾å“ªäº›å…ƒç´ çš„æ–‡æœ¬åŒ¹é…æŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ï¼š <code>div:matches((?i)login)</code></li>\n<li><code>:matchesOwn(regex)</code> : æŸ¥æ‰¾è‡ªèº«åŒ…å«æ–‡æœ¬åŒ¹é…æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼çš„å…ƒç´ </li>\n<li>æ³¨æ„ï¼šä¸Šè¿°ä¼ªé€‰æ‹©å™¨ç´¢å¼•æ˜¯ä» 0 å¼€å§‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç¬¬ä¸€ä¸ªå…ƒç´ ç´¢å¼•å€¼ä¸º 0ï¼Œç¬¬äºŒä¸ªå…ƒç´  index ä¸º 1 ç­‰</li>\n</ul>\n<hr />\n<h1 id=\"äº”-è·å–æ•°æ®node\"><a class=\"anchor\" href=\"#äº”-è·å–æ•°æ®node\">#</a> äº”ã€è·å–æ•°æ®ï¼ˆNodeï¼‰</h1>\n<blockquote>\n<p>åœ¨è·å¾—æ–‡æ¡£å¯¹è±¡å¹¶ä¸”æŒ‡å®šæŸ¥æ‰¾å…ƒç´ åï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–å…ƒç´ ä¸­çš„æ•°æ®ã€‚ è¿™äº›è®¿é—®å™¨æ–¹æ³•éƒ½æœ‰ç›¸åº”çš„ setter æ–¹æ³•æ¥æ›´æ”¹æ•°æ®ã€‚</p>\n</blockquote>\n<ul>\n<li><code>.attr(String key)</code>  ï¼šè·å¾—å±æ€§çš„å€¼ã€‚</li>\n<li><code>.text()</code> ï¼šè·å¾—å…ƒç´ ä¸­çš„æ–‡æœ¬ã€‚</li>\n<li><code>.html()</code> ï¼šè·å¾—å…ƒç´ æˆ–å±æ€§<strong>å†…éƒ¨</strong>çš„ HTML å†…å®¹ï¼ˆä¸åŒ…æ‹¬æœ¬èº«ï¼‰ã€‚</li>\n<li><code>.outerHtml()</code> ï¼šè·å¾—å…ƒç´ æˆ–å±æ€§<strong>å®Œæ•´</strong>çš„ HTML å†…å®¹ã€‚</li>\n<li><code>.id()</code> ï¼šè·å¾—å…ƒç´  id å±æ€§å€¼ã€‚</li>\n<li><code>className()</code> ï¼šè·å¾—å…ƒç´ ç±»é€‰æ‹©å™¨å€¼ã€‚</li>\n<li><code>.tagName()</code> ï¼šè·å¾—å…ƒç´ æ ‡ç­¾å‘½åã€‚</li>\n<li><code>.hasClass(String className)</code> ï¼šæ£€æŸ¥è¿™ä¸ªå…ƒç´ æ˜¯å¦å«æœ‰ä¸€ä¸ªç±»é€‰æ‹©å™¨ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>javaå¤åˆ¶ä»£ç <span class=\"token class-name\">String</span>   html <span class=\"token operator\">=</span> <span class=\"token string\">\"&lt;p>&lt;a href='http://csdn.com/'>&lt;b>example&lt;/b>&lt;/a> link.&lt;/p>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">Document</span> doc  <span class=\"token operator\">=</span> <span class=\"token class-name\">Jsoup</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// æŸ¥æ‰¾ç¬¬ä¸€ä¸ª & lt;a > å…ƒç´ </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token class-name\">Element</span> link <span class=\"token operator\">=</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// è¾“å‡ºï¼šexample</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token class-name\">String</span> text     <span class=\"token operator\">=</span> link<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// è¾“å‡ºï¼šhttp://csdn.com/</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token class-name\">String</span> href <span class=\"token operator\">=</span> link<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// è¾“å‡ºï¼š&lt;b>example&lt;/b></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token class-name\">String</span> aHtml     <span class=\"token operator\">=</span> link<span class=\"token punctuation\">.</span><span class=\"token function\">outerHtml</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">// è¾“å‡ºï¼š&lt;a href='http://csdn.com/'>&lt;b>example&lt;/b>&lt;/a></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token class-name\">String</span> aOuterHtml     <span class=\"token operator\">=</span> link<span class=\"token punctuation\">.</span><span class=\"token function\">outerHtml</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>--</p>\n<hr />\n<h1 id=\"å…­-ä¿®æ”¹æ•°æ®\"><a class=\"anchor\" href=\"#å…­-ä¿®æ”¹æ•°æ®\">#</a> å…­ã€ä¿®æ”¹æ•°æ®</h1>\n<blockquote>\n<p>åœ¨è§£æäº†ä¸€ä¸ª Document å¯¹è±¡ä¹‹åï¼Œä½ å¯èƒ½æƒ³ä¿®æ”¹å…¶ä¸­çš„æŸäº›å±æ€§å€¼ï¼Œå¹¶æŠŠå®ƒè¾“å‡ºåˆ°å‰å°é¡µé¢æˆ–ä¿å­˜åˆ°å…¶ä»–åœ°æ–¹ï¼Œjsoup å¯¹æ­¤æä¾›äº†ä¸€å¥—éå¸¸ç®€ä¾¿çš„æ¥å£ï¼ˆæ”¯æŒé“¾å¼å†™æ³•ï¼‰ã€‚</p>\n</blockquote>\n<h4 id=\"61è®¾ç½®å±æ€§çš„å€¼\"><a class=\"anchor\" href=\"#61è®¾ç½®å±æ€§çš„å€¼\">#</a> 6.1ï¼‰è®¾ç½®å±æ€§çš„å€¼</h4>\n<p>å½“ä»¥ä¸‹æ–¹æ³•é’ˆå¯¹ <code>Element</code>  å¯¹è±¡æ“ä½œæ—¶ï¼Œåªæœ‰ä¸€ä¸ªå…ƒç´ ä¼šå—åˆ°å½±å“ã€‚å½“é’ˆå¯¹ <code>Elements</code>  å¯¹è±¡è¿›è¡Œæ“ä½œæ—¶ï¼Œå¯èƒ½ä¼šå½±å“åˆ°å¤šä¸ªå…ƒç´ ã€‚</p>\n<ul>\n<li><code>.attr(String key, String value)</code> ï¼šè®¾ç½®æ ‡ç­¾çš„å±æ€§å€¼ã€‚</li>\n<li><code>.addClass(String className)</code> ï¼šå¢åŠ ç±»é€‰æ‹©å™¨é€‰é¡¹</li>\n<li><code>.removeClass(String className)</code> ï¼šåˆ é™¤å¯¹åº”çš„ç±»é€‰æ‹©å™¨</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>javaå¤åˆ¶ä»£ç <span class=\"token class-name\">Document</span> doc <span class=\"token operator\">=</span> <span class=\"token class-name\">Jsoup</span><span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://csdn.com\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// å¤æ•°ï¼ŒElements</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">Elements</span> elements <span class=\"token operator\">=</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"text\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// å•æ•°ï¼ŒElement</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token class-name\">Element</span> element <span class=\"token operator\">=</span> elements<span class=\"token punctuation\">.</span><span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// å¤æ•°å¯¹è±¡ï¼Œæ‰€æœ‰ class=\"text\" çš„å…ƒç´ éƒ½å°†å—åˆ°å½±å“</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>elements<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"goods\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// å•æ•°å¯¹è±¡ï¼Œåªæœ‰ä¸€ä¸ªå…ƒç´ ä¼šå—åˆ°å½±å“ï¼ˆé“¾å¼å†™æ³•ï¼‰</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>element<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"shop\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">addClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"red\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"62ä¿®æ”¹å…ƒç´ çš„htmlå†…å®¹\"><a class=\"anchor\" href=\"#62ä¿®æ”¹å…ƒç´ çš„htmlå†…å®¹\">#</a> 6.2ï¼‰ä¿®æ”¹å…ƒç´ çš„ HTML å†…å®¹</h4>\n<p>å¯ä»¥ä½¿ç”¨ <code>Element</code>  ä¸­çš„ HTML è®¾ç½®æ–¹æ³•å…·ä½“å¦‚ä¸‹ï¼š</p>\n<ul>\n<li><code>.html(String value)</code> ï¼šè¿™ä¸ªæ–¹æ³•å°†å…ˆæ¸…é™¤å…ƒç´ ä¸­çš„ HTML å†…å®¹ï¼Œç„¶åç”¨ä¼ å…¥çš„ HTML ä»£æ›¿ã€‚</li>\n<li><code>.prepend(String value)</code> ï¼šåœ¨å…ƒç´ <strong>å‰</strong>æ·»åŠ  html å†…å®¹ã€‚</li>\n<li><code>.append(String value)</code> ï¼šåœ¨å…ƒç´ <strong>å</strong>æ·»åŠ  html å†…å®¹ã€‚</li>\n<li><code>.wrap(String value)</code> ï¼šå¯¹å…ƒç´ åŒ…è£¹ä¸€ä¸ªå¤–éƒ¨ HTML å†…å®¹ï¼Œå°†å…ƒç´ ç½®äºæ–°å¢çš„å†…å®¹ä¸­é—´ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>javaå¤åˆ¶ä»£ç <span class=\"token class-name\">Document</span> doc <span class=\"token operator\">=</span> <span class=\"token class-name\">Jsoup</span><span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://csdn.com\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token class-name\">Element</span> div <span class=\"token operator\">=</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"div\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>div<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;p>csdn&lt;/p>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>div<span class=\"token punctuation\">.</span><span class=\"token function\">prepend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;p>a&lt;/p>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>div<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;p>good&lt;/p>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// è¾“å‡ºï¼š&lt;div\"> &lt;p>a&lt;/p> &lt;p>csdn&lt;/p> &lt;p>good&lt;/p> &lt;/div></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token class-name\">Element</span> span <span class=\"token operator\">=</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"span\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>span<span class=\"token punctuation\">.</span><span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;li>&lt;a href='...'>&lt;/a>&lt;/li>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// è¾“å‡º: &lt;li>&lt;a href=\"...\"> &lt;span>csdn&lt;/span> &lt;/a>&lt;/li></span></pre></td></tr></table></figure><h4 id=\"63ä¿®æ”¹å…ƒç´ çš„æ–‡æœ¬å†…å®¹\"><a class=\"anchor\" href=\"#63ä¿®æ”¹å…ƒç´ çš„æ–‡æœ¬å†…å®¹\">#</a> 6.3ï¼‰ä¿®æ”¹å…ƒç´ çš„æ–‡æœ¬å†…å®¹</h4>\n<p>å¯¹äºä¼ å…¥çš„æ–‡æœ¬ï¼Œå¦‚æœå«æœ‰åƒ  <code>&lt;</code> ,  <code>&gt;</code>  ç­‰è¿™æ ·çš„å­—ç¬¦ï¼Œå°†ä»¥æ–‡æœ¬å¤„ç†ï¼Œè€Œé HTMLã€‚</p>\n<ul>\n<li><code>.text(String text)</code>  ï¼šæ¸…é™¤å…ƒç´ å†…éƒ¨çš„ HTML å†…å®¹ï¼Œç„¶åç”¨æä¾›çš„æ–‡æœ¬ä»£æ›¿ã€‚</li>\n<li><code>.prepend(String first)</code> ï¼šåœ¨å…ƒç´ <strong>å</strong>æ·»åŠ æ–‡æœ¬èŠ‚ç‚¹ã€‚</li>\n<li><code>Element.append(String last)</code> ï¼šåœ¨å…ƒç´ <strong>å‰</strong>æ·»åŠ æ–‡æœ¬èŠ‚ç‚¹ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>javaå¤åˆ¶ä»£ç  <span class=\"token comment\">// &lt;div>&lt;/div></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">Element</span> div <span class=\"token operator\">=</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"div\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>div<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" one \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>div<span class=\"token punctuation\">.</span><span class=\"token function\">prepend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" two \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>div<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" three \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// è¾“å‡º: &lt;div> two one three &lt;/div></span></pre></td></tr></table></figure><hr />\n<h1 id=\"ä¸ƒ-å…¶ä»–åŠŸèƒ½\"><a class=\"anchor\" href=\"#ä¸ƒ-å…¶ä»–åŠŸèƒ½\">#</a> ä¸ƒã€å…¶ä»–åŠŸèƒ½</h1>\n<h4 id=\"71ç›¸å¯¹è·¯å¾„è½¬ç»å¯¹è·¯å¾„\"><a class=\"anchor\" href=\"#71ç›¸å¯¹è·¯å¾„è½¬ç»å¯¹è·¯å¾„\">#</a> 7.1ï¼‰ç›¸å¯¹è·¯å¾„è½¬ç»å¯¹è·¯å¾„</h4>\n<p><strong>é—®é¢˜æè¿°</strong>ï¼š â€ƒä½ æœ‰ä¸€ä¸ªåŒ…å«ç›¸å¯¹ URLs è·¯å¾„çš„ HTML æ–‡æ¡£ï¼Œç°åœ¨éœ€è¦å°†è¿™äº›ç›¸å¯¹è·¯å¾„è½¬æ¢æˆç»å¯¹è·¯å¾„çš„ URLsã€‚</p>\n<p><strong>è§£å†³æ–¹å¼</strong>ï¼š</p>\n<ol>\n<li>ç¡®ä¿åœ¨ä½ è§£ææ–‡æ¡£æ—¶æœ‰æŒ‡å®š <code>base URI</code>  è·¯å¾„ã€‚</li>\n<li>ç„¶åä½¿ç”¨  <code>abs:</code>  å±æ€§å‰ç¼€æ¥å–å¾—åŒ…å« <code>base URI</code>  çš„ç»å¯¹è·¯å¾„ã€‚ä»£ç å¦‚ä¸‹ï¼š</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>javaå¤åˆ¶ä»£ç <span class=\"token class-name\">Document</span> doc <span class=\"token operator\">=</span> <span class=\"token class-name\">Jsoup</span><span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://www.open-open.com\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">Element</span> link <span class=\"token operator\">=</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// è¾“å‡ºï¼š/</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token class-name\">String</span> relHref <span class=\"token operator\">=</span> link<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// è¾“å‡ºï¼šhttp://www.open-open.com/</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token class-name\">String</span> absHref <span class=\"token operator\">=</span> link<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"abs:href\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong>ï¼š</p>\n<p>åœ¨ HTML å…ƒç´ ä¸­ï¼ŒURLs ç»å¸¸å†™æˆç›¸å¯¹äºæ–‡æ¡£ä½ç½®çš„ç›¸å¯¹è·¯å¾„ï¼Œå¦‚ï¼š <code>&lt;a href=&quot;/download&quot;&gt;...&lt;/a&gt;</code> ã€‚å½“ä½ ä½¿ç”¨  <code>.attr(String key)</code>  æ–¹æ³•æ¥å–å¾— a å…ƒç´ çš„ href å±æ€§æ—¶ï¼Œå®ƒå°†ç›´æ¥è¿”å›åœ¨ HTML æºç ä¸­æŒ‡å®šçš„å€¼ã€‚</p>\n<p>å‡å¦‚ä½ éœ€è¦å–å¾—ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œéœ€è¦åœ¨å±æ€§åå‰åŠ   <code>abs:</code>  å‰ç¼€ï¼Œè¿™æ ·å°±å¯ä»¥è¿”å›åŒ…å«æ ¹è·¯å¾„çš„ URL åœ°å€ <code>attr(&quot;abs:href&quot;)</code> ã€‚å› æ­¤åœ¨è§£æ HTML æ–‡æ¡£æ—¶ï¼Œå®šä¹‰ base URI éå¸¸é‡è¦ã€‚</p>\n<p>å¦‚æœä½ ä¸æƒ³ä½¿ç”¨ <code>abs:</code>  å‰ç¼€ï¼Œè¿˜æœ‰ä¸€ä¸ªæ–¹æ³•èƒ½å¤Ÿå®ç°åŒæ ·çš„åŠŸèƒ½  <code>.absUrl(String key)</code> ã€‚</p>\n<p>--</p>\n<h4 id=\"72æ¶ˆé™¤ä¸å—ä¿¡ä»»çš„html-é˜²æ­¢xssæ”»å‡»\"><a class=\"anchor\" href=\"#72æ¶ˆé™¤ä¸å—ä¿¡ä»»çš„html-é˜²æ­¢xssæ”»å‡»\">#</a> 7.2ï¼‰æ¶ˆé™¤ä¸å—ä¿¡ä»»çš„ HTML (é˜²æ­¢ XSS æ”»å‡»)</h4>\n<p><strong>é—®é¢˜æè¿°</strong>ï¼š</p>\n<p>åœ¨æŸäº›ç½‘ç«™ä¸­ç»å¸¸ä¼šæä¾›ç”¨æˆ·è¯„è®ºçš„åŠŸèƒ½ï¼Œä½†æ˜¯æœ‰äº›ä¸æ€€å¥½æ„çš„ç”¨æˆ·ï¼Œä¼šæä¸€äº›è„šæœ¬åˆ°è¯„è®ºå†…å®¹ä¸­ï¼Œè€Œè¿™äº›è„šæœ¬å¯èƒ½ä¼šç ´åæ•´ä¸ªé¡µé¢çš„è¡Œä¸ºï¼Œæ›´ä¸¥é‡çš„æ˜¯è·å–ä¸€äº›æœºè¦ä¿¡æ¯ï¼Œæ­¤æ—¶éœ€è¦æ¸…ç†è¯¥ HTMLï¼Œä»¥é¿å…è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ã€‚</p>\n<p><strong>è§£å†³æ–¹å¼</strong>ï¼š â€ƒä½¿ç”¨ <code>clean()</code>  æ–¹æ³•æ¸…é™¤æ¶æ„ä»£ç ï¼Œä½†éœ€è¦æŒ‡å®šä¸€ä¸ªé…ç½®çš„  <code>Safelist</code> ï¼ˆæ—§ç‰ˆæœ¬ä¸­æ˜¯ <code>Whitelist</code> ï¼‰ï¼Œé€šå¸¸ä½¿ç”¨ <code>Safelist.basic()</code>  å³å¯ã€‚ <code>Safelist</code>  çš„å·¥ä½œåŸç†æ˜¯å°†è¾“å…¥çš„ HTML å†…å®¹å•ç‹¬éš”ç¦»è§£æï¼Œç„¶åéå†è§£ææ ‘ï¼Œåªå…è®¸å·²çŸ¥çš„å®‰å…¨æ ‡ç­¾å’Œå±æ€§è¾“å‡ºã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>javaå¤åˆ¶ä»£ç <span class=\"token class-name\">String</span> unsafe <span class=\"token operator\">=</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token string\">\"&lt;p>&lt;a href='http://csdn.com/' onclick='attack()'>Link&lt;/a>&lt;/p>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// è¾“å‡º: &lt;p>&lt;a href=\"http://csdn.com/\" >Link&lt;/a>&lt;/p></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token class-name\">String</span> safe <span class=\"token operator\">=</span> <span class=\"token class-name\">Jsoup</span><span class=\"token punctuation\">.</span><span class=\"token function\">clean</span><span class=\"token punctuation\">(</span>unsafe<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Safelist</span><span class=\"token punctuation\">.</span><span class=\"token function\">basic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>safe<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong>ï¼š</p>\n<p>jsoup çš„ <code>Safelist</code>  ä¸ä»…èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯å¯¹ç”¨æˆ·è¾“å…¥çš„ HTML è¿›è¡Œè¿‡æ»¤ï¼Œåªè¾“å‡ºä¸€äº›å®‰å…¨çš„æ ‡ç­¾å’Œå±æ€§ï¼Œè¿˜å¯ä»¥é™åˆ¶ç”¨æˆ·å¯ä»¥è¾“å…¥çš„æ ‡ç­¾èŒƒå›´ã€‚</p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "ç¬¬ä¸‰æ–¹åº“",
                "java",
                "è®¡ç®—æœºå­¦ç§‘",
                "ç¬¬ä¸‰æ–¹åº“",
                "çˆ¬è™«"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/Java%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%B1%BB%E7%9A%84%E8%B7%AF%E5%BE%84/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/Java%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%B1%BB%E7%9A%84%E8%B7%AF%E5%BE%84/",
            "title": "Javaè·å–å½“å‰ç±»çš„è·¯å¾„",
            "date_published": "2024-03-08T09:56:42.119Z",
            "content_html": "<h1 id=\"javaè·å–å½“å‰ç±»çš„è·¯å¾„\"><a class=\"anchor\" href=\"#javaè·å–å½“å‰ç±»çš„è·¯å¾„\">#</a> Java è·å–å½“å‰ç±»çš„è·¯å¾„</h1>\n<blockquote>\n<p>ç®€ä»‹ï¼š</p>\n<ol>\n<li>å¦‚ä½•è·å¾—å½“å‰æ–‡ä»¶è·¯å¾„å¸¸ç”¨ï¼š\n<ol>\n<li>Test.class.getResource (&quot;&quot;)ï¼šå¾—åˆ°çš„æ˜¯å½“å‰ç±» Test.class æ–‡ä»¶çš„ URL ç›®å½•ï¼Œä¸åŒ…æ‹¬è‡ªå·±ï¼</li>\n<li>Test.class.getResource (&quot;/&quot;) å¾—åˆ°çš„æ˜¯å½“å‰çš„ classpath çš„ç»å¯¹ URL è·¯å¾„</li>\n</ol>\n</li>\n</ol>\n</blockquote>\n<h2 id=\"ä¸€-å¦‚ä½•è·å¾—å½“å‰æ–‡ä»¶è·¯å¾„\"><a class=\"anchor\" href=\"#ä¸€-å¦‚ä½•è·å¾—å½“å‰æ–‡ä»¶è·¯å¾„\">#</a> ä¸€ã€ å¦‚ä½•è·å¾—å½“å‰æ–‡ä»¶è·¯å¾„</h2>\n<h3 id=\"11-æ™®é€šå·¥ç¨‹è·å–ç±»è·¯å¾„\"><a class=\"anchor\" href=\"#11-æ™®é€šå·¥ç¨‹è·å–ç±»è·¯å¾„\">#</a> 1.1 æ™®é€šå·¥ç¨‹è·å–ç±»è·¯å¾„</h3>\n<p>å…ˆçœ‹ä¸‹å½“å‰å·¥ç¨‹çš„ç›®å½•ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240308161752441.png\" alt=\"image-20240308161752441\" /></p>\n<p>å¸¸ç”¨ï¼š</p>\n<ol>\n<li>\n<p>Test.class.getResouce(&quot;&quot;)</p>\n<p>ä½œç”¨ï¼šå¾—åˆ°çš„æ˜¯å½“å‰ç±» Test.class çš„æ–‡ä»¶ URL ç›®å½•ã€‚ä¸åŒ…æ‹¬è‡ªå·±ï¼</p>\n<p>ä»£ç æ¼”ç¤ºï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">URL</span> resource <span class=\"token operator\">=</span> <span class=\"token class-name\">TestDemo</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getResource</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>resource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<pre><code>file:/C:/Users/Administrator/Desktop/Demo/nio_channel/out/production/nio_channel/com/dkx/\n</code></pre>\n</li>\n<li>\n<p>Test.class.getResouce(&quot;/&quot;)</p>\n<p>ä½œç”¨ï¼šå¾—åˆ°çš„æ˜¯å½“å‰çš„ classpath çš„ç»å¯¹ URL è·¯å¾„</p>\n<p>ä»£ç æ¼”ç¤ºï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">URL</span> resource <span class=\"token operator\">=</span> <span class=\"token class-name\">TestDemo</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getResource</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>resource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<pre><code>file:/C:/Users/Administrator/Desktop/Demo/nio_channel/out/production/nio_channel/\n</code></pre>\n</li>\n<li>\n<p>Thread.currentThread().getContextLoader().getResource(&quot;&quot;)</p>\n<p>ä½œç”¨ï¼šå¾—åˆ°çš„ä¹Ÿæ˜¯å½“å‰ classpath çš„ç»å¯¹ URL è·¯å¾„</p>\n<p>ä»£ç æ¼”ç¤ºï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">URL</span> resource <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContextClassLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getResource</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>resource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<pre><code>file:/C:/Users/Administrator/Desktop/Demo/nio_channel/out/production/nio_channel/\n</code></pre>\n</li>\n<li>\n<p>Test.class.getClassLoader().getResource(&quot;&quot;)</p>\n<p>ä½œç”¨ï¼šå¾—åˆ°çš„ä¹Ÿæ˜¯å½“å‰ classpath çš„ç»å¯¹ URL è·¯å¾„</p>\n<p>ä»£ç æ¼”ç¤ºï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">URL</span> resource <span class=\"token operator\">=</span> <span class=\"token class-name\">TestDemo</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getClassLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getResource</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>resource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<pre><code>file:/C:/Users/Administrator/Desktop/Demo/nio_channel/out/production/nio_channel/\n</code></pre>\n</li>\n<li>\n<p>ClassLoader.getSystemResource(&quot;&quot;)</p>\n<p>ä½œç”¨ï¼šå¾—åˆ°çš„ä¹Ÿæ˜¯å½“å‰ classpath çš„ç»å¯¹ URL è·¯å¾„</p>\n<p>ä»£ç æ¼”ç¤ºï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test4</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">URL</span> systemResource <span class=\"token operator\">=</span> <span class=\"token class-name\">ClassLoader</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSystemResource</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>systemResource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<pre><code>file:/C:/Users/Administrator/Desktop/Demo/nio_channel/out/production/nio_channel/\n</code></pre>\n<p>æ³¨æ„ï¼šå°½é‡ä¸è¦ä½¿ç”¨ System.getProperty (&quot;user.dir&quot;) å½“å‰ç”¨æˆ·ç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼Œåé¢å¯ä»¥çœ‹å‡ºå¾—å‡ºç»“æœäº”èŠ±å…«é—¨ã€‚</p>\n</li>\n<li>\n<p>new File(&quot;&quot;).getAbsolutePath</p>\n<p>ä½œç”¨ï¼šå¾—åˆ°çš„æ˜¯å½“å‰å·¥ç¨‹çš„ç»å¯¹è·¯å¾„ä»ä¸»ç›˜å¼€å§‹åˆ°å½“å‰å·¥ç¨‹</p>\n<p>ä»£ç æ¼”ç¤ºï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test5</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">String</span> absolutePath <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAbsolutePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>absolutePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<pre><code>C:\\Users\\Administrator\\Desktop\\Demo\\nio_channel\n</code></pre>\n</li>\n</ol>\n<h3 id=\"12-webæœåŠ¡å™¨è·å–è·¯å¾„\"><a class=\"anchor\" href=\"#12-webæœåŠ¡å™¨è·å–è·¯å¾„\">#</a> 1.2 Web æœåŠ¡å™¨è·å–è·¯å¾„</h3>\n<ol>\n<li>\n<p>Tomcat</p>\n<p>ç±»ä¸­è¾“å‡º System.getProperty (&quot;user.dir&quot;) æ˜¾ç¤ºçš„æ˜¯ % Tomcat_Home%/bin</p>\n<p>ä»£ç æ¼”ç¤ºï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span><span class=\"token operator\">--</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token class-name\">Created</span> by <span class=\"token class-name\">IntelliJ</span> <span class=\"token class-name\">IDEA<span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  User</span><span class=\"token operator\">:</span> <span class=\"token class-name\">Administrator</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token class-name\">Date</span><span class=\"token operator\">:</span> <span class=\"token number\">2024</span>å¹´<span class=\"token number\">03</span>æœˆ<span class=\"token number\">08</span>æ—¥ <span class=\"token number\">0008</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token class-name\">Time</span><span class=\"token operator\">:</span> <span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">33</span><span class=\"token operator\">:</span><span class=\"token number\">27</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token class-name\">To</span> change <span class=\"token keyword\">this</span> template use <span class=\"token class-name\">File</span> <span class=\"token operator\">|</span> <span class=\"token class-name\">Settings</span> <span class=\"token operator\">|</span> <span class=\"token class-name\">File</span> <span class=\"token class-name\">Templates</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">--</span><span class=\"token operator\">%</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span>@ page contentType<span class=\"token operator\">=</span><span class=\"token string\">\"text/html;charset=UTF-8\"</span> language<span class=\"token operator\">=</span><span class=\"token string\">\"java\"</span> <span class=\"token operator\">%</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>html<span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>head<span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>title<span class=\"token punctuation\">></span></span><span class=\"token class-name\">Title</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>title<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>head<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>body<span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span> <span class=\"token class-name\">String</span> property <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user.dir\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">%</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">%=</span> property <span class=\"token operator\">%</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>html<span class=\"token operator\">></span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240308170806707.png\" alt=\"image-20240308170806707\" /></p>\n</li>\n<li>\n<p>Resin</p>\n<p>ä¸æ˜¯ä½ çš„ JSP æ”¾çš„ç›¸å¯¹è·¯å¾„ï¼Œæ˜¯ JSP å¼•æ“æ‰§è¡Œè¿™ä¸ª JSP ç¼–è¯‘æˆ SERVLET çš„è·¯å¾„ä¸ºæ ¹ï¼Œæ¯”å¦‚ç”¨æ–°å»ºæ–‡ä»¶æ³•æµ‹è¯• File f = new File (&quot;a.html&quot;) è¿™ä¸ª a.html çš„ resin çš„å®‰è£…ç›®å½•ä¸‹</p>\n</li>\n<li>\n<p>å¦‚ä½•è¯»æ–‡ä»¶</p>\n<p>ä½¿ç”¨ ServletContext.getResourceAsStream () å°±å¯ä»¥</p>\n</li>\n<li>\n<p>è·å¾—æ–‡ä»¶çœŸå®è·¯å¾„</p>\n<p>String file_real_path = ServletContext.getRealPath (&quot;mypath/filename&quot;)ï¼›ä¸å»ºè®®ä½¿ç”¨ request.getRealPath (&quot;/&quot;)</p>\n</li>\n</ol>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "çŸ¥è¯†ç‚¹",
                "çŸ¥è¯†ç‚¹"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/Java%E7%88%AC%E5%8F%96%E6%9F%90%E7%BD%91%E7%AB%99%E6%89%80%E6%9C%89%E5%9B%BE%E7%89%87%E6%A1%88%E4%BE%8B/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/Java%E7%88%AC%E5%8F%96%E6%9F%90%E7%BD%91%E7%AB%99%E6%89%80%E6%9C%89%E5%9B%BE%E7%89%87%E6%A1%88%E4%BE%8B/",
            "title": "Javaçˆ¬å–æŸç½‘ç«™æ‰€æœ‰å›¾ç‰‡æ¡ˆä¾‹",
            "date_published": "2024-03-08T09:56:30.608Z",
            "content_html": "<h1 id=\"javaçˆ¬å–æŸç½‘ç«™æ‰€æœ‰å›¾ç‰‡æ¡ˆä¾‹\"><a class=\"anchor\" href=\"#javaçˆ¬å–æŸç½‘ç«™æ‰€æœ‰å›¾ç‰‡æ¡ˆä¾‹\">#</a> Java çˆ¬å–æŸç½‘ç«™æ‰€æœ‰å›¾ç‰‡æ¡ˆä¾‹</h1>\n<p>ä½¿ç”¨ maven å·¥ç¨‹</p>\n<p>å¼•å…¥ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.jsoup<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>jsoup<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.13.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>ä»»åŠ¡ï¼š</p>\n<ol>\n<li>æ‰¾åˆ°ç›®æ ‡ç½‘å€</li>\n<li>é€šè¿‡æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹åŒ…å«äº†å›¾ç‰‡çš„ html å…ƒç´ æ ‡ç­¾</li>\n<li>é€šè¿‡ java ä»£ç è¯·æ±‚ url å¹¶ä¸”é€šè¿‡ jsoup åº“æ¥è§£æ html æ ‡ç­¾è·å–æƒ³è¦çš„ä¿¡æ¯</li>\n</ol>\n<p>å¼€å§‹ç¼–ç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ImageCrawlers</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">String</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"https://mp.weixin.qq.com/s/YPrqMOYYrAtCni2VT8c4jA\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token comment\">// è·å–é¡µé¢çš„ document å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token class-name\">Document</span> document <span class=\"token operator\">=</span> <span class=\"token class-name\">Jsoup</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token comment\">// è·å–å…ƒç´ å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token class-name\">Element</span> content <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"js_content\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœ:</p>\n<p>ç”±äºè·å–çš„å†…å®¹å¤ªå¤šäº†ï¼Œä¸‹é¢æ‰“å°çš„ä¿¡æ¯æ˜¯æˆ‘æˆªå–è¿‡çš„ï¼Œèƒ½çœ‹å‡ºæ¥æˆåŠŸäº†å°±è¡Œ</p>\n<pre><code>&lt;div class=&quot;rich_media_content js_underline_content\n                       &quot; id=&quot;js_content&quot; style=&quot;visibility: hidden;&quot;&gt;\n &lt;p data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.75&quot; data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; data-w=&quot;960&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_jpg/DVk7VUQZ3qGeicxDibu7SlxIT62BJb593CqZhaC2FQbtcUracbaAicPXVrTZmaqlPC3gibYRSzcJ7licU3ibDVibjWBng/640?wx_fmt=jpeg&quot; style=&quot;text-align: center;&quot;&gt;&lt;/p&gt;\n &lt;section&gt;\n  &lt;section powered-by=&quot;xiumi.us&quot;&gt;\n   &lt;section&gt;\n     &lt;p style=&quot;text-align: center;&quot;&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_jpg/FJtasAibLFa6MScppd3RCMHwXCXbfduXo8cVtNz1WTPLCLz99V025BczdC8UBfzrmybo4j8RiarV15Fzq3KxBbyw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;\n     &lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;\n      &lt;section style=&quot;white-space: normal;box-sizing: border-box;font-size: 16px;&quot; mpa-from-tpl=&quot;t&quot;&gt;\n       &lt;section powered-by=&quot;xiumi.us&quot; style=&quot;margin-top: 0.5em;margin-bottom: 0.5em;box-sizing: border-box;&quot; mpa-from-tpl=&quot;t&quot;&gt;\n        &lt;section style=&quot;border-top: 1px dashed rgb(37, 180, 170);box-sizing: border-box;line-height: 0;&quot; mpa-from-tpl=&quot;t&quot;&gt;\n         &lt;section style=&quot;line-height: 0;width: 0px;&quot; mpa-from-tpl=&quot;t&quot;&gt;\n          &lt;svg viewbox=&quot;0 0 1 1&quot; style=&quot;vertical-align:top;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;/svg&gt;\n         &lt;/section&gt;\n      &lt;/section&gt;\n      &lt;p style=&quot;white-space: normal;text-align: center;&quot;&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.275&quot; data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_jpg/FJtasAibLFa6jZOQXB4rNue2qGicGC67SUw4NAJ0Hv99GsCPgXY0sbrhibvApAKDJzib18TicD1Hia0S1716qRqHGuiaQ/640?wx_fmt=jpeg&quot; style=&quot;width: 677px !important;height: auto !important;visibility: visible !important;&quot;&gt;&lt;/p&gt;\n     &lt;/section&gt;\n    &lt;/section&gt;\n   &lt;/section&gt;\n  &lt;/section&gt;\n &lt;/section&gt;\n&lt;/div&gt;\n</code></pre>\n<p>ä¸‹ä¸€æ­¥æˆ‘ä»¬ç»§ç»­ç¼–ç ï¼Œè·å– content å¯¹è±¡é‡Œé¢æ‰€æœ‰çš„ img æ ‡ç­¾</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ImageCrawlers</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">String</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"https://mp.weixin.qq.com/s/YPrqMOYYrAtCni2VT8c4jA\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token comment\">// è·å–é¡µé¢çš„ document å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token class-name\">Document</span> document <span class=\"token operator\">=</span> <span class=\"token class-name\">Jsoup</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token comment\">// è·å–å…ƒç´ å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token class-name\">Element</span> content <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"js_content\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token comment\">// é€šè¿‡ä¸Šé¢çš„å¯¹è±¡è·å–é‡Œé¢æ‰€æœ‰çš„ img æ ‡ç­¾å†…å®¹</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token class-name\">Elements</span> imgs <span class=\"token operator\">=</span> content<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTag</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"img\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>imgs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<p>å›¾ç‰‡å¤ªå¤šäº†ï¼Œä¸‹é¢æ‰“å°æ˜¯æˆ‘æˆªå–è¿‡çš„æ•°æ®</p>\n<pre><code>&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.75&quot; data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; data-w=&quot;960&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_jpg/DVk7VUQZ3qGeicxDibu7SlxIT62BJb593CqZhaC2FQbtcUracbaAicPXVrTZmaqlPC3gibYRSzcJ7licU3ibDVibjWBng/640?wx_fmt=jpeg&quot; style=&quot;text-align: center;&quot;&gt;\n&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.75&quot; data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; data-w=&quot;960&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_jpg/DVk7VUQZ3qGeicxDibu7SlxIT62BJb593C28QsQKN9ib198mFLvyG6vhpMrdiaUAeDRlTWQ3othPaZA2TMKDaFQqiaQ/640?wx_fmt=jpeg&quot; style=&quot;&quot;&gt;\n</code></pre>\n<p>ç»§ç»­ç¼–ç è·å– data-src å±æ€§é‡Œé¢çš„è·¯å¾„</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ImageCrawlers</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">String</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"https://mp.weixin.qq.com/s/YPrqMOYYrAtCni2VT8c4jA\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token comment\">// è·å–é¡µé¢çš„ document å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token class-name\">Document</span> document <span class=\"token operator\">=</span> <span class=\"token class-name\">Jsoup</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token comment\">// è·å–å…ƒç´ å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token class-name\">Element</span> content <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"js_content\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token comment\">// é€šè¿‡ä¸Šé¢çš„å¯¹è±¡è·å–é‡Œé¢æ‰€æœ‰çš„ img æ ‡ç­¾å†…å®¹</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token class-name\">Elements</span> imgs <span class=\"token operator\">=</span> content<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTag</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"img\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token comment\">// é€šè¿‡ stream æµéå† é‡Œé¢å¯¹è±¡è°ƒç”¨ attr è·å– data-src å±æ€§çš„å€¼ å¹¶æ‰“å°è¾“å‡º</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            imgs<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>element <span class=\"token operator\">-></span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"data-src\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<p>æ˜¯å¾ˆå¤šçš„å›¾ç‰‡è·¯å¾„</p>\n<pre><code>https://mmbiz.qpic.cn/sz_mmbiz_jpg/DVk7VUQZ3qGeicxDibu7SlxIT62BJb593COl353kWkzxwAckMU531UJ33KXD3YFYXYiaAnXo7M2cF22wZGG6Gib5sg/640?wx_fmt=jpeg\nhttps://mmbiz.qpic.cn/sz_mmbiz_jpg/DVk7VUQZ3qGeicxDibu7SlxIT62BJb593CsoRbMW21hdjAjT9EpkU9XO6Uv22LrCmauG76NPW6l2zKjC6XCQ5uQQ/640?\n</code></pre>\n<p>æ‹¿åˆ°äº†å›¾ç‰‡çš„è·¯å¾„æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ URL å¯¹è±¡æ¥è¿›è¡Œ IO æ“ä½œäº†å°†æ‰€æœ‰å›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ°æŸä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œæœ€ç»ˆä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ImageCrawlers</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">String</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"https://mp.weixin.qq.com/s/YPrqMOYYrAtCni2VT8c4jA\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token comment\">// è·å–é¡µé¢çš„ document å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token class-name\">Document</span> document <span class=\"token operator\">=</span> <span class=\"token class-name\">Jsoup</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token comment\">// è·å–å…ƒç´ å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token class-name\">Element</span> content <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"js_content\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token comment\">// é€šè¿‡ä¸Šé¢çš„å¯¹è±¡è·å–é‡Œé¢æ‰€æœ‰çš„ img æ ‡ç­¾å†…å®¹</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token class-name\">Elements</span> imgs <span class=\"token operator\">=</span> content<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTag</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"img\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token comment\">// é€šè¿‡ stream æµéå† é‡Œé¢å¯¹è±¡è°ƒç”¨ attr è·å– data-src å±æ€§çš„å€¼ å¹¶æ‰“å°è¾“å‡º</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">AtomicInteger</span> imgName <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtomicInteger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            imgs<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>element <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token class-name\">String</span> src <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"data-src\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token class-name\">FileOutputStream</span> os <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token class-name\">InputStream</span> is <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                    <span class=\"token class-name\">URL</span> target <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                    <span class=\"token class-name\">URLConnection</span> urlConnection <span class=\"token operator\">=</span> target<span class=\"token punctuation\">.</span><span class=\"token function\">openConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                    is <span class=\"token operator\">=</span> urlConnection<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                    os <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"E:\\\\images\\\\\"</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>imgName<span class=\"token punctuation\">.</span><span class=\"token function\">incrementAndGet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\".jpg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                    <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bytes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">1024</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                    <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> is<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                        os<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">MalformedURLException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>os <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                            os<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>is <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                            is<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰€æœ‰å›¾ç‰‡ä¸‹è½½å®Œæ¯•\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240308175451211.png\" alt=\"image-20240308175451211\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240308175502902.png\" alt=\"image-20240308175502902\" /></p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "çŸ¥è¯†ç‚¹",
                "çˆ¬è™«",
                "çŸ¥è¯†ç‚¹"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/URI%E5%92%8CURL%E7%9A%84%E5%8C%BA%E5%88%AB%E4%B8%8E%E8%81%94%E7%B3%BB/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/URI%E5%92%8CURL%E7%9A%84%E5%8C%BA%E5%88%AB%E4%B8%8E%E8%81%94%E7%B3%BB/",
            "title": "ä¸€ã€URIå’ŒURLçš„åŒºåˆ«ä¸è”ç³»",
            "date_published": "2024-03-08T04:58:21.052Z",
            "content_html": "<h1 id=\"ä¸€-uriå’Œurlçš„åŒºåˆ«ä¸è”ç³»\"><a class=\"anchor\" href=\"#ä¸€-uriå’Œurlçš„åŒºåˆ«ä¸è”ç³»\">#</a> ä¸€ã€URI å’Œ URL çš„åŒºåˆ«ä¸è”ç³»</h1>\n<h2 id=\"11-ä»€ä¹ˆæ˜¯uri\"><a class=\"anchor\" href=\"#11-ä»€ä¹ˆæ˜¯uri\">#</a> 1.1 ä»€ä¹ˆæ˜¯ URI</h2>\n<p>uri å°±ç±»ä¼¼ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„èº«ä»½æ ‡è¯†ã€‚</p>\n<p>å‡†ç¡®çš„è¯´æ˜¯æŸä¸ªç½‘ç»œèµ„æºçš„ç‰¹æœ‰æ ‡è¯† (ç”¨æ¥åŒºåˆ«äºå…¶å®ƒèµ„æºçš„ç‹¬ä¸€æ— äºŒçš„æ ‡è¯†)</p>\n<p>å…·ä½“ä»€ä¹ˆæ ·çš„å«åš URI å‘¢ï¼Ÿæˆ‘å°±ç›´æ¥ç»™ä¸ª java æ‰€ä¸¾çš„ URI ä¾‹å­ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>(First line of HTTP request) HTTP è¯·æ±‚çš„ç¬¬ä¸€è¡Œ</th>\n<th>uri</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>POST /some/path.html HTTP/1.1</td>\n<td>/some/path.html</td>\n</tr>\n<tr>\n<td>GET <span class=\"exturl\" data-url=\"aHR0cDovL2Zvby5iYXIvYS5odG1s\">http://foo.bar/a.html</span> HTTP/1.0</td>\n<td>/a.html</td>\n</tr>\n<tr>\n<td>HEAD /xyz?a=b HTTP/1.1</td>\n<td>/xyz</td>\n</tr>\n</tbody>\n</table>\n<p>ä»ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸åŒè¯·æ±‚è¿”å›çš„ URI æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>\n<p>å¦‚æœä¸Šé¢çš„ä¾‹å­è¿˜æ˜¯è®©ä½ æ„Ÿåˆ°å›°æƒ‘ï¼Œé‚£æˆ‘å°±ä¸¾ä¸ªæ›´åŠ é€šä¿—æ˜“æ‡‚çš„ã€‚</p>\n<p>æœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚:</p>\n<p>è¦æ±‚æ‰¾åˆ°ä¸€æœ¬ä¹¦ (ä¹¦å°±æ˜¯èµ„æº)ï¼Œè¿™æœ¬ä¹¦åœ¨ A çœä»½ / B å¸‚ / C åŒº / D è¡—é“ /xx æ ‹ / 392-1 ä½æˆ· / 1 å·æˆ¿é—´ / åå­—å«åšã€Šxxxã€‹ (è¿™é‡Œå°±æ˜¯æ¨¡æ‹Ÿæˆ‘ä»¬è¾“å…¥ç½‘å€è¿›è¡Œ HTTP è¯·æ±‚)</p>\n<p>é‚£ä¹ˆæ­¤æ—¶çš„ ==ã€Šxxxã€‹<mark>è¿™æœ¬ä¹¦ï¼Œå¯¹äº</mark> 1 å·æˆ¿é—´ == æ¥è¯´å°±æ˜¯ URI</p>\n<p>æ­¤æ—¶çš„<mark> D è¡—é“ /xx æ ‹ / 392-1 ä½æˆ· / 1 å·æˆ¿é—´ / åå­—å«åšã€Šxxxã€‹<mark>è¿™æœ¬ä¹¦ï¼Œå¯¹äº</mark> A çœä»½ / B å¸‚ / C åŒº</mark> æ¥è¯´å°±æ˜¯ RUI</p>\n<p>å¯ä»¥çœ‹å‡º<mark> URI æ˜¯ä¸å›ºå®šçš„ï¼Œæ˜¯ç›¸å¯¹æ¥è¯´çš„</mark>ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆå°±çœ‹ä½ çš„å‚ç…§è§’åº¦æ˜¯ä»€ä¹ˆã€‚(ä¸åŒè¯·æ±‚å‚ç…§è§’åº¦ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å®ƒä»¬çš„è¿”å› URI æœ‰å·®å¼‚)</p>\n<p><strong>ç”±æ­¤æ€»ç»“</strong>ï¼šURI æ˜¯ä¸€ä¸ªæ ‡è¯†ï¼Œç”¨æ¥åŒºåˆ«å…¶å®ƒèµ„æºçš„æ ‡è¯†ã€‚</p>\n<h2 id=\"12-ä»€ä¹ˆæ˜¯url\"><a class=\"anchor\" href=\"#12-ä»€ä¹ˆæ˜¯url\">#</a> 1.2 ä»€ä¹ˆæ˜¯ URL</h2>\n<p>URL å°±æ˜¯æ¯æ¬¡æˆ‘ä»¬è¾“å…¥ç½‘å€è®¿é—®æŸä¸ªç½‘ç«™æ—¶ï¼Œæµè§ˆå™¨ä¸Šè¾“å…¥çš„é‚£ä¸€è¡Œå†…å®¹ã€‚æ¯”å¦‚ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2JhaWR1LnhuLS1jb21VUkwtZG43aWdsaDIycW9jNWU=\">http://baidu.com è¿™æ˜¯ä¸€ä¸ª URL</span>ï¼Œæ¯ä¸ªé“¾æ¥åœ°å€å°±æ˜¯ä¸€ä¸ª URL</p>\n<h2 id=\"13-uriå’Œrulçš„å…³ç³»\"><a class=\"anchor\" href=\"#13-uriå’Œrulçš„å…³ç³»\">#</a> 1.3 URI å’Œ RUL çš„å…³ç³»</h2>\n<p>URI æ˜¯ URL çš„çˆ¶çº§</p>\n<p>å¯èƒ½æœ‰äººå°±å¥‡æ€ªäº†ï¼Œæ˜æ˜æ˜¯ URL åŒ…å«äº† URI ä¸ºå•¥ URI åè€Œæ˜¯çˆ¶çº§ï¼Ÿ</p>\n<p>è¯·æ³¨æ„ï¼Œè¿™é‡Œç”¨çš„æ˜¯çº§åˆ«æ¥æè¿°ï¼Œè€Œä¸æ˜¯åŒ…å«</p>\n<p>æˆ‘æ²¡æœ‰è¯´ URL æ˜¯ URI çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯è¯´æ˜¯å®ƒçš„å­çº§ã€‚</p>\n<p>è¦æƒ³ç†è§£è¿™ä¸ªæ¦‚å¿µï¼Œæœ€å¥½çš„è¯´æ˜å°±æ˜¯ java çš„ç»§æ‰¿å…³ç³»ã€‚URL ç»§æ‰¿äº† URIã€‚</p>\n<p>å› ä¸º URL ç»§æ‰¿äº†æ‰€æœ‰ URI çš„å†…å®¹ï¼Œæ‰€ä»¥å®ƒæ¯” URI æ›´åŠ è¯¦ç»†ï¼Œä½†æ˜¯ URI æ˜¯å®ƒçš„çˆ¶çº§</p>\n<h2 id=\"14-ä¸¤è€…çš„ä½œç”¨\"><a class=\"anchor\" href=\"#14-ä¸¤è€…çš„ä½œç”¨\">#</a> 1.4 ä¸¤è€…çš„ä½œç”¨</h2>\n<h3 id=\"141-urlçš„ä½œç”¨\"><a class=\"anchor\" href=\"#141-urlçš„ä½œç”¨\">#</a> 1.4.1 URL çš„ä½œç”¨</h3>\n<p>URL ä¸€èˆ¬æ˜¯ä¸€ä¸ªå®Œæ•´çš„é“¾æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡è¿™ä¸ªé“¾æ¥ (URL) è®¿é—®åˆ°ä¸€ä¸ªç½‘ç«™ï¼Œæˆ–è€…æŠŠè¿™ä¸ª URL å¤åˆ¶åˆ°æµè§ˆå™¨è®¿é—®ç½‘ç«™</p>\n<p>ä½¿ç”¨ URL æ—¶æˆ‘ä»¬å°±æ˜¯ä¸€ä¸ªç›´æ¥ç”¨æˆ·çš„è§’è‰²ï¼Œç›´æ¥è®¿é—®å°±å®Œäº‹å„¿äº†ã€‚</p>\n<h3 id=\"142-uriçš„ä½œç”¨\"><a class=\"anchor\" href=\"#142-uriçš„ä½œç”¨\">#</a> 1.4.2 URI çš„ä½œç”¨</h3>\n<p>URI å¹¶ä¸æ˜¯ä¸€ä¸ªç›´æ¥è®¿é—®çš„é“¾æ¥ï¼Œè€Œæ˜¯ç›¸å¯¹åœ°å€ (å½“ç„¶å¦‚æœç›¸å¯¹äºæµè§ˆå™¨ URI ç­‰åŒäº URL äº†)ã€‚è¿™ç§æ¦‚å¿µæ›´å¤šçš„æ˜¯ç”¨äºç¼–ç¨‹ä¸­ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡å¿…è¦æ¯æ¬¡ç¼–ç¨‹éƒ½ç”¨ç»å¯¹ URL æ¥è·å–ä¸€äº›é¡µé¢ï¼Œè¿™æ ·è¿˜éœ€è¦è¿›è¡Œåˆ†å‰² &quot;<span class=\"exturl\" data-url=\"aHR0cDovL3h4L3h4\">http://xx/xx</span>&quot; å‰é¢é‚£ä¸€ä¸²ï¼Œæ‰€ä»¥ç¼–ç¨‹çš„æ—¶å€™ç›´æ¥ reuqest.getRequestURI å°±è¡Œäº†ï¼Œå½“ç„¶å¦‚æœæ˜¯é‡å®šå‘çš„è¯ï¼Œå°±ç”¨ URLã€‚</p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "çŸ¥è¯†ç‚¹",
                "çŸ¥è¯†ç‚¹"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/IO/Java%E7%9A%84IO%E6%BC%94%E8%BF%9B%E4%B9%8B%E8%B7%AF/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/IO/Java%E7%9A%84IO%E6%BC%94%E8%BF%9B%E4%B9%8B%E8%B7%AF/",
            "title": "Javaçš„IOæ¼”è¿›ä¹‹è·¯",
            "date_published": "2024-03-05T15:02:41.664Z",
            "content_html": "<h1 id=\"javaçš„ioæ¼”è¿›ä¹‹è·¯\"><a class=\"anchor\" href=\"#javaçš„ioæ¼”è¿›ä¹‹è·¯\">#</a> Java çš„ IO æ¼”è¿›ä¹‹è·¯</h1>\n<h2 id=\"ioæ¨¡å‹åŸºæœ¬è¯´æ˜\"><a class=\"anchor\" href=\"#ioæ¨¡å‹åŸºæœ¬è¯´æ˜\">#</a> I/O æ¨¡å‹åŸºæœ¬è¯´æ˜</h2>\n<p>I/O æ¨¡å‹ï¼šå°±æ˜¯ç”¨ä»€ä¹ˆæ ·çš„é€šé“æˆ–è€…è¯´æ˜¯é€šä¿¡æ¨¡å¼å’Œæ¶æ„è¿›è¡Œæ•°æ®çš„ä¼ è¾“å’Œæ¥æ”¶ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå†³å®šäº†é€šä¿¡çš„æ€§èƒ½ï¼ŒJava å…±æ”¯æŒ 3 ä¸­ç½‘ç»œç¼–ç¨‹çš„ I/O æ¨¡å‹ï¼š<strong>BIO</strong>ï¼Œ<strong>NIO</strong>ï¼Œ<strong>AIO</strong></p>\n<p>å®é™…é€šä¿¡éœ€æ±‚ä¸‹ï¼Œè¦æ ¹æ®ä¸åŒçš„ä¸šåŠ¡åœºæ™¯å’Œæ€§èƒ½éœ€æ±‚å†³å®šé€‰æ‹©ä¸åŒçš„<mark> I/O æ¨¡å‹</mark></p>\n<h2 id=\"ioæ¨¡å‹\"><a class=\"anchor\" href=\"#ioæ¨¡å‹\">#</a> I/O æ¨¡å‹</h2>\n<h3 id=\"java-bio\"><a class=\"anchor\" href=\"#java-bio\">#</a> Java BIO</h3>\n<p><mark>åŒæ­¥å¹¶é˜»å¡</mark> (ä¼ ç»Ÿé˜»å¡æ¨¡å‹)ï¼ŒæœåŠ¡å™¨å®ç°æ¨¡å¼ä¸º<mark>ä¸€ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹</mark>ï¼Œå³å®¢æˆ·ç«¯æœ‰è¿æ¥è¯·æ±‚æ—¶æœåŠ¡å™¨ç«¯å°±éœ€è¦å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œå¦‚æœè¿™ä¸ªè¿æ¥ä¸åšä»»ä½•äº‹æƒ…ä¼šé€ æˆä¸å¿…è¦çš„çº¿ç¨‹å¼€é”€ [ç®€å•ç¤ºæ„å›¾]</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240228145345637.png\" alt=\"image-20240228145345637\" /></p>\n<h3 id=\"java-nio\"><a class=\"anchor\" href=\"#java-nio\">#</a> Java NIO</h3>\n<p>Java NIOï¼šåŒæ­¥éé˜»å¡ï¼ŒæœåŠ¡å™¨å®ç°æ¨¡å¼ä¸º<mark>ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªè¯·æ±‚</mark> (è¿æ¥)ï¼Œå³å®¢æˆ·ç«¯å‘é€çš„è¿æ¥è¯·æ±‚éƒ½ä¼š<mark>æ³¨å†Œåˆ°å¤šè·¯å¤ç”¨å™¨</mark> (Selector é€‰æ‹©å™¨) ä¸Šï¼Œå¤šè·¯å¤ç”¨å™¨ (Selector é€‰æ‹©å™¨)<mark> è½®è¯¢åˆ°è¿æ¥æœ‰ I/O è¯·æ±‚</mark>å°±ä¼šè¿›è¡Œå¤„ç† [ç®€å•ç¤ºæ„å›¾]</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240228152447374.png\" alt=\"image-20240228152447374\" /></p>\n<h3 id=\"java-aio\"><a class=\"anchor\" href=\"#java-aio\">#</a> Java AIO</h3>\n<p>Java AIO (NIO.2)ï¼šå¼‚æ­¥éé˜»å¡ï¼ŒæœåŠ¡å™¨å®ç°æ¨¡å¼ä¸º<mark>ä¸€ä¸ªæœ‰æ•ˆè¯·æ±‚ä¸€ä¸ªçº¿ç¨‹</mark>ï¼Œå®¢æˆ·ç«¯çš„ I/O è¯·æ±‚éƒ½æ˜¯ç”± OS<mark> å…ˆå®Œæˆäº†å†é€šçŸ¥</mark>æœåŠ¡å™¨åº”ç”¨å»å¯åŠ¨çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œä¸€èˆ¬é€‚ç”¨äº<mark>è¿æ¥æ•°è¾ƒå¤šä¸”è¿æ¥æ—¶é—´è¾ƒé•¿</mark>çš„åº”ç”¨</p>\n<p>JavaAIO ä¸­ A æŒ‡çš„æ˜¯å¼‚æ­¥çš„æ„æ€åŒæ—¶æˆ‘ä»¬ä¹Ÿç§°ä¹‹ä¸ºï¼šå¼‚æ­¥éé˜»å¡</p>\n<h2 id=\"bionioaioé€‚ç”¨åœºæ™¯åˆ†æ\"><a class=\"anchor\" href=\"#bionioaioé€‚ç”¨åœºæ™¯åˆ†æ\">#</a> BIOï¼ŒNIOï¼ŒAIO é€‚ç”¨åœºæ™¯åˆ†æ</h2>\n<ol>\n<li>BIO æ–¹å¼é€‚ç”¨äº<mark>è¿æ¥æ•°ç›®è¾ƒå°ä¸”å›ºå®š</mark>çš„æ¶æ„ï¼Œè¿™ç§æ–¹å¼å¯¹<mark>æœåŠ¡å™¨èµ„æºè¦æ±‚æ¯”è¾ƒé«˜</mark>ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ JDK1.4 ä»¥å‰çš„å”¯ä¸€é€‰æ‹©ï¼Œä½†ç¨‹åºç®€å•æ˜“ç†è§£</li>\n<li>NIO æ–¹å¼é€‚ç”¨äº<mark>è¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒçŸ­</mark> (è½»æ“ä½œ) çš„æ¶æ„ï¼Œæ¯”å¦‚èŠå¤©æœåŠ¡å™¨ï¼Œå¼¹å¹•ç³»ç»Ÿï¼ŒæœåŠ¡å™¨é—´é€šè®¯ç­‰ã€‚ç¼–ç¨‹æ¯”è¾ƒå¤æ‚ï¼ŒJDK1.4 å¼€å§‹æ”¯æŒ</li>\n<li>AIO æ–¹å¼é€‚ç”¨äº<mark>è¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒé•¿</mark> (é‡æ“ä½œ) çš„æ¶æ„ï¼Œæ¯”å¦‚ç›¸å†ŒæœåŠ¡å™¨ï¼Œå……åˆ†è°ƒç”¨ OS å‚ä¸å¹¶å‘æ“ä½œï¼Œç¼–ç¨‹æ¯”è¾ƒå¤æ‚ï¼ŒJDK7 å¼€å§‹æ”¯æŒ</li>\n</ol>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "çŸ¥è¯†ç‚¹",
                "IO",
                "çŸ¥è¯†ç‚¹",
                "IO"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/IO/BIO%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/IO/BIO%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90/",
            "title": "JAVA BIO æ·±å…¥å‰–æ",
            "date_published": "2024-03-05T15:02:41.630Z",
            "content_html": "<h1 id=\"1-java-bio-æ·±å…¥å‰–æ\"><a class=\"anchor\" href=\"#1-java-bio-æ·±å…¥å‰–æ\">#</a> 1 JAVA BIO æ·±å…¥å‰–æ</h1>\n<h2 id=\"11-åŸºæœ¬ä»‹ç»\"><a class=\"anchor\" href=\"#11-åŸºæœ¬ä»‹ç»\">#</a> 1.1 åŸºæœ¬ä»‹ç»</h2>\n<p>Java BIO <mark>å°±æ˜¯ä¼ ç»Ÿçš„ java io ç¼–ç¨‹</mark>ï¼Œå…¶ç›¸å…³çš„ç±»å’Œæ¥å£åœ¨ <span class=\"exturl\" data-url=\"aHR0cDovL2phdmEuaW8=\">java.io</span></p>\n<p>æˆ‘ä»¬å­¦çš„åŸç”Ÿçš„ io æµå°±æ˜¯æ”¾åœ¨ java.io åŒ…ä¸‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åŸºäºåŸç”Ÿçš„ io æµæ¯”å¦‚ å­—èŠ‚æµï¼Œå­—ç¬¦æµç­‰è¿›è¡Œçš„æ•°æ®äº¤äº’çš„ä¸€ç§é€šä¿¡æ–¹å¼å…¶å®å°±æ˜¯ä¸€ç§ BIO æ–¹å¼ã€‚</p>\n<p><strong>BIO(blocking I/O)</strong>ï¼š<mark>åŒæ­¥é˜»å¡</mark>ï¼ŒæœåŠ¡å™¨å®ç°æ¨¡å¼ä¸º<mark>ä¸€ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹</mark>ï¼Œå³å®¢æˆ·ç«¯æœ‰è¿æ¥è¯·æ±‚æ—¶æœåŠ¡å™¨ç«¯å°±éœ€è¦å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œå¦‚æœè¿™ä¸ªè¿æ¥ä¸åšä»»ä½•äº‹æƒ…ä¼šé€ æˆä¸å¿…è¦çš„çº¿ç¨‹å¼€é”€ï¼Œå¯ä»¥é€šè¿‡çº¿ç¨‹æ± æœºåˆ¶æ”¹å–„ (å®ç°å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨)</p>\n<h2 id=\"12-java-bioå·¥ä½œæœºåˆ¶\"><a class=\"anchor\" href=\"#12-java-bioå·¥ä½œæœºåˆ¶\">#</a> 1.2 Java BIO å·¥ä½œæœºåˆ¶</h2>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303174323321.png\" alt=\"image-20240303174323321\" /></p>\n<h2 id=\"13-ä¼ ç»Ÿçš„bioç¼–ç¨‹å®ä¾‹å›é¡¾\"><a class=\"anchor\" href=\"#13-ä¼ ç»Ÿçš„bioç¼–ç¨‹å®ä¾‹å›é¡¾\">#</a> 1.3 ä¼ ç»Ÿçš„ BIO ç¼–ç¨‹å®ä¾‹å›é¡¾</h2>\n<p>ç½‘ç¼–ç¼–ç¨‹çš„åŸºæœ¬æ¨¡å‹æ˜¯ Client/Server æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´è¿›è¡Œç›¸äº’é€šä¿¡ï¼Œå…¶ä¸­æœåŠ¡å™¨ç«¯æä¾›ä½ç½®ä¿¡æ¯ (ç»‘å®š IP åœ°å€å’Œç«¯å£)ï¼Œå®¢æˆ·ç«¯é€šè¿‡è¿æ¥æ“ä½œä¹¡æœåŠ¡ç«¯ç›‘å¬çš„ç«¯å£åœ°å€å‘èµ·è¿æ¥è¯·æ±‚ï¼ŒåŸºäº TCP åè®®ä¸‹è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹è¿æ¥ï¼Œè¿æ¥æˆåŠŸåï¼ŒåŒæ–¹é€šè¿‡ç½‘ç»œå¥—æ¥å­— (Socket) è¿›è¡Œé€šä¿¡ã€‚</p>\n<p>ä¼ ç»Ÿçš„åŒæ­¥é˜»å¡æ¨¡å‹å¼€å‘ä¸­ï¼ŒæœåŠ¡ç«¯ ServerSocket è´Ÿè´£ç»‘å®š IP åœ°å€ï¼Œå¯åŠ¨ç›‘å¬ç«¯å£ï¼›å®¢æˆ·ç«¯ Socket è´Ÿè´£å‘èµ·åŸºäº BIO æ¨¡å¼ä¸‹çš„é€šä¿¡ï¼Œå®¢æˆ·ç«¯ - æœåŠ¡ç«¯æ˜¯å®Œå…¨åŒæ­¥ï¼Œå®Œå…¨è€¦åˆçš„ã€‚</p>\n<p>ä»£ç ï¼š</p>\n<p>æœåŠ¡ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * ç›®æ ‡ï¼šå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯æ¥æ”¶æ¶ˆæ¯ã€‚</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Server</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">ServerSocket</span> serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯ å¯åŠ¨ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token comment\">// 1. å®šä¹‰ä¸€ä¸ª ServerSocket å¯¹è±¡è¿›è¡ŒæœåŠ¡ç«¯çš„ç«¯å£æ³¨å†Œ</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token comment\">// 2. ç›‘å¬å®¢æˆ·ç«¯çš„ Socket çš„è¿æ¥è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            socket <span class=\"token operator\">=</span> serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token comment\">// 3. ä» socket ç®¡é“ä¸­å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å…¥æµå¯¹è±¡</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token class-name\">InputStream</span> is <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token comment\">// 4. æŠŠå­—èŠ‚è¾“å…¥æµåŒ…è£…æˆä¸€ä¸ªç¼“å†²å­—ç¬¦è¾“å…¥æµ</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token class-name\">BufferedReader</span> br <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">(</span>is<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>msg <span class=\"token operator\">=</span> br<span class=\"token punctuation\">.</span><span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯æ¥æ”¶åˆ°ï¼š\"</span> <span class=\"token operator\">+</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * å®¢æˆ·ç«¯ï¼šå‘é€æ¶ˆæ¯åˆ°æœåŠ¡ç«¯</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">// 1. åˆ›å»º socket å¯¹è±¡è¯·æ±‚æœåŠ¡ç«¯è¿æ¥</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">InetAddress</span> localHost <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å®¢æˆ·ç«¯ å¯åŠ¨ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            localHost <span class=\"token operator\">=</span> <span class=\"token class-name\">InetAddress</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLocalHost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span>localHost<span class=\"token punctuation\">.</span><span class=\"token function\">getHostAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">OutputStream</span> os <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token class-name\">PrintStream</span> ps <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PrintStream</span><span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            ps<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello world! æœåŠ¡ç«¯ ä½ å¥½ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            ps<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303194303611.png\" alt=\"image-20240303194303611\" /></p>\n<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° æœåŠ¡ç«¯æŠ¥é”™äº†è¯´ï¼šè¿æ¥é‡ç½®ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>\n<p>åˆ†æï¼š</p>\n<p>æœåŠ¡ç«¯åˆšå¼€å§‹å¯åŠ¨çš„æ—¶å€™å°±ä¼šè¿›å…¥æš‚åœ (é˜»å¡) çŠ¶æ€åœ¨ accept ä»£ç å¤„ï¼Œæ­¤æ—¶ä¼šç­‰å¾…å®¢æˆ·ç«¯çš„æ¥å…¥</p>\n<p>å½“å®¢æˆ·ç«¯å¯åŠ¨çš„æ—¶å€™æœåŠ¡ç«¯å°±å¯ä»¥æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œäºæ˜¯ä¼šåœ¨ä¸‹é¢çš„ä»£ç  while (((msg = br.readLine ()) != null)) æŒ‰ç…§ <mark>è¡Œ</mark> ç­‰æ•°æ®ã€‚</p>\n<p>ä½†æ˜¯å› ä¸ºå®¢æˆ·ç«¯é‚£è¾¹æ²¡æœ‰æ•°æ®è¿‡æ¥æ‰€ä»¥æœåŠ¡ç«¯å°±ä¼šåœ¨ while (((msg = br.readLine ()) != null)) æš‚åœç­‰å¾…</p>\n<p>è€Œå®¢æˆ·ç«¯æœ€åå‘é€çš„æ•°æ® ps.print (&quot;hello world! æœåŠ¡ç«¯ ä½ å¥½ï¼&quot;) è¿™æ˜¯å¦æ˜¯ä¸€è¡Œå‘¢ï¼Ÿ</p>\n<p>è¿™ä¸ªåœ°æ–¹æ˜¯ä¸€ä¸ªå…³é”®ï¼ŒåŸå› å°±æ˜¯å› ä¸ºæœåŠ¡ç«¯æ˜¯ä¸€ç§åŒæ­¥é˜»å¡çš„æœºåˆ¶ï¼Œå°±æ˜¯è¯´ while (((msg = br.readLine ()) != null)) ä¼šä¸æ–­åœ°ç­‰å¾…å®¢æˆ·ç«¯çš„æ•°æ®è€Œè¿™é‡Œæ˜¯è¦ç­‰ä¸€è¡Œæ•°æ®ã€‚</p>\n<p>è€Œå®¢æˆ·ç«¯å¹¶æ²¡æœ‰å‘ä¸€è¡Œæ•°æ®è€Œæ˜¯å‘äº†ä¸€å †æ–‡å­—</p>\n<p>å½“å®¢æˆ·ç«¯æŠŠæ•°æ®å‘é€å‡ºå»åå®¢æˆ·ç«¯å°±æ­»æ‰äº†ï¼Œè€ŒæœåŠ¡ç«¯è¿˜åœ¨ç­‰ï¼ŒæœåŠ¡ç«¯åœ¨ç­‰çš„æ—¶å€™ä¹Ÿä¼šæ¥åˆ°å®¢æˆ·ç«¯çš„æ•°æ®ä½†æ˜¯ä»–å¹¶ä¸è®¤ä¸ºå®¢æˆ·ç«¯ç»™å®ƒçš„æ•°æ®æ˜¯ä¸€è¡Œæ•°æ®ã€‚æœåŠ¡ç«¯ä¸€ç›´åœ¨ç­‰å®¢æˆ·ç«¯ç»™ä»–å‘æ•°æ®å› ä¸ºä»–è®¤ä¸ºå®¢æˆ·ç«¯è¿˜æœ‰æ•°æ®ï¼Œæœ€åå®¢æˆ·ç«¯æ­»æ‰åï¼ŒæœåŠ¡ç«¯æœ€ç»ˆä¹Ÿæ­»æ‰ å°±è·‘å‡ºäº† è¿æ¥é‡ç½® çš„å¼‚å¸¸</p>\n<p>è¿™ç§é€šä¿¡æœºåˆ¶æ˜¯ åŒæ­¥é˜»å¡ åˆ¶ï¼Œå°±æ˜¯åŒæ–¹éƒ½åœ¨ç­‰å¯¹æ–¹</p>\n<p>å¦‚æœå®¢æˆ·ç«¯çš„ socket æŒ‚æ‰é‚£ä¹ˆæœåŠ¡ç«¯ socket ä¹Ÿä¼šè·Ÿç€ä¸€èµ·æŒ‚æ‰</p>\n<p>é‚£æˆ‘ä»¬æ€ä¹ˆåœ¨åŸæœ‰çš„ä»£ç ä¸Šè®©å®¢æˆ·ç«¯å‘é€ä¸€è¡Œæ•°æ®ç»™æœåŠ¡ç«¯å‘¢ï¼Ÿ</p>\n<p>ä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š</p>\n<p>æˆ‘ä»¬ä½¿ç”¨ println è¿™ä¸ªæ–¹æ³•çš„æ„æ€æ˜¯ï¼šç”¨äºæ‰“å°å­—ç¬¦ä¸²åå¹¶ç»ˆæ­¢è¯¥è¡Œ</p>\n<p>æœåŠ¡ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * ç›®æ ‡ï¼šå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯æ¥æ”¶æ¶ˆæ¯ã€‚</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Server</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">ServerSocket</span> serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯ å¯åŠ¨ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token comment\">// 1. å®šä¹‰ä¸€ä¸ª ServerSocket å¯¹è±¡è¿›è¡ŒæœåŠ¡ç«¯çš„ç«¯å£æ³¨å†Œ</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token comment\">// 2. ç›‘å¬å®¢æˆ·ç«¯çš„ Socket çš„è¿æ¥è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            socket <span class=\"token operator\">=</span> serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token comment\">// 3. ä» socket ç®¡é“ä¸­å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å…¥æµå¯¹è±¡</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token class-name\">InputStream</span> is <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token comment\">// 4. æŠŠå­—èŠ‚è¾“å…¥æµåŒ…è£…æˆä¸€ä¸ªç¼“å†²å­—ç¬¦è¾“å…¥æµ</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token class-name\">BufferedReader</span> br <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">(</span>is<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>msg <span class=\"token operator\">=</span> br<span class=\"token punctuation\">.</span><span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯æ¥æ”¶åˆ°ï¼š\"</span> <span class=\"token operator\">+</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * å®¢æˆ·ç«¯ï¼šå‘é€æ¶ˆæ¯åˆ°æœåŠ¡ç«¯</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">// 1. åˆ›å»º socket å¯¹è±¡è¯·æ±‚æœåŠ¡ç«¯è¿æ¥</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">InetAddress</span> localHost <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å®¢æˆ·ç«¯ å¯åŠ¨ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            localHost <span class=\"token operator\">=</span> <span class=\"token class-name\">InetAddress</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLocalHost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span>localHost<span class=\"token punctuation\">.</span><span class=\"token function\">getHostAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">OutputStream</span> os <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token class-name\">PrintStream</span> ps <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PrintStream</span><span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            ps<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello world! æœåŠ¡ç«¯ ä½ å¥½ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            ps<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303195710801.png\" alt=\"image-20240303195710801\" /></p>\n<p>å¯ä»¥çœ‹åˆ° æœåŠ¡ç«¯è¿™æ¬¡æ¥æ”¶åˆ°äº†å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ•°æ®äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æŠ¥é”™äº†è¯´ï¼šè¿æ¥é‡ç½®</p>\n<p>è¿™æ˜¯å› ä¸ºæœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„ä¸€æ¡æ•°æ®å ä»–å¹¶æ²¡æœ‰åœæ­¢ä»–è¿˜åœ¨ç­‰å®¢æˆ·ç«¯çš„ç¬¬äºŒæ¡æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯å‘å®Œæ¶ˆæ¯åå°±æŒ‚äº†ï¼ŒæœåŠ¡ç«¯åœ¨ç­‰æ¶ˆæ¯æ—¶å‘ç°å®¢æˆ·ç«¯æŒ‚äº†ï¼Œç„¶åä»–ä»¬è·Ÿç€æŒ‚äº† ç„¶åæŠ›å‡º è¿æ¥é‡ç½® å¼‚å¸¸</p>\n<p>é‚£æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬åªéœ€è¦è®©æœåŠ¡ç«¯ä¸è¦å¾ªç¯çš„ä¸€ç›´ç­‰å¾…å®¢æˆ·ç«¯çš„æ¶ˆæ¯ï¼Œè€Œæ˜¯åœ¨å®¢æˆ·ç«¯æœ‰æ¶ˆæ¯çš„æ—¶å€™æœåŠ¡ç«¯å†å»æ¥æ”¶</p>\n<p>æœåŠ¡ç«¯ä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * ç›®æ ‡ï¼šå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯æ¥æ”¶æ¶ˆæ¯ã€‚</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Server</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">ServerSocket</span> serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯ å¯åŠ¨ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token comment\">// 1. å®šä¹‰ä¸€ä¸ª ServerSocket å¯¹è±¡è¿›è¡ŒæœåŠ¡ç«¯çš„ç«¯å£æ³¨å†Œ</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token comment\">// 2. ç›‘å¬å®¢æˆ·ç«¯çš„ Socket çš„è¿æ¥è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            socket <span class=\"token operator\">=</span> serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token comment\">// 3. ä» socket ç®¡é“ä¸­å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å…¥æµå¯¹è±¡</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token class-name\">InputStream</span> is <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token comment\">// 4. æŠŠå­—èŠ‚è¾“å…¥æµåŒ…è£…æˆä¸€ä¸ªç¼“å†²å­—ç¬¦è¾“å…¥æµ</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token class-name\">BufferedReader</span> br <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">(</span>is<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>msg <span class=\"token operator\">=</span> br<span class=\"token punctuation\">.</span><span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯æ¥æ”¶åˆ°ï¼š\"</span> <span class=\"token operator\">+</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303200055745.png\" alt=\"image-20240303200055745\" /></p>\n<p>æœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„æ¶ˆæ¯åå°±ä¼šåˆ¤æ–­è¯»å–åˆ°çš„æ•°æ®æ˜¯å¦ ä¸ä¸º null å½“å®¢æˆ·ç«¯æŒ‚æ‰å æœåŠ¡ç«¯å°±ä¸ä¼šå»è¯»å–å®¢æˆ·ç«¯çš„æ¶ˆæ¯äº†ï¼Œä¹Ÿå°±ä¸ä¼šæŠ›å‡º è¿æ¥é‡ç½® çš„å¼‚å¸¸ä¿¡æ¯äº†</p>\n<h2 id=\"14-å°ç»“\"><a class=\"anchor\" href=\"#14-å°ç»“\">#</a> 1.4 å°ç»“</h2>\n<ul>\n<li>åœ¨ä»¥ä¸Šé€šä¿¡ä¸­ï¼ŒæœåŠ¡ç«¯ä¼šä¸€ç›´ç­‰å¾…å®¢æˆ·ç«¯çš„æ¶ˆæ¯ï¼Œå¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰è¿›è¡Œæ¶ˆæ¯çš„å‘é€ï¼ŒæœåŠ¡ç«¯å°†ä¸€ç›´è¿›å…¥é˜»å¡çŠ¶æ€</li>\n<li>åŒæ—¶æœåŠ¡ç«¯æ˜¯æŒ‰ç…§<mark>è¡Œ</mark>è·å–æ¶ˆæ¯çš„ï¼Œè¿™æ„å‘³ç€å®¢æˆ·ç«¯ä¹Ÿå¿…é¡»æŒ‰ç…§<mark>è¡Œ</mark>è¿›è¡Œæ¶ˆæ¯çš„å‘é€ï¼Œå¦åˆ™æœåŠ¡ç«¯å°†è¿›å…¥ç­‰å¾…æ¶ˆæ¯çš„é˜»å¡çŠ¶æ€ï¼</li>\n</ul>\n<h2 id=\"15-bioæ¨¡å¼ä¸‹å¤šå‘å’Œå¤šæ”¶æ¶ˆæ¯\"><a class=\"anchor\" href=\"#15-bioæ¨¡å¼ä¸‹å¤šå‘å’Œå¤šæ”¶æ¶ˆæ¯\">#</a> 1.5 BIO æ¨¡å¼ä¸‹å¤šå‘å’Œå¤šæ”¶æ¶ˆæ¯</h2>\n<p>åœ¨ 1.3 çš„æ¡ˆä¾‹ä¸­ï¼Œ<mark>åªèƒ½å®ç°å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯æ¥æ”¶æ¶ˆæ¯</mark>ï¼Œå¹¶ä¸èƒ½å®ç°åå¤çš„æ”¶æ¶ˆæ¯å’Œåå¤çš„å‘æ¶ˆæ¯ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å®¢æˆ·ç«¯æ¡ˆä¾‹ä¸­ï¼ŒåŠ ä¸Šåå¤æŒ‰ç…§è¡Œå‘é€æ¶ˆæ¯çš„é€»è¾‘å³å¯ï¼æ¡ˆä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>\n<p>å®¢æˆ·ç«¯</p>\n<p>é€šè¿‡ while å¾ªç¯åŠ ä¸Šæ‰«æå™¨æ¥è¿›è¡Œä¸æ–­åœ°è¯¢é—®å‘é€æ¶ˆæ¯ç»™æœåŠ¡ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * å®¢æˆ·ç«¯ï¼šåå¤çš„å‘é€æ¶ˆæ¯åˆ°æœåŠ¡ç«¯</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">// 1. åˆ›å»º socket å¯¹è±¡è¯·æ±‚æœåŠ¡ç«¯è¿æ¥</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">InetAddress</span> localHost <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å®¢æˆ·ç«¯ å¯åŠ¨ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            localHost <span class=\"token operator\">=</span> <span class=\"token class-name\">InetAddress</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLocalHost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span>localHost<span class=\"token punctuation\">.</span><span class=\"token function\">getHostAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">OutputStream</span> os <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token class-name\">PrintStream</span> ps <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PrintStream</span><span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token class-name\">Scanner</span> scanner <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¯·è¯´ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token class-name\">String</span> next <span class=\"token operator\">=</span> scanner<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                ps<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                ps<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æœåŠ¡ç«¯</p>\n<p>åªéœ€è¦å°† if å†æ”¹å›æ¥ æˆ while å¾ªç¯ä¸æ–­åœ°å»æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * ç›®æ ‡ï¼šæœåŠ¡ç«¯å¯ä»¥åå¤çš„æ¥æ”¶æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥åå¤çš„å‘é€æ¶ˆæ¯</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Server</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">ServerSocket</span> serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯ å¯åŠ¨ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token comment\">// 1. å®šä¹‰ä¸€ä¸ª ServerSocket å¯¹è±¡è¿›è¡ŒæœåŠ¡ç«¯çš„ç«¯å£æ³¨å†Œ</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token comment\">// 2. ç›‘å¬å®¢æˆ·ç«¯çš„ Socket çš„è¿æ¥è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            socket <span class=\"token operator\">=</span> serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token comment\">// 3. ä» socket ç®¡é“ä¸­å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å…¥æµå¯¹è±¡</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token class-name\">InputStream</span> is <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token comment\">// 4. æŠŠå­—èŠ‚è¾“å…¥æµåŒ…è£…æˆä¸€ä¸ªç¼“å†²å­—ç¬¦è¾“å…¥æµ</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token class-name\">BufferedReader</span> br <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">(</span>is<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>msg <span class=\"token operator\">=</span> br<span class=\"token punctuation\">.</span><span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯æ¥æ”¶åˆ°ï¼š\"</span> <span class=\"token operator\">+</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303201238782.png\" alt=\"image-20240303201238782\" /></p>\n<h3 id=\"å°ç»“\"><a class=\"anchor\" href=\"#å°ç»“\">#</a> å°ç»“</h3>\n<ul>\n<li>æœ¬æ¡ˆä¾‹ä¸­ç¡®å®å¯ä»¥å®ç°å®¢æˆ·ç«¯å¤šå‘å¤šæ”¶</li>\n<li>ä½†æ˜¯æœåŠ¡ç«¯åªèƒ½å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå› ä¸ºæœåŠ¡ç«¯æ˜¯å•çº¿ç¨‹çš„ã€‚ä¸€æ¬¡åªèƒ½ä¸ä¸€ä¸ªå®¢æˆ·ç«¯è¿›è¡Œæ¶ˆæ¯é€šä¿¡</li>\n</ul>\n<h2 id=\"16-bioæ¨¡å¼ä¸‹æ¥å—å¤šä¸ªå®¢æˆ·ç«¯\"><a class=\"anchor\" href=\"#16-bioæ¨¡å¼ä¸‹æ¥å—å¤šä¸ªå®¢æˆ·ç«¯\">#</a> 1.6 BIO æ¨¡å¼ä¸‹æ¥å—å¤šä¸ªå®¢æˆ·ç«¯</h2>\n<h3 id=\"æ¦‚è¿°\"><a class=\"anchor\" href=\"#æ¦‚è¿°\">#</a> æ¦‚è¿°</h3>\n<p>åœ¨ä¸Šè¿°çš„æ¡ˆä¾‹ä¸­ï¼Œä¸€ä¸ªæœåŠ¡ç«¯åªèƒ½æ¥å—ä¸€ä¸ªå®¢æˆ·ç«¯çš„é€šä¿¡è¯·æ±‚ï¼Œé‚£ä¹ˆå¦‚æœæœåŠ¡ç«¯éœ€è¦å¤„ç†å¾ˆå¤šä¸ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯é€šä¿¡è¯·æ±‚åº”è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦åœ¨æœåŠ¡ç«¯å¼•å…¥çº¿ç¨‹äº†ï¼Œä¹Ÿå°±æ˜¯è¯´å®¢æˆ·ç«¯æ¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼ŒæœåŠ¡ç«¯å°±åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥å¤„ç†è¿™ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œè¿™æ ·å°±å®ç°äº†ä¸€ä¸ªå®¢æˆ·ç«¯ä¸€ä¸ªçº¿ç¨‹çš„æ¨¡å‹ï¼Œå›¾è§£æ¨¡å¼å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303202416569.png\" alt=\"image-20240303202416569\" /></p>\n<p>å…ˆçœ‹ä¸Šé¢çš„ä»£ç çš„æ–¹å¼ï¼Œå½“å®¢æˆ·ç«¯å¯åŠ¨å¤šä¸ªä¼šé€ æˆçš„é—®é¢˜ï¼</p>\n<p>å®¢æˆ·ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * å®¢æˆ·ç«¯ï¼šå‘é€æ¶ˆæ¯åˆ°æœåŠ¡ç«¯</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">// 1. åˆ›å»º socket å¯¹è±¡è¯·æ±‚æœåŠ¡ç«¯è¿æ¥</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">InetAddress</span> localHost <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å®¢æˆ·ç«¯ å¯åŠ¨ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            localHost <span class=\"token operator\">=</span> <span class=\"token class-name\">InetAddress</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLocalHost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span>localHost<span class=\"token punctuation\">.</span><span class=\"token function\">getHostAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">OutputStream</span> os <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token class-name\">PrintStream</span> ps <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PrintStream</span><span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token class-name\">Scanner</span> scanner <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¯·è¯´ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token class-name\">String</span> next <span class=\"token operator\">=</span> scanner<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                ps<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                ps<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æœåŠ¡ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * ç›®æ ‡ï¼šæœåŠ¡ç«¯å¯ä»¥åå¤çš„æ¥æ”¶æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥åå¤çš„å‘é€æ¶ˆæ¯</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Server</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">ServerSocket</span> serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯ å¯åŠ¨ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token comment\">// 1. å®šä¹‰ä¸€ä¸ª ServerSocket å¯¹è±¡è¿›è¡ŒæœåŠ¡ç«¯çš„ç«¯å£æ³¨å†Œ</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token comment\">// 2. ç›‘å¬å®¢æˆ·ç«¯çš„ Socket çš„è¿æ¥è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            socket <span class=\"token operator\">=</span> serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token comment\">// 3. ä» socket ç®¡é“ä¸­å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å…¥æµå¯¹è±¡</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token class-name\">InputStream</span> is <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token comment\">// 4. æŠŠå­—èŠ‚è¾“å…¥æµåŒ…è£…æˆä¸€ä¸ªç¼“å†²å­—ç¬¦è¾“å…¥æµ</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token class-name\">BufferedReader</span> br <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">(</span>is<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>msg <span class=\"token operator\">=</span> br<span class=\"token punctuation\">.</span><span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯æ¥æ”¶åˆ°ï¼š\"</span> <span class=\"token operator\">+</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯åŠ¨å¤šä¸ªå®¢æˆ·ç«¯æ¥ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯æµ‹è¯•ä¸€ä¸‹ä¼šå‡ºä»€ä¹ˆé—®é¢˜</p>\n<p>åœ¨ Edit Configurations ä¸­å‹¾é€‰ä¸Š å¯ä»¥å¤šå¼€çš„é€‰é¡¹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303203147907.png\" alt=\"image-20240303203147907\" /></p>\n<p>æˆ‘ä»¬å¯åŠ¨ä¸€èµ·æœåŠ¡ç«¯ç„¶åå¯åŠ¨ä¸¤ä¸ªå®¢æˆ·ç«¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303203345659.png\" alt=\"image-20240303203345659\" /></p>\n<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° ç¬¬äºŒä¸ªå¯åŠ¨çš„ å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯æœåŠ¡ç«¯å¹¶ä¸ä¼šæ¥æ”¶åˆ° ä»–çš„æ¶ˆæ¯ï¼Œä¸­é—´çš„æ˜¯æœ€åä¸€ä¸ªå¯åŠ¨çš„å®¢æˆ·ç«¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303203512427.png\" alt=\"image-20240303203512427\" /></p>\n<p>è¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ</p>\n<p>åˆ†æï¼š</p>\n<p>å½“æœåŠ¡ç«¯å¯åŠ¨æ—¶ accept ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯ 1 å¯åŠ¨è¿æ¥äº†æœåŠ¡ï¼Œæ­¤æ—¶æœåŠ¡ç«¯ä»£ç å°±ä¼šæ‰§è¡Œåˆ° while (((msg = br.readLine ()) != null)) æœåŠ¡ç«¯å°±ä¸ä¼šå†å»æ¥æ”¶å…¶ä»–å®¢æˆ·ç«¯çš„è¯·æ±‚äº†ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯ 2 æ²¡æœ‰è¿æ¥åˆ°æœåŠ¡ç«¯å‘é€æ¶ˆæ¯è‡ªç„¶ä¸ä¼šæœ‰äººæ¥æ”¶</p>\n<p>ä½¿ç”¨çº¿ç¨‹æ¥è§£å†³é—®é¢˜</p>\n<p>ä»£ç ï¼š</p>\n<p>æœåŠ¡ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * ç›®æ ‡ï¼šå®ç°æœåŠ¡ç«¯å¯ä»¥åŒæ—¶æ¥æ”¶å¤šä¸ªå®¢æˆ·ç«¯çš„ Socket é€šä¿¡è¯·æ±‚</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * æ€è·¯ï¼šæ˜¯æœåŠ¡ç«¯æ¯æ¥æ”¶åˆ°ä¸€ä¸ªå®¢æˆ·ç«¯ Socket è¯·æ±‚å¯¹è±¡ä¹‹åéƒ½äº¤ç»™ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥å¤„ç†å®¢æˆ·ç«¯çš„æ•°æ®äº¤äº’éœ€æ±‚</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Server</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯ å¯åŠ¨ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">ServerSocket</span> serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token comment\">// å®šä¹‰ä¸€ä¸ªæ­»å¾ªç¯ä¸æ–­åœ°æ¥æ”¶å®¢æˆ·ç«¯ Socket è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token comment\">// åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥å¤„ç†ä¸è¿™ä¸ªå®¢æˆ·ç«¯çš„ Socket é€šä¿¡è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerThreadReader</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>çº¿ç¨‹ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ServerThreadReader</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Thread</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Socket</span> socket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ServerThreadReader</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Socket</span> socket<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>socket <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token class-name\">InputStream</span> is <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">BufferedReader</span> br <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">(</span>is<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>msg <span class=\"token operator\">=</span> br<span class=\"token punctuation\">.</span><span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å®¢æˆ·ç«¯ å¯åŠ¨ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token comment\">// è¯·æ±‚ä¸æœåŠ¡ç«¯çš„ Socket å¯¹è±¡è¿æ¥</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token class-name\">InetAddress</span> localHost <span class=\"token operator\">=</span> <span class=\"token class-name\">InetAddress</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLocalHost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span>localHost<span class=\"token punctuation\">.</span><span class=\"token function\">getHostAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token comment\">// å¾—åˆ°æ‰“å°æµ</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">PrintStream</span> ps <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PrintStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token class-name\">Scanner</span> sc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¯·è¯´ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token class-name\">String</span> next <span class=\"token operator\">=</span> sc<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                ps<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                ps<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303230637523.png\" alt=\"image-20240303230637523\" /></p>\n<h3 id=\"å°ç»“-2\"><a class=\"anchor\" href=\"#å°ç»“-2\">#</a> å°ç»“</h3>\n<ul>\n<li>1 æ¯ä¸ª Socket æ¥æ”¶åˆ°ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹çš„ç«äº‰ï¼Œåˆ‡æ¢ä¸Šä¸‹æ–‡å½±å“æ€§èƒ½</li>\n<li>2 æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šå ç”¨æ ˆç©ºé—´å’Œ CPU èµ„æº</li>\n<li>3 å¹¶ä¸æ˜¯æ¯ä¸ª Socket éƒ½è¿›è¡Œ IO æ“ä½œï¼Œæ— æ„ä¹‰çš„çº¿ç¨‹å¤„ç†</li>\n<li>4 å®¢æˆ·ç«¯çš„å¹¶å‘è®¿é—®å¢åŠ æ—¶ã€‚æœåŠ¡ç«¯å°†å‘ˆç° 1:1 çš„çº¿ç¨‹å¼€é”€ï¼Œè®¿é—®é‡è¶Šå¤§ï¼Œç³»ç»Ÿå°†å‘ç”Ÿçº¿ç¨‹æ ˆæº¢å‡ºï¼Œçº¿ç¨‹åˆ›å»ºå¤±è´¥ï¼Œæœ€ç»ˆå¯¼è‡´è¿›ç¨‹å®•æœºæˆ–è€…åƒµæ­»ï¼Œä»è€Œä¸èƒ½å¯¹å¤–æä¾›æœåŠ¡</li>\n</ul>\n<h2 id=\"17-ä¼ªå¼‚æ­¥ioç¼–ç¨‹\"><a class=\"anchor\" href=\"#17-ä¼ªå¼‚æ­¥ioç¼–ç¨‹\">#</a> 1.7 ä¼ªå¼‚æ­¥ I/O ç¼–ç¨‹</h2>\n<h3 id=\"æ¦‚è¿°-2\"><a class=\"anchor\" href=\"#æ¦‚è¿°-2\">#</a> æ¦‚è¿°</h3>\n<p>åœ¨ä¸Šè¿°æ¡ˆä¾‹ä¸­ï¼šå®¢æˆ·ç«¯çš„å¹¶å‘è®¿é—®å¢åŠ æ—¶ã€‚æœåŠ¡ç«¯å°†å‘ˆç° 1:1 çš„çº¿ç¨‹å¼€é”€ï¼Œè®¿é—®é‡è¶Šå¤§ï¼Œç³»ç»Ÿå°†å‘ç”Ÿçº¿ç¨‹æ ˆæº¢å‡ºï¼Œçº¿ç¨‹åˆ›å»ºå¤±è´¥ï¼Œæœ€ç»ˆå¯¼è‡´è¿›ç¨‹å®•æœºæˆ–è€…åƒµæ­»ï¼Œä»è€Œä¸èƒ½å¯¹å¤–æä¾›æœåŠ¡ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬é‡‡ç”¨ä¸€ä¸ªä¼ªå¼‚æ­¥ I/O çš„é€šä¿¡æ¡†æ¶ï¼Œé‡‡ç”¨çº¿ç¨‹æ± å’Œä»»åŠ¡é˜Ÿåˆ—å®ç°ï¼Œå½“å®¢æˆ·ç«¯æ¥å…¥æ—¶ï¼Œå°†å®¢æˆ·ç«¯çš„ Socket å°è£…æˆä¸€ä¸ª Task (è¯¥ä»»åŠ¡å®ç° java.lang.Runnable çº¿ç¨‹ä»»åŠ¡æ¥å£) äº¤ç»™åç«¯çš„çº¿ç¨‹æ± ä¸­è¿›è¡Œå¤„ç†ã€‚JDK çš„çº¿ç¨‹æ± ç»´æŠ¤ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—å’Œ N ä¸ªæ´»è·ƒçš„çº¿ç¨‹ï¼Œå¯¹æ¶ˆæ¯é˜Ÿåˆ—ä¸­ Socket ä»»åŠ¡è¿›è¡Œå¤„ç†ï¼Œç”±äºçº¿ç¨‹æ± å¯ä»¥è®¾ç½®æ¶ˆæ¯é˜Ÿåˆ—çš„å¤§å°å’Œæœ€å¤§çº¿ç¨‹æ•°ï¼Œå› æ­¤ï¼Œå®ƒçš„èµ„æºå ç”¨æ˜¯å¯æ§çš„ï¼Œæ— è®ºå¤šå°‘ä¸ªå®¢æˆ·ç«¯å¹¶å‘è®¿é—®ï¼Œéƒ½ä¸ä¼šå¯¼è‡´èµ„æºçš„è€—å°½å’Œå®•æœº</p>\n<p>å›¾ç¤ºå¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303232928002.png\" alt=\"image-20240303232928002\" /></p>\n<p>ä»£ç ï¼š</p>\n<p>æœåŠ¡ç«¯</p>\n<p>åˆ›å»ºçº¿ç¨‹ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ServerRunnableTarget</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Runnable</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Socket</span> socket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ServerRunnableTarget</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Socket</span> socket<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>socket <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// å¤„ç†æ¥æ”¶åˆ°çš„å®¢æˆ·ç«¯ socket é€šä¿¡éœ€æ±‚</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">InputStream</span> is <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token class-name\">BufferedReader</span> br <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">(</span>is<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>msg <span class=\"token operator\">=</span> br<span class=\"token punctuation\">.</span><span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯æ¥æ”¶åˆ°ï¼š\"</span> <span class=\"token operator\">+</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åˆ›å»ºçº¿ç¨‹æ± ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HandlerSocketServerPool</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± çš„æˆå‘˜å˜é‡ ç”¨äºå­˜å‚¨ä¸€ä¸ªçº¿ç¨‹æ± å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">ExecutorService</span> executorService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// åˆ›å»ºè¿™ä¸ªç±»çš„å¯¹è±¡çš„æ—¶å€™å°±éœ€è¦åˆå§‹åŒ–çº¿ç¨‹æ± å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">HandlerSocketServerPool</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> maxThreadNum<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> queueSize<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">// å‚æ•° 1ï¼šæ ¸å¿ƒçº¿ç¨‹æ•°é‡ï¼Œå‚æ•° 2ï¼šæœ€å¤§çº¿ç¨‹æ•°é‡ï¼Œå‚æ•° 3ï¼šçº¿ç¨‹ç©ºé—²æ—¶é—´ï¼Œå‚æ•° 4ï¼šæ—¶é—´å•ä½</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        executorService <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ThreadPoolExecutor</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> maxThreadNum<span class=\"token punctuation\">,</span> <span class=\"token number\">120</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SECONDS</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayBlockingQueue</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>queueSize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// æä¾›ä¸€ä¸ªæ–¹æ³•æ¥æäº¤ä»»åŠ¡ç»™çº¿ç¨‹æ± çš„ä»»åŠ¡é˜Ÿåˆ—æ¥æš‚å­˜ï¼Œç­‰ç€çº¿ç¨‹æ± æ¥å¤„ç†</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Runnable</span> target<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        executorService<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åˆ›å»ºæœåŠ¡ç«¯ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * ç›®æ ‡ï¼šå¼€å‘å®ç°ä¼ªå¼‚æ­¥é€šä¿¡æ¶æ„</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Server</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">// æ³¨å†Œç«¯å£</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯ å¯åŠ¨ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">ServerSocket</span> serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token class-name\">HandlerSocketServerPool</span> pool <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HandlerSocketServerPool</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token comment\">// å®šä¹‰ä¸€ä¸ªå¾ªç¯æ¥æ”¶å®¢æˆ·ç«¯çš„ Socket è¿æ¥è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token comment\">// æŠŠ socket å¯¹è±¡äº¤ç»™ä¸€ä¸ªçº¿ç¨‹æ± å¤„ç†</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token comment\">// æŠŠ socket å°è£…æˆä¸€ä¸ªä»»åŠ¡å¯¹è±¡äº¤ç»™çº¿ç¨‹æ± å¤„ç†</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token class-name\">ServerRunnableTarget</span> target <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerRunnableTarget</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                pool<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å®¢æˆ·ç«¯ å¯åŠ¨ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token class-name\">InetAddress</span> localHost <span class=\"token operator\">=</span> <span class=\"token class-name\">InetAddress</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLocalHost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span>localHost<span class=\"token punctuation\">.</span><span class=\"token function\">getHostAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token class-name\">OutputStream</span> os <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token class-name\">PrintStream</span> ps <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PrintStream</span><span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">Scanner</span> sc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¯·è¯´ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token class-name\">String</span> next <span class=\"token operator\">=</span> sc<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                ps<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                ps<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœ:</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240304000841607.png\" alt=\"image-20240304000841607\" /></p>\n<h3 id=\"å°ç»“-3\"><a class=\"anchor\" href=\"#å°ç»“-3\">#</a> å°ç»“</h3>\n<ul>\n<li>ä¼ªå¼‚æ­¥ IO é‡‡ç”¨äº†çº¿ç¨‹æ± å®ç°ï¼Œå› æ­¤é¿å…äº†ä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹é€ æˆçº¿ç¨‹èµ„æºè€—å°½çš„é—®é¢˜ï¼Œä½†ç”±äºåº•å±‚ä¾ç„¶æ˜¯é‡‡ç”¨çš„åŒæ­¥é˜»å¡æ¨¡å‹ï¼Œå› æ­¤æ— æ³•ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜</li>\n<li>å¦‚æœå•ä¸ªæ¶ˆæ¯å¤„ç†çš„ç¼“æ…¢ï¼Œæˆ–è€…æœåŠ¡å™¨çº¿ç¨‹æ± ä¸­çš„å…¨éƒ¨çº¿ç¨‹éƒ½è¢«é˜»å¡ï¼Œé‚£ä¹ˆåç»­ socket çš„ io æ¶ˆæ¯éƒ½å°†åœ¨é˜Ÿåˆ—ä¸­æ’é˜Ÿã€‚æ–°çš„ socket è¯·æ±‚å°†è¢«æ‹’ç»ï¼Œå®¢æˆ·ç«¯ä¼šå‘ç”Ÿå¤§é‡è¿æ¥è¶…æ—¶</li>\n</ul>\n<h2 id=\"18-åŸºäºbioå½¢å¼ä¸‹çš„æ–‡ä»¶ä¸Šä¼ \"><a class=\"anchor\" href=\"#18-åŸºäºbioå½¢å¼ä¸‹çš„æ–‡ä»¶ä¸Šä¼ \">#</a> 1.8 åŸºäº BIO å½¢å¼ä¸‹çš„æ–‡ä»¶ä¸Šä¼ </h2>\n<h3 id=\"ç›®æ ‡\"><a class=\"anchor\" href=\"#ç›®æ ‡\">#</a> ç›®æ ‡</h3>\n<p>æ”¯æŒä»»æ„ç±»å‹æ–‡ä»¶å½¢å¼çš„ä¸Šä¼ </p>\n<p>çº¿ç¨‹ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ServerReaderThread</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Thread</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Socket</span> socket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ServerReaderThread</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Socket</span> socket<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>socket <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token comment\">// å¾—åˆ°ä¸€ä¸ªæ•°æ®è¾“å…¥æµè¯»å–å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ•°æ®</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token class-name\">DataInputStream</span> dis <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataInputStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token comment\">// è¯»å–å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ–‡ä»¶ç±»å‹</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token comment\">// æ¥æ”¶å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„ utf-8 å­—ç¬¦ä¸²</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token class-name\">String</span> suffix <span class=\"token operator\">=</span> dis<span class=\"token punctuation\">.</span><span class=\"token function\">readUTF</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯å·²ç»æˆåŠŸæ¥æ”¶åˆ°äº†æ–‡ä»¶ç±»å‹ï¼š\"</span> <span class=\"token operator\">+</span> suffix<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token comment\">// å®šä¹‰ä¸€ä¸ªå­—èŠ‚è¾“å‡ºç®¡é“è´Ÿè´£æŠŠå®¢æˆ·ç«¯å‘è¿‡æ¥çš„æ–‡ä»¶æ•°æ®å†™å‡ºå»</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token class-name\">FileOutputStream</span> os <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"C:\\\\Users\\\\Administrator\\\\Desktop\\\\download\\\\\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                     <span class=\"token constant\">UUID</span><span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> suffix<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token comment\">// ä»æ•°æ®è¾“å…¥æµä¸­è¯»å–æ–‡ä»¶æ•°æ®ï¼Œå†™å‡ºåˆ°å­—èŠ‚è¾“å‡ºæµä¸­å»</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bytes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">1024</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> dis<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                os<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            os<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯æ¥æ”¶æ–‡ä»¶ï¼Œä¿å­˜æˆåŠŸï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æœåŠ¡ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * ç›®æ ‡ï¼šæœåŠ¡ç«¯å¼€å‘ï¼Œå¯ä»¥å®ç°æ¥æ”¶å®¢æˆ·ç«¯çš„ä»»æ„ç±»å‹æ–‡ä»¶ï¼Œå¹¶ä¿å­˜åˆ°æœåŠ¡ç«¯ç£ç›˜ã€‚</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Server</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token class-name\">ServerSocket</span> serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token comment\">// äº¤ç»™ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥å¤„ç†ä¸è¿™ä¸ªå®¢æˆ·ç«¯çš„æ–‡ä»¶é€šä¿¡éœ€æ±‚</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerReaderThread</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * ç›®æ ‡ï¼šå®ç°å®¢æˆ·ç«¯ä¸Šä¼ ä»»æ„ç±»å‹çš„æ–‡ä»¶æ•°æ®ç»™æœåŠ¡ç«¯ä¿å­˜èµ·æ¥</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">// è¯·æ±‚ä¸æœåŠ¡ç«¯çš„ Socket è¿æ¥</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token class-name\">InetAddress</span> localHost <span class=\"token operator\">=</span> <span class=\"token class-name\">InetAddress</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLocalHost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span>localHost<span class=\"token punctuation\">.</span><span class=\"token function\">getHostAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token comment\">// æŠŠå­—èŠ‚è¾“å‡ºæµä½œä¸€ä¸ªåŒ…è£… åŒ…è£…æˆä¸€ä¸ªæ•°æ®è¾“å‡ºæµ</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token class-name\">DataOutputStream</span> dos <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataOutputStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token comment\">// å…ˆå‘é€ä¸Šä¼ æ–‡ä»¶çš„åç¼€ç»™æœåŠ¡ç«¯ ï¼ˆå…ˆè®©æœåŠ¡ç«¯çŸ¥é“è‡ªå·±æ¥æ”¶çš„æ˜¯ä»€ä¹ˆç±»å‹çš„æ–‡ä»¶ï¼‰</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token comment\">// å‘é€ utf-8 ç¼–ç çš„å­—ç¬¦ä¸²åˆ°æœåŠ¡ç«¯ä¸­</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            dos<span class=\"token punctuation\">.</span><span class=\"token function\">writeUTF</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".png\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token comment\">// æŠŠæ–‡ä»¶æ•°æ®å‘é€ç»™æœåŠ¡ç«¯è¿›è¡Œæ¥æ”¶</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token class-name\">FileInputStream</span> is <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"C:\\\\Users\\\\Administrator\\\\Desktop\\\\Minecraft.png\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bytes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">1024</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> is<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                dos<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            dos<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç </p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240304211407647.png\" alt=\"image-20240304211407647\" /></p>\n<p>å¯ä»¥çœ‹åˆ° å®¢æˆ·ç«¯å‘é€çš„æ–‡ä»¶ æœåŠ¡ç«¯æ¥æ”¶åˆ°äº†ï¼Œä½†æ˜¯æœåŠ¡ç«¯ å´æŠ¥é”™äº†ï¼</p>\n<p>è€Œä¸” å›¾ç‰‡ ä¹Ÿä¸èƒ½æ­£å¸¸æ‰“å¼€æŸ¥çœ‹äº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240304211519844.png\" alt=\"image-20240304211519844\" /></p>\n<p>ä¸ºä»€ä¹ˆæœåŠ¡ç«¯æŠ¥é”™å‘¢ï¼Ÿ</p>\n<p>å› ä¸ºï¼Œå®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªæ–‡ä»¶å æœåŠ¡ç«¯ä»£ç æ‰§è¡Œåˆ° while (((i = dis.read (bytes)) != -1))ï¼ŒæœåŠ¡ç«¯ä¸€ç›´åœ¨ç­‰è€Œå®¢æˆ·ç«¯æ­»æ‰äº†æœåŠ¡ç«¯ä¹Ÿå°±è·Ÿç€æ­»æ‰ç„¶åæœåŠ¡ç«¯å°±è·‘å‡ºäº† è¿æ¥é‡ç½®çš„ å¼‚å¸¸äº†</p>\n<p>ä¹‹å‰ä½¿ç”¨ if è§£å†³äº†è¯¥é—®é¢˜ï¼Œè¿™æ¬¡å°±ä¸èƒ½ä½¿ç”¨ if äº† å› ä¸ºå®¢æˆ·ç«¯å‘é€æ–‡ä»¶æ•°æ®æ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œè€ŒæœåŠ¡ç«¯å¦‚æœä½¿ç”¨ if çš„è¯ æ–‡ä»¶æ•°æ®åªå‘é€ä¸€æ¬¡æ ¹æœ¬å‘é€ä¸å®Œã€‚</p>\n<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ socket çš„ shudownOutput () æ¥ å‘Šè¯‰æœåŠ¡ç«¯ ä¸Šä¸€ä¸ªå›è¯å·²ç»ç»“æŸäº†æ¥è§£å†³æŠ¥é”™ã€‚</p>\n<p>ä»£ç å¦‚ä¸‹ï¼š</p>\n<p>çº¿ç¨‹ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ServerReaderThread</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Thread</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Socket</span> socket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ServerReaderThread</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Socket</span> socket<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>socket <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token comment\">// å¾—åˆ°ä¸€ä¸ªæ•°æ®è¾“å…¥æµè¯»å–å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ•°æ®</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token class-name\">DataInputStream</span> dis <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataInputStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token comment\">// è¯»å–å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ–‡ä»¶ç±»å‹</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token comment\">// æ¥æ”¶å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„ utf-8 å­—ç¬¦ä¸²</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token class-name\">String</span> suffix <span class=\"token operator\">=</span> dis<span class=\"token punctuation\">.</span><span class=\"token function\">readUTF</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯å·²ç»æˆåŠŸæ¥æ”¶åˆ°äº†æ–‡ä»¶ç±»å‹ï¼š\"</span> <span class=\"token operator\">+</span> suffix<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token comment\">// å®šä¹‰ä¸€ä¸ªå­—èŠ‚è¾“å‡ºç®¡é“è´Ÿè´£æŠŠå®¢æˆ·ç«¯å‘è¿‡æ¥çš„æ–‡ä»¶æ•°æ®å†™å‡ºå»</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token class-name\">FileOutputStream</span> os <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"C:\\\\Users\\\\Administrator\\\\Desktop\\\\download\\\\\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                     <span class=\"token constant\">UUID</span><span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> suffix<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token comment\">// ä»æ•°æ®è¾“å…¥æµä¸­è¯»å–æ–‡ä»¶æ•°æ®ï¼Œå†™å‡ºåˆ°å­—èŠ‚è¾“å‡ºæµä¸­å»</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bytes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">1024</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> dis<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                os<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            os<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯æ¥æ”¶æ–‡ä»¶ï¼Œä¿å­˜æˆåŠŸï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æœåŠ¡ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * ç›®æ ‡ï¼šæœåŠ¡ç«¯å¼€å‘ï¼Œå¯ä»¥å®ç°æ¥æ”¶å®¢æˆ·ç«¯çš„ä»»æ„ç±»å‹æ–‡ä»¶ï¼Œå¹¶ä¿å­˜åˆ°æœåŠ¡ç«¯ç£ç›˜ã€‚</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Server</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token class-name\">ServerSocket</span> serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token comment\">// äº¤ç»™ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥å¤„ç†ä¸è¿™ä¸ªå®¢æˆ·ç«¯çš„æ–‡ä»¶é€šä¿¡éœ€æ±‚</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerReaderThread</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * ç›®æ ‡ï¼šå®ç°å®¢æˆ·ç«¯ä¸Šä¼ ä»»æ„ç±»å‹çš„æ–‡ä»¶æ•°æ®ç»™æœåŠ¡ç«¯ä¿å­˜èµ·æ¥</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">// è¯·æ±‚ä¸æœåŠ¡ç«¯çš„ Socket è¿æ¥</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token class-name\">InetAddress</span> localHost <span class=\"token operator\">=</span> <span class=\"token class-name\">InetAddress</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLocalHost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span>localHost<span class=\"token punctuation\">.</span><span class=\"token function\">getHostAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token comment\">// æŠŠå­—èŠ‚è¾“å‡ºæµä½œä¸€ä¸ªåŒ…è£… åŒ…è£…æˆä¸€ä¸ªæ•°æ®è¾“å‡ºæµ</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token class-name\">DataOutputStream</span> dos <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataOutputStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token comment\">// å…ˆå‘é€ä¸Šä¼ æ–‡ä»¶çš„åç¼€ç»™æœåŠ¡ç«¯ ï¼ˆå…ˆè®©æœåŠ¡ç«¯çŸ¥é“è‡ªå·±æ¥æ”¶çš„æ˜¯ä»€ä¹ˆç±»å‹çš„æ–‡ä»¶ï¼‰</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token comment\">// å‘é€ utf-8 ç¼–ç çš„å­—ç¬¦ä¸²åˆ°æœåŠ¡ç«¯ä¸­</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            dos<span class=\"token punctuation\">.</span><span class=\"token function\">writeUTF</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".png\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token comment\">// æŠŠæ–‡ä»¶æ•°æ®å‘é€ç»™æœåŠ¡ç«¯è¿›è¡Œæ¥æ”¶</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token class-name\">FileInputStream</span> is <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"C:\\\\Users\\\\Administrator\\\\Desktop\\\\Minecraft.png\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bytes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">1024</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> is<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                dos<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            dos<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            socket<span class=\"token punctuation\">.</span><span class=\"token function\">shutdownOutput</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240304212555193.png\" alt=\"image-20240304212555193\" /></p>\n<p>æˆ‘ä»¬å†æŸ¥çœ‹ä¸‹è½½å¥½çš„æ–‡ä»¶</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240304212626337.png\" alt=\"image-20240304212626337\" /></p>\n<h3 id=\"å°ç»“-4\"><a class=\"anchor\" href=\"#å°ç»“-4\">#</a> å°ç»“</h3>\n<ul>\n<li>å®¢æˆ·ç«¯å‘é€æ–‡ä»¶æ•°æ®åˆ°æœåŠ¡ç«¯æ­¤æ—¶å®¢æˆ·ç«¯ä½¿ç”¨ while å‘é€ç»™æœåŠ¡ç«¯æ•°æ®ä»è€ŒæœåŠ¡ç«¯ä¸èƒ½ä½¿ç”¨ if æ¥è§£å†³æŠ¥é”™é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®¢æˆ·ç«¯å‘é€å®Œæ–‡ä»¶æ•°æ®åé€šè¿‡ Socket è°ƒç”¨ shutdownOutput () æ¥å‘Šè¯‰æœåŠ¡ç«¯è¿™æ¬¡çš„å›è¯ç»“æŸäº†ï¼ŒæœåŠ¡ç«¯å°±ä¸ä¼šæŠ¥é”™äº†</li>\n<li>å®¢æˆ·ç«¯å‘é€æ–‡ä»¶ä½¿ç”¨çš„æ˜¯æ•°æ®è¾“å‡ºæµé‚£ä¹ˆæˆ‘ä»¬åœ¨æœåŠ¡ç«¯æ¥æ”¶æ–‡ä»¶æ•°æ®çš„æ—¶å€™å°±éœ€è¦ä½¿ç”¨æ•°æ®è¾“å…¥æµæ¥æ¥æ”¶ (ä»€ä¹ˆæµå¯¹åº”ä»€ä¹ˆæµ)</li>\n</ul>\n<h2 id=\"19-java-bio-æ¨¡å¼ä¸‹çš„ç«¯å£è½¬å‘æ€æƒ³\"><a class=\"anchor\" href=\"#19-java-bio-æ¨¡å¼ä¸‹çš„ç«¯å£è½¬å‘æ€æƒ³\">#</a> 1.9 Java BIO æ¨¡å¼ä¸‹çš„ç«¯å£è½¬å‘æ€æƒ³</h2>\n<p><strong>éœ€æ±‚</strong>ï¼šéœ€è¦å®ç°ä¸€ä¸ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯å¯ä»¥å‘é€ç»™æ‰€æœ‰çš„å®¢æˆ·ç«¯å»æ¥æ”¶ã€‚(ç¾¤èŠå®ç°)</p>\n<p>æˆ‘ä»¬è¦å®ç°ä¸Šé¢éœ€æ±‚ ä¹Ÿä¸èƒ½çœç•¥ä¸è®¿é—®æœåŠ¡ç«¯çš„ï¼Œä»¥ QQ ä¸ºä¾‹ï¼Œä»–å…¶å®å°±æ˜¯æŠŠæ¶ˆæ¯æ¨é€åˆ° QQ çš„æœåŠ¡å™¨ç„¶ååœ¨è½¬å‘åˆ°å…¶ä»–çš„å®¢æˆ·ç«¯ (è‡ªå·±ä¹Ÿæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯)ï¼Œæˆ‘ä»¬æŠŠè¿™ç§ç§°ä¹‹ä¸ºç«¯å£è½¬å‘çš„æ€æƒ³</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240304213533355.png\" alt=\"image-20240304213533355\" /></p>\n<p>å®¢æˆ·ç«¯çš„çº¿ç¨‹ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ClientReaderThread</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Thread</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Socket</span> socket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ClientReaderThread</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Socket</span> socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>socket <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">BufferedReader</span> br <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>msg <span class=\"token operator\">=</span> br<span class=\"token punctuation\">.</span><span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> ç›®æ ‡ï¼šå®ç°å®¢æˆ·ç«¯çš„å¼€å‘</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> åŸºæœ¬æ€è·¯ï¼š</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> 1ã€å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ç»™æœåŠ¡ç«¯</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> 2ã€å®¢æˆ·ç«¯å¯èƒ½è¿˜éœ€è¦æ¥æ”¶æœåŠ¡ç«¯å‘é€è¿‡æ¥çš„æ¶ˆæ¯</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token class-name\">InetAddress</span> localHost <span class=\"token operator\">=</span> <span class=\"token class-name\">InetAddress</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLocalHost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token comment\">// 1ã€åˆ›å»ºäºæœåŠ¡ç«¯çš„ Socket é“¾æ¥</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span>localHost<span class=\"token punctuation\">.</span><span class=\"token function\">getHostAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token comment\">// 4ã€åˆ†é…ä¸€ä¸ªçº¿ç¨‹ä¸ºå®¢æˆ·ç«¯ socket æœåŠ¡æ¥æ”¶æœåŠ¡ç«¯å‘æ¥çš„æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">new</span> <span class=\"token class-name\">ClientReaderThread</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token comment\">// 2ã€ä»å½“å‰ socket ç®¡é“ä¸­å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å‡ºæµå¯¹åº”çš„æ‰“å°æµ</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token class-name\">PrintStream</span> ps <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PrintStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token comment\">// 3ã€æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„æ¶ˆæ¯å‘é€å‡ºå»</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token class-name\">Scanner</span> sc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token class-name\">String</span> msg <span class=\"token operator\">=</span> sc<span class=\"token punctuation\">.</span><span class=\"token function\">nextLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                ps<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ³¢å¦ï¼š\"</span><span class=\"token operator\">+</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                ps<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æœåŠ¡ç«¯çš„çº¿ç¨‹ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ServerReaderThread</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Thread</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Socket</span> socket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ServerReaderThread</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Socket</span> socket<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>socket <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// ä» socket ä¸­å»è·å–å½“å‰å®¢æˆ·ç«¯çš„è¾“å…¥æµ</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token class-name\">BufferedReader</span> br <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>msg <span class=\"token operator\">=</span> br<span class=\"token punctuation\">.</span><span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token comment\">// æœåŠ¡ç«¯æ¥æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„æ¶ˆæ¯ä¹‹åï¼Œæ˜¯éœ€è¦æ¨é€ç»™å½“å‰æ‰€æœ‰çš„åœ¨çº¿ socket</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token function\">sendMsgToAllClient</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token comment\">// å¦‚æœæœ‰ Socket ä¸‹çº¿äº†é‚£ä¹ˆæœåŠ¡ç«¯çš„ br.readLine å¤„å°±ä¼šæŠ›å‡ºå¼‚å¸¸æ­¤æ—¶æˆ‘ä»¬åœ¨ catch ä¸­æ¥è¿›è¡Œå¤„ç†ä¸‹çº¿çš„ Socket</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getLocalAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" ä¸‹çº¿äº†ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token comment\">// ä»åœ¨çº¿ Socket é›†åˆä¸­ç§»é™¤ ä¸‹çº¿çš„ Socket</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token class-name\">Server</span><span class=\"token punctuation\">.</span>allSocketOneLine<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>     * æŠŠå½“å‰å®¢æˆ·ç«¯å‘æ¥çš„æ¶ˆæ¯æ¨é€ç»™å…¨éƒ¨åœ¨çº¿çš„ Socket</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>     * @param msg</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendMsgToAllClient</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Socket</span> sk <span class=\"token operator\">:</span> <span class=\"token class-name\">Server</span><span class=\"token punctuation\">.</span>allSocketOneLine<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token class-name\">PrintStream</span> ps <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PrintStream</span><span class=\"token punctuation\">(</span>sk<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                ps<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                ps<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æœåŠ¡ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * ç›®æ ‡ï¼šBIO æ¨¡å¼ä¸‹çš„ç«¯å£è½¬å‘æ€æƒ³ - æœåŠ¡ç«¯å®ç°</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * æœåŠ¡ç«¯å®ç°çš„éœ€æ±‚ï¼š</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * 1ã€æ³¨å†Œç«¯å£</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * 2ã€æ¥æ”¶å®¢æˆ·ç«¯çš„ Socket è¿æ¥ï¼Œäº¤ç»™ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥å¤„ç†</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * 3ã€æŠŠå½“å‰è¿æ¥çš„å®¢æˆ·ç«¯ Socket å­˜å…¥ä¸€ä¸ªæ‰€è°“çš„åœ¨çº¿ Socket é›†åˆä¸­ä¿å­˜</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * 4ã€æ¥æ”¶å®¢æˆ·ç«¯çš„æ¶ˆæ¯ï¼Œç„¶åæ¨é€ç»™å½“å‰æ‰€æœ‰åœ¨çº¿çš„ Socket æ¥æ”¶</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Server</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// å®šä¹‰ä¸€ä¸ªé™æ€é›†åˆ (åœ¨æ•´ä¸ªç³»ç»Ÿä¸­åŠ è½½è¿‡ç¨‹ä¸­åªæœ‰ä¸€ä»½ï¼Œå­˜å‚¨åœ¨çº¿ Socket å®¹å™¨å°±éœ€è¦ä¸€ä¸ªé›†åˆ)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Socket</span><span class=\"token punctuation\">></span></span> allSocketOneLine <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Server Start!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token class-name\">ServerSocket</span> serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token comment\">// æŠŠç™»å½•çš„å®¢æˆ·ç«¯ Socket å­˜å…¥åˆ°ä¸€ä¸ªåœ¨çº¿é›†åˆä¸­å»</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                allSocketOneLine<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token comment\">// ä¸ºå½“å‰ç™»å½•æˆåŠŸçš„ Socket åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥å¤„ç†ä¸ä¹‹é€šä¿¡</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerReaderThread</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°æ•ˆæœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/recording.gif\" alt=\"recording\" /></p>\n<h2 id=\"110-åŸºäºbioæ¨¡å¼ä¸‹å³æ—¶é€šä¿¡\"><a class=\"anchor\" href=\"#110-åŸºäºbioæ¨¡å¼ä¸‹å³æ—¶é€šä¿¡\">#</a> 1.10 åŸºäº BIO æ¨¡å¼ä¸‹å³æ—¶é€šä¿¡</h2>\n<p>åŸºäº BIO æ¨¡å¼ä¸‹çš„å³æ—¶é€šä¿¡ï¼Œæˆ‘ä»¬éœ€è¦è§£å†³å®¢æˆ·ç«¯åˆ°å®¢æˆ·ç«¯çš„é€šä¿¡ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å®ç°å®¢æˆ·ç«¯ä¸å®¢æˆ·ç«¯ç«¯å£æ¶ˆæ¯è½¬å‘é€»è¾‘ã€‚</p>\n<h3 id=\"é¡¹ç›®æ¡ˆä¾‹è¯´æ˜\"><a class=\"anchor\" href=\"#é¡¹ç›®æ¡ˆä¾‹è¯´æ˜\">#</a> é¡¹ç›®æ¡ˆä¾‹è¯´æ˜</h3>\n<p>æœ¬é¡¹ç›®æ¡ˆä¾‹ä¸ºå³æ—¶é€šä¿¡çš„è½¯ä»¶é¡¹ç›®ï¼Œé€‚åˆåŸºç¡€åŠ å¼ºçš„å¤§æ¡ˆä¾‹ï¼Œå…·å¤‡ç»¼åˆæ€§å­¦ä¹ æœ¬é¡¹ç›®æ¡ˆä¾‹è‡³å°‘éœ€è¦å…·å¤‡å¦‚ä¸‹ JavaSE æŠ€æœ¯ç‚¹ï¼š</p>\n<ul>\n<li>1 Java é¢å‘å¯¹è±¡è®¾è®¡ï¼Œè¯­æ³•è®¾è®¡</li>\n<li>2 å¤šçº¿ç¨‹æŠ€æœ¯</li>\n<li>3 IO æµæŠ€æœ¯</li>\n<li>4 ç½‘ç»œé€šä¿¡ç›¸å…³æŠ€æœ¯</li>\n<li>5 é›†åˆæ¡†æ¶</li>\n<li>6 é¡¹ç›®å¼€å‘æ€ç»´</li>\n<li>7 Java å¸¸ç”¨ api ä½¿ç”¨</li>\n</ul>\n<p><strong>åŠŸèƒ½æ¸…å•ç®€å•è¯´æ˜</strong>ï¼š</p>\n<ol>\n<li>\n<p>å®¢æˆ·ç«¯ç™»å½•åŠŸèƒ½</p>\n<p>å¯ä»¥å¯åŠ¨å®¢æˆ·ç«¯è¿›è¡Œç™»å½•ï¼Œå®¢æˆ·ç«¯ç™»å½•åªéœ€è¦è¾“å…¥ç”¨æˆ·åå’ŒæœåŠ¡ç«¯ ip åœ°å€å³å¯</p>\n</li>\n<li>\n<p>åœ¨çº¿äººæ•°å®æ—¶æ›´æ–°</p>\n<p>å®¢æˆ·ç«¯ç”¨æˆ·ç™»å½•ä»¥åï¼Œéœ€è¦åŒæ­¥æ›´æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„è”ç³»äººä¿¡æ¯æ </p>\n</li>\n<li>\n<p>ç¦»çº¿äººæ•°æ›´æ–°</p>\n<p>æ£€æµ‹åˆ°æœ‰å®¢æˆ·ç«¯ä¸‹çº¿åï¼Œéœ€è¦åŒæ­¥æ›´æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„è”ç³»äººä¿¡æ¯æ </p>\n</li>\n<li>\n<p>ç¾¤èŠ</p>\n<p>ä»»æ„ä¸€ä¸ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯ï¼Œå¯ä»¥æ¨é€ç»™å½“å‰æ‰€æœ‰å®¢æˆ·ç«¯æ¥æ”¶</p>\n</li>\n<li>\n<p>ç§èŠ</p>\n<p>å¯ä»¥é€‰æ‹©æŸä¸ªå‘˜å·¥ï¼Œç‚¹å‡»ç§èŠæŒ‰é’®ï¼Œç„¶åå‘å‡ºçš„æ¶ˆæ¯å¯ä»¥è¢«è¯¥å®¢æˆ·ç«¯å•ç‹¬æ¥æ”¶</p>\n</li>\n<li>\n<p>@æ¶ˆæ¯</p>\n<p>å¯ä»¥é€‰æ‹©æŸä¸ªå‘˜å·¥ï¼Œç„¶åå‘å‡ºçš„æ¶ˆæ¯å¯ä»¥ @è¯¥ç”¨æˆ·ï¼Œä½†æ˜¯å…¶ä»–æ‰€æœ‰äººéƒ½èƒ½çœ‹åˆ°</p>\n</li>\n<li>\n<p>æ¶ˆæ¯ç”¨æˆ·å’Œæ¶ˆæ¯æ—¶é—´ç‚¹</p>\n<p>æœåŠ¡ç«¯å¯ä»¥å®æ—¶è®°å½•è¯¥ç”¨æˆ·çš„æ¶ˆæ¯æ—¶é—´ç‚¹ï¼Œç„¶åè¿›è¡Œæ¶ˆæ¯çš„å¤šè·¯è½¬å‘æˆ–è€…é€‰æ‹©</p>\n</li>\n</ol>\n<h4 id=\"æœåŠ¡ç«¯\"><a class=\"anchor\" href=\"#æœåŠ¡ç«¯\">#</a> æœåŠ¡ç«¯</h4>\n<p>çº¿ç¨‹ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ServerReader</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Thread</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">Socket</span> socket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">ServerReader</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Socket</span> socket<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>socket <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t<span class=\"token class-name\">DataInputStream</span> dis <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\tdis <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataInputStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t<span class=\"token comment\">/** 1. å¾ªç¯ä¸€ç›´ç­‰å¾…å®¢æˆ·ç«¯çš„æ¶ˆæ¯ */</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t\t<span class=\"token comment\">/** 2. è¯»å–å½“å‰çš„æ¶ˆæ¯ç±»å‹ ï¼šç™»å½•ï¼Œç¾¤å‘ï¼Œç§èŠï¼Œ@æ¶ˆæ¯ */</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">int</span> flag <span class=\"token operator\">=</span> dis<span class=\"token punctuation\">.</span><span class=\"token function\">readInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>flag <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t\t\t<span class=\"token comment\">/** å…ˆå°†å½“å‰ç™»å½•çš„å®¢æˆ·ç«¯ socket å­˜åˆ°åœ¨çº¿äººæ•°çš„ socket é›†åˆä¸­   */</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t\t\t<span class=\"token class-name\">String</span> name <span class=\"token operator\">=</span> dis<span class=\"token punctuation\">.</span><span class=\"token function\">readUTF</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\t\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>name<span class=\"token operator\">+</span><span class=\"token string\">\"---->\"</span><span class=\"token operator\">+</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getRemoteSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\t\t\t<span class=\"token class-name\">ServerChat</span><span class=\"token punctuation\">.</span>onLineSockets<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t\t<span class=\"token function\">writeMsg</span><span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">,</span>dis<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"--æœ‰äººä¸‹çº¿äº†--\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\t<span class=\"token comment\">// ä»åœ¨çº¿äººæ•°ä¸­å°†å½“å‰ socket ç§»å‡ºå»  </span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t\t<span class=\"token class-name\">ServerChat</span><span class=\"token punctuation\">.</span>onLineSockets<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ä»æ–°æ›´æ–°åœ¨çº¿äººæ•°å¹¶å‘ç»™æ‰€æœ‰å®¢æˆ·ç«¯ </span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\t\t<span class=\"token function\">writeMsg</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>dis<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t\t\te1<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">writeMsg</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> flag<span class=\"token punctuation\">,</span> <span class=\"token class-name\">DataInputStream</span> dis<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token comment\">//\t\tDataOutputStream dos = new DataOutputStream(socket.getOutputStream()); </span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t<span class=\"token comment\">// å®šä¹‰ä¸€ä¸ªå˜é‡å­˜æ”¾æœ€ç»ˆçš„æ¶ˆæ¯å½¢å¼ </span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\t<span class=\"token class-name\">String</span> msg <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>flag <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\t\t<span class=\"token comment\">/** è¯»å–æ‰€æœ‰åœ¨çº¿äººæ•°å‘ç»™æ‰€æœ‰å®¢æˆ·ç«¯å»æ›´æ–°è‡ªå·±çš„åœ¨çº¿äººæ•°åˆ—è¡¨ */</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t\t\t<span class=\"token class-name\">StringBuilder</span> rs <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\t\t<span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> onlineNames <span class=\"token operator\">=</span> <span class=\"token class-name\">ServerChat</span><span class=\"token punctuation\">.</span>onLineSockets<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\t\t<span class=\"token comment\">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨åœ¨çº¿äººæ•° </span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>onlineNames <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> onlineNames<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name <span class=\"token operator\">:</span> onlineNames<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t\t\t\t\trs<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>name<span class=\"token operator\">+</span> <span class=\"token class-name\">Constants</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SPILIT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// å»æ‰æœ€åçš„ä¸€ä¸ªåˆ†éš”ç¬¦</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t\t\t\tmsg <span class=\"token operator\">=</span> rs<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> rs<span class=\"token punctuation\">.</span><span class=\"token function\">lastIndexOf</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constants</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SPILIT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\t\t\t\t<span class=\"token comment\">/** å°†æ¶ˆæ¯å‘é€ç»™æ‰€æœ‰çš„å®¢æˆ·ç«¯ */</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>\t\t\t\t<span class=\"token function\">sendMsgToAll</span><span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">,</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>flag <span class=\"token operator\">==</span> <span class=\"token number\">2</span> <span class=\"token operator\">||</span> flag <span class=\"token operator\">==</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\t\t\t<span class=\"token comment\">// è¯»åˆ°æ¶ˆæ¯  ç¾¤å‘çš„ æˆ–è€… @æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\t\t\t<span class=\"token class-name\">String</span> newMsg <span class=\"token operator\">=</span> dis<span class=\"token punctuation\">.</span><span class=\"token function\">readUTF</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span> <span class=\"token comment\">// æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>\t\t\t<span class=\"token comment\">// å¾—åˆ°å‘ä»¶äºº </span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>\t\t\t<span class=\"token class-name\">String</span> sendName <span class=\"token operator\">=</span> <span class=\"token class-name\">ServerChat</span><span class=\"token punctuation\">.</span>onLineSockets<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>\t\t\t<span class=\"token comment\">//    å†…å®¹ --</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>\t\t\t<span class=\"token class-name\">StringBuilder</span> msgFinal <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>\t\t\t<span class=\"token comment\">// æ—¶é—´  </span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>\t\t\t<span class=\"token class-name\">SimpleDateFormat</span> sdf <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleDateFormat</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"yyyy-MM-dd HH:mm:ss EEE\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>flag <span class=\"token operator\">==</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>\t\t\t\tmsgFinal<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>sendName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"  \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>sdf<span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>\t\t\t\tmsgFinal<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"    \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>newMsg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>\t\t\t\t<span class=\"token function\">sendMsgToAll</span><span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">,</span>msgFinal<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>flag <span class=\"token operator\">==</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>\t\t\t\tmsgFinal<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>sendName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"  \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>sdf<span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å¯¹æ‚¨ç§å‘\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>\t\t\t\tmsgFinal<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"    \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>newMsg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç§å‘ </span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// å¾—åˆ°ç»™è°ç§å‘ </span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>\t\t\t\t<span class=\"token class-name\">String</span> destName <span class=\"token operator\">=</span> dis<span class=\"token punctuation\">.</span><span class=\"token function\">readUTF</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>\t\t\t\t<span class=\"token function\">sendMsgToOne</span><span class=\"token punctuation\">(</span>destName<span class=\"token punctuation\">,</span>msgFinal<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>\t<span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"83\"></td><td><pre>\t * @param destName å¯¹è°ç§å‘ </pre></td></tr><tr><td data-num=\"84\"></td><td><pre>\t * @param msg å‘çš„æ¶ˆæ¯å†…å®¹ </pre></td></tr><tr><td data-num=\"85\"></td><td><pre>\t * @throws Exception</pre></td></tr><tr><td data-num=\"86\"></td><td><pre>\t */</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendMsgToOne</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> destName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>\t\t<span class=\"token comment\">// æ‹¿åˆ°æ‰€æœ‰çš„åœ¨çº¿ socket ç®¡é“ ç»™è¿™äº›ç®¡é“å†™å‡ºæ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>\t\t<span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Socket</span><span class=\"token punctuation\">></span></span> allOnLineSockets <span class=\"token operator\">=</span> <span class=\"token class-name\">ServerChat</span><span class=\"token punctuation\">.</span>onLineSockets<span class=\"token punctuation\">.</span><span class=\"token function\">keySet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>\t\t<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Socket</span> sk <span class=\"token operator\">:</span>  allOnLineSockets<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>\t\t\t<span class=\"token comment\">// å¾—åˆ°å½“å‰éœ€è¦ç§å‘çš„ socket </span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>\t\t\t<span class=\"token comment\">// åªå¯¹è¿™ä¸ªåå­—å¯¹åº”çš„ socket ç§å‘æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ServerChat</span><span class=\"token punctuation\">.</span>onLineSockets<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>sk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>destName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>\t\t\t\t<span class=\"token class-name\">DataOutputStream</span> dos <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataOutputStream</span><span class=\"token punctuation\">(</span>sk<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>\t\t\t\tdos<span class=\"token punctuation\">.</span><span class=\"token function\">writeInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æ¶ˆæ¯ç±»å‹</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>\t\t\t\tdos<span class=\"token punctuation\">.</span><span class=\"token function\">writeUTF</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>\t\t\t\tdos<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendMsgToAll</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> flag<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>\t\t<span class=\"token comment\">// æ‹¿åˆ°æ‰€æœ‰çš„åœ¨çº¿ socket ç®¡é“ ç»™è¿™äº›ç®¡é“å†™å‡ºæ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>\t\t<span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Socket</span><span class=\"token punctuation\">></span></span> allOnLineSockets <span class=\"token operator\">=</span> <span class=\"token class-name\">ServerChat</span><span class=\"token punctuation\">.</span>onLineSockets<span class=\"token punctuation\">.</span><span class=\"token function\">keySet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>\t\t<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Socket</span> sk <span class=\"token operator\">:</span>  allOnLineSockets<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>\t\t\t<span class=\"token class-name\">DataOutputStream</span> dos <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataOutputStream</span><span class=\"token punctuation\">(</span>sk<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>\t\t\tdos<span class=\"token punctuation\">.</span><span class=\"token function\">writeInt</span><span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æ¶ˆæ¯ç±»å‹</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>\t\t\tdos<span class=\"token punctuation\">.</span><span class=\"token function\">writeUTF</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>\t\t\tdos<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æœåŠ¡ç«¯ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ServerChat</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t * å®šä¹‰ä¸€ä¸ªé›†åˆå­˜æ”¾æ‰€æœ‰åœ¨çº¿çš„ socket</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t * åœ¨çº¿é›†åˆåªéœ€è¦ä¸€ä¸ªï¼šå­˜å‚¨å®¢æˆ·ç«¯ socket çš„åŒæ—¶è¿˜éœ€è¦çŸ¥é“è¿™ä¸ª Socket å®¢æˆ·ç«¯çš„åç§°</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Socket</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> onLineSockets <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t<span class=\"token comment\">/** æ³¨å†Œç«¯å£   */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t<span class=\"token class-name\">ServerSocket</span> serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constants</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t<span class=\"token comment\">/** å¾ªç¯ä¸€ç›´ç­‰å¾…æ‰€æœ‰å¯èƒ½çš„å®¢æˆ·ç«¯è¿æ¥ */</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t\t<span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t\t<span class=\"token comment\">/** æŠŠå®¢æˆ·ç«¯çš„ socket ç®¡é“å•ç‹¬é…ç½®ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç† */</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerReader</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\te<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"å®¢æˆ·ç«¯\"><a class=\"anchor\" href=\"#å®¢æˆ·ç«¯\">#</a> å®¢æˆ·ç«¯</h4>\n<p>çº¿ç¨‹ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">ClientReader</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Thread</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">Socket</span> socket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">ClientChat</span> clientChat <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">ClientReader</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ClientChat</span> clientChat<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Socket</span> socket<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clientChat <span class=\"token operator\">=</span> clientChat<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>socket <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t<span class=\"token class-name\">DataInputStream</span> dis <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataInputStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t<span class=\"token comment\">/** å¾ªç¯ä¸€ç›´ç­‰å¾…å®¢æˆ·ç«¯çš„æ¶ˆæ¯ */</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t\t<span class=\"token comment\">/** è¯»å–å½“å‰çš„æ¶ˆæ¯ç±»å‹ ï¼šç™»å½•ï¼Œç¾¤å‘ï¼Œç§èŠï¼Œ@æ¶ˆæ¯ */</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">int</span> flag <span class=\"token operator\">=</span> dis<span class=\"token punctuation\">.</span><span class=\"token function\">readInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>flag <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\t\t\t<span class=\"token comment\">// åœ¨çº¿äººæ•°æ¶ˆæ¯å›æ¥äº†</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\t\t\t<span class=\"token class-name\">String</span> nameDatas <span class=\"token operator\">=</span> dis<span class=\"token punctuation\">.</span><span class=\"token function\">readUTF</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t\t\t<span class=\"token comment\">// å±•ç¤ºåˆ°åœ¨çº¿äººæ•°çš„ç•Œé¢</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t\t\t<span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> names <span class=\"token operator\">=</span> nameDatas<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constants</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SPILIT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t\t\tclientChat<span class=\"token punctuation\">.</span>onLineUsers<span class=\"token punctuation\">.</span><span class=\"token function\">setListData</span><span class=\"token punctuation\">(</span>names<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>flag <span class=\"token operator\">==</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t\t\t\t<span class=\"token comment\">// ç¾¤å‘ï¼Œç§èŠï¼Œ@æ¶ˆæ¯ éƒ½æ˜¯ç›´æ¥æ˜¾ç¤ºçš„ã€‚</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\t\t\t<span class=\"token class-name\">String</span> msg <span class=\"token operator\">=</span> dis<span class=\"token punctuation\">.</span><span class=\"token function\">readUTF</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t\t\t\tclientChat<span class=\"token punctuation\">.</span>smsContent<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\t\t\t<span class=\"token comment\">// è®©æ¶ˆæ¯ç•Œé¢æ»¾å‹•åˆ°åº•ç«¯</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t\t\tclientChat<span class=\"token punctuation\">.</span>smsContent<span class=\"token punctuation\">.</span><span class=\"token function\">setCaretPosition</span><span class=\"token punctuation\">(</span>clientChat<span class=\"token punctuation\">.</span>smsContent<span class=\"token punctuation\">.</span><span class=\"token function\">getText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t\te<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * å®¢æˆ·ç«¯ç•Œé¢</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ClientChat</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ActionListener</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token comment\">/** 1. è®¾è®¡ç•Œé¢  */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">JFrame</span> win <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JFrame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token comment\">/** 2. æ¶ˆæ¯å†…å®¹æ¡†æ¶ */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">JTextArea</span> smsContent <span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">JTextArea</span><span class=\"token punctuation\">(</span><span class=\"token number\">23</span> <span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token comment\">/** 3. å‘é€æ¶ˆæ¯çš„æ¡†  */</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">JTextArea</span> smsSend <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JTextArea</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">40</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token comment\">/** 4. åœ¨çº¿äººæ•°çš„åŒºåŸŸ  */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token comment\">/** å­˜æ”¾äººçš„æ•°æ® */</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token comment\">/** å±•ç¤ºåœ¨çº¿äººæ•°çš„çª—å£ */</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">JList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> onLineUsers <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t<span class=\"token comment\">// æ˜¯å¦ç§èŠæŒ‰é’®</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">JCheckBox</span> isPrivateBn <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JCheckBox</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç§èŠ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t<span class=\"token comment\">// æ¶ˆæ¯æŒ‰é’®</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">JButton</span> sendBn  <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JButton</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å‘é€\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token comment\">// ç™»å½•ç•Œé¢</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">JFrame</span> loginView<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">JTextField</span> ipEt <span class=\"token punctuation\">,</span> nameEt <span class=\"token punctuation\">,</span> idEt<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">Socket</span> socket <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t<span class=\"token keyword\">new</span> <span class=\"token class-name\">ClientChat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">initView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t<span class=\"token comment\">/** åˆå§‹åŒ–èŠå¤©çª—å£çš„ç•Œé¢ */</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\twin<span class=\"token punctuation\">.</span><span class=\"token function\">setSize</span><span class=\"token punctuation\">(</span><span class=\"token number\">650</span><span class=\"token punctuation\">,</span> <span class=\"token number\">600</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t<span class=\"token comment\">/** å±•ç¤ºç™»å½•ç•Œé¢  */</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t<span class=\"token function\">displayLoginView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t<span class=\"token comment\">/** å±•ç¤ºèŠå¤©ç•Œé¢ */</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t<span class=\"token comment\">//displayChatView();</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">displayChatView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\t<span class=\"token class-name\">JPanel</span> bottomPanel <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JPanel</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BorderLayout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\t<span class=\"token comment\">//-----------------------------------------------</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t\t<span class=\"token comment\">// å°†æ¶ˆæ¯æ¡†å’ŒæŒ‰é’® æ·»åŠ åˆ°çª—å£çš„åº•ç«¯</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\twin<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>bottomPanel<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BorderLayout</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SOUTH</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\tbottomPanel<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>smsSend<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\t<span class=\"token class-name\">JPanel</span> btns <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JPanel</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FlowLayout</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FlowLayout</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LEFT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\tbtns<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>sendBn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t\tbtns<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>isPrivateBn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t\tbottomPanel<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>btns<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BorderLayout</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EAST</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t\t<span class=\"token comment\">//-----------------------------------------------</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t\t<span class=\"token comment\">// ç»™å‘é€æ¶ˆæ¯æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t\t<span class=\"token comment\">// å°†å±•ç¤ºæ¶ˆæ¯åŒº centerPanel æ·»åŠ åˆ°çª—å£çš„ä¸­é—´</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\t\tsmsContent<span class=\"token punctuation\">.</span><span class=\"token function\">setBackground</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xdd</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xdd</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xdd</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>\t\t<span class=\"token comment\">// è®©å±•ç¤ºæ¶ˆæ¯åŒºå¯ä»¥æ»šåŠ¨ã€‚</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\t\twin<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">JScrollPane</span><span class=\"token punctuation\">(</span>smsContent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">BorderLayout</span><span class=\"token punctuation\">.</span><span class=\"token constant\">CENTER</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\t\tsmsContent<span class=\"token punctuation\">.</span><span class=\"token function\">setEditable</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\t\t<span class=\"token comment\">//-----------------------------------------------</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\t\t<span class=\"token comment\">// ç”¨æˆ·åˆ—è¡¨å’Œæ˜¯å¦ç§èŠæ”¾åˆ°çª—å£çš„æœ€å³è¾¹</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>\t\t<span class=\"token class-name\">Box</span> rightBox <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Box</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BoxLayout</span><span class=\"token punctuation\">.</span><span class=\"token constant\">Y_AXIS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>\t\tonLineUsers<span class=\"token punctuation\">.</span><span class=\"token function\">setFixedCellWidth</span><span class=\"token punctuation\">(</span><span class=\"token number\">120</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>\t\tonLineUsers<span class=\"token punctuation\">.</span><span class=\"token function\">setVisibleRowCount</span><span class=\"token punctuation\">(</span><span class=\"token number\">13</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>\t\trightBox<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">JScrollPane</span><span class=\"token punctuation\">(</span>onLineUsers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>\t\twin<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>rightBox<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BorderLayout</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EAST</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>\t\t<span class=\"token comment\">//-----------------------------------------------</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>\t\t<span class=\"token comment\">// å…³é—­çª—å£é€€å‡ºå½“å‰ç¨‹åº</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>\t\twin<span class=\"token punctuation\">.</span><span class=\"token function\">setDefaultCloseOperation</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JFrame</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EXIT_ON_CLOSE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>\t\twin<span class=\"token punctuation\">.</span><span class=\"token function\">pack</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//swing åŠ ä¸Šè¿™å¥ å°±å¯ä»¥æ‹¥æœ‰å…³é—­çª—å£çš„åŠŸèƒ½</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>\t\t<span class=\"token comment\">/** è®¾ç½®çª—å£å±…ä¸­ï¼Œæ˜¾ç¤ºå‡ºæ¥  */</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>\t\t<span class=\"token function\">setWindowCenter</span><span class=\"token punctuation\">(</span>win<span class=\"token punctuation\">,</span><span class=\"token number\">650</span><span class=\"token punctuation\">,</span><span class=\"token number\">600</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>\t\t<span class=\"token comment\">// å‘é€æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>\t\tsendBn<span class=\"token punctuation\">.</span><span class=\"token function\">addActionListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">displayLoginView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>\t\t<span class=\"token comment\">/** å…ˆè®©ç”¨æˆ·è¿›è¡Œç™»å½•</pre></td></tr><tr><td data-num=\"78\"></td><td><pre>\t\t *  æœåŠ¡ç«¯ ip</pre></td></tr><tr><td data-num=\"79\"></td><td><pre>\t\t *  ç”¨æˆ·å</pre></td></tr><tr><td data-num=\"80\"></td><td><pre>\t\t *  id</pre></td></tr><tr><td data-num=\"81\"></td><td><pre>\t\t *  */</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>\t\t<span class=\"token comment\">/** æ˜¾ç¤ºä¸€ä¸ª qq çš„ç™»å½•æ¡†     */</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>\t\tloginView <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JFrame</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç™»å½•\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>\t\tloginView<span class=\"token punctuation\">.</span><span class=\"token function\">setLayout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">GridLayout</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>\t\tloginView<span class=\"token punctuation\">.</span><span class=\"token function\">setSize</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">,</span> <span class=\"token number\">230</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>\t\t<span class=\"token class-name\">JPanel</span> ip <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JPanel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>\t\t<span class=\"token class-name\">JLabel</span> label <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JLabel</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"   IP:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>\t\tip<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>label<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>\t\tipEt <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JTextField</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>\t\tip<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>ipEt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>\t\tloginView<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>\t\t<span class=\"token class-name\">JPanel</span> name <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JPanel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>\t\t<span class=\"token class-name\">JLabel</span> label1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JLabel</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å§“å:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>\t\tname<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>label1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>\t\tnameEt <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JTextField</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>\t\tname<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>nameEt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>\t\tloginView<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>\t\t<span class=\"token class-name\">JPanel</span> btnView <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JPanel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>\t\t<span class=\"token class-name\">JButton</span> login <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JButton</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç™»é™†\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>\t\tbtnView<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>login<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>\t\t<span class=\"token class-name\">JButton</span> cancle <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JButton</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å–æ¶ˆ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>\t\tbtnView<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>cancle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>\t\tloginView<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>btnView<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>\t\t<span class=\"token comment\">// å…³é—­çª—å£é€€å‡ºå½“å‰ç¨‹åº</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>\t\tloginView<span class=\"token punctuation\">.</span><span class=\"token function\">setDefaultCloseOperation</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JFrame</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EXIT_ON_CLOSE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>\t\t<span class=\"token function\">setWindowCenter</span><span class=\"token punctuation\">(</span>loginView<span class=\"token punctuation\">,</span><span class=\"token number\">400</span><span class=\"token punctuation\">,</span><span class=\"token number\">260</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>\t\t<span class=\"token comment\">/** ç»™ç™»å½•å’Œå–æ¶ˆç»‘å®šç‚¹å‡»äº‹ä»¶ */</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>\t\tlogin<span class=\"token punctuation\">.</span><span class=\"token function\">addActionListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>\t\tcancle<span class=\"token punctuation\">.</span><span class=\"token function\">addActionListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setWindowCenter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JFrame</span> frame<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> width <span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> height<span class=\"token punctuation\">,</span> <span class=\"token keyword\">boolean</span> flag<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>\t\t<span class=\"token comment\">/** å¾—åˆ°æ‰€åœ¨ç³»ç»Ÿæ‰€åœ¨å±å¹•çš„å®½é«˜ */</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>\t\t<span class=\"token class-name\">Dimension</span> ds <span class=\"token operator\">=</span> frame<span class=\"token punctuation\">.</span><span class=\"token function\">getToolkit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getScreenSize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>\t\t<span class=\"token comment\">/** æ‹¿åˆ°ç”µè„‘çš„å®½ */</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>\t\t<span class=\"token keyword\">int</span> width1 <span class=\"token operator\">=</span> ds<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>\t\t<span class=\"token comment\">/** é«˜ */</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>\t\t<span class=\"token keyword\">int</span> height1 <span class=\"token operator\">=</span> ds<span class=\"token punctuation\">.</span>height <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>width1 <span class=\"token operator\">+</span><span class=\"token string\">\"*\"</span> <span class=\"token operator\">+</span> height1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>\t\t<span class=\"token comment\">/** è®¾ç½®çª—å£çš„å·¦ä¸Šè§’åæ ‡ */</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>\t\tframe<span class=\"token punctuation\">.</span><span class=\"token function\">setLocation</span><span class=\"token punctuation\">(</span>width1<span class=\"token operator\">/</span><span class=\"token number\">2</span> <span class=\"token operator\">-</span> width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> height1<span class=\"token operator\">/</span><span class=\"token number\">2</span> <span class=\"token operator\">-</span>height<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>\t\tframe<span class=\"token punctuation\">.</span><span class=\"token function\">setVisible</span><span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">actionPerformed</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ActionEvent</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>\t\t<span class=\"token comment\">/** å¾—åˆ°ç‚¹å‡»çš„äº‹ä»¶æº */</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>\t\t<span class=\"token class-name\">JButton</span> btn <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">JButton</span><span class=\"token punctuation\">)</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>\t\t<span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>btn<span class=\"token punctuation\">.</span><span class=\"token function\">getText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre>\t\t\t<span class=\"token keyword\">case</span> <span class=\"token string\">\"ç™»é™†\"</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>\t\t\t\t<span class=\"token class-name\">String</span> ip <span class=\"token operator\">=</span> ipEt<span class=\"token punctuation\">.</span><span class=\"token function\">getText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>\t\t\t\t<span class=\"token class-name\">String</span> name <span class=\"token operator\">=</span> nameEt<span class=\"token punctuation\">.</span><span class=\"token function\">getText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// æ ¡éªŒå‚æ•°æ˜¯å¦ä¸ºç©º</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// é”™è¯¯æç¤º</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>\t\t\t\t<span class=\"token class-name\">String</span> msg <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// 12.1.2.0</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// \\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>ip<span class=\"token operator\">==</span><span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>ip<span class=\"token punctuation\">.</span><span class=\"token function\">matches</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\\\\.\\\\d&#123;1,3&#125;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>\t\t\t\t\tmsg <span class=\"token operator\">=</span> <span class=\"token string\">\"è¯·è¾“å…¥åˆæ³•çš„æœåŠ¡ç«¯ipåœ°å€\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"143\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>name<span class=\"token operator\">==</span><span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">matches</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\\\S&#123;1,&#125;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre>\t\t\t\t\tmsg <span class=\"token operator\">=</span> <span class=\"token string\">\"å§“åå¿…é¡»1ä¸ªå­—ç¬¦ä»¥ä¸Š\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre></pre></td></tr><tr><td data-num=\"147\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>msg<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"148\"></td><td><pre>\t\t\t\t\t<span class=\"token comment\">/** msg æœ‰å†…å®¹è¯´æ˜å‚æ•°æœ‰ä¸ºç©º */</span></pre></td></tr><tr><td data-num=\"149\"></td><td><pre>\t\t\t\t\t<span class=\"token comment\">// å‚æ•°ä¸€ï¼šå¼¹å‡ºæ”¾åˆ°å“ªä¸ªçª—å£é‡Œé¢</span></pre></td></tr><tr><td data-num=\"150\"></td><td><pre>\t\t\t\t\t<span class=\"token class-name\">JOptionPane</span><span class=\"token punctuation\">.</span><span class=\"token function\">showMessageDialog</span><span class=\"token punctuation\">(</span>loginView<span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"152\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre>\t\t\t\t\t\t<span class=\"token comment\">// å‚æ•°éƒ½åˆæ³•äº†</span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre>\t\t\t\t\t\t<span class=\"token comment\">// å½“å‰ç™»å½•çš„ç”¨æˆ·ï¼Œå»æœåŠ¡ç«¯ç™»é™†</span></pre></td></tr><tr><td data-num=\"155\"></td><td><pre>\t\t\t\t\t\t<span class=\"token comment\">/** å…ˆæŠŠå½“å‰ç”¨æˆ·çš„åç§°å±•ç¤ºåˆ°ç•Œé¢ */</span></pre></td></tr><tr><td data-num=\"156\"></td><td><pre>\t\t\t\t\t\twin<span class=\"token punctuation\">.</span><span class=\"token function\">setTitle</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"157\"></td><td><pre>\t\t\t\t\t\t<span class=\"token comment\">// å»æœåŠ¡ç«¯ç™»é™†è¿æ¥ä¸€ä¸ª socket ç®¡é“</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre>\t\t\t\t\t\tsocket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constants</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"159\"></td><td><pre>\t\t\t\t\t\t<span class=\"token comment\">// ä¸ºå®¢æˆ·ç«¯çš„ socket åˆ†é…ä¸€ä¸ªçº¿ç¨‹ ä¸“é—¨è´Ÿè´£æ”¶æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"160\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">new</span> <span class=\"token class-name\">ClientReader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span>socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"161\"></td><td><pre>\t\t\t\t\t\t<span class=\"token comment\">// å¸¦ä¸Šç”¨æˆ·ä¿¡æ¯è¿‡å»</span></pre></td></tr><tr><td data-num=\"162\"></td><td><pre>\t\t\t\t\t\t<span class=\"token class-name\">DataOutputStream</span> dos <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataOutputStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"163\"></td><td><pre>\t\t\t\t\t\tdos<span class=\"token punctuation\">.</span><span class=\"token function\">writeInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ç™»å½•æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"164\"></td><td><pre>\t\t\t\t\t\tdos<span class=\"token punctuation\">.</span><span class=\"token function\">writeUTF</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"165\"></td><td><pre>\t\t\t\t\t\tdos<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"166\"></td><td><pre>\t\t\t\t\t\t<span class=\"token comment\">// å…³ç³»å½“å‰çª—å£ å¼¹å‡ºèŠå¤©ç•Œé¢</span></pre></td></tr><tr><td data-num=\"167\"></td><td><pre>\t\t\t\t\t\tloginView<span class=\"token punctuation\">.</span><span class=\"token function\">dispose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ç™»å½•çª—å£é”€æ¯</span></pre></td></tr><tr><td data-num=\"168\"></td><td><pre>\t\t\t\t\t\t<span class=\"token function\">displayChatView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// å±•ç¤ºäº†èŠå¤©çª—å£äº†</span></pre></td></tr><tr><td data-num=\"169\"></td><td><pre>\t\t\t\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"170\"></td><td><pre>\t\t\t\t\t\te1<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"171\"></td><td><pre>\t\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"172\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"173\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"174\"></td><td><pre>\t\t\t<span class=\"token keyword\">case</span> <span class=\"token string\">\"å–æ¶ˆ\"</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"175\"></td><td><pre>\t\t\t\t<span class=\"token comment\">/** é€€å‡ºç³»ç»Ÿ */</span></pre></td></tr><tr><td data-num=\"176\"></td><td><pre>\t\t\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"177\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"178\"></td><td><pre>\t\t\t<span class=\"token keyword\">case</span> <span class=\"token string\">\"å‘é€\"</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"179\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// å¾—åˆ°å‘é€æ¶ˆæ¯çš„å†…å®¹</span></pre></td></tr><tr><td data-num=\"180\"></td><td><pre>\t\t\t\t<span class=\"token class-name\">String</span> msgSend <span class=\"token operator\">=</span> smsSend<span class=\"token punctuation\">.</span><span class=\"token function\">getText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"181\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>msgSend<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"182\"></td><td><pre>\t\t\t\t\t<span class=\"token comment\">/** å‘æ¶ˆæ¯ç»™æœåŠ¡ç«¯ */</span></pre></td></tr><tr><td data-num=\"183\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"184\"></td><td><pre>\t\t\t\t\t\t<span class=\"token comment\">// åˆ¤æ–­æ˜¯å¦å¯¹è°å‘æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"185\"></td><td><pre>\t\t\t\t\t\t<span class=\"token class-name\">String</span> selectName <span class=\"token operator\">=</span> onLineUsers<span class=\"token punctuation\">.</span><span class=\"token function\">getSelectedValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"186\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">int</span> flag <span class=\"token operator\">=</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">;</span><span class=\"token comment\">// ç¾¤å‘ @æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"187\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>selectName<span class=\"token operator\">!=</span><span class=\"token keyword\">null</span><span class=\"token operator\">&amp;&amp;</span><span class=\"token operator\">!</span>selectName<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"188\"></td><td><pre>\t\t\t\t\t\t\tmsgSend <span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@\"</span><span class=\"token operator\">+</span>selectName<span class=\"token operator\">+</span><span class=\"token string\">\",\"</span><span class=\"token operator\">+</span>msgSend<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"189\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token comment\">/** åˆ¤æ–­æ˜¯å¦é€‰ä¸­äº†ç§æ³• */</span></pre></td></tr><tr><td data-num=\"190\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>isPrivateBn<span class=\"token punctuation\">.</span><span class=\"token function\">isSelected</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"191\"></td><td><pre>\t\t\t\t\t\t\t\t<span class=\"token comment\">/** ç§æ³• */</span></pre></td></tr><tr><td data-num=\"192\"></td><td><pre>\t\t\t\t\t\t\t\tflag <span class=\"token operator\">=</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">;</span><span class=\"token comment\">// ç§å‘æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"193\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"194\"></td><td><pre>\t\t\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"195\"></td><td><pre>\t\t\t\t\t\t<span class=\"token class-name\">DataOutputStream</span> dos <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataOutputStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"196\"></td><td><pre>\t\t\t\t\t\tdos<span class=\"token punctuation\">.</span><span class=\"token function\">writeInt</span><span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ç¾¤å‘æ¶ˆæ¯  å‘é€ç»™æ‰€æœ‰äºº</span></pre></td></tr><tr><td data-num=\"197\"></td><td><pre>\t\t\t\t\t\tdos<span class=\"token punctuation\">.</span><span class=\"token function\">writeUTF</span><span class=\"token punctuation\">(</span>msgSend<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"198\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>flag <span class=\"token operator\">==</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"199\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token comment\">// å‘Šè¯‰æœåŠ¡ç«¯æˆ‘å¯¹è°ç§å‘</span></pre></td></tr><tr><td data-num=\"200\"></td><td><pre>\t\t\t\t\t\t\tdos<span class=\"token punctuation\">.</span><span class=\"token function\">writeUTF</span><span class=\"token punctuation\">(</span>selectName<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"201\"></td><td><pre>\t\t\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"202\"></td><td><pre>\t\t\t\t\t\tdos<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"203\"></td><td><pre></pre></td></tr><tr><td data-num=\"204\"></td><td><pre>\t\t\t\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"205\"></td><td><pre>\t\t\t\t\t\te1<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"206\"></td><td><pre>\t\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"207\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"208\"></td><td><pre>\t\t\t\tsmsSend<span class=\"token punctuation\">.</span><span class=\"token function\">setText</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"209\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"210\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"211\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"212\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"å°ç»“-5\"><a class=\"anchor\" href=\"#å°ç»“-5\">#</a> å°ç»“</h3>\n<ul>\n<li>å®ç°äº†æ¥æ”¶å®¢æˆ·ç«¯çš„ç™»å½•æ¶ˆæ¯ï¼Œç„¶åæå–å½“å‰åœ¨çº¿çš„å…¨éƒ¨çš„ç”¨æˆ·åç§°å’Œå½“å‰ç™»å½•çš„ç”¨æˆ·åç§°å‘é€ç»™å…¨éƒ¨åœ¨çº¿ç”¨æˆ·æ›´æ–°è‡ªå·±çš„åœ¨çº¿äººæ•°åˆ—è¡¨</li>\n<li>ç§èŠæ¶ˆæ¯éœ€è¦åªè¦æ¨é€ç»™æŸä¸ªå…·ä½“çš„å®¢æˆ·ç«¯ Socket ç®¡é“</li>\n<li>æˆ‘ä»¬å¯ä»¥æ¥æ”¶å®¢æˆ·ç«¯å‘æ¥çš„ç§èŠç”¨æˆ·åç§°ï¼Œæ ¹æ®ç”¨æˆ·åç§°å®šä½è¯¥ç”¨æˆ·çš„ Socket ç®¡é“ï¼Œç„¶åå•ç‹¬æ¨é€æ¶ˆæ¯ç»™è¯¥ Socket ç®¡é“</li>\n<li>æœåŠ¡ç«¯æ”¶åˆ°æ–°çš„ç™»å½•æ¶ˆæ¯åï¼Œä¼šå“åº”ä¸€ä¸ªåœ¨çº¿åˆ—è¡¨ç”¨æˆ·å›æ¥ç»™å®¢æˆ·ç«¯æ›´æ–°åœ¨çº¿äººæ•°</li>\n<li>å®ç°äº†å®¢æˆ·ç«¯å‘é€ç¾¤èŠæ¶ˆæ¯ï¼Œ@æ¶ˆæ¯ï¼Œä»¥åŠç§èŠæ¶ˆæ¯</li>\n<li>å¦‚æœç›´æ¥ç‚¹å‘é€ï¼Œé»˜è®¤å‘é€ç¾¤èŠæ¶ˆæ¯</li>\n<li>å¦‚æœé€‰ä¸­å³ä¾§åœ¨çº¿åˆ—è¡¨æŸä¸ªç”¨æˆ·ï¼Œé»˜è®¤å‘é€ @æ¶ˆæ¯</li>\n<li>å¦‚æœé€‰ä¸­å³ä¾§åœ¨çº¿åˆ—è¡¨æŸä¸ªç”¨æˆ·ï¼Œç„¶åé€‰æ‹©å³ä¸‹ä¾§ç§èŠæŒ‰é’®é»˜è®¤å‘é€ç§èŠæ¶ˆæ¯</li>\n</ul>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "çŸ¥è¯†ç‚¹",
                "IO",
                "çŸ¥è¯†ç‚¹",
                "IO"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/IO/NIO%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/IO/NIO%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90/",
            "title": "NIOæ·±å…¥å‰–æ",
            "date_published": "2024-03-05T15:02:41.620Z",
            "content_html": "<h1 id=\"ä¸€-nioæ·±å…¥å‰–æ\"><a class=\"anchor\" href=\"#ä¸€-nioæ·±å…¥å‰–æ\">#</a> ä¸€ã€NIO æ·±å…¥å‰–æ</h1>\n<p>åœ¨è®²è§£åˆ©ç”¨ NIO å®ç°é€šä¿¡æ¶æ„ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ¥äº†è§£ä¸€ä¸‹ NIO çš„åŸºæœ¬ç‰¹ç‚¹å’Œä½¿ç”¨</p>\n<h2 id=\"11-java-nioåŸºæœ¬ä»‹ç»\"><a class=\"anchor\" href=\"#11-java-nioåŸºæœ¬ä»‹ç»\">#</a> 1.1 Java NIO åŸºæœ¬ä»‹ç»</h2>\n<ul>\n<li>Java NIO (New IO) ä¹Ÿæœ‰äººç§°ä¹‹ä¸º java non-blocking IO æ˜¯ä» java 1.4 ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„ä¸€ä¸ªæ–°çš„ IO APIï¼Œå¯ä»¥ä»£æ›¿æ ‡å‡†çš„ Java IO APIã€‚NIO ä¸åŸæ¥çš„ IO æœ‰åŒæ ·çš„ä½œç”¨å’Œç›®çš„ï¼Œä½†æ˜¯ä½¿ç”¨çš„æ–¹å¼å®Œå…¨ä¸åŒï¼ŒNIO æ”¯æŒé¢å‘ç¼“å†²åŒºçš„ï¼ŒåŸºäºé€šé“çš„ IO æ“ä½œã€‚NIO å°†ä»¥æ›´åŠ é«˜æ•ˆçš„æ–¹å¼è¿›è¡Œæ–‡ä»¶çš„è¯»å†™æ“ä½œã€‚NIO å¯ä»¥ç†è§£ä¸ºéé˜»å¡ IOã€‚ä¼ ç»Ÿçš„ IO çš„ read å’Œ write åªèƒ½é˜»å¡æ‰§è¡Œï¼Œçº¿ç¨‹åœ¨è¯»å†™ IO æœŸé—´ä¸èƒ½å¹²å…¶ä»–äº‹æƒ…ï¼Œæ¯”å¦‚è°ƒç”¨ socket.read () æ—¶ï¼Œå¦‚æœæœåŠ¡å™¨ä¸€ç›´æ²¡æœ‰æ•°æ®ä¼ è¾“è¿‡æ¥ï¼Œçº¿ç¨‹å°±ä¸€ç›´é˜»å¡ï¼Œè€Œ NIO ä¸­å¯ä»¥é…ç½® socket ä¸ºéé˜»å¡æ¨¡å¼ã€‚</li>\n<li>NIO ç›¸å…³ç±»éƒ½è¢«æ”¾åœ¨ java.nio åŒ…åŠå­åŒ…ä¸‹ï¼Œå¹¶ä¸”å¯¹åŸ java.io åŒ…ä¸­çš„å¾ˆå¤šç±»è¿›è¡Œæ”¹å†™</li>\n<li>NIO æœ‰ä¸‰å¤§æ ¸å¿ƒéƒ¨åˆ†ï¼šChannel (é€šé“)ï¼ŒBuffer (ç¼“å†²åŒº)ï¼ŒSelector (é€‰æ‹©å™¨)</li>\n<li>Java NIO çš„éé˜»å¡æ¨¡å¼ï¼Œä½¿ä¸€ä¸ªçº¿ç¨‹ä»æŸé€šé“å‘é€è¯·æ±‚æˆ–è€…è¯»å–æ•°æ®ï¼Œä½†æ˜¯å®ƒä»…èƒ½å¾—åˆ°ç›®å‰å¯ç”¨çš„æ•°æ®ï¼Œå¦‚æœç›®å‰ç­æœ‰æ•°æ®å¯ç”¨æ—¶ï¼Œå°±ä»€ä¹ˆéƒ½ä¸ä¼šè·å–ï¼Œè€Œä¸æ˜¯ä¿æŒçº¿ç¨‹é˜»å¡ï¼Œæ‰€ä»¥ç›´è‡³æ•°æ®å˜çš„å¯ä»¥è¯»å–ä¹‹å‰ï¼Œè¯¥çº¿ç¨‹å¯ä»¥ç»§ç»­åšå…¶ä»–äº‹æƒ…ã€‚éé˜»å¡å†™ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä¸€ä¸ªçº¿ç¨‹è¯·æ±‚å†™å…¥ä¸€äº›æ•°æ®åˆ°æŸé€šé“ï¼Œä½†ä¸éœ€è¦ç­‰å¾…å®ƒå®Œå…¨å†™å…¥ï¼Œè¿™ä¸ªçº¿ç¨‹åŒæ—¶å¯ä»¥å»åšåˆ«çš„äº‹æƒ…ã€‚</li>\n<li>é€šä¿—ç†è§£ï¼šNIO æ˜¯å¯ä»¥åšåˆ°ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†å¤šä¸ªæ“ä½œçš„ã€‚å‡è®¾æœ‰ 1000 ä¸ªè¯·æ±‚è¿‡æ¥ï¼Œæ ¹æ®å®é™…æƒ…å†µï¼Œå¯ä»¥åˆ†é… 20 æˆ–è€… 80 ä¸ªçº¿ç¨‹æ¥å¤„ç†ã€‚ä¸åƒä¹‹å‰çš„é˜»å¡ IO é‚£æ ·ï¼Œéå¾—åˆ†é… 1000 ä¸ªã€‚</li>\n</ul>\n<h2 id=\"12-nio-å’Œbio-æ¯”è¾ƒ\"><a class=\"anchor\" href=\"#12-nio-å’Œbio-æ¯”è¾ƒ\">#</a> 1.2 NIO å’Œ BIO æ¯”è¾ƒ</h2>\n<ul>\n<li>BIO ä»¥æµçš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€Œ NIO ä»¥å—çš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œå— IO çš„æ•ˆç‡æ¯” IO é«˜å¾ˆå¤š</li>\n<li>BIO æ˜¯é˜»å¡çš„ï¼ŒNIO åˆ™æ˜¯éé˜»å¡çš„</li>\n<li>BIO åŸºäºå­—èŠ‚æµå’Œå­—ç¬¦æµè¿›è¡Œæ“ä½œï¼Œè€Œ NIO åŸºäº Channel (é€šé“) å’Œ Buffer (ç¼“å†²åŒº) è¿›è¡Œæ“ä½œï¼Œæ•°æ®æ€»æ˜¯ä»é€šé“è¯»å–åˆ°ç¼“å†²åŒºä¸­ï¼Œæˆ–è€…ä»ç¼“å†²åŒºå†™å…¥åˆ°é€šé“ä¸­ã€‚Selector (é€‰æ‹©å™¨) ç”¨äºç›‘å¬å¤šä¸ªé€šé“çš„äº‹ä»¶ (æ¯”å¦‚ï¼šè¿æ¥è¯·æ±‚ï¼Œæ•°æ®åˆ°è¾¾ç­‰)ï¼Œå› æ­¤ä½¿ç”¨å•ä¸ªçº¿ç¨‹å¯ä»¥ç›‘å¬å¤šä¸ªå®¢æˆ·ç«¯é€šé“</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>NIO</th>\n<th>BIO</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>é¢å‘ç¼“å†²åŒº (Buffer)</td>\n<td>é¢å‘æµ (Stream)</td>\n</tr>\n<tr>\n<td>éé˜»å¡ (Non Blocking IO)</td>\n<td>é˜»å¡ IO (Blocking IO)</td>\n</tr>\n<tr>\n<td>é€‰æ‹©å™¨ (Selectors)</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>å…ˆæ¥çœ‹ä¸‹ BIO æ¨¡å¼çš„å›¾è§£ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240305215849007.png\" alt=\"image-20240305215849007\" /></p>\n<p>å†æ¥çœ‹ NIO æ¨¡å¼çš„å›¾è§£ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240305221811257.png\" alt=\"image-20240305221811257\" /></p>\n<h2 id=\"13-nioä¸‰å¤§æ ¸å¿ƒåŸç†ç¤ºæ„å›¾\"><a class=\"anchor\" href=\"#13-nioä¸‰å¤§æ ¸å¿ƒåŸç†ç¤ºæ„å›¾\">#</a> 1.3 NIO ä¸‰å¤§æ ¸å¿ƒåŸç†ç¤ºæ„å›¾</h2>\n<p>NIO æœ‰ä¸‰å¤§æ ¸å¿ƒéƒ¨åˆ†ï¼šChannel (é€šé“)ï¼ŒBuffer (ç¼“å†²åŒº)ï¼ŒSelector (é€‰æ‹©å™¨)</p>\n<h3 id=\"131-bufferç¼“å†²åŒº\"><a class=\"anchor\" href=\"#131-bufferç¼“å†²åŒº\">#</a> 1.3.1 Buffer ç¼“å†²åŒº</h3>\n<p>ç¼“å†²åŒºæœ¬è´¨ä¸Šæ˜¯ä¸€å—å¯ä»¥å†™å…¥æ•°æ®ï¼Œç„¶åå¯ä»¥ä»ä¸­è¯»å–æ•°æ®çš„å†…å­˜ã€‚è¿™å—å†…å­˜è¢«åŒ…è£…æˆ NIO Buffer å¯¹è±¡ï¼Œå¹¶æä¾›äº†ä¸€ç»„æ–¹æ³•ï¼Œç”¨æ¥æ–¹ä¾¿çš„è®¿é—®è¯¥å—å†…å­˜ã€‚ç›¸æ¯”è¾ƒç›´æ¥å¯¹æ•°ç»„çš„æ“ä½œï¼ŒBuffer API æ›´åŠ å®¹æ˜“æ“ä½œå’Œç®¡ç†ã€‚</p>\n<h3 id=\"132-channelé€šé“\"><a class=\"anchor\" href=\"#132-channelé€šé“\">#</a> 1.3.2 Channel (é€šé“)</h3>\n<p>Java NIO çš„é€šé“ç±»ä¼¼æµï¼Œä½†åˆæœ‰äº›ä¸åŒï¼šå³å¯ä»¥ä»é€šé“ä¸­è¯»å–æ•°æ®ï¼Œåˆå¯ä»¥å†™æ•°æ®åˆ°é€šé“ã€‚ä½†æµçš„ (input æˆ– output) è¯»å†™é€šå¸¸æ˜¯å•å‘çš„ã€‚é€šé“å¯ä»¥éé˜»å¡è¯»å–å’Œå†™å…¥é€šé“ï¼Œé€šé“å¯ä»¥æ”¯æŒè¯»å–æˆ–å†™å…¥ç¼“å†²åŒºï¼Œä¹Ÿæ”¯æŒå¼‚æ­¥è¯»å†™ã€‚</p>\n<h3 id=\"133-selectoré€‰æ‹©å™¨\"><a class=\"anchor\" href=\"#133-selectoré€‰æ‹©å™¨\">#</a> 1.3.3 Selector é€‰æ‹©å™¨</h3>\n<p>Selector æ˜¯ä¸€ä¸ª Java NIO ç»„ä»¶ï¼Œå¯ä»¥èƒ½å¤Ÿæ£€æŸ¥ä¸€ä¸ªæˆ–å¤šä¸ª NIO é€šé“ï¼Œå¹¶ç¡®å®šæ‹¿äº›é€šé“å·²ç»å‡†å¤‡å¥½è¿›è¡Œè¯»å–æˆ–å†™å…¥ã€‚è¿™æ ·ï¼Œä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹å¯ä»¥ç®¡ç†å¤šä¸ª Channelï¼Œä»è€Œç®¡ç†å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œæé«˜æ•ˆç‡ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240305222516043.png\" alt=\"image-20240305222516043\" /></p>\n<ul>\n<li>æ¯ä¸ª Channel éƒ½ä¼šå¯¹åº”ä¸€ä¸ª Buffer</li>\n<li>ä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ª Selectorï¼Œä¸€ä¸ª Selector å¯¹åº”å¤šä¸ª Channel (è¿æ¥)</li>\n<li>ç¨‹åºåˆ‡æ¢åˆ°å“ªä¸ª Channel æ˜¯ç”±äº‹ä»¶å†³å®šçš„</li>\n<li>Selector ä¼šæ ¹æ®ä¸åŒçš„äº‹ä»¶ï¼Œåœ¨å„ä¸ªé€šé“ä¸Šåˆ‡æ¢</li>\n<li>Buffer å°±æ˜¯ä¸€ä¸ªå†…å­˜å—ï¼Œåº•å±‚æ˜¯ä¸€ä¸ªæ•°ç»„</li>\n<li>æ•°æ®çš„è¯»å–å†™å…¥æ˜¯é€šè¿‡ Buffer å®Œæˆçš„ï¼ŒBIO ä¸­è¦ä¹ˆæ˜¯è¾“å…¥æµï¼Œæˆ–è€…æ˜¯è¾“å‡ºæµï¼Œä¸èƒ½åŒå‘ï¼Œä½†æ˜¯ NIO çš„ Buffer æ˜¯å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™</li>\n<li>Java NIO ç³»ç»Ÿçš„æ ¸å¿ƒåœ¨äºï¼šé€šé“ (Channel) å’Œç¼“å†²åŒº (Buffer)ã€‚é€šé“è¡¨ç¤ºæ‰“å¼€åˆ° IO è®¾å¤‡ (ä¾‹å¦‚ï¼šæ–‡ä»¶ï¼Œå¥—æ¥å­—) çš„è¿æ¥ã€‚è‹¥éœ€è¦ä½¿ç”¨ NIO ç³»ç»Ÿï¼Œéœ€è¦è·å–ç”¨äºè¿æ¥ IO è®¾å¤‡çš„é€šé“ä»¥åŠç”¨äºå®¹çº³æ•°æ®çš„ç¼“å†²åŒºã€‚ç„¶åæ“ä½œç¼“å†²åŒºï¼Œå¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒChannel è´Ÿè´£ä¼ è¾“ï¼ŒBuffer è´Ÿè´£å­˜å–æ•°æ®ã€‚</li>\n</ul>\n<h2 id=\"14-nioæ ¸å¿ƒä¸€ç¼“å†²åŒºbuffer\"><a class=\"anchor\" href=\"#14-nioæ ¸å¿ƒä¸€ç¼“å†²åŒºbuffer\">#</a> 1.4 NIO æ ¸å¿ƒä¸€ï¼šç¼“å†²åŒº (Buffer)</h2>\n<h3 id=\"141-ç¼“å†²åŒºbuffer\"><a class=\"anchor\" href=\"#141-ç¼“å†²åŒºbuffer\">#</a> 1.4.1 ç¼“å†²åŒº (Buffer)</h3>\n<p>ä¸€ä¸ªç”¨äºç‰¹å®šåŸºæœ¬æ•°æ®ç±»å‹çš„å®¹å™¨ï¼Œç”± java.nio åŒ…å®šä¹‰çš„ï¼Œæ‰€æœ‰ç¼“å†²åŒºéƒ½æ˜¯ Buffer æŠ½è±¡ç±»çš„å­ç±»ã€‚Java NIO ä¸­çš„ Buffer ä¸»è¦ç”¨äºä¸ NIO é€šé“è¿›è¡Œäº¤äº’ï¼Œæ•°æ®æ˜¯ä»é€šé“è¯»å…¥ç¼“å†²åŒºçš„ï¼Œä»ç¼“å†²åŒºå†™å…¥é€šé“ä¸­çš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240305223759612.png\" alt=\"image-20240305223759612\" /></p>\n<h3 id=\"142-bufferç±»åŠå…¶å­ç±»\"><a class=\"anchor\" href=\"#142-bufferç±»åŠå…¶å­ç±»\">#</a> 1.4.2 Buffer ç±»åŠå…¶å­ç±»</h3>\n<p>Buffer å°±åƒä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥ä¿å­˜å¤šä¸ªç›¸åŒç±»å‹çš„æ•°æ®ã€‚æ ¹æ®æ•°æ®ç±»å‹ä¸åŒï¼Œæœ‰ä»¥ä¸‹ Buffer å¸¸ç”¨å­ç±»ï¼š</p>\n<ul>\n<li>ByteBuffer</li>\n<li>CharBuffer</li>\n<li>ShortBuffer</li>\n<li>IntBuffer</li>\n<li>LongBuffer</li>\n<li>FloatBuffer</li>\n<li>DoubleBuffer</li>\n</ul>\n<p>ä¸Šè¿° Buffer ç±»å®ƒä»¬éƒ½é‡‡ç”¨ç›¸ä¼¼çš„æ–¹æ³•è¿›è¡Œç®¡ç†æ•°æ®ï¼Œåªæ˜¯å„è‡ªç®¡ç†çš„æ•°æ®ç±»å‹ä¸åŒè€Œå·²ã€‚éƒ½æ˜¯é€šè¿‡å¦‚ä¸‹æ–¹æ³•è·å–ä¸€ä¸ª Buffer å¯¹è±¡ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token class-name\">XxxBuffer</span> <span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> capacity<span class=\"token punctuation\">)</span>ï¼šåˆ›å»ºä¸€ä¸ªå®¹å™¨ä¸ºcapacityçš„<span class=\"token class-name\">XxxBuffer</span>å¯¹è±¡</pre></td></tr></table></figure><h3 id=\"143-ç¼“å†²åŒºçš„åŸºæœ¬å±æ€§\"><a class=\"anchor\" href=\"#143-ç¼“å†²åŒºçš„åŸºæœ¬å±æ€§\">#</a> 1.4.3 ç¼“å†²åŒºçš„åŸºæœ¬å±æ€§</h3>\n<p>Buffer ä¸­çš„é‡è¦æ¦‚å¿µï¼š</p>\n<ul>\n<li>å®¹é‡ (capacity)ï¼šä½œä¸ºä¸€ä¸ªå†…å­˜å—ï¼ŒBuffer å…·æœ‰ä¸€å®šçš„å›ºå®šå¤§å°ï¼Œä¹Ÿç§°ä¸º &quot;å®¹é‡&quot;ï¼Œç¼“å†²åŒºå®¹é‡ä¸èƒ½ä¸ºè´Ÿï¼Œå¹¶ä¸”åˆ›å»ºåä¸èƒ½æ›´æ”¹ã€‚</li>\n<li>é™åˆ¶ (limit)ï¼šè¡¨ç¤ºç¼“å†²åŒºä¸­å¯ä»¥æ“ä½œæ•°æ®çš„å¤§å° (limit åæ•°æ®ä¸èƒ½è¿›è¡Œè¯»å†™)ã€‚ç¼“å†²åŒºçš„é™åˆ¶ä¸èƒ½ä¸ºè´Ÿï¼Œå¹¶ä¸”ä¸èƒ½å¤§äºå…¶å®¹é‡ã€‚å†™å…¥æ¨¡å¼ï¼Œé™åˆ¶ç­‰äº Buffer çš„å®¹é‡ã€‚è¯»å–æ¨¡å¼ä¸‹ï¼Œlimit ç­‰äºå†™å…¥çš„æ•°æ®é‡ã€‚</li>\n<li>ä½ç½® (position)ï¼šä¸‹ä¸€ä¸ªè¦è¯»å–æˆ–å†™å…¥çš„æ•°æ®çš„ç´¢å¼•ã€‚ç¼“å†²åŒºçš„ä½ç½®ä¸èƒ½ä¸ºè´Ÿï¼Œå¹¶ä¸”ä¸èƒ½å¤§äºå…¶é™åˆ¶ã€‚</li>\n<li>æ ‡è®° (mark) ä¸é‡ç½® (reset)ï¼šæ ‡è®°æ˜¯ä¸€ä¸ªç´¢å¼•ï¼Œé€šè¿‡ Buffer ä¸­çš„ mark () æ–¹æ³• æŒ‡å®š Buffer ä¸­ä¸€ä¸ªç‰¹å®šçš„ positionï¼Œä¹‹åå¯ä»¥é€šè¿‡è°ƒç”¨ reset () æ–¹æ³•æ¢å¤åˆ°è¿™ä¸ª postionã€‚æ ‡è®°ï¼Œä½ç½®ï¼Œé™åˆ¶ï¼Œå®¹é‡éµå®ˆä»¥ä¸‹ä¸å˜å¼ï¼š0 &lt;= mark &lt;= positoin &lt;= limit &lt;= capacity</li>\n<li>å›¾ç¤ºï¼š</li>\n<li><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240305225000497.png\" alt=\"image-20240305225000497\" /></li>\n</ul>\n<h3 id=\"144-bufferå¸¸è§æ–¹æ³•api\"><a class=\"anchor\" href=\"#144-bufferå¸¸è§æ–¹æ³•api\">#</a> 1.4.4 Buffer å¸¸è§æ–¹æ³• API</h3>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•</th>\n<th>ä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Buffer clear()</td>\n<td>æ¸…ç©ºç¼“å†²åŒºå¹¶è¿”å›å¯¹è±¡ç¼“å†²åŒºçš„å¼•ç”¨</td>\n</tr>\n<tr>\n<td>Buffer flip()</td>\n<td>å°†ç¼“å†²åŒºçš„ç•Œé™è®¾ç½®ä¸ºå½“å‰ä½ç½®ï¼Œå¹¶å°†å½“å‰ä½ç½®é‡ç½®ä¸º 0</td>\n</tr>\n<tr>\n<td>int capacity()</td>\n<td>è¿”å› Buffer çš„ capacity å¤§å°</td>\n</tr>\n<tr>\n<td>boolean hasRemaining()</td>\n<td>åˆ¤æ–­ç¼“å†²åŒºä¸­æ˜¯å¦è¿˜æœ‰å…ƒç´ </td>\n</tr>\n<tr>\n<td>int limit()</td>\n<td>è¿”å› Buffer çš„ç•Œé™ (limit) çš„ä½ç½®</td>\n</tr>\n<tr>\n<td>Buffer limit(int n)</td>\n<td>è®¾ç½®ç¼“å†²åŒºç•Œé™ä¸º nï¼Œå¹¶è¿”å›ä¸€ä¸ªå…·æœ‰æ–° limit çš„ç¼“å†²åŒºå¯¹è±¡</td>\n</tr>\n<tr>\n<td>Buffer mark()</td>\n<td>å¯¹ç¼“å†²åŒºè®¾ç½®æ ‡è®°</td>\n</tr>\n<tr>\n<td>int position()</td>\n<td>è¿”å›ç¼“å†²åŒºçš„å½“å‰ä½ç½® position</td>\n</tr>\n<tr>\n<td>Buffer position(int n)</td>\n<td>è®¾ç½®ç¼“å†²åŒºçš„å½“å‰ä½ç½®ä¸º nï¼Œå¹¶è¿”å›ä¿®æ”¹åçš„ Buffer å¯¹è±¡</td>\n</tr>\n<tr>\n<td>int remaining()</td>\n<td>è¿”å› position å’Œ limit ä¹‹é—´çš„å…ƒç´ ä¸ªæ•°</td>\n</tr>\n<tr>\n<td>Buffer reset()</td>\n<td>å°†ä½ç½® position è½¬åˆ°ä»¥å‰è®¾ç½®çš„ mark æ‰€åœ¨çš„ä½ç½®</td>\n</tr>\n<tr>\n<td>Buffer rewind()</td>\n<td>å°†ä½ç½®è®¾ä¸º 0ï¼Œå–æ¶ˆè®¾ç½®çš„ mark</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"145-ç¼“å†²åŒºçš„æ•°æ®æ“ä½œ\"><a class=\"anchor\" href=\"#145-ç¼“å†²åŒºçš„æ•°æ®æ“ä½œ\">#</a> 1.4.5 ç¼“å†²åŒºçš„æ•°æ®æ“ä½œ</h3>\n<p>Buffer æ‰€æœ‰å­ç±»æä¾›äº†ä¸¤ä¸ªç”¨äºæ•°æ®æ“ä½œçš„æ–¹æ³•ï¼šget ()ï¼Œ put () æ–¹æ³•</p>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•</th>\n<th>ä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>get()</td>\n<td>è¯»å–å•ä¸ªå­—èŠ‚</td>\n</tr>\n<tr>\n<td>get(byte[] dst)</td>\n<td>æ‰¹é‡è¯»å–å¤šä¸ªå­—èŠ‚åˆ° dst ä¸­</td>\n</tr>\n<tr>\n<td>get(int index)</td>\n<td>è¯»å–æŒ‡å®šç´¢å¼•ä½ç½®çš„å­—èŠ‚ (ä¸ä¼šç§»åŠ¨ position)</td>\n</tr>\n</tbody>\n</table>\n<p>æ”¾å…¥æ•°æ®åˆ° Buffer ä¸­</p>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•</th>\n<th>ä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>put(byte b)</td>\n<td>å°†ç»™å®šå•ä¸ªå­—èŠ‚å†™å…¥ç¼“å†²åŒºçš„å½“å‰ä½ç½®</td>\n</tr>\n<tr>\n<td>put(byte[] src)</td>\n<td>å°† src ä¸­çš„å­—èŠ‚å†™å…¥ç¼“å†²åŒºçš„å½“å‰ä½ç½®</td>\n</tr>\n<tr>\n<td>put(int index, byte b)</td>\n<td>å°†æŒ‡å®šå­—èŠ‚å†™å…¥ç¼“å†²åŒºçš„ç´¢å¼•ä½ç½® (ä¸ä¼šç§»åŠ¨ position)</td>\n</tr>\n</tbody>\n</table>\n<p><strong>ä½¿ç”¨ Buffer è¯»å†™æ•°æ®ä¸€èˆ¬éµå¾ªä»¥ä¸‹å››ä¸ªæ­¥éª¤</strong>ï¼š</p>\n<ol>\n<li>å†™å…¥æ•°æ®åˆ° Buffer</li>\n<li>è°ƒç”¨ flip () æ–¹æ³•ï¼Œè½¬æ¢ä¸ºè¯»å–æ¨¡å¼</li>\n<li>ä» Buffer ä¸­è¯»å–æ•°æ®</li>\n<li>è°ƒç”¨ buffer.clear () æ–¹æ³•æˆ–è€… buffer.compact () æ–¹æ³•æ¸…é™¤ç¼“å†²åŒº</li>\n</ol>\n<p>ä»£ç æ¼”ç¤ºï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token comment\">// åˆ†é…ä¸€ä¸ªç¼“å†²åŒºï¼Œå®¹é‡è®¾ç½®æˆ 10</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 0</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 10</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">capacity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 10</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"------------------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token class-name\">String</span> name <span class=\"token operator\">=</span> <span class=\"token string\">\"itheima\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">// å‘ ByteBuffer ä¸­æ”¾å…¥æ•°æ®</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   buffer<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token comment\">//position ç‰¹æ€§ï¼šè®°å½•ä¸‹ä¸€ä¸ªè¦è¯»å–æˆ–å†™å…¥çš„ç´¢å¼•ï¼Œç¼“å†²åŒºçš„ä½ç½®ä¸èƒ½ä¸ºè´Ÿï¼Œå¹¶ä¸”ä¸èƒ½å¤§äºå…¶é™åˆ¶</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token comment\">//position ä½œç”¨ï¼šè¿”å›ç¼“å†²åŒºçš„å½“å‰ä½ç½®</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 7</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 10</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">capacity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 10</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"------------------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token comment\">//flip ä½œç”¨ï¼šåˆ‡æ¢ä¸ºè¯»å–æ¨¡å¼</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token comment\">//flip ç‰¹æ–°ï¼šå°†ç¼“å†²åŒºçš„ç•Œé™è®¾ç½®ä¸ºå½“å‰ä½ç½®ï¼Œå¹¶å°†å½“å‰ä½ç½®é‡ç½®ä¸º 0</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token comment\">// ä» position ä½ç½®å¼€å§‹ è¯»å–åˆ° limit ä½ç½®</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 0</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 7</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">capacity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 10</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"------------------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   <span class=\"token keyword\">char</span> ch <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token punctuation\">)</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¯»å–çš„å­—ç¬¦ï¼š\"</span> <span class=\"token operator\">+</span> ch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>   <span class=\"token comment\">// è¯»å–ä¸€ä¸ªå­—ç¬¦å position æŒ‡å‘ä¸‹ä¸€ä¸ªå­—ç¬¦å°±å˜æˆäº† 1</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 7</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">capacity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 10</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token comment\">// åˆ†é…ä¸€ä¸ªç¼“å†²åŒºï¼Œå®¹é‡è®¾ç½®æˆ 10</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 0</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 10</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">capacity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 10</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"------------------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token class-name\">String</span> name <span class=\"token operator\">=</span> <span class=\"token string\">\"itheima\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">// å‘ ByteBuffer ä¸­æ”¾å…¥æ•°æ®</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   buffer<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token comment\">//position ç‰¹æ€§ï¼šè®°å½•ä¸‹ä¸€ä¸ªè¯»å–æˆ–å†™å…¥çš„ç´¢å¼•ï¼Œç¼“å†²åŒºçš„ä½ç½®ä¸èƒ½ä¸ºè´Ÿï¼Œå¹¶ä¸”ä¸èƒ½å¤§äºå…¶é™åˆ¶</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token comment\">//position ä½œç”¨ï¼šè¿”å›ç¼“å†²åŒºçš„å½“å‰ä½ç½®</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 7</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 10</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">capacity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 10</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"------------------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token comment\">// æ¸…ç©ºç¼“å†²åŒºå¹¶è¿”å›å¯¹è±¡ç¼“å†²åŒºçš„å¼•ç”¨</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   buffer<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 0</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 10</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">capacity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 10</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"------------------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   <span class=\"token comment\">// è°ƒç”¨äº† clear ä¸ºä»€ä¹ˆè¿˜èƒ½è·å–åˆ°ä¸Šé¢å­˜å‚¨çš„ itheima çš„ i å‘¢ï¼Ÿ è¿™æ˜¯å› ä¸º clear å¹¶æ²¡æœ‰çœŸæ­£çš„æ¸…é™¤æ•°æ®ï¼Œå®ƒåªæ˜¯è®© position çš„ä½ç½®æ¢å¤åˆ°äº† 0ï¼Œä½†æ˜¯åç»­çš„æ•°æ®è¿˜æ˜¯åœ¨çš„</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä»ç¼“å†²åŒºä¸­è·å–positionä½ç½®çš„å­—ç¬¦ï¼š\"</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token punctuation\">)</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// i</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// åˆ†é…ä¸€ä¸ªç¼“å†²åŒºå®¹é‡ä¸º 10</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">ByteBuffer</span> buf <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// åˆ‡æ¢å¯è¯»æ¨¡å¼ position ç½®ä¸º 0</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>buf<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æŠ¥é”™ï¼š.BufferUnderflowException æ„æ€æ˜¯æˆ‘ä»¬å¿…é¡»ä¿è¯ç¼“å†²åŒºä¸­æœ‰æ•°æ®æ‰èƒ½åˆ‡æ¢å¯è¯»æ¨¡å¼è¿›è¡Œè¯»å†™æ•°æ®</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// åˆ›å»ºç¼“å†²åŒº å¤§å°ä¸º 2</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bytes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// ä»ç¼“å†²åŒºä¸­è·å–å¤§å°ä¸º 2 å­—èŠ‚çš„æ•°æ®</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>buf<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// å°†å­—èŠ‚æ•°æ®è½¬æ¢ä¸ºåè¿›åˆ¶</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token class-name\">String</span> s <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// æ‰“å°</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">String</span> n <span class=\"token operator\">=</span> <span class=\"token string\">\"itheima\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   buffer<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bytes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   buffer<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token class-name\">String</span> rs <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>rs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"----------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2 å–å‡ºäº†ä¸¤ä¸ªå­—ç¬¦æ‰€ä»¥ position çš„ç´¢å¼•ä½ç½®åœ¨ 2</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 7</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">capacity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 10</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token comment\">// æ ‡è®°ä¸€å¤„ç´¢å¼•</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   buffer<span class=\"token punctuation\">.</span><span class=\"token function\">mark</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bytes1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"----------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   buffer<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>bytes1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>bytes1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 5 åˆå–å‡ºäº† 3 ä¸ªå­—ç¬¦æ‰€ä»¥ position çš„ç´¢å¼•ä½ç½®åœ¨ 5</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 7</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">capacity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 10</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   <span class=\"token comment\">// å›åˆ°ä¸Šä¸€æ¬¡æ ‡è®°å¤„</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   buffer<span class=\"token punctuation\">.</span><span class=\"token function\">reset</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   <span class=\"token comment\">// åˆ¤æ–­æ˜¯å¦è¿˜æœ‰å‰©ä½™çš„æ•°æ®</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">hasRemaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token comment\">// æ‰“å°è¾“å‡º å‰©ä½™çš„æ•°æ®ä¸ªæ•°</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">remaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 5</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"146-ç›´æ¥ä¸éç›´æ¥ç¼“å†²åŒº\"><a class=\"anchor\" href=\"#146-ç›´æ¥ä¸éç›´æ¥ç¼“å†²åŒº\">#</a> 1.4.6 ç›´æ¥ä¸éç›´æ¥ç¼“å†²åŒº</h3>\n<p>ä»€ä¹ˆæ˜¯ç›´æ¥å†…å­˜ä¸éç›´æ¥å†…å­˜</p>\n<p><strong>æ ¹æ®å®˜æ–¹æ–‡æ¡£çš„æè¿°</strong>ï¼š</p>\n<p><code>bytebuffer </code> å¯ä»¥æ˜¯ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯<mark>åŸºäºç›´æ¥å†…å­˜</mark> (ä¹Ÿå°±æ˜¯éå †å†…å­˜)ï¼›å¦ä¸€ç§æ˜¯<mark>éç›´æ¥å†…å­˜</mark> (ä¹Ÿå°±æ˜¯å †å†…å­˜)ã€‚å¯¹äºç›´æ¥å†…å­˜æ¥è¯´ï¼Œ<mark>JVM å°†ä¼šåœ¨ IO æ“ä½œä¸Šå…·æœ‰æ›´é«˜çš„æ€§èƒ½ï¼Œå› ä¸ºå®ƒç›´æ¥ç”¨äºæœ¬åœ°ç³»ç»Ÿçš„ IO æ“ä½œ</mark>ã€‚è€Œéç›´æ¥å†…å­˜ï¼Œä¹Ÿå°±æ˜¯å †å†…å­˜ä¸­çš„æ•°æ®ï¼Œå¦‚æœè¦æ“ä½œ IO æ“ä½œï¼Œ<mark>ä¼šå…ˆä»æœ¬è¿›ç¨‹å†…å­˜å¤åˆ¶åˆ°ç›´æ¥å†…å­˜ï¼Œå†åˆ©ç”¨æœ¬åœ° IO å¤„ç†</mark>ã€‚</p>\n<p>ä»æ•°æ®æµçš„è§’åº¦ï¼Œéç›´æ¥å†…å­˜æ˜¯ä¸‹é¢è¿™æ ·çš„ä½œç”¨é“¾ï¼š</p>\n<p><code>æœ¬åœ°IO â€”â€”&gt; ç›´æ¥å†…å­˜ â€”â€”&gt; éç›´æ¥å†…å­˜ â€”â€”&gt; ç›´æ¥å†…å­˜ â€”â€”&gt; æœ¬åœ°IO</code></p>\n<p>è€Œç›´æ¥å†…å­˜æ˜¯ï¼š</p>\n<p><code>æœ¬åœ°IO â€”â€”&gt; ç›´æ¥å†…å­˜ â€”â€”&gt; æœ¬åœ°IO</code></p>\n<p>å¾ˆæ˜æ˜¾ï¼Œåœ¨åš IO å¤„ç†æ—¶ï¼Œæ¯”å¦‚ç½‘ç»œå‘é€é‡å¤§æ•°æ®æ—¶ï¼Œç›´æ¥å†…å­˜ä¼šå…·æœ‰æ›´é«˜çš„æ•ˆç‡ã€‚ç›´æ¥å†…å­˜ä½¿ç”¨ allocateDirect åˆ›å»ºï¼Œä½†æ˜¯å®ƒæ¯”ç”³è¯·æ™®é€šçš„å †å†…å­˜éœ€è¦è€—è´¹æ›´é«˜çš„æ€§èƒ½ã€‚ä¸è¿‡ï¼Œè¿™éƒ¨åˆ†çš„æ•°æ®æ˜¯åœ¨ JVM ä¹‹å¤–çš„ï¼Œå› æ­¤å®ƒä¸ä¼šå ç”¨åº”ç”¨çš„å†…å­˜ã€‚æ‰€ä»¥å‘¢ï¼Œå½“ä½ æœ‰å¾ˆå¤§çš„æ•°æ®è¦ç¼“å­˜ï¼Œå¹¶ä¸”å®ƒçš„ç”Ÿå‘½å‘¨æœŸåˆå¾ˆé•¿ï¼Œé‚£ä¹ˆå°±æ¯”è¾ƒé€‚åˆä½¿ç”¨ç›´æ¥å†…å­˜ã€‚åªæ˜¯ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸æ˜¯èƒ½å¸¦æ¥å¾ˆæ˜æ˜¾çš„æ€§èƒ½æå‡ï¼Œè¿˜æ˜¯æ¨èç›´æ¥ä½¿ç”¨å †å†…å­˜ã€‚å­—èŠ‚ç¼“å†²åŒºæ˜¯å­—èŠ‚ç¼“å†²åŒºè¿˜æ˜¯éç›´æ¥ç¼“å†²åŒºå¯é€šè¿‡è°ƒç”¨å…¶ isDirect () æ–¹æ³•æ¥ç¡®å®šã€‚</p>\n<p><strong>ä½¿ç”¨åœºæ™¯</strong></p>\n<ul>\n<li>æœ‰å¾ˆå¤§çš„æ•°æ®éœ€è¦å­˜å‚¨ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸåˆå¾ˆé•¿</li>\n<li>é€‚åˆé¢‘ç¹çš„ IO æ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œå¹¶å‘åœºæ™¯</li>\n</ul>\n<h3 id=\"147-nioæ ¸å¿ƒäºŒé€šé“channel\"><a class=\"anchor\" href=\"#147-nioæ ¸å¿ƒäºŒé€šé“channel\">#</a> 1.4.7 NIO æ ¸å¿ƒäºŒï¼šé€šé“ (Channel)</h3>\n<h4 id=\"1471-é€šé“channelæ¦‚è¿°\"><a class=\"anchor\" href=\"#1471-é€šé“channelæ¦‚è¿°\">#</a> 1.4.7.1 é€šé“ Channel æ¦‚è¿°</h4>\n<p>é€šé“ (Channel)ï¼šç”± java.nio.channels åŒ…å®šä¹‰çš„ã€‚Channel è¡¨ç¤º IO æºä¸ç›®æ ‡æ‰“å¼€çš„è¿æ¥ã€‚Channel ç±»ä¼¼äºä¼ ç»Ÿçš„ &quot;æµ&quot;ã€‚åªä¸è¿‡ Channel æœ¬èº«ä¸èƒ½ç›´æ¥è®¿é—®æ•°æ®ï¼ŒChannel åªèƒ½ä¸ Buffer è¿›è¡Œäº¤äº’</p>\n<p>1ã€NIO çš„é€šé“ç±»ä¼¼äºæµï¼Œä½†æœ‰äº›åŒºåˆ«å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>é€šé“å¯ä»¥åŒæ—¶è¿›è¡Œè¯»å†™ï¼Œè€Œæµåªèƒ½è¯»æˆ–è€…åªèƒ½å†™</li>\n<li>é€šé“å¯ä»¥å®ç°å¼‚æ­¥è¯»å†™æ•°æ®</li>\n<li>é€šé“å¯ä»¥ä»ç¼“å†²è¯»æ•°æ®ï¼Œä¹Ÿå¯ä»¥å†™æ•°æ®åˆ°ç¼“å†²åŒº</li>\n</ul>\n<p>2ã€BIO ä¸­çš„ stream æ˜¯å•å‘çš„ï¼Œä¾‹å¦‚ FileInputStream å¯¹è±¡åªèƒ½è¿›è¡Œè¯»å–æ•°æ®çš„æ“ä½œï¼Œè€Œ NIO ä¸­çš„é€šé“ (Channel) æ˜¯åŒå‘çš„ï¼Œå¯ä»¥è¯»æ“ä½œï¼Œä¹Ÿå¯ä»¥å†™æ“ä½œã€‚</p>\n<p>3ã€Channel åœ¨ NIO ä¸­æ˜¯ä¸€ä¸ªæ¥å£</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Channel</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Clonseable</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"1472-å¸¸ç”¨çš„channelå®ç°ç±»\"><a class=\"anchor\" href=\"#1472-å¸¸ç”¨çš„channelå®ç°ç±»\">#</a> 1.4.7.2 å¸¸ç”¨çš„ Channel å®ç°ç±»</h4>\n<ul>\n<li>FileChannelï¼šç”¨äºè¯»å–ï¼Œå†™å…¥ï¼Œæ˜ å°„å’Œæ“ä½œæ–‡ä»¶çš„é€šé“ã€‚</li>\n<li>DatagramChannelï¼šé€šè¿‡ UDP è¯»å†™ç½‘ç»œä¸­çš„æ•°æ®é€šé“ã€‚</li>\n<li>SocketChannelï¼šé€šè¿‡ TCP è¯»å†™ç½‘ç»œä¸­çš„æ•°æ®ã€‚</li>\n<li>ServerSOcketChanbnelï¼šå¯ä»¥ç›‘å¬æ–°è¿›æ¥çš„ TCP è¿æ¥ï¼Œå¯¹æ¯ä¸€ä¸ªæ–°è¿›æ¥çš„è¿æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ª SocketChannelã€‚[ServerSocketChannel ç±»ä¼¼ ServerSocketï¼ŒSocketChannel ç±»ä¼¼ Socket]</li>\n</ul>\n<h4 id=\"1473-filechannelç±»\"><a class=\"anchor\" href=\"#1473-filechannelç±»\">#</a> 1.4.7.3 FileChannel ç±»</h4>\n<p>è·å–é€šé“çš„ä¸€ç§æ–¹å¼æ˜¯å¯¹æ”¯æŒé€šé“çš„å¯¹è±¡è°ƒç”¨ getChannel () æ–¹æ³•ã€‚æ”¯æŒé€šè¿‡çš„ç±»å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>\n<p>FileInputStream</p>\n</li>\n<li>\n<p>FileOutputStream</p>\n</li>\n<li>\n<p>RandomAccessFile</p>\n</li>\n<li>\n<p>DatagramSocket</p>\n</li>\n<li>\n<p>Socket</p>\n</li>\n<li>\n<p>ServerSocket</p>\n<p>è·å–é€šé“çš„å…¶å®ƒæ–¹å¼æ˜¯ä½¿ç”¨ Files ç±»çš„é™æ€æ–¹æ³• newByteChannel () è·å–å­—èŠ‚é€šé“ã€‚æˆ–è€…é€šè¿‡é€šé“çš„é™æ€æ–¹æ³• open () æ‰“å¼€å¹¶è¿”å›æŒ‡å®šé€šé“</p>\n</li>\n</ul>\n<h4 id=\"1474-filechannelçš„å¸¸ç”¨æ–¹æ³•\"><a class=\"anchor\" href=\"#1474-filechannelçš„å¸¸ç”¨æ–¹æ³•\">#</a> 1.4.7.4 FileChannel çš„å¸¸ç”¨æ–¹æ³•</h4>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•</th>\n<th>ä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>int read(ByteBuffer dst)</td>\n<td>ä» Channel ä¸­è¯»å–æ•°æ®åˆ° ByteBuffer</td>\n</tr>\n<tr>\n<td>long read(ByteBuffer[] dsts)</td>\n<td>å°† Channel ä¸­çš„æ•°æ® &quot;åˆ†æ•£&quot; åˆ° ByteBuffer []</td>\n</tr>\n<tr>\n<td>long write(ByteBuffer src)</td>\n<td>å°† ByteBuffer ä¸­çš„æ•°æ®å†™å…¥åˆ° Channel</td>\n</tr>\n<tr>\n<td>long write(ByteBuffer[] srcs)</td>\n<td>å°† ByteBuffer [] ä¸­çš„æ•°æ® &quot;èšé›†&quot; åˆ° Channel</td>\n</tr>\n<tr>\n<td>long position()</td>\n<td>è¿”å›æ­¤é€šé“çš„æ–‡ä»¶ä½ç½®</td>\n</tr>\n<tr>\n<td>FileChannel position(long p)</td>\n<td>è®¾ç½®æ­¤é€šé“çš„æ–‡ä»¶ä½ç½®</td>\n</tr>\n<tr>\n<td>long size()</td>\n<td>è¿”å›æ­¤é€šé“çš„æ–‡ä»¶çš„å½“å‰å¤§å°</td>\n</tr>\n<tr>\n<td>FileChannel truncate(long s)</td>\n<td>å°†æ­¤é€šé“çš„æ–‡ä»¶æˆªå–ä¸ºç»™å®šå¤§å°</td>\n</tr>\n<tr>\n<td>void force(boolean metaData)</td>\n<td>å¼ºåˆ¶å°†æ‰€æœ‰å¯¹æ­¤é€šé“çš„æ–‡ä»¶æ›´æ–°å†™å…¥åˆ°å­˜å‚¨è®¾å¤‡ä¸­</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"1475-æ¡ˆä¾‹-æœ¬åœ°æ–‡ä»¶å†™æ•°æ®\"><a class=\"anchor\" href=\"#1475-æ¡ˆä¾‹-æœ¬åœ°æ–‡ä»¶å†™æ•°æ®\">#</a> 1.4.7.5 æ¡ˆä¾‹ - æœ¬åœ°æ–‡ä»¶å†™æ•°æ®</h4>\n<p>éœ€æ±‚ï¼šä½¿ç”¨å‰é¢å­¦ä¹ åçš„ ByteBuffer (ç¼“å†²åŒº) å’Œ FileChannel (é€šé“)ï¼Œå°† &quot;hello&quot; å†™å…¥åˆ° ar.txt</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ChannelTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">FileOutputStream</span> os <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">FileChannel</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token comment\">// å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å‡ºæµé€šå‘ç›®æ ‡æ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            os <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user.dir\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\\ar.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token comment\">// å¾—åˆ°å­—èŠ‚è¾“å‡ºæµå¯¹åº”çš„é€šé“</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            channel <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span><span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token comment\">// åˆ›å»ºç¼“å†²åŒº</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token comment\">// å‘ç¼“å†²åŒºä¸­æ·»åŠ å­—èŠ‚æ•°æ®</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            buffer<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token comment\">// åˆ‡æ¢åˆ°å¯è¯»æ¨¡å¼</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">FileNotFoundException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>channel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>os <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                    os<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240308221531463.png\" alt=\"image-20240308221531463\" /></p>\n<h4 id=\"1476-æ¡ˆä¾‹-æœ¬åœ°æ–‡ä»¶è¯»æ•°æ®\"><a class=\"anchor\" href=\"#1476-æ¡ˆä¾‹-æœ¬åœ°æ–‡ä»¶è¯»æ•°æ®\">#</a> 1.4.7.6 æ¡ˆä¾‹ - æœ¬åœ°æ–‡ä»¶è¯»æ•°æ®</h4>\n<p>éœ€æ±‚ï¼šä½¿ç”¨å‰é¢å­¦ä¹ åçš„ ByteBuffer (ç¼“å†²åŒº) å’Œ FileChannel (é€šé“)ï¼Œå°† ar.txt ä¸­çš„æ•°æ®è¯»å…¥åˆ°ç¨‹åºï¼Œå¹¶æ˜¾ç¤ºåœ¨æ§åˆ¶å°å±å¹•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\">// è·å–å½“å‰å·¥ç¨‹çš„ç»å¯¹è·¯å¾„</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">String</span> filePath <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAbsolutePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token comment\">// åˆ›å»ºè¾“å…¥æµè¯»å– ar.txt æ–‡ä»¶å†…å®¹</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token class-name\">FileInputStream</span> is <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span>filePath <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\\ar.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token comment\">// è·å–é€šé“å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token class-name\">FileChannel</span> channel <span class=\"token operator\">=</span> is<span class=\"token punctuation\">.</span><span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token comment\">// åˆ›å»ºç¼“å†²åŒº</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token comment\">// å°†é€šé“ä¸­æ•°æ®è¯»å–åˆ°ç¼“å†²åŒº</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      channel<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token comment\">// åˆ‡æ¢è¯»æ¨¡å¼ position ç½®ä¸º 0</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token comment\">// æ‰“å°å†…å®¹ buffer.array å°†ç¼“å†²åŒºçš„æ•°æ®è½¬åŒ–ä¸ºæ•°ç»„ä» 0 å¼€å§‹è¯»å–åˆ° ç¼“å†²åŒºå‰©ä½™æ•°æ®ä¸ºæ­¢</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">.</span><span class=\"token function\">remaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">FileNotFoundException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<pre><code>hello\n</code></pre>\n<h4 id=\"1477-æ¡ˆä¾‹-ä½¿ç”¨bufferå®Œæˆæ–‡ä»¶å¤åˆ¶\"><a class=\"anchor\" href=\"#1477-æ¡ˆä¾‹-ä½¿ç”¨bufferå®Œæˆæ–‡ä»¶å¤åˆ¶\">#</a> 1.4.7.7 æ¡ˆä¾‹ - ä½¿ç”¨ Buffer å®Œæˆæ–‡ä»¶å¤åˆ¶</h4>\n<p>ä½¿ç”¨ FileChannel (é€šé“)ï¼Œå®Œæˆæ–‡ä»¶çš„æ‹·è´</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">copy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">FileInputStream</span> is <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">FileOutputStream</span> os <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">FileChannel</span> isChannel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token class-name\">FileChannel</span> osChannel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token comment\">// åˆ›å»ºå­—èŠ‚è¾“å…¥æµè¯»å–æŒ‡å®šæ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      is <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAbsolutePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\\ar.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token comment\">// åˆ›å»ºå­—èŠ‚è¾“å‡ºæµ æŒ‡å®šå†™å‡ºåœ°å€</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      os <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAbsolutePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\\arTwo.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token comment\">// è·å– è¯»æ•°æ®é€šé“</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      isChannel <span class=\"token operator\">=</span> is<span class=\"token punctuation\">.</span><span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token comment\">// è·å– å†™æ•°æ®é€šé“</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      osChannel <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span><span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token comment\">// åˆ›å»º 1024 çš„ç¼“å†²åŒº</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>         <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token comment\">// ä¸Šä¸€æ¬¡è¯»å–çš„æ•°æ®å·²ç»å†™å‡ºå®Œäº† æ¸…ç©ºä¸Šæ¬¡çš„æ•°æ®ç»§ç»­ä¸‹æ¬¡çš„æ•°æ®</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            buffer<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token comment\">// å°†è¯»å–çš„ç¼“å†²åŒºä¸ªæ•°æ®çš„å€¼èµ‹å€¼ç»™ flag</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token keyword\">int</span> flag <span class=\"token operator\">=</span> isChannel<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token comment\">// å¦‚æœ flag = -1 è¯´æ˜æ²¡æœ‰æ•°æ®æ­¤æ—¶å°± è·³å‡ºæ‰§è¡Œ</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>flag <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>               <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token comment\">// åˆ‡æ¢å¯è¯»æ¨¡å¼</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token comment\">// å°†æ•°æ®å†™å‡º</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            osChannel<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å¤åˆ¶å®Œæˆï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">FileNotFoundException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token comment\">// é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isChannel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            isChannel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>osChannel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            osChannel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240309171606609.png\" alt=\"image-20240309171606609\" /></p>\n<h4 id=\"1478-æ¡ˆä¾‹-åˆ†æ•£scatterå’Œèšé›†gather\"><a class=\"anchor\" href=\"#1478-æ¡ˆä¾‹-åˆ†æ•£scatterå’Œèšé›†gather\">#</a> 1.4.7.8 æ¡ˆä¾‹ - åˆ†æ•£ (Scatter) å’Œèšé›† (Gather)</h4>\n<p>åˆ†æ•£è¯»å– (Scatter)ï¼šæ˜¯æŒ‡æŠŠ Channel é€šé“çš„æ•°æ®è¯»å…¥åˆ°å¤šä¸ªç¼“å†²åŒºä¸­å»</p>\n<p>èšé›†å†™å…¥ (Gathering)ï¼šæ˜¯æŒ‡å°†å¤šä¸ª Buffer ä¸­çš„æ•°æ® &quot;èšé›†&quot; åˆ° Channelã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">FileChannel</span> isChannel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">FileChannel</span> osChannel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token comment\">// åˆ›å»º è¯»å†™ æµ å¹¶è·å–å¯¹åº”çš„é€šé“</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token class-name\">FileInputStream</span> is <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAbsolutePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\\ar.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      isChannel <span class=\"token operator\">=</span> is<span class=\"token punctuation\">.</span><span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token class-name\">FileOutputStream</span> os <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAbsolutePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\\arThree.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      osChannel <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span><span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token comment\">// åˆ›å»ºå®¹é‡ä¸º 5 å­—èŠ‚çš„ç¼“å†²åŒº</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token class-name\">ByteBuffer</span> bufOne <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token comment\">// åˆ›å»ºå®¹é‡ä¸º 1KB çš„ç¼“å†²åŒº</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token class-name\">ByteBuffer</span> bufTwo <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token comment\">// å°†ä¸¤ä¸ªç¼“å†²åŒºæ”¾å…¥åˆ°ä¸€ä¸ª bufs çš„æ•°ç»„ä¸­</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bufs <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>bufOne<span class=\"token punctuation\">,</span> bufTwo<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token comment\">// è¯»å–æ•°æ®åˆ°é€šé“</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      isChannel<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>bufs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token comment\">// éå† bufs</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuffer</span> buf <span class=\"token operator\">:</span> bufs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>         <span class=\"token comment\">// åˆ‡æ¢å¯è¯»æ¨¡å¼</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>         buf<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>         <span class=\"token comment\">// æ‰“å°è¾“å‡ºè¯»å–åˆ°çš„æ•°æ®</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>         <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> buf<span class=\"token punctuation\">.</span><span class=\"token function\">remaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">FileNotFoundException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token comment\">// é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isChannel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            isChannel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>osChannel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            osChannel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<pre><code>hello\nWorld\n</code></pre>\n<h4 id=\"1479-æ¡ˆä¾‹-transferfrom\"><a class=\"anchor\" href=\"#1479-æ¡ˆä¾‹-transferfrom\">#</a> 1.4.7.9 æ¡ˆä¾‹ - transferFrom ()</h4>\n<p>ä»ç›®æ ‡é€šé“ä¸­å»å¤åˆ¶åŸé€šé“æ•°æ®</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">FileChannel</span> isChannel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">FileChannel</span> osChannel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token comment\">// åˆ›å»º è¯»å†™æµå¹¶è·å–å¯¹åº”é€šé“</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token class-name\">FileInputStream</span> is <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAbsolutePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\\ar.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token class-name\">FileOutputStream</span> os <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAbsolutePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\\arThree.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      isChannel <span class=\"token operator\">=</span> is<span class=\"token punctuation\">.</span><span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      osChannel <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span><span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token comment\">// å°†è¯»æ•°æ®çš„é€šé“çš„æ•°æ®å¤åˆ¶åˆ°å†™é€šé“ä¸­</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      osChannel<span class=\"token punctuation\">.</span><span class=\"token function\">transferFrom</span><span class=\"token punctuation\">(</span>isChannel<span class=\"token punctuation\">,</span> isChannel<span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> isChannel<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">FileNotFoundException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token comment\">// é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isChannel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            isChannel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>osChannel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            osChannel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240310005045706.png\" alt=\"image-20240310005045706\" /></p>\n<h4 id=\"14710-æ¡ˆä¾‹-transferto\"><a class=\"anchor\" href=\"#14710-æ¡ˆä¾‹-transferto\">#</a> 1.4.7.10 æ¡ˆä¾‹ - transferTo ()</h4>\n<p>æŠŠåŸé€šé“æ•°æ®å¤åˆ¶åˆ°ç›®æ ‡é€šé“</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">FileChannel</span> isChannel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">FileChannel</span> osChannel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token comment\">// åˆ›å»º è¯»å†™æµå¹¶è·å–å¯¹åº”é€šé“</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token class-name\">FileInputStream</span> is <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAbsolutePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\\ar.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token class-name\">FileOutputStream</span> os <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAbsolutePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\\arThree.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      isChannel <span class=\"token operator\">=</span> is<span class=\"token punctuation\">.</span><span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      osChannel <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span><span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token comment\">// å°†è¯»æ•°æ®çš„é€šé“çš„æ•°æ®å¤åˆ¶åˆ°å†™é€šé“ä¸­</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      isChannel<span class=\"token punctuation\">.</span><span class=\"token function\">transferTo</span><span class=\"token punctuation\">(</span>isChannel<span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> isChannel<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> osChannel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">FileNotFoundException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token comment\">// é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isChannel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            isChannel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>osChannel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            osChannel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªå¤åˆ¶é€šé“æ•°æ®çš„æ–¹æ³• ä½œç”¨éƒ½æ˜¯ä¸€æ ·çš„ åªæ˜¯è°ç»™è°æ•°æ®çš„ä½ç½®ä¸åŒè€Œå·²ã€‚</p>\n<h3 id=\"15-nioæ ¸å¿ƒä¸‰é€‰æ‹©å™¨selector\"><a class=\"anchor\" href=\"#15-nioæ ¸å¿ƒä¸‰é€‰æ‹©å™¨selector\">#</a> 1.5 NIO æ ¸å¿ƒä¸‰ï¼šé€‰æ‹©å™¨ (Selector)</h3>\n<h4 id=\"151-é€‰æ‹©å™¨selectoræ¦‚è¿°\"><a class=\"anchor\" href=\"#151-é€‰æ‹©å™¨selectoræ¦‚è¿°\">#</a> 1.5.1 é€‰æ‹©å™¨ (Selector) æ¦‚è¿°</h4>\n<p>é€‰æ‹©å™¨ (Selector) æ˜¯ SelectableChannel å¯¹è±¡çš„å¤šè·¯å¤ç”¨å™¨ï¼ŒSelector å¯ä»¥åŒæ—¶ç›‘æ§å¤šä¸ª SelectableChannel çš„ IO çŠ¶å†µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ©ç”¨ Selector å¯ä½¿ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ç®¡ç†å¤šä¸ª Channelã€‚Selector æ˜¯éé˜»å¡ IO çš„æ ¸å¿ƒã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240310005558845.png\" alt=\"image-20240310005558845\" /></p>\n<ul>\n<li>Java çš„ NIOï¼Œç”¨éé˜»å¡ IO æ–¹å¼ã€‚å¯ä»¥ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå¤„ç†å¤šä¸ªçš„å®¢æˆ·ç«¯è¿æ¥ï¼Œå°±ä¼šä½¿ç”¨åˆ° Selector (é€‰æ‹©å™¨)</li>\n<li>Selector èƒ½å¤Ÿæ£€æµ‹å¤šä¸ªæ³¨å†Œçš„é€šé“ä¸Šæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿ (æ³¨æ„ï¼šå¤šä¸ª Channel ä»¥äº‹ä»¶çš„æ–¹å¼å¯ä»¥æ³¨å†Œåˆ°åŒä¸€ä¸ª Selector)ï¼Œå¦‚æœæœ‰äº‹ä»¶å‘ç”Ÿï¼Œä¾¿è·å–äº‹ä»¶ç„¶åé’ˆå¯¹æ¯ä¸ªäº‹ä»¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚è¿™æ ·å°±å¯ä»¥åªç”¨ä¸€ä¸ªå•çº¿ç¨‹å»ç®¡ç†å¤šä¸ªé€šé“ï¼Œä¹Ÿå°±æ˜¯ç®¡ç†å¤šä¸ªè¿æ¥å’Œè¯·æ±‚ã€‚</li>\n<li>åªæœ‰åœ¨ è¿æ¥ / é€šé“ çœŸæ­£æœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ‰ä¼šè¿›è¡Œè¯»å†™ï¼Œå°±å¤§å¤§çš„å‡å°‘äº†ç³»ç»Ÿå¼€é”€ï¼Œå¹¶ä¸”ä¸å¿…ä¸ºæ¯ä¸ªè¿æ¥éƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¸ç”¨å»ç»´æŠ¤å¤šä¸ªçº¿ç¨‹</li>\n<li>é¿å…äº†å¤šçº¿ç¨‹ä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´çš„å¼€é”€</li>\n</ul>\n<h4 id=\"152-é€‰æ‹©å™¨selectorçš„åº”ç”¨\"><a class=\"anchor\" href=\"#152-é€‰æ‹©å™¨selectorçš„åº”ç”¨\">#</a> 1.5.2 é€‰æ‹©å™¨ (Selector) çš„åº”ç”¨</h4>\n<p>åˆ›å»º Selectorï¼šé€šè¿‡è°ƒç”¨ Selector.open () æ–¹æ³•åˆ›å»ºä¸€ä¸ª Selectorã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Selector</span> selector <span class=\"token operator\">=</span> <span class=\"token class-name\">Selector</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>å‘é€‰æ‹©å™¨æ³¨å†Œé€šé“ï¼šSelectableChannel.register (Selector sel, int ops)</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 1. è·å–é€šé“</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">ServerSocketChannel</span> ssChannel <span class=\"token operator\">=</span> <span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 2. åˆ‡æ¢éé˜»å¡æ¨¡å¼</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// 3. ç»‘å®šè¿æ¥</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token number\">9898</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// 4. è·å–é€‰æ‹©å™¨</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token class-name\">Selector</span> selector <span class=\"token operator\">=</span> <span class=\"token class-name\">Selector</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// 5. å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šï¼Œå¹¶ä¸”æŒ‡å®š \"ç›‘å¬æ¥æ”¶äº‹ä»¶\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OP_ACCEPT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>å½“è°ƒç”¨ register (Selector sel, int ops) å°†é€šé“æ³¨å†Œé€‰æ‹©å™¨æ—¶ï¼Œé€‰æ‹©å™¨å¯¹é€šé“çš„ç›‘å¬äº‹ä»¶ï¼Œéœ€è¦é€šè¿‡ç¬¬äºŒä¸ªå‚æ•° ops æŒ‡å®šã€‚å¯ä»¥ç›‘å¬çš„äº‹ä»¶ç±»å‹ (å¯ä½¿ç”¨ SelectionKey çš„å››ä¸ªå¸¸é‡ è¡¨ç¤º)ï¼š</p>\n<ul>\n<li>è¯»ï¼šSelectionKey.OP_READ (1)</li>\n<li>å†™ï¼šSelectionKey.OP_WRITE (4)</li>\n<li>è¿æ¥ï¼šSelectionKey.OP_CONNECT (8)</li>\n<li>æ¥æ”¶ï¼šSelectionKey.OP_ACCEPT (16)</li>\n<li>è‹¥æ³¨å†Œæ—¶ä¸æ­¢ç›‘å¬ä¸€ä¸ªäº‹ä»¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ &quot;ä½ï¼Œ æˆ–&quot; æ“ä½œç¬¦è¿æ¥ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">int</span> interrestSet <span class=\"token operator\">=</span> <span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OP_READ</span><span class=\"token operator\">|</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OP_WRITE</span></pre></td></tr></table></figure><h4 id=\"153-nioéé˜»å¡å¼ç½‘ç»œé€šä¿¡åŸç†åˆ†æ\"><a class=\"anchor\" href=\"#153-nioéé˜»å¡å¼ç½‘ç»œé€šä¿¡åŸç†åˆ†æ\">#</a> 1.5.3 NIO éé˜»å¡å¼ç½‘ç»œé€šä¿¡åŸç†åˆ†æ</h4>\n<h5 id=\"1531-selectorç¤ºæ„å›¾å’Œç‰¹ç‚¹è¯´æ˜\"><a class=\"anchor\" href=\"#1531-selectorç¤ºæ„å›¾å’Œç‰¹ç‚¹è¯´æ˜\">#</a> 1.5.3.1 Selector ç¤ºæ„å›¾å’Œç‰¹ç‚¹è¯´æ˜</h5>\n<p>Selector å¯ä»¥å®ç°ï¼šä¸€ä¸ª IO çº¿ç¨‹å¯ä»¥å¹¶å‘å¤„ç† N ä¸ªå®¢æˆ·ç«¯è¿æ¥å’Œè¯»å†™æ“ä½œï¼Œè¿™ä»æ ¹æœ¬ä¸Šè§£å†³äº†ä¼ ç»ŸåŒæ­¥é˜»å¡ IO ä¸€ä¸ªé“¾æ¥ä¸€ä¸ªçº¿ç¨‹æ¨¡å‹ï¼Œæ¶æ„çš„æ€§èƒ½ï¼Œå¼¹æ€§ä¼¸ç¼©èƒ½åŠ›å’Œå¯é æ€§éƒ½å¾—åˆ°äº†æå¤§çš„æå‡ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240310124620521.png\" alt=\"image-20240310124620521\" /></p>\n<h5 id=\"1532-æœåŠ¡ç«¯æµç¨‹\"><a class=\"anchor\" href=\"#1532-æœåŠ¡ç«¯æµç¨‹\">#</a> 1.5.3.2 æœåŠ¡ç«¯æµç¨‹</h5>\n<ol>\n<li>\n<p>å½“å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šé€šè¿‡ ServerScoketChannel å¾—åˆ° SocketChannelï¼šè·å–é€šé“</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">ServerSocketChannel</span> ssChannel <span class=\"token operator\">=</span> <span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n<li>\n<p>åˆ‡æ¢éé˜»å¡æ¨¡å¼</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n<li>\n<p>ç»‘å®šé“¾æ¥</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token number\">9999</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n<li>\n<p>è·å–é€‰æ‹©å™¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Selector</span> selector <span class=\"token operator\">=</span> <span class=\"token class-name\">Selctor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n<li>\n<p>å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šï¼Œå¹¶ä¸”æŒ‡å®š &quot;ç›‘å¬æ¥æ”¶äº‹ä»¶&quot;</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token namespace\">selector<span class=\"token punctuation\">.</span></span>SelectionKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OP_ACCEPT</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure></li>\n<li>\n<p>è½®è¯¢å¼çš„è·å–é€‰æ‹©å™¨ä¸Šå·²ç» &quot;å‡†å¤‡å°±ç»ª&quot; çš„äº‹ä»¶</p>\n</li>\n</ol>\n<p>æœåŠ¡ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> ç›®æ ‡ï¼šNIO éé˜»å¡é€šä¿¡ä¸‹çš„å…¥é—¨æ¡ˆä¾‹ï¼šæœåŠ¡ç«¯å¼€å‘</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Server</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯å¯åŠ¨\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\">// 1ã€è·å–é€šé“</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">ServerSocketChannel</span> ssChannel <span class=\"token operator\">=</span> <span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// 2ã€åˆ‡æ¢ä¸ºéé˜»å¡æ¨¡å¼</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// 3ã€ç»‘å®šè¿æ¥çš„ç«¯å£</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token number\">9999</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">// 4ã€è·å–é€‰æ‹©å™¨ Selector</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">Selector</span> selector <span class=\"token operator\">=</span> <span class=\"token class-name\">Selector</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">// 5ã€å°†é€šé“éƒ½æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šå»ï¼Œå¹¶ä¸”å¼€å§‹æŒ‡å®šç›‘å¬æ¥æ”¶äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector <span class=\"token punctuation\">,</span> <span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OP_ACCEPT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// 6ã€ä½¿ç”¨ Selector é€‰æ‹©å™¨è½®è¯¢å·²ç»å°±ç»ªå¥½çš„äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å¼€å§‹ä¸€è½®äº‹ä»¶å¤„ç†~~~\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token comment\">// 7ã€è·å–é€‰æ‹©å™¨ä¸­çš„æ‰€æœ‰æ³¨å†Œçš„é€šé“ä¸­å·²ç»å°±ç»ªå¥½çš„äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> it <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">selectedKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token comment\">// 8ã€å¼€å§‹éå†è¿™äº›å‡†å¤‡å¥½çš„äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token comment\">// æå–å½“å‰è¿™ä¸ªäº‹ä»¶</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                <span class=\"token class-name\">SelectionKey</span> sk <span class=\"token operator\">=</span> it<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token comment\">// 9ã€åˆ¤æ–­è¿™ä¸ªäº‹ä»¶å…·ä½“æ˜¯ä»€ä¹ˆ</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>sk<span class=\"token punctuation\">.</span><span class=\"token function\">isAcceptable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                    <span class=\"token comment\">// 10ã€ç›´æ¥è·å–å½“å‰æ¥å…¥çš„å®¢æˆ·ç«¯é€šé“</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                    <span class=\"token class-name\">SocketChannel</span> schannel <span class=\"token operator\">=</span> ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                    <span class=\"token comment\">// 11 ã€åˆ‡æ¢æˆéé˜»å¡æ¨¡å¼</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                    schannel<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                    <span class=\"token comment\">// 12ã€å°†æœ¬å®¢æˆ·ç«¯é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                    schannel<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector <span class=\"token punctuation\">,</span> <span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OP_READ</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>sk<span class=\"token punctuation\">.</span><span class=\"token function\">isReadable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                    <span class=\"token comment\">// 13ã€è·å–å½“å‰é€‰æ‹©å™¨ä¸Šçš„è¯»å°±ç»ªäº‹ä»¶</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                    <span class=\"token class-name\">SocketChannel</span> sChannel <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">)</span> sk<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                    <span class=\"token comment\">// 14ã€è¯»å–æ•°æ®</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                    <span class=\"token class-name\">ByteBuffer</span> buf <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                    <span class=\"token keyword\">int</span> len <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>len <span class=\"token operator\">=</span> sChannel<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                        buf<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                        buf<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// æ¸…é™¤ä¹‹å‰çš„æ•°æ®</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                it<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// å¤„ç†å®Œæ¯•ä¹‹åéœ€è¦ç§»é™¤å½“å‰äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h5 id=\"1533-å®¢æˆ·ç«¯æµç¨‹\"><a class=\"anchor\" href=\"#1533-å®¢æˆ·ç«¯æµç¨‹\">#</a> 1.5.3.3 å®¢æˆ·ç«¯æµç¨‹</h5>\n<ol>\n<li>\n<p>è·å–é€šé“</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">SocketChannel</span> sChannel <span class=\"token operator\">=</span> <span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9999</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n<li>\n<p>åˆ‡æ¢éé˜»å¡æ¨¡å¼</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>sChannel<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n<li>\n<p>åˆ†é…æŒ‡å®šå¤§å°çš„ç¼“å†²åŒº</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">ByteBuffer</span> buf <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n<li>\n<p>å‘é€æ•°æ®ç»™æœåŠ¡ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å®¢æˆ·ç«¯ å¯åŠ¨ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token comment\">// è·å–é€šé“</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token class-name\">SocketChannel</span> sChannel <span class=\"token operator\">=</span> <span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9999</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token comment\">// è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            sChannel<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token comment\">// åˆ›å»º 1024 å­—èŠ‚çš„ç¼“å†²åŒº</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token class-name\">ByteBuffer</span> buf <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token comment\">// å‘é€æ•°æ®ç»™æœåŠ¡ç«¯</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">Scanner</span> sc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¯·è¯´ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token class-name\">String</span> msg <span class=\"token operator\">=</span> sc<span class=\"token punctuation\">.</span><span class=\"token function\">nextLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token comment\">// å°†è¾“å…¥çš„è¯æ·»åŠ åˆ°ç¼“å†²åŒºä¸­ä»¥å­—èŠ‚å½¢å¼</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                buf<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ³¢ä»”: \"</span> <span class=\"token operator\">+</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token comment\">// åˆ‡æ¢å¯è¯»æ¨¡å¼</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                buf<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token comment\">// å†™å‡ºç¼“å†²åŒºä¸­çš„æ•°æ®</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                sChannel<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token comment\">// æ¸…ç©ºç¼“å†²åŒº</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                buf<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ol>\n<p>æ‰§è¡Œç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/recording.gif\" alt=\"recording\" /></p>\n<h4 id=\"154-nioéé˜»å¡å¼ç½‘ç»œé€šä¿¡å…¥é—¨æ¡ˆä¾‹\"><a class=\"anchor\" href=\"#154-nioéé˜»å¡å¼ç½‘ç»œé€šä¿¡å…¥é—¨æ¡ˆä¾‹\">#</a> 1.5.4 NIO éé˜»å¡å¼ç½‘ç»œé€šä¿¡å…¥é—¨æ¡ˆä¾‹</h4>\n<p>éœ€æ±‚ï¼šæœåŠ¡ç«¯æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶æ¥æ”¶å¤šä¸ªå®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„äº‹ä»¶</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  å®¢æˆ·ç«¯</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token comment\">//1. è·å–é€šé“</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token class-name\">SocketChannel</span> sChannel <span class=\"token operator\">=</span> <span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9999</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t<span class=\"token comment\">//2. åˆ‡æ¢éé˜»å¡æ¨¡å¼</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\tsChannel<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t<span class=\"token comment\">//3. åˆ†é…æŒ‡å®šå¤§å°çš„ç¼“å†²åŒº</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t<span class=\"token class-name\">ByteBuffer</span> buf <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t<span class=\"token comment\">//4. å‘é€æ•°æ®ç»™æœåŠ¡ç«¯</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t<span class=\"token class-name\">Scanner</span> scan <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>scan<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t<span class=\"token class-name\">String</span> str <span class=\"token operator\">=</span> scan<span class=\"token punctuation\">.</span><span class=\"token function\">nextLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\tbuf<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleDateFormat</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"yyyy/MM/dd HH:mm:ss\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t\t\t<span class=\"token operator\">+</span> <span class=\"token string\">\"\\n\"</span> <span class=\"token operator\">+</span> str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\tbuf<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\tsChannel<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\tbuf<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t<span class=\"token comment\">//5. å…³é—­é€šé“</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\tsChannel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"29\"></td><td><pre> æœåŠ¡ç«¯</pre></td></tr><tr><td data-num=\"30\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Server</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token comment\">//1. è·å–é€šé“</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token class-name\">ServerSocketChannel</span> ssChannel <span class=\"token operator\">=</span> <span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token comment\">//2. åˆ‡æ¢éé˜»å¡æ¨¡å¼</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token comment\">//3. ç»‘å®šè¿æ¥</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token number\">9999</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token comment\">//4. è·å–é€‰æ‹©å™¨</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token class-name\">Selector</span> selector <span class=\"token operator\">=</span> <span class=\"token class-name\">Selector</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token comment\">//5. å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šï¼Œå¹¶ä¸”æŒ‡å®š â€œç›‘å¬æ¥æ”¶äº‹ä»¶â€</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OP_ACCEPT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token comment\">//6. è½®è¯¢å¼çš„è·å–é€‰æ‹©å™¨ä¸Šå·²ç» â€œå‡†å¤‡å°±ç»ªâ€ çš„äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è½®ä¸€è½®\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            <span class=\"token comment\">//7. è·å–å½“å‰é€‰æ‹©å™¨ä¸­æ‰€æœ‰æ³¨å†Œçš„ â€œé€‰æ‹©é”® (å·²å°±ç»ªçš„ç›‘å¬äº‹ä»¶)â€</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> it <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">selectedKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token comment\">//8. è·å–å‡†å¤‡ â€œå°±ç»ªâ€ çš„æ˜¯äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token class-name\">SelectionKey</span> sk <span class=\"token operator\">=</span> it<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token comment\">//9. åˆ¤æ–­å…·ä½“æ˜¯ä»€ä¹ˆäº‹ä»¶å‡†å¤‡å°±ç»ª</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sk<span class=\"token punctuation\">.</span><span class=\"token function\">isAcceptable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                    <span class=\"token comment\">//10. è‹¥ â€œæ¥æ”¶å°±ç»ªâ€ï¼Œè·å–å®¢æˆ·ç«¯è¿æ¥</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                    <span class=\"token class-name\">SocketChannel</span> sChannel <span class=\"token operator\">=</span> ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                    <span class=\"token comment\">//11. åˆ‡æ¢éé˜»å¡æ¨¡å¼</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                    sChannel<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                    <span class=\"token comment\">//12. å°†è¯¥é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                    sChannel<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OP_READ</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sk<span class=\"token punctuation\">.</span><span class=\"token function\">isReadable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                    <span class=\"token comment\">//13. è·å–å½“å‰é€‰æ‹©å™¨ä¸Š â€œè¯»å°±ç»ªâ€ çŠ¶æ€çš„é€šé“</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                    <span class=\"token class-name\">SocketChannel</span> sChannel <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">)</span> sk<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                    <span class=\"token comment\">//14. è¯»å–æ•°æ®</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                    <span class=\"token class-name\">ByteBuffer</span> buf <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                    <span class=\"token keyword\">int</span> len <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>len <span class=\"token operator\">=</span> sChannel<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                        buf<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                        buf<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                <span class=\"token comment\">//15. å–æ¶ˆé€‰æ‹©é”® SelectionKey</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                it<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"155-nioç½‘ç»œç¼–ç¨‹åº”ç”¨å®ä¾‹-ç¾¤èŠç³»ç»Ÿ\"><a class=\"anchor\" href=\"#155-nioç½‘ç»œç¼–ç¨‹åº”ç”¨å®ä¾‹-ç¾¤èŠç³»ç»Ÿ\">#</a> 1.5.5 NIO ç½‘ç»œç¼–ç¨‹åº”ç”¨å®ä¾‹ - ç¾¤èŠç³»ç»Ÿ</h4>\n<h5 id=\"ç›®æ ‡\"><a class=\"anchor\" href=\"#ç›®æ ‡\">#</a> ç›®æ ‡</h5>\n<p>éœ€æ±‚ï¼šè¿›ä¸€æ­¥ç†è§£ NIO éé˜»å¡ç½‘ç»œç¼–ç¨‹æœºåˆ¶ï¼Œå®ç°å¤šäººç¾¤èŠ</p>\n<ul>\n<li>ç¼–å†™ä¸€ä¸ª NIO ç¾¤èŠç³»ç»Ÿï¼Œå®ç°å®¢æˆ·ç«¯ä¸å®¢æˆ·ç«¯çš„é€šä¿¡éœ€æ±‚ (éé˜»å¡)</li>\n<li>æœåŠ¡ç«¯ï¼šå¯ä»¥ç›‘æµ‹ç”¨æˆ·ä¸Šçº¿ï¼Œç¦»çº¿ï¼Œå¹¶å®ç°æ¶ˆæ¯è½¬å‘åŠŸèƒ½</li>\n<li>å®¢æˆ·ç«¯ï¼šé€šè¿‡ channel å¯ä»¥æ— é˜»å¡å‘é€æ¶ˆæ¯ç»™å…¶å®ƒæ‰€æœ‰å®¢æˆ·ç«¯ç”¨æˆ·ï¼ŒåŒæ—¶å¯ä»¥æ¥æ”¶å…¶å®ƒå®¢æˆ·ç«¯ç”¨æˆ·é€šè¿‡æœåŠ¡ç«¯è½¬å‘è¿‡æ¥çš„æ¶ˆæ¯</li>\n</ul>\n<p>æœåŠ¡ç«¯ä»£ç å®ç°ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InetSocketAddress</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ByteBuffer</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Iterator</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// æœåŠ¡ç«¯ç¾¤èŠç³»ç»Ÿå®ç°</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Server</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// å®šä¹‰æˆå‘˜å±æ€§ï¼šé€‰æ‹©å™¨ï¼ŒæœåŠ¡ç«¯é€šé“ï¼Œç«¯å£</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Selector</span> selector<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">ServerSocketChannel</span> ssChannel<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> <span class=\"token number\">9999</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">// å®šä¹‰åˆå§‹åŒ–ä»£ç é€»è¾‘</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Server</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token comment\">// æ¥æ”¶é€‰æ‹©å™¨</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            selector <span class=\"token operator\">=</span> <span class=\"token class-name\">Selector</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token comment\">// è·å–é€šé“</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            ssChannel <span class=\"token operator\">=</span> <span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token comment\">// ç»‘å®šè¿æ¥ç«¯å£</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">// è®¾ç½®éé˜»å¡é€šä¿¡æ¨¡å¼</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// æŠŠé€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šå¹¶ä¸”æŒ‡å®šæ¥æ”¶è¿æ¥äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OP_ACCEPT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯ å¯åŠ¨ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token comment\">// åˆå§‹åŒ–æœåŠ¡ç«¯å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token class-name\">Server</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Server</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token comment\">// å¼€å§‹ç›‘å¬å®¢æˆ·ç«¯çš„å„ç§æ¶ˆæ¯äº‹ä»¶ï¼šè¿æ¥ï¼Œç¾¤èŠæ¶ˆæ¯ï¼Œç¦»çº¿æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        server<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token comment\">// å¼€å§‹ç›‘å¬</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token comment\">// è½®è¯¢äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                <span class=\"token comment\">// è·å–é€‰æ‹©å™¨ä¸­æ‰€æœ‰æ³¨å†Œé€šé“çš„å°±ç»ªäº‹ä»¶</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> it <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">selectedKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                <span class=\"token comment\">// éå†äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                    <span class=\"token comment\">// æå–äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                    <span class=\"token class-name\">SelectionKey</span> sk <span class=\"token operator\">=</span> it<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                    <span class=\"token comment\">// åˆ¤æ–­äº‹ä»¶ç±»å‹</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sk<span class=\"token punctuation\">.</span><span class=\"token function\">isAcceptable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                        <span class=\"token comment\">//isAcceptable = true è¯´æ˜ å®¢æˆ·ç«¯æ¥å…¥äº†</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                        <span class=\"token comment\">// è·å–å½“å‰å®¢æˆ·ç«¯é€šé“</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                        <span class=\"token class-name\">SocketChannel</span> channel <span class=\"token operator\">=</span> ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                        <span class=\"token comment\">// è®¾ç½®å½“å‰å®¢æˆ·ç«¯é€šé“ä¸º éé˜»å¡æ¨¡å¼</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                        channel<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                        <span class=\"token comment\">// æ³¨å†Œ è¯»å– äº‹ä»¶åˆ°é€‰æ‹©å™¨ä¸Š</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                        channel<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OP_READ</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sk<span class=\"token punctuation\">.</span><span class=\"token function\">isReadable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                        <span class=\"token comment\">// å¦‚æœå®¢æˆ·ç«¯å‘é€äº†è¯»äº‹ä»¶å°±ä¼šè¿›å…¥åˆ°å½“å‰ä»£ç å—</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                        <span class=\"token comment\">// å¤„ç†è¿™ä¸ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯ï¼Œæ¥æ”¶å®ƒç„¶åå®ç°è½¬å‘é€»è¾‘</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                        <span class=\"token comment\">// ä¸“é—¨å†™ä¸€ä¸ª api å« readClientData å»è¯»å–å½“å‰å®¢æˆ·ç«¯çš„æ•°æ®</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                        <span class=\"token comment\">// ä¼ å…¥äº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶æ˜¯å®šä½å½“å‰å®¢æˆ·ç«¯çš„å…³é”®å®ƒæ˜¯ä¸€ä¸ªåå‘ä»£ç†çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå¯ä»¥æå–å½“å‰å®¢æˆ·ç«¯çš„é€šé“</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                        <span class=\"token function\">readClientData</span><span class=\"token punctuation\">(</span>sk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                    <span class=\"token comment\">// å¤„ç†å®Œæ¯•ä¹‹åéœ€è¦ç§»é™¤å½“å‰äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                    it<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    <span class=\"token comment\">// æ¥æ”¶å½“å‰å®¢æˆ·ç«¯é€šé“çš„æ¶ˆæ¯ï¼Œè½¬å‘ç»™å…¶å®ƒå…¨éƒ¨å®¢æˆ·ç«¯é€šé“</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">readClientData</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SelectionKey</span> sk<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>        <span class=\"token class-name\">SocketChannel</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>            <span class=\"token comment\">// è·å–å½“å‰å®¢æˆ·ç«¯çš„é€šé“</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>            channel <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">)</span> sk<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>            <span class=\"token comment\">// åˆ›å»ºç¼“å†²åŒº</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>            <span class=\"token class-name\">ByteBuffer</span> buf <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>            <span class=\"token comment\">// è¯»å–æ•°æ®</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>            <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> channel<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>            <span class=\"token comment\">// åˆ¤æ–­æ˜¯å¦è¯»åˆ°äº†æ•°æ®</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>count <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>                <span class=\"token comment\">// åˆ‡æ¢å¯è¯»æ¨¡å¼</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>                buf<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>                <span class=\"token comment\">// å°†è¯»å–çš„æ•°æ®ä¼ å…¥ msg ä¸­</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>                <span class=\"token class-name\">String</span> msg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> buf<span class=\"token punctuation\">.</span><span class=\"token function\">remaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¥æ”¶åˆ°äº†å®¢æˆ·ç«¯æ¶ˆæ¯ï¼š\"</span> <span class=\"token operator\">+</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>                <span class=\"token comment\">// æŠŠè¿™ä¸ªæ¶ˆæ¯æ¨é€ç»™å…¨éƒ¨å®¢æˆ·ç«¯æ¥æ”¶ï¼Œä¼ å…¥æ¶ˆæ¯å’Œ å½“å‰é€šé“ï¼Œä¼ å…¥å½“å‰é€šé“æ˜¯ä¸ºäº†åˆ¤æ–­è¿™ä¸ªæ¶ˆæ¯æ˜¯å¦è¦å‘é€ç»™è‡ªå·±</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>                <span class=\"token function\">sendMsgToAllClient</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">,</span> channel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœ‰äººç¦»çº¿äº†\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>            <span class=\"token comment\">// å½“å‰å®¢æˆ·ç«¯ç¦»çº¿</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>channel<span class=\"token punctuation\">.</span><span class=\"token function\">getRemoteAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" ç¦»çº¿äº†\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>                <span class=\"token comment\">// å–æ¶ˆæ³¨å†Œ</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>                <span class=\"token comment\">// æŠŠå½“å‰é€šé“ä»é€‰æ‹©å™¨é‡Œé¢å–æ¶ˆæ‰è€Œäº‹ä»¶ä¹Ÿä¼šéšä¹‹å–æ¶ˆæ‰ï¼Œå–æ¶ˆæ‰ä»¥åå°±ä¸ä¼šå»ç®¡è¿™ä¸ªé€šé“äº†</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>                sk<span class=\"token punctuation\">.</span><span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>                <span class=\"token comment\">// å–æ¶ˆé€šé“åä¹Ÿåº”è¯¥å°†å…¶å…³é—­</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>                channel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>    <span class=\"token comment\">// æŠŠå½“å‰å®¢æˆ·ç«¯çš„æ¶ˆæ¯æ¨é€ç»™å½“å‰å…¨éƒ¨åœ¨çº¿æ³¨å†Œçš„é€šé“</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendMsgToAllClient</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SocketChannel</span> channel<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯å¼€å§‹è½¬å‘ æ¶ˆæ¯ å½“å‰å¤„ç†çš„çº¿ç¨‹ï¼š\"</span> <span class=\"token operator\">+</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>        <span class=\"token comment\">// è·å–é€‰æ‹©å™¨ä¸­çš„æ‰€æœ‰äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SelectionKey</span> key <span class=\"token operator\">:</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>            <span class=\"token comment\">// å¾—åˆ°æ‰€æœ‰é€šé“</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>            <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"119\"></td><td><pre>             * åœ¨æŠŠæ¶ˆæ¯åˆ†å‘ç»™æ‰€æœ‰é€šé“æ—¶æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä»é€‰æ‹©å™¨ä¸­æå–çš„æ‰€æœ‰çš„äº‹ä»¶å¯¹åº”çš„é€šé“</pre></td></tr><tr><td data-num=\"120\"></td><td><pre>             * è¿™ä¸ªé€šé“ä¼šæœ‰ä¸€ä¸ªæœåŠ¡ç«¯è‡ªå·±çš„é€šé“ï¼ŒæœåŠ¡ç«¯è‡ªå·±çš„é€šé“ä¹Ÿæ˜¯æ³¨å†Œåˆ°äº†å¤šè·¯å¤ç”¨å™¨çš„ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥å¼ºè½¬æˆ</pre></td></tr><tr><td data-num=\"121\"></td><td><pre>             * SocketChannel</pre></td></tr><tr><td data-num=\"122\"></td><td><pre>             * è¿™æ ·å°±å¯ä»¥æ’é™¤æ‰ æœåŠ¡ç«¯çš„é€šé“ å’Œ å½“å‰å®¢æˆ·ç«¯é€šé“</pre></td></tr><tr><td data-num=\"123\"></td><td><pre>             */</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>            <span class=\"token class-name\">Channel</span> channel1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Channel</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>            <span class=\"token comment\">// å°†è‡ªå·±çš„é€šé“ä»æ‰€æœ‰é€šé“ä¸­æ’é™¤æ‰</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>channel1 <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">SocketChannel</span> <span class=\"token operator\">&amp;&amp;</span> channel <span class=\"token operator\">!=</span> channel1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>                <span class=\"token comment\">// å°† msg è½¬æ¢ä¸ºå­—èŠ‚æ•°æ®åŒ…è£…åˆ° ByteBuffer ä¸­</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>                <span class=\"token class-name\">ByteBuffer</span> buf <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>                <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">)</span>channel1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InetSocketAddress</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ByteBuffer</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SelectionKey</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Selector</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SocketChannel</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Iterator</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Scanner</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// ç›®æ ‡ï¼šå®¢æˆ·ç«¯ä»£ç é€»è¾‘çš„å®ç°</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// å®šä¹‰å®¢æˆ·ç«¯ç›¸å…³å±æ€§</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Selector</span> selector<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">SocketChannel</span> socketChannel<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> <span class=\"token number\">9999</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Client</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token comment\">// åˆ›å»ºé€‰æ‹©å™¨</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            selector <span class=\"token operator\">=</span> <span class=\"token class-name\">Selector</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token comment\">// è¿æ¥æœåŠ¡ç«¯ è·å–é€šé“</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            socketChannel <span class=\"token operator\">=</span> <span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">// è®¾ç½®å½“å‰é€šé“ä¸ºéé˜»å¡æ¨¡å¼</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            socketChannel<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// æ³¨å†Œäº‹ä»¶åˆ°é€‰æ‹©å™¨</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token comment\">// æ¥æ”¶æœåŠ¡ç«¯çš„è¯»äº‹ä»¶ï¼Œè€Œä¸ç”¨ç›‘å¬æœåŠ¡ç«¯çš„æ¥å…¥äº‹ä»¶ï¼Œå› ä¸ºæ¥å…¥äº‹ä»¶æ˜¯ å®¢æˆ·ç«¯ æ‰¾ æœåŠ¡ç«¯çš„äº‹å„¿</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            socketChannel<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OP_READ</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å½“å‰å®¢æˆ·ç«¯å‡†å¤‡å®Œæˆ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token class-name\">Client</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Client</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token comment\">// å®šä¹‰ä¸€ä¸ªçº¿ç¨‹ä¸“é—¨è´Ÿè´£ç›‘å¬æœåŠ¡ç«¯å‘é€è¿‡æ¥çš„è¯»æ¶ˆæ¯äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">readInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token comment\">// å‘é€æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token class-name\">Scanner</span> sc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token comment\">// å¦‚æœæœ‰è¾“å…¥æ¶ˆæ¯å°±æ‰§è¡Œ</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>sc<span class=\"token punctuation\">.</span><span class=\"token function\">hasNextLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token comment\">// æ¥æ”¶è¾“å…¥çš„æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token class-name\">String</span> s <span class=\"token operator\">=</span> sc<span class=\"token punctuation\">.</span><span class=\"token function\">nextLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token comment\">// è°ƒç”¨å‡½æ•°å‘é€ç»™æœåŠ¡ç«¯</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            client<span class=\"token punctuation\">.</span><span class=\"token function\">sendToServer</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendToServer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> s<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            <span class=\"token comment\">// å°†è¾“å…¥çš„æ¶ˆæ¯å†™å‡ºç»™æœåŠ¡ç«¯</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            socketChannel<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ³¢ä»”ï¼š\"</span> <span class=\"token operator\">+</span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">readInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>            <span class=\"token comment\">// å¦‚æœæœ‰äº‹ä»¶å°±ä¼šæ‰§è¡Œï¼Œä½¿ç”¨å¾ªç¯è®©å…¶ä¸æ–­åœ° è·å–æ˜¯å¦æœ‰ é€šé“äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                <span class=\"token comment\">// éå†äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> it <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">selectedKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                    <span class=\"token comment\">// æå–äº‹ä»¶ç±»å‹</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                    <span class=\"token class-name\">SelectionKey</span> sk <span class=\"token operator\">=</span> it<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                    <span class=\"token comment\">// åˆ¤æ–­æ˜¯å¦ä¸ºè¯»äº‹ä»¶ï¼Œå½“ç„¶æœåŠ¡ç«¯å‘é€è¿‡æ¥çš„éƒ½æ˜¯è¯»äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sk<span class=\"token punctuation\">.</span><span class=\"token function\">isReadable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                        <span class=\"token comment\">// å¾—åˆ°å½“å‰é€šé“</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                        <span class=\"token class-name\">SocketChannel</span> sc <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">)</span> sk<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                        <span class=\"token comment\">// åˆ›å»ºç¼“å†²åŒº</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                        <span class=\"token class-name\">ByteBuffer</span> buf <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                        <span class=\"token comment\">// å°†æ•°æ®ä»é€šé“è¯»å–åˆ°ç¼“å†²åŒº</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>                        sc<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>                        <span class=\"token comment\">// æ‰“å°è¾“å‡º trim é˜²æ­¢ æœåŠ¡ç«¯é€è¿‡æ¥ç©ºçš„å¤šä½™çš„å­—ç¬¦æ‰€ä»¥è¿›è¡Œæ¸…é™¤</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>                    <span class=\"token comment\">// äº‹ä»¶å¤„ç†å®Œæ¯•åç§»é™¤äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>                    it<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ€»ç»“ï¼š</p>\n<ol>\n<li>æ³¨å†Œé€‰æ‹©å™¨ï¼Œç«¯å£ï¼Œå®¢æˆ·ç«¯é€šé“</li>\n<li>å¾—åˆ°é€‰æ‹©å™¨ï¼Œå¾—åˆ°å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¿æ¥é€šé“ï¼Œé€šé“æ³¨å†Œä¸ºéé˜»å¡ï¼Œæ³¨å†Œè¯»äº‹ä»¶åˆ°é€‰æ‹©å™¨ä¸Š</li>\n</ol>\n<p>æ‰§è¡Œæ•ˆæœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240311093828540.png\" alt=\"image-20240311093828540\" /></p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "çŸ¥è¯†ç‚¹",
                "IO",
                "çŸ¥è¯†ç‚¹",
                "IO"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/java%E8%BD%AC.jar%E5%86%8D%E8%BD%AC.exe/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/java%E8%BD%AC.jar%E5%86%8D%E8%BD%AC.exe/",
            "title": "javaè½¬.jarå†è½¬.exe",
            "date_published": "2024-03-05T13:22:09.277Z",
            "content_html": "<h1 id=\"javaè½¬jarå†è½¬exe\"><a class=\"anchor\" href=\"#javaè½¬jarå†è½¬exe\">#</a> java è½¬.jar å†è½¬.exe</h1>\n<p>åœ¨ idea ä¸­é€‰æ‹©è¿™ä¸ª</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240305203503858.png\" alt=\"image-20240305203503858\" /></p>\n<p>ç‚¹å‡»æ–‡ä»¶å›¾æ ‡ ç­‰å¾… å‡ ç§’å å°±ä¼šåˆ—å‡º java ç±»ï¼Œç„¶åé€‰æ‹©è¦æ‰“.jar çš„ç±»</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240305203619229.png\" alt=\"image-20240305203619229\" /></p>\n<p>é€‰æ‹©åç‚¹å‡» OK</p>\n<p>ç‚¹å‡» Build Artifacts</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240305203655919.png\" alt=\"image-20240305203655919\" /></p>\n<p>ç‚¹å‡» Build</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240305203724327.png\" alt=\"image-20240305203724327\" /></p>\n<p>Build æˆåŠŸåå°±å¯ä»¥åœ¨ ç¼–è¯‘ç›®å½•ä¸­çœ‹åˆ°äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240305203755489.png\" alt=\"image-20240305203755489\" /></p>\n<p>ä¸‹é¢å°±å¯ä»¥è¿›è¡Œ è½¬.exe æ–‡ä»¶äº†ï¼Œä¸‹è½½ exe4j è¿æ¥ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZWotdGVjaG5vbG9naWVzLmNvbS9kb3dubG9hZC9leGU0ai9maWxlcw==\">https://www.ej-technologies.com/download/exe4j/files</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240305203928781.png\" alt=\"image-20240305203928781\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240305204023491.png\" alt=\"image-20240305204023491\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240305204102880.png\" alt=\"image-20240305204102880\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240305204148276.png\" alt=\"image-20240305204148276\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240305204249970.png\" alt=\"image-20240305204249970\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240305204324160.png\" alt=\"image-20240305204324160\" /></p>\n<p>å‰©ä¸‹çš„å°±ä¸€ç›´ä¸‹ä¸€æ­¥ç„¶ååœ¨æŒ‡å®šçš„ä½ç½®å°±ä¼šç”Ÿæˆç¨‹åºäº†å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240305204404979.png\" alt=\"image-20240305204404979\" /></p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "çŸ¥è¯†ç‚¹",
                "çŸ¥è¯†ç‚¹"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F/",
            "title": "Hutool-æ•°æ®è„±æ•",
            "date_published": "2024-03-04T11:18:18.182Z",
            "content_html": "<h1 id=\"æ•°æ®è„±æ•\"><a class=\"anchor\" href=\"#æ•°æ®è„±æ•\">#</a> æ•°æ®è„±æ•</h1>\n<h2 id=\"1-åŠŸèƒ½\"><a class=\"anchor\" href=\"#1-åŠŸèƒ½\">#</a> 1 åŠŸèƒ½</h2>\n<p>å¯¹åº”ä¸€äº›æ•æ„Ÿæ•°æ®è¿›è¡Œè„±æ•</p>\n<h2 id=\"2-desensitizedutilæ”¯æŒçš„è„±æ•æ•°æ®ç±»å‹\"><a class=\"anchor\" href=\"#2-desensitizedutilæ”¯æŒçš„è„±æ•æ•°æ®ç±»å‹\">#</a> 2 DesensitizedUtil æ”¯æŒçš„è„±æ•æ•°æ®ç±»å‹</h2>\n<ul>\n<li>ç”¨æˆ· id</li>\n<li>ä¸­æ–‡å§“å</li>\n<li>èº«ä»½è¯å·</li>\n<li>åº§æœºå·</li>\n<li>æ‰‹æœºå·</li>\n<li>åœ°å€</li>\n<li>ç”µå­é‚®ä»¶</li>\n<li>å¯†ç </li>\n<li>ä¸­å›½å¤§é™†è½¦ç‰Œï¼ŒåŒ…å«æ™®é€šè½¦è¾†ï¼Œæ–°èƒ½æºè½¦è¾†</li>\n<li>é“¶è¡Œå¡</li>\n</ul>\n<h2 id=\"3-ä½¿ç”¨é¢‘ç‡è¾ƒé«˜çš„æ¡ˆä¾‹\"><a class=\"anchor\" href=\"#3-ä½¿ç”¨é¢‘ç‡è¾ƒé«˜çš„æ¡ˆä¾‹\">#</a> 3 ä½¿ç”¨é¢‘ç‡è¾ƒé«˜çš„æ¡ˆä¾‹</h2>\n<h3 id=\"31-ä¸­æ–‡å§“åè„±æ•\"><a class=\"anchor\" href=\"#31-ä¸­æ–‡å§“åè„±æ•\">#</a> 3.1 ä¸­æ–‡å§“åè„±æ•</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">String</span> chineseName <span class=\"token operator\">=</span> <span class=\"token class-name\">DesensitizedUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">chineseName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å†é£é›¨\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>chineseName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¯¥ç¨‹åºçš„è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>\n<pre><code>å†**\n</code></pre>\n<h3 id=\"32-èº«ä»½è¯å·è„±æ•\"><a class=\"anchor\" href=\"#32-èº«ä»½è¯å·è„±æ•\">#</a> 3.2 èº«ä»½è¯å·è„±æ•</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">idCardNum</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">String</span> s <span class=\"token operator\">=</span> <span class=\"token class-name\">DesensitizedUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">idCardNum</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"51343620000320711X\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¯¥ç¨‹åºçš„è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>\n<pre><code>51343***********1X\n</code></pre>\n<h3 id=\"33-æ‰‹æœºå·è„±æ•\"><a class=\"anchor\" href=\"#33-æ‰‹æœºå·è„±æ•\">#</a> 3.3 æ‰‹æœºå·è„±æ•</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">mobilePhone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">String</span> s <span class=\"token operator\">=</span> <span class=\"token class-name\">DesensitizedUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">mobilePhone</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"18049531999\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¯¥ç¨‹åºçš„è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>\n<pre><code>180****1999\n</code></pre>\n<h3 id=\"34-é‚®ç®±è„±æ•\"><a class=\"anchor\" href=\"#34-é‚®ç®±è„±æ•\">#</a> 3.4 é‚®ç®±è„±æ•</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">email</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">String</span> email <span class=\"token operator\">=</span> <span class=\"token class-name\">DesensitizedUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">email</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1792561025@qq.com\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>email<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¯¥ç¨‹åºçš„è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>\n<pre><code>1*********@qq.com\n</code></pre>\n<h3 id=\"35-é“¶è¡Œå¡å·è„±æ•\"><a class=\"anchor\" href=\"#35-é“¶è¡Œå¡å·è„±æ•\">#</a> 3.5 é“¶è¡Œå¡å·è„±æ•</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">bankCard</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">String</span> bankCard <span class=\"token operator\">=</span> <span class=\"token class-name\">DesensitizedUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">bankCard</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"9559980868435875810\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>bankCard<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¯¥ç¨‹åºè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>\n<pre><code>9559 **** **** *** 5810\n</code></pre>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "ç¬¬ä¸‰æ–¹åº“",
                "java",
                "è®¡ç®—æœºå­¦ç§‘",
                "ç¬¬ä¸‰æ–¹åº“",
                "hutool"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/%E5%B7%A5%E5%85%B7%E7%B1%BB/Result%E5%B7%A5%E5%85%B7%E7%B1%BB/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/%E5%B7%A5%E5%85%B7%E7%B1%BB/Result%E5%B7%A5%E5%85%B7%E7%B1%BB/",
            "title": "Resultå·¥å…·ç±»",
            "date_published": "2024-03-04T05:45:43.743Z",
            "content_html": "<h2 id=\"å¹³å¸¸è¿”å›æ•°æ®ç»™å‰ç«¯å±•ç¤ºçš„å“åº”ç±»\"><a class=\"anchor\" href=\"#å¹³å¸¸è¿”å›æ•°æ®ç»™å‰ç«¯å±•ç¤ºçš„å“åº”ç±»\">#</a> å¹³å¸¸è¿”å›æ•°æ®ç»™å‰ç«¯å±•ç¤ºçš„å“åº”ç±»</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@NoArgsConstructor</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@AllArgsConstructor</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Result</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> code<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> message<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">T</span> data<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Result</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> data<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>code <span class=\"token operator\">=</span> <span class=\"token number\">200</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>message <span class=\"token operator\">=</span> <span class=\"token string\">\"success\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Result</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> data<span class=\"token punctuation\">,</span> <span class=\"token keyword\">boolean</span> success<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>success<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>code <span class=\"token operator\">=</span> <span class=\"token number\">200</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>message <span class=\"token operator\">=</span> <span class=\"token string\">\"success\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>code <span class=\"token operator\">=</span> <span class=\"token number\">500</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>message <span class=\"token operator\">=</span> message<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Result</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> code<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>code <span class=\"token operator\">=</span> code<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>message <span class=\"token operator\">=</span> message<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>data <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">Result</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> data<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Result</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">Result</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Result</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">Result</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> code<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Result</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"åˆ†é¡µå“åº”ç±»\"><a class=\"anchor\" href=\"#åˆ†é¡µå“åº”ç±»\">#</a> åˆ†é¡µå“åº”ç±»</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@ToString</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PageResult</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// æ•°æ®åˆ—è¡¨</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> items<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// æ€»è®°å½•æ•°</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> counts<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// å½“å‰é¡µç </span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> page<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">// æ¯é¡µè®°å½•æ•°</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> pageSize<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">PageResult</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> items<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> counts<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> page<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> pageSize<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items <span class=\"token operator\">=</span> items<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>counts <span class=\"token operator\">=</span> counts<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>page <span class=\"token operator\">=</span> page<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pageSize <span class=\"token operator\">=</span> pageSize<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åˆ†é¡µæ¥æ”¶å‚æ•°ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@AllArgsConstructor</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@NoArgsConstructor</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PageParams</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// å½“å‰é¡µç </span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> pageNo<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// æ¯é¡µæ˜¾ç¤ºè®°å½•æ•°</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> pageSize <span class=\"token operator\">=</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">.</span><span class=\"token constant\">MAX_VALUE</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "å·¥å…·ç±»",
                "java",
                "è®¡ç®—æœºå­¦ç§‘",
                "å·¥å…·ç±»"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/%E5%AF%B9%E8%B1%A1/this%E9%80%83%E9%80%B8/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/%E5%AF%B9%E8%B1%A1/this%E9%80%83%E9%80%B8/",
            "title": "Thiså¼•ç”¨é€ƒé€¸è¯¦è§£",
            "date_published": "2024-03-04T05:04:04.787Z",
            "content_html": "<h1 id=\"ä¸€-thiså¼•ç”¨é€ƒé€¸\"><a class=\"anchor\" href=\"#ä¸€-thiså¼•ç”¨é€ƒé€¸\">#</a> ä¸€ã€This å¼•ç”¨é€ƒé€¸</h1>\n<h2 id=\"1-ä»€ä¹ˆæ˜¯thisé€ƒé€¸\"><a class=\"anchor\" href=\"#1-ä»€ä¹ˆæ˜¯thisé€ƒé€¸\">#</a> 1 ä»€ä¹ˆæ˜¯ This é€ƒé€¸</h2>\n<p>åœ¨æ„é€ å™¨è¿˜æœªå½»åº•å®Œæˆå‰ (å³å®ä¾‹åˆå§‹åŒ–é˜¶æ®µè¿˜æœªå®Œæˆ)ï¼Œå°†è‡ªèº« this å¼•ç”¨å‘å¤–æŠ›å‡ºå¹¶è¢«å…¶å®ƒçº¿ç¨‹å¤åˆ¶ (è®¿é—®) äº†è¯¥å¼•ç”¨ï¼Œå¯èƒ½ä¼šè®¿é—®åˆ°è¿˜æœªè¢«åˆå§‹åŒ–çš„å˜é‡ï¼Œç”šè‡³å¯èƒ½ä¼šé€ æˆæ›´å¤§ä¸¥é‡çš„é—®é¢˜ã€‚</p>\n<p>ä»£ç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  * æ¨¡æ‹Ÿ this é€ƒé€¸</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  * @author Lijian</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  *</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ThisEscape</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token comment\">//final å¸¸é‡ä¼šä¿è¯åœ¨æ„é€ å™¨å†…å®Œæˆåˆå§‹åŒ–ï¼ˆä½†æ˜¯ä»…é™äºæœªå‘ç”Ÿ this é€ƒé€¸çš„æƒ…å†µä¸‹ï¼Œå…·ä½“å¯ä»¥çœ‹å¤šçº¿ç¨‹å¯¹ final ä¿è¯å¯è§æ€§çš„å®ç°ï¼‰</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> i<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">// å°½ç®¡å®ä¾‹å˜é‡æœ‰åˆå§‹å€¼ï¼Œä½†æ˜¯è¿˜å®ä¾‹åŒ–å®Œæˆ</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token keyword\">static</span> <span class=\"token class-name\">ThisEscape</span> obj<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token class-name\">ThisEscape</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      i<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      j<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token comment\">// å°† this é€ƒé€¸æŠ›å‡ºç»™çº¿ç¨‹ B</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      obj <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token comment\">// çº¿ç¨‹ Aï¼šæ¨¡æ‹Ÿæ„é€ å™¨ä¸­ this é€ƒé€¸ï¼Œå°†æœªæ„é€ å®Œå…¨å¯¹è±¡å¼•ç”¨æŠ›å‡º</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token comment\">/*Thread threadA = new Thread(new Runnable() &#123;</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>             @Override</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>             public void run() &#123;</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                 //obj = new ThisEscape();</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>             &#125;</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>         &#125;);*/</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token comment\">// çº¿ç¨‹ Bï¼šè¯»å–å¯¹è±¡å¼•ç”¨ï¼Œè®¿é—® i/j å˜é‡</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token class-name\">Thread</span> threadB <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>         <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>         <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token number\">31</span>                 <span class=\"token comment\">// å¯èƒ½ä¼šå‘ç”Ÿåˆå§‹åŒ–å¤±è´¥çš„æƒ…å†µè§£é‡Šï¼šå®ä¾‹å˜é‡ i çš„åˆå§‹åŒ–è¢«é‡æ’åºåˆ°æ„é€ å™¨å¤–ï¼Œæ­¤æ—¶ 1 è¿˜æœªè¢«åˆå§‹åŒ–</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>               <span class=\"token class-name\">ThisEscape</span> objB <span class=\"token operator\">=</span> obj<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>               <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>objB<span class=\"token punctuation\">.</span>j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">NullPointerException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>               <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å‘ç”Ÿç©ºæŒ‡é’ˆé”™è¯¯ï¼šæ™®é€šå˜é‡jæœªè¢«åˆå§‹åŒ–\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>               <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>objB<span class=\"token punctuation\">.</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">NullPointerException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>               <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å‘ç”Ÿç©ºæŒ‡é’ˆé”™è¯¯ï¼šfinalå˜é‡iæœªè¢«åˆå§‹åŒ–\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>      <span class=\"token comment\">//threadA.start();</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      threadB<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p>\n<pre><code>å‘ç”Ÿç©ºæŒ‡é’ˆé”™è¯¯ï¼šæ™®é€šå˜é‡jæœªè¢«åˆå§‹åŒ–\nå‘ç”Ÿç©ºæŒ‡é’ˆé”™è¯¯ï¼šfinalå˜é‡iæœªè¢«åˆå§‹åŒ–\n</code></pre>\n<p>è¿™è¯´æ˜ ThisEscape è¿˜æœªå®Œæˆå®ä¾‹åŒ–ï¼Œæ„é€ è¿˜æœªå½»åº•ç»“æŸã€‚</p>\n<p>å¦ä¸€ç§æƒ…å†µæ˜¯åˆ©ç”¨çº¿ç¨‹ A æ¨¡æ‹Ÿ this é€ƒé€¸ï¼Œä½†ä¸ä¸€å®šä¼šå‘ç”Ÿï¼Œçº¿ç¨‹ A æ¨¡æ‹Ÿæ„é€ å™¨æ­£åœ¨æ„é€ ... è€Œçº¿ç¨‹ B å°è¯•è®¿é—®å˜é‡ï¼Œè¿™æ˜¯å› ä¸º</p>\n<ol>\n<li>ç”±äº JVM çš„æŒ‡ä»¤é‡æ’åºå­˜åœ¨ï¼Œå®ä¾‹å˜é‡ i çš„åˆå§‹åŒ–è¢«å®‰æ’åˆ°æ„é€ å™¨å¤– (final å¯è§æ€§ä¿è¯æ˜¯ final å˜é‡è§„å®šåœ¨æ„é€ å™¨ä¸­å®Œæˆçš„)</li>\n<li>ç±»ä¼¼äº this é€ƒé€¸ï¼Œçº¿ç¨‹ A ä¸­æ„é€ å™¨è¿˜æœªå®Œå…¨å®Œæˆ</li>\n</ol>\n<p>æ‰€ä»¥å°è¯•å¤šæ¬¡è¾“å‡º (ç›¸ä¿¡æˆ‘ä¸€å®šä¼šå‘ç”Ÿçš„ï¼Œåªæ˜¯æ¦‚ç‡ç›¸å¯¹ä½)ï¼Œä¹Ÿä¼šå‘ç”Ÿç±»ä¼¼ this å¼•ç”¨é€ƒé€¸çš„æƒ…å†µ</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  * æ¨¡æ‹Ÿ this é€ƒé€¸</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  * @author Lijian</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  *</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ThisEscape</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token comment\">//final å¸¸é‡ä¼šä¿è¯åœ¨æ„é€ å™¨å†…å®Œæˆåˆå§‹åŒ–ï¼ˆä½†æ˜¯ä»…é™äºæœªå‘é€ this é€ƒé€¸çš„æƒ…å†µä¸‹ï¼‰</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> i<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">// å°½ç®¡å®ä¾‹å˜é‡æœ‰åˆå§‹å€¼ï¼Œä½†æ˜¯è¿˜å®ä¾‹åŒ–å®Œæˆ</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token keyword\">static</span> <span class=\"token class-name\">ThisEscape</span> obj<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token class-name\">ThisEscape</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      i<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      j<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token comment\">//obj = this ;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token comment\">// çº¿ç¨‹ Aï¼šæ¨¡æ‹Ÿæ„é€ å™¨ä¸­ this é€ƒé€¸ï¼Œå°†æœªæ„é€ å®Œå…¨å¯¹è±¡å¼•ç”¨æŠ›å‡º</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token class-name\">Thread</span> threadA <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>         <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>         <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token comment\">// æ„é€ åˆå§‹åŒ–ä¸­... çº¿ç¨‹ B å¯èƒ½è·å–åˆ°è¿˜æœªè¢«åˆå§‹åŒ–å®Œæˆçš„å˜é‡</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">// ç±»ä¼¼äº this é€ƒé€¸ï¼Œä½†å¹¶ä¸å®šå‘ç”Ÿ</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            obj <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ThisEscape</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token comment\">// çº¿ç¨‹ Bï¼šè¯»å–å¯¹è±¡å¼•ç”¨ï¼Œè®¿é—® i/j å˜é‡</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token class-name\">Thread</span> threadB <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>         <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>         <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token comment\">// å¯èƒ½ä¼šå‘ç”Ÿåˆå§‹åŒ–å¤±è´¥çš„æƒ…å†µè§£é‡Šï¼šå®ä¾‹å˜é‡ i çš„åˆå§‹åŒ–è¢«é‡æ’åºåˆ°æ„é€ å™¨å¤–ï¼Œæ­¤æ—¶ 1 è¿˜æœªè¢«åˆå§‹åŒ–</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token class-name\">ThisEscape</span> objB <span class=\"token operator\">=</span> obj<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>               <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>objB<span class=\"token punctuation\">.</span>j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">NullPointerException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>               <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å‘ç”Ÿç©ºæŒ‡é’ˆé”™è¯¯ï¼šæ™®é€šå˜é‡jæœªè¢«åˆå§‹åŒ–\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>               <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>objB<span class=\"token punctuation\">.</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">NullPointerException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>               <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å‘ç”Ÿç©ºæŒ‡é’ˆé”™è¯¯ï¼šfinalå˜é‡iæœªè¢«åˆå§‹åŒ–\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      threadA<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>      threadB<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"12-ä»€ä¹ˆæƒ…å†µä¸‹ä¼šthisé€ƒé€¸\"><a class=\"anchor\" href=\"#12-ä»€ä¹ˆæƒ…å†µä¸‹ä¼šthisé€ƒé€¸\">#</a> 1.2 ä»€ä¹ˆæƒ…å†µä¸‹ä¼š This é€ƒé€¸ï¼Ÿ</h2>\n<ol>\n<li>åœ¨æ„é€ å™¨ä¸­å¾ˆæ˜æ˜¾çš„æŠ›å‡º this å¼•ç”¨æä¾›å…¶å®ƒçº¿ç¨‹ä½¿ç”¨ (å¦‚ä¸Šè¿°çš„æ˜æ˜¾å°† this æŠ›å‡º)</li>\n<li>åœ¨æ„é€ å™¨ä¸­å†…éƒ¨ç±»ä½¿ç”¨å¤–éƒ¨æƒ…å†µï¼šå†…éƒ¨ç±»è®¿é—®å¤–éƒ¨ç±»æ˜¯æ²¡æœ‰ä»»ä½•æ¡ä»¶çš„ï¼Œä¹Ÿä¸è¦ä»»ä½•ä»£ä»·ï¼Œä¹Ÿå°±é€ æˆäº†å½“å¤–éƒ¨ç±»è¿˜æœªåˆå§‹åŒ–å®Œæˆçš„æ—¶å€™ï¼Œå†…éƒ¨ç±»å°±å°è¯•è·å–æœªåˆå§‹åŒ–å®Œæˆçš„å˜é‡\n<ul>\n<li>åœ¨æ„é€ å™¨ä¸­å¯åŠ¨çº¿ç¨‹ï¼šå¯åŠ¨çš„çº¿ç¨‹ä»»åŠ¡æ˜¯å†…éƒ¨ç±»ï¼Œåœ¨å†…éƒ¨ç±»ä¸­ xxx.this è®¿é—®äº†å¤–éƒ¨ç±»å®ä¾‹ï¼Œå°±ä¼šå‘ç”Ÿè®¿é—®åˆ°è¿˜æœªåˆå§‹åŒ–å®Œæˆçš„å˜é‡</li>\n<li>åœ¨æ„é€ å™¨ä¸­æ³¨å†Œäº‹ä»¶ï¼Œè¿™æ˜¯å› ä¸ºåœ¨æ„é€ å™¨ä¸­ç›‘å¬äº‹ä»¶æ˜¯æœ‰å›è°ƒå‡½æ•° (å¯èƒ½è®¿é—®äº†æ“ä½œå®ä¾‹å˜é‡)ï¼Œè€Œäº‹ä»¶ç›‘å¬ä¸€èˆ¬éƒ½æ˜¯å¼‚æ­¥çš„ã€‚åœ¨è¿˜æœªåˆå§‹åŒ–å®Œæˆä¹‹å‰å°±å¯èƒ½å‘ç”Ÿä¼šå›è°ƒè®¿é—®äº†æœªåˆå§‹åŒ–çš„å˜é‡ã€‚</li>\n</ul>\n</li>\n</ol>\n<p>åœ¨æ„é€ å™¨ä¸­å¯åŠ¨çº¿ç¨‹ä»£ç å®ç°ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  * æ¨¡æ‹Ÿ this é€ƒé€¸ 2ï¼šæ„é€ å™¨ä¸­å¯åŠ¨çº¿ç¨‹</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  * @author Lijian</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  *</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ThisEscape2</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> i<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token keyword\">int</span> j<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token class-name\">ThisEscape2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      j <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RunablTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token comment\">// å†…éƒ¨ç±»å®ç° Runnableï¼šå¼•ç”¨å¤–éƒ¨ç±»</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RunablTest</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>         <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ThisEscape2</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">NullPointerException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å‘ç”Ÿç©ºæŒ‡é’ˆé”™è¯¯ï¼šæ™®é€šå˜é‡jæœªè¢«åˆå§‹åŒ–\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>         <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ThisEscape2</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">NullPointerException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å‘ç”Ÿç©ºæŒ‡é’ˆé”™è¯¯ï¼šfinalå˜é‡iæœªè¢«åˆå§‹åŒ–\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token keyword\">new</span> <span class=\"token class-name\">ThisEscape2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ„é€ å™¨ä¸­æ³¨å†Œäº‹ä»¶ï¼Œå¼•ç”¨ç½‘ä¸Šçš„ä¸€æ®µä¼ªä»£ç å°†ä»¥è§£é‡Šï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ThisEscape3</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token keyword\">var</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ThisEscape3</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">EventSource</span> source<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>ã€€ã€€ã€€ã€€ <span class=\"token comment\">// æ³¨å†Œäº‹ä»¶ï¼Œä¼šä¸€ç›´ç›‘å¬ï¼Œå½“å‘ç”Ÿäº‹ä»¶ e æ—¶ï¼Œä¼šæ‰§è¡Œå›è°ƒå‡½æ•° doSomething</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        source<span class=\"token punctuation\">.</span><span class=\"token function\">registerListener</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class=\"token comment\">// åŒ¿åå†…éƒ¨ç±»å®ç°</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">new</span> <span class=\"token class-name\">EventListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onEvent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Event</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ <span class=\"token comment\">// æ­¤æ—¶ ThisEscape3 å¯èƒ½è¿˜æœªåˆå§‹åŒ–å®Œæˆï¼Œvar å¯èƒ½è¿˜æœªè¢«èµ‹å€¼ï¼Œè‡ªç„¶å°±å‘ç”Ÿä¸¥é‡é”™è¯¯</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                    <span class=\"token function\">doSomething</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">var</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">// åœ¨å›è°ƒå‡½æ•°ä¸­è®¿é—®å˜é‡</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">int</span> <span class=\"token function\">doSomething</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Event</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">var</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"13-æ€æ ·é¿å…thisé€ƒé€¸\"><a class=\"anchor\" href=\"#13-æ€æ ·é¿å…thisé€ƒé€¸\">#</a> 1.3 æ€æ ·é¿å… This é€ƒé€¸ï¼Ÿ</h2>\n<p>1 å•ç‹¬ç¼–å†™ä¸€ä¸ªå¯åŠ¨çº¿ç¨‹çš„æ–¹æ³•ï¼Œä¸è¦åœ¨æ„é€ å™¨ä¸­å¯åŠ¨çº¿ç¨‹ï¼Œå°è¯•åœ¨å¤–éƒ¨å¯åŠ¨ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">Thread</span> t<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">ThisEscape2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    t <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">EscapeRunnable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initStart</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    t<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>2 å°†äº‹ä»¶ç›‘å¬æ”¾ç½®äºæ„é€ å™¨å¤–ï¼Œæ¯”å¦‚ new Object () çš„æ—¶å€™å°±å¯åŠ¨äº‹ä»¶ç›‘å¬ï¼Œä½†æ˜¯åœ¨æ„é€ å™¨å†…ä¸èƒ½ä½¿ç”¨äº‹ä»¶ç›‘å¬ï¼Œé‚£å¯ä»¥åœ¨ static {} ä¸­åŠ äº‹ä»¶ç›‘å¬ï¼Œè¿™æ ·å°±è·Ÿæ„é€ å™¨è§£è€¦äº†</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">static</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    source<span class=\"token punctuation\">.</span><span class=\"token function\">registerListener</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            <span class=\"token keyword\">new</span> <span class=\"token class-name\">EventListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onEvent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Event</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                    <span class=\"token function\">doSomething</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">var</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"14-æ€»ç»“\"><a class=\"anchor\" href=\"#14-æ€»ç»“\">#</a> 1.4 æ€»ç»“</h2>\n<p>this å¼•ç”¨é€ƒé€¸é—®é¢˜å®åˆ™æ˜¯ Java å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­éœ€è¦æ³¨æ„çš„é—®é¢˜ï¼Œå¼•èµ·é€ƒé€¸çš„åŸå› æ— éå°±æ˜¯åœ¨å¤šçº¿ç¨‹çš„ç¼–ç¨‹ä¸­ â€œæ»¥ç”¨â€ å¼•ç”¨ï¼ˆå¾€å¾€æ¶‰åŠæ„é€ å™¨ä¸­æ˜¾å¼æˆ–éšå¼åœ°æ»¥ç”¨ this å¼•ç”¨ï¼‰ï¼Œåœ¨ä½¿ç”¨åˆ° this å¼•ç”¨çš„æ—¶å€™éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼</p>\n<p>åŒæ—¶è¿™ä¼šæ¶‰åŠåˆ°ï¼šfinal çš„å†…å­˜è¯­ä¹‰ï¼Œå³ final åŸŸç¦æ­¢é‡æ’åºé—®é¢˜ï¼ˆ2020.11.22 å¢åŠ ï¼‰ï¼ŒåŒ…æ‹¬å†™ final åŸŸä¸è¯» final åŸŸé‡æ’åºä¸¤ä¸ªè§„åˆ™ï¼ˆå‚è€ƒèµ„æ–™ã€ŠJava å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹ï¼‰</p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "çŸ¥è¯†ç‚¹",
                "å¯¹è±¡",
                "çŸ¥è¯†ç‚¹",
                "å¯¹è±¡"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/%E5%A4%9A%E7%BA%BF%E7%A8%8B/join()%E6%96%B9%E6%B3%95%E7%9A%84%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/%E5%A4%9A%E7%BA%BF%E7%A8%8B/join()%E6%96%B9%E6%B3%95%E7%9A%84%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/",
            "title": "join()æ–¹æ³•çš„è¯¦ç»†åˆ†æ",
            "date_published": "2024-03-04T01:31:50.763Z",
            "content_html": "<h1 id=\"joinæ–¹æ³•çš„è¯¦ç»†åˆ†æ\"><a class=\"anchor\" href=\"#joinæ–¹æ³•çš„è¯¦ç»†åˆ†æ\">#</a> join () æ–¹æ³•çš„è¯¦ç»†åˆ†æ</h1>\n<p>æœ¬æ–‡ç« æ¥æ¢è®¨ ç³»ç»Ÿä¸­è¿è¡Œå¤šä¸ªçº¿ç¨‹æ—¶ï¼Œjoin () åˆ°åº•æ˜¯æš‚åœäº†é‚£äº›çº¿ç¨‹</p>\n<p><strong>ç»“è®º</strong>ï¼šA.join () æ–¹æ³•åªä¼šä½¿ä¸»çº¿ç¨‹ (æˆ–è€…æˆ–è°ƒç”¨ A.join () çš„çº¿ç¨‹) è¿›å…¥ç­‰å¾…æ± å¹¶ç­‰å¾… A çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰ä¼šè¢«å”¤é†’ã€‚å¹¶ä¸å½±å“åŒä¸€æ—¶åˆ»å¤„åœ¨è¿è¡ŒçŠ¶æ€çš„å…¶å®ƒçº¿ç¨‹</p>\n<p>ä»£ç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Demo01</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">DemoT</span> <span class=\"token class-name\">A</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DemoT</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">DemoT</span> <span class=\"token class-name\">B</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DemoT</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"B\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">A</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">B</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">DemoT</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Thread</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DemoT</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" - \"</span> <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœ</p>\n<pre><code>B - 1\nA - 1\nB - 2\nA - 2\nB - 3\nA - 3\nB - 4\nA - 4\nB - 5\nA - 5\n</code></pre>\n<p>å¯ä»¥çœ‹å‡º A çº¿ç¨‹å’Œ B çº¿ç¨‹æ˜¯äº¤æ›¿æ‰§è¡Œçš„ã€‚</p>\n<p>è€Œåœ¨å…¶ä¸­åŠ å…¥ join () æ–¹æ³•åï¼Œä»£ç å¦‚ä¸‹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Demo01</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">DemoT</span> <span class=\"token class-name\">A</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DemoT</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">DemoT</span> <span class=\"token class-name\">B</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DemoT</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"B\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">A</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token class-name\">A</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">B</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">DemoT</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Thread</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DemoT</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" - \"</span> <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœ</p>\n<pre><code>A - 1\nA - 2\nA - 3\nA - 4\nA - 5\nB - 1\nB - 2\nB - 3\nB - 4\nB - 5\n</code></pre>\n<p>æ˜¾ç„¶ï¼Œä½¿ç”¨ A.join () ä¹‹åï¼ŒB çº¿ç¨‹éœ€è¦ç­‰å¾… A çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰èƒ½æ‰§è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒA.join () éœ€è¦ç­‰ A.start () æ‰§è¡Œä¹‹åæ‰æœ‰æ•ˆæœï¼Œæ­¤å¤–ï¼Œå¦‚æœ A.join () æ”¾åœ¨ B.start () ä¹‹åçš„è¯ï¼Œæ‰”ç„¶ä¼šæ˜¯äº¤æ›¿æ‰§è¡Œï¼Œç„¶è€Œå¹¶æ²¡æœ‰æ•ˆæœï¼Œè¿™ç‚¹å°±å¾ˆå›°æƒ‘äº†</p>\n<p>ä»£ç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Demo01</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">DemoT</span> <span class=\"token class-name\">A</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DemoT</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">DemoT</span> <span class=\"token class-name\">B</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DemoT</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"B\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">A</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">B</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token class-name\">A</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">DemoT</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Thread</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DemoT</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" - \"</span> <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœ</p>\n<pre><code>A - 1\nB - 1\nA - 2\nB - 2\nA - 3\nB - 3\nA - 4\nB - 4\nA - 5\nB - 5\n</code></pre>\n<p>ä¸ºäº†æ·±å…¥ç†è§£ï¼Œæˆ‘ä»¬çœ‹ä¸‹ join () çš„æºç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     * Waits for this thread to die.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     * &lt;p> An invocation of this method behaves in exactly the same</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     * way as the invocation</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     * &lt;blockquote></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>     * &#123;@linkplain #join(long) join&#125;&#123;@code (0)&#125;</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>     * &lt;/blockquote></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>     * @throws  InterruptedException</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     *          if any thread has interrupted the current thread. The</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>     *          &lt;i>interrupted status&lt;/i> of the current thread is</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>     *          cleared when this exception is thrown.</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">void</span> <span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>            <span class=\"token comment\">//join () ç­‰åŒäº join (0)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>     * Waits at most &#123;@code millis&#125; milliseconds for this thread to</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>     * die. A timeout of &#123;@code 0&#125; means to wait forever.</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>     * &lt;p> This implementation uses a loop of &#123;@code this.wait&#125; calls</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>     * conditioned on &#123;@code this.isAlive&#125;. As a thread terminates the</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>     * &#123;@code this.notifyAll&#125; method is invoked. It is recommended that</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>     * applications not use &#123;@code wait&#125;, &#123;@code notify&#125;, or</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>     * &#123;@code notifyAll&#125; on &#123;@code Thread&#125; instances.</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>     * @param  millis</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>     *         the time to wait in milliseconds</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>     * @throws  IllegalArgumentException</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>     *          if the value of &#123;@code millis&#125; is negative</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>     * @throws  InterruptedException</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>     *          if any thread has interrupted the current thread. The</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>     *          &lt;i>interrupted status&lt;/i> of the current thread is</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>     *          cleared when this exception is thrown.</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">synchronized</span> <span class=\"token keyword\">void</span> <span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span> millis<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>   <span class=\"token keyword\">long</span> base <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>   <span class=\"token keyword\">long</span> now <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>millis <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"timeout value is negative\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>millis <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isAlive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>         <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">//join (0) ç­‰åŒäº wait (0)ï¼Œå³ wait æ— é™æ—¶é—´ç›´åˆ°è¢« notify</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>      <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isAlive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>         <span class=\"token keyword\">long</span> delay <span class=\"token operator\">=</span> millis <span class=\"token operator\">-</span> now<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>delay <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>         <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span>delay<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>         now <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> base<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œjoin () æ–¹æ³•çš„åº•å±‚æ˜¯åˆ©ç”¨ wait () æ–¹æ³•å®ç°çš„ã€‚å¯ä»¥çœ‹å‡º join () æ–¹æ³•æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ï¼Œå½“ä¸»çº¿ç¨‹è°ƒç”¨ A.join () æ–¹æ³•æ—¶ï¼Œä¸»çº¿ç¨‹å…ˆè·å¾—äº† A å¯¹è±¡çš„é”ï¼Œéšåè¿›å…¥æ–¹æ³•ï¼Œè°ƒç”¨äº† A å¯¹è±¡çš„ wait () æ–¹æ³•ï¼Œä½¿ä¸»çº¿ç¨‹è¿›å…¥äº† A å¯¹è±¡çš„ç­‰å¾…æ± ï¼Œæ­¤æ—¶ï¼ŒA çº¿ç¨‹åˆ™è¿˜åœ¨æ‰§è¡Œï¼Œå¹¶ä¸”éšå B.start () è¿˜æ²¡è¢«æ‰§è¡Œï¼Œå› æ­¤ï¼ŒB çº¿ç¨‹ä¹Ÿè¿˜æ²¡å¼€å§‹ã€‚ç­‰å¾… A çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œèµ°åˆ°äº† B.strt ()ï¼ŒB çº¿ç¨‹æ‰ä¼šå¼€å§‹æ‰§è¡Œã€‚</p>\n<p>æ­¤å¤–ï¼Œå¯¹äº join () çš„ä½ç½®å’Œä½œç”¨å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„ä¾‹å­æ¥åˆ†æï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Demo01</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" start\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">DemoT</span> <span class=\"token class-name\">A</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DemoT</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">DemoT</span> <span class=\"token class-name\">B</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DemoT</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"B\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">DemoT</span> <span class=\"token class-name\">C</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DemoT</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"C\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A start\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">A</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"B start\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">B</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"C start\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">C</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" end\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">DemoT</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Thread</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DemoT</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" - \"</span> <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœ</p>\n<pre><code>main start\nA start\nB start\nC start\nA - 1\nmain end\nB - 1\nC - 1\nA - 2\nC - 2\nB - 2\nC - 3\nA - 3\nC - 4\nB - 3\nC - 5\nA - 4\nA - 5\nB - 4\nB - 5\n</code></pre>\n<p>æ­¤æ—¶ Aï¼ŒBï¼ŒC å’Œä¸»çº¿ç¨‹äº¤æ›¿è¿è¡Œï¼ŒåŠ å…¥ join () æ–¹æ³•å</p>\n<p>ä»£ç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Demo01</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" start\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">DemoT</span> <span class=\"token class-name\">A</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DemoT</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">DemoT</span> <span class=\"token class-name\">B</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DemoT</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"B\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">DemoT</span> <span class=\"token class-name\">C</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DemoT</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"C\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A start\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">A</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"B start\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">B</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">A</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"C start\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">C</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" end\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">DemoT</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Thread</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DemoT</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" - \"</span> <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœ</p>\n<pre><code>main start\nA start\nB start\nA - 1\nB - 1\nA - 2\nB - 2\nA - 3\nB - 3\nA - 4\nB - 4\nA - 5\nB - 5\nC start\nmain end\nC - 1\nC - 2\nC - 3\nC - 4\nC - 5\n</code></pre>\n<p>å¤šæ¬¡è¯•éªŒå¯ä»¥çœ‹å‡ºï¼Œä¸»çº¿ç¨‹åœ¨ A.join () æ–¹æ³•å¤„åœæ­¢ï¼Œå¹¶éœ€è¦ç­‰å¾… A çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åæ‰ä¼šæ‰§è¡Œ C.start ()ï¼Œç„¶è€Œï¼Œå¹¶ä¸å½±å“ B çº¿ç¨‹çš„æ‰§è¡Œã€‚å› æ­¤ï¼Œå¯ä»¥å¾—å‡ºç»“è®ºï¼ŒA.join () æ–¹æ³•åªä¼šä½¿ä¸»çº¿ç¨‹è¿›å…¥ç­‰å¾…æ± å¹¶ç­‰å¾… A çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åæ‰ä¼šè¢«å”¤é†’ã€‚å¹¶ä¸å½±å“åŒä¸€æ—¶åˆ»å¤„åœ¨è¿è¡ŒçŠ¶æ€çš„å…¶å®ƒçº¿ç¨‹ã€‚</p>\n<p>PS: join æºç ä¸­ï¼Œåªä¼šè°ƒç”¨ wait æ–¹æ³•ï¼Œå¹¶æ²¡æœ‰åœ¨ç»“æŸæ—¶è°ƒç”¨ notifyï¼Œè¿™æ˜¯å› ä¸ºçº¿ç¨‹åœ¨æ¶ˆäº¡ (ç»“æŸ) çš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨è‡ªèº«çš„ notifyAll æ–¹æ³•ï¼Œæ¥é‡Šæ”¾æ‰€æœ‰çš„èµ„æºå’Œé”ã€‚</p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "çŸ¥è¯†ç‚¹",
                "å¤šçº¿ç¨‹",
                "å¤šçº¿ç¨‹",
                "çŸ¥è¯†ç‚¹"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/tools/%E5%89%8D%E7%AB%AF/alova/",
            "url": "https://pigpigletsgo.github.io/tools/%E5%89%8D%E7%AB%AF/alova/",
            "title": "alova",
            "date_published": "2024-03-03T09:03:35.032Z",
            "content_html": "<h1 id=\"alova\"><a class=\"anchor\" href=\"#alova\">#</a> alova</h1>\n<h2 id=\"æ”¹å˜axiosçš„ç”¨æ³•åæˆ‘çš„å·¥ä½œæ•ˆç‡æå‡äº†3å€\"><a class=\"anchor\" href=\"#æ”¹å˜axiosçš„ç”¨æ³•åæˆ‘çš„å·¥ä½œæ•ˆç‡æå‡äº†3å€\">#</a> æ”¹å˜ axios çš„ç”¨æ³•åï¼Œæˆ‘çš„å·¥ä½œæ•ˆç‡æå‡äº† 3 å€</h2>\n<p>å®é™…åœºæ™¯ä¸‹çš„è¯·æ±‚é—®é¢˜</p>\n<p>ä½œä¸ºå‰ç«¯å¼€å‘ï¼Œç½‘ç»œè¯·æ±‚è‚¯å®šæ˜¯æˆ‘ä»¬ç»å¸¸è¦é¢å¯¹çš„äº‹æƒ…ï¼Œåœ¨å‰ç«¯è¯·æ±‚ä¸­ï¼Œaxios å’Œ fetch API åº”è¯¥æ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„è¯·æ±‚å·¥å…·äº†ï¼Œå®ƒä»¬åœ¨å‘é€è¯·æ±‚å’Œæ¥æ”¶å“åº”æ•°æ®å·²ç»åšåˆ°äº†è¶³å¤Ÿç®€å•ã€‚</p>\n<p>ä½†åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä¸ºäº†è¾¾åˆ°æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘ä¸‹é¢è¿™å‡ ä¸ªå› ç´ ï¼š</p>\n<ol>\n<li>å±•ç¤ºåŠ è½½ä¸­çš„è¯·æ±‚çŠ¶æ€</li>\n<li>å±•ç¤ºè¯·æ±‚é”™è¯¯çŠ¶æ€</li>\n<li>å±•ç¤ºä¸Šä¼  / ä¸‹è½½æ–‡ä»¶çš„è¿›åº¦ä¿¡æ¯</li>\n</ol>\n<p>ä¸Šé¢è¿™äº›éƒ½éœ€è¦æˆ‘ä»¬ç¼–å†™é¢å¤–çš„ä»£ç ï¼Œå¢åŠ äº†ä¸å°‘çš„å·¥ä½œé‡ï¼Œä½ çš„è¯·æ±‚ä»£ç å¯èƒ½æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼Œæˆ‘ä»¬ä»¥ vue3 ä»£ç ä¸ºç¤ºä¾‹ã€‚</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> loading <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> error <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">request</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span>  </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    loading<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    data<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/xxx'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>  </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    error<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> e<span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  loading<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token function\">onMounted</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>å¦‚æœé¢å¯¹å¤§é‡çš„ apiï¼Œè¿™å·¥ä½œé‡å¯æƒ³è€ŒçŸ¥ï¼Œæƒ³åˆ°è¿™æ—¶å°±æœ‰ç‚¹å¤´ç–¼å•Šã€‚æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥è‡ªåŠ¨å¸®æˆ‘å¤„ç†è¿™äº›é€»è¾‘ï¼Œè®©è¯·æ±‚ä»£ç çœ‹èµ·æ¥æ›´ç®€æ´å‘¢ï¼Ÿ</p>\n<p>è§£å†³</p>\n<p>æˆ‘ä»¬å¯ä»¥ç”¨å°è£…çš„æ€è·¯ï¼ŒæŠŠä¸Šé¢è¿™äº›éƒ½å°è£…ä¸ºä¸€ä¸ªç®€å•çš„ use hookï¼Œå°±å¯ä»¥å¾ˆå¥½åœ°è§£å†³äº†ï¼Œå°è£…åçš„ä»£ç å¤§æ¦‚æ˜¯ä¸‹é¢è¿™æ ·çš„ã€‚</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useRequest</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">url</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token keyword\">const</span> loading <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">const</span> error <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">request</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      loading<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      data<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      error<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> e<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    loading<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token function\">onMounted</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    loading<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    data<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    error</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„ use hook å®ç°ï¼Œå®ƒå¸®æˆ‘ä»¬è§£å†³äº†è¯·æ±‚æ¨¡æ¿ä»£ç çš„é—®é¢˜ã€‚å½“ç„¶ä½ è¿˜å¯ä»¥ä½¿ç”¨ use hook å°è£…æ›´å¤šæ›´é«˜çº§çš„è¯·æ±‚åŠŸèƒ½ï¼Œè€Œè¿™äº›åŠŸèƒ½ç°åœ¨ä¸å¿…ä½ è‡ªå·±å°è£…äº†ï¼Œä½¿ç”¨<span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmp1ZWppbi5jbi8/dGFyZ2V0PWh0dHBzJTNBJTJGJTJGYWxvdmEuanMub3Jn\"> alova</span> å°±å¯ä»¥äº†ã€‚</p>\n<p><strong>alova æ˜¯ä¸€ä¸ªè½»é‡çº§çš„è¯·æ±‚ç­–ç•¥åº“ï¼Œé’ˆå¯¹åˆ†é¡µè¯·æ±‚ã€è¡¨å•æäº¤ã€ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶ç­‰ä¸åŒè¯·æ±‚åœºæ™¯ä½¿ç”¨å¯¹åº”çš„è¯·æ±‚æ¨¡å—ï¼Œè®©å¼€å‘è€…ä½¿ç”¨éå¸¸å°‘é‡çš„ä»£ç å°±å¯ä»¥å®ç°é«˜å¯ç”¨æ€§å’Œé«˜æµç•…æ€§çš„è¯·æ±‚åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€ï¼Œä½ å†ä¹Ÿä¸éœ€è¦è‡ªå·±ç»å°½è„‘æ±ç¼–å†™è¯·æ±‚ä¼˜åŒ–ä»£ç ï¼Œå†ä¹Ÿä¸éœ€è¦è‡ªå·±ç»´æŠ¤è¯·æ±‚æ•°æ®å’Œç›¸å…³çŠ¶æ€ï¼Œä½ åªéœ€è¦é€‰æ‹©å¹¶ä½¿ç”¨è¯·æ±‚æ¨¡å—ï¼Œè®¾ç½®å‚æ•°åï¼Œalova å¸®ä½ æå®šï¼</strong></p>\n<p>åœ¨å¼•å…¥ alova åï¼Œæˆ‘çš„å·¥ä½œæ•ˆç‡ç›´æ¥æé«˜äº† 3 å€ï¼Œå¼ºçƒˆæ¨èç»™å¤§å®¶ã€‚</p>\n<p>ä½ å¯ä»¥å°† alova ç†è§£æˆæ˜¯ axios æˆ– fetch-api ç­‰è¯·æ±‚å·¥å…·çš„ä¸€ç§æ­¦å™¨è£…å¤‡ï¼Œå°† alova ä¸è¯·æ±‚å·¥å…·é…åˆä½¿ç”¨å°†ä¼šè®©å®ƒä»¬å˜å¾—æ›´åŠ å¼ºå¤§ã€‚</p>\n<blockquote>\n<p>å…¶å®ï¼Œalova åº•å±‚ä¾ç„¶ä¾èµ– axios æˆ– fetch-api ç­‰è¯·æ±‚å‡½æ•°è¿›è¡Œè¯·æ±‚ï¼Œå› æ­¤ä½ ä»ç„¶å¯ä»¥ä½¿ç”¨ä½ å–œæ¬¢çš„è¯·æ±‚åº“ã€‚</p>\n</blockquote>\n<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºäº <code>vue3+axios+alova</code>  çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œalova å°†è‡ªåŠ¨ä¸ºä½ åˆ›å»ºè¯·æ±‚ç›¸å…³çš„ï¼Œå¯ä»¥ç›´æ¥ç”¨äºè§†å›¾çš„å“åº”å¼çŠ¶æ€ï¼Œåˆ›å»ºä¸€ä¸ª vue3 çš„é¡¹ç›®æ¶å­ï¼Œç„¶åè¿è¡Œï¼š</p>\n<p><code>npm i</code>  åˆå§‹åŒ–é¡¹ç›®</p>\n<p><code>npm i alova --save-dev</code>  ä¸‹è½½ alova</p>\n<p><code>npm i @alova/adapter-axios --save-dev</code>  ä¸‹è½½ alova é…åˆ axios ä½¿ç”¨çš„ä¾èµ–</p>\n<p>ä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">&lt;</span>template<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token operator\">&lt;</span>div v<span class=\"token operator\">-</span><span class=\"token keyword\">if</span><span class=\"token operator\">=</span><span class=\"token string\">\"loading\"</span><span class=\"token operator\">></span>Loading<span class=\"token operator\">...</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token operator\">&lt;</span>div v<span class=\"token operator\">-</span><span class=\"token keyword\">else</span><span class=\"token operator\">-</span><span class=\"token keyword\">if</span><span class=\"token operator\">=</span><span class=\"token string\">\"error\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span>swigï¿¼<span class=\"token number\">0</span><span class=\"token operator\">--</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token operator\">&lt;</span>span v<span class=\"token operator\">-</span><span class=\"token keyword\">else</span><span class=\"token operator\">></span>responseData<span class=\"token operator\">:</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span>swigï¿¼<span class=\"token number\">1</span><span class=\"token operator\">--</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>template<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">&lt;</span>script setup<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> createAlova<span class=\"token punctuation\">,</span> useRequest <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'alova'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> VueHook <span class=\"token keyword\">from</span> <span class=\"token string\">'alova/vue'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> axiosRequestAdapter <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@alova/adapter-axios'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">const</span> alovaInstance <span class=\"token operator\">=</span> <span class=\"token function\">createAlova</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token literal-property property\">statesHook</span><span class=\"token operator\">:</span> VueHook<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token comment\">// è®¾ç½®ä½¿ç”¨ axios ä½œä¸ºè¯·æ±‚å·¥å…·</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token literal-property property\">requestAdapter</span><span class=\"token operator\">:</span> <span class=\"token function\">axiosRequestAdapter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token comment\">// åŠ è½½çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  loading<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token comment\">// å“åº”æ•°æ®</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  data<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token comment\">// é”™è¯¯ä¿¡æ¯ï¼Œè¯·æ±‚é”™è¯¯æ—¶æ‰æœ‰å€¼</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  error</pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> <span class=\"token function\">useRequest</span><span class=\"token punctuation\">(</span>alovaInstance<span class=\"token punctuation\">.</span><span class=\"token function\">Get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/todoList'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯éå¸¸ niceï¼ï¼ï¼ä¹‹å‰éœ€è¦æˆ‘ä»¬è‡ªå·±å®ç°çš„å„ç§åŠŸèƒ½ï¼Œalova éƒ½å¸®æˆ‘ä»¬åšäº†ã€‚</p>\n<p>alova çš„ github åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmp1ZWppbi5jbi8/dGFyZ2V0PWh0dHBzJTNBJTJGJTJGZ2l0aHViLmNvbSUyRmFsb3ZhanMlMkZhbG92YQ==\">https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Falovajs%2Falova</span></p>\n<p>alova çš„å®˜ç½‘åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmp1ZWppbi5jbi8/dGFyZ2V0PWh0dHBzJTNBJTJGJTJGYWxvdmEuanMub3JnJTJG\">https://link.juejin.cn/?target=https%3A%2F%2Falova.js.org%2F</span></p>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<blockquote>\n<p>alova ç›®å‰æä¾›äº† 8 ç§è¯·æ±‚ç­–ç•¥ï¼Œå¦‚æœä½ å¸Œæœ›åœ¨ä¸åŒçš„è¯·æ±‚åœºæ™¯ä¸‹æ–¹ä¾¿åœ°å®ç°ç‰¹å®šçš„è¯·æ±‚éœ€æ±‚ï¼Œé‚£åƒä¸‡åˆ«é”™è¿‡å®ƒå“¦ã€‚alova è¿˜æä¾›äº†ç¼“å­˜ç®¡ç†ã€è¯·æ±‚å…±äº«ç­‰æ›´å¤šåŠŸèƒ½ï¼Œå¯ä»¥è¦†ç›–ç»å¤§å¤šæ•°è¯·æ±‚åœºæ™¯ã€‚</p>\n<p>æ‰€ä»¥ï¼Œåœ¨ä½ çš„ä¸‹ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œä½ ä¹Ÿå¯ä»¥æ¥è¯•è¯• alovaï¼Œä¸€å®šèƒ½ç»™ä½ å¸¦æ¥æ›´æ„‰å¿«çš„å¼€å‘ä½“éªŒï¼</p>\n</blockquote>\n",
            "tags": [
                "tools",
                "å‰ç«¯",
                "web",
                "tools"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/%E8%87%AA%E7%AE%A1%E7%90%86%E6%95%8F%E6%84%9F%E8%AF%8D/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/%E8%87%AA%E7%AE%A1%E7%90%86%E6%95%8F%E6%84%9F%E8%AF%8D/",
            "title": "è‡ªç®¡ç†æ•æ„Ÿè¯",
            "date_published": "2024-03-03T08:58:36.060Z",
            "content_html": "<h1 id=\"è‡ªç®¡ç†æ•æ„Ÿè¯\"><a class=\"anchor\" href=\"#è‡ªç®¡ç†æ•æ„Ÿè¯\">#</a> è‡ªç®¡ç†æ•æ„Ÿè¯</h1>\n<h2 id=\"æ•æ„Ÿè¯-è¿‡æ»¤-æŠ€æœ¯é€‰å‹\"><a class=\"anchor\" href=\"#æ•æ„Ÿè¯-è¿‡æ»¤-æŠ€æœ¯é€‰å‹\">#</a> æ•æ„Ÿè¯ - è¿‡æ»¤ - æŠ€æœ¯é€‰å‹</h2>\n<table>\n<thead>\n<tr>\n<th><strong>æ–¹æ¡ˆ</strong></th>\n<th><strong>è¯´æ˜</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ•°æ®åº“æ¨¡ç³ŠæŸ¥è¯¢</td>\n<td>æ•ˆç‡å¤ªä½</td>\n</tr>\n<tr>\n<td>String.indexOf (&quot;&quot;) æŸ¥æ‰¾</td>\n<td>æ•°æ®åº“é‡å¤§çš„è¯ä¹Ÿæ˜¯æ¯”è¾ƒæ…¢</td>\n</tr>\n<tr>\n<td>å…¨æ–‡æ£€ç´¢</td>\n<td>åˆ†è¯å†åŒ¹é…</td>\n</tr>\n<tr>\n<td>DFA ç®—æ³•</td>\n<td>ç¡®å®šæœ‰ç©·è‡ªåŠ¨æœº (ä¸€ç§æ•°æ®ç»“æ„)</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"dfaå®ç°åŸç†\"><a class=\"anchor\" href=\"#dfaå®ç°åŸç†\">#</a> DFA å®ç°åŸç†</h2>\n<p><strong>DFA å…¨ç§°ä¸º</strong>ï¼šDeterministic Finite Automaton, å³ç¡®å®šæœ‰ç©·è‡ªåŠ¨æœº</p>\n<p><strong>å­˜å‚¨</strong>ï¼šä¸€æ¬¡æ€§çš„æŠŠæ‰€æœ‰çš„æ•æ„Ÿè¯å­˜å‚¨åˆ°äº†å¤šä¸ª map ä¸­ï¼Œå°±æ˜¯ä¸‹å›¾è¡¨ç¤ºè¿™ç§ç»“æ„</p>\n<p><strong>æ•æ„Ÿè¯</strong>ï¼šå†°æ¯’ï¼Œå¤§éº»ï¼Œå¤§åè›‹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303165708800.png\" alt=\"image-20240303165708800\" /></p>\n<h3 id=\"æ£€ç´¢çš„è¿‡ç¨‹\"><a class=\"anchor\" href=\"#æ£€ç´¢çš„è¿‡ç¨‹\">#</a> æ£€ç´¢çš„è¿‡ç¨‹</h3>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/image-20240303165723044.png\" alt=\"image-20240303165723044\" /></p>\n<h2 id=\"åŠŸèƒ½å®ç°\"><a class=\"anchor\" href=\"#åŠŸèƒ½å®ç°\">#</a> åŠŸèƒ½å®ç°</h2>\n<h3 id=\"åˆ›å»ºæ•æ„Ÿè¯çš„æ•°æ®åº“\"><a class=\"anchor\" href=\"#åˆ›å»ºæ•æ„Ÿè¯çš„æ•°æ®åº“\">#</a> åˆ›å»ºæ•æ„Ÿè¯çš„æ•°æ®åº“</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Navicat MySQL Data Transfer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Source Server         : localhost</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Source Server Version : 50721</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Source Host           : localhost:3306</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Source Database       : leadnews_wemedia</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Target Server Type    : MYSQL</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Target Server Version : 50721</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>File Encoding         : 65001</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>Date: 2021-05-23 11:19:37</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">-- Table structure for ad_sensitive</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>wm_sensitive<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>wm_sensitive<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¸»é”®'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>sensitives<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">COLLATE</span> utf8mb4_unicode_ci <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æ•æ„Ÿè¯'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>created_time<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token operator\">=</span><span class=\"token number\">3201</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COLLATE</span><span class=\"token operator\">=</span>utf8mb4_unicode_ci ROW_FORMAT<span class=\"token operator\">=</span>DYNAMIC <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'æ•æ„Ÿè¯ä¿¡æ¯è¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">-- Records of wm_sensitive</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>wm_sensitive<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'3104'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å†°æ¯’'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-05-23 15:38:51'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>wm_sensitive<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'3105'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ³•è½®åŠŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-05-23 15:38:51'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>wm_sensitive<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'3106'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç§äººä¾¦æ¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-05-23 11:09:22'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>wm_sensitive<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'3107'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é’ˆå­”æ‘„è±¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-05-23 11:09:52'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>wm_sensitive<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'3108'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¿¡ç”¨å¡æç°'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-05-23 11:10:11'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>wm_sensitive<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'3109'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ— æŠµæŠ¼è´·æ¬¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-05-23 11:10:41'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>wm_sensitive<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'3110'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¹¿å‘Šä»£ç†'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-05-23 11:10:59'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>wm_sensitive<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'3111'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä»£å¼€å‘ç¥¨'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-05-23 11:11:18'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>wm_sensitive<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'3112'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'èšåŠ›ç¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-05-23 11:11:39'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>wm_sensitive<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'3113'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å”®è‚¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-05-23 11:12:08'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>wm_sensitive<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'3114'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åˆ»ç« åŠ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-05-23 11:12:24'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>wm_sensitive<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'3116'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¥—ç‰Œè½¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-05-23 11:12:37'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>wm_sensitive<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'3117'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¶³çƒæŠ•æ³¨'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-05-23 11:12:51'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>wm_sensitive<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'3118'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åœ°ä¸‹é’±åº„'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-05-23 11:13:07'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>wm_sensitive<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'3119'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‡ºå”®ç­”æ¡ˆ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-05-23 11:13:24'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>wm_sensitive<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'3200'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å°é¢è´·æ¬¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2021-05-23 11:13:40'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"pojo\"><a class=\"anchor\" href=\"#pojo\">#</a> pojo</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>heima<span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span>wemedia<span class=\"token punctuation\">.</span>pojos</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>baomidou<span class=\"token punctuation\">.</span>mybatisplus<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IdType</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>baomidou<span class=\"token punctuation\">.</span>mybatisplus<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">TableField</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>baomidou<span class=\"token punctuation\">.</span>mybatisplus<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">TableId</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>baomidou<span class=\"token punctuation\">.</span>mybatisplus<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">TableName</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Data</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Serializable</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Date</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * &lt;p></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * æ•æ„Ÿè¯ä¿¡æ¯è¡¨</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * &lt;/p></pre></td></tr><tr><td data-num=\"16\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> * @author itheima</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token annotation punctuation\">@TableName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"wm_sensitive\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WmSensitive</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> serialVersionUID <span class=\"token operator\">=</span> <span class=\"token number\">1L</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>     * ä¸»é”®</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token annotation punctuation\">@TableId</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"id\"</span><span class=\"token punctuation\">,</span> type <span class=\"token operator\">=</span> <span class=\"token class-name\">IdType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">AUTO</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>     * æ•æ„Ÿè¯</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token annotation punctuation\">@TableField</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sensitives\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> sensitives<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>     * åˆ›å»ºæ—¶é—´</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token annotation punctuation\">@TableField</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"created_time\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Date</span> createdTime<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"sensitivewordutil\"><a class=\"anchor\" href=\"#sensitivewordutil\">#</a> SensitiveWordUtil</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SensitiveWordUtil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> dictionaryMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>     * ç”Ÿæˆå…³é”®è¯å­—å…¸åº“</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     * @param words</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initMap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> words<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// åˆ¤æ–­ä¼ å…¥çš„æ•æ„Ÿè¯é›†åˆæ˜¯å¦ä¸ºä¸­</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>words <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ•æ„Ÿè¯åˆ—è¡¨ä¸èƒ½ä¸ºç©º\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token comment\">//map åˆå§‹é•¿åº¦ words.size ()ï¼Œæ•´ä¸ªå­—å…¸åº“çš„å…¥å£å­—æ•° (å°äº words.size ()ï¼Œå› ä¸ºä¸åŒçš„è¯å¯èƒ½ä¼šæœ‰ç›¸åŒçš„é¦–å­—)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> map <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>words<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\">// éå†è¿‡ç¨‹ä¸­å½“å‰å±‚æ¬¡çš„æ•°æ®</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> curMap <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">// å¾ªç¯éå†ä¼ å…¥çš„ List é›†åˆ</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> iterator <span class=\"token operator\">=</span> words<span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>iterator<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token comment\">// æ¯å¾ªç¯ä¸€æ¬¡æ‹¿åˆ°ä¸€æ¡æ•æ„Ÿè¯</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token class-name\">String</span> word <span class=\"token operator\">=</span> iterator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token comment\">// åˆå§‹åŒ– curMap é›†åˆ å°† map é›†åˆçš„å¼•ç”¨ èµ‹å€¼ ç»™ curMap åœ¨ä¸‹é¢çš„ curMap çš„ put ä¸­æ•°æ®å°†å…±äº«åˆ° map é›†åˆå¯¹è±¡ä¸­</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            curMap <span class=\"token operator\">=</span> map<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token comment\">// è·å–å½“å‰å¾ªç¯çš„æ•æ„Ÿè¯çš„é•¿åº¦</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token keyword\">int</span> len <span class=\"token operator\">=</span> word<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token comment\">// éå†æ¯ä¸ªè¯çš„å­—</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token class-name\">String</span> key <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">.</span><span class=\"token function\">charAt</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token comment\">// å½“å‰å­—åœ¨å½“å‰å±‚æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™æ–°å»ºï¼Œå½“å‰å±‚æ•°æ®æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç»§ç»­åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ•°æ®</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> wordMap <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">)</span> curMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>wordMap <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                    <span class=\"token comment\">// æ¯ä¸ªèŠ‚ç‚¹å­˜åœ¨ä¸¤ä¸ªæ•°æ®ï¼šä¸‹ä¸€ä¸ªèŠ‚ç‚¹å’Œ isEnd (æ˜¯å¦ç»“æŸæ ‡å¿—) æ¯æ¬¡çš„èŠ‚ç‚¹éƒ½æ˜¯ä¸åŒçš„å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                    wordMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                    <span class=\"token comment\">// æ¯ä¸ªå•è¯çš„ isEnd éƒ½é»˜è®¤ä¸º 0 è¡¨ç¤ºæ²¡æœ‰ç»“æŸ</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                    wordMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"isEnd\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"0\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                    <span class=\"token comment\">// å°†å•è¯ä¸º keyï¼ŒwordMap å¯¹è±¡ä¸º valueï¼Œå­˜å‚¨åˆ° curMap å¯¹è±¡ä¸­</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                    curMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> wordMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                <span class=\"token comment\">// å°† wordMap å¯¹è±¡å¼•ç”¨èµ‹å€¼ç»™ curMap å¯¹è±¡ç„¶åå°† isEnd ç»™ä¿®æ”¹ä¸º 1 ä¸ç„¶æ‰€æœ‰çš„ isEnd éƒ½å°†ä¿®æ”¹ä¸º 1</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                curMap <span class=\"token operator\">=</span> wordMap<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                <span class=\"token comment\">// å¦‚æœå½“å‰å­—æ˜¯è¯çš„æœ€åä¸€ä¸ªå­—ï¼Œåˆ™å°† isEnd æ ‡å¿—ç½® 1</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">==</span> len <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                    curMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"isEnd\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        dictionaryMap <span class=\"token operator\">=</span> map<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>     * æœç´¢æ–‡æœ¬ä¸­æŸä¸ªæ–‡å­—æ˜¯å¦åŒ¹é…å…³é”®è¯</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>     * @param text</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>     * @param beginIndex</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">checkWord</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> text<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> beginIndex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        <span class=\"token comment\">// åˆ¤æ–­åˆå§‹åŒ–çš„æ•æ„Ÿè¯åº“æ˜¯å¦ä¸º null</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>dictionaryMap <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å­—å…¸ä¸èƒ½ä¸ºç©º\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token keyword\">boolean</span> isEnd <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token keyword\">int</span> wordLength <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        <span class=\"token comment\">// å®šä¹‰ä¸€ä¸ªæ•æ„Ÿè¯åº“çš„ map é›†åˆ</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> curMap <span class=\"token operator\">=</span> dictionaryMap<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        <span class=\"token keyword\">int</span> len <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>        <span class=\"token comment\">// ä»æ–‡æœ¬çš„ç¬¬ beginIndex å¼€å§‹åŒ¹é…</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> beginIndex<span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>            <span class=\"token class-name\">String</span> key <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">.</span><span class=\"token function\">charAt</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>            <span class=\"token comment\">// è·å–å½“å‰ key çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>            <span class=\"token comment\">// è·å–æ–‡æœ¬ä¸­çš„æ¯ä¸€ä¸ªå•è¯æ˜¯å¦å­˜åœ¨ æ•æ„Ÿè¯åº“ä¸­</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>            curMap <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">)</span> curMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>curMap <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>                <span class=\"token comment\">// å¦‚æœä¸å­˜åœ¨å°± è·³å‡ºå¾ªç¯</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>                <span class=\"token comment\">// å¦‚æœå­˜åœ¨ æ•æ„Ÿè¯ å°±è¿›è¡Œ wordLength ++</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>                wordLength <span class=\"token operator\">++</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>                <span class=\"token comment\">// åˆ¤æ–­æ˜¯å¦ä¸ºæ•æ„Ÿè¯çš„ç»“æŸå•è¯ ï¼Œ å¹¶ä¿®æ”¹ isEnd ä¸º true ä¸è¦é‡ç½® wordLength çš„å€¼</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>curMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"isEnd\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>                    isEnd <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isEnd<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>            wordLength <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>        <span class=\"token keyword\">return</span> wordLength<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"98\"></td><td><pre>     * è·å–åŒ¹é…çš„å…³é”®è¯å’Œå‘½ä¸­æ¬¡æ•°</pre></td></tr><tr><td data-num=\"99\"></td><td><pre>     * @param text</pre></td></tr><tr><td data-num=\"100\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"101\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">matchWords</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> text<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>        <span class=\"token comment\">// åˆ›å»º map é›†åˆ</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> wordMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>        <span class=\"token comment\">// è·å–æ–‡ç« å†…å®¹çš„é•¿åº¦</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>        <span class=\"token keyword\">int</span> len <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>        <span class=\"token comment\">// å¾ªç¯</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>            <span class=\"token comment\">// è°ƒç”¨å‡½æ•°æ£€æŸ¥æ–‡ç« å†…å®¹å‡ºç°äº†å¤šå°‘æ¬¡ çš„æ•æ„Ÿè¯ æ¬¡æ•° æ¯æ¬¡è¿”å›æ•æ„Ÿè¯åå†ä»</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>            <span class=\"token keyword\">int</span> wordLength <span class=\"token operator\">=</span> <span class=\"token function\">checkWord</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>wordLength <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>                <span class=\"token class-name\">String</span> word <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> i <span class=\"token operator\">+</span> wordLength<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>                <span class=\"token comment\">// æ·»åŠ å…³é”®è¯åŒ¹é…æ¬¡æ•°</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>wordMap<span class=\"token punctuation\">.</span><span class=\"token function\">containsKey</span><span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>                    <span class=\"token comment\">// é‡å¤çš„æ•æ„Ÿè¯ æ•°é‡ è¿›è¡Œè¿½åŠ </span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>                    wordMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">,</span> wordMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>                    wordMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>                <span class=\"token comment\">// ç•¥è¿‡æ•æ„Ÿè¯ è¿›è¡Œä¸‹ä¸€ä¸ª</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>                i <span class=\"token operator\">+=</span> wordLength <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>        <span class=\"token keyword\">return</span> wordMap<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>        list<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ³•è½®\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>        list<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ³•è½®åŠŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>        list<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å†°æ¯’\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>        <span class=\"token function\">initMap</span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre>        <span class=\"token class-name\">String</span> content<span class=\"token operator\">=</span><span class=\"token string\">\"æˆ‘æ˜¯ä¸€ä¸ªå¥½äººï¼Œå¹¶ä¸ä¼šå–å†°æ¯’ï¼Œä¹Ÿä¸æ“ç»ƒæ³•è½®åŠŸ,æˆ‘çœŸçš„ä¸å–å†°æ¯’\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> map <span class=\"token operator\">=</span> <span class=\"token function\">matchWords</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"åœ¨æ–‡ç« å®¡æ ¸çš„é€»è¾‘ä»£ç ä¸­çš„ä½¿ç”¨æ–¹å¼\"><a class=\"anchor\" href=\"#åœ¨æ–‡ç« å®¡æ ¸çš„é€»è¾‘ä»£ç ä¸­çš„ä½¿ç”¨æ–¹å¼\">#</a> åœ¨æ–‡ç« å®¡æ ¸çš„é€»è¾‘ä»£ç ä¸­çš„ä½¿ç”¨æ–¹å¼</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     * èµ„ç®¡ç†çš„æ•æ„Ÿè¯å®¡æ ¸</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     * @param content</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     * @param wmNews</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">handleSensitiveScan</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> content<span class=\"token punctuation\">,</span> <span class=\"token class-name\">WmNews</span> wmNews<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">boolean</span> flag <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// è·å–æ‰€æœ‰çš„æ•æ„Ÿè¯ å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">WmSensitive</span><span class=\"token punctuation\">></span></span> wmSensitives <span class=\"token operator\">=</span> wmSensitiveMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectList</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Wrappers</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">WmSensitive</span><span class=\"token punctuation\">></span></span><span class=\"token function\">lambdaQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WmSensitive</span><span class=\"token operator\">::</span><span class=\"token function\">getSensitives</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// è·å–æ‰€æœ‰æ•æ„Ÿè¯ å­˜å…¥ List é›†åˆä¸­</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> sensitivesList <span class=\"token operator\">=</span> wmSensitives<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WmSensitive</span><span class=\"token operator\">::</span><span class=\"token function\">getSensitives</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// åˆå§‹åŒ–æ•æ„Ÿè¯åº“</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">SensitiveWordUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">initMap</span><span class=\"token punctuation\">(</span>sensitivesList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// æŸ¥çœ‹æ–‡ç« ä¸­æ˜¯å¦åŒ…å«æ•æ„Ÿè¯</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> map <span class=\"token operator\">=</span> <span class=\"token class-name\">SensitiveWordUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">matchWords</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token function\">updateWmNews</span><span class=\"token punctuation\">(</span>wmNews<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">short</span><span class=\"token punctuation\">)</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"å½“å‰æ–‡ç« ä¸­å­˜åœ¨è¿è§„å†…å®¹\"</span> <span class=\"token operator\">+</span> map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            flag <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">return</span> flag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "ç¬¬ä¸‰æ–¹åº“",
                "java",
                "è®¡ç®—æœºå­¦ç§‘",
                "é¡¹ç›®",
                "ç¬¬ä¸‰æ–¹åº“"
            ]
        }
    ]
}