{
    "version": "https://jsonfeed.org/version/1",
    "title": "Dkx ã® Javaå°çª",
    "subtitle": "åˆ«æ€•è·¯é•¿æ¢¦è¿œ",
    "icon": "https://pigpigletsgo.github.io/images/favicon.ico",
    "description": "æ¬¢è¿æ¥æˆ‘çš„åšå®¢ç©ºé—´",
    "home_page_url": "https://pigpigletsgo.github.io",
    "items": [
        {
            "id": "https://pigpigletsgo.github.io/bug/ClassNotFoundException/",
            "url": "https://pigpigletsgo.github.io/bug/ClassNotFoundException/",
            "title": "java.lang.ClassNotFoundException:javax.xml.bind.DatatypeConverter",
            "date_published": "2024-01-06T03:15:25.988Z",
            "content_html": "<h3 id=\"javalangclassnotfoundexceptionjavaxxmlbinddatatypeconverter\"><a class=\"anchor\" href=\"#javalangclassnotfoundexceptionjavaxxmlbinddatatypeconverter\">#</a> java.lang.ClassNotFoundException:javax.xml.bind.DatatypeConverter</h3>\n<p>æŠ¥é”™æè¿°ï¼š</p>\n<p>java.lang.ClassNotFoundException:javax.xml.bind.DatatypeConverter</p>\n<p>åŸå› ï¼šå¯èƒ½æ˜¯å› ä¸º SpringBoot é¡¹ç›®ç»“åˆ JWT è¿›è¡Œç™»å½•æ—¶å‡ºç°çš„é—®é¢˜ï¼Œå› ä¸º jdk ç‰ˆæœ¬å¤ªé«˜å¯¼è‡´çš„ã€‚</p>\n<h4 id=\"è§£å†³æ–¹æ¡ˆ\"><a class=\"anchor\" href=\"#è§£å†³æ–¹æ¡ˆ\">#</a> è§£å†³æ–¹æ¡ˆï¼š</h4>\n<h5 id=\"ä¸€é™ä½jdkç‰ˆæœ¬\"><a class=\"anchor\" href=\"#ä¸€é™ä½jdkç‰ˆæœ¬\">#</a> ä¸€ï¼Œé™ä½ jdk ç‰ˆæœ¬</h5>\n<h5 id=\"äºŒåœ¨mavenä¸­æ·»åŠ ä¾èµ–\"><a class=\"anchor\" href=\"#äºŒåœ¨mavenä¸­æ·»åŠ ä¾èµ–\">#</a> äºŒï¼Œåœ¨ maven ä¸­æ·»åŠ ä¾èµ–</h5>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>javax.xml.bind<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>jaxb-api<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.3.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>å› ä¸º javax.xml.bind åœ¨ jdk8 ä¸­ æœ‰ï¼Œä½†æ˜¯åœ¨æ›´é«˜ç‰ˆæœ¬å°±æ²¡æœ‰äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åŠ ä¸Šå°±è¡Œäº†ã€‚</p>\n",
            "tags": [
                "é—®é¢˜æ€»æ±‡",
                "é—®é¢˜æ€»æ±‡",
                "jdkç‰ˆæœ¬é—®é¢˜"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springsecurity/MD5%E5%8A%A0%E5%AF%86/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springsecurity/MD5%E5%8A%A0%E5%AF%86/",
            "title": "MD5åŠ å¯†ä»£ç ",
            "date_published": "2024-01-06T03:11:19.167Z",
            "content_html": "<h2 id=\"md5åŠ å¯†ä»£ç \"><a class=\"anchor\" href=\"#md5åŠ å¯†ä»£ç \">#</a> MD5 åŠ å¯†ä»£ç </h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MessageDigest</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">NoSuchAlgorithmException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MD5</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">encrypt</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> strSrc<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">char</span> hexChars<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token char\">'0'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'1'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'2'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'3'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'4'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'5'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'6'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'7'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'8'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                    <span class=\"token char\">'9'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'b'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'c'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'d'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'e'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'f'</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bytes <span class=\"token operator\">=</span> strSrc<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token class-name\">MessageDigest</span> md <span class=\"token operator\">=</span> <span class=\"token class-name\">MessageDigest</span><span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MD5\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            md<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            bytes <span class=\"token operator\">=</span> md<span class=\"token punctuation\">.</span><span class=\"token function\">digest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> bytes<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token keyword\">char</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> chars <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">[</span>j <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token keyword\">int</span> k <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> bytes<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token keyword\">byte</span> b <span class=\"token operator\">=</span> bytes<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                chars<span class=\"token punctuation\">[</span>k<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> hexChars<span class=\"token punctuation\">[</span>b <span class=\"token operator\">>>></span> <span class=\"token number\">4</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xf</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                chars<span class=\"token punctuation\">[</span>k<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> hexChars<span class=\"token punctuation\">[</span>b <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xf</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>chars<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">NoSuchAlgorithmException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MD5åŠ å¯†å‡ºé”™ï¼ï¼+\"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿™ä¸ªåŠ å¯†çš„ç»“æœä¸ MySQL ä¸­çš„ç»“æœæ˜¯ä¸€æ‘¸ä¸€æ ·çš„</p>\n<p>éªŒè¯ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202309101615100.png\" alt=\"image-20230910161535468\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202309101615139.png\" alt=\"image-20230910161547664\" /></p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springsecurity",
                "è®¡ç®—æœºå­¦ç§‘",
                "springsecurity",
                "MD5"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springsecurity/SpringSecurity/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springsecurity/SpringSecurity/",
            "title": "SpringSecurity",
            "date_published": "2024-01-06T03:11:19.167Z",
            "content_html": "<h1 id=\"springsecurityï¸\"><a class=\"anchor\" href=\"#springsecurityï¸\">#</a> SpringSecurityâ­ï¸</h1>\n<p>[TOC]</p>\n<hr />\n<h2 id=\"0-ç®€ä»‹\"><a class=\"anchor\" href=\"#0-ç®€ä»‹\">#</a> 0 ç®€ä»‹ğŸƒ</h2>\n<p>Spring Security æ˜¯ Spring å®¶æ—ä¸­çš„ä¸€ä¸ªå®‰å…¨ç®¡ç†æ¡†æ¶ï¼Œç›¸æ¯”ä¸å¦å¤–ä¸€ä¸ªå®‰å…¨æ¡†æ¶<strong> Shiro</strong>, å®ƒæä¾›äº†æ›´ä¸°å¯Œçš„åŠŸèƒ½ï¼Œç¤¾åŒºèµ„æºä¹Ÿæ¯” Shiro ä¸°å¯Œ &lt;img src=&quot;./images/% E4% BC% A0% E9%80%81% E9%97% A8.png&quot; alt=&quot;ä¼ é€é—¨&quot; style=&quot;zoom:10%;&quot; align=&quot;right&quot;/&gt;</p>\n<p>ä¸€èˆ¬æ¥è¯´ä¸­å¤§å‹çš„é¡¹ç›®éƒ½æ˜¯ä½¿ç”¨<strong> SpringSecurity</strong> æ¥åšå®‰å…¨æ¡†æ¶ï¼Œå°é¡¹ç›®ç”¨ Shiro çš„æ¯”è¾ƒå¤šï¼Œå› ä¸ºç›¸æ¯”ä¸ SpringSecurity , Shiro çš„ä¸Šæ‰‹æ›´åŠ çš„ç®€å•</p>\n<p>ä¸€èˆ¬ Web åº”ç”¨çš„éœ€è¦è¿›è¡Œ<strong>è®¤è¯</strong>å’Œ<strong>æˆæƒ</strong></p>\n<p><strong>è®¤è¯</strong>ï¼šéªŒè¯å½“å‰è®¿é—®ç³»ç»Ÿçš„æ˜¯ä¸æ˜¯æœ¬ç³»ç»Ÿçš„ç”¨æˆ·ï¼Œå¹¶ä¸”è¦ç¡®è®¤å…·ä½“æ˜¯å“ªä¸ªç”¨æˆ·</p>\n<p><strong>æˆæƒ</strong>ï¼šç»è¿‡è®¤è¯ååˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è¿›è¡ŒæŸä¸ªæ“ä½œ<br />\nè€Œè®¤è¯å’Œæˆæƒä¹Ÿæ˜¯ SpringSecurity ä½œä¸ºå®‰å…¨æ¡†æ¶çš„æ ¸å¿ƒåŠŸèƒ½</p>\n<hr />\n<h2 id=\"1-å¿«é€Ÿå…¥é—¨\"><a class=\"anchor\" href=\"#1-å¿«é€Ÿå…¥é—¨\">#</a> 1 å¿«é€Ÿå…¥é—¨ğŸ•‹</h2>\n<h3 id=\"11-å‡†å¤‡å·¥ä½œï¸\"><a class=\"anchor\" href=\"#11-å‡†å¤‡å·¥ä½œï¸\">#</a> 1.1 å‡†å¤‡å·¥ä½œâš¡ï¸</h3>\n<p>æˆ‘ä»¬å…ˆè¦æ­å»ºä¸€ä¸ªç®€å•çš„ SpringBoot å·¥ç¨‹</p>\n<p>1. è®¾ç½®çˆ¶å·¥ç¨‹ï¼Œæ·»åŠ ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>xsi</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2001/XMLSchema-instance<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>schemaLocation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modelVersion</span><span class=\"token punctuation\">></span></span>4.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modelVersion</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-parent<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">&lt;!-- åœ¨ SpringBoot2.7.10 ä¹‹å SpringSecurity çš„ WebWebSecurityConfigurerAdapter å·²å¼ƒç”¨äº† --></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.5.4<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.dkx<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>maven-learn-springSecurity<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.0-SNAPSHOT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>packaging</span><span class=\"token punctuation\">></span></span>jar<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>packaging</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>maven-learn-springSecurity<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>url</span><span class=\"token punctuation\">></span></span>http://maven.apache.org<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>url</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project.build.sourceEncoding</span><span class=\"token punctuation\">></span></span>UTF-8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project.build.sourceEncoding</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-web<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.projectlombok<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>lombok<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>optional</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>optional</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>junit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>junit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>4.12<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>build</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugins</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugin</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-maven-plugin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugin</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugins</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>build</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>2. åˆ›å»ºå¯åŠ¨ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootApplication</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">App</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>3. åˆ›å»º Controller</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Controller</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HelloController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/hello\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><hr />\n<h3 id=\"12-å¼•å…¥springsecurity\"><a class=\"anchor\" href=\"#12-å¼•å…¥springsecurity\">#</a> 1.2 å¼•å…¥ SpringSecurityğŸ°</h3>\n<p>åœ¨ SpringBoot é¡¹ç›®ä¸­ä½¿ç”¨ SpringSecurity æˆ‘ä»¬åªéœ€è¦å¼•å…¥ä¾èµ–å³å¯å®ç°å…¥é—¨æ¡ˆä¾‹ã€‚</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--SpringSecurity å¯åŠ¨å™¨ --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-security<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>å¼•å…¥ä¾èµ–åæˆ‘ä»¬åœ¨å°è¯•å»è®¿é—®ä¹‹å‰çš„æ¥å£å°±ä¼šè‡ªåŠ¨è·³è½¬åˆ°ä¸€ä¸ª SpringSecurity çš„é»˜è®¤ç™»å½•é¡µé¢ï¼Œé»˜è®¤ç”¨æˆ·åæ˜¯ user, å¯†ç ä¼šè¾“å‡ºåœ¨æ§åˆ¶å°ã€‚</p>\n<p>å¿…é¡»ç™»å½•ä¹‹åæ‰èƒ½å¯¹æ¥å£è¿›è¡Œè®¿é—®ã€‚</p>\n<p>2.<strong> æ“ä½œ</strong>ï¼š</p>\n<p>é‡æ–°è®¿é—® hello æ¥å£åå‡ºç°çš„é¡µé¢éœ€è¦è¾“å…¥è´¦å·å’Œå¯†ç ï¼Œè´¦å·é»˜è®¤ user å¯†ç åœ¨æ§åˆ¶å°æ‰“å°</p>\n<p><img data-src=\"./images/image-20230515122204230.png\" alt=\"image-20230515122204230\" /></p>\n<p>å¯åŠ¨ SpringBoot åæ§åˆ¶å°è‡ªåŠ¨æ‰“å° password</p>\n<p><img data-src=\"./images/image-20230515111742527.png\" alt=\"image-20230515111742527\" /></p>\n<p>è¾“å…¥è´¦å·ï¼Œå¯†ç åè¿›å…¥é¡µé¢å†…</p>\n<p><img data-src=\"./images/image-20230515111838401.png\" alt=\"image-20230515111838401\" /></p>\n<p>è¾“å…¥é»˜è®¤çš„é€€å‡ºæ¥å£ï¼šlogout å®Œæ•´æ¥å£è·¯å¾„å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight http\"><figcaption data-lang=\"HTTP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token header\"><span class=\"token header-name keyword\">http</span><span class=\"token punctuation\">:</span><span class=\"token header-value\">//localhost:8080/logout</span></span></pre></td></tr></table></figure><p><img data-src=\"./images/image-20230515122335159.png\" alt=\"image-20230515122335159\" /></p>\n<p>ç‚¹å‡»åé€€å‡ºåˆ°ç™»å½•é¡µé¢</p>\n<p><img data-src=\"./images/image-20230515122409008.png\" alt=\"image-20230515122409008\" /></p>\n<hr />\n<h2 id=\"2-è®¤è¯\"><a class=\"anchor\" href=\"#2-è®¤è¯\">#</a> 2 è®¤è¯ğŸ¾</h2>\n<h3 id=\"21-ç™»å½•æ ¡éªŒæµç¨‹\"><a class=\"anchor\" href=\"#21-ç™»å½•æ ¡éªŒæµç¨‹\">#</a> 2.1 ç™»å½•æ ¡éªŒæµç¨‹ğŸ·</h3>\n<p>jwt = json web token</p>\n<p><img data-src=\"./images/image-20211215094003288-1684293988758-1.png\" alt=\"image-20211215094003288\" /></p>\n<hr />\n<h3 id=\"22-åŸç†åˆæ¢\"><a class=\"anchor\" href=\"#22-åŸç†åˆæ¢\">#</a> 2.2 åŸç†åˆæ¢ğŸ‰</h3>\n<p>æƒ³è¦çŸ¥é“å¦‚ä½•å®ç°è‡ªå·±çš„ç™»å½•æµç¨‹å°±å¿…é¡»è¦å…ˆçŸ¥é“å…¥é—¨æ¡ˆä¾‹ä¸­ SpringSecurity çš„æµç¨‹ã€‚</p>\n<h4 id=\"221-springsecurityå®Œæ•´æµç¨‹\"><a class=\"anchor\" href=\"#221-springsecurityå®Œæ•´æµç¨‹\">#</a> 2.2.1 SpringSecurity å®Œæ•´æµç¨‹ğŸ“Ÿ</h4>\n<p>SpringSecurity çš„åŸç†å…¶å®å°±æ˜¯ä¸€ä¸ª &lt;ins style=&quot;color:red&quot;&gt; è¿‡æ»¤å™¨é“¾ &lt;/ins&gt;ï¼Œå†…éƒ¨åŒ…å«äº†æä¾›å„ç§åŠŸèƒ½çš„è¿‡æ»¤å™¨ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹å…¥é—¨æ¡ˆä¾‹ä¸­çš„è¿‡æ»¤å™¨ã€‚</p>\n<p><img data-src=\"./images/image-20230515125451221.png\" alt=\"image-20230515125451221\" /><br />\n å›¾ä¸­åªå±•ç¤ºäº†æ ¸å¿ƒè¿‡æ»¤å™¨ï¼Œå…¶å®ƒçš„éæ ¸å¿ƒè¿‡æ»¤å™¨å¹¶æ²¡æœ‰åœ¨å›¾ä¸­å±•ç¤ºã€‚</p>\n<p><strong>UsernamePasswordAuthenticationFilter</strong>ï¼šè´Ÿè´£å¤„ç†æˆ‘ä»¬çš„ç™»å½•é¡µé¢å¡«å†™äº†ç”¨æˆ·åå¯†ç åçš„ç™»å½•è¯·æ±‚ï¼Œå…¥é—¨æ¡ˆä¾‹çš„è®¤è¯å·¥ä½œä¸»è¦ç”±å®ƒè´Ÿè´£ã€‚</p>\n<p><strong>ExceptionTranslationFilter</strong>ï¼šå¤„ç†è¿‡æ»¤å™¨é“¾ä¸­æŠ›å‡ºçš„ä»»ä½• AccessDeniedException å’Œ AuthenticationExceptionã€‚</p>\n<p><strong>FilterSecurityInterceptor</strong>ï¼šè´Ÿè´£æƒé™æ ¡éªŒçš„è¿‡æ»¤å™¨</p>\n<p><strong>æˆ‘ä»¬å¯ä»¥é€šè¿‡ Debug æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­ SpringSecurity è¿‡æ»¤å™¨é“¾ä¸­æœ‰å“ªäº›è¿‡æ»¤å™¨åŠå®ƒä»¬çš„é¡ºåº</strong></p>\n<p><img data-src=\"./images/image-20230515131823600.png\" alt=\"image-20230515131823600\" /></p>\n<h4 id=\"222-è®¤è¯æµç¨‹è¯¦è§£\"><a class=\"anchor\" href=\"#222-è®¤è¯æµç¨‹è¯¦è§£\">#</a> 2.2.2 è®¤è¯æµç¨‹è¯¦è§£ğŸ¯</h4>\n<p><img data-src=\"./images/image-20230515135851738.png\" alt=\"image-20230515135851738\" /></p>\n<p><strong>æ¦‚å¿µé€ŸæŸ¥</strong>ï¼š</p>\n<p><strong>Authentication æ¥å£</strong>ï¼šå®ƒçš„å®ç°ç±»ï¼Œè¡¨ç¤ºå½“å‰è®¿é—®ç³»ç»Ÿçš„ç”¨æˆ·ï¼Œå°è£…äº†ç”¨æˆ·ç›¸å…³ä¿¡æ¯ã€‚</p>\n<p><strong>AuthenticationManager æ¥å£</strong>ï¼šå®šä¹‰äº†è®¤è¯ Authentication çš„æ–¹æ³•ã€‚</p>\n<p><strong>UserDetailsService æ¥å£</strong>ï¼šåŠ è½½ç”¨æˆ·ç‰¹å®šæ•°æ®çš„æ ¸å¿ƒæ¥å£ï¼Œé‡Œé¢å®šä¹‰äº†ä¸€ä¸ªæ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯çš„æ–¹æ³•ã€‚</p>\n<p><strong>UserDetails æ¥å£</strong>ï¼šæä¾›æ ¸å¿ƒç”¨æˆ·ä¿¡æ¯ï¼Œé€šè¿‡ UserDetailsService æ ¹æ®ç”¨æˆ·åè·å–å¤„ç†çš„ç”¨æˆ·ä¿¡æ¯è¦å°è£…æˆ UserDetails å¯¹è±¡è¿”å›ï¼Œç„¶åå°†è¿™äº›ä¿¡æ¯å°è£…åˆ° Authentication å¯¹è±¡ä¸­ã€‚</p>\n<p><strong>ç™»å½•éªŒè¯</strong></p>\n<p><img data-src=\"./images/image-20230515140642377.png\" alt=\"image-20230515140642377\" /></p>\n<p><strong>æ€è€ƒ</strong>ï¼šJwt è®¤è¯è¿‡æ»¤å™¨ä¸­ä»è·å–åˆ°äº† userid åæ€ä¹ˆè·å–åˆ°å®Œæ•´çš„ç”¨æˆ·ä¿¡æ¯ï¼Ÿ</p>\n<p><img data-src=\"./images/image-20230515140959180.png\" alt=\"image-20230515140959180\" /></p>\n<p><img data-src=\"./images/image-20230515143734436.png\" alt=\"image-20230515143734436\" /></p>\n<hr />\n<h3 id=\"23è§£å†³é—®é¢˜\"><a class=\"anchor\" href=\"#23è§£å†³é—®é¢˜\">#</a> 2.3. è§£å†³é—®é¢˜ğŸ¸</h3>\n<h4 id=\"231-æ€è·¯åˆ†æ\"><a class=\"anchor\" href=\"#231-æ€è·¯åˆ†æ\">#</a> 2.3.1 æ€è·¯åˆ†æğŸ­</h4>\n<p><strong>ç™»å½•</strong>ï¼š</p>\n<p>â‘  è‡ªå®šä¹‰ç™»å½•æ¥å£</p>\n<ul>\n<li>è°ƒç”¨ providerManager çš„æ–¹æ³•è¿›è¡Œè®¤è¯ï¼Œå¦‚æœè®¤è¯é€šè¿‡ç”Ÿæˆ jwt</li>\n<li>æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥ redis ä¸­</li>\n</ul>\n<p>â‘¡ è‡ªå®šä¹‰ UserDetailsService</p>\n<ul>\n<li>åœ¨è¿™ä¸ªå®ç°ç±»ä¸­å»æŸ¥è¯¢æ•°æ®åº“</li>\n</ul>\n<p><strong>æ ¡éªŒ</strong>ï¼š</p>\n<p>â‘  å®šä¹‰ jwt è®¤è¯è¿‡æ»¤å™¨</p>\n<ul>\n<li>è·å– token</li>\n<li>è§£æ token è·å–å…¶ä¸­çš„ userid</li>\n<li>ä» redis ä¸­è·å–ç”¨æˆ·ä¿¡æ¯</li>\n<li>å­˜å…¥ SecurityContextHolder</li>\n</ul>\n<h4 id=\"232-å‡†å¤‡å·¥ä½œ\"><a class=\"anchor\" href=\"#232-å‡†å¤‡å·¥ä½œ\">#</a> 2.3.2 å‡†å¤‡å·¥ä½œğŸ”‘</h4>\n<p><mark>æ³¨æ„äº‹é¡¹</mark>ï¼š</p>\n<p>Redis çš„é…ç½®ç±»ä½¿ç”¨äº† FastJson æ¥è¿›è¡Œåºåˆ—åŒ–çš„ï¼Œéœ€è¦å¯¼å…¥è‡ªå·±çš„ util æŠ¥ä¸‹çš„ FastJson å¦åˆ™åœ¨å­˜å‚¨ redis å¯¹è±¡ä¿¡æ¯æ—¶ä¼šå‡ºç°æ²¡æœ‰å­˜å‚¨ @Type å¯¹è±¡ä¿¡æ¯æƒ…å†µï¼Œåé¢è¿›è¡Œè·å–çš„æ—¶å€™æˆ‘ä»¬éœ€è¦è·å–çš„æ˜¯å¯¹è±¡ä¿¡æ¯ä½†æ˜¯è½¬æ¢ä¼šå‘ç”Ÿ ClassCaseException å¼‚å¸¸ã€‚</p>\n<p>â‘  æ·»åŠ ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--redis ä¾èµ– --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-data-redis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">&lt;!--fastjson ä¾èµ– --></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>fastjson<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.2.47<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">&lt;!--jwt ä¾èµ– --></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>io.jsonwebtoken<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>jjwt<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>0.9.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>â‘¡ æ·»åŠ  Redis ç›¸å…³é…ç½®</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>fastjson<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">JSON</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>fastjson<span class=\"token punctuation\">.</span>serializer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SerializerFeature</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fasterxml<span class=\"token punctuation\">.</span>jackson<span class=\"token punctuation\">.</span>databind<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">JavaType</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fasterxml<span class=\"token punctuation\">.</span>jackson<span class=\"token punctuation\">.</span>databind<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ObjectMapper</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fasterxml<span class=\"token punctuation\">.</span>jackson<span class=\"token punctuation\">.</span>databind<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">TypeFactory</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>redis<span class=\"token punctuation\">.</span>serializer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RedisSerializer</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>redis<span class=\"token punctuation\">.</span>serializer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SerializationException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>fastjson<span class=\"token punctuation\">.</span>parser<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ParserConfig</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Assert</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>charset<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Charset</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * Redis ä½¿ç”¨ FastJson åºåˆ—åŒ–</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * </pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * @author sg</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FastJsonRedisSerializer</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">RedisSerializer</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Charset</span> <span class=\"token constant\">DEFAULT_CHARSET</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">Charset</span><span class=\"token punctuation\">.</span><span class=\"token function\">forName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"UTF-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> clazz<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">static</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">ParserConfig</span><span class=\"token punctuation\">.</span><span class=\"token function\">getGlobalInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setAutoTypeSupport</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">FastJsonRedisSerializer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> clazz<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clazz <span class=\"token operator\">=</span> clazz<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">serialize</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> t<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SerializationException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>t <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSONString</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SerializerFeature<span class=\"token punctuation\">.</span>WriteClassName</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token constant\">DEFAULT_CHARSET</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">T</span> <span class=\"token function\">deserialize</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bytes<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SerializationException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>bytes <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> bytes<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token class-name\">String</span> str <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">,</span> <span class=\"token constant\">DEFAULT_CHARSET</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseObject</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">,</span> clazz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">JavaType</span> <span class=\"token function\">getJavaType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> clazz<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">TypeFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">defaultInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">constructType</span><span class=\"token punctuation\">(</span>clazz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Bean</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>redis<span class=\"token punctuation\">.</span>connection<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RedisConnectionFactory</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>redis<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RedisTemplate</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>redis<span class=\"token punctuation\">.</span>serializer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">StringRedisSerializer</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RedisConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"unchecked\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rawtypes\"</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">redisTemplate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RedisConnectionFactory</span> connectionFactory<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> template <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        template<span class=\"token punctuation\">.</span><span class=\"token function\">setConnectionFactory</span><span class=\"token punctuation\">(</span>connectionFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">FastJsonRedisSerializer</span> serializer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FastJsonRedisSerializer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token comment\">// ä½¿ç”¨ StringRedisSerializer æ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ– redis çš„ key å€¼</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        template<span class=\"token punctuation\">.</span><span class=\"token function\">setKeySerializer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">StringRedisSerializer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        template<span class=\"token punctuation\">.</span><span class=\"token function\">setValueSerializer</span><span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">// Hash çš„ key ä¹Ÿé‡‡ç”¨ StringRedisSerializer çš„åºåˆ—åŒ–æ–¹å¼</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        template<span class=\"token punctuation\">.</span><span class=\"token function\">setHashKeySerializer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">StringRedisSerializer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        template<span class=\"token punctuation\">.</span><span class=\"token function\">setHashValueSerializer</span><span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        template<span class=\"token punctuation\">.</span><span class=\"token function\">afterPropertiesSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">return</span> template<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>â‘¢ å“åº”ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fasterxml<span class=\"token punctuation\">.</span>jackson<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">JsonInclude</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@JsonInclude</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JsonInclude<span class=\"token punctuation\">.</span>Include</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NON_NULL</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ResponseResult</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     * çŠ¶æ€ç </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> code<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     * æç¤ºä¿¡æ¯ï¼Œå¦‚æœæœ‰é”™è¯¯æ—¶ï¼Œå‰ç«¯å¯ä»¥è·å–è¯¥å­—æ®µè¿›è¡Œæç¤º</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>     * æŸ¥è¯¢åˆ°çš„ç»“æœæ•°æ®ï¼Œ</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">T</span> data<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseResult</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> code<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>code <span class=\"token operator\">=</span> code<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>msg <span class=\"token operator\">=</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseResult</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> code<span class=\"token punctuation\">,</span> <span class=\"token class-name\">T</span> data<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>code <span class=\"token operator\">=</span> code<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Integer</span> <span class=\"token function\">getCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">return</span> code<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setCode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> code<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>code <span class=\"token operator\">=</span> code<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token keyword\">return</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setMsg</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>msg <span class=\"token operator\">=</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">T</span> <span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token keyword\">return</span> data<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setData</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> data<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseResult</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> code<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">,</span> <span class=\"token class-name\">T</span> data<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>code <span class=\"token operator\">=</span> code<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>msg <span class=\"token operator\">=</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>â‘£ å·¥å…·ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">io<span class=\"token punctuation\">.</span>jsonwebtoken<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Claims</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">io<span class=\"token punctuation\">.</span>jsonwebtoken<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">JwtBuilder</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">io<span class=\"token punctuation\">.</span>jsonwebtoken<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Jwts</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">io<span class=\"token punctuation\">.</span>jsonwebtoken<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SignatureAlgorithm</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>crypto<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SecretKey</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>crypto<span class=\"token punctuation\">.</span>spec<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SecretKeySpec</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Base64</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Date</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">UUID</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * JWT å·¥å…·ç±»</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JwtUtil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">// æœ‰æ•ˆæœŸä¸º</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Long</span> <span class=\"token constant\">JWT_TTL</span> <span class=\"token operator\">=</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span><span class=\"token number\">1000L</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 60 * 60 *1000  ä¸€ä¸ªå°æ—¶</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">// è®¾ç½®ç§˜é’¥æ˜æ–‡ï¼Œè®¾ç½®é•¿åº¦ä¸èƒ½å¤§äº 11</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">JWT_KEY</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"sangeng\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token class-name\">String</span> token <span class=\"token operator\">=</span> <span class=\"token constant\">UUID</span><span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replaceAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">return</span> token<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>     * ç”Ÿæˆ jtw</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>     * @param subject token ä¸­è¦å­˜æ”¾çš„æ•°æ®ï¼ˆjson æ ¼å¼ï¼‰</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">createJWT</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> subject<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token class-name\">JwtBuilder</span> builder <span class=\"token operator\">=</span> <span class=\"token function\">getJwtBuilder</span><span class=\"token punctuation\">(</span>subject<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token function\">getUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">return</span> builder<span class=\"token punctuation\">.</span><span class=\"token function\">compact</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>     * ç”Ÿæˆ jtw</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>     * @param subject token ä¸­è¦å­˜æ”¾çš„æ•°æ®ï¼ˆjson æ ¼å¼ï¼‰</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>     * @param ttlMillis token è¶…æ—¶æ—¶é—´</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">createJWT</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> subject<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> ttlMillis<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token class-name\">JwtBuilder</span> builder <span class=\"token operator\">=</span> <span class=\"token function\">getJwtBuilder</span><span class=\"token punctuation\">(</span>subject<span class=\"token punctuation\">,</span> ttlMillis<span class=\"token punctuation\">,</span> <span class=\"token function\">getUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// è®¾ç½®è¿‡æœŸæ—¶é—´</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token keyword\">return</span> builder<span class=\"token punctuation\">.</span><span class=\"token function\">compact</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">JwtBuilder</span> <span class=\"token function\">getJwtBuilder</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> subject<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> ttlMillis<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> uuid<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token class-name\">SignatureAlgorithm</span> signatureAlgorithm <span class=\"token operator\">=</span> <span class=\"token class-name\">SignatureAlgorithm</span><span class=\"token punctuation\">.</span><span class=\"token constant\">HS256</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token class-name\">SecretKey</span> secretKey <span class=\"token operator\">=</span> <span class=\"token function\">generalKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token keyword\">long</span> nowMillis <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token class-name\">Date</span> now <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>nowMillis<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>ttlMillis<span class=\"token operator\">==</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            ttlMillis<span class=\"token operator\">=</span><span class=\"token class-name\">JwtUtil</span><span class=\"token punctuation\">.</span><span class=\"token constant\">JWT_TTL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token keyword\">long</span> expMillis <span class=\"token operator\">=</span> nowMillis <span class=\"token operator\">+</span> ttlMillis<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token class-name\">Date</span> expDate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>expMillis<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Jwts</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">setId</span><span class=\"token punctuation\">(</span>uuid<span class=\"token punctuation\">)</span>           <span class=\"token comment\">// å”¯ä¸€çš„ ID</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">setSubject</span><span class=\"token punctuation\">(</span>subject<span class=\"token punctuation\">)</span>   <span class=\"token comment\">// ä¸»é¢˜  å¯ä»¥æ˜¯ JSON æ•°æ®</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">setIssuer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sg\"</span><span class=\"token punctuation\">)</span>     \t<span class=\"token comment\">// ç­¾å‘è€…</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">setIssuedAt</span><span class=\"token punctuation\">(</span>now<span class=\"token punctuation\">)</span>      <span class=\"token comment\">// ç­¾å‘æ—¶é—´</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">signWith</span><span class=\"token punctuation\">(</span>signatureAlgorithm<span class=\"token punctuation\">,</span> secretKey<span class=\"token punctuation\">)</span> <span class=\"token comment\">// ä½¿ç”¨ HS256 å¯¹ç§°åŠ å¯†ç®—æ³•ç­¾åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç§˜é’¥</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">setExpiration</span><span class=\"token punctuation\">(</span>expDate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>     * åˆ›å»º token</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>     * @param id</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>     * @param subject</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>     * @param ttlMillis</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"73\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">createJWT</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> subject<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> ttlMillis<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>        <span class=\"token class-name\">JwtBuilder</span> builder <span class=\"token operator\">=</span> <span class=\"token function\">getJwtBuilder</span><span class=\"token punctuation\">(</span>subject<span class=\"token punctuation\">,</span> ttlMillis<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// è®¾ç½®è¿‡æœŸæ—¶é—´</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>        <span class=\"token keyword\">return</span> builder<span class=\"token punctuation\">.</span><span class=\"token function\">compact</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>        <span class=\"token class-name\">String</span> token <span class=\"token operator\">=</span> <span class=\"token string\">\"eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJjYWM2ZDVhZi1mNjVlLTQ0MDAtYjcxMi0zYWEwOGIyOTIwYjQiLCJzdWIiOiJzZyIsImlzcyI6InNnIiwiaWF0IjoxNjM4MTA2NzEyLCJleHAiOjE2MzgxMTAzMTJ9.JVsSbkP94wuczb4QryQbAke3ysBDIL5ou8fWsbt_ebg\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>        <span class=\"token class-name\">Claims</span> claims <span class=\"token operator\">=</span> <span class=\"token function\">parseJWT</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>claims<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"86\"></td><td><pre>     * ç”ŸæˆåŠ å¯†åçš„ç§˜é’¥ secretKey</pre></td></tr><tr><td data-num=\"87\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"88\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">SecretKey</span> <span class=\"token function\">generalKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>        <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> encodedKey <span class=\"token operator\">=</span> <span class=\"token class-name\">Base64</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDecoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JwtUtil</span><span class=\"token punctuation\">.</span><span class=\"token constant\">JWT_KEY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>        <span class=\"token class-name\">SecretKey</span> key <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SecretKeySpec</span><span class=\"token punctuation\">(</span>encodedKey<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> encodedKey<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span> <span class=\"token string\">\"AES\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>        <span class=\"token keyword\">return</span> key<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"95\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"96\"></td><td><pre>     * è§£æ</pre></td></tr><tr><td data-num=\"97\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"98\"></td><td><pre>     * @param jwt</pre></td></tr><tr><td data-num=\"99\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"100\"></td><td><pre>     * @throws Exception</pre></td></tr><tr><td data-num=\"101\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Claims</span> <span class=\"token function\">parseJwt</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> jwt<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>        <span class=\"token class-name\">Claims</span> claims<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>        <span class=\"token class-name\">SecretKey</span> secretKey <span class=\"token operator\">=</span> <span class=\"token function\">generalKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token class-name\">Jwts</span><span class=\"token punctuation\">.</span><span class=\"token function\">parser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>                    <span class=\"token punctuation\">.</span><span class=\"token function\">setSigningKey</span><span class=\"token punctuation\">(</span>secretKey<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>                    <span class=\"token punctuation\">.</span><span class=\"token function\">parseClaimsJws</span><span class=\"token punctuation\">(</span>jwt<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>                    <span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ExpiredJwtException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>            claims <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getClaims</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>        <span class=\"token keyword\">return</span> claims<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>â‘¤ Redis å·¥å…·ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">TimeUnit</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"unchecked\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rawtypes\"</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RedisCache</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">RedisTemplate</span> redisTemplate<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     * ç¼“å­˜åŸºæœ¬çš„å¯¹è±¡ï¼ŒIntegerã€Stringã€å®ä½“ç±»ç­‰</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>     * @param key ç¼“å­˜çš„é”®å€¼</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>     * @param value ç¼“å­˜çš„å€¼</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">void</span> <span class=\"token function\">setCacheObject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> key<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">T</span> value<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>     * ç¼“å­˜åŸºæœ¬çš„å¯¹è±¡ï¼ŒIntegerã€Stringã€å®ä½“ç±»ç­‰</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>     * @param key ç¼“å­˜çš„é”®å€¼</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>     * @param value ç¼“å­˜çš„å€¼</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>     * @param timeout æ—¶é—´</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>     * @param timeUnit æ—¶é—´é¢—ç²’åº¦</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">void</span> <span class=\"token function\">setCacheObject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> key<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">T</span> value<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Integer</span> timeout<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">TimeUnit</span> timeUnit<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">,</span> timeout<span class=\"token punctuation\">,</span> timeUnit<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>     * è®¾ç½®æœ‰æ•ˆæ—¶é—´</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>     * @param key Redis é”®</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>     * @param timeout è¶…æ—¶æ—¶é—´</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>     * @return true = è®¾ç½®æˆåŠŸï¼›false = è®¾ç½®å¤±è´¥</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">expire</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> key<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> timeout<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">expire</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> timeout<span class=\"token punctuation\">,</span> <span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SECONDS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>     * è®¾ç½®æœ‰æ•ˆæ—¶é—´</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>     * @param key Redis é”®</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>     * @param timeout è¶…æ—¶æ—¶é—´</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>     * @param unit æ—¶é—´å•ä½</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>     * @return true = è®¾ç½®æˆåŠŸï¼›false = è®¾ç½®å¤±è´¥</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">expire</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> key<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> timeout<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">TimeUnit</span> unit<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token keyword\">return</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">expire</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> timeout<span class=\"token punctuation\">,</span> unit<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>     * è·å¾—ç¼“å­˜çš„åŸºæœ¬å¯¹è±¡ã€‚</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>     * @param key ç¼“å­˜é”®å€¼</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>     * @return ç¼“å­˜é”®å€¼å¯¹åº”çš„æ•°æ®</pre></td></tr><tr><td data-num=\"65\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">T</span> <span class=\"token function\">getCacheObject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token class-name\">ValueOperations</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> operation <span class=\"token operator\">=</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token keyword\">return</span> operation<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"73\"></td><td><pre>     * åˆ é™¤å•ä¸ªå¯¹è±¡</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"75\"></td><td><pre>     * @param key</pre></td></tr><tr><td data-num=\"76\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">deleteObject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>        <span class=\"token keyword\">return</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"83\"></td><td><pre>     * åˆ é™¤é›†åˆå¯¹è±¡</pre></td></tr><tr><td data-num=\"84\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"85\"></td><td><pre>     * @param collection å¤šä¸ªå¯¹è±¡</pre></td></tr><tr><td data-num=\"86\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"87\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">long</span> <span class=\"token function\">deleteObject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Collection</span> collection<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>        <span class=\"token keyword\">return</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>collection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"94\"></td><td><pre>     * ç¼“å­˜ List æ•°æ®</pre></td></tr><tr><td data-num=\"95\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"96\"></td><td><pre>     * @param key ç¼“å­˜çš„é”®å€¼</pre></td></tr><tr><td data-num=\"97\"></td><td><pre>     * @param dataList å¾…ç¼“å­˜çš„ List æ•°æ®</pre></td></tr><tr><td data-num=\"98\"></td><td><pre>     * @return ç¼“å­˜çš„å¯¹è±¡</pre></td></tr><tr><td data-num=\"99\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">long</span> <span class=\"token function\">setCacheList</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> key<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> dataList<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>        <span class=\"token class-name\">Long</span> count <span class=\"token operator\">=</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">rightPushAll</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> dataList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>        <span class=\"token keyword\">return</span> count <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">?</span> <span class=\"token number\">0</span> <span class=\"token operator\">:</span> count<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"107\"></td><td><pre>     * è·å¾—ç¼“å­˜çš„ list å¯¹è±¡</pre></td></tr><tr><td data-num=\"108\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"109\"></td><td><pre>     * @param key ç¼“å­˜çš„é”®å€¼</pre></td></tr><tr><td data-num=\"110\"></td><td><pre>     * @return ç¼“å­˜é”®å€¼å¯¹åº”çš„æ•°æ®</pre></td></tr><tr><td data-num=\"111\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getCacheList</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>        <span class=\"token keyword\">return</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">range</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"118\"></td><td><pre>     * ç¼“å­˜ Set</pre></td></tr><tr><td data-num=\"119\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"120\"></td><td><pre>     * @param key ç¼“å­˜é”®å€¼</pre></td></tr><tr><td data-num=\"121\"></td><td><pre>     * @param dataSet ç¼“å­˜çš„æ•°æ®</pre></td></tr><tr><td data-num=\"122\"></td><td><pre>     * @return ç¼“å­˜æ•°æ®çš„å¯¹è±¡</pre></td></tr><tr><td data-num=\"123\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">BoundSetOperations</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">setCacheSet</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> key<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> dataSet<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>        <span class=\"token class-name\">BoundSetOperations</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> setOperation <span class=\"token operator\">=</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">boundSetOps</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>        <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> it <span class=\"token operator\">=</span> dataSet<span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>            setOperation<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>        <span class=\"token keyword\">return</span> setOperation<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"136\"></td><td><pre>     * è·å¾—ç¼“å­˜çš„ set</pre></td></tr><tr><td data-num=\"137\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"138\"></td><td><pre>     * @param key</pre></td></tr><tr><td data-num=\"139\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"140\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getCacheSet</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"143\"></td><td><pre>        <span class=\"token keyword\">return</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">members</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre></pre></td></tr><tr><td data-num=\"146\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"147\"></td><td><pre>     * ç¼“å­˜ Map</pre></td></tr><tr><td data-num=\"148\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"149\"></td><td><pre>     * @param key</pre></td></tr><tr><td data-num=\"150\"></td><td><pre>     * @param dataMap</pre></td></tr><tr><td data-num=\"151\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"152\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">void</span> <span class=\"token function\">setCacheMap</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> key<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> dataMap<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>dataMap <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"155\"></td><td><pre>            redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForHash</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">putAll</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> dataMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"156\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"157\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre></pre></td></tr><tr><td data-num=\"159\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"160\"></td><td><pre>     * è·å¾—ç¼“å­˜çš„ Map</pre></td></tr><tr><td data-num=\"161\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"162\"></td><td><pre>     * @param key</pre></td></tr><tr><td data-num=\"163\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"164\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"165\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getCacheMap</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"166\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"167\"></td><td><pre>        <span class=\"token keyword\">return</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForHash</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"168\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"169\"></td><td><pre></pre></td></tr><tr><td data-num=\"170\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"171\"></td><td><pre>     * å¾€ Hash ä¸­å­˜å…¥æ•°æ®</pre></td></tr><tr><td data-num=\"172\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"173\"></td><td><pre>     * @param key Redis é”®</pre></td></tr><tr><td data-num=\"174\"></td><td><pre>     * @param hKey Hash é”®</pre></td></tr><tr><td data-num=\"175\"></td><td><pre>     * @param value å€¼</pre></td></tr><tr><td data-num=\"176\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"177\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">void</span> <span class=\"token function\">setCacheMapValue</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> key<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> hKey<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">T</span> value<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"178\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"179\"></td><td><pre>        redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForHash</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> hKey<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"180\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"181\"></td><td><pre></pre></td></tr><tr><td data-num=\"182\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"183\"></td><td><pre>     * è·å– Hash ä¸­çš„æ•°æ®</pre></td></tr><tr><td data-num=\"184\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"185\"></td><td><pre>     * @param key Redis é”®</pre></td></tr><tr><td data-num=\"186\"></td><td><pre>     * @param hKey Hash é”®</pre></td></tr><tr><td data-num=\"187\"></td><td><pre>     * @return Hash ä¸­çš„å¯¹è±¡</pre></td></tr><tr><td data-num=\"188\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"189\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">T</span> <span class=\"token function\">getCacheMapValue</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> key<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> hKey<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"190\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"191\"></td><td><pre>        <span class=\"token class-name\">HashOperations</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> opsForHash <span class=\"token operator\">=</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForHash</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"192\"></td><td><pre>        <span class=\"token keyword\">return</span> opsForHash<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> hKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"193\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"194\"></td><td><pre></pre></td></tr><tr><td data-num=\"195\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"196\"></td><td><pre>     * åˆ é™¤ Hash ä¸­çš„æ•°æ®</pre></td></tr><tr><td data-num=\"197\"></td><td><pre>     * </pre></td></tr><tr><td data-num=\"198\"></td><td><pre>     * @param key</pre></td></tr><tr><td data-num=\"199\"></td><td><pre>     * @param hkey</pre></td></tr><tr><td data-num=\"200\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"201\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">delCacheMapValue</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> key<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> hkey<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"202\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"203\"></td><td><pre>        <span class=\"token class-name\">HashOperations</span> hashOperations <span class=\"token operator\">=</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForHash</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"204\"></td><td><pre>        hashOperations<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> hkey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"205\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"206\"></td><td><pre></pre></td></tr><tr><td data-num=\"207\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"208\"></td><td><pre>     * è·å–å¤šä¸ª Hash ä¸­çš„æ•°æ®</pre></td></tr><tr><td data-num=\"209\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"210\"></td><td><pre>     * @param key Redis é”®</pre></td></tr><tr><td data-num=\"211\"></td><td><pre>     * @param hKeys Hash é”®é›†åˆ</pre></td></tr><tr><td data-num=\"212\"></td><td><pre>     * @return Hash å¯¹è±¡é›†åˆ</pre></td></tr><tr><td data-num=\"213\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"214\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getMultiCacheMapValue</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> key<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> hKeys<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"215\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"216\"></td><td><pre>        <span class=\"token keyword\">return</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForHash</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">multiGet</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> hKeys<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"217\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"218\"></td><td><pre></pre></td></tr><tr><td data-num=\"219\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"220\"></td><td><pre>     * è·å¾—ç¼“å­˜çš„åŸºæœ¬å¯¹è±¡åˆ—è¡¨</pre></td></tr><tr><td data-num=\"221\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"222\"></td><td><pre>     * @param pattern å­—ç¬¦ä¸²å‰ç¼€</pre></td></tr><tr><td data-num=\"223\"></td><td><pre>     * @return å¯¹è±¡åˆ—è¡¨</pre></td></tr><tr><td data-num=\"224\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"225\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> pattern<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"226\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"227\"></td><td><pre>        <span class=\"token keyword\">return</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>pattern<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"228\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"229\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>â‘¥ Web å·¥å…·ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpServletResponse</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WebUtils</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     * å°†å­—ç¬¦ä¸²æ¸²æŸ“åˆ°å®¢æˆ·ç«¯</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>     * </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>     * @param response æ¸²æŸ“å¯¹è±¡</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     * @param string å¾…æ¸²æŸ“çš„å­—ç¬¦ä¸²</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>     * @return null</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">renderString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> string<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">try</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            response<span class=\"token punctuation\">.</span><span class=\"token function\">setStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            response<span class=\"token punctuation\">.</span><span class=\"token function\">setContentType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            response<span class=\"token punctuation\">.</span><span class=\"token function\">setCharacterEncoding</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            response<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>â‘¦ å®ä½“ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Serializable</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Date</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * ç”¨æˆ·è¡¨ (User) å®ä½“ç±»</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * @author ä¸‰æ›´</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token annotation punctuation\">@AllArgsConstructor</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token annotation punctuation\">@NoArgsConstructor</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> serialVersionUID <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">40356785423868312L</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    * ä¸»é”®</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    * ç”¨æˆ·å</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> userName<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    * æ˜µç§°</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> nickName<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    * å¯†ç </pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    * è´¦å·çŠ¶æ€ï¼ˆ0 æ­£å¸¸ 1 åœç”¨ï¼‰</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> status<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    * é‚®ç®±</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> email<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    * æ‰‹æœºå·</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> phonenumber<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    * ç”¨æˆ·æ€§åˆ«ï¼ˆ0 ç”·ï¼Œ1 å¥³ï¼Œ2 æœªçŸ¥ï¼‰</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> sex<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    * å¤´åƒ</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> avatar<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    * ç”¨æˆ·ç±»å‹ï¼ˆ0 ç®¡ç†å‘˜ï¼Œ1 æ™®é€šç”¨æˆ·ï¼‰</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> userType<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    * åˆ›å»ºäººçš„ç”¨æˆ· id</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> createBy<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    * åˆ›å»ºæ—¶é—´</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Date</span> createTime<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    * æ›´æ–°äºº</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> updateBy<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    * æ›´æ–°æ—¶é—´</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Date</span> updateTime<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"73\"></td><td><pre>    * åˆ é™¤æ ‡å¿—ï¼ˆ0 ä»£è¡¨æœªåˆ é™¤ï¼Œ1 ä»£è¡¨å·²åˆ é™¤ï¼‰</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> delFlag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"233-å®ç°ï¸\"><a class=\"anchor\" href=\"#233-å®ç°ï¸\">#</a> 2.3.3 å®ç°â›µï¸</h4>\n<h5 id=\"2331-æ•°æ®åº“æ ¡éªŒç”¨æˆ·\"><a class=\"anchor\" href=\"#2331-æ•°æ®åº“æ ¡éªŒç”¨æˆ·\">#</a> 2.3.3.1 æ•°æ®åº“æ ¡éªŒç”¨æˆ·ğŸƒ</h5>\n<p>ä»ä¹‹å‰çš„åˆ†ææˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª UserDetailsServiceï¼Œè®© SpringSecurity ä½¿ç”¨æˆ‘ä»¬çš„ UserDetailsServiceï¼Œæˆ‘ä»¬è‡ªå·±çš„ UserDetailsService å¯ä»¥ä»æ•°æ®åº“ä¸­æŸ¥è¯¢ç”¨æˆ·åå’Œå¯†ç </p>\n<h5 id=\"å‡†å¤‡å·¥ä½œ\"><a class=\"anchor\" href=\"#å‡†å¤‡å·¥ä½œ\">#</a> å‡†å¤‡å·¥ä½œğŸ’ƒ</h5>\n<p>æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªç”¨æˆ·è¡¨ï¼Œå»ºè¡¨è¯­å¥å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>sys_user<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¸»é”®'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>user_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'NULL'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç”¨æˆ·å'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>nick_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'NULL'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æ˜µç§°'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>password<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'NULL'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å¯†ç '</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>status<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">CHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è´¦å·çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>email<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é‚®ç®±'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>phonenumber<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æ‰‹æœºå·'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>sex<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">CHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç”¨æˆ·æ€§åˆ«ï¼ˆ0ç”·ï¼Œ1å¥³ï¼Œ2æœªçŸ¥ï¼‰'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>avatar<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å¤´åƒ'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>user_type<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">CHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'1'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç”¨æˆ·ç±»å‹ï¼ˆ0ç®¡ç†å‘˜ï¼Œ1æ™®é€šç”¨æˆ·ï¼‰'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>create_by<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººçš„ç”¨æˆ·id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>create_time<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">DATETIME</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>update_by<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æ›´æ–°äºº'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>update_time<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">DATETIME</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æ›´æ–°æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>del_flag<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">INT</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ é™¤æ ‡å¿—ï¼ˆ0ä»£è¡¨æœªåˆ é™¤ï¼Œ1ä»£è¡¨å·²åˆ é™¤ï¼‰'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">INNODB</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token operator\">=</span><span class=\"token number\">2</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'ç”¨æˆ·è¡¨'</span></pre></td></tr></table></figure><p>å¼•å…¥ MyBatisPlus å’Œ MySQL é©±åŠ¨çš„ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.baomidou<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>mybatis-plus-boot-starter<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>3.4.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>mysql<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>mysql-connector-java<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>8.0.28<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>druid<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.2.8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>é…ç½®æ•°æ®åº“ä¿¡æ¯</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> com.alibaba.druid.pool.DruidDataSource</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">driver-class-name</span><span class=\"token punctuation\">:</span> com.mysql.cj.jdbc.Driver</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> jdbc<span class=\"token punctuation\">:</span>mysql<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span>3306/test<span class=\"token punctuation\">?</span>characterEncoding=utf<span class=\"token punctuation\">-</span>8<span class=\"token important\">&amp;serverTimezone=UTC</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> dkx</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token key atrule\">mybatis-plus</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token key atrule\">mapper-locations</span><span class=\"token punctuation\">:</span> classpath<span class=\"token punctuation\">:</span>mapper/<span class=\"token important\">*.xml</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token key atrule\">config-location</span><span class=\"token punctuation\">:</span> classpath<span class=\"token punctuation\">:</span>mybatis/mybatis<span class=\"token punctuation\">-</span>config.xml</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token key atrule\">global-config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token key atrule\">banner</span><span class=\"token punctuation\">:</span> off</pre></td></tr></table></figure><p>å®šä¹‰ Mapper æ¥å£</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Mapper</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserMapper</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseMapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æµ‹è¯• MP æ˜¯å¦èƒ½æ­£å¸¸ä½¿ç”¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootTest</span><span class=\"token punctuation\">(</span>classes <span class=\"token operator\">=</span> <span class=\"token class-name\">App</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@RunWith</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SpringJUnit4ClassRunner</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserMapper</span> mapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> mapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectList</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token class-name\">Result</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">05</span><span class=\"token operator\">-</span><span class=\"token number\">16</span> <span class=\"token number\">17</span><span class=\"token operator\">:</span><span class=\"token number\">27</span><span class=\"token operator\">:</span><span class=\"token number\">34.013</span>  <span class=\"token constant\">INFO</span> <span class=\"token number\">16256</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>           main<span class=\"token punctuation\">]</span> <span class=\"token class-name\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>druid<span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span></span>DruidDataSource</span>   <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>dataSource<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> inited</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> userName<span class=\"token operator\">=</span><span class=\"token number\">123</span><span class=\"token punctuation\">,</span> nickName<span class=\"token operator\">=</span><span class=\"token number\">123</span><span class=\"token punctuation\">,</span> password<span class=\"token operator\">=</span><span class=\"token number\">123</span><span class=\"token punctuation\">,</span> status<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> email<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> phonenumber<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> sex<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> avatar<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> userType<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> createBy<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> createTime<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> updateBy<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> updateTime<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> delFlag<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><h5 id=\"æ ¸å¿ƒä»£ç å®ç°\"><a class=\"anchor\" href=\"#æ ¸å¿ƒä»£ç å®ç°\">#</a> æ ¸å¿ƒä»£ç å®ç°ğŸŒµ</h5>\n<p>åˆ›å»ºä¸€ä¸ªç±»å®ç° UserDetailsService æ¥å£ï¼Œé‡å†™å…¶ä¸­çš„æ–¹æ³•ï¼Œè®©å…¶ç”¨æˆ·åä»æ•°æ®åº“ä¸­æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserDetailsServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserDetailsService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserMapper</span> mapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserDetails</span> <span class=\"token function\">loadUserByUsername</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">UsernameNotFoundException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//        æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">LambdaQueryWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> wrapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LambdaQueryWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">eq</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span><span class=\"token operator\">::</span><span class=\"token function\">getUserName</span><span class=\"token punctuation\">,</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> mapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectOne</span><span class=\"token punctuation\">(</span>wrapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">//        å¦‚æœæ²¡æœ‰æŸ¥è¯¢åˆ°ç”¨æˆ·å°±æŠ›å‡ºå¼‚å¸¸</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Objects</span><span class=\"token punctuation\">.</span><span class=\"token function\">isNull</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">//TODO        æŸ¥è¯¢å¯¹åº”çš„æƒé™ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LoginUser</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å› ä¸º UserDetailsService æ–¹æ³•çš„è¿”å›å€¼æ˜¯ UserDetails ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦å®šä¹‰ä¸€ä¸ªç±»ï¼Œå®ç°è¯¥æ¥å£ï¼ŒæŠŠç”¨æˆ·ä¿¡æ¯å°è£…åœ¨å…¶ä¸­ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@AllArgsConstructor</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@NoArgsConstructor</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoginUser</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserDetails</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">LoginUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>user <span class=\"token operator\">=</span> user<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">//    è¿”å›æƒé™ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">GrantedAuthority</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">//    è·å–å¯†ç </span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">return</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">//    è·å–ç”¨æˆ·å</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token keyword\">return</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getUserName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">//    åˆ¤æ–­æ˜¯å¦æ²¡è¿‡æœŸ</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isAccountNonExpired</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isAccountNonLocked</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">//    æ˜¯å¦æ²¡æœ‰è¶…æ—¶</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isCredentialsNonExpired</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token comment\">//    ç”¨æˆ·æ˜¯å¦å¯ç”¨çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isEnabled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœè¦æµ‹è¯•ï¼Œéœ€è¦å¾€ç”¨æˆ·è¡¨ä¸­å†™å…¥ç”¨æˆ·æ•°æ®ï¼Œå¹¶ä¸”å¦‚æœä½ æƒ³è®©ç”¨æˆ·çš„å¯†ç æ˜¯æ˜æ–‡å­˜å‚¨ï¼Œéœ€è¦åœ¨å¯†ç å‰åŠ  {noop}ã€‚<strong>ä¾‹å¦‚</strong>ï¼š</p>\n<p><img data-src=\"./images/image-20230516174146080.png\" alt=\"image-20230516174146080\" /></p>\n<p>&lt;font style=&quot;color:red&quot;&gt; ä¸åŠ  {noop} ç™»å½•åç«¯å°±ä¼šæŠ¥é”™å¦‚ä¸‹ &lt;/font&gt;ï¼š</p>\n<p><img data-src=\"./images/image-20230516174034569.png\" alt=\"image-20230516174034569\" /></p>\n<p>è¿™æ ·ç™»å½•çš„æ—¶å€™å°±å¯ä»¥ç”¨ 123 ä½œä¸ºç”¨æˆ·åï¼Œ123 ä½œä¸ºå¯†ç äº†ç™»å½•äº†ã€‚</p>\n<p><img data-src=\"./images/image-20230516174127584.png\" alt=\"image-20230516174127584\" /></p>\n<p><strong>æ€»ç»“æµç¨‹</strong>ï¼š</p>\n<ol>\n<li>é‡å†™ UserDetailsServiceï¼Œå®ç°äº†ä»æ•°æ®æŸ¥è¯¢ç”¨æˆ·åå’Œå¯†ç ï¼Œè¿›è¡Œæ ¡éªŒçš„å·¥ä½œ</li>\n<li>åœ¨ loadUserByUsername (String username) æ–¹æ³•ä¸­è¿›è¡ŒæŸ¥è¯¢ç”¨æˆ·å¹¶åšä¸€äº›å®‰å…¨çš„æ ¡éªŒæŸ¥è¯¢ç”¨æˆ·æ˜¯å¦ä¸º null</li>\n<li>loadUserByUsername (String username) æ–¹æ³•æ‰§è¡Œæ²¡æœ‰ä»»ä½•å¼‚å¸¸åˆ™å°è£…æˆ LoginUser å¯¹è±¡è¿”å›</li>\n<li noop=\"\">å¯†ç åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ˜¯æ˜æ–‡å­˜å‚¨ï¼Œéœ€è¦åœ¨å‰é¢åŠ ä¸Š</li>\n<li>é‡å†™åå¯åŠ¨ SpringBoot æ§åˆ¶å°å°±ä¸ä¼šè¾“å‡º jwt ç”Ÿæˆçš„ password äº†</li>\n</ol>\n<h5 id=\"2332-å¯†ç åŠ å¯†å­˜å‚¨\"><a class=\"anchor\" href=\"#2332-å¯†ç åŠ å¯†å­˜å‚¨\">#</a> 2.3.3.2 å¯†ç åŠ å¯†å­˜å‚¨ğŸ°</h5>\n<p>å®é™…é¡¹ç›®ä¸­æˆ‘ä»¬ä¸ä¼šæŠŠå¯†ç æ˜æ–‡å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚</p>\n<p>é»˜è®¤ä½¿ç”¨çš„ PasswordEncoder è¦æ±‚æ•°æ®åº“ä¸­çš„å¯†ç æ ¼å¼ä¸º: {id} password. å®ƒä¼šæ ¹æ® id å»åˆ¤æ–­å¯†ç çš„åŠ å¯†æ–¹å¼ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šé‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œæ‰€ä»¥å°±éœ€è¦æ›¿æ¢ PasswordEncoderã€‚</p>\n<p>æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ SpringSecurity ä¸ºæˆ‘ä»¬æä¾›çš„ BCryptPasswordEncoderã€‚</p>\n<p>æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨æŠŠ BCryptPasswordEncoder å¯¹è±¡æ³¨å…¥ Spring å®¹å™¨ä¸­ï¼ŒSpringSecurity å°±ä¼šä½¿ç”¨è¯¥ PasswordEncoder æ¥è¿›è¡Œå¯†ç æ ¡éªŒã€‚</p>\n<p>æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª SpringSecurity çš„é…ç½®ç±»ï¼ŒSpringSecurity è¦æ±‚è¿™ä¸ªé…ç½®ç±»è¦ç»§æ‰¿ WebSecurityConfigurerAdapterã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SecurityConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t <span class=\"token comment\">// å°† BCryptPasswordEncoder å¯¹è±¡æ³¨å…¥å®¹å™¨ä¸­æ¥æ›¿ä»£ PasswordEncoder çš„åŠ å¯†æ–¹å¼</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">PasswordEncoder</span> <span class=\"token function\">passwordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BCryptPasswordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼š</p>\n<ul>\n<li>BCryptPasswordEncoder æ ¡éªŒçš„å¯†ç åŠ å¯†æ–¹å¼å¹¶ä¸æ˜¯ jwtï¼Œå¦åˆ™å¯†ç é”™è¯¯ä¼šæŠ¥ 403 é”™è¯¯</li>\n</ul>\n<p>åœ¨æµ‹è¯•ç±»ä¸­åˆ›å»º BCryptPasswordEncoder è°ƒç”¨ encode (ä¼ å…¥å¯†ç ) æ¥ç”ŸæˆåŠ å¯†åçš„å¯†ç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootTest</span><span class=\"token punctuation\">(</span>classes <span class=\"token operator\">=</span> <span class=\"token class-name\">App</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@RunWith</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SpringJUnit4ClassRunner</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserMapper</span> mapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">BCryptPasswordEncoder</span> passwordEncoder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BCryptPasswordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">String</span> encode <span class=\"token operator\">=</span> passwordEncoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"123\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>encode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token class-name\">Result</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>$<span class=\"token number\">2</span>a$<span class=\"token number\">10</span>$<span class=\"token class-name\"><span class=\"token namespace\">jBm<span class=\"token punctuation\">.</span></span>Lr0NFXSuPspDFIGv1ulorD</span><span class=\"token operator\">/</span><span class=\"token number\">6</span>cySeE<span class=\"token operator\">/</span><span class=\"token class-name\"><span class=\"token namespace\">aWmvrLhT5<span class=\"token punctuation\">.</span></span>YVsrVkSKm</span></pre></td></tr></table></figure><p>å°†åŠ å¯†åçš„å¯†æ–‡å…ˆæ‰‹åŠ¨è®¾ç½®åˆ°æ•°æ®åº“ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯ä¸­ï¼š</p>\n<p><img data-src=\"./images/image-20230520205719441.png\" alt=\"image-20230520205719441\" /></p>\n<h5 id=\"2333-ç™»å½•æ¥å£\"><a class=\"anchor\" href=\"#2333-ç™»å½•æ¥å£\">#</a> 2.3.3.3 ç™»å½•æ¥å£ğŸ¡</h5>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ç™»å½•æ¥å£ï¼Œç„¶åè®© SpringSecurity å¯¹è¿™ä¸ªæ¥å£æ”¾è¡Œï¼Œè®©ç”¨æˆ·è®¿é—®è¿™ä¸ªæ¥å£çš„æ—¶å€™ä¸ç”¨ç™»å½•ä¹Ÿèƒ½è®¿é—®ã€‚</p>\n<p>åœ¨æ¥å£ä¸­æˆ‘ä»¬é€šè¿‡ AuthenticationManager çš„ authenticate æ–¹æ³•æ¥è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œæ‰€ä»¥éœ€è¦åœ¨ SecurityConfig ä¸­é…ç½®æŠŠ AuthenticationManager æ³¨å…¥å®¹å™¨ã€‚</p>\n<p>è®¤è¯æˆåŠŸçš„è¯è¦ç”Ÿæˆä¸€ä¸ª jwtï¼Œæ”¾å…¥å“åº”ä¸­è¿”å›ã€‚å¹¶ä¸”ä¸ºäº†è®©ç”¨æˆ·ä¸‹å›è¯·æ±‚æ—¶èƒ½é€šè¿‡ jwt è¯†åˆ«å‡ºå…·ä½“çš„æ˜¯å“ªä¸ªç”¨æˆ·ï¼Œæˆ‘ä»¬éœ€è¦æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥ redisï¼Œå¯ä»¥æŠŠç”¨æˆ· id ä½œä¸º keyã€‚</p>\n<blockquote>\n<p>è¿™é‡Œä¸ç”¨åœ¨ mapper ä¸­å†™ä»£ç ï¼Œç›´æ¥åœ¨ loginService ä¸­å†™è¿”å›ç±»å‹ä¸º ResponseReuslt çš„æ–¹æ³•å‚æ•°ä¸ºå¯¹è±¡ã€‚</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Controller</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoginController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LoginServcie</span> loginServcie<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t <span class=\"token comment\">// è‡ªå®šä¹‰ç™»å½•æ¥å£</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"/user/login\"</span> <span class=\"token punctuation\">,</span> method <span class=\"token operator\">=</span> <span class=\"token class-name\">RequestMethod</span><span class=\"token punctuation\">.</span><span class=\"token constant\">POST</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseResult</span> <span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">return</span> loginServcie<span class=\"token punctuation\">.</span><span class=\"token function\">login</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SecurityConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t <span class=\"token comment\">// é…ç½® BCryptPasswordEncoder ç”¨æˆ·å¯†ç æ ¡éªŒè§„åˆ™</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">PasswordEncoder</span> <span class=\"token function\">passwordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BCryptPasswordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"10\"></td><td><pre> \t <span class=\"token comment\">// é…ç½®æ”¾è¡Œ</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        http</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token comment\">// å…³é—­ csrf</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">csrf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">disable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token comment\">// ä¸é€šè¿‡ Session è·å– SecurityContext</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">sessionManagement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sessionCreationPolicy</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SessionCreationPolicy</span><span class=\"token punctuation\">.</span><span class=\"token constant\">STATELESS</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token comment\">// å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—®</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">anonymous</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token comment\">// é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t <span class=\"token comment\">// æ³¨å…¥ AuthenticationManager å®¹å™¨</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AuthenticationManager</span> <span class=\"token function\">authenticationManagerBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticationManagerBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoginServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">LoginService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// è‡ªåŠ¨è£…é… Redis å·¥å…·ç±»</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RedisCache</span> redisCache<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// è‡ªåŠ¨è£…é… AuthenticationManager</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AuthenticationManager</span> authenticationManager<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseResult</span> <span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">//        AuthenticationManager authenticate è¿›è¡Œç”¨æˆ·è®¤è¯</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">UsernamePasswordAuthenticationToken</span> authenticationToken <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UsernamePasswordAuthenticationToken</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getUserName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">Authentication</span> authenticate <span class=\"token operator\">=</span> authenticationManager<span class=\"token punctuation\">.</span><span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span>authenticationToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">//        å¦‚æœè®¤è¯æ²¡é€šè¿‡ï¼Œç»™å‡ºå¯¹åº”çš„æç¤º</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Objects</span><span class=\"token punctuation\">.</span><span class=\"token function\">isNull</span><span class=\"token punctuation\">(</span>authenticate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç™»å½•å¤±è´¥\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">//        å¦‚æœè®¤è¯é€šè¿‡äº†ï¼Œä½¿ç”¨ userid ç”Ÿæˆä¸€ä¸ª jwt (token) jwt (token) å­˜å…¥ ResponseResult è¿”å›</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">LoginUser</span> loginUser <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">LoginUser</span><span class=\"token punctuation\">)</span> authenticate<span class=\"token punctuation\">.</span><span class=\"token function\">getPrincipal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token class-name\">String</span> userId <span class=\"token operator\">=</span> loginUser<span class=\"token punctuation\">.</span><span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">//        ç”Ÿæˆ jwt</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">String</span> jwt <span class=\"token operator\">=</span> <span class=\"token class-name\">JwtUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">createJWT</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// æŠŠ token å“åº”ç»™å‰ç«¯</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> map <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        map<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"token\"</span><span class=\"token punctuation\">,</span>jwt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">//        æŠŠå®Œæ•´çš„ç”¨æˆ·ä¿¡æ¯å­˜å…¥ redis,userid ä½œä¸º key</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        redisCache<span class=\"token punctuation\">.</span><span class=\"token function\">setCacheObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"login:\"</span><span class=\"token operator\">+</span>userId<span class=\"token punctuation\">,</span>loginUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ResponseResult</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"ç™»å½•æˆåŠŸ\"</span><span class=\"token punctuation\">,</span>map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>é…ç½® Redis</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">redis</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> 192.168.244.142</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6379</span></pre></td></tr></table></figure><ul>\n<li>è®°å¾—å¼€å¯ Redis å¦åˆ™æŠ¥é”™ï¼ŒçŠ¶æ€ç ï¼š500</li>\n</ul>\n<h5 id=\"2334-è®¤è¯è¿‡æ»¤å™¨\"><a class=\"anchor\" href=\"#2334-è®¤è¯è¿‡æ»¤å™¨\">#</a> 2.3.3.4 è®¤è¯è¿‡æ»¤å™¨ğŸ…</h5>\n<p>æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œè¿™ä¸ªè¿‡æ»¤å™¨ä¼šå»è·å–è¯·æ±‚å¤´ä¸­çš„ token, å¯¹ token è¿›è¡Œè§£æå–å‡ºå…¶ä¸­çš„ userIdã€‚</p>\n<p>ä½¿ç”¨ userId å» redis ä¸­è·å–å¯¹åº”çš„ LoginUser å¯¹è±¡ã€‚</p>\n<p>ç„¶åå°è£… Authentication å¯¹è±¡å­˜å…¥ SecurityContextHolder</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JwtAuthenticationTokenFilter</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">OncePerRequestFilter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RedisCache</span> redisCache<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doFilterInternal</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">FilterChain</span> filterChain<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ServletException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">//        è·å– token</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">String</span> token <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"token\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasText</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">//            æ”¾è¡Œ</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            filterChain<span class=\"token punctuation\">.</span><span class=\"token function\">doFilter</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span>response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">//        è§£æ token è·å– userId</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">String</span> userId<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token class-name\">Claims</span> claims <span class=\"token operator\">=</span> <span class=\"token class-name\">JwtUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseJWT</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            userId <span class=\"token operator\">=</span> claims<span class=\"token punctuation\">.</span><span class=\"token function\">getSubject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tokenéæ³•\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">//        é€šè¿‡ userId ä» redis ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ LoginUser</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">String</span> redisKey <span class=\"token operator\">=</span> <span class=\"token string\">\"login:\"</span> <span class=\"token operator\">+</span> userId<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">LoginUser</span> loginUser <span class=\"token operator\">=</span> redisCache<span class=\"token punctuation\">.</span><span class=\"token function\">getCacheObject</span><span class=\"token punctuation\">(</span>redisKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Objects</span><span class=\"token punctuation\">.</span><span class=\"token function\">isNull</span><span class=\"token punctuation\">(</span>loginUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç”¨æˆ·æœªç™»å½•\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">//        å¦‚æœèƒ½ä» redis ä¸­è·å– LoginUser å°±å­˜å…¥ securityContextHolder</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">//        TODO è·å–æƒé™ä¿¡æ¯å°è£…åˆ° Authentication ä¸­</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token class-name\">UsernamePasswordAuthenticationToken</span> authentication <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UsernamePasswordAuthenticationToken</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token punctuation\">(</span>loginUser<span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setAuthentication</span><span class=\"token punctuation\">(</span>authentication<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\">//        æ”¾è¡Œ</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        filterChain<span class=\"token punctuation\">.</span><span class=\"token function\">doFilter</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span>response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SecurityConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">PasswordEncoder</span> <span class=\"token function\">passwordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BCryptPasswordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token class-name\">JwtAuthenticationTokenFilter</span> jwtAuthenticationTokenFilter<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        http</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token comment\">// å…³é—­ csrf</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">csrf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">disable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token comment\">// ä¸é€šè¿‡ Session è·å– SecurityContext</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">sessionManagement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sessionCreationPolicy</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SessionCreationPolicy</span><span class=\"token punctuation\">.</span><span class=\"token constant\">STATELESS</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>           \t\t <span class=\"token comment\">// è¿”å›å€¼ä¸º HttpSecurity å¯ä»¥ç»§ç»­è°ƒç”¨å…¶å®ƒçš„</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token comment\">// å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—®</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">anonymous</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token comment\">//permitAll ä»£è¡¨æ— è®ºæ˜¯å¦ç™»å½•éƒ½èƒ½è®¿é—®</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token comment\">// é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// æŠŠ token æ ¡éªŒè¿‡æ»¤å™¨æ·»åŠ åˆ°è¿‡æ»¤å™¨é“¾ä¸­</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        http<span class=\"token punctuation\">.</span><span class=\"token function\">addFilterBefore</span><span class=\"token punctuation\">(</span>jwtAuthenticationTokenFilter<span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">// æ·»åŠ è¿‡æ»¤å™¨</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t  <span class=\"token class-name\">UsernamePasswordAuthenticationFilter</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AuthenticationManager</span> <span class=\"token function\">authenticationManagerBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticationManagerBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h5 id=\"2335-é€€å‡ºç™»å½•\"><a class=\"anchor\" href=\"#2335-é€€å‡ºç™»å½•\">#</a> 2.3.3.5 é€€å‡ºç™»å½•ğŸ¦„</h5>\n<p>æˆ‘ä»¬åªéœ€è¦å®šä¹‰ä¸€ä¸ªç™»å½•æ¥å£ï¼Œç„¶åè·å– SecurityContextHolder ä¸­çš„è®¤è¯ä¿¡æ¯ï¼Œåˆ é™¤ redis ä¸­å¯¹åº”çš„æ•°æ®å³å¯ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoginServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">LoginService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RedisCache</span> redisCache<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AuthenticationManager</span> authenticationManager<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseResult</span> <span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">//        AuthenticationManager authenticate è¿›è¡Œç”¨æˆ·è®¤è¯</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">UsernamePasswordAuthenticationToken</span> authenticationToken <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UsernamePasswordAuthenticationToken</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getUserName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">Authentication</span> authenticate <span class=\"token operator\">=</span> authenticationManager<span class=\"token punctuation\">.</span><span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span>authenticationToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">//        å¦‚æœè®¤è¯æ²¡é€šè¿‡ï¼Œç»™å‡ºå¯¹åº”çš„æç¤º</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Objects</span><span class=\"token punctuation\">.</span><span class=\"token function\">isNull</span><span class=\"token punctuation\">(</span>authenticate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç™»å½•å¤±è´¥\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">//        å¦‚æœè®¤è¯é€šè¿‡äº†ï¼Œä½¿ç”¨ userid ç”Ÿæˆä¸€ä¸ª jwt jwt å­˜å…¥ ResponseResult è¿”å›</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>       <span class=\"token comment\">//Authenticatoin.getPrincipal () å¯ä»¥è·å–ä»£è¡¨å½“å‰ç”¨æˆ·ä¿¡æ¯ã€‚</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">LoginUser</span> loginUser <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">LoginUser</span><span class=\"token punctuation\">)</span> authenticate<span class=\"token punctuation\">.</span><span class=\"token function\">getPrincipal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">String</span> userId <span class=\"token operator\">=</span> loginUser<span class=\"token punctuation\">.</span><span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">//        ç”Ÿæˆ jwt</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">String</span> jwt <span class=\"token operator\">=</span> <span class=\"token class-name\">JwtUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">createJWT</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> map <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        map<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"token\"</span><span class=\"token punctuation\">,</span>jwt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">//        æŠŠå®Œæ•´çš„ç”¨æˆ·ä¿¡æ¯å­˜å…¥ redis,userid ä½œä¸º key</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        redisCache<span class=\"token punctuation\">.</span><span class=\"token function\">setCacheObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"login:\"</span><span class=\"token operator\">+</span>userId<span class=\"token punctuation\">,</span>loginUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ResponseResult</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"ç™»å½•æˆåŠŸ\"</span><span class=\"token punctuation\">,</span>map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseResult</span> <span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">//        è·å– SecurityContextHolder ä¸­çš„ç”¨æˆ· id</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token class-name\">UsernamePasswordAuthenticationToken</span> authentication <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">UsernamePasswordAuthenticationToken</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token class-name\">LoginUser</span> loginUser <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">LoginUser</span><span class=\"token punctuation\">)</span> authentication<span class=\"token punctuation\">.</span><span class=\"token function\">getPrincipal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token class-name\">Long</span> userId <span class=\"token operator\">=</span> loginUser<span class=\"token punctuation\">.</span><span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">//        åˆ é™¤ redis ä¸­çš„å€¼</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        redisCache<span class=\"token punctuation\">.</span><span class=\"token function\">deleteObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"login:\"</span><span class=\"token operator\">+</span>userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ResponseResult</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"æ³¨é”€æˆåŠŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><hr />\n<h2 id=\"3-æˆæƒ\"><a class=\"anchor\" href=\"#3-æˆæƒ\">#</a> 3 æˆæƒğŸ¨</h2>\n<h3 id=\"3-æƒé™ç³»ç»Ÿçš„ä½œç”¨\"><a class=\"anchor\" href=\"#3-æƒé™ç³»ç»Ÿçš„ä½œç”¨\">#</a> 3 æƒé™ç³»ç»Ÿçš„ä½œç”¨ğŸ›´</h3>\n<p>ä¾‹å¦‚ä¸€ä¸ªå­¦æ ¡å›¾ä¹¦é¦†çš„ç®¡ç†ç³»ç»Ÿï¼Œå¦‚æœæ˜¯æ™®é€šå­¦ç”Ÿç™»å½•å°±èƒ½çœ‹åˆ°å€Ÿä¹¦è¿˜ä¹¦çš„åŠŸèƒ½ï¼Œä¸å¯èƒ½è®©å®ƒçœ‹åˆ°å¹¶ä¸”å»ä½¿ç”¨æ·»åŠ ä¹¦ç±ä¿¡æ¯ï¼Œåˆ é™¤ä¹¦ç±ä¿¡æ¯ç­‰åŠŸèƒ½ï¼Œä½†æ˜¯å¦‚æœæ˜¯ä¸€ä¸ªå›¾ä¹¦ç®¡ç†å‘˜çš„è´¦å·ç™»å½•äº†ï¼Œåº”è¯¥å°±èƒ½çœ‹åˆ°å¹¶ä½¿ç”¨æ·»åŠ ä¹¦ç±ä¿¡æ¯ï¼Œåˆ é™¤ä¹¦ç±ä¿¡æ¯ç­‰åŠŸèƒ½ã€‚</p>\n<p>æ€»ç»“èµ·æ¥å°±æ˜¯<strong>ä¸åŒçš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨ä¸åŒçš„åŠŸèƒ½</strong>ã€‚è¿™å°±æ˜¯æƒé™ç³»ç»Ÿè¦å»å®ç°çš„æ•ˆæœã€‚</p>\n<p>æˆ‘ä»¬ä¸èƒ½åªä¾èµ–å‰ç«¯å»åˆ¤æ–­ç”¨æˆ·çš„æƒé™æ¥é€‰æ‹©æ˜¾ç¤ºå“ªäº›èœå•å“ªäº›æŒ‰é’®ã€‚å› ä¸ºå¦‚æœåªæ˜¯è¿™æ ·ï¼Œå¦‚æœæœ‰äººçŸ¥é“äº†å¯¹åº”çš„æ¥å£åœ°å€å°±å¯ä»¥ä¸é€šè¿‡å‰ç«¯ï¼Œç›´æ¥å»å‘é€è¯·æ±‚æ¥å®ç°ç›¸å…³åŠŸèƒ½æ“ä½œã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦åœ¨åå°è¿›è¡Œç”¨æˆ·æƒé™çš„åˆ¤æ–­ï¼Œåˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰ç›¸åº”çš„æƒé™ï¼Œå¿…é¡»å…·æœ‰æ‰€éœ€æƒé™æ‰èƒ½è¿›è¡Œå“åº”çš„æ“ä½œã€‚</p>\n<hr />\n<h3 id=\"31-æˆæƒåŸºæœ¬æµç¨‹\"><a class=\"anchor\" href=\"#31-æˆæƒåŸºæœ¬æµç¨‹\">#</a> 3.1 æˆæƒåŸºæœ¬æµç¨‹ğŸ¦…</h3>\n<p>åœ¨ SpringSecurity ä¸­ï¼Œä¼šä½¿ç”¨é»˜è®¤çš„ FilterSecurityInterceptor æ¥è¿›è¡Œæƒé™æ ¡éªŒï¼Œåœ¨ FilterSecurityInterceptor ä¸­ä¼šä» SecurityContextHolder è·å–å…¶ä¸­çš„ Authenticationï¼Œç„¶åè·å–å…¶ä¸­çš„æƒé™ä¿¡æ¯ã€‚å½“å‰ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰è®¿é—®å½“å‰èµ„æºæ‰€éœ€çš„æƒé™ã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­åªéœ€è¦æŠŠå½“å‰ç™»å½•ç”¨æˆ·çš„æƒé™ä¿¡æ¯ä¹Ÿå­˜å…¥ Authenticationã€‚</p>\n<p>ç„¶åè®¾ç½®æˆ‘ä»¬çš„èµ„æºæ‰€éœ€çš„æƒé™å³å¯ã€‚</p>\n<hr />\n<h3 id=\"32-æˆæƒå®ç°\"><a class=\"anchor\" href=\"#32-æˆæƒå®ç°\">#</a> 3.2 æˆæƒå®ç°ğŸŒœ</h3>\n<h4 id=\"321-é™åˆ¶è®¿é—®èµ„æºæ‰€éœ€æƒé™\"><a class=\"anchor\" href=\"#321-é™åˆ¶è®¿é—®èµ„æºæ‰€éœ€æƒé™\">#</a> 3.2.1 é™åˆ¶è®¿é—®èµ„æºæ‰€éœ€æƒé™ğŸ—‘</h4>\n<p>SpringSecurity ä¸ºæˆ‘ä»¬æä¾›äº†åŸºäºæ³¨è§£çš„æƒé™æ§åˆ¶æ–¹æ¡ˆï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬é¡¹ç›®ä¸­ä¸»è¦é‡‡ç”¨çš„æ–¹å¼ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ³¨è§£å»æŒ‡å®šè®¿é—®å¯¹åº”çš„èµ„æºæ‰€éœ€çš„æƒé™ã€‚</p>\n<p>ä½†æ˜¯è¦ä½¿ç”¨å®ƒæˆ‘ä»¬éœ€è¦å…ˆå¼€å¯ç›¸å…³é…ç½®ã€‚</p>\n<p>åœ¨ SecurityConfig ç±»ä¸­æ·»åŠ æ³¨è§£</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@EnableGlobalMethodSecurity</span><span class=\"token punctuation\">(</span>prePostEnabled <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥ä½¿ç”¨å¯¹åº”çš„æ³¨è§£ã€‚@PreAuthorize</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Controller</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HelloController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LoginService</span> loginService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">//hasAuthoriryï¼šè¯»å–æ³¨è§£ä¸­çš„å±æ€§å€¼è¿”å›ç»“æœæ˜¯ boolean å€¼ï¼Œtest æƒé™åˆ™è¿”å› true å»æ‰§è¡Œ</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@PreAuthorize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hasAuthority('test')\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/hello\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"322-å°è£…æƒé™ä¿¡æ¯\"><a class=\"anchor\" href=\"#322-å°è£…æƒé™ä¿¡æ¯\">#</a> 3.2.2 å°è£…æƒé™ä¿¡æ¯ğŸ—¾</h4>\n<p>æˆ‘ä»¬å‰é¢åœ¨å†™ UserDetailsServiceImpl çš„æ—¶å€™è¯´è¿‡ï¼Œåœ¨æŸ¥è¯¢å‡ºç”¨æˆ·åè¿˜è¦è·å–å¯¹åº”çš„æƒé™ä¿¡æ¯ï¼Œå°è£…åˆ° UserDetails ä¸­è¿”å›ã€‚</p>\n<p>æˆ‘ä»¬å…ˆç›´æ¥æŠŠæƒé™ä¿¡æ¯å†™æ­»å°è£…åˆ° UserDetails ä¸­è¿›è¡Œæµ‹è¯•ã€‚</p>\n<p>æˆ‘ä»¬ä¹‹å‰å®šä¹‰äº† UserDetails çš„å®ç°ç±» LoginUserï¼Œæƒ³è¦è®©å…¶å°è£…æƒé™ä¿¡æ¯å°±è¦å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>sangeng<span class=\"token punctuation\">.</span>domain</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>fastjson<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">JSONField</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AllArgsConstructor</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Data</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">NoArgsConstructor</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">GrantedAuthority</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>authority<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SimpleGrantedAuthority</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>userdetails<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">UserDetails</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Collection</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>stream<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Collectors</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token annotation punctuation\">@NoArgsConstructor</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoginUser</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserDetails</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token comment\">// å­˜å‚¨æƒé™ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> permissions<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token comment\">// å­˜å‚¨ SpringSecurity æ‰€éœ€è¦çš„æƒé™ä¿¡æ¯çš„é›†åˆï¼ŒåŠ ä¸Šè¯¥æ³¨è§£è¡¨ç¤ºä¸ä¼šè¢«åºåˆ—åŒ–</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token annotation punctuation\">@JSONField</span><span class=\"token punctuation\">(</span>serialize <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">GrantedAuthority</span><span class=\"token punctuation\">></span></span> authorities<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">LoginUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">,</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> permissions<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>user <span class=\"token operator\">=</span> user<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>permissions <span class=\"token operator\">=</span> permissions<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">public</span>  <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">GrantedAuthority</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>authorities<span class=\"token operator\">!=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token keyword\">return</span> authorities<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token comment\">// æŠŠ permissions ä¸­å­—ç¬¦ä¸²ç±»å‹çš„æƒé™ä¿¡æ¯è½¬æ¢æˆ GrantedAuthority å¯¹è±¡å­˜å…¥ authorities ä¸­</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        authorities <span class=\"token operator\">=</span> permissions<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SimpleGrantedAuthority</span><span class=\"token operator\">::</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">return</span> authorities<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token keyword\">return</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token keyword\">return</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getUserName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isAccountNonExpired</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isAccountNonLocked</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isCredentialsNonExpired</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isEnabled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"323-ä»æ•°æ®åº“æŸ¥è¯¢æƒé™ä¿¡æ¯\"><a class=\"anchor\" href=\"#323-ä»æ•°æ®åº“æŸ¥è¯¢æƒé™ä¿¡æ¯\">#</a> 3.2.3 ä»æ•°æ®åº“æŸ¥è¯¢æƒé™ä¿¡æ¯</h4>\n<h5 id=\"3231-rbacæƒé™æ¨¡å‹\"><a class=\"anchor\" href=\"#3231-rbacæƒé™æ¨¡å‹\">#</a> 3.2.3.1 RBAC æƒé™æ¨¡å‹</h5>\n<p>RBAC æƒé™æ¨¡å‹ (Role-Based Access Control) å³ï¼šåŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ï¼Œè¿™æ˜¯ç›®å‰æœ€å¸¸è¢«å¼€å‘è€…ä½¿ç”¨ä¹Ÿæ˜¯ç›¸å¯¹æ˜“ç”¨ï¼Œé€šç”¨æƒé™æ¨¡å‹ã€‚</p>\n<p><img data-src=\"./images/image-20211222110249727.png\" alt=\"image-20211222110249727\" /></p>\n<h4 id=\"3232-å‡†å¤‡å·¥ä½œ\"><a class=\"anchor\" href=\"#3232-å‡†å¤‡å·¥ä½œ\">#</a> 3.2.3.2 å‡†å¤‡å·¥ä½œ</h4>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>sys_menu<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>menu_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'NULL'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'èœå•å'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>path<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è·¯ç”±åœ°å€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>component<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç»„ä»¶è·¯å¾„'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>visible<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'èœå•çŠ¶æ€ï¼ˆ0æ˜¾ç¤º 1éšè—ï¼‰'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>status<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'èœå•çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>perms<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æƒé™æ ‡è¯†'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>icon<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'#'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'èœå•å›¾æ ‡'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>create_by<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>create_time<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>update_by<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>update_time<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>del_flag<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æ˜¯å¦åˆ é™¤ï¼ˆ0æœªåˆ é™¤ 1å·²åˆ é™¤ï¼‰'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>remark<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å¤‡æ³¨'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token operator\">=</span><span class=\"token number\">2</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'èœå•è¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>sys_menu<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span>menu_name<span class=\"token punctuation\">,</span>path<span class=\"token punctuation\">,</span>component<span class=\"token punctuation\">,</span>perms<span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> </pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token string\">'éƒ¨é—¨ç®¡ç†'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dept'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'system/dept/index'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'system:dept:list'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>sys_menu<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span>menu_name<span class=\"token punctuation\">,</span>path<span class=\"token punctuation\">,</span>component<span class=\"token punctuation\">,</span>perms<span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> </pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token string\">'æµ‹è¯•'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dept'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'system/test/index'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'system:test:list'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">/*Table structure for table `sys_role` */</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>sys_role<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>sys_role<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>role_key<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è§’è‰²æƒé™å­—ç¬¦ä¸²'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>status<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è§’è‰²çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>del_flag<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'del_flag'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>create_by<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>create_time<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>update_by<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>update_time<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>remark<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å¤‡æ³¨'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token operator\">=</span><span class=\"token number\">3</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'è§’è‰²è¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>sys_role<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span>role_key<span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>status<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> </pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token string\">'CEO'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'ceo'</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>sys_role<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span>role_key<span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>status<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> </pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token string\">'Coder'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'coder'</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token comment\">/*Table structure for table `sys_role_menu` */</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>sys_role_menu<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>sys_role_menu<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>role_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è§’è‰²ID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>menu_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'èœå•id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>role_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>menu_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token operator\">=</span><span class=\"token number\">2</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>sys_role_menu<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span>role_id<span class=\"token punctuation\">,</span>menu_id<span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> </pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>sys_role_menu<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span>role_id<span class=\"token punctuation\">,</span>menu_id<span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> </pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token comment\">/*Table structure for table `sys_user_role` */</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>sys_user_role<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>sys_user_role<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>user_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç”¨æˆ·id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>role_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è§’è‰²id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>user_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>role_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre></pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>sys_user_role<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span>user_id<span class=\"token punctuation\">,</span>role_id<span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> </pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>æŸ¥è¯¢ç”¨æˆ·æƒé™ SQL</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">SELECT</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token keyword\">DISTINCT</span> em<span class=\"token punctuation\">.</span>perms </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">FROM</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tsys_user_role <span class=\"token keyword\">AS</span> ur</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token comment\">#è”è¡¨æŸ¥è¯¢</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> sys_role <span class=\"token keyword\">AS</span> ro <span class=\"token keyword\">ON</span> ur<span class=\"token punctuation\">.</span>role_id <span class=\"token operator\">=</span> ro<span class=\"token punctuation\">.</span>id</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> sys_role_menu rm <span class=\"token keyword\">ON</span> ur<span class=\"token punctuation\">.</span>role_id <span class=\"token operator\">=</span> rm<span class=\"token punctuation\">.</span>role_id</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> sys_menu <span class=\"token keyword\">AS</span> em <span class=\"token keyword\">ON</span> em<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> rm<span class=\"token punctuation\">.</span>menu_id </pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">WHERE</span><span class=\"token comment\">#æŸ¥è¯¢æ¡ä»¶</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tur<span class=\"token punctuation\">.</span>user_id <span class=\"token operator\">=</span> <span class=\"token number\">2</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token operator\">AND</span> ro<span class=\"token punctuation\">.</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>status<span class=\"token punctuation\">`</span></span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token operator\">AND</span> em<span class=\"token punctuation\">.</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>status<span class=\"token punctuation\">`</span></span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr></table></figure><p>èœå•è¡¨ (Menu) å®ä½“ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>sangeng<span class=\"token punctuation\">.</span>domain</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>baomidou<span class=\"token punctuation\">.</span>mybatisplus<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">TableId</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>baomidou<span class=\"token punctuation\">.</span>mybatisplus<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">TableName</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fasterxml<span class=\"token punctuation\">.</span>jackson<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">JsonInclude</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AllArgsConstructor</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Data</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">NoArgsConstructor</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Serializable</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Date</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * èœå•è¡¨ (Menu) å®ä½“ç±»</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> * @author makejava</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> * @since 2021-11-24 15:30:08</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token annotation punctuation\">@TableName</span><span class=\"token punctuation\">(</span>value<span class=\"token operator\">=</span><span class=\"token string\">\"sys_menu\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token annotation punctuation\">@AllArgsConstructor</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token annotation punctuation\">@NoArgsConstructor</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token annotation punctuation\">@JsonInclude</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JsonInclude<span class=\"token punctuation\">.</span>Include</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NON_NULL</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Menu</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> serialVersionUID <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">54979041104113736L</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token annotation punctuation\">@TableId</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    * èœå•å</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> menuName<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    * è·¯ç”±åœ°å€</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> path<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    * ç»„ä»¶è·¯å¾„</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> component<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    * èœå•çŠ¶æ€ï¼ˆ0 æ˜¾ç¤º 1 éšè—ï¼‰</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> visible<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    * èœå•çŠ¶æ€ï¼ˆ0 æ­£å¸¸ 1 åœç”¨ï¼‰</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> status<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    * æƒé™æ ‡è¯†</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> perms<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    * èœå•å›¾æ ‡</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> icon<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> createBy<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Date</span> createTime<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> updateBy<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Date</span> updateTime<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    * æ˜¯å¦åˆ é™¤ï¼ˆ0 æœªåˆ é™¤ 1 å·²åˆ é™¤ï¼‰</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> delFlag<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    * å¤‡æ³¨</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> remark<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"3233-ä»£ç å®ç°\"><a class=\"anchor\" href=\"#3233-ä»£ç å®ç°\">#</a> 3.2.3.3 ä»£ç å®ç°</h4>\n<p>æˆ‘ä»¬åªéœ€è¦æ ¹æ®ç”¨æˆ· id å»æŸ¥è¯¢åˆ°å…¶æ‰€å¯¹åº”çš„æƒé™ä¿¡æ¯å³å¯ã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆå†™ä¸€ä¸ª mapperï¼Œå…¶ä¸­æä¾›ä¸€ä¸ªæ–¹æ³•å¯ä»¥æ ¹æ® userid æŸ¥è¯¢æƒé™ä¿¡æ¯ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Mapper</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">MenuMapper</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseMapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Menu</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">selectPermsByUserId</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åˆ›å»ºå¯¹åº”çš„ mapper æ–‡ä»¶ï¼Œå®šä¹‰å¯¹åº”çš„ sql è¯­å¥ã€‚</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">mapper</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"https://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">&lt;!--namespace ç»‘å®šä¸€ä¸ªå¯¹åº”çš„ Dao (Mapper) æ¥å£ --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.dkx.mapper.MenuMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>selectPermsByUserId<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>String<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        SELECT DISTINCT em.perms</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        FROM sys_user_role as ur</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                 LEFT JOIN sys_role as ro ON ur.role_id = ro.id</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                 LEFT JOIN sys_role_menu rm ON ur.role_id = rm.role_id</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                 LEFT JOIN sys_menu as em ON em.id = rm.menu_id</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        WHERE ur.user_id = 2</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>          AND ro.status = 0</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>          AND em.status = 0</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨ UserDetailsServiceImpl ä¸­å»è°ƒç”¨è¯¥ mapperd çš„æ–¹æ³•æŸ¥è¯¢æƒé™ä¿¡æ¯å°è£…åˆ° LoginUser å¯¹è±¡ä¸­å³å¯ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserDetailsServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserDetailsService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserMapper</span> userMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">MenuMapper</span> menuMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserDetails</span> <span class=\"token function\">loadUserByUsername</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">UsernameNotFoundException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">//        æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">LambdaQueryWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> wrapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LambdaQueryWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">eq</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span><span class=\"token operator\">::</span><span class=\"token function\">getUserName</span><span class=\"token punctuation\">,</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> userMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectOne</span><span class=\"token punctuation\">(</span>wrapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">//        å¦‚æœæ²¡æœ‰æŸ¥è¯¢åˆ°ç”¨æˆ·å°±æŠ›å‡ºå¼‚å¸¸</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Objects</span><span class=\"token punctuation\">.</span><span class=\"token function\">isNull</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">//TODO        æŸ¥è¯¢å¯¹åº”çš„æƒé™ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> menuMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectPermsByUserId</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">//        List&lt;String> list = new ArrayList&lt;>(Arrays.asList(\"test\",\"admin\"));</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LoginUser</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><hr />\n<h2 id=\"4-è‡ªå®šä¹‰å¤±è´¥å¤„ç†\"><a class=\"anchor\" href=\"#4-è‡ªå®šä¹‰å¤±è´¥å¤„ç†\">#</a> 4 è‡ªå®šä¹‰å¤±è´¥å¤„ç†ğŸ’¤</h2>\n<p>æˆ‘ä»¬è¿˜å¸Œæœ›åœ¨è®¤è¯å¤±è´¥æˆ–è€…æ˜¯æˆæƒå¤±è´¥çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å’Œæˆ‘ä»¬çš„æ¥å£ä¸€æ ·è¿”å›ç›¸åŒç»“æ„çš„ jsonï¼Œè¿™æ ·å¯ä»¥è®©å‰ç«¯èƒ½å¤Ÿå“åº”è¿›è¡Œç»Ÿä¸€çš„å¤„ç†ï¼Œè¦å®ç°è¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬éœ€è¦çŸ¥é“ SpringSecurity çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚</p>\n<p>åœ¨ SpringSecurity ä¸­ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è®¤è¯æˆ–è€…æˆæƒçš„è¿‡ç¨‹ä¸­å‡ºç°äº†å¼‚å¸¸ä¼šè¢« ExceptionTranslationFilter æ•è·åˆ°ã€‚åœ¨ ExceptionTranslationFilter ä¸­ä¼šå»åˆ¤æ–­æ˜¯è®¤è¯å¤±è´¥è¿˜æ˜¯æˆæƒå¤±è´¥å‡ºç°çš„å¼‚å¸¸ã€‚</p>\n<p>å¦‚æœæ˜¯è®¤è¯è¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ä¼šè¢«å°è£…æˆ AuthenticationException ç„¶åè°ƒç”¨ AuthenticationEntryPoint å¯¹è±¡çš„æ–¹æ³•å»è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚</p>\n<p>å¦‚æœæ˜¯æˆæƒè¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ä¼šè¢«å°è£…æˆ AccessDeniedException ç„¶åè°ƒç”¨ AccessDeniedHander å¯¹è±¡çš„æ–¹æ³•å»è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚</p>\n<p>æ‰€ä»¥å¦‚æœæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ï¼Œæˆ‘ä»¬åªéœ€è¦è‡ªå®šä¹‰ AuthenticationEntryPoint å’Œ AccessDeniedHanler ç„¶åé…ç½®ç»™ SpeingSecurity å³å¯ã€‚</p>\n<p>â‘  è‡ªå®šä¹‰å®ç°ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AuthenticationEntryPointImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">AuthenticationEntryPoint</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">commence</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AuthenticationException</span> e<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">ResponseResult</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ResponseResult</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpStatus</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UNAUTHORIZED</span><span class=\"token punctuation\">.</span><span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"ç”¨æˆ·è®¤è¯å¤±è´¥è¯·æŸ¥è¯¢ç™»å½•\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">String</span> json <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSONString</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//        å¤„ç†å¼‚å¸¸</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">WebUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">renderString</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">,</span>json<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccessDeniedHandlerImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">AccessDeniedHandler</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AccessDeniedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">ResponseResult</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ResponseResult</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpStatus</span><span class=\"token punctuation\">.</span><span class=\"token constant\">FORBIDDEN</span><span class=\"token punctuation\">.</span><span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"ç”¨æˆ·æˆæƒå¤±è´¥è¯·æŸ¥è¯¢ç™»å½•\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">String</span> json <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSONString</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">WebUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">renderString</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">,</span>json<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>â‘¡ é…ç½® SpeingSecurity</p>\n<p>åœ¨ SecurityConfig ç±»ä¸­ï¼Œå…ˆæ³¨å…¥å¯¹åº”çš„å¤„ç†å™¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">AuthenticationEntryPoint</span> authenticationEntryPoint<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">AccessDeniedHandler</span> accessDeniedHandler<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ HttpSecurity http å¯¹è±¡çš„æ–¹æ³•å»é…ç½®ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// é…ç½®å¼‚å¸¸å¤„ç†å™¨</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>http<span class=\"token punctuation\">.</span><span class=\"token function\">exceptionHandling</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\">// é…ç½®è®¤è¯å¤±è´¥å¤„ç†å™¨</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token punctuation\">.</span><span class=\"token function\">authenticationEntryPoint</span><span class=\"token punctuation\">(</span>authenticationEntryPoint<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token comment\">// é…ç½®æˆæƒå¤±è´¥å¤„ç†å™¨</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token punctuation\">.</span><span class=\"token function\">accessDeniedHandler</span><span class=\"token punctuation\">(</span>accessDeniedHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>æµ‹è¯•æ­¥éª¤</strong>ï¼š</p>\n<ol>\n<li>å…ˆæµ‹è¯• login æ¥å£ï¼Œæ‹¿åˆ° token å†å»ç”¨ token æ”¾åˆ° hello æ¥å£ä¸­å»è¯·æ±‚</li>\n</ol>\n<p><strong>æµ‹è¯•æˆæƒå¤±è´¥åœºæ™¯</strong>ï¼š</p>\n<p>å°†æƒé™è¡¨è¾¾å¼ä¸­çš„æƒé™å€¼æ”¹ä¸ºç™»å½•ç³»ç»Ÿä¸­ä¸å­˜åœ¨çš„ï¼Œå†å°† hello æ¥å£è¯·æ±‚ä¸­æ·»åŠ  token æºå¸¦ token å»è¯·æ±‚</p>\n<p><img data-src=\"./images/image-20230518143620414.png\" alt=\"image-20230518143620414\" /></p>\n<p><strong>PostMan ç»“æœ</strong>ï¼š</p>\n<p><img data-src=\"./images/image-20230518143302423.png\" alt=\"image-20230518143302423\" /></p>\n<p><strong>æµ‹è¯•è®¤è¯å¤±è´¥åœºæ™¯</strong>ï¼š</p>\n<p>åªéœ€è¦å°†ç”¨æˆ·åè¯·æ±‚è¿‡å»ä¸€ä¸ªæ•°æ®åº“ä¸­ä¸å­˜åœ¨çš„å³å¯ã€‚</p>\n<p><img data-src=\"./images/image-20230518143449553.png\" alt=\"image-20230518143449553\" /></p>\n<hr />\n<h2 id=\"5-è·¨åŸŸ\"><a class=\"anchor\" href=\"#5-è·¨åŸŸ\">#</a> 5 è·¨åŸŸğŸ‚</h2>\n<p>æµè§ˆå™¨å¤„äºå®‰å…¨çš„è€ƒè™‘ï¼Œä½¿ç”¨ XMLHttpRequest å¯¹è±¡å‘èµ· HTTP è¯·æ±‚æ—¶å¿…é¡»éµå®ˆåŒæºç­–ç•¥ï¼Œå¦åˆ™å°±æ˜¯è·¨åŸŸçš„ HTTP è¯·æ±‚ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯è¢«ç¦æ­¢çš„ï¼ŒåŒæºç­–ç•¥è¦æ±‚æºç›¸åŒæ‰èƒ½æ­£å¸¸è¿›è¡Œé€šä¿¡ï¼ŒåŠåè®®ï¼ŒåŸŸåï¼Œç«¯å£å·éƒ½å®Œå…¨ä¸€è‡´ã€‚</p>\n<p>å‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼Œå‰ç«¯é¡¹ç›®å’Œåç«¯é¡¹ç›®ä¸€èˆ¬éƒ½ä¸æ˜¯åŒæºçš„ï¼Œæ‰€ä»¥è‚¯å®šä¼šå­˜åœ¨è·¨åŸŸè¯·æ±‚çš„é—®é¢˜ã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬å°±è¦å¤„ç†ä¸€ä¸‹ï¼Œè®©å‰ç«¯èƒ½è¿›è¡Œè·¨åŸŸè¯·æ±‚ã€‚</p>\n<p>â‘  å…ˆå¯¹ SpringBoot é…ç½®ï¼Œè¿è¡Œè·¨åŸŸè¯·æ±‚ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CorsConfig</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">WebMvcConfigurer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addCorsMappings</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CorsRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token comment\">// è®¾ç½®å…è®¸è·¨åŸŸçš„è·¯å¾„</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/**\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token comment\">// è®¾ç½®å…è®¸è·¨åŸŸè¯·æ±‚çš„åŸŸå</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">allowedOriginPatterns</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token comment\">// æ˜¯å¦å…è®¸ cookie</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">allowCredentials</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token comment\">// è®¾ç½®å…è®¸çš„è¯·æ±‚æ–¹å¼</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">allowedMethods</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"DELETE\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PUT\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token comment\">// è®¾ç½®å…è®¸çš„ header å±æ€§</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">allowedHeaders</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token comment\">// è·¨åŸŸå…è®¸æ—¶é—´</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">maxAge</span><span class=\"token punctuation\">(</span><span class=\"token number\">3600</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>â‘¡ å¼€å¯ SpringSecurity çš„è·¨åŸŸè®¿é—®</p>\n<p>ç”±äºæˆ‘ä»¬çš„èµ„æºéƒ½ä¼šæ”¶åˆ° SpringSecurity çš„ä¿æŠ¤ï¼Œæ‰€ä»¥æƒ³è¦è·¨åŸŸè®¿é—®è¿˜è¦è®© SpringSecurity è¿è¡Œè·¨åŸŸè®¿é—®ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   http</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token comment\">// å…³é—­ csrf</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">csrf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">disable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token comment\">// ä¸é€šè¿‡ Session è·å– SecurityContext</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">sessionManagement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sessionCreationPolicy</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SessionCreationPolicy</span><span class=\"token punctuation\">.</span><span class=\"token constant\">STATELESS</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token comment\">// å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—®</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">anonymous</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token comment\">// é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token comment\">// æ·»åŠ è¿‡æ»¤å™¨</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   http<span class=\"token punctuation\">.</span><span class=\"token function\">addFilterBefore</span><span class=\"token punctuation\">(</span>jwtAuthenticationTokenFilter<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UsernamePasswordAuthenticationFilter</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token comment\">// é…ç½®å¼‚å¸¸å¤„ç†å™¨</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   http<span class=\"token punctuation\">.</span><span class=\"token function\">exceptionHandling</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token comment\">// é…ç½®è®¤è¯å¤±è´¥å¤„ç†å™¨</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">authenticationEntryPoint</span><span class=\"token punctuation\">(</span>authenticationEntryPoint<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">accessDeniedHandler</span><span class=\"token punctuation\">(</span>accessDeniedHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token comment\">// å…è®¸è·¨åŸŸ</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   http<span class=\"token punctuation\">.</span><span class=\"token function\">cors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><hr />\n<h2 id=\"6-é—ç•™å°é—®é¢˜\"><a class=\"anchor\" href=\"#6-é—ç•™å°é—®é¢˜\">#</a> 6 é—ç•™å°é—®é¢˜</h2>\n<h3 id=\"å…¶å®ƒæƒé™æ ¡éªŒæ–¹æ³•\"><a class=\"anchor\" href=\"#å…¶å®ƒæƒé™æ ¡éªŒæ–¹æ³•\">#</a> å…¶å®ƒæƒé™æ ¡éªŒæ–¹æ³•</h3>\n<p>æˆ‘ä»¬å‰é¢éƒ½æ˜¯ä½¿ç”¨ @PreAuthorize æ³¨è§£ï¼Œç„¶ååœ¨å…¶ä¸­ä½¿ç”¨çš„æ˜¯ hasAuthority æ–¹æ³•è¿›è¡Œæ ¡éªŒï¼ŒSpringSecurity è¿˜ä¸ºæˆ‘ä»¬æä¾›äº†å…¶å®ƒæ–¹æ³•ä¾‹å¦‚ï¼šhasAnyAuthorityï¼ŒhasRoleï¼ŒHasAnyRole ç­‰ã€‚</p>\n<p>è¿™é‡Œæˆ‘ä»¬å…ˆä¸æ€¥ç€å»ä»‹ç»è¿™äº›æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆå»ç†è§£ hasAuthority çš„åŸç†ï¼Œç„¶åå†å»å­¦ä¹ å…¶ä»–æ–¹æ³•ä½ å°±æ›´å®¹æ˜“ç†è§£ï¼Œè€Œä¸æ˜¯æ­»è®°ç¡¬èƒŒåŒºåˆ«ã€‚å¹¶ä¸”æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©å®šä¹‰æ ¡éªŒæ–¹æ³•ï¼Œå®ç°æˆ‘ä»¬è‡ªå·±çš„æ ¡éªŒé€»è¾‘ã€‚</p>\n<p>â€‹\thasAuthority æ–¹æ³•å®é™…æ˜¯æ‰§è¡Œåˆ°äº† SecurityExpressionRoot çš„ hasAuthorityï¼Œå¤§å®¶åªè¦æ–­ç‚¹è°ƒè¯•æ—¢å¯çŸ¥é“å®ƒå†…éƒ¨çš„æ ¡éªŒåŸç†ã€‚</p>\n<p>â€‹\tå®ƒå†…éƒ¨å…¶å®æ˜¯è°ƒç”¨ authentication çš„ getAuthorities æ–¹æ³•è·å–ç”¨æˆ·çš„æƒé™åˆ—è¡¨ã€‚ç„¶ååˆ¤æ–­æˆ‘ä»¬å­˜å…¥çš„æ–¹æ³•å‚æ•°æ•°æ®åœ¨æƒé™åˆ—è¡¨ä¸­ã€‚</p>\n<p>â€‹\thasAnyAuthority æ–¹æ³•å¯ä»¥ä¼ å…¥å¤šä¸ªæƒé™ï¼Œåªæœ‰ç”¨æˆ·æœ‰å…¶ä¸­ä»»æ„ä¸€ä¸ªæƒé™éƒ½å¯ä»¥è®¿é—®å¯¹åº”èµ„æºã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@PreAuthorize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hasAnyAuthority('admin','test','system:dept:list')\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>hasRole è¦æ±‚æœ‰å¯¹åº”çš„è§’è‰²æ‰å¯ä»¥è®¿é—®ï¼Œä½†æ˜¯å®ƒå†…éƒ¨ä¼šæŠŠæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°æ‹¼æ¥ä¸Š <strong>ROLE_</strong> åå†å»æ¯”è¾ƒã€‚æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹è¦ç”¨ç”¨æˆ·å¯¹åº”çš„æƒé™ä¹Ÿè¦æœ‰ <strong>ROLE_</strong> è¿™ä¸ªå‰ç¼€æ‰å¯ä»¥ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@PreAuthorize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hasRole('system:dept:list')\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>â€‹\thasAnyRole æœ‰ä»»æ„çš„è§’è‰²å°±å¯ä»¥è®¿é—®ã€‚å®ƒå†…éƒ¨ä¹Ÿä¼šæŠŠæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°æ‹¼æ¥ä¸Š <strong>ROLE_</strong> åå†å»æ¯”è¾ƒã€‚æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹è¦ç”¨ç”¨æˆ·å¯¹åº”çš„æƒé™ä¹Ÿè¦æœ‰ <strong>ROLE_</strong> è¿™ä¸ªå‰ç¼€æ‰å¯ä»¥ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@PreAuthorize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hasAnyRole('admin','system:dept:list')\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><hr />\n<h3 id=\"è‡ªå®šä¹‰æƒé™æ ¡éªŒæ–¹æ³•\"><a class=\"anchor\" href=\"#è‡ªå®šä¹‰æƒé™æ ¡éªŒæ–¹æ³•\">#</a> è‡ªå®šä¹‰æƒé™æ ¡éªŒæ–¹æ³•</h3>\n<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„æƒé™æ ¡éªŒæ–¹æ³•ï¼Œåœ¨ @PreAuthorize æ³¨è§£ä¸­ä½¿ç”¨æˆ‘ä»¬çš„æ–¹æ³•ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ex\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SGExpressionRoot</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">hasAuthority</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> authority<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// è·å–å½“å‰ç”¨æˆ·çš„æƒé™</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">Authentication</span> authentication <span class=\"token operator\">=</span> <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">LoginUser</span> loginUser <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">LoginUser</span><span class=\"token punctuation\">)</span> authentication<span class=\"token punctuation\">.</span><span class=\"token function\">getPrincipal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> permissions <span class=\"token operator\">=</span> loginUser<span class=\"token punctuation\">.</span><span class=\"token function\">getPermissions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// åˆ¤æ–­ç”¨æˆ·æƒé™é›†åˆä¸­æ˜¯å¦å­˜åœ¨ authority</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">return</span> permissions<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span>authority<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨ SPEL è¡¨è¾¾å¼ä¸­ä½¿ç”¨ @ex ç›¸å½“äºè·å–å®¹å™¨ä¸­ bean çš„åå­—æœª ex çš„å¯¹è±¡ã€‚ç„¶åå†è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„ hasAuthority æ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/hello\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@PreAuthorize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@ex.hasAuthority('system:dept:list')\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><hr />\n<h3 id=\"åŸºäºé…ç½®çš„æƒé™æ§åˆ¶\"><a class=\"anchor\" href=\"#åŸºäºé…ç½®çš„æƒé™æ§åˆ¶\">#</a> åŸºäºé…ç½®çš„æƒé™æ§åˆ¶</h3>\n<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨é…ç½®ç±»ä¸­ä½¿ç”¨ä½¿ç”¨é…ç½®çš„æ–¹å¼å¯¹èµ„æºè¿›è¡Œæƒé™æ§åˆ¶ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   http</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token comment\">// å…³é—­ csrf</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">csrf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">disable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token comment\">// ä¸é€šè¿‡ Session è·å– SecurityContext</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">sessionManagement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sessionCreationPolicy</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SessionCreationPolicy</span><span class=\"token punctuation\">.</span><span class=\"token constant\">STATELESS</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token comment\">// å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—®</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">anonymous</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/testCors\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasAuthority</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"system:dept:list222\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token comment\">// é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token comment\">// æ·»åŠ è¿‡æ»¤å™¨</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   http<span class=\"token punctuation\">.</span><span class=\"token function\">addFilterBefore</span><span class=\"token punctuation\">(</span>jwtAuthenticationTokenFilter<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UsernamePasswordAuthenticationFilter</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token comment\">// é…ç½®å¼‚å¸¸å¤„ç†å™¨</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   http<span class=\"token punctuation\">.</span><span class=\"token function\">exceptionHandling</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token comment\">// é…ç½®è®¤è¯å¤±è´¥å¤„ç†å™¨</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">authenticationEntryPoint</span><span class=\"token punctuation\">(</span>authenticationEntryPoint<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">accessDeniedHandler</span><span class=\"token punctuation\">(</span>accessDeniedHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   <span class=\"token comment\">// å…è®¸è·¨åŸŸ</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   http<span class=\"token punctuation\">.</span><span class=\"token function\">cors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><hr />\n<h3 id=\"csrf\"><a class=\"anchor\" href=\"#csrf\">#</a> CSRF</h3>\n<p>â€‹\tCSRF æ˜¯æŒ‡è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCross-site request forgeryï¼‰ï¼Œæ˜¯ web å¸¸è§çš„æ”»å‡»ä¹‹ä¸€ã€‚</p>\n<p>â€‹\t<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZyZWVraW5nMTAxL2FydGljbGUvZGV0YWlscy84NjUzNzA4Nw==\">https://blog.csdn.net/freeking101/article/details/86537087</span></p>\n<p>â€‹\tSpringSecurity å»é˜²æ­¢ CSRF æ”»å‡»çš„æ–¹å¼å°±æ˜¯é€šè¿‡ csrf_tokenã€‚åç«¯ä¼šç”Ÿæˆä¸€ä¸ª csrf_tokenï¼Œå‰ç«¯å‘èµ·è¯·æ±‚çš„æ—¶å€™éœ€è¦æºå¸¦è¿™ä¸ª csrf_token, åç«¯ä¼šæœ‰è¿‡æ»¤å™¨è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœæ²¡æœ‰æºå¸¦æˆ–è€…æ˜¯ä¼ªé€ çš„å°±ä¸å…è®¸è®¿é—®ã€‚</p>\n<p>â€‹\tæˆ‘ä»¬å¯ä»¥å‘ç° CSRF æ”»å‡»ä¾é çš„æ˜¯ cookie ä¸­æ‰€æºå¸¦çš„è®¤è¯ä¿¡æ¯ã€‚ä½†æ˜¯åœ¨å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸­æˆ‘ä»¬çš„è®¤è¯ä¿¡æ¯å…¶å®æ˜¯ tokenï¼Œè€Œ token å¹¶ä¸æ˜¯å­˜å‚¨ä¸­ cookie ä¸­ï¼Œå¹¶ä¸”éœ€è¦å‰ç«¯ä»£ç å»æŠŠ token è®¾ç½®åˆ°è¯·æ±‚å¤´ä¸­æ‰å¯ä»¥ï¼Œæ‰€ä»¥ CSRF æ”»å‡»ä¹Ÿå°±ä¸ç”¨æ‹…å¿ƒäº†ã€‚</p>\n<hr />\n<h3 id=\"è®¤è¯æˆåŠŸå¤„ç†å™¨\"><a class=\"anchor\" href=\"#è®¤è¯æˆåŠŸå¤„ç†å™¨\">#</a> è®¤è¯æˆåŠŸå¤„ç†å™¨</h3>\n<p>â€‹\tå®é™…ä¸Šåœ¨ UsernamePasswordAuthenticationFilter è¿›è¡Œç™»å½•è®¤è¯çš„æ—¶å€™ï¼Œå¦‚æœç™»å½•æˆåŠŸäº†æ˜¯ä¼šè°ƒç”¨ AuthenticationSuccessHandler çš„æ–¹æ³•è¿›è¡Œè®¤è¯æˆåŠŸåçš„å¤„ç†çš„ã€‚AuthenticationSuccessHandler å°±æ˜¯ç™»å½•æˆåŠŸå¤„ç†å™¨ã€‚</p>\n<p>â€‹\tæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å»è‡ªå®šä¹‰æˆåŠŸå¤„ç†å™¨è¿›è¡ŒæˆåŠŸåçš„ç›¸åº”å¤„ç†ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SGSuccessHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">AuthenticationSuccessHandler</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onAuthenticationSuccess</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Authentication</span> authentication<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è®¤è¯æˆåŠŸäº†\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SecurityConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AuthenticationSuccessHandler</span> successHandler<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        http<span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">successHandler</span><span class=\"token punctuation\">(</span>successHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        http<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><hr />\n<h3 id=\"è®¤è¯å¤±è´¥å¤„ç†å™¨\"><a class=\"anchor\" href=\"#è®¤è¯å¤±è´¥å¤„ç†å™¨\">#</a> è®¤è¯å¤±è´¥å¤„ç†å™¨</h3>\n<p>â€‹\tå®é™…ä¸Šåœ¨ UsernamePasswordAuthenticationFilter è¿›è¡Œç™»å½•è®¤è¯çš„æ—¶å€™ï¼Œå¦‚æœè®¤è¯å¤±è´¥äº†æ˜¯ä¼šè°ƒç”¨ AuthenticationFailureHandler çš„æ–¹æ³•è¿›è¡Œè®¤è¯å¤±è´¥åçš„å¤„ç†çš„ã€‚AuthenticationFailureHandler å°±æ˜¯ç™»å½•å¤±è´¥å¤„ç†å™¨ã€‚</p>\n<p>â€‹\tæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å»è‡ªå®šä¹‰å¤±è´¥å¤„ç†å™¨è¿›è¡Œå¤±è´¥åçš„ç›¸åº”å¤„ç†ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SGFailureHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">AuthenticationFailureHandler</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onAuthenticationFailure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AuthenticationException</span> exception<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è®¤è¯å¤±è´¥äº†\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SecurityConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AuthenticationSuccessHandler</span> successHandler<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AuthenticationFailureHandler</span> failureHandler<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        http<span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">//                é…ç½®è®¤è¯æˆåŠŸå¤„ç†å™¨</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">successHandler</span><span class=\"token punctuation\">(</span>successHandler<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">//                é…ç½®è®¤è¯å¤±è´¥å¤„ç†å™¨</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">failureHandler</span><span class=\"token punctuation\">(</span>failureHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        http<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><hr />\n<h3 id=\"ç™»å‡ºæˆåŠŸå¤„ç†å™¨\"><a class=\"anchor\" href=\"#ç™»å‡ºæˆåŠŸå¤„ç†å™¨\">#</a> ç™»å‡ºæˆåŠŸå¤„ç†å™¨</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SGLogoutSuccessHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">LogoutSuccessHandler</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onLogoutSuccess</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Authentication</span> authentication<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ³¨é”€æˆåŠŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SecurityConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AuthenticationSuccessHandler</span> successHandler<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AuthenticationFailureHandler</span> failureHandler<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LogoutSuccessHandler</span> logoutSuccessHandler<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        http<span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">//                é…ç½®è®¤è¯æˆåŠŸå¤„ç†å™¨</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">successHandler</span><span class=\"token punctuation\">(</span>successHandler<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">//                é…ç½®è®¤è¯å¤±è´¥å¤„ç†å™¨</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">failureHandler</span><span class=\"token punctuation\">(</span>failureHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        http<span class=\"token punctuation\">.</span><span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token comment\">// é…ç½®æ³¨é”€æˆåŠŸå¤„ç†å™¨</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">logoutSuccessHandler</span><span class=\"token punctuation\">(</span>logoutSuccessHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        http<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springsecurity",
                "è®¡ç®—æœºå­¦ç§‘",
                "springsecurity"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springsecurity/JWT/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springsecurity/JWT/",
            "title": "JWT",
            "date_published": "2024-01-06T03:11:19.157Z",
            "content_html": "<h2 id=\"jwt\"><a class=\"anchor\" href=\"#jwt\">#</a> JWT</h2>\n<h4 id=\"ä»‹ç»\"><a class=\"anchor\" href=\"#ä»‹ç»\">#</a> ä»‹ç»</h4>\n<p>JWT æ˜¯ JSON Web Token çš„ç¼©å†™ï¼Œå³ JSON Web ä»¤ç‰Œï¼Œæ˜¯ä¸€ç§è‡ªåŒ…å«ä»¤ç‰Œ (è‡ªå·±èƒ½åŒ…å«é‡è¦ä¿¡æ¯)ï¼Œæ˜¯ä¸ºäº†åœ¨ç½‘ç»œå¼•ç”¨ç¯å¢ƒé—´ä¼ é€’å£°æ˜è€Œæ‰§è¡Œçš„ä¸€ç§åŸºäº JSON çš„å¼€å‘æ ‡å‡†</p>\n<p>JWT çš„å£°æ˜ä¸€èˆ¬è¢«ç”¨æ¥åœ¨èº«ä»½æä¾›è€…å’ŒæœåŠ¡æä¾›è€…é—´ä¼ é€’è¢«è®¤è¯çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œä»¥ä¾¿äºä»èµ„æºæœåŠ¡å™¨è·å–èµ„æºã€‚æ¯”å¦‚ç”¨åœ¨ç”¨æˆ·ç™»å½•ä¸Šã€‚</p>\n<p>JWT æœ€é‡è¦çš„ä½œç”¨å°±æ˜¯å¯¹ token çš„ä¿¡æ¯çš„é˜²ä¼ªä½œç”¨ã€‚</p>\n<h3 id=\"jwtä»¤ç‰Œçš„ç»„æˆ\"><a class=\"anchor\" href=\"#jwtä»¤ç‰Œçš„ç»„æˆ\">#</a> JWT ä»¤ç‰Œçš„ç»„æˆ</h3>\n<p>ä¸€ä¸ª JWT ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šJWT å¤´ï¼Œæœ‰æ•ˆè½½è·ï¼Œç­¾åå“ˆå¸Œ</p>\n<p>æœ€åç”±è¿™ä¸‰è€…ç»„åˆè¿›è¡Œ base64url ç¼–ç å¾—åˆ° JWT</p>\n<p>å…¸å‹çš„ï¼Œä¸€ä¸ª JWT çœ‹èµ·æ¥å¦‚ä¸‹å›¾ï¼šè¯¥å¯¹è±¡ä¸ºä¸€ä¸ªå¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¹‹é—´é€šè¿‡ â€œ.â€ åˆ†éš”ç¬¦åˆ†ä¸ºä¸‰ä¸ªå­ä¸²ã€‚</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qd3QuaW8v\">https://jwt.io/</span></p>\n<h3 id=\"jwtå¤´\"><a class=\"anchor\" href=\"#jwtå¤´\">#</a> JWT å¤´</h3>\n<p>JWT å¤´éƒ¨åˆ†æ˜¯ä¸€ä¸ªæè¿° JWT å…ƒæ•°æ®çš„ JSON å¯¹è±¡ï¼Œé€šå¸¸å¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token property\">\"alg\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"HS256\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"typ\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"JWT\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œalg å±æ€§è¡¨ç¤ºç­¾åä½¿ç”¨çš„ç®—æ³•ï¼Œé»˜è®¤ä¸º HMAC SHA256 (å†™ä¸º HS256)</p>\n<p>typ å±æ€§è¡¨ç¤ºä»¤ç‰Œçš„ç±»å‹ï¼ŒJWT ä»¤ç‰Œç»Ÿä¸€å†™ä¸º JWTã€‚</p>\n<p>æœ€åï¼Œä½¿ç”¨ Base64URL ç®—æ³•å°†ä¸Šè¿° JSON å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²ä¿å­˜ã€‚</p>\n<h3 id=\"æœ‰æ•ˆè½½è·\"><a class=\"anchor\" href=\"#æœ‰æ•ˆè½½è·\">#</a> æœ‰æ•ˆè½½è·</h3>\n<p>æœ‰æ•ˆè½½è·éƒ¨åˆ†ï¼Œæ˜¯ JWT çš„ä¸»ä½“å†…å®¹éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼ŒåŒ…å«éœ€è¦ä¼ é€’çš„æ•°æ®ï¼ŒJWT æŒ‡å®šä¸ƒä¸ªé»˜è®¤å­—æ®µä¾›é€‰æ‹©ã€‚</p>\n<p>issï¼šjwt ç­¾å‘è€…</p>\n<p>subï¼šä¸»é¢˜</p>\n<p>audï¼šæ¥æ”¶ jwt çš„ä¸€æ–¹</p>\n<p>expï¼šjwt çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªè¿‡æœŸäº‹ä»¶å¿…é¡»è¦å¤§äºç­¾å‘æ—¶é—´</p>\n<p>nbfï¼šå®šä¹‰åœ¨ä»€ä¹ˆæ—¶é—´ä¹‹å‰ï¼Œè¯¥ jwt éƒ½æ˜¯ä¸å¯ç”¨çš„ã€‚</p>\n<p>jatï¼šjwt çš„ç­¾å‘æ—¶é—´</p>\n<p>jtiï¼šjwt çš„å”¯ä¸€èº«ä»½æ ‡è¯†ï¼Œä¸»è¦ç”¨æ¥ä½œä¸ºä¸€æ¬¡æ€§ tokenï¼Œä»è€Œå›é¿é‡æ”¾æ”»å‡»ã€‚</p>\n<p><strong>é™¤ä»¥ä¸Šé»˜è®¤å­—æ®µå¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ç§æœ‰å­—æ®µï¼Œå¦‚ä¸‹ä¾‹</strong>ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Helen\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"role\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"editor\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token property\">\"avatar\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"helen.jpg\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œé»˜è®¤æƒ…å†µä¸‹ JWT æ˜¯æœªåŠ å¯†çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥è§£è¯»å…¶å†…å®¹ï¼Œå› æ­¤ä¸è¦æ„å»ºéšç§ä¿¡æ¯å­—æ®µï¼Œå­˜æ”¾ä¿å¯†ä¿¡æ¯ï¼Œä»¥é˜²æ­¢ä¿¡æ¯æ³„éœ²</p>\n<p>JSON å¯¹è±¡ä¹Ÿæ˜¯ç”¨ Base64URL ç®—æ³•è½¬æ¢ä¸ºå­—ç¬¦ä¸²ä¿å­˜ã€‚</p>\n<h3 id=\"ç­¾åå“ˆå¸Œ\"><a class=\"anchor\" href=\"#ç­¾åå“ˆå¸Œ\">#</a> ç­¾åå“ˆå¸Œ</h3>\n<p>ç­¾åå“ˆå¸Œéƒ¨åˆ†æ˜¯å¯¹ä¸Šé¢ä¸¤éƒ¨åˆ†æ•°æ®ç­¾åï¼Œé€šè¿‡æŒ‡å®šçš„ç®—æ³•ç”Ÿæˆå“ˆå¸Œï¼Œä»¥ç¡®ä¿æ•°æ®ä¸ä¼šè¢«ç¯¡æ”¹ã€‚</p>\n<p>é¦–å…ˆï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªå¯†ç  (secret)ã€‚æ”¹å¯†ç ä»…ä»…ä¸ºä¿å­˜åœ¨æœåŠ¡å™¨ä¸­ï¼Œå¹¶ä¸”ä¸èƒ½å‘ç”¨æˆ·å…¬å¼€ã€‚ç„¶åï¼Œä½¿ç”¨æ ‡å¤´ä¸­æŒ‡å®šçš„ç­¾åç®—æ³• (é»˜è®¤æƒ…å†µä¸‹ä¸º HMAC SHA256) æ ¹æ®ä»¥ä¸‹å…¬å¼ç”Ÿæˆç­¾åã€‚</p>\n<pre><code>HMACSHA256(base64urlEncode(header) + &quot;.&quot; + base64UrlEncode(claims).secret) ==&gt; ç­¾å hash\n</code></pre>\n<p>åœ¨è®¡ç®—å‡ºç­¾åå“ˆå¸Œåï¼ŒJWT å¤´ï¼Œæœ‰æ•ˆè½½è·å’Œç­¾åå“ˆå¸Œçš„ä¸‰ä¸ªéƒ¨åˆ†ç»„åˆæˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªéƒ¨åˆ†ç”¨ â€œ.â€ åˆ†éš”ï¼Œå°±æ„æˆæ•´ä¸ª JWT å¯¹è±¡ã€‚</p>\n<h3 id=\"base64urlç®—æ³•\"><a class=\"anchor\" href=\"#base64urlç®—æ³•\">#</a> Base64URL ç®—æ³•</h3>\n<p>å¦‚å‰æ‰€è¿°ï¼ŒJWT å¤´å’Œæœ‰æ•ˆè½½è·åºåˆ—åŒ–çš„ç®—æ³•éƒ½ç”¨åˆ°äº† Base64URLã€‚è¯¥ç®—æ³•å’Œå¸¸è§ Base64 ç®—æ³•ç±»ä¼¼ï¼Œç¨æœ‰å·®åˆ«ã€‚</p>\n<p>ä½œä¸ºä»¤ç‰Œçš„ JWT å¯ä»¥æ”¾åœ¨ URL ä¸­ (ä¾‹å¦‚ api.example/?token=xxx)ã€‚Base64 ä¸­ç”¨çš„ä¸‰ä¸ªå­—ç¬¦æ˜¯ â€œ+â€ , â€œ/â€ å’Œ â€œ=â€ ï¼Œç”±äºåœ¨ URL ä¸­æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œå› æ­¤ Base64URL ä¸­å¯¹ä»–ä»¬åšäº†æ›¿æ¢ï¼š â€œ=â€ å»æ‰ï¼Œâ€œ+â€ ç”¨ â€œ-â€ æ›¿æ¢ï¼Œâ€œ/â€ ç”¨ â€œ_â€ æ›¿æ¢ï¼Œè¿™å°±æ˜¯ Base64URL ç®—æ³•</p>\n<h3 id=\"jwtå·¥å…·ç±»ä»£ç \"><a class=\"anchor\" href=\"#jwtå·¥å…·ç±»ä»£ç \">#</a> JWT å·¥å…·ç±»ä»£ç </h3>\n<p>å…·ä½“å¯ä»¥æ ¹æ®è‡ªå·±çš„</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">io<span class=\"token punctuation\">.</span>jsonwebtoken<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>crypto<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SecretKey</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>crypto<span class=\"token punctuation\">.</span>spec<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SecretKeySpec</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Base64</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Date</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">UUID</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JWTHelper</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// è®¾ç½®æœ‰æ•ˆæœŸ ä¸€ä¸ªå°æ—¶</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Long</span> <span class=\"token constant\">JWT_TTL</span> <span class=\"token operator\">=</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000L</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// è®¾ç½®å¯†é’¥ è®¾ç½®é•¿åº¦ä¸èƒ½å¤§äº 11</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">JWT_KEY</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"liusangbaoyo\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token constant\">UUID</span><span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replaceAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>     * ç”Ÿæˆ JWT</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>     * @param subject token ä¸­è¦å­˜æ”¾çš„æ•°æ® (JSON æ ¼å¼)</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">createJwt</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> subject<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">getJwtBuilder</span><span class=\"token punctuation\">(</span>subject<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token function\">getUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">compact</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">createJwt</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">getJwtBuilder</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token function\">getUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">compact</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">createJwt</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> subject<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> ttlMillis<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token comment\">// è®¾ç½®è¿‡æœŸæ—¶é—´</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">getJwtBuilder</span><span class=\"token punctuation\">(</span>subject<span class=\"token punctuation\">,</span> ttlMillis<span class=\"token punctuation\">,</span> <span class=\"token function\">getUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">compact</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">JwtBuilder</span> <span class=\"token function\">getJwtBuilder</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> subject<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> ttlMillis<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> uuid<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token class-name\">SignatureAlgorithm</span> signatureAlgorithm <span class=\"token operator\">=</span> <span class=\"token class-name\">SignatureAlgorithm</span><span class=\"token punctuation\">.</span><span class=\"token constant\">HS256</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token class-name\">SecretKey</span> secretKey <span class=\"token operator\">=</span> <span class=\"token function\">generalKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token keyword\">long</span> nowMillis <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token class-name\">Date</span> now <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>nowMillis<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ttlMillis <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            ttlMillis <span class=\"token operator\">=</span> <span class=\"token class-name\">JWTHelper</span><span class=\"token punctuation\">.</span><span class=\"token constant\">JWT_TTL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token keyword\">long</span> expMills <span class=\"token operator\">=</span> nowMillis <span class=\"token operator\">+</span> ttlMillis<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token class-name\">Date</span> expDate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>expMills<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Jwts</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">setId</span><span class=\"token punctuation\">(</span>uuid<span class=\"token punctuation\">)</span> <span class=\"token comment\">// å”¯ä¸€çš„ ID</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">setSubject</span><span class=\"token punctuation\">(</span>subject<span class=\"token punctuation\">)</span> <span class=\"token comment\">// ä¸»é¢˜ï¼Œå¯ä»¥æ˜¯ JSON æ•°æ®</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">claim</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"userId\"</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">claim</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"username\"</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">setIssuer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// ç­¾å‘è€…</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">setIssuedAt</span><span class=\"token punctuation\">(</span>now<span class=\"token punctuation\">)</span> <span class=\"token comment\">// ç­¾å‘æ—¶é—´</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">signWith</span><span class=\"token punctuation\">(</span>signatureAlgorithm<span class=\"token punctuation\">,</span> secretKey<span class=\"token punctuation\">)</span> <span class=\"token comment\">// ä½¿ç”¨ HS256 å¯¹ç§°åŠ å¯†ç®—æ³•ç­¾åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå¯†é’¥</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">setExpiration</span><span class=\"token punctuation\">(</span>expDate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">createJwt</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> subject<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> ttlMillis<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">getJwtBuilder</span><span class=\"token punctuation\">(</span>subject<span class=\"token punctuation\">,</span> ttlMillis<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">compact</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">SecretKey</span> <span class=\"token function\">generalKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> encodedKey <span class=\"token operator\">=</span> <span class=\"token class-name\">Base64</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDecoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JWTHelper</span><span class=\"token punctuation\">.</span><span class=\"token constant\">JWT_KEY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SecretKeySpec</span><span class=\"token punctuation\">(</span>encodedKey<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> encodedKey<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span> <span class=\"token string\">\"AES\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Claims</span> <span class=\"token function\">parseJwt</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> jwt<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token class-name\">Claims</span> claims<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        <span class=\"token class-name\">SecretKey</span> secretKey <span class=\"token operator\">=</span> <span class=\"token function\">generalKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token class-name\">Jwts</span><span class=\"token punctuation\">.</span><span class=\"token function\">parser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                    <span class=\"token punctuation\">.</span><span class=\"token function\">setSigningKey</span><span class=\"token punctuation\">(</span>secretKey<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                    <span class=\"token punctuation\">.</span><span class=\"token function\">parseClaimsJws</span><span class=\"token punctuation\">(</span>jwt<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                    <span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ExpiredJwtException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>            claims <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getClaims</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>        <span class=\"token keyword\">return</span> claims<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"jwtä¸­çš„claims\"><a class=\"anchor\" href=\"#jwtä¸­çš„claims\">#</a> JWT ä¸­çš„ Claims</h3>\n<p>Claims æœ‰ç´¢èµ”ï¼Œå£°ç§°ï¼Œè¦æ±‚æˆ–è€…æƒåˆ©è¦æ±‚çš„å«ä¹‰ï¼Œä½†æ˜¯ç¬”è€…è§‰å¾—ä»»ä¸€ä¸ªç¿»è¯‘éƒ½ä¸æ€ä¹ˆåˆä¹è¯­ä¹‰ï¼Œè¿™é‡Œä¿ç•™ Claims å…³é”®å­—ç›´æ¥ä½œä¸ºå‘½åã€‚JWT çš„æ ¸å¿ƒä½œç”¨å°±æ˜¯ä¿æŠ¤ Claims çš„å®Œæ•´æ€§ (æˆ–è€…æ•°æ®åŠ å¯†) ï¼Œä¿è¯ JWT ä¼ è¾“çš„è¿‡ç¨‹ä¸­ Claims ä¸è¢«ç¯¡æ”¹ (æˆ–è€…ä¸è¢«ç ´è§£)ã€‚Claims åœ¨ JWT åŸå§‹å†…å®¹ä¸­æ˜¯ä¸€ä¸ª JSON æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œå…¶ä¸­å•ä¸ª Claims æ˜¯ k-v ç»“æ„ï¼Œä½œä¸º JsonNode ä¸­çš„ä¸€ä¸ª find-valueï¼Œè¿™é‡Œåˆ—å‡ºäº†å¸¸ç”¨çš„è§„èŒƒä¸­é¢„å®šä¹‰å¥½çš„ Claimï¼›</p>\n<table>\n<thead>\n<tr>\n<th>ç®€ç§°</th>\n<th>å…¨ç§°</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>iss</td>\n<td>Issuer</td>\n<td>å‘è¡Œæ–¹</td>\n</tr>\n<tr>\n<td>sub</td>\n<td>Subject</td>\n<td>ä¸»ä½“</td>\n</tr>\n<tr>\n<td>aud</td>\n<td>Audience</td>\n<td>(æ¥æ”¶) ç›®æ ‡æ–¹</td>\n</tr>\n<tr>\n<td>exp</td>\n<td>Expiration Time</td>\n<td>è¿‡æœŸæ—¶é—´</td>\n</tr>\n<tr>\n<td>nbf</td>\n<td>Not Before</td>\n<td>æ—©äºè¯¥å®šä¹‰çš„æ—¶é—´çš„ JWT ä¸èƒ½è¢«æ¥å—å¤„ç†</td>\n</tr>\n<tr>\n<td>iat</td>\n<td>Issued At</td>\n<td>JWT å‘è¡Œæ—¶çš„æ—¶é—´æˆ³</td>\n</tr>\n<tr>\n<td>jti</td>\n<td>JWT ID</td>\n<td>JWT çš„å”¯ä¸€æ ‡è¯†</td>\n</tr>\n</tbody>\n</table>\n<p>è¿™äº›é¢„å®šä¹‰çš„ Claim å¹¶ä¸è¦æ±‚å¼ºåˆ¶ä½¿ç”¨ï¼Œä½•æ—¶é€‰ç”¨ä½•ç§ Claim å®Œå…¨ç”±ä½¿ç”¨è€…å†³å®šï¼Œè€Œä¸ºäº†ä½¿ JWT æ›´åŠ ç´§å‡‘ï¼Œè¿™äº› Claim éƒ½æ˜¯ç”¨äº†ç®€çŸ­çš„å‘½åæ–¹å¼å»å®šä¹‰ã€‚åœ¨ä¸å’Œå†…å»ºçš„ Claim å†²çªçš„å‰æä¸‹ï¼Œä½¿ç”¨è€…å¯ä»¥è‡ªå®šä¹‰æ–°çš„å…¬å…± Claimï¼Œå¦‚ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>ç®€ç§°</th>\n<th>å…¨ç§°</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>cid</td>\n<td>Customer ID</td>\n<td>å®¢æˆ· ID</td>\n</tr>\n<tr>\n<td>rid</td>\n<td>Role ID</td>\n<td>è§’è‰² ID</td>\n</tr>\n</tbody>\n</table>\n<p>ä¸€å®šè¦æ³¨æ„ï¼Œåœ¨ JWT å®ç°ä¸­ï¼ŒClaims ä¼šä½œä¸º payload éƒ¨åˆ†è¿›è¡Œ Base64 ç¼–ç ï¼Œæ˜æ–‡ä¼šç›´æ¥æš´æ¼ï¼Œæ•æ„Ÿä¿¡æ¯ä¸€èˆ¬ä¸åº”è¯¥è®¾è®¡ä¸ºä¸€ä¸ªè‡ªå®šä¹‰ Claimã€‚</p>\n<p>&lt;span alt='solid'&gt; å–å‡ºä¸Šè¿° JWT å·¥å…·ç±»ä¸­è®¾ç½®çš„ userId ä¸ username çš„å€¼ &lt;/span&gt;.</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">String</span> jwt <span class=\"token operator\">=</span> <span class=\"token class-name\">JWTHelper</span><span class=\"token punctuation\">.</span><span class=\"token function\">createJwt</span><span class=\"token punctuation\">(</span><span class=\"token number\">1233L</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"jiashujv\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>jwt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">Claims</span> claims <span class=\"token operator\">=</span> <span class=\"token class-name\">JWTHelper</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseJwt</span><span class=\"token punctuation\">(</span>jwt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token class-name\">Integer</span> id <span class=\"token operator\">=</span> claims<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"userId\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token class-name\">String</span> username <span class=\"token operator\">=</span> claims<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"username\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id: \"</span><span class=\"token operator\">+</span>id<span class=\"token operator\">+</span><span class=\"token string\">\", name: \"</span><span class=\"token operator\">+</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springsecurity",
                "è®¡ç®—æœºå­¦ç§‘",
                "springsecurity",
                "JWT"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springsecurity/thymeleaf+SpringSecurity/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springsecurity/thymeleaf+SpringSecurity/",
            "title": "Thymeleafä¸­SpringSecurityçš„ä½¿ç”¨",
            "date_published": "2024-01-06T03:11:19.157Z",
            "content_html": "<h1 id=\"thymeleafä¸­springsecurityçš„ä½¿ç”¨ï¸\"><a class=\"anchor\" href=\"#thymeleafä¸­springsecurityçš„ä½¿ç”¨ï¸\">#</a> Thymeleaf ä¸­ SpringSecurity çš„ä½¿ç”¨â­ï¸</h1>\n<blockquote>\n<p>SpringSecurity å¯ä»¥åœ¨ä¸€äº›è§†å›¾æŠ€æœ¯ä¸­è¿›è¡Œæ§åˆ¶æ˜¾ç¤ºæ•ˆæœï¼Œä¾‹å¦‚ï¼šJSP æˆ– Thymeleafã€‚åœ¨éå‰åç«¯åˆ†ç¦»ä¸”ä½¿ç”¨ SpringBoot çš„é¡¹ç›®ä¸­å¤šä½¿ç”¨ Thymeleaf ä½œä¸ºè§†å›¾å±•ç¤ºæŠ€æœ¯ã€‚</p>\n</blockquote>\n<blockquote>\n<p>Thymeleaf å¯¹ SpringSecurity çš„æ”¯æŒéƒ½æ”¾åœ¨ Thymeleaf-extras-springsecurityX<sup>X ä»£è¡¨æŸä¸€ä¸ªç‰ˆæœ¬</sup>ä¸­ï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬ä¸º 5ã€‚æ‰€ä»¥éœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ æ­¤ jar åŒ…çš„ä¾èµ–å’Œ thymeleaf çš„ä¾èµ–ã€‚</p>\n</blockquote>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.thymeleaf.extras<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>thymeleaf-extras-springsecurity5<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>3.0.4.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">&lt;!--thymeleaf ä¾èµ– --></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-thymeleaf<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>åœ¨ html é¡µé¢ä¸­å¼•å…¥ thymeleaf å‘½åç©ºé—´å’Œ security å‘½åç©ºé—´ã€‚</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/1999/xhtml<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>      <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>th</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.thymeleaf.org<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>      <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>sec</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.thymeleaf.org/thymeleaf-extras-springsecurity5<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>è‡ªå®šä¹‰ç™»å½•é¡µé¢</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   http</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token comment\">// å…³é—­ csrf é˜²æŠ¤ï¼Œç±»ä¼¼äºå…³é—­é˜²ç«å¢™</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">csrf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">disable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">sessionManagement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sessionCreationPolicy</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SessionCreationPolicy</span><span class=\"token punctuation\">.</span><span class=\"token constant\">STATELESS</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token comment\">// è¡¨å•æäº¤</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token comment\">// è‡ªå®šä¹‰ç™»å½•ç•Œé¢ï¼Œthymeleaf é€šè¿‡æ¥å£è·³è½¬åˆ°å¯¹åº”çš„é¡µé¢ä¸­ç›´æ¥æ‰¾ä¼šæŠ¥ 404</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">loginPage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token comment\">// ç™»å½•æˆåŠŸåè·³è½¬åˆ°çš„é¡µé¢æ¥å£</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">successForwardUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/index\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token comment\">// æˆæƒ</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   http<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token comment\">// æ”¾è¡Œï¼Œé™æ€èµ„æº</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/css/**\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"/js/**\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"/fonts/**\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"/img/**\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"/login.html\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   http<span class=\"token punctuation\">.</span><span class=\"token function\">addFilterBefore</span><span class=\"token punctuation\">(</span>jwtAuthenticationTokenFilter<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                        <span class=\"token class-name\">UsernamePasswordAuthenticationFilter</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token comment\">// æŠŠ token æ ¡éªŒè¿‡æ»¤å™¨æ·»åŠ åˆ°è¿‡æ»¤å™¨é“¾ä¸­</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   http<span class=\"token punctuation\">.</span><span class=\"token function\">addFilterBefore</span><span class=\"token punctuation\">(</span>jwtAuthenticationTokenFilter<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                        <span class=\"token comment\">// æ·»åŠ è¿‡æ»¤å™¨</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                        <span class=\"token class-name\">UsernamePasswordAuthenticationFilter</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   http<span class=\"token punctuation\">.</span><span class=\"token function\">exceptionHandling</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">authenticationEntryPoint</span><span class=\"token punctuation\">(</span>authenticationEntryPoint<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">accessDeniedHandler</span><span class=\"token punctuation\">(</span>accessDeniedHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"1-è·å–å±æ€§\"><a class=\"anchor\" href=\"#1-è·å–å±æ€§\">#</a> 1 è·å–å±æ€§</h2>\n<blockquote>\n<p>å¯ä»¥åœ¨ html é¡µé¢ä¸­é€šè¿‡ sec:authentication=&quot;&quot; è·å– UsernamePasswordAuthenticationToken ä¸­æ‰€æœ‰ getXXX çš„å†…å®¹ï¼ŒåŒ…å«çˆ¶ç±»ä¸­çš„ getXXX çš„å†…å®¹ã€‚</p>\n</blockquote>\n<p><strong>æ ¹æ®æºç å¾—å‡ºä¸‹é¢å±æ€§</strong>ï¼š</p>\n<ul>\n<li>nameï¼šç™»å½•è´¦å·åç§°</li>\n<li>principalï¼šç™»å½•ä¸»ä½“ï¼Œåœ¨è‡ªå®šä¹‰ç™»å½•é€»è¾‘ä¸­æ˜¯ UserDetails</li>\n<li>credentialsï¼šå‡­è¯<sup>å¯†ç  / è¯æ®</sup></li>\n<li>authoritiesï¼šæƒé™å’Œè§’è‰²</li>\n<li>detailsï¼šå®é™…ä¸Šæ˜¯ WebAuthenticationDetails çš„å®ä¾‹ã€‚å¯ä»¥è·å– remoteAddress (å®¢æˆ·ç«¯ ip) å’Œ sessionId (å½“å‰ sessionId)</li>\n</ul>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>è´¦å·: <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\"><span class=\"token namespace\">sec:</span>authentication</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ç™»å½•è´¦å·: <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\"><span class=\"token namespace\">sec:</span>authentication</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>principal.username<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">&lt;!-- å¤„äºå®‰å…¨åŸå› å‡­è¯æ˜¾ç¤ºä¸å‡ºæ¥ --></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>å‡­è¯: <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\"><span class=\"token namespace\">sec:</span>authentication</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>credentials<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>æƒé™å’Œè§’è‰²: <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\"><span class=\"token namespace\">sec:</span>authentication</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>authorities<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>å®¢æˆ·ç«¯åœ°å€: <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\"><span class=\"token namespace\">sec:</span>authentication</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>details.remoteAddress<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">&lt;!--SessionId ä¹Ÿä¸æ˜¾ç¤º --></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>sessionId: <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\"><span class=\"token namespace\">sec:</span>authentication</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>details.sessionId<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>æ•ˆæœ</strong>ï¼š</p>\n<p><img data-src=\"./images/image-20230523095318581.png\" alt=\"image-20230523095318581\" /></p>\n<p><mark>æƒé™</mark>å°±æ˜¯åœ¨ UserDetails å®ç°ç±»ä¸­æŸ¥è¯¢æ•°æ®åº“æ‰€æ·»åŠ åˆ° Authentication ä¸­çš„ã€‚å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserDetailsServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserDetailsService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserMapper</span> mapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RoleMapper</span> roleMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserDetails</span> <span class=\"token function\">loadUserByUsername</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> s<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">UsernameNotFoundException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">LambdaQueryWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">UserTable</span><span class=\"token punctuation\">></span></span> wrapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LambdaQueryWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">eq</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserTable</span><span class=\"token operator\">::</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">,</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">UserTable</span> user <span class=\"token operator\">=</span> mapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectOne</span><span class=\"token punctuation\">(</span>wrapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Objects</span><span class=\"token punctuation\">.</span><span class=\"token function\">isNull</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">//        é€šè¿‡ username æŸ¥è¯¢ç”¨æˆ·æƒé™</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> roleMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectByRole</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LoginUser</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>SQL</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token keyword\">select</span> id<span class=\"token operator\">=</span><span class=\"token string\">\"selectByRole\"</span> resultType<span class=\"token operator\">=</span><span class=\"token string\">\"String\"</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">SELECT</span> <span class=\"token keyword\">DISTINCT</span> <span class=\"token keyword\">DISTINCT</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        mt<span class=\"token punctuation\">.</span>roting</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">FROM</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        user_table <span class=\"token keyword\">AS</span> u</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> user_role <span class=\"token keyword\">AS</span> ur <span class=\"token keyword\">ON</span> u<span class=\"token punctuation\">.</span>role <span class=\"token operator\">=</span> ur<span class=\"token punctuation\">.</span>user_id</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> role_menu <span class=\"token keyword\">AS</span> rm <span class=\"token keyword\">ON</span> ur<span class=\"token punctuation\">.</span>role_id <span class=\"token operator\">=</span> rm<span class=\"token punctuation\">.</span>role_id</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> menu_table <span class=\"token keyword\">AS</span> mt <span class=\"token keyword\">ON</span> mt<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> rm<span class=\"token punctuation\">.</span>menu_id</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">WHERE</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        u<span class=\"token punctuation\">.</span><span class=\"token keyword\">STATUS</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token operator\">AND</span> u<span class=\"token punctuation\">.</span>username <span class=\"token operator\">=</span> <span class=\"token comment\">#&#123;username&#125;;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span><span class=\"token keyword\">select</span><span class=\"token operator\">></span></pre></td></tr></table></figure><h2 id=\"12-æƒé™åˆ¤æ–­\"><a class=\"anchor\" href=\"#12-æƒé™åˆ¤æ–­\">#</a> 1.2 æƒé™åˆ¤æ–­ğŸ¨</h2>\n<h3 id=\"121-è®¾ç½®ç”¨æˆ·è§’è‰²å’Œæƒé™\"><a class=\"anchor\" href=\"#121-è®¾ç½®ç”¨æˆ·è§’è‰²å’Œæƒé™\">#</a> 1.2.1 è®¾ç½®ç”¨æˆ·è§’è‰²å’Œæƒé™</h3>\n<p>è®¾å®šç”¨æˆ·å…·æœ‰ adminï¼Œ/insertï¼Œ/delete æƒé™ ROLE_abc è§’è‰²ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span>password<span class=\"token punctuation\">,</span><span class=\"token class-name\">AuthorityUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">commaSeparatedSpringToAuthorityList</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin,ROLE_abc,/insert,/delete\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"122-æ§åˆ¶é¡µé¢æ˜¾ç¤ºæ•ˆæœ\"><a class=\"anchor\" href=\"#122-æ§åˆ¶é¡µé¢æ˜¾ç¤ºæ•ˆæœ\">#</a> 1.2.2 æ§åˆ¶é¡µé¢æ˜¾ç¤ºæ•ˆæœ</h3>\n<p>åœ¨é¡µé¢ä¸­æ ¹æ®ç”¨æˆ·æƒé™å’Œè§’è‰²åˆ¤æ–­é¡µé¢ä¸­æ˜¾ç¤ºçš„å†…å®¹</p>\n<p><strong>é€šè¿‡æƒé™åˆ¤æ–­</strong>ï¼š</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\"><span class=\"token namespace\">sec:</span>authorize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hasAuthority('/insert')<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>æ–°å¢<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\"><span class=\"token namespace\">sec:</span>authorize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hasAuthority('/delete')<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>åˆ é™¤<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\"><span class=\"token namespace\">sec:</span>authorize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hasAuthority('/update')<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>ä¿®æ”¹<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\"><span class=\"token namespace\">sec:</span>authorize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hasAuthority('/select')<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>æŸ¥çœ‹<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>é€šè¿‡è§’è‰²åˆ¤æ–­</strong>ï¼š</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\"><span class=\"token namespace\">sec:</span>authorize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hasRole('abc')<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>æ–°å¢<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\"><span class=\"token namespace\">sec:</span>authorize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hasRole('abc')<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>åˆ é™¤<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\"><span class=\"token namespace\">sec:</span>authorize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hasRole('abc')<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>ä¿®æ”¹<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\"><span class=\"token namespace\">sec:</span>authorize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hasRole('abc')<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>æŸ¥çœ‹<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h2 id=\"2-é€€å‡ºç™»å½•\"><a class=\"anchor\" href=\"#2-é€€å‡ºç™»å½•\">#</a> 2 é€€å‡ºç™»å½•ğŸŒ®</h2>\n<p>ç”¨æˆ·åªéœ€è¦å‘ Spring Security é¡¹ç›®ä¸­å‘é€ <mark>/logout</mark> é€€å‡ºè¯·æ±‚å³å¯ã€‚</p>\n<h3 id=\"21-é€€å‡ºç™»å½•\"><a class=\"anchor\" href=\"#21-é€€å‡ºç™»å½•\">#</a> 2.1 é€€å‡ºç™»å½•ğŸ‰</h3>\n<p>å®ç°é€€å‡ºéå¸¸ç®€å•ï¼Œåªè¦åœ¨é¡µé¢ä¸­æ·»åŠ  <mark>/logout</mark> çš„è¶…é“¾æ¥å³å¯ã€‚</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/logout<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>æ³¨é”€<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure>",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springsecurity",
                "è®¡ç®—æœºå­¦ç§‘",
                "springsecurity",
                "thymeleaf"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springmvc/REST%E9%A3%8E%E6%A0%BC/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springmvc/REST%E9%A3%8E%E6%A0%BC/",
            "title": "RESTé£æ ¼",
            "date_published": "2024-01-06T03:03:32.454Z",
            "content_html": "<h1 id=\"rest\"><a class=\"anchor\" href=\"#rest\">#</a> REST</h1>\n<h3 id=\"æ¦‚è¿°\"><a class=\"anchor\" href=\"#æ¦‚è¿°\">#</a> æ¦‚è¿°</h3>\n<ul>\n<li>\n<p>REST ç®€ä»‹ (Repersentational State Transfer), è¡¨ç°å½¢å¼çŠ¶æ€è½¬æ¢</p>\n<ul>\n<li>ä¼ ç»Ÿé£æ ¼èµ„æºæè¿°å½¢å¼</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2xvY2xhaG9zdC91c2VyL2dldEJ5SWQ/aWQ9MQ==\">http://loclahost/user/getById?id=1</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC91c2VyL3NhdmVVc2Vy\">http://localhost/user/saveUser</span></li>\n</ul>\n</li>\n<li>\n<p>REST é£æ ¼æè¿°å½¢å¼</p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC91c2VyLzE=\">http://localhost/user/1</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC91c2Vy\">http://localhost/user</span></li>\n</ul>\n</li>\n<li>\n<p>ä¼˜ç‚¹:</p>\n<ul>\n<li>éšè—èµ„æºçš„è®¿é—®è¡Œä¸ºï¼Œæ— æ³•é€šè¿‡åœ°å€å¾—çŸ¥å¯¹èµ„æºæ˜¯ä½•ç§æ“ä½œ</li>\n<li>ä¹¦å†™ç®€åŒ–</li>\n</ul>\n</li>\n<li>\n<p>æŒ‰ç…§ REST é£æ ¼è®¿é—®èµ„æºæ—¶ä½¿ç”¨ &lt;font style=&quot;color:red&quot;&gt;<strong> è¡Œä¸ºåŠ¨ä½œ</strong> &lt;/font&gt; åŒºåˆ†å¯¹èµ„æºè¿›è¡Œäº†ä½•ç§æ“ä½œ</p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC91c2Vycw==\">http://localhost/users</span>         æŸ¥è¯¢å…¨éƒ¨ç”¨æˆ·ä¿¡æ¯    GET (æŸ¥è¯¢)</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC91c2Vycy8x\">http://localhost/users/1</span>      æŸ¥è¯¢æŒ‡å®šç”¨æˆ·ä¿¡æ¯    GET (æŸ¥è¯¢)</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC91c2Vycw==\">http://localhost/users</span>         æ·»åŠ ç”¨æˆ·ä¿¡æ¯           POST (æ–°å¢ / ä¿å­˜)</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC91c2Vycw==\">http://localhost/users</span>         ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯           PUT (ä¿®æ”¹ / æ›´æ–°)</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC91c2Vycy8x\">http://localhost/users/1</span>      åˆ é™¤ç”¨æˆ·ä¿¡æ¯           DELETE (åˆ é™¤)</li>\n</ul>\n</li>\n</ul>\n<p><img data-src=\"REST%E9%A3%8E%E6%A0%BC_md_files/image_2023-03-03-11-03-53_20230307150309.png?v=1&amp;type=image&amp;token=V1:zQ12RX8ah08KPGpWyX_M1Djk4mXiqtwHcxoY3zJstAo\" alt=\"image_2023-03-03-11-03-53\" /></p>\n<p>&lt;font style=&quot;color:red&quot;&gt;<strong> æ³¨æ„äº‹é¡¹:</strong>&lt;/font&gt;</p>\n<p>ä¸Šè¿°è¡Œä¸ºæ˜¯çº¦å®šæ–¹å¼ï¼Œçº¦å®šä¸æ˜¯è§„èŒƒï¼Œå¯ä»¥æ‰“ç ´ï¼Œæ‰€ä»¥ç§° REST é£æ ¼ï¼Œè€Œä¸æ˜¯ REST è§„èŒƒ</p>\n<p>æè¿°æ¨¡å—çš„åç§°é€šå¸¸ä½¿ç”¨å¤æ•°ï¼Œä¹Ÿå°±æ˜¯åŠ  s çš„æ ¼å¼æè¿°ï¼Œè¡¨ç¤ºæ­¤ç±»èµ„æºï¼Œè€Œéå•ä¸ªèµ„æºï¼Œä¾‹å¦‚:users,books,accounts...</p>\n<ul>\n<li>æ ¹æ® REST é£æ ¼å¯¹èµ„æºè¿›è¡Œè®¿é—®ç§°ä¸º &lt;font style=&quot;color:red&quot;&gt;<strong>RESTful</strong>&lt;/font&gt;</li>\n</ul>\n<h3 id=\"æ“ä½œæ­¥éª¤\"><a class=\"anchor\" href=\"#æ“ä½œæ­¥éª¤\">#</a> æ“ä½œæ­¥éª¤:</h3>\n<p>1. è®¾å®š http è¯·æ±‚åŠ¨ä½œ</p>\n<p>method = <span class=\"exturl\" data-url=\"aHR0cDovL1JlcXVlc3RNZXRob2QuWFhY\">RequestMethod.XXX</span></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//    ä½¿ç”¨ REST é£æ ¼è®¾ç½® save æ–¹æ³•ä¸º POST è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"/users\"</span><span class=\"token punctuation\">,</span>method <span class=\"token operator\">=</span> <span class=\"token class-name\">RequestMethod</span><span class=\"token punctuation\">.</span><span class=\"token constant\">POST</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"springmvc user save running...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"save\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"/users/&#123;id&#125;\"</span><span class=\"token punctuation\">,</span>method <span class=\"token operator\">=</span> <span class=\"token class-name\">RequestMethod</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DELETE</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">//    @PathVariable: è¿™ä¸ªå˜é‡çš„å€¼æ¥è‡ªäºè·¯å¾„ï¼Œä½†æ˜¯ä¸æ¸…æ¥šæ¥è‡ªäºè·¯å¾„çš„å“ªé‡Œ</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"springmvc user delete running...\"</span><span class=\"token operator\">+</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"delete\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>2. è®¾å®šè¯·æ±‚å‚æ•° (è·¯å¾„å˜é‡)</p>\n<p>@RequestMapping(value = &quot;/users/&lt;font style=&quot;color:red&quot;&gt;{id}&lt;/font&gt;&quot;,method = RequestMethod.XXXX)</p>\n<p>&lt;font style=&quot;color:red&quot;&gt;@PathVariabl&lt;/font&gt;</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span> value <span class=\"token operator\">=</span> <span class=\"token string\">\"/users/&#123;id&#125;\"</span><span class=\"token punctuation\">,</span>method <span class=\"token operator\">=</span> <span class=\"token class-name\">RequestMethod</span><span class=\"token punctuation\">.</span><span class=\"token constant\">GET</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token class-name\">UserById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"springmvc user UserById running...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"userbyid\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"requestmapping\"><a class=\"anchor\" href=\"#requestmapping\">#</a> @RequestMapping</h3>\n<ul>\n<li>\n<p>ç±»å‹ï¼šæ–¹æ³•æ³¨è§£</p>\n</li>\n<li>\n<p>ä½ç½®ï¼šSpringMvc æ§åˆ¶å™¨æ–¹æ³•å®šä¹‰ä¸Šæ–¹</p>\n</li>\n<li>\n<p>ä½œç”¨ï¼šè®¾ç½®å½“å‰æ§åˆ¶å™¨æ–¹æ³•è¯·æ±‚è®¿é—®è·¯å¾„</p>\n</li>\n<li>\n<p>å±æ€§:</p>\n<ul>\n<li>value (é»˜è®¤): è¯·æ±‚è®¿é—®è·¯å¾„</li>\n<li>method:http è¯·æ±‚åŠ¨ä½œï¼Œæ ‡å‡†åŠ¨ä½œ (GET/POST/PUT/DELETE)</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"pathvariable\"><a class=\"anchor\" href=\"#pathvariable\">#</a> @PathVariable</h3>\n<ul>\n<li>\n<p>ç±»å‹ï¼šå½¢å‚æ³¨è§£</p>\n</li>\n<li>\n<p>ä½ç½®ï¼šSpringMvc æ§åˆ¶å™¨æ–¹æ³•å½¢å‚å®šä¹‰å‰é¢</p>\n</li>\n<li>\n<p>ä½œç”¨ï¼šç»‘å®šè·¯å¾„å‚æ•°ä¸å¤„ç†å™¨æ–¹æ³•å½¢å‚é—´çš„å…³ç³»ï¼Œè¦æ±‚è·¯å¾„å‚æ•°åä¸å½¢å‚åä¸€ä¸€å¯¹åº”</p>\n</li>\n</ul>\n<p><strong>@RequestBody @RequestParam @PathVariable</strong></p>\n<ul>\n<li>\n<p>åŒºåˆ«</p>\n<ul>\n<li>@RequestParam ç”¨äºæ¥æ”¶ url åœ°å€ä¼ å‚æˆ–è¡¨å•ä¼ å‚</li>\n<li>@RequestBody ç”¨äºæ¥æ”¶ json æ•°æ®</li>\n<li>@PathVariable ç”¨äºæ¥æ”¶è·¯å¾„å‚æ•°ï¼Œä½¿ç”¨ {å‚æ•°åç§°} æè¿°è·¯å¾„å‚æ•°</li>\n</ul>\n</li>\n<li>\n<p>&lt;font style=&quot;color:red&quot;&gt; åº”ç”¨ &lt;/font&gt;</p>\n<ul>\n<li>åæœŸå¼€å‘ä¸­ï¼Œå‘é€è¯·æ±‚å‚æ•°è¶…è¿‡ 1 ä¸ªæ—¶ï¼Œä»¥ json æ ¼å¼ä¸ºä¸»ï¼Œ@RequestBody å¼•ç”¨è¾ƒå¹¿</li>\n<li>å¦‚æœå‘é€é json æ ¼å¼æ•°æ®ï¼Œé€‰ç”¨ @RequestParam æ¥æ”¶è¯·æ±‚å‚æ•°</li>\n<li>é‡‡ç”¨ RESTful è¿›è¡Œå¼€å‘ï¼Œå½“å‚æ•°æ•°é‡è¾ƒå°‘æ—¶ï¼Œä¾‹å¦‚ 1 ä¸ªï¼Œå¯ä»¥é‡‡ç”¨ @PathVariable æ¥æ”¶è¯·æ±‚è·¯å¾„å˜é‡ï¼Œé€šå¸¸ç”¨äºä¼ é€’ id å€¼</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"restfulå¿«é€Ÿå¼€å‘\"><a class=\"anchor\" href=\"#restfulå¿«é€Ÿå¼€å‘\">#</a> RESTful å¿«é€Ÿå¼€å‘</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"/users/&#123;id&#125;\"</span><span class=\"token punctuation\">,</span>method <span class=\"token operator\">=</span> <span class=\"token class-name\">RequestMethod</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DELETE</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//    @PathVariable: è¿™ä¸ªå˜é‡çš„å€¼æ¥è‡ªäºè·¯å¾„ï¼Œä½†æ˜¯ä¸æ¸…æ¥šæ¥è‡ªäºè·¯å¾„çš„å“ªé‡Œ</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"springmvc user delete running...\"</span><span class=\"token operator\">+</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"delete\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"/users/&#123;u&#125;\"</span><span class=\"token punctuation\">,</span>method <span class=\"token operator\">=</span> <span class=\"token class-name\">RequestMethod</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PUT</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">User</span> u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"springmvc user update running...\"</span><span class=\"token operator\">+</span>u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"update\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç®€åŒ–é‡å¤åœ¨æ–¹æ³•ä¸Šå†™ @Response å’Œ /users è·¯å¾„å</p>\n<p><img data-src=\"REST%E9%A3%8E%E6%A0%BC_md_files/image_2023-03-03-18-36-15_20230307150329.png?v=1&amp;type=image&amp;token=V1:oejCepTy_6hcgPfchIWBnq7Ta1iUEofW-gRbLdJWc-c\" alt=\"image_2023-03-03-18-36-15\" /></p>\n<ul>\n<li>æ•´ä½“ Controller ä»£ç </li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// é…ç½® controller</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//@Controller</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// å®šä¹‰ç±»ä¸Šæ•´ä¸ªç±»ç”Ÿæ•ˆ</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">//@ResponseBody</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// å°† controller å’Œ responsebody ä¸¤ä¸ªæ³¨è§£åŠŸèƒ½åˆäºŒä¸ºä¸€</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/users\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">//    ä½¿ç”¨ REST é£æ ¼è®¾ç½® save æ–¹æ³•ä¸º POST è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">//    @RequestMapping(method = RequestMethod.POST)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">//    ç®€åŒ–ä¸Šé¢çš„æ³¨è§£åŠŸèƒ½ä¸ä¸Šé¢çš„ method = RequestMethod.POST æ˜¯å¯¹ç­‰çš„</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@PostMapping</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"springmvc user save running...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"save\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">//    @RequestMapping(value = \"/&#123;id&#125;\",method = RequestMethod.DELETE)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">//    ç®€åŒ–ä¸Šé¢æ³¨è§£ï¼Œæœ‰å‚æ•°åŠ ä¸Šå‚æ•°</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token annotation punctuation\">@DeleteMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">//    @PathVariable: è¿™ä¸ªå˜é‡çš„å€¼æ¥è‡ªäºè·¯å¾„ï¼Œä½†æ˜¯ä¸æ¸…æ¥šæ¥è‡ªäºè·¯å¾„çš„å“ªé‡Œ</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"springmvc user delete running...\"</span><span class=\"token operator\">+</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"delete\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">//    @RequestMapping(value = \"/&#123;user&#125;\",method = RequestMethod.PUT)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">//    ç®€åŒ–ä¸Šé¢æ³¨è§£</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token annotation punctuation\">@PutMapping</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"springmvc user update running...\"</span><span class=\"token operator\">+</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"update\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">//    @RequestMapping( value = \"/&#123;id&#125;\",method = RequestMethod.GET)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">//    ç®€åŒ–ä¸Šé¢æ³¨è§£</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token class-name\">UserById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"springmvc user UserById running...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"userbyid\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token comment\">//    @RequestMapping(method = RequestMethod.GET)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">//    ç®€åŒ–ä¸Šé¢æ³¨è§£</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"springmvc user getAll running...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"getAll\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"restcontroller\"><a class=\"anchor\" href=\"#restcontroller\">#</a> @RestController</h3>\n<ul>\n<li>\n<p>ç±»å‹ï¼šç±»æ³¨è§£</p>\n</li>\n<li>\n<p>ä½ç½®ï¼šåŸºäº SpringMvc çš„ RESTful å¼€å‘æ§åˆ¶å™¨ç±»å®šä¹‰ä¸Šæ–¹</p>\n</li>\n<li>\n<p>ä½œç”¨ï¼šè®¾ç½®å½“å‰æ§åˆ¶å™¨ç±»ä¸º RESTful é£æ ¼ï¼Œç­‰åŒäº @Controller ä¸ @ResponseBody ä¸¤ä¸ªæ³¨è§£ç»„åˆåŠŸèƒ½</p>\n</li>\n</ul>\n<h3 id=\"getmappingpostmappingputmappingdeletemapping\"><a class=\"anchor\" href=\"#getmappingpostmappingputmappingdeletemapping\">#</a> @GetMapping,@PostMapping,@PutMapping,@DeleteMapping</h3>\n<ul>\n<li>\n<p>ç±»å‹ï¼šæ–¹æ³•æ³¨è§£</p>\n</li>\n<li>\n<p>ä½ç½®ï¼šåŸºäº SpringMvc çš„ RESTful å¼€å‘æ§åˆ¶å™¨æ–¹æ³•å®šä¹‰ä¸Šæ–¹</p>\n</li>\n<li>\n<p>ä½œç”¨ï¼šè®¾ç½®å½“å‰æ§åˆ¶å™¨æ–¹æ³•è¯·æ±‚è®¿é—®è·¯å¾„ä¸è¯·æ±‚åŠ¨ä½œï¼Œæ¯ç§å¯¹åº”ä¸€ä¸ªè¯·æ±‚åŠ¨ä½œï¼Œä¾‹å¦‚:@GetMapping å¯¹åº” GET è¯·æ±‚</p>\n</li>\n<li>\n<p>å±æ€§</p>\n<ul>\n<li>value (é»˜è®¤): è¯·æ±‚è®¿é—®è·¯å¾„</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@DeleteMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//    @PathVariable: è¿™ä¸ªå˜é‡çš„å€¼æ¥è‡ªäºè·¯å¾„ï¼Œä½†æ˜¯ä¸æ¸…æ¥šæ¥è‡ªäºè·¯å¾„çš„å“ªé‡Œ</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"springmvc user delete running...\"</span><span class=\"token operator\">+</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"delete\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"è®¾ç½®å¯¹é™æ€èµ„æºçš„è®¿é—®æ”¾è¡Œ\"><a class=\"anchor\" href=\"#è®¾ç½®å¯¹é™æ€èµ„æºçš„è®¿é—®æ”¾è¡Œ\">#</a> è®¾ç½®å¯¹é™æ€èµ„æºçš„è®¿é—®æ”¾è¡Œ</h3>\n<ul>\n<li>ç”±äº SpringMvcConfig ä¸­æŸ¥æ‰¾èµ„æºè®¾ç½®äº† <code>/</code>  ä¼šæŸ¥æ‰¾æ‰€æœ‰çš„èµ„æºä½œä¸º SpringMvc èµ„æºï¼Œä¼šå¯¼è‡´é™æ€é¡µé¢èµ„æºè¢« SpringMvc æ‹¦æˆªèµ°å¯¼è‡´è®¿é—®ä¸åˆ°ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªç±»æ¥è¿‡æ»¤</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @3/3/20239:03 PM</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @function</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @comment</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * è¿‡æ»¤ web é™æ€èµ„æºä¸è®© Spring æ‹¦æˆªèµ°ï¼Œå› ä¸ºåœ¨ SpringMvcConfig ä¸­çš„æŸ¥æ‰¾èµ„æºä½¿ç”¨äº† / ä¸ºæ‰¾å…¨éƒ¨</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SpringMvcSupport</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebMvcConfigurationSupport</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addResourceHandlers</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ResourceHandlerRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">//        å½“è®¿é—® /page/??? æ—¶ä¸è¦èµ° MVCï¼Œèµ° /page ç›®å½•ä¸‹çš„å†…å®¹</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">//        å¦‚æœè®¿é—®äº† /page/** çš„è¯·æ±‚å°±è®¿é—® /page/ ä¸‹çš„å†…å®¹</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addResourceHandler</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/pages/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addResourceLocations</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/pages/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">//        å¦‚æœè®¿é—®äº† /css/** çš„è¯·æ±‚å°±è®¿é—® /css/ ä¸‹çš„å†…å®¹</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addResourceHandler</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/css/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addResourceLocations</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/css/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">//        å¦‚æœè®¿é—®äº† /fonts/** çš„è¯·æ±‚å°±è®¿é—® /fonts/ ä¸‹çš„å†…å®¹</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addResourceHandler</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/plugins/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addResourceLocations</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/plugins/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">//        å¦‚æœè®¿é—®äº† /js/** çš„è¯·æ±‚å°±è®¿é—® /js/ ä¸‹çš„å†…å®¹</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addResourceHandler</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/js/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addResourceLocations</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/js/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springmvc",
                "è®¡ç®—æœºå­¦ç§‘",
                "springmvc"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springmvc/SpringMVC%E7%AE%80%E4%BB%8B/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springmvc/SpringMVC%E7%AE%80%E4%BB%8B/",
            "title": "SpringMVC",
            "date_published": "2024-01-06T03:03:26.801Z",
            "content_html": "<h1 id=\"springmvc\"><a class=\"anchor\" href=\"#springmvc\">#</a> SpringMVC</h1>\n<p><strong>1. ä»€ä¹ˆæ˜¯ MVC</strong></p>\n<p>MVC æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„çš„æ€æƒ³ï¼Œå°†è½¯ä»¶æŒ‰ç…§æ¨¡å‹ï¼Œè§†å›¾ï¼Œæ§åˆ¶å™¨æ¥åˆ’åˆ†</p>\n<p>M: Model, æ¨¡å‹å±‚ï¼ŒæŒ‡å·¥ç¨‹ä¸­çš„ javaBean, ä½œç”¨æ˜¯å¤„ç†æ•°æ®</p>\n<p>JavaBean åˆ†ä¸ºä¸¤ç±»:</p>\n<ul>\n<li>\n<p>ä¸€ç±»ç§°ä¸ºå®ä½“ç±» Bean: ä¸“é—¨å­˜å‚¨ä¸šåŠ¡æ•°æ®çš„ï¼Œå¦‚ Student,User ç­‰</p>\n</li>\n<li>\n<p>ä¸€ç±»ç§°ä¸ºä¸šåŠ¡å¤„ç† Bean: æŒ‡ Service æˆ– Dao å¯¹è±¡ï¼Œä¸“é—¨ç”¨äºå¤„ç†ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®è®¿é—®</p>\n</li>\n</ul>\n<p>V: View, è§†å›¾å±‚ï¼ŒæŒ‡å·¥ç¨‹ä¸­çš„ html æˆ– jsp ç­‰é¡µé¢ï¼Œä½œç”¨æ˜¯ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’ï¼Œå±•ç¤ºæ•°æ®</p>\n<p>C: Controller, æ§åˆ¶å±‚ï¼ŒæŒ‡å·¥ç¨‹ä¸­çš„ Servlet, ä½œç”¨æ˜¯æ¥æ”¶è¯·æ±‚å’Œå“åº”æµè§ˆå™¨</p>\n<p>MVC çš„å·¥ä½œæµç¨‹:</p>\n<p>ç”¨æˆ·é€šè¿‡è§†å›¾å±‚å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œåœ¨æœåŠ¡å™¨ä¸­è¯·æ±‚è¢« Controller æ¥æ”¶ï¼ŒController è°ƒç”¨ç›¸åº”çš„ Model å±‚å¤„ç†è¯·æ±‚ï¼Œå¤„ç†å®Œæ¯•å°†ç»“æœè¿”å›åˆ° Controller,Controller å†æ ¹æ®è¯·æ±‚å¤„ç†çš„ç»“æœæ‰¾åˆ°ç›¸åº”çš„ View è§†å›¾ï¼Œæ¸²æŸ“æ•°æ®åæœ€ç»ˆå“åº”ç»™æµè§ˆå™¨</p>\n<h2 id=\"springæ¦‚è¿°\"><a class=\"anchor\" href=\"#springæ¦‚è¿°\">#</a> Spring æ¦‚è¿°</h2>\n<ul>\n<li>SpringMVC æŠ€æœ¯ä¸ Servlet æŠ€æœ¯åŠŸèƒ½ç­‰åŒï¼Œå‡å±äº web å±‚å¼€å‘æŠ€æœ¯</li>\n</ul>\n<p>å½“å‰ web ç¨‹åºçš„å·¥ä½œæµç¨‹</p>\n<p>web é€šè¿‡æµè§ˆå™¨è®¿é—®é¡µé¢ï¼Œå‰ç«¯é¡µé¢ä½¿ç”¨å¼‚æ­¥æäº¤çš„æ–¹å¼å‘é€åˆ°åç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨é‡‡ç”¨ï¼Œè¡¨ç°å±‚ï¼Œä¸šåŠ¡å±‚ï¼Œæ•°æ®å±‚çš„ä¸‰å±‚æ¶æ„çš„å½¢å¼è¿›è¡Œå¼€å‘ï¼Œé¡µé¢å‘é€çš„è¯·æ±‚ç”±è¡¨ç°å±‚æ¥æ”¶ï¼Œè·å–ç”¨æˆ·çš„è¯·æ±‚å‚æ•°åï¼Œå°†å‚æ•°ä¼ é€’åˆ°ä¸šåŠ¡å±‚å†ç”±ä¸šåŠ¡å±‚è®¿é—®æ•°æ®å±‚å¾—åˆ°ç”¨æˆ·éœ€è¦è®¿é—®çš„æ•°æ®åå°†æ•°æ®è¿”å›ç»™è¡¨ç°å±‚</p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-02-28-09-55-34_20230228095922.png?v=1&amp;type=image&amp;token=V1:mM4SRRKC4ipI2jAbTv_XKB0Lvj3FXM3SLxSyTJlV5dI\" alt=\"image_2023-02-28-09-55-34\" /></p>\n<p>è¡¨ç°å±‚æ‹¿åˆ°æ•°æ®åå°†æ•°æ®è½¬æ¢æˆ json æ ¼å¼å‘é€ç»™å‰ç«¯é¡µé¢ï¼Œå‰ç«¯é¡µé¢æ¥æ”¶æ•°æ®åè§£ææ•°æ®å¹¶ç»„ç»‡æˆç”¨æˆ·æµè§ˆçš„æœ€ç»ˆé¡µé¢ä¿¡æ¯äº¤ç»™æµè§ˆå™¨</p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-02-28-10-04-48_20230228114047.png?v=1&amp;type=image&amp;token=V1:lPxGAY3PyF3SDnLjjy4wO3gbPVodnCklfxcALZQRTNg\" alt=\"image_2023-02-28-10-04-48\" /></p>\n<ul>\n<li>\n<p>SpringMVC æ˜¯ä¸€ç§åŸºäº Java å®ç° MVC æ¨¡å‹çš„è½»é‡çº§ web æ¡†æ¶</p>\n</li>\n<li>\n<p>ä¼˜ç‚¹</p>\n<ul>\n<li>ä½¿ç”¨ç®€å•ï¼Œå¼€å‘ä¾¿æ·ï¼ˆç›¸æ¯”äº Servletï¼‰</li>\n</ul>\n</li>\n<li>\n<p>çµæ´»æ€§å¼º</p>\n</li>\n</ul>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-02-28-10-09-22_20230228114059.png?v=1&amp;type=image&amp;token=V1:zipI1kWUI2CjRJWAdJ7YDmvma9-wlq57vyvpwhD5jdU\" alt=\"image_2023-02-28-10-09-22\" /></p>\n<ul>\n<li>å°ç»“\n<ul>\n<li>SpringMVC æ˜¯ä¸€ç§è¡¨ç°å±‚æ¡†æ¶æŠ€æœ¯</li>\n<li>SpringMVC ç”¨äºè¿›è¡Œè¡¨ç°å±‚åŠŸèƒ½å¼€å‘</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"æ“ä½œæ­¥éª¤\"><a class=\"anchor\" href=\"#æ“ä½œæ­¥éª¤\">#</a> æ“ä½œæ­¥éª¤</h2>\n<p>1. ä½¿ç”¨ SpringMVC æŠ€æœ¯éœ€è¦å…ˆå¯¼å…¥ SpringMVC åæ ‡ä¸ Servlet åæ ‡</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>javax.servlet<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>javax.servlet-api<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>3.1.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>provided<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-webmvc<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>5.2.10.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>build</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugins</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugin</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>         <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.apache.tomcat.maven<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>         <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>tomcat7-maven-plugin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>         <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>         <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>port</span><span class=\"token punctuation\">></span></span>80<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>port</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>path</span><span class=\"token punctuation\">></span></span>/<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>path</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>         <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugin</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugins</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>build</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-02-28-11-01-23_20230228114117.png?v=1&amp;type=image&amp;token=V1:4HI6B2csKa50-InxxCciyzZXscbTRiNsq4IulZb8424\" alt=\"image_2023-02-28-11-01-23\" /></p>\n<p>2. åˆ›å»º SpringMVC æ§åˆ¶å™¨ç±» (ç­‰åŒäº Servlet åŠŸèƒ½)</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// ä½¿ç”¨ @Controller å®šä¹‰ bean</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@Controller</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">//    è®¾ç½®å½“å‰è·¯å¾„çš„è®¿é—®æ“ä½œ</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/save\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//    è®¾ç½®å½“å‰æ“ä½œçš„è¿”å›å€¼ç±»å‹</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user save running...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"&#123;'module':'springMVC'&#125;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>3. åˆå§‹åŒ– SpringMVC ç¯å¢ƒ (åŒ Spring ç¯å¢ƒ), è®¾å®š SpringMVC åŠ è½½å¯¹åº”çš„ bean</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// åˆ›å»º SpringMvc çš„é…ç½®ç±»ï¼ŒåŠ è½½ controller å¯¹åº”çš„ bean</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token annotation punctuation\">@ComponentScan</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"com.dkx.springmvc\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SpringMvcConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>4. åˆå§‹åŒ– Servlet å®¹å™¨ï¼ŒåŠ è½½ SpringMVC ç¯å¢ƒï¼Œå¹¶è®¾ç½® SpringMVC æŠ€æœ¯å¤„ç†çš„è¯·æ±‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å®šä¹‰ä¸€ä¸ª Servlet å®¹å™¨å¯åŠ¨çš„é…ç½®ç±»ï¼Œåœ¨é‡Œé¢åŠ è½½ Spring çš„é…ç½®</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ServletContainerInitializerConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractDispatcherServletInitializer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">//    åŠ è½½ SpringMvc å®¹å™¨é…ç½®</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">WebApplicationContext</span> <span class=\"token function\">createServletApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">AnnotationConfigWebApplicationContext</span> c <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AnnotationConfigWebApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        c<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SpringMvcConfig</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">return</span> c<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">//    è®¾ç½®å“ªäº›è¯·æ±‚å½’å± SpringMvc å¤„ç†</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">getServletMappings</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">//        è®¾ç½®æ‰€æœ‰è¯·æ±‚å½’ SpringMvc å»å¤„ç†</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">//    åŠ è½½ SpringMvc å®¹å™¨çš„é…ç½®</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">WebApplicationContext</span> <span class=\"token function\">createRootApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"controller\"><a class=\"anchor\" href=\"#controller\">#</a> @Controller</h2>\n<ul>\n<li>\n<p>ç±»å‹ï¼šç±»æ³¨è§£</p>\n</li>\n<li>\n<p>ä½ç½®ï¼šSpringMvc æ§åˆ¶å™¨ç±»å®šä¹‰ä¸Šæ–¹</p>\n</li>\n<li>\n<p>ä½œç”¨ï¼šè®¾å®š SpringMvc çš„æ ¸å¿ƒæ§åˆ¶å™¨ bean</p>\n</li>\n</ul>\n<h2 id=\"requestmapping\"><a class=\"anchor\" href=\"#requestmapping\">#</a> @RequestMapping</h2>\n<ul>\n<li>\n<p>ç±»å‹ï¼šæ–¹æ³•æ³¨è§£</p>\n</li>\n<li>\n<p>ä½ç½®ï¼šSpringMvc æ§åˆ¶å™¨æ–¹æ³•å®šä¹‰ä¸Šæ–¹</p>\n</li>\n<li>\n<p>ä½œç”¨ï¼šè®¾ç½®å½“å‰æ§åˆ¶å™¨æ–¹æ³•è¯·æ±‚è®¿é—®è·¯å¾„</p>\n</li>\n<li>\n<p>ç›¸å…³å±æ€§</p>\n<ul>\n<li>value (é»˜è®¤): è¯·æ±‚è®¿é—®è·¯å¾„</li>\n</ul>\n</li>\n<li>\n<p>SpringMVC å…¥é—¨ç¨‹åºå¼€å‘æ€»ç»“ (1+N)</p>\n<ul>\n<li>ä¸€æ¬¡æ€§å·¥ä½œ\n<ul>\n<li>åˆ›å»ºå·¥ç¨‹ï¼Œè®¾ç½®æœåŠ¡å™¨ï¼ŒåŠ è½½å·¥ç¨‹</li>\n<li>å¯¼å…¥åæ ‡</li>\n<li>åˆ›å»º web å®¹å™¨å¯åŠ¨ç±»ï¼ŒåŠ è½½ SpringMVC é…ç½®ï¼Œå¹¶è®¾ç½® SpringMVC è¯·æ±‚æ‹¦æˆªè·¯å¾„</li>\n<li>SpringMVC æ ¸å¿ƒé…ç½®ç±»ï¼ˆè®¾ç½®é…ç½®ç±»ï¼Œæ‰«æ controller åŒ…ï¼ŒåŠ è½½ Controller æ§åˆ¶å™¨ beanï¼‰</li>\n</ul>\n</li>\n<li>å¤šæ¬¡å·¥ä½œ\n<ul>\n<li>å®šä¹‰å¤„ç†è¯·æ±‚çš„æ§åˆ¶å™¨ç±»</li>\n<li>å®šä¹‰å¤„ç†è¯·æ±‚çš„æ§åˆ¶å™¨æ–¹æ³•ï¼Œå¹¶é…ç½®æ˜ å°„è·¯å¾„ï¼ˆ@RequestMappingï¼‰ä¸è¿”å› json æ•°æ®ï¼ˆ@ResponseBodyï¼‰</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>AbstractDispatcherServletInitializer ç±»æ˜¯ SpringMvc æä¾›çš„å¿«é€Ÿåˆå§‹åŒ– web3.0 å®¹å™¨çš„æŠ½è±¡ç±»</p>\n</li>\n<li>\n<p>AbstractDispatcherServletInitializer æä¾›ä¸‰ä¸ªæ¥å£æ–¹æ³•ä¾›ç”¨æˆ·å®ç°</p>\n<ul>\n<li>createServletApplicationContext () æ–¹æ³•ï¼Œåˆ›å»º Servlet å®¹å™¨æ—¶ï¼ŒåŠ è½½ SpringMVC å¯¹åº”çš„ bean å¹¶æ”¾å…¥ WebApplicationContext å¯¹è±¡èŒƒå›´ä¸­ï¼Œè€Œ WebApplicationContext çš„èŒƒå›´ä¸º ServletContext èŒƒå›´ï¼Œå³æ•´ä¸ª web å®¹å™¨èŒƒå›´</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//    åŠ è½½ SpringMvc å®¹å™¨é…ç½®</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">WebApplicationContext</span> <span class=\"token function\">createServletApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">AnnotationConfigWebApplicationContext</span> c <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AnnotationConfigWebApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        c<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SpringMvcConfig</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> c<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>getServletMappings () æ–¹æ³•ï¼Œè®¾å®š SpringMVC å¯¹åº”çš„è¯·æ±‚æ˜ å°„è·¯å¾„ï¼Œè®¾ç½®ä¸º / è¡¨ç¤ºæ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œä»»æ„è¯·æ±‚éƒ½å°†è½¬å…¥åˆ° SpringMVC è¿›è¡Œå¤„ç†</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//    è®¾ç½®å“ªäº›è¯·æ±‚å½’å± SpringMvc å¤„ç†</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">getServletMappings</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">//        è®¾ç½®æ‰€æœ‰è¯·æ±‚å½’ SpringMvc å»å¤„ç†</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>createRootApplicationContext () æ–¹æ³•ï¼Œå¦‚æœåˆ›å»º Servlet å®¹å™¨æ—¶éœ€è¦åŠ è½½é SpringMVC å¯¹åº”çš„ bean, ä½¿ç”¨å½“å‰æ–¹æ³•è¿›è¡Œï¼Œä½¿ç”¨æ–¹å¼åŒ createServletApplicationContext ()</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//    åŠ è½½ SpringMvc å®¹å™¨çš„é…ç½®</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">WebApplicationContext</span> <span class=\"token function\">createRootApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"å…¥é—¨æ¡ˆä¾‹å·¥ä½œæµç¨‹åˆ†æ\"><a class=\"anchor\" href=\"#å…¥é—¨æ¡ˆä¾‹å·¥ä½œæµç¨‹åˆ†æ\">#</a> å…¥é—¨æ¡ˆä¾‹å·¥ä½œæµç¨‹åˆ†æ</h2>\n<ul>\n<li>å¯åŠ¨æœåŠ¡å™¨åˆå§‹åŒ–è¿‡ç¨‹</li>\n</ul>\n<ol>\n<li>\n<p>æœåŠ¡å™¨å¯åŠ¨ï¼Œæ‰§è¡Œ ServletContainersInitConfig ç±»ï¼Œåˆå§‹åŒ– web å®¹å™¨</p>\n</li>\n<li>\n<p>æ‰§è¡Œ createServletApplicationContext æ–¹æ³•ï¼Œåˆ›å»ºäº† WebApplicationContext å¯¹è±¡</p>\n</li>\n<li>\n<p>åŠ è½½ SpringMvcConfig</p>\n</li>\n<li>\n<p>æ‰§è¡Œ @ComponentScan åŠ è½½å¯¹åº”çš„ bean</p>\n</li>\n<li>\n<p>åŠ è½½ UserController, æ¯ä¸ª @RequestMapping çš„åç§°å¯¹åº”ä¸€ä¸ªå…·ä½“çš„æ–¹æ³•</p>\n</li>\n<li>\n<p>æ‰§è¡Œ getServletMapping æ–¹æ³•ï¼Œå®šä¹‰æ‰€æœ‰çš„è¯·æ±‚éƒ½é€šè¿‡ SpringMvc</p>\n</li>\n</ol>\n<ul>\n<li>å•æ¬¡è¯·æ±‚è¿‡ç¨‹</li>\n</ul>\n<ol>\n<li>\n<p>å‘é€è¯·æ±‚ localhost/save</p>\n</li>\n<li>\n<p>web å®¹å™¨å‘ç°æ‰€æœ‰è¯·æ±‚éƒ½ç»è¿‡ SpringMVC, å°†è¯·æ±‚äº¤ç»™ SpringMVC å¤„ç†</p>\n</li>\n<li>\n<p>è§£æè¯·æ±‚è·¯å¾„ /save</p>\n</li>\n<li>\n<p>ç”± /save åŒ¹é…æ‰§è¡Œå¯¹åº”çš„æ–¹æ³• save ()</p>\n</li>\n<li>\n<p>æ‰§è¡Œ save ()</p>\n</li>\n<li>\n<p>æ£€æµ‹åˆ°æœ‰ @ResponseBody ç›´æ¥å°† save () æ–¹æ³•çš„è¿”å›å€¼ä½œä¸ºå“åº”ä½“è¿”å›ç»™è¯·æ±‚æ–¹</p>\n</li>\n</ol>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-02-28-14-48-08_20230228150010.png?v=1&amp;type=image&amp;token=V1:oD4mrSPwUaDZwAcbwGn2GXxkKorT-HhDI2vSyA0S5hs\" alt=\"image_2023-02-28-14-48-08\" /></p>\n<h2 id=\"controlleråŠ è½½æ§åˆ¶ä¸ä¸šåŠ¡beanåŠ è½½æ§åˆ¶\"><a class=\"anchor\" href=\"#controlleråŠ è½½æ§åˆ¶ä¸ä¸šåŠ¡beanåŠ è½½æ§åˆ¶\">#</a> Controller åŠ è½½æ§åˆ¶ä¸ä¸šåŠ¡ bean åŠ è½½æ§åˆ¶</h2>\n<ul>\n<li>\n<p>SpringMVC ç›¸å…³ bean (è¡¨ç°å±‚ bean)</p>\n</li>\n<li>\n<p>Spring æ§åˆ¶çš„ bean</p>\n<ul>\n<li>ä¸šåŠ¡ bean (Service)</li>\n<li>åŠŸèƒ½ bean (DataSource ç­‰)</li>\n</ul>\n</li>\n<li>\n<p>SpringMVC ç›¸å…³ bean åŠ è½½æ§åˆ¶</p>\n<ul>\n<li>SpringMVC åŠ è½½çš„ bean å¯¹åº”çš„åŒ…å‡åœ¨ com.dkx.spring.controller åŒ…å†…</li>\n</ul>\n</li>\n<li>\n<p>Spring ç›¸å…³ bean åŠ è½½æ§åˆ¶</p>\n<ul>\n<li>æ–¹å¼ä¸€ï¼šSpring åŠ è½½çš„ bean è®¾å®šæ‰«æèŒƒå›´ä¸º com.dkx.spring, æ’é™¤æ‰ controller åŒ…å†…çš„ bean</li>\n<li>æ–¹å¼äºŒï¼šSpring åŠ è½½çš„ bean è®¾å®šæ‰«æèŒƒå›´ä¸ºç²¾å‡†èŒƒå›´ï¼Œä¾‹å¦‚ Service åŒ…ï¼Œdao åŒ…ç­‰</li>\n<li>æ–¹å¼ä¸‰ï¼šä¸åŒºåˆ† Spring ä¸ SpringMVC çš„ç¯å¢ƒï¼ŒåŠ è½½åˆ°åŒä¸€ä¸ªç¯å¢ƒä¸­</li>\n</ul>\n</li>\n</ul>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-02-28-14-57-35_20230228150025.png?v=1&amp;type=image&amp;token=V1:HfBhhMHkzrQ-8QgMljigm3w6tD8kggRnAG3XqMB4To0\" alt=\"image_2023-02-28-14-57-35\" /></p>\n<h2 id=\"componentscan\"><a class=\"anchor\" href=\"#componentscan\">#</a> @ComponentScan</h2>\n<ul>\n<li>\n<p>åç§°:@ComponentScan</p>\n</li>\n<li>\n<p>ç±»å‹ï¼šç±»æ³¨è§£</p>\n</li>\n<li>\n<p>ä½œç”¨ï¼š<strong>ç”¨äºè®¾å®šæ‰«æ Bean è·¯å¾„ï¼Œå¤šä¸ªæ•°æ®ä½¿ç”¨æ•°ç»„æ ¼å¼</strong></p>\n</li>\n<li>\n<p>èŒƒä¾‹:</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@ComponentScan</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"com.dkx.spring\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        excludeFilters <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@ComponentScan.Filter</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                type <span class=\"token operator\">=</span> <span class=\"token class-name\">FilterType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ANNOTATION</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                classes <span class=\"token operator\">=</span> <span class=\"token class-name\">Controller</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SpringMvcConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>å±æ€§\n<ul>\n<li>excludeFilters: æ’é™¤æ‰«æè·¯å¾„åŠ è½½çš„ bean, éœ€è¦æŒ‡å®šç±»åˆ« (type) ä¸å…·ä½“é¡¹ (classes)</li>\n<li>includeFilters: åŠ è½½æŒ‡å®šçš„ bean, éœ€è¦æŒ‡å®šç±»åˆ« (type) ä¸å…·ä½“é¡¹ (classes)</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"ç®€åŒ–åˆå§‹åŒ–servletå®¹å™¨\"><a class=\"anchor\" href=\"#ç®€åŒ–åˆå§‹åŒ–servletå®¹å™¨\">#</a> ç®€åŒ–åˆå§‹åŒ– Servlet å®¹å™¨</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å®šä¹‰ç®€åŒ– Servlet å®¹å™¨å¯åŠ¨çš„é…ç½®ç±»ï¼Œåœ¨é‡Œé¢åŠ è½½ Spring çš„é…ç½®</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ServletContainersInitConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractAnnotationConfigDispatcherServletInitializer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// åŠ è½½ Spring å®¹å™¨é…ç½®</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">getRootConfigClasses</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Class</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#123;</span><span class=\"token class-name\">SpringConfig</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// åŠ è½½ SpringMVC å®¹å™¨é…ç½®</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">getServletConfigClasses</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Class</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#123;</span><span class=\"token class-name\">SpringMvcConfig</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// è®¾ç½®å“ªäº›è¯·æ±‚å½’å± SpringMVC å¤„ç†</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">getServletMappings</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>       <span class=\"token comment\">// è®¾ç½®æ‰€æœ‰è¯·æ±‚å½’å± SpringMVC å»æ‹¦æˆªå¤„ç†</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"postmanç®€ä»‹\"><a class=\"anchor\" href=\"#postmanç®€ä»‹\">#</a> PostMan ç®€ä»‹</h2>\n<ul>\n<li>\n<p>PostMan æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„ç½‘é¡µè°ƒè¯•ä¸å‘é€ç½‘é¡µ HTTP è¯·æ±‚çš„ Chrome æ’ä»¶</p>\n</li>\n<li>\n<p>ä½œç”¨ï¼šå¸¸ç”¨äºè¿›è¡Œæ¥å£æµ‹è¯•</p>\n</li>\n<li>\n<p>ç‰¹å¾</p>\n<ul>\n<li>ç®€å•</li>\n<li>å®ç”¨</li>\n<li>ç¾è§‚</li>\n<li>å¤§æ–¹</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"postmanåŸºæœ¬ä½¿ç”¨\"><a class=\"anchor\" href=\"#postmanåŸºæœ¬ä½¿ç”¨\">#</a> PostMan åŸºæœ¬ä½¿ç”¨</h3>\n<ul>\n<li>\n<p>æ³¨å†Œç™»å½•</p>\n</li>\n<li>\n<p>åˆ›å»ºå·¥ä½œç©ºé—´ / è¿›å…¥å·¥ä½œç©ºé—´</p>\n</li>\n<li>\n<p>å‘èµ·è¯·æ±‚æµ‹è¯•ç»“æœ</p>\n</li>\n</ul>\n<h2 id=\"è¯·æ±‚ä¸å“åº”\"><a class=\"anchor\" href=\"#è¯·æ±‚ä¸å“åº”\">#</a> è¯·æ±‚ä¸å“åº”</h2>\n<h3 id=\"è¯·æ±‚çš„æ˜ å°„è·¯å¾„\"><a class=\"anchor\" href=\"#è¯·æ±‚çš„æ˜ å°„è·¯å¾„\">#</a> è¯·æ±‚çš„æ˜ å°„è·¯å¾„</h3>\n<p><strong>é—®é¢˜</strong></p>\n<ul>\n<li>å¦‚æœä¸¤ä¸ª Controller ä¸åŒçš„ç±»ä¸­æœ‰åŒæ ·ä¸€ä¸ªè®¿é—®è·¯å¾„ä¸º  <code>/save</code>  é‚£ä¹ˆï¼Œå°†ä¼šæŠ¥é”™å¦‚ä¸‹:</li>\n</ul>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image-20230301103255294_20230301150535.png?v=1&amp;type=image&amp;token=V1:M6qs_9a4bb7PuqGlYabymKsv4IQO9Q2Q3d3iWhTUQRs\" alt=\"image-20230301103255294\" /></p>\n<p>å¯¼è‡´é”™è¯¯çš„ä»£ç </p>\n<ul>\n<li>UserController</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Controller</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/save\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"User save running...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"&#123;'module':'springMvc User Save'&#125;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>BookController</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Controller</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BookController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/save\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Book save running...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"&#123;'module':'springMVC Book save'&#125;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/delete\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Book delete running...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"&#123;'module':'springMVC Book delete'&#125;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol>\n<li>å›¢é˜Ÿå¤šäººå¼€å‘ï¼Œæ¯äººè®¾ç½®ä¸åŒçš„è¯·æ±‚è·¯å¾„ï¼Œå†²çªé—®é¢˜å¦‚ä½•è§£å†³ ---&lt;font style=&quot;color:red&quot;&gt; è®¾ç½®æ¨¡å—åä½œä¸ºè¯·æ±‚è·¯å¾„å‰ç¼€ &lt;/font&gt;</li>\n</ol>\n<ul>\n<li>åœ¨ UserController ç±»ä¸­çš„ save è®¿é—®è·¯å¾„åŠ ä¸Š user çš„ä¸€çº§è·¯å¾„ï¼ŒBookController ä¸­ä¹Ÿè¦è¿™æ ·åŠ ä¸Šç»Ÿä¸€è§„èŒƒ</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Controller</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user/save\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"User save running...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"&#123;'module':'springMvc User Save'&#125;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è®¿é—®è·¯å¾„æŸ¥çœ‹æ•ˆæœ</p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-10-45-02_20230301104757.png?v=1&amp;type=image&amp;token=V1:uJXvcIF9AnGIXFW3S4geaxdy89MMGTSc8GflaJMsft0\" alt=\"image_2023-03-01-10-45-02\" /></p>\n<h3 id=\"ç®€åŒ–ä¹¦å†™\"><a class=\"anchor\" href=\"#ç®€åŒ–ä¹¦å†™\">#</a> ç®€åŒ–ä¹¦å†™</h3>\n<ul>\n<li>\n<p>ç±»ä¸Šå®šä¹‰æ•´ä¸ªæ¨¡å—çš„è·¯å¾„å‰ç¼€</p>\n</li>\n<li>\n<p>ç±»ä¸­å®šä¹‰è®¿é—®è·¯å¾„çš„å…·ä½“</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Controller</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/book\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BookController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/save\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Book save running...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"&#123;'module':'springMVC Book save'&#125;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/delete\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Book delete running...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"&#123;'module':'springMVC Book delete'&#125;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è®¿é—®ç»“æœ</p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-11-01-34_20230301150555.png?v=1&amp;type=image&amp;token=V1:jB0L_yef15YHTi5og4N4HpBXFyOb6wSR3OwRebOmpuU\" alt=\"image_2023-03-01-11-01-34\" /></p>\n<h2 id=\"è¯·æ±‚æ–¹å¼\"><a class=\"anchor\" href=\"#è¯·æ±‚æ–¹å¼\">#</a> è¯·æ±‚æ–¹å¼</h2>\n<h3 id=\"getè¯·æ±‚\"><a class=\"anchor\" href=\"#getè¯·æ±‚\">#</a> Get è¯·æ±‚</h3>\n<ul>\n<li>å¤„ç†ä¸­æ–‡ä¹±ç é—®é¢˜\n<ul>\n<li>åœ¨ pom.xml ä¸­é…ç½® Tomcat7 çš„ç¼–ç å…·ä½“çœ‹å¦‚ä¸‹:</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugin</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.apache.tomcat.maven<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>tomcat7-maven-plugin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>port</span><span class=\"token punctuation\">></span></span>80<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>port</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>path</span><span class=\"token punctuation\">></span></span>/<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>path</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>uriEncoding</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            UTF-8</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>uriEncoding</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugin</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Controller</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/book\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BookController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/save\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span><span class=\"token keyword\">int</span> age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Book save running...\"</span><span class=\"token operator\">+</span>name<span class=\"token operator\">+</span><span class=\"token string\">\",\"</span><span class=\"token operator\">+</span>age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"&#123;'module':'springMVC Book save'&#125;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Send Request</p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-11-15-51_20230301150615.png?v=1&amp;type=image&amp;token=V1:F_VyXVqNDeJgU9E7axr187s12rN-X4K0NS6RrRcftj4\" alt=\"image_2023-03-01-11-15-51\" /></p>\n<p>show console result</p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-11-17-02_20230301150628.png?v=1&amp;type=image&amp;token=V1:DFtAW_rQFgFqa0IsqReHfQuo3nsiKdX2BZ500bUxq-4\" alt=\"image_2023-03-01-11-17-02\" /></p>\n<h4 id=\"postè¯·æ±‚\"><a class=\"anchor\" href=\"#postè¯·æ±‚\">#</a> Post è¯·æ±‚</h4>\n<ul>\n<li>æ™®é€šå‚æ•°ï¼šform è¡¨å• Post è¯·æ±‚ä¼ å‚ï¼Œè¡¨å•å‚æ•°åä¸å½¢å‚å˜é‡åç›¸åŒï¼Œå®šä¹‰å½¢å‚å³å¯æ¥æ”¶å‚æ•°</li>\n</ul>\n<p>Post è¯·æ±‚ä¸èƒ½åœ¨ Url ä¸­å†™ï¼Ÿæ¥è¿›è¡Œå‚æ•°çš„èµ‹å€¼</p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-11-18-32_20230301150645.png?v=1&amp;type=image&amp;token=V1:wSNFsoibWZGB1HTtkzEcZjiqGzndvgIl_0fyokBgVRg\" alt=\"image_2023-03-01-11-18-32\" /></p>\n<p>æˆ‘ä»¬éœ€è¦åœ¨å“åº”ä½“ä¸­è¿›è¡Œèµ‹å€¼</p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-11-22-51_20230301150656.png?v=1&amp;type=image&amp;token=V1:-F2apK9f0drjPUy_2QVN29uOciF-ofSIGq3YzvKu5UI\" alt=\"image_2023-03-01-11-22-51\" /></p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-11-26-14_20230301150709.png?v=1&amp;type=image&amp;token=V1:WFlzGxbF9kovBCkYt3HB5I1oec2XGZbPTrFzXlzB6F0\" alt=\"image_2023-03-01-11-26-14\" /></p>\n<p>show console result</p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-11-26-51_20230301150723.png?v=1&amp;type=image&amp;token=V1:TKGTq0suvc8qDFKv7pBYBVi50TwopZPOHb36uXPPGuU\" alt=\"image_2023-03-01-11-26-51\" /></p>\n<h2 id=\"å¤„ç†è¯·æ±‚å‚æ•°ä¸­æ–‡ä¹±ç é—®é¢˜\"><a class=\"anchor\" href=\"#å¤„ç†è¯·æ±‚å‚æ•°ä¸­æ–‡ä¹±ç é—®é¢˜\">#</a> å¤„ç†è¯·æ±‚å‚æ•°ä¸­æ–‡ä¹±ç é—®é¢˜</h2>\n<ul>\n<li>åœ¨ config ç›®å½•ä¸‹ ServletConfig ç±»ä¸­å®šä¹‰å¤„ç†ä¹±ç çš„è¿‡æ»¤æ–¹æ³•</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ServeltConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractAnnotationConfigDispatcherServletInitializer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">getRootConfigClasses</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Class</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">getServletConfigClasses</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Class</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#123;</span><span class=\"token class-name\">SpringMvcConfig</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">getServletMappings</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">//    å¤„ç†ä¹±ç </span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">Filter</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">getServletFilters</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">CharacterEncodingFilter</span> character <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CharacterEncodingFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        character<span class=\"token punctuation\">.</span><span class=\"token function\">setEncoding</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"UTF-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">//        å¤šä¸ª character ä½¿ç”¨ï¼Œ(é€—å·) åˆ†éš”</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Filter</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#123;</span>character<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-11-38-16_20230301150740.png?v=1&amp;type=image&amp;token=V1:TL148AyiBBTqA7icy316397q2umA9OTps_VPFKQDwpU\" alt=\"image_2023-03-01-11-38-16\" /></p>\n<p>send request</p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-11-44-17_20230301150750.png?v=1&amp;type=image&amp;token=V1:JxP3dqC6yZIvE5BaFZV76wo4I1tmt4jVEA7cnsqzj_w\" alt=\"image_2023-03-01-11-44-17\" /></p>\n<p>show console result</p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-11-44-39_20230301150805.png?v=1&amp;type=image&amp;token=V1:OrO83t7BqaxrMO8XxtMqyaK_IpNcxS9VEzuDADDZn-k\" alt=\"image_2023-03-01-11-44-39\" /></p>\n<ul>\n<li>&lt;font style=&quot;color:red&quot;&gt;<strong> æ³¨æ„</strong> &lt;/font&gt;: æ­¤å¤„ç†ä¹±ç æ–¹å¼å¯¹ POST æœ‰æ•ˆï¼Œä½†å¯¹ GET æ— æ•ˆ</li>\n</ul>\n<h3 id=\"requestparam\"><a class=\"anchor\" href=\"#requestparam\">#</a> @RequestParam</h3>\n<ul>\n<li>\n<p>é—®é¢˜ï¼šå¦‚æœå‘é€è¯·æ±‚å‚æ•°çš„ key ä¸æˆ‘ä»¬æ¥æ”¶å‚æ•°çš„å‚æ•°åä¸ç›¸åŒé‚£ä¹ˆåˆ™æ¥æ”¶ä¸åˆ°å‚æ•°</p>\n</li>\n<li>\n<p>ç±»å‹ï¼šå½¢å‚æ³¨è§£</p>\n</li>\n<li>\n<p>ä½ç½®ï¼šSpringMvc æ§åˆ¶å™¨æ–¹æ³•å½¢å‚å®šä¹‰å‰é¢</p>\n</li>\n<li>\n<p>ä½œç”¨ï¼šç»‘å®šè¯·æ±‚å‚æ•°ä¸å¤„ç†å™¨æ–¹æ³•å½¢å‚é—´çš„å…³ç³»</p>\n</li>\n<li>\n<p>å‚æ•°:</p>\n<ul>\n<li>required: æ˜¯å¦ä¸ºå¿…ä¼ å‚æ•°</li>\n<li>defaultValue: å‚æ•°é»˜è®¤å€¼</li>\n</ul>\n</li>\n</ul>\n<p>send request</p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-11-58-02_20230301150821.png?v=1&amp;type=image&amp;token=V1:H27NRXNfyD6vdxJel_CMq_Xcmjl_BSg5281qxzIITac\" alt=\"image_2023-03-01-11-58-02\" /></p>\n<p>show console result</p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-11-57-49_20230301150831.png?v=1&amp;type=image&amp;token=V1:QAiUWisL8vXBpDSD2FSWmtPUfyjsCikHHY5JsG9yyHY\" alt=\"image_2023-03-01-11-57-49\" /></p>\n<ul>\n<li>ç”¨äºåœ¨è®¿é—®è·¯å¾„çš„æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸­å¯¹è¯·æ±‚å‚æ•°è¿›è¡Œå½¢å‚ä¹‹é—´ç»‘å®šå…³ç³»</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Controller</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/book\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BookController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/save\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//                    RequestParam ç»‘å®šè¯·æ±‚å‚æ•°å’Œå½¢å‚ä¹‹é—´çš„å…³ç³»</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"n\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Book save running...\"</span><span class=\"token operator\">+</span>name<span class=\"token operator\">+</span><span class=\"token string\">\",\"</span><span class=\"token operator\">+</span>age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"&#123;'module':'springMVC Book save'&#125;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>send request</p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-11-59-05_20230301150845.png?v=1&amp;type=image&amp;token=V1:oVlgDoybS8okUommnvOQsbZcoQuXHUcaswo6kTPzqDE\" alt=\"image_2023-03-01-11-59-05\" /></p>\n<p>show console result</p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-11-59-33_20230301150858.png?v=1&amp;type=image&amp;token=V1:W_wzg-57RrwZCwaWil5BWiQxeao6aG1zuq3tDYJ7jcA\" alt=\"image_2023-03-01-11-59-33\" /></p>\n<h2 id=\"äº”ç§æ•°æ®ç±»å‹çš„ä¼ å‚æ–¹å¼\"><a class=\"anchor\" href=\"#äº”ç§æ•°æ®ç±»å‹çš„ä¼ å‚æ–¹å¼\">#</a> äº”ç§æ•°æ®ç±»å‹çš„ä¼ å‚æ–¹å¼</h2>\n<h3 id=\"æ™®é€šå‚æ•°\"><a class=\"anchor\" href=\"#æ™®é€šå‚æ•°\">#</a> æ™®é€šå‚æ•°:</h3>\n<ul>\n<li>url åœ°å€ä¼ å‚ï¼Œåœ°å€å‚æ•°åä¸å½¢å‚å˜é‡åç›¸åŒï¼Œå®šä¹‰å½¢å‚å³å¯æ¥æ”¶å‚æ•°</li>\n</ul>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-14-50-09_20230301150944.png?v=1&amp;type=image&amp;token=V1:tUp4kE9X3Q390V2oQM6mfl3QXE7pfFm_ZJCkqnZnEWc\" alt=\"image_2023-03-01-14-50-09\" /></p>\n<ul>\n<li>è¯·æ±‚å‚æ•°åä¸å½¢å‚å˜é‡å &lt;font style=&quot;color:red&quot;&gt;<strong> ä¸åŒ</strong> &lt;/font&gt;, ä½¿ç”¨ &lt; font style=&quot;color:red&quot;&gt;<strong>@RequestParam</strong>&lt;/font&gt; ç»‘å®šå‚æ•°å…³ç³»</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/save\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//                RequestParam ç»‘å®šè¯·æ±‚å‚æ•°å’Œå½¢å‚ä¹‹é—´çš„å…³ç³»</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"n\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Book save running...\"</span><span class=\"token operator\">+</span>name<span class=\"token operator\">+</span><span class=\"token string\">\",\"</span><span class=\"token operator\">+</span>age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token string\">\"&#123;'module':'springMVC Book save'&#125;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"pojoå‚æ•°åµŒå¥—pojoå‚æ•°\"><a class=\"anchor\" href=\"#pojoå‚æ•°åµŒå¥—pojoå‚æ•°\">#</a> POJO å‚æ•° / åµŒå¥— POJO å‚æ•°:</h3>\n<p>å‰è€…ï¼šè¯·æ±‚å‚æ•°åä¸å½¢å‚å¯¹è±¡å±æ€§åç›¸åŒï¼Œå®šä¹‰ POJO ç±»å‹å½¢å‚å³å¯æ¥æ”¶å‚æ•°</p>\n<p>åè€…ï¼šPOJO å¯¹è±¡ä¸­åŒ…å« POJO å¯¹è±¡</p>\n<p>&lt;font style=&quot;color:red&quot;&gt;<strong> æ³¨æ„:</strong> &lt;/font&gt;<strong> ç¼–å†™å®ä½“ç±»ä»£ç çš„æ—¶å€™ä¸€å®šåŠ ä¸Š getter å’Œ setter è¿˜æœ‰ toString å¦åˆ™å€¼ä¸º null</strong></p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-14-57-29_20230301151000.png?v=1&amp;type=image&amp;token=V1:XTzNFGj6VAvumdlB39Pl4riYLGUujwAJXmhB9OdgjVk\" alt=\"image_2023-03-01-14-57-29\" /></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//    pojo å‚æ•°ï¼Œå¦‚æœå‘é€è¯·æ±‚çš„å‚æ•°åå’Œ pojo ç±»ä¸­çš„å±æ€§åç›¸åŒåˆ™å¯ä»¥æ¥æ”¶åˆ°å‚æ•°å€¼</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/save\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token string\">\"&#123;'module':'springMvc User Save'&#125;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"æ•°ç»„å‚æ•°\"><a class=\"anchor\" href=\"#æ•°ç»„å‚æ•°\">#</a> æ•°ç»„å‚æ•°:</h3>\n<ul>\n<li>è¯·æ±‚å‚æ•°åä¸å½¢å‚å¯¹è±¡å±æ€§åç›¸åŒä¸”è¯·æ±‚å‚æ•°ä¸ºå¤šä¸ªï¼Œå®šä¹‰æ•°ç»„ç±»å‹å½¢å‚å³å¯æ¥æ”¶å‚æ•°</li>\n</ul>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-15-01-24_20230301151014.png?v=1&amp;type=image&amp;token=V1:XcAYDtTIOhiDO5t9lZkcQv8Y9rmOSZ41jDh87czsFV8\" alt=\"image_2023-03-01-15-01-24\" /></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//    æ•°ç»„å‚æ•°</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/arrayParam\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">arrayParam</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> likes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span>likes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token string\">\"&#123;'module':'springMvc User arrayParam running...'&#125;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"é›†åˆä¿å­˜æ™®é€šå‚æ•°\"><a class=\"anchor\" href=\"#é›†åˆä¿å­˜æ™®é€šå‚æ•°\">#</a> é›†åˆä¿å­˜æ™®é€šå‚æ•°:</h3>\n<ul>\n<li>è¯·æ±‚å‚æ•°åä¸å½¢å‚é›†åˆå¯¹è±¡åç›¸åŒä¸”è¯·æ±‚å‚æ•°ä¸ºå¤šä¸ªï¼Œ@RequestParam ç»‘å®šå‚æ•°å…³ç³»</li>\n</ul>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-15-03-14_20230301151028.png?v=1&amp;type=image&amp;token=V1:X2_xC1nK4n4iW6DK2y-sXI5DcZzKEpoqJviXMThD9Pg\" alt=\"image_2023-03-01-15-03-14\" /></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//    é›†åˆå‚æ•°</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/listParam\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@ResponseBody</span>           <span class=\"token comment\">/*List æ˜¯å¼•ç”¨ç±»å‹å®ƒä¼šåˆ›å»ºå¯¹è±¡ set å±æ€§ï¼ŒåŠ ä¸Šæ³¨è§£æ¥è®©å®ƒç›´æ¥å¾€é‡Œé¢æ·»åŠ å€¼ */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">listParam</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> likes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>likes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token string\">\"&#123;'module':'springMvc User listParam running...'&#125;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"ä¼ é€’jsonæ•°æ®\"><a class=\"anchor\" href=\"#ä¼ é€’jsonæ•°æ®\">#</a> ä¼ é€’ json æ•°æ®</h3>\n<ol>\n<li>å¯¼å…¥åæ ‡</li>\n</ol>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.fasterxml.jackson.core<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>jackson-databind<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.9.9<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ol start=\"2\">\n<li>\n<p>è®¾ç½®å‘é€ json æ•°æ®ï¼ˆè¯·æ±‚ body ä¸­æ·»åŠ  json æ•°æ®ï¼‰</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401061105792.png\" alt=\"image-20230417173450225\" /></p>\n</li>\n<li>\n<p>å¼€å¯è‡ªåŠ¨è½¬æ¢ json æ•°æ®çš„æ”¯æŒ</p>\n</li>\n</ol>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image-20230301170021890_20230301214324.png?v=1&amp;type=image&amp;token=V1:6bhIWdxVMSWxSQbI-fN2xHbDAqoboL1GOote0oUILio\" alt=\"image-20230301170021890\" /></p>\n<p>&lt;font style=&quot;color:red&quot;&gt;<strong> æ³¨æ„äº‹é¡¹ï¼š</strong>&lt;/font&gt;<strong>@EnableWebMvc</strong> æ³¨è§£åŠŸèƒ½å¼ºå¤§ï¼Œè¯¥æ³¨è§£æ•´åˆäº†å¤šä¸ªåŠŸèƒ½ï¼Œæ­¤å¤„ä»…ä½¿ç”¨å…¶ä¸­ä¸€éƒ¨åˆ†åŠŸèƒ½ï¼Œå³ json æ•°æ®è¿›è¡Œè‡ªåŠ¨ç±»å‹è½¬æ¢</p>\n<ol start=\"4\">\n<li>\n<p>è®¾ç½®æ¥æ”¶ json æ•°æ®</p>\n</li>\n<li>\n<p>è®¾ç½®æ¥æ”¶ json æ•°æ® @RequestBody</p>\n</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/json\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//    RequestBody: ç”¨äºæ¥æ”¶å‰ç«¯ç»™åç«¯ä¼ é€’çš„ json æ•°æ®</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">listParamforJson</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> likes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>likes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"&#123;'module':'springMvc User listParamforJson'&#125;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">//-------------------------------Run Result-------------------------------</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>å”±<span class=\"token punctuation\">,</span> è·³<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Wrapr</span><span class=\"token punctuation\">,</span> ç¯®çƒ<span class=\"token punctuation\">]</span></pre></td></tr></table></figure><h4 id=\"jsonæ•°ç»„\"><a class=\"anchor\" href=\"#jsonæ•°ç»„\">#</a> json æ•°ç»„</h4>\n<ul>\n<li>åœ¨ SpringMvcConfig é…ç½®ç±»ä¸­ é…ç½®æ³¨è§£ @EnableWebMvc</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@ComponentScan</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"com.dkx.spring\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token annotation punctuation\">@EnableWebMvc</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SpringMvcConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>Controller ç±»</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Controller</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/json\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//    RequestBody: ç”¨äºæ¥æ”¶å‰ç«¯ç»™åç«¯ä¼ é€’çš„ json æ•°æ®</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">listParamforJson</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> likes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>likes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"&#123;'module':'springMvc User listParamforJson'&#125;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>send request</p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-15-45-34_20230301165118.png?v=1&amp;type=image&amp;token=V1:EJPbv1_S3rPUXUUsGYLCRhMZJIPY-oNY0aKvUXguYbE\" alt=\"image_2023-03-01-15-45-34\" /></p>\n<p>show console result</p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-16-09-14_20230301165133.png?v=1&amp;type=image&amp;token=V1:jTNEFJBIf4haD9ulFJuhmqJo3Of4rVXOVZXMogd0svQ\" alt=\"image_2023-03-01-16-09-14\" /></p>\n<h4 id=\"jsonå¯¹è±¡pojo\"><a class=\"anchor\" href=\"#jsonå¯¹è±¡pojo\">#</a> json å¯¹è±¡ (POJO)</h4>\n<ul>\n<li>User</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name1<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name2<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name3<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Address</span> address<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"User&#123;\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token string\">\"name='\"</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token string\">\", name1='\"</span> <span class=\"token operator\">+</span> name1 <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token string\">\", name2='\"</span> <span class=\"token operator\">+</span> name2 <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token string\">\", name3='\"</span> <span class=\"token operator\">+</span> name3 <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token string\">\", name4='\"</span> <span class=\"token operator\">+</span> name4 <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token string\">\", address=\"</span> <span class=\"token operator\">+</span> address <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token char\">'&#125;'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Address</span> <span class=\"token function\">getAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">return</span> address<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setAddress</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Address</span> address<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>address <span class=\"token operator\">=</span> address<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> name1<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> name2<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> name3<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> name4<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Address</span> address<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name1 <span class=\"token operator\">=</span> name1<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name2 <span class=\"token operator\">=</span> name2<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name3 <span class=\"token operator\">=</span> name3<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name4 <span class=\"token operator\">=</span> name4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>address <span class=\"token operator\">=</span> address<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> name1<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> name2<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> name3<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> name4<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name1 <span class=\"token operator\">=</span> name1<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name2 <span class=\"token operator\">=</span> name2<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name3 <span class=\"token operator\">=</span> name3<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name4 <span class=\"token operator\">=</span> name4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token keyword\">return</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getName1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token keyword\">return</span> name1<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setName1</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name1 <span class=\"token operator\">=</span> name1<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getName2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        <span class=\"token keyword\">return</span> name2<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setName2</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name2<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name2 <span class=\"token operator\">=</span> name2<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getName3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>        <span class=\"token keyword\">return</span> name3<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setName3</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name3<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name3 <span class=\"token operator\">=</span> name3<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getName4</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>        <span class=\"token keyword\">return</span> name4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setName4</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name4<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name4 <span class=\"token operator\">=</span> name4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre></pre></td></tr><tr><td data-num=\"90\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>Address</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Address</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> provind<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> city<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> provind<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> city<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>provind <span class=\"token operator\">=</span> provind<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>city <span class=\"token operator\">=</span> city<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getProvind</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> provind<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setProvind</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> provind<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>provind <span class=\"token operator\">=</span> provind<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getCity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">return</span> city<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setCity</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> city<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>city <span class=\"token operator\">=</span> city<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"Address&#123;\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token string\">\"provind='\"</span> <span class=\"token operator\">+</span> provind <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token string\">\", city='\"</span> <span class=\"token operator\">+</span> city <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token char\">'&#125;'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>UserController</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/pojo\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//    RequestBody: ç”¨äºæ¥æ”¶å‰ç«¯ç»™åç«¯ä¼ é€’çš„ json æ•°æ®</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">pojoParam</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">User</span> u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"&#123;'module':'springMvc User pojoParam'&#125;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>send request</p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-16-42-25_20230301165202.png?v=1&amp;type=image&amp;token=V1:mKrSrm0-gLapYKgMEwSH646T1WJFZm2vsjQ3fHRlZPk\" alt=\"image_2023-03-01-16-42-25\" /></p>\n<h4 id=\"jsonæ•°ç»„pojo\"><a class=\"anchor\" href=\"#jsonæ•°ç»„pojo\">#</a> json æ•°ç»„ (POJO)</h4>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/listPOJO\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//    @RequestBody: ç”¨äºæ¥æ”¶å‰ç«¯ç»™åç«¯ä¼ é€’çš„ json æ•°æ®</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">listPOJOforParamJson</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"&#123;'module':'springMvc User listPOJOforParamJson'&#125;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>send request</p>\n<p><img data-src=\"SpringMVC%E7%AE%80%E4%BB%8B_md_files/image_2023-03-01-16-50-01_20230301165216.png?v=1&amp;type=image&amp;token=V1:GODlLy0uFoSWsaNCDANiuu1TzfbXUFdIUdcyNcF7LqU\" alt=\"image_2023-03-01-16-50-01\" /></p>\n<h3 id=\"enablewebmvc\"><a class=\"anchor\" href=\"#enablewebmvc\">#</a> @EnableWebMvc</h3>\n<ul>\n<li>\n<p>ç±»å‹ï¼šé…ç½®ç±»æ³¨è§£</p>\n</li>\n<li>\n<p>ä½ç½®ï¼šSpringMvc é…ç½®ç±»å®šä¹‰ä¸Šæ–¹</p>\n</li>\n<li>\n<p>ä½œç”¨:<strong> å¼€å¯ SpringMvc å¤šé¡¹è¾…åŠ©åŠŸèƒ½</strong></p>\n</li>\n</ul>\n<h3 id=\"requestbody\"><a class=\"anchor\" href=\"#requestbody\">#</a> @RequestBody</h3>\n<ul>\n<li>\n<p>ç±»å‹ï¼šå½¢å‚æ³¨è§£</p>\n</li>\n<li>\n<p>ä½ç½®ï¼šSpringM vc æ§åˆ¶å™¨æ–¹æ³•å½¢å‚å®šä¹‰å‰é¢</p>\n</li>\n<li>\n<p>ä½œç”¨:<strong> å°†è¯·æ±‚ä¸­è¯·æ±‚ä½“æ‰€åŒ…å«çš„æ•°æ®ä¼ é€’ç»™è¯·æ±‚å‚æ•°ï¼Œæ­¤æ³¨è§£ä¸€ä¸ªå¤„ç†å™¨æ–¹æ³•åªèƒ½ä½¿ç”¨ä¸€æ¬¡</strong></p>\n</li>\n</ul>\n<h2 id=\"requestbodyä¸requestparamåŒºåˆ«\"><a class=\"anchor\" href=\"#requestbodyä¸requestparamåŒºåˆ«\">#</a> @RequestBody ä¸ RequestParam åŒºåˆ«</h2>\n<ul>\n<li>\n<p>åŒºåˆ«</p>\n<ul>\n<li>@RequestParam ç”¨äºæ¥æ”¶ url åœ°å€ä¼ å‚ï¼Œè¡¨å•ä¼ å‚ (application/x-www-form-urlencoded)</li>\n<li>@requestBody ç”¨äºæ¥æ”¶ json æ•°æ® (application/json)</li>\n</ul>\n</li>\n<li>\n<p>åº”ç”¨</p>\n<ul>\n<li>åæœŸå¼€å‘ä¸­ï¼Œå‘é€ json æ ¼å¼æ•°æ®ä¸ºä¸»ï¼Œ@RequestBody åº”ç”¨è¾ƒå¹¿</li>\n<li>å¦‚æœå‘é€é json æ ¼å¼æ•°æ®ï¼Œé€‰ç”¨ @RequestParam æ¥æ”¶è¯·æ±‚å‚æ•°</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"æ—¥æœŸç±»å‹å‚æ•°ä¼ é€’\"><a class=\"anchor\" href=\"#æ—¥æœŸç±»å‹å‚æ•°ä¼ é€’\">#</a> æ—¥æœŸç±»å‹å‚æ•°ä¼ é€’</h2>\n<ul>\n<li>æ—¥æœŸç±»å‹æ•°æ®åŸºäºç³»ç»Ÿä¸åŒæ ¼å¼ä¹Ÿä¸å°½ç›¸åŒ\n<ul>\n<li>2088-08-18</li>\n<li>2088/08/18</li>\n<li>08/18/2088</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"datetimeformat\"><a class=\"anchor\" href=\"#datetimeformat\">#</a> @DateTimeFormat</h3>\n<ul>\n<li>\n<p>ç±»å‹ï¼šå½¢å‚æ³¨è§£</p>\n</li>\n<li>\n<p>ä½ç½®ï¼šSpringMvc æ§åˆ¶å™¨æ–¹æ³•å½¢å‚å‰é¢</p>\n</li>\n<li>\n<p>ä½œç”¨ï¼šè®¾å®šæ—¥æœŸæ—¶é—´å‹æ•°æ®æ ¼å¼</p>\n</li>\n<li>\n<p>å±æ€§:pattern: æ—¥æœŸæ—¶é—´æ ¼å¼å­—ç¬¦ä¸²</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\">// è®¾å®šæ—¥æœŸæ—¶é—´ç±»å‹æ ¼å¼ï¼Œå¦‚æœæ ¼å¼åœ¨ json ä¼ é€’å‚æ•°æ—¶ä¸ä¸€è‡´åˆ™ä¼šå¯¼è‡´æŠ¥é”™</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@DateTimeFormat</span><span class=\"token punctuation\">(</span>pattern <span class=\"token operator\">=</span> <span class=\"token string\">\"yyyy-MM-dd\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Date</span> date<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">return</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Date</span> <span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">return</span> date<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setDate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Date</span> date<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>date <span class=\"token operator\">=</span> date<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"User&#123;\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token string\">\"name='\"</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token string\">\", date=\"</span> <span class=\"token operator\">+</span> date <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token char\">'&#125;'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>controller</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Controller</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/json\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">User</span> u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"&#123;'model':'springMVC'&#125;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">//--------------------------------Result--------------------------------</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token class-name\">User</span><span class=\"token punctuation\">&#123;</span>name<span class=\"token operator\">=</span><span class=\"token char\">'Dkx'</span><span class=\"token punctuation\">,</span> date<span class=\"token operator\">=</span><span class=\"token class-name\">Wed</span> <span class=\"token class-name\">Dec</span> <span class=\"token number\">19</span> <span class=\"token number\">08</span><span class=\"token operator\">:</span><span class=\"token number\">00</span><span class=\"token operator\">:</span><span class=\"token number\">00</span> <span class=\"token constant\">CST</span> <span class=\"token number\">2001</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>PostMan, å‘é€ json çš„æ•°æ®</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Dkx\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"date\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"2001-12-19\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"ç±»å‹è½¬æ¢å™¨\"><a class=\"anchor\" href=\"#ç±»å‹è½¬æ¢å™¨\">#</a> ç±»å‹è½¬æ¢å™¨</h3>\n<p>å¸®æˆ‘ä»¬è¿›è¡Œç±»å‹è½¬æ¢çš„æ¥å£ï¼Œå°† Date è½¬æ¢ä¸º String ç±»å‹ä½†æ˜¯ä»ç¬¬äºŒä¸ª Date å‚æ•°å¼€å§‹ä¸è¿›è¡Œè‡ªåŠ¨è½¬æ¢</p>\n<ul>\n<li>Converter æ¥å£</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@FunctionalInterface</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Converter</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">S</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Nullable</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">T</span> <span class=\"token function\">convert</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">S</span> var1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>\n<p>è¯·æ±‚å‚æ•°å¹´é¾„æ•°æ® (String --&gt; Integer)</p>\n</li>\n<li>\n<p>æ—¥æœŸæ ¼å¼è½¬æ¢ (String --&gt; Date)</p>\n</li>\n<li>\n<p>@EnablewebMvc åŠŸèƒ½ä¹‹ä¸€ï¼šæ ¹æ®ç±»å‹åŒ¹é…å¯¹åº”çš„ç±»å‹è½¬æ¢å™¨</p>\n</li>\n</ul>\n<h2 id=\"å“åº”\"><a class=\"anchor\" href=\"#å“åº”\">#</a> å“åº”</h2>\n<ul>\n<li>å“åº”é¡µé¢</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//    å“åº”é¡µé¢ / è·³è½¬é¡µé¢</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/toJumpPage\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toJumpPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"é¡µé¢è·³è½¬\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"/page.jsp\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>å“åº”æ•°æ®\n<ul>\n<li>æ–‡æœ¬æ•°æ®</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//    å“åº”æ–‡æœ¬æ•°æ®</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/toText\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//    [WARNING] No mapping for GET /response text: æ‰¾ä¸€ä¸ªæ–‡ä»¶ä¸º response æ‰¾ä¸åˆ°æŠ¥é”™å¼‚å¸¸</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">//    åŠ ä¸Š ResponseBody ç”¨äºæ¥æ”¶ json æ•°æ® ï¼ˆapplication/jsonï¼‰</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¿”å›çº¯æ–‡æœ¬æ•°æ®\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"response text\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>json æ•°æ®</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//    å“åº” POJO å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/toJsonPOJO\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">toJsonPOJO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¿”å›POJOå¯¹è±¡\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        user<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å°æ—¥å­-åˆ˜æ¡‘\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        user<span class=\"token punctuation\">.</span><span class=\"token function\">setAge</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">return</span> user<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>å“åº” json æ•°æ® (å¯¹è±¡é›†åˆè½¬ json æ•°ç»„)</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/toJsonList\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">toJsonList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¿”å›Jsoné›†åˆæ•°æ®\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        user<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"åˆ˜æ¡‘\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        user<span class=\"token punctuation\">.</span><span class=\"token function\">setAge</span><span class=\"token punctuation\">(</span><span class=\"token number\">23</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">User</span> user1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        user1<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å¼ ä¸‰\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        user1<span class=\"token punctuation\">.</span><span class=\"token function\">setAge</span><span class=\"token punctuation\">(</span><span class=\"token number\">22</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        list<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        list<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>user1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">return</span> list<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"responsebody\"><a class=\"anchor\" href=\"#responsebody\">#</a> @ResponseBody</h3>\n<ul>\n<li>\n<p>ç±»å‹ï¼šæ–¹æ³•æ³¨è§£</p>\n</li>\n<li>\n<p>ä½ç½®ï¼šSpringMvc æ§åˆ¶å™¨æ–¹æ³•å®šä¹‰ä¸Šæ–¹</p>\n</li>\n<li>\n<p>ä½œç”¨ï¼šè®¾<strong>ç½®å½“å‰æ§åˆ¶å™¨è¿”å›å€¼ä½œä¸ºå“åº”ä½“</strong></p>\n</li>\n</ul>\n<p>å¸®æˆ‘ä»¬è½¬æ¢çš„æ¥å£ï¼šHttpMessageConverter æ¥å£</p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springmvc",
                "è®¡ç®—æœºå­¦ç§‘",
                "springmvc"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springboot/MiniO/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springboot/MiniO/",
            "title": "Minio",
            "date_published": "2024-01-06T03:01:41.977Z",
            "content_html": "<h1 id=\"ä¸€-minio\"><a class=\"anchor\" href=\"#ä¸€-minio\">#</a> ä¸€ã€Minio</h1>\n<h2 id=\"11-ä»‹ç»\"><a class=\"anchor\" href=\"#11-ä»‹ç»\">#</a> 1.1ã€ä»‹ç»</h2>\n<p>æœ¬é¡¹ç›®é‡‡ç”¨ Minio æ„å»ºåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ŒMiniO æ˜¯ä¸€ä¸ªéå¸¸è½»é‡çš„æœåŠ¡ï¼Œå¯ä»¥å¾ˆç®€å•çš„å’Œå…¶å®ƒåº”ç”¨çš„ç»“åˆä½¿ç”¨ï¼Œå®ƒå…¼å®¹äºšé©¬å­™ S3 äº‘å­˜å‚¨æœåŠ¡æ¥å£ï¼Œéå¸¸é€‚åˆäºå­˜å‚¨å¤§å®¹é‡éç»“æ„åŒ–çš„æ•°æ®ï¼Œä¾‹å¦‚å›¾ç‰‡ï¼Œè§†é¢‘ï¼Œæ—¥å¿—æ–‡ä»¶ï¼Œå¤‡ä»½æ•°æ®å’Œå®¹å™¨ / è™šæ‹Ÿæœºé•œåƒç­‰ã€‚</p>\n<p>å®ƒä¸€å¤§ç‰¹ç‚¹å°±æ˜¯è½»é‡ï¼Œä½¿ç”¨ç®€å•ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒå„ç§å¹³å°ï¼Œå•ä¸ªæ–‡ä»¶æœ€å¤§ 5TBï¼Œå…¼å®¹ Amazon S3 æ¥å£ï¼Œæä¾›äº† Javaï¼ŒPythonï¼ŒGo ç­‰å¤šç‰ˆæœ¬ SDK æ”¯æŒã€‚</p>\n<p>å®˜ç½‘ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9taW4uaW8=\">https://min.io</span></p>\n<p>ä¸­æ–‡ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubWluaW8ub3JnLmNuLyVFRiVCQyU4Q2h0dHA6Ly9kb2NzLm1pbmlvLm9yZy5jbi9kb2NzLw==\">https://www.minio.org.cn/ï¼Œhttp://docs.minio.org.cn/docs/</span></p>\n<p>Minio é›†ç¾¤é‡‡ç”¨å»ä¸­å¿ƒåŒ–å…±äº«æ¶æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ˜¯å¯¹ç­‰å…³ç³»ï¼Œé€šè¿‡ Nginx å¯å¯¹ Minio è¿›è¡Œè´Ÿè½½å‡è¡¡è®¿é—®ã€‚</p>\n<p><strong>å»ä¸­å¿ƒåŒ–æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</strong>ã€‚</p>\n<p>åœ¨å¤§æ•°æ®é¢†åŸŸï¼Œé€šå¸¸çš„è®¾è®¡ç†å¿µéƒ½æ˜¯æ— ä¸­å¿ƒå’Œåˆ†å¸ƒå¼ã€‚Minio åˆ†å¸ƒå¼æ¨¡å¼å¯ä»¥å¸®åŠ©ä½ æ­å»ºä¸€ä¸ªé«˜å¯ç”¨çš„å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™äº›å­˜å‚¨è®¾å¤‡ï¼Œè€Œä¸ç”¨è€ƒè™‘å…¶çœŸå®ç‰©ç†ä½ç½®ã€‚</p>\n<p>å®ƒå°†åˆ†å¸ƒåœ¨ä¸ç”¨æœåŠ¡å™¨ä¸Šçš„å¤šå—ç¡¬ç›˜ç»„æˆä¸€ä¸ªå¯¹è±¡å­˜å‚¨æœåŠ¡ã€‚ç”±äºç¡¬ç›˜åˆ†å¸ƒåœ¨ä¸åŒçš„èŠ‚ç‚¹ï¼Œåˆ†å¸ƒå¼ Minio é¿å…äº†å•ç‚¹æ•…éšœã€‚å¦‚ä¸‹å›¾ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310302141371.png\" alt=\"image-20231030214114635\" /></p>\n<p>Minio ä½¿ç”¨çº åˆ ç æŠ€æœ¯æ¥ä¿æŠ¤æ•°æ®ï¼Œå®ƒæ˜¯ä¸€ç§æ¢å¤ä¸¢å¤±å’ŒæŸåæ•°æ®çš„æ•°å­¦ç®—æ³•ï¼Œå®ƒå°†æ•°æ®åˆ†å—å†—ä½™çš„åˆ†æ•£å­˜å‚¨åœ¨å„ä¸ªèŠ‚ç‚¹çš„ç£ç›˜ä¸Šï¼Œæ‰€æœ‰çš„å¯ç”¨ç£ç›˜ç»„æˆä¸€ä¸ªé›†åˆï¼Œä¸Šå›¾ç”± 8 å—ç¡¬ç›˜ç»„æˆä¸€ä¸ªé›†åˆï¼Œå½“ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶æ—¶ä¼šé€šè¿‡çº åˆ ç ç®—æ³•è®¡ç®—å¯¹æ–‡ä»¶è¿›è¡Œåˆ†å—å­˜å‚¨ï¼Œé™¤äº†å°†æ–‡ä»¶æœ¬èº«åˆ†æˆ 4 ä¸ªæ•°æ®å—ï¼Œè¿˜ä¼šç”Ÿæˆ 4 ä¸ªæ ¡éªŒå—ï¼Œæ•°æ®å—å’Œæ ¡éªŒå—ä¼šåˆ†æ•£çš„å­˜å‚¨åœ¨è¿™ 8 å—ç¡¬ç›˜ä¸Šã€‚</p>\n<p>ä½¿ç”¨çº åˆ ç çš„å¥½å¤„æ˜¯å³ä¾¿ä¸¢å¤±ä¸€åŠæ•°é‡ (N//2) çš„ç¡¬ç›˜ï¼Œä»ç„¶å¯ä»¥æ¢å¤æ•°æ®ã€‚æ¯”å¦‚ä¸Šè¾¹é›†åˆä¸­æœ‰ 4 ä¸ªä»¥å†…çš„ç¡¬ç›˜æŸåä»å¯ä¿è¯æ•°æ®æ¢å¤ï¼Œä¸å½±å“ä¸Šä¼ å’Œä¸‹è½½ï¼Œå¦‚æœå¤šä½™ä¸€åŠçš„ç¡¬ç›˜åäº†åˆ™æ— æ³•æ¢å¤</p>\n<h2 id=\"12-æ•°æ®æ¢å¤æ¼”ç¤º\"><a class=\"anchor\" href=\"#12-æ•°æ®æ¢å¤æ¼”ç¤º\">#</a> 1.2ã€æ•°æ®æ¢å¤æ¼”ç¤º</h2>\n<p>ä¸‹è¾¹åœ¨æœ¬æœºæ¼”ç¤º Minio æ¢å¤æ•°æ®çš„è¿‡ç¨‹ã€‚åœ¨æœ¬åœ°åˆ›å»º 4 ä¸ªç›®å½•è¡¨ç¤º 4 ä¸ªç¡¬ç›˜ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310302148756.png\" alt=\"image-20231030214820074\" /></p>\n<p>ä¸‹è½½ minioï¼Œä¸‹è½½åœ°å€åœ¨ <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kbC5taW5pby5pby9zZXJ2ZXIvbWluaW8vcmVsZWFzZS8lRUYlQkMlOEMlRTUlOEYlQUYlRTQlQkIlOEUlRTglQUYlQkUlRTclQTglOEIlRTglQjUlODQlRTYlOTYlOTklRTYlODklQkUlRTUlODglQjBtaW5pbyVFNyU5QSU4NCVFNSVBRSU4OSVFOCVBMyU4NSVFNiU5NiU4NyVFNCVCQiVCNm1pbmlvLnppcCVFOCVBNyVBMyVFNSU4RSU4QiVFNSU4RCVCMyVFNSU4RiVBRiVFNCVCRCVCRiVFNyU5NCVBOCVFRiVCQyU4Q0NNRCVFOCVCRiU5QiVFNSU4NSVBNSVFNiU5QyU4OW1pbmlvLmV4ZSVFNyU5QSU4NCVFNyU5QiVBRSVFNSVCRCU5NSVFRiVCQyU4QyVFOCVCRiU5MCVFOCVBMSU4QyVFNCVCOCU4QiVFOCVCRSVCOSVFNyU5QSU4NCVFNSU5MSVCRCVFNCVCQiVBNCVFRiVCQyU5QQ==\">https://dl.minio.io/server/minio/release/ï¼Œå¯ä»è¯¾ç¨‹èµ„æ–™æ‰¾åˆ° minio çš„å®‰è£…æ–‡ä»¶ minio.zip è§£å‹å³å¯ä½¿ç”¨ï¼ŒCMD è¿›å…¥æœ‰ minio.exe çš„ç›®å½•ï¼Œè¿è¡Œä¸‹è¾¹çš„å‘½ä»¤ï¼š</span></p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>minio.exe server D:<span class=\"token punctuation\">\\</span>develop<span class=\"token punctuation\">\\</span>minio_data<span class=\"token punctuation\">\\</span>data1  D:<span class=\"token punctuation\">\\</span>develop<span class=\"token punctuation\">\\</span>minio_data<span class=\"token punctuation\">\\</span>data2  D:<span class=\"token punctuation\">\\</span>develop<span class=\"token punctuation\">\\</span>minio_data<span class=\"token punctuation\">\\</span>data3  D:<span class=\"token punctuation\">\\</span>develop<span class=\"token punctuation\">\\</span>minio_data<span class=\"token punctuation\">\\</span>data4</pre></td></tr></table></figure><p>å¯åŠ¨å®Œæˆåæ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310310858167.png\" alt=\"image-20231031085828981\" /></p>\n<p>è¯´æ˜å¦‚ä¸‹ï¼š</p>\n<pre><code>WARNING: MINIO_ACCESS_KEY and MINIO_SECRET_KEY are deprecated.\n         Please use MINIO_ROOT_USER and MINIO_ROOT_PASSWORD\nFormatting 1st pool, 1 set(s), 4 drives per set.\nWARNING: Host local has more than 2 drives of set. A host failure will result in data becoming unavailable.\nWARNING: Detected default credentials 'minioadmin:minioadmin', we recommend that you change these values with 'MINIO_ROOT_USER' and 'MINIO_ROOT_PASSWORD' environment variables\n</code></pre>\n<p>1ï¼‰è€ç‰ˆæœ¬ä½¿ç”¨çš„ MINIO_ACCESS_KEY å’Œ MINIO_SECRET_KEY ä¸æ¨èä½¿ç”¨ï¼Œæ¨èä½¿ç”¨ MINIO_ROOT_USER å’Œ MINIO_ROOT_PASSWORD è®¾ç½®è´¦å·å’Œå¯†ç ã€‚</p>\n<p>2ï¼‰pool å³ minio èŠ‚ç‚¹ç»„æˆçš„æ± å­ï¼Œå½“å‰æœ‰ä¸€ä¸ª pool å’Œ 4 ä¸ªç¡¬ç›˜ç»„æˆçš„ set é›†åˆ</p>\n<p>3ï¼‰å› ä¸ºé›†åˆæ˜¯ 4 ä¸ªç¡¬ç›˜ï¼Œå¤§äº 2 çš„ç¡¬ç›˜æŸåæ•°æ®å°†æ— æ³•æ¢å¤ã€‚</p>\n<p>4ï¼‰è´¦å·å’Œå¯†ç é»˜è®¤ä¸º minioadminã€minioadminï¼Œå¯ä»¥åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®é€šè¿‡ 'MINIO_ROOT_USER' and 'MINIO_ROOT_PASSWORD' è¿›è¡Œè®¾ç½®ã€‚</p>\n<p>ä¸‹è¾¹è¾“å…¥ http://localhost:9000 è¿›è¡Œç™»å½•ï¼Œè´¦å·å’Œå¯†ç ä¸ºï¼šminioadmin/minioadmin</p>\n<p>ç™»å½•æˆåŠŸåï¼Œä¸‹ä¸€æ­¥åˆ›å»º bucketï¼Œæ¡¶ï¼Œå®ƒç›¸å½“äºå­˜å‚¨æ–‡ä»¶çš„ç›®å½•ï¼Œå¯ä»¥åˆ›å»ºè‹¥å¹²çš„æ¡¶ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310310900241.png\" alt=\"image-20231031090017162\" /></p>\n<p>è¾“å…¥ bucket çš„åç§°ï¼Œç‚¹å‡» â€œCreateBucketâ€ï¼Œåˆ›å»ºæˆåŠŸ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310310900332.png\" alt=\"image-20231031090033336\" /></p>\n<p>ç‚¹å‡» â€œuploadâ€ ä¸Šä¼ æ–‡ä»¶ã€‚</p>\n<p>ä¸‹è¾¹ä¸Šä¼ å‡ ä¸ªæ–‡ä»¶</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310310900295.png\" alt=\"image-20231031090045752\" /></p>\n<p>ä¸‹è¾¹å»å››ä¸ªç›®å½•è§‚å¯Ÿæ–‡ä»¶çš„å­˜å‚¨æƒ…å†µ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310310901020.png\" alt=\"image-20231031090107880\" /></p>\n<p>æˆ‘ä»¬å‘ç°ä¸Šä¼ çš„ 1.mp4 æ–‡ä»¶å­˜å‚¨åœ¨äº†å››ä¸ªç›®å½•ï¼Œå³å››ä¸ªç¡¬ç›˜ä¸Šã€‚</p>\n<p>ä¸‹è¾¹æµ‹è¯• minio çš„æ•°æ®æ¢å¤è¿‡ç¨‹ï¼š</p>\n<p>1ã€é¦–å…ˆåˆ é™¤ä¸€ä¸ªç›®å½•ã€‚</p>\n<p>åˆ é™¤ç›®å½•åä»ç„¶å¯ä»¥åœ¨ web æ§åˆ¶å°ä¸Šä¼ æ–‡ä»¶å’Œä¸‹è½½æ–‡ä»¶ã€‚</p>\n<p>ç¨ç­‰ç‰‡åˆ»åˆ é™¤çš„ç›®å½•è‡ªåŠ¨æ¢å¤ã€‚</p>\n<p>2ã€åˆ é™¤ä¸¤ä¸ªç›®å½•ã€‚</p>\n<p>åˆ é™¤ä¸¤ä¸ªç›®å½•ä¹Ÿä¼šè‡ªåŠ¨æ¢å¤ã€‚</p>\n<p>3ã€åˆ é™¤ä¸‰ä¸ªç›®å½• ã€‚</p>\n<p>ç”±äº é›†åˆä¸­å…±æœ‰ 4 å—ç¡¬ç›˜ï¼Œæœ‰å¤§äºä¸€åŠçš„ç¡¬ç›˜æŸåæ•°æ®æ— æ³•æ¢å¤ã€‚</p>\n<p>æ­¤æ—¶æŠ¥é”™ï¼šWe encountered an internal error, please try again.  (Read failed.  Insufficient number of drives online) åœ¨çº¿é©±åŠ¨å™¨æ•°é‡ä¸è¶³ã€‚</p>\n<h1 id=\"äºŒ-sdk\"><a class=\"anchor\" href=\"#äºŒ-sdk\">#</a> äºŒã€SDK</h1>\n<h2 id=\"21-ä¸Šä¼ æ–‡ä»¶\"><a class=\"anchor\" href=\"#21-ä¸Šä¼ æ–‡ä»¶\">#</a> 2.1ã€ä¸Šä¼ æ–‡ä»¶</h2>\n<p>MinIO æä¾›å¤šä¸ªè¯­è¨€ç‰ˆæœ¬ SDK çš„æ”¯æŒï¼Œä¸‹è¾¹æ‰¾åˆ° java ç‰ˆæœ¬çš„æ–‡æ¡£ï¼š</p>\n<p>åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm1pbi5pby9kb2NzL2phdmEtY2xpZW50LXF1aWNrc3RhcnQtZ3VpZGUuaHRtbA==\">https://docs.min.io/docs/java-client-quickstart-guide.html</span></p>\n<p>æœ€ä½éœ€æ±‚ Java 1.8 æˆ–æ›´é«˜ç‰ˆæœ¬:</p>\n<p>maven ä¾èµ–å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>io.minio<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>minio<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>8.4.3<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.squareup.okhttp3<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>okhttp<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>4.8.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>åœ¨ media-service å·¥ç¨‹æ·»åŠ æ­¤ä¾èµ–ã€‚</p>\n<p>å‚æ•°è¯´æ˜ï¼š</p>\n<p>éœ€è¦ä¸‰ä¸ªå‚æ•°æ‰èƒ½è¿æ¥åˆ° minio æœåŠ¡ã€‚</p>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Endpoint</td>\n<td>å¯¹è±¡å­˜å‚¨æœåŠ¡çš„ URL</td>\n</tr>\n<tr>\n<td>Access Key</td>\n<td>Access key å°±åƒç”¨æˆ· IDï¼Œå¯ä»¥å”¯ä¸€æ ‡è¯†ä½ çš„è´¦æˆ·ã€‚</td>\n</tr>\n<tr>\n<td>Secret Key</td>\n<td>Secret key æ˜¯ä½ è´¦æˆ·çš„å¯†ç ã€‚</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"22-æ·»åŠ \"><a class=\"anchor\" href=\"#22-æ·»åŠ \">#</a> 2.2ã€æ·»åŠ </h2>\n<p>ç¼–å†™ä¸Šä¼ ä»£ç è¿›è¡Œæµ‹è¯•ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">io<span class=\"token punctuation\">.</span>minio<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MinioClient</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">io<span class=\"token punctuation\">.</span>minio<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">UploadObjectArgs</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>junit<span class=\"token punctuation\">.</span>jupiter<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Test</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * @2023/10/319:34</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * @function</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * @comment æµ‹è¯• Minio çš„ SDK</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MinioTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token class-name\">MinioClient</span> minioClient <span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token class-name\">MinioClient</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                    <span class=\"token punctuation\">.</span><span class=\"token function\">endpoint</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://192.168.249.128:9000\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                    <span class=\"token punctuation\">.</span><span class=\"token function\">credentials</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"minioadmin\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                            <span class=\"token string\">\"minioadmin\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                    <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test_update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">UploadObjectArgs</span> build <span class=\"token operator\">=</span> <span class=\"token class-name\">UploadObjectArgs</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">bucket</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"testbucket\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// æ¡¶åç§°</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">filename</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"D:\\\\Backup\\\\Documents\\\\My Pictures\\\\Camera Roll\\\\ç‘å…‹.png\"</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">// æŒ‡å®šä¸Šä¼ æ–‡ä»¶è·¯å¾„</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">object</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// æŒ‡å®šä¸Šä¼ æ–‡ä»¶çš„å¯¹è±¡å (éšä¾¿èµ·å)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>              <span class=\"token comment\">//.object (\"/root/dkx/dkx1.png\") // å¯ä»¥åˆ›å»ºå¤šçº§ç›®å½•æ¥è¿›è¡Œå­˜å‚¨</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">// è°ƒç”¨å‡½æ•°ä¸Šä¼ æ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        minioClient<span class=\"token punctuation\">.</span><span class=\"token function\">uploadObject</span><span class=\"token punctuation\">(</span>build<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œåï¼ŒæŸ¥çœ‹ä¸Šä¼ çš„ç»“æœï¼š</p>\n<p>å¯ä»¥çœ‹åˆ°ä¸Šä¼ æˆåŠŸäº†ï¼</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310311009033.png\" alt=\"image-20231031100946983\" /></p>\n<h2 id=\"23-åˆ é™¤\"><a class=\"anchor\" href=\"#23-åˆ é™¤\">#</a> 2.3ã€åˆ é™¤</h2>\n<p>æµ‹è¯•åˆ é™¤æŒ‡å®šçš„æ¡¶å¯¹è±¡</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">io<span class=\"token punctuation\">.</span>minio<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MinioClient</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">io<span class=\"token punctuation\">.</span>minio<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RemoveObjectArgs</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>junit<span class=\"token punctuation\">.</span>jupiter<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Test</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * @2023/10/319:34</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * @function</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * @comment æµ‹è¯• Minio çš„ SDK</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MinioTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token class-name\">MinioClient</span> minioClient <span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token class-name\">MinioClient</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                    <span class=\"token punctuation\">.</span><span class=\"token function\">endpoint</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://192.168.249.128:9000\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                    <span class=\"token punctuation\">.</span><span class=\"token function\">credentials</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"minioadmin\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                            <span class=\"token string\">\"minioadmin\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                    <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test_update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\">// åˆ é™¤æŒ‡å®šæ¡¶å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">RemoveObjectArgs</span> removeObjectArgs <span class=\"token operator\">=</span> <span class=\"token class-name\">RemoveObjectArgs</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">bucket</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"testbucket\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                        <span class=\"token punctuation\">.</span><span class=\"token function\">object</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// è°ƒç”¨å‡½æ•°ä¸Šä¼ æ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        minioClient<span class=\"token punctuation\">.</span><span class=\"token function\">removeObject</span><span class=\"token punctuation\">(</span>removeObjectArgs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æŸ¥çœ‹åˆ é™¤ç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310311014474.png\" alt=\"image-20231031101414466\" /></p>\n<p>è®¾ç½® contentType å¯ä»¥é€šè¿‡ com.j256.simplemagic.ContentType æšä¸¾ç±»æŸ¥çœ‹å¸¸ç”¨çš„ mimeTypeï¼ˆåª’ä½“ç±»å‹ï¼‰</p>\n<p>é€šè¿‡æ‰©å±•åå¾—åˆ° mimeTypeï¼Œä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// æ ¹æ®æ‰©å±•åå–å‡º mimeType</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">ContentInfo</span> extensionMatch <span class=\"token operator\">=</span> <span class=\"token class-name\">ContentInfoUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">findExtensionMatch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".mp4\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token class-name\">String</span> mimeType <span class=\"token operator\">=</span> <span class=\"token class-name\">MediaType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">APPLICATION_OCTET_STREAM_VALUE</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// é€šç”¨ mimeTypeï¼Œå­—èŠ‚æµ</span></pre></td></tr></table></figure><p>å®Œå–„ä¸Šè¾¹çš„ä»£ç  å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token keyword\">public</span>  <span class=\"token keyword\">void</span> <span class=\"token function\">upload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\">// æ ¹æ®æ‰©å±•åå–å‡º mimeType</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">ContentInfo</span> extensionMatch <span class=\"token operator\">=</span> <span class=\"token class-name\">ContentInfoUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">findExtensionMatch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".mp4\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">String</span> mimeType <span class=\"token operator\">=</span> <span class=\"token class-name\">MediaType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">APPLICATION_OCTET_STREAM_VALUE</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// é€šç”¨ mimeTypeï¼Œå­—èŠ‚æµ</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>extensionMatch<span class=\"token operator\">!=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      mimeType <span class=\"token operator\">=</span> extensionMatch<span class=\"token punctuation\">.</span><span class=\"token function\">getMimeType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token class-name\">UploadObjectArgs</span> testbucket <span class=\"token operator\">=</span> <span class=\"token class-name\">UploadObjectArgs</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">bucket</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"testbucket\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>         <span class=\"token comment\">//                    .object(\"test001.mp4\")</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">object</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"001/test001.mp4\"</span><span class=\"token punctuation\">)</span><span class=\"token comment\">// æ·»åŠ å­ç›®å½•</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">filename</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"D:\\\\develop\\\\upload\\\\1mp4.temp\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">contentType</span><span class=\"token punctuation\">(</span>mimeType<span class=\"token punctuation\">)</span><span class=\"token comment\">// é»˜è®¤æ ¹æ®æ‰©å±•åç¡®å®šæ–‡ä»¶å†…å®¹ç±»å‹ï¼Œä¹Ÿå¯ä»¥æŒ‡å®š</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      minioClient<span class=\"token punctuation\">.</span><span class=\"token function\">uploadObject</span><span class=\"token punctuation\">(</span>testbucket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä¸Šä¼ æˆåŠŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä¸Šä¼ å¤±è´¥\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"24-æŸ¥è¯¢\"><a class=\"anchor\" href=\"#24-æŸ¥è¯¢\">#</a> 2.4ã€æŸ¥è¯¢</h2>\n<p>é€šè¿‡æŸ¥è¯¢æ–‡ä»¶æŸ¥çœ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨ minio ä¸­ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">MinioClient</span> minioClient <span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token class-name\">MinioClient</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token punctuation\">.</span><span class=\"token function\">endpoint</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://192.168.249.128:9000\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token punctuation\">.</span><span class=\"token function\">credentials</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"minioadmin\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token string\">\"minioadmin\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// æŸ¥è¯¢æ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test_search</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token class-name\">GetObjectArgs</span> getObjectArgs <span class=\"token operator\">=</span> <span class=\"token class-name\">GetObjectArgs</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">bucket</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"testbucket\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">object</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test/dkx.png\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token class-name\">GetObjectResponse</span> object <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token class-name\">FileOutputStream</span> outputStream <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      object <span class=\"token operator\">=</span> minioClient<span class=\"token punctuation\">.</span><span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span>getObjectArgs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      outputStream <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"E:\\\\dkx.png\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token class-name\">IOUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">copy</span><span class=\"token punctuation\">(</span>object<span class=\"token punctuation\">,</span> outputStream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>         <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>object <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>         <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            object<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>         <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>outputStream <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>         <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            outputStream<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ ¡éªŒæ–‡ä»¶çš„å®Œæ•´æ€§ï¼Œå¯¹æ–‡ä»¶è®¡ç®—å‡º md5 å€¼ï¼Œæ¯”è¾ƒåŸå§‹æ–‡ä»¶çš„ md5 å’Œç›®æ ‡æ–‡ä»¶çš„ md5ï¼Œä¸€è‡´åˆ™è¯´æ˜å®Œæ•´</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// æ ¡éªŒæ–‡ä»¶çš„å®Œæ•´æ€§å¯¹æ–‡ä»¶çš„å†…å®¹è¿›è¡Œ md5</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">FileInputStream</span> fileInputStream1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"D:\\\\develop\\\\upload\\\\1.mp4\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// è·å– minio ä¸­æ–‡ä»¶çš„ md5 å€¼</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">String</span> source_md5 <span class=\"token operator\">=</span> <span class=\"token class-name\">DigestUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">md5Hex</span><span class=\"token punctuation\">(</span>fileInputStream1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token class-name\">FileInputStream</span> fileInputStream <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"D:\\\\develop\\\\upload\\\\1a.mp4\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// è·å–æœ¬åœ°ä¸‹è½½çš„æ–‡ä»¶çš„ md5 å€¼</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token class-name\">String</span> local_md5 <span class=\"token operator\">=</span> <span class=\"token class-name\">DigestUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">md5Hex</span><span class=\"token punctuation\">(</span>fileInputStream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>source_md5<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>local_md5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä¸‹è½½æˆåŠŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"ä¸‰-springbootæ•´åˆminio\"><a class=\"anchor\" href=\"#ä¸‰-springbootæ•´åˆminio\">#</a> ä¸‰ã€SpringBoot æ•´åˆ minio</h1>\n<h2 id=\"31-é…ç½®yml\"><a class=\"anchor\" href=\"#31-é…ç½®yml\">#</a> 3.1ã€é…ç½® yml</h2>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">minio</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">endpoint</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//192.168.249.128<span class=\"token punctuation\">:</span><span class=\"token number\">9000</span> <span class=\"token comment\">#Minio æœåŠ¡æ‰€åœ¨åœ°å€</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">bucketName</span><span class=\"token punctuation\">:</span> testbucket <span class=\"token comment\">#å­˜å‚¨æ¡¶åç§°</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">accessKey</span><span class=\"token punctuation\">:</span> minioadmin <span class=\"token comment\">#è®¿é—®çš„ key</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">secretKey</span><span class=\"token punctuation\">:</span> minioadmin <span class=\"token comment\">#è®¿é—®çš„ç§˜é’¥</span></pre></td></tr></table></figure><p>ç¼–å†™é…ç½®ç±»æ¥åŠ è½½é…ç½®</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MinioConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;minio.endpoint&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> endpoint<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;minio.accessKey&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> accessKey<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;minio.secretKey&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> secretKey<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MinioClient</span> <span class=\"token function\">minioClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">MinioClient</span> minioClient <span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token class-name\">MinioClient</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                        <span class=\"token punctuation\">.</span><span class=\"token function\">endpoint</span><span class=\"token punctuation\">(</span>endpoint<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                        <span class=\"token punctuation\">.</span><span class=\"token function\">credentials</span><span class=\"token punctuation\">(</span>accessKey<span class=\"token punctuation\">,</span> secretKey<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                        <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">return</span> minioClient<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™æ¥å£ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">MediaFileService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     * ä¸Šä¼ æ–‡ä»¶</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     * @param companyId æœºæ„ id</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     * @param uploadFileParamsDto æ–‡ä»¶ä¿¡æ¯</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     * @param localFilePath æ–‡ä»¶æœ¬åœ°è·¯å¾„</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     * @return è¿”å›æ–‡ä»¶ä¿¡æ¯</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token class-name\">UploadFileResultDto</span> <span class=\"token function\">uploadFile</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> companyId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UploadFileParamsDto</span> uploadFileParamsDto<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> localFilePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™æ¥å£çš„å®ç°ç±»ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MediaFileServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">MediaFileService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MediaFilesMapper</span> mediaFilesMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MinioClient</span> minioClient<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MediaFileService</span> currentProxy<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MediaProcessMapper</span> mediaProcessMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token comment\">// å­˜å‚¨æ™®é€šæ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;minio.bucket.files&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> bucket_mediafiles<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token comment\">// å­˜å‚¨è§†é¢‘</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;minio.bucket.videofiles&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> bucket_video<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token class-name\">UploadFileResultDto</span> <span class=\"token function\">uploadFile</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> companyId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UploadFileParamsDto</span> uploadFileParamsDto<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                                         <span class=\"token class-name\">String</span> localFilePath<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token comment\">// æ–‡ä»¶å</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token class-name\">String</span> filename <span class=\"token operator\">=</span> uploadFileParamsDto<span class=\"token punctuation\">.</span><span class=\"token function\">getFilename</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token comment\">// å…ˆå¾—åˆ°æ‰©å±•å</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token class-name\">String</span> extension <span class=\"token operator\">=</span> filename<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">.</span><span class=\"token function\">lastIndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token comment\">// å¾—åˆ° mimeType</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token class-name\">String</span> mimeType <span class=\"token operator\">=</span> <span class=\"token function\">getMimeType</span><span class=\"token punctuation\">(</span>extension<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token comment\">// å­ç›®å½•</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token class-name\">String</span> defaultFolderPath <span class=\"token operator\">=</span> <span class=\"token function\">getDefaultFolderPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token comment\">// æ–‡ä»¶çš„ md5 å€¼</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token class-name\">String</span> fileMd5 <span class=\"token operator\">=</span> <span class=\"token function\">getFileMd5</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span>localFilePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      <span class=\"token class-name\">String</span> objectName <span class=\"token operator\">=</span> defaultFolderPath<span class=\"token operator\">+</span>fileMd5<span class=\"token operator\">+</span>extension<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token comment\">// ä¸Šä¼ æ–‡ä»¶åˆ° minio</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>      <span class=\"token keyword\">boolean</span> result <span class=\"token operator\">=</span> <span class=\"token function\">addMediaFilesToMinIO</span><span class=\"token punctuation\">(</span>localFilePath<span class=\"token punctuation\">,</span> mimeType<span class=\"token punctuation\">,</span> bucket_mediafiles<span class=\"token punctuation\">,</span> objectName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>         <span class=\"token class-name\">XueChengPlusException</span><span class=\"token punctuation\">.</span><span class=\"token function\">cast</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä¸Šä¼ æ–‡ä»¶å¤±è´¥\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      <span class=\"token comment\">// å°†æ–‡ä»¶ä¿¡æ¯å­˜å…¥æ•°æ®åº“</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>      <span class=\"token class-name\">MediaFiles</span> mediaFiles <span class=\"token operator\">=</span> currentProxy<span class=\"token punctuation\">.</span><span class=\"token function\">addMediaFilesToDb</span><span class=\"token punctuation\">(</span>companyId<span class=\"token punctuation\">,</span> fileMd5<span class=\"token punctuation\">,</span> uploadFileParamsDto<span class=\"token punctuation\">,</span> bucket_mediafiles<span class=\"token punctuation\">,</span> objectName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>mediaFiles<span class=\"token operator\">==</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>         <span class=\"token class-name\">XueChengPlusException</span><span class=\"token punctuation\">.</span><span class=\"token function\">cast</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ–‡ä»¶ä¸Šä¼ åä¿å­˜ä¿¡æ¯å¤±è´¥\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>      <span class=\"token comment\">// å‡†å¤‡è¿”å›çš„å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>      <span class=\"token class-name\">UploadFileResultDto</span> uploadFileResultDto <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UploadFileResultDto</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>      <span class=\"token class-name\">BeanUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">copyProperties</span><span class=\"token punctuation\">(</span>mediaFiles<span class=\"token punctuation\">,</span>uploadFileResultDto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>      <span class=\"token keyword\">return</span> uploadFileResultDto<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™ controller å±‚ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @author Mr.M</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @description åª’èµ„æ–‡ä»¶ç®¡ç†æ¥å£</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @date 2022/9/6 11:29</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MediaFilesController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token class-name\">MediaFileService</span> mediaFileService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"upload/coursefile\"</span><span class=\"token punctuation\">,</span> consumes <span class=\"token operator\">=</span> <span class=\"token class-name\">MediaType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">MULTIPART_FORM_DATA_VALUE</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token class-name\">UploadFileResultDto</span> <span class=\"token function\">upload</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestPart</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"filedata\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">MultipartFile</span> file<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token class-name\">UploadFileParamsDto</span> uploadFileParamsDto <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UploadFileParamsDto</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token comment\">// åŸå§‹æ–‡ä»¶åç§°</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      uploadFileParamsDto<span class=\"token punctuation\">.</span><span class=\"token function\">setFilename</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">getOriginalFilename</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token comment\">// æ–‡ä»¶å¤§å°</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      uploadFileParamsDto<span class=\"token punctuation\">.</span><span class=\"token function\">setFileSize</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">getSize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token comment\">// æ–‡ä»¶ç±»å‹</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      uploadFileParamsDto<span class=\"token punctuation\">.</span><span class=\"token function\">setFileType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"001001\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token class-name\">Long</span> companyId <span class=\"token operator\">=</span> <span class=\"token number\">1232141425L</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token comment\">// åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token class-name\">File</span> file1<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>         file1 <span class=\"token operator\">=</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">.</span><span class=\"token function\">createTempFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"minio\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"temp\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>         file<span class=\"token punctuation\">.</span><span class=\"token function\">transferTo</span><span class=\"token punctuation\">(</span>file1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token comment\">// è·å–æ–‡ä»¶è·¯å¾„</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token class-name\">String</span> absoluteFile <span class=\"token operator\">=</span> file1<span class=\"token punctuation\">.</span><span class=\"token function\">getAbsolutePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token comment\">// Long companyId, UploadFileParamsDto uploadFileParamsDto, String localFilePath</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token comment\">// ä¸Šä¼ å›¾ç‰‡</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token keyword\">return</span> mediaFileService<span class=\"token punctuation\">.</span><span class=\"token function\">uploadFile</span><span class=\"token punctuation\">(</span>companyId<span class=\"token punctuation\">,</span> uploadFileParamsDto<span class=\"token punctuation\">,</span> absoluteFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"åç«¯å®ç°åˆ†ç‰‡ä¸Šä¼ æ–‡ä»¶\"><a class=\"anchor\" href=\"#åç«¯å®ç°åˆ†ç‰‡ä¸Šä¼ æ–‡ä»¶\">#</a> åç«¯å®ç°åˆ†ç‰‡ä¸Šä¼ æ–‡ä»¶</h2>\n<h3 id=\"52-æ–­ç‚¹ç»­ä¼ æŠ€æœ¯\"><a class=\"anchor\" href=\"#52-æ–­ç‚¹ç»­ä¼ æŠ€æœ¯\">#</a> 5.2 æ–­ç‚¹ç»­ä¼ æŠ€æœ¯</h3>\n<h4 id=\"521-ä»€ä¹ˆæ˜¯æ–­ç‚¹ç»­ä¼ \"><a class=\"anchor\" href=\"#521-ä»€ä¹ˆæ˜¯æ–­ç‚¹ç»­ä¼ \">#</a> 5.2.1 ä»€ä¹ˆæ˜¯æ–­ç‚¹ç»­ä¼ </h4>\n<p>é€šå¸¸è§†é¢‘æ–‡ä»¶éƒ½æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥å¯¹äºåª’èµ„ç³»ç»Ÿä¸Šä¼ æ–‡ä»¶çš„éœ€æ±‚è¦æ»¡è¶³å¤§æ–‡ä»¶çš„ä¸Šä¼ è¦æ±‚ã€‚http åè®®æœ¬èº«å¯¹ä¸Šä¼ æ–‡ä»¶å¤§å°æ²¡æœ‰é™åˆ¶ï¼Œä½†æ˜¯å®¢æˆ·çš„ç½‘ç»œç¯å¢ƒè´¨é‡ã€ç”µè„‘ç¡¬ä»¶ç¯å¢ƒç­‰å‚å·®ä¸é½ï¼Œå¦‚æœä¸€ä¸ªå¤§æ–‡ä»¶å¿«ä¸Šä¼ å®Œäº†ç½‘æ–­äº†æ²¡æœ‰ä¸Šä¼ å®Œæˆï¼Œéœ€è¦å®¢æˆ·é‡æ–°ä¸Šä¼ ï¼Œç”¨æˆ·ä½“éªŒéå¸¸å·®ï¼Œæ‰€ä»¥å¯¹äºå¤§æ–‡ä»¶ä¸Šä¼ çš„è¦æ±‚æœ€åŸºæœ¬çš„æ˜¯æ–­ç‚¹ç»­ä¼ ã€‚</p>\n<h4 id=\"ä»€ä¹ˆæ˜¯æ–­ç‚¹ç»­ä¼ \"><a class=\"anchor\" href=\"#ä»€ä¹ˆæ˜¯æ–­ç‚¹ç»­ä¼ \">#</a> ä»€ä¹ˆæ˜¯æ–­ç‚¹ç»­ä¼ ï¼š</h4>\n<p>â€‹    å¼•ç”¨ç™¾åº¦ç™¾ç§‘ï¼šæ–­ç‚¹ç»­ä¼ æŒ‡çš„æ˜¯åœ¨ä¸‹è½½æˆ–ä¸Šä¼ æ—¶ï¼Œå°†ä¸‹è½½æˆ–ä¸Šä¼ ä»»åŠ¡ï¼ˆä¸€ä¸ªæ–‡ä»¶æˆ–ä¸€ä¸ªå‹ç¼©åŒ…ï¼‰äººä¸ºçš„åˆ’åˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸€ä¸ªéƒ¨åˆ†é‡‡ç”¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œä¸Šä¼ æˆ–ä¸‹è½½ï¼Œå¦‚æœç¢°åˆ°ç½‘ç»œæ•…éšœï¼Œå¯ä»¥ä»å·²ç»ä¸Šä¼ æˆ–ä¸‹è½½çš„éƒ¨åˆ†å¼€å§‹ç»§ç»­ä¸Šä¼ ä¸‹è½½æœªå®Œæˆçš„éƒ¨åˆ†ï¼Œè€Œæ²¡æœ‰å¿…è¦ä»å¤´å¼€å§‹ä¸Šä¼ ä¸‹è½½ï¼Œæ–­ç‚¹ç»­ä¼ å¯ä»¥æé«˜èŠ‚çœæ“ä½œæ—¶é—´ï¼Œæé«˜ç”¨æˆ·ä½“éªŒæ€§ã€‚</p>\n<p>æ–­ç‚¹ç»­ä¼ æµç¨‹å¦‚ä¸‹å›¾ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021007223.png\" alt=\"image-20231102100719107\" /></p>\n<p>æµç¨‹å¦‚ä¸‹ï¼š</p>\n<p>1ã€å‰ç«¯ä¸Šä¼ å‰å…ˆæŠŠæ–‡ä»¶åˆ†æˆå—</p>\n<p>2ã€ä¸€å—ä¸€å—çš„ä¸Šä¼ ï¼Œä¸Šä¼ ä¸­æ–­åé‡æ–°ä¸Šä¼ ï¼Œå·²ä¸Šä¼ çš„åˆ†å—åˆ™ä¸ç”¨å†ä¸Šä¼ </p>\n<p>3ã€å„åˆ†å—ä¸Šä¼ å®Œæˆæœ€ååœ¨æœåŠ¡ç«¯åˆå¹¶æ–‡ä»¶</p>\n<p>ç¼–å†™ æ–‡ä»¶ä¸Šä¼ å‰æ ¡éªŒæ–‡ä»¶çš„ä¸šåŠ¡é€»è¾‘ä»£ç ï¼š</p>\n<p>ç¼–å†™ æ¥å£ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @author Mr.M</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @description åª’èµ„æ–‡ä»¶ç®¡ç†ä¸šåŠ¡ç±»</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @date 2022/9/10 8:55</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">MediaFileService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>     * æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     * @param fileMd5 æ–‡ä»¶ md5 å€¼</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token class-name\">RestResponse</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Boolean</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">checkFile</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> fileMd5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™ æ¥å£ å®ç°ç±»ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @author Mr.M</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @description TODO</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @date 2022/9/10 8:58</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MediaFileServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">MediaFileService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MediaFilesMapper</span> mediaFilesMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MinioClient</span> minioClient<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MediaFileService</span> currentProxy<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MediaProcessMapper</span> mediaProcessMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   <span class=\"token comment\">// å­˜å‚¨æ™®é€šæ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;minio.bucket.files&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> bucket_mediafiles<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>   <span class=\"token comment\">// å­˜å‚¨è§†é¢‘</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;minio.bucket.videofiles&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> bucket_video<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>   <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token class-name\">RestResponse</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Boolean</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">checkFile</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> fileMd5<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token comment\">// å…ˆæŸ¥è¯¢æ•°æ®åº“</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token class-name\">MediaFiles</span> mediaFiles <span class=\"token operator\">=</span> mediaFilesMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectById</span><span class=\"token punctuation\">(</span>fileMd5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>mediaFiles<span class=\"token operator\">!=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>         <span class=\"token comment\">// æ¡¶</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>         <span class=\"token class-name\">String</span> bucket <span class=\"token operator\">=</span> mediaFiles<span class=\"token punctuation\">.</span><span class=\"token function\">getBucket</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>         <span class=\"token comment\">//objectname</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>         <span class=\"token class-name\">String</span> filePath <span class=\"token operator\">=</span> mediaFiles<span class=\"token punctuation\">.</span><span class=\"token function\">getFilePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>         <span class=\"token comment\">// å¦‚æœæ•°æ®åº“å­˜åœ¨å†æŸ¥è¯¢ minio</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>         <span class=\"token class-name\">GetObjectArgs</span> getObjectArgs <span class=\"token operator\">=</span> <span class=\"token class-name\">GetObjectArgs</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">bucket</span><span class=\"token punctuation\">(</span>bucket<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">object</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>         <span class=\"token comment\">// æŸ¥è¯¢è¿œç¨‹æœåŠ¡è·å–åˆ°ä¸€ä¸ªæµå¯¹è±¡</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>         <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token class-name\">FilterInputStream</span> inputStream <span class=\"token operator\">=</span> minioClient<span class=\"token punctuation\">.</span><span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span>getObjectArgs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>inputStream<span class=\"token operator\">!=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>               <span class=\"token comment\">// æ–‡ä»¶å·²å­˜åœ¨</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>               <span class=\"token keyword\">return</span> <span class=\"token class-name\">RestResponse</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>      <span class=\"token comment\">// æ–‡ä»¶ä¸å­˜åœ¨</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>      <span class=\"token keyword\">return</span> <span class=\"token class-name\">RestResponse</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™ contrllerï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @2023/10/3120:29</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @function</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @comment</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BigFileController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MediaFileService</span> mediaFileService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token comment\">// æ–‡ä»¶ä¸Šä¼ å‰æ£€æŸ¥æ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"upload/checkfile\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token class-name\">RestResponse</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Boolean</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">checkfile</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fileMd5\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> fileMd5<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token keyword\">return</span> mediaFileService<span class=\"token punctuation\">.</span><span class=\"token function\">checkFile</span><span class=\"token punctuation\">(</span>fileMd5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™ åˆ†å—æ–‡ä»¶ä¸Šä¼ å‰çš„æ£€æŸ¥ ä¸šåŠ¡é€»è¾‘ä»£ç ï¼š</p>\n<p>ç¼–å†™ æ¥å£ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @author Mr.M</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @description åª’èµ„æ–‡ä»¶ç®¡ç†ä¸šåŠ¡ç±»</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @date 2022/9/10 8:55</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">MediaFileService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     * æ£€æŸ¥åˆ†å—æ˜¯å¦å­˜åœ¨</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>     * @param fileMd5 æ–‡ä»¶ md5 å€¼</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     * @param chunkIndex åˆ†å—åºå·</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token class-name\">RestResponse</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Boolean</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">checkChunk</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> fileMd5<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> chunkIndex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™ æ¥å£çš„ å®ç°ç±»ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @author Mr.M</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @description TODO</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @date 2022/9/10 8:58</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MediaFileServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">MediaFileService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MediaFilesMapper</span> mediaFilesMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MinioClient</span> minioClient<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MediaFileService</span> currentProxy<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MediaProcessMapper</span> mediaProcessMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   <span class=\"token comment\">// å­˜å‚¨æ™®é€šæ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;minio.bucket.files&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> bucket_mediafiles<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>   <span class=\"token comment\">// å­˜å‚¨è§†é¢‘</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;minio.bucket.videofiles&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> bucket_video<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>   <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token class-name\">RestResponse</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Boolean</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">checkChunk</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> fileMd5<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> chunkIndex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token comment\">// æ ¹æ® md5 å¾—åˆ°åˆ†å—æ–‡ä»¶æ‰€åœ¨ç›®å½•çš„è·¯å¾„</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token class-name\">String</span> chunkFileFolderPath <span class=\"token operator\">=</span> <span class=\"token function\">getChunkFileFolderPath</span><span class=\"token punctuation\">(</span>fileMd5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token comment\">// å¦‚æœæ•°æ®åº“å­˜åœ¨å†æŸ¥è¯¢ minio</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token class-name\">GetObjectArgs</span> getObjectArgs <span class=\"token operator\">=</span> <span class=\"token class-name\">GetObjectArgs</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">bucket</span><span class=\"token punctuation\">(</span>bucket_video<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">object</span><span class=\"token punctuation\">(</span>chunkFileFolderPath<span class=\"token operator\">+</span>chunkIndex<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>      <span class=\"token comment\">// æŸ¥è¯¢è¿œç¨‹æœåŠ¡è·å–åˆ°ä¸€ä¸ªæµå¯¹è±¡</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>         <span class=\"token class-name\">FilterInputStream</span> inputStream <span class=\"token operator\">=</span> minioClient<span class=\"token punctuation\">.</span><span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span>getObjectArgs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>         <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>inputStream<span class=\"token operator\">!=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            <span class=\"token comment\">// æ–‡ä»¶å·²å­˜åœ¨</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token class-name\">RestResponse</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>         e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>      <span class=\"token comment\">// æ–‡ä»¶ä¸å­˜åœ¨</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>      <span class=\"token keyword\">return</span> <span class=\"token class-name\">RestResponse</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™ controllerï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @2023/10/3120:29</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @function</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @comment</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BigFileController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MediaFileService</span> mediaFileService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token comment\">// åˆ†å—æ–‡ä»¶ä¸Šä¼ å‰çš„æ£€æŸ¥</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"upload/checkchunk\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token class-name\">RestResponse</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Boolean</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">checkchunk</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fileMd5\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> fileMd5<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                                           <span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"chunk\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">int</span> chunk<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token keyword\">return</span> mediaFileService<span class=\"token punctuation\">.</span><span class=\"token function\">checkChunk</span><span class=\"token punctuation\">(</span>fileMd5<span class=\"token punctuation\">,</span> chunk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™ æ–‡ä»¶ ä¸Šä¼  ä¸šåŠ¡é€»è¾‘ä»£ç ï¼š</p>\n<p>ç¼–å†™ æ¥å£ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @author Mr.M</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @description åª’èµ„æ–‡ä»¶ç®¡ç†ä¸šåŠ¡ç±»</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @date 2022/9/10 8:55</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">MediaFileService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     * ä¸Šä¼ åˆ†å—</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>     * @param fileMd5 æ–‡ä»¶ md5 å€¼</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     * @param chunk åˆ†å—åºå·</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>     * @param localChunkFilePath åˆ†å—æ–‡ä»¶æœ¬åœ°è·¯å¾„</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token class-name\">RestResponse</span> <span class=\"token function\">uploadChunk</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> fileMd5<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> chunk<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                            <span class=\"token class-name\">String</span> localChunkFilePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™ æ¥å£  å®ç°ç±» ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @author Mr.M</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @description TODO</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @date 2022/9/10 8:58</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MediaFileServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">MediaFileService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MediaFilesMapper</span> mediaFilesMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MinioClient</span> minioClient<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MediaFileService</span> currentProxy<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MediaProcessMapper</span> mediaProcessMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   <span class=\"token comment\">// å­˜å‚¨æ™®é€šæ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;minio.bucket.files&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> bucket_mediafiles<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>   <span class=\"token comment\">// å­˜å‚¨è§†é¢‘</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;minio.bucket.videofiles&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> bucket_video<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>   <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token class-name\">RestResponse</span> <span class=\"token function\">uploadChunk</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> fileMd5<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> chunk<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> localChunkFilePath<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token comment\">// åˆ†å—æ–‡ä»¶çš„è·¯å¾„</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token class-name\">String</span> chunkFilePath <span class=\"token operator\">=</span> <span class=\"token function\">getChunkFileFolderPath</span><span class=\"token punctuation\">(</span>fileMd5<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> chunk<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token comment\">// è·å– mimeType</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token class-name\">String</span> mimeType <span class=\"token operator\">=</span> <span class=\"token function\">getMimeType</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token comment\">// å°†åˆ†å—æ–‡ä»¶ä¸Šä¼ åˆ° minio</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token keyword\">boolean</span> b <span class=\"token operator\">=</span> <span class=\"token function\">addMediaFilesToMinIO</span><span class=\"token punctuation\">(</span>localChunkFilePath<span class=\"token punctuation\">,</span> mimeType<span class=\"token punctuation\">,</span> bucket_video<span class=\"token punctuation\">,</span> chunkFilePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>         <span class=\"token keyword\">return</span> <span class=\"token class-name\">RestResponse</span><span class=\"token punctuation\">.</span><span class=\"token function\">validfail</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"ä¸Šä¼ åˆ†å—æ–‡ä»¶å¤±è´¥\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>      <span class=\"token comment\">// ä¸Šä¼ æˆåŠŸ</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>      <span class=\"token keyword\">return</span> <span class=\"token class-name\">RestResponse</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™ controllerï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @2023/10/3120:29</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @function</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @comment</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BigFileController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MediaFileService</span> mediaFileService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token comment\">// ä¸Šä¼ æ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"upload/uploadchunk\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token class-name\">RestResponse</span> <span class=\"token function\">uploadchunk</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"file\"</span><span class=\"token punctuation\">)</span><span class=\"token class-name\">MultipartFile</span> file<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                                   <span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fileMd5\"</span><span class=\"token punctuation\">)</span><span class=\"token class-name\">String</span> fileMd5<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                                   <span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"chunk\"</span><span class=\"token punctuation\">)</span><span class=\"token keyword\">int</span> chunk<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token class-name\">File</span> localFile <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>         localFile <span class=\"token operator\">=</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">.</span><span class=\"token function\">createTempFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"minio\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"temp\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>         file<span class=\"token punctuation\">.</span><span class=\"token function\">transferTo</span><span class=\"token punctuation\">(</span>localFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token class-name\">String</span> absolutePath <span class=\"token operator\">=</span> localFile<span class=\"token punctuation\">.</span><span class=\"token function\">getAbsolutePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token keyword\">return</span> mediaFileService<span class=\"token punctuation\">.</span><span class=\"token function\">uploadChunk</span><span class=\"token punctuation\">(</span>fileMd5<span class=\"token punctuation\">,</span> chunk<span class=\"token punctuation\">,</span> absolutePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™ åˆå¹¶æ–‡ä»¶ ä¸šåŠ¡é€»è¾‘ä»£ç ï¼š</p>\n<p>ç¼–å†™ æ¥å£ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @author Mr.M</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @description åª’èµ„æ–‡ä»¶ç®¡ç†ä¸šåŠ¡ç±»</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @date 2022/9/10 8:55</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">MediaFileService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     *  å› ä¸ºè¦è§£å†³äº‹åŠ¡å¤±æ•ˆçš„é—®é¢˜æ‰€ä»¥å¯¹å¤–æš´æ¼æ¥å£ æ¥å®ç°ä»£ç†è°ƒç”¨</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>     * @param companyId</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     * @param fileMd5</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>     * @param uploadFileParamsDto</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>     * @param bucket</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>     * @param objectName</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token class-name\">MediaFiles</span> <span class=\"token function\">addMediaFilesToDb</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> companyId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> fileMd5<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                                 <span class=\"token class-name\">UploadFileParamsDto</span> uploadFileParamsDto<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                                 <span class=\"token class-name\">String</span> bucket<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> objectName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token class-name\">RestResponse</span> <span class=\"token function\">mergechunks</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> companyId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> fileMd5<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                            <span class=\"token keyword\">int</span> chunkTotal<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                            <span class=\"token class-name\">UploadFileParamsDto</span> uploadFileParamsDto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™ æ¥å£ å®ç°ç±»ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @author Mr.M</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @description TODO</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @date 2022/9/10 8:58</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MediaFileServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">MediaFileService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MediaFilesMapper</span> mediaFilesMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MinioClient</span> minioClient<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MediaFileService</span> currentProxy<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MediaProcessMapper</span> mediaProcessMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   <span class=\"token comment\">// å­˜å‚¨æ™®é€šæ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;minio.bucket.files&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> bucket_mediafiles<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>   <span class=\"token comment\">// å­˜å‚¨è§†é¢‘</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;minio.bucket.videofiles&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> bucket_video<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>   <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token class-name\">RestResponse</span> <span class=\"token function\">mergechunks</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> companyId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> fileMd5<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> chunkTotal<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UploadFileParamsDto</span> uploadFileParamsDto<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token comment\">// åˆ†å—æ–‡ä»¶æ‰€åœ¨ç›®å½•</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token class-name\">String</span> chunkFileFolderPath <span class=\"token operator\">=</span> <span class=\"token function\">getChunkFileFolderPath</span><span class=\"token punctuation\">(</span>fileMd5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token comment\">// æ‰¾åˆ°æ‰€æœ‰çš„åˆ†å—æ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ComposeSource</span><span class=\"token punctuation\">></span></span> sources <span class=\"token operator\">=</span> <span class=\"token class-name\">Stream</span><span class=\"token punctuation\">.</span><span class=\"token function\">iterate</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> i <span class=\"token operator\">-></span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span>chunkTotal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">-></span> <span class=\"token class-name\">ComposeSource</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">bucket</span><span class=\"token punctuation\">(</span>bucket_video<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">object</span><span class=\"token punctuation\">(</span>chunkFileFolderPath <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token comment\">// æºæ–‡ä»¶åç§°</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token class-name\">String</span> filename <span class=\"token operator\">=</span> uploadFileParamsDto<span class=\"token punctuation\">.</span><span class=\"token function\">getFilename</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      <span class=\"token comment\">// æ‰©å±•å</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token class-name\">String</span> extension <span class=\"token operator\">=</span> filename<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">.</span><span class=\"token function\">lastIndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>      <span class=\"token comment\">// åˆå¹¶åæ–‡ä»¶çš„ objectname</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>      <span class=\"token class-name\">String</span> objectName <span class=\"token operator\">=</span> <span class=\"token function\">getFilePathByMd5</span><span class=\"token punctuation\">(</span>fileMd5<span class=\"token punctuation\">,</span> extension<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>      <span class=\"token comment\">// æŒ‡å®šåˆå¹¶åçš„ objectName ç­‰ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>      <span class=\"token class-name\">ComposeObjectArgs</span> composeObjectArgs <span class=\"token operator\">=</span> <span class=\"token class-name\">ComposeObjectArgs</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">bucket</span><span class=\"token punctuation\">(</span>bucket_video<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">object</span><span class=\"token punctuation\">(</span>objectName<span class=\"token punctuation\">)</span><span class=\"token comment\">// åˆå¹¶åçš„æ–‡ä»¶çš„ objectname</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">sources</span><span class=\"token punctuation\">(</span>sources<span class=\"token punctuation\">)</span><span class=\"token comment\">// æŒ‡å®šæºæ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token comment\">//=========== åˆå¹¶æ–‡ä»¶ ============</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>      <span class=\"token comment\">// æŠ¥é”™ size 1048576 must be greater than 5242880ï¼Œminio é»˜è®¤çš„åˆ†å—æ–‡ä»¶å¤§å°ä¸º 5M</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>         minioClient<span class=\"token punctuation\">.</span><span class=\"token function\">composeObject</span><span class=\"token punctuation\">(</span>composeObjectArgs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>         e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>         log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"åˆå¹¶æ–‡ä»¶å‡ºé”™,bucket:&#123;&#125;,objectName:&#123;&#125;,é”™è¯¯ä¿¡æ¯:&#123;&#125;\"</span><span class=\"token punctuation\">,</span>bucket_video<span class=\"token punctuation\">,</span>objectName<span class=\"token punctuation\">,</span>e<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>         <span class=\"token keyword\">return</span> <span class=\"token class-name\">RestResponse</span><span class=\"token punctuation\">.</span><span class=\"token function\">validfail</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"åˆå¹¶æ–‡ä»¶å¼‚å¸¸\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>      <span class=\"token comment\">//=========== æ ¡éªŒåˆå¹¶åçš„å’Œæºæ–‡ä»¶æ˜¯å¦ä¸€è‡´ï¼Œè§†é¢‘ä¸Šä¼ æ‰æˆåŠŸ ===========</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>      <span class=\"token comment\">// å…ˆä¸‹è½½åˆå¹¶åçš„æ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>      <span class=\"token class-name\">File</span> file <span class=\"token operator\">=</span> <span class=\"token function\">downloadFileFromMinIO</span><span class=\"token punctuation\">(</span>bucket_video<span class=\"token punctuation\">,</span> objectName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>      <span class=\"token keyword\">try</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FileInputStream</span> fileInputStream <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>         <span class=\"token comment\">// è®¡ç®—åˆå¹¶åæ–‡ä»¶çš„ md5</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>         <span class=\"token class-name\">String</span> mergeFile_md5 <span class=\"token operator\">=</span> <span class=\"token class-name\">DigestUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">md5Hex</span><span class=\"token punctuation\">(</span>fileInputStream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>         <span class=\"token comment\">// æ¯”è¾ƒåŸå§‹ md5 å’Œåˆå¹¶åæ–‡ä»¶çš„ md5</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>         <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>fileMd5<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>mergeFile_md5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>            log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ ¡éªŒåˆå¹¶æ–‡ä»¶md5å€¼ä¸ä¸€è‡´,åŸå§‹æ–‡ä»¶:&#123;&#125;,åˆå¹¶æ–‡ä»¶:&#123;&#125;\"</span><span class=\"token punctuation\">,</span>fileMd5<span class=\"token punctuation\">,</span>mergeFile_md5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token class-name\">RestResponse</span><span class=\"token punctuation\">.</span><span class=\"token function\">validfail</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"æ–‡ä»¶æ ¡éªŒå¤±è´¥\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>         <span class=\"token comment\">// æ–‡ä»¶å¤§å°</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>         uploadFileParamsDto<span class=\"token punctuation\">.</span><span class=\"token function\">setFileSize</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>         <span class=\"token keyword\">return</span> <span class=\"token class-name\">RestResponse</span><span class=\"token punctuation\">.</span><span class=\"token function\">validfail</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"æ–‡ä»¶æ ¡éªŒå¤±è´¥\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>      <span class=\"token comment\">//============== å°†æ–‡ä»¶ä¿¡æ¯å…¥åº“ ============</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>      <span class=\"token class-name\">MediaFiles</span> mediaFiles <span class=\"token operator\">=</span> currentProxy<span class=\"token punctuation\">.</span><span class=\"token function\">addMediaFilesToDb</span><span class=\"token punctuation\">(</span>companyId<span class=\"token punctuation\">,</span> fileMd5<span class=\"token punctuation\">,</span> uploadFileParamsDto<span class=\"token punctuation\">,</span> bucket_video<span class=\"token punctuation\">,</span> objectName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>mediaFiles <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>         <span class=\"token keyword\">return</span> <span class=\"token class-name\">RestResponse</span><span class=\"token punctuation\">.</span><span class=\"token function\">validfail</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"æ–‡ä»¶å…¥åº“å¤±è´¥\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>      <span class=\"token comment\">//========== æ¸…ç†åˆ†å—æ–‡ä»¶ =========</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>      <span class=\"token function\">clearChunkFiles</span><span class=\"token punctuation\">(</span>chunkFileFolderPath<span class=\"token punctuation\">,</span>chunkTotal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>      <span class=\"token keyword\">return</span> <span class=\"token class-name\">RestResponse</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>   <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"88\"></td><td><pre>     * æ¸…é™¤åˆ†å—æ–‡ä»¶</pre></td></tr><tr><td data-num=\"89\"></td><td><pre>     * @param chunkFileFolderPath åˆ†å—æ–‡ä»¶è·¯å¾„</pre></td></tr><tr><td data-num=\"90\"></td><td><pre>     * @param chunkTotal åˆ†å—æ–‡ä»¶æ€»æ•°</pre></td></tr><tr><td data-num=\"91\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">clearChunkFiles</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> chunkFileFolderPath<span class=\"token punctuation\">,</span><span class=\"token keyword\">int</span> chunkTotal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>      <span class=\"token class-name\">Iterable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">DeleteObject</span><span class=\"token punctuation\">></span></span> objects <span class=\"token operator\">=</span>  <span class=\"token class-name\">Stream</span><span class=\"token punctuation\">.</span><span class=\"token function\">iterate</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> i <span class=\"token operator\">-></span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span>chunkTotal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DeleteObject</span><span class=\"token punctuation\">(</span>chunkFileFolderPath<span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>      <span class=\"token class-name\">RemoveObjectsArgs</span> removeObjectsArgs <span class=\"token operator\">=</span> <span class=\"token class-name\">RemoveObjectsArgs</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">bucket</span><span class=\"token punctuation\">(</span>bucket_video<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">objects</span><span class=\"token punctuation\">(</span>objects<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>      <span class=\"token class-name\">Iterable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Result</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">DeleteError</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> results <span class=\"token operator\">=</span> minioClient<span class=\"token punctuation\">.</span><span class=\"token function\">removeObjects</span><span class=\"token punctuation\">(</span>removeObjectsArgs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>      <span class=\"token comment\">// è¦æƒ³çœŸæ­£åˆ é™¤</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>      results<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>f<span class=\"token operator\">-></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>         <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>            <span class=\"token class-name\">DeleteError</span> deleteError <span class=\"token operator\">=</span> f<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>   <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"107\"></td><td><pre>     * ä» minio ä¸‹è½½æ–‡ä»¶</pre></td></tr><tr><td data-num=\"108\"></td><td><pre>     * @param bucket æ¡¶</pre></td></tr><tr><td data-num=\"109\"></td><td><pre>     * @param objectName å¯¹è±¡åç§°</pre></td></tr><tr><td data-num=\"110\"></td><td><pre>     * @return ä¸‹è½½åçš„æ–‡ä»¶</pre></td></tr><tr><td data-num=\"111\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token class-name\">File</span> <span class=\"token function\">downloadFileFromMinIO</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> bucket<span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span> objectName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>      <span class=\"token comment\">// ä¸´æ—¶æ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>      <span class=\"token class-name\">File</span> minioFile <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>      <span class=\"token class-name\">FileOutputStream</span> outputStream <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>      <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>         <span class=\"token class-name\">InputStream</span> stream <span class=\"token operator\">=</span> minioClient<span class=\"token punctuation\">.</span><span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">GetObjectArgs</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>                                                    <span class=\"token punctuation\">.</span><span class=\"token function\">bucket</span><span class=\"token punctuation\">(</span>bucket<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>                                                    <span class=\"token punctuation\">.</span><span class=\"token function\">object</span><span class=\"token punctuation\">(</span>objectName<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>                                                    <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>         <span class=\"token comment\">// åˆ›å»ºä¸´æ—¶æ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>         minioFile<span class=\"token operator\">=</span><span class=\"token class-name\">File</span><span class=\"token punctuation\">.</span><span class=\"token function\">createTempFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"minio\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\".merge\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>         outputStream <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span>minioFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>         <span class=\"token class-name\">IOUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">copy</span><span class=\"token punctuation\">(</span>stream<span class=\"token punctuation\">,</span>outputStream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>         <span class=\"token keyword\">return</span> minioFile<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>         e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>         <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>outputStream<span class=\"token operator\">!=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>               outputStream<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre>               e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre>      <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre></pre></td></tr><tr><td data-num=\"140\"></td><td><pre>   <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"141\"></td><td><pre>     * å¾—åˆ°åˆå¹¶åçš„æ–‡ä»¶çš„åœ°å€</pre></td></tr><tr><td data-num=\"142\"></td><td><pre>     * @param fileMd5 æ–‡ä»¶ id å³ md5 å€¼</pre></td></tr><tr><td data-num=\"143\"></td><td><pre>     * @param fileExt æ–‡ä»¶æ‰©å±•å</pre></td></tr><tr><td data-num=\"144\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"145\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getFilePathByMd5</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> fileMd5<span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span> fileExt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"147\"></td><td><pre>      <span class=\"token keyword\">return</span>   fileMd5<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"/\"</span> <span class=\"token operator\">+</span> fileMd5<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"/\"</span> <span class=\"token operator\">+</span> fileMd5 <span class=\"token operator\">+</span> <span class=\"token string\">\"/\"</span> <span class=\"token operator\">+</span>fileMd5 <span class=\"token operator\">+</span>fileExt<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"148\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"149\"></td><td><pre></pre></td></tr><tr><td data-num=\"150\"></td><td><pre>   <span class=\"token comment\">// å¾—åˆ°åˆ†å—æ–‡ä»¶çš„ç›®å½•</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getChunkFileFolderPath</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> fileMd5<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"152\"></td><td><pre>      <span class=\"token keyword\">return</span> fileMd5<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"/\"</span> <span class=\"token operator\">+</span> fileMd5<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"/\"</span> <span class=\"token operator\">+</span> fileMd5 <span class=\"token operator\">+</span> <span class=\"token string\">\"/\"</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"chunk\"</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springboot",
                "è®¡ç®—æœºå­¦ç§‘",
                "springboot"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/SpringBoot%E6%95%B4%E5%90%88docker%E9%83%A8%E7%BD%B2xxl-job-2.3.1/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/SpringBoot%E6%95%B4%E5%90%88docker%E9%83%A8%E7%BD%B2xxl-job-2.3.1/",
            "title": "XXL-JOBä»‹ç»å’Œä½¿ç”¨",
            "date_published": "2024-01-06T02:58:18.367Z",
            "content_html": "<h1 id=\"ä¸€-xxl-jobä»‹ç»\"><a class=\"anchor\" href=\"#ä¸€-xxl-jobä»‹ç»\">#</a> ä¸€ã€ XXL-JOB ä»‹ç»</h1>\n<p>XXL-JOB æ˜¯ä¸€ä¸ªè½»é‡çº§åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼Œå…¶æ ¸å¿ƒè®¾è®¡ç›®æ ‡æ˜¯å¼€å‘è¿…é€Ÿã€å­¦ä¹ ç®€å•ã€è½»é‡çº§ã€æ˜“æ‰©å±•ã€‚ç°å·²å¼€æ”¾æºä»£ç å¹¶æ¥å…¥å¤šå®¶å…¬å¸çº¿ä¸Šäº§å“çº¿ï¼Œå¼€ç®±å³ç”¨ã€‚</p>\n<p>å®˜ç½‘ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueHV4dWVsaS5jb20veHhsLWpvYi8=\">https://www.xuxueli.com/xxl-job/</span></p>\n<p>æ–‡æ¡£ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueHV4dWVsaS5jb20veHhsLWpvYi8jJUUzJTgwJThBJUU1JTg4JTg2JUU1JUI4JTgzJUU1JUJDJThGJUU0JUJCJUJCJUU1JThBJUExJUU4JUIwJTgzJUU1JUJBJUE2JUU1JUI5JUIzJUU1JThGJUIwWFhMLUpPQiVFMyU4MCU4Qg==\">https://www.xuxueli.com/xxl-job/#ã€Šåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å° XXL-JOBã€‹</span></p>\n<p>XXL-JOB ä¸»è¦æœ‰è°ƒåº¦ä¸­å¿ƒã€æ‰§è¡Œå™¨ã€ä»»åŠ¡ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021141945.png\" alt=\"image-20231102114124616\" /></p>\n<p><strong>è°ƒåº¦ä¸­å¿ƒï¼š</strong></p>\n<p>â€‹    è´Ÿè´£ç®¡ç†è°ƒåº¦ä¿¡æ¯ï¼ŒæŒ‰ç…§è°ƒåº¦é…ç½®å‘å‡ºè°ƒåº¦è¯·æ±‚ï¼Œè‡ªèº«ä¸æ‰¿æ‹…ä¸šåŠ¡ä»£ç ï¼›</p>\n<p>â€‹    ä¸»è¦èŒè´£ä¸ºæ‰§è¡Œå™¨ç®¡ç†ã€ä»»åŠ¡ç®¡ç†ã€ç›‘æ§è¿ç»´ã€æ—¥å¿—ç®¡ç†ç­‰</p>\n<p><strong>ä»»åŠ¡æ‰§è¡Œå™¨ï¼š</strong></p>\n<p>â€‹    è´Ÿè´£æ¥æ”¶è°ƒåº¦è¯·æ±‚å¹¶æ‰§è¡Œä»»åŠ¡é€»è¾‘ï¼›</p>\n<p>â€‹    åªè¦èŒè´£æ˜¯æ³¨å†ŒæœåŠ¡ã€ä»»åŠ¡æ‰§è¡ŒæœåŠ¡ï¼ˆæ¥æ”¶åˆ°ä»»åŠ¡åä¼šæ”¾å…¥çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—ï¼‰ã€æ‰§è¡Œç»“æœä¸ŠæŠ¥ã€æ—¥å¿—æœåŠ¡ç­‰</p>\n<p>** ä»»åŠ¡ï¼š** è´Ÿè´£æ‰§è¡Œå…·ä½“çš„ä¸šåŠ¡å¤„ç†ã€‚</p>\n<p>è°ƒåº¦ä¸­å¿ƒä¸æ‰§è¡Œå™¨ä¹‹é—´çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021142092.png\" alt=\"image-20231102114151941\" /></p>\n<p><strong>æ‰§è¡Œæµç¨‹ï¼š</strong></p>\n<p>â€‹    1. ä»»åŠ¡æ‰§è¡Œå™¨æ ¹æ®é…ç½®çš„è°ƒåº¦ä¸­å¿ƒçš„åœ°å€ï¼Œè‡ªåŠ¨æ³¨å†Œåˆ°è°ƒåº¦ä¸­å¿ƒ</p>\n<p>â€‹    2. è¾¾åˆ°ä»»åŠ¡è§¦å‘æ¡ä»¶ï¼Œè°ƒåº¦ä¸­å¿ƒä¸‹å‘ä»»åŠ¡</p>\n<p>â€‹    3. æ‰§è¡Œå™¨åŸºäºçº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶æŠŠæ‰§è¡Œç»“æœæ”¾å…¥å†…å­˜é˜Ÿåˆ—ä¸­ã€æŠŠæ‰§è¡Œæ—¥å¿—å†™å…¥æ—¥å¿—æ–‡ä»¶ä¸­</p>\n<p>â€‹    4. æ‰§è¡Œå™¨æ¶ˆè´¹å†…å­˜é˜Ÿåˆ—ä¸­çš„æ‰§è¡Œç»“æœï¼Œä¸»åŠ¨ä¸ŠæŠ¥ç»™è°ƒåº¦ä¸­å¿ƒ</p>\n<p>â€‹    5. å½“ç”¨æˆ·åœ¨è°ƒåº¦ä¸­å¿ƒæŸ¥çœ‹ä»»åŠ¡æ—¥å¿—ï¼Œè°ƒåº¦ä¸­å¿ƒè¯·æ±‚ä»»åŠ¡æ‰§è¡Œå™¨ï¼Œä»»åŠ¡æ‰§è¡Œå™¨è¯»å–ä»»åŠ¡æ—¥å¿—æ–‡ä»¶å¹¶è¿”å›æ—¥å¿—è¯¦æƒ…</p>\n<hr />\n<h1 id=\"äºŒ-ä½¿ç”¨é…ç½®\"><a class=\"anchor\" href=\"#äºŒ-ä½¿ç”¨é…ç½®\">#</a> äºŒã€ä½¿ç”¨é…ç½®</h1>\n<p>æ‰§è¡Œå‘½ä»¤æ‹‰å– xxl-job-2.3.1</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> pull xuxueli/xxl-job-admin:2.3.1</pre></td></tr></table></figure><p>æ‹‰å–æˆåŠŸåï¼Œåˆ›å»ºæŒ‚è½½é…ç½®è·¯å¾„ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> <span class=\"token parameter variable\">-m</span> <span class=\"token number\">777</span> /root/tmp/xxl-job/data/applogs</pre></td></tr></table></figure><p>åˆ›å»ºå®Œæˆååœ¨ /root/tem/xxl-job/ ç›®å½•ä¸­ åˆ›å»º é…ç½®æ–‡ä»¶ application.properties</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021026700.png\" alt=\"image-20231102102637272\" /></p>\n<p>é…ç½®å†…å®¹å¦‚ä¸‹ï¼š</p>\n<p>é‡Œé¢å°±æ›´æ”¹ä¸‹è‡ªå·±çš„ ip åœ°å€å’Œæ•°æ®åº“è´¦æˆ·å’Œå¯†ç å³å¯ã€‚</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">### web</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>server.port=8080</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>server.servlet.context<span class=\"token punctuation\">-</span>path=/xxl<span class=\"token punctuation\">-</span>job<span class=\"token punctuation\">-</span>admin</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">### actuator</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>management.server.servlet.context<span class=\"token punctuation\">-</span>path=/actuator</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>management.health.mail.enabled=false</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">### resources</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>spring.mvc.servlet.load<span class=\"token punctuation\">-</span>on<span class=\"token punctuation\">-</span>startup=0</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>spring.mvc.static<span class=\"token punctuation\">-</span>path<span class=\"token punctuation\">-</span>pattern=/static/<span class=\"token important\">**</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>spring.resources.static<span class=\"token punctuation\">-</span>locations=classpath<span class=\"token punctuation\">:</span>/static/</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> </pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">### freemarker</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>spring.freemarker.templateLoaderPath=classpath<span class=\"token punctuation\">:</span>/templates/</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>spring.freemarker.suffix=.ftl</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>spring.freemarker.charset=UTF<span class=\"token punctuation\">-</span><span class=\"token number\">8</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>spring.freemarker.request<span class=\"token punctuation\">-</span>context<span class=\"token punctuation\">-</span>attribute=request</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>spring.freemarker.settings.number_format=0.<span class=\"token comment\">##########</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre> </pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">### mybatis</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>mybatis.mapper<span class=\"token punctuation\">-</span>locations=classpath<span class=\"token punctuation\">:</span>/mybatis<span class=\"token punctuation\">-</span>mapper/<span class=\"token important\">*Mapper.xml</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#mybatis.type-aliases-package=com.xxl.job.admin.core.model</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre> </pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">### xxl-job, datasource</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>spring.datasource.url=jdbc<span class=\"token punctuation\">:</span>mysql<span class=\"token punctuation\">:</span>//192.168.249.128<span class=\"token punctuation\">:</span>3306/xxl_job<span class=\"token punctuation\">?</span>useUnicode=true<span class=\"token important\">&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>spring.datasource.username=root</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>spring.datasource.password=dkx.</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>spring.datasource.driver<span class=\"token punctuation\">-</span>class<span class=\"token punctuation\">-</span>name=com.mysql.cj.jdbc.Driver</pre></td></tr><tr><td data-num=\"30\"></td><td><pre> </pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">### datasource-pool</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>spring.datasource.type=com.zaxxer.hikari.HikariDataSource</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>spring.datasource.hikari.minimum<span class=\"token punctuation\">-</span>idle=10</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>spring.datasource.hikari.maximum<span class=\"token punctuation\">-</span>pool<span class=\"token punctuation\">-</span>size=30</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>spring.datasource.hikari.auto<span class=\"token punctuation\">-</span>commit=true</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>spring.datasource.hikari.idle<span class=\"token punctuation\">-</span>timeout=30000</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>spring.datasource.hikari.pool<span class=\"token punctuation\">-</span>name=HikariCP</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>spring.datasource.hikari.max<span class=\"token punctuation\">-</span>lifetime=900000</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>spring.datasource.hikari.connection<span class=\"token punctuation\">-</span>timeout=10000</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>spring.datasource.hikari.connection<span class=\"token punctuation\">-</span>test<span class=\"token punctuation\">-</span>query=SELECT 1</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>spring.datasource.hikari.validation<span class=\"token punctuation\">-</span>timeout=1000</pre></td></tr><tr><td data-num=\"42\"></td><td><pre> </pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token comment\">### xxl-job, email</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>spring.mail.host=smtp.qq.com</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>spring.mail.port=25</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>spring.mail.username=xxx@qq.com</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>spring.mail.from=xxx@qq.com</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>spring.mail.password=xxx</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>spring.mail.properties.mail.smtp.auth=true</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>spring.mail.properties.mail.smtp.starttls.enable=true</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>spring.mail.properties.mail.smtp.starttls.required=true</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>spring.mail.properties.mail.smtp.socketFactory.class=javax.net.ssl.SSLSocketFactory</pre></td></tr><tr><td data-num=\"53\"></td><td><pre> </pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token comment\">### xxl-job, access token</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>xxl.job.accessToken=default_token</pre></td></tr><tr><td data-num=\"56\"></td><td><pre> </pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token comment\">### xxl-job, i18n (default is zh_CN, and you can choose \"zh_CN\", \"zh_TC\" and \"en\")</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>xxl.job.i18n=zh_CN</pre></td></tr><tr><td data-num=\"59\"></td><td><pre> </pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token comment\">## xxl-job, triggerpool max size</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>xxl.job.triggerpool.fast.max=200</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>xxl.job.triggerpool.slow.max=100</pre></td></tr><tr><td data-num=\"63\"></td><td><pre> </pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token comment\">### xxl-job, log retention days</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>xxl.job.logretentiondays=30</pre></td></tr></table></figure><p>åˆ° github ä¸­ æ‹‰å–ä¸€ä¸‹é¡¹ç›®é‡Œé¢æœ‰ä¸€ä¸ª sql æ–‡ä»¶ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3h1eHVlbGkveHhsLWpvYg==\">https://github.com/xuxueli/xxl-job</span></p>\n<p>æˆ–è€…åˆ°ç äº‘ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20veHV4dWVsaTAzMjMveHhsLWpvYg==\">https://gitee.com/xuxueli0323/xxl-job</span> æ‹‰å–é¡¹ç›®ã€‚ä¸»è¦æ˜¯ sql æ–‡ä»¶å•Š</p>\n<p>æˆ‘ä»¬éœ€è¦æ‰¾åˆ°è¿™ä¸ª sql æ–‡ä»¶ç„¶ååˆ›å»ºä¸€ä¸ªæ•°æ®åº“å¹¶å¯¼å…¥ sql æ–‡ä»¶ï¼Œå†è¿›è¡Œä¸‹ä¸€æ­¥ï¼</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021034863.png\" alt=\"image-20231102103400507\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021035033.png\" alt=\"image-20231102103536623\" /></p>\n<p>é…ç½®å®Œæˆåå¯åŠ¨ xxl-job-2.3.1 å¹¶åˆ›å»ºå®¹å™¨ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run  <span class=\"token parameter variable\">-p</span> <span class=\"token number\">18080</span>:8080 <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span><span class=\"token operator\">=</span>xxl <span class=\"token parameter variable\">--restart</span><span class=\"token operator\">=</span>always <span class=\"token parameter variable\">-v</span> /root/tmp/xxl-job/application.properties:/application.properties  <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">PARAMS</span><span class=\"token operator\">=</span><span class=\"token string\">'--spring.config.location=/application.properties'</span> xuxueli/xxl-job-admin:2.3.1</pre></td></tr></table></figure><p>å¯åŠ¨æˆåŠŸåè®¿é—® uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMjQ5LjEyODoxODA4MC94eGwtam9iLWFkbWluL2pvYmdyb3Vw\">http://192.168.249.128:18080/xxl-job-admin/jobgroup</span></p>\n<p>è´¦å·ï¼šadmin ï¼Œå¯†ç ï¼š123456</p>\n<p>è®¿é—®åé¡µé¢å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021028455.png\" alt=\"image-20231102102848028\" /></p>\n<p>åˆ›å»ºä¸€ä¸ªæ‰§è¡Œå™¨</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021046055.png\" alt=\"image-20231102104642146\" /></p>\n<p>ç‚¹å‡»æ–°å¢ï¼Œå¡«å†™æ‰§è¡Œå™¨ä¿¡æ¯ï¼Œappname æ˜¯å‰è¾¹åœ¨ nacos ä¸­é…ç½® xxl ä¿¡æ¯æ—¶æŒ‡å®šçš„æ‰§è¡Œå™¨çš„åº”ç”¨åã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021047493.png\" alt=\"image-20231102104700103\" /></p>\n<p>æ·»åŠ æˆåŠŸï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021047508.png\" alt=\"image-20231102104719719\" /></p>\n<p>åœ¨éœ€è¦ç”¨åˆ°çš„ä¸šåŠ¡æ¨¡å—ä¸­å¯¼å…¥ä¾èµ–ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.xuxueli<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>xxl-job-core<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>é…ç½® application.yml å¦‚ä¸‹ï¼Œä¹Ÿå¯ä»¥é…ç½®åˆ° nacos ä¸­ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">xxl</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">job</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">admin</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">addresses</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//192.168.101.65<span class=\"token punctuation\">:</span>8088/xxl<span class=\"token punctuation\">-</span>job<span class=\"token punctuation\">-</span>admin</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">executor</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">appname</span><span class=\"token punctuation\">:</span> media<span class=\"token punctuation\">-</span>process<span class=\"token punctuation\">-</span>service</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">address</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token key atrule\">ip</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">9999</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token key atrule\">logpath</span><span class=\"token punctuation\">:</span> /data/applogs/xxl<span class=\"token punctuation\">-</span>job/jobhandler</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token key atrule\">logretentiondays</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">accessToken</span><span class=\"token punctuation\">:</span> default_token</pre></td></tr></table></figure><p>&lt;font color='red'&gt; æ³¨æ„ &lt;/font &gt; é…ç½®ä¸­çš„ appname è¿™æ˜¯æ‰§è¡Œå™¨çš„åº”ç”¨åï¼Œport æ˜¯æ‰§è¡Œå™¨å¯åŠ¨çš„ç«¯å£ï¼Œå¦‚æœæœ¬åœ°å¯åŠ¨å¤šä¸ªæ‰§è¡Œå™¨æ³¨æ„ç«¯å£ä¸èƒ½é‡å¤ã€‚</p>\n<p>åœ¨ä» github æˆ–è€… gitee ä¸­æ‹‰å–çš„ xxl-job-2.3.1 é¡¹ç›®ä¸­æ‰¾åˆ°</p>\n<p>E:\\ å­¦æˆåœ¨çº¿é¡¹ç›® â€” èµ„æ–™ \\day06 æ–­ç‚¹ç»­ä¼  xxl-job\\ èµ„æ–™ \\xxl-job-2.3.1\\xxl-job-executor-samples\\xxl-job-executor-sample-springboot\\src\\main\\java\\com\\xxl\\job\\executor\\core\\config\\XxlJobConfig.java</p>\n<p>é…ç½®æ–‡ä»¶</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021057889.png\" alt=\"image-20231102105732814\" /></p>\n<p>å°†è¯¥é…ç½®æ–‡ä»¶æ‹·è´åˆ° è‡ªå·±é¡¹ç›®çš„è¯¥æ¨¡å—çš„ config ç›®å½•ä¸­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021058604.png\" alt=\"image-20231102105838113\" /></p>\n<p>å¯åŠ¨æœåŠ¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021102864.png\" alt=\"image-20231102110215950\" /></p>\n<p>å¯ä»¥çœ‹åˆ°æœåŠ¡å°±è‡ªåŠ¨çš„æ³¨å†Œåˆ°äº†æ‰§è¡Œå™¨ä¸­äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021102303.png\" alt=\"image-20231102110243545\" /></p>\n<p>ç‚¹å‡» æŸ¥çœ‹ (1)</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021104929.png\" alt=\"image-20231102110416038\" /></p>\n<p>æ‰§è¡Œå™¨æ‰§è¡Œä»»åŠ¡</p>\n<p>ä» xxl-job-2.3.1 é¡¹ç›®ä¸­å…ˆæ¥æ‹¿åˆ°ä¸€ä¸ªä¾‹å­å°±æ˜¯å¦‚ä¸‹ä»£ç ï¼š</p>\n<p>E:\\ å­¦æˆåœ¨çº¿é¡¹ç›® â€” èµ„æ–™ \\day06 æ–­ç‚¹ç»­ä¼  xxl-job\\ èµ„æ–™ \\xxl-job-2.3.1\\xxl-job-executor-samples\\xxl-job-executor-sample-springboot\\src\\main\\java\\com\\xxl\\job\\executor\\service\\jobhandler\\SampleXxlJob.java</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021117873.png\" alt=\"image-20231102111700620\" /></p>\n<p>ç„¶åå°†è¿™ä¸ªä»£ç ï¼Œæ‹·è´åˆ°è‡ªå·±é¡¹ç›®çš„æ¨¡å—çš„ service ä¸šåŠ¡ä¸­ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * XxlJob å¼€å‘ç¤ºä¾‹ï¼ˆBean æ¨¡å¼ï¼‰</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * å¼€å‘æ­¥éª¤ï¼š</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> *      1ã€ä»»åŠ¡å¼€å‘ï¼šåœ¨ Spring Bean å®ä¾‹ä¸­ï¼Œå¼€å‘ Job æ–¹æ³•ï¼›</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> *      2ã€æ³¨è§£é…ç½®ï¼šä¸º Job æ–¹æ³•æ·»åŠ æ³¨è§£ \"@XxlJob (value=\" è‡ªå®šä¹‰ jobhandler åç§° \", init =\"JobHandler åˆå§‹åŒ–æ–¹æ³• \", destroy =\"JobHandler é”€æ¯æ–¹æ³• \")\"ï¼Œæ³¨è§£ value å€¼å¯¹åº”çš„æ˜¯è°ƒåº¦ä¸­å¿ƒæ–°å»ºä»»åŠ¡çš„ JobHandler å±æ€§çš„å€¼ã€‚</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> *      3ã€æ‰§è¡Œæ—¥å¿—ï¼šéœ€è¦é€šè¿‡ \"XxlJobHelper.log\" æ‰“å°æ‰§è¡Œæ—¥å¿—ï¼›</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> *      4ã€ä»»åŠ¡ç»“æœï¼šé»˜è®¤ä»»åŠ¡ç»“æœä¸º \"æˆåŠŸ\" çŠ¶æ€ï¼Œä¸éœ€è¦ä¸»åŠ¨è®¾ç½®ï¼›å¦‚æœ‰è¯‰æ±‚ï¼Œæ¯”å¦‚è®¾ç½®ä»»åŠ¡ç»“æœä¸ºå¤±è´¥ï¼Œå¯ä»¥é€šè¿‡ \"XxlJobHelper.handleFail/handleSuccess\" è‡ªä¸»è®¾ç½®ä»»åŠ¡ç»“æœï¼›</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * @author xuxueli 2019-12-11 21:52:51</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SampleXxlJob</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Logger</span> logger <span class=\"token operator\">=</span> <span class=\"token class-name\">LoggerFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLogger</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SampleXxlJob</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>     * 1ã€ç®€å•ä»»åŠ¡ç¤ºä¾‹ï¼ˆBean æ¨¡å¼ï¼‰</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token annotation punctuation\">@XxlJob</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"demoJobHandler\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">demoJobHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è§†é¢‘å¤„ç†...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">// default success</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021118433.png\" alt=\"image-20231102111804565\" /></p>\n<p>ç„¶åå°±å¯ä»¥åœ¨è¿™é‡Œé¢æ¥ç¼–å†™è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ä»£ç äº†ã€‚</p>\n<p>é‚£ä¹ˆè¿™ä¸ªä»»åŠ¡æ‰§è¡Œå™¨ä¸­çš„ä»»åŠ¡æ€ä¹ˆæ‰§è¡Œå‘¢ï¼Œæˆ‘ä»¬éœ€è¦åˆ°æ§åˆ¶å°ä¸­çš„æ‰§è¡Œä»»åŠ¡ä¸­è¿›è¡Œé…ç½®ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021127816.png\" alt=\"image-20231102112746770\" /></p>\n<p>å…¶ä¸­çš„ bean æŒ‡çš„å°±æ˜¯ æ‰§è¡Œä»»åŠ¡ ä¸šåŠ¡é€»è¾‘ä»£ç ä¸­æ³¨å…¥çš„ bean åç§°</p>\n<p>ä¹Ÿå¯ä»¥é€‰æ‹©å…¶å®ƒçš„æ¯”å¦‚ Java é‚£ä¹ˆå³è¾¹çš„æ¡†å°±ä¸èƒ½è¾“å…¥äº†ï¼Œä¸‹é¢å°±æ˜¯è¾“å…¥è¦æ‰§è¡Œçš„ Java ä»£ç ã€‚</p>\n<p>æå®Œä¸Šé¢çš„åå°±é‡å¯åç«¯æœåŠ¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021132541.png\" alt=\"image-20231102113214411\" /></p>\n<p>å¯åŠ¨æœåŠ¡åé‚£ ä»»åŠ¡æ€ä¹ˆæ‰§è¡Œå‘¢ï¼Œæˆ‘ä»¬éœ€è¦ ï¼Œåœ¨æ§åˆ¶å° ä¸­ ä»»åŠ¡ç®¡ç†çš„ ä»»åŠ¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021133078.png\" alt=\"image-20231102113310041\" /></p>\n<p>å¯åŠ¨åå°±å¯ä»¥çœ‹åˆ°æ¯éš” 5 ç§’åç«¯æ§åˆ¶å°å°±ä¼šæ‰“å°å‡ºä¸€å¥è¯</p>\n<pre><code>c.xxl.job.core.executor.XxlJobExecutor   : &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job regist JobThread success, jobId:2, handler:com.xxl.job.core.handler.impl.MethodJobHandler@1dcca426[class com.xuecheng.media.service.jobhandler.SampleXxlJob#demoJobHandler]\nè§†é¢‘å¤„ç†...\nè§†é¢‘å¤„ç†...\nè§†é¢‘å¤„ç†...\nè§†é¢‘å¤„ç†...\nè§†é¢‘å¤„ç†...\nè§†é¢‘å¤„ç†...\n</code></pre>\n<p>åœ¨è¿è¡ŒæŠ¥è¡¨ä¸­å¯ä»¥çœ‹åˆ°è°ƒåº¦æƒ…å†µå¦‚ä¸‹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021136278.png\" alt=\"image-20231102113642675\" /></p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "è®¡ç®—æœºå­¦ç§‘",
                "åŸºç¡€",
                "springcloud"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/sentinel/sentinel%E8%A7%84%E5%88%99%E6%8C%81%E4%B9%85%E5%8C%96/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/sentinel/sentinel%E8%A7%84%E5%88%99%E6%8C%81%E4%B9%85%E5%8C%96/",
            "title": "Sentinelè§„åˆ™æŒä¹…åŒ–",
            "date_published": "2024-01-06T02:53:16.074Z",
            "content_html": "<h1 id=\"sentinel-è§„åˆ™æŒä¹…åŒ–\"><a class=\"anchor\" href=\"#sentinel-è§„åˆ™æŒä¹…åŒ–\">#</a> Sentinel è§„åˆ™æŒä¹…åŒ–</h1>\n<h2 id=\"ä¸€-ä¿®æ”¹order-serviceæœåŠ¡\"><a class=\"anchor\" href=\"#ä¸€-ä¿®æ”¹order-serviceæœåŠ¡\">#</a> ä¸€ã€ä¿®æ”¹ order-service æœåŠ¡</h2>\n<p>ä¿®æ”¹ OrderServiceï¼Œè®©å…¶ç›‘å¬ Nacos ä¸­çš„ sentinel è§„åˆ™é…ç½®ã€‚</p>\n<p>å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<h3 id=\"1å¼•å…¥ä¾èµ–\"><a class=\"anchor\" href=\"#1å¼•å…¥ä¾èµ–\">#</a> 1. å¼•å…¥ä¾èµ–</h3>\n<p>åœ¨ order-service ä¸­å¼•å…¥ sentinel ç›‘å¬ nacos çš„ä¾èµ–ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.csp<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>sentinel-datasource-nacos<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h3 id=\"2é…ç½®nacosåœ°å€\"><a class=\"anchor\" href=\"#2é…ç½®nacosåœ°å€\">#</a> 2. é…ç½® nacos åœ°å€</h3>\n<p>åœ¨ order-service ä¸­çš„ application.yml æ–‡ä»¶é…ç½® nacos åœ°å€åŠç›‘å¬çš„é…ç½®ä¿¡æ¯ï¼š</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">sentinel</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token key atrule\">flow</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>          <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span> <span class=\"token comment\"># nacos åœ°å€</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token key atrule\">dataId</span><span class=\"token punctuation\">:</span> orderservice<span class=\"token punctuation\">-</span>flow<span class=\"token punctuation\">-</span>rules</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token key atrule\">groupId</span><span class=\"token punctuation\">:</span> SENTINEL_GROUP</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token key atrule\">rule-type</span><span class=\"token punctuation\">:</span> flow <span class=\"token comment\"># è¿˜å¯ä»¥æ˜¯ï¼šdegradeã€authorityã€param-flow</span></pre></td></tr></table></figure><h2 id=\"äºŒ-ä¿®æ”¹sentinel-dashboardæºç \"><a class=\"anchor\" href=\"#äºŒ-ä¿®æ”¹sentinel-dashboardæºç \">#</a> äºŒã€ä¿®æ”¹ sentinel-dashboard æºç </h2>\n<p>SentinelDashboard é»˜è®¤ä¸æ”¯æŒ nacos çš„æŒä¹…åŒ–ï¼Œéœ€è¦ä¿®æ”¹æºç ã€‚</p>\n<h3 id=\"1-è§£å‹\"><a class=\"anchor\" href=\"#1-è§£å‹\">#</a> 1. è§£å‹</h3>\n<p>è§£å‹è¯¾å‰èµ„æ–™ä¸­çš„ sentinel æºç åŒ…ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644436.png\" alt=\"image-20210618201340086\" /></p>\n<p>ç„¶åå¹¶ç”¨ IDEA æ‰“å¼€è¿™ä¸ªé¡¹ç›®ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644159.png\" alt=\"image-20210618201412878\" /></p>\n<h3 id=\"2-ä¿®æ”¹nacosä¾èµ–\"><a class=\"anchor\" href=\"#2-ä¿®æ”¹nacosä¾èµ–\">#</a> 2. ä¿®æ”¹ nacos ä¾èµ–</h3>\n<p>åœ¨ sentinel-dashboard æºç çš„ pom æ–‡ä»¶ä¸­ï¼Œnacos çš„ä¾èµ–é»˜è®¤çš„ scope æ˜¯ testï¼Œåªèƒ½åœ¨æµ‹è¯•æ—¶ä½¿ç”¨ï¼Œè¿™é‡Œè¦å»é™¤ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644823.png\" alt=\"image-20210618201607831\" /></p>\n<p>å°† sentinel-datasource-nacos ä¾èµ–çš„ scope å»æ‰ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.csp<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>sentinel-datasource-nacos<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h3 id=\"3-æ·»åŠ nacosæ”¯æŒ\"><a class=\"anchor\" href=\"#3-æ·»åŠ nacosæ”¯æŒ\">#</a> 3. æ·»åŠ  nacos æ”¯æŒ</h3>\n<p>åœ¨ sentinel-dashboard çš„ test åŒ…ä¸‹ï¼Œå·²ç»ç¼–å†™äº†å¯¹ nacos çš„æ”¯æŒï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶æ‹·è´åˆ° main ä¸‹ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644434.png\" alt=\"image-20210618201726280\" /></p>\n<h3 id=\"4-ä¿®æ”¹nacosåœ°å€\"><a class=\"anchor\" href=\"#4-ä¿®æ”¹nacosåœ°å€\">#</a> 4. ä¿®æ”¹ nacos åœ°å€</h3>\n<p>ç„¶åï¼Œè¿˜éœ€è¦ä¿®æ”¹æµ‹è¯•ä»£ç ä¸­çš„ NacosConfig ç±»ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644320.png\" alt=\"image-20210618201912078\" /></p>\n<p>ä¿®æ”¹å…¶ä¸­çš„ nacos åœ°å€ï¼Œè®©å…¶è¯»å– application.properties ä¸­çš„é…ç½®ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644820.png\" alt=\"image-20210618202047575\" /></p>\n<p>åœ¨ sentinel-dashboard çš„ application.properties ä¸­æ·»åŠ  nacos åœ°å€é…ç½®ï¼š</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key attr-name\">nacos.addr</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">localhost:8848</span></pre></td></tr></table></figure><h3 id=\"5-é…ç½®nacosæ•°æ®æº\"><a class=\"anchor\" href=\"#5-é…ç½®nacosæ•°æ®æº\">#</a> 5. é…ç½® nacos æ•°æ®æº</h3>\n<p>å¦å¤–ï¼Œè¿˜éœ€è¦ä¿®æ”¹ com.alibaba.csp.sentinel.dashboard.controller.v2 åŒ…ä¸‹çš„ FlowControllerV2 ç±»ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644684.png\" alt=\"w\" /></p>\n<p>è®©æˆ‘ä»¬æ·»åŠ çš„ Nacos æ•°æ®æºç”Ÿæ•ˆï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644334.png\" alt=\"image-20210618202334536\" /></p>\n<h3 id=\"6-ä¿®æ”¹å‰ç«¯é¡µé¢\"><a class=\"anchor\" href=\"#6-ä¿®æ”¹å‰ç«¯é¡µé¢\">#</a> 6. ä¿®æ”¹å‰ç«¯é¡µé¢</h3>\n<p>æ¥ä¸‹æ¥ï¼Œè¿˜è¦ä¿®æ”¹å‰ç«¯é¡µé¢ï¼Œæ·»åŠ ä¸€ä¸ªæ”¯æŒ nacos çš„èœå•ã€‚</p>\n<p>ä¿®æ”¹ src/main/webapp/resources/app/scripts/directives/sidebar/ ç›®å½•ä¸‹çš„ sidebar.html æ–‡ä»¶ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644086.png\" alt=\"image-20210618202433356\" /></p>\n<p>å°†å…¶ä¸­çš„è¿™éƒ¨åˆ†æ³¨é‡Šæ‰“å¼€ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644031.png\" alt=\"image-20210618202449881\" /></p>\n<p>ä¿®æ”¹å…¶ä¸­çš„æ–‡æœ¬ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644504.png\" alt=\"image-20210618202501928\" /></p>\n<h3 id=\"7-é‡æ–°ç¼–è¯‘-æ‰“åŒ…é¡¹ç›®\"><a class=\"anchor\" href=\"#7-é‡æ–°ç¼–è¯‘-æ‰“åŒ…é¡¹ç›®\">#</a> 7. é‡æ–°ç¼–è¯‘ã€æ‰“åŒ…é¡¹ç›®</h3>\n<p>è¿è¡Œ IDEA ä¸­çš„ maven æ’ä»¶ï¼Œç¼–è¯‘å’Œæ‰“åŒ…ä¿®æ”¹å¥½çš„ Sentinel-Dashboardï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644941.png\" alt=\"image-20210618202701492\" /></p>\n<h3 id=\"8å¯åŠ¨\"><a class=\"anchor\" href=\"#8å¯åŠ¨\">#</a> 8. å¯åŠ¨</h3>\n<p>å¯åŠ¨æ–¹å¼è·Ÿå®˜æ–¹ä¸€æ ·ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">java</span> <span class=\"token parameter variable\">-jar</span> sentinel-dashboard.jar</pre></td></tr></table></figure><p>å¦‚æœè¦ä¿®æ”¹ nacos åœ°å€ï¼Œéœ€è¦æ·»åŠ å‚æ•°ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">java</span> <span class=\"token parameter variable\">-jar</span> <span class=\"token parameter variable\">-Dnacos.addr</span><span class=\"token operator\">=</span>localhost:8848 sentinel-dashboard.jar</pre></td></tr></table></figure>",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "springcloud-é«˜çº§",
                "sentinel",
                "è®¡ç®—æœºå­¦ç§‘",
                "springcloud",
                "Sentinel",
                "æŒä¹…åŒ–"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/seata/seata%E7%9A%84%E9%83%A8%E7%BD%B2%E5%92%8C%E9%9B%86%E6%88%90/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/seata/seata%E7%9A%84%E9%83%A8%E7%BD%B2%E5%92%8C%E9%9B%86%E6%88%90/",
            "title": "seataçš„éƒ¨ç½²å’Œé›†æˆ",
            "date_published": "2024-01-06T02:51:53.386Z",
            "content_html": "<h1 id=\"seataçš„éƒ¨ç½²å’Œé›†æˆ\"><a class=\"anchor\" href=\"#seataçš„éƒ¨ç½²å’Œé›†æˆ\">#</a> seata çš„éƒ¨ç½²å’Œé›†æˆ</h1>\n<h1 id=\"ä¸€-éƒ¨ç½²seataçš„tc-server\"><a class=\"anchor\" href=\"#ä¸€-éƒ¨ç½²seataçš„tc-server\">#</a> ä¸€ã€éƒ¨ç½² Seata çš„ tc-server</h1>\n<h2 id=\"1ä¸‹è½½\"><a class=\"anchor\" href=\"#1ä¸‹è½½\">#</a> 1. ä¸‹è½½</h2>\n<p>é¦–å…ˆæˆ‘ä»¬è¦ä¸‹è½½ seata-server åŒ…ï¼Œåœ°å€åœ¨<span class=\"exturl\" data-url=\"aHR0cDovL3NlYXRhLmlvL3poLWNuL2Jsb2cvZG93bmxvYWQuaHRtbA==\"> http</span><span class=\"exturl\" data-url=\"aHR0cDovL3NlYXRhLmlvL3poLWNuL2Jsb2cvZG93bmxvYWQuaHRtbA==\">ğŸ˜•/seata.io/zh-cn/blog/download</span><span class=\"exturl\" data-url=\"aHR0cDovL3NlYXRhLmlvL3poLWNuL2Jsb2cvZG93bmxvYWQuaHRtbA==\">.</span><span class=\"exturl\" data-url=\"aHR0cDovL3NlYXRhLmlvL3poLWNuL2Jsb2cvZG93bmxvYWQuaHRtbA==\">html</span></p>\n<p>å½“ç„¶ï¼Œè¯¾å‰èµ„æ–™ä¹Ÿå‡†å¤‡å¥½äº†ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180750149.png\" alt=\"image-20210622202357640\" /></p>\n<h2 id=\"2è§£å‹\"><a class=\"anchor\" href=\"#2è§£å‹\">#</a> 2. è§£å‹</h2>\n<p>åœ¨éä¸­æ–‡ç›®å½•è§£å‹ç¼©è¿™ä¸ª zip åŒ…ï¼Œå…¶ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180750336.png\" alt=\"image-20210622202515014\" /></p>\n<h2 id=\"3ä¿®æ”¹é…ç½®\"><a class=\"anchor\" href=\"#3ä¿®æ”¹é…ç½®\">#</a> 3. ä¿®æ”¹é…ç½®</h2>\n<p>ä¿®æ”¹ conf ç›®å½•ä¸‹çš„ registry.conf æ–‡ä»¶ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180750504.png\" alt=\"image-20210622202622874\" /></p>\n<p>å†…å®¹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key attr-name\">registry</span> <span class=\"token value attr-value\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">  # tc æœåŠ¡çš„æ³¨å†Œä¸­å¿ƒç±»ï¼Œè¿™é‡Œé€‰æ‹© nacosï¼Œä¹Ÿå¯ä»¥æ˜¯ eurekaã€zookeeper ç­‰</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key attr-name\">  type</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"nacos\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key attr-name\">  nacos</span> <span class=\"token value attr-value\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">    # seata tc æœåŠ¡æ³¨å†Œåˆ° nacos çš„æœåŠ¡åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key attr-name\">    application</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"seata-tc-server\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key attr-name\">    serverAddr</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"127.0.0.1:8848\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token key attr-name\">    group</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"DEFAULT_GROUP\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token key attr-name\">    namespace</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token key attr-name\">    cluster</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"SH\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token key attr-name\">    username</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"nacos\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token key attr-name\">    password</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"nacos\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  &#125;</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>&#125;</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token key attr-name\">config</span> <span class=\"token value attr-value\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">  # è¯»å– tc æœåŠ¡ç«¯çš„é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼Œè¿™é‡Œæ˜¯ä» nacos é…ç½®ä¸­å¿ƒè¯»å–ï¼Œè¿™æ ·å¦‚æœ tc æ˜¯é›†ç¾¤ï¼Œå¯ä»¥å…±äº«é…ç½®</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token key attr-name\">  type</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"nacos\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">  # é…ç½® nacos åœ°å€ç­‰ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token key attr-name\">  nacos</span> <span class=\"token value attr-value\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token key attr-name\">    serverAddr</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"127.0.0.1:8848\"</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token key attr-name\">    namespace</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token key attr-name\">    group</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"SEATA_GROUP\"</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token key attr-name\">    username</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"nacos\"</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token key attr-name\">    password</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"nacos\"</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token key attr-name\">    dataId</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"seataServer.properties\"</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  &#125;</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>&#125;</pre></td></tr></table></figure><p>Seata-1.7.0 ç‰ˆæœ¬çš„é…ç½®å¦‚ä¸‹ï¼š</p>\n<p>æ‰¾åˆ° yml é…ç½®æ–‡ä»¶</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180927758.png\" alt=\"image-20231018092704361\" /></p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">7091</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> seata<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key atrule\">logging</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span> classpath<span class=\"token punctuation\">:</span>logback<span class=\"token punctuation\">-</span>spring.xml</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">file</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span>user.home<span class=\"token punctuation\">&#125;</span>/logs/seata</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">extend</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">logstash-appender</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token key atrule\">destination</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">4560</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">kafka-appender</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token key atrule\">bootstrap-servers</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">9092</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token key atrule\">topic</span><span class=\"token punctuation\">:</span> logback_to_logstash</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token key atrule\">console</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token key atrule\">user</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> seata</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> seata</pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token key atrule\">seata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token comment\"># support: nacos, consul, apollo, zk, etcd3</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token comment\"># æ”¹è¿™é‡Œä¼šæŠ¥é”™</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> SEATA_GROUP</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token comment\">##if use MSE Nacos with auth, mutex with username/password attribute</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token comment\">#access-key: \"\"</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token comment\">#secret-key: \"\"</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token key atrule\">data-id</span><span class=\"token punctuation\">:</span> seataServer.properties</pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>  <span class=\"token key atrule\">registry</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token comment\"># support: nacos, eureka, redis, zk, consul, etcd3, sofa</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token key atrule\">preferred-networks</span><span class=\"token punctuation\">:</span> 30.240.*</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span> seata<span class=\"token punctuation\">-</span>tc<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> DEFAULT_GROUP</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token key atrule\">cluster</span><span class=\"token punctuation\">:</span> SH</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>      <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>      <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>      <span class=\"token comment\">##if use MSE Nacos with auth, mutex with username/password attribute</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>      <span class=\"token comment\">#access-key: \"\"</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>      <span class=\"token comment\">#secret-key: \"\"</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>  <span class=\"token key atrule\">store</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token comment\"># support: file ã€ db ã€ redis</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token key atrule\">mode</span><span class=\"token punctuation\">:</span> db</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token key atrule\">db</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>      <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span> druid</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>      <span class=\"token key atrule\">db-type</span><span class=\"token punctuation\">:</span> mysql</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>      <span class=\"token key atrule\">driver-class-name</span><span class=\"token punctuation\">:</span> com.mysql.cj.jdbc.Driver</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>      <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> jdbc<span class=\"token punctuation\">:</span>mysql<span class=\"token punctuation\">:</span>//127.0.0.1<span class=\"token punctuation\">:</span>13306/seata<span class=\"token punctuation\">?</span>useUnicode=true<span class=\"token important\">&amp;rewriteBatchedStatements=true&amp;serverTimezone=GMT</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>      <span class=\"token key atrule\">user</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>      <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> dkx.</pre></td></tr><tr><td data-num=\"65\"></td><td><pre>      <span class=\"token key atrule\">min-conn</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>      <span class=\"token key atrule\">max-conn</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>      <span class=\"token key atrule\">global-table</span><span class=\"token punctuation\">:</span> global_table</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>      <span class=\"token key atrule\">branch-table</span><span class=\"token punctuation\">:</span> branch_table</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>      <span class=\"token key atrule\">lock-table</span><span class=\"token punctuation\">:</span> lock_table</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>      <span class=\"token key atrule\">distributed-lock-table</span><span class=\"token punctuation\">:</span> distributed_lock</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>      <span class=\"token key atrule\">query-limit</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>      <span class=\"token key atrule\">max-wait</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5000</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token comment\">#  server:</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token comment\">#    service-port: 8091 #If not configured, the default is '$&#123;server.port&#125; + 1000'</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>  <span class=\"token key atrule\">security</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    <span class=\"token key atrule\">secretKey</span><span class=\"token punctuation\">:</span> SeataSecretKey0c382ef121d778043159209298fd40bf3850a017</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    <span class=\"token key atrule\">tokenValidityInMilliseconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1800000</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>    <span class=\"token key atrule\">ignore</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>      <span class=\"token key atrule\">urls</span><span class=\"token punctuation\">:</span> /<span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.css</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.js</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.html</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.map</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.svg</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.png</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.ico</span><span class=\"token punctuation\">,</span>/console<span class=\"token punctuation\">-</span>fe/public/<span class=\"token important\">**</span><span class=\"token punctuation\">,</span>/api/v1/auth/login</pre></td></tr></table></figure><h2 id=\"4åœ¨nacosæ·»åŠ é…ç½®\"><a class=\"anchor\" href=\"#4åœ¨nacosæ·»åŠ é…ç½®\">#</a> 4. åœ¨ nacos æ·»åŠ é…ç½®</h2>\n<p>ç‰¹åˆ«æ³¨æ„ï¼Œä¸ºäº†è®© tc æœåŠ¡çš„é›†ç¾¤å¯ä»¥å…±äº«é…ç½®ï¼Œæˆ‘ä»¬é€‰æ‹©äº† nacos ä½œä¸ºç»Ÿä¸€é…ç½®ä¸­å¿ƒã€‚å› æ­¤æœåŠ¡ç«¯é…ç½®æ–‡ä»¶ seataServer.properties æ–‡ä»¶éœ€è¦åœ¨ nacos ä¸­é…å¥½ã€‚</p>\n<p>æ ¼å¼å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180750398.png\" alt=\"image-20210622203609227\" /></p>\n<p>é…ç½®å†…å®¹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œdb ä»£è¡¨æ•°æ®åº“</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key attr-name\">store.mode</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">db</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key attr-name\">store.db.datasource</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">druid</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key attr-name\">store.db.dbType</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">mysql</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key attr-name\">store.db.driverClassName</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">com.mysql.jdbc.Driver</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key attr-name\">store.db.url</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">jdbc:mysql://127.0.0.1:3306/seata?useUnicode=true&amp;rewriteBatchedStatements=true</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key attr-name\">store.db.user</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">root</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key attr-name\">store.db.password</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">123</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token key attr-name\">store.db.minConn</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">5</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token key attr-name\">store.db.maxConn</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">30</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token key attr-name\">store.db.globalTable</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">global_table</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token key attr-name\">store.db.branchTable</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">branch_table</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token key attr-name\">store.db.queryLimit</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">100</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token key attr-name\">store.db.lockTable</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">lock_table</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token key attr-name\">store.db.maxWait</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">5000</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># äº‹åŠ¡ã€æ—¥å¿—ç­‰é…ç½®</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token key attr-name\">server.recovery.committingRetryPeriod</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">1000</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token key attr-name\">server.recovery.asynCommittingRetryPeriod</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">1000</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token key attr-name\">server.recovery.rollbackingRetryPeriod</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">1000</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token key attr-name\">server.recovery.timeoutRetryPeriod</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">1000</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token key attr-name\">server.maxCommitRetryTimeout</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">-1</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token key attr-name\">server.maxRollbackRetryTimeout</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">-1</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token key attr-name\">server.rollbackRetryTimeoutUnlockEnable</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token key attr-name\">server.undo.logSaveDays</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">7</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token key attr-name\">server.undo.logDeletePeriod</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">86400000</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\"># å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¼ è¾“æ–¹å¼</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token key attr-name\">transport.serialization</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">seata</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token key attr-name\">transport.compressor</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">none</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\"># å…³é—­ metrics åŠŸèƒ½ï¼Œæé«˜æ€§èƒ½</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token key attr-name\">metrics.enabled</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token key attr-name\">metrics.registryType</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">compact</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token key attr-name\">metrics.exporterList</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">prometheus</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token key attr-name\">metrics.exporterPrometheusPort</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">9898</span></pre></td></tr></table></figure><p><mark>å…¶ä¸­çš„æ•°æ®åº“åœ°å€ã€ç”¨æˆ·åã€å¯†ç éƒ½éœ€è¦ä¿®æ”¹æˆä½ è‡ªå·±çš„æ•°æ®åº“ä¿¡æ¯ã€‚</mark></p>\n<h2 id=\"5åˆ›å»ºæ•°æ®åº“è¡¨\"><a class=\"anchor\" href=\"#5åˆ›å»ºæ•°æ®åº“è¡¨\">#</a> 5. åˆ›å»ºæ•°æ®åº“è¡¨</h2>\n<p>ç‰¹åˆ«æ³¨æ„ï¼štc æœåŠ¡åœ¨ç®¡ç†åˆ†å¸ƒå¼äº‹åŠ¡æ—¶ï¼Œéœ€è¦è®°å½•äº‹åŠ¡ç›¸å…³æ•°æ®åˆ°æ•°æ®åº“ä¸­ï¼Œä½ éœ€è¦æå‰åˆ›å»ºå¥½è¿™äº›è¡¨ã€‚</p>\n<p>æ–°å»ºä¸€ä¸ªåä¸º seata çš„æ•°æ®åº“ï¼Œè¿è¡Œè¯¾å‰èµ„æ–™æä¾›çš„ sql æ–‡ä»¶ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180750346.png\" alt=\"image-20210622204145159\" /></p>\n<p>è¿™äº›è¡¨ä¸»è¦è®°å½•å…¨å±€äº‹åŠ¡ã€åˆ†æ”¯äº‹åŠ¡ã€å…¨å±€é”ä¿¡æ¯ï¼š</p>\n<pre><code class=\"language-mysql\">\nSET NAMES utf8mb4;\nSET FOREIGN_KEY_CHECKS = 0;\n\n-- ----------------------------\n-- åˆ†æ”¯äº‹åŠ¡è¡¨\n-- ----------------------------\nDROP TABLE IF EXISTS `branch_table`;\nCREATE TABLE `branch_table`  (\n  `branch_id` bigint(20) NOT NULL,\n  `xid` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,\n  `transaction_id` bigint(20) NULL DEFAULT NULL,\n  `resource_group_id` varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n  `resource_id` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n  `branch_type` varchar(8) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n  `status` tinyint(4) NULL DEFAULT NULL,\n  `client_id` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n  `application_data` varchar(2000) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n  `gmt_create` datetime(6) NULL DEFAULT NULL,\n  `gmt_modified` datetime(6) NULL DEFAULT NULL,\n  PRIMARY KEY (`branch_id`) USING BTREE,\n  INDEX `idx_xid`(`xid`) USING BTREE\n) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;\n\n-- ----------------------------\n-- å…¨å±€äº‹åŠ¡è¡¨\n-- ----------------------------\nDROP TABLE IF EXISTS `global_table`;\nCREATE TABLE `global_table`  (\n  `xid` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,\n  `transaction_id` bigint(20) NULL DEFAULT NULL,\n  `status` tinyint(4) NOT NULL,\n  `application_id` varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n  `transaction_service_group` varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n  `transaction_name` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n  `timeout` int(11) NULL DEFAULT NULL,\n  `begin_time` bigint(20) NULL DEFAULT NULL,\n  `application_data` varchar(2000) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n  `gmt_create` datetime NULL DEFAULT NULL,\n  `gmt_modified` datetime NULL DEFAULT NULL,\n  PRIMARY KEY (`xid`) USING BTREE,\n  INDEX `idx_gmt_modified_status`(`gmt_modified`, `status`) USING BTREE,\n  INDEX `idx_transaction_id`(`transaction_id`) USING BTREE\n) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;\n\nSET FOREIGN_KEY_CHECKS = 1;\n</code></pre>\n<h2 id=\"6å¯åŠ¨tcæœåŠ¡\"><a class=\"anchor\" href=\"#6å¯åŠ¨tcæœåŠ¡\">#</a> 6. å¯åŠ¨ TC æœåŠ¡</h2>\n<p>è¿›å…¥ bin ç›®å½•ï¼Œè¿è¡Œå…¶ä¸­çš„ seata-server.bat å³å¯ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180750008.png\" alt=\"image-20210622205427318\" /></p>\n<p>å¯åŠ¨æˆåŠŸåï¼Œseata-server åº”è¯¥å·²ç»æ³¨å†Œåˆ° nacos æ³¨å†Œä¸­å¿ƒäº†ã€‚</p>\n<p>æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® nacos åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4ODQ4\">http://localhost:8848</span>ï¼Œç„¶åè¿›å…¥æœåŠ¡åˆ—è¡¨é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ° seata-tc-server çš„ä¿¡æ¯ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180750053.png\" alt=\"image-20210622205901450\" /></p>\n<h1 id=\"äºŒ-å¾®æœåŠ¡é›†æˆseata\"><a class=\"anchor\" href=\"#äºŒ-å¾®æœåŠ¡é›†æˆseata\">#</a> äºŒã€å¾®æœåŠ¡é›†æˆ seata</h1>\n<h2 id=\"1å¼•å…¥ä¾èµ–\"><a class=\"anchor\" href=\"#1å¼•å…¥ä¾èµ–\">#</a> 1. å¼•å…¥ä¾èµ–</h2>\n<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¾®æœåŠ¡ä¸­å¼•å…¥ seata ä¾èµ–ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-alibaba-seata<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclusions</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">&lt;!-- ç‰ˆæœ¬è¾ƒä½ï¼Œ1.3.0ï¼Œå› æ­¤æ’é™¤ --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclusion</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>seata-spring-boot-starter<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>io.seata<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclusion</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclusions</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">&lt;!--seata starter é‡‡ç”¨ 1.4.2 ç‰ˆæœ¬ --></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>io.seata<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>seata-spring-boot-starter<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>$&#123;seata.version&#125;<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h2 id=\"2ä¿®æ”¹é…ç½®æ–‡ä»¶\"><a class=\"anchor\" href=\"#2ä¿®æ”¹é…ç½®æ–‡ä»¶\">#</a> 2. ä¿®æ”¹é…ç½®æ–‡ä»¶</h2>\n<p>éœ€è¦ä¿®æ”¹ application.yml æ–‡ä»¶ï¼Œæ·»åŠ ä¸€äº›é…ç½®ï¼š</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">seata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">registry</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># TC æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„é…ç½®ï¼Œå¾®æœåŠ¡æ ¹æ®è¿™äº›ä¿¡æ¯å»æ³¨å†Œä¸­å¿ƒè·å– tc æœåŠ¡åœ°å€</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\"># å‚è€ƒ tc æœåŠ¡è‡ªå·±çš„ registry.conf ä¸­çš„é…ç½®</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># tc</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> DEFAULT_GROUP</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span> seata<span class=\"token punctuation\">-</span>tc<span class=\"token punctuation\">-</span>server <span class=\"token comment\"># tc æœåŠ¡åœ¨ nacos ä¸­çš„æœåŠ¡åç§°</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token key atrule\">cluster</span><span class=\"token punctuation\">:</span> SH</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token key atrule\">tx-service-group</span><span class=\"token punctuation\">:</span> seata<span class=\"token punctuation\">-</span>demo <span class=\"token comment\"># äº‹åŠ¡ç»„ï¼Œæ ¹æ®è¿™ä¸ªè·å– tc æœåŠ¡çš„ cluster åç§°</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">vgroup-mapping</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># äº‹åŠ¡ç»„ä¸ TC æœåŠ¡ cluster çš„æ˜ å°„å…³ç³»</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token key atrule\">seata-demo</span><span class=\"token punctuation\">:</span> SH</pre></td></tr></table></figure><p>è¦ä» nacos ä¸­æ‰¾åˆ°ä¸€ä¸ªæœåŠ¡ï¼Œæˆ‘éœ€è¦çŸ¥é“ä»€ä¹ˆä¿¡æ¯ã€‚</p>\n<p>æˆ‘ä»¬ä» nacos æ‰¾åˆ°ä¸€ä¸ªæœåŠ¡è‡³å°‘éœ€è¦çŸ¥é“ namespaceï¼Œgroupï¼Œapplication-name å’Œ cluster</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180945757.png\" alt=\"image-20231018094533567\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180948844.png\" alt=\"image-20231018094851842\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>nacos æœåŠ¡åç§°ç»„æˆåŒ…æ‹¬ï¼Ÿ</p>\n<ul>\n<li>namespace + group + serviceName + cluster</li>\n</ul>\n<p>seata å®¢æˆ·ç«¯è·å– tc çš„ cluster åç§°æ–¹å¼</p>\n<ul>\n<li>ä»¥ tx-group-service çš„å€¼ä¸º key åˆ° vgroupMapping ä¸­æŸ¥æ‰¾</li>\n</ul>\n</blockquote>\n<h1 id=\"ä¸‰-tcæœåŠ¡çš„é«˜å¯ç”¨å’Œå¼‚åœ°å®¹ç¾\"><a class=\"anchor\" href=\"#ä¸‰-tcæœåŠ¡çš„é«˜å¯ç”¨å’Œå¼‚åœ°å®¹ç¾\">#</a> ä¸‰ã€TC æœåŠ¡çš„é«˜å¯ç”¨å’Œå¼‚åœ°å®¹ç¾</h1>\n<h2 id=\"1æ¨¡æ‹Ÿå¼‚åœ°å®¹ç¾çš„tcé›†ç¾¤\"><a class=\"anchor\" href=\"#1æ¨¡æ‹Ÿå¼‚åœ°å®¹ç¾çš„tcé›†ç¾¤\">#</a> 1. æ¨¡æ‹Ÿå¼‚åœ°å®¹ç¾çš„ TC é›†ç¾¤</h2>\n<p>è®¡åˆ’å¯åŠ¨ä¸¤å° seata çš„ tc æœåŠ¡èŠ‚ç‚¹ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>èŠ‚ç‚¹åç§°</th>\n<th>ip åœ°å€</th>\n<th>ç«¯å£å·</th>\n<th>é›†ç¾¤åç§°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>seata</td>\n<td>127.0.0.1</td>\n<td>8091</td>\n<td>SH</td>\n</tr>\n<tr>\n<td>seata2</td>\n<td>127.0.0.1</td>\n<td>8092</td>\n<td>HZ</td>\n</tr>\n</tbody>\n</table>\n<p>ä¹‹å‰æˆ‘ä»¬å·²ç»å¯åŠ¨äº†ä¸€å° seata æœåŠ¡ï¼Œç«¯å£æ˜¯ 8091ï¼Œé›†ç¾¤åä¸º SHã€‚</p>\n<p>ç°åœ¨ï¼Œå°† seata ç›®å½•å¤åˆ¶ä¸€ä»½ï¼Œèµ·åä¸º seata2</p>\n<p>ä¿®æ”¹ seata2/conf/registry.conf å†…å®¹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">registry</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token comment\"># tc æœåŠ¡çš„æ³¨å†Œä¸­å¿ƒç±»ï¼Œè¿™é‡Œé€‰æ‹© nacosï¼Œä¹Ÿå¯ä»¥æ˜¯ eurekaã€zookeeper ç­‰</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token directive\"><span class=\"token keyword\">type</span> = <span class=\"token string\">\"nacos\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  nacos</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\"># seata tc æœåŠ¡æ³¨å†Œåˆ° nacos çš„æœåŠ¡åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    application = \"seata-tc-server\"</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    serverAddr = \"127.0.0.1:8848\"</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    group = \"DEFAULT_GROUP\"</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    namespace = \"\"</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    cluster = \"HZ\"</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    username = \"nacos\"</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    password = \"nacos\"</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">config</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token comment\"># è¯»å– tc æœåŠ¡ç«¯çš„é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼Œè¿™é‡Œæ˜¯ä» nacos é…ç½®ä¸­å¿ƒè¯»å–ï¼Œè¿™æ ·å¦‚æœ tc æ˜¯é›†ç¾¤ï¼Œå¯ä»¥å…±äº«é…ç½®</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token directive\"><span class=\"token keyword\">type</span> = <span class=\"token string\">\"nacos\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token comment\"># é…ç½® nacos åœ°å€ç­‰ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  nacos</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    serverAddr = \"127.0.0.1:8848\"</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    namespace = \"\"</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    group = \"SEATA_GROUP\"</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    username = \"nacos\"</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    password = \"nacos\"</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    dataId = \"seataServer.properties\"</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Seata-1.7.0 ç‰ˆæœ¬çš„é…ç½®å¦‚ä¸‹ï¼š</p>\n<p>æ‰¾åˆ° yml é…ç½®æ–‡ä»¶</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181958636.png\" alt=\"image-20231018092704361\" /></p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">7091</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> seata<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key atrule\">logging</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span> classpath<span class=\"token punctuation\">:</span>logback<span class=\"token punctuation\">-</span>spring.xml</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">file</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span>user.home<span class=\"token punctuation\">&#125;</span>/logs/seata</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">extend</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">logstash-appender</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token key atrule\">destination</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">4560</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">kafka-appender</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token key atrule\">bootstrap-servers</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">9092</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token key atrule\">topic</span><span class=\"token punctuation\">:</span> logback_to_logstash</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token key atrule\">console</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token key atrule\">user</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> seata</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> seata</pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token key atrule\">seata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token comment\"># support: nacos, consul, apollo, zk, etcd3</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token comment\"># æ”¹è¿™é‡Œä¼šæŠ¥é”™</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> SEATA_GROUP</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token comment\">##if use MSE Nacos with auth, mutex with username/password attribute</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token comment\">#access-key: \"\"</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token comment\">#secret-key: \"\"</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token key atrule\">data-id</span><span class=\"token punctuation\">:</span> seataServer.properties</pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>  <span class=\"token key atrule\">registry</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token comment\"># support: nacos, eureka, redis, zk, consul, etcd3, sofa</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token key atrule\">preferred-networks</span><span class=\"token punctuation\">:</span> 30.240.*</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span> seata<span class=\"token punctuation\">-</span>tc<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> DEFAULT_GROUP</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token key atrule\">cluster</span><span class=\"token punctuation\">:</span> HZ <span class=\"token comment\"># ä¿®æ”¹é›†ç¾¤åœ°å€</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>      <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>      <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>      <span class=\"token comment\">##if use MSE Nacos with auth, mutex with username/password attribute</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>      <span class=\"token comment\">#access-key: \"\"</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>      <span class=\"token comment\">#secret-key: \"\"</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"56\"></td><td><pre>  <span class=\"token key atrule\">store</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token comment\"># support: file ã€ db ã€ redis</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token key atrule\">mode</span><span class=\"token punctuation\">:</span> db</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token key atrule\">db</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>      <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span> druid</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>      <span class=\"token key atrule\">db-type</span><span class=\"token punctuation\">:</span> mysql</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>      <span class=\"token key atrule\">driver-class-name</span><span class=\"token punctuation\">:</span> com.mysql.cj.jdbc.Driver</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>      <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> jdbc<span class=\"token punctuation\">:</span>mysql<span class=\"token punctuation\">:</span>//127.0.0.1<span class=\"token punctuation\">:</span>13306/seata<span class=\"token punctuation\">?</span>useUnicode=true<span class=\"token important\">&amp;rewriteBatchedStatements=true&amp;serverTimezone=GMT</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>      <span class=\"token key atrule\">user</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"65\"></td><td><pre>      <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> dkx.</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>      <span class=\"token key atrule\">min-conn</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>      <span class=\"token key atrule\">max-conn</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>      <span class=\"token key atrule\">global-table</span><span class=\"token punctuation\">:</span> global_table</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>      <span class=\"token key atrule\">branch-table</span><span class=\"token punctuation\">:</span> branch_table</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>      <span class=\"token key atrule\">lock-table</span><span class=\"token punctuation\">:</span> lock_table</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>      <span class=\"token key atrule\">distributed-lock-table</span><span class=\"token punctuation\">:</span> distributed_lock</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>      <span class=\"token key atrule\">query-limit</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>      <span class=\"token key atrule\">max-wait</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5000</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token comment\">#  server:</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token comment\">#    service-port: 8091 #If not configured, the default is '$&#123;server.port&#125; + 1000'</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>  <span class=\"token key atrule\">security</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    <span class=\"token key atrule\">secretKey</span><span class=\"token punctuation\">:</span> SeataSecretKey0c382ef121d778043159209298fd40bf3850a017</pre></td></tr><tr><td data-num=\"78\"></td><td><pre>    <span class=\"token key atrule\">tokenValidityInMilliseconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1800000</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>    <span class=\"token key atrule\">ignore</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>      <span class=\"token key atrule\">urls</span><span class=\"token punctuation\">:</span> /<span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.css</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.js</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.html</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.map</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.svg</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.png</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.ico</span><span class=\"token punctuation\">,</span>/console<span class=\"token punctuation\">-</span>fe/public/<span class=\"token important\">**</span><span class=\"token punctuation\">,</span>/api/v1/auth/login</pre></td></tr></table></figure><p>è¿›å…¥ seata2/bin ç›®å½•ï¼Œç„¶åè¿è¡Œå‘½ä»¤ï¼š</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>seata-server<span class=\"token punctuation\">.</span>bat <span class=\"token operator\">-</span>p 8092</pre></td></tr></table></figure><p>1.7.0 ç‰ˆæœ¬å®åœ¨ä¸è¡Œå°±é…ç½®æ–‡ä»¶é‡Œä¿®æ”¹ç«¯å£å·</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310182005822.png\" alt=\"image-20231018200503303\" /></p>\n<p>æ‰“å¼€ nacos æ§åˆ¶å°ï¼ŒæŸ¥çœ‹æœåŠ¡åˆ—è¡¨ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180750772.png\" alt=\"image-20210624151150840\" /></p>\n<p>ç‚¹è¿›è¯¦æƒ…æŸ¥çœ‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180750333.png\" alt=\"image-20210624151221747\" /></p>\n<h2 id=\"2å°†äº‹åŠ¡ç»„æ˜ å°„é…ç½®åˆ°nacos\"><a class=\"anchor\" href=\"#2å°†äº‹åŠ¡ç»„æ˜ å°„é…ç½®åˆ°nacos\">#</a> 2. å°†äº‹åŠ¡ç»„æ˜ å°„é…ç½®åˆ° nacos</h2>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å°† tx-service-group ä¸ cluster çš„æ˜ å°„å…³ç³»éƒ½é…ç½®åˆ° nacos é…ç½®ä¸­å¿ƒã€‚</p>\n<p>æ–°å»ºä¸€ä¸ªé…ç½®ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180751774.png\" alt=\"image-20210624151507072\" /></p>\n<p>é…ç½®çš„å†…å®¹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># äº‹åŠ¡ç»„æ˜ å°„å…³ç³»</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key attr-name\">service.vgroupMapping.seata-demo</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">SH</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key attr-name\">service.enableDegrade</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key attr-name\">service.disableGlobalTransaction</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># ä¸ TC æœåŠ¡çš„é€šä¿¡é…ç½®</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key attr-name\">transport.type</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">TCP</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key attr-name\">transport.server</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">NIO</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token key attr-name\">transport.heartbeat</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">true</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token key attr-name\">transport.enableClientBatchSendRequest</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token key attr-name\">transport.threadFactory.bossThreadPrefix</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">NettyBoss</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token key attr-name\">transport.threadFactory.workerThreadPrefix</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">NettyServerNIOWorker</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token key attr-name\">transport.threadFactory.serverExecutorThreadPrefix</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">NettyServerBizHandler</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token key attr-name\">transport.threadFactory.shareBossWorker</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token key attr-name\">transport.threadFactory.clientSelectorThreadPrefix</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">NettyClientSelector</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token key attr-name\">transport.threadFactory.clientSelectorThreadSize</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">1</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token key attr-name\">transport.threadFactory.clientWorkerThreadPrefix</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">NettyClientWorkerThread</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token key attr-name\">transport.threadFactory.bossThreadSize</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">1</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token key attr-name\">transport.threadFactory.workerThreadSize</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">default</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token key attr-name\">transport.shutdown.wait</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">3</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\"># RM é…ç½®</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token key attr-name\">client.rm.asyncCommitBufferLimit</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">10000</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token key attr-name\">client.rm.lock.retryInterval</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">10</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token key attr-name\">client.rm.lock.retryTimes</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">30</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token key attr-name\">client.rm.lock.retryPolicyBranchRollbackOnConflict</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">true</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token key attr-name\">client.rm.reportRetryCount</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">5</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token key attr-name\">client.rm.tableMetaCheckEnable</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token key attr-name\">client.rm.tableMetaCheckerInterval</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">60000</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token key attr-name\">client.rm.sqlParserType</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">druid</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token key attr-name\">client.rm.reportSuccessEnable</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token key attr-name\">client.rm.sagaBranchRegisterEnable</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\"># TM é…ç½®</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token key attr-name\">client.tm.commitRetryCount</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">5</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token key attr-name\">client.tm.rollbackRetryCount</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">5</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token key attr-name\">client.tm.defaultGlobalTransactionTimeout</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">60000</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token key attr-name\">client.tm.degradeCheck</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token key attr-name\">client.tm.degradeCheckAllowTimes</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">10</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token key attr-name\">client.tm.degradeCheckPeriod</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">2000</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\"># undo æ—¥å¿—é…ç½®</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token key attr-name\">client.undo.dataValidation</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">true</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token key attr-name\">client.undo.logSerialization</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">jackson</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token key attr-name\">client.undo.onlyCareUpdateColumns</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">true</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token key attr-name\">client.undo.logTable</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">undo_log</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token key attr-name\">client.undo.compress.enable</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">true</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token key attr-name\">client.undo.compress.type</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">zip</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token key attr-name\">client.undo.compress.threshold</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">64k</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token key attr-name\">client.log.exceptionRate</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">100</span></pre></td></tr></table></figure><h2 id=\"3å¾®æœåŠ¡è¯»å–nacosé…ç½®\"><a class=\"anchor\" href=\"#3å¾®æœåŠ¡è¯»å–nacosé…ç½®\">#</a> 3. å¾®æœåŠ¡è¯»å– nacos é…ç½®</h2>\n<p>æ¥ä¸‹æ¥ï¼Œéœ€è¦ä¿®æ”¹æ¯ä¸€ä¸ªå¾®æœåŠ¡çš„ application.yml æ–‡ä»¶ï¼Œè®©å¾®æœåŠ¡è¯»å– nacos ä¸­çš„ client.properties æ–‡ä»¶ï¼š</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">seata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> SEATA_GROUP <span class=\"token comment\"># è¿™é‡Œå’Œ nacos æ·»åŠ é…ç½®æ–‡ä»¶ä¸­çš„ group è¦ä¸€è‡´</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">data-id</span><span class=\"token punctuation\">:</span> client.properties</pre></td></tr></table></figure><p>é‡å¯å¾®æœåŠ¡ï¼Œç°åœ¨å¾®æœåŠ¡åˆ°åº•æ˜¯è¿æ¥ tc çš„ SH é›†ç¾¤ï¼Œè¿˜æ˜¯ tc çš„ HZ é›†ç¾¤ï¼Œéƒ½ç»Ÿä¸€ç”± nacos çš„ client.properties æ¥å†³å®šäº†ã€‚</p>\n<p>8092</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310182016810.png\" alt=\"image-20231018201640218\" /></p>\n<p>7091</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310182017126.png\" alt=\"image-20231018201658572\" /></p>\n<p>å¯ä»¥çœ‹åˆ° 8092 æ²¡æœ‰ä»»ä½•äººæ³¨å†Œï¼Œè€Œæ˜¯éƒ½æ³¨å†Œåˆ°äº† 7091 ä¸Šäº†</p>\n<p>æˆ‘ä»¬å» nacos æ§åˆ¶å°ä¸­å¯¹åˆšæ‰åˆ›å»ºçš„é…ç½®æ–‡ä»¶çš„é›†ç¾¤åœ°å€è¿›è¡Œä¿®æ”¹ä¸ºï¼šHZ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310182019284.png\" alt=\"image-20231018201902967\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310182019735.png\" alt=\"image-20231018201919714\" /></p>\n<p>åœ¨ 8092 çš„ seata å¯åŠ¨çª—å£å°±å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>\n<p>æ­¤æ—¶æœåŠ¡å°±å…¨éƒ¨éƒ½åˆ‡æ¢åˆ°äº† 8092 è¿™ä¸ª seata æœåŠ¡ä¸Šäº†ï¼Œ7091 å°±æ²¡ç”¨äº†ç”šè‡³äºåœæ‰ä¹Ÿæ²¡æœ‰é—®é¢˜</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310182027851.png\" alt=\"image-20231018202705207\" /></p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "springcloud-é«˜çº§",
                "seata",
                "è®¡ç®—æœºå­¦ç§‘",
                "springcloud",
                "éƒ¨ç½²",
                "Seata"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/canal/%E5%AE%89%E8%A3%85Canal/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/canal/%E5%AE%89%E8%A3%85Canal/",
            "title": "å®‰è£…å’Œé…ç½®Canal",
            "date_published": "2024-01-06T02:51:08.278Z",
            "content_html": "<h1 id=\"å®‰è£…å’Œé…ç½®canal\"><a class=\"anchor\" href=\"#å®‰è£…å’Œé…ç½®canal\">#</a> å®‰è£…å’Œé…ç½® Canal</h1>\n<p>ä¸‹é¢æˆ‘ä»¬å°±å¼€å¯ mysql çš„ä¸»ä»åŒæ­¥æœºåˆ¶ï¼Œè®© Canal æ¥æ¨¡æ‹Ÿ salve</p>\n<h1 id=\"1å¼€å¯mysqlä¸»ä»\"><a class=\"anchor\" href=\"#1å¼€å¯mysqlä¸»ä»\">#</a> 1. å¼€å¯ MySQL ä¸»ä»</h1>\n<p>Canal æ˜¯åŸºäº MySQL çš„ä¸»ä»åŒæ­¥åŠŸèƒ½ï¼Œå› æ­¤å¿…é¡»å…ˆå¼€å¯ MySQL çš„ä¸»ä»åŠŸèƒ½æ‰å¯ä»¥ã€‚</p>\n<p>è¿™é‡Œä»¥ä¹‹å‰ç”¨ Docker è¿è¡Œçš„ mysql ä¸ºä¾‹ï¼š</p>\n<h2 id=\"11å¼€å¯binlog\"><a class=\"anchor\" href=\"#11å¼€å¯binlog\">#</a> 1.1. å¼€å¯ binlog</h2>\n<p>æ‰“å¼€ mysql å®¹å™¨æŒ‚è½½çš„æ—¥å¿—æ–‡ä»¶ï¼Œæˆ‘çš„åœ¨ <code>/tmp/mysql/conf</code>  ç›®å½•:</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310210931806.png\" alt=\"image-20210813153241537\" /></p>\n<p>ä¿®æ”¹æ–‡ä»¶ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vi</span> /tmp/mysql/conf/my.cnf</pre></td></tr></table></figure><p>æ·»åŠ å†…å®¹ï¼š</p>\n<figure class=\"highlight ini\"><figcaption data-lang=\"ini\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key attr-name\">log-bin</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">/var/lib/mysql/mysql-bin</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># æ•°æ®åº“åç§°</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key attr-name\">binlog-do-db</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">dkx</span></pre></td></tr></table></figure><p>é…ç½®è§£è¯»ï¼š</p>\n<ul>\n<li><code>log-bin=/var/lib/mysql/mysql-bin</code> ï¼šè®¾ç½® binary log æ–‡ä»¶çš„å­˜æ”¾åœ°å€å’Œæ–‡ä»¶åï¼Œå«åš mysql-bin</li>\n<li><code>binlog-do-db=dkx</code> ï¼šæŒ‡å®šå¯¹å“ªä¸ª database è®°å½• binary log eventsï¼Œè¿™é‡Œè®°å½• heima è¿™ä¸ªåº“</li>\n</ul>\n<p>æœ€ç»ˆæ•ˆæœï¼š</p>\n<figure class=\"highlight ini\"><figcaption data-lang=\"ini\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token section\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">mysqld</span><span class=\"token punctuation\">]</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>skip-name-resolve</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key attr-name\">character_set_server</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">utf8</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key attr-name\">datadir</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">/var/lib/mysql</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key attr-name\">server-id</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">1000</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key attr-name\">log-bin</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">/var/lib/mysql/mysql-bin</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key attr-name\">binlog-do-db</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">dkx</span></pre></td></tr></table></figure><p>é‡å¯ mysql</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> restart mysql</pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å›¾ä¸­å‡ºç°äº†æŒ‡å®šæ–‡ä»¶è¡¨ç¤ºæˆåŠŸï¼</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211007103.png\" alt=\"image-20231021100731994\" /></p>\n<h2 id=\"12è®¾ç½®ç”¨æˆ·æƒé™\"><a class=\"anchor\" href=\"#12è®¾ç½®ç”¨æˆ·æƒé™\">#</a> 1.2. è®¾ç½®ç”¨æˆ·æƒé™</h2>\n<p>æ¥ä¸‹æ¥æ·»åŠ ä¸€ä¸ªä»…ç”¨äºæ•°æ®åŒæ­¥çš„è´¦æˆ·ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œè¿™é‡Œä»…æä¾›å¯¹ heima è¿™ä¸ªåº“çš„æ“ä½œæƒé™ã€‚</p>\n<pre><code class=\"language-mysql\">create user canal@'%' IDENTIFIED by 'canal';\nGRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT,SUPER ON *.* TO 'canal'@'%' identified by 'canal';\nFLUSH PRIVILEGES;\n</code></pre>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">USER</span> canal IDENTIFIED <span class=\"token keyword\">BY</span> <span class=\"token string\">'canal'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">GRANT</span> <span class=\"token keyword\">SELECT</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">REPLICATION</span> SLAVE<span class=\"token punctuation\">,</span> <span class=\"token keyword\">REPLICATION</span> CLIENT <span class=\"token keyword\">ON</span> <span class=\"token punctuation\">.</span> <span class=\"token keyword\">TO</span> <span class=\"token string\">'canal'</span><span class=\"token variable\">@'%'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">GRANT</span> <span class=\"token keyword\">ALL</span> <span class=\"token keyword\">PRIVILEGES</span> <span class=\"token keyword\">ON</span> <span class=\"token punctuation\">.</span> <span class=\"token keyword\">TO</span> <span class=\"token string\">'canal'</span><span class=\"token variable\">@'%'</span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>FLUSH <span class=\"token keyword\">PRIVILEGES</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>mysql 8.0.2 å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">USER</span> canal IDENTIFIED <span class=\"token keyword\">BY</span> <span class=\"token string\">'canal'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">GRANT</span> <span class=\"token keyword\">SELECT</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">SHOW</span> <span class=\"token keyword\">VIEW</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">REPLICATION</span> SLAVE<span class=\"token punctuation\">,</span> <span class=\"token keyword\">REPLICATION</span> CLIENT <span class=\"token keyword\">ON</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> <span class=\"token keyword\">TO</span> <span class=\"token string\">'canal'</span><span class=\"token variable\">@'%'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>FLUSH <span class=\"token keyword\">PRIVILEGES</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>é‡å¯ mysql å®¹å™¨å³å¯</p>\n<pre><code>docker restart mysql\n</code></pre>\n<p>æµ‹è¯•è®¾ç½®æ˜¯å¦æˆåŠŸï¼šåœ¨ mysql æ§åˆ¶å°ï¼Œæˆ–è€… Navicat ä¸­ï¼Œè¾“å…¥å‘½ä»¤ï¼š</p>\n<pre><code>show master status;\n</code></pre>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211015054.png\" alt=\"image-20231021101552134\" /></p>\n<h1 id=\"2å®‰è£…canal\"><a class=\"anchor\" href=\"#2å®‰è£…canal\">#</a> 2. å®‰è£… Canal</h1>\n<h2 id=\"21åˆ›å»ºç½‘ç»œ\"><a class=\"anchor\" href=\"#21åˆ›å»ºç½‘ç»œ\">#</a> 2.1. åˆ›å»ºç½‘ç»œ</h2>\n<p>æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç½‘ç»œï¼Œå°† MySQLã€Canalã€MQ æ”¾åˆ°åŒä¸€ä¸ª Docker ç½‘ç»œä¸­ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> network create dkx</pre></td></tr></table></figure><p>è®© mysql åŠ å…¥è¿™ä¸ªç½‘ç»œï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> network connect dkx mysql</pre></td></tr></table></figure><h2 id=\"23å®‰è£…canal\"><a class=\"anchor\" href=\"#23å®‰è£…canal\">#</a> 2.3. å®‰è£… Canal</h2>\n<p>è¯¾å‰èµ„æ–™ä¸­æä¾›äº† canal çš„é•œåƒå‹ç¼©åŒ…:</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211145229.png\" alt=\"image-20210813161804292\" /></p>\n<p>å¤§å®¶å¯ä»¥ä¸Šä¼ åˆ°è™šæ‹Ÿæœºï¼Œç„¶åé€šè¿‡å‘½ä»¤å¯¼å…¥ï¼š</p>\n<pre><code>docker load -i canal.tar\n</code></pre>\n<p>ç„¶åè¿è¡Œå‘½ä»¤åˆ›å»º Canal å®¹å™¨ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-p</span> <span class=\"token number\">11111</span>:11111 <span class=\"token parameter variable\">--name</span> canal <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">canal.destinations</span><span class=\"token operator\">=</span>dkx1 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">canal.instance.master.address</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.249.128:3306  <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">canal.instance.dbUsername</span><span class=\"token operator\">=</span>canal  <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">canal.instance.dbPassword</span><span class=\"token operator\">=</span>canal  <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">canal.instance.connectionCharset</span><span class=\"token operator\">=</span>UTF-8 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">canal.instance.tsdb.enable</span><span class=\"token operator\">=</span>true <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">canal.instance.gtidon</span><span class=\"token operator\">=</span>false  <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">canal.instance.filter.regex</span><span class=\"token operator\">=</span>dkx<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">\\</span><span class=\"token punctuation\">..</span>* <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token parameter variable\">--network</span> dkx1 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token parameter variable\">-d</span> canal/canal-server:v1.1.5</pre></td></tr></table></figure><p>è¯´æ˜:</p>\n<ul>\n<li><code>-p 11111:11111</code> ï¼šè¿™æ˜¯ canal çš„é»˜è®¤ç›‘å¬ç«¯å£</li>\n<li><code>-e canal.instance.master.address=mysql:3306</code> ï¼šæ•°æ®åº“åœ°å€ (åŒä¸€ç½‘ç»œå¯ä»¥ä½¿ç”¨å®¹å™¨åäº’è”) å’Œç«¯å£ï¼Œå¦‚æœä¸çŸ¥é“ mysql å®¹å™¨åœ°å€ï¼Œå¯ä»¥é€šè¿‡ <code>docker inspect å®¹å™¨id</code>  æ¥æŸ¥çœ‹</li>\n<li><code>-e canal.instance.dbUsername=canal</code> ï¼šæ•°æ®åº“ç”¨æˆ·å</li>\n<li><code>-e canal.instance.dbPassword=canal</code>  ï¼šæ•°æ®åº“å¯†ç </li>\n<li><code>-e canal.instance.filter.regex=</code> ï¼šè¦ç›‘å¬çš„è¡¨åç§°</li>\n</ul>\n<p>è¡¨åç§°ç›‘å¬æ”¯æŒçš„è¯­æ³•ï¼š</p>\n<pre><code>mysql æ•°æ®è§£æå…³æ³¨çš„è¡¨ï¼ŒPerlæ­£åˆ™è¡¨è¾¾å¼.\nå¤šä¸ªæ­£åˆ™ä¹‹é—´ä»¥é€—å·(,)åˆ†éš”ï¼Œè½¬ä¹‰ç¬¦éœ€è¦åŒæ–œæ (\\\\) \nå¸¸è§ä¾‹å­ï¼š\n1.  æ‰€æœ‰è¡¨ï¼š.*   or  .*\\\\..*\n2.  canal schemaä¸‹æ‰€æœ‰è¡¨ï¼š canal\\\\..*\n3.  canalä¸‹çš„ä»¥canalæ‰“å¤´çš„è¡¨ï¼šcanal\\\\.canal.*\n4.  canal schemaä¸‹çš„ä¸€å¼ è¡¨ï¼šcanal.test1\n5.  å¤šä¸ªè§„åˆ™ç»„åˆä½¿ç”¨ç„¶åä»¥é€—å·éš”å¼€ï¼šcanal\\\\..*,mysql.test1,mysql.test2 \n</code></pre>\n<p>æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼ŒæŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸäº†ï¼š</p>\n<pre><code class=\"language-shÂ·\">[root@localhost tmp]# docker logs -f canal\nDOCKER_DEPLOY_TYPE=VM\n==&gt; INIT /alidata/init/02init-sshd.sh\n==&gt; EXIT CODE: 0\n==&gt; INIT /alidata/init/fix-hosts.py\n==&gt; EXIT CODE: 0\n==&gt; INIT DEFAULT\nGenerating SSH1 RSA host key: [  OK  ]\nStarting sshd: [  OK  ]\nStarting crond: [  OK  ]\n==&gt; INIT DONE\n==&gt; RUN /home/admin/app.sh\n==&gt; START ...\nstart canal ...\nstart canal successful\n==&gt; START SUCCESSFUL ...\n</code></pre>\n<p>æŸ¥çœ‹ canal æ˜¯å¦ä¸ mysql è¿›è¡Œå»ºç«‹è¿æ¥äº†</p>\n<p>æ­¥éª¤ï¼š</p>\n<p>1ã€è¿›å…¥ canal å†…éƒ¨</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost tmp<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker exec -it canal bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@a02803287608 admin<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>2ã€ä½¿ç”¨å‘½ä»¤ç›‘æ§ canal çš„æ—¥å¿—ä¿¡æ¯</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@a02803287608 admin<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>total <span class=\"token number\">8</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>-rwxr-xr-x. <span class=\"token number\">1</span> admin admin <span class=\"token number\">3941</span> Apr <span class=\"token number\">19</span>  <span class=\"token number\">2021</span> app.sh</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>drwxr-xr-x. <span class=\"token number\">2</span> admin admin   <span class=\"token number\">43</span> Apr <span class=\"token number\">19</span>  <span class=\"token number\">2021</span> bin</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>drwxr-xr-x. <span class=\"token number\">1</span> admin admin   <span class=\"token number\">66</span> Apr <span class=\"token number\">19</span>  <span class=\"token number\">2021</span> canal-server</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>-rwxr-xr-x. <span class=\"token number\">1</span> admin admin  <span class=\"token number\">670</span> Apr <span class=\"token number\">19</span>  <span class=\"token number\">2021</span> health.sh</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>lrwxrwxrwx. <span class=\"token number\">1</span> admin admin   <span class=\"token number\">44</span> Apr <span class=\"token number\">19</span>  <span class=\"token number\">2021</span> node_exporter -<span class=\"token operator\">></span> /home/admin/node_exporter-0.18.1.linux-arm64</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>drwxr-xr-x. <span class=\"token number\">2</span> admin admin   <span class=\"token number\">56</span> Jun  <span class=\"token number\">5</span>  <span class=\"token number\">2019</span> node_exporter-0.18.1.linux-arm64</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@a02803287608 admin<span class=\"token punctuation\">]</span><span class=\"token comment\"># tail -f canal-server/logs/canal/canal.log</span></pre></td></tr></table></figure><p>æ‰“å°æ—¥å¿—å¦‚ä¸‹</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">2023</span>-10-21 <span class=\"token number\">10</span>:31:37.324 <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  com.alibaba.otter.canal.deployer.CanalLauncher - <span class=\"token comment\">## set default uncaught exception handler</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">2023</span>-10-21 <span class=\"token number\">10</span>:31:37.376 <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  com.alibaba.otter.canal.deployer.CanalLauncher - <span class=\"token comment\">## load canal configurations</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2023</span>-10-21 <span class=\"token number\">10</span>:31:37.392 <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  com.alibaba.otter.canal.deployer.CanalStarter - <span class=\"token comment\">## start the canal server.</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">2023</span>-10-21 <span class=\"token number\">10</span>:31:37.466 <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  com.alibaba.otter.canal.deployer.CanalController - <span class=\"token comment\">## start the canal server[172.22.0.3(172.22.0.3):11111]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">2023</span>-10-21 <span class=\"token number\">10</span>:31:39.126 <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  com.alibaba.otter.canal.deployer.CanalStarter - <span class=\"token comment\">## the canal server is running now ......</span></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å¯åŠ¨æ²¡ä»€ä¹ˆé—®é¢˜</p>\n<p>æŸ¥çœ‹ mysql è¿æ¥çš„æ—¥å¿—</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@a02803287608 admin<span class=\"token punctuation\">]</span><span class=\"token comment\"># tail -f canal-server/logs/dkx1/dkx1.log</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">find</span> start position successfully, EntryPosition<span class=\"token punctuation\">[</span>included<span class=\"token operator\">=</span>false,journalName<span class=\"token operator\">=</span>mysql-bin.000006,position<span class=\"token operator\">=</span><span class=\"token number\">4</span>,serverId<span class=\"token operator\">=</span><span class=\"token number\">1000</span>,gtid<span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>null<span class=\"token operator\">></span>,timestamp<span class=\"token operator\">=</span><span class=\"token number\">1697857809000</span><span class=\"token punctuation\">]</span> cost <span class=\"token builtin class-name\">:</span> 521ms , the next step is binlog dump</pre></td></tr></table></figure>",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "springcloud-é«˜çº§",
                "canal",
                "è®¡ç®—æœºå­¦ç§‘",
                "åŸºç¡€",
                "springcloud",
                "Canal"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/OpenResty/%E5%AE%89%E8%A3%85OpenResty/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/OpenResty/%E5%AE%89%E8%A3%85OpenResty/",
            "title": "å®‰è£…OpenResty",
            "date_published": "2024-01-06T02:48:59.643Z",
            "content_html": "<h1 id=\"å®‰è£…openresty\"><a class=\"anchor\" href=\"#å®‰è£…openresty\">#</a> å®‰è£… OpenResty</h1>\n<h1 id=\"1å®‰è£…\"><a class=\"anchor\" href=\"#1å®‰è£…\">#</a> 1. å®‰è£…</h1>\n<p>é¦–å…ˆä½ çš„ Linux è™šæ‹Ÿæœºå¿…é¡»è”ç½‘</p>\n<h2 id=\"1å®‰è£…å¼€å‘åº“\"><a class=\"anchor\" href=\"#1å®‰è£…å¼€å‘åº“\">#</a> <strong>1ï¼‰å®‰è£…å¼€å‘åº“</strong></h2>\n<p>é¦–å…ˆè¦å®‰è£… OpenResty çš„ä¾èµ–å¼€å‘åº“ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> pcre-devel openssl-devel gcc --skip-broken</pre></td></tr></table></figure><h2 id=\"2å®‰è£…openrestyä»“åº“\"><a class=\"anchor\" href=\"#2å®‰è£…openrestyä»“åº“\">#</a> <strong>2ï¼‰å®‰è£… OpenResty ä»“åº“</strong></h2>\n<p>ä½ å¯ä»¥åœ¨ä½ çš„ CentOS ç³»ç»Ÿä¸­æ·»åŠ   <code>openresty</code>  ä»“åº“ï¼Œè¿™æ ·å°±å¯ä»¥ä¾¿äºæœªæ¥å®‰è£…æˆ–æ›´æ–°æˆ‘ä»¬çš„è½¯ä»¶åŒ…ï¼ˆé€šè¿‡  <code>yum check-update</code>  å‘½ä»¤ï¼‰ã€‚è¿è¡Œä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥æ·»åŠ æˆ‘ä»¬çš„ä»“åº“ï¼š</p>\n<pre><code>yum-config-manager --add-repo https://openresty.org/package/centos/openresty.repo\n</code></pre>\n<p>å¦‚æœæç¤ºè¯´å‘½ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿è¡Œï¼š</p>\n<pre><code>yum install -y yum-utils \n</code></pre>\n<p>ç„¶åå†é‡å¤ä¸Šé¢çš„å‘½ä»¤</p>\n<h2 id=\"3å®‰è£…openresty\"><a class=\"anchor\" href=\"#3å®‰è£…openresty\">#</a> <strong>3ï¼‰å®‰è£… OpenResty</strong></h2>\n<p>ç„¶åå°±å¯ä»¥åƒä¸‹é¢è¿™æ ·å®‰è£…è½¯ä»¶åŒ…ï¼Œæ¯”å¦‚  <code>openresty</code> ï¼š</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> openresty</pre></td></tr></table></figure><h2 id=\"4å®‰è£…opmå·¥å…·\"><a class=\"anchor\" href=\"#4å®‰è£…opmå·¥å…·\">#</a> <strong>4ï¼‰å®‰è£… opm å·¥å…·</strong></h2>\n<p>opm æ˜¯ OpenResty çš„ä¸€ä¸ªç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®‰è£…ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„ Lua æ¨¡å—ã€‚</p>\n<p>å¦‚æœä½ æƒ³å®‰è£…å‘½ä»¤è¡Œå·¥å…·  <code>opm</code> ï¼Œé‚£ä¹ˆå¯ä»¥åƒä¸‹é¢è¿™æ ·å®‰è£…  <code>openresty-opm</code>  åŒ…ï¼š</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> openresty-opm</pre></td></tr></table></figure><h2 id=\"5ç›®å½•ç»“æ„\"><a class=\"anchor\" href=\"#5ç›®å½•ç»“æ„\">#</a> <strong>5ï¼‰ç›®å½•ç»“æ„</strong></h2>\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒOpenResty å®‰è£…çš„ç›®å½•æ˜¯ï¼š/usr/local/openresty</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200901485.png\" alt=\"image-20200310225539214\" /></p>\n<p>çœ‹åˆ°é‡Œé¢çš„ nginx ç›®å½•äº†å—ï¼ŒOpenResty å°±æ˜¯åœ¨ Nginx åŸºç¡€ä¸Šé›†æˆäº†ä¸€äº› Lua æ¨¡å—ã€‚</p>\n<h2 id=\"6é…ç½®nginxçš„ç¯å¢ƒå˜é‡\"><a class=\"anchor\" href=\"#6é…ç½®nginxçš„ç¯å¢ƒå˜é‡\">#</a> <strong>6ï¼‰é…ç½® nginx çš„ç¯å¢ƒå˜é‡</strong></h2>\n<p>æ‰“å¼€é…ç½®æ–‡ä»¶ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vi</span> /etc/profile</pre></td></tr></table></figure><p>åœ¨æœ€ä¸‹é¢åŠ å…¥ä¸¤è¡Œï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">NGINX_HOME</span><span class=\"token operator\">=</span>/usr/local/openresty/nginx</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token variable\">$&#123;NGINX_HOME&#125;</span>/sbin:<span class=\"token environment constant\">$PATH</span></pre></td></tr></table></figure><p>NGINX_HOMEï¼šåé¢æ˜¯ OpenResty å®‰è£…ç›®å½•ä¸‹çš„ nginx çš„ç›®å½•</p>\n<p>ç„¶åè®©é…ç½®ç”Ÿæ•ˆï¼š</p>\n<pre><code>source /etc/profile\n</code></pre>\n<h1 id=\"2å¯åŠ¨å’Œè¿è¡Œ\"><a class=\"anchor\" href=\"#2å¯åŠ¨å’Œè¿è¡Œ\">#</a> 2. å¯åŠ¨å’Œè¿è¡Œ</h1>\n<p>OpenResty åº•å±‚æ˜¯åŸºäº Nginx çš„ï¼ŒæŸ¥çœ‹ OpenResty ç›®å½•çš„ nginx ç›®å½•ï¼Œç»“æ„ä¸ windows ä¸­å®‰è£…çš„ nginx åŸºæœ¬ä¸€è‡´ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200901105.png\" alt=\"image-20210811100653291\" /></p>\n<p>æ‰€ä»¥è¿è¡Œæ–¹å¼ä¸ nginx åŸºæœ¬ä¸€è‡´ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># å¯åŠ¨ nginx</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>nginx</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># é‡æ–°åŠ è½½é…ç½®</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>nginx <span class=\"token parameter variable\">-s</span> reload</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># åœæ­¢</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>nginx <span class=\"token parameter variable\">-s</span> stop</pre></td></tr></table></figure><p>nginx çš„é»˜è®¤é…ç½®æ–‡ä»¶æ³¨é‡Šå¤ªå¤šï¼Œå½±å“åç»­æˆ‘ä»¬çš„ç¼–è¾‘ï¼Œè¿™é‡Œå°† nginx.conf ä¸­çš„æ³¨é‡Šéƒ¨åˆ†åˆ é™¤ï¼Œä¿ç•™æœ‰æ•ˆéƒ¨åˆ†ã€‚</p>\n<p>ä¿®æ”¹ <code>/usr/local/openresty/nginx/conf/nginx.conf</code>  æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#user  nobody;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">worker_processes</span>  <span class=\"token number\">1</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">error_log</span>  logs/error.log</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">events</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">worker_connections</span>  <span class=\"token number\">1024</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">http</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">include</span>       mime.types</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">default_type</span>  application/octet-stream</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">sendfile</span>        <span class=\"token boolean\">on</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">keepalive_timeout</span>  <span class=\"token number\">65</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">listen</span>       <span class=\"token number\">8081</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">server_name</span>  localhost</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> /</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">root</span>   html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">index</span>  index.html index.htm</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">error_page</span>   <span class=\"token number\">500</span> <span class=\"token number\">502</span> <span class=\"token number\">503</span> <span class=\"token number\">504</span>  /50x.html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> = /50x.html</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">root</span>   html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨ Linux çš„æ§åˆ¶å°è¾“å…¥å‘½ä»¤ä»¥å¯åŠ¨ nginxï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>nginx</pre></td></tr></table></figure><p>ç„¶åè®¿é—®é¡µé¢ï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTUwLjEwMTo4MDgx\">http://192.168.150.101:8081</span>ï¼Œæ³¨æ„ ip åœ°å€æ›¿æ¢ä¸ºä½ è‡ªå·±çš„è™šæ‹Ÿæœº IPï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200910980.png\" alt=\"image-20231020091008283\" /></p>\n<h1 id=\"3å¤‡æ³¨\"><a class=\"anchor\" href=\"#3å¤‡æ³¨\">#</a> 3. å¤‡æ³¨</h1>\n<p>åŠ è½½ OpenResty çš„ lua æ¨¡å—ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#lua æ¨¡å—</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">lua_package_path</span> <span class=\"token string\">\"/usr/local/openresty/lualib/?.lua;;\"</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#c æ¨¡å—     </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">lua_package_cpath</span> <span class=\"token string\">\"/usr/local/openresty/lualib/?.so;;\"</span></span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>ç›‘å¬æµè§ˆå™¨è¯·æ±‚</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">listen</span>       <span class=\"token number\">8081</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">server_name</span>  localhost</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> /api/item</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>          <span class=\"token comment\"># é»˜è®¤çš„å“åº”ç±»å‹</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>          <span class=\"token directive\"><span class=\"token keyword\">default_type</span> application/json</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>          <span class=\"token comment\"># å“åº”ç»“æœç”± lua/item.lua ä¸‹çš„æ–‡ä»¶å†³å®š</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>          <span class=\"token directive\"><span class=\"token keyword\">content_by_lua_file</span> lua/item.lua</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> /</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">root</span>   html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">index</span>  index.html index.htm</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">error_page</span>   <span class=\"token number\">500</span> <span class=\"token number\">502</span> <span class=\"token number\">503</span> <span class=\"token number\">504</span>  /50x.html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> = /50x.html</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">root</span>   html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>common.lua</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å°è£…å‡½æ•°ï¼Œå‘é€ http è¯·æ±‚ï¼Œå¹¶è§£æå“åº”</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">read_http</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">local</span> resp <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span><span class=\"token function\">capture</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        method <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>HTTP_GET<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        args <span class=\"token operator\">=</span> params<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> resp <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">-- è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œè¿”å› 404</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"http not found, path: \"</span><span class=\"token punctuation\">,</span> path <span class=\"token punctuation\">,</span> <span class=\"token string\">\", args: \"</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">404</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">return</span> resp<span class=\"token punctuation\">.</span>body</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">-- å°†æ–¹æ³•å¯¼å‡º</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">local</span> _M <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>  </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    read_http <span class=\"token operator\">=</span> read_http</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span>  </pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">return</span> _M</pre></td></tr></table></figure><p>é‡Šæ”¾ Redis è¿æ¥ APIï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å…³é—­ redis è¿æ¥çš„å·¥å…·æ–¹æ³•ï¼Œå…¶å®æ˜¯æ”¾å…¥è¿æ¥æ± </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">close_redis</span><span class=\"token punctuation\">(</span>red<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">local</span> pool_max_idle_time <span class=\"token operator\">=</span> <span class=\"token number\">10000</span> <span class=\"token comment\">-- è¿æ¥çš„ç©ºé—²æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">local</span> pool_size <span class=\"token operator\">=</span> <span class=\"token number\">100</span> <span class=\"token comment\">-- è¿æ¥æ± å¤§å°</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">local</span> ok<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> red<span class=\"token punctuation\">:</span><span class=\"token function\">set_keepalive</span><span class=\"token punctuation\">(</span>pool_max_idle_time<span class=\"token punctuation\">,</span> pool_size<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> ok <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"æ”¾å…¥redisè¿æ¥æ± å¤±è´¥: \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>è¯»å– Redis æ•°æ®çš„ APIï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢ redis çš„æ–¹æ³• ip å’Œ port æ˜¯ redis åœ°å€ï¼Œkey æ˜¯æŸ¥è¯¢çš„ key</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">read_redis</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">-- è·å–ä¸€ä¸ªè¿æ¥</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">local</span> ok<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> red<span class=\"token punctuation\">:</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> ok <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"è¿æ¥rediså¤±è´¥ : \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">nil</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">-- æŸ¥è¯¢ redis</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">local</span> resp<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> red<span class=\"token punctuation\">:</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">-- æŸ¥è¯¢å¤±è´¥å¤„ç†</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> resp <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"æŸ¥è¯¢Rediså¤±è´¥: \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">,</span> <span class=\"token string\">\", key = \"</span> <span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\">-- å¾—åˆ°çš„æ•°æ®ä¸ºç©ºå¤„ç†</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">if</span> resp <span class=\"token operator\">==</span> ngx<span class=\"token punctuation\">.</span>null <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        resp <span class=\"token operator\">=</span> <span class=\"token keyword\">nil</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"æŸ¥è¯¢Redisæ•°æ®ä¸ºç©º, key = \"</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token function\">close_redis</span><span class=\"token punctuation\">(</span>red<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">return</span> resp</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>å¼€å¯å…±äº«è¯å…¸ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># å…±äº«å­—å…¸ï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œåç§°å«åšï¼šitem_cacheï¼Œå¤§å° 150m</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">lua_shared_dict</span> item_cache <span class=\"token number\">150m</span></span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure>",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "springcloud-é«˜çº§",
                "OpenResty",
                "è®¡ç®—æœºå­¦ç§‘",
                "springcloud",
                "OpenResty"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%AB%98%E7%BA%A7%E7%AF%87/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%AB%98%E7%BA%A7%E7%AF%87/",
            "title": "SpringCloudé«˜çº§ç¯‡",
            "date_published": "2024-01-06T02:42:53.168Z",
            "content_html": "<h1 id=\"ä¸€-å¾®æœåŠ¡ä¿æŠ¤\"><a class=\"anchor\" href=\"#ä¸€-å¾®æœåŠ¡ä¿æŠ¤\">#</a> ä¸€ã€å¾®æœåŠ¡ä¿æŠ¤ğŸ„</h1>\n<ul>\n<li>Sentinel</li>\n</ul>\n<p>å­¦ä¹ å†…å®¹ï¼š</p>\n<ul>\n<li>åˆå§‹ Sentinel</li>\n<li>æµé‡æ§åˆ¶</li>\n<li>éš”ç¦»å’Œé™çº§</li>\n<li>æˆæƒè§„åˆ™</li>\n<li>è§„åˆ™æŒä¹…åŒ–</li>\n</ul>\n<h2 id=\"11-åˆå§‹sentinel\"><a class=\"anchor\" href=\"#11-åˆå§‹sentinel\">#</a> 1.1ã€åˆå§‹ SentinelğŸŒ³</h2>\n<ul>\n<li>é›ªå´©é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</li>\n<li>æœåŠ¡ä¿æŠ¤æŠ€æœ¯å¯¹æ¯”</li>\n<li>Sentinel ä»‹ç»å’Œå®‰è£…</li>\n<li>å¾®æœåŠ¡æ•´åˆ Sentinel</li>\n</ul>\n<h3 id=\"111-é›ªå´©é—®é¢˜\"><a class=\"anchor\" href=\"#111-é›ªå´©é—®é¢˜\">#</a> 1.1.1ã€é›ªå´©é—®é¢˜ğŸŒ²</h3>\n<p>å¾®æœåŠ¡è°ƒç”¨é“¾è·¯ä¸­çš„æŸä¸ªæœåŠ¡æ•…éšœï¼Œå¼•èµ·æ•´ä¸ªé“¾è·¯ä¸­çš„æ‰€æœ‰å¾®æœåŠ¡éƒ½ä¸å¯ç”¨ï¼Œè¿™å°±æ˜¯é›ªå´©ã€‚</p>\n<p><strong>åœºæ™¯</strong>ï¼š</p>\n<p>æ¯”æ–¹è¯´åœ¨æœåŠ¡ A å†…éƒ¨ä¾èµ–äºæœåŠ¡ Bï¼Œè€ŒæœåŠ¡ A å†…éƒ¨å¯èƒ½è¿˜æœ‰ä¸€äº›å…¶å®ƒçš„ä¸šåŠ¡æ¯”å¦‚è¯´å®ƒä¾èµ–äºæœåŠ¡ C æˆ–è€…æ˜¯ä¾èµ–äºæœåŠ¡ D</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161531964.png\" alt=\"image-20231016153100257\" /></p>\n<p>ç°åœ¨å‡è®¾è¯´æœåŠ¡ D å‡ºç°äº†æ•…éšœï¼Œé‚£æœåŠ¡ A å†…éƒ¨ä¾èµ–ä¸æœåŠ¡ D çš„ä¸šåŠ¡è¯·æ±‚å°±ä¸èƒ½æ­£å¸¸è®¿é—®äº†</p>\n<p>å› ä¸ºæœåŠ¡ A è®¿é—®æœåŠ¡ D å°±å¿…ç„¶è¦ç­‰å¾…æœåŠ¡ D çš„å“åº”ç»“æœï¼Œè€Œå› ä¸ºæœåŠ¡ D å‡ºç°äº†æ•…éšœä¸å¯èƒ½è¿”å›ç»“æœå®ƒä¼šé˜»å¡ï¼Œé‚£å°±å¯¼è‡´äº†æœåŠ¡ A å†…éƒ¨ä¸šåŠ¡ä¹Ÿä¼šé˜»å¡ï¼Œé˜»å¡ å®ƒå°±ä¸ä¼šé‡Šæ”¾ tomcat çš„é“¾æ¥ã€‚å½“ç„¶å…¶å®ƒä¸šåŠ¡è¯·æ±‚ä¸å—å½±å“è¿˜å¯ä»¥æ­£å¸¸å·¥ä½œã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161532119.png\" alt=\"image-20231016153207881\" /></p>\n<p>ä½†æ˜¯æ—¢ç„¶æœ‰ç¬¬ä¸€ä¸ªä¾èµ–äºæœåŠ¡ D è¿™æ ·çš„è¯·æ±‚ï¼Œé‚£ä¸€å®šè¿˜ä¼šæœ‰ç¬¬äºŒä¸ªç”šè‡³ç¬¬ä¸‰ä¸ªã€‚è¿™æ ·ä¾èµ–äºæœåŠ¡ D çš„ä¸šåŠ¡è¯·æ±‚è¶Šæ¥è¶Šå¤šï¼Œè€Œå®ƒä»¬éƒ½ä¸ä¼šé‡Šæ”¾è¿æ¥ï¼Œé‚£ä¹ˆæ—¶ä¹…ä¸€å®šä¼šæŠŠæœåŠ¡ A å†…éƒ¨æ‰€æœ‰çš„é“¾æ¥éƒ½ç»™å ç”¨äº†</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ tomcat èµ„æºè€—å°½äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161537530.png\" alt=\"image-20231016153714784\" /></p>\n<p>æ­¤æ—¶å†æœ‰æœåŠ¡è¿›æ¥å“ªæ€•ä¸æ˜¯ä¾èµ–äºæœåŠ¡ D çš„è€Œæ˜¯æœåŠ¡ B çš„ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿè¿›ä¸æ¥äº†ã€‚é‚£å°±å¯ä»¥è®¤ä¸ºæœåŠ¡ A ä¹Ÿå‡ºç°äº†æ•…éšœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161539417.png\" alt=\"image-20231016153923278\" /></p>\n<p>è¿™å°±é€ æˆäº†ä¸€ä¸ªæœåŠ¡çš„æ•…éšœå¯¼è‡´äº†ä¾èµ–äºå®ƒçš„æœåŠ¡æœ€ç»ˆä¹Ÿå‡ºç°äº†æ•…éšœã€‚åœ¨å¾®æœåŠ¡é‡Œè¿™ç§è°ƒç”¨å…³ç³»å¯ä¸æ­¢è¿™ä¹ˆç®€å•</p>\n<p>é‚£ä¹ˆæœåŠ¡ A ä¾èµ–äºæœåŠ¡ D å¯¼è‡´æœ€åç»™æœåŠ¡ D æ‹–å®äº†ï¼Œé‚£è‚¯å®šè¿˜ä¼šæœ‰å…¶å®ƒçš„æœåŠ¡ä¹Ÿä¾èµ–äºæœåŠ¡ Dï¼Œæœ€ç»ˆä¹Ÿä¼šè¢«æ‹–å®ï¼Œå°†æ¥å…¶å®ƒä¾èµ–äºæœåŠ¡ A çš„ä¹Ÿä¼šå‡ºç°æ•…éšœï¼Œæœ€ç»ˆæ•…éšœçš„æœåŠ¡è¶Šæ¥è¶Šå¤šé‚£ä¹ˆæ•´ä¸ªå¾®æœåŠ¡ç¾¤å°±ä¸å¯ç”¨äº†ã€‚</p>\n<p>è¿™ä¸å°±æ˜¯é›ªå´©äº†å—ï¼</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161541181.png\" alt=\"image-20231016154142767\" /></p>\n<h3 id=\"112-è§£å†³é›ªå´©é—®é¢˜\"><a class=\"anchor\" href=\"#112-è§£å†³é›ªå´©é—®é¢˜\">#</a> 1.1.2ã€è§£å†³é›ªå´©é—®é¢˜ğŸŒ²</h3>\n<p><strong>è§£å†³é›ªå´©é—®é¢˜çš„å¸¸è§æ–¹å¼æœ‰å››ç§</strong>ï¼š</p>\n<p>1ã€<mark>è¶…æ—¶å¤„ç†</mark>ï¼šè®¾å®šè¶…æ—¶æ—¶é—´ï¼Œè¯·æ±‚è¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰å“åº”ç»“æœå°±è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œä¸ä¼šæ— ä¼‘æ­¢ç­‰å¾…</p>\n<p>ä¼šåœ¨è°ƒç”¨ä¸šåŠ¡æ—¶åŠ ä¸Šä¸€ä¸ªè¶…æ—¶æ—¶é—´æ¯”å¦‚è¯´ 1 ç§’é’Ÿï¼Œå½“æœåŠ¡ A ä¾èµ–äºæœåŠ¡ C æ—¶è¯·æ±‚æœ€å¤šç­‰å¾… 1 ç§’é’Ÿï¼Œå¦‚æœè¯·æ±‚è¶…è¿‡ 1 ç§’é’Ÿå°±ä¼šç«‹å³ç»“æŸè¿™ä¸ªè¯·æ±‚ï¼Œä¸å†ç­‰å¾…ï¼Œè¿”å›ç»™ç”¨æˆ·æç¤ºä¿¡æ¯ (ä¸å¥½æ„æ€å¤±è´¥äº†)</p>\n<p>ç¼ºç‚¹ï¼šåªèƒ½èµ·åˆ°ç¼“è§£ä½œç”¨ï¼Œä¸èƒ½è§£å†³æ ¹æœ¬é—®é¢˜ï¼Œå› ä¸ºè¯·æ±‚é€Ÿåº¦å¤§äºç­‰å¾…æ—¶é—´å°±ä¼šå‡ºç°é—®é¢˜</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161546216.png\" alt=\"image-20231016154632246\" /></p>\n<p>2ã€<mark>èˆ±å£æ¨¡å¼</mark>ï¼šé™å®šæ¯ä¸ªä¸šåŠ¡èƒ½ä½¿ç”¨çš„çº¿ç¨‹æ•°ï¼Œé¿å…è€—å°½æ•´ä¸ª tomcat çš„èµ„æºï¼Œå› æ­¤ä¹Ÿå«çº¿ç¨‹éš”ç¦»ã€‚</p>\n<p>èˆ±å£æ¨¡å¼æ˜¯æ¥è‡ªäºç°å®ç”Ÿæ´»ä¸­çš„èˆ¹èˆ±çš„è®¾è®¡ï¼Œä¸€äº›å¤§å‹çš„è½®èˆ¹å®ƒéƒ½ä¼šæŠŠèˆ¹ä½“åˆ©ç”¨éš”æ¿åˆ†éš”æˆç‹¬ç«‹çš„å°çš„ç©ºé—´è¿™æ ·çš„éš”æ¿å°±å«åšèˆ±å£ã€‚å› ä¸ºè¿™äº›ç©ºé—´ä¹‹é—´æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œå‡è®¾è¯´èˆ¹ä½“çš„æŸä¸ªéƒ¨ä½æ’ä¸Šäº†å†°å±±æ¼æ°´äº†ã€‚é‚£ä¹ˆæœ€å¤šåªæ˜¯æŠŠéƒ¨åˆ†èˆ¹èˆ±å¡«æ»¡æ°´ï¼Œå› ä¸ºæ˜¯éš”ç¦»çš„æ‰€ä»¥å…¶å®ƒèˆ¹èˆ±ä¸å—å½±å“ã€‚è¿™æ ·å°±æé«˜äº†æ•´è‰˜èˆ¹çš„å®¹ç¾èƒ½åŠ›</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161550959.png\" alt=\"image-20231016155024959\" /></p>\n<p>è¿™ç§æ¨¡å¼å»¶ç»­åˆ°ç¨‹åºè®¾è®¡é‡Œè¾¹æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ</p>\n<p>è¿™æ˜¯æœåŠ¡ A é‡Œé¢çš„èµ„æºä¹Ÿå°±æ˜¯ tomcat å°±å¯ä»¥çœ‹åšæˆæ•´è‰˜èˆ¹ã€‚æˆ‘ä»¬å¯ä»¥æŠŠ tomcat é‡Œé¢çš„èµ„æº (çº¿ç¨‹) åˆ’åˆ†æˆä¸€ä¸ªä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ± ã€‚ç»™æ¯ä¸ªä¸šåŠ¡åˆ†é…ä¸€ä¸ªçº¿ç¨‹æ± ã€‚ç°åœ¨ä¸šåŠ¡ 1 è¿›æ¥åå®ƒä¾èµ–äºæœåŠ¡ Bï¼Œå®ƒæœ€å¤šä½¿ç”¨åä¸ªé™åˆ¶ï¼Œè®¿é—®ä¸šåŠ¡ 2 æ¯”æ–¹è¯´å®ƒä¾èµ–äºæœåŠ¡ Cï¼Œå®ƒä¹Ÿæœ€å¤šä½¿ç”¨åçº¿ç¨‹ã€‚</p>\n<p>ç°åœ¨å‡è®¾è¯´æœåŠ¡ C å‡ºç°æ•…éšœäº†ï¼Œè¿™ä¸ªä¸šåŠ¡ 2 å°±ä¼šé˜»å¡å ç”¨çº¿ç¨‹ï¼Œä½†æ˜¯å®ƒæœ€å¤šå ç”¨åä¸ªï¼Œè¿™æ—¶å®ƒèƒ½å¤Ÿä½¿ç”¨ tomcat çš„èµ„æºæ˜¯æœ‰é™çš„ï¼Œè¿™æ ·å°±æŠŠæ•…éšœéš”ç¦»åˆ°åä¸ªçº¿ç¨‹å†…äº†ï¼Œå› æ­¤ä¹Ÿå«çº¿ç¨‹éš”ç¦»ã€‚å› æ­¤å°±é¿å…äº†æ•´ä¸ª tomcat è¢«è€—å°½çš„æƒ…å†µ</p>\n<p>ç¼ºç‚¹ï¼šèµ„æºæœ‰ä¸€å®šçš„æµªè´¹ï¼Œæ¯”å¦‚è¯´æœåŠ¡ C çœŸçš„å®•æœºäº†ï¼Œç°åœ¨æ¯æ¬¡è¯·æ±‚æ¥è¿˜è®©å®ƒå°è¯•ç€å»è®¿é—®ä¸€ä¸‹æœåŠ¡ C è¿˜è¦å ç”¨åä¸ªçº¿ç¨‹ä¹Ÿæ˜¯ä¸€ç§æµªè´¹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161558553.png\" alt=\"image-20231016155848381\" /></p>\n<p>3ã€<mark>ç†”æ–­é™çº§</mark>ï¼šç”±<mark>æ–­è·¯å™¨</mark>ç»Ÿè®¡ä¸šåŠ¡æ‰§è¡Œçš„å¼‚å¸¸æ¯”ä¾‹ï¼Œå¦‚æœè¶…å‡ºé˜ˆå€¼åˆ™ä¼š<mark>ç†”æ–­</mark>è¯¥ä¸šåŠ¡ï¼Œæ‹¦æˆªè®¿é—®è¯¥ä¸šåŠ¡çš„ä¸€åˆ‡è¯·æ±‚ã€‚</p>\n<p>ç»Ÿè®¡æœåŠ¡ A é‡Œé¢çš„ä¸šåŠ¡ï¼Œæ¯”æ–¹è¯´æœåŠ¡ A é‡Œç¬¬ä¸€æ¬¡ä¸šåŠ¡è®¿é—®æ˜¯æ­£å¸¸çš„ï¼Œç»“æœåé¢ä¸¤æ¬¡éƒ½å‡ºç°äº†æ•…éšœã€‚è¿™æ—¶æ–­è·¯å™¨å°±ä¼šç»Ÿè®¡æ¯”ä¾‹ï¼Œä¸‰ä¸ªè¯·æ±‚ä¸€ä¸ªæ­£å¸¸ä¸¤ä¸ªæ•…éšœï¼Œæ•…éšœæ¯”ä¾‹é«˜è¾¾ 60%ã€‚å‡è®¾è¯´é˜ˆå€¼æ˜¯ 50% è¶…å‡ºäº†é˜ˆå€¼ï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°ç†”æ–­ã€‚</p>\n<p>ä¸€æ—¦è¢«ç†”æ–­å¦‚æœåœ¨æœåŠ¡ A å†…éƒ¨è¿˜æƒ³è¦è®¿é—®æœåŠ¡ D çš„ä¸šåŠ¡å°±æ— æ³•å†å»è®¿é—®æœåŠ¡ D äº†ï¼Œåªè¦æ˜¯è®¿é—®æœåŠ¡ D çš„ä¸šåŠ¡å°±ä¼šè¢«æ‹¦æˆª</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161606208.png\" alt=\"image-20231016160627109\" /></p>\n<p>4ã€<mark>æµé‡æ§åˆ¶</mark>ï¼šé™åˆ¶ä¸šåŠ¡è®¿é—® QPSï¼Œé¿å…æœåŠ¡å› æµé‡çš„çªå¢è€Œæ•…éšœã€‚</p>\n<p>QPSï¼šæ¯ç§’é’Ÿå¤„ç†çš„è¯·æ±‚æ•°é‡</p>\n<p>æ¯”æ–¹è¯´æœ‰ä¸€ä¸ªå¾®æœåŠ¡ï¼Œå®ƒèƒ½æ‰¿å—çš„æœ€å¤§ QPS ä¸º 2ï¼Œä¹Ÿå°±æ˜¯æ¯ç§’é’Ÿæœ€å¤šå¤„ç†ä¸¤ä¸ªè¯·æ±‚ã€‚</p>\n<p>ä½†æ˜¯ç°åœ¨æœ‰æ— æ•°ä¸ªè¯·æ±‚æ¶Œè¿‡æ¥ï¼Œå°±ä¼šå‡ºç°æ•…éšœï¼Œä¸€æ—¦è¿™ä¸ªæœåŠ¡å‡ºç°æ•…éšœï¼Œè€Œä¾èµ–äºè¿™ä¸ªæœåŠ¡çš„å…¶å®ƒæœåŠ¡ä¹Ÿå°±è·Ÿç€å‡ºç°æ•…éšœå°±ä¼šå‡ºç°é›ªå´©é—®é¢˜</p>\n<p>æ‰€ä»¥æˆ‘ä»¬è¦é¿å…æœåŠ¡å› ä¸ºæµé‡è¿‡é«˜è€Œå¼•èµ·æ•…éšœï¼Œè¿™æ—¶å°±éœ€è¦ç”¨åˆ° Sentinel äº†</p>\n<p>ç°åœ¨å‡è®¾è¯´æœ‰æ— æ•°ä¸ªè¯·æ±‚è¿‡æ¥è€Œ Sentinel å¯ä»¥æŒ‰ç…§è¿™ä¸ªæœåŠ¡æ‰€èƒ½å¤Ÿæ‰¿å—çš„é¢‘ç‡å»é‡Šæ”¾è¯·æ±‚ï¼Œè¿™æ—¶å¾®æœåŠ¡å°±èƒ½ä»å®¹åº”å¯¹è¿™äº›è¯·æ±‚äº†å°±é¿å…äº†å‡ºç°æ•…éšœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161613445.png\" alt=\"image-20231016161314587\" /></p>\n<p>æµé‡æ§åˆ¶æ˜¯é¢„é˜²é›ªå´©ï¼Œå‰é¢ä¸‰ç§æ˜¯å·²ç»æœ‰æœåŠ¡æ•…éšœäº†æˆ‘æ€ä¹ˆæ ·å»é¿å…è¿™ä¸ªæ•…éšœä¼ é€’ç»™å…¶å®ƒæœåŠ¡</p>\n<p>ä½†æ˜¯ä¹Ÿä¸èƒ½è¯´ï¼Œé‚£æˆ‘å°±åªç”¨ æµé‡æ§åˆ¶å‘—ï¼Œå…¶å®ƒçš„æˆ‘å°±ä¸ç”¨äº†ï¼Œè¿™æ ·æ˜¾ç„¶æ˜¯ä¸å¯¹çš„ã€‚</p>\n<p>å› ä¸ºé«˜å¹¶å‘å¼•èµ·çš„æœåŠ¡æ•…éšœåªæ˜¯æ•…éšœçš„åŸå› ä¹‹ä¸€ï¼Œå¾€å¾€æœåŠ¡è¿˜ä¼šå› ä¸ºå…¶å®ƒé—®é¢˜è€Œå‡ºç°æ•…éšœã€‚æ¯”æ–¹è¯´ç½‘ç»œé—®é¢˜æˆ–è€…è¯´ fgc å¼•èµ·çš„å‡æ­»é—®é¢˜ï¼Œè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°å…¶å®ƒçš„è§£å†³æ–¹æ¡ˆäº†</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>ä»€ä¹ˆæ˜¯é›ªå´©é—®é¢˜ï¼Ÿ</p>\n<ul>\n<li>å¾®æœåŠ¡ä¹‹é—´ç›¸äº’è°ƒç”¨ï¼Œå› ä¸ºè°ƒç”¨é“¾ä¸­ä¸€ä¸ªæœåŠ¡æ•…éšœï¼Œå¼•èµ·æ•´ä¸ªé“¾è·¯éƒ½æ— æ³•è®¿é—®çš„æƒ…å†µ</li>\n</ul>\n<p>å¦‚ä½•é¿å…å› ç¬é—´é«˜å¹¶å‘æµé‡è€Œå¯¼è‡´æœåŠ¡æ•…éšœï¼Ÿ</p>\n<ul>\n<li>æµé‡æ§åˆ¶</li>\n</ul>\n<p>å¦‚ä½•é¿å…å› æœåŠ¡æ•…éšœå¼•èµ·çš„é›ªå´©é—®é¢˜ï¼Ÿ</p>\n<ul>\n<li>è¶…æ—¶å¤„ç†</li>\n<li>çº¿ç¨‹éš”ç¦»</li>\n<li>é™çº§ç†”æ–­</li>\n</ul>\n</blockquote>\n<h3 id=\"113-æœåŠ¡ä¿æŠ¤æŠ€æœ¯å¯¹æ¯”\"><a class=\"anchor\" href=\"#113-æœåŠ¡ä¿æŠ¤æŠ€æœ¯å¯¹æ¯”\">#</a> 1.1.3ã€æœåŠ¡ä¿æŠ¤æŠ€æœ¯å¯¹æ¯”ğŸŒ²</h3>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Sentinel</th>\n<th>Hystrix</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>éš”ç¦»ç­–ç•¥</td>\n<td>ä¿¡å·é‡éš”ç¦»</td>\n<td>çº¿ç¨‹æ± éš”ç¦» / ä¿¡å·é‡éš”ç¦»</td>\n</tr>\n<tr>\n<td>ç†”æ–­é™çº§ç­–ç•¥</td>\n<td>åŸºäºæ…¢è°ƒç”¨æ¯”ä¾‹æˆ–å¼‚å¸¸æ¯”ä¾‹</td>\n<td>åŸºäºå¤±è´¥æ¯”ä¾‹</td>\n</tr>\n<tr>\n<td>å®æ—¶æŒ‡æ ‡å®ç°</td>\n<td>æ»‘åŠ¨çª—å£</td>\n<td>æ»‘åŠ¨çª—å£ (åŸºäº RxJava)</td>\n</tr>\n<tr>\n<td>è§„åˆ™é…ç½®</td>\n<td>æ”¯æŒå¤šç§æ•°æ®æº</td>\n<td>æ”¯æŒå¤šç§æ•°æ®æº</td>\n</tr>\n<tr>\n<td>æ‰©å±•æ€§</td>\n<td>å¤šä¸ªæ‰©å±•ç‚¹</td>\n<td>æ’ä»¶çš„å½¢å¼</td>\n</tr>\n<tr>\n<td>åŸºäºæ³¨è§£çš„æ”¯æŒ</td>\n<td>æ”¯æŒ</td>\n<td>æ”¯æŒ</td>\n</tr>\n<tr>\n<td>é™æµ</td>\n<td>åŸºäº QPSï¼Œæ”¯æŒåŸºäºè°ƒç”¨å…³ç³»çš„é™æµ</td>\n<td>æœ‰é™çš„æ”¯æŒ</td>\n</tr>\n<tr>\n<td>æµé‡æ•´å½¢</td>\n<td>æ”¯æŒæ…¢å¯åŠ¨ï¼ŒåŒ€é€Ÿæ’é˜Ÿæ¨¡å¼</td>\n<td>ä¸æ”¯æŒ</td>\n</tr>\n<tr>\n<td>ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤</td>\n<td>æ”¯æŒ</td>\n<td>ä¸æ”¯æŒ</td>\n</tr>\n<tr>\n<td>æ§åˆ¶å°</td>\n<td>å¼€ç®±å³ç”¨ï¼Œå¯é…ç½®è§„åˆ™ï¼ŒæŸ¥çœ‹ç§’çº§ç›‘æ§ï¼Œæœºå™¨å‘ç°ç­‰</td>\n<td>ä¸å®Œå–„</td>\n</tr>\n<tr>\n<td>å¸¸è§æ¡†æ¶çš„é€‚é…</td>\n<td>Servletï¼ŒSpring Cloudï¼ŒDubboï¼ŒgRPC ç­‰</td>\n<td>Servletï¼ŒSpring Cloud Netflix</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"12-è®¤è¯†sentinel\"><a class=\"anchor\" href=\"#12-è®¤è¯†sentinel\">#</a> 1.2ã€è®¤è¯† SentinelğŸŒ³</h2>\n<p>Sentinel æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€æ¬¾å¾®æœåŠ¡æµé‡æ§åˆ¶ç»„ä»¶ã€‚å®˜ç½‘åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZW50aW5lbGd1YXJkLmlvL3poLWNuLw==\">https://sentinelguard.io/zh-cn/</span></p>\n<p><strong>Sentinel å…·æœ‰ä»¥ä¸‹ç‰¹å¾</strong>ï¼š</p>\n<p>1ã€<mark>ä¸°å¯Œçš„åº”ç”¨åœºæ™¯</mark>ï¼šSentinel æ‰¿æ¥äº†é˜¿é‡Œå·´å·´è¿› 10 å¹´çš„åŒåä¸€å¤§ä¿ƒæµé‡çš„æ ¸å¿ƒåœºæ™¯ï¼Œä¾‹å¦‚ç§’æ€ (å³çªå‘æµé‡æ§åˆ¶åœ¨ç³»ç»Ÿå®¹é‡å¯ä»¥æ‰¿å—çš„èŒƒå›´)ï¼Œæ¶ˆæ¯å‰Šå³°æ·»è°·ï¼Œé›†ç¾¤æµé‡æ§åˆ¶ï¼Œå®æ—¶ç†”æ–­ä¸‹æ¸¸ä¸å¯ç”¨åº”ç”¨ç­‰ã€‚</p>\n<p>2ã€<mark>å®Œå¤‡çš„å®æ—¶ç›‘æ§</mark>ï¼šSentinel åŒæ—¶æä¾›å®æ—¶çš„ç›‘æ§åŠŸèƒ½ã€‚æ‚¨å¯ä»¥åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°æ¥å…¥åº”ç”¨çš„å•å°é›†ç¾¤ç§’çº§æ•°æ®ï¼Œç”šè‡³ 500 å°ä»¥ä¸‹è§„æ¨¡çš„é›†ç¾¤çš„æ±‡æ€»è¿è¡Œæƒ…å†µ</p>\n<p>3ã€<mark>å¹¿æ³›çš„å¼€æºç”Ÿæ€</mark>ï¼šSentinel æä¾›å¼€ç®±å³ç”¨çš„ä¸å…¶å®ƒå¼€æºæ¡†æ¶ / åº“çš„æ•´åˆæ¨¡å—ï¼Œä¾‹å¦‚ä¸ Spring cloudï¼ŒDubboï¼ŒgRPC çš„æ•´åˆã€‚æ‚¨åªéœ€è¦å¼•å…¥ç›¸åº”çš„ä¾èµ–å¹¶è¿è¡Œç®€å•çš„é…ç½®å³å¯å¿«é€Ÿçš„æ¥å…¥ Sentinel</p>\n<p>4ã€<mark>å®Œå–„çš„ SPI æ‰©å±•ç‚¹</mark>ï¼šSentinel æä¾›ç®€å•æ˜“ç”¨ï¼Œå®Œå–„çš„ SPI æ‰©å±•æ¥å£ã€‚æ‚¨å¯ä»¥é€šè¿‡å®ç°æ‰©å±•æ¥å£æ¥å¿«é€Ÿçš„å®šåˆ¶é€»è¾‘ã€‚ä¾‹å¦‚å®šåˆ¶è§„åˆ™ç®¡ç†ï¼Œé€‚é…åŠ¨æ€æ•°æ®æºç­‰ã€‚</p>\n<h3 id=\"121-å®‰è£…sentinelæ§åˆ¶å°\"><a class=\"anchor\" href=\"#121-å®‰è£…sentinelæ§åˆ¶å°\">#</a> 1.2.1ã€å®‰è£… Sentinel æ§åˆ¶å°ğŸŒ²</h3>\n<p>sentinel å®˜æ–¹æä¾›äº† UI æ§åˆ¶å°ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹ç³»ç»Ÿåšé™æµè®¾ç½®ã€‚å¤§å®¶å¯ä»¥åœ¨<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvU2VudGluZWw=\"> Github</span> ä¸‹è½½ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161747500.png\" alt=\"image-20231016174714403\" /></p>\n<p>1ã€å°†å…¶æ‹·è´åˆ°ä¸€ä¸ªéä¸­æ–‡ç›®å½•ï¼Œç„¶åè¿è¡Œå‘½ä»¤</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">java</span> <span class=\"token parameter variable\">-jar</span> sentinel-dashboard-1.8.6.jar</pre></td></tr></table></figure><p>2ã€ç„¶åè®¿é—®ï¼šlocalhost:8080 å³å¯çœ‹åˆ°æ§åˆ¶å°é¡µé¢ï¼Œé»˜è®¤çš„è´¦å·å’Œå¯†ç éƒ½æ˜¯ sentinel</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161747766.png\" alt=\"image-20231016174746831\" /></p>\n<h2 id=\"13-å®‰è£…sentinelæ§åˆ¶å°\"><a class=\"anchor\" href=\"#13-å®‰è£…sentinelæ§åˆ¶å°\">#</a> 1.3ã€å®‰è£… Sentinel æ§åˆ¶å°ğŸŒ³</h2>\n<p>å¦‚æœè¦ä¿®æ”¹ Sentinel çš„é»˜è®¤ç«¯å£ï¼Œè´¦å·ï¼Œå¯†ç ï¼Œå¯ä»¥é€šè¿‡ä¸‹åˆ—é…ç½®ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>é…ç½®é¡¹</th>\n<th>é»˜è®¤å€¼</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>server.port</td>\n<td>8080</td>\n<td>æœåŠ¡ç«¯å£</td>\n</tr>\n<tr>\n<td>sentinel.dashboard.auth.username</td>\n<td>sentinel</td>\n<td>é»˜è®¤ç”¨æˆ·å</td>\n</tr>\n<tr>\n<td>sentinel.dashboard.auth.password</td>\n<td>sentinel</td>\n<td>é»˜è®¤å¯†ç </td>\n</tr>\n</tbody>\n</table>\n<p>ä½†æ˜¯å®ƒå·²ç»æ˜¯ä¸€ä¸ª jar åŒ…äº†æ€ä¹ˆæ”¹å®ƒçš„é…ç½®æ–‡ä»¶å‘¢ï¼Ÿ</p>\n<p>ä¿®æ”¹é…ç½®æ–¹å¼ï¼š</p>\n<blockquote>\n<p>ä¸¾ä¾‹è¯´æ˜ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>sentinel-dashboard-1.8.6.jar <span class=\"token parameter variable\">-Dserver.port</span><span class=\"token operator\">=</span><span class=\"token number\">8090</span></pre></td></tr></table></figure></blockquote>\n<h2 id=\"14-å¾®æœåŠ¡ä¸sentinelæ•´åˆ\"><a class=\"anchor\" href=\"#14-å¾®æœåŠ¡ä¸sentinelæ•´åˆ\">#</a> 1.4ã€å¾®æœåŠ¡ä¸ Sentinel æ•´åˆğŸŒ³</h2>\n<h3 id=\"141-å¼•å…¥cloud-demo\"><a class=\"anchor\" href=\"#141-å¼•å…¥cloud-demo\">#</a> 1.4.1ã€å¼•å…¥ cloud-demoğŸŒ²</h3>\n<p>è¦ä½¿ç”¨ Sentinel è‚¯å®šè¦ç»“åˆå¾®æœåŠ¡ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ SpringCloud å·¥ç¨‹ï¼Œé¡¹ç›®åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZG91a2FpeGluL3R5cG9yYS5naXQ=\">https://gitee.com/doukaixin/typora.git</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161754232.png\" alt=\"image-20231016175423216\" /></p>\n<p>é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161755797.png\" alt=\"image-20231016175537988\" /></p>\n<p>å¯åŠ¨é¡¹ç›®è¿›è¡Œæµ‹è¯•çœ‹çœ‹æ˜¯å¦è¿˜å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161939226.png\" alt=\"image-20231016193950393\" /></p>\n<p>è®¿é—®é¡µé¢</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161939102.png\" alt=\"image-20231016193935669\" /></p>\n<p>ä¸€åˆ‡æ­£å¸¸åæˆ‘ä»¬å°±å¼€å§‹æ•´åˆ</p>\n<h3 id=\"142-å¾®æœåŠ¡æ•´åˆsentinel\"><a class=\"anchor\" href=\"#142-å¾®æœåŠ¡æ•´åˆsentinel\">#</a> 1.4.2ã€å¾®æœåŠ¡æ•´åˆ SentinelğŸŒ²</h3>\n<p>æˆ‘ä»¬åœ¨ order-service ä¸­æ•´åˆ Sentinelï¼Œå¹¶ä¸”é“¾æ¥ Sentinel çš„æ§åˆ¶å°ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<p>1ã€å¼•å…¥ Sentinel ä¾èµ–ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-alibaba-sentinel<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>2ã€é…ç½®æ§åˆ¶å°åœ°å€</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">sentinel</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">transport</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token key atrule\">dashboard</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8080</span></pre></td></tr></table></figure><p>3ã€è®¿é—®å¾®æœåŠ¡çš„ä»»æ„ç«¯ç‚¹ï¼Œè§¦å‘ Sentinel ç›‘æ§</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161955434.png\" alt=\"image-20231016195535390\" /></p>\n<h2 id=\"15-é™æµè§„åˆ™\"><a class=\"anchor\" href=\"#15-é™æµè§„åˆ™\">#</a> 1.5ã€é™æµè§„åˆ™ğŸŒ³</h2>\n<ul>\n<li>å¿«é€Ÿå…¥é—¨</li>\n<li>æµæ§æ¨¡å¼</li>\n<li>æµæ§æ•ˆæœ</li>\n<li>çƒ­ç‚¹å‚æ•°é™æµ</li>\n</ul>\n<h3 id=\"151-è”Ÿç‚¹é“¾è·¯\"><a class=\"anchor\" href=\"#151-è”Ÿç‚¹é“¾è·¯\">#</a> 1.5.1ã€è”Ÿç‚¹é“¾è·¯ğŸŒ²</h3>\n<p>è”Ÿç‚¹é“¾è·¯ï¼šå°±æ˜¯é¡¹ç›®å†…çš„è°ƒç”¨é“¾è·¯ï¼Œé“¾è·¯ä¸­<mark>è¢«ç›‘æ§</mark>çš„æ¯ä¸ªæ¥å£å°±æ˜¯ä¸€ä¸ªèµ„æºã€‚é»˜è®¤æƒ…å†µä¸‹ Sentinel ä¼šç›‘æ§ SpringMVC çš„æ¯ä¸€ä¸ªç«¯ç‚¹ (Endpoint)ï¼Œå› æ­¤ SpringMVC çš„æ¯ä¸€ä¸ªç«¯ç‚¹ (Endpoint)ï¼Œå°±æ˜¯è°ƒç”¨é“¾è·¯ä¸­çš„ä¸€ä¸ªèµ„æºã€‚</p>\n<p>æµæ§ï¼Œç†”æ–­ç­‰éƒ½æ˜¯<mark>é’ˆå¯¹è”Ÿç‚¹é“¾è·¯ä¸­çš„èµ„æº</mark>æ¥è®¾ç½®çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç‚¹å‡»å¯¹åº”èµ„æºåé¢çš„æŒ‰é’®æ¥è®¾ç½®è§„åˆ™ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162003730.png\" alt=\"image-20231016200306361\" /></p>\n<p>ç‚¹å‡»èµ„æº /order/{orderId} åé¢çš„æµæ§æŒ‰é’®ï¼Œå°±å¯ä»¥å¼¹å‡ºè¡¨å•ã€‚è¡¨å•ä¸­å¯ä»¥æ·»åŠ æµæ§è§„åˆ™ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162009637.png\" alt=\"image-20231016200951539\" /></p>\n<p>å…¶å«ä¹‰æ˜¯é™åˆ¶ /order/{orderId} è¿™ä¸ªèµ„æºçš„å•å‡» QPS ä¸º 1ï¼Œå³æ¯ç§’åªå…è®¸ 1 æ¬¡è¯·æ±‚ï¼Œè¶…å‡ºçš„è¯·æ±‚ä¼šè¢«æ‹¦æˆªå¹¶æŠ¥é”™ã€‚</p>\n<p>é’ˆå¯¹æ¥æºä¸­ defalt è¡¨ç¤ºä¸€åˆ‡è¯·æ±‚éƒ½é™æµ</p>\n<h4 id=\"1511-æ¡ˆä¾‹æµæ§è§„åˆ™å…¥é—¨æ¡ˆä¾‹\"><a class=\"anchor\" href=\"#1511-æ¡ˆä¾‹æµæ§è§„åˆ™å…¥é—¨æ¡ˆä¾‹\">#</a> 1.5.1.1ã€æ¡ˆä¾‹ï¼Œæµæ§è§„åˆ™å…¥é—¨æ¡ˆä¾‹ğŸŒ´</h4>\n<p><strong>éœ€æ±‚</strong>ï¼šç»™ /order/{orderId} è¿™ä¸ªèµ„æºè®¾ç½®æµæ§è§„åˆ™ï¼ŒQPS ä¸èƒ½è¶…è¿‡ 5ã€‚ç„¶ååˆ©ç”¨ jmeter æµ‹è¯•ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162014028.png\" alt=\"image-20231016201450102\" /></p>\n<p>è¿™é‡Œä½¿ç”¨ jemeter è¿›è¡Œå¹¶å‘çš„æµ‹è¯•å·¥å…·å®‰è£…æ–‡ç« ï¼š<a href=\"../Jmeter/Jmeter%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.md\">jmeter å®‰è£…åŠä½¿ç”¨</a>.</p>\n<p>æµ‹è¯•æ–‡ä»¶æ–‡ç« åœ°å€ï¼š<a href=\"../%E6%B5%8B%E8%AF%95%E6%96%87%E4%BB%B6/sentinel%E6%B5%8B%E8%AF%95.jmx\">sentinel æµ‹è¯•.jmx</a>.</p>\n<p>å¯¼å…¥åˆ° jmeter ä¸­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162035976.png\" alt=\"image-20231016203528848\" /></p>\n<p>å¦‚æœç‚¹å‡»æ²¡æœ‰ååº”å°±ç›´æ¥å°† jmx æ–‡ä»¶æ‹–åˆ°è“ç“¶å­é‡Œé¢å°±ç®—å¯¼å…¥äº†</p>\n<p>å³é”®ï¼Œæµæ§å…¥é—¨ï¼Œç‚¹å‡»å¯åŠ¨ï¼Œä¹‹åå¯ä»¥ç‚¹å‡»æŸ¥çœ‹ç»“æœæ ‘æ¥æŸ¥çœ‹è¯·æ±‚çš„æƒ…å†µ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162036099.png\" alt=\"image-20231016203617798\" /></p>\n<p>è¿™æ˜¯è®¾ç½® QPS åçš„è¯·æ±‚æƒ…å†µï¼Œæ²¡æœ‰é™æµçš„æ—¶å€™å…¨æ˜¯é€šè¿‡çš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162037652.png\" alt=\"image-20231016203706692\" /></p>\n<p>æŸ¥çœ‹æ§åˆ¶å°çš„æƒ…å†µ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162032402.png\" alt=\"image-20231016203257242\" /></p>\n<h3 id=\"152-æµæ§æ¨¡å¼\"><a class=\"anchor\" href=\"#152-æµæ§æ¨¡å¼\">#</a> 1.5.2ã€æµæ§æ¨¡å¼ğŸŒ²</h3>\n<p>åœ¨æ·»åŠ é™æµè§„åˆ™æ—¶ï¼Œç‚¹å‡»é«˜çº§é€‰é¡¹ï¼Œå¯ä»¥é€‰æ‹©ä¸‰ç§æµæ§æ¨¡å¼ï¼š</p>\n<ul>\n<li>\n<p>ç›´æ¥ï¼šç»Ÿè®¡å½“å‰èµ„æºçš„è¯·æ±‚ï¼Œè§¦å‘é˜ˆå€¼æ—¶å¯¹å½“å‰èµ„æºç›´æ¥é™æµï¼Œä¹Ÿæ˜¯é»˜è®¤çš„æ¨¡å¼</p>\n</li>\n<li>\n<p>å…³è”ï¼šç»Ÿè®¡ä¸å½“å‰èµ„æºç›¸å…³çš„å¦ä¸€ä¸ªèµ„æºï¼Œè§¦å‘é˜ˆå€¼æ—¶ï¼Œå¯¹å½“å‰èµ„æºé™æµ</p>\n<p>ä¸¤ä¸ªèµ„æºï¼ŒA è§¦å‘äº†é˜ˆå€¼ï¼Œä½†æˆ‘å´å¯¹ B åšäº†é™æµ</p>\n</li>\n<li>\n<p>é“¾è·¯ï¼šç»Ÿè®¡ä»æŒ‡å®šé“¾è·¯è®¿é—®åˆ°æœ¬èµ„æºçš„è¯·æ±‚ï¼Œè§¦å‘é˜ˆå€¼æ—¶ï¼Œå¯¹æŒ‡å®šé“¾è·¯é™æµ</p>\n</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162041214.png\" alt=\"image-20231016204109075\" /></p>\n<h4 id=\"1521-æµæ§æ¨¡å¼-å…³è”\"><a class=\"anchor\" href=\"#1521-æµæ§æ¨¡å¼-å…³è”\">#</a> 1.5.2.1ã€æµæ§æ¨¡å¼ - å…³è”ğŸŒ´</h4>\n<ul>\n<li>å…³è”æ¨¡å¼ï¼šç»Ÿè®¡ä¸å½“å‰èµ„æºç›¸å…³çš„å¦ä¸€ä¸ªèµ„æºï¼Œè§¦å‘é˜ˆå€¼æ—¶ï¼Œå¯¹å½“å‰èµ„æºé™æµ</li>\n<li>ä½¿ç”¨åœºæ™¯ï¼šæ¯”å¦‚ç”¨æˆ·æ”¯ä»˜æ—¶éœ€è¦ä¿®æ”¹è®¢å•çŠ¶æ€ï¼ŒåŒæ—¶ç”¨æˆ·è¦æŸ¥è¯¢è®¢å•ã€‚æŸ¥è¯¢å’Œä¿®æ”¹æ“ä½œä¼šäº‰æŠ¢æ•°æ®åº“é”ï¼Œäº§ç”Ÿç«äº‰ã€‚ä¸šåŠ¡éœ€æ±‚æ˜¯æœ‰é™æ”¯ä»˜å’Œæ›´æ–°è®¢å•çš„ä¸šåŠ¡ï¼Œå› æ­¤å½“ä¿®æ”¹è®¢å•ä¸šåŠ¡è§¦å‘é˜ˆå€¼æ—¶ï¼Œéœ€è¦å¯¹æŸ¥è¯¢è®¢å•ä¸šåŠ¡é™æµã€‚</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162047957.png\" alt=\"image-20231016204748747\" /></p>\n<p>å½“ /write èµ„æºè®¿é—®é‡è§¦å‘é˜ˆå€¼æ—¶ï¼Œå°±ä¼šå¯¹ /read èµ„æºé™æµï¼Œé¿å…å½±å“ /write èµ„æºã€‚</p>\n<h5 id=\"15211-æ¡ˆä¾‹æµæ§æ¨¡å¼-å…³è”\"><a class=\"anchor\" href=\"#15211-æ¡ˆä¾‹æµæ§æ¨¡å¼-å…³è”\">#</a> 1.5.2.1.1ã€æ¡ˆä¾‹ï¼Œæµæ§æ¨¡å¼ - å…³è”ğŸ‹</h5>\n<p>éœ€æ±‚ï¼š</p>\n<ul>\n<li>åœ¨ OrderController æ–°å»ºä¸¤ä¸ªç«¯ç‚¹ï¼š/order/query å’Œ /order/updateï¼Œæ— éœ€å®ç°ä¸šåŠ¡</li>\n<li>é…ç½®æµæ§è§„åˆ™ï¼Œå½“ /order/update èµ„æºè¢«è®¿é—®çš„ QPS è¶…è¿‡ 5 ä¸ªæ—¶ï¼Œå¯¹ /order/query è¯·æ±‚é™æµ</li>\n</ul>\n<p>é‡å¯æœåŠ¡åè”Ÿç‚¹é“¾è·¯é‡Œé¢å°±ä¼šè¢«æ¸…ç©ºäº†ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°å»è¯·æ±‚ä¸€ä¸‹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162054136.png\" alt=\"image-20231016205436554\" /></p>\n<p>åˆ†åˆ«è¯·æ±‚ä¸€ä¸‹ query å’Œ update çš„æ¥å£</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162055490.png\" alt=\"image-20231016205532378\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162055118.png\" alt=\"image-20231016205543133\" /></p>\n<p>å†å»æŸ¥çœ‹è”Ÿç‚¹é“¾è·¯å°±å¯ä»¥çœ‹åˆ°æœ‰ä¿¡æ¯äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162056790.png\" alt=\"image-20231016205631141\" /></p>\n<p>é…ç½®æµæ§è§„åˆ™ï¼Œå½“ /order/update èµ„æºè¢«è®¿é—®çš„ QPS è¶…è¿‡ 5 ä¸ªæ—¶ï¼Œå¯¹ /order/query è¯·æ±‚é™æµã€‚</p>\n<p>æˆ‘ä»¬è¦å¯¹è°è¿›è¡Œé™æµå°±å¯¹è°è¿›è¡Œæµæ§è§„åˆ™</p>\n<p>ç‚¹å‡» query çš„æµæ§</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162058104.png\" alt=\"image-20231016205856014\" /></p>\n<p>é€šè¿‡ jmeter è¿›è¡Œæµ‹è¯•ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162101233.png\" alt=\"image-20231016210113073\" /></p>\n<p>è¯·æ±‚çš„åœ°å€å°±æ˜¯ /order/update</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162101101.png\" alt=\"image-20231016210145527\" /></p>\n<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªè¯·æ±‚ä¸ä¼šå—åˆ°ä»»ä½•å½±å“</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162102511.png\" alt=\"image-20231016210228553\" /></p>\n<p>ä½†ï¼Œå½“è®¿é—® /order/query æ—¶</p>\n<p>å°±å‘ç”Ÿäº†å¼‚å¸¸ï¼Œupdate è§¦å‘é˜ˆå€¼æ—¶å¯¹ query é™æµå°±å®ç°äº†è¿™æ ·ä¸€ç§å…³è”æ¨¡å¼äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162103557.png\" alt=\"image-20231016210318424\" /></p>\n<blockquote>\n<p><strong>å°ç»“</strong>ï¼š</p>\n<p>æ»¡è¶³ä¸‹é¢æ¡ä»¶å¯ä»¥ä½¿ç”¨å…³è”æ¨¡å¼ï¼š</p>\n<ul>\n<li>ä¸¤ä¸ªæœ‰ç«äº‰å…³ç³»çš„èµ„æº</li>\n<li>ä¸€ä¸ªä¼˜å…ˆçº§è¾ƒé«˜ï¼Œä¸€ä¸ªä¼˜å…ˆçº§è¾ƒä½</li>\n</ul>\n</blockquote>\n<h4 id=\"1523-æµæ§æ¨¡å¼-é“¾è·¯\"><a class=\"anchor\" href=\"#1523-æµæ§æ¨¡å¼-é“¾è·¯\">#</a> 1.5.2.3ã€æµæ§æ¨¡å¼ - é“¾è·¯ğŸŒ´</h4>\n<p>é“¾è·¯æ¨¡å¼ï¼šåªé’ˆå¯¹ä»æŒ‡å®šé“¾è·¯è®¿é—®åˆ°æœ¬èµ„æºçš„è¯·æ±‚åšç»Ÿè®¡ï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜ˆå€¼ã€‚</p>\n<p>ä¾‹å¦‚ï¼šæœ‰ä¸¤æ¡è¯·æ±‚é“¾è·¯ä¸€ä¸ªæ˜¯ä» test1 è®¿é—® common èµ„æºå¦ä¸€ä¸ªæ˜¯ä» test2 è®¿é—® common èµ„æºï¼š</p>\n<ul>\n<li>/test1 -&gt; /common</li>\n<li>/test2 -&gt; /common</li>\n</ul>\n<p>å¦‚æœå¸Œæœ›ç»Ÿè®¡ä» /test2 è¿›å…¥åˆ° /common çš„è¯·æ±‚ï¼Œåˆ™å¯ä»¥è¿™æ ·é…ç½®ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162107107.png\" alt=\"image-20231016210716025\" /></p>\n<p>è¿™ä¸ªé…ç½®çš„æ„æ€ï¼š</p>\n<p>åœ¨åšé™æµç»Ÿè®¡æ—¶ï¼Œåªç»Ÿè®¡ä» test2 è¿›å…¥ common çš„è¯·æ±‚ï¼Œtest1 è¿›æ¥çš„ä¸ç®¡ã€‚æ‰€ä»¥è¿™ç§ç»Ÿè®¡æ˜¯å¯¹è¯·æ±‚æ¥æºçš„ä¸€ç§ç»Ÿè®¡</p>\n<p>ä»€ä¹ˆæƒ…å†µä¸‹æˆ‘ä»¬ä¼šç”¨åˆ°è¿™æ ·çš„æ¨¡å¼å‘¢ï¼Ÿé€šè¿‡å¦‚ä¸‹æ¡ˆä¾‹äº†è§£</p>\n<h5 id=\"15231-æ¡ˆä¾‹æµæ§æ¨¡å¼-é“¾è·¯\"><a class=\"anchor\" href=\"#15231-æ¡ˆä¾‹æµæ§æ¨¡å¼-é“¾è·¯\">#</a> 1.5.2.3.1ã€æ¡ˆä¾‹ï¼Œæµæ§æ¨¡å¼ - é“¾è·¯ğŸ‹</h5>\n<p>éœ€æ±‚ï¼šæœ‰æŸ¥è¯¢è®¢å•å’Œåˆ›å»ºè®¢å•ä¸šåŠ¡ï¼Œä¸¤è€…éœ€è¦æŸ¥è¯¢å•†å“ã€‚é’ˆå¯¹ä»æŸ¥è¯¢è®¢å•è¿›å…¥åˆ°æŸ¥è¯¢å•†å“çš„è¯·æ±‚ç»Ÿè®¡ï¼Œå¹¶è®¾ç½®é™æµã€‚</p>\n<p>æ­¥éª¤ï¼š</p>\n<p>1ã€åœ¨ OrderService ä¸­æ·»åŠ ä¸€ä¸ª queryGoods æ–¹æ³•ï¼Œä¸ç”¨å®ç°ä¸šåŠ¡</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@SentinelResource</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"goods\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">queryGoods</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æŸ¥è¯¢å•†å“\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>2ã€åœ¨ OrderController ä¸­ï¼Œæ”¹é€  /order/query ç«¯ç‚¹ï¼Œè°ƒç”¨ OrderService ä¸­çš„ queryGoods æ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"query\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">queryOrder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// æŸ¥è¯¢å•†å“</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   orderService<span class=\"token punctuation\">.</span><span class=\"token function\">queryGoods</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// æŸ¥è¯¢è®¢å•</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æŸ¥è¯¢è®¢å•\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token string\">\"æŸ¥è¯¢è®¢å•æˆåŠŸ\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>3ã€åœ¨ OrderController ä¸­æ·»åŠ ä¸€ä¸ª /order/save çš„ç«¯ç‚¹ï¼Œè°ƒç”¨ OrderService çš„ queryGoods æ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"save\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">saveOrder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   orderService<span class=\"token punctuation\">.</span><span class=\"token function\">queryGoods</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ–°å¢è®¢å•\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token string\">\"æ–°å¢è®¢å•æˆåŠŸ\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>4ã€ç»™ queryGoods è®¾ç½®é™æµè§„åˆ™ï¼Œä» /order/query è¿›å…¥ queryGoods çš„æ–¹æ³•é™åˆ¶ QPS å¿…é¡»å°äº 2</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170741307.png\" alt=\"image-20231017074152072\" /></p>\n<ul>\n<li>\n<p>Sentinel é»˜è®¤åªæ ‡è®° Controller ä¸­çš„æ–¹æ³•ä¸ºèµ„æºï¼Œå¦‚æœè¦æ ‡è®°å…¶å®ƒæ–¹æ³•ï¼Œéœ€è¦åˆ©ç”¨ @SentinelResource æ³¨è§£ï¼Œç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SentinelResource</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"goods\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">queryGoods</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æŸ¥è¯¢å•†å“\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>Sentinel é»˜è®¤ä¼šå°† Controller æ–¹æ³•åš context æ•´åˆï¼Œå¯¼è‡´é“¾è·¯æ¨¡å¼çš„æµæ§å¤±è´¥ï¼Œéœ€è¦ä¿®æ”¹ application.ymlï¼Œæ·»åŠ é…ç½®ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">sentinel</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">transport</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token key atrule\">dashboard</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8080</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">web-context-unify</span><span class=\"token punctuation\">:</span> false // å…³é—­contextæ•´åˆ</pre></td></tr></table></figure></li>\n</ul>\n<p>è®¿é—® order/query å’Œ order/save</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162148402.png\" alt=\"image-20231016214825324\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162148432.png\" alt=\"image-20231016214834464\" /></p>\n<p>æŸ¥çœ‹ sentinel çš„è”Ÿç‚¹é“¾è·¯ä¿¡æ¯</p>\n<p>å¯ä»¥çœ‹åˆ° /order/query ä¸ /order/save å˜æˆäº†ä¸¤ä¸ªç‹¬ç«‹çš„é“¾è·¯äº†ï¼Œåœ¨ä¹‹å‰æ²¡æœ‰å…³é—­ context æ•´åˆæ—¶å®ƒä¿©æ˜¯åŒä¸€ä¸ªè·Ÿé“¾è·¯ä¸‹çš„å­é“¾è·¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162149544.png\" alt=\"image-20231016214905203\" /></p>\n<p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å¯¹ goods æ·»åŠ æµæ§è§„åˆ™äº†ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„ç¬¬ 4 æ­¥</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170741307.png\" alt=\"\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170755887.png\" alt=\"image-20231017075526647\" /></p>\n<p>ä½¿ç”¨ jmeter è¿›è¡Œæµ‹è¯•</p>\n<p>å‘èµ· 200 ä¸ªè¯·æ±‚æ¯ç§’å‘èµ· 4 ä¸ª ï¼Œè€Œä¸”åŒæ—¶å‘èµ·ä¸¤ä¸ªè¯·æ±‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170802306.png\" alt=\"image-20231017080217215\" /></p>\n<p>å¯ä»¥çœ‹åˆ°è¯·æ±‚ save æ²¡é—®é¢˜</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170806261.png\" alt=\"image-20231017080631501\" /></p>\n<p>å¯ä»¥çœ‹åˆ°è¯·æ±‚ query æ—¶æ˜¯ä¸¤ä¸ªä¸¤ä¸ªçš„ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170806763.png\" alt=\"image-20231017080641204\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>æµæ§æ¨¡å¼æœ‰å“ªäº›ï¼Ÿ</p>\n<ul>\n<li>ç›´æ¥ï¼šå¯¹å½“å‰èµ„æºé™æµ</li>\n<li>å…³è”ï¼šé«˜ä¼˜å…ˆçº§èµ„æºè§¦å‘é˜ˆå€¼ï¼Œå¯¹ä½ä¼˜å…ˆçº§èµ„æºé™æµ</li>\n<li>é“¾è·¯ï¼šé˜ˆå€¼ç»Ÿè®¡æ—¶ï¼Œåªç»Ÿè®¡ä»æŒ‡å®šèµ„æºè¿›å…¥å½“å‰èµ„æºçš„è¯·æ±‚ï¼Œæ˜¯å¯¹è¯·æ±‚æ¥æºçš„é™æµ</li>\n</ul>\n</blockquote>\n<h4 id=\"1524-æµæ§æ•ˆæœ\"><a class=\"anchor\" href=\"#1524-æµæ§æ•ˆæœ\">#</a> 1.5.2.4ã€æµæ§æ•ˆæœğŸŒ²</h4>\n<p>æµæ§æ•ˆæœæ˜¯æŒ‡è¯·æ±‚è¾¾åˆ°æµæ§é˜ˆå€¼æ—¶åº”è¯¥é‡‡å–çš„æªæ–½ï¼ŒåŒ…æ‹¬ä¸‰ç§ï¼š</p>\n<ul>\n<li>å¿«é€Ÿå¤±è´¥ï¼šè¾¾åˆ°é˜ˆå€¼åï¼Œæ–°çš„è¯·æ±‚ä¼šè¢«ç«‹å³æ‹’ç»å¹¶æŠ›å‡º FlowException å¼‚å¸¸ã€‚æ˜¯é»˜è®¤çš„å¤„ç†æ–¹å¼ã€‚</li>\n<li>warm upï¼šé¢„çƒ­æ¨¡å¼ï¼Œå¯¹è¶…å‡ºé˜ˆå€¼çš„è¯·æ±‚åŒæ ·æ˜¯æ‹’ç»å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚ä½†è¿™ç§æ¨¡å¼é˜ˆå€¼ä¼šåŠ¨æ€å˜åŒ–ï¼Œä»ä¸€ä¸ªè¾ƒå°å€¼é€æ¸å¢åŠ åˆ°æœ€å¤§é˜ˆå€¼</li>\n<li>æ’é˜Ÿç­‰å¾…ï¼šè®©æ‰€æœ‰çš„è¯·æ±‚æŒ‰ç…§å…ˆåæ¬¡åºæ’é˜Ÿæ‰§è¡Œï¼Œä¸¤ä¸ªè¯·æ±‚çš„å‰ªä¸ªä¸èƒ½å°äºæŒ‡å®šæ—¶é•¿</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170813160.png\" alt=\"image-20231017081328807\" /></p>\n<h5 id=\"15241-æµæ§æ•ˆæœ-warm-up\"><a class=\"anchor\" href=\"#15241-æµæ§æ•ˆæœ-warm-up\">#</a> 1.5.2.4.1ã€æµæ§æ•ˆæœ - warm upğŸŒ´</h5>\n<p>warm up ä¹Ÿå«é¢„çƒ­æ¨¡å¼ï¼Œæ˜¯åº”å¯¹æœåŠ¡å†·å¯åŠ¨çš„ä¸€ç§æ–¹æ¡ˆã€‚è¯·æ±‚é˜ˆå€¼åˆå§‹å€¼æ˜¯ threshold é™¤ä»¥ coldFactorï¼ŒæŒç»­æŒ‡å®šæ—¶é•¿åï¼Œé€æ¸æé«˜åˆ° threshold å€¼ã€‚è€Œ clodFactor çš„é»˜è®¤å€¼æ˜¯ 3.</p>\n<p>ä¾‹å¦‚ï¼Œæˆ‘è®¾ç½® QPS çš„ threshold ä¸º 10ï¼Œé¢„çƒ­æ—¶é—´ä¸º 5 ç§’ï¼Œé‚£ä¹ˆåˆå§‹é˜ˆå€¼å°±æ˜¯ 10 / 3ï¼Œä¹Ÿå°±æ˜¯ 3ï¼Œç„¶ååœ¨ 5 ç§’åé€æ¸å¢é•¿åˆ° 10</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170818338.png\" alt=\"image-20231017081845114\" /></p>\n<h6 id=\"152411-æ¡ˆä¾‹æµæ§æ•ˆæœ-warm-up\"><a class=\"anchor\" href=\"#152411-æ¡ˆä¾‹æµæ§æ•ˆæœ-warm-up\">#</a> 1.5.2.4.1.1ã€æ¡ˆä¾‹ï¼Œæµæ§æ•ˆæœ - warm upğŸ‹</h6>\n<p>éœ€æ±‚ï¼šç»™ /order/{orderId} è¿™ä¸ªèµ„æºè®¾ç½®é™æµï¼Œæœ€å¤§ QPS ä¸º 10ï¼Œåˆ©ç”¨ warm up æ•ˆæœï¼Œé¢„çƒ­æ—¶é•¿ä¸º 5 ç§’</p>\n<p>è¯·æ±‚ä¸€ä¸‹é€šè¿‡ id æŸ¥è¯¢çš„ uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDg4L29yZGVyLzEwMQ==\">http://localhost:8088/order/101</span></p>\n<p>ç„¶åå›åˆ° Sentinel åˆ·æ–°é¡µé¢ï¼Œå°±å¯ä»¥çœ‹åˆ° orderId äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170823021.png\" alt=\"image-20231017082330841\" /></p>\n<p>ç»™ orderId æ·»åŠ ä¸€ä¸ªæµæ§è§„åˆ™</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170827278.png\" alt=\"image-20231017082705193\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170827270.png\" alt=\"image-20231017082714223\" /></p>\n<p>ä½¿ç”¨ jmeter è¿›è¡Œæµ‹è¯•ï¼š</p>\n<p>å¯ä»¥çœ‹åˆ°é€šè¿‡çš„ QPS è¶Šæ¥è¶Šå¤š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170829082.png\" alt=\"image-20231017082949095\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170830693.png\" alt=\"image-20231017083005138\" /></p>\n<h5 id=\"15242-æµæ§æ•ˆæœ-æ’é˜Ÿç­‰å¾…\"><a class=\"anchor\" href=\"#15242-æµæ§æ•ˆæœ-æ’é˜Ÿç­‰å¾…\">#</a> 1.5.2.4.2ã€æµæ§æ•ˆæœ - æ’é˜Ÿç­‰å¾…ğŸŒ´</h5>\n<p>å½“è¯·æ±‚è¶…è¿‡ QPS é˜ˆå€¼æ—¶ï¼Œå¿«é€Ÿå¤±è´¥å’Œ warm up ä¼šæ‹’ç»æ–°çš„è¯·æ±‚å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚è€Œæ’é˜Ÿç­‰å¾…åˆ™æ˜¯è®©æ‰€æœ‰è¯·æ±‚è¿›å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œç„¶åæŒ‰ç…§é˜ˆå€¼å…è®¸çš„æ—¶é—´é—´éš”ä¾æ¬¡æ‰§è¡Œã€‚åæ¥çš„è¯·æ±‚å¿…é¡»ç­‰å¾…å‰é¢æ‰§è¡Œå®Œæˆã€‚å¦‚æœè¯·æ±‚é¢„æœŸçš„ç­‰å¾…æ—¶é—´è¶…å‡ºæœ€å¤§æ—¶é•¿ï¼Œåˆ™ä¼šè¢«æ‹’ç»ã€‚</p>\n<p>ä¾‹å¦‚ï¼šQPS=5ï¼Œæ„å‘³ç€æ¯ 200ms å¤„ç†ä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„è¯·æ±‚ï¼›timeout=2000ï¼Œæ„å‘³ç€é¢„æœŸç­‰å¾…è¶…è¿‡ 2000ms çš„è¯·æ±‚ä¼šè¢«æ‹’ç»å¹¶æŠ›å‡ºå¼‚å¸¸</p>\n<p>æ¯”å¦‚ä¸‹é¢çš„æ—¶é—´çº¿ï¼Œæœ‰æ— æ•°ä¸ªè¯·æ±‚è¦è¿›å…¥é˜Ÿåˆ—æ‰§è¡Œï¼Œé‚£ç¬¬ä¸€ä¸ªè¿›å…¥é˜Ÿåˆ—çš„è¯·æ±‚å®ƒçš„ç­‰å¾…æ—¶é—´ä¸€å®šæ˜¯ 0msã€‚ä½†æ˜¯åŒä¸€æ—¶åˆ»åˆæ¥äº†ä¸€ä¸ªè¯·æ±‚é‚£ä¹ˆç¬¬äºŒä¸ªè¯·æ±‚å®ƒä¸€å®šè¦ç­‰å¾…è‡³å°‘ 200msï¼Œæ‰€ä»¥å®ƒçš„é¢„æœŸç­‰å¾…æ—¶é—´å°±æ˜¯ 2 ç§’ï¼Œåé¢çš„è¯·æ±‚ä»¥æ­¤ç±»æ¨ã€‚ç›´åˆ°ç­‰åˆ°æ—¶é—´æœ€å¤šä¸º 2000ms æ—¶ï¼Œå†æ¥ä¸€ä¸ªè¯·æ±‚å®ƒçš„ç­‰å¾…æ—¶é—´å°±æ˜¯è¶…å‡ºè¿™ 2000ms çš„æ—¶é—´äº†ï¼Œè€Œè¶…å‡ºçš„è¯·æ±‚å°±ä¼šè¢«æ‹’ç»</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170838123.png\" alt=\"image-20231017083846925\" /></p>\n<p>å¥½å¤„ï¼šå‡è®¾è¯´è¯·æ±‚ QPS æ˜¯æ³¢åŠ¨å‹çš„ï¼Œæ¯”å¦‚è¯´ç¬¬ä¸€ç§’é’Ÿä¸€ä¸ªè¯·æ±‚ä¹Ÿæ²¡æ¥ï¼Œè¿™æ—¶é˜Ÿåˆ—æ˜¯ç©ºçš„ã€‚ç»“æœç¬¬äºŒç§’ä¸€ä¸‹æ¥äº† 10 ä¸ªè¯·æ±‚ï¼Œæ”¾åˆ°é˜Ÿåˆ—é‡Œç„¶åæ¯ 200ms æ”¾è¡Œä¸€ä¸ªæ¢ç®—æˆ QPS å°±æ˜¯ 5ï¼Œæ‰€ä»¥ä¸ç®¡è¿›å…¥çš„ QPS æ˜¯æ€æ ·æ³¢åŠ¨çš„å‡ºå»çš„ QPS ä¸€å®šæ˜¯ç¨³å®šçš„æŒ‰ç…§ 200ms ä¸€ä¸ªçš„é€Ÿåº¦å»æ”¾ã€‚æ‰€ä»¥å°±èµ·åˆ°äº†æµé‡æ•´å½¢çš„ä½œç”¨</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170854889.png\" alt=\"image-20231017085359679\" /></p>\n<h6 id=\"152421-æ¡ˆä¾‹æµæ§æ•ˆæœ-æ’é˜Ÿç­‰å¾…\"><a class=\"anchor\" href=\"#152421-æ¡ˆä¾‹æµæ§æ•ˆæœ-æ’é˜Ÿç­‰å¾…\">#</a> 1.5.2.4.2.1ã€æ¡ˆä¾‹ï¼Œæµæ§æ•ˆæœ - æ’é˜Ÿç­‰å¾…ğŸ‹</h6>\n<p>éœ€æ±‚ï¼šç»™ /order/{orderId} è¿™ä¸ªèµ„æºè®¾ç½®é™æµï¼Œæœ€å¤§ QPS ä¸º 10ï¼Œåˆ©ç”¨æ’é˜Ÿçš„æµæ§æ•ˆæœï¼Œè¶…æ—¶æ—¶é•¿è®¾ç½®ä¸º 5ss</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170859614.png\" alt=\"image-20231017085932633\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170901195.png\" alt=\"image-20231017090152352\" /></p>\n<p>ä½¿ç”¨ jmeter è¿›è¡Œæµ‹è¯•ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170908478.png\" alt=\"image-20231017090853567\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170909192.png\" alt=\"image-20231017090906285\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>æµæ§æ•ˆæœæœ‰å“ªäº›ï¼Ÿ</p>\n<ul>\n<li>å¿«é€Ÿå¤±è´¥ï¼šQPS è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œæ‹’ç»æ–°çš„è¯·æ±‚</li>\n<li>warm upï¼šQPS è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œæ‹’ç»æ–°çš„è¯·æ±‚ï¼›QPS é˜ˆå€¼æ˜¯é€æ¸æå‡çš„ï¼Œå¯ä»¥é¿å…å†·å¯åŠ¨æ—¶é«˜å¹¶å‘å¯¼è‡´æœåŠ¡å®•æœºã€‚</li>\n<li>æ’é˜Ÿç­‰å¾…ï¼šè¯·æ±‚ä¼šè¿›å…¥é˜Ÿåˆ—ï¼ŒæŒ‰ç…§é˜ˆå€¼å…è®¸çš„æ—¶é—´é—´éš”ä¾æ¬¡æ‰§è¡Œè¯·æ±‚ï¼›å¦‚æœè¯·æ±‚é¢„æœŸç­‰å¾…æ—¶é•¿å¤§äºè¶…æ—¶æ—¶é—´ï¼Œç›´æ¥æ‹’ç»</li>\n</ul>\n</blockquote>\n<h3 id=\"153-çƒ­ç‚¹å‚æ•°é™æµ\"><a class=\"anchor\" href=\"#153-çƒ­ç‚¹å‚æ•°é™æµ\">#</a> 1.5.3ã€çƒ­ç‚¹å‚æ•°é™æµğŸŒ²</h3>\n<p>ä¹‹å‰çš„é™æµæ˜¯ç»Ÿè®¡è®¿é—®æŸä¸ªèµ„æºçš„æ‰€æœ‰è¯·æ±‚ï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡ QPS é˜ˆå€¼ã€‚è€Œçƒ­ç‚¹å‚æ•°é™æµæ˜¯åˆ†åˆ«ç»Ÿè®¡<mark>å‚æ•°å€¼ç›¸åŒ</mark>çš„è¯·æ±‚ï¼Œåˆ¤è¯»æ˜¯å¦è¶…è¿‡ QPS é˜ˆå€¼ã€‚</p>\n<p>æ¯”å¦‚è¯´ï¼šæœ‰ä¸€ä¸ªèµ„æºæ˜¯æ ¹æ® id æŸ¥è¯¢å•†å“ï¼Œå…±æœ‰ 4 ä¸ªè¯·æ±‚ã€‚å¦‚æœæŒ‰ç…§åŸæ¥çš„ç»Ÿè®¡æ–¹å¼é‚£ QPS å°±æ˜¯ 4ã€‚è€ŒæŒ‰ç…§çƒ­ç‚¹å‚æ•°å®ƒä¼šæ ¹æ®å‚æ•°å€¼æ¥åˆ¤æ–­ï¼Œå‰ä¸‰ä¸ªè¯·æ±‚ä¼ é€’çš„ id ä¸º 1ï¼Œè€Œæœ€åä¸€ä¸ªä¼ é€’çš„ id ä¸º 2ã€‚æ‰€ä»¥ QPS ç»Ÿè®¡å°±ä¼šåˆ†å¼€ç»Ÿè®¡äº†ï¼Œid ä¸º 1 çš„ç»Ÿè®¡ä¸º 3 ä¸ª QPS å°±ä¸º 3ï¼Œid ä¸º 2 çš„ç»Ÿè®¡ä¸º 1 ä¸ª QPS å°±ä¸º 1</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170919488.png\" alt=\"image-20231017091910421\" /></p>\n<h4 id=\"1531-é…ç½®çƒ­ç‚¹é™æµ\"><a class=\"anchor\" href=\"#1531-é…ç½®çƒ­ç‚¹é™æµ\">#</a> 1.5.3.1ã€é…ç½®çƒ­ç‚¹é™æµğŸŒ´</h4>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170920122.png\" alt=\"image-20231017092015196\" /></p>\n<p>å‚æ•°ç´¢å¼•ï¼šä»£è¡¨å½“å‰åˆ—è¡¨ä¸­ç´¢å¼•ä¸º 0 çš„å‚æ•°ä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ª</p>\n<p>å•æœºé˜ˆå€¼ + ç»Ÿè®¡çª—å£æ—¶é•¿ = n ç§’é’Ÿæœ€å¤šå¤„ç† 5 ä¸ªè¯·æ±‚</p>\n<p>ä»£è¡¨çš„å«ä¹‰æ˜¯ï¼šå¯¹ hot è¿™ä¸ªèµ„æºçš„ 0 å·å‚æ•° (ç¬¬ä¸€ä¸ªå‚æ•°) åšç»Ÿè®¡ï¼Œæ¯ 1 ç§’<strong>ç›¸åŒå‚æ•°å€¼</strong>çš„è¯·æ±‚æ•°ä¸èƒ½è¶…è¿‡ 5</p>\n<h4 id=\"1532-é…ç½®çƒ­ç‚¹é™æµé«˜çº§é¡¹\"><a class=\"anchor\" href=\"#1532-é…ç½®çƒ­ç‚¹é™æµé«˜çº§é¡¹\">#</a> 1.5.3.2ã€é…ç½®çƒ­ç‚¹é™æµé«˜çº§é¡¹ğŸŒ´</h4>\n<p>åœ¨çƒ­ç‚¹å‚æ•°é™æµçš„é«˜çº§é€‰é¡¹ä¸­ï¼Œå¯ä»¥å¯¹éƒ¨åˆ†å‚æ•°è®¾ç½®ä¾‹å¤–é…ç½®ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170924654.png\" alt=\"image-20231017092441509\" /></p>\n<p>ç»“åˆä¸Šä¸€ä¸ªé…ç½®ï¼Œè¿™é‡Œçš„å«ä¹‰æ˜¯å¯¹ 0 å·çš„ long ç±»å‹å‚æ•°é™æµï¼Œæ¯ 1 ç§’ç›¸åŒå‚æ•°çš„ QPS ä¸èƒ½è¶…è¿‡ 5ï¼Œæœ‰ä¸¤ä¸ªä¾‹å¤–ï¼š</p>\n<p>1ã€å¦‚æœå‚æ•°å€¼æ˜¯ 100ï¼Œåˆ™æ¯ 1 ç§’å…è®¸çš„ QPS ä¸º 10</p>\n<p>2ã€å¦‚æœå‚æ•°å€¼æ˜¯ 101ï¼Œåˆ™æ¯ 1 ç§’å…è®¸çš„ QPS ä¸º 15</p>\n<h4 id=\"1533-æ¡ˆä¾‹çƒ­ç‚¹å‚æ•°é™æµ\"><a class=\"anchor\" href=\"#1533-æ¡ˆä¾‹çƒ­ç‚¹å‚æ•°é™æµ\">#</a> 1.5.3.3ã€æ¡ˆä¾‹ï¼Œçƒ­ç‚¹å‚æ•°é™æµğŸŒ´</h4>\n<p>ç»™ /order/{orderId} è¿™ä¸ªèµ„æºæ·»åŠ çƒ­ç‚¹å‚æ•°é™æµï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>é»˜è®¤çš„çƒ­ç‚¹å‚æ•°è§„åˆ™æ˜¯æ¯ 1 ç§’è¯·æ±‚é‡ä¸è¶…è¿‡ 2</li>\n<li>ç»™ 102 è¿™ä¸ªå‚æ•°è®¾ç½®ä¾‹å¤–ï¼šæ¯ 1 ç§’è¯·æ±‚é‡ä¸è¶…è¿‡ 4</li>\n<li>ç»™ 103 è¿™ä¸ªå‚æ•°è®¾ç½®ä¾‹å¤–ï¼šæ¯ 1 ç§’è¯·æ±‚é‡ä¸è¶…è¿‡ 10</li>\n</ul>\n<blockquote>\n<p>&lt;font color='red'&gt; æ³¨æ„ &lt;/font&gt;ï¼š</p>\n<p>çƒ­ç‚¹å‚æ•°é™æµå¯¹é»˜è®¤çš„ SpringMVC èµ„æºæ— æ•ˆ</p>\n</blockquote>\n<p>æ­¥éª¤ï¼š</p>\n<p>1ã€çƒ­ç‚¹å‚æ•°é™æµå¯¹é»˜è®¤çš„ SpringMVC èµ„æºæ— æ•ˆï¼Œæˆ‘ä»¬ order/{orderId} è¿™ä¸ªèµ„æºæ°å¥½å°±æ˜¯ Sentinel é»˜è®¤å¯¹ SpringMVC ç›‘æ§çš„ä¸€ä¸ªèµ„æºï¼Œæ‰€ä»¥å³ä¾¿é…ç½®äº†çƒ­ç‚¹å‚æ•°ä¹Ÿä¸ä¼šç”Ÿæ•ˆï¼Œåªæœ‰é€šè¿‡ @SentinelResource å»å£°æ˜çš„èµ„æºæ‰å¯ä»¥é…ç½®çƒ­ç‚¹å‚æ•°é™æµ</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SentinelResource</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hot\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&#123;orderId&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">Order</span> <span class=\"token function\">queryOrderByUserId</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"orderId\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Long</span> orderId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// æ ¹æ® id æŸ¥è¯¢è®¢å•å¹¶è¿”å›</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">return</span> orderService<span class=\"token punctuation\">.</span><span class=\"token function\">queryOrderById</span><span class=\"token punctuation\">(</span>orderId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿™æ—¶èµ„æºå°±åŒæ—¶å…·å¤‡äº†ä¸¤ä¸ªåç§°äº†ï¼Œä¸€ä¸ªæ˜¯ order/{orderId} è¿™æ˜¯é»˜è®¤çš„ SpringMVC èµ„æºåç§°ã€‚</p>\n<p>å¦å¤–ä¸€ä¸ªå°±æ˜¯æˆ‘ä»¬è‡ªå·±èµ·çš„ hot</p>\n<p>é‡å¯ orderService æœåŠ¡åè®¿é—®é¡µé¢ uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDg4L29yZGVyLzEwMQ==\">http://localhost:8088/order/101</span></p>\n<p>è¿™æ ·å°±å¯ä»¥çœ‹åˆ°è”Ÿç‚¹é“¾è·¯äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171009407.png\" alt=\"image-20231017100944355\" /></p>\n<p>2ã€é…ç½®çƒ­ç‚¹é™æµï¼Œä¸è¦ç‚¹å‡»æ ‘å½¢åˆ—è¡¨ä¸­çš„çƒ­ç‚¹è¿™ä¸ªè¡¨å•é‡Œé¢æ²¡æœ‰é«˜çº§é…ç½®</p>\n<p>æˆ‘ä»¬ç‚¹å‡»å·¦è¾¹çš„é€‰é¡¹æ ä¸­çš„çƒ­ç‚¹è§„åˆ™ï¼Œè¿›è¡Œé…ç½®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171011792.png\" alt=\"image-20231017101141197\" /></p>\n<p>ç‚¹å‡»æ–°å¢çƒ­ç‚¹é™æµè§„åˆ™å°±ä¼šå¼¹å‡ºä¸€ä¸ªè¡¨å•è¿›è¡Œé…ç½®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171015751.png\" alt=\"image-20231017101511501\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171017813.gif\" alt=\"test\" /></p>\n<p>ä½¿ç”¨ jmeter è¿›è¡Œæµ‹è¯•ï¼š</p>\n<p>order/101 çš„è¯·æ±‚ç»“æœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171021326.png\" alt=\"image-20231017102157624\" /></p>\n<p>order/102 è¯·æ±‚çš„ç»“æœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171022007.png\" alt=\"image-20231017102216489\" /></p>\n<p>order/103 è¯·æ±‚ç»“æœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171022759.png\" alt=\"image-20231017102239351\" /></p>\n<p>Sentinel çš„æ§åˆ¶å°æƒ…å†µ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171022389.png\" alt=\"image-20231017102256408\" /></p>\n<h2 id=\"16-éš”ç¦»å’Œé™çº§\"><a class=\"anchor\" href=\"#16-éš”ç¦»å’Œé™çº§\">#</a> 1.6ã€éš”ç¦»å’Œé™çº§ğŸŒ³</h2>\n<ul>\n<li>FeignClient æ•´åˆ Sentinel</li>\n<li>çº¿ç¨‹éš”ç¦» (èˆ±å£æ¨¡å¼)</li>\n<li>ç†”æ–­é™çº§</li>\n</ul>\n<p><strong>å›é¡¾ï¼Œéš”ç¦»å’Œé™çº§çš„åŸç†</strong></p>\n<p>è™½ç„¶é™æµå¯ä»¥å°½é‡é¿å…å› é«˜å¹¶å‘è€Œå¼•èµ·çš„æœåŠ¡æ•…éšœï¼Œä½†æœåŠ¡è¿˜ä¼šå› ä¸ºå…¶å®ƒåŸå› è€Œæ•…éšœã€‚è€Œè¦å°†è¿™äº›æ•…éšœæ§åˆ¶åœ¨ä¸€å®šèŒƒå›´ï¼Œé¿å…é›ªå´©ï¼Œå°±è¦é çº¿ç¨‹éš”ç¦» (èˆ±å£æ¨¡å¼) å’Œç†”æ–­é™çº§æ‰‹æ®µäº†ã€‚</p>\n<p>ç»™æ¯ä¸ªä¸šåŠ¡åˆ’åˆ†çº¿ç¨‹æ± ï¼Œå½“æœ‰è¯·æ±‚è®¿é—®ä¸šåŠ¡ 1 æ—¶æœ€å¤šä½¿ç”¨åä¸ªçº¿ç¨‹ï¼Œè™½ç„¶æœåŠ¡ C æ•…éšœäº†è¯·æ±‚è¿‡ç¨‹ä¸­ä¼šé˜»å¡ä½†æ˜¯æœ€å¤šåªå ç”¨ 10 ä¸ªçº¿ç¨‹èµ„æº</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171031862.png\" alt=\"image-20231017103151291\" /></p>\n<p>ç†”æ–­é™çº§ä¼šç»Ÿè®¡æ•…éšœæœåŠ¡çš„æ¯”ä¾‹ï¼Œæ¯”å¦‚è¯´æœåŠ¡ A è®¿é—®æœåŠ¡ D æˆåŠŸçš„åªæœ‰ä¸€ä¸ªï¼Œæ•…éšœçš„æœ‰ä¸¤ä¸ªè¿™æ—¶çš„æ¯”ä¾‹å°±æ˜¯ 60%ã€‚æ­¤æ—¶ æ–­è·¯å™¨å°±ä¼šç†”æ–­ä¸šåŠ¡ï¼Œå†æœ‰è¦è¯·æ±‚æœåŠ¡ D çš„ä¸šåŠ¡å°±ä¼šå¿«é€Ÿå¤±è´¥</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171033093.png\" alt=\"image-20231017103347716\" /></p>\n<p>ä¸ç®¡æ˜¯çº¿ç¨‹éš”ç¦»è¿˜æ˜¯ç†”æ–­é™çº§ï¼Œéƒ½æ˜¯å¯¹ &lt;font color='red'&gt; å®¢æˆ·ç«¯ (è°ƒç”¨æ–¹) &lt;/font&gt;. çš„ä¿æŠ¤</p>\n<h3 id=\"161-feignæ•´åˆsentinel\"><a class=\"anchor\" href=\"#161-feignæ•´åˆsentinel\">#</a> 1.6.1ã€Feign æ•´åˆ SentinelğŸŒ²</h3>\n<p>SpringCloud ä¸­ï¼Œå¾®æœåŠ¡è°ƒç”¨éƒ½æ˜¯é€šè¿‡ Feign æ¥å®ç°çš„ï¼Œå› æ­¤åšå®¢æˆ·ç«¯ä¿æŠ¤å¿…é¡»æ•´åˆ Feign å’Œ Sentinel</p>\n<p>1ã€ä¿®æ”¹ OrderService çš„ applicaiton.yml æ–‡ä»¶ï¼Œå¼€å¯ Feign çš„ Sentinel åŠŸèƒ½</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">feign</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token key atrule\">sentinel</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\"># å¼€å¯ feign å¯¹ sentinel çš„æ”¯æŒ</span></pre></td></tr></table></figure><p>2ã€ç»™ FeignClient ç¼–å†™å¤±è´¥åçš„é™çº§é€»è¾‘</p>\n<p>2.1ã€æ–¹å¼ä¸€ï¼šFallbackClassï¼Œæ— æ³•å¯¹è¿œç¨‹è°ƒç”¨çš„å¼‚å¸¸åšå¤„ç†</p>\n<p>2.2ã€æ–¹å¼äºŒï¼šFallbackFactoryï¼Œå¯ä»¥å¯¹è¿œç¨‹è°ƒç”¨çš„å¼‚å¸¸åšå¤„ç†ï¼Œæˆ‘ä»¬é€‰æ‹©è¿™ç§</p>\n<p>2.2.1ã€åœ¨ feign-api é¡¹ç›®ä¸­å®šä¹‰ç±»ï¼Œå®ç° FallbackFactoryï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserClientFallbackFactory</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">FallbackFactory</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">UserClient</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserClient</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> throwable<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// åˆ›å»º UserClient æ¥å£å®ç°ç±»ï¼Œå®ç°å…¶ä¸­çš„æ–¹æ³•ï¼Œç¼–å†™å¤±è´¥é™çº§çš„å¤„ç†é€»è¾‘</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UserClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">findById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token comment\">// è®°å½•å¼‚å¸¸ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æŸ¥è¯¢ç”¨æˆ·å¼‚å¸¸\"</span><span class=\"token punctuation\">,</span> throwable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token comment\">// æ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿”å›é»˜è®¤çš„æ•°æ®ï¼Œè¿™é‡Œæ˜¯ç©ºç”¨æˆ·</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>2.2.2ã€åœ¨ feign-api é¡¹ç›®ä¸­çš„ DefaultFeignConfigration ç±»ä¸­å°† UserClientFallbackFactory æ³¨å†Œä¸ºä¸€ä¸ª Beanï¼š</p>\n<p>å£°æ˜ Bean å¾ˆç®€å•ï¼Œå®šä¹‰å‡½æ•°è¿”å› new å‡ºæ¥çš„å¯¹è±¡å¹¶æ³¨å†Œ Bean å°±è¡Œäº†</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">UserClientFallbackFactory</span> <span class=\"token function\">userClientFallbackFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UserClientFallbackFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>2.2.3ã€åœ¨ feign-api é¡¹ç›®ä¸­çš„ UserClient æ¥å£ä¸­ä½¿ç”¨ UserClientFallbackFactoryï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@FeignClient</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"userservice\"</span><span class=\"token punctuation\">,</span> fallbackFactory <span class=\"token operator\">=</span> <span class=\"token class-name\">UserClientFallbackFactory</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserClient</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">User</span> <span class=\"token function\">findById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>3ã€é‡å¯ orderService æœåŠ¡</p>\n<p>é‡å¤å®ŒæˆåæŸ¥çœ‹ Sentinel çš„è”Ÿç‚¹é“¾è·¯æƒ…å†µï¼Œä¸‹é¢çš„æƒ…å†µè¯´æ˜å®Œæˆäº† Feign ä¸ Sentinel çš„æ•´åˆäº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171304966.png\" alt=\"image-20231017130442973\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>Sentinel æ”¯æŒçš„é›ªå´©è§£å†³æ–¹æ¡ˆï¼š</p>\n<ul>\n<li>çº¿ç¨‹éš”ç¦» (ä»“å£æ¨¡å¼)</li>\n<li>é™çº§ç†”æ–­</li>\n</ul>\n<p>Feign æ•´åˆ Sentinel çš„æ­¥éª¤ï¼š</p>\n<ol>\n<li>åœ¨ application.yml ä¸­é…ç½®ï¼šfeign.sentinel.enable = true</li>\n<li>ç»™ FeignClient ç¼–å†™ FallbackFactory å¹¶æ³¨å†Œä¸º Bean</li>\n<li>å°† FallbackFactory é…ç½®åˆ° FeignClient</li>\n</ol>\n</blockquote>\n<h3 id=\"162-çº¿ç¨‹éš”ç¦»\"><a class=\"anchor\" href=\"#162-çº¿ç¨‹éš”ç¦»\">#</a> 1.6.2ã€çº¿ç¨‹éš”ç¦»ğŸŒ²</h3>\n<p>çº¿ç¨‹éš”ç¦»æœ‰ä¸¤ç§æ–¹å¼å®ç°ï¼š</p>\n<ul>\n<li>çº¿ç¨‹æ± éš”ç¦»</li>\n<li>ä¿¡å·é‡éš”ç¦» (Sentinel é»˜è®¤é‡‡ç”¨)</li>\n</ul>\n<p>é€šè¿‡æ¡ˆä¾‹æ¥æŸ¥çœ‹ä¸¤ä¸ªçº¿ç¨‹éš”ç¦»çš„å·®åˆ«ï¼š</p>\n<p>å‡è®¾è¯´æœ‰å››ä¸ªæœåŠ¡ iï¼Œaï¼Œbï¼Œc ã€‚æœåŠ¡ i é‡Œé¢çš„ä¸šåŠ¡ä¾èµ–äºæœåŠ¡ aï¼Œbï¼Œcã€‚æ¯”æ–¹è¯´æ¥äº†ä¸€ä¸ªè¯·æ±‚ï¼Œå®ƒçš„ä¸šåŠ¡ä¾èµ–äºæœåŠ¡ aï¼Œbã€‚å¦‚æœè¯´æˆ‘ä»¬ç°åœ¨ç”¨çš„æ˜¯çº¿ç¨‹æ± éš”ç¦»é‚£ä¹ˆå®ƒå°±ä¼šç»™è¿™ä¸ªä¸šåŠ¡æ‰€ä¾èµ–çš„æ¯ä¸ªæœåŠ¡éƒ½åˆ›å»ºçº¿ç¨‹æ± ï¼Œè¯·æ±‚æ¥äº†ä»¥åä¸ä¼šä½¿ç”¨è¯·æ±‚æœ¬èº«çš„çº¿ç¨‹ï¼Œè€Œæ˜¯å»åˆ›å»ºçš„çº¿ç¨‹æ± ä¸­åˆ†åˆ«å–ä¸€ä¸ªçº¿ç¨‹è€Œç”¨è¿™ä¸ªçº¿ç¨‹å»è°ƒç”¨ Feign çš„å®¢æˆ·ç«¯ï¼Œå‘èµ·è¿œç¨‹è°ƒç”¨ã€‚è¿™æ ·å‘¢å°±æŠŠä¸¤ä¸ªæœåŠ¡éš”ç¦»äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171315936.png\" alt=\"image-20231017131457045\" /></p>\n<p>è€Œå¦‚æœé‡‡ç”¨çš„æ˜¯ä¿¡å·é‡çš„æ¨¡å¼å°±ç®€å•å¤šäº†ã€‚æ¯”å¦‚è¯´æ¥äº†ä¸€ä¸ªè¯·æ±‚ï¼Œè¦è®¿é—®æœåŠ¡ cã€‚å®ƒä¼šä½¿ç”¨è¯·æ±‚æœ¬èº«çš„çº¿ç¨‹ç›´æ¥å»è°ƒç”¨ Feign çš„å®¢æˆ·ç«¯å»è°ƒç”¨æœåŠ¡ cã€‚é‚£å®ƒæ€ä¹ˆåšéš”ç¦»å‘¢ï¼Ÿå®ƒä¼šåœ¨è¯·æ±‚è¿›å…¥æ—¶åšä¸€ä¸ªåˆ¤æ–­ï¼Œç»´æŒäº†ä¸€ä¸ªè®¡æ•°å™¨ã€‚åˆ¤æ–­ç°åœ¨è®¡æ•°å™¨è¿˜æœ‰æ²¡æœ‰ã€‚æ¯”å¦‚è¯´è®¡æ•°å™¨æ€»æ•°ä¸º 10 æ¯è¿›å…¥ä¸€ä¸ªè¯·æ±‚è®¡æ•°å™¨å°±ä¼šå‡ 1ï¼Œç„¶åå°±å¯ä»¥å»è®¿é—®æœåŠ¡ c äº†ã€‚å½“æ¥äº†åä¸ªè¯·æ±‚è®¡æ•°å™¨è¢«å–å®Œåå†æ¥æ–°è¯·æ±‚å°±ä¼šè¢«æ‹’ç»ã€‚è¿™æ ·å°±ç­‰äºåˆ©ç”¨è®¡æ•°å™¨é™åˆ¶äº†æœ€ç»ˆçº¿ç¨‹çš„æ•°é‡äº†ã€‚å¦‚æœå¤„ç†å®Œè¯·æ±‚è®¡æ•°å™¨è¿˜æ˜¯è¦è¿˜å›å»çš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171319389.png\" alt=\"image-20231017131940276\" /></p>\n<h4 id=\"1621-ä¸¤è€…çš„ä¼˜ç¼ºç‚¹\"><a class=\"anchor\" href=\"#1621-ä¸¤è€…çš„ä¼˜ç¼ºç‚¹\">#</a> 1.6.2.1ã€ä¸¤è€…çš„ä¼˜ç¼ºç‚¹ï¼š</h4>\n<h5 id=\"çº¿ç¨‹æ± éš”ç¦»\"><a class=\"anchor\" href=\"#çº¿ç¨‹æ± éš”ç¦»\">#</a> çº¿ç¨‹æ± éš”ç¦»</h5>\n<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>\n<p>1ã€æ”¯æŒä¸»åŠ¨è¶…æ—¶</p>\n<p>å¦‚æœå‘ç°è¯·æ±‚æœ‰ç‚¹ä¹…äº†å¯ä»¥æ‰‹åŠ¨çš„ç»ˆæ­¢çº¿ç¨‹</p>\n<p>2ã€æ”¯æŒå¼‚æ­¥è°ƒç”¨</p>\n<p>æ¯ä¸€æ¬¡è¯·æ±‚éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹è€Œä¸æ˜¯ tomcat è¯·æ±‚çš„çº¿ç¨‹</p>\n<p><strong>ç¼ºç‚¹</strong>ï¼š</p>\n<p>1ã€çº¿ç¨‹çš„é¢å¤–å¼€é”€æ¯”è¾ƒå¤§</p>\n<p>åœºæ™¯ï¼š</p>\n<p>1ã€ä½æ‰‡å‡º</p>\n<p>æ‰‡å‡ºï¼šæ¯”æ–¹è¯´è¯·æ±‚åˆ°æˆ‘è¿™ä¸ªæœåŠ¡ï¼Œè€Œæˆ‘è¿™ä¸ªæœåŠ¡ä¾èµ–äºå…¶å®ƒçš„ n ä¸ªæœåŠ¡ã€‚å°±æ˜¯ä»æˆ‘è¿™æ¥äº†ï¼Œæ¥äº†ä¸€ä¸ªè€Œåæˆ‘æ‰‡å‡ºäº†å¥½å‡ ä¸ªã€‚å¦‚æœä¾èµ–çš„æœåŠ¡è¶Šå¤šï¼Œé‚£æ‰‡å‡ºä¹Ÿå°±è¶Šé«˜ï¼Œè€Œæ‰‡å‡ºè¶Šé«˜è°ƒç”¨çš„è¶Šå¤šæˆ‘éœ€è¦å¼€å¯çš„çº¿ç¨‹ä¹Ÿè¶Šå¤šï¼Œæ¶ˆè€—ä¹Ÿå°±è¶Šå¤§ã€‚æ‰€ä»¥å®ƒä¸é€‚ç”¨äºé«˜æ‰‡å‡ºçš„åœºæ™¯ï¼</p>\n<h5 id=\"ä¿¡å·é‡éš”ç¦»\"><a class=\"anchor\" href=\"#ä¿¡å·é‡éš”ç¦»\">#</a> ä¿¡å·é‡éš”ç¦»</h5>\n<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>\n<p>1ã€è½»é‡çº§ï¼Œæ— é¢å¤–å¼€é”€</p>\n<p><strong>ç¼ºç‚¹</strong>ï¼š</p>\n<p>1ã€ä¸æ”¯æŒä¸»åŠ¨è¶…æ—¶</p>\n<p>2ã€ä¸æ”¯æŒå¼‚æ­¥è°ƒç”¨</p>\n<p>åœºæ™¯ï¼š</p>\n<p>1ã€é«˜é¢‘è°ƒç”¨</p>\n<p>2ã€é«˜æ‰‡å‡º</p>\n<h4 id=\"1622-çº¿ç¨‹éš”ç¦»-èˆ±å£æ¨¡å¼\"><a class=\"anchor\" href=\"#1622-çº¿ç¨‹éš”ç¦»-èˆ±å£æ¨¡å¼\">#</a> 1.6.2.2ã€çº¿ç¨‹éš”ç¦» (èˆ±å£æ¨¡å¼)ğŸŒ´</h4>\n<p>åœ¨æ·»åŠ é™æµè§„åˆ™æ—¶ï¼Œå¯ä»¥é€‰æ‹©ä¸¤ç§é˜ˆå€¼ç±»å‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171332558.png\" alt=\"image-20231017133257502\" /></p>\n<ul>\n<li>QPSï¼šå°±æ˜¯æ¯ç§’çš„è¯·æ±‚æ•°ï¼Œåœ¨å¿«é€Ÿå…¥é—¨ä¸­å·²ç»æ¼”ç¤ºè¿‡</li>\n<li>çº¿ç¨‹æ•°ï¼šæ˜¯è¯¥èµ„æºèƒ½ä½¿ç”¨çš„ tomcat çº¿ç¨‹æ•°çš„æœ€å¤§å€¼ã€‚ä¹Ÿå°±æ˜¯é€šè¿‡é™åˆ¶çº¿ç¨‹æ•°é‡ï¼Œå®ç° &lt;font color='red'&gt; èˆ±å£æ¨¡å¼ &lt;/font&gt;.</li>\n</ul>\n<h5 id=\"16221-æ¡ˆä¾‹çº¿ç¨‹éš”ç¦»-èˆ±å£æ¨¡å¼\"><a class=\"anchor\" href=\"#16221-æ¡ˆä¾‹çº¿ç¨‹éš”ç¦»-èˆ±å£æ¨¡å¼\">#</a> 1.6.2.2.1ã€æ¡ˆä¾‹ï¼Œçº¿ç¨‹éš”ç¦» (èˆ±å£æ¨¡å¼)ğŸ‹</h5>\n<p>éœ€æ±‚ï¼šç»™ UserClient çš„æŸ¥è¯¢ç”¨æˆ·æ¥å£è®¾ç½®æµæ§è§„åˆ™ï¼Œçº¿ç¨‹æ•°ä¸èƒ½è¶…è¿‡ 2ã€‚ç„¶ååˆ©ç”¨ jmeter æµ‹è¯•ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171336102.png\" alt=\"image-20231017133620881\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171336135.png\" alt=\"image-20231017133657213\" /></p>\n<p>é…ç½®å®Œæˆï¼ä½¿ç”¨ jmeter è¿›è¡Œé«˜å¹¶å‘æµ‹è¯•ï¼š</p>\n<p>å…¶ä¸­çš„çº¿ç¨‹æ•°ä¸º 10ï¼Œæ—¶é—´ä¸º 0ã€‚è¡¨ç¤ºä¸€ç¬é—´å‘ 10 ä¸ªçº¿ç¨‹è¯·æ±‚ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171337544.png\" alt=\"image-20231017133755763\" /></p>\n<p>æµ‹è¯•ç»“æœï¼š</p>\n<p>ä½†æ˜¯æ€ä¹ˆæ²¡æœ‰çœ‹åˆ°è¢«æ‹’ç»çš„è¯·æ±‚å‘¢ï¼Ÿ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171341275.png\" alt=\"image-20231017134110845\" /></p>\n<p>å…¶å®æˆ‘ä»¬åšäº†é™çº§ç­–ç•¥äº†</p>\n<p>åœ¨ FeignClient æ³¨è§£ä¸­åŠ äº† fallbackFactory</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@FeignClient</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"userservice\"</span><span class=\"token punctuation\">,</span> fallbackFactory <span class=\"token operator\">=</span> <span class=\"token class-name\">UserClientFallbackFactory</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserClient</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">User</span> <span class=\"token function\">findById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰€ä»¥å½“çº¿ç¨‹éš”ç¦»è¢«é™çº§ä»¥åå®ƒä¸æ˜¯æŠ¥é”™ï¼Œè€Œæ˜¯ä¼šèµ°è¿™ä¸ªé™çº§é€»è¾‘è¿”å›ä¸€ä¸ªç©ºå¯¹è±¡</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserClientFallbackFactory</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">FallbackFactory</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">UserClient</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserClient</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> throwable<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// åˆ›å»º UserClient æ¥å£å®ç°ç±»ï¼Œå®ç°å…¶ä¸­çš„æ–¹æ³•ï¼Œç¼–å†™å¤±è´¥é™çº§çš„å¤„ç†é€»è¾‘</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UserClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">findById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token comment\">// è®°å½•å¼‚å¸¸ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æŸ¥è¯¢ç”¨æˆ·å¼‚å¸¸\"</span><span class=\"token punctuation\">,</span> throwable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token comment\">// æ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿”å›é»˜è®¤çš„æ•°æ®ï¼Œè¿™é‡Œæ˜¯ç©ºç”¨æˆ·</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨ idea çš„æ§åˆ¶å°ä¼šæ‰“å°å¼‚å¸¸çš„ä¿¡æ¯</p>\n<pre><code>10-17 13:40:38:046 ERROR 1804 --- [nio-8088-exec-3] c.i.f.c.f.UserClientFallbackFactory : æŸ¥è¯¢ç”¨æˆ·å¼‚å¸¸\n</code></pre>\n<p>æˆ‘ä»¬åœ¨å›åˆ° jmeter ç‚¹å‡»è¯·æ±‚æŸ¥çœ‹è¯¦ç»†æƒ…å†µï¼Œæœ‰çš„è·å–çš„æ•°æ®æ˜¯ç©ºçš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171347804.png\" alt=\"image-20231017134731646\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>çº¿ç¨‹éš”ç¦»çš„ä¸¤ç§æ‰‹æ®µæ˜¯ï¼Ÿ</p>\n<ul>\n<li>ä¿¡å·éš”ç¦»</li>\n<li>çº¿ç¨‹æ± éš”ç¦»</li>\n</ul>\n<p>ä¿¡å·é‡éš”ç¦»çš„ç‰¹ç‚¹æ˜¯ï¼Ÿ</p>\n<ul>\n<li>åŸºäºè®¡æ•°å™¨æ¨¡å¼ï¼Œç®€å•ï¼Œå¼€é”€å°</li>\n</ul>\n<p>çº¿ç¨‹æ± éš”ç¦»çš„ç‰¹ç‚¹æ˜¯ï¼Ÿ</p>\n<ul>\n<li>åŸºäºçº¿ç¨‹æ± æ¨¡å¼ï¼Œæœ‰é¢å¤–å¼€é”€ï¼Œä½†éš”ç¦»æ§åˆ¶æ›´å¼º</li>\n</ul>\n</blockquote>\n<h3 id=\"163-ç†”æ–­é™çº§\"><a class=\"anchor\" href=\"#163-ç†”æ–­é™çº§\">#</a> 1.6.3ã€ç†”æ–­é™çº§ğŸŒ²</h3>\n<p>ç†”æ–­é™çº§æ˜¯è§£å†³é›ªå´©é—®é¢˜çš„é‡è¦æ‰‹æ®µã€‚å…¶æ€è·¯æ˜¯ç”± &lt;font color='red'&gt; æ–­è·¯å™¨ &lt;/font &gt; ç»Ÿè®¡æœåŠ¡è°ƒç”¨çš„å¼‚å¸¸æ¯”ä¾‹ï¼Œæ…¢è¯·æ±‚æ¯”ä¾‹ï¼Œå¦‚æœè¶…å‡ºé˜ˆå€¼åˆ™ä¼š &lt; font color='red'&gt; ç†”æ–­ &lt;/font &gt; è¯¥æœåŠ¡ã€‚å³æ‹¦æˆªè®¿é—®è¯¥æœåŠ¡çš„ä¸€åˆ‡è¯·æ±‚ï¼›è€Œå½“è¯·æ±‚æ¢å¤æ—¶ï¼Œæ–­è·¯å™¨ä¼šæ”¾è¡Œè®¿é—®è¯¥æœåŠ¡çš„è¯·æ±‚ã€‚</p>\n<p>æ–­è·¯å™¨å†…éƒ¨ç”±ä¸€ä¸ªçŠ¶æ€æœºæ¥å®ç°çš„ï¼Œè¿™ä¸ªçŠ¶æ€æœºåŒ…å«ä¸‰ç§çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯ï¼šclosedï¼Œopenï¼ŒHalf-Open</p>\n<p>closed çŠ¶æ€ä¸‹ï¼Œæ–­è·¯å™¨ä¸ä¼šæ‹¦æˆªä»»ä½•è¯·æ±‚ã€‚ä¸ç®¡è¯·æ±‚æ˜¯æ­£å¸¸çš„è¿˜æ˜¯å¼‚å¸¸çš„éƒ½å¯ä»¥è®¿é—®ï¼Œå®ƒä¼šå»ç»Ÿè®¡è°ƒç”¨å¼‚å¸¸çš„æ¯”ä¾‹ï¼Œå¦‚æœç»Ÿè®¡è¿‡ç¨‹ä¸­å‘ç°å¼‚å¸¸æ¯”ä¾‹è¿‡é«˜è¾¾åˆ°äº†é˜ˆå€¼å°±ä¼šä» closed çŠ¶æ€åˆ‡æ¢åˆ° open çŠ¶æ€ã€è¿™æ—¶å°±ä¼šæ‹¦æˆªè¿›å…¥è¯¥æœåŠ¡çš„ä¸€äº›è¯·æ±‚äº†ä¹Ÿå°±ç›¸å½“äºæ˜¯ç†”æ–­äº†ã€‚ç†”æ–­æœ‰ä¸€ä¸ªæŒç»­çš„æ—¶é—´ï¼Œå½“ç†”æ–­æ—¶é—´ç»“æŸå°±ä¼šä» open çŠ¶æ€åˆ‡æ¢åˆ° half-open çŠ¶æ€ (åŠå¼€çŠ¶æ€)ã€‚half-open çŠ¶æ€ä¼šæ”¾è¡Œä¸€æ¬¡è¯·æ±‚ï¼Œç„¶åæ ¹æ®è¿™æ¬¡è¯·æ±‚çš„ç»“æœæ¥åˆ¤æ–­ä¸‹ä¸€æ­¥ã€‚</p>\n<p>æ¯”å¦‚è¯´æ”¾è¡Œä¸€æ¬¡è¯·æ±‚å‘ç°è¿™ä¸ªè¯·æ±‚ä¾èµ–æ˜¯å¤±è´¥çš„é‚£ä¹ˆå°±ä¼šå†æ¬¡è¿›å…¥ open çŠ¶æ€</p>\n<p>å¦‚æœæ”¾è¡Œä¸€æ¬¡è¯·æ±‚æ‰§è¡Œå®Œäº†å‘ç°æ˜¯æˆåŠŸçš„é‚£ä¹ˆå°±ä¼šä» half-open åˆ‡æ¢åˆ° closed çŠ¶æ€</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171422210.png\" alt=\"image-20231017142215093\" /></p>\n<p>æˆ‘ä»¬çŸ¥é“æ–­è·¯å™¨è¦æƒ³ä» closed çŠ¶æ€è¿›å…¥åˆ° open çŠ¶æ€éœ€è¦åˆ¤æ–­æœåŠ¡æœ‰æ²¡æœ‰è§¦å‘ç†”æ–­çš„æ¡ä»¶ã€‚è€Œç†”æ–­åˆ¤æ–­çš„æ¡ä»¶å°±æ˜¯ä¾æ®ç†”æ–­ç­–ç•¥æ¥å®Œæˆçš„ï¼Œè€Œåœ¨ Sentinel é‡Œç†”æ–­çš„ç­–ç•¥æœ‰ä¸‰ç§ï¼šæ…¢è°ƒç”¨ï¼Œå¼‚å¸¸æ¯”ä¾‹ï¼Œå¼‚å¸¸æ•°</p>\n<h4 id=\"1631-ç†”æ–­ç­–ç•¥-æ…¢è°ƒç”¨\"><a class=\"anchor\" href=\"#1631-ç†”æ–­ç­–ç•¥-æ…¢è°ƒç”¨\">#</a> 1.6.3.1ã€ç†”æ–­ç­–ç•¥ - æ…¢è°ƒç”¨ğŸŒ´</h4>\n<p><mark>æ…¢è°ƒç”¨</mark>ï¼šä¸šåŠ¡çš„å“åº”æ—¶é•¿ (RT) å¤§äºæŒ‡å®šæ—¶é•¿çš„è¯·æ±‚è®¤å®šä¸ºæ…¢è°ƒç”¨è¯·æ±‚ã€‚åœ¨æŒ‡å®šæ—¶é—´å†…ï¼Œå¦‚æœè¯·æ±‚æ•°é‡è¶…è¿‡è®¾å®šçš„æœ€å°æ•°é‡ï¼Œæ…¢è°ƒç”¨æ¯”ä¾‹å¤§äºè®¾å®šçš„é˜ˆå€¼ï¼Œåˆ™è§¦å‘ç†”æ–­ã€‚ä¾‹å¦‚ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171428040.png\" alt=\"image-20231017142805647\" /></p>\n<p><strong>è§£è¯»</strong>ï¼šRT è¶…è¿‡ 500ms çš„è°ƒç”¨æ˜¯æ…¢è°ƒç”¨ï¼Œç»Ÿè®¡æœ€è¿‘ 10000ms å†…çš„è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚é‡è¶…è¿‡ 10 æ¬¡ï¼Œå¹¶ä¸”æ…¢è°ƒç”¨æ¯”ä¾‹ä¸ä½äº 0.5ï¼Œåˆ™è§¦å‘ç†”æ–­ï¼Œç†”æ–­æ—¶é•¿ä¸º 5 ç§’ã€‚ç„¶åè¿›å…¥ half-open çŠ¶æ€ï¼Œæ”¾è¡Œä¸€æ¬¡è¯·æ±‚åšæµ‹è¯•ã€‚</p>\n<h5 id=\"16311-æ¡ˆä¾‹ç†”æ–­ç­–ç•¥-æ…¢è°ƒç”¨\"><a class=\"anchor\" href=\"#16311-æ¡ˆä¾‹ç†”æ–­ç­–ç•¥-æ…¢è°ƒç”¨\">#</a> 1.6.3.1.1ã€æ¡ˆä¾‹ï¼Œç†”æ–­ç­–ç•¥ - æ…¢è°ƒç”¨ğŸ‹</h5>\n<p>éœ€æ±‚ï¼šç»™ UserClient çš„æŸ¥è¯¢ç”¨æˆ·æ¥å£è®¾ç½®é™çº§è§„åˆ™ï¼Œæ…¢è°ƒç”¨çš„ RT é˜ˆå€¼ä¸º 50msï¼Œç»Ÿè®¡æ—¶é—´ä¸º 1 ç§’ï¼Œ æœ€å°è¯·æ±‚æ•°é‡ä¸º 5ï¼Œå¤±è´¥é˜ˆå€¼æ¯”ä¾‹ä¸º 0.4ï¼Œç†”æ–­æ—¶é•¿ä¸º 5</p>\n<p>é—®é¢˜ï¼šæœ¬åœ°è°ƒç”¨æ—¶é—´ä¸å¯èƒ½é‚£ä¹ˆé•¿æ‰€ä»¥ä¸ºäº†èƒ½å¤Ÿè§¦å‘æ…¢è°ƒç”¨éœ€è¦ä¿®æ”¹ä¸€ä¸‹ä¸šåŠ¡ä»£ç è®©å…¶è¶…è¿‡å“åº”æ—¶é—´</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">queryById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@RequestHeader</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"Truth\"</span><span class=\"token punctuation\">,</span> required <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> truth<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>id <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token comment\">// ä¼‘çœ ï¼Œè§¦å‘ç†”æ–­</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>         <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">60</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"truth: \"</span> <span class=\"token operator\">+</span> truth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token keyword\">return</span> userService<span class=\"token punctuation\">.</span><span class=\"token function\">queryById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>é‡å¯ userService æœåŠ¡</p>\n<p>è®¿é—® order/101 æ—¶å°±ä¼šå»è¯·æ±‚ userId ä¸º 1 çš„ç”¨æˆ·</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171439770.png\" alt=\"image-20231017143949635\" /></p>\n<p>order/102</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171441135.png\" alt=\"image-20231017144136736\" /></p>\n<p>order/101</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171441279.png\" alt=\"image-20231017144150302\" /></p>\n<p>å¯ä»¥çœ‹åˆ° 102 è¯·æ±‚æ—¶é•¿åŸºæœ¬ä¸è¶…è¿‡ 10 æ¯«ç§’ï¼Œè€Œ 101 è¯·æ±‚æ—¶é•¿åŸºæœ¬ä¸ä¸‹ 70 æ¯«ç§’ã€‚è¿™æ ·å°±èƒ½æ»¡è¶³æˆ‘ä»¬è§¦å‘é˜ˆå€¼çš„æƒ…å†µäº†</p>\n<p>ç„¶åå°±å¯ä»¥å»é…ç½®ç†”æ–­é™çº§ç­–ç•¥äº†ï¼Œå» Sentinel æ§åˆ¶å°ä¸­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171445150.png\" alt=\"image-20231017144506913\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171445998.png\" alt=\"image-20231017144515744\" /></p>\n<p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥å»è¿›è¡Œæµ‹è¯•äº†ï¼š</p>\n<p>è¿™æ¬¡çš„æµ‹è¯•å¯ä»¥ä¸ç”¨ jmeter äº†ï¼Œå› ä¸ºéœ€è¦ä¸€ç§’å†… 5 æ¬¡è¯·æ±‚ï¼Œæœ‰ 2 æ¬¡è§¦å‘å°±è¡Œäº†å¾ˆå®¹æ˜“å¯ä»¥å»åˆ·æ–° order/{orderId} çš„è¯·æ±‚é¡µé¢</p>\n<p>ç°åœ¨è®¿é—® order/102ï¼Œæ˜¯æ­£å¸¸å¯ä»¥è®¿é—®çš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171448397.png\" alt=\"image-20231017144804306\" /></p>\n<p>è¿ç»­è¯·æ±‚ 5 æ¬¡ order/101ï¼Œä¹Ÿå°±æ˜¯åˆ·æ–° 5 æ¬¡é¡µé¢</p>\n<p>å†å»è®¿é—® order/102 å°±ä¼šå‘ç° user ä¸­æ²¡æœ‰æ•°æ®äº†ï¼Œå½“ order å»æŸ¥ user çš„é‚£ä¸€åˆ»ç›´æ¥è¢«ç†”æ–­äº†ï¼Œå‹æ ¹æ²¡æœ‰å»æŸ¥ç›´æ¥èµ°é™çº§é€»è¾‘è¿”å› null äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171449564.png\" alt=\"image-20231017144859133\" /></p>\n<p>ç­‰å¾… 5 ç§’åå†å»åˆ·æ–°ä¸€ä¸ª order/102 é¡µé¢ï¼Œç†”æ–­å°±å–æ¶ˆäº†å¯ä»¥è¯·æ±‚åˆ° user çš„æ•°æ®äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171451453.png\" alt=\"image-20231017145103496\" /></p>\n<h4 id=\"1632-ç†”æ–­ç­–ç•¥-å¼‚å¸¸æ¯”ä¾‹å¼‚å¸¸æ•°\"><a class=\"anchor\" href=\"#1632-ç†”æ–­ç­–ç•¥-å¼‚å¸¸æ¯”ä¾‹å¼‚å¸¸æ•°\">#</a> 1.6.3.2ã€ç†”æ–­ç­–ç•¥ - å¼‚å¸¸æ¯”ä¾‹ï¼Œå¼‚å¸¸æ•°ğŸŒ´</h4>\n<ul>\n<li><mark>å¼‚å¸¸æ¯”ä¾‹æˆ–å¼‚å¸¸æ•°</mark>ï¼šç»Ÿè®¡æŒ‡å®šæ—¶é—´å†…çš„ è°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨æ¬¡æ•°è¶…è¿‡æŒ‡å®šçš„è¯·æ±‚æ•°ï¼Œå¹¶ä¸”å‡ºç°å¼‚å¸¸çš„æ¯”ä¾‹è¾¾åˆ°è®¾å®šçš„æ¯”ä¾‹é˜ˆå€¼ (æˆ–è¶…è¿‡æŒ‡å®šå¼‚å¸¸æ•°) ï¼Œåˆ™è§¦å‘ç†”æ–­ã€‚ä¾‹å¦‚ï¼š</li>\n</ul>\n<p>æŒ‰ç…§å¼‚å¸¸çš„æ¯”ä¾‹ç†”æ–­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171454750.png\" alt=\"image-20231017145414614\" /></p>\n<p>è¾¾åˆ°å¼‚å¸¸æ•°é‡ç†”æ–­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171456985.png\" alt=\"image-20231017145619743\" /></p>\n<p><strong>è§£è¯»</strong>ï¼šç»Ÿè®¡æœ€è¿‘ 1000ms å†…çš„è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚é‡è¶…è¿‡ 10 æ¬¡ï¼Œå¹¶ä¸”å¼‚å¸¸æ¯”ä¾‹ä¸ä½äº 0.5ï¼Œåˆ™è§¦å‘ç†”æ–­ï¼Œç†”æ–­æ—¶é•¿ä¸º 5 ç§’ã€‚ç„¶åè¿›å…¥ half-open çŠ¶æ€ï¼Œæ”¾è¡Œä¸€æ¬¡è¯·æ±‚åšæµ‹è¯•ã€‚</p>\n<h5 id=\"16321-æ¡ˆä¾‹ç†”æ–­ç­–ç•¥-å¼‚å¸¸æ¯”ä¾‹\"><a class=\"anchor\" href=\"#16321-æ¡ˆä¾‹ç†”æ–­ç­–ç•¥-å¼‚å¸¸æ¯”ä¾‹\">#</a> 1.6.3.2.1ã€æ¡ˆä¾‹ï¼Œç†”æ–­ç­–ç•¥ - å¼‚å¸¸æ¯”ä¾‹ğŸ‹</h5>\n<p><strong>éœ€æ±‚</strong>ï¼šç»™ UserClient çš„æŸ¥è¯¢ç”¨æˆ·æ¥å£è®¾ç½®é™çº§è§„åˆ™ï¼Œç»Ÿè®¡æ—¶é—´ä¸º 1 ç§’ï¼Œæœ€å°è¯·æ±‚æ•°é‡ä¸º 5ï¼Œå¤±è´¥é˜ˆå€¼æ¯”ä¾‹ä¸º 0.4ï¼Œç†”æ–­æ—¶é•¿ä¸º 5</p>\n<p>&lt;font color='red'&gt; æç¤º &lt;/font&gt;ï¼šä¸ºäº†è§¦å‘å¼‚å¸¸ç»Ÿè®¡ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ UserService ä¸­çš„ä¸šåŠ¡ï¼ŒæŠ›å‡ºå¼‚å¸¸å¦‚ä¸‹ä»£ç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">queryById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@RequestHeader</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"Truth\"</span><span class=\"token punctuation\">,</span> required <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> truth<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>id <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ•…æ„æŠ›å‡ºå¼‚å¸¸ï¼Œè§¦å‘å¼‚å¸¸æ¯”ä¾‹ç†”æ–­\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"truth: \"</span> <span class=\"token operator\">+</span> truth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token keyword\">return</span> userService<span class=\"token punctuation\">.</span><span class=\"token function\">queryById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç»™ UserClient æŸ¥è¯¢ç”¨æˆ·æ¥å£è®¾ç½®é™çº§è§„åˆ™</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171511550.png\" alt=\"image-20231017151144666\" /></p>\n<p>è®¿é—® order/102</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171512960.png\" alt=\"image-20231017151235103\" /></p>\n<p>ç„¶åè¿ç»­è®¿é—® n æ¬¡ order/101</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171516133.png\" alt=\"image-20231017151605944\" /></p>\n<p>åœ¨è®¿é—® order/102 å°±å‘ç°è¢«ç†”æ–­äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171515798.png\" alt=\"image-20231017151556049\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>Sentinel ç†”æ–­é™çº§çš„ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</p>\n<p>1ã€æ…¢è°ƒç”¨æ¯”ä¾‹ï¼šè¶…è¿‡æŒ‡å®šæ—¶é•¿çš„è°ƒç”¨ä¸ºæ…¢è°ƒç”¨ï¼Œç»Ÿè®¡å•ä½æ—¶é•¿å†…æ…¢è°ƒç”¨çš„æ¯”ä¾‹ï¼Œè¶…è¿‡é˜ˆå€¼åˆ™ç†”æ–­</p>\n<p>2ã€å¼‚å¸¸æ¯”ä¾‹ï¼šç»Ÿè®¡å•ä½æ—¶é•¿å†…å¼‚å¸¸è°ƒç”¨çš„æ¯”ä¾‹ï¼Œè¶…è¿‡é˜ˆå€¼åˆ™ç†”æ–­</p>\n<p>3ã€å¼‚å¸¸æ•°ï¼šç»Ÿè®¡å•ä½æ—¶é•¿å†…å¼‚å¸¸è°ƒç”¨çš„æ¬¡æ•°ï¼Œè¶…è¿‡é˜ˆå€¼åˆ™ç†”æ–­</p>\n</blockquote>\n<h2 id=\"17-æˆæƒè§„åˆ™\"><a class=\"anchor\" href=\"#17-æˆæƒè§„åˆ™\">#</a> 1.7ã€æˆæƒè§„åˆ™ğŸŒ³</h2>\n<ul>\n<li>æˆæƒè§„åˆ™</li>\n<li>è‡ªå®šä¹‰å¼‚å¸¸ç»“æœ</li>\n</ul>\n<h3 id=\"171-æˆæƒè§„åˆ™\"><a class=\"anchor\" href=\"#171-æˆæƒè§„åˆ™\">#</a> 1.7.1ã€æˆæƒè§„åˆ™ğŸŒ²</h3>\n<p>æˆæƒè§„åˆ™å¯ä»¥å¯¹è°ƒç”¨æ–¹çš„æ¥æºåšæ§åˆ¶ï¼Œæœ‰ç™½åå•å’Œé»‘åå•ä¸¤ç§æ–¹å¼ã€‚</p>\n<blockquote>\n<p>æˆ‘ä»¬å­¦ä¹ ç½‘å…³çš„æ—¶å€™è®²è¿‡ï¼Œgateway å®ƒä¸å°±æ˜¯æŠŠé—¨çš„å—ã€‚æ‰€æœ‰è¯·æ±‚éƒ½è¦ç»è¿‡ç½‘å…³å»åšèº«ä»½çš„è®¤è¯ï¼Œæ€ä¹ˆåˆ°è¿™å„¿åˆè¦æ•´ä¸€ä¸ªå‘¢ï¼Ÿ</p>\n<p>ä¸‡ä¸€å…¬å¸å‡ºäº†ä¸€ä¸ªå†…é¬¼ï¼Œå®ƒæŠŠå¾®æœåŠ¡åœ°å€æ³„éœ²ç»™äº†å¤–è¾¹å“ªäº›ä¸æ€€å¥½æ„çš„äººï¼Œé‚£è¿™äº›å“¥ä»¬å°±å¯ä»¥ç»•è¿‡ç½‘å…³ç›´æ¥è®¿é—®å¾®æœåŠ¡äº†ã€‚é‚£ç½‘å…³é‡Œåšçš„å†ä¸¥å¯†ä¹Ÿéƒ½æ²¡ç”¨äº†ï¼Œæ‰€ä»¥ Sentinel æˆæƒè§„åˆ™å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆæƒè§„åˆ™ä¼šå»éªŒè¯ä½ è¯·æ±‚ä»å“ªæ¥çš„ã€‚å¦‚æœè¯´ä½ æ˜¯ä»ç½‘å…³è¿‡æ¥çš„é‚£å°±æ”¾è¡Œï¼Œå¦‚æœè¯´ä½ ä»åˆ«çš„åœ°æ–¹æ¥çš„å°±æ‹¦æˆª</p>\n</blockquote>\n<ul>\n<li>ç™½åå•ï¼šæ¥æº (origin) åœ¨ç™½åå•å†…çš„è°ƒç”¨è€…å…è®¸è®¿é—®</li>\n<li>é»‘åå•ï¼šæ¥æº (origin) åœ¨é»‘åå•å†…çš„è°ƒç”¨è€…ä¸å…è®¸è®¿é—®</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171530129.png\" alt=\"image-20231017153026632\" /></p>\n<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬é™å®šåªå…è®¸ä»ç½‘å…³æ¥çš„è¯·æ±‚è®¿é—® order-serviceï¼Œé‚£ä¹ˆæµæ§åº”ç”¨ä¸­å°±å¡«å†™ç½‘å…³çš„åç§°</p>\n<p>é‚£ä¹ˆè¿™æ—¶</p>\n<p orderId=\"\">èµ„æºåå¡«çš„å°±æ˜¯ï¼šorder-service é‡Œé¢çš„å—ä¿æŠ¤èµ„æºï¼Œæ¯”æ–¹è¯´ order/</p>\n<p>æµæ§åº”ç”¨å¡«çš„å°±æ˜¯ï¼šå…è®¸çš„è°ƒç”¨è€…çš„åå­— originï¼Œè¯·æ±‚æ¥æºåç§°ï¼Œé‚£ä¹ˆè¯·æ±‚æ¥æºåç§°æ˜¯æ€ä¹ˆå¾—åˆ°çš„å‘¢ï¼Ÿ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171531533.png\" alt=\"image-20231017153153844\" /></p>\n<p>Sentinel æ˜¯é€šè¿‡ RequestOriginParser è¿™ä¸ªæ¥å£çš„ parseOrigin æ¥è·å–è¯·æ±‚çš„æ¥æºçš„ã€‚</p>\n<p>ä½†æ˜¯è¿™ä¸ªæ–¹æ³•çš„è¿”å›ç»“æœåªèƒ½æ˜¯ defaultï¼Œä¹Ÿå°±æ˜¯è¯´æ— è®ºæ˜¯ä»ç½‘å…³è¿‡æ¥è¿˜æ˜¯æµè§ˆå™¨è¿‡æ¥å®ƒçš„æ¥æºåç§°éƒ½å« default</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">RequestOriginParser</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   * ä»è¯·æ±‚ request å¯¹è±¡ä¸­è·å– originï¼Œè·å–æ–¹å¼è‡ªå®šä¹‰</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">String</span> <span class=\"token function\">parseOrigin</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¿…é¡»è‡ªå·±æƒ³åŠæ³•å®ç°è¿™ä¸ªæ¥å£ç¼–å†™å®ƒçš„ä¸šåŠ¡é€»è¾‘ï¼Œè®©ä»ç½‘å…³è¿‡æ¥çš„è¯·æ±‚å’Œä»æµè§ˆå™¨è¿‡æ¥çš„è¯·æ±‚è¿”å›ä¸åŒçš„ç»“æœï¼Œè¿™æ ·æ¥æºåç§°ä¸åŒå°±å¯ä»¥ç¼–å†™æˆæƒè§„åˆ™äº†</p>\n<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å°è¯•ä» reqeust ä¸­è·å–ä¸€ä¸ªåä¸º origin çš„è¯·æ±‚å¤´ï¼Œä½œä¸º origin çš„å€¼ï¼š</p>\n<p>è¿™é‡Œ gateway è®¿é—®æ¶ˆè´¹è€…ä¹Ÿå°±æ˜¯ orderservice æœåŠ¡æ‰€ä»¥ä¸‹é¢ä¸šåŠ¡ä»£ç æ˜¯å†™åˆ° order æœåŠ¡ä¸­çš„</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HeaderOriginParser</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">RequestOriginParser</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">parseOrigin</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">// 1. è·å–è¯·æ±‚å¤´</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">String</span> header <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"origin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// 2. éç©ºåˆ¤æ–­</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>header<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            header <span class=\"token operator\">=</span> <span class=\"token string\">\"blank\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">return</span> header<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜éœ€è¦åœ¨ gateway æœåŠ¡ä¸­ï¼Œåˆ©ç”¨ç½‘å…³çš„è¿‡æ»¤å™¨æ·»åŠ åä¸º gateway çš„ origin å¤´</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">default-filters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token punctuation\">-</span> AddRequestHeader=origin<span class=\"token punctuation\">,</span>gateway <span class=\"token comment\"># æ·»åŠ åä¸º origin çš„è¯·æ±‚å¤´ï¼Œå€¼ä¸º gateway</span></pre></td></tr></table></figure><p>é‡å¯ orderservice æœåŠ¡å’Œ gateway æœåŠ¡</p>\n<p>éšä¾¿è®¿é—®ä¸€ä¸ª uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDg4L29yZGVyLzEwMQ==\">http://localhost:8088/order/101</span></p>\n<p>ç„¶åæŸ¥çœ‹ Sentinel æ§åˆ¶å°ä¸­çš„è”Ÿç‚¹é“¾è·¯</p>\n<p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥ç»™ /order/{orderId} é…ç½®æˆæƒè§„åˆ™ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171605527.png\" alt=\"image-20231017160506456\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171605725.png\" alt=\"image-20231017160532751\" /></p>\n<p>æ­¤æ—¶æˆ‘ä»¬å†å»è®¿é—® order/101 æœåŠ¡</p>\n<p>æ³¨æ„ï¼šè¿™é‡Œ order/101 æ˜¯ç»•è¿‡äº†ç½‘å…³çš„</p>\n<p>è®¿é—®æ˜¯ä¸æˆåŠŸçš„ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171605535.png\" alt=\"image-20231017160543084\" /></p>\n<p>é‚£æˆ‘ä»¬ä½¿ç”¨ç½‘å…³è¿›è¡Œè®¿é—®çš„</p>\n<p>å¯ä»¥æ­£å¸¸è®¿é—®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171606887.png\" alt=\"image-20231017160611726\" /></p>\n<p>ä½†æ˜¯ç”±äºä¸Šé¢ç›´æ¥è·³è¿‡ç½‘å…³è®¿é—® order/101 çš„æ—¶å€™å°±ä¼šæŠ¥é”™ï¼Œé¡µé¢çš„æŠ¥é”™æç¤ºå¦‚ä¸‹ï¼š</p>\n<p>è¯´æ˜¯é™æµå¼‚å¸¸è¿™å°±ä¸åˆç†äº†ï¼Œæ˜æ˜æ˜¯æˆæƒå¼‚å¸¸æ€ä¹ˆå°±é™æµå¼‚å¸¸äº†å‘¢</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171609433.png\" alt=\"image-20231017160543084\" /></p>\n<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œè‡ªå®šä¹‰å¼‚å¸¸ï¼š</p>\n<h3 id=\"172-è‡ªå®šä¹‰å¼‚å¸¸ç»“æœ\"><a class=\"anchor\" href=\"#172-è‡ªå®šä¹‰å¼‚å¸¸ç»“æœ\">#</a> 1.7.2ã€è‡ªå®šä¹‰å¼‚å¸¸ç»“æœğŸŒ²</h3>\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘ç”Ÿé™æµï¼Œé™çº§ï¼Œæˆæƒæ‹¦æˆªæ—¶ï¼Œéƒ½ä¼šæŠ›å‡ºå¼‚å¸¸åˆ°è°ƒç”¨æ–¹ã€‚å¦‚æœè¦è‡ªå®šä¹‰å¼‚å¸¸æ—¶çš„è¿”å›ç»“æœï¼Œéœ€è¦å®ç° BlockExceptionHanlder æ¥å£ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">BlockExcpetionHandler</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   * å¤„ç†è¯·æ±‚è¢«é™æµï¼Œé™çº§ï¼Œæˆæƒæ‹¦æˆªæ—¶æŠ›å‡ºçš„å¼‚å¸¸ï¼šBlockException</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BlockExcpetion</span> e<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è€Œ BlockException åŒ…å«å¾ˆå¤šä¸ªå­ç±»ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒçš„åœºæ™¯ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>å¼‚å¸¸</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>FlowException</td>\n<td>é™æµå¼‚å¸¸</td>\n</tr>\n<tr>\n<td>ParamFlowException</td>\n<td>çƒ­ç‚¹å‚æ•°é™æµçš„å¼‚å¸¸</td>\n</tr>\n<tr>\n<td>DegradeException</td>\n<td>é™çº§å¼‚å¸¸</td>\n</tr>\n<tr>\n<td>AuthorityException</td>\n<td>æˆæƒè§„åˆ™å¼‚å¸¸</td>\n</tr>\n<tr>\n<td>SystemBlockException</td>\n<td>ç³»ç»Ÿè§„åˆ™å¼‚å¸¸</td>\n</tr>\n</tbody>\n</table>\n<p>æˆ‘ä»¬åœ¨ order-service ä¸­å®šä¹‰ç±»ï¼Œå®ç° BlockExceptionHandler æ¥å£ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SentinelBlockHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">BlockExceptionHandler</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> httpServletRequest<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BlockException</span> e<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">String</span> msg <span class=\"token operator\">=</span> <span class=\"token string\">\"æœªçŸ¥å¼‚å¸¸\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">int</span> status <span class=\"token operator\">=</span> <span class=\"token number\">429</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>e <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">FlowException</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            msg <span class=\"token operator\">=</span> <span class=\"token string\">\"è¯·æ±‚è¢«é™æµäº† !\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>e <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">DegradeException</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            msg <span class=\"token operator\">=</span> <span class=\"token string\">\"è¯·æ±‚è¢«é™çº§äº† !\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>e <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">ParamFlowException</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            msg <span class=\"token operator\">=</span> <span class=\"token string\">\"çƒ­ç‚¹å‚æ•°é™æµ !\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>e <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">AuthorityException</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            msg <span class=\"token operator\">=</span> <span class=\"token string\">\"è¯·æ±‚æ²¡æœ‰æƒé™ !\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            status <span class=\"token operator\">=</span> <span class=\"token number\">401</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        response<span class=\"token punctuation\">.</span><span class=\"token function\">setContentType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"application/json;charset=utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        response<span class=\"token punctuation\">.</span><span class=\"token function\">setStatus</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        response<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&#123;\\\"message\\\": \\\"\"</span> <span class=\"token operator\">+</span> msg <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\",\\\"status\\\": \"</span> <span class=\"token operator\">+</span> status <span class=\"token operator\">+</span> <span class=\"token string\">\"&#125;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>é‡å¯ orderservice æœåŠ¡ï¼Œç„¶åè®¿é—®ä¸€ä¸‹ order/101ã€‚å†å» Sentinel æ§åˆ¶å°æŸ¥çœ‹è”Ÿç‚¹é“¾è·¯å¹¶æ·»åŠ æˆæƒè§„åˆ™ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171629649.png\" alt=\"image-20231017162948414\" /></p>\n<p>ç„¶åå†å¯¹ order/101 è¿›è¡Œç›´æ¥è®¿é—®</p>\n<p>å¯ä»¥çœ‹åˆ°è‡ªå®šä¹‰å¼‚å¸¸æˆåŠŸäº†ï¼</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171630717.png\" alt=\"image-20231017163007309\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>è·å–è¯·æ±‚æ¥æºçš„æ¥å£æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>RequestOriginParser</li>\n</ul>\n<p>å¤„ç† BlockException çš„æ¥å£æ˜¯ä»€ä¹ˆ</p>\n<ul>\n<li>BlockExcpetionHandler</li>\n</ul>\n</blockquote>\n<h2 id=\"18-è§„åˆ™æŒä¹…åŒ–\"><a class=\"anchor\" href=\"#18-è§„åˆ™æŒä¹…åŒ–\">#</a> 1.8ã€è§„åˆ™æŒä¹…åŒ–ğŸŒ³</h2>\n<ul>\n<li>è§„åˆ™ç®¡ç†æ¨¡å¼</li>\n<li>å®ç° push æ¨¡å¼</li>\n</ul>\n<p>Sentinel çš„æ§åˆ¶å°è§„åˆ™ç®¡ç†æœ‰ä¸‰ç§æ¨¡å¼ï¼š</p>\n<ul>\n<li>åŸå§‹æ¨¡å¼ï¼šSentinel çš„é»˜è®¤æ¨¡å¼ï¼Œå°†è§„åˆ™ä¿å­˜åœ¨å†…å­˜ï¼Œé‡å¯æœåŠ¡ä¼šä¸¢å¤±ã€‚</li>\n<li>pull æ¨¡å¼</li>\n<li>push æ¨¡å¼</li>\n</ul>\n<h3 id=\"181-è§„åˆ™ç®¡ç†æ¨¡å¼-pullæ¨¡å¼\"><a class=\"anchor\" href=\"#181-è§„åˆ™ç®¡ç†æ¨¡å¼-pullæ¨¡å¼\">#</a> 1.8.1ã€è§„åˆ™ç®¡ç†æ¨¡å¼ - pull æ¨¡å¼ğŸŒ²</h3>\n<p>pull æ¨¡å¼ï¼šæ§åˆ¶å°å°†é…ç½®çš„è§„åˆ™æ¨é€åˆ° Sentinel å®¢æˆ·ç«¯ï¼Œè€Œå®¢æˆ·ç«¯ä¼šå°†é…ç½®è§„åˆ™ä¿å­˜åœ¨æœ¬åœ°æ–‡ä»¶æˆ–æ•°æ®åº“ä¸­ã€‚ä»¥åä¼šå®šæ—¶å»æœ¬åœ°æ–‡ä»¶æˆ–æ•°æ®åº“ä¸­æŸ¥è¯¢ï¼Œæ›´æ–°æœ¬åœ°è§„åˆ™ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171635037.png\" alt=\"image-20231017163548813\" /></p>\n<p>ç¼ºç‚¹ï¼šå­˜åœ¨æ—¶æ•ˆæ€§é—®é¢˜ï¼Œä»è€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´é—®é¢˜</p>\n<h3 id=\"182-è§„åˆ™ç®¡ç†æ¨¡å¼-pushæ¨¡å¼\"><a class=\"anchor\" href=\"#182-è§„åˆ™ç®¡ç†æ¨¡å¼-pushæ¨¡å¼\">#</a> 1.8.2ã€è§„åˆ™ç®¡ç†æ¨¡å¼ - push æ¨¡å¼ğŸŒ²</h3>\n<p>push æ¨¡å¼ï¼šæ§åˆ¶å°å°†é…ç½®è§„åˆ™æ¨é€åˆ°è¿œç¨‹é…ç½®ä¸­å¿ƒï¼Œä¾‹å¦‚ Nacosã€‚Sentinel å®¢æˆ·ç«¯ç›‘å¬ Nacosï¼Œè·å–é…ç½®å˜æ›´çš„æ¨é€æ¶ˆæ¯ï¼Œå®Œæˆæœ¬åœ°é…ç½®æ›´æ–°</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171639844.png\" alt=\"image-20231017163912849\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>Sentinel çš„ä¸‰ç§é…ç½®ç®¡ç†æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>\n<p>åŸå§‹æ¨¡å¼ï¼šä¿å­˜åœ¨å†…å­˜</p>\n<p>ä¸æ”¯æŒæŒä¹…åŒ–</p>\n</li>\n<li>\n<p>pull æ¨¡å¼ï¼šä¿å­˜åœ¨æœ¬åœ°æ–‡ä»¶æˆ–æ•°æ®åº“ï¼Œå®šæ—¶å»è¯»å–</p>\n<p>å®šæ—¶è½®è¯¢å­˜åœ¨æ—¶æ•ˆæ€§é—®é¢˜ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´</p>\n</li>\n<li>\n<p>push æ¨¡å¼ï¼šä¿å­˜åœ¨ Nacosï¼Œç›‘å¬å˜æ›´å®æ—¶æ›´æ–°</p>\n</li>\n</ul>\n</blockquote>\n<h3 id=\"183-å®ç°pushæ¨¡å¼\"><a class=\"anchor\" href=\"#183-å®ç°pushæ¨¡å¼\">#</a> 1.8.3ã€å®ç° push æ¨¡å¼ğŸŒ²</h3>\n<p>push æ¨¡å¼å®ç°æœ€ä¸ºå¤æ‚ï¼Œä¾èµ–äº Nacosï¼Œå¹¶ä¸”éœ€è¦ä¿®æ”¹ Sentinel æ§åˆ¶å°æºç ã€‚</p>\n<p>è¯¦ç»†æ­¥éª¤å¯ä»¥å‚è€ƒæ–‡ç« <a href=\"../sentinel%E6%8C%81%E4%B9%85%E5%8C%96/sentinel%E8%A7%84%E5%88%99%E6%8C%81%E4%B9%85%E5%8C%96.md\"> sentinel è§„åˆ™æŒä¹…åŒ–</a>.</p>\n<h1 id=\"äºŒ-åˆ†å¸ƒå¼äº‹åŠ¡\"><a class=\"anchor\" href=\"#äºŒ-åˆ†å¸ƒå¼äº‹åŠ¡\">#</a> äºŒã€åˆ†å¸ƒå¼äº‹åŠ¡ğŸ„</h1>\n<ul>\n<li>seata</li>\n</ul>\n<p><strong>äº‹åŠ¡çš„ ACID åŸåˆ™</strong></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171718973.png\" alt=\"image-20231017171810630\" /></p>\n<h2 id=\"21-åˆ†å¸ƒå¼æœåŠ¡æ¡ˆä¾‹\"><a class=\"anchor\" href=\"#21-åˆ†å¸ƒå¼æœåŠ¡æ¡ˆä¾‹\">#</a> 2.1ã€åˆ†å¸ƒå¼æœåŠ¡æ¡ˆä¾‹ğŸŒ³</h2>\n<p>å¾®æœåŠ¡ä¸‹å•ä¸šåŠ¡ï¼Œåœ¨ä¸‹å•æ—¶ä¼šè°ƒç”¨è®¢å•æœåŠ¡ï¼Œåˆ›å»ºè®¢å•å¹¶å†™å…¥æ•°æ®åº“ã€‚ç„¶åè®¢å•æœåŠ¡è°ƒç”¨è´¦æˆ·æœåŠ¡å’Œåº“å­˜æœåŠ¡ï¼š</p>\n<ul>\n<li>è´¦æˆ·æœåŠ¡è´Ÿè´£æ‰£å‡ç”¨æˆ·ä½™é¢</li>\n<li>åº“å­˜æœåŠ¡è´Ÿè´£æ‰£å‡å•†å“åº“å­˜</li>\n</ul>\n<p>æ¯”æ–¹è¯´ä»¥ä¸‹å¾®æœåŠ¡ï¼šé‡Œé¢åŒ…å«ä¸‰ä¸ªæœåŠ¡ è®¢å•æœåŠ¡ï¼Œè´¦æˆ·æœåŠ¡ï¼Œåº“å­˜æœåŠ¡ã€‚ç°åœ¨æœ‰ä¸€ä¸ªç”¨æˆ·ä¸‹å•çš„ä¸šåŠ¡ï¼Œç”¨æˆ·ä¸‹å•æ—¶æˆ‘å¸Œæœ›è®¢å•æœåŠ¡å»åˆ›å»ºè®¢å•å¹¶ä¸”å†™å…¥æ•°æ®åº“ï¼Œè€Œåå®ƒå†å»è°ƒç”¨è´¦æˆ·æœåŠ¡å’Œåº“å­˜æœåŠ¡ã€‚è´¦æˆ·æœåŠ¡å»æ‰£å‡ç”¨æˆ·çš„ä½™é¢ï¼Œè€Œåº“å­˜æœåŠ¡åˆ™å»æ‰£å‡å•†å“åº“å­˜ã€‚é‡Œé¢å°±åŒ…å«äº†ä¸‰ä¸ªä¸åŒçš„å¾®æœåŠ¡è°ƒç”¨ï¼Œè€Œæ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ•°æ®åº“ï¼Œä¹Ÿå°±æ˜¯ç‹¬ç«‹çš„äº‹åŠ¡ã€‚æœ€ç»ˆå¸Œæœ›çš„è‚¯å®šæ˜¯ä¸‹å•ä¸šåŠ¡ä¸€æ—¦æ‰§è¡Œæ¯ä¸€ä¸ªæœåŠ¡éƒ½è¦æˆåŠŸï¼Œå¦‚æœå¤±è´¥éƒ½å¤±è´¥ã€‚ä½†æ˜¯èƒ½ä¸èƒ½è¾¾åˆ°è¿™æ ·çš„ç»“æœå‘¢ä¸‹é¢è¿›è¡ŒéªŒè¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171720793.png\" alt=\"image-20231017172030706\" /></p>\n<h2 id=\"22-æ¼”ç¤ºåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜\"><a class=\"anchor\" href=\"#22-æ¼”ç¤ºåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜\">#</a> 2.2ã€æ¼”ç¤ºåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ ğŸŒ³</h2>\n<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ï¼Œä¸€ä¸ªä¸šåŠ¡è·¨è¶Šå¤šä¸ªæœåŠ¡æˆ–æ•°æ®æºï¼Œæ¯ä¸ªæœåŠ¡éƒ½æ˜¯ä¸€ä¸ªåˆ†æ”¯äº‹åŠ¡ï¼Œè¦ä¿è¯æ‰€æœ‰åˆ†æ”¯äº‹åŠ¡æœ€ç»ˆçŠ¶æ€ä¸€è‡´è¿™æ ·çš„äº‹åŠ¡å°±æ˜¯ &lt;font color='red'&gt; åˆ†å¸ƒå¼äº‹åŠ¡ &lt;/font&gt;.</p>\n<p>1ã€å¯¼å…¥å¾®æœåŠ¡é¡¹ç›®ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZG91a2FpeGluL3R5cG9yYS5naXQ=\">https://gitee.com/doukaixin/typora.git</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171737590.png\" alt=\"image-20231017173700559\" /></p>\n<p>2ã€åˆ›å»ºæ•°æ®åº“ï¼Œåä¸º seata_demoï¼Œç„¶åå¯¼å…¥ SQL æ–‡ä»¶ï¼Œæ”¹ SQL æ–‡ä»¶åœ¨ seata-demo é¡¹ç›®ä¸­çš„ SQL æ–‡ä»¶å¤¹ä¸­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171737039.png\" alt=\"image-20231017173733114\" /></p>\n<p>3ã€å¯åŠ¨ nacosï¼Œæ‰€æœ‰å¾®æœåŠ¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171955624.png\" alt=\"image-20231017195536248\" /></p>\n<p>4ã€æµ‹è¯•ä¸‹å•åŠŸèƒ½ï¼Œå‘é€ Post è¯·æ±‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171956965.png\" alt=\"image-20231017195605740\" /></p>\n<p>å‘é€è¯·æ±‚åæŸ¥çœ‹æ•°æ®åº“</p>\n<p>è´¦æˆ·è¡¨</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171956775.png\" alt=\"image-20231017195643886\" /></p>\n<p>åº“å­˜è¡¨</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171957799.png\" alt=\"image-20231017195701407\" /></p>\n<p>å¯ä»¥å‘ç°ï¼Œè´¦æˆ·ä½™é¢æ‰£äº† 200 å˜æˆäº† 800ï¼Œè€Œåº“å­˜æ‰£äº† 2 å˜æˆäº† 8</p>\n<p>é‚£ä¹ˆæˆ‘ä»¬è®©æ‰£é™¤åº“å­˜çš„æ—¶å€™æŠ¥é”™çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µã€‚</p>\n<p>ç°åœ¨åº“å­˜ä¸å¤Ÿ 10 ä¸ªäº†æˆ‘è¯·æ±‚æ‰£ 10 ä¸ªå°±ä¼šå‘ç”ŸæŠ¥é”™ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171958176.png\" alt=\"image-20231017195804119\" /></p>\n<p>å¯ä»¥çœ‹åˆ°å“åº”ç»“æœ 500 äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171958776.png\" alt=\"image-20231017195845362\" /></p>\n<p>æ­¤æ—¶æˆ‘ä»¬å†æŸ¥çœ‹æ•°æ®åº“çš„æƒ…å†µ</p>\n<p>è´¦æˆ·è¡¨</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171959625.png\" alt=\"image-20231017195918162\" /></p>\n<p>åº“å­˜è¡¨</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171959448.png\" alt=\"image-20231017195930412\" /></p>\n<p>è´¦æˆ·è¡¨çš„ä½™é¢è¢«æ‰£äº† 200ï¼Œä½†æ˜¯åº“å­˜è¡¨çš„æ•°é‡å´æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œè¿™æ ·æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ã€‚</p>\n<p>ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸‹è¿™ä»¶äº‹å„¿ã€‚</p>\n<p>åœ¨ä¸Šé¢çš„ä¸šåŠ¡ä¸­ï¼Œè®¢å•æœåŠ¡å»åˆ›å»ºäº†è®¢å•ç„¶åå»è°ƒç”¨äº†è´¦æˆ·æœåŠ¡å’Œåº“å­˜æœåŠ¡å®Œæˆä½™é¢æ‰£å‡å’Œåº“å­˜æ‰£å‡ï¼Œå…¶ä¸­è®¢å•æœåŠ¡å’Œè´¦æˆ·æœåŠ¡éƒ½åˆ›å»ºæˆåŠŸäº†ã€‚è€Œåº“å­˜æœåŠ¡åœ¨æ‰§è¡Œçš„æ—¶å€™å´å› ä¸ºåº“å­˜ä¸è¶³è€Œå¤±è´¥äº†ã€‚é‚£æŒ‰ç…§ç†è®ºä¸Šè®²è¿™é‡ŒæŠ¥é”™å‰é¢éƒ½åº”è¯¥è·Ÿç€å›æ»š</p>\n<p>åŸå› ï¼š</p>\n<p>1ã€æ¯ä¸ªæœåŠ¡éƒ½æ˜¯ç‹¬ç«‹çš„åº“å­˜æœåŠ¡æŠ›å‡ºå¼‚å¸¸å…¶å®ƒæœåŠ¡ä¹Ÿä¸çŸ¥é“</p>\n<p>2ã€æ¯ä¸ªæœåŠ¡éƒ½æ˜¯ç‹¬ç«‹çš„æ‰€ä»¥å®ƒä»¬çš„äº‹åŠ¡ä¹Ÿæ˜¯ç‹¬ç«‹çš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310172023838.png\" alt=\"image-20231017202319388\" /></p>\n<p>å¦‚æœè¦è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„é—®é¢˜ï¼Œé¦–å…ˆè¦è€ƒè™‘å››ç‚¹ï¼š</p>\n<p>é¦–å…ˆç¬¬ä¸€ç‚¹ï¼šåˆ†å¸ƒå¼äº‹åŠ¡äº§ç”Ÿçš„åŸå› ï¼Œè¿™ä¸ªä¸Šè¿°åˆ†æè¿‡äº†ã€‚</p>\n<p>ç¬¬äºŒç‚¹ï¼šç†è§£ç†è®ºåŸºç¡€</p>\n<p>ç¬¬ä¸‰ç‚¹ï¼šå¼„æ¸… seata åŸç†</p>\n<p>ç¬¬å››ç‚¹ï¼šåˆ©ç”¨ seata æ‰‹åŠ¨å®è·µï¼Œè§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310172032081.png\" alt=\"image-20231017203228913\" /></p>\n<p>å­¦ä¹ å†…å®¹ï¼š</p>\n<ul>\n<li>ç†è®ºåŸºç¡€</li>\n<li>åˆå§‹ Seata</li>\n<li>æ‰‹åŠ¨å®è·µ</li>\n<li>é«˜å¯ç”¨</li>\n</ul>\n<h2 id=\"23-ç†è®ºåŸºç¡€\"><a class=\"anchor\" href=\"#23-ç†è®ºåŸºç¡€\">#</a> 2.3ã€ç†è®ºåŸºç¡€ğŸŒ³</h2>\n<ul>\n<li>CAP å®šç†</li>\n<li>BASE ç†è®º</li>\n</ul>\n<h3 id=\"231-capå®šç†\"><a class=\"anchor\" href=\"#231-capå®šç†\">#</a> 2.3.1ã€CAP å®šç†ğŸŒ²</h3>\n<p>1998 å¹´ï¼ŒåŠ å·å¤§å­¦çš„è®¡ç®—æœºç§‘å­¦ Eric Brewer æå‡ºï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿæœ‰ä¸‰ä¸ªæŒ‡æ ‡ï¼š</p>\n<p>1ã€Consistency (ä¸€è‡´æ€§)</p>\n<p>2ã€Availability (å¯ç”¨æ€§)</p>\n<p>3ã€Partition tolerance (åˆ†åŒºå®¹é”™æ€§)</p>\n<p>Eric Brewer è¯´ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿæ— æ³•åŒæ—¶æ»¡è¶³è¿™ä¸‰ä¸ªæŒ‡æ ‡ã€‚</p>\n<p>è¿™ä¸ªç»“è®ºå°±å«åš CAP å®šç†ã€‚</p>\n<p>ä¸‰ä¸ªåœ†ä¸ä¼šåŒæ—¶é‡å ï¼Œæœ€å¤šä¸¤ä¸¤é‡å ï¼Œä¹Ÿå°±æ˜¯è¯´åŒæ—¶æ»¡è¶³ä¸¤ä¸ª</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310172037268.png\" alt=\"image-20231017203753986\" /></p>\n<h4 id=\"2311-capå®šç†-consistency\"><a class=\"anchor\" href=\"#2311-capå®šç†-consistency\">#</a> 2.3.1.1ã€CAP å®šç† - ConsistencyğŸŒ´</h4>\n<p>Consistency (ä¸€è‡´æ€§) ï¼šç”¨æˆ·è®¿é—®åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä»»æ„èŠ‚ç‚¹ï¼Œå¾—åˆ°çš„æ•°æ®å¿…é¡»ä¸€è‡´</p>\n<p>æ¯”æ–¹è¯´æœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸Šæœ‰ä¸ªæ•°æ®å« data å€¼ä¸º 0ï¼Œç¬¬äºŒä¸ªèŠ‚ç‚¹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ç°åœ¨ç”¨æˆ·ä¸ç®¡æ˜¯è®¿é—®å“ªä¸ªèŠ‚ç‚¹ï¼Œç»“æœéƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310172043065.png\" alt=\"image-20231017204312228\" /></p>\n<p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘å¯¹èŠ‚ç‚¹ node1 çš„æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œè¿™æ—¶ä¸¤ä¸ªèŠ‚ç‚¹çš„æ•°æ®å°±ä¸ä¸€æ ·äº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310172044702.png\" alt=\"image-20231017204437374\" /></p>\n<p>ä¸ºäº†æ»¡è¶³ä¸€è‡´æ€§å°±ä¸€å®šè¦æŠŠ node1 çš„æ•°æ®åŒæ­¥åˆ° node2 ä¸­ï¼Œä¸€æ—¦æ•°æ®åŒæ­¥å®Œæˆï¼Œæ•°æ®å°±å†æ­¤ä¸€è‡´äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310172044179.png\" alt=\"image-20231017204454104\" /></p>\n<p>æ‰€ä»¥ï¼Œä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨åšæ•°æ®å¤‡ä»½çš„æ—¶å€™ä¸€å®šè¦åŠæ—¶å®Œæˆæ•°æ®åŒæ­¥è¿™æ ·æ‰èƒ½æ»¡è¶³ä¸€è‡´æ€§</p>\n<h4 id=\"2312-capå®šç†-availability\"><a class=\"anchor\" href=\"#2312-capå®šç†-availability\">#</a> 2.3.1.2ã€CAP å®šç† - AvailabilityğŸŒ´</h4>\n<p>Availability (å¯ç”¨æ€§) ï¼šç”¨æˆ·è®¿é—®é›†ç¾¤ä¸­çš„ä»»æ„å¥åº·èŠ‚ç‚¹ï¼Œå¿…é¡»èƒ½å¾—åˆ°å“åº”ï¼Œè€Œä¸æ˜¯è¶…æ—¶æˆ–æ‹’ç»</p>\n<p>æ¯”å¦‚è¯´ node3 çš„è¯·æ±‚è¢«é˜»å¡æˆ–è€…æ‹’ç»äº†ï¼Œé‚£æ‰€æœ‰çš„è¯·æ±‚è¿›æ¥æ— æ³•è®¿é—®äº†ï¼Œè¿™æ—¶ node3 å°±æ˜¯ä¸å¯ç”¨äº†</p>\n<p>æ‰€ä»¥å¯ç”¨æ€§æ˜¯æŒ‡è¿™ä¸ªèŠ‚ç‚¹èƒ½ä¸èƒ½è¢«æ­£å¸¸çš„è®¿é—®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310172048465.png\" alt=\"image-20231017204818409\" /></p>\n<h4 id=\"2313-capå®šç†-partition-tolerance\"><a class=\"anchor\" href=\"#2313-capå®šç†-partition-tolerance\">#</a> 2.3.1.3ã€CAP å®šç† - Partition toleranceğŸŒ´</h4>\n<p>Partition (åˆ†åŒº) ï¼šå› ä¸ºç½‘ç»œæ•…éšœæˆ–å…¶å®ƒåŸå› å¯¼è‡´åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„éƒ¨åˆ†èŠ‚ç‚¹ä¸å…¶å®ƒèŠ‚ç‚¹å¤±å»è¿æ¥ï¼Œå½¢æˆç‹¬ç«‹åˆ†åŒºã€‚</p>\n<p>Tolerance (å®¹é”™) ï¼šåœ¨é›†ç¾¤å‡ºç°åˆ†åŒºæ—¶ï¼Œæ•´ä¸ªç³»ç»Ÿä¹Ÿè¦æŒç»­å¯¹å¤–æä¾›æœåŠ¡</p>\n<p>æ¯”å¦‚è¯´ node3 å› ä¸ºç½‘ç»œæ•…éšœä¸ node1 ä¸ node2 æ–­å¼€äº†è¿æ¥ã€‚node1 ä¸ node2 ä¹‹é—´æ­£å¸¸è®¿é—®ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310172052718.png\" alt=\"image-20231017205201677\" /></p>\n<p>æ­¤æ—¶æ•´ä¸ªé›†ç¾¤å°±ä¼šè¢«åˆ’åˆ†æˆä¸¤ä¸ªåŒºäº†ã€‚node1 å’Œ node2 å®ƒä¿©æ˜¯ä¸€ä¸ªåŒºï¼Œnode3 è‡ªå·±æ˜¯ä¸€ä¸ªåŒºï¼Œè¿™æ—¶å¦‚æœæœ‰ç”¨æˆ·å‘ node2 å†™å…¥äº†ä¸€ä¸ªæ•°æ®ï¼Œnode2 å¯ä»¥æŠŠæ•°æ®åŒæ­¥ç»™ node1 çš„ä½†æ˜¯ node3 ä¸Šä¸èƒ½åŒæ­¥åˆ°æ•°æ®ï¼Œå› æ­¤è¿™ä¸¤ä¸ªåŒºçš„æ•°æ®å°±ä¸ä¸€è‡´äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310172055775.png\" alt=\"image-20231017205544452\" /></p>\n<p>é‚£å¦‚æœæˆ‘ä¸€å®šè¦æ»¡è¶³æ•°æ®çš„ä¸€è‡´æ€§å‘¢ï¼Œé‚£æˆ‘æ˜¯ä¸æ˜¯å¯ä»¥è®© node3 ç­‰å¾… node2 ç½‘ç»œçš„æ¢å¤å’Œæ•°æ®çš„åŒæ­¥ï¼Œåœ¨æ¢å¤ä¹‹å‰æ‰€æœ‰æ¥è®¿é—®æˆ‘çš„è¯·æ±‚æˆ‘éƒ½é˜»å¡åœ¨è¿™é‡Œã€‚å¦‚æœè¿™ä¹ˆåšå¯èƒ½ä¼šæ»¡è¶³æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä½†æ˜¯ node3 æ˜æ˜æ˜¯ä¸€ä¸ªå¥åº·çš„èŠ‚ç‚¹ç»“æœè¿›æ¥çš„è¯·æ±‚ä½ éƒ½å¡åœ¨è¿™é‡Œä¸è®©äººå®¶è®¿é—®ï¼Œé‚£ node3 ä¸å°±æ˜¯ä¸å¯ç”¨äº†å—ï¼Œæ‰€ä»¥å®ƒå°±ä¸æ»¡è¶³ å¯ç”¨æ€§äº†ã€‚</p>\n<p>æˆ‘è¦æƒ³æ»¡è¶³å¯ç”¨æ€§ï¼Œæˆ‘å°±æ²¡åŠæ³•ä¿è¯ä¸€è‡´æ€§ã€‚</p>\n<p>æˆ‘è¦ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œæˆ‘å°±æ²¡åŠæ³•è®© node3 æ˜¯å¯ç”¨æ€§çš„</p>\n<p>å½“ç½‘ç»œå‡ºç°åˆ†åŒºæ—¶ï¼Œå¯ç”¨æ€§å’Œä¸€è‡´æ€§æ²¡æœ‰åŠæ³•åŒæ—¶æ»¡è¶³ã€‚ä½†æ˜¯ç½‘ç»œåˆ†åŒºä¹Ÿæ˜¯ä¸å¯é¿å…çš„ã€‚</p>\n<p>å½“ p ä¸€å®šè¦å®ç°ï¼Œé‚£ä¹ˆè¿™æ—¶ c å’Œ a ä¹‹é—´å°±è¦åšå‡ºæŠ‰æ‹©äº†ã€‚è¦ä¹ˆ c è¦ä¹ˆ a æ²¡æœ‰åŠæ³•åŒæ—¶æ»¡è¶³ã€‚è¿™å°±æ˜¯ CAP å®šç†äº†çš„åŸå› äº†</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>ç®€è¿° CAP å®šç†å†…å®¹ï¼Ÿ</p>\n<ul>\n<li>åˆ†å¸ƒå¼ç³»ç»ŸèŠ‚ç‚¹é€šè¿‡ç½‘ç»œè¿æ¥ï¼Œä¸€å®šä¼šå‡ºç°åˆ†åŒºé—®é¢˜ (P)</li>\n<li>å½“åˆ†åŒºå‡ºç°æ—¶ï¼Œç³»ç»Ÿçš„ä¸€è‡´æ€§ (C) å’Œå¯ç”¨æ€§ (A) å°±æ— æ³•åŒæ—¶æ»¡è¶³</li>\n</ul>\n<p>æ€è€ƒï¼šelasticsearch é›†ç¾¤æ˜¯ CP è¿˜æ˜¯ APï¼Ÿ</p>\n<p>ç­”ï¼šES é›†ç¾¤å½“ç½‘ç»œå‡ºç°æ•…éšœæ—¶ï¼Œæœ‰èŠ‚ç‚¹ä¸å…¶å®ƒèŠ‚ç‚¹æ–­å¼€è¿æ¥çš„æ—¶å€™ã€‚es é›†ç¾¤å¤„äºä¸€ä¸ªè­¦å‘ŠçŠ¶æ€ï¼Œå‡ºç°æ•…éšœçš„èŠ‚ç‚¹è¿‡äº†ä¸€æ®µæ—¶é—´åå°±ä¼šä»é›†ç¾¤ä¸­å‰”é™¤ï¼Œè€Œè¿™ä¸ªèŠ‚ç‚¹ä¸ŠåŸæ¥çš„æ•°æ®åˆ†ç‰‡ã€‚ä¼šåˆ†æ•£åˆ°å…¶å®ƒå¥åº·çš„èŠ‚ç‚¹ä¸Šï¼Œè€Œæ•…éšœèŠ‚ç‚¹ä»é›†ç¾¤ä¸­å‰”é™¤ç”¨æˆ·æ— æ³•è®¿é—®äº†å› æ­¤å°±ç‰ºç‰²äº† å¯ç”¨æ€§äº†ã€‚è€Œæ•°æ®ä¼šè´Ÿè´£å…¶å®ƒèŠ‚ç‚¹æ•°æ®åŒæ­¥å¯ä»¥æ­£å¸¸è¿›è¡Œä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p>\n<p>å› æ­¤ es é›†ç¾¤æ˜¾ç„¶æ˜¯ä¸€ä¸ª CPã€‚æ»¡è¶³é«˜ä¸€è‡´æ€§ä½å¯ç”¨æ€§</p>\n</blockquote>\n<p>æˆ‘ä»¬çŸ¥é“åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ç½‘ç»œåˆ†åŒºæ˜¯ä¸å¯é¿å…çš„ï¼Œæ‰€ä»¥ä¸å¾—ä¸åœ¨ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ä¹‹é—´åšå‡ºä¸€ä¸ªé€‰æ‹©ã€‚</p>\n<p>ä½†æ˜¯è¿™ä¸¤ä¸ªç‰¹æ€§éƒ½å¾ˆé‡è¦æˆ‘ä¸€ä¸ªéƒ½ä¸æƒ³æ”¾å¼ƒæˆ‘è¯¥æ€ä¹ˆåŠå‘¢ï¼ŸBase ç†è®ºæ­£å¥½å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜</p>\n<h3 id=\"232-baseç†è®º\"><a class=\"anchor\" href=\"#232-baseç†è®º\">#</a> 2.3.2ã€BASE ç†è®ºğŸŒ²</h3>\n<p>BASE ç†è®ºæ˜¯å¯¹ CAP çš„ä¸€ç§è§£å†³æ€è·¯ï¼ŒåŒ…å«ä¸‰ä¸ªæ€æƒ³ï¼š</p>\n<ul>\n<li>Basically Available (åŸºæœ¬å¯ç”¨)ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœæ—¶ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼Œå³ä¿è¯æ ¸å¿ƒå¯ç”¨ã€‚</li>\n<li>Soft State (è½¯çŠ¶æ€)ï¼šåœ¨ä¸€å®šæ—¶é—´å†…ï¼Œå…è®¸å‡ºç°ä¸­é—´çŠ¶æ€ï¼Œæ¯”å¦‚ä¸´æ—¶çš„ä¸ä¸€è‡´çŠ¶æ€ã€‚</li>\n<li>Eventually Consistent (æœ€ç»ˆä¸€è‡´æ€§)ï¼šè™½ç„¶æ— æ³•ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œä½†æ˜¯åœ¨è½¯çŠ¶æ€ç»“æŸåï¼Œæœ€ç»ˆè¾¾åˆ°æ•°æ®ä¸€è‡´ã€‚</li>\n</ul>\n<p>è€Œåˆ†å¸ƒå¼äº‹åŠ¡æœ€å¤§çš„é—®é¢˜æ˜¯å„ä¸ªå­äº‹åŠ¡çš„ä¸€è‡´æ€§é—®é¢˜ï¼Œå› æ­¤å¯ä»¥å€Ÿç­¾ CAP å®šç†çš„ BASE ç†è®ºï¼š</p>\n<ul>\n<li>AP æ¨¡å¼ï¼šå„å­äº‹åŠ¡åˆ†åˆ«æ‰§è¡Œå’Œæäº¤ï¼Œå…è®¸å‡ºç°ç»“æœä¸ä¸€è‡´ï¼Œç„¶åé‡‡ç”¨å¼¥è¡¥æªæ–½æ¢å¤æ•°æ®å³å¯ï¼Œå®ç° &lt;font color='red'&gt; æœ€ç»ˆä¸€è‡´ &lt;/font&gt;.</li>\n<li>CP æ¨¡å¼ï¼šå„ä¸ªå­äº‹åŠ¡æ‰§è¡Œåäº’ç›¸ç­‰å¾…ï¼ŒåŒæ—¶æäº¤ï¼ŒåŒæ—¶å›æ»šï¼Œè¾¾æˆ &lt;font color='red'&gt; å¼ºä¸€è‡´ &lt;/font&gt;ã€‚ä½†äº‹åŠ¡ç­‰å¾…è¿‡ç¨‹ä¸­ï¼Œå¤„äºå¼±å¯ç”¨çŠ¶æ€ã€‚</li>\n</ul>\n<h4 id=\"2321-åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹\"><a class=\"anchor\" href=\"#2321-åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹\">#</a> 2.3.2.1ã€åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹ğŸŒ´</h4>\n<p>è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå„ä¸ªå­ç³»ç»Ÿä¹‹é—´å¿…é¡»èƒ½æ„ŸçŸ¥åˆ°å½¼æ­¤çš„äº‹åŠ¡çŠ¶æ€ï¼Œæ‰èƒ½ä¿è¯çŠ¶æ€ä¸€è‡´ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªäº‹åŠ¡åè°ƒè€…æ¥åè°ƒæ¯ä¸€ä¸ªäº‹åŠ¡çš„å‚ä¸è€… (å­ç³»ç»Ÿäº‹åŠ¡)ã€‚</p>\n<p>ç”¨æˆ·ä¸‹å•è°ƒç”¨è®¢å•æœåŠ¡ï¼Œç„¶åå»è°ƒç”¨è´¦æˆ·æœåŠ¡å’Œåº“å­˜æœåŠ¡ã€‚é‚£è¿™ä¸ªåœ°æ–¹æˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªäº‹åŠ¡çš„åè°ƒè€…äº†ï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½è·Ÿäº‹åŠ¡åè°ƒè€…ä¿æŒè”ç³»ï¼Œå¦‚æœä½ ç°åœ¨è¦åšå¼ºä¸€è‡´ã€‚è®¢å•æœåŠ¡æ‰§è¡Œçš„æ—¶å€™ä¸è¦æäº¤ï¼Œæ‰£æ¬¾æœåŠ¡ï¼Œæ‰£åº“å­˜æœåŠ¡ï¼Œä½†æ˜¯åº“å­˜æœåŠ¡æ‰§è¡Œå®Œåå‘ç°å¤±è´¥äº†ã€‚æ€ä¹ˆçŸ¥é“çš„ã€‚å®ƒä»¬è¦æŠŠè‡ªå·±çš„æ‰§è¡Œç»“æœå‘ŠçŸ¥ç»™åè°ƒè€…ï¼Œç„¶ååè°ƒè€…ä¸€çœ‹æœ‰äººå¤±è´¥äº†å°†æ¥å†é€šçŸ¥å…¶å®ƒæœåŠ¡è®©å®ƒä»¬åšå›æ»šï¼Œè¿™æ ·å¤§å®¶å°±èƒ½ä¿æŒä¸€è‡´äº†</p>\n<p>æ¯ä¸€ä¸ªäº‹åŠ¡çš„å‚ä¸è€… (å­ç³»ç»Ÿäº‹åŠ¡)ã€‚</p>\n<p>è¿™é‡Œçš„å­ç³»ç»Ÿäº‹åŠ¡ï¼Œç§°ä¸º &lt;font color='red'&gt; åˆ†æ”¯äº‹åŠ¡ &lt;/font&gt;.ï¼›æœ‰å…³è”çš„å„ä¸ªåˆ†æ”¯äº‹åŠ¡ åœ¨ä¸€èµ·ç§°ä¸º &lt;font color='red'&gt; å…¨å±€äº‹åŠ¡ &lt;/font&gt;.</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310172141933.png\" alt=\"image-20231017214146879\" /></p>\n<p>æ‰€ä»¥äº‹åŠ¡åè°ƒè€…ï¼Œå°±æ˜¯å»åè°ƒå„ä¸ªåˆ†æ”¯äº‹ç‰©çš„çŠ¶æ€è®©å®ƒä»¬è¾¾æˆä¸€è‡´</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>ç®€è¿° BASE ç†è®ºä¸‰ä¸ªæ€æƒ³ï¼š</p>\n<ol>\n<li>åŸºæœ¬å¯ç”¨</li>\n<li>è½¯çŠ¶æ€</li>\n<li>æœ€ç»ˆä¸€è‡´</li>\n</ol>\n<p>è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„æ€æƒ³å’Œæ¨¡å‹ï¼š</p>\n<ol>\n<li>å…¨å±€äº‹åŠ¡ï¼šæ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡</li>\n<li>åˆ†æ”¯äº‹åŠ¡ï¼šåˆ†å¸ƒå¼äº‹åŠ¡ä¸­åŒ…å«çš„æ¯ä¸ªå­ç³»ç»Ÿçš„äº‹åŠ¡</li>\n<li>æœ€ç»ˆä¸€è‡´æ€æƒ³ï¼šå„åˆ†æ”¯äº‹åŠ¡åˆ†åˆ«æ‰§è¡Œå¹¶æäº¤ï¼Œå¦‚æœæœ‰ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå†æƒ³åŠæ³•æ¢å¤æ•°æ®</li>\n<li>å¼ºä¸€è‡´æ€æƒ³ï¼šå„åˆ†æ”¯äº‹åŠ¡æ‰§è¡Œå®Œä¸šåŠ¡ä¸è¦æäº¤ï¼Œç­‰å¾…å½¼æ­¤ç»“æœã€‚è€Œåç»Ÿä¸€æäº¤æˆ–å›æ»š</li>\n</ol>\n</blockquote>\n<h2 id=\"24-åˆå§‹seata\"><a class=\"anchor\" href=\"#24-åˆå§‹seata\">#</a> 2.4ã€åˆå§‹ SeatağŸŒ³</h2>\n<ul>\n<li>Seata çš„æ¶æ„</li>\n<li>éƒ¨ç½² TC æœåŠ¡</li>\n<li>å¾®æœåŠ¡é›†æˆ Seata</li>\n</ul>\n<p>Seata æ˜¯ 2019 å¹´ 1 æœˆä»½èš‚èšé‡‘æœå’Œé˜¿é‡Œå·´å·´å…±åŒå¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚è‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ï¼Œä¸ºç”¨æˆ·æ‰“é€ ä¸€ç«™å¼çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆã€‚</p>\n<p>å®˜ç½‘åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWF0YS5pby96aC1jbi8=\">https://seata.io/zh-cn/</span></p>\n<p><strong>Seata äº‹åŠ¡ç®¡ç†ä¸­æœ‰ä¸‰ä¸ªé‡è¦çš„è§’è‰²</strong>ï¼š</p>\n<p>1ã€TC (Transaction Coordinator) - äº‹åŠ¡åè°ƒè€…ï¼šç»´æŠ¤å…¨å±€å’Œåˆ†å¸ƒå¼äº‹åŠ¡çš„çŠ¶æ€ï¼Œåè°ƒå…¨å±€äº‹åŠ¡æäº¤å’Œå›æ»šã€‚</p>\n<p>2ã€TM (Transaction Manager) - äº‹åŠ¡ç®¡ç†å™¨ï¼šå®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ï¼Œå¼€å§‹å…¨å±€äº‹åŠ¡ï¼Œæäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚</p>\n<p>3ã€RM (Resource Manager) - èµ„æºç®¡ç†å™¨ï¼šç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸ TC äº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180745437.png\" alt=\"image-20231018074554248\" /></p>\n<p>Seata æ ¹æ®è¦åšå¼ºä¸€è‡´è¿˜æ˜¯æœ€ç»ˆä¸€è‡´åˆå»¶ä¼¸å‡ºäº†å¥½å‡ ç§ä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼š</p>\n<p><strong>Seata æä¾›äº†å››ä¸ªä¸åŒçš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>\n<p>1ã€XA æ¨¡å¼ï¼šå¼ºä¸€è‡´æ€§åˆ†é˜¶æ®µäº‹åŠ¡æ¨¡å¼ï¼Œç‰ºç‰²äº†ä¸€å®šçš„å¯ç”¨æ€§ï¼Œæ— ä¸šåŠ¡ä¾µå…¥</p>\n<p>2ã€TCC æ¨¡å¼ï¼šæœ€ç»ˆä¸€è‡´çš„åˆ†é˜¶æ®µäº‹åŠ¡æ¨¡å¼ï¼Œæœ‰ä¸šåŠ¡ä¾µå…¥</p>\n<p>3ã€AT æ¨¡å¼ï¼šæœ€ç»ˆä¸€è‡´çš„åˆ†é˜¶æ®µäº‹åŠ¡æ¨¡å¼ï¼Œæ— ä¸šåŠ¡ä¾µå…¥ï¼Œä¹Ÿæ˜¯ Seata çš„é»˜è®¤æ¨¡å¼</p>\n<p>4ã€SAGA æ¨¡å¼ï¼šé•¿äº‹åŠ¡æ¨¡å¼ï¼Œæœ‰ä¸šåŠ¡ä¾µå…¥</p>\n<h3 id=\"241-éƒ¨ç½²tcæœåŠ¡\"><a class=\"anchor\" href=\"#241-éƒ¨ç½²tcæœåŠ¡\">#</a> 2.4.1ã€éƒ¨ç½² TC æœåŠ¡ğŸŒ²</h3>\n<p>å‚è€ƒæ–‡ç« ï¼š<a href=\"../Seata/seata%E7%9A%84%E9%83%A8%E7%BD%B2%E5%92%8C%E9%9B%86%E6%88%90.md\">seata çš„éƒ¨ç½²å’Œé›†æˆ</a>.</p>\n<h3 id=\"242-æ‰‹åŠ¨å®è·µ\"><a class=\"anchor\" href=\"#242-æ‰‹åŠ¨å®è·µ\">#</a> 2.4.2ã€æ‰‹åŠ¨å®è·µğŸŒ²</h3>\n<ul>\n<li>XA æ¨¡å¼</li>\n<li>AT æ¨¡å¼</li>\n<li>TCC æ¨¡å¼</li>\n<li>SAGA æ¨¡å¼</li>\n</ul>\n<h4 id=\"2421-xaæ¨¡å¼åŸç†\"><a class=\"anchor\" href=\"#2421-xaæ¨¡å¼åŸç†\">#</a> 2.4.2.1ã€XA æ¨¡å¼åŸç†ğŸŒ´</h4>\n<p>XA è§„åˆ™ æ˜¯ X/Open ç»„ç»‡å®šä¹‰çš„åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç† (DTPï¼ŒDistributed Transaction Processing) æ ‡å‡†ï¼ŒXA è§„èŒƒ æè¿°äº†å…¨å±€çš„ TM ä¸å±€éƒ¨çš„ RM ä¹‹é—´çš„æ¥å£ï¼Œå‡ ä¹æ‰€æœ‰ä¸»æµçš„æ•°æ®åº“éƒ½å¯¹ XA è§„èŒƒ æä¾›äº†æ”¯æŒã€‚</p>\n<p>è¿™ç§æ¨¡å¼ï¼Œå®ƒæŠŠåˆ†å¸ƒå¼äº‹åŠ¡å®šä¹‰æˆäº†ä¸¤ä¸ªé˜¶æ®µã€‚ç¬¬ä¸€é˜¶æ®µä¸º â€œå‡†å¤‡é˜¶æ®µâ€ åœ¨æ­¤é˜¶æ®µä¸­å®ç‰©åè°ƒè€…ä¼šå‘äº‹åŠ¡å‚ä¸è€… (RM) å»å‘èµ·ä¸€ä¸ªå‡†å¤‡çš„è¯·æ±‚ï¼Œåœ¨ä¸Šé¢è®²è¿°ä¸­ RM æ˜¯èµ„æºç®¡ç†å™¨ï¼Œä½†æ˜¯åœ¨ XA æ ‡å‡†ä¸­è¿™ä¸ª RM å…¶å®éƒ½æ˜¯ç”±æ•°æ®åŒºå®ç°çš„ã€‚ä¹Ÿå°±æ˜¯è¯´æ•°æ®åº“æœ¬èº«å®ç°äº† RM åŠŸèƒ½ã€‚äº‹åŠ¡åè°ƒè€…é€šçŸ¥è¿™äº›æ•°æ®åº“å»æ‰§è¡Œè‡ªå·±çš„ä¸šåŠ¡ï¼Œä½†æ˜¯æ‰§è¡Œå®Œä¸è¦æäº¤ï¼Œç„¶åæŠŠæ‰§è¡Œç»“æœå‘ŠçŸ¥äº‹åŠ¡åè°ƒè€…</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181016731.png\" alt=\"Snipaste_2023-10-18_10-16-42\" /></p>\n<p>ç„¶åè¿›è¡Œ â€œç¬¬äºŒé˜¶æ®µâ€ äº‹åŠ¡åè°ƒè€…é€šçŸ¥ RM å¯ä»¥æäº¤äº†ã€‚äº‹åŠ¡ç»“æŸ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181017816.png\" alt=\"image-20231018101741714\" /></p>\n<p>å¦‚æœ ç¬¬ä¸€é˜¶æ®µ æœ‰ä»»æ„ä¸€ä¸ªæœåŠ¡å¤±è´¥äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181018842.png\" alt=\"image-20231018101839751\" /></p>\n<p>é‚£ä¹ˆç¬¬äºŒé˜¶æ®µï¼Œäº‹åŠ¡åè°ƒè€…å°±ä¼šé€šçŸ¥æ‰€æœ‰çš„ RM è¿›è¡Œå›æ»š</p>\n<p>XA æ¨¡å¼ï¼Œå…¶å®å°±æ˜¯åŸºäºæ•°æ®åº“æœ¬èº«çš„ç‰¹æ€§å»å®ç°çš„ä¸€ç§åˆ†å¸ƒå¼äº‹åŠ¡</p>\n<h4 id=\"2422-seataçš„xaæ¨¡å¼\"><a class=\"anchor\" href=\"#2422-seataçš„xaæ¨¡å¼\">#</a> 2.4.2.2ã€seata çš„ XA æ¨¡å¼ğŸŒ´</h4>\n<p>seata çš„ XA æ¨¡å¼åšäº†ä¸€äº›è°ƒæ•´ï¼Œä½†å¤§ä½“ç›¸ä¼¼ï¼š</p>\n<p>TM æ³¨å†Œå…¨å±€äº‹åŠ¡ï¼ŒTM ä½œä¸ºåˆ†å¸ƒå¼å…¥å£è‡ªç„¶å»è°ƒç”¨å¾®æœåŠ¡ï¼Œè°ƒç”¨å¾®æœåŠ¡é‡Œé¢çš„ RM æ‹¦æˆªè¯·æ±‚ï¼Œseata é‡Œé¢ä¹Ÿå®ç°äº† RMï¼Œæ•°æ®åº“ä¹Ÿæœ‰ RMï¼Œåœ¨è¿™ä¸ªæƒ…å†µä¸‹ seata çš„ RM ä»…ä»…æ˜¯ä»£ç†ä½ çš„è¯·æ±‚ã€‚ç„¶ååšä¸€ä¸‹åˆ†æ”¯äº‹åŠ¡çš„æ³¨å†Œï¼Œæ¥ä¸‹æ¥çš„äº‹å°±æ˜¯ç›´æ¥è°ƒç”¨æ•°æ®åº“äº†æ‰§è¡Œä¸šåŠ¡ SQLï¼Œä½†æ˜¯æ‰§è¡Œå®Œä¸æäº¤ï¼Œå»æŠ¥å‘Šä¸€ä¸‹äº‹åŠ¡çš„çŠ¶æ€åˆ° TC å°±è¡Œäº†ã€‚æ‰€ä»¥ TC æ­¤æ—¶å°±å†²å½“äº†äº‹åŠ¡åè°ƒçš„ä½œç”¨äº†</p>\n<p>è‡³æ­¤ï¼Œç¬¬ä¸€é˜¶æ®µç»“æŸ</p>\n<p>ç¬¬äºŒé˜¶æ®µ TM å‘ç°ä¸šåŠ¡ç»“æŸäº†å°±å»é€šçŸ¥ TCï¼Œç„¶å TC å»æ£€æŸ¥äº‹åŠ¡çš„çŠ¶æ€ï¼Œéƒ½æˆåŠŸå°±æˆåŠŸã€‚æœ‰ä¸€ä¸ªå¤±è´¥å°±è¦å›æ»š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181126968.png\" alt=\"image-20231018112632854\" /></p>\n<p>å¦‚æœæˆ‘ä»¬åªçœ‹æ ¸å¿ƒéƒ¨åˆ†å°±å’Œ XA æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„åŒºåˆ«äº†</p>\n<p><strong>RM ä¸€é˜¶æ®µçš„å·¥ä½œ</strong>ï¼š</p>\n<p>1ã€æ³¨å†Œåˆ†æ”¯å®ç‰©åˆ° TC</p>\n<p>2ã€æ‰§è¡Œåˆ†æ”¯ä¸šåŠ¡ sql ä½†ä¸æäº¤</p>\n<p>3ã€æŠ¥å‘Šæ‰§è¡ŒçŠ¶æ€åˆ° TC</p>\n<p><strong>TC äºŒé˜¶æ®µçš„å·¥ä½œ</strong>ï¼š</p>\n<ul>\n<li>TC æ£€æµ‹å„åˆ†æ”¯äº‹åŠ¡æ‰§è¡ŒçŠ¶æ€\n<ul>\n<li>å¦‚æœéƒ½æˆåŠŸï¼Œé€šè¿‡æ‰€æœ‰ RM æäº¤äº‹åŠ¡</li>\n<li>å¦‚æœæœ‰å¤±è´¥ï¼Œé€šè¿‡æ‰€æœ‰ RM å›æ»šäº‹åŠ¡</li>\n</ul>\n</li>\n</ul>\n<p><strong>RM äºŒé˜¶æ®µçš„å·¥ä½œ</strong>ï¼š</p>\n<ul>\n<li>æ¥æ”¶ TC æŒ‡ä»¤ï¼Œæäº¤æˆ–å›æ»šäº‹åŠ¡</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181128704.png\" alt=\"image-20231018112758938\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>XA æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>äº‹åŠ¡çš„å¼ºä¸€è‡´æ€§ï¼Œæ»¡è¶³ ACID åŸåˆ™</li>\n<li>å¸¸ç”¨æ•°æ®åº“éƒ½æ”¯æŒï¼Œå®ç°ç®€å•ï¼Œå¹¶ä¸”æ²¡æœ‰ä»£ç ä¾µå…¥</li>\n</ul>\n<p>XA æ¨¡å¼çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>å› ä¸ºä¸€é˜¶æ®µéœ€è¦é”å®šæ•°æ®åº“èµ„æºï¼Œç­‰å¾…äºŒé˜¶æ®µç»“æŸæ‰é‡Šæ”¾ï¼Œæ€§èƒ½è¾ƒå·®</li>\n<li>ä¾èµ–å…³ç³»å‹æ•°æ®åº“å®ç°äº‹åŠ¡</li>\n</ul>\n</blockquote>\n<h4 id=\"2423-å®ç°xaæ¨¡å¼\"><a class=\"anchor\" href=\"#2423-å®ç°xaæ¨¡å¼\">#</a> 2.4.2.3ã€å®ç° XA æ¨¡å¼ğŸŒ´</h4>\n<p>Seata çš„ starter å·²ç»å®Œæˆäº† XA æ¨¡å¼çš„è‡ªåŠ¨è£…é…ï¼Œå®ç°éå¸¸ç®€å•ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<p>1ã€ä¿®æ”¹ application.yml æ–‡ä»¶ (æ¯ä¸ªå‚ä¸äº‹åŠ¡çš„å¾®æœåŠ¡)ï¼Œå¼€å¯ XA æ¨¡å¼</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">seata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">data-source-proxy-mode</span><span class=\"token punctuation\">:</span> XA <span class=\"token comment\"># å¼€å¯æ•°æ®æºä»£ç†çš„ XA æ¨¡å¼</span></pre></td></tr></table></figure><p>2ã€ç»™å‘èµ·å…¨å±€äº‹åŠ¡çš„å…¥å£æ–¹æ³•æ·»åŠ  @GlobalTransactional æ³¨è§£ï¼Œæœ¬ä¾‹ä¸­æ˜¯ OrderServiceImpl ä¸­çš„ create æ–¹æ³•ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@GlobalTransactional</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">Long</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Order</span> order<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// åˆ›å»ºè®¢å•</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   orderMapper<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token comment\">// æ‰£ç”¨æˆ·ä½™é¢</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      accountClient<span class=\"token punctuation\">.</span><span class=\"token function\">deduct</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">.</span><span class=\"token function\">getUserId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> order<span class=\"token punctuation\">.</span><span class=\"token function\">getMoney</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token comment\">// æ‰£åº“å­˜</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      storageClient<span class=\"token punctuation\">.</span><span class=\"token function\">deduct</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">.</span><span class=\"token function\">getCommodityCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> order<span class=\"token punctuation\">.</span><span class=\"token function\">getCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">FeignException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä¸‹å•å¤±è´¥ï¼ŒåŸå› :&#123;&#125;\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">contentUTF8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token function\">contentUTF8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token keyword\">return</span> order<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>3ã€é‡å¯æœåŠ¡å¹¶æµ‹è¯•</p>\n<p>ç›®å‰çš„ account_tbl è¡¨å•ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181144973.png\" alt=\"image-20231018114458627\" /></p>\n<p>ç›®å‰ storage_tbl è¡¨å•ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181145948.png\" alt=\"image-20231018114522634\" /></p>\n<p>ä½¿ç”¨ postman è¿›è¡Œå‘é€è¯·æ±‚æµ‹è¯•</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181146511.png\" alt=\"image-20231018114629170\" /></p>\n<p>æµ‹è¯•å account_tbl è¡¨å•ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181146234.png\" alt=\"image-20231018114658167\" /></p>\n<p>æµ‹è¯•å storage_tbl è¡¨å•ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181147047.png\" alt=\"image-20231018114715998\" /></p>\n<p>å¯ä»¥çœ‹åˆ°æ²¡æœ‰é—®é¢˜ï¼Œä¸‹é¢æµ‹è¯• å¼‚å¸¸ çš„æƒ…å†µ</p>\n<p>postman æµ‹è¯•å¦‚ä¸‹ï¼š</p>\n<p>å°†å­˜åº“æ•°é‡æ”¹ä¸º 10ï¼Œå½“å‰çš„åº“å­˜æ•°æ®æ˜¯ä¸è¶³ 10 ä¸ªçš„å› æ­¤æ‰§è¡Œå°±ä¼šå‡ºé—®é¢˜å¯ä»¥çœ‹åˆ°çŠ¶æ€ç  500 å·²ç»å¼‚å¸¸äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181148645.png\" alt=\"image-20231018114814272\" /></p>\n<p>æˆ‘ä»¬çœ‹ä¸‹æ•°æ®åº“æœ‰æ²¡æœ‰å›æ»šå•Š</p>\n<p>æµ‹è¯•å account_tbl è¡¨å•ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181149371.png\" alt=\"image-20231018114937327\" /></p>\n<p>æµ‹è¯•å storage_tbl è¡¨å•ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181149916.png\" alt=\"image-20231018114955744\" /></p>\n<p>å¯ä»¥çœ‹åˆ°æ²¡æœ‰ä»»ä½•å˜åŒ–</p>\n<p>çœ‹ä¸‹ idea çš„æ§åˆ¶å°çš„æ‰“å°ä¿¡æ¯ï¼š</p>\n<p>accountApplication æ‰“å°å‡ºäº†äº‹åŠ¡å›æ»šçš„ä¿¡æ¯ï¼Œå…¶å®ƒçš„æ˜¯æŠ¥é”™çš„ä¿¡æ¯ï¼Œå› ä¸ºæŠ¥é”™æœ¬èº«å°±æ²¡æœ‰æ‰§è¡ŒæˆåŠŸ</p>\n<pre><code>10-18 11:48:06:076  INFO 18016 --- [h_RMROLE_1_2_16] i.s.c.r.p.c.RmBranchRollbackProcessor    : rm handle branch rollback process:xid=192.168.45.1:8091:4251845158843265029,branchId=4251845158843265031,branchType=XA,resourceId=jdbc:mysql:///seata_demo,applicationData=null\n10-18 11:48:06:080  INFO 18016 --- [h_RMROLE_1_2_16] io.seata.rm.AbstractRMHandler            : Branch Rollbacking: 192.168.45.1:8091:4251845158843265029 4251845158843265031 jdbc:mysql:///seata_demo\n10-18 11:48:06:083  INFO 18016 --- [h_RMROLE_1_2_16] i.s.rm.datasource.xa.ResourceManagerXA   : 192.168.45.1:8091:4251845158843265029-4251845158843265031 was rollbacked\n10-18 11:48:06:084  INFO 18016 --- [h_RMROLE_1_2_16] io.seata.rm.AbstractRMHandler            : Branch Rollbacked result: PhaseTwo_Rollbacked\n</code></pre>\n<h4 id=\"2424-atæ¨¡å¼åŸç†\"><a class=\"anchor\" href=\"#2424-atæ¨¡å¼åŸç†\">#</a> 2.4.2.4ã€AT æ¨¡å¼åŸç†ğŸŒ´</h4>\n<p>AT æ¨¡å¼åŒæ ·æ˜¯åˆ†é˜¶æ®µæäº¤çš„äº‹åŠ¡æ¨¡å‹ï¼Œä¸è¿‡å´å¼¥è¡¥äº† XA æ¨¡å‹ä¸­èµ„æºé”å®šå‘¨æœŸè¿‡é•¿çš„ç¼ºé™·ã€‚</p>\n<p>AT æ¨¡å¼æ‰§è¡Œå®Œä¸šåŠ¡ sql åä¼šç›´æ¥æäº¤äº‹åŠ¡ï¼Œè€Œä¸æ˜¯ç­‰å¾…å¯¹æ–¹çš„æ‰§è¡Œã€‚åœ¨æ‰§è¡Œä¸šåŠ¡ sql çš„æ—¶å€™ç”± RM æ‹¦æˆªè¿™æ¬¡çš„æ‰§è¡Œå¹¶ä¸”ç»™æ•°æ®å½¢æˆä¸€ä¸ªå¿«ç…§ï¼Œå¿«ç…§åä¸ºï¼šundo logï¼Œå¦‚æœå¤±è´¥äº†å°±å¯ä»¥æ ¹æ®å¿«ç…§è¿›è¡Œæ¢å¤äº†ã€‚åœ¨ç¬¬ä¸€é˜¶æ®µå°±å·²ç»æäº¤äº†ï¼Œç¬¬äºŒé˜¶æ®µå°† log ç»™åˆ é™¤</p>\n<p>é˜¶æ®µä¸€ RM çš„å·¥ä½œï¼š</p>\n<p>1ã€æ³¨å†Œåˆ†æ”¯äº‹åŠ¡</p>\n<p>2ã€&lt;font color='red'&gt; è®°å½• undo-log (æ•°æ®å¿«ç…§)&lt;/font&gt;.</p>\n<p>3ã€æ‰§è¡Œä¸šåŠ¡ sql å¹¶ &lt;font color='red'&gt; æäº¤ &lt;/font&gt;.</p>\n<p>4ã€æŠ¥å‘Šäº‹åŠ¡çŠ¶æ€</p>\n<p>é˜¶æ®µäºŒæäº¤æ—¶ RM çš„å·¥ä½œï¼š</p>\n<p>1ã€åˆ é™¤ undo-log å³å¯</p>\n<p>é˜¶æ®µäºŒå›æ»šæ—¶ RM çš„å·¥ä½œï¼š</p>\n<p>1ã€æ ¹æ® undo-log æ¢å¤æ•°æ®åˆ°æ›´æ–°å‰</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181329271.png\" alt=\"image-20231018132921268\" /></p>\n<p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¿›è¡Œæ¯”å–»ï¼š</p>\n<p>ä¾‹å¦‚ï¼Œä¸€ä¸ªåˆ†æ”¯ä¸šåŠ¡çš„ SQL æ˜¯è¿™æ ·çš„ï¼šupdate tb_account set money = money - 10 where id = 1</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181333976.png\" alt=\"image-20231018133322819\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>ç®€è¿° AT æ¨¡å¼ä¸ XA æ¨¡å¼æœ€å¤§çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>XA æ¨¡å¼ä¸€é˜¶æ®µä¸æäº¤äº‹åŠ¡ï¼Œé”å®šèµ„æºï¼›AT æ¨¡å¼ä¸€é˜¶æ®µç›´æ¥æäº¤ï¼Œä¸é”å®šèµ„æº</li>\n<li>XA æ¨¡å¼ä¾èµ–æ•°æ®åº“æœºåˆ¶å®ç°å›æ»šï¼›AT æ¨¡å¼åˆ©ç”¨æ•°æ®å¿«ç…§å®ç°æ•°æ®å›æ»š</li>\n<li>XA æ¨¡å¼å¼ºä¸€è‡´ï¼›AT æ¨¡å¼æœ€ç»ˆä¸€è‡´</li>\n</ul>\n</blockquote>\n<h5 id=\"24241-atæ¨¡å¼çš„è„å†™é—®é¢˜\"><a class=\"anchor\" href=\"#24241-atæ¨¡å¼çš„è„å†™é—®é¢˜\">#</a> 2.4.2.4.1ã€AT æ¨¡å¼çš„è„å†™é—®é¢˜ğŸ‹</h5>\n<p>ä¸Šè¿°å¾—çŸ¥ï¼ŒAT æ¨¡å¼ç›¸å¯¹äº XA æ¨¡å¼æ¥è®²ï¼Œæ€§èƒ½å¾—åˆ°äº†ä¸€äº›æå‡ï¼Œå› ä¸º AT æ¨¡å¼åœ¨ç¬¬ä¸€é˜¶æ®µçš„æ—¶å€™æ‰§è¡Œäº‹åŠ¡ä¼šç›´æ¥æäº¤ã€‚è€Œä¸æ˜¯ç­‰å¾…å„ä¸ªåˆ†æ”¯ä¸€èµ·æ‰§è¡Œå®Œï¼Œå› æ­¤èµ„æºé”å®šå‘¨æœŸçŸ­ æ€§èƒ½å°±æ¯”è¾ƒå¥½äº†ã€‚ä½†æ˜¯ä¹Ÿæ­£æ˜¯å› ä¸ºå®ƒæå‰é‡Šæ”¾äº†èµ„æºæ²¡æœ‰å»åšé”ï¼Œè¿™å°±å¯¼è‡´äº†åœ¨å¹¶å‘è®¿é—®æƒ…å†µä¸‹ä¼šå­˜åœ¨ä¸€äº›å®‰å…¨é—®é¢˜ã€‚</p>\n<p>æ¯”å¦‚è¯´æœ‰ä¸ª account è¡¨ï¼Œä¸šåŠ¡æ˜¯ä¿®æ”¹ money å­—æ®µè®©å…¶å‡ 10ï¼Œé‚£ä¹ˆæœ‰ä¸€ä¸ªçº¿ç¨‹å¼€å¯äº†è¿™ä¸ªæ ·äº‹åŠ¡ã€‚äº‹åŠ¡å¼€å¯ç¬¬ä¸€ä»¶äº‹å°±æ˜¯è·å–æ•°æ®åº“é”ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªå¿«ç…§ã€‚ç„¶åæ‰§è¡Œ sql ä» 100 æ”¹ä¸º 90ï¼Œç„¶åæäº¤äº‹åŠ¡ï¼Œäº‹åŠ¡ä¸€æ—¦æäº¤é”å°±é‡Šæ”¾äº†ï¼Œæ•°æ®ä¹Ÿå°±æ”¹äº†ã€‚ç¬¬ä¸€é˜¶æ®µå®Œæˆå°±è½®åˆ°ç¬¬äºŒé˜¶æ®µï¼Œä½†åŒä¸€æ—¶åˆ»å› ä¸ºæ˜¯å¹¶å‘ç°åœ¨æœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¹Ÿå¼€å¯äº†äº‹åŠ¡æ‰§è¡Œè¿™ä¸ªä¸šåŠ¡ã€‚äº‹åŠ¡ 2 ç­‰å¾…äº‹åŠ¡ 1 é‡Šæ”¾é”äº†ï¼Œç„¶åæ‹¿åˆ°é”æ‰èƒ½å»ä¿å­˜å¿«ç…§å¹¶æ‰§è¡Œä¸šåŠ¡ sql å°† 90 æ”¹ ä¸º 80ï¼Œç„¶åæäº¤äº‹åŠ¡å¹¶é‡Šæ”¾é”ã€‚</p>\n<p>å¦‚æœè¿™æ—¶äº‹åŠ¡ 1 æ‹¿åˆ°é”åå®ƒè¦åšå›æ»šï¼Œå› ä¸ºäº‹åŠ¡ 1 çš„ç¬¬äºŒé˜¶æ®µè¿˜æ²¡åšå®Œï¼Œè¿™æ—¶äº‹åŠ¡ 1 çš„å¿«ç…§æ•°æ®ä¸º money=100 è¿™æ˜¯å›æ»šå°±å‡ºé—®é¢˜äº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181351685.png\" alt=\"image-20231018135124412\" /></p>\n<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ AT æ¨¡å¼å¼•å…¥äº†ä¸€ä¸ªå« â€œå…¨å±€é”â€ çš„ä¸œè¥¿</p>\n<p><mark>å…¨å±€é”</mark>ï¼šç”± TC è®°å½•å½“å‰æ­£åœ¨æ“ä½œæŸè¡Œæ•°æ®çš„äº‹åŠ¡ï¼Œæ”¹äº‹åŠ¡æŒæœ‰å…¨å±€é”ï¼Œå…·å¤‡æ‰§è¡Œæƒã€‚</p>\n<p>TC é€šè¿‡ä¸€å¼ è¡¨æ¥è¿›è¡Œè®°å½•ï¼Œåˆ†åˆ«è®°å½•ï¼šå½“å‰ç”±å“ªä¸ªäº‹åŠ¡åœ¨æ“ä½œï¼Œæ“ä½œçš„å“ªå¼ è¡¨ï¼Œä¸»é”® æ“ä½œè¿™å¼ è¡¨çš„å“ªä¸€è¡Œæ•°æ®ã€‚é€šè¿‡è®°å½•æŸ¥çœ‹è¿™ä¸ªè¡¨çš„è¿™è¡Œæ•°æ®å°±åªèƒ½è¢«è¿™ä¸ªäº‹åŠ¡è¿›è¡Œæ“ä½œï¼Œå…¶å®ƒäº‹åŠ¡ä¸èƒ½æ“ä½œã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181402045.png\" alt=\"image-20231018140242928\" /></p>\n<p>å°½ç®¡å¦‚æ­¤ï¼Œäº‹åŠ¡ 1 åœ¨æ“ä½œ money å­—æ®µçš„æ—¶å€™ä¹Ÿå¯èƒ½ä¼šæœ‰ä¸€ä¸ªæ²¡æœ‰è¢« seata ç®¡ç†çš„ä¸šåŠ¡æ¥æ“ä½œ money å­—æ®µæ­¤æ—¶å°±ä¼šäº§ç”Ÿè„å†™çš„é—®é¢˜äº†ã€‚åˆ†å¸ƒå¼äº‹åŠ¡æˆ‘ä»¬åº”è¯¥å°½é‡çš„é¿å…ä¸¤ä¸ªæ“ä½œåŒä¸€ä¸ªå­—æ®µã€‚ä½†æ˜¯å†æ€ä¹ˆé¿å…ä¹Ÿä¸æ˜¯ä¸å¯èƒ½çš„æƒ…å†µ</p>\n<p>AT æ¨¡å¼ä¹Ÿå¯¹è¿™ç§æ–¹å¼åšäº†ä¸€äº›å¤„ç†ã€‚</p>\n<p>å½“äº‹åŠ¡ 1 ç¬¬äºŒé˜¶æ®µè¿›è¡Œå›æ»šæ—¶ï¼Œä¼šæ‹¿åˆ° æ›´æ–°å‰çš„å¿«ç…§å’Œæ›´æ–°åçš„å¿«ç…§ã€‚ç„¶åç”¨æ›´æ–°åçš„å¿«ç…§æ•°æ®å»å¯¹å½“å‰çš„æ•°æ®åº“æ•°æ®åšå¯¹æ¯”ï¼Œåˆ¤æ–­æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´å°±ä¼šè®°å½•å¼‚å¸¸ï¼Œå‘é€è­¦å‘Šï¼Œäººå·¥ä»‹å…¥</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181414617.png\" alt=\"image-20231018141424667\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>AT æ¨¡å¼çš„ä¼˜ç‚¹ï¼š</p>\n<ul>\n<li>ä¸€é˜¶æ®µå®Œæˆç›´æ¥æäº¤äº‹åŠ¡ï¼Œé‡Šæ”¾æ•°æ®åº“èµ„æºï¼Œæ€§èƒ½æ¯”è¾ƒå¥½</li>\n<li>åˆ©ç”¨å…¨å±€é”å®ç°è¯»å†™éš”ç¦»</li>\n<li>æ²¡æœ‰ä»£ç ä¾µå…¥ï¼Œæ¡†æ¶è‡ªåŠ¨å®Œæˆå›æ»šå’Œæäº¤</li>\n</ul>\n<p>AT æ¨¡å¼çš„ç¼ºç‚¹ï¼š</p>\n<ul>\n<li>ä¸¤é˜¶æ®µä¹‹é—´å±äºè½¯çŠ¶æ€ï¼Œå±äºæœ€ç»ˆä¸€è‡´</li>\n<li>æ¡†æ¶çš„å¿«ç…§åŠŸèƒ½ä¼šå½±å“æ€§èƒ½ï¼Œä½†æ¯” XA æ¨¡å¼å¥½å¾ˆå¤š</li>\n</ul>\n</blockquote>\n<h4 id=\"2425-å®ç°atæ¨¡å¼\"><a class=\"anchor\" href=\"#2425-å®ç°atæ¨¡å¼\">#</a> 2.4.2.5ã€å®ç° AT æ¨¡å¼ğŸŒ´</h4>\n<p>AT æ¨¡å¼ä¸­çš„å¿«ç…§ç”Ÿæˆï¼Œå›æ»šç­‰åŠ¨ä½œéƒ½æ˜¯ç”±æ¡†æ¶è‡ªåŠ¨å®Œæˆï¼Œæ²¡æœ‰ä»»ä½•ä»£ç ä¾µå…¥ï¼Œå› æ­¤å®ç°éå¸¸ç®€å•ã€‚</p>\n<p>1ã€å¯¼å…¥ SQL æ–‡ä»¶ï¼šseata-at.sqlã€‚æ‰“å¼€ sql æ–‡ä»¶å…¶ä¸­ lock_table å¯¼å…¥åˆ° TC æœåŠ¡å…³è”çš„æ•°æ®åº“ï¼Œundo_log è¡¨å¯¼å…¥åˆ°å¾®æœåŠ¡ç®¡ç†çš„æ•°æ®åº“ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181426661.png\" alt=\"image-20231018142639716\" /></p>\n<p>2ã€ä¿®æ”¹ application.yml æ–‡ä»¶ï¼Œå°†äº‹åŠ¡æ¨¡å¼ä¿®æ”¹ä¸º AT æ¨¡å¼å³å¯ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">seata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">data-source-proxy-mode</span><span class=\"token punctuation\">:</span> AT <span class=\"token comment\"># å¼€å¯æ•°æ®æºä»£ç†çš„ AT æ¨¡å¼</span></pre></td></tr></table></figure><p>3ã€é‡å¯æœåŠ¡å¹¶æµ‹è¯•</p>\n<p>ç›®å‰çš„æ•°æ®åº“æ•°æ®</p>\n<p>account_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181429533.png\" alt=\"image-20231018142929459\" /></p>\n<p>storage_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181429518.png\" alt=\"image-20231018142946308\" /></p>\n<p>ä½¿ç”¨ postman è¿›è¡Œæµ‹è¯•</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181430146.png\" alt=\"image-20231018143051522\" /></p>\n<p>æµ‹è¯•åçš„ account_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181431746.png\" alt=\"image-20231018143114523\" /></p>\n<p>æµ‹è¯•åçš„ storage_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181431267.png\" alt=\"image-20231018143133064\" /></p>\n<p>ä½¿ç”¨ postman è¿›è¡Œä¸€æ¬¡å¤±è´¥çš„æµ‹è¯•ï¼š</p>\n<p>åº“å­˜æ•°æ®ç°åœ¨ä¸å¤Ÿ 10 ä¸ªæˆ‘ä»¬æ‰£å‡ 10 ä¸ªæ­¤æ—¶å°±ä¼šäº§ç”Ÿå¼‚å¸¸</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181432899.png\" alt=\"image-20231018143222278\" /></p>\n<p>æµ‹è¯•åçš„ account_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181432696.png\" alt=\"image-20231018143252735\" /></p>\n<p>æµ‹è¯•åçš„ storage_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181433130.png\" alt=\"image-20231018143302062\" /></p>\n<p>å¯ä»¥å‘ç°æ²¡æœ‰å‘ç”Ÿä»»ä½•çš„å˜åŒ–å•Šã€‚è¯´æ˜äº‹åŠ¡ç”Ÿæ•ˆäº†ï¼Œæ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡éƒ½å›æ»šäº†</p>\n<p>accountApplication æœåŠ¡åœ¨ idea æ§åˆ¶å°ä¸­æ‰“å°çš„ä¿¡æ¯å¦‚ä¸‹ï¼š</p>\n<p>å¯ä»¥çœ‹åˆ°æœ€ç»ˆåˆ é™¤äº†ä¸€ä¸ªå« undo_log çš„è¡¨çš„æ•°æ®ä¹Ÿå°±æ˜¯å¿«ç…§æ•°æ®</p>\n<pre><code>10-18 14:32:15:309  INFO 19080 --- [h_RMROLE_1_2_16] i.s.c.r.p.c.RmBranchRollbackProcessor    : rm handle branch rollback process:xid=192.168.45.1:8091:4251845158843265037,branchId=4251845158843265039,branchType=AT,resourceId=jdbc:mysql:///seata_demo,applicationData=null\n10-18 14:32:15:310  INFO 19080 --- [h_RMROLE_1_2_16] io.seata.rm.AbstractRMHandler            : Branch Rollbacking: 192.168.45.1:8091:4251845158843265037 4251845158843265039 jdbc:mysql:///seata_demo\n10-18 14:32:15:347  INFO 19080 --- [h_RMROLE_1_2_16] i.s.r.d.undo.AbstractUndoLogManager      : xid 192.168.45.1:8091:4251845158843265037 branch 4251845158843265039, undo_log deleted with GlobalFinished\n10-18 14:32:15:348  INFO 19080 --- [h_RMROLE_1_2_16] io.seata.rm.AbstractRMHandler            : Branch Rollbacked result: PhaseTwo_Rollbacked\n</code></pre>\n<h4 id=\"2426-tccæ¨¡å¼åŸç†\"><a class=\"anchor\" href=\"#2426-tccæ¨¡å¼åŸç†\">#</a> 2.4.2.6ã€TCC æ¨¡å¼åŸç†ğŸŒ´</h4>\n<p>TCC æ¨¡å¼ä¸ AT æ¨¡å¼éå¸¸ç›¸ä¼¼ï¼Œæ¯é˜¶æ®µéƒ½æ˜¯ç‹¬ç«‹äº‹åŠ¡ï¼Œä¸åŒçš„æ˜¯ TCC é€šè¿‡äººå·¥ç¼–ç æ¥å®ç°æ•°æ®æ¢å¤ã€‚éœ€è¦å®ç°ä¸‰ä¸ªæ–¹æ³•ï¼š</p>\n<p>1ã€Tryï¼šèµ„æºçš„æ£€æµ‹å’Œé¢„ç•™</p>\n<p>2ã€Confirmï¼šå®Œæˆèµ„æºæ“ä½œä¸šåŠ¡ï¼›è¦æ±‚ Try æˆåŠŸ Confirm ä¸€å®šè¦èƒ½æˆåŠŸ</p>\n<p>3ã€Cancelï¼šé¢„ç•™èµ„æºé‡Šæ”¾ï¼Œå¯ä»¥ç†è§£ä¸º try çš„åå‘æ“ä½œ</p>\n<p>ä¸¾ä¾‹ï¼Œä¸€ä¸ªæ‰£å‡ç”¨æˆ·ä½™é¢çš„ä¸šåŠ¡ã€‚å‡è®¾è´¦æˆ· A åŸæ¥ä½™é¢æ˜¯ 100ï¼Œéœ€è¦ä½™é¢æ‰£å‡ 30 å…ƒ</p>\n<ul>\n<li>\n<p>é˜¶æ®µä¸€ (Try)ï¼šæ£€æŸ¥ä½™é¢æ˜¯å¦å……è¶³ï¼Œå¦‚æœå……è¶³åˆ™å†»ç»“é‡‘é¢å¢åŠ  30 å…ƒï¼Œå¯ç”¨ä½™é¢æ‰£é™¤ 30</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181448987.png\" alt=\"image-20231018144806649\" /></p>\n</li>\n<li>\n<p>é˜¶æ®µäºŒ (Confirm)ï¼šå‡å¦‚è¦æäº¤ï¼Œåˆ™å†»ç»“é‡‘é¢æ‰£å‡ 30</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181448879.png\" alt=\"image-20231018144815748\" /></p>\n</li>\n<li>\n<p>é˜¶æ®µäºŒ (Cancel)ï¼šå¦‚æœè¦å›æ»šï¼Œåˆ™å†»ç»“é‡‘é¢æ‰£å‡ 30ï¼Œå¯ç”¨ä½™é¢å¢åŠ  30</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181448428.png\" alt=\"image-20231018144824406\" /></p>\n</li>\n</ul>\n<p>TCC çš„å·¥ä½œæ¨¡å‹å›¾ï¼š</p>\n<p>ç”± TM å¼€å¯å¹¶æ³¨å†Œå…¨å±€äº‹åŠ¡åˆ° TC ä¸Šï¼Œç„¶å TM é€šçŸ¥æ¯ä¸€ä¸ªåˆ†æ”¯äº‹åŠ¡å»æ‰§è¡Œï¼Œåˆ†æ”¯äº‹åŠ¡è¢« RM åšæ‹¦æˆªï¼ŒRM å…ˆå»æ³¨å†Œä¸€ä¸‹åˆ†æ”¯äº‹åŠ¡ã€‚ç„¶åå†æ‰§è¡Œæ“ä½œï¼Œç¬¬ä¸€é˜¶æ®µè¿›è¡Œ Tryã€‚Try æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„èµ„æºä¼šç›´æ¥æäº¤ï¼Œæäº¤åæŠ¥å‘Šäº‹åŠ¡çš„çŠ¶æ€ã€‚äºŒé˜¶æ®µï¼šTM é€šçŸ¥ TC äº‹åŠ¡ç»“æŸäº†ï¼Œç„¶å TC åšäº‹åŠ¡çŠ¶æ€çš„åˆ¤æ–­ï¼Œçœ‹çœ‹åˆ†æ”¯èµ„æºå¤Ÿä¸å¤Ÿã€‚å¦‚æœå¤Ÿç›´æ¥ Confirm æäº¤ï¼Œå¦‚æœä¸å¤Ÿå°±æ‰§è¡Œ Cancel é€»è¾‘è¿›è¡Œå›æ»šã€‚</p>\n<p>è€Œè¿™ä¸‰ä¸ª Tryï¼ŒConfirmï¼ŒCancel éƒ½æ˜¯éœ€è¦äººå·¥ç¼–å†™çš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181456139.png\" alt=\"image-20231018145621001\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>TCC æ¨¡å¼çš„æ¯ä¸ªé˜¶æ®µæ˜¯åšä»€ä¹ˆçš„ï¼Ÿ</p>\n<ul>\n<li>Tryï¼šèµ„æºæ£€æŸ¥å’Œé¢„ç•™</li>\n<li>Confirmï¼šä¸šåŠ¡æ‰§è¡Œå’Œæäº¤</li>\n<li>Cancelï¼šé¢„ç•™èµ„æºçš„é‡Šæ”¾</li>\n</ul>\n<p>TCC çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>ä¸€é˜¶æ®µå®Œæˆç›´æ¥æäº¤äº‹åŠ¡ï¼Œé‡Šæ”¾æ•°æ®åº“èµ„æºï¼Œæ€§èƒ½å¥½</li>\n<li>ç›¸æ¯” AT æ¨¡å‹ï¼Œæ— éœ€ç”Ÿæˆå¿«ç…§ï¼Œæ— éœ€ä½¿ç”¨å…¨å±€é”ï¼Œæ€§èƒ½æœ€å¼º</li>\n<li>ä¸ä¾èµ–æ•°æ®åº“äº‹åŠ¡ï¼Œè€Œæ˜¯ä¾èµ–è¡¥å¿æ“ä½œï¼Œå¯ä»¥ç”¨äºéäº‹åŠ¡å‹æ•°æ®åº“æ¯”å¦‚ï¼šredis</li>\n</ul>\n<p>TCC çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>æœ‰ä»£ç ä¾µå…¥ï¼Œéœ€è¦è®¤ä¸ºç¼–å†™ Tryï¼ŒConfirm å’Œ Cancel æ¥å£ï¼Œå¤ªéº»çƒ¦</li>\n<li>è½¯çŠ¶æ€ï¼Œäº‹åŠ¡æ˜¯æœ€ç»ˆä¸€è‡´</li>\n<li>éœ€è¦è€ƒè™‘ Confirm å’Œ Cancel çš„å¤±è´¥æƒ…å†µï¼Œåšå¥½å¹‚ç­‰å¤„ç†</li>\n</ul>\n</blockquote>\n<h5 id=\"24261-æ¡ˆä¾‹æ”¹é€ account-serviceæœåŠ¡åˆ©ç”¨tccå®ç°åˆ†å¸ƒå¼äº‹åŠ¡\"><a class=\"anchor\" href=\"#24261-æ¡ˆä¾‹æ”¹é€ account-serviceæœåŠ¡åˆ©ç”¨tccå®ç°åˆ†å¸ƒå¼äº‹åŠ¡\">#</a> 2.4.2.6.1ã€æ¡ˆä¾‹ï¼Œæ”¹é€  account-service æœåŠ¡ï¼Œåˆ©ç”¨ TCC å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ğŸ‹</h5>\n<p>éœ€æ±‚å¦‚ä¸‹ï¼š</p>\n<p>1ã€ä¿®æ”¹ acoount-serviceï¼Œç¼–å†™ Tryï¼ŒConfirmï¼ŒCancel é€»è¾‘</p>\n<p>2ã€Try ä¸šåŠ¡ï¼šæ·»åŠ å†»ç»“é‡‘é¢ï¼Œæ‰£å‡å¯ç”¨é‡‘é¢</p>\n<p>3ã€Confirm ä¸šåŠ¡ï¼šåˆ é™¤å†»ç»“é‡‘é¢</p>\n<p>4ã€Cancel ä¸šåŠ¡ï¼šåˆ é™¤å†»ç»“é‡‘é¢ï¼Œæ¢å¤å¯ç”¨é‡‘é¢</p>\n<p>5ã€ä¿è¯ Confirmï¼ŒCancel æ¥å£çš„ &lt;font color='red'&gt; å¹‚ç­‰æ€§ &lt;/font&gt;.</p>\n<p>6ã€å…è®¸ &lt;font color='red'&gt; ç©ºå›æ»š &lt;/font&gt;.</p>\n<p>7ã€æ‹’ç» &lt;font color='red'&gt; ä¸šåŠ¡æ‚¬æŒ‚ &lt;/font&gt;.</p>\n<h5 id=\"24262-tccçš„ç©ºå›æ»šå’Œä¸šåŠ¡æ‚¬æŒ‚\"><a class=\"anchor\" href=\"#24262-tccçš„ç©ºå›æ»šå’Œä¸šåŠ¡æ‚¬æŒ‚\">#</a> 2.4.2.6.2ã€TCC çš„ç©ºå›æ»šå’Œä¸šåŠ¡æ‚¬æŒ‚ğŸ‹</h5>\n<blockquote>\n<p>å½“æŸåˆ†æ”¯äº‹åŠ¡çš„ try é˜¶æ®µé˜»å¡æ—¶ï¼Œå¯èƒ½å¯¼è‡´å…¨å±€äº‹åŠ¡è¶…æ—¶è€Œè§¦å‘äºŒé˜¶æ®µçš„ cancel æ“ä½œã€‚åœ¨æœªæ‰§è¡Œ try æ“ä½œæ—¶å…ˆæ‰§è¡Œäº† cancel æ“ä½œï¼Œè¿™æ—¶ cancel ä¸èƒ½åšå›æ»šï¼Œå°±æ˜¯ &lt;font color='red'&gt; ç©ºå›æ»š &lt;/font&gt;.</p>\n<p>å› æ­¤ä¹Ÿä¸èƒ½æŠ¥é”™ã€‚æŠ¥é”™å°±ä¼šé‡è¯•å°±ä¼šé™·å…¥ä¸€ä¸ªæ­»å¾ªç¯ä¸­ã€‚</p>\n<p>å¯¹äºå·²ç»ç©ºå›æ»šçš„ä¸šåŠ¡ï¼Œå¦‚æœä»¥åç»§ç»­æ‰§è¡Œ tryï¼Œå°±æ°¸è¿œä¸å¯èƒ½ Confirm æˆ– Cancelï¼Œè¿™å°±æ˜¯ &lt;font color='red'&gt; ä¸šåŠ¡æ‚¬æŒ‚ &lt;/font&gt;ã€‚åº”å½“é˜»æ­¢æ‰§è¡Œç©ºå›æ»šåçš„ try æ“ä½œï¼Œé¿å…æ‚¬æŒ‚</p>\n</blockquote>\n<p>å½“ç¬¬äºŒä¸ªäº‹åŠ¡å»æ‰§è¡Œçš„æ—¶å€™å°±ä¼šè¢«é˜»å¡ï¼Œé˜»å¡åå¾—ä¸åˆ°æ‰§è¡Œ TM å°±ä¼šå¡åœ¨è¿™é‡Œï¼Œç­‰å¾…è¶…æ—¶åå°±ä¼šæŠ¥ä¸€ä¸ªé”™è¯¯ç»™ TC äº†ï¼ŒTC æ­¤æ—¶å°±ä¼šè¿”å›ä¸€ä¸ªå›æ»šçš„é€šçŸ¥äºæ˜¯ RM å°±ä¼šæ‰§è¡Œ Cancel çš„é€»è¾‘äº†ã€‚</p>\n<p>ç¬¬ä¸€ä¸ªåˆ†æ”¯æ‰§è¡Œ Cancel æ²¡é—®é¢˜å› ä¸ºå®ƒå·²ç» Try äº†ï¼Œä½†æ˜¯ç¬¬äºŒä¸ªåˆ†æ”¯å°±å‡ºé—®é¢˜äº† è¿˜æ²¡å†»ç»“é‡‘é¢å°±å»æ¢å¤é‡‘é¢å»äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181514887.png\" alt=\"image-20231018151440530\" /></p>\n<p>â€‹</p>\n<p><strong>ä¸šåŠ¡åˆ†æ</strong></p>\n<p>ä¸ºäº†å®ç°ç©ºå›æ»šï¼Œé˜²æ­¢ä¸šåŠ¡æ‚¬æŒ‚ï¼Œä»¥åŠå¹‚ç­‰æ€§è¦æ±‚ã€‚æˆ‘ä»¬å¿…é¡»åœ¨æ•°æ®åº“è®°å½•å†»ç»“é‡‘é¢çš„åŒæ—¶ï¼Œè®°å½•å½“å‰äº‹åŠ¡ id å’Œæ‰§è¡ŒçŠ¶æ€ï¼Œä¸ºæ­¤æˆ‘ä»¬è®¾è®¡äº†ä¸€å¼ è¡¨ (account_freeze_tbl è¿™ä¸ªè¡¨åœ¨é¡¹ç›®ä¸­ sql æ–‡ä»¶å¤¹å·²ç»æä¾›äº†)ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181702525.png\" alt=\"image-20231018170230443\" /></p>\n<p>æœ‰äº†è¡¨åæˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºå®ä½“ç±»å’Œ mapper</p>\n<p>å®ä½“ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@TableName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"account_freeze_tbl\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccountFreeze</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@TableId</span><span class=\"token punctuation\">(</span>type <span class=\"token operator\">=</span> <span class=\"token class-name\">IdType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">INPUT</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> xid<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> userId<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> freezeMoney<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> state<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">State</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">TRY</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">CONFIRM</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">CANCEL</span> <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>mapper</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">AccountFreezeMapper</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseMapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AccountFreeze</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h5 id=\"24263-å£°æ˜tccæ¥å£\"><a class=\"anchor\" href=\"#24263-å£°æ˜tccæ¥å£\">#</a> 2.4.2.6.3ã€å£°æ˜ TCC æ¥å£ï¼š</h5>\n<p>TCC çš„ Tryï¼ŒConfirmï¼ŒCancel æ–¹æ³•éƒ½éœ€è¦åœ¨æ¥å£ä¸­åŸºäºæ³¨è§£æ¥å£°æ˜ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@LocalTCC</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">AccountTCCService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\">// Try é€»è¾‘ï¼Œ@TwoPhaseBusinessAction ä¸­çš„ name å±æ€§è¦ä¸å½“å‰æ–¹æ³•åä¸€è‡´ï¼Œç”¨äºæŒ‡å®š Try é€»è¾‘å¯¹åº”æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@TwoPhaseBusinessAction</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"deduct\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            commitMethod <span class=\"token operator\">=</span> <span class=\"token string\">\"confirm\"</span><span class=\"token punctuation\">,</span> rollbackMethod <span class=\"token operator\">=</span> <span class=\"token string\">\"cancel\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">deduct</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@BusinessActionContextParameter</span><span class=\"token punctuation\">(</span>paramName <span class=\"token operator\">=</span> <span class=\"token string\">\"userId\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> userId<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token annotation punctuation\">@BusinessActionContextParameter</span><span class=\"token punctuation\">(</span>paramName <span class=\"token operator\">=</span> <span class=\"token string\">\"money\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">int</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// äºŒé˜¶æ®µ confirm ç¡®è®¤æ–¹æ³•ï¼Œå¯ä»¥å¦å‘½åï¼Œä½†è¦ä¿è¯ä¸ commitMethod ä¸€è‡´</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">// @Param context ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥ä¼ é€’ Try æ–¹æ³•çš„å‚æ•°</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token comment\">// @return boolean æ‰§è¡Œæ˜¯å¦æˆåŠŸ</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token keyword\">boolean</span> <span class=\"token function\">confirm</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BusinessActionContext</span> ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token comment\">// äºŒé˜¶æ®µå›æ»šæ–¹æ³•ï¼Œè¦ä¿è¯ä¸ rollbackMethod ä¸€è‡´</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">boolean</span> <span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BusinessActionContext</span> ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®ç°ç±»ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccountTccServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">AccountTCCService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AccountMapper</span> mapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AccountFreezeMapper</span> freezeMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AccountTccServiceImpl</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AccountMapper</span> mapper<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                                 <span class=\"token class-name\">AccountFreezeMapper</span> freezeMapper<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mapper <span class=\"token operator\">=</span> mapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>freezeMapper <span class=\"token operator\">=</span> freezeMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token annotation punctuation\">@Transactional</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">deduct</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> userId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> money<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token comment\">// 1. è·å–äº‹åŠ¡ id</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token class-name\">String</span> xid <span class=\"token operator\">=</span> <span class=\"token class-name\">RootContext</span><span class=\"token punctuation\">.</span><span class=\"token function\">getXID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\">// 1.1. åˆ¤æ–­ freeze ä¸­æ˜¯å¦æœ‰å†»ç»“è®°å½•ï¼Œå¦‚æœæœ‰ï¼Œä¸€å®šæ˜¯ CANCEL æ‰§è¡Œè¿‡ï¼Œè¦æ‹’ç»ä¸šåŠ¡</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">AccountFreeze</span> freeze1 <span class=\"token operator\">=</span> freezeMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectById</span><span class=\"token punctuation\">(</span>xid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>freeze1 <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// CANCEL æ‰§è¡Œè¿‡ï¼Œè¦æ‹’ç»ä¸šåŠ¡</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">// 2. æ‰£å‡å¯ç”¨ä½™é¢</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        mapper<span class=\"token punctuation\">.</span><span class=\"token function\">deduct</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token comment\">// 3. è®°å½•å†»ç»“é‡‘é¢ï¼Œäº‹åŠ¡çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token class-name\">AccountFreeze</span> freeze <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AccountFreeze</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        freeze<span class=\"token punctuation\">.</span><span class=\"token function\">setUserId</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        freeze<span class=\"token punctuation\">.</span><span class=\"token function\">setFreezeMoney</span><span class=\"token punctuation\">(</span>money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        freeze<span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AccountFreeze<span class=\"token punctuation\">.</span>State</span><span class=\"token punctuation\">.</span><span class=\"token constant\">TRY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        freeze<span class=\"token punctuation\">.</span><span class=\"token function\">setXid</span><span class=\"token punctuation\">(</span>xid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        freezeMapper<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>freeze<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">confirm</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BusinessActionContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token comment\">// 1. è·å–äº‹åŠ¡ id</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token class-name\">String</span> xid <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">getXid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token comment\">// 2. æ ¹æ® id åˆ é™¤å†»ç»“è®°å½•</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> freezeMapper<span class=\"token punctuation\">.</span><span class=\"token function\">deleteById</span><span class=\"token punctuation\">(</span>xid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token keyword\">return</span> count <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BusinessActionContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token comment\">// 1. ä»ä¸Šä¸‹æ–‡ä¸­è·å– ç”¨æˆ·çš„ id å’Œä½™é¢</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token class-name\">String</span> xid <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">getXid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token class-name\">String</span> userId <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">getActionContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"userId\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token class-name\">AccountFreeze</span> freeze <span class=\"token operator\">=</span> freezeMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectById</span><span class=\"token punctuation\">(</span>xid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token comment\">// 1.1. ç©ºå›æ»šçš„åˆ¤æ–­ï¼Œåˆ¤æ–­ freeze æ˜¯å¦ä¸º nullï¼Œä¸º null è¯æ˜ try æ²¡æœ‰æ‰§è¡Œï¼Œéœ€è¦ç©ºå›æ»š</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>freeze <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token comment\">// è¯æ˜ try æ²¡æœ‰æ‰§è¡Œï¼Œéœ€è¦å›æ»š</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            freeze <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AccountFreeze</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>            freeze<span class=\"token punctuation\">.</span><span class=\"token function\">setUserId</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            freeze<span class=\"token punctuation\">.</span><span class=\"token function\">setFreezeMoney</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            freeze<span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AccountFreeze<span class=\"token punctuation\">.</span>State</span><span class=\"token punctuation\">.</span><span class=\"token constant\">CANCEL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>            freeze<span class=\"token punctuation\">.</span><span class=\"token function\">setXid</span><span class=\"token punctuation\">(</span>xid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>            freezeMapper<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>freeze<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>        <span class=\"token comment\">// 1.2. å¹‚ç­‰åˆ¤æ–­</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>freeze<span class=\"token punctuation\">.</span><span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token class-name\">AccountFreeze<span class=\"token punctuation\">.</span>State</span><span class=\"token punctuation\">.</span><span class=\"token constant\">CANCEL</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>            <span class=\"token comment\">// å·²ç»å¤„ç†è¿‡ä¸€æ¬¡ CANCEL äº†ï¼Œæ— éœ€é‡å¤å¤„ç†</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        <span class=\"token comment\">// 2. æ¢å¤å¯ç”¨ä½™é¢</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>        mapper<span class=\"token punctuation\">.</span><span class=\"token function\">refund</span><span class=\"token punctuation\">(</span>freeze<span class=\"token punctuation\">.</span><span class=\"token function\">getUserId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> freeze<span class=\"token punctuation\">.</span><span class=\"token function\">getFreezeMoney</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>        <span class=\"token comment\">// 3. å°†å†»ç»“é‡‘é¢æ¸…é›¶ï¼ŒçŠ¶æ€æ”¹ä¸º CANCEL</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>        freeze<span class=\"token punctuation\">.</span><span class=\"token function\">setFreezeMoney</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>        freeze<span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AccountFreeze<span class=\"token punctuation\">.</span>State</span><span class=\"token punctuation\">.</span><span class=\"token constant\">CANCEL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>        <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> freezeMapper<span class=\"token punctuation\">.</span><span class=\"token function\">updateById</span><span class=\"token punctuation\">(</span>freeze<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>        <span class=\"token keyword\">return</span> count <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç›®å‰çš„æ•°æ®åº“æ•°æ®</p>\n<p>account_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181752228.png\" alt=\"image-20231018175239070\" /></p>\n<p>storage_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181752894.png\" alt=\"image-20231018175252816\" /></p>\n<p>ä½¿ç”¨ postman è¿›è¡Œæµ‹è¯•</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181753247.png\" alt=\"image-20231018175315999\" /></p>\n<p>è¯·æ±‚å®ŒåæŸ¥çœ‹æ•°æ®åº“çš„æ•°æ®</p>\n<p>account_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181753982.png\" alt=\"image-20231018175345921\" /></p>\n<p>storage_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181754323.png\" alt=\"image-20231018175359525\" /></p>\n<p>æµ‹è¯•å¤±è´¥çš„ postman è¯·æ±‚</p>\n<p>å› ä¸ºæ­¤æ—¶åº“å­˜çš„æ•°é‡ä¸å¤Ÿ 10 ä¸ªï¼Œæˆ‘ä»¬å‡å» 10 ä¸ªå°±ä¼šäº§ç”Ÿå¼‚å¸¸</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181754231.png\" alt=\"image-20231018175428861\" /></p>\n<p>æŸ¥çœ‹æ•°æ®åº“çš„æ•°æ®æƒ…å†µ</p>\n<p>æµ‹è¯•åçš„ account_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181932222.png\" alt=\"image-20231018193221241\" /></p>\n<p>æµ‹è¯•åçš„ storage_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181932553.png\" alt=\"image-20231018193242522\" /></p>\n<p>å¯ä»¥çœ‹åˆ°å®Œæˆäº†æ•°æ®çš„å›æ»š</p>\n<h4 id=\"2427-sagaæ¨¡å¼\"><a class=\"anchor\" href=\"#2427-sagaæ¨¡å¼\">#</a> 2.4.2.7ã€Saga æ¨¡å¼ğŸŒ´</h4>\n<p>Saga æ¨¡å¼æ˜¯ SEATA æä¾›çš„é•¿äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚ä¹Ÿåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p>\n<ul>\n<li>ä¸€é˜¶æ®µï¼šç›´æ¥æäº¤æœ¬åœ°äº‹åŠ¡</li>\n<li>äºŒé˜¶æ®µï¼šæˆåŠŸåˆ™ä»€ä¹ˆéƒ½ä¸åšï¼Œå¤±è´¥åˆ™é€šè¿‡ç¼–å†™è¡¥å¿ä¸šåŠ¡æ¥å›æ»š</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181938269.png\" alt=\"image-20231018193808535\" /></p>\n<p>Saga æ¨¡å¼ä¼˜ç‚¹ï¼š</p>\n<p>1ã€äº‹åŠ¡å‚ä¸è€…å¯ä»¥åŸºäºäº‹åŠ¡é©±åŠ¨å®ç°å¼‚æ­¥è°ƒç”¨ï¼Œååé«˜</p>\n<p>2ã€ä¸€é˜¶æ®µç›´æ¥æäº¤äº‹åŠ¡ï¼Œæ— é”ï¼Œæ€§èƒ½å¥½</p>\n<p>3ã€ä¸ç”¨ç¼–å†™ TCC ä¸­çš„ä¸‰ä¸ªé˜¶æ®µï¼Œå®ç°ç®€å•</p>\n<p>ç¼ºç‚¹ï¼š</p>\n<p>1ã€è½¯çŠ¶æ€æ”¯æŒæ—¶é—´ä¸ç¡®å®šï¼Œæ—¶æ•ˆæ€§å·®</p>\n<p>2ã€æ²¡æœ‰é”ï¼Œæ²¡æœ‰äº‹åŠ¡éš”ç¦»ï¼Œä¼šæœ‰è„å†™</p>\n<h4 id=\"2428-å››ç§æ¨¡å¼å¯¹æ¯”\"><a class=\"anchor\" href=\"#2428-å››ç§æ¨¡å¼å¯¹æ¯”\">#</a> 2.4.2.8ã€å››ç§æ¨¡å¼å¯¹æ¯”ğŸŒ´</h4>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>XA</th>\n<th>AT</th>\n<th>TCC</th>\n<th>SAGA</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ä¸€è‡´æ€§</td>\n<td>å¼ºä¸€è‡´</td>\n<td>å¼±ä¸€è‡´</td>\n<td>å¼±ä¸€è‡´</td>\n<td>æœ€ç»ˆä¸€è‡´</td>\n</tr>\n<tr>\n<td>éš”ç¦»æ€§</td>\n<td>å®Œå…¨éš”ç¦»</td>\n<td>åŸºäºå…¨å±€é”éš”ç¦»</td>\n<td>åŸºäºèµ„æºé¢„ç•™éš”ç¦»</td>\n<td>æ— éš”ç¦»</td>\n</tr>\n<tr>\n<td>ä»£ç ä¾µå…¥</td>\n<td>æ— </td>\n<td>æ— </td>\n<td>æœ‰ï¼Œè¦ç¼–å†™ä¸‰ä¸ªæ¥å£</td>\n<td>æœ‰ï¼Œè¦ç¼–å†™çŠ¶æ€æœºå’Œè¡¥å¿ä¸šåŠ¡</td>\n</tr>\n<tr>\n<td>æ€§èƒ½</td>\n<td>å·®</td>\n<td>å¥½</td>\n<td>éå¸¸å¥½</td>\n<td>éå¸¸å¥½</td>\n</tr>\n<tr>\n<td>åœºæ™¯</td>\n<td>å¯¹ä¸€è‡´æ€§ï¼Œéš”ç¦»æ€§æœ‰é«˜è¦æ±‚çš„ä¸šåŠ¡</td>\n<td>åŸºäºå…³ç³»å‹æ•°æ®åº“çš„å¤§å¤šæ•°åˆ†å¸ƒå¼åœºæ™¯éƒ½å¯ä»¥</td>\n<td>å¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„äº‹åŠ¡ &lt;br /&gt; æœ‰éå…³ç³»å‹æ•°æ®åº“è¦å‚ä¸çš„äº‹åŠ¡</td>\n<td>ä¸šåŠ¡æµç¨‹é•¿ï¼Œä¸šåŠ¡æµç¨‹å¤š &lt;br /&gt; å‚ä¸è€…åŒ…å«å…¶å®ƒå…¬å¸æˆ–é—ç•™ç³»ç»ŸæœåŠ¡ï¼Œæ— æ³•æä¾› TCC æ¨¡å¼è¦æ±‚çš„ä¸‰ä¸ªæ¥å£</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"ä¸‰-é«˜å¯ç”¨\"><a class=\"anchor\" href=\"#ä¸‰-é«˜å¯ç”¨\">#</a> ä¸‰ã€é«˜å¯ç”¨ğŸ„</h1>\n<ul>\n<li>é«˜å¯ç”¨é›†ç¾¤ç»“æ„</li>\n<li>å®ç°é«˜å¯ç”¨é›†ç¾¤</li>\n</ul>\n<p><strong>TC çš„å¼‚åœ°å¤šæœºæˆ¿å®¹ç¾æ¶æ„</strong></p>\n<p>TC æœåŠ¡ä½œä¸º Seata çš„æ ¸å¿ƒæœåŠ¡ï¼Œä¸€å®šè¦ä¿è¯<mark>é«˜å¯ç”¨</mark>å’Œ<mark>å¼‚åœ°å®¹ç¾</mark>.</p>\n<p>å…·ä½“å®ç°æŸ¥çœ‹æ–‡ç« ï¼š<a href=\"../Seata/seata%E7%9A%84%E9%83%A8%E7%BD%B2%E5%92%8C%E9%9B%86%E6%88%90.md\">seata çš„éƒ¨ç½²å’Œé›†æˆ.md</a>.</p>\n<h1 id=\"å››å¤šçº§ç¼“å­˜\"><a class=\"anchor\" href=\"#å››å¤šçº§ç¼“å­˜\">#</a> å››ï¼Œå¤šçº§ç¼“å­˜ğŸ„</h1>\n<p>äº¿çº§æµé‡çš„ç¼“å­˜æ–¹æ¡ˆ</p>\n<h2 id=\"41-ä¼ ç»Ÿç¼“å­˜çš„é—®é¢˜\"><a class=\"anchor\" href=\"#41-ä¼ ç»Ÿç¼“å­˜çš„é—®é¢˜\">#</a> 4.1ã€ä¼ ç»Ÿç¼“å­˜çš„é—®é¢˜ğŸŒ³</h2>\n<p>ä¼ ç»Ÿçš„ç¼“å­˜ç­–ç•¥ä¸€èˆ¬æ˜¯è¯·æ±‚åˆ°è¾¾ Tomcat åï¼Œå…ˆæŸ¥è¯¢ redisï¼Œå¦‚æœæœªå‘½ä¸­åˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œå­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š</p>\n<p>1ã€è¯·æ±‚è¦ç»è¿‡ Tomcat å¤„ç†ï¼ŒTomcat çš„æ€§èƒ½æˆä¸ºæ•´ä¸ªç³»ç»Ÿçš„ç“¶é¢ˆ</p>\n<p>2ã€Redis ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œä¼šå¯¹æ•°æ®åº“äº§ç”Ÿå†²å‡»</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191526124.png\" alt=\"image-20231019152653849\" /></p>\n<h2 id=\"42-å¤šçº§ç¼“å­˜æ–¹æ¡ˆ\"><a class=\"anchor\" href=\"#42-å¤šçº§ç¼“å­˜æ–¹æ¡ˆ\">#</a> 4.2ã€å¤šçº§ç¼“å­˜æ–¹æ¡ˆğŸŒ³</h2>\n<p>å¤šçº§ç¼“å­˜å°±æ˜¯å……åˆ†åˆ©ç”¨è¯·æ±‚å¤„ç†çš„æ¯ä¸ªç¯èŠ‚ï¼Œåˆ†åˆ«æ·»åŠ ç¼“å­˜ï¼Œå‡è½» Tomcat å‹åŠ›ï¼Œæå‡æœåŠ¡æ€§èƒ½ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191532661.png\" alt=\"image-20231019153224519\" /></p>\n<p>ç”¨ä½œç¼“å­˜çš„ Nginx æ˜¯ä¸šåŠ¡ Nginxï¼Œéœ€è¦éƒ¨ç½²ä¸ºé›†ç¾¤ï¼Œå†æœ‰ä¸“é—¨çš„ Nginx ç”¨æ¥åšåå‘ä»£ç†ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191534434.png\" alt=\"image-20231019153411071\" /></p>\n<h2 id=\"43-jvmè¿›ç¨‹ç¼“å­˜\"><a class=\"anchor\" href=\"#43-jvmè¿›ç¨‹ç¼“å­˜\">#</a> 4.3ã€JVM è¿›ç¨‹ç¼“å­˜ğŸŒ³</h2>\n<ul>\n<li>å¯¼å…¥å•†å“æ¡ˆä¾‹</li>\n<li>åˆå§‹ Caffeine</li>\n<li>å®ç°è¿›ç¨‹ç¼“å­˜</li>\n</ul>\n<h3 id=\"431-å¯¼å…¥å•†å“æ¡ˆä¾‹\"><a class=\"anchor\" href=\"#431-å¯¼å…¥å•†å“æ¡ˆä¾‹\">#</a> 4.3.1ã€å¯¼å…¥å•†å“æ¡ˆä¾‹ğŸŒ²</h3>\n<p>æŸ¥çœ‹æ–‡ç« ï¼š<a href=\"./%E6%A1%88%E4%BE%8B%E5%AF%BC%E5%85%A5%E8%AF%B4%E6%98%8E/%E6%A1%88%E4%BE%8B%E5%AF%BC%E5%85%A5%E8%AF%B4%E6%98%8E.md\">æ¡ˆä¾‹å¯¼å…¥è¯´æ˜</a>.</p>\n<h3 id=\"432-åˆå§‹caffeine\"><a class=\"anchor\" href=\"#432-åˆå§‹caffeine\">#</a> 4.3.2ã€åˆå§‹ CaffeineğŸŒ²</h3>\n<h4 id=\"4321-æœ¬åœ°è¿›ç¨‹ç¼“å­˜\"><a class=\"anchor\" href=\"#4321-æœ¬åœ°è¿›ç¨‹ç¼“å­˜\">#</a> 4.3.2.1ã€æœ¬åœ°è¿›ç¨‹ç¼“å­˜ğŸŒ´</h4>\n<p>ç¼“å­˜åœ¨æ—¥å¸¸å¼€å‘ä¸­èµ·åˆ°è‡³å…³é‡è¦çš„ä½œç”¨ã€‚ç”±äºæ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ•°æ®çš„è¯»å–é€Ÿåº¦æ˜¯éå¸¸å¿«çš„ï¼Œèƒ½å¤§é‡å‡å°‘å¯¹æ•°æ®åº“çš„è®¿é—®ï¼Œå‡å°‘æ•°æ®åº“çš„å‹åŠ›ã€‚æˆ‘ä»¬å§ç¼“å­˜åˆ†ä¸ºä¸¤ç±»ï¼š</p>\n<p>1ã€åˆ†å¸ƒå¼ç¼“å­˜ï¼Œä¾‹å¦‚ Redisï¼š</p>\n<ul>\n<li>ä¼˜ç‚¹ï¼šå­˜å‚¨å®¹é‡æ›´å¤§ï¼Œå¯é æ€§æ›´å¥½ï¼Œå¯ä»¥åœ¨é›†ç¾¤é—´å…±äº«</li>\n<li>ç¼ºç‚¹ï¼šè®¿é—®ç¼“å­˜æœ‰ç½‘ç»œå¼€é”€</li>\n<li>åœºæ™¯ï¼šç¼“å­˜æ•°æ®é‡è¾ƒå¤§ï¼Œå¯é æ€§è¦æ±‚è¾ƒé«˜ï¼Œéœ€è¦åœ¨é›†ç¾¤é—´å…±äº«</li>\n</ul>\n<p>2ã€è¿›ç¨‹æœ¬åœ°ç¼“å­˜ï¼Œä¾‹å¦‚ HashMapï¼ŒGuavaCacheï¼š</p>\n<ul>\n<li>ä¼˜ç‚¹ï¼šè¯»å–æœ¬åœ°å†…å­˜ï¼Œæ²¡æœ‰ç½‘ç»œå¼€é”€ï¼Œé€Ÿåº¦æ›´å¿«</li>\n<li>ç¼ºç‚¹ï¼šå­˜å‚¨å®¹é‡æœ‰é™ï¼Œå¯é æ€§è¾ƒä½ï¼Œæ— æ³•å…±äº«</li>\n<li>åœºæ™¯ï¼šæ€§èƒ½è¦æ±‚è¾ƒé«˜ï¼Œç¼“å­˜æ•°æ®é‡è¾ƒå°</li>\n</ul>\n<p>Caffeine æ˜¯ä¸€ä¸ªåŸºäº java8 å¼€å‘çš„ï¼Œæä¾›äº†è¿‘ä¹æœ€ä½³å‘½ä¸­ç‡çš„é«˜æ€§èƒ½çš„æœ¬åœ°ç¼“å­˜åº“ã€‚ç›®å‰ Spring å†…éƒ¨çš„ç¼“å­˜ä½¿ç”¨çš„å°±æ˜¯ Caffeineã€‚Github åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2Jlbi1tYW5lcy9jYWZmZWluZQ==\">https://github.com/ben-manes/caffeine</span></p>\n<h5 id=\"43211-caffeineç¤ºä¾‹\"><a class=\"anchor\" href=\"#43211-caffeineç¤ºä¾‹\">#</a> 4.3.2.1.1ã€Caffeine ç¤ºä¾‹ğŸ‹</h5>\n<p>å¯ä»¥é€šè¿‡ item-service é¡¹ç›®ä¸­çš„å•å…ƒæµ‹è¯•æ¥å­¦ä¹  Caffeine çš„ä½¿ç”¨ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">testBasicOpsTwo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. æ„å»º cache å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">Cache</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> cache <span class=\"token operator\">=</span> <span class=\"token class-name\">Caffeine</span><span class=\"token punctuation\">.</span><span class=\"token function\">newBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 2. å­˜æ•°æ®</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"éƒ­æ˜ç„¶\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// 3. å–æ•°æ®</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token class-name\">String</span> gf <span class=\"token operator\">=</span> cache<span class=\"token punctuation\">.</span><span class=\"token function\">getIfPresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf = \"</span> <span class=\"token operator\">+</span> gf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token comment\">// 4. å–æ•°æ®ï¼Œå¦‚æœæœªå‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token class-name\">String</span> defaultGF <span class=\"token operator\">=</span> cache<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"defaultGF\"</span><span class=\"token punctuation\">,</span> key <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token comment\">// 4.1. æ ¹æ® key å»æŸ¥è¯¢æ•°æ®åº“</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token keyword\">return</span> <span class=\"token string\">\"æ˜¯ä¸ªå‚»å­\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"defaultGF = \"</span> <span class=\"token operator\">+</span> defaultGF<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">//------------------ æ‰§è¡Œç»“æœ ------------------</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>gf <span class=\"token operator\">=</span> éƒ­æ˜ç„¶</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>defaultGF <span class=\"token operator\">=</span> æ˜¯ä¸ªå‚»å­</pre></td></tr></table></figure><p>Caffeine æä¾›äº†ä¸‰ç§ç¼“å­˜é©±é€ç­–ç•¥ï¼š</p>\n<p>1ã€åŸºäºå®¹é‡ï¼šè®¾ç½®ç¼“å­˜çš„æ•°é‡ä¸Šé™</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">testBasicOpsTwo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. æ„å»º cache å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">Cache</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> cache <span class=\"token operator\">=</span> <span class=\"token class-name\">Caffeine</span><span class=\"token punctuation\">.</span><span class=\"token function\">newBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">maximumSize</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½®ç¼“å­˜å¤§å°ä¸Šé™ä¸º 1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// 2. å­˜æ•°æ®</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"éƒ­æ˜ç„¶\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"éƒ­æ˜ç„¶1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"éƒ­æ˜ç„¶2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token comment\">//        try &#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token comment\">//            // å»¶è¿Ÿ 10msï¼Œç»™æ¸…ç†çº¿ç¨‹ä¸€ç‚¹æ—¶é—´</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token comment\">//            Thread.sleep(100);</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token comment\">//        &#125; catch (InterruptedException e) &#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token comment\">//            throw new RuntimeException(e);</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token comment\">//        &#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token comment\">// 3. å–æ•°æ®</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">getIfPresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">getIfPresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">getIfPresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">//---------------- æ‰“å°ç»“æœ ----------------</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>éƒ­æ˜ç„¶</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>éƒ­æ˜ç„¶<span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>éƒ­æ˜ç„¶<span class=\"token number\">2</span></pre></td></tr></table></figure><p>ä½¿ç”¨çº¿ç¨‹ç¡çœ è®©å…¶ç­‰å¾… 10ms ç»™æ¸…ç†çº¿ç¨‹ä¸€ç‚¹æ—¶é—´</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">testBasicOpsTwo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. æ„å»º cache å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">Cache</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> cache <span class=\"token operator\">=</span> <span class=\"token class-name\">Caffeine</span><span class=\"token punctuation\">.</span><span class=\"token function\">newBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">maximumSize</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½®ç¼“å­˜å¤§å°ä¸Šé™ä¸º 1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// 2. å­˜æ•°æ®</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"éƒ­æ˜ç„¶\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"éƒ­æ˜ç„¶1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"éƒ­æ˜ç„¶2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>       <span class=\"token comment\">// å»¶è¿Ÿ 10msï¼Œç»™æ¸…ç†çº¿ç¨‹ä¸€ç‚¹æ—¶é—´</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>       <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">10l</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>       <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token comment\">// 3. å–æ•°æ®</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">getIfPresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">getIfPresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">getIfPresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">//---------------- æ‰“å°ç»“æœ ----------------</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">null</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">null</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>éƒ­æ˜ç„¶<span class=\"token number\">2</span></pre></td></tr></table></figure><p>2ã€åŸºäºæ—¶é—´ï¼šè®¾ç½®ç¼“å­˜çš„æœ‰æ•ˆæ—¶é—´</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">testBasicOpsTwo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. æ„å»º cache å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">Cache</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> cache <span class=\"token operator\">=</span> <span class=\"token class-name\">Caffeine</span><span class=\"token punctuation\">.</span><span class=\"token function\">newBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">expireAfterWrite</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Duration</span><span class=\"token punctuation\">.</span><span class=\"token function\">ofSeconds</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½®ç¼“å­˜æœ‰æ•ˆæœŸä¸º 10 ç§’ï¼Œä»æœ€åä¸€æ¬¡å†™å…¥å¼€å§‹è®¡æ—¶</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// 2. å­˜æ•°æ®</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"éƒ­æ˜ç„¶\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"éƒ­æ˜ç„¶1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"éƒ­æ˜ç„¶2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token comment\">// 3. å–æ•°æ®</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">getIfPresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token comment\">// å»¶è¿Ÿ 10msï¼Œç»™æ¸…ç†çº¿ç¨‹ä¸€ç‚¹æ—¶é—´</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">11000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">getIfPresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">getIfPresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">//------------------- æ‰“å°ç»“æœ -------------------</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>éƒ­æ˜ç„¶</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">null</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">null</span></pre></td></tr></table></figure><p>3ã€åŸºäºå¼•ç”¨ï¼šè®¾ç½®ç¼“å­˜ä¸ºè½¯å¼•ç”¨æˆ–å¼±å¼•ç”¨ï¼Œåˆ©ç”¨ GC æ¥å›æ”¶ç¼“å­˜æ•°æ®ã€‚æ€§èƒ½è¾ƒå·®ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚</p>\n<p><mark>è½¯å¼•ç”¨</mark>ï¼šå†…å­˜ä¸è¶³æ—¶æ‰ä¼šå›æ”¶ï¼›       <mark>å¼±å¼•ç”¨</mark>ï¼šå°±ç®—å†…å­˜å……è¶³æ—¶ä¹Ÿä¼šå›æ”¶ï¼›</p>\n<p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªç¼“å­˜å…ƒç´ è¿‡æœŸçš„æ—¶å€™ï¼ŒCaffeine ä¸ä¼šè‡ªåŠ¨ç«‹å³å°†å…¶æ¸…ç†å’Œé©±é€ã€‚è€Œæ˜¯åœ¨ä¸€æ¬¡è¯»æˆ–å†™æ“ä½œåï¼Œæˆ–è€…åœ¨ç©ºé—²æ—¶é—´å®Œæˆå¯¹å¤±æ•ˆæ•°æ®çš„é©±é€ã€‚</p>\n<h3 id=\"433-å®ç°è¿›ç¨‹ç¼“å­˜\"><a class=\"anchor\" href=\"#433-å®ç°è¿›ç¨‹ç¼“å­˜\">#</a> 4.3.3ã€å®ç°è¿›ç¨‹ç¼“å­˜ğŸŒ²</h3>\n<h4 id=\"4331-æ¡ˆä¾‹å®ç°å•†å“çš„æŸ¥è¯¢çš„æœ¬åœ°è¿›ç¨‹ç¼“å­˜\"><a class=\"anchor\" href=\"#4331-æ¡ˆä¾‹å®ç°å•†å“çš„æŸ¥è¯¢çš„æœ¬åœ°è¿›ç¨‹ç¼“å­˜\">#</a> 4.3.3.1ã€æ¡ˆä¾‹ï¼Œå®ç°å•†å“çš„æŸ¥è¯¢çš„æœ¬åœ°è¿›ç¨‹ç¼“å­˜ğŸŒ´</h4>\n<p>åˆ©ç”¨ Caffeine å®ç°ä¸‹åˆ—éœ€æ±‚ï¼š</p>\n<p>1ã€ç»™æ ¹æ® id æŸ¥è¯¢å•†å“çš„ä¸šåŠ¡æ·»åŠ ç¼“å­˜ï¼Œç¼“å­˜æœªå‘½ä¸­æ—¶æŸ¥è¯¢æ•°æ®åº“</p>\n<p>2ã€ç»™æ ¹æ® id æŸ¥è¯¢å•†å“å­˜åº“çš„ä¸šåŠ¡æ·»åŠ ç¼“å­˜ï¼Œç¼“å­˜æœªå‘½ä¸­æ—¶æŸ¥è¯¢æ•°æ®åº“</p>\n<p>3ã€ç¼“å­˜åˆå§‹å¤§å°ä¸º 100</p>\n<p>4ã€ç¼“å­˜ä¸Šé™ä¸º 10000</p>\n<p>æ­¥éª¤ï¼š</p>\n<p>1ã€ç»™æ ¹æ® id æŸ¥è¯¢å•†å“çš„ä¸šåŠ¡æ·»åŠ ç¼“å­˜ï¼Œç¼“å­˜æœªå‘½ä¸­æ—¶æŸ¥è¯¢æ•°æ®åº“</p>\n<p>2ã€ç»™æ ¹æ® id æŸ¥è¯¢å•†å“å­˜åº“çš„ä¸šåŠ¡æ·»åŠ ç¼“å­˜ï¼Œç¼“å­˜æœªå‘½ä¸­æ—¶æŸ¥è¯¢æ•°æ®åº“</p>\n<p>3ã€ç¼“å­˜åˆå§‹å¤§å°ä¸º 100</p>\n<p>4ã€ç¼“å­˜ä¸Šé™ä¸º 10000</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CaffeineConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Cache</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">itemCache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Caffeine</span><span class=\"token punctuation\">.</span><span class=\"token function\">newBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">initialCapacity</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½®ç¼“å­˜åˆå§‹åŒ–å¤§å°</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">maximumSize</span><span class=\"token punctuation\">(</span><span class=\"token number\">10_000</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½®ç¼“å­˜æœ€å¤§ä¸Šé™å€¼</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Cache</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ItemStock</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">itemStockCache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Caffeine</span><span class=\"token punctuation\">.</span><span class=\"token function\">newBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">initialCapacity</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½®ç¼“å­˜åˆå§‹åŒ–å¤§å°</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">maximumSize</span><span class=\"token punctuation\">(</span><span class=\"token number\">10_000</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½®ç¼“å­˜æœ€å¤§ä¸Šé™å€¼</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>5ã€åœ¨ controller å±‚è¿›è¡Œä¸¤ä¸ªç¼“å­˜å¯¹è±¡çš„è‡ªåŠ¨è£…é…</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">Cache</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">></span></span> itemCache<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">Cache</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ItemStock</span><span class=\"token punctuation\">></span></span> itemStockCache<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>6ã€ç¼–å†™ç¼“å­˜ä»£ç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">Item</span> <span class=\"token function\">findById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\">// ä¼˜å…ˆæ ¹æ®ç¼“å­˜æŸ¥ï¼Œå¦‚æœæœªå‘½ä¸­åˆ™æŸ¥è¯¢æ•°æ®åº“</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">return</span> itemCache<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> key <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token keyword\">return</span> itemService<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">ne</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"status\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">eq</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">one</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/stock/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">ItemStock</span> <span class=\"token function\">findStockById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token keyword\">return</span> itemStockCache<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> key <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token keyword\">return</span> stockService<span class=\"token punctuation\">.</span><span class=\"token function\">getById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¯·æ±‚æ¥å£è¿›è¡Œæµ‹è¯•ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDgxL2l0ZW0vMTAwMDE=\">http://localhost:8081/item/10001</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191732546.png\" alt=\"image-20231019173236082\" /></p>\n<p>ç¬¬ä¸€æ¬¡è¯·æ±‚æˆ‘ä»¬å¯ä»¥åœ¨ idea æ§åˆ¶å°ä¸­çœ‹åˆ°æ‰“å°äº†ä¸€æ®µæ‰§è¡Œ SQL çš„æ—¥å¿—ï¼Œè¯´æ˜æŸ¥äº†ä¸€ä¸‹æ•°æ®åº“</p>\n<pre><code>17:31:53:355 DEBUG 5692 --- [nio-8081-exec-1] c.h.item.mapper.ItemMapper.selectOne     : ==&gt;  Preparing: SELECT id,name,title,price,image,category,brand,spec,status,create_time,update_time FROM tb_item WHERE (status &lt;&gt; ? AND id = ?)\n17:31:53:383 DEBUG 5692 --- [nio-8081-exec-1] c.h.item.mapper.ItemMapper.selectOne     : ==&gt; Parameters: 3(Integer), 10001(Long)\n17:31:53:405 DEBUG 5692 --- [nio-8081-exec-1] c.h.item.mapper.ItemMapper.selectOne     : &lt;==      Total: 1\n</code></pre>\n<p>æ¸…ç©º idea æ§åˆ¶å°å†å¯¹è¯¥é¡µé¢è¿›è¡Œä¸€æ¬¡è®¿é—®ï¼Œå› ä¸ºç¼“å­˜ä¸€å¼€å§‹å°±æ˜¯ç©ºçš„</p>\n<p>å½“æˆ‘ä»¬æ‰§è¡Œè¿‡ä¸€æ¬¡åæ•°æ®å°±ä¼šè¢«ç¼“å­˜èµ·æ¥ï¼Œç¬¬äºŒæ¬¡æ‰§è¡Œå°±ç›´æ¥æ‹¿ç¼“å­˜çš„æ•°æ®äº†å¯ä»¥çœ‹åˆ°æ§åˆ¶å°å¾ˆå¹²å‡€æ²¡æœ‰ä¸€ç‚¹æ‰“å°ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191733727.png\" alt=\"image-20231019173347678\" /></p>\n<p>å½“ç„¶åº“å­˜ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†</p>\n<p>è®¿é—® uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDgxL2l0ZW0vc3RvY2svMTAwMDE=\">http://localhost:8081/item/stock/10001</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191735447.png\" alt=\"image-20231019173509976\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191734949.png\" alt=\"image-20231019173456734\" /></p>\n<p>æ¸…ç©ºæ§åˆ¶å°ä¿¡æ¯è¿›è¡Œç¬¬äºŒæ¬¡è®¿é—®ï¼Œæ­¤æ—¶æ•°æ®å·²ç»è¢«ç¼“å­˜èµ·æ¥äº†ã€‚</p>\n<p>äºŒæ¬¡ä¾æ—§å¾ˆå¹²å‡€</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191735198.png\" alt=\"image-20231019173553835\" /></p>\n<h1 id=\"äº”-luaè¯­è¨€å…¥é—¨\"><a class=\"anchor\" href=\"#äº”-luaè¯­è¨€å…¥é—¨\">#</a> äº”ã€Lua è¯­è¨€å…¥é—¨ğŸ„</h1>\n<p>å› ä¸º Nginx å¼€å‘éœ€è¦ä½¿ç”¨ Lua è¯­è¨€æ¥è¿›è¡Œç¼–ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦å­¦ä¹  Lua è¯­è¨€</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191745432.png\" alt=\"image-20231019174517515\" /></p>\n<p>å­¦ä¹ å†…å®¹ï¼š</p>\n<ul>\n<li>åˆå§‹ Lua</li>\n<li>å˜é‡å’Œå¾ªç¯</li>\n<li>æ¡ä»¶æ§åˆ¶ï¼Œå‡½æ•°</li>\n</ul>\n<h2 id=\"51-åˆå§‹lua\"><a class=\"anchor\" href=\"#51-åˆå§‹lua\">#</a> 5.1ã€åˆå§‹ LuağŸŒ³</h2>\n<p>Lua æ˜¯ä¸€ç§è½»é‡çº§å°å·§çš„è„šæœ¬è¯­è¨€ï¼Œç”¨æ ‡å‡† C è¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€æ”¾ï¼Œå…¶è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†åµŒå…¥åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½ã€‚å®˜ç½‘ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5sdWEub3JnLw==\">http://www.lua.org/</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191751131.png\" alt=\"image-20231019175148607\" /></p>\n<h3 id=\"511-helloworld\"><a class=\"anchor\" href=\"#511-helloworld\">#</a> 5.1.1ã€HelloWorldğŸŒ²</h3>\n<p>1ã€åœ¨ Linux è™šæ‹Ÿæœºçš„ä»»æ„ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ª hello.lua æ–‡ä»¶</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim hello.lua</span></pre></td></tr></table></figure><p>2ã€æ·»åŠ ä¸‹é¢çš„å†…å®¹</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>print<span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World!\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>3ã€è¿è¡Œ</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># lua hello.lua</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Hello World<span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><h3 id=\"512-æ•°æ®ç±»å‹\"><a class=\"anchor\" href=\"#512-æ•°æ®ç±»å‹\">#</a> 5.1.2ã€æ•°æ®ç±»å‹ğŸŒ²</h3>\n<table>\n<thead>\n<tr>\n<th>æ•°æ®ç±»å‹</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>nil</td>\n<td>è¿™ä¸ªæœ€ç®€å•ï¼Œåªæœ‰å€¼ nil å±äºè¯¥ç±»ï¼Œè¡¨ç¤ºä¸€ä¸ªæ— æ•ˆå€¼ (åœ¨æ¡ä»¶è¡¨è¾¾å¼ä¸­ç›¸å½“äº false)</td>\n</tr>\n<tr>\n<td>boolean</td>\n<td>åŒ…å«ä¸¤ä¸ªå€¼ï¼šfalse å’Œ true</td>\n</tr>\n<tr>\n<td>number</td>\n<td>è¡¨ç¤ºåŒç²¾åº¦ç±»å‹çš„å®æµ®ç‚¹æ•°</td>\n</tr>\n<tr>\n<td>string</td>\n<td>å­—ç¬¦ä¸²ç”±ä¸€å¯¹åŒå¼•å·æˆ–å•å¼•å·æ¥è¡¨ç¤º</td>\n</tr>\n<tr>\n<td>function</td>\n<td>ç”± C æˆ– Lua ç¼–å†™çš„å‡½æ•°</td>\n</tr>\n<tr>\n<td>table</td>\n<td>Lua ä¸­çš„è¡¨ (table) å…¶å®æ˜¯ä¸€ä¸ª â€œå…³è”æ•°ç»„â€ (associative arrays)ï¼Œæ•°ç»„çš„ç´¢å¼•å¯ä»¥æ˜¯æ•°å­—ï¼Œå­—ç¬¦ä¸²æˆ–è¡¨ç±»å‹ã€‚åœ¨ Lua é‡Œï¼Œtable çš„åˆ›å»ºæ˜¯é€šè¿‡ â€œæ„é€ è¡¨è¾¾å¼â€ æ¥å®Œæˆï¼Œæœ€ç®€å•æ„é€ è¡¨è¾¾å¼æ˜¯ { }ï¼Œç”¨æ¥åˆ›å»ºä¸€ä¸ªç©ºè¡¨ã€‚</td>\n</tr>\n</tbody>\n</table>\n<p>å¯ä»¥åˆ©ç”¨ type å‡½æ•°æµ‹è¯•ç»™å®šå˜é‡æˆ–è€…å€¼çš„ç±»å‹</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim hello.lua</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># lua hello.lua</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>string</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat hello.lua</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>print<span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World!\"</span><span class=\"token punctuation\">))</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim hello.lua</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># lua hello.lua</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>number</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat hello.lua</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>print<span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">(</span><span class=\"token number\">10.4</span> * <span class=\"token number\">3</span><span class=\"token punctuation\">))</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><h3 id=\"513-å˜é‡\"><a class=\"anchor\" href=\"#513-å˜é‡\">#</a> 5.1.3ã€å˜é‡ğŸŒ²</h3>\n<p>Lua å£°æ˜å˜é‡çš„æ—¶å€™ï¼Œå¹¶ä¸éœ€è¦æŒ‡å®šæ•°æ®ç±»å‹ï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å£°æ˜å­—ç¬¦ä¸²</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> str <span class=\"token operator\">=</span> <span class=\"token string\">'hello'</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">-- å£°æ˜æ•°å­—</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">local</span> num <span class=\"token operator\">=</span> <span class=\"token number\">21</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">-- å£°æ˜å¸ƒå°”ç±»å‹</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">local</span> flag <span class=\"token operator\">=</span> <span class=\"token keyword\">true</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">-- å£°æ˜æ•°ç»„ key ä¸ºç´¢å¼•çš„ table </span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">local</span> arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">'java'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'python'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'lua'</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">-- å£°æ˜ table ï¼Œç±»ä¼¼ java çš„ map</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">local</span> map <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'Jack'</span><span class=\"token punctuation\">,</span> age <span class=\"token operator\">=</span> <span class=\"token number\">21</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è®¿é—® tableï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- è®¿é—®æ•°ç»„ï¼Œlua æ•°ç»„çš„è§’æ ‡ä» 1 å¼€å§‹</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">print</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">-- è®¿é—® table</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">print</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">[</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">print</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²æ‹¼æ¥ä½¿ç”¨  <code>..</code></p>\n<h3 id=\"514-å¾ªç¯\"><a class=\"anchor\" href=\"#514-å¾ªç¯\">#</a> 5.1.4ã€å¾ªç¯ğŸŒ²</h3>\n<p>æ•°ç»„ï¼Œtable éƒ½å¯ä»¥åˆ©ç”¨ for å¾ªç¯æ¥éå†</p>\n<ul>\n<li>éå†æ•°ç»„ï¼š</li>\n</ul>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å£°æ˜æ•°ç»„ key ä¸ºç´¢å¼•çš„ table</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">'java'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'python'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'lua'</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">-- éå†æ•°ç»„</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">for</span> index<span class=\"token punctuation\">,</span> value <span class=\"token keyword\">in</span> <span class=\"token function\">ipairs</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><ul>\n<li>éå† table</li>\n</ul>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å£°æ˜ mapï¼Œä¹Ÿå°±æ˜¯ table</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> map <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'Jack'</span><span class=\"token punctuation\">,</span> age <span class=\"token operator\">=</span> <span class=\"token number\">21</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">-- éå† table</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">for</span> key<span class=\"token punctuation\">,</span>value <span class=\"token keyword\">in</span> <span class=\"token function\">pairs</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><h3 id=\"515-å‡½æ•°\"><a class=\"anchor\" href=\"#515-å‡½æ•°\">#</a> 5.1.5ã€å‡½æ•°ğŸŒ²</h3>\n<p>å®šä¹‰å‡½æ•°çš„è¯­æ³•ï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">function</span> å‡½æ•°å<span class=\"token punctuation\">(</span> argument1<span class=\"token punctuation\">,</span> argument2<span class=\"token punctuation\">,</span> argument3 <span class=\"token punctuation\">...</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token comment\">-- å‡½æ•°ä½“</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">return</span> è¿”å›å€¼</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥æ‰“å°æ•°ç»„ï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">printArr</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token keyword\">for</span> index<span class=\"token punctuation\">,</span> value <span class=\"token keyword\">in</span> <span class=\"token function\">ipairs</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>      <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><h3 id=\"516-æ¡ä»¶æ§åˆ¶\"><a class=\"anchor\" href=\"#516-æ¡ä»¶æ§åˆ¶\">#</a> 5.1.6ã€æ¡ä»¶æ§åˆ¶ğŸŒ²</h3>\n<p>ç±»ä¼¼ Java çš„æ¡ä»¶æ§åˆ¶ï¼Œä¾‹å¦‚ if , else è¯­æ³•ï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>å¸ƒå°”è¡¨è¾¾å¼<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\">-- [å¸ƒå°”è¡¨è¾¾å¼ä¸º true æ—¶æ‰§è¡Œè¯¥è¯­å¥å— --]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token comment\">-- [å¸ƒå°”è¡¨è¾¾å¼ä¸º false æ—¶æ‰§è¡Œè¯¥è¯­å¥å— --]</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>ä¸ java ä¸åŒï¼Œå¸ƒå°”è¡¨è¾¾å¼ä¸­çš„é€»è¾‘è¿ç®—æ˜¯åŸºäºè‹±æ–‡å•è¯ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>æ“ä½œç¬¦</th>\n<th>æè¿°</th>\n<th>å®ä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>and</td>\n<td>é€»è¾‘ä¸æ“ä½œç¬¦ã€‚è‹¥ A ä¸º falseï¼Œåˆ™è¿”å› Aï¼Œå¦åˆ™è¿”å› B</td>\n<td>(A and B) ä¸º false</td>\n</tr>\n<tr>\n<td>or</td>\n<td>é€»è¾‘æˆ–æ“ä½œç¬¦ã€‚è‹¥ A ä¸º trueï¼Œåˆ™è¿”å› Aï¼Œå¦åˆ™è¿”å› B</td>\n<td>(A or B) ä¸º true</td>\n</tr>\n<tr>\n<td>not</td>\n<td>é€»è¾‘éæ“ä½œç¬¦ã€‚ä¸é€»è¾‘è¿ç®—ç»“æœç›¸åï¼Œå¦‚æœæ¡ä»¶ä¸º trueï¼Œé€»è¾‘éä¸º false</td>\n<td>not (A and B) ä¸º true</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"å…­-å¤šçº§ç¼“å­˜\"><a class=\"anchor\" href=\"#å…­-å¤šçº§ç¼“å­˜\">#</a> å…­ã€å¤šçº§ç¼“å­˜ğŸ„</h1>\n<ul>\n<li>å®‰è£… OpenResty</li>\n<li>OpenResty å¿«é€Ÿå…¥é—¨</li>\n<li>è¯·æ±‚å‚æ•°å¤„ç†</li>\n<li>æŸ¥è¯¢ Tomcat</li>\n<li>Redis ç¼“å­˜é¢„çƒ­</li>\n<li>æŸ¥è¯¢ Redis ç¼“å­˜</li>\n<li>Nginx æœ¬åœ°ç¼“å­˜</li>\n</ul>\n<h2 id=\"61-åˆå§‹openresty\"><a class=\"anchor\" href=\"#61-åˆå§‹openresty\">#</a> 6.1ã€åˆå§‹ OpenRestyğŸŒ³</h2>\n<p>OpenResty æ˜¯ä¸€ä¸ªåŸºäº Nginx çš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†é«˜å¹¶å‘ï¼Œæ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ï¼ŒWeb æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚å…·å¤‡ä¸‹åˆ—ç‰¹ç‚¹ï¼š</p>\n<ul>\n<li>å…·å¤‡ Nginx çš„å®Œæ•´åŠŸèƒ½</li>\n<li>åŸºäº Lua è¯­è¨€è¿›è¡Œæ‰©å±•ï¼Œé›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ï¼Œç¬¬ä¸‰æ–¹æ¨¡å—</li>\n<li>å…è®¸ä½¿ç”¨ Lua è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘ï¼Œè‡ªå®šä¹‰åº“</li>\n</ul>\n<p>å®˜æ–¹ç½‘ç«™ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9vcGVucmVzdHkub3JnL2NuLw==\">https://openresty.org/cn/</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200852606.png\" alt=\"image-20231020085036341\" /></p>\n<h3 id=\"611-openrestyå®‰è£…\"><a class=\"anchor\" href=\"#611-openrestyå®‰è£…\">#</a> 6.1.1ã€OpenResty å®‰è£…ğŸŒ²</h3>\n<p>æŸ¥çœ‹æ–‡ç« ï¼š<a href=\"./OpenResty%E5%AE%89%E8%A3%85/%E5%AE%89%E8%A3%85OpenResty.md\">å®‰è£… OpenResty</a>.</p>\n<h3 id=\"612-æ¡ˆä¾‹openrestyå¿«é€Ÿå…¥é—¨å®ç°å•†å“è¯¦æƒ…é¡µæ•°æ®æŸ¥è¯¢\"><a class=\"anchor\" href=\"#612-æ¡ˆä¾‹openrestyå¿«é€Ÿå…¥é—¨å®ç°å•†å“è¯¦æƒ…é¡µæ•°æ®æŸ¥è¯¢\">#</a> 6.1.2ã€æ¡ˆä¾‹ï¼ŒOpenResty å¿«é€Ÿå…¥é—¨ï¼Œå®ç°å•†å“è¯¦æƒ…é¡µæ•°æ®æŸ¥è¯¢ğŸŒ²</h3>\n<p>å•†å“è¯¦æƒ…é¡µç›®å‰å±•ç¤ºçš„æ˜¯å‡æ•°æ®ï¼Œåœ¨æµè§ˆå™¨çš„æ§åˆ¶å°å¯ä»¥çœ‹åˆ°æŸ¥è¯¢å•†å“ä¿¡æ¯çš„è¯·æ±‚ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200915073.png\" alt=\"image-20231020091453815\" /></p>\n<p>è€Œè¿™ä¸ªè¯·æ±‚æœ€ç»ˆè¢«åå‘ä»£ç†åˆ°è™šæ‹Ÿæœºçš„ OpenResty é›†ç¾¤ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200915958.png\" alt=\"image-20231020091503555\" /></p>\n<p>éœ€æ±‚ï¼šåœ¨ OpenResty ä¸­æ¥æ”¶è¿™ä¸ªè¯·æ±‚ï¼Œå¹¶è¿”å›ä¸€æ®µå•†å“çš„å‡æ•°æ®ã€‚</p>\n<p>æ­¥éª¤ï¼šä¸€ã€‚</p>\n<p>1ã€åœ¨ nginx.conf çš„ http ä¸‹é¢ï¼Œæ·»åŠ å¯¹ OpenResty çš„ Lua æ¨¡å—çš„åŠ è½½</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># lua æ¨¡å—</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>lua_package_path <span class=\"token string\">\"/usr/local/openresty/lualib/?.lua;;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># c æ¨¡å—     </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>lua_package_cpath <span class=\"token string\">\"/usr/local/openresty/lualib/?.so;;\"</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>2ã€åœ¨ nginx.conf çš„ server ä¸‹é¢ï¼Œæ·»åŠ å¯¹ /api/item è¿™ä¸ªè·¯å¾„çš„ç›‘å¬</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># è¿™é‡Œå¯ä»¥ç†è§£ä¸ºå°±æ˜¯ SpringMVC ä¸­çš„ Controller</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>location /api/item <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># é»˜è®¤çš„å“åº”ç±»å‹</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>default_type application/json<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># è¿™é‡Œå¯ä»¥ç†è§£ä¸ºå°±æ˜¯ Service ä¸šåŠ¡é€»è¾‘å±‚</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># å“åº”ç»“æœç”± lua/item.lua ä¸‹çš„æ–‡ä»¶å†³å®š</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>content_by_lua_file lua/item.lua<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ­¥éª¤ï¼šäºŒã€‚</p>\n<p>1ã€åœ¨ nginx ç›®å½•åˆ›å»ºæ–‡ä»¶å¤¹ï¼šlua</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir lua</span></pre></td></tr></table></figure><p>2ã€åœ¨ lua æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»ºæ–‡ä»¶ï¼šitem.lua</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\"># touch lua/item.lua</span></pre></td></tr></table></figure><p>3ã€å†…å®¹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">--  è¿”å›å‡æ•°æ®ï¼Œè¿™é‡Œçš„ ngx.say () å‡½æ•°ï¼Œå°±æ˜¯å†™æ•°æ®åˆ° Response ä¸­</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&#123;\"id\":10001, \"name\":\"SALSA AIR\"&#125;'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>è¿™é‡Œé¢çš„å‡æ•°æ®å» uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDElRTQlQjglQUQlRTYlODklOTMlRTUlQkMlODAlRTYlOEUlQTclRTUlODglQjYlRTUlOEYlQjAlRTklODAlODklRTYlOEIlQTl2dWUlRTclODQlQjYlRTUlOTAlOEUlRTglQjUlOEIlRTUlODAlQkNJdGVtJUU0JUI5JTlGJUU1JUIwJUIxJUU2JTk4JUFGT2JqZWN0JUU1JUFGJUI5JUU4JUIxJUExJUVGJUJDJThDJUU1JUIwJTg2JUU5JTg3JThDJUU5JTlEJUEyJUU3JTlBJTg0JUU2JTk1JUIwJUU2JThEJUFFJUU0JUJEJTlDJUU0JUI4JUJBJUU1JTgxJTg3JUU2JTk1JUIwJUU2JThEJUFFJUU0JUJEJUJGJUU3JTk0JUE4\">http://localhost/item.html?id=10001 ä¸­æ‰“å¼€æ§åˆ¶å°é€‰æ‹© vue ç„¶åèµ‹å€¼ Item ä¹Ÿå°±æ˜¯ Object å¯¹è±¡ï¼Œå°†é‡Œé¢çš„æ•°æ®ä½œä¸ºå‡æ•°æ®ä½¿ç”¨</span></p>\n<p>è¿™ä¸ªé¡µé¢æ˜¯ä» nginx ä»£ç†é‡Œé¢è®¿é—®è¿‡æ¥çš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200940251.png\" alt=\"image-20231020094054757\" /></p>\n<p>å°†å‡æ•°æ®æ‹·è´åˆ° ngx.say (â€˜â€™) é‡Œé¢</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200942719.png\" alt=\"image-20231020094215395\" /></p>\n<p>ä¸ºäº†èƒ½åŒºåˆ†ä¸€ä¸‹æ˜¯å¦æˆåŠŸï¼Œæˆ‘ä»¬å°†é‡Œé¢çš„ä¸€äº›æ•°æ®è¿›è¡Œä¸€ä¸‹ä¿®æ”¹</p>\n<p>æ­¤å¤„åªæ˜¯ä¿®æ”¹äº†å°ºå¯¸å’Œä»·æ ¼</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&#123;\"id\":10001,\"name\":\"SALSA AIR\",\"title\":\"RIMOWA 31å¯¸æ‰˜è¿ç®±æ‹‰æ†ç®± SALSA AIRç³»åˆ—æœç»¿è‰² 820.70.36.4\",\"price\":27900,\"image\":\"https://m.360buyimg.com/mobilecms/s720x720_jfs/t6934/364/1195375010/84676/e9f2c55f/597ece38N0ddcbc77.jpg!q70.jpg.webp\",\"category\":\"æ‹‰æ†ç®±\",\"brand\":\"RIMOWA\",\"spec\":\"\",\"status\":1,\"createTime\":\"2019-04-30T16:00:00.000+00:00\",\"updateTime\":\"2019-04-30T16:00:00.000+00:00\",\"stock\":2999,\"sold\":31290&#125;'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>å®Œæ•´çš„ nginx.conf é…ç½®å†…å®¹ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#user  nobody;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">worker_processes</span>  <span class=\"token number\">1</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">error_log</span>  logs/error.log</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">events</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">worker_connections</span>  <span class=\"token number\">1024</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">http</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">include</span>       mime.types</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">default_type</span>  application/octet-stream</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">sendfile</span>        <span class=\"token boolean\">on</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">keepalive_timeout</span>  <span class=\"token number\">65</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\"># lua æ¨¡å—</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">lua_package_path</span> <span class=\"token string\">\"/usr/local/openresty/lualib/?.lua;;\"</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\"># c æ¨¡å—     </span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">lua_package_cpath</span> <span class=\"token string\">\"/usr/local/openresty/lualib/?.so;;\"</span></span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">listen</span>       <span class=\"token number\">8081</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">server_name</span>  localhost</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> /api/item</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>          <span class=\"token comment\"># é»˜è®¤çš„å“åº”ç±»å‹</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>          <span class=\"token directive\"><span class=\"token keyword\">default_type</span> application/json</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>          <span class=\"token comment\"># å“åº”ç»“æœç”± lua/item.lua ä¸‹çš„æ–‡ä»¶å†³å®š</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token directive\"><span class=\"token keyword\">content_by_lua_file</span> lua/item.lua</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> /</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">root</span>   html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">index</span>  index.html index.htm</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">error_page</span>   <span class=\"token number\">500</span> <span class=\"token number\">502</span> <span class=\"token number\">503</span> <span class=\"token number\">504</span>  /50x.html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> = /50x.html</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">root</span>   html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>4ã€é‡æ–°åŠ è½½é…ç½®</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>nginx <span class=\"token parameter variable\">-s</span> reload</pre></td></tr></table></figure><p>æŸ¥çœ‹å•†å“é¡µé¢ï¼Œæ²¡æœ‰åˆ·æ–°å‰</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200946010.png\" alt=\"image-20231020094617482\" /></p>\n<p>åˆ·æ–°å</p>\n<p>å¯ä»¥çœ‹åˆ°å°ºå¯¸å’Œä»·æ ¼è¢«ä¿®æ”¹äº†ä½†æ˜¯ä¸­æ–‡ä¹Ÿä¹±ç äº†ã€‚ã€‚ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200951850.png\" alt=\"image-20231020095132419\" /></p>\n<h2 id=\"62-openrestyè·å–è¯·æ±‚å‚æ•°\"><a class=\"anchor\" href=\"#62-openrestyè·å–è¯·æ±‚å‚æ•°\">#</a> 6.2ã€OpenResty è·å–è¯·æ±‚å‚æ•°ğŸŒ³</h2>\n<p>OpenResty æä¾›äº†å„ç§ API ç”¨æ¥è·å–ä¸åŒç±»å‹çš„è¯·æ±‚å‚æ•°ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200958589.png\" alt=\"image-20231020095810221\" /></p>\n<h3 id=\"621-æ¡ˆä¾‹è·å–è¯·æ±‚è·¯å¾„ä¸­çš„å•†å“idä¿¡æ¯æ‹¼æ¥åˆ°jsonç»“æœä¸­è¿”å›\"><a class=\"anchor\" href=\"#621-æ¡ˆä¾‹è·å–è¯·æ±‚è·¯å¾„ä¸­çš„å•†å“idä¿¡æ¯æ‹¼æ¥åˆ°jsonç»“æœä¸­è¿”å›\">#</a> 6.2.1ã€æ¡ˆä¾‹ï¼Œè·å–è¯·æ±‚è·¯å¾„ä¸­çš„å•†å“ id ä¿¡æ¯ï¼Œæ‹¼æ¥åˆ° json ç»“æœä¸­è¿”å›ğŸŒ²</h3>\n<p>åœ¨æŸ¥è¯¢å•†å“ä¿¡æ¯çš„è¯·æ±‚ä¸­ï¼Œé€šè¿‡è·¯å¾„å ä½ç¬¦çš„æ–¹å¼ï¼Œä¼ é€’äº†å•†å“ id åˆ°åå°ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201002974.png\" alt=\"image-20231020100241654\" /></p>\n<p>éœ€æ±‚ï¼šåœ¨ OpenResty ä¸­æ¥æ”¶è¿™ä¸ªè¯·æ±‚ï¼Œå¹¶è·å–è·¯å¾„ä¸­çš„ id ä¿¡æ¯ï¼Œæ‹¼æ¥åˆ°ç»“æœçš„ json å­—ç¬¦ä¸²ä¸­è¿”å›</p>\n<p>OpenResty ä¸­æ¥å—è¯·æ±‚</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">location</span> ~ /api/item(\\d+)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token comment\"># é»˜è®¤çš„å“åº”ç±»å‹</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">default_type</span> application/json</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\"># å“åº”ç»“æœç”± lua/item.lua ä¸‹çš„æ–‡ä»¶å†³å®š</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">content_by_lua_file</span> lua/item.lua</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¹¶è·å–è·¯å¾„ä¸­çš„ id ä¿¡æ¯ï¼Œæ‹¼æ¥åˆ°ç»“æœçš„ json å­—ç¬¦ä¸²ä¸­è¿”å›</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- è·å–è·¯å¾„å‚æ•°</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> id <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>var<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">-- è¿”å›ç»“æœ</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&#123;\"id\":'</span> <span class=\"token operator\">..</span> id <span class=\"token operator\">..</span> <span class=\"token string\">',\"name\":\"SALSA AIR\",\"title\":\"RIMOWA 31å¯¸æ‰˜è¿ç®±æ‹‰æ†ç®± SALSA AIRç³»åˆ—æœç»¿è‰² 820.70.36.4\",\"price\":27900,\"image\":\"https://m.360buyimg.com/mobilecms/s720x720_jfs/t6934/364/1195375010/84676/e9f2c55f/597ece38N0ddcbc77.jpg!q70.jpg.webp\",\"category\":\"æ‹‰æ†ç®±\",\"brand\":\"RIMOWA\",\"spec\":\"\",\"status\":1,\"createTime\":\"2019-04-30T16:00:00.000+00:00\",\"updateTime\":\"2019-04-30T16:00:00.000+00:00\",\"stock\":2999,\"sold\":31290&#125;'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>é‡å¯ Linux ä¸­çš„ nginx æœåŠ¡å™¨</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>nginx <span class=\"token parameter variable\">-s</span> reload</pre></td></tr></table></figure><p>è®¿é—®é¡µé¢è¿›è¡Œæµ‹è¯•ï¼š</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDE=\">http://localhost/item.html?id=10001</span></p>\n<p>è¯·æ±‚ç»“æœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201022922.png\" alt=\"image-20231020102241989\" /></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDI=\">http://localhost/item.html?id=10002</span></p>\n<p>è¯·æ±‚ç»“æœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201023953.png\" alt=\"image-20231020102259850\" /></p>\n<p>å¯ä»¥çœ‹åˆ° id å°±ä¸å†æ˜¯å†™æ­»çš„äº†ï¼Œè€Œæ˜¯å¯ä»¥äº‹å®å˜åŒ–çš„</p>\n<h2 id=\"63-æŸ¥è¯¢tomcat\"><a class=\"anchor\" href=\"#63-æŸ¥è¯¢tomcat\">#</a> 6.3ã€æŸ¥è¯¢ TomcatğŸŒ³</h2>\n<p>å…ˆçœ‹ä¸‹å¤šçº§ç¼“å­˜çš„æ¶æ„ã€‚ç›®å‰å·²ç»å‡†å¤‡å¥½äº† nginx åå‘ä»£ç†æœåŠ¡å™¨ï¼Œå®ƒå»æ¥å—å‰ç«¯çš„è¯·æ±‚å¹¶ä¸”è½¬åˆ° OpenRestyï¼ŒæœåŠ¡ç«¯ä¹Ÿç¼–å†™å¥½äº†è¿›ç¨‹ç¼“å­˜ OpenResty ä¹Ÿæ­å¥½äº†ï¼Œä½†æ˜¯ OpenResty æ¥æ”¶åˆ°è¯·æ±‚åè¦æŸ¥è¯¢æ•°æ®ã€‚æˆ‘ä»¬å…ˆå®ç°ä» Tomcat å»æŸ¥ç„¶åå†å­˜å‚¨åˆ°ç¼“å­˜ä¸­ã€‚</p>\n<p>éœ€è¦æ³¨å†Œ OPenResty åœ¨è™šæ‹Ÿæœºä¸Šï¼Œè€Œ Tomcat åœ¨æœ¬æœºä¸Šï¼Œip åœ°å€ä¸åŒ</p>\n<p>ä¸¤ä¸ª ip åœ°å€è®¿é—®çš„ä¾¿æ·æ–¹å¼ï¼šä¸ç®¡è™šæ‹Ÿæœºçš„ ip åœ°å€æ˜¯ä»€ä¹ˆåªè¦å®˜å‰ä¸‰ä½å°±è¡Œäº†ï¼Œç„¶åæŠŠæœ€åä¸€ä½æ›¿æ¢æˆ 1 ä¸€å®šå¾—åˆ°çš„å°±æ˜¯ windows ç”µè„‘çš„ä½ç½®ã€‚å‰ææ˜¯éœ€è¦å…³é—­é˜²ç«å¢™</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201030614.png\" alt=\"image-20231020103028998\" /></p>\n<h3 id=\"631-æ¡ˆä¾‹è·å–è¯·æ±‚è·¯å¾„ä¸­çš„å•†å“idä¿¡æ¯æ ¹æ®idå‘tomcatæŸ¥è¯¢å•†å“ä¿¡æ¯\"><a class=\"anchor\" href=\"#631-æ¡ˆä¾‹è·å–è¯·æ±‚è·¯å¾„ä¸­çš„å•†å“idä¿¡æ¯æ ¹æ®idå‘tomcatæŸ¥è¯¢å•†å“ä¿¡æ¯\">#</a> 6.3.1ã€æ¡ˆä¾‹ï¼Œè·å–è¯·æ±‚è·¯å¾„ä¸­çš„å•†å“ id ä¿¡æ¯ï¼Œæ ¹æ® id å‘ Tomcat æŸ¥è¯¢å•†å“ä¿¡æ¯ğŸŒ²</h3>\n<p>è¿™é‡Œè¦ä¿®æ”¹ item.luaï¼Œæ»¡è¶³ä¸‹é¢çš„éœ€æ±‚ï¼š</p>\n<p>1ã€è·å–è¯·æ±‚å‚æ•°ä¸­çš„ id</p>\n<p>2ã€æ ¹æ® id å‘ Tomcat æœåŠ¡å‘é€è¯·æ±‚ï¼ŒæŸ¥è¯¢å•†å“ä¿¡æ¯</p>\n<p>3ã€æ ¹æ® id å‘ Tomcat æœåŠ¡å‘é€è¯·æ±‚ï¼ŒæŸ¥è¯¢åº“å­˜ä¿¡æ¯</p>\n<p>4ã€ç»„è£…å•†å“ä¿¡æ¯ï¼Œåº“å­˜ä¿¡æ¯ï¼Œåºåˆ—åŒ–ä¸º Json æ ¼å¼å¹¶è¿”å›</p>\n<p>æ­¥éª¤ï¼š</p>\n<p>ä¸€ï¼Œnginx å†…éƒ¨å‘é€ Http è¯·æ±‚</p>\n<p>nginx æä¾›äº†å†…éƒ¨ API ç”¨ä»¥å‘é€ http è¯·æ±‚ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># æ³¨æ„ï¼šè¿™é‡Œçš„ path æ˜¯è·¯å¾„ï¼Œå¹¶ä¸åŒ…å« ip å’Œç«¯å£ã€‚è¿™ä¸ªè¯·æ±‚ä¼šè¢« nginx å†…éƒ¨çš„ server ç›‘å¬å¹¶å¤„ç†</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># è¿™è‚¯å®šä¸è¡Œï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›å¯ä»¥å‘é€ç»™ Tomcat æ‰€ä»¥å°±è¦æŒ‡å®š Tomcat çš„ ip å’Œç«¯å£</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">local</span> resp = ngx.location.capture(<span class=\"token string\">\"/path\"</span>,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   \t<span class=\"token directive\"><span class=\"token keyword\">method</span> = ngx.HTTP_GET, -- è¯·æ±‚æ–¹å¼</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      args =</span> <span class=\"token punctuation\">&#123;</span>a = 1, b = 2<span class=\"token punctuation\">&#125;</span>, -- getæ–¹å¼ä¼ å‚æ•°</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      body = \"c=3&amp;d=4\" -- postæ–¹å¼ä¼ å‚æ•°</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span>)</pre></td></tr></table></figure><p>è¿”å›çš„å“åº”å†…å®¹åŒ…æ‹¬ï¼š</p>\n<ul>\n<li>resp.statusï¼šå“åº”çŠ¶æ€ç </li>\n<li>resp.headerï¼šå“åº”å¤´ï¼Œæ˜¯ä¸€ä¸ª table</li>\n<li>resp.bodyï¼šå“åº”ä½“ï¼Œå°±æ˜¯å“åº”æ•°æ®</li>\n</ul>\n<p>æˆ‘ä»¬å¸Œæœ›è¿™ä¸ªè¯·æ±‚å‘é€åˆ° Tomcat æœåŠ¡å™¨ï¼Œæ‰€ä»¥è¿˜éœ€è¦ç¼–å†™ä¸€ä¸ª server æ¥å¯¹è¿™ä¸ªè·¯å¾„åšåå‘ä»£ç†ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">location</span> /path</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token comment\"># è¿™é‡Œæ˜¯ windows ç”µè„‘çš„ ip å’Œ Java æœåŠ¡ç«¯å£ï¼Œéœ€è¦ç¡®ä¿ windows é˜²ç«å¢™å¤„äºå…³é—­çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">proxy_pass</span> http://192.168.137.169:8081</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™ä»£ç ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">listen</span>       <span class=\"token number\">8081</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">server_name</span>  localhost</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">location</span> /item</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token directive\"><span class=\"token keyword\">proxy_pass</span> http://192.168.137.1:8081</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">location</span> ~ /api/item/(\\d+)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token comment\"># é»˜è®¤çš„å“åº”ç±»å‹</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token directive\"><span class=\"token keyword\">default_type</span> application/json</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token comment\"># å“åº”ç»“æœç”± lua/item.lua ä¸‹çš„æ–‡ä»¶å†³å®š</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token directive\"><span class=\"token keyword\">content_by_lua_file</span> lua/item.lua</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">location</span> /</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token directive\"><span class=\"token keyword\">root</span>   html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token directive\"><span class=\"token keyword\">index</span>  index.html index.htm</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">error_page</span>   <span class=\"token number\">500</span> <span class=\"token number\">502</span> <span class=\"token number\">503</span> <span class=\"token number\">504</span>  /50x.html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">location</span> = /50x.html</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token directive\"><span class=\"token keyword\">root</span>   html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Tomcat çš„åå‘ä»£ç†æå®šäº†ï¼Œä»¥ååªè¦è°ƒç”¨ capture API è¯·æ±‚æ˜¯ item å¼€å¤´å°±ä¸€å®šèƒ½è¾¾åˆ° Tomcatã€‚æ‰€ä»¥ä»¥åå°±å¯ä»¥æ”¾å¿ƒçš„ä½¿ç”¨è¿™å¥— API äº†ï¼Œé‚£ä¹ˆæ—¢ç„¶è¿™ä¸ª API ç»å¸¸è¦ä½¿ç”¨ã€‚é‚£æˆ‘ä»¬å¯ä»¥å°†å‘è¯·æ±‚çš„ä»£ç å°è£…æˆä¸€ä¸ªå‡½æ•°</p>\n<h4 id=\"6311-å°è£…httpæŸ¥è¯¢çš„å‡½æ•°\"><a class=\"anchor\" href=\"#6311-å°è£…httpæŸ¥è¯¢çš„å‡½æ•°\">#</a> 6.3.1.1ã€å°è£… HTTP æŸ¥è¯¢çš„å‡½æ•°ğŸŒ´</h4>\n<p>æˆ‘ä»¬å¯ä»¥å§ http æŸ¥è¯¢çš„è¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œæ”¾åˆ° OPenResty å‡½æ•°åº“ä¸­ï¼Œæ–¹ä¾¿åæœŸä½¿ç”¨ã€‚</p>\n<p>1ã€åœ¨ /usr/local/openresty/lualib ç›®å½•ä¸‹åˆ›å»º common.lua æ–‡ä»¶ï¼š</p>\n<p>ä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªä½ç½®ï¼Ÿ å› ä¸ºåœ¨ä¸Šè¿°é…ç½® nginx åŠ è½½æ¨¡å—ä¸­æŒ‡å®šçš„è·¯å¾„å°±æ˜¯åŠ è½½è¿™ä¸ªä½ç½®çš„ä»»ä½•.lua æ–‡ä»¶</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> /usr/local/openresty/lualib/common.lua</pre></td></tr></table></figure><p>2ã€åœ¨ common.lua ä¸­å°è£… http æŸ¥è¯¢çš„å‡½æ•°</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å°è£…å‡½æ•°ï¼Œå‘é€ http è¯·æ±‚ï¼Œå¹¶è§£æå“åº”</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">read_http</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">local</span> resp <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span><span class=\"token function\">capture</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        method <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>HTTP_GET<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        args <span class=\"token operator\">=</span> params<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> resp <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">-- è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œè¿”å› 404</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"http not found, path: \"</span><span class=\"token punctuation\">,</span> path <span class=\"token punctuation\">,</span> <span class=\"token string\">\", args: \"</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">404</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">return</span> resp<span class=\"token punctuation\">.</span>body</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">-- å°†æ–¹æ³•å¯¼å‡º</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">local</span> _M <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>  </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    read_http <span class=\"token operator\">=</span> read_http</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span>  </pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">return</span> _M</pre></td></tr></table></figure><p>åœ¨ item.lua æ–‡ä»¶ä¸­ç¼–å†™ä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å¯¼å…¥ common å‡½æ•°åº“</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> common <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'common'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">local</span> read_http <span class=\"token operator\">=</span> common<span class=\"token punctuation\">.</span>read_http</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">-- è·å–è·¯å¾„å‚æ•°</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">local</span> id <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>var<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢å•†å“ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">local</span> itemJSON <span class=\"token operator\">=</span> <span class=\"token function\">read_http</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/item/\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢åº“å­˜ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">local</span> stockJSON <span class=\"token operator\">=</span> <span class=\"token function\">read_http</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/item/stock\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">-- è¿”å›ç»“æœ</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span>itemJSON<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>è®¿é—® uri è¿›è¡Œä¸€ä¸‹è¯·æ±‚æµ‹è¯•ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDM=\">http://localhost/item.html?id=10003</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201318784.png\" alt=\"image-20231020131800919\" /></p>\n<p>è¿”å›çš„æ•°æ®</p>\n<pre><code>&#123;\n    &quot;id&quot;: 10003,\n    &quot;name&quot;: &quot;éŸ©ç‰ˆç‰›ä»”è£¤&quot;,\n    &quot;title&quot;: &quot;å”ç‹®æ–°å“ç‰›ä»”è£¤å¥³å­¦ç”ŸéŸ©ç‰ˆå®½æ¾è£¤å­ Aæ¬¾/ä¸­ç‰›ä»”è“ï¼ˆæ— ç»’æ¬¾ï¼‰ 26&quot;,\n    &quot;price&quot;: 84600,\n    &quot;image&quot;: &quot;https://m.360buyimg.com/mobilecms/s720x720_jfs/t26989/116/124520860/644643/173643ea/5b860864N6bfd95db.jpg!q70.jpg.webp&quot;,\n    &quot;category&quot;: &quot;ç‰›ä»”è£¤&quot;,\n    &quot;brand&quot;: &quot;å”ç‹®&quot;,\n    &quot;spec&quot;: &quot;&#123;\\&quot;é¢œè‰²\\&quot;: \\&quot;è“è‰²\\&quot;, \\&quot;å°ºç \\&quot;: \\&quot;26\\&quot;&#125;&quot;,\n    &quot;status&quot;: 1,\n    &quot;createTime&quot;: &quot;2019-05-01T00:00:00.000+00:00&quot;,\n    &quot;updateTime&quot;: &quot;2019-05-01T00:00:00.000+00:00&quot;,\n    &quot;stock&quot;: null,\n    &quot;sold&quot;: null\n&#125;\n</code></pre>\n<p>ç°åœ¨æ‰€æœ‰çš„å•†å“éƒ½èƒ½æ­£å¸¸æŸ¥è¯¢äº†ï¼Œä½†æ˜¯ï¼</p>\n<p>é‡Œé¢çš„ï¼Œé”€é‡å’Œå­˜åº“çš„æ•°æ®è¿˜æ²¡æœ‰ã€‚</p>\n<p>ä½†æ˜¯å¦‚æœè¦æ˜¯æœ‰ 3 å¼ è¡¨ï¼Œ4 å¼ è¡¨ï¼Œ5 å¼ è¡¨éƒ½éœ€è¦æŠŠå®ƒä»¬æ‹¼æ¥èµ·æ¥ï¼Œæ‰€ä»¥æœ€ç»ˆéœ€è¦çš„æ˜¯å®Œæ•´çš„æ•°æ®</p>\n<p>ä½†æ˜¯ itemJSON å¾—åˆ°çš„æ•°æ®æ˜¯ä¸€ä¸ª Json æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦è½¬æ¢ä¸º Lua é‡Œé¢çš„å¯¹è±¡ï¼Œä½¿ç”¨ table è¿™ä¸ªæ•°æ®ç±»å‹æ¥è¿›è¡Œå­˜å‚¨</p>\n<p>å¦‚ä¸‹å°±æ˜¯å°† JSON ååºåˆ—åŒ–ä¸º Lua å¯¹è±¡çš„æ–¹å¼ï¼š</p>\n<h4 id=\"6312-jsonç»“æœå¤„ç†\"><a class=\"anchor\" href=\"#6312-jsonç»“æœå¤„ç†\">#</a> 6.3.1.2ã€JSON ç»“æœå¤„ç†ğŸŒ´</h4>\n<p>OPenResty æä¾›äº†ä¸€ä¸ª cjson çš„æ¨¡å—ç”¨æ¥å¤„ç† JSON çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p>\n<p>å®˜æ–¹åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL29wZW5yZXN0eS9sdWEtY2pzb24v\">https://github.com/openresty/lua-cjson/</span></p>\n<p>è¯¥æ¨¡å—çš„ç›®å½•ä½ç½®å¦‚ä¸‹ï¼š/usr/local/openresty/lualib/</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201330405.png\" alt=\"image-20231020133045031\" /></p>\n<p><strong>ä½¿ç”¨</strong>ï¼š</p>\n<p>1ã€å¯¼å…¥ cjson æ¨¡å—ï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">local</span> cjson <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cjson'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>2ã€åºåˆ—åŒ–ï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">local</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   name <span class=\"token operator\">=</span> <span class=\"token string\">'jack'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   age <span class=\"token operator\">=</span> <span class=\"token number\">21</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">local</span> json <span class=\"token operator\">=</span> cjson<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>3ã€ååºåˆ—åŒ–</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">local</span> json <span class=\"token operator\">=</span> <span class=\"token string\">'&#123;\"name\": \"jack\", \"age\": 21&#125;'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">-- ååºåˆ—åŒ–</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">local</span> obj <span class=\"token operator\">=</span> cjson<span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">print</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>ç»§ç»­ä¸‹é¢çš„ä»£ç æ­¥éª¤ï¼š</p>\n<p>1ã€å°†è¯·æ±‚åˆ°çš„ json æ•°æ®åºåˆ—åŒ–ä¸º lua ä¸­çš„ table æ•°æ®</p>\n<p>2ã€å†å°†åºåˆ—åŒ–çš„æ•°æ®è¿›è¡Œè°ƒç”¨æ‹¼æ¥</p>\n<p>3ã€æ‹¼æ¥å®Œæ¯•åå†å°† lua ä¸­ table æ•°æ®åºåˆ—åŒ–ä¸º json å“åº”åˆ°å‰ç«¯</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å¯¼å…¥ common å‡½æ•°åº“</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> common <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'common'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">local</span> read_http <span class=\"token operator\">=</span> common<span class=\"token punctuation\">.</span>read_http</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">-- å¯¼å…¥ cjson åº“</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">local</span> cjson <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cjson'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">-- è·å–è·¯å¾„å‚æ•°</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">local</span> id <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>var<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢å•†å“ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">local</span> itemJSON <span class=\"token operator\">=</span> <span class=\"token function\">read_http</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/item/\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢åº“å­˜ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">local</span> stockJSON <span class=\"token operator\">=</span> <span class=\"token function\">read_http</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/item/stock/\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">-- JSON è½¬åŒ–ä¸º lua çš„ table</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">local</span> item <span class=\"token operator\">=</span> cjson<span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>itemJSON<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">local</span> sto <span class=\"token operator\">=</span> cjson<span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>stockJSON<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">-- ç»„åˆæ•°æ®</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>item<span class=\"token punctuation\">.</span>stock <span class=\"token operator\">=</span> sto<span class=\"token punctuation\">.</span>stock</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>item<span class=\"token punctuation\">.</span>sold <span class=\"token operator\">=</span> sto<span class=\"token punctuation\">.</span>sold</pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">-- æŠŠ item åºåˆ—åŒ–ä¸º json è¿”å›ç»“æœ</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span>cjson<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>è¯·æ±‚ uri è¿›è¡Œæµ‹è¯•ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDQ=\">http://localhost/item.html?id=10004</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201343013.png\" alt=\"image-20231020134303536\" /></p>\n<p>è¯·æ±‚åˆ°çš„æ•°æ®</p>\n<pre><code>&#123;\n    &quot;spec&quot;: &quot;&#123;\\&quot;é¢œè‰²\\&quot;: \\&quot;ç™½è‰²\\&quot;, \\&quot;å°ºç \\&quot;: \\&quot;36\\&quot;&#125;&quot;,\n    &quot;sold&quot;: 974,\n    &quot;status&quot;: 1,\n    &quot;updateTime&quot;: &quot;2019-05-01T00:00:00.000+00:00&quot;,\n    &quot;title&quot;: &quot;æ£®é©¬(senma)ä¼‘é—²é‹å¥³2019æ˜¥å­£æ–°æ¬¾éŸ©ç‰ˆç³»å¸¦æ¿é‹å­¦ç”Ÿç™¾æ­å¹³åº•å¥³é‹ é»„è‰² 36&quot;,\n    &quot;stock&quot;: 99999,\n    &quot;price&quot;: 10400,\n    &quot;image&quot;: &quot;https://m.360buyimg.com/mobilecms/s720x720_jfs/t1/29976/8/2947/65074/5c22dad6Ef54f0505/0b5fe8c5d9bf6c47.jpg!q70.jpg.webp&quot;,\n    &quot;createTime&quot;: &quot;2019-05-01T00:00:00.000+00:00&quot;,\n    &quot;category&quot;: &quot;ä¼‘é—²é‹&quot;,\n    &quot;name&quot;: &quot;ä¼‘é—²æ¿é‹&quot;,\n    &quot;brand&quot;: &quot;æ£®é©¬&quot;,\n    &quot;id&quot;: 10004\n&#125;\n</code></pre>\n<p>å¯ä»¥çœ‹åˆ°æœ‰åº“å­˜å’Œé”€é‡çš„æ•°æ®äº†</p>\n<h3 id=\"632-tomcaté›†ç¾¤çš„è´Ÿè½½å‡è¡¡\"><a class=\"anchor\" href=\"#632-tomcaté›†ç¾¤çš„è´Ÿè½½å‡è¡¡\">#</a> 6.3.2ã€Tomcat é›†ç¾¤çš„è´Ÿè½½å‡è¡¡ğŸŒ²</h3>\n<p>æˆ‘ä»¬å·²ç»å®ç°äº†ï¼Œä» OPenResty å‘ tomcat å‘é€ä¸€ä¸ª http è¯·æ±‚å»æŸ¥è¯¢å•†å“ä¿¡æ¯è¿”å›é¡µé¢ï¼Œå®Œæˆæ¸²æŸ“ã€‚ä½†æ˜¯åœ¨ä¸Šè¿°å®ç°æ¡ˆä¾‹ä¸­ Tomcat åªæœ‰ä¸€å°</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201346554.png\" alt=\"image-20231020134614455\" /></p>\n<p>åœ¨å®é™…ç”Ÿäº§ä¸­ Tomcat ä¸€å®šæ˜¯ä¸€ä¸ªé›†ç¾¤ã€‚æ‰€ä»¥ OPenResty å†å‘é€è¯·æ±‚æ—¶å¿…é¡»å¾—å¯¹å¤šå° Tomcat å®ç°ä¸€ä¸ªè´Ÿè½½å‡è¡¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201349192.png\" alt=\"image-20231020134913570\" /></p>\n<p>æ¯”æ–¹è¯´ è´Ÿè½½å‡è¡¡æŒ‘é€‰äº† 8081ï¼Œç„¶åè¯·æ±‚å°±ä¼šåˆ°è¾¾ 8081 ç„¶åå»æŸ¥è¯¢æ•°æ®åº“ã€‚</p>\n<p>æŸ¥è¯¢å®Œæ•°æ®åº“åä¼šå½¢æˆä¸€ä¸ª jvm è¿›ç¨‹ç¼“å­˜ï¼Œä¿å­˜åœ¨ 8081 è¿™å°æœåŠ¡å™¨ä¸Šï¼Œç¼“å­˜æœ‰äº†ä»¥åä¸‹æ¬¡å¯ä»¥ç›´æ¥è¯»å–ç¼“å­˜å°±ä¸ç”¨æŸ¥è¯¢æ•°æ®åº“äº†æ€§èƒ½å°±éå¸¸å¥½äº†ã€‚ä½†æ˜¯éå¸¸å¯æƒœçš„æ˜¯è¿›ç¨‹ç¼“å­˜æ˜¯ä¸èƒ½å…±äº«çš„ 8081 æœ‰è¿™ä¸ªç¼“å­˜ï¼Œ8082 å¹¶æ²¡æœ‰ï¼Œè€Œè´Ÿè½½å‡è¡¡çš„è§„åˆ™æ˜¯ è½®è¯¢ã€‚å¦‚æœè¿™æ ·è®¿é—®ç¼“å­˜å°±ä¼šåœ¨å¤šå° Tomcat å»å†—ä½™çš„ä¿å­˜ã€‚ç¬¬ä¸€ä¸ªå ç”¨é¢å¤–ç©ºé—´ï¼Œç¬¬äºŒæ˜¯ç¼“å­˜çš„å‘½ä¸­ç‡ä¹Ÿæœ‰ç‚¹æƒ¨</p>\n<p>å¦‚æœè¯´æˆ‘æƒ³è¦å•†å“ 10001 ç¬¬ä¸€æ¬¡æŸ¥è¯¢å®Œä»¥åæ°¸è¿œéƒ½æœ‰ç¼“å­˜ã€‚é‚£ä¹ˆæˆ‘å¿…é¡»è®© item/10001 è¿™ä¸ªè¯·æ±‚æ¯æ¬¡éƒ½æŒ‡å‘åŒä¸€ä¸ªæœåŠ¡å™¨ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯è¿™ä¸ªç¼“å­˜ä¸€ç›´ç”Ÿæ•ˆã€‚å‡å¦‚è¯´åˆæ¥ä¸€ä¸ª item/10002 é‚£æˆ‘å°±è®©å®ƒæŒ‡å‘ä¸‹ä¸€ä¸ªæœåŠ¡å™¨ã€‚</p>\n<p>ä¸åŒå•†å“æ°¸è¿œè®¿é—®ä¸åŒæœåŠ¡å™¨ï¼Œç›¸åŒå•†å“æ°¸è¿œè®¿é—®åŒä¸€ä¸ªæœåŠ¡å™¨ï¼Œè¿™æ ·å°±èƒ½ä¿è¯ç¼“å­˜æ°¸è¿œå‘½ä¸­ã€‚</p>\n<p>è¿™æ · jvm è¿›ç¨‹ç¼“å­˜æ‰æœ‰æ„ä¹‰ã€‚ä½†æ˜¯ç°åœ¨æ˜¯è½®è¯¢è‚¯å®šåšä¸åˆ°è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹ nginx è´Ÿè½½å‡è¡¡çš„ç®—æ³•äº†ã€‚</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># tomcat é›†ç¾¤é…ç½®</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">upstream</span> tomcat-cluster</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\"># æ ¹æ®è¯·æ±‚è¿‡æ¥çš„è·¯å¾„æ¥è®¡ç®— hash å€¼ç„¶åå†³å®šè®¿é—®å“ªä¸ªæœåŠ¡å™¨</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token directive\"><span class=\"token keyword\">hash</span> <span class=\"token variable\">$request_uri</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">server</span> 192.168.249.128:8081</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">server</span> 192.168.249.128:8082</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä»£ç æ¼”ç¤ºå¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">http</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">include</span>       mime.types</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">default_type</span>  application/octet-stream</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">sendfile</span>        <span class=\"token boolean\">on</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">keepalive_timeout</span>  <span class=\"token number\">65</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\"># lua æ¨¡å—</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">lua_package_path</span> <span class=\"token string\">\"/usr/local/openresty/lualib/?.lua;;\"</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\"># c æ¨¡å—     </span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">lua_package_cpath</span> <span class=\"token string\">\"/usr/local/openresty/lualib/?.so;;\"</span></span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">upstream</span> tomcat-cluster</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">hash</span> <span class=\"token variable\">$request_uri</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">server</span> 192.168.249.128:8081</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">server</span> 192.168.249.128:8082</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">listen</span>       <span class=\"token number\">8081</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">server_name</span>  localhost</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> /item</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">proxy_pass</span> http://tomcat-cluster</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> ~ /api/item/(\\d+)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>          <span class=\"token comment\"># é»˜è®¤çš„å“åº”ç±»å‹</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>          <span class=\"token directive\"><span class=\"token keyword\">default_type</span> application/json</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token comment\"># å“åº”ç»“æœç”± lua/item.lua ä¸‹çš„æ–‡ä»¶å†³å®š</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>          <span class=\"token directive\"><span class=\"token keyword\">content_by_lua_file</span> lua/item.lua</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> /</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">root</span>   html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">index</span>  index.html index.htm</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">error_page</span>   <span class=\"token number\">500</span> <span class=\"token number\">502</span> <span class=\"token number\">503</span> <span class=\"token number\">504</span>  /50x.html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> = /50x.html</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">root</span>   html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨ idea ä¸­å¼€å¯ 8082 ç«¯å£çš„æœåŠ¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201435034.png\" alt=\"image-20231020143541296\" /></p>\n<p>å¯åŠ¨</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201436217.png\" alt=\"image-20231020143629316\" /></p>\n<p>è®¿é—® uri è¿›è¡Œæµ‹è¯•ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDE=\">http://localhost/item.html?id=10001</span></p>\n<p>è¿™ä¸ª uri è®¿é—®è¯·æ±‚åˆ°çš„ Tomcat æœåŠ¡ä¸ºå¦‚ä¸‹ï¼š</p>\n<p>idea æ§åˆ¶å°ä¸­æ‰“å°ä¿¡æ¯ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201441979.png\" alt=\"image-20231020144146827\" /></p>\n<p>è®¿é—® uri è¿›è¡Œæµ‹è¯•ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDI=\">http://localhost/item.html?id=10002</span></p>\n<p>è¿™ä¸ª uri è®¿é—®è¯·æ±‚åˆ°çš„ Tomcat æœåŠ¡ä¸ºå¦‚ä¸‹ï¼š</p>\n<p>idea æ§åˆ¶å°ä¸­æ‰“å°ä¿¡æ¯ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201442866.png\" alt=\"image-20231020144213109\" /></p>\n<p>å°†è¿ä¸ªæœåŠ¡çš„æ§åˆ¶å°æ‰“å°çš„ä¿¡æ¯éƒ½æ¸…ç©ºç„¶åå†å»è®¿é—®ä¸€ä¸‹ 10001 å’Œ 10002</p>\n<p>æ§åˆ¶å°éƒ½æ²¡æœ‰æ‰“å°ä»»ä½•çš„ä¿¡æ¯è¯´æ˜ç¼“å­˜èµ·ä½œç”¨äº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201443037.png\" alt=\"image-20231020144338972\" /></p>\n<h2 id=\"64-æ·»åŠ redisç¼“å­˜çš„éœ€æ±‚\"><a class=\"anchor\" href=\"#64-æ·»åŠ redisç¼“å­˜çš„éœ€æ±‚\">#</a> 6.4ã€æ·»åŠ  Redis ç¼“å­˜çš„éœ€æ±‚ğŸŒ³</h2>\n<p>è¯·æ±‚æˆåŠŸåä¸åº”è¯¥ç›´æ¥æŸ¥è¯¢ jvm è¿›ç¨‹ç¼“å­˜è€Œæ˜¯åº”è¯¥å…ˆåˆ° redis ä¸­çœ‹çœ‹æœ‰æ²¡æœ‰ç¼“å­˜å†å»çœ‹ jvm è¿›ç¨‹ç¼“å­˜</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201447926.png\" alt=\"image-20231020144727615\" /></p>\n<h3 id=\"641-æ·»åŠ redisç¼“å­˜è¦é¢ä¸´çš„é—®é¢˜\"><a class=\"anchor\" href=\"#641-æ·»åŠ redisç¼“å­˜è¦é¢ä¸´çš„é—®é¢˜\">#</a> 6.4.1ã€æ·»åŠ  Redis ç¼“å­˜è¦é¢ä¸´çš„é—®é¢˜ğŸŒ²</h3>\n<h4 id=\"6411-å†·å¯åŠ¨ä¸ç¼“å­˜é¢„çƒ­\"><a class=\"anchor\" href=\"#6411-å†·å¯åŠ¨ä¸ç¼“å­˜é¢„çƒ­\">#</a> 6.4.1.1ã€å†·å¯åŠ¨ä¸ç¼“å­˜é¢„çƒ­ğŸŒ´</h4>\n<p><mark>å†·å¯åŠ¨</mark>ï¼šæœåŠ¡åˆšåˆšå¯åŠ¨æ—¶ï¼ŒRedis ä¸­å¹¶æ²¡æœ‰ç¼“å­˜ï¼Œå¦‚æœæ‰€æœ‰å•†å“æ•°æ®éƒ½åœ¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ˜¯æ·»åŠ ç¼“å­˜ï¼Œå¯èƒ½ä¼šç»™æ•°æ®åº“å¸¦æ¥è¾ƒå¤§å‹åŠ›</p>\n<p><mark>ç¼“å­˜é¢„çƒ­</mark>ï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¤§æ•°æ®ç»Ÿè®¡ç”¨æˆ·è®¿é—®çš„çƒ­ç‚¹æ•°æ®ï¼Œåœ¨é¡¹ç›®å¯åŠ¨æ—¶å°†è¿™äº›çƒ­ç‚¹æ•°æ®æå‰æŸ¥è¯¢å¹¶ä¿å­˜åˆ° Redis ä¸­</p>\n<p>æˆ‘ä»¬æ•°æ®æµé‡è¾ƒå°‘ï¼Œå¯ä»¥åœ¨å¯åŠ¨æ—¶å°†æ‰€æœ‰æ•°æ®éƒ½å­˜å…¥ç¼“å­˜ä¸­ã€‚</p>\n<h4 id=\"6412-ç¼“å­˜é¢„çƒ­\"><a class=\"anchor\" href=\"#6412-ç¼“å­˜é¢„çƒ­\">#</a> 6.4.1.2ã€ç¼“å­˜é¢„çƒ­ğŸŒ´</h4>\n<p>æ­¥éª¤ï¼š</p>\n<p>1ã€åˆ©ç”¨ Docker å®‰è£… Redis</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker run --name redis -p 6379:6379 -d redis redis-server --appendonly yes</span></pre></td></tr></table></figure><p>2ã€åœ¨ item-service æœåŠ¡ä¸­å¼•å…¥ redis ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-data-redis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>3ã€é…ç½® Redis åœ°å€</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">redis</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> 192.168.249.128</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6379</span></pre></td></tr></table></figure><p>4ã€ç¼–å†™åˆå§‹åŒ–ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RedisHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">InitializingBean</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">StringRedisTemplate</span> redisTemplate<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">ItemService</span> itemService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">IItemStockService</span> stockService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ObjectMapper</span> <span class=\"token constant\">MAPPER</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectMapper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">afterPropertiesSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">// åˆå§‹åŒ–ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// 1. æŸ¥è¯¢å•†å“ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Item</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> itemService<span class=\"token punctuation\">.</span><span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// 2. æ”¾å…¥ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Item</span> item <span class=\"token operator\">:</span> list<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token comment\">// 2.1. åºåˆ—åŒ–ä¸º json</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token class-name\">String</span> json <span class=\"token operator\">=</span> <span class=\"token constant\">MAPPER</span><span class=\"token punctuation\">.</span><span class=\"token function\">writeValueAsString</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token comment\">// 2.2. å­˜å…¥ redis</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item:id:\"</span> <span class=\"token operator\">+</span> item<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> json<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token comment\">// 1. æŸ¥è¯¢åº“å­˜ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ItemStock</span><span class=\"token punctuation\">></span></span> list1 <span class=\"token operator\">=</span> stockService<span class=\"token punctuation\">.</span><span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// 2. æ”¾å…¥ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ItemStock</span> itemStock <span class=\"token operator\">:</span> list1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token comment\">// 2.1. åºåˆ—åŒ–ä¸º json</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token class-name\">String</span> json <span class=\"token operator\">=</span> <span class=\"token constant\">MAPPER</span><span class=\"token punctuation\">.</span><span class=\"token function\">writeValueAsString</span><span class=\"token punctuation\">(</span>itemStock<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token comment\">// 2.2. å­˜å…¥ redis</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item:stock:id:\"</span> <span class=\"token operator\">+</span> itemStock<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> json<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>é‡å¯æˆ–å¯åŠ¨ 8081 å’Œ 8082 ä¸¤ä¸ªæœåŠ¡å™¨</p>\n<p>å¯ä»¥çœ‹åˆ°å¯åŠ¨æ—¶ redis åˆå§‹åŒ–ç¼“å­˜å»æŸ¥è¯¢äº†æ•°æ®åº“æ­¤æ—¶å¯ä»¥çœ‹ä¸‹ redis ä¸­çš„æ•°æ®æƒ…å†µ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201513672.png\" alt=\"image-20231020151344361\" /></p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker exec -it redis redis-cli</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> keys *</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item:id:10004\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item:stock:id:10004\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item:id:10002\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item:stock:id:10005\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item:id:10001\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item:stock:id:10001\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item:stock:id:10003\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item:id:10003\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> <span class=\"token number\">9</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item:stock:id:10002\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item:id:10005\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><h2 id=\"65-æŸ¥è¯¢redisç¼“å­˜\"><a class=\"anchor\" href=\"#65-æŸ¥è¯¢redisç¼“å­˜\">#</a> 6.5ã€æŸ¥è¯¢ Redis ç¼“å­˜ğŸŒ³</h2>\n<h3 id=\"651-openrestyçš„redisæ¨¡å—\"><a class=\"anchor\" href=\"#651-openrestyçš„redisæ¨¡å—\">#</a> 6.5.1ã€OpenResty çš„ Redis æ¨¡å—ğŸŒ²</h3>\n<p>OPenResty æä¾›äº†æ“ä½œ Redis çš„æ¨¡å—ï¼Œæˆ‘ä»¬åªè¦å¼•å…¥è¯¥æ¨¡å—å°±èƒ½ç›´æ¥ä½¿ç”¨ï¼š</p>\n<p>åœ¨ common.lua æ–‡ä»¶ä¸­è¿›è¡Œç¼–å†™</p>\n<ul>\n<li>å¼•å…¥ Redis æ¨¡å—ï¼Œå¹¶åˆå§‹åŒ– Redis å¯¹è±¡</li>\n</ul>\n<p>ä¸ºä»€ä¹ˆå¼•å…¥æ¨¡å—ä¸­æ–‡ä»¶åä¸­é—´éœ€è¦ä¸€ä¸ª . ï¼Ÿ</p>\n<p>è§£é‡Šï¼šå› ä¸ºæˆ‘ä»¬ä¸Šè¿°æ–‡ç« ä¸­éƒ½æ˜¯å¼•å…¥çš„ lualib ç›®å½•ä¸‹çš„æ¨¡å—å› ä¸ºç›´æ¥åœ¨ lua ç›®å½•æ‰€ä»¥å¯ä»¥ç›´æ¥å†™æ–‡ä»¶åå°±è¡Œäº†ã€‚ä½†æ˜¯è¿™ä¸ª redis å¯ä¸å† lualib æ ¹ç›®å½•ä¸­è€Œæ˜¯åœ¨ resty ç›®å½•ä¸‹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201533407.png\" alt=\"image-20231020153335950\" /></p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å¼•å…¥ redis æ¨¡å—</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> redis <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resty.redis'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">-- åˆå§‹åŒ– redis å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">local</span> red <span class=\"token operator\">=</span> redis<span class=\"token punctuation\">:</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">-- è®¾ç½® redis è¶…æ—¶æ—¶é—´</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>red<span class=\"token punctuation\">:</span><span class=\"token function\">set_timeouts</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><ul>\n<li>å°è£…å‡½æ•°ï¼Œç”¨æ¥é‡Šæ”¾ Redis é“¾æ¥ï¼Œå…¶å®æ˜¯æ”¾å…¥è¿æ¥æ± </li>\n</ul>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å…³é—­ redis è¿æ¥çš„å·¥å…·æ–¹æ³•ï¼Œå…¶å®æ˜¯æ”¾å…¥è¿æ¥æ± </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">close_redis</span><span class=\"token punctuation\">(</span>red<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">local</span> pool_max_idle_time <span class=\"token operator\">=</span> <span class=\"token number\">10000</span> <span class=\"token comment\">-- è¿æ¥çš„ç©ºé—²æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">local</span> pool_size <span class=\"token operator\">=</span> <span class=\"token number\">100</span> <span class=\"token comment\">-- è¿æ¥æ± å¤§å°</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">local</span> ok<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> red<span class=\"token punctuation\">:</span><span class=\"token function\">set_keepalive</span><span class=\"token punctuation\">(</span>pool_max_idle_time<span class=\"token punctuation\">,</span> pool_size<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> ok <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"æ”¾å…¥redisè¿æ¥æ± å¤±è´¥: \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>OPenResty æä¾›äº†æ“ä½œ Redis çš„æ¨¡å—ï¼Œæˆ‘ä»¬åªè¦å¼•å…¥è¯¥æ¨¡å—å°±èƒ½ç›´æ¥ä½¿ç”¨ï¼š</p>\n<ul>\n<li>å°è£…å‡½æ•°ï¼Œä» Redis è¯»æ•°æ®å¹¶è¿”å›ï¼š</li>\n</ul>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢ redis çš„æ–¹æ³• ip å’Œ port æ˜¯ redis åœ°å€ï¼Œkey æ˜¯æŸ¥è¯¢çš„ key</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">read_redis</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">-- è·å–ä¸€ä¸ªè¿æ¥</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">local</span> ok<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> red<span class=\"token punctuation\">:</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> ok <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"è¿æ¥rediså¤±è´¥ : \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">nil</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">-- æŸ¥è¯¢ redis</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">local</span> resp<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> red<span class=\"token punctuation\">:</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">-- æŸ¥è¯¢å¤±è´¥å¤„ç†</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> resp <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"æŸ¥è¯¢Rediså¤±è´¥: \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">,</span> <span class=\"token string\">\", key = \"</span> <span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\">-- å¾—åˆ°çš„æ•°æ®ä¸ºç©ºå¤„ç†</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">if</span> resp <span class=\"token operator\">==</span> ngx<span class=\"token punctuation\">.</span>null <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        resp <span class=\"token operator\">=</span> <span class=\"token keyword\">nil</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"æŸ¥è¯¢Redisæ•°æ®ä¸ºç©º, key = \"</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token function\">close_redis</span><span class=\"token punctuation\">(</span>red<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">return</span> resp</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>å®Œæ•´çš„ä»£ç ç¼–å†™ï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å¼•å…¥ redis æ¨¡å—</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> redis <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resty.redis'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">-- åˆå§‹åŒ– redis å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">local</span> red <span class=\"token operator\">=</span> redis<span class=\"token punctuation\">:</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">-- è®¾ç½® redis è¶…æ—¶æ—¶é—´</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>red<span class=\"token punctuation\">:</span><span class=\"token function\">set_timeouts</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">-- å…³é—­ redis è¿æ¥çš„å·¥å…·æ–¹æ³•ï¼Œå…¶å®æ˜¯æ”¾å…¥è¿æ¥æ± </span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">close_redis</span><span class=\"token punctuation\">(</span>red<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">local</span> pool_max_idle_time <span class=\"token operator\">=</span> <span class=\"token number\">10000</span> <span class=\"token comment\">-- è¿æ¥çš„ç©ºé—²æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">local</span> pool_size <span class=\"token operator\">=</span> <span class=\"token number\">100</span> <span class=\"token comment\">-- è¿æ¥æ± å¤§å°</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">local</span> ok<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> red<span class=\"token punctuation\">:</span><span class=\"token function\">set_keepalive</span><span class=\"token punctuation\">(</span>pool_max_idle_time<span class=\"token punctuation\">,</span> pool_size<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> ok <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"æ”¾å…¥redisè¿æ¥æ± å¤±è´¥: \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢ redis çš„æ–¹æ³• ip å’Œ port æ˜¯ redis åœ°å€ï¼Œkey æ˜¯æŸ¥è¯¢çš„ key</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">read_redis</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">-- è·å–ä¸€ä¸ªè¿æ¥</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">local</span> ok<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> red<span class=\"token punctuation\">:</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> ok <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"è¿æ¥rediså¤±è´¥ : \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">nil</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token comment\">-- æŸ¥è¯¢ redis</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">local</span> resp<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> red<span class=\"token punctuation\">:</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token comment\">-- æŸ¥è¯¢å¤±è´¥å¤„ç†</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> resp <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"æŸ¥è¯¢Rediså¤±è´¥: \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">,</span> <span class=\"token string\">\", key = \"</span> <span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token comment\">-- å¾—åˆ°çš„æ•°æ®ä¸ºç©ºå¤„ç†</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">if</span> resp <span class=\"token operator\">==</span> ngx<span class=\"token punctuation\">.</span>null <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        resp <span class=\"token operator\">=</span> <span class=\"token keyword\">nil</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"æŸ¥è¯¢Redisæ•°æ®ä¸ºç©º, key = \"</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token function\">close_redis</span><span class=\"token punctuation\">(</span>red<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token keyword\">return</span> resp</pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">-- å°è£…å‡½æ•°ï¼Œå‘é€ http è¯·æ±‚ï¼Œå¹¶è§£æå“åº”</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">read_http</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token keyword\">local</span> resp <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span><span class=\"token function\">capture</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        method <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>HTTP_GET<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        args <span class=\"token operator\">=</span> params<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> resp <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token comment\">-- è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œè¿”å› 404</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"http æŸ¥è¯¢å¤±è´¥äº†~, path: \"</span><span class=\"token punctuation\">,</span> path <span class=\"token punctuation\">,</span> <span class=\"token string\">\", args: \"</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">404</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token keyword\">return</span> resp<span class=\"token punctuation\">.</span>body</pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token comment\">-- å°†æ–¹æ³•å¯¼å‡º</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token keyword\">local</span> _M <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    read_http <span class=\"token operator\">=</span> read_http<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    read_redis <span class=\"token operator\">=</span> read_redis</pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token punctuation\">&#125;</span>  </pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token keyword\">return</span> _M</pre></td></tr></table></figure><p>åœ¨ item.lua æ–‡ä»¶ä¸­è¿›è¡Œå¯¼å…¥ redis å·¥å…·å‡½æ•°</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">local</span> read_redis <span class=\"token operator\">=</span> common<span class=\"token punctuation\">.</span>read_redis</pre></td></tr></table></figure><p>ç”±äºæ·»åŠ äº† redis ç¼“å­˜é‚£ä¹ˆä¹‹å‰çš„æŸ¥è¯¢å•†å“ä¿¡æ¯å’Œåº“å­˜çš„å‡½æ•°å°±éœ€è¦ä¿®æ”¹äº†ã€‚</p>\n<p>ä½†æ˜¯éœ€è¦ä¿®æ”¹ä¸¤ä¸ªå¤ªéº»çƒ¦äº†æ‰€ä»¥å¯¹å…¶è¿›è¡Œå°è£…å‡½æ•°ï¼š</p>\n<p>éœ€æ±‚ï¼š</p>\n<p>1ã€ä¿®æ”¹ item.luaï¼Œå°è£…ä¸€ä¸ªå‡½æ•° read_dataï¼Œå®ç°å…ˆæŸ¥è¯¢ redisï¼Œå¦‚æœæœªå‘½ä¸­ï¼Œå†æŸ¥è¯¢ tomcat</p>\n<p>2ã€ä¿®æ”¹ item.luaï¼ŒæŸ¥è¯¢å•†å“å’Œåº“å­˜æ—¶éƒ½è°ƒç”¨ read_data è¿™ä¸ªå‡½æ•°</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å°è£…æŸ¥è¯¢å‡½æ•°ï¼Œå…ˆæŸ¥è¯¢ redisï¼Œå¦‚æœæœªå‘½ä¸­å†æŸ¥è¯¢ tomcat</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">read_data</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token comment\">-- æŸ¥è¯¢ redis</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">local</span> resp <span class=\"token operator\">=</span> <span class=\"token function\">read_redis</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.249.128\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6379</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token comment\">-- åˆ¤æ–­ redis æ˜¯å¦å‘½ä¸­</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> resp <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">-- redis æŸ¥è¯¢å¤±è´¥ï¼Œå†æŸ¥è¯¢ tomcat</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    resp <span class=\"token operator\">=</span> <span class=\"token function\">read_http</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token keyword\">return</span> resp</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>ç¼–å†™å®Œå°è£…å‡½æ•°åå°†åŸæ¥çš„è¯·æ±‚å‡½æ•°è¿›è¡Œæ›¿æ¢</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢å•†å“ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> itemJSON <span class=\"token operator\">=</span> <span class=\"token function\">read_data</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item:id:\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/item/\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢åº“å­˜ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">local</span> stockJSON <span class=\"token operator\">=</span> <span class=\"token function\">read_data</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item:stock:id:\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/item/stock/\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>item.lua æ–‡ä»¶çš„å®Œæ•´ä»£ç ï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å¯¼å…¥ common å‡½æ•°åº“</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> common <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'common'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">local</span> read_http <span class=\"token operator\">=</span> common<span class=\"token punctuation\">.</span>read_http</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">local</span> read_redis <span class=\"token operator\">=</span> common<span class=\"token punctuation\">.</span>read_redis</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">-- å¯¼å…¥ cjson åº“</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">local</span> cjson <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cjson'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">-- å°è£…æŸ¥è¯¢å‡½æ•°ï¼Œå…ˆæŸ¥è¯¢ redisï¼Œå¦‚æœæœªå‘½ä¸­å†æŸ¥è¯¢ tomcat</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">read_data</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token comment\">-- æŸ¥è¯¢ redis</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token keyword\">local</span> resp <span class=\"token operator\">=</span> <span class=\"token function\">read_redis</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.249.128\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6379</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token comment\">-- åˆ¤æ–­ redis æ˜¯å¦å‘½ä¸­</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> resp <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\">-- redis æŸ¥è¯¢å¤±è´¥ï¼Œå†æŸ¥è¯¢ tomcat</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"redisæŸ¥è¯¢å¤±è´¥,å°è¯•æŸ¥è¯¢http, key :\"</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    resp <span class=\"token operator\">=</span> <span class=\"token function\">read_http</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token keyword\">return</span> resp</pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">-- è·å–è·¯å¾„å‚æ•°</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">local</span> id <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>var<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢å•†å“ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">local</span> itemJSON <span class=\"token operator\">=</span> <span class=\"token function\">read_data</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item:id:\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/item/\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢åº“å­˜ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">local</span> stockJSON <span class=\"token operator\">=</span> <span class=\"token function\">read_data</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item:stock:id:\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/item/stock/\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">-- JSON è½¬åŒ–ä¸º lua çš„ table</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token keyword\">local</span> item <span class=\"token operator\">=</span> cjson<span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>itemJSON<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token keyword\">local</span> sto <span class=\"token operator\">=</span> cjson<span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>stockJSON<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\">-- ç»„åˆæ•°æ®</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>item<span class=\"token punctuation\">.</span>stock <span class=\"token operator\">=</span> sto<span class=\"token punctuation\">.</span>stock</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>item<span class=\"token punctuation\">.</span>sold <span class=\"token operator\">=</span> sto<span class=\"token punctuation\">.</span>sold</pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">-- æŠŠ item åºåˆ—åŒ–ä¸º json è¿”å›ç»“æœ</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span>cjson<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>é‡å¯è™šæ‹Ÿæœºä¸­çš„ nginx</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\"># nginx -s reload</span></pre></td></tr></table></figure><p>è®¿é—® uri è¿›è¡Œæµ‹è¯•ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDI=\">http://localhost/item.html?id=10002</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201603830.png\" alt=\"image-20231020160328617\" /></p>\n<p>æŸ¥çœ‹ idea æ§åˆ¶å°</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201603637.png\" alt=\"image-20231020160349587\" /></p>\n<p>å°†æ§åˆ¶å°ä¿¡æ¯æ¸…ç©ºåå†æ¬¡è®¿é—® uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDI=\">http://localhost/item.html?id=10002</span></p>\n<p>æ§åˆ¶å°æƒ…å†µ</p>\n<p>è¯´æ˜æ•°æ®å·²ç»è¢«ç¼“å­˜äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201604800.png\" alt=\"image-20231020160432732\" /></p>\n<p>æˆ‘ä»¬æŠŠä¸¤ä¸ªæœåŠ¡å™¨å…¨å…³äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201605790.png\" alt=\"image-20231020160510420\" /></p>\n<p>å†è®¿é—®ä¸€ä¸‹ uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDI=\">http://localhost/item.html?id=10002</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201634990.png\" alt=\"image-20231020163445555\" /></p>\n<p>å¯ä»¥çœ‹åˆ°å¦‚æœæ²¡æœ‰å¯åŠ¨ Tomcat ä¹Ÿæ²¡äº‹å„¿å› ä¸ºå…ˆå»çœ‹äº†ä¸‹ Redis å‘ç°æœ‰ç›¸å…³æ•°æ®ç›´æ¥æ‹¿æ¥å°±ä¸æ‰¾æœåŠ¡å™¨äº†ã€‚</p>\n<h2 id=\"66-nginxæœ¬åœ°ç¼“å­˜\"><a class=\"anchor\" href=\"#66-nginxæœ¬åœ°ç¼“å­˜\">#</a> 6.6ã€Nginx æœ¬åœ°ç¼“å­˜ğŸŒ³</h2>\n<p>OPenResty ä¸º Nginx æä¾›äº† shard dict çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ Nginx çš„å¤šä¸ª worker ä¹‹é—´å…±äº«æ•°æ®ï¼Œå®ç°ç¼“å­˜åŠŸèƒ½ã€‚</p>\n<p>1ã€å¼€å¯å…±äº«å­—å…¸ï¼Œåœ¨ nginx.conf çš„ http ä¸‹æ·»åŠ é…ç½®</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># å…±äº«å­—å…¸ï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œåç§°å«åšï¼šitem_cacheï¼Œå¤§å° 150m</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">lua_shared_dict</span> item_cache <span class=\"token number\">150m</span></span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>2ã€æ“ä½œå…±äº«å­—å…¸</p>\n<p>åœ¨ item.lua æ–‡ä»¶ä¸­å¯¼å…¥</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å¯¼å…¥å…±äº«è¯å…¸ï¼Œæœ¬åœ°ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> item_cache <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>shared<span class=\"token punctuation\">.</span>item_cache</pre></td></tr></table></figure><h3 id=\"661-æ¡ˆä¾‹åœ¨æŸ¥è¯¢å•†å“æ—¶ä¼˜å…ˆæŸ¥è¯¢openrestyçš„æœ¬åœ°ç¼“å­˜\"><a class=\"anchor\" href=\"#661-æ¡ˆä¾‹åœ¨æŸ¥è¯¢å•†å“æ—¶ä¼˜å…ˆæŸ¥è¯¢openrestyçš„æœ¬åœ°ç¼“å­˜\">#</a> 6.6.1ã€æ¡ˆä¾‹ï¼Œåœ¨æŸ¥è¯¢å•†å“æ—¶ï¼Œä¼˜å…ˆæŸ¥è¯¢ OPenResty çš„æœ¬åœ°ç¼“å­˜ğŸŒ²</h3>\n<p>éœ€æ±‚ï¼š</p>\n<p>1ã€ä¿®æ”¹ item.lua ä¸­çš„ read_data å‡½æ•°ï¼Œä¼˜å…ˆæŸ¥è¯¢æœ¬åœ°ç¼“å­˜ï¼Œæœªå‘½ä¸­æ—¶åœ¨æŸ¥è¯¢ Redisï¼ŒTomcat</p>\n<p>2ã€æŸ¥è¯¢ Redis æˆ– Tomcat æˆåŠŸåï¼Œå°†æ•°æ®å†™å…¥æœ¬åœ°ç¼“å­˜ï¼Œå¹¶è®¾ç½®æœ‰æ•ˆæœŸ</p>\n<p>3ã€å•†å“åŸºæœ¬ä¿¡æ¯ï¼Œæœ‰æ•ˆæœŸ 30 åˆ†é’Ÿ</p>\n<p>4ã€åº“å­˜ä¿¡æ¯ï¼Œæœ‰æ•ˆæœŸ 1 åˆ†é’Ÿ</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å°è£…æŸ¥è¯¢å‡½æ•°ï¼Œå…ˆæŸ¥è¯¢ redisï¼Œå¦‚æœæœªå‘½ä¸­å†æŸ¥è¯¢ tomcat</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">read_data</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> expire<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token comment\">-- æŸ¥è¯¢æœ¬åœ°ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">local</span> val <span class=\"token operator\">=</span> item_cache<span class=\"token punctuation\">:</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> val <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">-- æŸ¥è¯¢ redis</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    val <span class=\"token operator\">=</span> <span class=\"token function\">read_redis</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.249.128\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6379</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">-- åˆ¤æ–­æŸ¥è¯¢ç»“æœ</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> val <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">-- redis æŸ¥è¯¢å¤±è´¥ï¼ŒæŸ¥è¯¢ tomcat</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        val <span class=\"token operator\">=</span> <span class=\"token function\">read_http</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token comment\">-- æŸ¥è¯¢æˆåŠŸï¼ŒæŠŠæ•°æ®å†™å…¥æœ¬åœ°ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  item_cache<span class=\"token punctuation\">:</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> val<span class=\"token punctuation\">,</span> expire<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token comment\">-- è¿”å›æ•°æ®</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token keyword\">return</span> val</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>æµ‹è¯•</p>\n<p>åˆ‡æ¢åˆ° nginx ç›®å½•ä¸‹æ¥ç›‘æ§ error.log æ–‡ä»¶çš„æ‰“å°æƒ…å†µ</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\"># nginx -s reload</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\"># pwd</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>/usr/local/openresty/nginx</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\"># tail -f logs/error.log</span></pre></td></tr></table></figure><h1 id=\"ä¸ƒ-ç¼“å­˜åŒæ­¥\"><a class=\"anchor\" href=\"#ä¸ƒ-ç¼“å­˜åŒæ­¥\">#</a> ä¸ƒã€ç¼“å­˜åŒæ­¥ğŸ„</h1>\n<ul>\n<li>æ•°æ®åŒæ­¥ç­–ç•¥</li>\n<li>å®‰è£… Canal</li>\n<li>ç›‘å¬ Canal</li>\n</ul>\n<h2 id=\"71-æ•°æ®åŒæ­¥ç­–ç•¥\"><a class=\"anchor\" href=\"#71-æ•°æ®åŒæ­¥ç­–ç•¥\">#</a> 7.1ã€æ•°æ®åŒæ­¥ç­–ç•¥ğŸŒ³</h2>\n<p>ç¼“å­˜æ•°æ®åŒæ­¥çš„å¸¸è§æ–¹å¼æœ‰ä¸‰ç§ï¼š</p>\n<p><mark>1ã€è®¾ç½®æœ‰æ•ˆæœŸ</mark>ï¼šç»™ç¼“å­˜è®¾ç½®æœ‰æ•ˆæœŸï¼Œåˆ°æœŸåè‡ªåŠ¨åˆ é™¤ã€‚å†æ¬¡æŸ¥è¯¢æ—¶æ›´æ–°</p>\n<p>1.1ã€ä¼˜åŠ¿ï¼šç®€å•ï¼Œæ–¹ä¾¿</p>\n<p>1.2ã€ç¼ºç‚¹ï¼šæ—¶æ•ˆæ€§å·®ï¼Œç¼“å­˜è¿‡æœŸä¹‹å‰å¯èƒ½ä¸ä¸€è‡´</p>\n<p>1.3ã€åœºæ™¯ï¼šæ›´æ–°é¢‘ç‡è¾ƒä½ï¼Œæ—¶æ•ˆæ€§è¦æ±‚ä½çš„ä¸šåŠ¡</p>\n<p><mark>2ã€åŒæ­¥åŒå†™</mark>ï¼šåœ¨ä¿®æ”¹æ•°æ®åº“çš„åŒæ—¶ï¼Œç›´æ¥ä¿®æ”¹ç¼“å­˜</p>\n<p>2.1ã€ä¼˜åŠ¿ï¼šæ—¶æ•ˆæ€§å¼ºï¼Œç¼“å­˜ä¸æ•°æ®åº“å¼ºä¸€è‡´</p>\n<p>2.2ã€ç¼ºç‚¹ï¼šæœ‰ä»£ç ä¾µå…¥ï¼Œè€¦åˆåº¦é«˜</p>\n<p>2.3ã€åœºæ™¯ï¼šå¯¹ä¸€è‡´æ€§ï¼Œæ—¶æ•ˆæ€§è¦æ±‚è¾ƒé«˜çš„ç¼“å­˜æ•°æ®</p>\n<p><mark>3ã€å¼‚æ­¥é€šçŸ¥</mark>ï¼šä¿®æ”¹æ•°æ®åº“æ—¶å‘é€äº‹ä»¶é€šçŸ¥ï¼Œç›¸å…³æœåŠ¡ç›‘å¬åˆ°é€šçŸ¥åä¿®æ”¹ç¼“å­˜æ•°æ®</p>\n<p>3.1ã€ä¼˜åŠ¿ï¼šä½è€¦åˆï¼Œå¯ä»¥åŒæ—¶é€šçŸ¥å¤šä¸ªç¼“å­˜æœåŠ¡</p>\n<p>3.2ã€ç¼ºç‚¹ï¼šæ—¶æ•ˆæ€§ä¸€èˆ¬ï¼Œå¯èƒ½å­˜åœ¨ç»ˆæçˆ±ä½ ä¸ä¸€è‡´çŠ¶æ€</p>\n<p>3.3ã€åœºæ™¯ï¼šæ—¶æ•ˆæ€§è¦æ±‚ä¸€èˆ¬ï¼Œæœ‰å¤šä¸ªæœåŠ¡éœ€è¦åŒæ­¥</p>\n<h3 id=\"711-ç¼“å­˜åŒæ­¥ç­–ç•¥\"><a class=\"anchor\" href=\"#711-ç¼“å­˜åŒæ­¥ç­–ç•¥\">#</a> 7.1.1ã€ç¼“å­˜åŒæ­¥ç­–ç•¥ğŸŒ²</h3>\n<p>å¼‚æ­¥é€šçŸ¥å¯ä»¥ä½¿ç”¨åŸºäº MQ çš„å¼‚æ­¥é€šçŸ¥</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310210915149.png\" alt=\"image-20231021091552370\" /></p>\n<p>ä½†æ˜¯åŸºäº MQ è¿˜æ˜¯è¦ä¿®æ”¹é‡Œé¢çš„ä»£ç å‘é€æ¶ˆæ¯ï¼Œè€Œä¸‹é¢è¦è®²çš„æ˜¯åŸºäº Canal çš„å¼‚æ­¥é€šçŸ¥</p>\n<p>åŸºäº Canal çš„å¼‚æ­¥é€šçŸ¥</p>\n<p>canal å¯ä»¥å»ç›‘å¬æ•°æ®åº“çš„å˜åŒ–</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310210917386.png\" alt=\"image-20231021091750935\" /></p>\n<h3 id=\"712-åˆå§‹canal\"><a class=\"anchor\" href=\"#712-åˆå§‹canal\">#</a> 7.1.2ã€åˆå§‹ CanalğŸŒ²</h3>\n<p>Canal æ„è¯‘ä¸º æ°´é“ / ç®¡é“ / æ²Ÿæ¸ ï¼ŒCanal æ˜¯é˜¿é‡Œå·´å·´æ——ä¸‹çš„ä¸€æ¬¾å¼€æºé¡¹ç›®ï¼ŒåŸºäº Java å¼€å‘ã€‚åŸºäºæ•°æ®åº“å¢é‡æ—¥å¿—è§£æï¼Œæä¾›å¢é‡æ•°æ®è®¢é˜… &amp; æ¶ˆè´¹ã€‚GiHub åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvY2FuYWw=\">https://github.com/alibaba/canal</span></p>\n<p>Canal æ˜¯åŸºäº mysql çš„ä¸»ä»åŒæ­¥æ¥å®ç°çš„ï¼ŒMySQL ä¸»ä»åŒæ­¥çš„åŸç†å¦‚ä¸‹ï¼š</p>\n<p>master å°±æ˜¯ mysql çš„ä¸»èŠ‚ç‚¹ï¼Œslave å°±æ˜¯ mysql çš„ä»èŠ‚ç‚¹ã€‚ä¸»ä»æ•°æ®æ˜¯è¦åšåŒæ­¥çš„ï¼Œé‚£å®ƒæ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿé¦–å…ˆ mysql çš„ä¸»èŠ‚ç‚¹åœ¨åšå¢åˆ æ”¹æŸ¥æ—¶å°±å›å»è®°å½•æ—¥å¿—åˆ° binary.log æ–‡ä»¶ä¸­è¿™ä¸ªæ–‡ä»¶ç§°ä¸ºäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ã€‚å…¶ä¸­è®°å½•çš„å°±æ˜¯ binary log eventsï¼Œé‡Œé¢è®°å½•çš„å°±æ˜¯ä¸šåŠ¡ sqlã€‚slave ä¼šå¼€å¯ä¸€ä¸ªçº¿ç¨‹ä¸æ–­çš„æ¥è¯»å–è¿™ä¸ªæ—¥å¿—æ–‡ä»¶æŠŠè¿™ä¸ªæ–‡ä»¶è¯»è¿‡æ¥æ”¾åˆ°ä¸€ä¸ª relay log æ–‡ä»¶ä¸­ã€‚è¿™æ ·ä¸»èŠ‚ç‚¹åšäº†å“ªäº› sql ä»èŠ‚ç‚¹ ä¹Ÿåšå“ªäº› sql</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310210922728.png\" alt=\"image-20231021092228657\" /></p>\n<p>è€Œ Canal å°±æ˜¯æŠŠè‡ªå·±ä¼ªè£…æˆ MySQL çš„ä¸€ä¸ª Slave èŠ‚ç‚¹ï¼Œä»è€Œç›‘å¬ master çš„ binary log å˜åŒ–ã€‚å†æŠŠå¾—åˆ°çš„å˜åŒ–ä¿¡æ¯é€šçŸ¥ç»™ Canal çš„å®¢æˆ·ç«¯ï¼Œè¿›è€Œå®Œæˆå¯¹å…¶å®ƒæ•°æ®åº“çš„åŒæ­¥ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310210929872.png\" alt=\"image-20231021092859461\" /></p>\n<h3 id=\"713-canalå®‰è£…\"><a class=\"anchor\" href=\"#713-canalå®‰è£…\">#</a> 7.1.3ã€Canal å®‰è£…ğŸŒ²</h3>\n<p>æŸ¥çœ‹æ–‡ç« ï¼š<a href=\"./Canal/%E5%AE%89%E8%A3%85Canal.md\">å®‰è£… Canal</a>.</p>\n<h3 id=\"714-canalå®¢æˆ·ç«¯\"><a class=\"anchor\" href=\"#714-canalå®¢æˆ·ç«¯\">#</a> 7.1.4ã€Canal å®¢æˆ·ç«¯ğŸŒ²</h3>\n<p>Canal æä¾›äº†å„ç§è¯­è¨€çš„å®¢æˆ·ç«¯ï¼Œå½“ Canal ç›‘å¬åˆ° binlog å˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥ Canal çš„å®¢æˆ·ç«¯ã€‚ä¸è¿‡è¿™é‡Œæˆ‘ä»¬ä¼šä½¿ç”¨ Github ä¸Šçš„ç¬¬ä¸‰æ–¹å¼€æºçš„ canal-staterã€‚åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL05vcm1hbkd5bGxlbmhhYWwvY2FuYWwtY2xpZW50\">https://github.com/NormanGyllenhaal/canal-client</span></p>\n<p>å¼•å…¥ä¾èµ–ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>top.javatool<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>canal-spring-boot-starter<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.2.1-RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>ç¼–å†™é…ç½®ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">canal</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">destination</span><span class=\"token punctuation\">:</span> dkx1 <span class=\"token comment\"># canal å®ä¾‹åç§°ï¼Œè¦è·Ÿ canal-server è¿è¡Œæ—¶è®¾ç½®çš„ destiation ä¸€è‡´</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span> 192.168.249.128<span class=\"token punctuation\">:</span><span class=\"token number\">11111</span> <span class=\"token comment\"># canal åœ°å€</span></pre></td></tr></table></figure><p>ç¼–å†™ç›‘å¬å™¨ï¼Œç›‘å¬ Canal æ¶ˆæ¯ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// æŒ‡å®šè¦ç›‘å¬çš„è¡¨</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@CanalTable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tb_item\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span>                                    <span class=\"token comment\">// æŒ‡å®šè¡¨å…³è”çš„å®ä½“ç±»</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">EntryHandler</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Item</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token comment\">// ä¸‹é¢ä¸‰ä¸ªé‡å†™æ–¹æ³•æ˜¯ï¼Œç›‘å¬åˆ°æ•°æ®åº“çš„å¢åˆ æ”¹çš„æ¶ˆæ¯çš„</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">insert</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Item</span> item<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° redis</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° jvm è¿›ç¨‹ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">EntryHandler</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Item</span> before<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Item</span> after<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° redis</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° jvm è¿›ç¨‹ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">EntryHandler</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>before<span class=\"token punctuation\">,</span> after<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Item</span> item<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° redis</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° jvm è¿›ç¨‹ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">EntryHandler</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Canal æ¨é€ç»™ canal-client çš„æ˜¯è¢«ä¿®æ”¹çš„è¿™ä¸€è¡Œæ•°æ® (row) ï¼Œè€Œæˆ‘ä»¬å¼•å…¥çš„ canal-client åˆ™ä¼šå¸®æˆ‘ä»¬æŠŠè¡Œæ•°æ®å°è£…åˆ° item å®ä½“ç±»ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦çŸ¥é“æ•°æ®åº“ä¸å®ä½“çš„æ˜ å°„å…³ç³»ï¼Œè¦ç”¨åˆ° JPA çš„å‡ ä¸ªæ³¨è§£ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@TableName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tb_item\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Item</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@TableId</span><span class=\"token punctuation\">(</span>type <span class=\"token operator\">=</span> <span class=\"token class-name\">IdType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">AUTO</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// æ ‡è®°è¡¨ä¸­çš„ id å­—æ®µ</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Id</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span><span class=\"token comment\">// å•†å“ id</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> å…¶å®ƒå­—æ®µ çœç•¥</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Date</span> updateTime<span class=\"token punctuation\">;</span><span class=\"token comment\">// æ›´æ–°æ—¶é—´</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// @Transient æ ‡è®°ä¸å±äºè¡¨ä¸­çš„å­—æ®µ  å¿½ç•¥</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token annotation punctuation\">@TableField</span><span class=\"token punctuation\">(</span>exist <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@Transient</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> stock<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token annotation punctuation\">@TableField</span><span class=\"token punctuation\">(</span>exist <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token annotation punctuation\">@Transient</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> sold<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™ redis çš„ç¼“å­˜ç±» ï¼Œæ·»åŠ ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªæ–°å¢æˆ–æ›´æ–°ï¼Œä¸€ä¸ªæ˜¯åˆ é™¤</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">saveItem</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Item</span> item<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token class-name\">String</span> json <span class=\"token operator\">=</span> <span class=\"token constant\">MAPPER</span><span class=\"token punctuation\">.</span><span class=\"token function\">writeValueAsString</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item:id:\"</span> <span class=\"token operator\">+</span> item<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> json<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">JsonProcessingException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">deleteItemById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item:id:\"</span> <span class=\"token operator\">+</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®šä¹‰å®Œ redis çš„ç¼“å­˜ç±»é‡Œé¢çš„å‡½æ•°åå†å›åˆ°ç¼–å†™ç›‘å¬å™¨çš„ç±»é‡Œé¢ç¼–å†™ä»£ç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@CanalTable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tb_item\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">EntryHandler</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Item</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RedisHandler</span> redisHandler<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Cache</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">></span></span> cache<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">insert</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Item</span> item<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° jvm è¿›ç¨‹ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° redis</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        redisHandler<span class=\"token punctuation\">.</span><span class=\"token function\">saveItem</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Item</span> before<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Item</span> after<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° jvm è¿›ç¨‹ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>after<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> after<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° redis</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        redisHandler<span class=\"token punctuation\">.</span><span class=\"token function\">saveItem</span><span class=\"token punctuation\">(</span>after<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">EntryHandler</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>before<span class=\"token punctuation\">,</span> after<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Item</span> item<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° jvm è¿›ç¨‹ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        cache<span class=\"token punctuation\">.</span><span class=\"token function\">invalidate</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° redis</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        redisHandler<span class=\"token punctuation\">.</span><span class=\"token function\">deleteItemById</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token class-name\">EntryHandler</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡æŸ¥çœ‹ idea æ‰“å°ä¿¡æ¯ï¼š</p>\n<pre><code>meters: 10005(Long)\n14:50:32:387 DEBUG 4956 --- [nio-8081-exec-7] c.h.i.mapper.ItemStockMapper.selectById  : &lt;==      Total: 1\n14:50:32:472  INFO 4956 --- [l-client-thread] t.j.c.client.client.AbstractCanalClient  : è·å–æ¶ˆæ¯ Message[id=-1,entries=[],raw=false,rawEntries=[]]\n14:50:34:474  INFO 4956 --- [l-client-thread] t.j.c.client.client.AbstractCanalClient  : è·å–æ¶ˆæ¯ Message[id=-1,entries=[],raw=false,rawEntries=[]]\n14:50:36:477  INFO 4956 --- [l-client-thread] t.j.c.client.client.AbstractCanalClient  : è·å–æ¶ˆæ¯ Message[id=-1,entries=[],raw=false,rawEntries=[]]\n14:50:38:478  INFO 4956 --- [l-client-thread] t.j.c.client.client.AbstractCanalClient  : è·å–æ¶ˆæ¯ Message[id=-1,entries=[],raw=false,rawEntries=[]]\n14:50:40:472  INFO 4956 --- [l-client-thread] t.j.c.client.client.AbstractCanalClient  : è·å–æ¶ˆæ¯ Message[id=-1,entries=[],raw=false,rawEntries=[]]\n</code></pre>\n<p>è¡¨ç¤º canal ä¸ java æˆåŠŸçš„è¿æ¥åˆ°äº†</p>\n<p>é‚£ä¹ˆæµ‹è¯•ä¸€ä¸‹æ•°æ®åŒæ­¥æ‰“å¼€ 8081 ç«¯å£çš„é¡µé¢</p>\n<p>æ¯”å¦‚è¯´ä¿®æ”¹ 10001 è¿™ä¸ªå•†å“çš„æ•°æ®ï¼š</p>\n<p>åŸæ¥çš„æ•°æ®å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211452116.png\" alt=\"image-20231021145237319\" /></p>\n<p>ä¿®æ”¹åçš„æ•°æ®å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211453292.png\" alt=\"image-20231021145302067\" /></p>\n<p>ç‚¹å‡»ç¡®å®š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211453164.png\" alt=\"image-20231021145357351\" /></p>\n<p>å†æŸ¥çœ‹ idea çš„æ§åˆ¶å°ä¿¡æ¯ï¼š</p>\n<p>å¯ä»¥çœ‹åˆ°æ‰“å°äº†ä¸€å †æ—¥å¿—ä¿¡æ¯</p>\n<pre><code>  version: 1\n  logfileName: &quot;mysql-bin.000006&quot;\n  logfileOffset: 1173\n  serverId: 1000\n  serverenCode: &quot;UTF-8&quot;\n  executeTime: 1697871191000\n  sourceType: MYSQL\n  schemaName: &quot;&quot;\n  tableName: &quot;&quot;\n  eventLength: 91\n&#125;\nentryType: TRANSACTIONBEGIN\nstoreValue: &quot; H&quot;\n, header &#123;\n  version: 1\n  logfileName: &quot;mysql-bin.000006&quot;\n  logfileOffset: 1344\n  serverId: 1000\n  serverenCode: &quot;UTF-8&quot;\n  executeTime: 1697871191000\n  sourceType: MYSQL\n  schemaName: &quot;dkx&quot;\n  tableName: &quot;tb_item&quot;\n  eventLength: 620\n  eventType: UPDATE\n  props &#123;\n    key: &quot;rowsCount&quot;\n    value: &quot;1&quot;\n  &#125;\n&#125;\nentryType: ROWDATA\nstoreValue: &quot;\\b_\\020\\002P\\000b\\324\\n\\n&amp;\\b\\000\\020\\373\\377\\377\\377\\377\\377\\377\\377\\377\\001\\032\\002id \\001(\\0000\\000B\\00510001R\\006bigint\\nd\\b\\001\\020\\f\\032\\005title \\000(\\0000\\000BCRIMOWA 21\\345\\257\\270\\346\\211\\230\\350\\277\\220\\347\\256\\261\\346\\213\\211\\346\\235\\206\\347\\256\\261 SALSA AIR\\347\\263\\273\\345\\210\\227\\346\\236\\234\\347\\273\\277\\350\\211\\262 820.70.36.4R\\fvarchar(264)\\n)\\b\\002\\020\\f\\032\\004name \\000(\\0000\\000B\\tSALSA AIRR\\fvarchar(128)\\n)\\b\\003\\020\\373\\377\\377\\377\\377\\377\\377\\377\\377\\001\\032\\005price \\000(\\0000\\000B\\00516900R\\006bigint\\n\\226\\001\\b\\004\\020\\f\\032\\005image \\000(\\0000\\000Buhttps://m.360buyimg.com/mobilecms/s720x720_jfs/t6934/364/1195375010/84676/e9f2c55f/597ece38N0ddcbc77.jpg!q70.jpg.webpR\\fvarchar(200)\\n-\\b\\005\\020\\f\\032\\bcategory \\000(\\0000\\000B\\t\\346\\213\\211\\346\\235\\206\\347\\256\\261R\\fvarchar(200)\\n\\'\\b\\006\\020\\f\\032\\005brand \\000(\\0000\\000B\\006RIMOWAR\\fvarchar(100)\\nG\\b\\a\\020\\f\\032\\004spec \\000(\\0000\\000B\\'&#123;\\&quot;\\351\\242\\234\\350\\211\\262\\&quot;: \\&quot;\\347\\272\\242\\350\\211\\262\\&quot;, \\&quot;\\345\\260\\272\\347\\240\\201\\&quot;: \\&quot;26\\345\\257\\270\\&quot;&#125;R\\fvarchar(200)\\n\\032\\b\\b\\020\\004\\032\\006status \\000(\\0000\\000B\\0011R\\003int\\n6\\b\\t\\020]\\032\\vcreate_time \\000(\\0000\\000B\\0232019-05-01 00:00:00R\\bdatetime\\n6\\b\\n\\020]\\032\\vupdate_time \\000(\\0000\\000B\\0232019-05-01 00:00:00R\\bdatetime\\022&amp;\\b\\000\\020\\373\\377\\377\\377\\377\\377\\377\\377\\377\\001\\032\\002id \\001(\\0000\\000B\\00510001R\\006bigint\\022d\\b\\001\\020\\f\\032\\005title \\000(\\0000\\000BCRIMOWA 21\\345\\257\\270\\346\\211\\230\\350\\277\\220\\347\\256\\261\\346\\213\\211\\346\\235\\206\\347\\256\\261 SALSA AIR\\347\\263\\273\\345\\210\\227\\346\\236\\234\\347\\273\\277\\350\\211\\262 820.70.36.4R\\fvarchar(264)\\022)\\b\\002\\020\\f\\032\\004name \\000(\\0000\\000B\\tSALSA AIRR\\fvarchar(128)\\022)\\b\\003\\020\\373\\377\\377\\377\\377\\377\\377\\377\\377\\001\\032\\005price \\000(\\0010\\000B\\00528900R\\006bigint\\022\\226\\001\\b\\004\\020\\f\\032\\005image \\000(\\0000\\000Buhttps://m.360buyimg.com/mobilecms/s720x720_jfs/t6934/364/1195375010/84676/e9f2c55f/597ece38N0ddcbc77.jpg!q70.jpg.webpR\\fvarchar(200)\\022-\\b\\005\\020\\f\\032\\bcategory \\000(\\0000\\000B\\t\\346\\213\\211\\346\\235\\206\\347\\256\\261R\\fvarchar(200)\\022\\'\\b\\006\\020\\f\\032\\005brand \\000(\\0000\\000B\\006RIMOWAR\\fvarchar(100)\\022G\\b\\a\\020\\f\\032\\004spec \\000(\\0010\\000B\\'&#123;\\&quot;\\351\\242\\234\\350\\211\\262\\&quot;: \\&quot;\\347\\272\\242\\350\\211\\262\\&quot;, \\&quot;\\345\\260\\272\\347\\240\\201\\&quot;: \\&quot;33\\345\\257\\270\\&quot;&#125;R\\fvarchar(200)\\022\\032\\b\\b\\020\\004\\032\\006status \\000(\\0000\\000B\\0011R\\003int\\0226\\b\\t\\020]\\032\\vcreate_time \\000(\\0000\\000B\\0232019-05-01 00:00:00R\\bdatetime\\0226\\b\\n\\020]\\032\\vupdate_time \\000(\\0000\\000B\\0232019-05-01 00:00:00R\\bdatetime&quot;\n],raw=false,rawEntries=[]]\n</code></pre>\n<p>æˆ‘ä»¬å†å»è®¿é—®å•†å“æ•°æ®çš„å±•ç¤ºé¡µé¢æŸ¥çœ‹æ•°æ®æ˜¯å¦è¢«ä¿®æ”¹äº†</p>\n<p>è®¿é—® uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDEjaW5kZXg=\">http://localhost/item.html?id=10001#index</span></p>\n<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªé¡µé¢çš„æ•°æ®ä¹Ÿè¢«ä¿®æ”¹äº†è¯´æ˜ç¼“å­˜åŒæ­¥æˆåŠŸäº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211504526.png\" alt=\"image-20231021150447258\" /></p>\n<h1 id=\"å…«-æ€»ç»“å¤šçº§ç¼“å­˜æ¶æ„\"><a class=\"anchor\" href=\"#å…«-æ€»ç»“å¤šçº§ç¼“å­˜æ¶æ„\">#</a> å…«ã€æ€»ç»“å¤šçº§ç¼“å­˜æ¶æ„ğŸ„</h1>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211510207.png\" alt=\"image-20231021151019996\" /></p>\n<p>æœ‰ä¸€ä¸ªé¡µé¢å« item.html æ”¾åˆ°äº† windows çš„ nginx æœåŠ¡å™¨ä¸Šã€‚å®ƒçš„ ä¸»è¦ä½œç”¨å°±æ˜¯ä¸€ä¸ªé™æ€èµ„æºæœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨ã€‚å½“ç”¨æˆ·é€šè¿‡æµè§ˆå™¨æ¥è¯·æ±‚å®ƒæ—¶å®ƒå°±å¯ä»¥æŠŠé¡µé¢è¿”å›ç»™ç”¨æˆ·è€Œæµè§ˆå™¨åœ¨æ¸²æŸ“æ—¶å‘ç°ç¼ºå°‘æ•°æ®å°±ä¼šå‘é€ ajax è¯·æ±‚æ¥æŸ¥è¯¢æ•°æ®ã€‚æŸ¥è¯¢åœ°å€å°±æ˜¯ item/10001 è¿™æ—¶çš„ nginx åå‘ä»£ç†æœåŠ¡å™¨ä¸å›å»å¤„ç†ä¸šåŠ¡ï¼Œåªæ˜¯åšåå‘ä»£ç†ï¼Œæ‰€ä»¥å®ƒä¼šæŠŠè¯·æ±‚ä»£ç†ç»™ OPenResty é›†ç¾¤ï¼Œæƒ³è¦å»æŸ¥è¯¢æ•°æ®åˆæœ‰å…ˆå»æœ¬åœ°å¦‚æœæœ‰åˆ™ç›´æ¥è¿”å›ï¼Œæœ¬åœ°å…±äº«è¯å…¸æ•°æ®åªèƒ½åœ¨å½“å‰ nginx ä¸­ä½¿ç”¨ã€‚å¦‚æœæˆ‘ä»¬éƒ¨ç½²æˆ OPenResty é›†ç¾¤å®ƒä»¬ä¹‹é—´çš„å†…å­˜æ˜¯ä¸å…±äº«çš„ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿå¯ä»¥é‡‡ç”¨é€šè¿‡ id è®¡ç®— hash æ¥è·¯ç”±æŒ‡å®šé›†ç¾¤æœåŠ¡å™¨çš„æ–¹å¼è¿™æ ·å°±ä¼šä¿è¯ OPenResty ç¼“å­˜ä¸€ç›´ç”Ÿæ•ˆã€‚æœ¬åœ°ç¼“å­˜å¦‚æœæœªå‘½ä¸­åˆ™å»æŸ¥è¯¢ redis ç¼“å­˜ï¼Œå‘½ä¸­åˆ™è¿”å›ï¼Œæœªå‘½ä¸­åˆ™æŸ¥è¯¢ tomcatã€‚æŸ¥è¯¢ tomcat ä¹Ÿæ˜¯é›†ç¾¤ä¹Ÿåšäº† jvm è¿›ç¨‹ç¼“å­˜ï¼Œtomcat æœåŠ¡å™¨ä¹‹é—´æ˜¯ä¸å…±äº«å†…å­˜çš„æ‰€ä»¥è¿˜éœ€è¦ä½¿ç”¨é€šè¿‡ id è®¡ç®— hash å€¼çš„æ–¹å¼æ¥è·¯ç”±æŒ‡å®š tomcat æœåŠ¡å™¨</p>\n<p>é‚£ä¹ˆå¤šçº§ç¼“å­˜å®Œæˆåå°±ä¼šé¢ä¸´ä¸€ä¸ªé—®é¢˜å°±æ˜¯æ•°æ®åŒæ­¥çš„é—®é¢˜ã€‚</p>\n<p>mysql çš„æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ redis å’Œ tomcat è¿›ç¨‹ç¼“å­˜å’Œ nginx ç¼“å­˜éƒ½éœ€è¦åšåŒæ­¥</p>\n<p>åœ¨ OPenResty ä¸­ä½¿ç”¨çš„è¶…æ—¶åŒæ­¥ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´è¿‡æœŸè‡ªåŠ¨åˆ é™¤å°±å˜æˆæ–°æ•°æ®äº†ï¼Œè¿™ç§æ–¹å¼é€‚åˆäºæ›´æ–°é¢‘ç‡è¾ƒä½çš„æ•°æ®</p>\n<p>è€Œ redis ä¸ mysql ä¹‹é—´çš„æ•°æ®åŒæ­¥é‡‡ç”¨äº† canal ç›‘å¬ mysql çš„æ–¹å¼</p>\n<h1 id=\"ä¹-æœåŠ¡å¼‚æ­¥é€šè®¯\"><a class=\"anchor\" href=\"#ä¹-æœåŠ¡å¼‚æ­¥é€šè®¯\">#</a> ä¹ã€æœåŠ¡å¼‚æ­¥é€šè®¯ğŸ„</h1>\n<p>é«˜çº§ç¯‡ - rabbitmq çš„é«˜çº§ç‰¹æ€§</p>\n<p>æˆ‘ä»¬å·²ç»å­¦ä¹ è¿‡å®ƒçš„åŸºæœ¬ç”¨æ³•äº†ï¼Œå­¦ä¹ äº†å¦‚ä½•åˆ©ç”¨ springamqp æ”¶å’Œå‘æ¶ˆæ¯ï¼Œä½†æ˜¯æ”¶å’Œå‘æ¶ˆæ¯åªæ˜¯ mq çš„æœ€åŸºæœ¬çš„åŠŸèƒ½ã€‚å› ä¸ºåœ¨æ”¶å’Œå‘æ¶ˆæ¯çš„è¿‡ç¨‹å½“ä¸­è¿˜æœ‰å¾ˆå¤šé—®é¢˜éœ€è¦æ€è€ƒéœ€è¦å»è§£å†³è¿™æ—¶å°±éœ€è¦ä½¿ç”¨ mq çš„é«˜çº§ç‰¹æ€§å»è§£å†³äº†</p>\n<p>MQ çš„ä¸€äº›å¸¸è§é—®é¢˜</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211532979.png\" alt=\"image-20231021153238893\" /></p>\n<p>å­¦ä¹ å†…å®¹ï¼š</p>\n<ul>\n<li>æ¶ˆæ¯å¯é æ€§</li>\n<li>æ­»ä¿¡äº¤æ¢æœº</li>\n<li>æƒ°æ€§é˜Ÿåˆ—</li>\n<li>MQ é›†ç¾¤</li>\n</ul>\n<h2 id=\"91-æ¶ˆæ¯å¯é æ€§é—®é¢˜\"><a class=\"anchor\" href=\"#91-æ¶ˆæ¯å¯é æ€§é—®é¢˜\">#</a> 9.1ã€æ¶ˆæ¯å¯é æ€§é—®é¢˜ğŸŒ³</h2>\n<p>æ¶ˆæ¯ä»ç”Ÿäº§è€…å‘é€åˆ° exchangeï¼Œå†åˆ° queueï¼Œå†åˆ°æ¶ˆè´¹è€…ï¼Œæœ‰å“ªäº›å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±çš„å¯èƒ½æ€§ï¼Ÿ</p>\n<p>å…ˆæ¥æ¸©ä¹ ä¸€ä¸‹ mq çš„æ•´ä¸ªæµç¨‹</p>\n<p>æ¶ˆæ¯çš„å‘é€è€…ç§°ä¸º publisherï¼Œå®ƒæŠŠæ¶ˆæ¯æŠ•é€’ç»™äº¤æ¢æœº exchangeï¼Œè€Œäº¤æ¢æœºä¼šæ ¹æ® routingkey å°†æ¶ˆæ¯è·¯ç”±åˆ°é˜Ÿåˆ— queue ä¸­ï¼Œè€Œé˜Ÿåˆ—å†æŠŠæ¶ˆæ¯æŠ•é€’ç»™æ¶ˆè´¹è€… consumer</p>\n<p>åœ¨æ•´ä¸ªè¿™æ ·çš„æµç¨‹å½“ä¸­æ¶ˆæ¯å¯èƒ½ä¼šå‘ç”Ÿä¸¢å¤±</p>\n<ul>\n<li>å‘é€æ—¶ä¸¢å¤±ï¼š\n<ul>\n<li>ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯æœªé€è¾¾ exchange</li>\n<li>æ¶ˆæ¯åˆ°è¾¾ exchange åæœªè¾¾åˆ° queue</li>\n</ul>\n</li>\n<li>MQ å®•æœºï¼Œqueue å°†æ¶ˆæ¯ä¸¢å¤±</li>\n<li>consumer æ¥æ”¶åˆ°æ¶ˆæ¯åæœªæ¶ˆæ¯å°±å®•æœº</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211536652.png\" alt=\"image-20231021153606449\" /></p>\n<p>é’ˆå¯¹ä¸Šè¿°é—®é¢˜æˆ‘ä»¬æ¥å­¦ä¹ å¦‚ä¸‹å†…å®¹ï¼š</p>\n<ul>\n<li>ç”Ÿäº§è€…æ¶ˆæ¯ç¡®è®¤</li>\n<li>æ¶ˆæ¯æŒä¹…åŒ–</li>\n<li>æ¶ˆè´¹è€…æ¶ˆæ¯ç¡®è®¤</li>\n<li>æ¶ˆè´¹å¤±è´¥é‡è¯•æœºåˆ¶</li>\n</ul>\n<h3 id=\"911-ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶\"><a class=\"anchor\" href=\"#911-ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶\">#</a> 9.1.1ã€ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶ğŸŒ²</h3>\n<p>RabbitMQ æä¾›äº† publisher confirm æœºåˆ¶æ¥é¿å…æ¶ˆæ¯å‘é€åˆ° MQ è¿‡ç¨‹ä¸­ä¸¢å¤±ã€‚æ¶ˆæ¯å‘é€åˆ° MQ ä»¥åï¼Œä¼šè¿”å›ä¸€ä¸ªç»“æœç»™å‘é€è€…ï¼Œè¡¨ç¤ºæ¶ˆæ¯æ˜¯å¦å¤„ç†æˆåŠŸã€‚ç»“æœæœ‰ä¸¤ç§è¯·æ±‚ï¼š</p>\n<ul>\n<li>publisher-confirmï¼Œå‘é€è€…ç¡®è®¤\n<ul>\n<li>æ¶ˆæ¯æˆåŠŸæŠ•é€’åˆ°äº¤æ¢æœºï¼Œè¿”å› ack</li>\n<li>æ¶ˆæ¯æœªæŠ•é€’åˆ°äº¤æ¢æœºï¼Œè¿”å› nack</li>\n</ul>\n</li>\n<li>publisher-returnï¼Œå‘é€è€…å›æ‰§\n<ul>\n<li>æ¶ˆæ¯æŠ•é€’åˆ°äº¤æ¢æœºäº†ï¼Œä½†æ˜¯æ²¡æœ‰è·¯ç”±åˆ°é˜Ÿåˆ—ã€‚è¿”å› ACKï¼ŒåŠè·¯ç”±å¤±è´¥åŸå› ã€‚</li>\n</ul>\n</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211546864.png\" alt=\"image-20231021154614145\" /></p>\n<blockquote>\n<p>&lt;font color='red'&gt; æ³¨æ„ &lt;/font&gt;ï¼š</p>\n<p>ç¡®è®¤æœºåˆ¶å‘é€æ¶ˆæ¯æ—¶ï¼Œéœ€è¦ç»™æ¯ä¸ªæ¶ˆæ¯è®¾ç½®ä¸€ä¸ªå…¨å±€å”¯ä¸€ idï¼Œä»¥åŒºåˆ†ä¸åŒæ¶ˆæ¯ï¼Œé¿å… ack å†²çª</p>\n</blockquote>\n<p>å¼•å…¥ demo å·¥ç¨‹</p>\n<p>é¦–å…ˆï¼Œéœ€è¦å¼•å…¥é¡¹ç›®ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZG91a2FpeGluL3R5cG9yYS5naXQ=\">https://gitee.com/doukaixin/typora.git</span></p>\n<p>æ‹‰å–åˆ†æ”¯ï¼šmq-advanced-demo ä»£ç æ¼”ç¤º</p>\n<h2 id=\"92-springamqpå®ç°ç”Ÿäº§è€…ç¡®è®¤\"><a class=\"anchor\" href=\"#92-springamqpå®ç°ç”Ÿäº§è€…ç¡®è®¤\">#</a> 9.2ã€SpringAMQP å®ç°ç”Ÿäº§è€…ç¡®è®¤ğŸŒ³</h2>\n<p>1ã€åœ¨ publisher è¿™ä¸ªå¾®æœåŠ¡çš„ applicaiton.yml ä¸­æ·»åŠ é…ç½®ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">rabbitmq</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> 192.168.249.128 <span class=\"token comment\"># rabbitMQ çš„ ip åœ°å€</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5672</span> <span class=\"token comment\"># ç«¯å£</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> itcast</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123321</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">virtual-host</span><span class=\"token punctuation\">:</span> /</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">#------------------------------------</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">publisher-confirm-type</span><span class=\"token punctuation\">:</span> correlated</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">publisher-returns</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token key atrule\">mandatory</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr></table></figure><p>é…ç½®è¯´æ˜ï¼š</p>\n<ul>\n<li>publishe-confirm-typeï¼šå¼€å¯ publisher-confirmï¼Œè¿™é‡Œæ”¯æŒä¸¤ç§ç±»å‹ï¼š\n<ul>\n<li>simpleï¼šåŒæ­¥ç­‰å¾… confirm ç»“æœï¼Œç›´åˆ°è¶…æ—¶</li>\n<li>correlatedï¼šå¼‚æ­¥å›è°ƒï¼Œå®šä¹‰ ConfirmCallbackï¼ŒMQ è¿”å›ç»“æœæ—¶ä¼šå›è°ƒè¿™ä¸ª ConfirmCallback</li>\n</ul>\n</li>\n<li>publish-returnsï¼šå¼€å¯ publish-return åŠŸèƒ½ï¼ŒåŒæ ·æ˜¯åŸºäº callback æœºåˆ¶ï¼Œä¸è¿‡æ˜¯å®šä¹‰ ReturnCallback</li>\n<li>template.mandatoryï¼šå®šä¹‰æ¶ˆæ¯è·¯ç”±å¤±è´¥æ—¶çš„ç­–ç•¥ã€‚trueï¼Œåˆ™è°ƒç”¨ ReturnCallback; falseï¼šåˆ™ç›´æ¥ä¸¢å¼ƒæ¶ˆæ¯</li>\n</ul>\n<p>2ã€æ¯ä¸ª RabbitTemplate åªèƒ½é…ç½®ä¸€ä¸ª ReturnCallbackï¼Œå› æ­¤éœ€è¦åœ¨é¡¹ç›®å¯åŠ¨è¿‡ç¨‹ä¸­é…ç½®ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//                         å®ç° Spring å·¥å‚çš„é€šçŸ¥</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CommonConfig</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ApplicationContextAware</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// é‡å†™ Bean å·¥å‚å‡†å¤‡å¥½åè°ƒç”¨çš„å‡½æ•°</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ApplicationContext</span> applicationContext<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// å–å‡º RabbitTempalte çš„ Bean</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">RabbitTemplate</span> rabbitTemplate <span class=\"token operator\">=</span> applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RabbitTemplate</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// é…ç½® ReturnCallback</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setReturnCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">,</span> s1<span class=\"token punctuation\">,</span> s2<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token comment\">// è®°å½•æ—¥å¿— &#123;&#125; ä¸ºå ä½ç¬¦</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—å¤±è´¥ï¼Œå“åº”ç ï¼š&#123;&#125;ï¼Œå¤±è´¥åŸå› ï¼š&#123;&#125;ï¼Œ\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                    <span class=\"token string\">\"äº¤æ¢æœºï¼š&#123;&#125;ï¼Œè·¯ç”±keyï¼š&#123;&#125;ï¼Œæ¶ˆæ¯ï¼š&#123;&#125;\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                    i<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">,</span> s1<span class=\"token punctuation\">,</span> s2<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token comment\">// å¦‚æœæœ‰éœ€è¦çš„è¯ï¼Œé‡å‘æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>returncallback æ˜¯ exchange è·¯ç”±ä¸åˆ° queue æ—¶ï¼Œæ‰è§¦å‘çš„å›è°ƒ</p>\n<p>confirmcallback æ˜¯åœ¨æ¶ˆæ¯è¾¾ä¸åˆ°äº¤æ¢æœºæ—¶ï¼Œæ‰å›è°ƒ</p>\n<p>3ã€å‘é€æ¶ˆæ¯ï¼ŒæŒ‡å®šæ¶ˆæ¯ IDï¼Œæ¶ˆæ¯ ConfirmCallback</p>\n<p>å…ˆä½¿ç”¨ test ä»£ç è¿›è¡Œä¸€ä¸‹æµ‹è¯•</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211718275.png\" alt=\"image-20231021171827222\" /></p>\n<p>å‘é€æ¶ˆæ¯çš„ä»£ç ä¸­ï¼Œæœ‰ äº¤æ¢æœºï¼Œä½†æ˜¯ Routingkey ä¸å­˜åœ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»åˆ›å»ºä¸€ä¸‹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211719943.png\" alt=\"image-20231021171807188\" /></p>\n<p>ç‚¹å‡» bind</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211719018.png\" alt=\"image-20231021171942977\" /></p>\n<p>ä½†æ˜¯ï¼åœ¨å‘é€æ¶ˆæ¯çš„æµ‹è¯•ä»£ç ä¸­ä»¥å‰æ˜¯é‚£æ ·å†™çš„ï¼Œä½†æ˜¯ç°åœ¨è¦åšæ¶ˆæ¯ç¡®è®¤æœºåˆ¶æ‰€ä»¥å°±è¦å¤šä¼ é€’ä¸€ä¸ªå‚æ•°äº†</p>\n<p>æµ‹è¯•ä»£ç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@RunWith</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SpringRunner</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootTest</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SpringAmqpTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RabbitTemplate</span> rabbitTemplate<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testSendMessage2SimpleQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">String</span> routingKey <span class=\"token operator\">=</span> <span class=\"token string\">\"simple.test\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// 1. å‡†å¤‡æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">String</span> message <span class=\"token operator\">=</span> <span class=\"token string\">\"hello, spring amqp!\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">// 1.1. å‡†å¤‡ CorrelationData</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// 1.2. æ¶ˆæ¯ ID</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">CorrelationData</span> correlationData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CorrelationData</span><span class=\"token punctuation\">(</span><span class=\"token constant\">UUID</span><span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// 1.3. å‡†å¤‡ ConfirmCallback</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// æˆåŠŸçš„å›è°ƒå‡½æ•°</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        correlationData<span class=\"token punctuation\">.</span><span class=\"token function\">getFuture</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addCallback</span><span class=\"token punctuation\">(</span>confirm <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token comment\">// åˆ¤æ–­ç»“æœ</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>confirm<span class=\"token punctuation\">.</span><span class=\"token function\">isAck</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token comment\">// ACK</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                log<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆæ¯æˆåŠŸæŠ•é€’åˆ°äº¤æ¢æœº ï¼æ¶ˆæ¯ID: &#123;&#125;\"</span><span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token comment\">// NACK</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆæ¯æŠ•é€’åˆ°äº¤æ¢æœºå¤±è´¥äº† ï¼ æ¶ˆæ¯ID: &#123;&#125;\"</span><span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token comment\">// é‡å‘æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token comment\">// å¤±è´¥çš„å›è°ƒå‡½æ•°</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> throwable <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token comment\">// è®°å½•æ—¥å¿—</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆæ¯å‘é€å¤±è´¥ ! \"</span><span class=\"token punctuation\">,</span> throwable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token comment\">// é‡å‘æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token comment\">// 2. å‘é€æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"amq.topic\"</span><span class=\"token punctuation\">,</span> routingKey<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">,</span>correlationData <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿è¡Œè¿™ä¸ªæµ‹è¯•ä»£ç </p>\n<p>idea æ§åˆ¶å°æ‰“å°ä¿¡æ¯å¦‚ä¸‹ï¼š</p>\n<pre><code>æ¶ˆæ¯æˆåŠŸæŠ•é€’åˆ°äº¤æ¢æœº ï¼æ¶ˆæ¯ID: a4abf2f4-85f5-4fdc-bb73-7be9ab91b6bd\n</code></pre>\n<p>æŸ¥çœ‹æ¶ˆæ¯é˜Ÿåˆ—æ˜¯å¦æ¥å—åˆ°äº†ä¸€ä¸ªæ¶ˆæ¯å¹¶æŸ¥çœ‹å†…å®¹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211737447.png\" alt=\"image-20231021173713091\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211737796.png\" alt=\"image-20231021173730615\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>SpringAMQP ä¸­å¤„ç†æ¶ˆæ¯ç¡®è®¤çš„å‡ ç§æƒ…å†µï¼š</p>\n<ul>\n<li>publisher-confirm\n<ul>\n<li>æ¶ˆæ¯æˆåŠŸå‘é€åˆ° exchangeï¼Œè¿”å› ack</li>\n<li>æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œæ²¡æœ‰åˆ°è¾¾äº¤æ¢æœºï¼Œè¿”å› nack</li>\n<li>æ¶ˆæ¯å‘é€è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œæ²¡æœ‰æ”¶åˆ°å›æ‰§</li>\n</ul>\n</li>\n<li>æ¶ˆæ¯æˆåŠŸå‘é€åˆ° exchangeï¼Œä½†æ²¡æœ‰è·¯ç”±åˆ° queue\n<ul>\n<li>è°ƒç”¨ ReturnCallback</li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<p>ä»¥ä¸Šå°±æ˜¯ç”Ÿäº§ç¡®è®¤çš„æœºåˆ¶äº†ã€‚é€šè¿‡è¿™äº›æœºåˆ¶å°±èƒ½å¤Ÿç¡®è®¤æ¶ˆæ¯ èƒ½å¤Ÿåˆ°è¾¾æ¶ˆæ¯é˜Ÿåˆ—</p>\n<h2 id=\"93-æ¶ˆæ¯æŒä¹…åŒ–\"><a class=\"anchor\" href=\"#93-æ¶ˆæ¯æŒä¹…åŒ–\">#</a> 9.3ã€æ¶ˆæ¯æŒä¹…åŒ–ğŸŒ³</h2>\n<p>ç”±äº RabbitMQ é»˜è®¤æ˜¯å†…å­˜å­˜å‚¨ï¼Œå¦‚æœæ­¤æ—¶ mq å‘ç”Ÿäº†å®•æœºï¼Œæ¶ˆæ¯ä¹Ÿæ˜¯æœ‰å¯èƒ½ä¸¢å¤±çš„ã€‚è¦æƒ³è®©æ¶ˆæ¯çœŸæ­£å®‰å…¨ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿è¿™ä¸ªæ¶ˆæ¯èƒ½å¤Ÿåšåˆ°æŒä¹…åŒ–ã€‚ä¹Ÿå°±æ˜¯æŠŠå®ƒå†™å…¥åˆ°ç£ç›˜ä¸­</p>\n<p>åœ¨æ¶ˆè´¹è€…çš„ config ç±»ä¸­è¿›è¡Œé…ç½®</p>\n<p>1ã€äº¤æ¢æœºæŒä¹…åŒ–ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">DirectExchange</span> <span class=\"token function\">simpleExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// ä¸‰ä¸ªå‚æ•°ï¼šäº¤æ¢æœºåç§°ï¼Œæ˜¯å¦æŒä¹…åŒ–ï¼Œå½“æ²¡æœ‰ queue ä¸å…¶ç»‘å®šæ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DirectExchange</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"simple.direct\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>2ã€é˜Ÿåˆ—æŒä¹…åŒ–</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">simpleQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// ä½¿ç”¨ QueueBuilder æ„å»ºé˜Ÿåˆ—ï¼Œdurable å°±æ˜¯æŒä¹…åŒ–çš„</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token class-name\">QueueBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">durable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"simple.queue\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡è¿›è¡Œæµ‹è¯•ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>\n<p>é˜Ÿåˆ—</p>\n<p>å…¶ä¸­çš„ D å°±æ˜¯ durable å°±æ˜¯æŒä¹…åŒ–çš„æ„æ€</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211756121.png\" alt=\"image-20231021175655932\" /></p>\n<p>äº¤æ¢æœº</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211759449.png\" alt=\"image-20231021175939976\" /></p>\n<p>å…³é—­æ‰€æœ‰æœåŠ¡å™¨</p>\n<p>å‘é€ä¸€ä¸‹æ¶ˆæ¯è¿›è¡Œæµ‹è¯•ä¸€ä¸‹æ¶ˆæ¯æ˜¯å¦ä¹Ÿèƒ½æŒä¹…åŒ–</p>\n<p>æˆ‘ä»¬å‘ simple.queue ä¸­å‘é€ä¸€æ¡æ¶ˆæ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211831349.png\" alt=\"image-20231021183122204\" /></p>\n<p>æ­¤æ—¶é˜Ÿåˆ—ä¸­å°±ä¼šå­˜ç•™ä¸€æ¡æ¶ˆæ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211833155.png\" alt=\"image-20231021183339726\" /></p>\n<p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬é˜Ÿåˆ—é‡Œé¢æœ‰æ¶ˆæ¯äº†ï¼Œå¹¶ä¸”é˜Ÿåˆ—å·²ç»æŒä¹…åŒ–äº†ï¼Œæˆ‘ä»¬å†å»é‡å¯ mq æ¥æµ‹è¯•ä¸€ä¸‹</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker restart mq</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>mq</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>å›åˆ°é¡µé¢ä¸­è¿›è¡ŒæŸ¥çœ‹</p>\n<p>å¯ä»¥çœ‹åˆ°æ¶ˆæ¯ æ²¡äº†ï¼</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211835842.png\" alt=\"image-20231021183522398\" /></p>\n<p>è¿™å°±è¯æ˜æ¶ˆæ¯æ²¡æœ‰æŒä¹…åŒ–ï¼Œé‚£æˆ‘ä»¬çš„ç›®çš„æ˜¯è®©æ¶ˆæ¯ä¹Ÿèƒ½æŒä¹…å•Šï¼Œé‚£æ€ä¹ˆåŠï¼Ÿ</p>\n<p>3ã€æ¶ˆæ¯æŒä¹…åŒ–ï¼ŒSpringAMQP ä¸­çš„æ¶ˆæ¯é»˜è®¤æ˜¯æŒä¹…çš„ï¼Œå¯ä»¥é€šè¿‡ MessageProperties ä¸­çš„ DeliveryMode æ¥æŒ‡å®šï¼š</p>\n<p>åœ¨æµ‹è¯•ä»£ç ä¸­è¿›è¡Œç¼–å†™ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testDurableMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">Message</span> message <span class=\"token operator\">=</span> <span class=\"token class-name\">MessageBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">withBody</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello, spring\"</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                                             <span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// æ¶ˆæ¯ä½“</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">setDeliveryMode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageDeliveryMode</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PERSISTENT</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// æŒä¹…åŒ–</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">// 2. å‘é€æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"simple.queue\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨æˆåŠŸåæŸ¥çœ‹é˜Ÿåˆ—æƒ…å†µï¼š</p>\n<p>å¯ä»¥çœ‹åˆ°é˜Ÿåˆ—ä¸­å°±æœ‰äº†ä¸€æ¡æ¶ˆæ¯äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211842026.png\" alt=\"image-20231021184255870\" /></p>\n<p>åœ¨é˜Ÿåˆ—çš„è¯¦æƒ…é¡µé¢é‡Œé¢çš„ get message ä¸­å¯ä»¥çœ‹åˆ° delivery_modeï¼š2 è¡¨ç¤ºæ¶ˆæ¯æŒä¹…åŒ–</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211844251.png\" alt=\"image-20231021184420061\" /></p>\n<p>é‡å¯ mq æµ‹è¯•æ¶ˆæ¯æ˜¯å¦çœŸçš„å°±æ˜¯æŒä¹…åŒ–äº†ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker restart mq</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>mq</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>è®¿é—® mq é˜Ÿé‡Œæƒ…å†µï¼š</p>\n<p>å¯ä»¥çœ‹åˆ°è¿™æ¡æ¶ˆæ¯è¿˜å­˜åœ¨ç€</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211845144.png\" alt=\"image-20231021184553048\" /></p>\n<h2 id=\"94-æ¶ˆè´¹è€…ç¡®è®¤\"><a class=\"anchor\" href=\"#94-æ¶ˆè´¹è€…ç¡®è®¤\">#</a> 9.4ã€æ¶ˆè´¹è€…ç¡®è®¤ğŸŒ³</h2>\n<p>RabbitMQ æ”¯æŒæ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶ï¼Œå³ï¼šæ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯åå¯ä»¥å‘ MQ å‘é€ ack å›æ‰§ï¼ŒMQ æ”¶åˆ° ack å›æ‰§åæ‰ä¼šåˆ é™¤æ¶ˆæ¯ã€‚è€Œ SpringAMQP åˆ™å…è®¸é…ç½®ä¸‰ç§ç¡®è®¤æ¨¡å¼ï¼š</p>\n<ul>\n<li>manualï¼šæ‰‹åŠ¨ ackï¼Œéœ€è¦åœ¨ä¸šåŠ¡ä»£ç ç»“æŸåï¼Œè°ƒç”¨ api å‘é€ ack</li>\n<li>autoï¼šè‡ªåŠ¨ ackï¼Œç”± Spring æ£€æµ‹ listener ä»£ç æ˜¯å¦å‡ºç°å¼‚å¸¸ï¼Œæ²¡æœ‰å¼‚å¸¸åˆ™è¿”å› ackï¼›æŠ›å‡ºå¼‚å¸¸åˆ™è¿”å› nack</li>\n<li>noneï¼šå…³é—­ ackï¼ŒMQ å‡å®šæ¶ˆè´¹è€…è·å–æ¶ˆæ¯åä¼šæˆåŠŸå¤„ç†ï¼Œå› æ­¤æ¶ˆæ¯æŠ•é€’åç«‹å³è¢«åˆ é™¤</li>\n</ul>\n<p>é…ç½®æ–¹å¼æ˜¯ä¿®æ”¹ application.yml æ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢é…ç½®ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">rabbitmq</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> 192.168.249.128 <span class=\"token comment\"># rabbitMQ çš„ ip åœ°å€</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5672</span> <span class=\"token comment\"># ç«¯å£</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> itcast</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123321</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">virtual-host</span><span class=\"token punctuation\">:</span> /</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">listener</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">simple</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token key atrule\">prefetch</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token key atrule\">acknowledge-mode</span><span class=\"token punctuation\">:</span> auto <span class=\"token comment\"># è‡ªåŠ¨ ack</span></pre></td></tr></table></figure><p>å…ˆçœ‹ä¸‹ mq çš„é˜Ÿåˆ—æƒ…å†µ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310212025971.png\" alt=\"image-20231021202521333\" /></p>\n<p>é˜Ÿåˆ—ä¸­æœ‰ä¸€æ¡æ¶ˆæ¯</p>\n<p>æˆ‘ä»¬åœ¨ consumer çš„æ¶ˆè´¹ä»£ç ç¼–å†™ä¸€ä¸ªå¼‚å¸¸</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SpringRabbitListener</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> <span class=\"token string\">\"simple.queue\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">listenSimpleQueue</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">*</span>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆè´¹è€…æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ï¼šã€\"</span> <span class=\"token operator\">+</span> msg <span class=\"token operator\">+</span> <span class=\"token string\">\"ã€‘\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">/</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯æˆåŠŸ ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>é…ç½®å®Œæˆåå¯åŠ¨ consumer æœåŠ¡è¿›è¡Œæµ‹è¯•</p>\n<p>æ­¤æ—¶ç¨‹åºèµ°åˆ° debug å¤„ï¼Œæ²¡æœ‰æ‰§è¡Œå®Œæ¯•æˆ‘ä»¬çœ‹ä¸‹ç°åœ¨çš„é˜Ÿåˆ—æƒ…å†µ</p>\n<p>å¯ä»¥çœ‹åˆ°å®ƒæ²¡æœ‰åˆ é™¤è¿™æ¡æ¶ˆæ¯è€Œæ˜¯æ ‡è®°ä¸ºäº† Unacked</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310212027453.png\" alt=\"image-20231021202727506\" /></p>\n<p>å¦‚æœç¨‹åºä¸è¿›è¡Œä¸€ç›´ç­‰å¾…åˆ™ä¼šå˜å›åŸæ¥çš„çŠ¶æ€</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310212029138.png\" alt=\"image-20231021202909987\" /></p>\n<p>java ä»£ç ç¨‹åºå¾€ä¸‹èµ°å°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯å®ƒä¼šè¿›è¡Œé‡æ–°æŠ•é€’</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310212048599.gif\" alt=\"test\" /></p>\n<p>ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸å¸Œæœ›å®ƒå°±è¿™æ ·å¤±è´¥äº†å°±æ— è„‘é‡è¯•é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿçœ‹ä¸‹é¢çš„å†…å®¹ã€‚</p>\n<h2 id=\"95-å¤±è´¥é‡è¯•æœºåˆ¶\"><a class=\"anchor\" href=\"#95-å¤±è´¥é‡è¯•æœºåˆ¶\">#</a> 9.5ã€å¤±è´¥é‡è¯•æœºåˆ¶ğŸŒ³</h2>\n<p>å½“æ¶ˆè´¹è€…å‡ºç°å¼‚å¸¸åï¼Œæ¶ˆè´¹ä¼šä¸æ–­ requue (é‡æ–°å…¥é˜Ÿ) åˆ°é˜Ÿåˆ—ï¼Œå†é‡æ–°å‘é€ç»™æ¶ˆè´¹è€…ï¼Œç„¶åå†æ¬¡å¼‚å¸¸ï¼Œå†æ¬¡ requeueï¼Œæ— é™å¾ªç¯ï¼Œå¯¼è‡´ mq çš„æ¶ˆæ¯å¤„ç†é£™å‡ï¼Œå¸¦æ¥ä¸å¿…è¦çš„å‹åŠ›ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310212051338.png\" alt=\"image-20231021205137135\" /></p>\n<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Spring çš„ retry æœºåˆ¶ï¼Œåœ¨æ¶ˆè´¹è€…å‡ºç°å¼‚å¸¸æ—¶åˆ©ç”¨æœ¬åœ°é‡è¯•ï¼Œè€Œä¸æ˜¯æ— é™åˆ¶çš„ requeue åˆ° mq é˜Ÿåˆ—ã€‚</p>\n<p>å½“ç„¶æœ¬åœ°é‡è¯•ä¹Ÿä¸æ˜¯æ— é™è®©å®ƒä¸€ç›´é‡è¯•</p>\n<p>åœ¨æ¶ˆè´¹è€…æœåŠ¡ä¸­è¿›è¡Œé…ç½®ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">rabbitmq</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> 192.168.249.128 <span class=\"token comment\"># rabbitMQ çš„ ip åœ°å€</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5672</span> <span class=\"token comment\"># ç«¯å£</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> itcast</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123321</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">virtual-host</span><span class=\"token punctuation\">:</span> /</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">listener</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">simple</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token key atrule\">prefetch</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token key atrule\">acknowledge-mode</span><span class=\"token punctuation\">:</span> auto</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">#------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token key atrule\">retry</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>          <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\"># å¼€å¯æ¶ˆè´¹è€…å¤±è´¥é‡è¯•</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>          <span class=\"token key atrule\">initial-interval</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1000</span> <span class=\"token comment\"># åˆå§‹çš„å¤±è´¥ç­‰å¾…æ—¶é•¿ä¸º 1 ç§’</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>          <span class=\"token key atrule\">multiplier</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span> <span class=\"token comment\"># ä¸‹æ¬¡å¤±è´¥çš„ç­‰å¾…æ—¶é•¿å€æ•°ï¼Œä¸‹æ¬¡ç­‰å¾…æ—¶é•¿ = multiplier *last-interval</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>          <span class=\"token key atrule\">max-attempts</span><span class=\"token punctuation\">:</span> <span class=\"token number\">4</span> <span class=\"token comment\"># æœ€å¤§é‡è¯•æ¬¡æ•°</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>          <span class=\"token key atrule\">stateless</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\"># true æ— çŠ¶æ€ï¼›false æœ‰çŠ¶æ€ã€‚å¦‚æœä¸šåŠ¡ä¸­åŒ…å«äº‹åŠ¡ï¼Œè¿™é‡Œæ”¹ä¸º false</span></pre></td></tr></table></figure><p>å¯åŠ¨æ¶ˆè´¹è€…æœåŠ¡åè¿›è¡Œæµ‹è¯• idea æ§åˆ¶å°æ‰“å°å¦‚ä¸‹ï¼š</p>\n<p>æŠ¥äº†ä¸€ä¸ªå¼‚å¸¸ï¼Œè¯´é‡è¯•æ¬¡æ•°è€—å°½äº†</p>\n<pre><code>mqp.rabbit.support.ListenerExecutionFailedException: Retry Policy Exhausted\n\tat org.springframework.amqp.rabbit.retry.RejectAndDontRequeueRecoverer.recover(RejectAndDontRequeueRecoverer.java:45) ~[spring-rabbit-2.2.15.RELEASE.jar:2.2.15.RELEASE]\n\tat org.springframework.amqp.rabbit.config.StatelessRetryOperationsInterceptorFactoryBean.lambda$createRecoverer$0(StatelessRetryOperationsInterceptorFactoryBean.java:74) ~[spring-rabbit-2.2.15.RELEASE.jar:2.2.15.RELEASE]\n\tat org.springframework.retry.interceptor.RetryOperationsInterceptor$ItemRecovererCallback.recover(RetryOperationsInterceptor.java:141) ~[spring-retry-1.2.5.RELEASE.jar:na]\n\tat org.springframework.retry.support.RetryTemplate.handleRetryExhausted(RetryTemplate.java:512) ~[spring-retry-1.2.5.RELEASE.jar:na]\n</code></pre>\n<p>è¿™æ¡æ¶ˆæ¯å°±ä¼šè¢«ä¸¢å¼ƒæ‰</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310220940740.png\" alt=\"image-20231022094032330\" /></p>\n<h3 id=\"951-æ¶ˆè´¹è€…å¤±è´¥æ¶ˆæ¯å¤„ç†ç­–ç•¥\"><a class=\"anchor\" href=\"#951-æ¶ˆè´¹è€…å¤±è´¥æ¶ˆæ¯å¤„ç†ç­–ç•¥\">#</a> 9.5.1ã€æ¶ˆè´¹è€…å¤±è´¥æ¶ˆæ¯å¤„ç†ç­–ç•¥ğŸŒ²</h3>\n<p>åœ¨å¼€å¯é‡è¯•æ¨¡å¼åï¼Œé‡è¯•æ¬¡æ•°è€—å°½ï¼Œå¦‚æœæ¶ˆæ¯ä¾ç„¶å¤±è´¥ï¼Œåˆ™éœ€è¦æœ‰ MessageRecoverer æ¥å£æ¥å¤„ç†ï¼Œå®ƒåŒ…å«ä¸‰ç§ä¸åŒçš„å®ç°ï¼š</p>\n<p>1ã€RejectAndDontRequeueRecovererï¼šé‡è¯•è€—å°½åï¼Œç›´æ¥ rejectï¼Œä¸¢å¼ƒæ¶ˆæ¯ã€‚é»˜è®¤å°±æ˜¯è¿™ç§æ–¹å¼</p>\n<p>2ã€ImmediateRequeueMessageRecovererï¼šé‡è¯•è€—å°½åï¼Œè¿”å› nackï¼Œæ¶ˆæ¯é‡æ–°å…¥é˜Ÿ</p>\n<p>3ã€RepublishMessageRecovererï¼šé‡è¯•è€—å°½åï¼Œå°†å¤±è´¥æ¶ˆæ¯æŠ•é€’åˆ°æŒ‡å®šçš„äº¤æ¢æœº</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221014285.png\" alt=\"image-20231022101421805\" /></p>\n<p>æµ‹è¯•ä¸‹ RepublishMessageRcoverer å¤„ç†æ¨¡å¼ï¼š</p>\n<p>1ã€é¦–å…ˆï¼Œå®šä¹‰æ¥æ”¶å¤±è´¥æ¶ˆæ¯çš„äº¤æ¢æœºï¼Œé˜Ÿåˆ—åŠå…¶ç»‘å®šå…³ç³»ï¼š</p>\n<p>2ã€ç„¶åå®šä¹‰ RepublishMessageRecovererï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ErrorMessageConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DirectExchange</span> <span class=\"token function\">errorMessageExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DirectExchange</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"error.direct\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">errorQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"error.queue\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">errorMessageBinding</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">BindingBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token function\">errorQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">(</span><span class=\"token function\">errorMessageExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"error\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MessageRecoverer</span> <span class=\"token function\">republishMessageRecoverer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RabbitTemplate</span> rabbitTemplate<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RepublishMessageRecoverer</span><span class=\"token punctuation\">(</span>rabbitTemplate<span class=\"token punctuation\">,</span> <span class=\"token string\">\"error.direct\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"error\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨æ¶ˆè´¹è€…æœåŠ¡æŸ¥çœ‹ mq çš„äº¤æ¢æœºå’Œé˜Ÿåˆ—æƒ…å†µ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221027869.png\" alt=\"image-20231022102732042\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221027294.png\" alt=\"image-20231022102744943\" /></p>\n<p>å‘é€ä¸€æ¡æ¶ˆæ¯è¿›è¡Œæµ‹è¯•ï¼Œæ‰¾åˆ° simple.queue è¿›è¡Œå‘é€æ¶ˆæ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221030573.png\" alt=\"image-20231022103002600\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221032487.png\" alt=\"image-20231022103250120\" /></p>\n<p>idea æ§åˆ¶å°æ‰“å°æƒ…å†µ</p>\n<pre><code>æ¶ˆè´¹è€…æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ï¼šã€hello spring !ã€‘\næ¶ˆè´¹è€…æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ï¼šã€hello spring !ã€‘\næ¶ˆè´¹è€…æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ï¼šã€hello spring !ã€‘\n10:30:18:538  WARN 6996 --- [ntContainer#0-1] o.s.a.r.retry.RepublishMessageRecoverer  : Republishing failed message to exchange 'error.direct' with routing key error\n</code></pre>\n<p>ç„¶åå†æŸ¥çœ‹é˜Ÿåˆ—æƒ…å†µ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221031933.png\" alt=\"image-20231022103105401\" /></p>\n<p>åœ¨ error.queue é˜Ÿåˆ—çš„è¯¦ç»†æ¶ˆæ¯ä¸­å¯ä»¥çœ‹åˆ°æŠ¥é”™çš„ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221032636.png\" alt=\"image-20231022103202192\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>:</p>\n<p>å¦‚ä½•ç¡®ä¿ RabbitMQ æ¶ˆæ¯çš„å¯é æ€§ï¼Ÿ</p>\n<ol>\n<li>å¼€å¯ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶ï¼Œç¡®ä¿ç”Ÿäº§è€…çš„æ¶ˆæ¯èƒ½åˆ°è¾¾é˜Ÿåˆ—</li>\n<li>å¼€å¯æŒä¹…åŒ–åŠŸèƒ½ï¼Œç¡®ä¿æ¶ˆæ¯æœªæ¶ˆè´¹å‰åœ¨é˜Ÿåˆ—ä¸­ä¸ä¼šä¸¢å¤±</li>\n<li>å¼€å¯æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶ä¸º autoï¼Œç”± spring ç¡®è®¤æ¶ˆæ¯å¤„ç†æˆåŠŸåå®Œæˆ ack</li>\n<li>å¼€å¯æ¶ˆè´¹è€…å¤±è´¥é‡è¯•æœºåˆ¶ï¼Œå¹¶è®¾ç½® MessageRecovererï¼Œå¤šæ¬¡é‡è¯•å¤±è´¥åå°†æ¶ˆæ¯æŠ•é€’åˆ°å¼‚å¸¸äº¤æ¢æœºï¼Œäº¤ç”±äººå·¥å¤„ç†</li>\n</ol>\n</blockquote>\n<h1 id=\"å-æ­»ä¿¡äº¤æ¢æœº\"><a class=\"anchor\" href=\"#å-æ­»ä¿¡äº¤æ¢æœº\">#</a> åã€æ­»ä¿¡äº¤æ¢æœºğŸ„</h1>\n<ul>\n<li>åˆè¯†æ­»ä¿¡äº¤æ¢æœº</li>\n<li>TTL</li>\n<li>å»¶è¿Ÿé˜Ÿåˆ—</li>\n</ul>\n<h2 id=\"101-åˆè¯†æ­»ä¿¡äº¤æ¢æœº\"><a class=\"anchor\" href=\"#101-åˆè¯†æ­»ä¿¡äº¤æ¢æœº\">#</a> 10.1ã€åˆè¯†æ­»ä¿¡äº¤æ¢æœºğŸŒ³</h2>\n<p>å½“ä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ»¡è¶³ä¸‹åˆ—æƒ…å†µä¹‹ä¸€æ—¶ï¼Œå¯ä»¥ç§°ä¸º &lt;font color='red'&gt; æ­»ä¿¡ (dead letter)&lt;/font&gt;ï¼š</p>\n<p>1ã€æ¶ˆè´¹è€…ä½¿ç”¨ basic.reject æˆ– basic.nack å£°æ˜æ¶ˆè´¹å¤±è´¥ï¼Œå¹¶ä¸”æ¶ˆæ¯çš„ requeue å‚æ•°è®¾ç½®ä¸º false</p>\n<p>2ã€æ¶ˆæ¯æ˜¯ä¸€ä¸ªè¿‡æœŸæ¶ˆæ¯ï¼Œè¶…æ—¶æ— äººæ¶ˆè´¹</p>\n<p>3ã€è¦æŠ•é€’çš„é˜Ÿåˆ—æ¶ˆæ¯å †ç§¯æ»¡äº†ï¼Œæœ€æ—©çš„æ¶ˆæ¯å¯èƒ½æˆä¸ºæ­»ä¿¡</p>\n<p>å¦‚æœè¯¥é˜Ÿåˆ—é…ç½®äº† dead-letter-exchange å±æ€§ï¼ŒæŒ‡å®šäº†ä¸€ä¸ªäº¤æ¢æœºï¼Œé‚£ä¹ˆé˜Ÿåˆ—ä¸­çš„æ­»ä¿¡å°±ä¼šæŠ•é€’åˆ°è¿™ä¸ªäº¤æ¢æœºä¸­ï¼Œè€Œè¿™ä¸ªäº¤æ¢æœºç§°ä¸º &lt;font color='red'&gt; æ­»ä¿¡äº¤æ¢æœº &lt;/font&gt;. (Dead Letter Exchange ï¼Œ ç®€ç§° DLX)ã€‚</p>\n<p>å¦‚æœæœ‰ä¸€ä¸ªæ¶ˆæ¯å‘é€åˆ°äº†æ¶ˆè´¹è€…ï¼Œå‡è®¾æ¶ˆè´¹è€…é‡‡ç”¨é»˜è®¤çš„é‡è¯•æœºåˆ¶ä¸æ–­é‡è¯•ç›´åˆ°æ¬¡æ•°è€—å°½å°±ä¼šå°†æ¶ˆæ¯æ‹’ç»ï¼Œè€Œæ¶ˆæ¯ä¸€æ—¦è¢«æ‹’ç»é»˜è®¤æƒ…å†µä¸‹å°±ä¼šè¢«ä¸¢å¼ƒäº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221043785.png\" alt=\"image-20231022104354267\" /></p>\n<p>å¦‚æœè¯´ä¸æƒ³ä¸¢å¤±å°±å¿…é¡»ç»™ simple.queue è¿™ä¸ªé˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœºï¼Œè¿™æ—¶æ¶ˆæ¯å°±ä¸ä¼šè¢«ä¸¢å¼ƒäº†è€Œæ˜¯å˜æˆä¸€ä¸ªæ­»ä¿¡å†å›åˆ°é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—å†æŠ•é€’åˆ°æ­»ä¿¡äº¤æ¢æœºã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221046386.png\" alt=\"image-20231022104628552\" /></p>\n<p>äº¤æ¢æœºä¸èƒ½å­˜å‚¨æ¶ˆæ¯é‚£ä¹ˆä¸ºäº†ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œè¿˜éœ€è¦ç»‘å®šä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™ä¸ªæ¶ˆæ¯å°±ä¼šåˆ°è¾¾ dl.queue é˜Ÿåˆ—ä¸­ç§°ä¸ºæ­»ä¿¡é˜Ÿåˆ—</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221049450.png\" alt=\"image-20231022104901077\" /></p>\n<p>è¿™é‡Œä¸ä¸Šè¿°çš„ æ¶ˆè´¹è€…å¤±è´¥æ¶ˆæ¯å¤„ç†ç­–ç•¥ ä¸€æ ·ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å·®å¼‚çš„ï¼Œå°±æ˜¯åœ¨ä¸Šè¿°æ–¹å¼ä¸­ï¼Œæ‰€æœ‰çš„å¤±è´¥æ¶ˆæ¯éƒ½æ˜¯æœ‰æ¶ˆè´¹è€…æ¥åšæŠ•é€’çš„ã€‚è€Œåœ¨ç°åœ¨çš„æ–¹å¼ä¸­æ˜¯ç”±é˜Ÿåˆ—åšæŠ•é€’çš„</p>\n<p>å¦‚æœåªæ˜¯åšæ¶ˆæ¯çš„å…œåº•å¤„ç†å»ºè®®ä½¿ç”¨ä¸Šè¿°æ–¹å¼ï¼Œå¦‚æœæ˜¯åšæ¶ˆæ¯å…œåº•å¤„ç†ä»¥åŠé¢å¤–çš„åŠŸèƒ½å»ºè®®ä½¿ç”¨å½“å‰æ–¹å¼</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>ä»€ä¹ˆæ ·çš„æ¶ˆæ¯ä¼šæˆä¸ºæ­»ä¿¡ï¼Ÿ</p>\n<p>1ã€æ¶ˆæ¯è¢«æ¶ˆè´¹è€… reject æˆ–è€…è¿”å› nack</p>\n<p>2ã€æ¶ˆæ¯è¶…æ—¶æœªæ¶ˆè´¹</p>\n<p>3ã€é˜Ÿåˆ—æ»¡äº†</p>\n<p>å¦‚ä½•ç»™é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœºï¼Ÿ</p>\n<p>1ã€ç»™é˜Ÿåˆ—è®¾ç½® dead-letter-exchange å±æ€§ï¼ŒæŒ‡å®šä¸€ä¸ªäº¤æ¢æœº</p>\n<p>2ã€ç»™é˜Ÿåˆ—è®¾ç½® dead-letter-routing-key å±æ€§ï¼Œè®¾ç½®æ­»ä¿¡äº¤æ¢æœºä¸æ­»ä¿¡é˜Ÿåˆ—çš„ RoutingKey</p>\n</blockquote>\n<h2 id=\"102-ttl\"><a class=\"anchor\" href=\"#102-ttl\">#</a> 10.2ã€TTLğŸŒ³</h2>\n<p>TTLï¼Œä¹Ÿå°±æ˜¯ Time-To-Liveã€‚å¦‚æœä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ TTL ç»“æŸä»æœªæ¶ˆè´¹ï¼Œåˆ™ä¼šå˜ä¸ºæ­»ä¿¡ï¼ŒTTL è¶…æ—¶åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p>\n<p>1ã€æ¶ˆæ¯æ‰€åœ¨çš„é˜Ÿåˆ—è®¾ç½®äº†å­˜æ´»æ—¶é—´</p>\n<p>2ã€æ¶ˆæ¯æœ¬èº«è®¾ç½®äº†å­˜æ´»æ—¶é—´</p>\n<p>å‡å¦‚ä¸€ä¸ªæ¶ˆæ¯è‡ªå·±è®¾ç½®äº†æ—¶é—´ä¸º 5000 æ¯«ç§’åˆ°æ¶ˆæ¯å‘å‡ºå»ï¼Œåˆ°è¾¾äº†é˜Ÿåˆ—çš„æ—¶å€™å°±ä¼šå¼€å§‹è®¡æ—¶ï¼Œè®¡æ—¶ç»“æŸåè¿™ä¸ªæ¶ˆæ¯å°±ä¼šæˆä¸ºæ­»ä¿¡ï¼Œä»è€ŒæŠ•é€’åˆ°æ­»ä¿¡äº¤æ¢æœº æœ€ç»ˆåˆ°è¾¾äº†æ­»ä¿¡é˜Ÿåˆ—ã€‚è¿™æ—¶å¦‚æœæ°å¥½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…åœ¨ç›‘å¬æ­»ä¿¡é˜Ÿåˆ—å®ƒå°±ä¼šæ”¶åˆ°è¿™ä¸ªæ­»ä¿¡æ¶ˆæ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221102065.gif\" alt=\"test\" /></p>\n<p>æˆ‘ä»¬å£°æ˜ä¸€ç»„æ­»ä¿¡äº¤æ¢æœºå’Œé˜Ÿåˆ—ï¼ŒåŸºäºæ³¨è§£æ–¹å¼ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>bindings <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@QueueBinding</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   value <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Queue</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"dl.queue\"</span><span class=\"token punctuation\">,</span> durable <span class=\"token operator\">=</span> <span class=\"token string\">\"true\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   exchange <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Exchange</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"dl.direct\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   key <span class=\"token operator\">=</span> <span class=\"token string\">\"dl\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">listenDlQueue</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆè´¹è€…æ¥æ”¶åˆ°äº†dl.queueçš„å»¶è¿Ÿæ¶ˆæ¯\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¦ç»™é˜Ÿåˆ—è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œéœ€è¦åœ¨å£°æ˜é˜Ÿåˆ—çš„ç±»ä¸­ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TTLMessageConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DirectExchange</span> <span class=\"token function\">ttlDirectExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DirectExchange</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ttl.direct\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">ttlQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">QueueBuilder</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">durable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ttl.queue\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// æŒ‡å®šé˜Ÿåˆ—åç§°ï¼Œå¹¶æŒä¹…åŒ–</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">ttl</span><span class=\"token punctuation\">(</span><span class=\"token number\">10000</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½®é˜Ÿåˆ—çš„è¶…æ—¶æ—¶é—´ï¼Œ10 ç§’</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">deadLetterExchange</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dl.direct\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// æŒ‡å®šæ­»ä¿¡äº¤æ¢æœº</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">deadLetterRoutingKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dl\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// æŒ‡å®šæ­»ä¿¡ RoutingKey</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">ttlBinding</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">BindingBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token function\">ttlQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">(</span><span class=\"token function\">ttlDirectExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ttl\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™å‘å¸ƒè€…ä»£ç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testTTLMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">Message</span> message <span class=\"token operator\">=</span> <span class=\"token class-name\">MessageBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">withBody</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello, ttl message\"</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                                             <span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">setDeliveryMode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageDeliveryMode</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PERSISTENT</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">// 2. å‘é€æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ttl.direct\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ttl\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token comment\">// 3. è®°å½•æ—¥å¿—</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆæ¯å·²ç»æˆåŠŸå‘é€äº† ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡è¿›è¡Œæµ‹è¯•ï¼š</p>\n<p>æ¶ˆæ¯å‘å¸ƒè€…å‘é€å‡ºå»çš„æ—¶é—´ä¸ºï¼š46</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221122622.png\" alt=\"image-20231022112215176\" /></p>\n<p>æ¶ˆæ¯æ¥æ”¶è€…æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶é—´ä¸ºï¼š56</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221122464.png\" alt=\"image-20231022112249139\" /></p>\n<p>å»¶è¿Ÿäº† 10 ç§’é’Ÿçš„æ—¶é—´ï¼Œè¿™æ ·å»¶è¿Ÿæ¶ˆæ¯å°±å®ç°äº†</p>\n<p>ä¸Šè¿°æ˜¯åŸºäºé˜Ÿåˆ—å®ç°çš„å»¶è¿Ÿæ¶ˆæ¯ï¼Œä¸‹é¢æ¥å­¦ä¹ ç»™æ¶ˆæ¯è®¾ç½®å»¶è¿Ÿæ—¶é—´</p>\n<p>å‘é€æ¶ˆæ¯æ—¶ï¼Œç»™æ¶ˆæ¯æœ¬èº«è®¾ç½®è¶…æ—¶æ—¶é—´ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testTTLMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">Message</span> message <span class=\"token operator\">=</span> <span class=\"token class-name\">MessageBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">withBody</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello, ttl message\"</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                                             <span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">setDeliveryMode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageDeliveryMode</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PERSISTENT</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">setExpiration</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"5000\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½®æ¶ˆæ¯çš„å»¶è¿Ÿæ—¶é—´ä¸º 5 ç§’</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token comment\">// 2. å‘é€æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ttl.direct\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ttl\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token comment\">// 3. è®°å½•æ—¥å¿—</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆæ¯å·²ç»æˆåŠŸå‘é€äº† ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡å™¨æµ‹è¯•æŸ¥çœ‹æ¶ˆæ¯å»¶è¿Ÿå¤šä¹…æ—¶é—´ï¼š</p>\n<p>å‘é€è€…å‘é€æ¶ˆæ¯æ—¶é—´ä¸ºï¼š16</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221127666.png\" alt=\"image-20231022112741830\" /></p>\n<p>æ¥å—è€…æ”¶åˆ°æ¶ˆæ¯æ—¶é—´ä¸ºï¼š21</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221128275.png\" alt=\"image-20231022112808892\" /></p>\n<p>æ¶ˆæ¯å»¶è¿Ÿäº† 5 ç§’çš„æ—¶é—´ï¼Œ<mark>å½“é˜Ÿåˆ—ä¸æ¶ˆæ¯æœ¬èº«éƒ½è®¾ç½®äº†å»¶è¿Ÿæ—¶é—´æ—¶ï¼Œä»¥æœ€çŸ­çš„æ—¶é—´ä¸ºå‡†</mark>ã€‚</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>æ¶ˆæ¯è¶…æ—¶çš„ä¸¤ç§æ–¹å¼æ˜¯ï¼Ÿ</p>\n<p>1ã€ç»™é˜Ÿåˆ—è®¾ç½® ttl å±æ€§ï¼Œè¿›å…¥é˜Ÿåˆ—åè¶…è¿‡ ttl æ—¶é—´çš„æ¶ˆæ¯å˜ä¸ºæ­»ä¿¡</p>\n<p>2ã€ç»™æ¶ˆæ¯è®¾ç½® ttl å±æ€§ï¼Œé˜Ÿåˆ—æ¥æ”¶åˆ°æ¶ˆæ¯è¶…è¿‡ ttl æ—¶é—´åå˜ä¸ºæ­»ä¿¡</p>\n<p>3ã€ä¸¤è€…å…±å­˜æ—¶ï¼Œä»¥æ—¶é—´çŸ­çš„ ttl ä¸ºå‡†</p>\n<p>å¦‚ä½•å®ç°å‘é€ä¸€ä¸ªæ¶ˆæ¯ 20 ç§’åæ¶ˆè´¹è€…æ‰æ”¶åˆ°æ¶ˆæ¯ï¼Ÿ</p>\n<p>1ã€ç»™æ¶ˆæ¯çš„ç›®æ ‡é˜Ÿåˆ—æŒ‡å®šæ­»ä¿¡äº¤æ¢æœº</p>\n<p>2ã€æ¶ˆè´¹è€…ç›‘å¬ä¸æ­»ä¿¡äº¤æ¢æœºç»‘å®šçš„é˜Ÿåˆ—</p>\n<p>3ã€å‘é€æ¶ˆæ¯æ—¶ç»™æ¶ˆæ¯è®¾ç½® tll ä¸º 20 ç§’</p>\n</blockquote>\n<p>ä¸‹é¢å­¦ä¹ å»¶è¿Ÿé˜Ÿåˆ—çš„æ’ä»¶æ¥å®ç°å»¶è¿Ÿæ¶ˆæ¯</p>\n<h2 id=\"103-å»¶è¿Ÿé˜Ÿåˆ—\"><a class=\"anchor\" href=\"#103-å»¶è¿Ÿé˜Ÿåˆ—\">#</a> 10.3ã€å»¶è¿Ÿé˜Ÿåˆ—ğŸŒ³</h2>\n<p>åˆ©ç”¨ TTL ç»“åˆæ­»ä¿¡äº¤æ¢æœºï¼Œæˆ‘ä»¬å®ç°äº†æ¶ˆæ¯å‘å‡ºåï¼Œæ¶ˆè´¹è€…å»¶è¿Ÿæ”¶åˆ°æ¶ˆæ¯çš„æ•ˆæœã€‚è¿™ç§æ¶ˆæ¯æ¨¡å¼å°±ç§°ä¸º &lt;font color='red'&gt; å»¶è¿Ÿé˜Ÿåˆ— (Delay Queue) æ¨¡å¼ &lt;/font&gt;.</p>\n<p>å»¶è¿Ÿé˜Ÿåˆ—çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬ï¼š</p>\n<p>1ã€å»¶è¿Ÿå‘é€çŸ­ä¿¡</p>\n<p>2ã€ç”¨æˆ·ä¸‹å•ï¼Œå¦‚æœç”¨æˆ·åœ¨ 15 åˆ†é’Ÿå†…æœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆ</p>\n<p>3ã€é¢„çº¦å·¥ä½œä¼šè®®ï¼Œ20 åˆ†é’Ÿåè‡ªåŠ¨é€šçŸ¥æ‰€æœ‰å‚ä¼šäººå‘˜</p>\n<h3 id=\"1031-å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶\"><a class=\"anchor\" href=\"#1031-å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶\">#</a> 10.3.1ã€å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶ğŸŒ²</h3>\n<p>å› ä¸ºå»¶è¿Ÿé˜Ÿåˆ—çš„éœ€æ±‚éå¸¸å¤šï¼Œæ‰€ä»¥ RabbitMQ çš„å®˜æ–¹ä¹Ÿæ¨å‡ºäº†ä¸€ä¸ªæ’ä»¶ï¼ŒåŸç”Ÿæ”¯æŒå»¶è¿Ÿé˜Ÿåˆ—æ•ˆæœã€‚</p>\n<p>è¯¦ç»†å®‰è£…æŸ¥çœ‹æ–‡ç« ï¼š<a href=\"../RabbitMQ/%E9%AB%98%E7%BA%A7%E7%AF%87/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97.md\">RabbitMQ éƒ¨ç½²æŒ‡å—</a>.</p>\n<h3 id=\"1032-springamqpä½¿ç”¨å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶\"><a class=\"anchor\" href=\"#1032-springamqpä½¿ç”¨å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶\">#</a> 10.3.2ã€SpringAMQP ä½¿ç”¨å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶ğŸŒ²</h3>\n<p>DelayExchange çš„æœ¬è´¨è¿˜æ˜¯å®˜æ–¹çš„ä¸‰ç§äº¤æ¢æœºï¼Œåªæ˜¯æ·»åŠ äº†å»¶è¿ŸåŠŸèƒ½ã€‚å› æ­¤ä½¿ç”¨æ—¶åªéœ€è¦å£°æ˜ä¸€ä¸ªäº¤æ¢æœºï¼Œäº¤æ¢æœºçš„ç±»å‹å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œç„¶åè®¾å®š delayed å±æ€§ä¸º true å³å¯</p>\n<p>åŸºäºæ³¨è§£æ–¹å¼ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>bindings <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@QueueBinding</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   value <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Queue</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.queue\"</span><span class=\"token punctuation\">,</span> durable <span class=\"token operator\">=</span> <span class=\"token string\">\"true\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   exchange <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Exchange</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.direct\"</span><span class=\"token punctuation\">,</span> delayed <span class=\"token operator\">=</span> <span class=\"token string\">\"true\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   key <span class=\"token operator\">=</span> <span class=\"token string\">\"delay\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">listenDelayExchange</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆè´¹è€…æ¥æ”¶åˆ°äº†delay.queueçš„å»¶è¿Ÿæ¶ˆæ¯ , &#123;&#125;\"</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å…ˆå¯åŠ¨æ¶ˆè´¹è€…æœåŠ¡è®©å®ƒå…ˆç­‰ç€</p>\n<p>æŸ¥çœ‹ mq çš„äº¤æ¢æœºæƒ…å†µï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221614876.png\" alt=\"image-20231022161400235\" /></p>\n<p>ç„¶åæˆ‘ä»¬å‘è¿™ä¸ª delay ä¸º true çš„äº¤æ¢æœºä¸­å‘é€æ¶ˆæ¯ï¼Œä¸€å®šè¦ç»™æ¶ˆæ¯æ·»åŠ ä¸€ä¸ª header: x-delayï¼Œå€¼ä¸ºå»¶è¿Ÿçš„æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testSndDelayMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">Message</span> message <span class=\"token operator\">=</span> <span class=\"token class-name\">MessageBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">withBody</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello, ttl message\"</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                                             <span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">setDeliveryMode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageDeliveryMode</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PERSISTENT</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-delay\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½®æ¶ˆæ¯çš„å»¶è¿Ÿæ—¶é—´ä¸º 5 ç§’</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// 1.1. å‡†å¤‡ CorrelationData</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">// 1.2. æ¶ˆæ¯ ID</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token class-name\">CorrelationData</span> correlationData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CorrelationData</span><span class=\"token punctuation\">(</span><span class=\"token constant\">UUID</span><span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token comment\">// 2. å‘é€æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"delay.direct\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"delay\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">,</span>correlationData <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆæ¯å‘é€æˆåŠŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å†å¯åŠ¨å‘å¸ƒè€…æµ‹è¯•ä»£ç è¿›è¡Œå‘å¸ƒï¼š</p>\n<p>å‘å¸ƒåæµ‹è¯•ä»£ç ä¼šæç¤ºä¸€ä¸ªé”™è¯¯ä½†æ˜¯è¿™ä¸ªé”™è¯¯æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºå»¶è¿Ÿå®ƒä¼šè¯¯ä»¥ä¸ºéœ€è¦é‡è¯•ï¼Œå°±ä¼šè§¦å‘é‡å‘æœºåˆ¶ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸éœ€è¦å¯¹å»¶è¿Ÿæ¶ˆæ¯è¿›è¡Œé‡è¯•ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹å…¶åšä¸€ä¸‹åˆ¤æ–­</p>\n<pre><code>ERROR 17588 --- [nectionFactory1] cn.itcast.mq.config.CommonConfig         : æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—å¤±è´¥ï¼Œå“åº”ç ï¼š312ï¼Œå¤±è´¥åŸå› ï¼šNO_ROUTEï¼Œäº¤æ¢æœºï¼šdelay.directï¼Œè·¯ç”±keyï¼šdelayï¼Œæ¶ˆæ¯ï¼š(Body:'[B@71c09e9d(byte[18])' MessageProperties [headers=&#123;spring_returned_message_correlation=b85f2836-22b6-406e-9e49-d5f44a07af32&#125;, contentType=application/octet-stream, contentLength=0, receivedDeliveryMode=PERSISTENT, priority=0, receivedDelay=5000, deliveryTag=0])\n</code></pre>\n<p>å¯¹ receivedDelay è¿›è¡Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨å€¼</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//                         å®ç° Spring å·¥å‚çš„é€šçŸ¥</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CommonConfig</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ApplicationContextAware</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// é‡å†™ Bean å·¥å‚å‡†å¤‡å¥½åè°ƒç”¨çš„å‡½æ•°</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ApplicationContext</span> applicationContext<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// å–å‡º RabbitTempalte çš„ Bean</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">RabbitTemplate</span> rabbitTemplate <span class=\"token operator\">=</span> applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RabbitTemplate</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// é…ç½® ReturnCallback</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setReturnCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">,</span> s1<span class=\"token punctuation\">,</span> s2<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token comment\">// åˆ¤æ–­æ˜¯å¦æ˜¯å»¶è¿Ÿæ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getReceivedDelay</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token comment\">// æ˜¯ä¸€ä¸ªå»¶è¿Ÿæ¶ˆæ¯ï¼Œå¿½ç•¥è¿™ä¸ªé”™è¯¯æç¤º</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token comment\">// è®°å½•æ—¥å¿— &#123;&#125; ä¸ºå ä½ç¬¦</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—å¤±è´¥ï¼Œå“åº”ç ï¼š&#123;&#125;ï¼Œå¤±è´¥åŸå› ï¼š&#123;&#125;ï¼Œ\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                    <span class=\"token string\">\"äº¤æ¢æœºï¼š&#123;&#125;ï¼Œè·¯ç”±keyï¼š&#123;&#125;ï¼Œæ¶ˆæ¯ï¼š&#123;&#125;\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                    i<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">,</span> s1<span class=\"token punctuation\">,</span> s2<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">// å¦‚æœæœ‰éœ€è¦çš„è¯ï¼Œé‡å‘æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨è¿è¡Œå‘å¸ƒè€…æµ‹è¯•ä»£ç åæ‰“å°å¦‚ä¸‹ï¼š</p>\n<p>å¯ä»¥çœ‹åˆ°å°±æ²¡æœ‰é”™è¯¯æç¤ºäº†ï¼Œä¹Ÿå°±è§£å†³äº†æ˜æ˜æ²¡æœ‰é”™è¯¯å´é‡è¯•çš„é—®é¢˜äº†</p>\n<pre><code>16:22:35:703  INFO 2568 --- [           main] cn.itcast.mq.spring.SpringAmqpTest       : æ¶ˆæ¯å‘é€æˆåŠŸ\n</code></pre>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶çš„ä½¿ç”¨æ­¥éª¤åŒ…æ‹¬å“ªäº›ï¼Ÿ</p>\n<p>1ã€å£°æ˜ä¸€ä¸ªäº¤æ¢æœºï¼Œæ·»åŠ  delayed å±æ€§ä¸º true</p>\n<p>2ã€å‘é€æ¶ˆæ¯æ—¶ï¼Œæ·»åŠ  x-delay å¤´ï¼Œå€¼ä¸ºè¶…æ—¶æ—¶é—´</p>\n</blockquote>\n<h1 id=\"åä¸€-æƒ°æ€§é˜Ÿåˆ—\"><a class=\"anchor\" href=\"#åä¸€-æƒ°æ€§é˜Ÿåˆ—\">#</a> åä¸€ã€æƒ°æ€§é˜Ÿåˆ—ğŸ„</h1>\n<ul>\n<li>æ¶ˆæ¯å †ç§¯é—®é¢˜</li>\n<li>æƒ°æ€§é˜Ÿåˆ—</li>\n</ul>\n<h2 id=\"111-æ¶ˆæ¯å †ç§¯é—®é¢˜\"><a class=\"anchor\" href=\"#111-æ¶ˆæ¯å †ç§¯é—®é¢˜\">#</a> 11.1ã€æ¶ˆæ¯å †ç§¯é—®é¢˜ğŸŒ³</h2>\n<p>å½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„é€Ÿåº¦è¶…è¿‡äº†æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯çš„é€Ÿåº¦ï¼Œå°±ä¼šå¯¼è‡´é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å †ç§¯ï¼Œç›´åˆ°é˜Ÿåˆ—å­˜å‚¨æ¶ˆæ¯è¾¾åˆ°ä¸Šé™ã€‚æœ€æ—©æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œå¯èƒ½å°±ä¼šæˆä¸ºæ­»ä¿¡ï¼Œä¼šè¢«ä¸¢å¼ƒï¼Œè¿™å°±æ˜¯ &lt;font color='red'&gt; æ¶ˆæ¯å †ç§¯ &lt;/font &gt; é—®é¢˜ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221629911.gif\" alt=\"test\" /></p>\n<p><strong>è§£å†³æ¶ˆæ¯å †ç§¯æœ‰ä¸‰ç§æ€è·¯</strong>ï¼š</p>\n<p>1ã€å¢åŠ æ›´å¤šæ¶ˆè´¹è€…ï¼Œæé«˜æ¶ˆè´¹é€Ÿåº¦</p>\n<p>2ã€åœ¨æ¶ˆè´¹è€…å†…å¼€å¯çº¿ç¨‹æ± åŠ å¿«æ¶ˆæ¯å¤„ç†é€Ÿåº¦</p>\n<p>3ã€æ‰©å¤§é˜Ÿåˆ—å®¹ç§¯ï¼Œæé«˜å †ç§¯ä¸Šé™</p>\n<h2 id=\"112-æƒ°æ€§é˜Ÿåˆ—\"><a class=\"anchor\" href=\"#112-æƒ°æ€§é˜Ÿåˆ—\">#</a> 11.2ã€æƒ°æ€§é˜Ÿåˆ—ğŸŒ³</h2>\n<p>ä» RabbitMQ çš„ 3.6.0 ç‰ˆæœ¬å¼€å§‹ï¼Œå°±å¢åŠ äº† Lazy Queues çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯ &lt;font color='red'&gt; æƒ°æ€§é˜Ÿåˆ— &lt;/font&gt;.</p>\n<p>æƒ°æ€§é˜Ÿåˆ—çš„ç‰¹å¾å¦‚ä¸‹ï¼š</p>\n<p>1ã€æ¥å—åˆ°æ¶ˆæ¯åç›´æ¥å­˜å…¥ç£ç›˜è€Œéå†…å­˜</p>\n<p>2ã€æ¶ˆè´¹è€…è¦æ¶ˆè´¹æ—¶æ‰ä¼šä»ç£ç›˜ä¸­è¯»å–å¹¶åŠ è½½åˆ°å†…å­˜</p>\n<p>3ã€æ”¯æŒæ•°ç™¾ä¸‡æ¡çš„æ¶ˆæ¯å­˜å‚¨</p>\n<p>è€Œè¦è®¾ç½®ä¸€ä¸ªé˜Ÿåˆ—ä¸ºæƒ°æ€§é˜Ÿåˆ—ï¼Œåªéœ€è¦åœ¨å£°æ˜é˜Ÿåˆ—æ—¶ï¼ŒæŒ‡å®š x-queue-mode å±æ€§ä¸º lazy å³å¯ã€‚å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå°†ä¸€ä¸ªè¿è¡Œä¸­çš„é˜Ÿåˆ—ä¿®æ”¹ä¸ºæƒ°æ€§é˜Ÿåˆ—ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmqctl set_policy <span class=\"token class-name\">Lazy</span> <span class=\"token string\">\"^lazy-queue$\"</span> '<span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"queue-mode\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"lazy\"</span><span class=\"token punctuation\">&#125;</span>' <span class=\"token operator\">--</span>apply<span class=\"token operator\">-</span><span class=\"token keyword\">to</span> <span class=\"token namespace\">queues</span></pre></td></tr></table></figure><p>ç”¨ SpringAMQP å£°æ˜æƒ°æ€§é˜Ÿåˆ—åˆ†ä¸¤ç§æ–¹å¼ï¼š</p>\n<p>@Bean æ–¹å¼</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LazyConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">lazyQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">QueueBuilder</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">durable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lazy.queue\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">lazy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// å¼€å¯ x-queue-mode ä¸º lazy</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ³¨è§£æ–¹å¼ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queuesToDeclare <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Queue</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tname <span class=\"token operator\">=</span> <span class=\"token string\">\"lazy.queue\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   durable <span class=\"token operator\">=</span> <span class=\"token string\">\"true\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token string\">\"arguments\"</span> <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Argument</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"x-queue-mode\"</span><span class=\"token punctuation\">,</span> value <span class=\"token operator\">=</span> <span class=\"token string\">\"lazy\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">listenLazyQueue</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¥æ”¶åˆ° lazy.queueçš„æ¶ˆæ¯: &#123;&#125;\"</span> <span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™æµ‹è¯•ä»£ç è¿›è¡Œç™¾ä¸‡æ¶ˆæ¯æµ‹è¯•ï¼š</p>\n<p>å…ˆå¯¹ delay.direct æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œç™¾ä¸‡æ¶ˆæ¯çš„æµ‹è¯•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testLazyQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">&lt;</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token comment\">// 1. å‡†å¤‡æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token class-name\">Message</span> message <span class=\"token operator\">=</span> <span class=\"token class-name\">MessageBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">withBody</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello, ttl message\"</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                                                <span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">setDeliveryMode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageDeliveryMode</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NON_PERSISTENT</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token comment\">// 2. å‘é€æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"delay.direct\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å®ƒæ²¡æœ‰å­˜å‚¨ç£ç›˜è€Œå´å‘¢çˆ†çº¢äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221657687.png\" alt=\"image-20231022165706663\" /></p>\n<p>ä¸‹é¢æµ‹è¯•æƒ°æ€§é˜Ÿåˆ—çš„æƒ…å†µï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testLazyQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">&lt;</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token comment\">// 1. å‡†å¤‡æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token class-name\">Message</span> message <span class=\"token operator\">=</span> <span class=\"token class-name\">MessageBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">withBody</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello, ttl message\"</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                                                <span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">setDeliveryMode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageDeliveryMode</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NON_PERSISTENT</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token comment\">// 2. å‘é€æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lazy.queue\"</span><span class=\"token punctuation\">,</span>  message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ¶ˆæ¯éƒ½å­˜å‚¨åˆ°äº†ç£ç›˜ä¸­ï¼Œè¿™æ ·æ€§èƒ½å°±ä¼šæ¯”è¾ƒå¥½</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221702921.png\" alt=\"image-20231022170213243\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>æ¶ˆæ¯å †ç§¯é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Ÿ</p>\n<p>1ã€é˜Ÿåˆ—ä¸Šç»‘å®šå¤šä¸ªæ¶ˆè´¹è€…ï¼Œæé«˜æ¶ˆè´¹é€Ÿåº¦</p>\n<p>2ã€ç»™æ¶ˆè´¹è€…å¼€å¯çº¿ç¨‹æ± ï¼Œæé«˜æ¶ˆè´¹é€Ÿåº¦</p>\n<p>3ã€ä½¿ç”¨æƒ°æ€§é˜Ÿåˆ—ï¼Œå¯ä»¥å† mq ä¸­ä¿å­˜æ›´å¤šæ¶ˆæ¯</p>\n<p>æƒ°æ€§é˜Ÿåˆ—çš„ä¼˜ç‚¹æœ‰å“ªäº›ï¼Ÿ</p>\n<p>1ã€åŸºäºç£ç›˜å­˜å‚¨ï¼Œæ¶ˆæ¯ä¸Šé™é«˜</p>\n<p>2ã€æ²¡æœ‰é—´æ­‡æ€§çš„ page-outï¼Œæ€§èƒ½æ¯”è¾ƒç¨³å®š</p>\n<p>æƒ°æ€§é˜Ÿåˆ—çš„ç¼ºç‚¹æœ‰å“ªäº›ï¼Ÿ</p>\n<p>1ã€åŸºäºç£ç›˜å­˜å‚¨ï¼Œæ¶ˆæ¯æ—¶æ•ˆæ€§ä¼šé™ä½</p>\n<p>2ã€æ€§èƒ½å—é™äºç£ç›˜çš„ IO</p>\n</blockquote>\n<h1 id=\"åäºŒ-mqé›†ç¾¤\"><a class=\"anchor\" href=\"#åäºŒ-mqé›†ç¾¤\">#</a> åäºŒã€MQ é›†ç¾¤ğŸ„</h1>\n<ul>\n<li>é›†ç¾¤åˆ†ç±»</li>\n<li>æ™®é€šé›†ç¾¤</li>\n<li>é•œåƒé›†ç¾¤</li>\n<li>ä»²è½½é˜Ÿåˆ—</li>\n</ul>\n<h2 id=\"121-é›†ç¾¤åˆ†ç±»\"><a class=\"anchor\" href=\"#121-é›†ç¾¤åˆ†ç±»\">#</a> 12.1ã€é›†ç¾¤åˆ†ç±»ğŸŒ³</h2>\n<p>RabbitMQ æ˜¯åŸºäº Erlang è¯­è¨€ç¼–å†™ï¼Œè€Œ Erlang åˆæ˜¯ä¸€ä¸ªé¢å‘å¹¶å‘çš„è¯­è¨€ï¼Œå¤©ç„¶æ”¯æŒé›†ç¾¤æ¨¡å¼ï¼Œæ­å»ºæ¯”è¾ƒç®€å•ã€‚RabbitMQ çš„é›†ç¾¤æœ‰ä¸¤ç§æ¨¡å¼ï¼š</p>\n<p>1ã€<mark>æ™®é€šé›†ç¾¤</mark>ï¼šæ˜¯ä¸€ç§åˆ†å¸ƒå¼é›†ç¾¤ï¼Œå°†é˜Ÿåˆ—åˆ†æ•£åˆ°é›†ç¾¤çš„å„ä¸ªèŠ‚ç‚¹ï¼Œä»è€Œæé«˜æ•´ä¸ªé›†ç¾¤çš„å¹¶å‘èƒ½åŠ›ã€‚</p>\n<p>2ã€<mark>é•œåƒé›†ç¾¤</mark>ï¼šæ˜¯ä¸€ç§ä¸»ä»é›†ç¾¤ï¼Œæ™®é€šé›†ç¾¤çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ äº†ä¸»ä»å¤‡ä»½åŠŸèƒ½ï¼Œæé«˜é›†ç¾¤çš„æ•°æ®å¯ç”¨æ€§ã€‚</p>\n<p>é•œåƒé›†ç¾¤è™½ç„¶æ”¯æŒä¸»ä»ï¼Œä½†ä¸»ä»åŒæ­¥å¹¶ä¸æ˜¯å¼ºä¸€è‡´çš„ï¼ŒæŸäº›æƒ…å†µä¸‹å¯èƒ½æœ‰æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚å› æ­¤åœ¨ RabbitMQ çš„ 3.8 ç‰ˆæœ¬ä»¥åï¼Œæ¨å‡ºäº†æ–°çš„åŠŸèƒ½ï¼š<mark>ä»²è½½é˜Ÿåˆ—</mark> æ¥ä»£æ›¿é•œåƒé›†ç¾¤ï¼Œåº•å±‚é‡‡ç”¨ Raft åè®®ç¡®ä¿ä¸»ä»çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p>\n<h3 id=\"1211-æ™®é€šé›†ç¾¤\"><a class=\"anchor\" href=\"#1211-æ™®é€šé›†ç¾¤\">#</a> 12.1.1ã€æ™®é€šé›†ç¾¤ğŸŒ²</h3>\n<p>æ™®é€šé›†ç¾¤ï¼Œæˆ–è€…å«æ ‡å‡†é›†ç¾¤ (classic cluster) ï¼Œå…·å¤‡ä¸‹åˆ—ç‰¹å¾ï¼š</p>\n<ul>\n<li>ä¼šåœ¨é›†ç¾¤çš„å„ä¸ªèŠ‚ç‚¹é—´å…±äº«éƒ¨åˆ†æ•°æ®ï¼Œ åŒ…æ‹¬ï¼šäº¤æ¢æœºï¼Œé˜Ÿåˆ—å…ƒä¿¡æ¯ã€‚ä¸åŒ…å«é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚</li>\n</ul>\n<p>æ¯”å¦‚è¯´æœ‰ä¸‰å° RabbitMQï¼Œç„¶ååˆ›å»ºä¸€ä¸ªäº¤æ¢æœº</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221716648.png\" alt=\"image-20231022171634984\" /></p>\n<p>ç”±äºäº¤æ¢æœºå¯ä»¥åœ¨å„ä¸ªèŠ‚ç‚¹é—´å…±äº«ï¼Œæ‰€ä»¥å°†æ¥è¿™ä¸‰ä¸ªèŠ‚ç‚¹éƒ½èƒ½çœ‹åˆ°</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221717792.png\" alt=\"image-20231022171726859\" /></p>\n<p>ä½†æ˜¯ï¼Œç°åœ¨è¦åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—è¿™ä¸ªé˜Ÿåˆ—å« queue1 å®ƒæ˜¯åœ¨ç¬¬ä¸€ä¸ªäº¤æ¢æœºä¸Šå£°æ˜çš„ï¼Œæ­¤æ—¶é˜Ÿåˆ—æ˜¯ä¸å…±äº«çš„ã€‚ä½†æ˜¯æœ‰é˜Ÿåˆ—å…ƒä¿¡æ¯ï¼Œæ¯”å¦‚è¯´ queue1 å®ƒä¼šæœ‰å…¶å®ƒèŠ‚ç‚¹ä¸Šæœ‰ queue1 çš„åå­—ï¼Œä½ç½®ç­‰ä¿¡æ¯ã€‚ç›¸å½“äºæ˜¯ä¸€ä¸ªå¼•ç”¨</p>\n<ul>\n<li>å½“è®¿é—®é›†ç¾¤æŸèŠ‚ç‚¹æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—ä¸åœ¨è¯¥èŠ‚ç‚¹ï¼Œä¼šä»æ•°æ®æ‰€åœ¨èŠ‚ç‚¹ä¼ é€’åˆ°å½“å‰èŠ‚ç‚¹å¹¶è¿”å›</li>\n</ul>\n<p>æ¯”å¦‚è¯´ç°åœ¨æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ç»‘å®šåˆ°äº† queue1 ä½†æ˜¯åœ¨è®¿é—®çš„æ—¶å€™ä¸å°å¿ƒè®¿é—®åˆ°äº†ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹ã€‚è¿™ä¸ªèŠ‚ç‚¹ä¸Šæ²¡æœ‰ queue1 ä½†æ˜¯æœ‰ queue1 çš„å…ƒä¿¡æ¯ï¼Œå½“è·å–æ•°æ®çš„æ—¶å€™å°±ä¼šæ ¹æ®ç¬¬ä¸‰èŠ‚ç‚¹æœ‰ queue1 çš„ä½ç½®ä¿¡æ¯æ¥æ‰¾åˆ° queue1 ç„¶åæ‹¿åˆ°æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221722945.png\" alt=\"image-20231022172221484\" /></p>\n<ul>\n<li>é˜Ÿåˆ—æ‰€åœ¨èŠ‚ç‚¹å®•æœºï¼Œé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å°±ä¼šä¸¢å¤±</li>\n</ul>\n<p>æ¯”å¦‚è¯´ queue1 æŒ‚äº†ï¼Œå› ä¸ºç¬¬ä¸‰èŠ‚ç‚¹å’Œ queue1 æ˜¯å¼•ç”¨å…³ç³»å†æ¥å–æ•°æ®çš„æ—¶å€™å°±å–ä¸åˆ°äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221723703.png\" alt=\"image-20231022172351386\" /></p>\n<h4 id=\"12111-æ­å»ºæ™®é€šé›†ç¾¤\"><a class=\"anchor\" href=\"#12111-æ­å»ºæ™®é€šé›†ç¾¤\">#</a> 12.1.1.1ã€æ­å»ºæ™®é€šé›†ç¾¤ğŸŒ´</h4>\n<p>æ­å»ºæ™®é€šé›†ç¾¤å¯ä»¥å‚è€ƒæ–‡ç« ï¼š<a href=\"../RabbitMQ/%E9%AB%98%E7%BA%A7%E7%AF%87/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97.md\">RabbitMQ éƒ¨ç½²æŒ‡å—</a>.</p>\n<h3 id=\"1212-é•œåƒé›†ç¾¤\"><a class=\"anchor\" href=\"#1212-é•œåƒé›†ç¾¤\">#</a> 12.1.2ã€é•œåƒé›†ç¾¤ğŸŒ²</h3>\n<p>æ¯”æ–¹è¯´ï¼Œä¸‰ä¸ªèŠ‚ç‚¹ï¼Œäº¤æ¢æœºéƒ½èƒ½çœ‹åˆ°ã€‚é‚£é˜Ÿåˆ—å‘¢è¿™æ—¶å°±è¦çœ‹ä½ æ˜¯ä¸æ˜¯é•œåƒäº†ã€‚æ¯”æ–¹è¯´åœ¨ queue1 è¿™ä¸ªèŠ‚ç‚¹ä¸Šåˆ›å»ºäº†ä¸€ä¸ªé˜Ÿåˆ—ã€‚å› ä¸ºæ˜¯åœ¨èŠ‚ç‚¹ 1 ä¸Šåˆ›å»ºçš„ queue1 é˜Ÿåˆ—æ‰€ä»¥èŠ‚ç‚¹ 1 å°±æ˜¯ queue1 çš„ä¸»èŠ‚ç‚¹ï¼Œç„¶åæˆ‘ä»¬è¿˜å¯ä»¥æŒ‘å‡ºä¸€ä¸ªé•œåƒèŠ‚ç‚¹ã€‚æ¯”å¦‚è¯´åœ¨èŠ‚ç‚¹äºŒä¸Šåšä¸€ä¸ªé•œåƒï¼Œé‚£ä¹ˆèŠ‚ç‚¹äºŒå°±ä¼šæ‰¾èŠ‚ç‚¹ä¸€å»åŒæ­¥ queue1 çš„æ‰€æœ‰æ•°æ®ã€‚è¿™æ ·å®ƒä¿©çš„æ•°æ®å°±å…±äº«äº†ã€‚</p>\n<p>è€Œä¸»èŠ‚ç‚¹å’Œé•œåƒèŠ‚ç‚¹æ˜¯å¯ä»¥äº’ç›¸å¤‡ä»½çš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221753072.png\" alt=\"image-20231022175329422\" /></p>\n<p>é•œåƒé›†ç¾¤ï¼šæœ¬è´¨æ˜¯ä¸»ä»æ¨¡å¼ï¼Œå…·å¤‡ä¸‹é¢çš„ç‰¹å¾ï¼š</p>\n<p>1ã€äº¤æ¢æœºï¼Œé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šåœ¨å„ä¸ª mq çš„é•œåƒèŠ‚ç‚¹ä¹‹é—´åŒæ­¥å¤‡ä»½ã€‚</p>\n<p>2ã€åˆ›å»ºé˜Ÿåˆ—çš„èŠ‚ç‚¹è¢«ç§°ä¸ºè¯¥é˜Ÿåˆ—çš„<strong>ä¸»èŠ‚ç‚¹</strong>ï¼Œå¤‡ä»½åˆ°çš„å…¶å®ƒèŠ‚ç‚¹å«åšè¯¥é˜Ÿåˆ—çš„<strong>é•œåƒ</strong>èŠ‚ç‚¹ã€‚</p>\n<p>3ã€ä¸€ä¸ªé˜Ÿåˆ—çš„ä¸»èŠ‚ç‚¹å¯èƒ½æ˜¯å¦ä¸€ä¸ªé˜Ÿåˆ—çš„é•œåƒèŠ‚ç‚¹</p>\n<p>4ã€æ‰€æœ‰æ“ä½œéƒ½æ˜¯ä¸»èŠ‚ç‚¹å®Œæˆï¼Œç„¶ååŒæ­¥ç»™é•œåƒèŠ‚ç‚¹</p>\n<p>5ã€ä¸»å®•æœºåï¼Œé•œåƒèŠ‚ç‚¹ä¼šæ›¿ä»£æˆæ–°çš„ä¸»</p>\n<p>æ¯”æ–¹è¯´ queue1 å®ƒçš„é•œåƒèŠ‚ç‚¹æ˜¯åœ¨ queue2 ä¸Šï¼Œqueue2 è¿™ä¸ªé˜Ÿåˆ—æ˜¯åœ¨èŠ‚ç‚¹ 2 ä¸Šçš„ï¼Œä½†æ˜¯å®ƒå¯ä»¥å†èŠ‚ç‚¹ 3 ä¸Šå¤‡ä»½ï¼Œè€Œ queue3 æ˜¯åœ¨èŠ‚ç‚¹ 3 ä¸Šï¼Œè€Œå®ƒçš„é•œåƒèŠ‚ç‚¹æ˜¯åœ¨èŠ‚ç‚¹ 1 ä¸Šã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221942543.png\" alt=\"image-20231022194205210\" /></p>\n<h4 id=\"12121-æ­å»ºé•œåƒé›†ç¾¤\"><a class=\"anchor\" href=\"#12121-æ­å»ºé•œåƒé›†ç¾¤\">#</a> 12.1.2.1ã€æ­å»ºé•œåƒé›†ç¾¤ğŸŒ´</h4>\n<p>æ­å»ºé•œåƒé›†ç¾¤å¯ä»¥å‚è€ƒæ–‡ç« ï¼š<a href=\"../RabbitMQ/%E9%AB%98%E7%BA%A7%E7%AF%87/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97.md\">RabbitMQ éƒ¨ç½²æŒ‡å—</a>.</p>\n<h3 id=\"1213-ä»²è½½é˜Ÿåˆ—\"><a class=\"anchor\" href=\"#1213-ä»²è½½é˜Ÿåˆ—\">#</a> 12.1.3ã€ä»²è½½é˜Ÿåˆ—ğŸŒ²</h3>\n<p>ä»²è½½é˜Ÿåˆ—ï¼šä»²è½½é˜Ÿåˆ—æ˜¯åœ¨ 3.8 ç‰ˆæœ¬ä»¥åæ‰æœ‰çš„æ–°åŠŸèƒ½ï¼Œç”¨æ¥æ›¿ä»£é•œåƒé˜Ÿåˆ—ï¼Œå…·å¤‡ä¸‹åˆ—ç‰¹å¾ï¼š</p>\n<p>1ã€ä¸é•œåƒé˜Ÿåˆ—ä¸€æ ·ï¼Œéƒ½æ˜¯ä¸»ä»æ¨¡å¼ï¼Œæ”¯æŒä¸»ä»æ•°æ®åŒæ­¥</p>\n<p>2ã€ä½¿ç”¨éå¸¸ç®€å•ï¼Œæ²¡æœ‰å¤æ‚çš„é…ç½®</p>\n<p>3ã€ä¸»ä»åŒæ­¥åŸºäº Raft åè®®ï¼Œå¼ºä¸€è‡´</p>\n<h4 id=\"12131-ä»²è½½é˜Ÿåˆ—æ­å»º\"><a class=\"anchor\" href=\"#12131-ä»²è½½é˜Ÿåˆ—æ­å»º\">#</a> 12.1.3.1ã€ä»²è½½é˜Ÿåˆ—æ­å»ºğŸŒ´</h4>\n<p>ä»²è½½é˜Ÿåˆ—æ­å»ºå¯ä»¥å‚è€ƒæ–‡ç« ï¼š<a href=\"../RabbitMQ/%E9%AB%98%E7%BA%A7%E7%AF%87/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97.md\">RabbitMQ éƒ¨ç½²æŒ‡å—</a>.</p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "springcloud-é«˜çº§",
                "è®¡ç®—æœºå­¦ç§‘",
                "springcloud"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/RabbitMQ/%E9%AB%98%E7%BA%A7/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/RabbitMQ/%E9%AB%98%E7%BA%A7/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/",
            "title": "RabbitMQéƒ¨ç½²æŒ‡å—-é›†ç¾¤éƒ¨ç½²",
            "date_published": "2024-01-06T02:39:34.999Z",
            "content_html": "<h1 id=\"rabbitmqéƒ¨ç½²æŒ‡å—\"><a class=\"anchor\" href=\"#rabbitmqéƒ¨ç½²æŒ‡å—\">#</a> RabbitMQ éƒ¨ç½²æŒ‡å—</h1>\n<h1 id=\"1å•æœºéƒ¨ç½²\"><a class=\"anchor\" href=\"#1å•æœºéƒ¨ç½²\">#</a> 1. å•æœºéƒ¨ç½²</h1>\n<p>æˆ‘ä»¬åœ¨ Centos7 è™šæ‹Ÿæœºä¸­ä½¿ç”¨ Docker æ¥å®‰è£…ã€‚</p>\n<h2 id=\"11ä¸‹è½½é•œåƒ\"><a class=\"anchor\" href=\"#11ä¸‹è½½é•œåƒ\">#</a> 1.1. ä¸‹è½½é•œåƒ</h2>\n<p>æ–¹å¼ä¸€ï¼šåœ¨çº¿æ‹‰å–</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> pull rabbitmq:3.8-management</pre></td></tr></table></figure><p>æ–¹å¼äºŒï¼šä»æœ¬åœ°åŠ è½½</p>\n<p>åœ¨è¯¾å‰èµ„æ–™å·²ç»æä¾›äº†é•œåƒåŒ…ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221138546.png\" alt=\"image-20210423191210349\" /></p>\n<p>ä¸Šä¼ åˆ°è™šæ‹Ÿæœºä¸­åï¼Œä½¿ç”¨å‘½ä»¤åŠ è½½é•œåƒå³å¯ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> load <span class=\"token parameter variable\">-i</span> mq.tar</pre></td></tr></table></figure><h2 id=\"12å®‰è£…mq\"><a class=\"anchor\" href=\"#12å®‰è£…mq\">#</a> 1.2. å®‰è£… MQ</h2>\n<p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥è¿è¡Œ MQ å®¹å™¨ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_USER</span><span class=\"token operator\">=</span>itcast <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_PASS</span><span class=\"token operator\">=</span><span class=\"token number\">123321</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> <span class=\"token parameter variable\">-v</span> mq-plugins:/plugins <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token parameter variable\">--name</span> mq <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> <span class=\"token parameter variable\">--hostname</span> mq1 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token parameter variable\">-p</span> <span class=\"token number\">15672</span>:15672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> <span class=\"token parameter variable\">-p</span> <span class=\"token number\">5672</span>:5672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre> <span class=\"token parameter variable\">-d</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> rabbitmq:3.8-management</pre></td></tr></table></figure><h1 id=\"2å®‰è£…delayexchangeæ’ä»¶\"><a class=\"anchor\" href=\"#2å®‰è£…delayexchangeæ’ä»¶\">#</a> 2. å®‰è£… DelayExchange æ’ä»¶</h1>\n<p>æˆ‘ä»¬è¦ä½¿ç”¨çš„æ˜¯å»¶è¿Ÿé˜Ÿåˆ—ä½†æ˜¯åå­—å´æ˜¯å»¶è¿Ÿäº¤æ¢æœºï¼Œä¸ºä»€ä¹ˆå«è¿™ä¸ªåå­—å‘¢ç®€å•è¯´ä¸‹å®ƒçš„åŸç†ï¼š</p>\n<p>æˆ‘ä»¬åœ¨ä½¿ç”¨è¿™ä¸ªæ’ä»¶çš„æ—¶å€™å®ƒä¸æ˜¯åŸºäºé˜Ÿåˆ—å»åšçš„è€Œæ˜¯äº¤æ¢æœºã€‚æˆ‘ä»¬å‘æ¶ˆæ¯åˆ°äº¤æ¢æœºï¼Œè€Œäº¤æ¢æœºä¼šå¸®ä½ å»¶è¿Ÿçš„æŠ•é€’åˆ°é˜Ÿåˆ—é‡Œ</p>\n<p>å®˜æ–¹çš„å®‰è£…æŒ‡å—åœ°å€ä¸ºï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnJhYmJpdG1xLmNvbS9wb3N0cy8yMDE1LzA0L3NjaGVkdWxpbmctbWVzc2FnZXMtd2l0aC1yYWJiaXRtcQ==\">https://blog.rabbitmq.com/posts/2015/04/scheduling-messages-with-rabbitmq</span></p>\n<p>ä¸Šè¿°æ–‡æ¡£æ˜¯åŸºäº linux åŸç”Ÿå®‰è£… RabbitMQï¼Œç„¶åå®‰è£…æ’ä»¶ã€‚</p>\n<p>å› ä¸ºæˆ‘ä»¬ä¹‹å‰æ˜¯åŸºäº Docker å®‰è£… RabbitMQï¼Œæ‰€ä»¥ä¸‹é¢æˆ‘ä»¬ä¼šè®²è§£åŸºäº Docker æ¥å®‰è£… RabbitMQ æ’ä»¶ã€‚</p>\n<h2 id=\"21ä¸‹è½½æ’ä»¶\"><a class=\"anchor\" href=\"#21ä¸‹è½½æ’ä»¶\">#</a> 2.1. ä¸‹è½½æ’ä»¶</h2>\n<p>RabbitMQ æœ‰ä¸€ä¸ªå®˜æ–¹çš„æ’ä»¶ç¤¾åŒºï¼Œåœ°å€ä¸ºï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmFiYml0bXEuY29tL2NvbW11bml0eS1wbHVnaW5zLmh0bWw=\">https://www.rabbitmq.com/community-plugins.html</span></p>\n<p>å…¶ä¸­åŒ…å«å„ç§å„æ ·çš„æ’ä»¶ï¼ŒåŒ…æ‹¬æˆ‘ä»¬è¦ä½¿ç”¨çš„ DelayExchange æ’ä»¶ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221139975.png\" alt=\"image-20210713104511055\" /></p>\n<p>å¤§å®¶å¯ä»¥å»å¯¹åº”çš„ GitHub é¡µé¢ä¸‹è½½ 3.8.9 ç‰ˆæœ¬çš„æ’ä»¶ï¼Œåœ°å€ä¸º https://github.com/rabbitmq/rabbitmq-delayed-message-exchange/releases/tag/3.8.9 è¿™ä¸ªå¯¹åº” RabbitMQ çš„ 3.8.5 ä»¥ä¸Šç‰ˆæœ¬ã€‚</p>\n<p>è¯¾å‰èµ„æ–™ä¹Ÿæä¾›äº†ä¸‹è½½å¥½çš„æ’ä»¶ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221139733.png\" alt=\"image-20210713104808909\" /></p>\n<h2 id=\"22ä¸Šä¼ æ’ä»¶\"><a class=\"anchor\" href=\"#22ä¸Šä¼ æ’ä»¶\">#</a> 2.2. ä¸Šä¼ æ’ä»¶</h2>\n<p>å› ä¸ºæˆ‘ä»¬æ˜¯åŸºäº Docker å®‰è£…ï¼Œæ‰€ä»¥éœ€è¦å…ˆæŸ¥çœ‹ RabbitMQ çš„æ’ä»¶ç›®å½•å¯¹åº”çš„æ•°æ®å·ã€‚å¦‚æœä¸æ˜¯åŸºäº Docker çš„åŒå­¦ï¼Œè¯·å‚è€ƒç¬¬ä¸€ç« éƒ¨åˆ†ï¼Œé‡æ–°åˆ›å»º Docker å®¹å™¨ã€‚</p>\n<p>æˆ‘ä»¬ä¹‹å‰è®¾å®šçš„ RabbitMQ çš„æ•°æ®å·åç§°ä¸º <code>mq-plugins</code> ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢å‘½ä»¤æŸ¥çœ‹æ•°æ®å·ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> volume inspect mq-plugins</pre></td></tr></table></figure><p>å¯ä»¥å¾—åˆ°ä¸‹é¢ç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221139695.png\" alt=\"image-20210713105135701\" /></p>\n<p>æ¥ä¸‹æ¥ï¼Œå°†æ’ä»¶ä¸Šä¼ åˆ°è¿™ä¸ªç›®å½•å³å¯ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221139638.png\" alt=\"image-20210713105339785\" /></p>\n<h2 id=\"23å®‰è£…æ’ä»¶\"><a class=\"anchor\" href=\"#23å®‰è£…æ’ä»¶\">#</a> 2.3. å®‰è£…æ’ä»¶</h2>\n<p>æœ€åå°±æ˜¯å®‰è£…äº†ï¼Œéœ€è¦è¿›å…¥ MQ å®¹å™¨å†…éƒ¨æ¥æ‰§è¡Œå®‰è£…ã€‚æˆ‘çš„å®¹å™¨åä¸º <code>mq</code> ï¼Œæ‰€ä»¥æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> mq <span class=\"token function\">bash</span></pre></td></tr></table></figure><p>æ‰§è¡Œæ—¶ï¼Œè¯·å°†å…¶ä¸­çš„  <code>-it</code>  åé¢çš„ <code>mq</code>  æ›¿æ¢ä¸ºä½ è‡ªå·±çš„å®¹å™¨å.</p>\n<p>è¿›å…¥å®¹å™¨å†…éƒ¨åï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤å¼€å¯æ’ä»¶ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmq-plugins <span class=\"token builtin class-name\">enable</span> rabbitmq_delayed_message_exchange</pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221139444.png\" alt=\"image-20210713105829435\" /></p>\n<p>è®¿é—® mq å‰ç«¯å£°æ˜ä¸€ä¸ªäº¤æ¢æœºè¿›è¡Œæµ‹è¯•ï¼š</p>\n<p>DelayExchange æ’ä»¶çš„åŸç†æ˜¯å¯¹å®˜æ–¹åŸç”Ÿçš„ Exchange åšäº†åŠŸèƒ½çš„å‡çº§ï¼š</p>\n<p>1ã€å°† DelayExchange æ¥å—çš„æ¶ˆæ¯æš‚å­˜åœ¨å†…å­˜ä¸­ (å®˜æ–¹çš„ Exchange æ˜¯æ— æ³•å­˜å‚¨æ¶ˆæ¯çš„)</p>\n<p>2ã€åœ¨ DelayExchange ä¸­è®¡æ—¶ï¼Œè¶…æ—¶åæ‰æŠ•é€’æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221553081.png\" alt=\"image-20231022155351657\" /></p>\n<p>å‘é€è¿™ä¸ªæ¶ˆæ¯çš„æ—¶å€™å»¶è¿Ÿå¤šä¹…éœ€è¦åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™è®¾ç½®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221557138.png\" alt=\"image-20231022155755822\" /></p>\n<h1 id=\"3é›†ç¾¤éƒ¨ç½²\"><a class=\"anchor\" href=\"#3é›†ç¾¤éƒ¨ç½²\">#</a> 3. é›†ç¾¤éƒ¨ç½²</h1>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å®‰è£… RabbitMQ çš„é›†ç¾¤ã€‚</p>\n<h2 id=\"21é›†ç¾¤åˆ†ç±»\"><a class=\"anchor\" href=\"#21é›†ç¾¤åˆ†ç±»\">#</a> 2.1. é›†ç¾¤åˆ†ç±»</h2>\n<p>åœ¨ RabbitMQ çš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œè®²è¿°äº†ä¸¤ç§é›†ç¾¤çš„é…ç½®æ–¹å¼ï¼š</p>\n<ul>\n<li>æ™®é€šæ¨¡å¼ï¼šæ™®é€šæ¨¡å¼é›†ç¾¤ä¸è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œæ¯ä¸ª MQ éƒ½æœ‰è‡ªå·±çš„é˜Ÿåˆ—ã€æ•°æ®ä¿¡æ¯ï¼ˆå…¶å®ƒå…ƒæ•°æ®ä¿¡æ¯å¦‚äº¤æ¢æœºç­‰ä¼šåŒæ­¥ï¼‰ã€‚ä¾‹å¦‚æˆ‘ä»¬æœ‰ 2 ä¸ª MQï¼šmq1ï¼Œå’Œ mq2ï¼Œå¦‚æœä½ çš„æ¶ˆæ¯åœ¨ mq1ï¼Œè€Œä½ è¿æ¥åˆ°äº† mq2ï¼Œé‚£ä¹ˆ mq2 ä¼šå» mq1 æ‹‰å–æ¶ˆæ¯ï¼Œç„¶åè¿”å›ç»™ä½ ã€‚å¦‚æœ mq1 å®•æœºï¼Œæ¶ˆæ¯å°±ä¼šä¸¢å¤±ã€‚</li>\n<li>é•œåƒæ¨¡å¼ï¼šä¸æ™®é€šæ¨¡å¼ä¸åŒï¼Œé˜Ÿåˆ—ä¼šåœ¨å„ä¸ª mq çš„é•œåƒèŠ‚ç‚¹ä¹‹é—´åŒæ­¥ï¼Œå› æ­¤ä½ è¿æ¥åˆ°ä»»ä½•ä¸€ä¸ªé•œåƒèŠ‚ç‚¹ï¼Œå‡å¯è·å–åˆ°æ¶ˆæ¯ã€‚è€Œä¸”å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œå¹¶ä¸ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ä¸è¿‡ï¼Œè¿™ç§æ–¹å¼å¢åŠ äº†æ•°æ®åŒæ­¥çš„å¸¦å®½æ¶ˆè€—ã€‚</li>\n</ul>\n<p>æˆ‘ä»¬å…ˆæ¥çœ‹æ™®é€šæ¨¡å¼é›†ç¾¤ï¼Œæˆ‘ä»¬çš„è®¡åˆ’éƒ¨ç½² 3 èŠ‚ç‚¹çš„ mq é›†ç¾¤ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>ä¸»æœºå</th>\n<th>æ§åˆ¶å°ç«¯å£</th>\n<th>amqp é€šä¿¡ç«¯å£</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>mq1</td>\n<td>8081 ---&gt; 15672</td>\n<td>8071 ---&gt; 5672</td>\n</tr>\n<tr>\n<td>mq2</td>\n<td>8082 ---&gt; 15672</td>\n<td>8072 ---&gt; 5672</td>\n</tr>\n<tr>\n<td>mq3</td>\n<td>8083 ---&gt; 15672</td>\n<td>8073  ---&gt; 5672</td>\n</tr>\n</tbody>\n</table>\n<p>é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ ‡ç¤ºé»˜è®¤éƒ½æ˜¯ï¼š <code>rabbit@[hostname]</code> ï¼Œå› æ­¤ä»¥ä¸Šä¸‰ä¸ªèŠ‚ç‚¹çš„åç§°åˆ†åˆ«ä¸ºï¼š</p>\n<ul>\n<li>rabbit@mq1</li>\n<li>rabbit@mq2</li>\n<li>rabbit@mq3</li>\n</ul>\n<h2 id=\"22è·å–cookie\"><a class=\"anchor\" href=\"#22è·å–cookie\">#</a> 2.2. è·å– cookie</h2>\n<p>RabbitMQ åº•å±‚ä¾èµ–äº Erlangï¼Œè€Œ Erlang è™šæ‹Ÿæœºå°±æ˜¯ä¸€ä¸ªé¢å‘åˆ†å¸ƒå¼çš„è¯­è¨€ï¼Œé»˜è®¤å°±æ”¯æŒé›†ç¾¤æ¨¡å¼ã€‚é›†ç¾¤æ¨¡å¼ä¸­çš„æ¯ä¸ª RabbitMQ èŠ‚ç‚¹ä½¿ç”¨ cookie æ¥ç¡®å®šå®ƒä»¬æ˜¯å¦è¢«å…è®¸ç›¸äº’é€šä¿¡ã€‚</p>\n<p>è¦ä½¿ä¸¤ä¸ªèŠ‚ç‚¹èƒ½å¤Ÿé€šä¿¡ï¼Œå®ƒä»¬å¿…é¡»å…·æœ‰ç›¸åŒçš„å…±äº«ç§˜å¯†ï¼Œç§°ä¸º<strong> Erlang cookie</strong>ã€‚cookie åªæ˜¯ä¸€ä¸²æœ€å¤š 255 ä¸ªå­—ç¬¦çš„å­—æ¯æ•°å­—å­—ç¬¦ã€‚</p>\n<p>æ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹å¿…é¡»å…·æœ‰<strong>ç›¸åŒçš„ cookie</strong>ã€‚å®ä¾‹ä¹‹é—´ä¹Ÿéœ€è¦å®ƒæ¥ç›¸äº’é€šä¿¡ã€‚</p>\n<p>æˆ‘ä»¬å…ˆåœ¨ä¹‹å‰å¯åŠ¨çš„ mq å®¹å™¨ä¸­è·å–ä¸€ä¸ª cookie å€¼ï¼Œä½œä¸ºé›†ç¾¤çš„ cookieã€‚æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> mq <span class=\"token function\">cat</span> /var/lib/rabbitmq/.erlang.cookie</pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° cookie å€¼å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>DVNQQPDKLNCMEPRBYEHX</pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œåœæ­¢å¹¶åˆ é™¤å½“å‰çš„ mq å®¹å™¨ï¼Œæˆ‘ä»¬é‡æ–°æ­å»ºé›†ç¾¤ã€‚</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token function\">rm</span> <span class=\"token parameter variable\">-f</span> mq</pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221139218.png\" alt=\"image-20210717212345165\" /></p>\n<h2 id=\"23å‡†å¤‡é›†ç¾¤é…ç½®\"><a class=\"anchor\" href=\"#23å‡†å¤‡é›†ç¾¤é…ç½®\">#</a> 2.3. å‡†å¤‡é›†ç¾¤é…ç½®</h2>\n<p>åœ¨ /tmp ç›®å½•æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ rabbitmq.confï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /tmp</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># åˆ›å»ºæ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">touch</span> rabbitmq.conf</pre></td></tr></table></figure><p>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>loopback_users.guest = false</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>listeners.tcp.default = 5672</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>cluster_formation.peer_discovery_backend = rabbit_peer_discovery_classic_config</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>cluster_formation.classic_config.nodes.1 = rabbit@mq1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>cluster_formation.classic_config.nodes.2 = rabbit@mq2</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>cluster_formation.classic_config.nodes.3 = rabbit@mq3</pre></td></tr></table></figure><p>å†åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œè®°å½• cookie</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /tmp</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># åˆ›å»º cookie æ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">touch</span> .erlang.cookie</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># å†™å…¥ cookie</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"FXZMCVGLBIXZCDEMMVZQ\"</span> <span class=\"token operator\">></span> .erlang.cookie</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># ä¿®æ”¹ cookie æ–‡ä»¶çš„æƒé™</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">chmod</span> <span class=\"token number\">600</span> .erlang.cookie</pre></td></tr></table></figure><p>å‡†å¤‡ä¸‰ä¸ªç›®å½•ï¼Œmq1ã€mq2ã€mq3ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /tmp</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># åˆ›å»ºç›®å½•</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">mkdir</span> mq1 mq2 mq3</pre></td></tr></table></figure><p>ç„¶åæ‹·è´ rabbitmq.confã€cookie æ–‡ä»¶åˆ° mq1ã€mq2ã€mq3ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># è¿›å…¥ /tmp</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /tmp</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># æ‹·è´</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">cp</span> rabbitmq.conf mq1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">cp</span> rabbitmq.conf mq2</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">cp</span> rabbitmq.conf mq3</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">cp</span> .erlang.cookie mq1</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">cp</span> .erlang.cookie mq2</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">cp</span> .erlang.cookie mq3</pre></td></tr></table></figure><h2 id=\"24å¯åŠ¨é›†ç¾¤\"><a class=\"anchor\" href=\"#24å¯åŠ¨é›†ç¾¤\">#</a> 2.4. å¯åŠ¨é›†ç¾¤</h2>\n<p>åˆ›å»ºä¸€ä¸ªç½‘ç»œï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> network create mq-net</pre></td></tr></table></figure><p>è¿è¡Œå‘½ä»¤</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--net</span> mq-net <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token parameter variable\">-v</span> <span class=\"token variable\">$&#123;<span class=\"token environment constant\">PWD</span>&#125;</span>/mq1/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token parameter variable\">-v</span> <span class=\"token variable\">$&#123;<span class=\"token environment constant\">PWD</span>&#125;</span>/.erlang.cookie:/var/lib/rabbitmq/.erlang.cookie <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_USER</span><span class=\"token operator\">=</span>itcast <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_PASS</span><span class=\"token operator\">=</span><span class=\"token number\">123321</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token parameter variable\">--name</span> mq1 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token parameter variable\">--hostname</span> mq1 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token parameter variable\">-p</span> <span class=\"token number\">8071</span>:5672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token parameter variable\">-p</span> <span class=\"token number\">8081</span>:15672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>rabbitmq:3.8-management</pre></td></tr></table></figure><figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--net</span> mq-net <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token parameter variable\">-v</span> <span class=\"token variable\">$&#123;<span class=\"token environment constant\">PWD</span>&#125;</span>/mq2/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token parameter variable\">-v</span> <span class=\"token variable\">$&#123;<span class=\"token environment constant\">PWD</span>&#125;</span>/.erlang.cookie:/var/lib/rabbitmq/.erlang.cookie <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_USER</span><span class=\"token operator\">=</span>itcast <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_PASS</span><span class=\"token operator\">=</span><span class=\"token number\">123321</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token parameter variable\">--name</span> mq2 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token parameter variable\">--hostname</span> mq2 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token parameter variable\">-p</span> <span class=\"token number\">8072</span>:5672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token parameter variable\">-p</span> <span class=\"token number\">8082</span>:15672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>rabbitmq:3.8-management</pre></td></tr></table></figure><figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--net</span> mq-net <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token parameter variable\">-v</span> <span class=\"token variable\">$&#123;<span class=\"token environment constant\">PWD</span>&#125;</span>/mq3/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token parameter variable\">-v</span> <span class=\"token variable\">$&#123;<span class=\"token environment constant\">PWD</span>&#125;</span>/.erlang.cookie:/var/lib/rabbitmq/.erlang.cookie <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_USER</span><span class=\"token operator\">=</span>itcast <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_PASS</span><span class=\"token operator\">=</span><span class=\"token number\">123321</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token parameter variable\">--name</span> mq3 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token parameter variable\">--hostname</span> mq3 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token parameter variable\">-p</span> <span class=\"token number\">8073</span>:5672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token parameter variable\">-p</span> <span class=\"token number\">8083</span>:15672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>rabbitmq:3.8-management</pre></td></tr></table></figure><h2 id=\"25æµ‹è¯•\"><a class=\"anchor\" href=\"#25æµ‹è¯•\">#</a> 2.5. æµ‹è¯•</h2>\n<p>åœ¨ mq1 è¿™ä¸ªèŠ‚ç‚¹ä¸Šæ·»åŠ ä¸€ä¸ªé˜Ÿåˆ—ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221139410.png\" alt=\"image-20210717222833196\" /></p>\n<p>å¦‚å›¾ï¼Œåœ¨ mq2 å’Œ mq3 ä¸¤ä¸ªæ§åˆ¶å°ä¹Ÿéƒ½èƒ½çœ‹åˆ°ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221139214.png\" alt=\"image-20210717223057902\" /></p>\n<h3 id=\"251æ•°æ®å…±äº«æµ‹è¯•\"><a class=\"anchor\" href=\"#251æ•°æ®å…±äº«æµ‹è¯•\">#</a> 2.5.1. æ•°æ®å…±äº«æµ‹è¯•</h3>\n<p>ç‚¹å‡»è¿™ä¸ªé˜Ÿåˆ—ï¼Œè¿›å…¥ç®¡ç†é¡µé¢ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221139412.png\" alt=\"image-20210717223421750\" /></p>\n<p>ç„¶ååˆ©ç”¨æ§åˆ¶å°å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°è¿™ä¸ªé˜Ÿåˆ—ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140585.png\" alt=\"image-20210717223320238\" /></p>\n<p>ç»“æœåœ¨ mq2ã€mq3 ä¸Šéƒ½èƒ½çœ‹åˆ°è¿™æ¡æ¶ˆæ¯ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140067.png\" alt=\"image-20210717223603628\" /></p>\n<h3 id=\"252å¯ç”¨æ€§æµ‹è¯•\"><a class=\"anchor\" href=\"#252å¯ç”¨æ€§æµ‹è¯•\">#</a> 2.5.2. å¯ç”¨æ€§æµ‹è¯•</h3>\n<p>æˆ‘ä»¬è®©å…¶ä¸­ä¸€å°èŠ‚ç‚¹ mq1 å®•æœºï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> stop mq1</pre></td></tr></table></figure><p>ç„¶åç™»å½• mq2 æˆ– mq3 çš„æ§åˆ¶å°ï¼Œå‘ç° simple.queue ä¹Ÿä¸å¯ç”¨äº†ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140781.png\" alt=\"image-20210717223800203\" /></p>\n<p>è¯´æ˜æ•°æ®å¹¶æ²¡æœ‰æ‹·è´åˆ° mq2 å’Œ mq3ã€‚</p>\n<h1 id=\"4é•œåƒæ¨¡å¼\"><a class=\"anchor\" href=\"#4é•œåƒæ¨¡å¼\">#</a> 4. é•œåƒæ¨¡å¼</h1>\n<p>åœ¨åˆšåˆšçš„æ¡ˆä¾‹ä¸­ï¼Œä¸€æ—¦åˆ›å»ºé˜Ÿåˆ—çš„ä¸»æœºå®•æœºï¼Œé˜Ÿåˆ—å°±ä¼šä¸å¯ç”¨ã€‚ä¸å…·å¤‡é«˜å¯ç”¨èƒ½åŠ›ã€‚å¦‚æœè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¿…é¡»ä½¿ç”¨å®˜æ–¹æä¾›çš„é•œåƒé›†ç¾¤æ–¹æ¡ˆã€‚</p>\n<p>å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmFiYml0bXEuY29tL2hhLmh0bWw=\">https://www.rabbitmq.com/ha.html</span></p>\n<h2 id=\"41é•œåƒæ¨¡å¼çš„ç‰¹å¾\"><a class=\"anchor\" href=\"#41é•œåƒæ¨¡å¼çš„ç‰¹å¾\">#</a> 4.1. é•œåƒæ¨¡å¼çš„ç‰¹å¾</h2>\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé˜Ÿåˆ—åªä¿å­˜åœ¨åˆ›å»ºè¯¥é˜Ÿåˆ—çš„èŠ‚ç‚¹ä¸Šã€‚è€Œé•œåƒæ¨¡å¼ä¸‹ï¼Œåˆ›å»ºé˜Ÿåˆ—çš„èŠ‚ç‚¹è¢«ç§°ä¸ºè¯¥é˜Ÿåˆ—çš„<strong>ä¸»èŠ‚ç‚¹</strong>ï¼Œé˜Ÿåˆ—è¿˜ä¼šæ‹·è´åˆ°é›†ç¾¤ä¸­çš„å…¶å®ƒèŠ‚ç‚¹ï¼Œä¹Ÿå«åšè¯¥é˜Ÿåˆ—çš„<strong>é•œåƒ</strong>èŠ‚ç‚¹ã€‚</p>\n<p>ä½†æ˜¯ï¼Œä¸åŒé˜Ÿåˆ—å¯ä»¥åœ¨é›†ç¾¤ä¸­çš„ä»»æ„èŠ‚ç‚¹ä¸Šåˆ›å»ºï¼Œå› æ­¤ä¸åŒé˜Ÿåˆ—çš„ä¸»èŠ‚ç‚¹å¯ä»¥ä¸åŒã€‚ç”šè‡³ï¼Œ<strong>ä¸€ä¸ªé˜Ÿåˆ—çš„ä¸»èŠ‚ç‚¹å¯èƒ½æ˜¯å¦ä¸€ä¸ªé˜Ÿåˆ—çš„é•œåƒèŠ‚ç‚¹</strong>ã€‚</p>\n<p>ç”¨æˆ·å‘é€ç»™é˜Ÿåˆ—çš„ä¸€åˆ‡è¯·æ±‚ï¼Œä¾‹å¦‚å‘é€æ¶ˆæ¯ã€æ¶ˆæ¯å›æ‰§é»˜è®¤éƒ½ä¼šåœ¨ä¸»èŠ‚ç‚¹å®Œæˆï¼Œå¦‚æœæ˜¯ä»èŠ‚ç‚¹æ¥æ”¶åˆ°è¯·æ±‚ï¼Œä¹Ÿä¼šè·¯ç”±åˆ°ä¸»èŠ‚ç‚¹å»å®Œæˆã€‚<strong>é•œåƒèŠ‚ç‚¹ä»…ä»…èµ·åˆ°å¤‡ä»½æ•°æ®ä½œç”¨</strong>ã€‚</p>\n<p>å½“ä¸»èŠ‚ç‚¹æ¥æ”¶åˆ°æ¶ˆè´¹è€…çš„ ACK æ—¶ï¼Œæ‰€æœ‰é•œåƒéƒ½ä¼šåˆ é™¤èŠ‚ç‚¹ä¸­çš„æ•°æ®ã€‚</p>\n<p>æ€»ç»“å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>é•œåƒé˜Ÿåˆ—ç»“æ„æ˜¯ä¸€ä¸»å¤šä»ï¼ˆä»å°±æ˜¯é•œåƒï¼‰</li>\n<li>æ‰€æœ‰æ“ä½œéƒ½æ˜¯ä¸»èŠ‚ç‚¹å®Œæˆï¼Œç„¶ååŒæ­¥ç»™é•œåƒèŠ‚ç‚¹</li>\n<li>ä¸»å®•æœºåï¼Œé•œåƒèŠ‚ç‚¹ä¼šæ›¿ä»£æˆæ–°çš„ä¸»ï¼ˆå¦‚æœåœ¨ä¸»ä»åŒæ­¥å®Œæˆå‰ï¼Œä¸»å°±å·²ç»å®•æœºï¼Œå¯èƒ½å‡ºç°æ•°æ®ä¸¢å¤±ï¼‰</li>\n<li>ä¸å…·å¤‡è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œå› ä¸ºæ‰€æœ‰æ“ä½œéƒ½ä¼šæœ‰ä¸»èŠ‚ç‚¹å®Œæˆï¼ˆä½†æ˜¯ä¸åŒé˜Ÿåˆ—ï¼Œå…¶ä¸»èŠ‚ç‚¹å¯ä»¥ä¸åŒï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªæé«˜ååé‡ï¼‰</li>\n</ul>\n<h2 id=\"42é•œåƒæ¨¡å¼çš„é…ç½®\"><a class=\"anchor\" href=\"#42é•œåƒæ¨¡å¼çš„é…ç½®\">#</a> 4.2. é•œåƒæ¨¡å¼çš„é…ç½®</h2>\n<p>é•œåƒæ¨¡å¼çš„é…ç½®æœ‰ 3 ç§æ¨¡å¼ï¼š</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">ha-mode</th>\n<th style=\"text-align:left\">ha-params</th>\n<th style=\"text-align:left\">æ•ˆæœ</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">å‡†ç¡®æ¨¡å¼ exactly</td>\n<td style=\"text-align:left\">é˜Ÿåˆ—çš„å‰¯æœ¬é‡ count</td>\n<td style=\"text-align:left\">é›†ç¾¤ä¸­é˜Ÿåˆ—å‰¯æœ¬ï¼ˆä¸»æœåŠ¡å™¨å’Œé•œåƒæœåŠ¡å™¨ä¹‹å’Œï¼‰çš„æ•°é‡ã€‚count å¦‚æœä¸º 1 æ„å‘³ç€å•ä¸ªå‰¯æœ¬ï¼šå³é˜Ÿåˆ—ä¸»èŠ‚ç‚¹ã€‚count å€¼ä¸º 2 è¡¨ç¤º 2 ä¸ªå‰¯æœ¬ï¼š1 ä¸ªé˜Ÿåˆ—ä¸»å’Œ 1 ä¸ªé˜Ÿåˆ—é•œåƒã€‚æ¢å¥è¯è¯´ï¼šcount = é•œåƒæ•°é‡ + 1ã€‚å¦‚æœç¾¤é›†ä¸­çš„èŠ‚ç‚¹æ•°å°‘äº countï¼Œåˆ™è¯¥é˜Ÿåˆ—å°†é•œåƒåˆ°æ‰€æœ‰èŠ‚ç‚¹ã€‚å¦‚æœæœ‰é›†ç¾¤æ€»æ•°å¤§äº count+1ï¼Œå¹¶ä¸”åŒ…å«é•œåƒçš„èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œåˆ™å°†åœ¨å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">all</td>\n<td style=\"text-align:left\">(none)</td>\n<td style=\"text-align:left\">é˜Ÿåˆ—åœ¨ç¾¤é›†ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œé•œåƒã€‚é˜Ÿåˆ—å°†é•œåƒåˆ°ä»»ä½•æ–°åŠ å…¥çš„èŠ‚ç‚¹ã€‚é•œåƒåˆ°æ‰€æœ‰èŠ‚ç‚¹å°†å¯¹æ‰€æœ‰ç¾¤é›†èŠ‚ç‚¹æ–½åŠ é¢å¤–çš„å‹åŠ›ï¼ŒåŒ…æ‹¬ç½‘ç»œ I / Oï¼Œç£ç›˜ I / O å’Œç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µã€‚æ¨èä½¿ç”¨ exactlyï¼Œè®¾ç½®å‰¯æœ¬æ•°ä¸ºï¼ˆN / 2 +1ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">nodes</td>\n<td style=\"text-align:left\"><em>node names</em></td>\n<td style=\"text-align:left\">æŒ‡å®šé˜Ÿåˆ—åˆ›å»ºåˆ°å“ªäº›èŠ‚ç‚¹ï¼Œå¦‚æœæŒ‡å®šçš„èŠ‚ç‚¹å…¨éƒ¨ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå‡ºç°å¼‚å¸¸ã€‚å¦‚æœæŒ‡å®šçš„èŠ‚ç‚¹åœ¨é›†ç¾¤ä¸­å­˜åœ¨ï¼Œä½†æ˜¯æš‚æ—¶ä¸å¯ç”¨ï¼Œä¼šåˆ›å»ºèŠ‚ç‚¹åˆ°å½“å‰å®¢æˆ·ç«¯è¿æ¥åˆ°çš„èŠ‚ç‚¹ã€‚</td>\n</tr>\n</tbody>\n</table>\n<p>è¿™é‡Œæˆ‘ä»¬ä»¥ rabbitmqctl å‘½ä»¤ä½œä¸ºæ¡ˆä¾‹æ¥è®²è§£é…ç½®è¯­æ³•ã€‚</p>\n<p>è¯­æ³•ç¤ºä¾‹ï¼š</p>\n<h3 id=\"421exactlyæ¨¡å¼\"><a class=\"anchor\" href=\"#421exactlyæ¨¡å¼\">#</a> 4.2.1.exactly æ¨¡å¼</h3>\n<pre><code>rabbitmqctl set_policy ha-two &quot;^two\\.&quot; '&#123;&quot;ha-mode&quot;:&quot;exactly&quot;,&quot;ha-params&quot;:2,&quot;ha-sync-mode&quot;:&quot;automatic&quot;&#125;'\n</code></pre>\n<ul>\n<li><code>rabbitmqctl set_policy</code> ï¼šå›ºå®šå†™æ³•</li>\n<li><code>ha-two</code> ï¼šç­–ç•¥åç§°ï¼Œè‡ªå®šä¹‰</li>\n<li><code>&quot;^two\\.&quot;</code> ï¼šåŒ¹é…é˜Ÿåˆ—çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œç¬¦åˆå‘½åè§„åˆ™çš„é˜Ÿåˆ—æ‰ç”Ÿæ•ˆï¼Œè¿™é‡Œæ˜¯ä»»ä½•ä»¥ <code>two.</code>  å¼€å¤´çš„é˜Ÿåˆ—åç§°</li>\n<li><code>'&#123;&quot;ha-mode&quot;:&quot;exactly&quot;,&quot;ha-params&quot;:2,&quot;ha-sync-mode&quot;:&quot;automatic&quot;&#125;'</code> : ç­–ç•¥å†…å®¹\n<ul>\n<li><code>&quot;ha-mode&quot;:&quot;exactly&quot;</code> ï¼šç­–ç•¥æ¨¡å¼ï¼Œæ­¤å¤„æ˜¯ exactly æ¨¡å¼ï¼ŒæŒ‡å®šå‰¯æœ¬æ•°é‡</li>\n<li><code>&quot;ha-params&quot;:2</code> ï¼šç­–ç•¥å‚æ•°ï¼Œè¿™é‡Œæ˜¯ 2ï¼Œå°±æ˜¯å‰¯æœ¬æ•°é‡ä¸º 2ï¼Œ1 ä¸» 1 é•œåƒ</li>\n<li><code>&quot;ha-sync-mode&quot;:&quot;automatic&quot;</code> ï¼šåŒæ­¥ç­–ç•¥ï¼Œé»˜è®¤æ˜¯ manualï¼Œå³æ–°åŠ å…¥çš„é•œåƒèŠ‚ç‚¹ä¸ä¼šåŒæ­¥æ—§çš„æ¶ˆæ¯ã€‚å¦‚æœè®¾ç½®ä¸º automaticï¼Œåˆ™æ–°åŠ å…¥çš„é•œåƒèŠ‚ç‚¹ä¼šæŠŠä¸»èŠ‚ç‚¹ä¸­æ‰€æœ‰æ¶ˆæ¯éƒ½åŒæ­¥ï¼Œä¼šå¸¦æ¥é¢å¤–çš„ç½‘ç»œå¼€é”€</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"422allæ¨¡å¼\"><a class=\"anchor\" href=\"#422allæ¨¡å¼\">#</a> 4.2.2.all æ¨¡å¼</h3>\n<pre><code>rabbitmqctl set_policy ha-all &quot;^all\\.&quot; '&#123;&quot;ha-mode&quot;:&quot;all&quot;&#125;'\n</code></pre>\n<ul>\n<li><code>ha-all</code> ï¼šç­–ç•¥åç§°ï¼Œè‡ªå®šä¹‰</li>\n<li><code>&quot;^all\\.&quot;</code> ï¼šåŒ¹é…æ‰€æœ‰ä»¥ <code>all.</code>  å¼€å¤´çš„é˜Ÿåˆ—å</li>\n<li><code>'&#123;&quot;ha-mode&quot;:&quot;all&quot;&#125;'</code> ï¼šç­–ç•¥å†…å®¹\n<ul>\n<li><code>&quot;ha-mode&quot;:&quot;all&quot;</code> ï¼šç­–ç•¥æ¨¡å¼ï¼Œæ­¤å¤„æ˜¯ all æ¨¡å¼ï¼Œå³æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šç§°ä¸ºé•œåƒèŠ‚ç‚¹</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"423nodesæ¨¡å¼\"><a class=\"anchor\" href=\"#423nodesæ¨¡å¼\">#</a> 4.2.3.nodes æ¨¡å¼</h3>\n<pre><code>rabbitmqctl set_policy ha-nodes &quot;^nodes\\.&quot; '&#123;&quot;ha-mode&quot;:&quot;nodes&quot;,&quot;ha-params&quot;:[&quot;rabbit@nodeA&quot;, &quot;rabbit@nodeB&quot;]&#125;'\n</code></pre>\n<ul>\n<li><code>rabbitmqctl set_policy</code> ï¼šå›ºå®šå†™æ³•</li>\n<li><code>ha-nodes</code> ï¼šç­–ç•¥åç§°ï¼Œè‡ªå®šä¹‰</li>\n<li><code>&quot;^nodes\\.&quot;</code> ï¼šåŒ¹é…é˜Ÿåˆ—çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œç¬¦åˆå‘½åè§„åˆ™çš„é˜Ÿåˆ—æ‰ç”Ÿæ•ˆï¼Œè¿™é‡Œæ˜¯ä»»ä½•ä»¥ <code>nodes.</code>  å¼€å¤´çš„é˜Ÿåˆ—åç§°</li>\n<li><code>'&#123;&quot;ha-mode&quot;:&quot;nodes&quot;,&quot;ha-params&quot;:[&quot;rabbit@nodeA&quot;, &quot;rabbit@nodeB&quot;]&#125;'</code> : ç­–ç•¥å†…å®¹\n<ul>\n<li><code>&quot;ha-mode&quot;:&quot;nodes&quot;</code> ï¼šç­–ç•¥æ¨¡å¼ï¼Œæ­¤å¤„æ˜¯ nodes æ¨¡å¼</li>\n<li><code>&quot;ha-params&quot;:[&quot;rabbit@mq1&quot;, &quot;rabbit@mq2&quot;]</code> ï¼šç­–ç•¥å‚æ•°ï¼Œè¿™é‡ŒæŒ‡å®šå‰¯æœ¬æ‰€åœ¨èŠ‚ç‚¹åç§°</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"43æµ‹è¯•\"><a class=\"anchor\" href=\"#43æµ‹è¯•\">#</a> 4.3. æµ‹è¯•</h2>\n<p>æˆ‘ä»¬ä½¿ç”¨ exactly æ¨¡å¼çš„é•œåƒï¼Œå› ä¸ºé›†ç¾¤èŠ‚ç‚¹æ•°é‡ä¸º 3ï¼Œå› æ­¤é•œåƒæ•°é‡å°±è®¾ç½®ä¸º 2.</p>\n<p>è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> mq1 rabbitmqctl set_policy ha-two <span class=\"token string\">\"^two\\.\"</span> <span class=\"token string\">'&#123;\"ha-mode\":\"exactly\",\"ha-params\":2,\"ha-sync-mode\":\"automatic\"&#125;'</span></pre></td></tr></table></figure><p>ä¸‹é¢ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„é˜Ÿåˆ—ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140154.png\" alt=\"image-20210717231751411\" /></p>\n<p>åœ¨ä»»æ„ä¸€ä¸ª mq æ§åˆ¶å°æŸ¥çœ‹é˜Ÿåˆ—ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140517.png\" alt=\"image-20210717231829505\" /></p>\n<h3 id=\"431æµ‹è¯•æ•°æ®å…±äº«\"><a class=\"anchor\" href=\"#431æµ‹è¯•æ•°æ®å…±äº«\">#</a> 4.3.1. æµ‹è¯•æ•°æ®å…±äº«</h3>\n<p>ç»™ two.queue å‘é€ä¸€æ¡æ¶ˆæ¯ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140429.png\" alt=\"image-20210717231958996\" /></p>\n<p>ç„¶ååœ¨ mq1ã€mq2ã€mq3 çš„ä»»æ„æ§åˆ¶å°æŸ¥çœ‹æ¶ˆæ¯ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140006.png\" alt=\"image-20210717232108584\" /></p>\n<h3 id=\"432æµ‹è¯•é«˜å¯ç”¨\"><a class=\"anchor\" href=\"#432æµ‹è¯•é«˜å¯ç”¨\">#</a> 4.3.2. æµ‹è¯•é«˜å¯ç”¨</h3>\n<p>ç°åœ¨ï¼Œæˆ‘ä»¬è®© two.queue çš„ä¸»èŠ‚ç‚¹ mq1 å®•æœºï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> stop mq1</pre></td></tr></table></figure><p>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140157.png\" alt=\"image-20210717232257420\" /></p>\n<p>æŸ¥çœ‹é˜Ÿåˆ—çŠ¶æ€ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140733.png\" alt=\"image-20210717232322646\" /></p>\n<p>å‘ç°ä¾ç„¶æ˜¯å¥åº·çš„ï¼å¹¶ä¸”å…¶ä¸»èŠ‚ç‚¹åˆ‡æ¢åˆ°äº† rabbit@mq2 ä¸Š</p>\n<h1 id=\"5ä»²è£é˜Ÿåˆ—\"><a class=\"anchor\" href=\"#5ä»²è£é˜Ÿåˆ—\">#</a> 5. ä»²è£é˜Ÿåˆ—</h1>\n<p>ä» RabbitMQ 3.8 ç‰ˆæœ¬å¼€å§‹ï¼Œå¼•å…¥äº†æ–°çš„ä»²è£é˜Ÿåˆ—ï¼Œä»–å…·å¤‡ä¸é•œåƒé˜Ÿé‡Œç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½†ä½¿ç”¨æ›´åŠ æ–¹ä¾¿ã€‚</p>\n<h2 id=\"51æ·»åŠ ä»²è£é˜Ÿåˆ—\"><a class=\"anchor\" href=\"#51æ·»åŠ ä»²è£é˜Ÿåˆ—\">#</a> 5.1. æ·»åŠ ä»²è£é˜Ÿåˆ—</h2>\n<p>åœ¨ä»»æ„æ§åˆ¶å°æ·»åŠ ä¸€ä¸ªé˜Ÿåˆ—ï¼Œä¸€å®šè¦é€‰æ‹©é˜Ÿåˆ—ç±»å‹ä¸º Quorum ç±»å‹ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140068.png\" alt=\"image-20210717234329640\" /></p>\n<p>åœ¨ä»»æ„æ§åˆ¶å°æŸ¥çœ‹é˜Ÿåˆ—ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140859.png\" alt=\"image-20210717234426209\" /></p>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œä»²è£é˜Ÿåˆ—çš„ + 2 å­—æ ·ã€‚ä»£è¡¨è¿™ä¸ªé˜Ÿåˆ—æœ‰ 2 ä¸ªé•œåƒèŠ‚ç‚¹ã€‚</p>\n<p>å› ä¸ºä»²è£é˜Ÿåˆ—é»˜è®¤çš„é•œåƒæ•°ä¸º 5ã€‚å¦‚æœä½ çš„é›†ç¾¤æœ‰ 7 ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆé•œåƒæ•°è‚¯å®šæ˜¯ 5ï¼›è€Œæˆ‘ä»¬é›†ç¾¤åªæœ‰ 3 ä¸ªèŠ‚ç‚¹ï¼Œå› æ­¤é•œåƒæ•°é‡å°±æ˜¯ 3.</p>\n<h2 id=\"52springamqpåˆ›å»ºä»²è½½é˜Ÿåˆ—\"><a class=\"anchor\" href=\"#52springamqpåˆ›å»ºä»²è½½é˜Ÿåˆ—\">#</a> 5.2.SpringAMQP åˆ›å»ºä»²è½½é˜Ÿåˆ—</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">QuorumConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">quorumQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">QueueBuilder</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">durable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"quorum.queue2\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// æŒä¹…åŒ–</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">quorum</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// ä»²è½½é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>SpringAMQP é“¾æ¥é›†ç¾¤ï¼Œåªéœ€è¦åœ¨ yml ä¸­é…ç½®å³å¯ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">rabbitmq</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">addresses</span><span class=\"token punctuation\">:</span> 192.168.249.128<span class=\"token punctuation\">:</span><span class=\"token number\">8071</span><span class=\"token punctuation\">,</span> 192.168.249.128<span class=\"token punctuation\">:</span><span class=\"token number\">8072</span><span class=\"token punctuation\">,</span> 192.168.249.128<span class=\"token punctuation\">:</span><span class=\"token number\">8073</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\"># port: 5672 # ç«¯å£</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> itcast</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123321</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">virtual-host</span><span class=\"token punctuation\">:</span> /</pre></td></tr></table></figure><h2 id=\"53æµ‹è¯•\"><a class=\"anchor\" href=\"#53æµ‹è¯•\">#</a> 5.3. æµ‹è¯•</h2>\n<p>å¯ä»¥å‚è€ƒå¯¹é•œåƒé›†ç¾¤çš„æµ‹è¯•ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p>\n<h2 id=\"53é›†ç¾¤æ‰©å®¹\"><a class=\"anchor\" href=\"#53é›†ç¾¤æ‰©å®¹\">#</a> 5.3. é›†ç¾¤æ‰©å®¹</h2>\n<h3 id=\"531åŠ å…¥é›†ç¾¤\"><a class=\"anchor\" href=\"#531åŠ å…¥é›†ç¾¤\">#</a> 5.3.1. åŠ å…¥é›†ç¾¤</h3>\n<p>1ï¼‰å¯åŠ¨ä¸€ä¸ªæ–°çš„ MQ å®¹å™¨ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--net</span> mq-net <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token parameter variable\">-v</span> <span class=\"token variable\">$&#123;<span class=\"token environment constant\">PWD</span>&#125;</span>/.erlang.cookie:/var/lib/rabbitmq/.erlang.cookie <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_USER</span><span class=\"token operator\">=</span>itcast <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_PASS</span><span class=\"token operator\">=</span><span class=\"token number\">123321</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token parameter variable\">--name</span> mq4 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token parameter variable\">--hostname</span> mq5 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token parameter variable\">-p</span> <span class=\"token number\">8074</span>:15672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token parameter variable\">-p</span> <span class=\"token number\">8084</span>:15672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>rabbitmq:3.8-management</pre></td></tr></table></figure><p>2ï¼‰è¿›å…¥å®¹å™¨æ§åˆ¶å°ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> mq4 <span class=\"token function\">bash</span></pre></td></tr></table></figure><p>3ï¼‰åœæ­¢ mq è¿›ç¨‹</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmqctl stop_app</pre></td></tr></table></figure><p>4ï¼‰é‡ç½® RabbitMQ ä¸­çš„æ•°æ®ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmqctl reset</pre></td></tr></table></figure><p>5ï¼‰åŠ å…¥ mq1ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmqctl join_cluster rabbit@mq1</pre></td></tr></table></figure><p>6ï¼‰å†æ¬¡å¯åŠ¨ mq è¿›ç¨‹</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmqctl start_app</pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140463.png\" alt=\"image-20210718001909492\" /></p>\n<h3 id=\"532å¢åŠ ä»²è£é˜Ÿåˆ—å‰¯æœ¬\"><a class=\"anchor\" href=\"#532å¢åŠ ä»²è£é˜Ÿåˆ—å‰¯æœ¬\">#</a> 5.3.2. å¢åŠ ä»²è£é˜Ÿåˆ—å‰¯æœ¬</h3>\n<p>æˆ‘ä»¬å…ˆæŸ¥çœ‹ä¸‹ quorum.queue è¿™ä¸ªé˜Ÿåˆ—ç›®å‰çš„å‰¯æœ¬æƒ…å†µï¼Œè¿›å…¥ mq1 å®¹å™¨ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> mq1 <span class=\"token function\">bash</span></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmq-queues quorum_status <span class=\"token string\">\"quorum.queue\"</span></pre></td></tr></table></figure><p>ç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140047.png\" alt=\"image-20210718002118357\" /></p>\n<p>ç°åœ¨ï¼Œæˆ‘ä»¬è®© mq4 ä¹ŸåŠ å…¥è¿›æ¥ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmq-queues add_member <span class=\"token string\">\"quorum.queue\"</span> <span class=\"token string\">\"rabbit@mq4\"</span></pre></td></tr></table></figure><p>ç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140584.png\" alt=\"image-20210718002253226\" /></p>\n<p>å†æ¬¡æŸ¥çœ‹ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmq-queues quorum_status <span class=\"token string\">\"quorum.queue\"</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140083.png\" alt=\"image-20210718002342603\" /></p>\n<p>æŸ¥çœ‹æ§åˆ¶å°ï¼Œå‘ç° quorum.queue çš„é•œåƒæ•°é‡ä¹Ÿä»åŸæ¥çš„ +2 å˜æˆäº† +3ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140839.png\" alt=\"image-20210718002422365\" /></p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "RabbitMQ",
                "é«˜çº§",
                "è®¡ç®—æœºå­¦ç§‘",
                "é›†ç¾¤",
                "springcloud",
                "RabbitMQ",
                "éƒ¨ç½²"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/RabbitMQ/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/RabbitMQ/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/",
            "title": "RabbitMQéƒ¨ç½²æŒ‡å—-å•å‡»éƒ¨ç½²",
            "date_published": "2024-01-06T02:37:51.674Z",
            "content_html": "<h1 id=\"rabbitmqéƒ¨ç½²æŒ‡å—\"><a class=\"anchor\" href=\"#rabbitmqéƒ¨ç½²æŒ‡å—\">#</a> RabbitMQ éƒ¨ç½²æŒ‡å—</h1>\n<h1 id=\"1å•æœºéƒ¨ç½²\"><a class=\"anchor\" href=\"#1å•æœºéƒ¨ç½²\">#</a> 1. å•æœºéƒ¨ç½²</h1>\n<p>æˆ‘ä»¬åœ¨ Centos7 è™šæ‹Ÿæœºä¸­ä½¿ç”¨ Docker æ¥å®‰è£…ã€‚</p>\n<h2 id=\"11ä¸‹è½½é•œåƒ\"><a class=\"anchor\" href=\"#11ä¸‹è½½é•œåƒ\">#</a> 1.1. ä¸‹è½½é•œåƒ</h2>\n<p>æ–¹å¼ä¸€ï¼šåœ¨çº¿æ‹‰å–</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> pull rabbitmq:3-management</pre></td></tr></table></figure><p>æ–¹å¼äºŒï¼šä»æœ¬åœ°åŠ è½½</p>\n<p>åœ¨è¯¾å‰èµ„æ–™å·²ç»æä¾›äº†é•œåƒåŒ…ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310101608790.png\" alt=\"image-20210423191210349\" /></p>\n<p>ä¸Šä¼ åˆ°è™šæ‹Ÿæœºä¸­åï¼Œä½¿ç”¨å‘½ä»¤åŠ è½½é•œåƒå³å¯ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> load <span class=\"token parameter variable\">-i</span> mq.tar</pre></td></tr></table></figure><p>ä½¿ç”¨å‘½ä»¤æ¥æŸ¥çœ‹ä¸€ä¸‹</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker images</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>REPOSITORY                   TAG       IMAGE ID       CREATED         SIZE</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>rabbitmq                     latest    24cc95a2cb57   <span class=\"token number\">6</span> days ago      217MB</pre></td></tr></table></figure><h2 id=\"12å®‰è£…mq\"><a class=\"anchor\" href=\"#12å®‰è£…mq\">#</a> 1.2. å®‰è£… MQ</h2>\n<p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥è¿è¡Œ MQ å®¹å™¨ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_USER</span><span class=\"token operator\">=</span>itcast <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_PASS</span><span class=\"token operator\">=</span><span class=\"token number\">123321</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> <span class=\"token parameter variable\">--name</span> mq <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token parameter variable\">--hostname</span> mq1 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> <span class=\"token comment\"># ui ç®¡ç†å¹³å°çš„ç«¯å£å·</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token parameter variable\">-p</span> <span class=\"token number\">15672</span>:15672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> <span class=\"token comment\"># æ¶ˆæ¯é€šä¿¡çš„ç«¯å£å·</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre> <span class=\"token parameter variable\">-p</span> <span class=\"token number\">5672</span>:5672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token parameter variable\">-d</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> rabbitmq:3-management</pre></td></tr></table></figure><p>æŸ¥çœ‹å¯åŠ¨çŠ¶æ€</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker ps</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>CONTAINER ID   IMAGE                   COMMAND                  CREATED         STATUS         PORTS                                                                                                                                                 NAMES</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>5ca16a608743   rabbitmq:3-management   <span class=\"token string\">\"docker-entrypoint.sâ€¦\"</span>   <span class=\"token number\">2</span> minutes ago   Up <span class=\"token number\">2</span> minutes   <span class=\"token number\">4369</span>/tcp, <span class=\"token number\">5671</span>/tcp, <span class=\"token number\">0.0</span>.0.0:5672-<span class=\"token operator\">></span><span class=\"token number\">5672</span>/tcp, :::5672-<span class=\"token operator\">></span><span class=\"token number\">5672</span>/tcp, <span class=\"token number\">15671</span>/tcp, <span class=\"token number\">15691</span>-15692/tcp, <span class=\"token number\">25672</span>/tcp, <span class=\"token number\">0.0</span>.0.0:15672-<span class=\"token operator\">></span><span class=\"token number\">15672</span>/tcp, :::15672-<span class=\"token operator\">></span><span class=\"token number\">15672</span>/tcp   mq</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>æ§åˆ¶å°æ‰“å°äº†ç«¯å£ä¸ºï¼š15671ï¼Œåœ¨å¯åŠ¨å®¹å™¨æ—¶é…ç½®äº†è´¦å·ä¸ºï¼šitcastï¼Œå¯†ç ä¸ºï¼š123321</p>\n<p>è®¿é—® uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMjQ5LjEyODoxNTY3Mg==\">http://192.168.249.128:15672</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310101627722.png\" alt=\"image-20231010162721293\" /></p>\n<p><strong>é¡µé¢åŠŸèƒ½ä»‹ç»</strong>ï¼š</p>\n<blockquote>\n<p>Overviewï¼šæ€»è§ˆ</p>\n<p>ä½œç”¨ï¼šæŸ¥çœ‹èŠ‚ç‚¹çš„ä¸€äº›è¯¦ç»†ä¿¡æ¯</p>\n</blockquote>\n<blockquote>\n<p>Connectionsï¼šè¿æ¥</p>\n<p>æ— è®ºæ˜¯æ¶ˆæ¯å‘å¸ƒè€…è¿˜æ˜¯æ¶ˆæ¯æ¶ˆè´¹è€…éƒ½åº”è¯¥è·Ÿ mq å»ºç«‹è¿æ¥</p>\n</blockquote>\n<blockquote>\n<p>Channelsï¼šé€šé“</p>\n<p>å»ºç«‹è¿æ¥åä¸€å®šè¦åˆ›å»ºä¸€ä¸ªé€šé“ï¼Œå®Œåç”Ÿäº§è€… æˆ–è€…æ˜¯æ¶ˆè´¹è€…æ‰èƒ½åŸºäº Channel å®Œæˆæ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶</p>\n</blockquote>\n<blockquote>\n<p>Exchangesï¼šäº¤æ¢æœº</p>\n<p>æ˜¯æ¶ˆæ¯çš„è·¯ç”±</p>\n</blockquote>\n<blockquote>\n<p>Queuesï¼šé˜Ÿåˆ—</p>\n</blockquote>\n<blockquote>\n<p>Adminï¼šç”¨æˆ·ç®¡ç†</p>\n<ul>\n<li>Virtual Hostï¼šè™šæ‹Ÿæœºå¯ä»¥å¯¹æ¯ä¸ªç”¨æˆ·è¿›è¡Œä¸€ä¸ªéš”ç¦»é˜²æ­¢æ“ä½œå†²çª</li>\n</ul>\n</blockquote>\n<h1 id=\"2é›†ç¾¤éƒ¨ç½²\"><a class=\"anchor\" href=\"#2é›†ç¾¤éƒ¨ç½²\">#</a> 2. é›†ç¾¤éƒ¨ç½²</h1>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å®‰è£… RabbitMQ çš„é›†ç¾¤ã€‚</p>\n<h2 id=\"21é›†ç¾¤åˆ†ç±»\"><a class=\"anchor\" href=\"#21é›†ç¾¤åˆ†ç±»\">#</a> 2.1. é›†ç¾¤åˆ†ç±»</h2>\n<p>åœ¨ RabbitMQ çš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œè®²è¿°äº†ä¸¤ç§é›†ç¾¤çš„é…ç½®æ–¹å¼ï¼š</p>\n<ul>\n<li>æ™®é€šæ¨¡å¼ï¼šæ™®é€šæ¨¡å¼é›†ç¾¤ä¸è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œæ¯ä¸ª MQ éƒ½æœ‰è‡ªå·±çš„é˜Ÿåˆ—ã€æ•°æ®ä¿¡æ¯ï¼ˆå…¶å®ƒå…ƒæ•°æ®ä¿¡æ¯å¦‚äº¤æ¢æœºç­‰ä¼šåŒæ­¥ï¼‰ã€‚ä¾‹å¦‚æˆ‘ä»¬æœ‰ 2 ä¸ª MQï¼šmq1ï¼Œå’Œ mq2ï¼Œå¦‚æœä½ çš„æ¶ˆæ¯åœ¨ mq1ï¼Œè€Œä½ è¿æ¥åˆ°äº† mq2ï¼Œé‚£ä¹ˆ mq2 ä¼šå» mq1 æ‹‰å–æ¶ˆæ¯ï¼Œç„¶åè¿”å›ç»™ä½ ã€‚å¦‚æœ mq1 å®•æœºï¼Œæ¶ˆæ¯å°±ä¼šä¸¢å¤±ã€‚</li>\n<li>é•œåƒæ¨¡å¼ï¼šä¸æ™®é€šæ¨¡å¼ä¸åŒï¼Œé˜Ÿåˆ—ä¼šåœ¨å„ä¸ª mq çš„é•œåƒèŠ‚ç‚¹ä¹‹é—´åŒæ­¥ï¼Œå› æ­¤ä½ è¿æ¥åˆ°ä»»ä½•ä¸€ä¸ªé•œåƒèŠ‚ç‚¹ï¼Œå‡å¯è·å–åˆ°æ¶ˆæ¯ã€‚è€Œä¸”å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œå¹¶ä¸ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ä¸è¿‡ï¼Œè¿™ç§æ–¹å¼å¢åŠ äº†æ•°æ®åŒæ­¥çš„å¸¦å®½æ¶ˆè€—ã€‚</li>\n</ul>\n<p>æˆ‘ä»¬å…ˆæ¥çœ‹æ™®é€šæ¨¡å¼é›†ç¾¤ã€‚</p>\n<h2 id=\"22è®¾ç½®ç½‘ç»œ\"><a class=\"anchor\" href=\"#22è®¾ç½®ç½‘ç»œ\">#</a> 2.2. è®¾ç½®ç½‘ç»œ</h2>\n<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è®© 3 å° MQ äº’ç›¸çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ã€‚</p>\n<p>åˆ†åˆ«åœ¨ 3 å°æœºå™¨ä¸­ï¼Œè®¾ç½® /etc/hosts æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>\n<pre><code>192.168.150.101 mq1\n192.168.150.102 mq2\n192.168.150.103 mq3\n</code></pre>\n<p>å¹¶åœ¨æ¯å°æœºå™¨ä¸Šæµ‹è¯•ï¼Œæ˜¯å¦å¯ä»¥ ping é€šå¯¹æ–¹ï¼š</p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "RabbitMQ",
                "è®¡ç®—æœºå­¦ç§‘",
                "springcloud",
                "RabbitMQ",
                "éƒ¨ç½²"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Nacos/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Nacos/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/",
            "title": "Nacoså®‰è£…æŒ‡å—",
            "date_published": "2024-01-06T02:33:28.230Z",
            "content_html": "<h1 id=\"nacoså®‰è£…æŒ‡å—\"><a class=\"anchor\" href=\"#nacoså®‰è£…æŒ‡å—\">#</a> Nacos å®‰è£…æŒ‡å—</h1>\n<h1 id=\"1windowså®‰è£…\"><a class=\"anchor\" href=\"#1windowså®‰è£…\">#</a> 1.Windows å®‰è£…</h1>\n<p>å¼€å‘é˜¶æ®µé‡‡ç”¨å•æœºå®‰è£…å³å¯ã€‚</p>\n<h2 id=\"11ä¸‹è½½å®‰è£…åŒ…\"><a class=\"anchor\" href=\"#11ä¸‹è½½å®‰è£…åŒ…\">#</a> 1.1. ä¸‹è½½å®‰è£…åŒ…</h2>\n<p>åœ¨ Nacos çš„ GitHub é¡µé¢ï¼Œæä¾›æœ‰ä¸‹è½½é“¾æ¥ï¼Œå¯ä»¥ä¸‹è½½ç¼–è¯‘å¥½çš„ Nacos æœåŠ¡ç«¯æˆ–è€…æºä»£ç ï¼š</p>\n<p>GitHub ä¸»é¡µï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvbmFjb3M=\">https://github.com/alibaba/nacos</span></p>\n<p>GitHub çš„ Release ä¸‹è½½é¡µï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvbmFjb3MvcmVsZWFzZXM=\">https://github.com/alibaba/nacos/releases</span></p>\n<p>å¦‚å›¾ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218392.png\" alt=\"image-20210402161102887\" /></p>\n<p>æœ¬è¯¾ç¨‹é‡‡ç”¨ 1.4.1. ç‰ˆæœ¬çš„ Nacosï¼Œè¯¾å‰èµ„æ–™å·²ç»å‡†å¤‡äº†å®‰è£…åŒ…ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218840.png\" alt=\"image-20210402161130261\" /></p>\n<p>windows ç‰ˆæœ¬ä½¿ç”¨ <code>nacos-server-1.4.1.zip</code>  åŒ…å³å¯ã€‚</p>\n<h2 id=\"12è§£å‹\"><a class=\"anchor\" href=\"#12è§£å‹\">#</a> 1.2. è§£å‹</h2>\n<p>å°†è¿™ä¸ªåŒ…è§£å‹åˆ°ä»»æ„éä¸­æ–‡ç›®å½•ä¸‹ï¼Œå¦‚å›¾ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218669.png\" alt=\"image-20210402161843337\" /></p>\n<p>ç›®å½•è¯´æ˜ï¼š</p>\n<ul>\n<li>binï¼šå¯åŠ¨è„šæœ¬</li>\n<li>confï¼šé…ç½®æ–‡ä»¶</li>\n</ul>\n<h2 id=\"13ç«¯å£é…ç½®\"><a class=\"anchor\" href=\"#13ç«¯å£é…ç½®\">#</a> 1.3. ç«¯å£é…ç½®</h2>\n<p>Nacos çš„é»˜è®¤ç«¯å£æ˜¯ 8848ï¼Œå¦‚æœä½ ç”µè„‘ä¸Šçš„å…¶å®ƒè¿›ç¨‹å ç”¨äº† 8848 ç«¯å£ï¼Œè¯·å…ˆå°è¯•å…³é—­è¯¥è¿›ç¨‹ã€‚</p>\n<p><strong>å¦‚æœæ— æ³•å…³é—­å ç”¨ 8848 ç«¯å£çš„è¿›ç¨‹</strong>ï¼Œä¹Ÿå¯ä»¥è¿›å…¥ nacos çš„ conf ç›®å½•ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218946.png\" alt=\"image-20210402162008280\" /></p>\n<p>ä¿®æ”¹å…¶ä¸­çš„å†…å®¹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218758.png\" alt=\"image-20210402162251093\" /></p>\n<h2 id=\"14å¯åŠ¨\"><a class=\"anchor\" href=\"#14å¯åŠ¨\">#</a> 1.4. å¯åŠ¨</h2>\n<p>å¯åŠ¨éå¸¸ç®€å•ï¼Œè¿›å…¥ bin ç›®å½•ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218561.png\" alt=\"image-20210402162350977\" /></p>\n<p>ç„¶åæ‰§è¡Œå‘½ä»¤å³å¯ï¼š</p>\n<ul>\n<li>\n<p>windows å‘½ä»¤ï¼š</p>\n<pre><code>startup.cmd -m standalone\n</code></pre>\n</li>\n</ul>\n<p>æ‰§è¡Œåçš„æ•ˆæœå¦‚å›¾ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218179.png\" alt=\"image-20210402162526774\" /></p>\n<h2 id=\"15è®¿é—®\"><a class=\"anchor\" href=\"#15è®¿é—®\">#</a> 1.5. è®¿é—®</h2>\n<p>åœ¨æµè§ˆå™¨è¾“å…¥åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzEyNy4wLjAuMTo4ODQ4L25hY29zJUU1JThEJUIzJUU1JThGJUFGJUVGJUJDJTlB\">http://127.0.0.1:8848/nacos å³å¯ï¼š</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218689.png\" alt=\"image-20210402162630427\" /></p>\n<p>é»˜è®¤çš„è´¦å·å’Œå¯†ç éƒ½æ˜¯ nacosï¼Œè¿›å…¥åï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218382.png\" alt=\"image-20210402162709515\" /></p>\n<h1 id=\"2linuxå®‰è£…\"><a class=\"anchor\" href=\"#2linuxå®‰è£…\">#</a> 2.Linux å®‰è£…</h1>\n<p>Linux æˆ–è€… Mac å®‰è£…æ–¹å¼ä¸ Windows ç±»ä¼¼ã€‚</p>\n<h2 id=\"21å®‰è£…jdk\"><a class=\"anchor\" href=\"#21å®‰è£…jdk\">#</a> 2.1. å®‰è£… JDK</h2>\n<p>Nacos ä¾èµ–äº JDK è¿è¡Œï¼Œæ‰€ä»¥ Linux ä¸Šä¹Ÿéœ€è¦å®‰è£… JDK æ‰è¡Œã€‚</p>\n<p>ä¸Šä¼  jdk å®‰è£…åŒ…ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218243.png\" alt=\"image-20210402172334810\" /></p>\n<p>ä¸Šä¼ åˆ°æŸä¸ªç›®å½•ï¼Œä¾‹å¦‚ï¼š <code>/usr/local/</code></p>\n<p>ç„¶åè§£å‹ç¼©ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">tar</span> <span class=\"token parameter variable\">-xvf</span> jdk-8u144-linux-x64.tar.gz</pre></td></tr></table></figure><p>ç„¶åé‡å‘½åä¸º java</p>\n<p>é…ç½®ç¯å¢ƒå˜é‡ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">JAVA_HOME</span><span class=\"token operator\">=</span>/usr/local/java</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token environment constant\">$PATH</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$JAVA_HOME</span>/bin</pre></td></tr></table></figure><p>åˆ·æ–°ç¯å¢ƒå˜é‡ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">source</span> /etc/profile</pre></td></tr></table></figure><h2 id=\"22ä¸Šä¼ å®‰è£…åŒ…\"><a class=\"anchor\" href=\"#22ä¸Šä¼ å®‰è£…åŒ…\">#</a> 2.2. ä¸Šä¼ å®‰è£…åŒ…</h2>\n<p>å¦‚å›¾ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218879.png\" alt=\"image-20210402161102887\" /></p>\n<p>ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨è¯¾å‰èµ„æ–™ä¸­çš„ tar.gzï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218287.png\" alt=\"image-20210402161130261\" /></p>\n<p>ä¸Šä¼ åˆ° Linux æœåŠ¡å™¨çš„æŸä¸ªç›®å½•ï¼Œä¾‹å¦‚ <code>/usr/local/src</code>  ç›®å½•ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218025.png\" alt=\"image-20210402163715580\" /></p>\n<h2 id=\"23è§£å‹\"><a class=\"anchor\" href=\"#23è§£å‹\">#</a> 2.3. è§£å‹</h2>\n<p>å‘½ä»¤è§£å‹ç¼©å®‰è£…åŒ…ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">tar</span> <span class=\"token parameter variable\">-xvf</span> nacos-server-1.4.1.tar.gz</pre></td></tr></table></figure><p>ç„¶ååˆ é™¤å®‰è£…åŒ…ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">rm</span> <span class=\"token parameter variable\">-rf</span> nacos-server-1.4.1.tar.gz</pre></td></tr></table></figure><p>ç›®å½•ä¸­æœ€ç»ˆæ ·å¼ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218677.png\" alt=\"image-20210402163858429\" /></p>\n<p>ç›®å½•å†…éƒ¨ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218771.png\" alt=\"image-20210402164414827\" /></p>\n<h2 id=\"24ç«¯å£é…ç½®\"><a class=\"anchor\" href=\"#24ç«¯å£é…ç½®\">#</a> 2.4. ç«¯å£é…ç½®</h2>\n<p>ä¸ windows ä¸­ç±»ä¼¼</p>\n<h2 id=\"25å¯åŠ¨\"><a class=\"anchor\" href=\"#25å¯åŠ¨\">#</a> 2.5. å¯åŠ¨</h2>\n<p>åœ¨ nacos/bin ç›®å½•ä¸­ï¼Œè¾“å…¥å‘½ä»¤å¯åŠ¨ Nacosï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sh</span> startup.sh <span class=\"token parameter variable\">-m</span> standalone</pre></td></tr></table></figure><h1 id=\"3nacosçš„ä¾èµ–\"><a class=\"anchor\" href=\"#3nacosçš„ä¾èµ–\">#</a> 3.Nacos çš„ä¾èµ–</h1>\n<p>çˆ¶å·¥ç¨‹ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-alibaba-dependencies<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.2.5.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>type</span><span class=\"token punctuation\">></span></span>pom<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>type</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>import<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- nacos å®¢æˆ·ç«¯ä¾èµ–åŒ… --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-alibaba-nacos-discovery<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure>",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "Nacos",
                "è®¡ç®—æœºå­¦ç§‘",
                "åŸºç¡€",
                "springcloud",
                "Nacos"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Nacos/nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Nacos/nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/",
            "title": "Nacosé›†ç¾¤æ­å»º",
            "date_published": "2024-01-06T02:33:28.222Z",
            "content_html": "<h1 id=\"nacosé›†ç¾¤æ­å»º\"><a class=\"anchor\" href=\"#nacosé›†ç¾¤æ­å»º\">#</a> Nacos é›†ç¾¤æ­å»º</h1>\n<p>1. é›†ç¾¤ç»“æ„å›¾</p>\n<p>å®˜æ–¹ç»™å‡ºçš„ Nacos é›†ç¾¤å›¾ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061439329.png\" alt=\"image-20210409210621117\" /></p>\n<p>å…¶ä¸­åŒ…å« 3 ä¸ª nacos èŠ‚ç‚¹ï¼Œç„¶åä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ä»£ç† 3 ä¸ª Nacosã€‚è¿™é‡Œè´Ÿè½½å‡è¡¡å™¨å¯ä»¥ä½¿ç”¨ nginxã€‚</p>\n<p>æˆ‘ä»¬è®¡åˆ’çš„é›†ç¾¤ç»“æ„ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061439932.png\" alt=\"image-20210409211355037\" /></p>\n<p>ä¸‰ä¸ª nacos èŠ‚ç‚¹çš„åœ°å€ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>èŠ‚ç‚¹</th>\n<th>ip</th>\n<th>port</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>nacos1</td>\n<td>192.168.150.1</td>\n<td>8845</td>\n</tr>\n<tr>\n<td>nacos2</td>\n<td>192.168.150.1</td>\n<td>8846</td>\n</tr>\n<tr>\n<td>nacos3</td>\n<td>192.168.150.1</td>\n<td>8847</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"2æ­å»ºé›†ç¾¤\"><a class=\"anchor\" href=\"#2æ­å»ºé›†ç¾¤\">#</a> 2. æ­å»ºé›†ç¾¤</h1>\n<p>æ­å»ºé›†ç¾¤çš„åŸºæœ¬æ­¥éª¤ï¼š</p>\n<ul>\n<li>æ­å»ºæ•°æ®åº“ï¼Œåˆå§‹åŒ–æ•°æ®åº“è¡¨ç»“æ„</li>\n<li>ä¸‹è½½ nacos å®‰è£…åŒ…</li>\n<li>é…ç½® nacos</li>\n<li>å¯åŠ¨ nacos é›†ç¾¤</li>\n<li>nginx åå‘ä»£ç†</li>\n</ul>\n<h2 id=\"21åˆå§‹åŒ–æ•°æ®åº“\"><a class=\"anchor\" href=\"#21åˆå§‹åŒ–æ•°æ®åº“\">#</a> 2.1. åˆå§‹åŒ–æ•°æ®åº“</h2>\n<p>Nacos é»˜è®¤æ•°æ®å­˜å‚¨åœ¨å†…åµŒæ•°æ®åº“ Derby ä¸­ï¼Œä¸å±äºç”Ÿäº§å¯ç”¨çš„æ•°æ®åº“ã€‚</p>\n<p>å®˜æ–¹æ¨èçš„æœ€ä½³å®è·µæ˜¯ä½¿ç”¨å¸¦æœ‰ä¸»ä»çš„é«˜å¯ç”¨æ•°æ®åº“é›†ç¾¤ï¼Œä¸»ä»æ¨¡å¼çš„é«˜å¯ç”¨æ•°æ®åº“å¯ä»¥å‚è€ƒ<strong>ä¼ æ™ºæ•™è‚²</strong>çš„åç»­é«˜æ‰‹è¯¾ç¨‹ã€‚</p>\n<p>è¿™é‡Œæˆ‘ä»¬ä»¥å•ç‚¹çš„æ•°æ®åº“ä¸ºä¾‹æ¥è®²è§£ã€‚</p>\n<p>é¦–å…ˆæ–°å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå‘½åä¸º nacosï¼Œè€Œåå¯¼å…¥ä¸‹é¢çš„ SQLï¼š</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>config_info<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'data_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>content<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">longtext</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'content'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>md5<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'md5'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>src_user<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">text</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'source user'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>src_ip<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'source ip'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>app_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç§Ÿæˆ·å­—æ®µ'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>c_desc<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>c_use<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>effect<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>type<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>c_schema<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">text</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>uk_configinfo_datagrouptenant<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8 <span class=\"token keyword\">COLLATE</span><span class=\"token operator\">=</span>utf8_bin <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'config_info'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">/*   è¡¨åç§° = config_info_aggr   */</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>config_info_aggr<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'data_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'group_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>datum_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'datum_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>content<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">longtext</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å†…å®¹'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>app_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç§Ÿæˆ·å­—æ®µ'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>uk_configinfoaggr_datagrouptenantdatum<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>datum_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8 <span class=\"token keyword\">COLLATE</span><span class=\"token operator\">=</span>utf8_bin <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'å¢åŠ ç§Ÿæˆ·å­—æ®µ'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\">/*   è¡¨åç§° = config_info_beta   */</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>config_info_beta<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'data_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'group_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>app_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'app_name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>content<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">longtext</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'content'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>beta_ips<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'betaIps'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>md5<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'md5'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>src_user<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">text</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'source user'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>src_ip<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'source ip'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç§Ÿæˆ·å­—æ®µ'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>uk_configinfobeta_datagrouptenant<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8 <span class=\"token keyword\">COLLATE</span><span class=\"token operator\">=</span>utf8_bin <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'config_info_beta'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token comment\">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token comment\">/*   è¡¨åç§° = config_info_tag   */</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>config_info_tag<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'data_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'group_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'tenant_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tag_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'tag_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>app_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'app_name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>content<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">longtext</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'content'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>md5<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'md5'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>src_user<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">text</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'source user'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>src_ip<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'source ip'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>uk_configinfotag_datagrouptenanttag<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tag_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8 <span class=\"token keyword\">COLLATE</span><span class=\"token operator\">=</span>utf8_bin <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'config_info_tag'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre></pre></td></tr><tr><td data-num=\"82\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre><span class=\"token comment\">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre><span class=\"token comment\">/*   è¡¨åç§° = config_tags_relation   */</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>config_tags_relation<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tag_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'tag_name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tag_type<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'tag_type'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'data_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'group_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'tenant_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>nid<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>nid<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>uk_configtagrelation_configidtag<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tag_name<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tag_type<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>idx_tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8 <span class=\"token keyword\">COLLATE</span><span class=\"token operator\">=</span>utf8_bin <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'config_tag_relation'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre></pre></td></tr><tr><td data-num=\"99\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre><span class=\"token comment\">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre><span class=\"token comment\">/*   è¡¨åç§° = group_capacity   */</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_capacity<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¸»é”®ID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Group IDï¼Œç©ºå­—ç¬¦è¡¨ç¤ºæ•´ä¸ªé›†ç¾¤'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>quota<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>usage<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä½¿ç”¨é‡'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>max_size<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>max_aggr_count<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°ï¼Œï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>max_aggr_size<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>max_history_count<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€å¤§å˜æ›´å†å²æ•°é‡'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>uk_group_id<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8 <span class=\"token keyword\">COLLATE</span><span class=\"token operator\">=</span>utf8_bin <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'é›†ç¾¤ã€å„Groupå®¹é‡ä¿¡æ¯è¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre></pre></td></tr><tr><td data-num=\"118\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre><span class=\"token comment\">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre><span class=\"token comment\">/*   è¡¨åç§° = his_config_info   */</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>his_config_info<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>nid<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>app_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'app_name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>content<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">longtext</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>md5<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>src_user<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">text</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>src_ip<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>op_type<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç§Ÿæˆ·å­—æ®µ'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>nid<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>idx_gmt_create<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>idx_gmt_modified<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>idx_did<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8 <span class=\"token keyword\">COLLATE</span><span class=\"token operator\">=</span>utf8_bin <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'å¤šç§Ÿæˆ·æ”¹é€ '</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre></pre></td></tr><tr><td data-num=\"142\"></td><td><pre></pre></td></tr><tr><td data-num=\"143\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre><span class=\"token comment\">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre><span class=\"token comment\">/*   è¡¨åç§° = tenant_capacity   */</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"147\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_capacity<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"148\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¸»é”®ID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"149\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Tenant ID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"150\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>quota<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>usage<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä½¿ç”¨é‡'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"152\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>max_size<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>max_aggr_count<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>max_aggr_size<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"155\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>max_history_count<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€å¤§å˜æ›´å†å²æ•°é‡'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"156\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"157\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"159\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>uk_tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"160\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8 <span class=\"token keyword\">COLLATE</span><span class=\"token operator\">=</span>utf8_bin <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'ç§Ÿæˆ·å®¹é‡ä¿¡æ¯è¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"161\"></td><td><pre></pre></td></tr><tr><td data-num=\"162\"></td><td><pre></pre></td></tr><tr><td data-num=\"163\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_info<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"164\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"165\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>kp<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'kp'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"166\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">default</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'tenant_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"167\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">default</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'tenant_name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"168\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_desc<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'tenant_desc'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"169\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>create_source<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'create_source'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"170\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"171\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"172\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"173\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>uk_tenant_info_kptenantid<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>kp<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"174\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>idx_tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"175\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8 <span class=\"token keyword\">COLLATE</span><span class=\"token operator\">=</span>utf8_bin <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'tenant_info'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"176\"></td><td><pre></pre></td></tr><tr><td data-num=\"177\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>users<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"178\"></td><td><pre>\t<span class=\"token identifier\"><span class=\"token punctuation\">`</span>username<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"179\"></td><td><pre>\t<span class=\"token identifier\"><span class=\"token punctuation\">`</span>password<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"180\"></td><td><pre>\t<span class=\"token identifier\"><span class=\"token punctuation\">`</span>enabled<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">boolean</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span></pre></td></tr><tr><td data-num=\"181\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"182\"></td><td><pre></pre></td></tr><tr><td data-num=\"183\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>roles<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"184\"></td><td><pre>\t<span class=\"token identifier\"><span class=\"token punctuation\">`</span>username<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"185\"></td><td><pre>\t<span class=\"token identifier\"><span class=\"token punctuation\">`</span>role<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"186\"></td><td><pre>\t<span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">INDEX</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>idx_user_role<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>username<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">ASC</span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>role<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">ASC</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span></pre></td></tr><tr><td data-num=\"187\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"188\"></td><td><pre></pre></td></tr><tr><td data-num=\"189\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>permissions<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"190\"></td><td><pre>    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>role<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"191\"></td><td><pre>    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>resource<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"192\"></td><td><pre>    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>action<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"193\"></td><td><pre>    <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">INDEX</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>uk_role_permission<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>role<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>resource<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>action<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span></pre></td></tr><tr><td data-num=\"194\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"195\"></td><td><pre></pre></td></tr><tr><td data-num=\"196\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> users <span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">,</span> enabled<span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'nacos'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"197\"></td><td><pre></pre></td></tr><tr><td data-num=\"198\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> roles <span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> role<span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'nacos'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ROLE_ADMIN'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"22ä¸‹è½½nacos\"><a class=\"anchor\" href=\"#22ä¸‹è½½nacos\">#</a> 2.2. ä¸‹è½½ nacos</h2>\n<p>nacos åœ¨ GitHub ä¸Šæœ‰ä¸‹è½½åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvbmFjb3MvdGFncyVFRiVCQyU4QyVFNSU4RiVBRiVFNCVCQiVBNSVFOSU4MCU4OSVFNiU4QiVBOSVFNCVCQiVCQiVFNiU4NCU4RiVFNyU4OSU4OCVFNiU5QyVBQyVFNCVCOCU4QiVFOCVCRCVCRCVFMyU4MCU4Mg==\">https://github.com/alibaba/nacos/tagsï¼Œå¯ä»¥é€‰æ‹©ä»»æ„ç‰ˆæœ¬ä¸‹è½½ã€‚</span></p>\n<p>æœ¬ä¾‹ä¸­æ‰ç”¨ 1.4.1 ç‰ˆæœ¬ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061439539.png\" alt=\"image-20210409212119411\" /></p>\n<h2 id=\"23é…ç½®nacos\"><a class=\"anchor\" href=\"#23é…ç½®nacos\">#</a> 2.3. é…ç½® Nacos</h2>\n<p>å°†è¿™ä¸ªåŒ…è§£å‹åˆ°ä»»æ„éä¸­æ–‡ç›®å½•ä¸‹ï¼Œå¦‚å›¾ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061439220.png\" alt=\"image-20210402161843337\" /></p>\n<p>ç›®å½•è¯´æ˜ï¼š</p>\n<ul>\n<li>binï¼šå¯åŠ¨è„šæœ¬</li>\n<li>confï¼šé…ç½®æ–‡ä»¶</li>\n</ul>\n<p>è¿›å…¥ nacos çš„ conf ç›®å½•ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ cluster.conf.exampleï¼Œé‡å‘½åä¸º cluster.confï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061440003.png\" alt=\"image-20210409212459292\" /></p>\n<p>ç„¶åæ·»åŠ å†…å®¹ï¼š</p>\n<p>é›†ç¾¤ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯</p>\n<p>å¦‚æœæ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹é‚£ä¸‹é¢ä¸‰ä¸ªéƒ½åº”è¯¥æ˜¯çœŸå®æœºå™¨çš„ ip åœ°å€å’Œç«¯å£å·</p>\n<pre><code>127.0.0.1:8845\n127.0.0.1.8846\n127.0.0.1.8847\n</code></pre>\n<p>ç„¶åä¿®æ”¹ application.properties æ–‡ä»¶ï¼Œæ·»åŠ æ•°æ®åº“é…ç½®</p>\n<p>å°†é…ç½®æ–‡ä»¶ä¸­å¦‚ä¸‹çš„é…ç½®çš„æ³¨é‡Šå…¨éƒ¨å»æ‰ä¹Ÿå°±æ˜¯æ‰“å¼€</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key attr-name\">spring.datasource.platform</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">mysql</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key attr-name\">db.num</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">1</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key attr-name\">db.url.0</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key attr-name\">db.user.0</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">root</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key attr-name\">db.password.0</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">123</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061439107.png\" alt=\"image-20231006143926134\" /></p>\n<h2 id=\"24å¯åŠ¨\"><a class=\"anchor\" href=\"#24å¯åŠ¨\">#</a> 2.4. å¯åŠ¨</h2>\n<p>å°† nacos æ–‡ä»¶å¤¹å¤åˆ¶ä¸‰ä»½ï¼Œåˆ†åˆ«å‘½åä¸ºï¼šnacos1ã€nacos2ã€nacos3</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061440201.png\" alt=\"image-20210409213335538\" /></p>\n<p>ç„¶ååˆ†åˆ«ä¿®æ”¹ä¸‰ä¸ªæ–‡ä»¶å¤¹ä¸­çš„ application.propertiesï¼Œ</p>\n<p>nacos1:</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key attr-name\">server.port</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">8845</span></pre></td></tr></table></figure><p>nacos2:</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key attr-name\">server.port</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">8846</span></pre></td></tr></table></figure><p>nacos3:</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key attr-name\">server.port</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">8847</span></pre></td></tr></table></figure><p>ç„¶ååˆ†åˆ«å¯åŠ¨ä¸‰ä¸ª nacos èŠ‚ç‚¹ï¼š</p>\n<p>&lt;font color='red'&gt; æ³¨æ„ &lt;/font&gt;ï¼šæ­¤æ—¶å¯åŠ¨ä¸éœ€è¦åŠ å‚æ•°äº†ï¼Œç›´æ¥å¯åŠ¨å³å¯ã€‚å› ä¸ºç°åœ¨æ˜¯é›†ç¾¤å¯åŠ¨ (é»˜è®¤)</p>\n<pre><code>startup.cmd\n</code></pre>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061454156.png\" alt=\"image-20231006145123931\" /></p>\n<p>ç„¶åä¾æ¬¡è®¿é—®ä¸€ä¸‹ url çœ‹çœ‹æ˜¯å¦æ­£å¸¸å¯åŠ¨äº†</p>\n<p>æ­£å¸¸å¯åŠ¨äº†ï¼</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061453370.png\" alt=\"image-20231006145253400\" /></p>\n<h2 id=\"25nginxåå‘ä»£ç†\"><a class=\"anchor\" href=\"#25nginxåå‘ä»£ç†\">#</a> 2.5.nginx åå‘ä»£ç†</h2>\n<p>æ‰¾åˆ°è¯¾å‰èµ„æ–™æä¾›çš„ nginx å®‰è£…åŒ…ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061440828.png\" alt=\"image-20210410103253355\" /></p>\n<p>è§£å‹åˆ°ä»»æ„éä¸­æ–‡ç›®å½•ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061440364.png\" alt=\"image-20210410103322874\" /></p>\n<p>ä¿®æ”¹ conf/nginx.conf æ–‡ä»¶ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">http</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">upstream</span> nacos-cluster</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    \t<span class=\"token directive\"><span class=\"token keyword\">server</span> 127.0.0.1:8845</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token directive\"><span class=\"token keyword\">server</span> 127.0.0.1:8846</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token directive\"><span class=\"token keyword\">server</span> 127.0.0.1:8847</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    \t<span class=\"token directive\"><span class=\"token keyword\">listen</span>       <span class=\"token number\">80</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    \t<span class=\"token directive\"><span class=\"token keyword\">server_name</span>  localhost</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    \t<span class=\"token directive\"><span class=\"token keyword\">location</span> /nacos</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">proxy_pass</span> http://nacos-cluster</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    \t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®Œæ•´çš„é…ç½®æ–‡ä»¶ä¿¡æ¯ï¼š</p>\n<pre><code>\n#user  nobody;\nworker_processes  1;\n\n#error_log  logs/error.log;\n#error_log  logs/error.log  notice;\n#error_log  logs/error.log  info;\n\n#pid        logs/nginx.pid;\n\n\nevents &#123;\n    worker_connections  1024;\n&#125;\n\n\nhttp &#123;\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    #log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '\n    #                  '$status $body_bytes_sent &quot;$http_referer&quot; '\n    #                  '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';\n\n    #access_log  logs/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    #keepalive_timeout  0;\n    keepalive_timeout  65;\n\n    #gzip  on;\n\n    server &#123;\n        listen       88;\n        server_name  localhost;\n\n        location / &#123;\n            root   html;\n            index  index.html index.htm;\n        &#125;\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n    &#125;\n\tupstream nacos-cluster &#123;\n    \t\tserver 127.0.0.1:8845;\n\t\tserver 127.0.0.1:8846;\n\t\tserver 127.0.0.1:8847;\n\t&#125;\n\n\tserver &#123;\n    \t\tlisten       80;\n    \t\tserver_name  localhost;\n\n    \t\tlocation /nacos &#123;\n        \t\tproxy_pass http://nacos-cluster;\n    \t\t&#125;\n\t&#125;\n&#125;\n</code></pre>\n<p>é…ç½®å®Œæˆåå¯åŠ¨ nginxï¼Œæ‰§è¡Œå‘½ä»¤ï¼šstart nginx.exe</p>\n<p>è®¿é—®ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4OC8lRTYlOUYlQTUlRTclOUMlOEIlRTYlOTglQUYlRTUlOTAlQTYlRTglODMlQkQlRTYlQUQlQTMlRTUlQjglQjglRTglQUUlQkYlRTklOTclQUU=\">http://localhost:88 / æŸ¥çœ‹æ˜¯å¦èƒ½æ­£å¸¸è®¿é—®</span></p>\n<p>nginx å¯åŠ¨æˆåŠŸï¼</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061521543.png\" alt=\"image-20231006152139209\" /></p>\n<p>è€Œååœ¨æµè§ˆå™¨è®¿é—®ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9uYWNvcyVFNSU4RCVCMyVFNSU4RiVBRiVFMyU4MCU4Mg==\">http://localhost/nacos å³å¯ã€‚</span></p>\n<p>åˆ°è¿™å„¿ï¼é›†ç¾¤æ­å»ºå°±æˆåŠŸäº†ã€‚çœ‹ç€åƒæ˜¯è®¿é—®çš„ä¸€ä¸ª nacosï¼Œäº‹å®ä¸Šå®ƒä¼šåœ¨ä¸‰ä¸ª nacos ä¹‹é—´åšä¸€ä¸ªè´Ÿè½½å‡è¡¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061522455.png\" alt=\"image-20231006152205310\" /></p>\n<p>é—®é¢˜æ¥äº†ï¼Œjava ä»£ç è¯¥å¦‚ä½•é…å‘¢ï¼Œåœ¨ java çš„ yml é…ç½®æ–‡ä»¶ä¸­å°† nacos çš„æœåŠ¡åœ°å€æ”¹ä¸ºå¯¹åº”çš„ç«¯å£ä¹Ÿå°±æ˜¯ 80 ç«¯å£</p>\n<p>ä»£ç ä¸­ bootstrap.yml æ–‡ä»¶é…ç½®å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> userservice <span class=\"token comment\"># æœåŠ¡åç§°</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">profiles</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">active</span><span class=\"token punctuation\">:</span> dev <span class=\"token comment\"># ç¯å¢ƒ</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">80</span> <span class=\"token comment\"># nacos åœ°å€ï¼Œè¿™é‡Œæ‰¾çš„æ˜¯ nginx åå‘ä»£ç†çš„åœ°å€å®ƒä¼šæ ¹æ®è´Ÿè½½å‡è¡¡æ¥å¯åŠ¨ nacos</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token key atrule\">file-extension</span><span class=\"token punctuation\">:</span> yaml <span class=\"token comment\"># é…ç½®æ–‡ä»¶åç¼€å</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># ä¸‰è¦ç´ ï¼šæœåŠ¡åç§°ï¼Œç¯å¢ƒï¼Œåç¼€å è€Œè¿™ä¸‰ä¸ªå†³å®šäº† DateId</span></pre></td></tr></table></figure><p>å¯åŠ¨ user-service æœåŠ¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061528874.png\" alt=\"image-20231006152811433\" /></p>\n<p>æˆ‘ä»¬æŸ¥çœ‹ nacos æ§åˆ¶å°ä¸­çš„æœåŠ¡åˆ—è¡¨ã€‚</p>\n<p>å¯ä»¥çœ‹åˆ°æˆåŠŸçš„æ³¨å†Œè¿›æ¥äº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061528168.png\" alt=\"image-20231006152847028\" /></p>\n<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œç‚¹å‡»å‘å¸ƒ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061544827.png\" alt=\"image-20231006154304156\" /></p>\n<p>å‘å¸ƒåæŸ¥çœ‹æ•°æ®åº“ä¸­çš„ config_info è¡¨é‡Œé¢çš„ä¿¡æ¯ï¼Œå°±å¯ä»¥çœ‹åˆ°å¤šäº†ä¸€æ¡ä¿¡æ¯å°±æ˜¯åˆ›å»ºçš„ç¯å¢ƒé…ç½®æ–‡ä»¶çš„ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061545446.png\" alt=\"image-20231006154339296\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>é›†ç¾¤æ­å»ºæ­¥éª¤ï¼š</p>\n<ol>\n<li>æ­å»º MySQL é›†ç¾¤å¹¶åˆå§‹åŒ–æ•°æ®åº“è¡¨</li>\n<li>ä¸‹è½½è§£å‹ nacos</li>\n<li>ä¿®æ”¹é›†ç¾¤é…ç½® (èŠ‚ç‚¹ä¿¡æ¯)ï¼Œæ•°æ®åº“é…ç½®</li>\n<li>åˆ†åˆ«å¯åŠ¨å¤šä¸ª nacos èŠ‚ç‚¹</li>\n<li>nginx åå‘ä»£ç†</li>\n</ol>\n</blockquote>\n<h2 id=\"26ä¼˜åŒ–\"><a class=\"anchor\" href=\"#26ä¼˜åŒ–\">#</a> 2.6. ä¼˜åŒ–</h2>\n<ul>\n<li>\n<p>å®é™…éƒ¨ç½²æ—¶ï¼Œéœ€è¦ç»™åšåå‘ä»£ç†çš„ nginx æœåŠ¡å™¨è®¾ç½®ä¸€ä¸ªåŸŸåï¼Œè¿™æ ·åç»­å¦‚æœæœ‰æœåŠ¡å™¨è¿ç§» nacos çš„å®¢æˆ·ç«¯ä¹Ÿæ— éœ€æ›´æ”¹é…ç½®.</p>\n</li>\n<li>\n<p>Nacos çš„å„ä¸ªèŠ‚ç‚¹åº”è¯¥éƒ¨ç½²åˆ°å¤šä¸ªä¸åŒæœåŠ¡å™¨ï¼Œåšå¥½å®¹ç¾å’Œéš”ç¦»</p>\n</li>\n</ul>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "Nacos",
                "è®¡ç®—æœºå­¦ç§‘",
                "é›†ç¾¤",
                "springcloud",
                "Nacos"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Elasticsearch/%E5%AE%89%E8%A3%85elasticsearch/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Elasticsearch/%E5%AE%89%E8%A3%85elasticsearch/",
            "title": "å®‰è£…elasticsearch",
            "date_published": "2024-01-06T02:31:36.590Z",
            "content_html": "<h1 id=\"å®‰è£…elasticsearch\"><a class=\"anchor\" href=\"#å®‰è£…elasticsearch\">#</a> å®‰è£… elasticsearch</h1>\n<h1 id=\"1éƒ¨ç½²å•ç‚¹es\"><a class=\"anchor\" href=\"#1éƒ¨ç½²å•ç‚¹es\">#</a> 1. éƒ¨ç½²å•ç‚¹ es</h1>\n<h2 id=\"11åˆ›å»ºç½‘ç»œ\"><a class=\"anchor\" href=\"#11åˆ›å»ºç½‘ç»œ\">#</a> 1.1. åˆ›å»ºç½‘ç»œ</h2>\n<p>å› ä¸ºæˆ‘ä»¬è¿˜éœ€è¦éƒ¨ç½² kibana å®¹å™¨ï¼Œå› æ­¤éœ€è¦è®© es å’Œ kibana å®¹å™¨äº’è”ã€‚è¿™é‡Œå…ˆåˆ›å»ºä¸€ä¸ªç½‘ç»œï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> network create es-net</pre></td></tr></table></figure><h2 id=\"12åŠ è½½é•œåƒ\"><a class=\"anchor\" href=\"#12åŠ è½½é•œåƒ\">#</a> 1.2. åŠ è½½é•œåƒ</h2>\n<p>è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ elasticsearch çš„ 7.12.1 ç‰ˆæœ¬çš„é•œåƒï¼Œè¿™ä¸ªé•œåƒä½“ç§¯éå¸¸å¤§ï¼Œæ¥è¿‘ 1Gã€‚ä¸å»ºè®®å¤§å®¶è‡ªå·± pullã€‚</p>\n<p>è¯¾å‰èµ„æ–™æä¾›äº†é•œåƒçš„ tar åŒ…ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112020462.png\" alt=\"image-20210510165308064\" /></p>\n<p>å¤§å®¶å°†å…¶ä¸Šä¼ åˆ°è™šæ‹Ÿæœºä¸­ï¼Œç„¶åè¿è¡Œå‘½ä»¤åŠ è½½å³å¯ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># å¯¼å…¥æ•°æ®</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> load <span class=\"token parameter variable\">-i</span> es.tar</pre></td></tr></table></figure><p>åŒç†è¿˜æœ‰ <code>kibana</code>  çš„ tar åŒ…ä¹Ÿéœ€è¦è¿™æ ·åšã€‚</p>\n<h2 id=\"13è¿è¡Œ\"><a class=\"anchor\" href=\"#13è¿è¡Œ\">#</a> 1.3. è¿è¡Œ</h2>\n<p>è¿è¡Œ docker å‘½ä»¤ï¼Œéƒ¨ç½²å•ç‚¹ esï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token parameter variable\">--name</span> es <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token parameter variable\">-e</span> <span class=\"token string\">\"ES_JAVA_OPTS=-Xms512m -Xmx512m\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token parameter variable\">-e</span> <span class=\"token string\">\"discovery.type=single-node\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token parameter variable\">-v</span> es-data:/usr/share/elasticsearch/data <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token parameter variable\">-v</span> es-plugins:/usr/share/elasticsearch/plugins <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token parameter variable\">--privileged</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token parameter variable\">--network</span> es-net <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token parameter variable\">-p</span> <span class=\"token number\">9200</span>:9200 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token parameter variable\">-p</span> <span class=\"token number\">9300</span>:9300 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>elasticsearch:7.12.1</pre></td></tr></table></figure><p>å‘½ä»¤è§£é‡Šï¼š</p>\n<ul>\n<li><code>-e &quot;cluster.name=es-docker-cluster&quot;</code> ï¼šè®¾ç½®é›†ç¾¤åç§°</li>\n<li><code>-e &quot;http.host=0.0.0.0&quot;</code> ï¼šç›‘å¬çš„åœ°å€ï¼Œå¯ä»¥å¤–ç½‘è®¿é—®</li>\n<li><code>-e &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</code> ï¼šå†…å­˜å¤§å°</li>\n<li><code>-e &quot;discovery.type=single-node&quot;</code> ï¼šéé›†ç¾¤æ¨¡å¼</li>\n<li><code>-v es-data:/usr/share/elasticsearch/data</code> ï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®š es çš„æ•°æ®ç›®å½•</li>\n<li><code>-v es-logs:/usr/share/elasticsearch/logs</code> ï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®š es çš„æ—¥å¿—ç›®å½•</li>\n<li><code>-v es-plugins:/usr/share/elasticsearch/plugins</code> ï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®š es çš„æ’ä»¶ç›®å½•</li>\n<li><code>--privileged</code> ï¼šæˆäºˆé€»è¾‘å·è®¿é—®æƒ</li>\n<li><code>--network es-net</code>  ï¼šåŠ å…¥ä¸€ä¸ªåä¸º es-net çš„ç½‘ç»œä¸­</li>\n<li><code>-p 9200:9200</code> ï¼šç«¯å£æ˜ å°„é…ç½®</li>\n</ul>\n<p>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTUwLjEwMTo5MjAw\">http://192.168.150.101:9200</span> å³å¯çœ‹åˆ° elasticsearch çš„å“åº”ç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112020815.png\" alt=\"image-20210506101053676\" /></p>\n<h1 id=\"2éƒ¨ç½²kibana\"><a class=\"anchor\" href=\"#2éƒ¨ç½²kibana\">#</a> 2. éƒ¨ç½² kibana</h1>\n<p>kibana å¯ä»¥ç»™æˆ‘ä»¬æä¾›ä¸€ä¸ª elasticsearch çš„å¯è§†åŒ–ç•Œé¢ï¼Œä¾¿äºæˆ‘ä»¬å­¦ä¹ ã€‚</p>\n<h2 id=\"21éƒ¨ç½²\"><a class=\"anchor\" href=\"#21éƒ¨ç½²\">#</a> 2.1. éƒ¨ç½²</h2>\n<p>è¿è¡Œ docker å‘½ä»¤ï¼Œéƒ¨ç½² kibana</p>\n<p>kibana éœ€è¦å’Œ elaticsearch å¤„äºåŒä¸€ä¸ªç½‘ç»œä¸­</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token parameter variable\">--name</span> kibana <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># å› ä¸ºå®ƒä»¬ä¸¤ä¸ªä¸ºåŒä¸€ä¸ªç½‘ç»œï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨å®¹å™¨åäº’è”</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">ELASTICSEARCH_HOSTS</span><span class=\"token operator\">=</span>http://es:9200 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token parameter variable\">--network</span><span class=\"token operator\">=</span>es-net <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token parameter variable\">-p</span> <span class=\"token number\">5601</span>:5601  <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>kibana:7.12.1</pre></td></tr></table></figure><ul>\n<li><code>--network es-net</code>  ï¼šåŠ å…¥ä¸€ä¸ªåä¸º es-net çš„ç½‘ç»œä¸­ï¼Œä¸ elasticsearch åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­</li>\n<li><code>-e ELASTICSEARCH_HOSTS=http://es:9200&quot;</code> ï¼šè®¾ç½® elasticsearch çš„åœ°å€ï¼Œå› ä¸º kibana å·²ç»ä¸ elasticsearch åœ¨ä¸€ä¸ªç½‘ç»œï¼Œå› æ­¤å¯ä»¥ç”¨å®¹å™¨åç›´æ¥è®¿é—® elasticsearch</li>\n<li><code>-p 5601:5601</code> ï¼šç«¯å£æ˜ å°„é…ç½®</li>\n</ul>\n<p>kibana å¯åŠ¨ä¸€èˆ¬æ¯”è¾ƒæ…¢ï¼Œéœ€è¦å¤šç­‰å¾…ä¸€ä¼šï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> logs <span class=\"token parameter variable\">-f</span> kibana</pre></td></tr></table></figure><p>æŸ¥çœ‹è¿è¡Œæ—¥å¿—ï¼Œå½“æŸ¥çœ‹åˆ°ä¸‹é¢çš„æ—¥å¿—ï¼Œè¯´æ˜æˆåŠŸï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112020301.png\" alt=\"image-20210109105135812\" /></p>\n<p>æ­¤æ—¶ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥åœ°å€è®¿é—®ï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTUwLjEwMTo1NjAx\">http://192.168.150.101:5601</span>ï¼Œå³å¯çœ‹åˆ°ç»“æœ</p>\n<h2 id=\"22devtools\"><a class=\"anchor\" href=\"#22devtools\">#</a> 2.2.DevTools</h2>\n<p>kibana ä¸­æä¾›äº†ä¸€ä¸ª DevTools ç•Œé¢ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112020356.png\" alt=\"image-20210506102630393\" /></p>\n<p>è¿™ä¸ªç•Œé¢ä¸­å¯ä»¥ç¼–å†™ DSL æ¥æ“ä½œ elasticsearchã€‚å¹¶ä¸”å¯¹ DSL è¯­å¥æœ‰è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ã€‚</p>\n<h1 id=\"3å®‰è£…ikåˆ†è¯å™¨\"><a class=\"anchor\" href=\"#3å®‰è£…ikåˆ†è¯å™¨\">#</a> 3. å®‰è£… IK åˆ†è¯å™¨</h1>\n<h2 id=\"31åœ¨çº¿å®‰è£…ikæ’ä»¶è¾ƒæ…¢\"><a class=\"anchor\" href=\"#31åœ¨çº¿å®‰è£…ikæ’ä»¶è¾ƒæ…¢\">#</a> 3.1. åœ¨çº¿å®‰è£… ik æ’ä»¶ï¼ˆè¾ƒæ…¢ï¼‰</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># è¿›å…¥å®¹å™¨å†…éƒ¨</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> elasticsearch /bin/bash</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># åœ¨çº¿ä¸‹è½½å¹¶å®‰è£…</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>./bin/elasticsearch-plugin  <span class=\"token function\">install</span> https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.12.1/elasticsearch-analysis-ik-7.12.1.zip</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#é€€å‡º</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token builtin class-name\">exit</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#é‡å¯å®¹å™¨</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">docker</span> restart elasticsearch</pre></td></tr></table></figure><h2 id=\"32ç¦»çº¿å®‰è£…ikæ’ä»¶æ¨è\"><a class=\"anchor\" href=\"#32ç¦»çº¿å®‰è£…ikæ’ä»¶æ¨è\">#</a> 3.2. ç¦»çº¿å®‰è£… ik æ’ä»¶ï¼ˆæ¨èï¼‰</h2>\n<h3 id=\"1æŸ¥çœ‹æ•°æ®å·ç›®å½•\"><a class=\"anchor\" href=\"#1æŸ¥çœ‹æ•°æ®å·ç›®å½•\">#</a> 1ï¼‰æŸ¥çœ‹æ•°æ®å·ç›®å½•</h3>\n<p>å®‰è£…æ’ä»¶éœ€è¦çŸ¥é“ elasticsearch çš„ plugins ç›®å½•ä½ç½®ï¼Œè€Œæˆ‘ä»¬ç”¨äº†æ•°æ®å·æŒ‚è½½ï¼Œå› æ­¤éœ€è¦æŸ¥çœ‹ elasticsearch çš„æ•°æ®å·ç›®å½•ï¼Œé€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹:</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> volume inspect es-plugins</pre></td></tr></table></figure><p>æ˜¾ç¤ºç»“æœï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"CreatedAt\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2022-05-06T10:06:34+08:00\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token property\">\"Driver\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"local\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token property\">\"Labels\"</span><span class=\"token operator\">:</span> <span class=\"token null keyword\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token property\">\"Mountpoint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/var/lib/docker/volumes/es-plugins/_data\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token property\">\"Name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"es-plugins\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"Options\"</span><span class=\"token operator\">:</span> <span class=\"token null keyword\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token property\">\"Scope\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"local\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>è¯´æ˜ plugins ç›®å½•è¢«æŒ‚è½½åˆ°äº†ï¼š <code>/var/lib/docker/volumes/es-plugins/_data </code> è¿™ä¸ªç›®å½•ä¸­ã€‚</p>\n<h3 id=\"2è§£å‹ç¼©åˆ†è¯å™¨å®‰è£…åŒ…\"><a class=\"anchor\" href=\"#2è§£å‹ç¼©åˆ†è¯å™¨å®‰è£…åŒ…\">#</a> 2ï¼‰è§£å‹ç¼©åˆ†è¯å™¨å®‰è£…åŒ…</h3>\n<p>ä¸‹é¢æˆ‘ä»¬éœ€è¦æŠŠè¯¾å‰èµ„æ–™ä¸­çš„ ik åˆ†è¯å™¨è§£å‹ç¼©ï¼Œé‡å‘½åä¸º ik</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112020922.png\" alt=\"image-20210506110249144\" /></p>\n<h3 id=\"3ä¸Šä¼ åˆ°eså®¹å™¨çš„æ’ä»¶æ•°æ®å·ä¸­\"><a class=\"anchor\" href=\"#3ä¸Šä¼ åˆ°eså®¹å™¨çš„æ’ä»¶æ•°æ®å·ä¸­\">#</a> 3ï¼‰ä¸Šä¼ åˆ° es å®¹å™¨çš„æ’ä»¶æ•°æ®å·ä¸­</h3>\n<p>ä¹Ÿå°±æ˜¯ <code>/var/lib/docker/volumes/es-plugins/_data </code> ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112020853.png\" alt=\"image-20210506110704293\" /></p>\n<h3 id=\"4é‡å¯å®¹å™¨\"><a class=\"anchor\" href=\"#4é‡å¯å®¹å™¨\">#</a> 4ï¼‰é‡å¯å®¹å™¨</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 4ã€é‡å¯å®¹å™¨</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> restart es</pre></td></tr></table></figure><figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># æŸ¥çœ‹ es æ—¥å¿—</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> logs <span class=\"token parameter variable\">-f</span> es</pre></td></tr></table></figure><p>çœ‹åˆ°è¿™æ¡ä¿¡æ¯è¯´æ˜å®‰è£…æˆåŠŸäº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112200825.png\" alt=\"image-20231011220033681\" /></p>\n<h3 id=\"5æµ‹è¯•\"><a class=\"anchor\" href=\"#5æµ‹è¯•\">#</a> 5ï¼‰æµ‹è¯•ï¼š</h3>\n<p>IK åˆ†è¯å™¨åŒ…å«ä¸¤ç§æ¨¡å¼ï¼š</p>\n<ul>\n<li>\n<p><code>ik_smart</code> ï¼šæœ€å°‘åˆ‡åˆ†</p>\n<ul>\n<li>å¯ä»¥æœç´¢åˆ°çš„è¯çš„èŒƒå›´æ¯”è¾ƒå°</li>\n</ul>\n</li>\n<li>\n<p><code>ik_max_word</code> ï¼šæœ€ç»†åˆ‡åˆ†</p>\n<ul>\n<li>å¯ä»¥æœç´¢åˆ°çš„è¯çš„èŒƒå›´æ¯”è¾ƒå¤§</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /_analyze</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ik_max_word\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"é»‘é©¬ç¨‹åºå‘˜å­¦ä¹ javaå¤ªæ£’äº†\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç»“æœï¼š</p>\n<p>ik_smart</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"tokens\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"é»‘é©¬\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ç¨‹åºå‘˜\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å­¦ä¹ \"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"java\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ENGLISH\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¤ªæ£’äº†\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">14</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ik_max_word</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"tokens\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"é»‘é©¬\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ç¨‹åºå‘˜\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ç¨‹åº\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å‘˜\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_CHAR\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å­¦ä¹ \"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"java\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ENGLISH\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¤ªæ£’äº†\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">14</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">6</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¤ªæ£’\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">13</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">7</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"äº†\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">13</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">14</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_CHAR\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">8</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>  <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"33-æ‰©å±•è¯è¯å…¸\"><a class=\"anchor\" href=\"#33-æ‰©å±•è¯è¯å…¸\">#</a> 3.3 æ‰©å±•è¯è¯å…¸</h2>\n<p>éšç€äº’è”ç½‘çš„å‘å±•ï¼Œâ€œé€ è¯è¿åŠ¨â€ ä¹Ÿè¶Šå‘çš„é¢‘ç¹ã€‚å‡ºç°äº†å¾ˆå¤šæ–°çš„è¯è¯­ï¼Œåœ¨åŸæœ‰çš„è¯æ±‡åˆ—è¡¨ä¸­å¹¶ä¸å­˜åœ¨ã€‚æ¯”å¦‚ï¼šâ€œå¥¥åŠ›ç»™â€ï¼Œâ€œä¼ æ™ºæ’­å®¢â€ ç­‰ã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬çš„è¯æ±‡ä¹Ÿéœ€è¦ä¸æ–­çš„æ›´æ–°ï¼ŒIK åˆ†è¯å™¨æä¾›äº†æ‰©å±•è¯æ±‡çš„åŠŸèƒ½ã€‚</p>\n<p>1ï¼‰æ‰“å¼€ IK åˆ†è¯å™¨ config ç›®å½•ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112020613.png\" alt=\"image-20210506112225508\" /></p>\n<p>2ï¼‰åœ¨ IKAnalyzer.cfg.xml é…ç½®æ–‡ä»¶å†…å®¹æ·»åŠ ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">properties</span> <span class=\"token name\">SYSTEM</span> <span class=\"token string\">\"http://java.sun.com/dtd/properties.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>comment</span><span class=\"token punctuation\">></span></span>IK Analyzer æ‰©å±•é…ç½®<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>comment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">&lt;!-- ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ *** æ·»åŠ æ‰©å±•è¯å…¸ --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>entry</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ext_dict<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>ext.dic<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>entry</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>3ï¼‰æ–°å»ºä¸€ä¸ª ext.dicï¼Œå¯ä»¥å‚è€ƒ config ç›®å½•ä¸‹å¤åˆ¶ä¸€ä¸ªé…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ä¼ æ™ºæ•™è‚²</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>å¥¥åŠ›ç»™</pre></td></tr></table></figure><p>4ï¼‰é‡å¯ elasticsearch</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> restart es</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># æŸ¥çœ‹ æ—¥å¿—</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">docker</span> logs <span class=\"token parameter variable\">-f</span> elasticsearch</pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112020980.png\" alt=\"image-20201115230900504\" /></p>\n<p>æ—¥å¿—ä¸­å·²ç»æˆåŠŸåŠ è½½ ext.dic é…ç½®æ–‡ä»¶</p>\n<p>5ï¼‰æµ‹è¯•æ•ˆæœï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /_analyze</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ik_max_word\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ä¼ æ™ºæ’­å®¢Javaå°±ä¸šè¶…è¿‡90%,å¥¥åŠ›ç»™ï¼\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>æ³¨æ„å½“å‰æ–‡ä»¶çš„ç¼–ç å¿…é¡»æ˜¯ UTF-8 æ ¼å¼ï¼Œä¸¥ç¦ä½¿ç”¨ Windows è®°äº‹æœ¬ç¼–è¾‘</p>\n</blockquote>\n<h2 id=\"34-åœç”¨è¯è¯å…¸\"><a class=\"anchor\" href=\"#34-åœç”¨è¯è¯å…¸\">#</a> 3.4 åœç”¨è¯è¯å…¸</h2>\n<p>åœ¨äº’è”ç½‘é¡¹ç›®ä¸­ï¼Œåœ¨ç½‘ç»œé—´ä¼ è¾“çš„é€Ÿåº¦å¾ˆå¿«ï¼Œæ‰€ä»¥å¾ˆå¤šè¯­è¨€æ˜¯ä¸å…è®¸åœ¨ç½‘ç»œä¸Šä¼ é€’çš„ï¼Œå¦‚ï¼šå…³äºå®—æ•™ã€æ”¿æ²»ç­‰æ•æ„Ÿè¯è¯­ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨æœç´¢æ—¶ä¹Ÿåº”è¯¥å¿½ç•¥å½“å‰è¯æ±‡ã€‚</p>\n<p>IK åˆ†è¯å™¨ä¹Ÿæä¾›äº†å¼ºå¤§çš„åœç”¨è¯åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬åœ¨ç´¢å¼•æ—¶å°±ç›´æ¥å¿½ç•¥å½“å‰çš„åœç”¨è¯æ±‡è¡¨ä¸­çš„å†…å®¹ã€‚</p>\n<p>1ï¼‰IKAnalyzer.cfg.xml é…ç½®æ–‡ä»¶å†…å®¹æ·»åŠ ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">properties</span> <span class=\"token name\">SYSTEM</span> <span class=\"token string\">\"http://java.sun.com/dtd/properties.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>comment</span><span class=\"token punctuation\">></span></span>IK Analyzer æ‰©å±•é…ç½®<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>comment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">&lt;!-- ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>entry</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ext_dict<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>ext.dic<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>entry</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>         <span class=\"token comment\">&lt;!-- ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•åœæ­¢è¯å­—å…¸  *** æ·»åŠ åœç”¨è¯è¯å…¸ --></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>entry</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ext_stopwords<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>stopword.dic<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>entry</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>3ï¼‰åœ¨ stopword.dic æ·»åŠ åœç”¨è¯</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ç‰›é€¼</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>çš„</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>å°</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>é»‘</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>å­</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>IKUN</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>å¤</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>é¸¡</pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„ï¼š<mark>ç‰›é€¼</mark>è¿™ä¸ªè¯ï¼Œè¿›è¡Œåˆ†è¯æ—¶ä¼šå‡ºç°ç‰›ï¼Œé€¼ ã€‚å› ä¸ºå¦‚ä¸‹è§£é‡Šï¼š</p>\n<p>IK æŸ¥è¯¢åœç”¨è¯å¬å›çš„æ—¶å€™ä¼šå…ˆå°†æŸ¥è¯¢è¯æ ¹æ®åˆ†è¯è¯åº“é…ç½®è¿›è¡Œåˆ†è¯ï¼Œæ¯”å¦‚ &quot;ç‰›é€¼&quot; è¿™ä¸ªè¯ä¼šè¢«åˆ†ä¸º &quot;ç‰›&quot;ï¼Œ&quot;é€¼&quot;ï¼Œä¹‹åä¼šæ ¹æ®åœç”¨è¯åº“å»çœ‹æ˜¯å¦ &quot;ç‰›&quot;ï¼Œ&quot;é€¼&quot; ä¸¤ä¸ªè¯å†åº“å†…ï¼Œå¦‚åœ¨åº“å†…å°±ä¸ä¼šå¬å›ã€‚</p>\n<p>è¯´èµ·æ¥ å¯èƒ½æŠ½è±¡çœ‹å¦‚ä¸‹çš„æƒ…å†µå§ï¼š</p>\n<p>å½“æˆ‘ä»¬æŸ¥è¯¢ â€œç‰›é€¼çš„æ—¶å€™â€ ç»“æœå¦‚ä¸‹ï¼š</p>\n<p>è¿™é‡Œä½ è‚¯å®šå›æƒ³ï¼Œæˆ‘ä¸æ˜¯åœç”¨äº†å—æ€ä¹ˆè¿˜æœ‰æ˜¾ç¤ºå‘¢ï¼Œé‚£ä½ å°±é”™äº†å› ä¸ºå®ƒè¢«åˆ†è¯ä¸º ä¸€ä¸ª â€œç‰›â€ ä¸€ä¸ª â€œé€¼â€ å®ƒå¹¶ä¸æ˜¯ â€œç‰›é€¼â€ äº† ï¼Œæˆ‘ä»¬å†å¾€ä¸‹çœ‹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310120847300.png\" alt=\"image-20231012084748860\" /></p>\n<p>æˆ‘æŸ¥è¯¢ â€œå°â€ çš„æ—¶å€™ç»“æœä»€ä¹ˆä¹Ÿæ²¡æœ‰ å› ä¸ºä¸€ä¸ªå­—è¢«åˆ†è¯è¿˜æ˜¯ä¸€ä¸ªè¯è€Œè¿™ä¸€ä¸ªè¯è¿˜æ˜¯è¢«åœç”¨çš„ä¸€æ¬¡å°±èƒ½åŒ¹é…åˆ°æ‰€ä»¥å°±åœç”¨çœ‹ä¸åˆ°äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310120849089.png\" alt=\"image-20231012084916676\" /></p>\n<p>4ï¼‰é‡å¯ elasticsearch</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># é‡å¯æœåŠ¡</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> restart elasticsearch</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">docker</span> restart kibana</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># æŸ¥çœ‹ æ—¥å¿—</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">docker</span> logs <span class=\"token parameter variable\">-f</span> elasticsearch</pre></td></tr></table></figure><p>æ—¥å¿—ä¸­å·²ç»æˆåŠŸåŠ è½½ stopword.dic é…ç½®æ–‡ä»¶</p>\n<p>5ï¼‰æµ‹è¯•æ•ˆæœï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /_analyze</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ik_max_word\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ä¼ æ™ºæ’­å®¢Javaå°±ä¸šç‡è¶…è¿‡95%,ä¹ å¤§å¤§éƒ½ç‚¹èµ,å¥¥åŠ›ç»™ï¼\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>æ³¨æ„å½“å‰æ–‡ä»¶çš„ç¼–ç å¿…é¡»æ˜¯ UTF-8 æ ¼å¼ï¼Œä¸¥ç¦ä½¿ç”¨ Windows è®°äº‹æœ¬ç¼–è¾‘</p>\n</blockquote>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>åˆ†è¯å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>åˆ›å»ºå€’æ’ç´¢å¼•æ—¶å¯¹æ–‡æ¡£åˆ†è¯</li>\n<li>ç”¨æˆ·æœç´¢æ—¶ï¼Œå¯¹è¾“å…¥çš„å†…å®¹åˆ†è¯</li>\n</ul>\n<p>IK åˆ†è¯å™¨æœ‰å‡ ç§æ¨¡å¼ï¼Ÿ</p>\n<ul>\n<li>ik_smartï¼šæ™ºèƒ½åˆ‡åˆ†ï¼Œç²—ç²’åº¦</li>\n<li>ik_max_wordï¼šæœ€ç»†åˆ‡åˆ†ï¼Œç»†ç²’åº¦</li>\n</ul>\n<p>IK åˆ†è¯å™¨å¦‚ä½•æ‰©å±•è¯æ¡ï¼Ÿå¦‚ä½•åœç”¨è¯æ¡ï¼Ÿ</p>\n<ul>\n<li>åˆ©ç”¨ config ç›®å½•çš„ IkAnalyzer.cfg.xml æ–‡ä»¶æ·»åŠ æ‰©å±•è¯å…¸å’Œåœç”¨è¯å…¸</li>\n<li>åœ¨è¯å…¸ä¸­æ·»åŠ æ‰©å±•è¯æ¡æˆ–è€…åœç”¨è¯æ¡</li>\n</ul>\n</blockquote>\n<h1 id=\"4éƒ¨ç½²esé›†ç¾¤\"><a class=\"anchor\" href=\"#4éƒ¨ç½²esé›†ç¾¤\">#</a> 4. éƒ¨ç½² es é›†ç¾¤</h1>\n<p>éƒ¨ç½² es é›†ç¾¤å¯ä»¥ç›´æ¥ä½¿ç”¨ docker-compose æ¥å®Œæˆï¼Œä¸è¿‡è¦æ±‚ä½ çš„ Linux è™šæ‹Ÿæœºè‡³å°‘æœ‰<strong> 4G</strong> çš„å†…å­˜ç©ºé—´</p>\n<p>é¦–å…ˆç¼–å†™ä¸€ä¸ª docker-compose æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>version: <span class=\"token string\">'2.2'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>services:</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  es01:</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    image: docker.elastic.co/elasticsearch/elasticsearch:7.12.1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    container_name: es01</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    environment:</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      - <span class=\"token assign-left variable\">node.name</span><span class=\"token operator\">=</span>es01</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      - <span class=\"token assign-left variable\">cluster.name</span><span class=\"token operator\">=</span>es-docker-cluster</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      - <span class=\"token assign-left variable\">discovery.seed_hosts</span><span class=\"token operator\">=</span>es02,es03</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      - <span class=\"token assign-left variable\">cluster.initial_master_nodes</span><span class=\"token operator\">=</span>es01,es02,es03</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      - <span class=\"token assign-left variable\">bootstrap.memory_lock</span><span class=\"token operator\">=</span>true</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      - <span class=\"token string\">\"ES_JAVA_OPTS=-Xms512m -Xmx512m\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    ulimits:</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      memlock:</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        soft: <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        hard: <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    volumes:</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      - data01:/usr/share/elasticsearch/data</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    ports:</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      - <span class=\"token number\">9200</span>:9200</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    networks:</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      - elastic</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  es02:</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    image: docker.elastic.co/elasticsearch/elasticsearch:7.12.1</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    container_name: es02</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    environment:</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      - <span class=\"token assign-left variable\">node.name</span><span class=\"token operator\">=</span>es02</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      - <span class=\"token assign-left variable\">cluster.name</span><span class=\"token operator\">=</span>es-docker-cluster</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      - <span class=\"token assign-left variable\">discovery.seed_hosts</span><span class=\"token operator\">=</span>es01,es03</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      - <span class=\"token assign-left variable\">cluster.initial_master_nodes</span><span class=\"token operator\">=</span>es01,es02,es03</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      - <span class=\"token assign-left variable\">bootstrap.memory_lock</span><span class=\"token operator\">=</span>true</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      - <span class=\"token string\">\"ES_JAVA_OPTS=-Xms512m -Xmx512m\"</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    ulimits:</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      memlock:</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        soft: <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        hard: <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    volumes:</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      - data02:/usr/share/elasticsearch/data</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    networks:</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      - elastic</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  es03:</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    image: docker.elastic.co/elasticsearch/elasticsearch:7.12.1</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    container_name: es03</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    environment:</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      - <span class=\"token assign-left variable\">node.name</span><span class=\"token operator\">=</span>es03</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>      - <span class=\"token assign-left variable\">cluster.name</span><span class=\"token operator\">=</span>es-docker-cluster</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      - <span class=\"token assign-left variable\">discovery.seed_hosts</span><span class=\"token operator\">=</span>es01,es02</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      - <span class=\"token assign-left variable\">cluster.initial_master_nodes</span><span class=\"token operator\">=</span>es01,es02,es03</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      - <span class=\"token assign-left variable\">bootstrap.memory_lock</span><span class=\"token operator\">=</span>true</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>      - <span class=\"token string\">\"ES_JAVA_OPTS=-Xms512m -Xmx512m\"</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    ulimits:</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>      memlock:</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        soft: <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        hard: <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    volumes:</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>      - data03:/usr/share/elasticsearch/data</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    networks:</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>      - elastic</pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>volumes:</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>  data01:</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    driver: <span class=\"token builtin class-name\">local</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>  data02:</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    driver: <span class=\"token builtin class-name\">local</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>  data03:</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    driver: <span class=\"token builtin class-name\">local</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>networks:</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>  elastic:</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    driver: bridge</pre></td></tr></table></figure><p>å°†è¯¥é…ç½®æ–‡ä»¶ä¸Šä¼ åˆ° Linux ä¸­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161059412.png\" alt=\"image-20231016105943788\" /></p>\n<p>es è¿è¡Œéœ€è¦ä¿®æ”¹ä¸€äº› Linux ç³»ç»Ÿæƒé™ï¼Œä¿®æ”¹  <code>/etc/sysctl.conf</code>  æ–‡ä»¶ï¼š</p>\n<pre><code class=\"language-shÂ·\">vi /etc/sysctl.conf\n</code></pre>\n<p>æ·»åŠ ä¸‹é¢å†…å®¹ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">vm.max_map_count</span><span class=\"token operator\">=</span><span class=\"token number\">262144</span></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œå‘½ä»¤ï¼Œè®©é…ç½®ç”Ÿæ•ˆï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sysctl -p</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>vm.max_map_count <span class=\"token operator\">=</span> <span class=\"token number\">262144</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>Run  <code>docker-compose</code>  to bring up the cluster:</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker-compose up -d</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Starting es03 <span class=\"token punctuation\">..</span>. <span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Starting es01 <span class=\"token punctuation\">..</span>. <span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Starting es02 <span class=\"token punctuation\">..</span>. <span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker ps -a</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>CONTAINER ID   IMAGE                   COMMAND                  CREATED         STATUS                            PORTS                                                                                                                                                 NAMES</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>c3c4b0e1ffdc   elasticsearch:7.12.1    <span class=\"token string\">\"/bin/tini -- /usr/lâ€¦\"</span>   <span class=\"token number\">2</span> minutes ago   Up <span class=\"token number\">13</span> seconds                     <span class=\"token number\">0.0</span>.0.0:9200-<span class=\"token operator\">></span><span class=\"token number\">9200</span>/tcp, :::9200-<span class=\"token operator\">></span><span class=\"token number\">9200</span>/tcp, <span class=\"token number\">9300</span>/tcp                                                                                                   es01</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>073f8e46e296   elasticsearch:7.12.1    <span class=\"token string\">\"/bin/tini -- /usr/lâ€¦\"</span>   <span class=\"token number\">2</span> minutes ago   Up <span class=\"token number\">13</span> seconds                     <span class=\"token number\">9300</span>/tcp, <span class=\"token number\">0.0</span>.0.0:9201-<span class=\"token operator\">></span><span class=\"token number\">9200</span>/tcp, :::9201-<span class=\"token operator\">></span><span class=\"token number\">9200</span>/tcp                                                                                                   es02</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>aca2f691e3e2   elasticsearch:7.12.1    <span class=\"token string\">\"/bin/tini -- /usr/lâ€¦\"</span>   <span class=\"token number\">2</span> minutes ago   Up <span class=\"token number\">13</span> seconds                     <span class=\"token number\">9300</span>/tcp, <span class=\"token number\">0.0</span>.0.0:9202-<span class=\"token operator\">></span><span class=\"token number\">9200</span>/tcp, :::9202-<span class=\"token operator\">></span><span class=\"token number\">9200</span>/tcp                                                                                                   es03</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>61161df3ec6a   kibana:7.12.1           <span class=\"token string\">\"/bin/tini -- /usr/lâ€¦\"</span>   <span class=\"token number\">4</span> days ago      Up <span class=\"token number\">18</span> minutes                     <span class=\"token number\">0.0</span>.0.0:5601-<span class=\"token operator\">></span><span class=\"token number\">5601</span>/tcp, :::5601-<span class=\"token operator\">></span><span class=\"token number\">5601</span>/tcp                                                                                                             kibana</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>318bc511f26c   elasticsearch:7.12.1    <span class=\"token string\">\"/bin/tini -- /usr/lâ€¦\"</span>   <span class=\"token number\">4</span> days ago      Exited <span class=\"token punctuation\">(</span><span class=\"token number\">137</span><span class=\"token punctuation\">)</span> About a minute ago                                                                                                                                                         es</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>46756ed1a2ee   rabbitmq:3-management   <span class=\"token string\">\"docker-entrypoint.sâ€¦\"</span>   <span class=\"token number\">4</span> days ago      Up <span class=\"token number\">18</span> minutes                     <span class=\"token number\">4369</span>/tcp, <span class=\"token number\">5671</span>/tcp, <span class=\"token number\">0.0</span>.0.0:5672-<span class=\"token operator\">></span><span class=\"token number\">5672</span>/tcp, :::5672-<span class=\"token operator\">></span><span class=\"token number\">5672</span>/tcp, <span class=\"token number\">15671</span>/tcp, <span class=\"token number\">15691</span>-15692/tcp, <span class=\"token number\">25672</span>/tcp, <span class=\"token number\">0.0</span>.0.0:15672-<span class=\"token operator\">></span><span class=\"token number\">15672</span>/tcp, :::15672-<span class=\"token operator\">></span><span class=\"token number\">15672</span>/tcp   mq</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><h2 id=\"41-é›†ç¾¤çŠ¶æ€ç›‘æ§\"><a class=\"anchor\" href=\"#41-é›†ç¾¤çŠ¶æ€ç›‘æ§\">#</a> 4.1ã€é›†ç¾¤çŠ¶æ€ç›‘æ§</h2>\n<p>kibana å¯ä»¥ç›‘æ§ es é›†ç¾¤ï¼Œä¸è¿‡æ–°ç‰ˆæœ¬éœ€è¦ä¾èµ– es çš„ x-pack åŠŸèƒ½ï¼Œé…ç½®æ¯”è¾ƒå¤æ‚ã€‚</p>\n<p>è¿™é‡Œæ¨èä½¿ç”¨ cerebro æ¥ç›‘æ§ es é›†ç¾¤çŠ¶æ€ï¼Œå®˜æ–¹ç½‘å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2xtZW5lemVzL2NlcmVicm8=\">https://github.com/lmenezes/cerebro</span></p>\n<p>ä¸‹è½½åè¿›è¡Œè§£å‹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161113552.png\" alt=\"image-20231016111307167\" /></p>\n<p>è§£å‹åè¿›å…¥ bin ç›®å½•ä¸­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161113838.png\" alt=\"image-20231016111341471\" /></p>\n<p>åŒå‡»è¿è¡Œ cerebro.bat å³å¯è¿è¡Œ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161115237.png\" alt=\"image-20231016111523818\" /></p>\n<p>å¯åŠ¨å®Œæˆåè®¿é—®ï¼šlocalhost:9000 åœ°å€ï¼Œè¯æ˜æ­£å¸¸å¯åŠ¨æˆåŠŸäº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161115161.png\" alt=\"image-20231016111547168\" /></p>\n<p>è¿™æ—¶å°±å¯ä»¥è®¿é—®è™šæ‹Ÿæœºä¸­ es çš„å“ªä¸ªå…±åŒç«¯å£å·çš„åœ°å€äº†ï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMjQ5LjEyODo5MjAw\">http://192.168.249.128:9200</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161154359.png\" alt=\"image-20231016115434836\" /></p>\n<h2 id=\"42-åˆ›å»ºç´¢å¼•åº“\"><a class=\"anchor\" href=\"#42-åˆ›å»ºç´¢å¼•åº“\">#</a> 4.2ã€åˆ›å»ºç´¢å¼•åº“</h2>\n<h3 id=\"421-åˆ©ç”¨kibanaçš„devtoolsåˆ›å»ºç´¢å¼•åº“\"><a class=\"anchor\" href=\"#421-åˆ©ç”¨kibanaçš„devtoolsåˆ›å»ºç´¢å¼•åº“\">#</a> 4.2.1ã€åˆ©ç”¨ kibana çš„ DevTools åˆ›å»ºç´¢å¼•åº“</h3>\n<p>åœ¨ DevTools ä¸­è¾“å…¥æŒ‡ä»¤ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>PUT /indexName</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"settings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token property\">\"number_of_shards\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// åˆ†ç‰‡æ•°é‡</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"number_of_replicas\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token comment\">// å‰¯æœ¬æ•°é‡</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token property\">\"mappings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>         <span class=\"token comment\">//mapping æ˜ å°„å®šä¹‰ ...</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161201547.png\" alt=\"image-20231016120105950\" /></p>\n<p>å¡«å†™å®Œæˆåç‚¹å‡» create åˆ›å»ºç´¢å¼•åº“</p>\n<p>å›åˆ°é¦–é¡µ</p>\n<p>å¯ä»¥çœ‹åˆ°æ•°æ®è¢«æˆåŠŸçš„åˆ†æˆäº†ä¸‰ç‰‡ï¼Œåç§°ä¸º itcast</p>\n<p>ä½†æ˜¯è¿˜åŠ äº†ä¸€ä¸ªå‰¯æœ¬ï¼Œæ¯ä¸€ç‰‡éƒ½åŠ ä¸€ä¸ªå‰¯æœ¬å°±æ˜¯ 3 * 2 = 6 ç‰‡</p>\n<p>å…¶ä¸­å®çº¿å°±æ˜¯ä½åˆ†ç‰‡ï¼Œè™šçº¿å°±æ˜¯å‰¯æœ¬åˆ†ç‰‡ï¼ˆå°±æ˜¯æ‹·è´äº†ä¸€ä»½ï¼‰</p>\n<p>æ¯ä¸€ä¸ªåˆ†ç‰‡å®ƒçš„å¤‡ä»½éƒ½åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œè¿™æ ·å°±ç¡®ä¿äº†ä»»æ„ä¸€å°æœºå™¨å®•æœºï¼Œé‚£çš„å¤‡ä»½ä¾ç„¶è¿˜ä¿ç•™ç€é¿å…å‡ºç°æ•°æ®æ•…éšœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161202468.png\" alt=\"image-20231016120225681\" /></p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "Elasticsearch",
                "è®¡ç®—æœºå­¦ç§‘",
                "åŸºç¡€",
                "springcloud",
                "Elasticsearch"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Elasticsearch/%E6%A1%88%E4%BE%8Bsql/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Elasticsearch/%E6%A1%88%E4%BE%8Bsql/",
            "title": "esæ¡ˆä¾‹",
            "date_published": "2024-01-06T02:31:36.585Z",
            "content_html": "<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> Navicat Premium Data Transfer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> Source Server         : local</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> Source Server Type    : MySQL</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> Source Server Version : 50622</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> Source Host           : localhost:3306</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> Source Schema         : heima</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> Target Server Type    : MySQL</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> Target Server Version : 50622</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> File Encoding         : 65001</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> Date: 06/05/2021 18:31:05</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">SET</span> NAMES utf8mb4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">-- Table structure for tb_hotel</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span>  <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…’åº—id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…’åº—åç§°'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>address<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…’åº—åœ°å€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>price<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…’åº—ä»·æ ¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>score<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…’åº—è¯„åˆ†'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>brand<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…’åº—å“ç‰Œ'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>city<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æ‰€åœ¨åŸå¸‚'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>star_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…’åº—æ˜Ÿçº§ï¼Œ1æ˜Ÿåˆ°5æ˜Ÿï¼Œ1é’»åˆ°5é’»'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>business<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å•†åœˆ'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>latitude<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'çº¬åº¦'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>longitude<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç»åº¦'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>pic<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…’åº—å›¾ç‰‡'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> <span class=\"token operator\">=</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> <span class=\"token operator\">=</span> utf8mb4_general_ci ROW_FORMAT <span class=\"token operator\">=</span> Compact<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">-- Records of tb_hotel</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">36934</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(ä¸Šæµ·å®å±±è·¯åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é™å®‰äº¤é€šè·¯40å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">336</span><span class=\"token punctuation\">,</span> <span class=\"token number\">37</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››å·åŒ—è·¯å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.251433'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.47522'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/3E/40/Cii9EVkyLrKIXo1vAAHgrxo_pUcAALcKQLD688AAeDH564_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">38609</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—(ä¸Šæµ·èµ¤å³°è·¯åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¹¿çµäºŒè·¯126å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">249</span><span class=\"token punctuation\">,</span> <span class=\"token number\">35</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››å·åŒ—è·¯å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.282444'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.479385'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/DF/96/Cii-TFkx0ImIQZeiAAITil0LM7cAALCYwKXHQ4AAhOi377_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">38665</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—ä¸Šæµ·ä¸­å±±åŒ—è·¯å…°ç”°è·¯åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å…°ç”°è·¯38å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">226</span><span class=\"token punctuation\">,</span> <span class=\"token number\">35</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é•¿é£å…¬å›­åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.244288'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.422419'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/EF/86/Cii-Tlk2mV2IMZ-_AAEucgG3dx4AALaawEjiycAAS6K083_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">38812</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(ä¸Šæµ·æ¼•æºªè·¯åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¾æ±‡é¾™åè¥¿è·¯315å¼„58å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">298</span><span class=\"token punctuation\">,</span> <span class=\"token number\">37</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å…«ä¸‡äººä½“è‚²åœºåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.174377'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.442875'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/E0/0E/Cii-TlkyIr2IEWNoAAHQYv7i5CkAALD-QP2iJwAAdB6245_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">39106</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—ï¼ˆä¸Šæµ·è˜åº„åœ°é“ç«™åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é—µè¡Œè˜åº„é•‡ä¸ƒè˜è·¯299å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">348</span><span class=\"token punctuation\">,</span> <span class=\"token number\">41</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è˜åº„å·¥ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.113812'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.375869'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/D8/11/Cii-T1ku2zGIGR7uAAF1NYY9clwAAKxZAHO8HgAAXVN368_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">39141</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(ä¸Šæµ·äº”è§’åœºå¤æ—¦åŒæµå¤§å­¦åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¨æµ¦å›½æƒè·¯315å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">349</span><span class=\"token punctuation\">,</span> <span class=\"token number\">38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±Ÿæ¹¾ã€äº”è§’åœºå•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.290057'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.508804'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/C7/E3/Cii-T1knFXCIJzNYAAFB8-uFNAEAAKYkQPcw1IAAUIL012_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">45845</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·è¥¿è—å¤§å¦ä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è™¹æ¡¥è·¯100å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">589</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¾å®¶æ±‡åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.192714'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.434717'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/48GNb9GZpJDCejVAcQHYWwYyU8T_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">45870</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ä¸´æ¸¯è±ªç”Ÿå¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ–°å…ƒå—è·¯555å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">896</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è±ªç”Ÿ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ»´æ°´æ¹–ä¸´æ¸¯åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'30.871729'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.81959'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2F5HoQvBgypoDUE46752ppnQaTqs_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">46829</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·æµ¦è¥¿ä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ’ä¸°è·¯338å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">726</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ç«è½¦ç«™åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.242977'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.455864'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/x87VCoyaR8cTuYFZmKHe8VC6Wk1_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">47066</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·æµ¦ä¸œä¸œç«™åç¾è¾¾é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ–½æ–°è·¯958å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">408</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œæœºåœºæ ¸å¿ƒåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.147989'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.759199'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2pNujAVaQbXACzkHp8bQMm6zqwhp_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">47478</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—(ä¸Šæµ·æ¾æ±Ÿä¸­å¿ƒåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¾æ±Ÿè£ä¹ä¸œè·¯677å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">428</span><span class=\"token punctuation\">,</span> <span class=\"token number\">35</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä½˜å±±ã€æ¾æ±Ÿå¤§å­¦åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.016712'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.261606'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/filebroker/cdn/res/07/36/073662e1718fccefb7130a9da44ddf5c_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">56201</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·é½é²ä¸‡æ€¡å¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸œæ–¹è·¯838å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">873</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œé™†å®¶å˜´é‡‘èè´¸æ˜“åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.226031'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.525801'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/B6/Cii-TF3eXKeIJeN7AASiKHbTtx4AAGRegDSBzMABKJA111_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">56214</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·æµ¦ä¸œåç¾è¾¾å¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ–°é‡‘æ¡¥è·¯18å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">830</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œé‡‘æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.244916'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.590752'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3jtXiuMKZEXJAuKuAkc47yLCjUBt_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">56227</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·åœ£æ·˜æ²™ä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å—æ¡¥é•‡å—æ¡¥è·¯1å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">899</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¥‰è´¤å¼€å‘åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'30.910917'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.456525'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/B9/Cii-U13eXSiIdJjXAARSA6FywFYAAGRnwHvy1AABFIb158_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">56392</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·é“¶æ˜Ÿçš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç•ªç¦ºè·¯400å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">809</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¾å®¶æ±‡åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.202768'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.429524'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/37ucQ38K3UFdcRqntJ8M5dt884HR_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">56852</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·è´¢å¤§è±ªç”Ÿå¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ­¦ä¸œè·¯188å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">592</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è±ªç”Ÿ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±Ÿæ¹¾/äº”è§’åœºå•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.304182'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.492936'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2jGHezLZvPZqC9cBGesbP5vAhCXi_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">56912</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·åå‡¯åç¾è¾¾å¹¿åœºé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœˆåè·¯9å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">747</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¥‰è´¤å¼€å‘åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'30.814382'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.464521'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/45iaCNCuZavJTxwTLskhVKzwynLD_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">56977</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·äº”è§’åœºåç¾è¾¾å¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é»„å…´è·¯1888å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">499</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±Ÿæ¹¾/äº”è§’åœºå•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.292932'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.519759'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/26VREqAQdaGFvJdAJALVtjxcNMpL_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60214</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·é‡‘èŒ‚å›æ‚¦å¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸–çºªå¤§é“88å·ï¼ˆ54æ¥¼åŠç†å…¥ä½ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">699</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œé™†å®¶å˜´é‡‘èè´¸æ˜“åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.235152'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.506082'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/7Azm3jvGUHuXe3eS1DrixAWVTXY_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60223</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å¸Œå°”é¡¿é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é™å®‰åå±±è·¯250å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2688</span><span class=\"token punctuation\">,</span> <span class=\"token number\">37</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸Œå°”é¡¿'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é™å®‰å¯ºåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.219306'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.445427'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/filebroker/cdn/res/92/10/9210e74442aceceaf6e196d61fc3b6b1_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60359</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å¤–é«˜æ¡¥çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¨é«˜åŒ—è·¯1000å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3299</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œå¤–é«˜æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.338944'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.590611'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/VcKUM9zUSiVgDhFioc6mWQoX9ES_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60363</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·æ–°ä¸–ç•Œä¸½ç¬™å¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å—äº¬è¥¿è·¯88å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1341</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸½ç¬™'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äººæ°‘å¹¿åœºåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.23462'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.47327'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2j31b7X3YzGkf4Li3phS6TG1mtwm_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60398</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å¤æ—¦çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é‚¯éƒ¸è·¯199å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">924</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±Ÿæ¹¾/äº”è§’åœºå•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.295382'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.502537'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2H1Gk8LHaBWZfYvR6NYYcGTvACmL_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60487</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å¤–æ»©èŒ‚æ‚¦å¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é»„æµ¦è·¯199å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">689</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤–æ»©åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.245409'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.492969'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2Swp2h1fdj9zCUKsk63BQvVgKLTo_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60522</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å˜‰è±ªæ·®æµ·å›½é™…è±ªç”Ÿé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±¾é˜³è·¯1å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">425</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è±ªç”Ÿ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·®æµ·è·¯/æ–°å¤©åœ°åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.215497'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.456297'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/38UBi4QYuaF8jN94CxQ7tb7tjtmZ_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60916</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ç»¿åœ°ä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ²ªå®œå…¬è·¯3101å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">328</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å˜‰å®šæ–°åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.368523'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.258567'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3VLwG9tTQQnp3M3MTeMTdx9nas9B_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60922</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·è™¹æ¡¥ç¥¥æºå¸Œå°”é¡¿é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çº¢æ¾ä¸œè·¯1116å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1108</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸Œå°”é¡¿'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è™¹æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.18746'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.395312'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/tQRqDTFkHnHzMZiDKjcGV81ekvc_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60935</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·è™¹å£ä¸‰è‡³å–œæ¥ç™»é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››å¹³è·¯59å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1899</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››å·åŒ—è·¯å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.2579'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.487954'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3C3gxLxLjVwnkxJwJm8rd3f38kcd_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">61075</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·é›…å±…ä¹ä¸‡è±ªé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿è—ä¸­è·¯555å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1152</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äººæ°‘å¹¿åœºåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.236681'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.473529'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3FoT16PkXavKsssvktVvVq5Si6Cr_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">61083</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·æ»´æ°´æ¹–çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è‡ªç”±è´¸æ˜“è¯•éªŒåŒºä¸´æ¸¯æ–°ç‰‡åŒºå—å²›1å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">971</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ»´æ°´æ¹–ä¸´æ¸¯åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'30.890867'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.937241'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/312e971Rnj9qFyR3pPv4bTtpj1hX_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">309208</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬ç‹åºœäº•å¸Œå°”é¡¿é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç‹åºœäº•ä¸œè¡—8å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1679</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸Œå°”é¡¿'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤©å®‰é—¨/ç‹åºœäº•åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.914539'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.413392'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/10/Cii-TF3ePt2IX9UEAALb6VYBSmoAAGKMgGsuW8AAtwB147_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">394559</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬ä¸œæ–¹å›æ‚¦å¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é•¿å®‰è¡—1å·ä¸œæ–¹å¹¿åœº'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">686</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤©å®‰é—¨/ç‹åºœäº•åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.909635'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.414621'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3mFqcNSh7eEo9yc3Rw2P5HDNTdDe_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">394617</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬å®è¾°é¥­åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å»ºå›½é—¨å†…å¤§è¡—ç”²18å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">418</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è±ªç”Ÿ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬ç«™/å»ºå›½é—¨åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.905768'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.428153'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/NEYa6EfDHuhhb19Ct85WBbkKHZU_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">394796</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬æ–°äº‘å—çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸œåŒ—ä¸‰ç¯è¥¿åæ²³å¤ªé˜³å®«æ¡¥ä¸œåŒ—è§’äº‘å—å¤§å¦'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">485</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›½å±•ä¸­å¿ƒåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.972409'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.434698'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/dfP8K782eTsohQWSRdkd7St9LA2_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">395434</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬å¸Œå°”é¡¿é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸œä¸‰ç¯åŒ—è·¯ä¸œæ–¹è·¯1å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">350</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸Œå°”é¡¿'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç‡•è/æœé˜³å…¬å›­å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.952703'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.462387'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3fwNbKGhk6XCrkdVyxwhC5uGpLVy_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">395702</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬é¦–éƒ½æœºåœºå¸Œå°”é¡¿é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¦–éƒ½æœºåœº3å·èˆªç«™æ¥¼ä¸‰ç»è·¯1å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">222</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸Œå°”é¡¿'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¦–éƒ½æœºåœº/æ–°å›½å±•åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.048969'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.619566'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/10/Cii-U13ePtuIMRSjAAFZ58NGQrMAAGKMgADZ1QAAVn_167_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">395787</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬æµ·èˆªå¤§å¦ä¸‡è±ªé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'éœ„äº‘è·¯ç”²26å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1302</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç‡•è/æœé˜³å…¬å›­å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.959861'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.467363'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3zFiWi2C9SmbcQwCZgJFQC9ahvs5_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">395799</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬å›½é™…è‰ºè‹‘çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç‹åºœäº•å¤§è¡—48å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">636</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤©å®‰é—¨/ç‹åºœäº•åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.918994'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.411277'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/10/Cii-U13ePvyIahjPAAMykV278aEAAGKOQO9e4UAAzKp283_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">395815</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬æ˜è±ªåç¾è¾¾é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤©ç«ºé•‡åºœå‰ä¸€è¡—13å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">558</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¦–éƒ½æœºåœº/æ–°å›½å±•åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.062832'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.580678'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/13/Cii-U13eP2mIKCwvAAODTZXT-fAAAGKVAA9taIAA4Nl245_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">396189</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬æœé˜³æ‚ å”çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰ä¸°åŒ—é‡Œ3å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">944</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é‡Œå±¯/å·¥ä½“/ä¸œç›´é—¨åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.92129'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.43847'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/tT6ipLain1ZovR5gnQ7tJ4KKym5_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">396471</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³é…’åº—ï¼ˆåŒ—äº¬èŠ±å›­è·¯åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ·æ·€åŒ—å¤ªå¹³åº„èŠ±å›­è·¯ç”²17å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">381</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é©¬ç”¸ã€å®‰è´åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.970837'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.365244'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/filebroker/cdn/res/17/00/1700926908bae6ba3e5ef96de7b7d4cc_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">396506</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬é‡‘éš…å–œæ¥ç™»é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—ä¸‰ç¯ä¸œè·¯36å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">357</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é©¬ç”¸/å®‰è´åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.967163'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.4099'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/29FW2WtGzzUtPhWR1LKxcFZAVa9P_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">413460</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(åŒ—äº¬å¤©å›åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸œåŸå¤©å›ä¸œé‡Œç”²48å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">753</span><span class=\"token punctuation\">,</span> <span class=\"token number\">38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‰é—¨ã€å´‡æ–‡é—¨å•†è´¸åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.875786'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.421987'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/C7/D8/Cii-T1knCK6IWTtxAAI0plLButMAAKYTAJu-woAAjS-422_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">413476</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(åŒ—äº¬å—ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸°å°é©¬å®¶å ¡è¥¿è·¯22å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">478</span><span class=\"token punctuation\">,</span> <span class=\"token number\">37</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ°¸å®šé—¨ã€å—ç«™ã€å¤§çº¢é—¨ã€å—è‹‘åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.845363'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.372327'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/26/B7/Cii-U1knCtaISM4VAAHkEQd-mrAAAKw0ALVCwEAAeQp741_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">414168</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(åŒ—äº¬è¥¿ç›´é—¨åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿åŸå¹³å®‰é‡Œè¥¿å¤§è¡—ç¿ èŠ±è¡—è‚²å¹¼èƒ¡åŒç”²20-22å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">419</span><span class=\"token punctuation\">,</span> <span class=\"token number\">37</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿å•ã€é‡‘èè¡—åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.931338'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.364982'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/bc/66/bc666859edf4fc072a8006c66758058d_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">414481</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(åŒ—äº¬å›¢ç»“æ¹–åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœé˜³å›¢ç»“æ¹–åŒ—é‡Œ9å·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">525</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç‡•èã€ä¸‰é‡Œå±¯å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.928457'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.466132'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/38/2D/Cii9EFkv2-uIPTaBAALX6P-rbdUAALPpwHv4ykAAtgA277_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">414698</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—ï¼ˆåŒ—äº¬798è‰ºæœ¯åŒºåº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœé˜³åŒ—äº¬å¸‚æœé˜³åŒºé…’ä»™æ¡¥åŒ—è·¯ï¼ˆ798è‰ºæœ¯åŒºåŒ—é—¨ï¼‰å½©è™¹è·¯6å·-ç”µé€šåˆ›æ„å¹¿åœºå¤§é™¢å†…'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">553</span><span class=\"token punctuation\">,</span> <span class=\"token number\">37</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœ›äº¬ã€é…’ä»™æ¡¥ã€798åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.990671'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.498452'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/D8/11/Cii-T1ku2zqIN7SiAAEdvT6RrjUAAKxZQKFooYAAR3V090_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">415600</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(åŒ—äº¬æœé˜³åŒ—è·¯ä¼ åª’å¤§å­¦è¤¡è£¢å¡åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é—´æˆ¿ä¹¡è¤¡è£¢å¡æ‘é’å¹´æ²Ÿè¥¿ä¾§558å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">259</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¼ åª’å¤§å­¦/ç®¡åº„åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.923212'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.560023'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3NezpxNZWQMdNXibwbMkQuAZjDyJ_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">415659</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—ï¼ˆåŒ—äº¬ç´«ç«¹æ¡¥åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ·æ·€åŒ—æ´¼è·¯ç”²3å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">781</span><span class=\"token punctuation\">,</span> <span class=\"token number\">42</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿ç›´é—¨åŠåŒ—äº¬å±•è§ˆé¦†åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.936138'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.302405'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/3C/22/Cii9EVkxPMqIZJz-AAIh0esETAIAALXbgNQkH8AAiHp053_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">416121</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(åŒ—äº¬è¥¿å®¢ç«™åŒ—å¹¿åœºåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è²èŠ±æ± ä¸œè·¯120-2å·6å±‚'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">275</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬è¥¿ç«™/ä¸½æ³½å•†åŠ¡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.896449'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.317382'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/42DTRnKbiYoiGFVzrV9ZJUxNbvRo_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">416260</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(åŒ—äº¬é€šå·å…«é‡Œæ¡¥åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ°¸é¡ºé•‡è¥¿é©¬åº„å°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">534</span><span class=\"token punctuation\">,</span> <span class=\"token number\">38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœå›­ç¯å²›ã€é€šå·åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.915443'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.631871'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/DF/5A/Cii-TlkxkeGIKM0oAAGOb64RvToAALBAAH9Fg8AAY6H201_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">416268</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢é…’åº—(åŒ—äº¬ä¼ åª’å¤§å­¦è´¢æ»¡è¡—åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœé˜³è·¯é«˜äº•176å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">524</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›½è´¸åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.918277'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.53015'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/13/Cii-TF3eP5GIJIOLAAUwsIVCxdAAAGKXgK5a0IABTDI239_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">416307</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—(åŒ—äº¬æ–°å›½å±•é¦–éƒ½æœºåœºåæ²™å³ªåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åæ²™å³ªé•‡è£•æ°‘å¤§è¡—32å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">350</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¦–éƒ½æœºåœº/æ–°å›½å±•åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.099019'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.543655'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/3E/Cii-TF3eRgGIHCkKAAP_ATvriiQAAGL0AIoLtUAA_8Z513_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">432335</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(ä¸Šæµ·åŒ—å¤–æ»©å›½é™…å®¢è¿ä¸­å¿ƒåœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å”å±±è·¯145å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">249</span><span class=\"token punctuation\">,</span> <span class=\"token number\">35</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—å¤–æ»©åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.252585'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.498753'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/c1/ba/c1baf64418437c56617f89840c6411ef_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">433576</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(ä¸Šæµ·å—äº¬è·¯æ­¥è¡Œè¡—åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å—äº¬ä¸œè·¯480å·ä¿å®‰åŠå†…'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">379</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äººæ°‘å¹¿åœºåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.236454'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.480948'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/BA/Cii-U13eXVaIQmdaAAWxgzdXXxEAAGRrgNIOkoABbGb143_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">434082</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—Â·neo(ä¸Šæµ·å¤–æ»©åŸéšåº™å°å—é—¨åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤å…´ä¸œè·¯260å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">392</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è±«å›­åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.220706'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.498769'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/B6/Cii-U13eXLGIdHFzAAIG-5cEwDEAAGRfQNNIV0AAgcT627_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">441836</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(åŒ—äº¬å›½å±•ä¸‰å…ƒæ¡¥åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿åæ²³ä¸œé‡Œ36å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">458</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›½å±•ä¸­å¿ƒåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.966238'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.450142'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/39/Cii-TF3eRTGITp1UAAYIilRD7skAAGLngIuAnQABgii479_w200_h200_c1_t0.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">485775</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(ä¸Šæµ·é—µè¡Œåä¸œå¸ˆèŒƒå¤§å­¦å´æ³¾åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å´æ³¾é•‡å®ç§€è·¯977å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">161</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº¤å¤§/é—µè¡Œç»æµå¼€å‘åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.047135'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.46224'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/V8pz15CkiMX5xYJRmbbp5zkKWJ8_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">489756</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(åŒ—äº¬å¹³è°·åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ–‡åŒ–åŒ—è¡—4-16å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">544</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¹³è°·åŸåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.14308'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'117.111554'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/2e/b4/2eb4edb22ddb981307d8570beb1d746d_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">517915</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—Â·neo(æ·±åœ³è‰åŸ”åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸ƒå‰è·¯1036å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">159</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç”°è´/æ°´è´ç å®åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.583191'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.118499'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/228vhBCQmFRFWQBYX1cgoFQb6x58_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">527938</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å¥½æ—¥å­çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç¦åä¸€è·¯28å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">590</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¼šå±•ä¸­å¿ƒ/CBD'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.537153'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.053529'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/b6Ztz5jn4MngK3Hzfxuu9JGsjrm_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">541619</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(ä¸Šæµ·è˜åº„åœ°é“ç«™é¾™ä¹‹æ¢¦å•†ä¸šå¹¿åœºåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è˜åº„é•‡è˜æµœè·¯172å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">149</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è˜åº„å·¥ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.105797'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.37755'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3mKs3jETvJDj3dDdkRB9UyLLvPna_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">542068</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·èŒ‚ä¸šåç¾è¾¾å¹¿åœºé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ²ªå—è·¯938å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">646</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œæ–°å›½é™…åšè§ˆä¸­å¿ƒ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.182761'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.554106'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2139uDFUZ2VKxrathwSeeE4DwyFU_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">546869</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å½­å¹´ä¸‡ä¸½é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å˜‰å®¾è·¯2002å·ï¼ˆæ¯—é‚»é‡‘å…‰åè´­ç‰©å¹¿åœºï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">701</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡ä¸½'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç½—æ¹–å£å²¸/ç«è½¦ç«™'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.540989'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.122665'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/gwAbqEXFUpjUBmnxUfK89p3zBBT_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">581859</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³é…’åº—ï¼ˆåŒ—äº¬ä¸°ç›Šæ¡¥åº—ï¼‰ï¼ˆåŸç”³æ™¨é…’åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸°å°ä¸°ç®¡è·¯8å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">648</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬è¥¿ç«™ã€ä¸½æ³½å•†åŠ¡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.857707'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.312482'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/97/43/97438481b9e79abad429e5c30d7f303f_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">584697</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—ï¼ˆæ·±åœ³åå¼ºèµ›æ ¼å¹¿åœºåº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åå¼ºå—è·¯3024å·èµ›æ ¼è‹‘1æ ‹'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">362</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åå¼ºåŒ—å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.539831'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.087899'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/D8/11/Cii-T1ku2zmIcP4sAAEw8iuLXFgAAKxZQH7HVYAATEK972_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">593228</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—ï¼ˆåŒ—äº¬é¢å’Œå›­åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ·æ·€å¢çº¢æ——è·¯åŠŸå¾·å¯ºæ¡¥åŒ—ä¾§'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">730</span><span class=\"token punctuation\">,</span> <span class=\"token number\">38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¦™å±±ã€å…«å¤§å¤„é£æ™¯åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.003959'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.256718'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/55/84/55841f502c5a711e66dd5454b64f559b_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">598591</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ä¸½æ˜‚è±ªç”Ÿå¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é‡‘æ–°è·¯99å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">529</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è±ªç”Ÿ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œé‡‘æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.252496'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.600085'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2KfPPyPx9rWyVXif2CUuxv61Nryc_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">607915</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­é…’åº—(æ·±åœ³çš‡å²—åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ»¨æ²³å¤§é“6033å·æµ·æ»¨å¹¿åœºå›½çš‡å¤§å¦3æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">313</span><span class=\"token punctuation\">,</span> <span class=\"token number\">42</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å²—å£å²¸/ç¦ç”°å£å²¸'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.528101'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.064221'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/qMyCJVYuW21nsCeEBt8CMfmEhra_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">608374</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(ä¸Šæµ·æµ¦ä¸œæœºåœºé¾™ä¸œå¤§é“åˆåº†åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸œå·å…¬è·¯5863å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">160</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œæœºåœºæ ¸å¿ƒåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.237662'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.718556'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/LUYxGGV4pzjKeN5a69K4deU8JD8_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">609023</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—Â·neo(ä¸Šæµ·å¤–é«˜æ¡¥ä¿ç¨åŒºåŒ—åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'èŠ±å±±è·¯1209å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">266</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œå¤–é«˜æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.351148'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.585606'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3cJ6KTfms9cfEnME8WRkQQBXBkYm_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">609372</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è±ªæ´¾ç‰¹åç¾è¾¾å¹¿åœºé…’åº—(æ·±åœ³åŒ—ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ°‘æ²»è¡—é“æ¢…é¾™è·¯ä¸æ°‘æ—ºè·¯äº¤æ±‡å¤„'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">498</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³åŒ—ç«™åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.620501'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.033874'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3G5TnUCPbjGYHAVWfvuixw8bs69t_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">624417</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å›æ‚¦é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å®å®‰å—è·¯1881å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">442</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±¡åŸ/äº¬åŸº100'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.537247'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.111182'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/45/EA/Cii-TF3ZpVmIVDJ9AAXvJftz_AgAAFrrQKbI4oABe89086_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">628327</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—Â·neo(æ·±åœ³ç½—æ¹–å£å²¸å›½è´¸åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äººæ°‘å—è·¯2011å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">223</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç½—æ¹–å£å²¸/ç«è½¦ç«™'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.536734'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.118336'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2rKHmQWHYiY8GZA3xBHpFKCLZwZo_w200_h200_c1_t0.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">629023</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢é…’åº—(åŒ—äº¬åé‡Œæ²³æ¬¢ä¹è°·åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åå…«é‡Œåº—ä¹¡å‘¨å®¶åº„288å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">390</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŠ²æ¾/æ½˜å®¶å›­åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.853354'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.483437'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/28hnDdqn5uzuzCKYkw2x4pYmunXM_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">629729</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(ä¸Šæµ·å¼ æ±Ÿé«˜ç§‘å›­åŒºåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œæ–°åŒºè”¡ä¼¦è·¯103å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">267</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œå¼ æ±Ÿåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.196154'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.62071'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/d9/61/d961508a10865b9b29c033064f31b913_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">635963</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³é¾™å²—ç æ±Ÿçš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¾™å²—ä¸­å¿ƒåŸé¾™ç¿”å¤§é“9009å·ç æ±Ÿå¹¿åœº'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">737</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¾™å²—ä¸­å¿ƒåŒº/å¤§è¿æ–°åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.722941'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.250002'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/45/EA/Cii-U13ZpWGIasKjAAY1SNE36KMAAFrrwMNoAwABjVg973_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">636080</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å¤§ä¸­åå–œæ¥ç™»é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç¦åè·¯ä¸€å·å¤§ä¸­åå›½é™…äº¤æ˜“å¹¿åœº'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1556</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¼šå±•ä¸­å¿ƒ/CBD'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.535567'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.062005'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3hQRTmAUW9PegTjxMiEfYwh2HnKp_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">644417</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å¤–é«˜æ¡¥å–œæ¥ç™»é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è‡ªç”±è´¸æ˜“è¯•éªŒåŒºåŸºéš†è·¯28å·ï¼ˆäºŒå·é—¨å†…ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2419</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œå¤–é«˜æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.350989'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.588751'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/1Rrtg9n7PdMEivVDhsehbJBrEre_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">648219</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·é‡‘æ¡¥çº¢æ«ä¸‡è±ªé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ–°é‡‘æ¡¥è·¯15å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">891</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œé‡‘æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.244061'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.591153'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/B6/Cii-TF3eXKuIR_a0AAUx-Xd2JLQAAGRfACSpvUABTIR560_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">657192</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å®å®‰ä¸­å¤©ç¾æ™¯åç¾è¾¾é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ–°æ¡¥è¡—é“ä¸‡ä¸°ç¤¾åŒºä¸­å¿ƒè·¯7-1å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">498</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å›½é™…ä¼šå±•ä¸­å¿ƒå•†åœˆ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.716473'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.826391'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/45/EA/Cii-U13ZpVeIRbhTAAOzGZSDtlcAAFrrQEWM-AAA7Mx626_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">659496</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³é…’åº—(æ·±åœ³å›½ç‹åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¾™åæ–°åŒºé¾™åé¾™è§‚è¥¿è·¯95å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">714</span><span class=\"token punctuation\">,</span> <span class=\"token number\">37</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³åŒ—ç«™åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.65892'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.006817'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/b4/76/b476cacc575a7ff237128ba2fd63923a_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">670673</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬é¾™åŸåç¾è¾¾é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ˜Œå¹³è·¯319å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">506</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›é¾™è§‚/å¤©é€šè‹‘åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.084219'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.304313'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/T3WruZV3S4MfcxdD1HFVhZjaBLW_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">672207</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢è‡³å°Šé…’åº—(åŒ—äº¬æœ›äº¬798åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é…’ä»™æ¡¥åŒ—è·¯9å·è§å±é‡Œ4å·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">579</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœ›äº¬/é…’ä»™æ¡¥/798åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.98835'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.491217'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2y56zwK8kd2tBuRUyF7XeJ2ucvWM_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">684720</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢é…’åº—(æ·±åœ³ç½—æ¹–å£å²¸ç«è½¦åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ²¿æ²³å—è·¯1064å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">208</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç½—æ¹–å£å²¸/ç«è½¦ç«™'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.533753'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.122491'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2LFgB2iFawKKoGADwzhW6jpCSaJT_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">696948</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·æ–°å›­åç¾è¾¾å¹¿åœºé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¼•å®è·¯509å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1290</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å…‰å¤§ä¼šå±•ä¸­å¿ƒ/æ¼•æ²³æ³¾åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.163802'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.405618'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/B6/Cii-TF3eXHuIE57sAAZx8iP6rMIAAGRbgAH09gABnIK621_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">706343</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—ï¼ˆåŒ—äº¬è¥¿å®¢ç«™åŒ—å¹¿åœºåº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸°å°è²èŠ±æ± ä¸œè·¯126å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">268</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬è¥¿ç«™ã€ä¸½æ³½å•†åŠ¡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.896623'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.315586'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/E3/46/Cii-TlkzMXWIL0sAAAGG8a3YwiwAALJlgG-r5YAAYcJ067_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">707357</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³é…’åº—ï¼ˆä¸Šæµ·å—ç«™å…‰å¤§åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¾æ±‡æ¡‚æ—è·¯46å·ï¼ˆé’¦å·å—è·¯è·¯å£å¾€å—100ç±³ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3288</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å…‰å¤§ä¼šå±•ä¸­å¿ƒ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.156297'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.419948'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/f7/13/f713f8f98d777d8d53aafefb37a79ef6_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">711837</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—ï¼ˆåŒ—äº¬ç«‹æ°´æ¡¥åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœé˜³å®‰ç«‹è·¯3å·1å¹¢3å±‚'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">268</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºšè¿æ‘ã€å¥¥ä½“ä¸­å¿ƒåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.043717'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.410962'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/b3/87/b3876eaf16af62521cf6fb474504b8ca_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">727679</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(æ·±åœ³æ­¥è¡Œè¡—è€è¡—åœ°é“ç«™äºŒåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç½—æ¹–åŒºä¸œé—¨ä¸­è·¯2216å·åä½³å¹¿åœº12-14æ¥¼ï¼ˆä¸œé—¨å¤©æ¡¥ä¸œå¤´ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">742</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸œé—¨å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.54585'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.122227'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/39/99/Cii9EFkwVMKIP_mCAAI3fOHlS1wAALSDAMeO2MAAjeU309_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">728180</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(æ·±åœ³å®å®‰è¥¿ä¹¡åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿ä¹¡å¤§é“298-7å·ï¼ˆå¯Œé€šåŸäºŒæœŸå…¬äº¤ç«™æ—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">184</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å®å®‰ä½“è‚²ä¸­å¿ƒå•†åœˆ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.569693'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.860186'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/FHdugqgUgYLPMoC4u4rdTbAPrVF_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">728415</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—Â·neo(æ·±åœ³ä¸œé—¨æ­¥è¡Œè¡—æ™’å¸ƒåœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ™’å¸ƒè·¯67å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">152</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸œé—¨å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.550183'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.120771'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/25/57/Cii-U13PFNWISSnQAAEpTtoilsQAAEVWgEvur8AASlm647_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">728461</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­é…’åº—(æ·±åœ³ä¼šå±•ä¸­å¿ƒåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ–°æ´²è·¯ä¸–çºªå·¥è‰ºå“å¹¿åœº307æ ‹'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">258</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å²—å£å²¸/ç¦ç”°å£å²¸'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.518026'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.046061'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/25/56/Cii-TF3PFKOIPl0JAANm4ge6DdMAAEVTQK2SP8AA2b6365_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">728604</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—Â·neo(æ·±åœ³å—å±±åœ°é“ç«™å—å±±å¸‚åœºåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å—æ–°è·¯é¡ºå¯Œè¡—18å·åŒ–å·å¤§å¦'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">198</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç§‘æŠ€å›­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.525561'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.920058'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/25/57/Cii-TF3PFLmIDGWiAAPHkaNTuOIAAEVVQBGazAAA8ep611_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">730454</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(æ·±åœ³ä¸‡è±¡åŸåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç½—æ¹–åŒºå˜‰å®¾è·¯4025å·åŸå¸‚å¤©åœ°å¹¿åœºå†…'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">552</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç½—æ¹–å£å²¸/ç«è½¦ç«™'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.537078'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.113733'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/C8/4C/Cii-Tlknhz2IFnYNAAInF2jEK14AAKbcQNB5M8AAicv660_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">730569</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(æ·±åœ³æ¢…æ—å“è¶ŠåŸåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å­–å²­åœ°é“å£Cå‡ºå£å·¦æ‰‹è¾¹ï¼Œé’å¹´å­¦é™¢å¯¹é¢'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">269</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è²èŠ±å±±/æ¢…æ—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.568701'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.068464'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/D8/0B/Cii-Tlku2dOISeGXAAAUw3MvPrIAAKxYALB2VAAABTb555_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">730968</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(æ·±åœ³å®å®‰åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å®å®‰åŒºå®å®‰25åŒºåˆ›ä¸šäºŒè·¯æ­¥è¡Œè¡—é‡‘éº’éºŸæœè£…å¹¿åœº4æ ‹'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">314</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å®å®‰ä¸­å¿ƒåŒº/å‰æµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.568162'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.900968'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/D8/0B/Cii-T1ku2cqIWTOOAAAS_bvRI5UAAKxXwILCFYAABMV285_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">751035</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(ä¸Šæµ·è‡ªè´¸åŒºåŒ—é—¨åœ°é“ç«™åº—)(åŸå¤–é«˜æ¡¥åœ°é“åŒ—ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'èŠ±å±±è·¯706å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">328</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œå¤–é«˜æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.348029'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.576896'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/3A/21/Cii-U1kwxUCINXaHAAGmh7z6qRAAALUdwMKGREAAaaf928_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">844350</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(æ·±åœ³ä¸–ç•Œä¹‹çª—åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å—å±±åŒºç™½çŸ³æ´²æ²™æ²³è¡—2å·é‡‘ä¸‰è§’å¤§å¦'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">769</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åä¾¨åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.540501'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.968858'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/D8/11/Cii-TFku2zmIOdjCAAAQJpLFhEEAAKxZQIEvQ0AABA-920_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2316304</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(æ·±åœ³åŒé¾™åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¾™å²—è¡—é“é¾™å²—å¢Ÿç¤¾åŒºé¾™å¹³ä¸œè·¯62å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">135</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¾™å²—ä¸­å¿ƒåŒº/å¤§è¿æ–°åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.730828'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.278337'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/4AzEoQ44awd1D2g95a6XDtJf3dkw_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"143\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2329005</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³é…’åº—(æ·±åœ³åä¹‹æ²™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç¦å¼ºè·¯æ–°æ´²ä¹è¡—28å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">651</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å²—å£å²¸/ç¦ç”°å£å²¸'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.524835'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.048214'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/88/f0/88f05cd11990ef39ae187886c76f40a5_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2351601</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³è›‡å£å¸Œå°”é¡¿å—æµ·é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœ›æµ·è·¯1177å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">509</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸Œå°”é¡¿'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³æ¹¾å£å²¸/è›‡å£'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.479373'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.916013'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/45/EA/Cii-TF3ZpXOIfa6fAAJjiUOiuYgAAFrtgDtgpQAAmOh799_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2359697</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(åŒ—äº¬ä¸Šåœ°å®‰å®åº„ä¸œè·¯åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¸…æ²³å°è¥å®‰å®åº„ä¸œè·¯18å·20å·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">420</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šåœ°äº§ä¸šå›­/è¥¿ä¸‰æ——'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.041322'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.333316'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2wj2f8mo9WZQCmzm51cwkZ9zvyp8_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5865979</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬ä¸½éƒ½çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å°†å°è·¯6å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1168</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœ›äº¬/é…’ä»™æ¡¥/798åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.978133'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.478642'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/Yo4xL3RUsYUnDDc5QcQWj7sCrUX_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"147\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5870456</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å®åä¸‡è±ªé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¹¿ä¸­è¥¿è·¯333å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">922</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤§å®å›½é™…å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.279371'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.446327'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/BA/Cii-U13eXVqIZXDFAAUC_xbrQDAAAGRrwPRyOcABQMX057_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"148\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5871652</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·åœ£è¯ºäºšçš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é‡‘æ²™æ±Ÿè·¯1699å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">770</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é•¿é£å…¬å›­åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.232346'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.377709'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/J4sP7qRSHa9rFYnKTW75ZPB393M_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"149\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5872067</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å´‡æ˜é‡‘èŒ‚å‡¯æ‚¦é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é™ˆå®¶é•‡æ½æµ·è·¯799å¼„'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1024</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‡¯æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å´‡æ˜å²›/é•¿å…´å²›/æ¨ªæ²™å²›'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.466563'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.799671'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/fsKrbnNsmSsYnNLmhh3ZvVjZ5cA_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"150\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5873072</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—ï¼ˆä¸Šæµ·ç«è½¦ç«™åŒ—å¹¿åœºåº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é—¸åŒ—èŠ·æ±Ÿè¥¿è·¯796å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">190</span><span class=\"token punctuation\">,</span> <span class=\"token number\">41</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ç«è½¦ç«™åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.255579'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.452903'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/96/6d/966d6596e6cb7b48c9cc1d7da79b57c8_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">7094829</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­é…’åº—(æ·±åœ³åå¼ºå—åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¾å²­è·¯9å·ï¼ˆå—å›­å°å­¦å¯¹é¢ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">215</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åå¼ºåŒ—å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.536842'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.094316'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3WDhaZZ9yALHw8yNiU6HJyrdC3u5_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"152\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">189429168</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(åŒ—äº¬å¤§å…´é»„æ‘æ¸…æºè·¯åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¸…æºè¥¿è·¯55å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">392</span><span class=\"token punctuation\">,</span> <span class=\"token number\">38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤§å…´å†œä¸šç”Ÿæ€è§‚å…‰åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.743751'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.321676'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/4F/25/Cii9EFk3LmOIFtnDAAHm5kdIiM8AAL1FQM8kG0AAeb-418_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">197487869</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(åŒ—äº¬ç¬¬äºŒå¤–å›½è¯­å¤§å­¦å—é—¨åŒæ¡¥åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é—´æˆ¿ä¹¡æ–°æˆ¿æ‘1å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">321</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¼ åª’å¤§å­¦/ç®¡åº„åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.90635'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.565528'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/ZkgDAs8tTMvgFHdVPpikNqENEn1_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">197488318</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—ï¼ˆåŒ—äº¬ç«‹æ°´æ¡¥åœ°é“å—ç«™åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœé˜³åŒ—è‹‘è·¯18å·é™¢3å·æ¥¼4å±‚'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">344</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºšè¿æ‘ã€å¥¥ä½“ä¸­å¿ƒåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.043689'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.414138'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/36/4D/Cii9EVkvP72IYYjgAAF7yZeWV-wAALMQACOARMAAXvh983_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"155\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">197492277</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—ï¼ˆåŒ—äº¬å¹³è°·å…´è°·ç¯å²›åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¹³è°·å¹³è°·å¤§è¡—31å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">614</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¹³è°·åŸåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.159255'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'117.12401'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/38/D5/Cii9EFkwFCiII79zAAHKsXy_LAoAALQuQEmEZ4AAcrJ339_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"156\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">197492479</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(åŒ—äº¬é¡ºä¹‰ä¸­å¿ƒåœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å…‰æ˜å—å¤§è¡—14å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">306</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¡ºä¹‰æ¸©æ³‰ä¼‘é—²åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.124783'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.65751'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2hNBSjmMTk6JQ2o8ixr5s3ioevhB_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"157\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">197496182</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢é…’åº—(åŒ—äº¬å›¢ç»“æ¹–åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›¢ç»“æ¹–è·¯9å·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">341</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç‡•è/æœé˜³å…¬å›­å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.930731'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.466602'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2gK41VpMb4AwyNkwQEkfFo83uTUU_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">197496980</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—(åŒ—äº¬æ¸©éƒ½æ°´åŸç‹åºœåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ˜Œå¹³åŒ—ä¸ƒå®¶é•‡å¹³è¥¿åºœæ‘ï¼ˆæ¸©éƒ½æ°´åŸä¸œ200ç±³ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">585</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å°æ±¤å±±æ¸©æ³‰åº¦å‡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.10144'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.380641'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/C7/CB/Cii-T1km_5eICnpJAAHOWN1GylMAAKYJwF0Hp8AAc5w000_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"159\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">197516492</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—ï¼ˆåŒ—äº¬å—è‹‘ä¸œé«˜åœ°åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸°å°å—å¤§çº¢é—¨è·¯ä¸œè¥æˆ¿15å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">651</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ°¸å®šé—¨ã€å—ç«™ã€å¤§çº¢é—¨ã€å—è‹‘åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.78996'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.42081'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/3B/D8/Cii-U1kxKGWIQlaxAAIdkjkSALkAALXDQMFbTsAAh2q158_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"160\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">197835483</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(æ·±åœ³å¤§å­¦æ¡ƒå›­åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å—å±±åŒºæ¡ƒå›­è¥¿è·¯160å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">431</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç§‘æŠ€å›­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.532576'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.916362'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/38/40/Cii9EFkv4XKIQN85AAFUcDrkXe0AALPvwPRn08AAVSI037_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"161\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">197837109</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—Â·neo(æ·±åœ³é¾™å²—å¤§é“å¸ƒå‰åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸ƒå‰é•‡æ·±æƒ è·¯é¾™ç å•†åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">127</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸ƒå‰/æ·±åœ³ä¸œç«™'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.602482'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.123284'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/25/58/Cii-TF3PFZOIA7jwAAKInGFN4xgAAEVbAGeP4AAAoi0485_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"162\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">198323591</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­é…’åº—(æ·±åœ³åŒ—ç«™é¾™åæ±½è½¦ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¾™åæ–°åŒºå»ºè¾‰è·¯2å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">209</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³åŒ—ç«™åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.671313'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.02784'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2dkB2HzbaBUJ7adZZfZaeS9JCvjP_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"163\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200208940</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·æµ¦ä¸œå–œæ¥ç™»ç”±ç”±å…¬å¯“'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦å»ºè·¯38å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3168</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œæ–°å›½é™…åšè§ˆä¸­å¿ƒ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.208553'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.518552'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/m3Nrm37Yx6YV4NwqRvSYnFRNSGk_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"164\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200210163</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(ä¸Šæµ·å¾å®¶æ±‡å®œå±±è·¯åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¾æ±‡é’¦å·åŒ—è·¯78å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">219</span><span class=\"token punctuation\">,</span> <span class=\"token number\">35</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å…‰å¤§ä¼šå±•ä¸­å¿ƒ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.180615'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.422916'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/DF/96/Cii-Tlkx0TOIGtOzAAEe_xcDxeIAALCZQJyxf4AAR8X941_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"165\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200214437</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·æµ¦ä¸œæœºåœºåç¾è¾¾å¹¿åœºé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œæœºåœºå¯èˆªè·¯1100å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">600</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œæœºåœºæ ¸å¿ƒåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.160969'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.799086'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2D2gbXDgrMx76uWfwzmoWpmSCCXx_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"166\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200214538</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ç»¿åœ°ä¸‡è±ªé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±Ÿæ»¨è·¯99å·ï¼ˆæ‰“æµ¦è·¯åº•ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">720</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ‰“æµ¦æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.192103'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.47298'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/268jVMuWdYok5ehGFhQ2QNhBhUhs_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"167\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200214715</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·æµ¦ä¸œå–œæ¥ç™»ç”±ç”±å¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦å»ºè·¯38å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2489</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œæ–°å›½é™…åšè§ˆä¸­å¿ƒ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.208739'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.518305'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/36t2KUGs4h5YgYSaLSkr5pMXLM54_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"168\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200214824</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(ä¸Šæµ·é™†å®¶å˜´å…«ä½°ä¼´åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å´‚å±±è·¯689å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">249</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œé™†å®¶å˜´é‡‘èè´¸æ˜“åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.220656'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.525127'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/3D/95/Cii9EVkx0JCIRDFfAAIMnl8npiYAALaawHMG2kAAgy2536_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"169\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200215226</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·é¢–å¥•çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åšå›­è·¯6555å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">907</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å˜‰å®šæ–°åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.272533'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.19179'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3Uyfi2aBRETE1K5PChiLVZCwtDLF_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"170\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200215286</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ä¸‡è±ªè™¹æ¡¥å¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è™¹æ¡¥è·¯2270å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">910</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è™¹æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.191529'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.375577'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/B6/Cii-TF3eXK6IBQoRAAbgs1dyxJwAAGRfAPXbPQABuDL314_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"171\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200215365</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(ä¸Šæµ·è™¹æ¡¥æ¼•æ²³æ³¾å¤åŒ—åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è™¹æ¢…è·¯2971å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">189</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è™¹æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.180968'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.392415'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2WPfVp6auQkYoHzAdSbxwHAtQFfa_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"172\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200215548</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—ï¼ˆä¸Šæµ·è™¹æ¡¥æ¢çº½ä¹äº­ä¸­å¿ƒè·¯åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¾æ±Ÿä¹äº­é•‡ä¸­å¿ƒè·¯128å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">198</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸ƒå®å¤é•‡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.119363'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.322768'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/42/40/Cii-U1kziVOIGTw-AAGRMfcIwJwAALi6ACRnUsAAZFJ536_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"173\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200216665</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³é…’åº—ï¼ˆä¸Šæµ·å¥‰è´¤å—æ¡¥ä¸­å¿ƒåº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¥‰è´¤æ²ªæ­å…¬è·¯1758-8å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1289</span><span class=\"token punctuation\">,</span> <span class=\"token number\">38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¥‰è´¤å¼€å‘åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'30.934646'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.451449'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/DC/A8/Cii-T1kw5leIQAA3AAFzNYtL4loAAK9OQOyk4sAAXNN152_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"174\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">219484323</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(æ·±åœ³è§‚æ¾œç« é˜åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å®å®‰åŒºç« é˜æ‘æ¡‚æœˆè·¯ç« é˜å¸‚åœºæ±‡é¾™å³°æ™¯ä¸€æœŸAæ ‹2-4å±‚'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">725</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è§‚æ¾œ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.746493'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.023'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/3C/8C/Cii-U1kxXqaIeqeuAAHwF4GDmOcAALYFQI9zMMAAfAv100_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"175\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">223318960</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢é…’åº—(æ·±åœ³æ·±å—å¤§é“åå¼ºè·¯åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±å—ä¸­è·¯2081å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">637</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åå¼ºåŒ—å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.540313'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.088611'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2M7am7D8rPTeTQAhxqBeMSANaqGr_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"176\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">233036941</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(ä¸Šæµ·ä¸œæ—å¯ºåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœ±æ³¾é•‡æ–‡å•†è·¯79å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">218</span><span class=\"token punctuation\">,</span> <span class=\"token number\">37</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é‡‘å±±æ«æ³¾å¤é•‡åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'30.895912'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.160238'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G4/M00/35/13/Cii_J1zr5PyIY3acAAFCnHJPxLUAAGX-ABvcIMAAUK0087_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"177\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">234719711</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—Â·neo(åŒ—äº¬æœé˜³åŒ—è·¯åé‡Œå ¡åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœé˜³åŒ—è·¯å…«é‡Œåº„å—é‡Œ26å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">378</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›½è´¸åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.922472'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.501118'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2rHdXNCmycnUxw99AniFC25ZDSfJ_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"178\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">234719728</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—ï¼ˆåŒ—äº¬æˆ¿å±±åŸå…³åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æˆ¿å±±åŸå…³é•‡åŸéšåº™è¡—10å·(åŸæˆ¿å±±è€å…¬å®‰å±€)'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">392</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.705216'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'115.981904'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/3F/66/Cii9EFkyeImIB3ZVAAHcTtTFt4oAALdsgICDO0AAdxm378_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"179\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">235196477</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢é…’åº—(åŒ—äº¬æ€»éƒ¨åŸºåœ°åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸°è‘†è·¯106å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">379</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ€»éƒ¨åŸºåœ°/ä¸°å°ä½“è‚²ä¸­å¿ƒ/å—å®«åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.815383'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.291012'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3J7Hcvwt5xZJL3NkS4wPJ6csmFb9_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"180\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">339777429</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å˜‰å®šå–œæ¥ç™»é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'èŠå›­æ–°åŒºå˜‰å”å…¬è·¯66å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1286</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å˜‰å®šæ–°åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.394595'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.245773'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2v2fKuo5bzhunSBC1n1E42cLTkZV_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"181\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">339952837</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(åŒ—äº¬è‰¯ä¹¡è¥¿è·¯åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è‰¯ä¹¡è¥¿è·¯7å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">159</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æˆ¿å±±é£æ™¯åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.73167'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.132482'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3Dpgf5RTTzrxpeN5y3RLnRVtxMEA_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"182\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">343341695</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢é…’åº—(åŒ—äº¬ä¸­å…³æ‘è½¯ä»¶å›­åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸œåŒ—æ—ºè¥¿è·¯8å·ä¸­å…³æ‘è½¯ä»¶å›­ä¸€æœŸ9å·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">245</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šåœ°äº§ä¸šå›­/è¥¿ä¸‰æ——'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.044663'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.29607'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3hSkPeWRQ3VK1heRQpHzJNMTanQz_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"183\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">365011120</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢é…’åº—(åŒ—äº¬çŸ³æ™¯å±±ä¸‡è¾¾å¹¿åœºåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é²è°·ä¸œè¡—ç”²26å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">505</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å…¬ä¸»åŸ/äº”æ£µæ¾/çŸ³æ™¯å±±æ¸¸ä¹å›­åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.895479'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.240386'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3iwohdQzyZP9azUkYAwTFj7WzBwd_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"184\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">368343863</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(ä¸Šæµ·é‡‘æ¡¥åšå…´è·¯åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åšå…´è·¯1119å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">218</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œé‡‘æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.266272'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.593829'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/w5ERtGJEmdgdgy5qtLPatR1xfm4_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"185\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">368701368</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å¤§ä¸­åå¸Œå°”é¡¿é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç¦ç”°æ·±å—å¤§é“1003å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1666</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸Œå°”é¡¿'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¼šå±•ä¸­å¿ƒ/CBD'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.539313'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.069763'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/4EnHseZ73LXdFJY7DSdJ8xqAcjXe_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"186\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1393017952</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­é…’åº—(æ·±åœ³å®å®‰æ¾å²—åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¾å²—é•‡æ²³æ»¨åŒ—è·¯12å·ç››åå¤§å¦'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">166</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¾å²—å•†ä¸šä¸­å¿ƒåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.768912'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.83325'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/4NehRjdHyZDKxTjAxTYv27FHq8LJ_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"187\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1400304687</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(æ·±åœ³æ¨ªå²—åœ°é“ç«™æ–°é©¬å•†è´¸åŸåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¾™å²—å¤§é“æ¨ªå²—æ®µ4004å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">149</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¾™å²—ä¸­å¿ƒåŒº/å¤§è¿æ–°åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.642629'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.202799'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/25/5A/Cii-TF3PFkiIb27dAAEqdDcKl3YAAEViQGVWY0AASqM960_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"188\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1406627919</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³ä¸­æ´²ä¸‡è±ªé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ·å¾·ä¸€é“88å·ä¸­æ´²æ§è‚¡ä¸­å¿ƒAåº§'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">204</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ·å²¸åŸ/åæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.517293'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.933785'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3wsinQAcuWtCdmv1yxauVG2PSYpC_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"189\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1418471719</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å®é¾™ä¸½ç¬™é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é‡‘æµ·è·¯2449å¼„2å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">860</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸½ç¬™'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œé‡‘æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.26571'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.650132'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3myGUurFCriEVMGPy9yYMPFdb9Zh_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"190\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1455383931</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(æ·±åœ³å®å®‰å®¢è¿ä¸­å¿ƒç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿ä¹¡æ²³è¥¿é‡‘é›…æ–°è‹‘34æ ‹'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">169</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å®å®‰å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.590272'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.881933'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2w9cbbpzjjsyd2wRhFrnUpBMT8b4_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"191\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1457521002</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(æ·±åœ³è¥¿ä¸½èŒ¶å…‰åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç å…‰åŒ—è·¯280å·å¤©ä¸‹æ¹˜å†›1æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">517</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤§å­¦åŸ/è¥¿ä¸½åŠ¨ç‰©å›­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.576187'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.956166'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/E3/E0/Cii-Tlkzdl6IfQYfAAHCgNVDe1sAALK6gPBDhQAAcKY242_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"192\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1463484295</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å’Œå¹³è±ªç”Ÿé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ²ªå—å…¬è·¯2653-2å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">650</span><span class=\"token punctuation\">,</span> <span class=\"token number\">41</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è±ªç”Ÿ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‘¨æµ¦åº·æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.146478'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.568218'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/ZxM9gWHqj657ndRsHw4j4p3CQ5k_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"193\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1514269829</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(ä¸Šæµ·ä¸œå·è·¯ç¢§æ±Ÿå•†ä¸šå¹¿åœºåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸œå·è·¯2645å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">218</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº¤å¤§/é—µè¡Œç»æµå¼€å‘åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.008875'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.402813'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/R92UunuCRXiG826G9Ptu7orqs7b_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"194\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1557882030</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³é…’åº—ï¼ˆæ·±åœ³ä¸œé—¨è€è¡—åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç½—æ¹–åŒºä¸œé—¨æ–°å›­è·¯37å·ç›Šå¾·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">336</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸œé—¨å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.549413'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.118866'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/45/83/Cii9EFk0opCIPl9CAAKHl3Egm6oAALoKwLNWlwAAoev470_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"195\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1557997004</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·äº”è§’åœºå‡¯æ‚¦é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›½å®šä¸œè·¯88å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1104</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‡¯æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±Ÿæ¹¾/äº”è§’åœºå•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.300645'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.51918'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3a3Zz9cDgbJEEJ1GcXzKhTh21YqK_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"196\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1565094427</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å›½é™…æ—…æ¸¸åº¦å‡åŒºä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç§€æµ¦è·¯3999å¼„17å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">713</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¿ªå£«å°¼åº¦å‡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.132913'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.63464'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/KPBUPunPDETYWg8WaJDSmiZC65z_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"197\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1584362548</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(ä¸Šæµ·æµ¦ä¸œå›½é™…æ—…æ¸¸åº¦å‡åŒºå¾¡æ¡¥åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¾¡é’è·¯315-317å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">339</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‘¨æµ¦åº·æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.15719'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.572392'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2ybd3wqdoBtBeKcPxmyso9y1hNXa_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"198\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1630005459</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—ï¼ˆæ·±åœ³åœ°ç‹å¤§å¦çº¢æ¡‚è·¯åº—ï¼‰ï¼ˆåŸçº¢æ¡‚è·¯åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç½—æ¹–åŒºå®å®‰å—è·¯2078å·æ·±æ¸¯è±ªè‹‘ï¼ˆä¸çº¢æ¡‚è·¯äº¤æ±‡å¤„ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">143</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.550341'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.10965'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/EA/18/Cii-T1k1KaGIIkQVAAD4fD_T3FcAALTtABiCJ8AAPiU164_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"199\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1637944903</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—åŒ—äº¬åæµ·åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿åŸåŒ—äº¬å¸‚è¥¿åŸåŒºå¾·èƒœé—¨å†…å¤§è¡—å…´åèƒ¡åŒäº”ç¦é‡Œ2å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">213</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.934452'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.38184'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/48/0C/Cii9EVk1JNuILdBWAAHv5O89TjMAALrFgJ8bwcAAe_8197_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"200\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1649956165</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å—é’åç¾è¾¾é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åå¤ä¸œè·¯811å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">299</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¿ªå£«å°¼åº¦å‡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.195206'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.664791'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2RHmQgTpte3UVSDJ5KbqobbZGRnE_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"201\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1714520967</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—(åŒ—äº¬å®‰åæ¡¥é»„å¯ºå¤§è¡—åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é»„å¯ºå¤§è¡—12å·é™¢16å·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">559</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é©¬ç”¸ã€å®‰è´åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.962742'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.388431'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/4A/21/Cii-U1k1o-uIdcUZAAIbmIKVlKAAALtvQGBb6kAAhuw170_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"202\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1725781423</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ä¸‰è¿ªåç¾è¾¾é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¹¿å¯Œæ—è·¯600å¼„7å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">690</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä½˜å±±/æ¾æ±Ÿå¤§å­¦åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.058023'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.246536'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/NoHym6tuKwVazxy33wRNTNuQWd2_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"203\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1734220581</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­é…’åº—(æ·±åœ³å¤§é¹ä½³å…†ä¸šåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤§é¹è¡—é“æ–°å›­è¡—12å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">378</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¾ƒåœºå°¾/å¤§é¹æ‰€åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.592661'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.475167'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3nWzyWt63gtwPzRf5xbHvwKM27vU_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"204\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1754929048</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ç¯çƒæ¸¯å‡¯æ‚¦é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å®å¤è·¯718å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1336</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‡¯æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸­å±±å…¬å›­å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.232041'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.412492'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/45/B6/Cii-U13ZY-CIF-8MAAXkwQoY7FIAAFpQgEE1bgABeTZ750_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"205\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1762661667</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³ä½³å…†ä¸šä¸‡è±ªé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ£•æ¦ˆå¤§é“33å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">223</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¾ƒåœºå°¾/å¤§é¹æ‰€åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.569193'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.459325'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/45/EC/Cii-TF3ZqE-IYM0NAAY6GIHLZNsAAFr2QDhR8EABjow444_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"206\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1765008760</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(åŒ—äº¬è¥¿ç›´é—¨åŒ—äº¬åŒ—ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿ç›´é—¨åŒ—å¤§è¡—49å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">356</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿ç›´é—¨/åŒ—äº¬å±•è§ˆé¦†åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.945106'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.353827'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/4CLwbCE9346jYn7nFsJTQXuBExTJ_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"207\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1880614409</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å´‡æ˜ç”±ç”±å–œæ¥ç™»é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ½æµ·è·¯2888å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2198</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å´‡æ˜å²›/é•¿å…´å²›/æ¨ªæ²™å²›'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.462167'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.823103'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/21gDCGgRT3xFqCd3FxBh633j6Qsu_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"208\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1889333146</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(åŒ—äº¬è¥¿å®¢ç«™ä¸½æ³½æ¡¥åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿ä¸‰ç¯å—è·¯44å·-218'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">459</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬è¥¿ç«™/ä¸½æ³½å•†åŠ¡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.869638'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.313075'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/kG5corYUDC7U1qE8RAY6xCVnGxq_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"209\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1908594080</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å»ºå·¥æµ¦æ±Ÿçš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é™ˆè¡Œå…¬è·¯3701å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">843</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦æ±Ÿé•‡åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.090063'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.489728'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/45/B7/Cii-U13ZZDWIePrGAAPyImW93N0AAFpRgMmj4MAA_I6005_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"210\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1913922369</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ä¸­å»ºä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'èŸ æ–‡è·¯333å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">889</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è™¹æ¡¥æœºåœº/å›½å®¶ä¼šå±•ä¸­å¿ƒ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.185504'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.287709'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/39Afm5Bxgd784eMeFB5DrcsPnhT_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"211\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1916002015</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·è‹å®ç¯çƒä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸¹å·´è·¯99å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">689</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é•¿é£å…¬å›­åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.22292'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.379912'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/svpYHdmVDck91NqAhjtngcXth2G_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"212\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1928731731</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·åº·æ¡¥ä¸‡è±ªé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åº·æ–°å…¬è·¯4499å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">811</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¿ªå£«å°¼åº¦å‡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.119187'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.618966'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3inpPxTnvRjMCEB39K9FuHaXohYw_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"213\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1931442052</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³æœºåœºå‡¯æ‚¦é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å®å®‰å›½é™…æœºåœºåœ°é¢äº¤é€šä¸­å¿ƒï¼ˆGTCï¼‰18å·å‡ºå£'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">291</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‡¯æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å®å®‰æœºåœºå•†åœˆ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.622498'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.812341'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/45/EC/Cii-TF3ZqVeIJcTPAAUq_Ou_CrcAAFr4gKufPUABSsU446_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"214\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1931602865</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³è”æŠ•ä¸œæ–¹ä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¾å²—ä¸œæ–¹å¤§é“46å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">688</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¾å²—å•†ä¸šä¸­å¿ƒåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.760746'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.856961'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/45/EC/Cii-U13ZqVyIOjdpAARI9aeBh-IAAFr4gOQh7oABEkN297_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"215\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1937347815</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬æœ›äº¬å‡¯æ‚¦é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¹¿é¡ºå—å¤§è¡—8å·é™¢2å·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">617</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‡¯æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœ›äº¬/é…’ä»™æ¡¥/798åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.991546'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.476288'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2gLT4ZgJ8ZuS7sSmXzYoCXnV248p_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"216\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1942938880</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬ä¹å¤šæ¸¯ä¸‡è±ªé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŸå—è¡—é“å—å£è·¯29å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">227</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ˜Œå¹³åŸåŒº/åä¸‰é™µåº¦å‡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.23264'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.188888'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3mBWaZeaqq54E7kX2n7g9b2CZX6q_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"217\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1942992995</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å˜‰å®šå‡¯æ‚¦é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è£•æ°‘å—è·¯1366å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">758</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‡¯æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å˜‰å®šæ–°åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.352298'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.263314'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/53/2D/Cii-U13edkqIfZhLAAJEW25WIF4AAGVxQIg38sAAkRz517_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"218\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1951709780</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³åŒæ³°ä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç¦æµ·è¡—é“å®å®‰å¤§é“ 6259å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">617</span><span class=\"token punctuation\">,</span> <span class=\"token number\">48</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å›½é™…ä¼šå±•ä¸­å¿ƒå•†åœˆ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.678611'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.805695'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3oUfktphxMAWq9hUxD9uqdjRdZGB_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"219\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1973839294</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³æ¹¾ä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç§‘æŠ€å—è·¯16å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">508</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç§‘æŠ€å›­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.531101'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.950615'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/8C9QscRsvTWCx92wt17GAegEMFn_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"220\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1975922994</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—Â·neo(æ·±åœ³å—å±±æµ·å²¸åŸå—æ²¹åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å—å•†è·¯84-6å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">238</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ·å²¸åŸ/åæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.513566'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.9291'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/25/5E/Cii-TF3PGD-IQ0FcAAFIZC82AnkAAEVvAKdj4YAAUh8638_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"221\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1989806195</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³åšæ—å¤©ç‘å–œæ¥ç™»é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç•™ä»™å¤§é“4088å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1369</span><span class=\"token punctuation\">,</span> <span class=\"token number\">48</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤§å­¦åŸ/è¥¿ä¸½åŠ¨ç‰©å›­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.582918'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.97219'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/4Rx55fZoneUeKbE3TCRSPB6WQ6bw_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"222\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1996823660</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ç´«ç«¹ä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç´«æ˜Ÿè·¯588å·3å¹¢'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">642</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº¤å¤§/é—µè¡Œç»æµå¼€å‘åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.02118'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.465186'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/53/2F/Cii-TF3edraIPzK9AAH_p8vdHKoAAGV3AJgSVEAAf-_019_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"223\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1997830708</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢è‡³å°šé…’åº—(åŒ—äº¬ä¸Šåœ°è½¯ä»¶å›­åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¸…æ²³å°è¥è¥¿è·¯48å·æ±‡è‹‘ä»å’Œå¤§å¦ä¸€å±‚'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">753</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šåœ°äº§ä¸šå›­/è¥¿ä¸‰æ——'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.034623'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.323925'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2sKjxS1hFYyBFVKVBqo2x2hSFvGj_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"224\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2003479905</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·æ¦•æ¸¯ä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ–°æ¾æ±Ÿè·¯1277å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">798</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä½˜å±±/æ¾æ±Ÿå¤§å­¦åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.038198'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.210178'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2GM761BYH8k15qkNrJrja3cwfr2D_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"225\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2009548883</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢è‡³å°šé…’åº—(åŒ—äº¬é¦–éƒ½æœºåœºæ–°å›½å±•åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åºœå‰äºŒè¡—6å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">611</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¦–éƒ½æœºåœº/æ–°å›½å±•åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.063953'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.576829'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/43zCTomkMSkUfZByZxn77YH2XidJ_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"226\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2011785622</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬ä¸–å›­å‡¯æ‚¦é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é˜œåº·å—è·¯1å·é™¢1å·æ¥¼A'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">558</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‡¯æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å»¶åº†ä¼‘é—²åº¦å‡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.440732'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'115.963259'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/uhGcQze3zZQxe4avSU8BysgYVvx_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"227\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2022598930</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å®åå–œæ¥ç™»é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å—å¥‰å…¬è·¯3111å¼„228å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2899</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¥‰è´¤å¼€å‘åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'30.921659'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.575572'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/45/BD/Cii-TF3ZaBmIStrbAASnoOyg7FoAAFpYwEoz9oABKe4992_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"228\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2022881967</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³ç›ç”°å‡¯æ‚¦é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ·æ™¯äºŒè·¯1025å·1-6å±‚ã€30-50å±‚'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">650</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‡¯æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç›ç”°åŒºæ”¿åºœ/æ²™å¤´è§’'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.551323'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.23781'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2RFMLSujkczEn1HoybD6dUpN9pzr_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"229\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2031683181</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢è‡³å°šé…’åº—(åŒ—äº¬é›å’Œå®«å’Œå¹³é‡Œåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å°é»„åº„1åŒº15å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">299</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é©¬ç”¸/å®‰è´åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.962361'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.412931'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/4Xqm5BN9pZTamwmYS3eLxL417YYt_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"230\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2045052822</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å›½é™…ä¼šå±•ä¸­å¿ƒçš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å±•äº‘è·¯6å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">675</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å›½é™…ä¼šå±•ä¸­å¿ƒå•†åœˆ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.686581'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.777655'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/4DGZygQpE4iSpcBDCoXJvjNr4oiR_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"231\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2048042240</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬å¤§å…´å¸Œå°”é¡¿é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é«˜ç±³åº—å—é‡Œ18å·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1283</span><span class=\"token punctuation\">,</span> <span class=\"token number\">48</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸Œå°”é¡¿'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤§å…´åŒ—äº¬æ–°æœºåœºåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.76875'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.339199'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3B32F8zSU2CJCWzs1hoH2o4WcquR_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"232\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2048047291</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬æ–°é’æµ·å–œæ¥ç™»é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸½æ³½é‡‘èå•†åŠ¡åŒºå‡¤å‡°å˜´åŒ—è·¯ä¸é‡‘ä¸­éƒ½è¥¿è·¯äº¤å‰å£è¥¿è¥è¡—8å·é™¢1å·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">723</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬è¥¿ç«™/ä¸½æ³½å•†åŠ¡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.864026'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.322505'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/4DPQMu5sMM7XR1mvcjoqtWngc7TF_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"233\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2048050570</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­é…’åº—ï¼ˆæ·±åœ³åªå±±ç«è½¦ç«™åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ–°å’Œè·¯127-2å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">436</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åªå±±é«˜é“ç«™å•†åœˆ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.700753'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.339089'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2nXN2bWjfoqoTkPwHvLJQPYz17qD_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"234\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2048671293</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­é…’åº—(æ·±åœ³è§‚æ¾œäº”å’Œå¤§é“åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è§‚æ¹–è¡—é“äº”å’Œå¤§é“327å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">234</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è§‚æ¾œ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.684459'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.07708'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2JrQi83S9qgDEkXqWpe5iyi44Uh2_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"235\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2051661320</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­é…’åº—(æ·±åœ³ç½—æ¹–å£å²¸ä¸‡è±¡åŸäºŒåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¡‚å›­è¡—é“å®å®‰å—è·¯1050å·å˜‰å®¾èŠ±å›­Cæ ‹'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">667</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±¡åŸ/äº¬åŸº100'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.540352'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.112668'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/34FRP7HLPhvKZP1a6tXu4XrJeiaw_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"236\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2056105938</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬é€šå·åŒ—æŠ•å¸Œå°”é¡¿é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ–°åä¸œè¡—289å·2å·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1068</span><span class=\"token punctuation\">,</span> <span class=\"token number\">48</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸Œå°”é¡¿'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœå›­ç¯å²›/é€šå·åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.908805'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.659748'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/NGKdpec3tZJNUUNWJ5pd67Cp5AY_w200_h200_c1_t0.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"237\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2056126831</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·è™¹æ¡¥é‡‘è‡£çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç”³é•¿è·¯630å¼„1-3 å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2488</span><span class=\"token punctuation\">,</span> <span class=\"token number\">48</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è™¹æ¡¥æœºåœº/å›½å®¶ä¼šå±•ä¸­å¿ƒ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.19036'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.31535'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/PvFh4Vzc84xXhm5N41F6AqdAqyJ_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"238\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2056132395</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³æ·±é“çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±å—å¤§é“9819å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">340</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç§‘æŠ€å›­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.538923'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.944794'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/eBLtrED2uJs7yURWfjnWge9dT1P_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"239\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2056298828</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ä¸­ä¼˜åŸå¸‚ä¸‡è±ªé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ²ªå—å…¬è·¯7688å¼„1å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1200</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å—æ±‡/é‡ç”ŸåŠ¨ç‰©å›­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.030053'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.662943'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2gBATEyysyQWmw3wZL863HGdqjaq_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"240\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2058250574</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³æ¹¾ä¸‡ä¸½é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç²¤æµ·è¡—é“é«˜æ–°åŒºç¤¾åŒºç§‘æŠ€å—è·¯18å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">351</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡ä¸½'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç§‘æŠ€å›­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.531674'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.951882'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2YWUpZsvPVkRiKgdPg95LJxaFmB6_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"241\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2060510277</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬é‡‘éš…å…«è¾¾å²­çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦«æ°´åŒ—è¡—1å·1-14å¹¢'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1026</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å»¶åº†ä¼‘é—²åº¦å‡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.476483'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'115.97481'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3Dzq2KxgiQbmb1sbc5iK6xqpVuFr_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"242\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2060618247</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­é…’åº—(æ·±åœ³æµ·å²¸åŸåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç²¤æµ·è¡—é“åæµ·ç¤¾åŒºåæµ·ç¬¬äºŒç»Ÿå»ºæ¥¼å•†ä¸šè£™æ¥¼ç¬¬äºŒå±‚B'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">562</span><span class=\"token punctuation\">,</span> <span class=\"token number\">49</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ·å²¸åŸ/åæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.507276'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.931251'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/TBoXdgEx5Yjc2HobeC3fPWWnSJi_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"243\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2062643512</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å›½é™…ä¼šå±•ä¸­å¿ƒå¸Œå°”é¡¿é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å±•ä¸°è·¯80å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">285</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸Œå°”é¡¿'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å›½é™…ä¼šå±•ä¸­å¿ƒå•†åœˆ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.705335'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.77794'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2SHUVXNrN5NsXsTUwcd1yaHKbrGq_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"244\"></td><td><pre></pre></td></tr><tr><td data-num=\"245\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure>",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "Elasticsearch",
                "è®¡ç®—æœºå­¦ç§‘",
                "springcloud",
                "Elasticsearch",
                "æ¡ˆä¾‹"
            ]
        }
    ]
}