{
    "version": "https://jsonfeed.org/version/1",
    "title": "Dkx ã® Javaå°çª",
    "subtitle": "åˆ«æ€•è·¯é•¿æ¢¦è¿œ",
    "icon": "https://pigpigletsgo.github.io/images/favicon.ico",
    "description": "æ¬¢è¿æ¥æˆ‘çš„åšå®¢ç©ºé—´",
    "home_page_url": "https://pigpigletsgo.github.io",
    "items": [
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/SpringBoot%E6%95%B4%E5%90%88docker%E9%83%A8%E7%BD%B2xxl-job-2.3.1/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/SpringBoot%E6%95%B4%E5%90%88docker%E9%83%A8%E7%BD%B2xxl-job-2.3.1/",
            "title": "XXL-JOBä»‹ç»å’Œä½¿ç”¨",
            "date_published": "2024-01-06T02:58:18.367Z",
            "content_html": "<h1 id=\"ä¸€-xxl-jobä»‹ç»\"><a class=\"anchor\" href=\"#ä¸€-xxl-jobä»‹ç»\">#</a> ä¸€ã€ XXL-JOB ä»‹ç»</h1>\n<p>XXL-JOB æ˜¯ä¸€ä¸ªè½»é‡çº§åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼Œå…¶æ ¸å¿ƒè®¾è®¡ç›®æ ‡æ˜¯å¼€å‘è¿…é€Ÿã€å­¦ä¹ ç®€å•ã€è½»é‡çº§ã€æ˜“æ‰©å±•ã€‚ç°å·²å¼€æ”¾æºä»£ç å¹¶æ¥å…¥å¤šå®¶å…¬å¸çº¿ä¸Šäº§å“çº¿ï¼Œå¼€ç®±å³ç”¨ã€‚</p>\n<p>å®˜ç½‘ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueHV4dWVsaS5jb20veHhsLWpvYi8=\">https://www.xuxueli.com/xxl-job/</span></p>\n<p>æ–‡æ¡£ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueHV4dWVsaS5jb20veHhsLWpvYi8jJUUzJTgwJThBJUU1JTg4JTg2JUU1JUI4JTgzJUU1JUJDJThGJUU0JUJCJUJCJUU1JThBJUExJUU4JUIwJTgzJUU1JUJBJUE2JUU1JUI5JUIzJUU1JThGJUIwWFhMLUpPQiVFMyU4MCU4Qg==\">https://www.xuxueli.com/xxl-job/#ã€Šåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å° XXL-JOBã€‹</span></p>\n<p>XXL-JOB ä¸»è¦æœ‰è°ƒåº¦ä¸­å¿ƒã€æ‰§è¡Œå™¨ã€ä»»åŠ¡ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021141945.png\" alt=\"image-20231102114124616\" /></p>\n<p><strong>è°ƒåº¦ä¸­å¿ƒï¼š</strong></p>\n<p>â€‹    è´Ÿè´£ç®¡ç†è°ƒåº¦ä¿¡æ¯ï¼ŒæŒ‰ç…§è°ƒåº¦é…ç½®å‘å‡ºè°ƒåº¦è¯·æ±‚ï¼Œè‡ªèº«ä¸æ‰¿æ‹…ä¸šåŠ¡ä»£ç ï¼›</p>\n<p>â€‹    ä¸»è¦èŒè´£ä¸ºæ‰§è¡Œå™¨ç®¡ç†ã€ä»»åŠ¡ç®¡ç†ã€ç›‘æ§è¿ç»´ã€æ—¥å¿—ç®¡ç†ç­‰</p>\n<p><strong>ä»»åŠ¡æ‰§è¡Œå™¨ï¼š</strong></p>\n<p>â€‹    è´Ÿè´£æ¥æ”¶è°ƒåº¦è¯·æ±‚å¹¶æ‰§è¡Œä»»åŠ¡é€»è¾‘ï¼›</p>\n<p>â€‹    åªè¦èŒè´£æ˜¯æ³¨å†ŒæœåŠ¡ã€ä»»åŠ¡æ‰§è¡ŒæœåŠ¡ï¼ˆæ¥æ”¶åˆ°ä»»åŠ¡åä¼šæ”¾å…¥çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—ï¼‰ã€æ‰§è¡Œç»“æœä¸ŠæŠ¥ã€æ—¥å¿—æœåŠ¡ç­‰</p>\n<p>** ä»»åŠ¡ï¼š** è´Ÿè´£æ‰§è¡Œå…·ä½“çš„ä¸šåŠ¡å¤„ç†ã€‚</p>\n<p>è°ƒåº¦ä¸­å¿ƒä¸æ‰§è¡Œå™¨ä¹‹é—´çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021142092.png\" alt=\"image-20231102114151941\" /></p>\n<p><strong>æ‰§è¡Œæµç¨‹ï¼š</strong></p>\n<p>â€‹    1. ä»»åŠ¡æ‰§è¡Œå™¨æ ¹æ®é…ç½®çš„è°ƒåº¦ä¸­å¿ƒçš„åœ°å€ï¼Œè‡ªåŠ¨æ³¨å†Œåˆ°è°ƒåº¦ä¸­å¿ƒ</p>\n<p>â€‹    2. è¾¾åˆ°ä»»åŠ¡è§¦å‘æ¡ä»¶ï¼Œè°ƒåº¦ä¸­å¿ƒä¸‹å‘ä»»åŠ¡</p>\n<p>â€‹    3. æ‰§è¡Œå™¨åŸºäºçº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶æŠŠæ‰§è¡Œç»“æœæ”¾å…¥å†…å­˜é˜Ÿåˆ—ä¸­ã€æŠŠæ‰§è¡Œæ—¥å¿—å†™å…¥æ—¥å¿—æ–‡ä»¶ä¸­</p>\n<p>â€‹    4. æ‰§è¡Œå™¨æ¶ˆè´¹å†…å­˜é˜Ÿåˆ—ä¸­çš„æ‰§è¡Œç»“æœï¼Œä¸»åŠ¨ä¸ŠæŠ¥ç»™è°ƒåº¦ä¸­å¿ƒ</p>\n<p>â€‹    5. å½“ç”¨æˆ·åœ¨è°ƒåº¦ä¸­å¿ƒæŸ¥çœ‹ä»»åŠ¡æ—¥å¿—ï¼Œè°ƒåº¦ä¸­å¿ƒè¯·æ±‚ä»»åŠ¡æ‰§è¡Œå™¨ï¼Œä»»åŠ¡æ‰§è¡Œå™¨è¯»å–ä»»åŠ¡æ—¥å¿—æ–‡ä»¶å¹¶è¿”å›æ—¥å¿—è¯¦æƒ…</p>\n<hr />\n<h1 id=\"äºŒ-ä½¿ç”¨é…ç½®\"><a class=\"anchor\" href=\"#äºŒ-ä½¿ç”¨é…ç½®\">#</a> äºŒã€ä½¿ç”¨é…ç½®</h1>\n<p>æ‰§è¡Œå‘½ä»¤æ‹‰å– xxl-job-2.3.1</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> pull xuxueli/xxl-job-admin:2.3.1</pre></td></tr></table></figure><p>æ‹‰å–æˆåŠŸåï¼Œåˆ›å»ºæŒ‚è½½é…ç½®è·¯å¾„ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> <span class=\"token parameter variable\">-m</span> <span class=\"token number\">777</span> /root/tmp/xxl-job/data/applogs</pre></td></tr></table></figure><p>åˆ›å»ºå®Œæˆååœ¨ /root/tem/xxl-job/ ç›®å½•ä¸­ åˆ›å»º é…ç½®æ–‡ä»¶ application.properties</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021026700.png\" alt=\"image-20231102102637272\" /></p>\n<p>é…ç½®å†…å®¹å¦‚ä¸‹ï¼š</p>\n<p>é‡Œé¢å°±æ›´æ”¹ä¸‹è‡ªå·±çš„ ip åœ°å€å’Œæ•°æ®åº“è´¦æˆ·å’Œå¯†ç å³å¯ã€‚</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">### web</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>server.port=8080</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>server.servlet.context<span class=\"token punctuation\">-</span>path=/xxl<span class=\"token punctuation\">-</span>job<span class=\"token punctuation\">-</span>admin</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">### actuator</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>management.server.servlet.context<span class=\"token punctuation\">-</span>path=/actuator</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>management.health.mail.enabled=false</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">### resources</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>spring.mvc.servlet.load<span class=\"token punctuation\">-</span>on<span class=\"token punctuation\">-</span>startup=0</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>spring.mvc.static<span class=\"token punctuation\">-</span>path<span class=\"token punctuation\">-</span>pattern=/static/<span class=\"token important\">**</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>spring.resources.static<span class=\"token punctuation\">-</span>locations=classpath<span class=\"token punctuation\">:</span>/static/</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> </pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">### freemarker</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>spring.freemarker.templateLoaderPath=classpath<span class=\"token punctuation\">:</span>/templates/</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>spring.freemarker.suffix=.ftl</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>spring.freemarker.charset=UTF<span class=\"token punctuation\">-</span><span class=\"token number\">8</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>spring.freemarker.request<span class=\"token punctuation\">-</span>context<span class=\"token punctuation\">-</span>attribute=request</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>spring.freemarker.settings.number_format=0.<span class=\"token comment\">##########</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre> </pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">### mybatis</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>mybatis.mapper<span class=\"token punctuation\">-</span>locations=classpath<span class=\"token punctuation\">:</span>/mybatis<span class=\"token punctuation\">-</span>mapper/<span class=\"token important\">*Mapper.xml</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#mybatis.type-aliases-package=com.xxl.job.admin.core.model</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre> </pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">### xxl-job, datasource</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>spring.datasource.url=jdbc<span class=\"token punctuation\">:</span>mysql<span class=\"token punctuation\">:</span>//192.168.249.128<span class=\"token punctuation\">:</span>3306/xxl_job<span class=\"token punctuation\">?</span>useUnicode=true<span class=\"token important\">&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>spring.datasource.username=root</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>spring.datasource.password=dkx.</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>spring.datasource.driver<span class=\"token punctuation\">-</span>class<span class=\"token punctuation\">-</span>name=com.mysql.cj.jdbc.Driver</pre></td></tr><tr><td data-num=\"30\"></td><td><pre> </pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">### datasource-pool</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>spring.datasource.type=com.zaxxer.hikari.HikariDataSource</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>spring.datasource.hikari.minimum<span class=\"token punctuation\">-</span>idle=10</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>spring.datasource.hikari.maximum<span class=\"token punctuation\">-</span>pool<span class=\"token punctuation\">-</span>size=30</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>spring.datasource.hikari.auto<span class=\"token punctuation\">-</span>commit=true</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>spring.datasource.hikari.idle<span class=\"token punctuation\">-</span>timeout=30000</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>spring.datasource.hikari.pool<span class=\"token punctuation\">-</span>name=HikariCP</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>spring.datasource.hikari.max<span class=\"token punctuation\">-</span>lifetime=900000</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>spring.datasource.hikari.connection<span class=\"token punctuation\">-</span>timeout=10000</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>spring.datasource.hikari.connection<span class=\"token punctuation\">-</span>test<span class=\"token punctuation\">-</span>query=SELECT 1</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>spring.datasource.hikari.validation<span class=\"token punctuation\">-</span>timeout=1000</pre></td></tr><tr><td data-num=\"42\"></td><td><pre> </pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token comment\">### xxl-job, email</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>spring.mail.host=smtp.qq.com</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>spring.mail.port=25</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>spring.mail.username=xxx@qq.com</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>spring.mail.from=xxx@qq.com</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>spring.mail.password=xxx</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>spring.mail.properties.mail.smtp.auth=true</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>spring.mail.properties.mail.smtp.starttls.enable=true</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>spring.mail.properties.mail.smtp.starttls.required=true</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>spring.mail.properties.mail.smtp.socketFactory.class=javax.net.ssl.SSLSocketFactory</pre></td></tr><tr><td data-num=\"53\"></td><td><pre> </pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token comment\">### xxl-job, access token</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>xxl.job.accessToken=default_token</pre></td></tr><tr><td data-num=\"56\"></td><td><pre> </pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token comment\">### xxl-job, i18n (default is zh_CN, and you can choose \"zh_CN\", \"zh_TC\" and \"en\")</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>xxl.job.i18n=zh_CN</pre></td></tr><tr><td data-num=\"59\"></td><td><pre> </pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token comment\">## xxl-job, triggerpool max size</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>xxl.job.triggerpool.fast.max=200</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>xxl.job.triggerpool.slow.max=100</pre></td></tr><tr><td data-num=\"63\"></td><td><pre> </pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token comment\">### xxl-job, log retention days</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>xxl.job.logretentiondays=30</pre></td></tr></table></figure><p>åˆ° github ä¸­ æ‹‰å–ä¸€ä¸‹é¡¹ç›®é‡Œé¢æœ‰ä¸€ä¸ª sql æ–‡ä»¶ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3h1eHVlbGkveHhsLWpvYg==\">https://github.com/xuxueli/xxl-job</span></p>\n<p>æˆ–è€…åˆ°ç äº‘ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20veHV4dWVsaTAzMjMveHhsLWpvYg==\">https://gitee.com/xuxueli0323/xxl-job</span> æ‹‰å–é¡¹ç›®ã€‚ä¸»è¦æ˜¯ sql æ–‡ä»¶å•Š</p>\n<p>æˆ‘ä»¬éœ€è¦æ‰¾åˆ°è¿™ä¸ª sql æ–‡ä»¶ç„¶ååˆ›å»ºä¸€ä¸ªæ•°æ®åº“å¹¶å¯¼å…¥ sql æ–‡ä»¶ï¼Œå†è¿›è¡Œä¸‹ä¸€æ­¥ï¼</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021034863.png\" alt=\"image-20231102103400507\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021035033.png\" alt=\"image-20231102103536623\" /></p>\n<p>é…ç½®å®Œæˆåå¯åŠ¨ xxl-job-2.3.1 å¹¶åˆ›å»ºå®¹å™¨ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run  <span class=\"token parameter variable\">-p</span> <span class=\"token number\">18080</span>:8080 <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span><span class=\"token operator\">=</span>xxl <span class=\"token parameter variable\">--restart</span><span class=\"token operator\">=</span>always <span class=\"token parameter variable\">-v</span> /root/tmp/xxl-job/application.properties:/application.properties  <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">PARAMS</span><span class=\"token operator\">=</span><span class=\"token string\">'--spring.config.location=/application.properties'</span> xuxueli/xxl-job-admin:2.3.1</pre></td></tr></table></figure><p>å¯åŠ¨æˆåŠŸåè®¿é—® uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMjQ5LjEyODoxODA4MC94eGwtam9iLWFkbWluL2pvYmdyb3Vw\">http://192.168.249.128:18080/xxl-job-admin/jobgroup</span></p>\n<p>è´¦å·ï¼šadmin ï¼Œå¯†ç ï¼š123456</p>\n<p>è®¿é—®åé¡µé¢å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021028455.png\" alt=\"image-20231102102848028\" /></p>\n<p>åˆ›å»ºä¸€ä¸ªæ‰§è¡Œå™¨</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021046055.png\" alt=\"image-20231102104642146\" /></p>\n<p>ç‚¹å‡»æ–°å¢ï¼Œå¡«å†™æ‰§è¡Œå™¨ä¿¡æ¯ï¼Œappname æ˜¯å‰è¾¹åœ¨ nacos ä¸­é…ç½® xxl ä¿¡æ¯æ—¶æŒ‡å®šçš„æ‰§è¡Œå™¨çš„åº”ç”¨åã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021047493.png\" alt=\"image-20231102104700103\" /></p>\n<p>æ·»åŠ æˆåŠŸï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021047508.png\" alt=\"image-20231102104719719\" /></p>\n<p>åœ¨éœ€è¦ç”¨åˆ°çš„ä¸šåŠ¡æ¨¡å—ä¸­å¯¼å…¥ä¾èµ–ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.xuxueli<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>xxl-job-core<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>é…ç½® application.yml å¦‚ä¸‹ï¼Œä¹Ÿå¯ä»¥é…ç½®åˆ° nacos ä¸­ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">xxl</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">job</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">admin</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">addresses</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//192.168.101.65<span class=\"token punctuation\">:</span>8088/xxl<span class=\"token punctuation\">-</span>job<span class=\"token punctuation\">-</span>admin</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">executor</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">appname</span><span class=\"token punctuation\">:</span> media<span class=\"token punctuation\">-</span>process<span class=\"token punctuation\">-</span>service</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">address</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token key atrule\">ip</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">9999</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token key atrule\">logpath</span><span class=\"token punctuation\">:</span> /data/applogs/xxl<span class=\"token punctuation\">-</span>job/jobhandler</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token key atrule\">logretentiondays</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">accessToken</span><span class=\"token punctuation\">:</span> default_token</pre></td></tr></table></figure><p>&lt;font color='red'&gt; æ³¨æ„ &lt;/font &gt; é…ç½®ä¸­çš„ appname è¿™æ˜¯æ‰§è¡Œå™¨çš„åº”ç”¨åï¼Œport æ˜¯æ‰§è¡Œå™¨å¯åŠ¨çš„ç«¯å£ï¼Œå¦‚æœæœ¬åœ°å¯åŠ¨å¤šä¸ªæ‰§è¡Œå™¨æ³¨æ„ç«¯å£ä¸èƒ½é‡å¤ã€‚</p>\n<p>åœ¨ä» github æˆ–è€… gitee ä¸­æ‹‰å–çš„ xxl-job-2.3.1 é¡¹ç›®ä¸­æ‰¾åˆ°</p>\n<p>E:\\ å­¦æˆåœ¨çº¿é¡¹ç›® â€” èµ„æ–™ \\day06 æ–­ç‚¹ç»­ä¼  xxl-job\\ èµ„æ–™ \\xxl-job-2.3.1\\xxl-job-executor-samples\\xxl-job-executor-sample-springboot\\src\\main\\java\\com\\xxl\\job\\executor\\core\\config\\XxlJobConfig.java</p>\n<p>é…ç½®æ–‡ä»¶</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021057889.png\" alt=\"image-20231102105732814\" /></p>\n<p>å°†è¯¥é…ç½®æ–‡ä»¶æ‹·è´åˆ° è‡ªå·±é¡¹ç›®çš„è¯¥æ¨¡å—çš„ config ç›®å½•ä¸­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021058604.png\" alt=\"image-20231102105838113\" /></p>\n<p>å¯åŠ¨æœåŠ¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021102864.png\" alt=\"image-20231102110215950\" /></p>\n<p>å¯ä»¥çœ‹åˆ°æœåŠ¡å°±è‡ªåŠ¨çš„æ³¨å†Œåˆ°äº†æ‰§è¡Œå™¨ä¸­äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021102303.png\" alt=\"image-20231102110243545\" /></p>\n<p>ç‚¹å‡» æŸ¥çœ‹ (1)</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021104929.png\" alt=\"image-20231102110416038\" /></p>\n<p>æ‰§è¡Œå™¨æ‰§è¡Œä»»åŠ¡</p>\n<p>ä» xxl-job-2.3.1 é¡¹ç›®ä¸­å…ˆæ¥æ‹¿åˆ°ä¸€ä¸ªä¾‹å­å°±æ˜¯å¦‚ä¸‹ä»£ç ï¼š</p>\n<p>E:\\ å­¦æˆåœ¨çº¿é¡¹ç›® â€” èµ„æ–™ \\day06 æ–­ç‚¹ç»­ä¼  xxl-job\\ èµ„æ–™ \\xxl-job-2.3.1\\xxl-job-executor-samples\\xxl-job-executor-sample-springboot\\src\\main\\java\\com\\xxl\\job\\executor\\service\\jobhandler\\SampleXxlJob.java</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021117873.png\" alt=\"image-20231102111700620\" /></p>\n<p>ç„¶åå°†è¿™ä¸ªä»£ç ï¼Œæ‹·è´åˆ°è‡ªå·±é¡¹ç›®çš„æ¨¡å—çš„ service ä¸šåŠ¡ä¸­ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * XxlJob å¼€å‘ç¤ºä¾‹ï¼ˆBean æ¨¡å¼ï¼‰</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * å¼€å‘æ­¥éª¤ï¼š</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> *      1ã€ä»»åŠ¡å¼€å‘ï¼šåœ¨ Spring Bean å®ä¾‹ä¸­ï¼Œå¼€å‘ Job æ–¹æ³•ï¼›</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> *      2ã€æ³¨è§£é…ç½®ï¼šä¸º Job æ–¹æ³•æ·»åŠ æ³¨è§£ \"@XxlJob (value=\" è‡ªå®šä¹‰ jobhandler åç§° \", init =\"JobHandler åˆå§‹åŒ–æ–¹æ³• \", destroy =\"JobHandler é”€æ¯æ–¹æ³• \")\"ï¼Œæ³¨è§£ value å€¼å¯¹åº”çš„æ˜¯è°ƒåº¦ä¸­å¿ƒæ–°å»ºä»»åŠ¡çš„ JobHandler å±æ€§çš„å€¼ã€‚</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> *      3ã€æ‰§è¡Œæ—¥å¿—ï¼šéœ€è¦é€šè¿‡ \"XxlJobHelper.log\" æ‰“å°æ‰§è¡Œæ—¥å¿—ï¼›</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> *      4ã€ä»»åŠ¡ç»“æœï¼šé»˜è®¤ä»»åŠ¡ç»“æœä¸º \"æˆåŠŸ\" çŠ¶æ€ï¼Œä¸éœ€è¦ä¸»åŠ¨è®¾ç½®ï¼›å¦‚æœ‰è¯‰æ±‚ï¼Œæ¯”å¦‚è®¾ç½®ä»»åŠ¡ç»“æœä¸ºå¤±è´¥ï¼Œå¯ä»¥é€šè¿‡ \"XxlJobHelper.handleFail/handleSuccess\" è‡ªä¸»è®¾ç½®ä»»åŠ¡ç»“æœï¼›</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * @author xuxueli 2019-12-11 21:52:51</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SampleXxlJob</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Logger</span> logger <span class=\"token operator\">=</span> <span class=\"token class-name\">LoggerFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLogger</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SampleXxlJob</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>     * 1ã€ç®€å•ä»»åŠ¡ç¤ºä¾‹ï¼ˆBean æ¨¡å¼ï¼‰</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token annotation punctuation\">@XxlJob</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"demoJobHandler\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">demoJobHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è§†é¢‘å¤„ç†...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">// default success</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021118433.png\" alt=\"image-20231102111804565\" /></p>\n<p>ç„¶åå°±å¯ä»¥åœ¨è¿™é‡Œé¢æ¥ç¼–å†™è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ä»£ç äº†ã€‚</p>\n<p>é‚£ä¹ˆè¿™ä¸ªä»»åŠ¡æ‰§è¡Œå™¨ä¸­çš„ä»»åŠ¡æ€ä¹ˆæ‰§è¡Œå‘¢ï¼Œæˆ‘ä»¬éœ€è¦åˆ°æ§åˆ¶å°ä¸­çš„æ‰§è¡Œä»»åŠ¡ä¸­è¿›è¡Œé…ç½®ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021127816.png\" alt=\"image-20231102112746770\" /></p>\n<p>å…¶ä¸­çš„ bean æŒ‡çš„å°±æ˜¯ æ‰§è¡Œä»»åŠ¡ ä¸šåŠ¡é€»è¾‘ä»£ç ä¸­æ³¨å…¥çš„ bean åç§°</p>\n<p>ä¹Ÿå¯ä»¥é€‰æ‹©å…¶å®ƒçš„æ¯”å¦‚ Java é‚£ä¹ˆå³è¾¹çš„æ¡†å°±ä¸èƒ½è¾“å…¥äº†ï¼Œä¸‹é¢å°±æ˜¯è¾“å…¥è¦æ‰§è¡Œçš„ Java ä»£ç ã€‚</p>\n<p>æå®Œä¸Šé¢çš„åå°±é‡å¯åç«¯æœåŠ¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021132541.png\" alt=\"image-20231102113214411\" /></p>\n<p>å¯åŠ¨æœåŠ¡åé‚£ ä»»åŠ¡æ€ä¹ˆæ‰§è¡Œå‘¢ï¼Œæˆ‘ä»¬éœ€è¦ ï¼Œåœ¨æ§åˆ¶å° ä¸­ ä»»åŠ¡ç®¡ç†çš„ ä»»åŠ¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021133078.png\" alt=\"image-20231102113310041\" /></p>\n<p>å¯åŠ¨åå°±å¯ä»¥çœ‹åˆ°æ¯éš” 5 ç§’åç«¯æ§åˆ¶å°å°±ä¼šæ‰“å°å‡ºä¸€å¥è¯</p>\n<pre><code>c.xxl.job.core.executor.XxlJobExecutor   : &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job regist JobThread success, jobId:2, handler:com.xxl.job.core.handler.impl.MethodJobHandler@1dcca426[class com.xuecheng.media.service.jobhandler.SampleXxlJob#demoJobHandler]\nè§†é¢‘å¤„ç†...\nè§†é¢‘å¤„ç†...\nè§†é¢‘å¤„ç†...\nè§†é¢‘å¤„ç†...\nè§†é¢‘å¤„ç†...\nè§†é¢‘å¤„ç†...\n</code></pre>\n<p>åœ¨è¿è¡ŒæŠ¥è¡¨ä¸­å¯ä»¥çœ‹åˆ°è°ƒåº¦æƒ…å†µå¦‚ä¸‹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202311021136278.png\" alt=\"image-20231102113642675\" /></p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "è®¡ç®—æœºå­¦ç§‘",
                "åŸºç¡€",
                "springcloud"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/sentinel/sentinel%E8%A7%84%E5%88%99%E6%8C%81%E4%B9%85%E5%8C%96/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/sentinel/sentinel%E8%A7%84%E5%88%99%E6%8C%81%E4%B9%85%E5%8C%96/",
            "title": "Sentinelè§„åˆ™æŒä¹…åŒ–",
            "date_published": "2024-01-06T02:53:16.074Z",
            "content_html": "<h1 id=\"sentinel-è§„åˆ™æŒä¹…åŒ–\"><a class=\"anchor\" href=\"#sentinel-è§„åˆ™æŒä¹…åŒ–\">#</a> Sentinel è§„åˆ™æŒä¹…åŒ–</h1>\n<h2 id=\"ä¸€-ä¿®æ”¹order-serviceæœåŠ¡\"><a class=\"anchor\" href=\"#ä¸€-ä¿®æ”¹order-serviceæœåŠ¡\">#</a> ä¸€ã€ä¿®æ”¹ order-service æœåŠ¡</h2>\n<p>ä¿®æ”¹ OrderServiceï¼Œè®©å…¶ç›‘å¬ Nacos ä¸­çš„ sentinel è§„åˆ™é…ç½®ã€‚</p>\n<p>å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<h3 id=\"1å¼•å…¥ä¾èµ–\"><a class=\"anchor\" href=\"#1å¼•å…¥ä¾èµ–\">#</a> 1. å¼•å…¥ä¾èµ–</h3>\n<p>åœ¨ order-service ä¸­å¼•å…¥ sentinel ç›‘å¬ nacos çš„ä¾èµ–ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.csp<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>sentinel-datasource-nacos<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h3 id=\"2é…ç½®nacosåœ°å€\"><a class=\"anchor\" href=\"#2é…ç½®nacosåœ°å€\">#</a> 2. é…ç½® nacos åœ°å€</h3>\n<p>åœ¨ order-service ä¸­çš„ application.yml æ–‡ä»¶é…ç½® nacos åœ°å€åŠç›‘å¬çš„é…ç½®ä¿¡æ¯ï¼š</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">sentinel</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token key atrule\">flow</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>          <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span> <span class=\"token comment\"># nacos åœ°å€</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token key atrule\">dataId</span><span class=\"token punctuation\">:</span> orderservice<span class=\"token punctuation\">-</span>flow<span class=\"token punctuation\">-</span>rules</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token key atrule\">groupId</span><span class=\"token punctuation\">:</span> SENTINEL_GROUP</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token key atrule\">rule-type</span><span class=\"token punctuation\">:</span> flow <span class=\"token comment\"># è¿˜å¯ä»¥æ˜¯ï¼šdegradeã€authorityã€param-flow</span></pre></td></tr></table></figure><h2 id=\"äºŒ-ä¿®æ”¹sentinel-dashboardæºç \"><a class=\"anchor\" href=\"#äºŒ-ä¿®æ”¹sentinel-dashboardæºç \">#</a> äºŒã€ä¿®æ”¹ sentinel-dashboard æºç </h2>\n<p>SentinelDashboard é»˜è®¤ä¸æ”¯æŒ nacos çš„æŒä¹…åŒ–ï¼Œéœ€è¦ä¿®æ”¹æºç ã€‚</p>\n<h3 id=\"1-è§£å‹\"><a class=\"anchor\" href=\"#1-è§£å‹\">#</a> 1. è§£å‹</h3>\n<p>è§£å‹è¯¾å‰èµ„æ–™ä¸­çš„ sentinel æºç åŒ…ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644436.png\" alt=\"image-20210618201340086\" /></p>\n<p>ç„¶åå¹¶ç”¨ IDEA æ‰“å¼€è¿™ä¸ªé¡¹ç›®ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644159.png\" alt=\"image-20210618201412878\" /></p>\n<h3 id=\"2-ä¿®æ”¹nacosä¾èµ–\"><a class=\"anchor\" href=\"#2-ä¿®æ”¹nacosä¾èµ–\">#</a> 2. ä¿®æ”¹ nacos ä¾èµ–</h3>\n<p>åœ¨ sentinel-dashboard æºç çš„ pom æ–‡ä»¶ä¸­ï¼Œnacos çš„ä¾èµ–é»˜è®¤çš„ scope æ˜¯ testï¼Œåªèƒ½åœ¨æµ‹è¯•æ—¶ä½¿ç”¨ï¼Œè¿™é‡Œè¦å»é™¤ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644823.png\" alt=\"image-20210618201607831\" /></p>\n<p>å°† sentinel-datasource-nacos ä¾èµ–çš„ scope å»æ‰ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.csp<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>sentinel-datasource-nacos<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h3 id=\"3-æ·»åŠ nacosæ”¯æŒ\"><a class=\"anchor\" href=\"#3-æ·»åŠ nacosæ”¯æŒ\">#</a> 3. æ·»åŠ  nacos æ”¯æŒ</h3>\n<p>åœ¨ sentinel-dashboard çš„ test åŒ…ä¸‹ï¼Œå·²ç»ç¼–å†™äº†å¯¹ nacos çš„æ”¯æŒï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶æ‹·è´åˆ° main ä¸‹ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644434.png\" alt=\"image-20210618201726280\" /></p>\n<h3 id=\"4-ä¿®æ”¹nacosåœ°å€\"><a class=\"anchor\" href=\"#4-ä¿®æ”¹nacosåœ°å€\">#</a> 4. ä¿®æ”¹ nacos åœ°å€</h3>\n<p>ç„¶åï¼Œè¿˜éœ€è¦ä¿®æ”¹æµ‹è¯•ä»£ç ä¸­çš„ NacosConfig ç±»ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644320.png\" alt=\"image-20210618201912078\" /></p>\n<p>ä¿®æ”¹å…¶ä¸­çš„ nacos åœ°å€ï¼Œè®©å…¶è¯»å– application.properties ä¸­çš„é…ç½®ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644820.png\" alt=\"image-20210618202047575\" /></p>\n<p>åœ¨ sentinel-dashboard çš„ application.properties ä¸­æ·»åŠ  nacos åœ°å€é…ç½®ï¼š</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key attr-name\">nacos.addr</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">localhost:8848</span></pre></td></tr></table></figure><h3 id=\"5-é…ç½®nacosæ•°æ®æº\"><a class=\"anchor\" href=\"#5-é…ç½®nacosæ•°æ®æº\">#</a> 5. é…ç½® nacos æ•°æ®æº</h3>\n<p>å¦å¤–ï¼Œè¿˜éœ€è¦ä¿®æ”¹ com.alibaba.csp.sentinel.dashboard.controller.v2 åŒ…ä¸‹çš„ FlowControllerV2 ç±»ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644684.png\" alt=\"w\" /></p>\n<p>è®©æˆ‘ä»¬æ·»åŠ çš„ Nacos æ•°æ®æºç”Ÿæ•ˆï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644334.png\" alt=\"image-20210618202334536\" /></p>\n<h3 id=\"6-ä¿®æ”¹å‰ç«¯é¡µé¢\"><a class=\"anchor\" href=\"#6-ä¿®æ”¹å‰ç«¯é¡µé¢\">#</a> 6. ä¿®æ”¹å‰ç«¯é¡µé¢</h3>\n<p>æ¥ä¸‹æ¥ï¼Œè¿˜è¦ä¿®æ”¹å‰ç«¯é¡µé¢ï¼Œæ·»åŠ ä¸€ä¸ªæ”¯æŒ nacos çš„èœå•ã€‚</p>\n<p>ä¿®æ”¹ src/main/webapp/resources/app/scripts/directives/sidebar/ ç›®å½•ä¸‹çš„ sidebar.html æ–‡ä»¶ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644086.png\" alt=\"image-20210618202433356\" /></p>\n<p>å°†å…¶ä¸­çš„è¿™éƒ¨åˆ†æ³¨é‡Šæ‰“å¼€ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644031.png\" alt=\"image-20210618202449881\" /></p>\n<p>ä¿®æ”¹å…¶ä¸­çš„æ–‡æœ¬ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644504.png\" alt=\"image-20210618202501928\" /></p>\n<h3 id=\"7-é‡æ–°ç¼–è¯‘-æ‰“åŒ…é¡¹ç›®\"><a class=\"anchor\" href=\"#7-é‡æ–°ç¼–è¯‘-æ‰“åŒ…é¡¹ç›®\">#</a> 7. é‡æ–°ç¼–è¯‘ã€æ‰“åŒ…é¡¹ç›®</h3>\n<p>è¿è¡Œ IDEA ä¸­çš„ maven æ’ä»¶ï¼Œç¼–è¯‘å’Œæ‰“åŒ…ä¿®æ”¹å¥½çš„ Sentinel-Dashboardï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171644941.png\" alt=\"image-20210618202701492\" /></p>\n<h3 id=\"8å¯åŠ¨\"><a class=\"anchor\" href=\"#8å¯åŠ¨\">#</a> 8. å¯åŠ¨</h3>\n<p>å¯åŠ¨æ–¹å¼è·Ÿå®˜æ–¹ä¸€æ ·ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">java</span> <span class=\"token parameter variable\">-jar</span> sentinel-dashboard.jar</pre></td></tr></table></figure><p>å¦‚æœè¦ä¿®æ”¹ nacos åœ°å€ï¼Œéœ€è¦æ·»åŠ å‚æ•°ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">java</span> <span class=\"token parameter variable\">-jar</span> <span class=\"token parameter variable\">-Dnacos.addr</span><span class=\"token operator\">=</span>localhost:8848 sentinel-dashboard.jar</pre></td></tr></table></figure>",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "springcloud-é«˜çº§",
                "sentinel",
                "è®¡ç®—æœºå­¦ç§‘",
                "springcloud",
                "Sentinel",
                "æŒä¹…åŒ–"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/seata/seata%E7%9A%84%E9%83%A8%E7%BD%B2%E5%92%8C%E9%9B%86%E6%88%90/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/seata/seata%E7%9A%84%E9%83%A8%E7%BD%B2%E5%92%8C%E9%9B%86%E6%88%90/",
            "title": "seataçš„éƒ¨ç½²å’Œé›†æˆ",
            "date_published": "2024-01-06T02:51:53.386Z",
            "content_html": "<h1 id=\"seataçš„éƒ¨ç½²å’Œé›†æˆ\"><a class=\"anchor\" href=\"#seataçš„éƒ¨ç½²å’Œé›†æˆ\">#</a> seata çš„éƒ¨ç½²å’Œé›†æˆ</h1>\n<h1 id=\"ä¸€-éƒ¨ç½²seataçš„tc-server\"><a class=\"anchor\" href=\"#ä¸€-éƒ¨ç½²seataçš„tc-server\">#</a> ä¸€ã€éƒ¨ç½² Seata çš„ tc-server</h1>\n<h2 id=\"1ä¸‹è½½\"><a class=\"anchor\" href=\"#1ä¸‹è½½\">#</a> 1. ä¸‹è½½</h2>\n<p>é¦–å…ˆæˆ‘ä»¬è¦ä¸‹è½½ seata-server åŒ…ï¼Œåœ°å€åœ¨<span class=\"exturl\" data-url=\"aHR0cDovL3NlYXRhLmlvL3poLWNuL2Jsb2cvZG93bmxvYWQuaHRtbA==\"> http</span><span class=\"exturl\" data-url=\"aHR0cDovL3NlYXRhLmlvL3poLWNuL2Jsb2cvZG93bmxvYWQuaHRtbA==\">ğŸ˜•/seata.io/zh-cn/blog/download</span><span class=\"exturl\" data-url=\"aHR0cDovL3NlYXRhLmlvL3poLWNuL2Jsb2cvZG93bmxvYWQuaHRtbA==\">.</span><span class=\"exturl\" data-url=\"aHR0cDovL3NlYXRhLmlvL3poLWNuL2Jsb2cvZG93bmxvYWQuaHRtbA==\">html</span></p>\n<p>å½“ç„¶ï¼Œè¯¾å‰èµ„æ–™ä¹Ÿå‡†å¤‡å¥½äº†ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180750149.png\" alt=\"image-20210622202357640\" /></p>\n<h2 id=\"2è§£å‹\"><a class=\"anchor\" href=\"#2è§£å‹\">#</a> 2. è§£å‹</h2>\n<p>åœ¨éä¸­æ–‡ç›®å½•è§£å‹ç¼©è¿™ä¸ª zip åŒ…ï¼Œå…¶ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180750336.png\" alt=\"image-20210622202515014\" /></p>\n<h2 id=\"3ä¿®æ”¹é…ç½®\"><a class=\"anchor\" href=\"#3ä¿®æ”¹é…ç½®\">#</a> 3. ä¿®æ”¹é…ç½®</h2>\n<p>ä¿®æ”¹ conf ç›®å½•ä¸‹çš„ registry.conf æ–‡ä»¶ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180750504.png\" alt=\"image-20210622202622874\" /></p>\n<p>å†…å®¹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key attr-name\">registry</span> <span class=\"token value attr-value\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">  # tc æœåŠ¡çš„æ³¨å†Œä¸­å¿ƒç±»ï¼Œè¿™é‡Œé€‰æ‹© nacosï¼Œä¹Ÿå¯ä»¥æ˜¯ eurekaã€zookeeper ç­‰</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key attr-name\">  type</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"nacos\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key attr-name\">  nacos</span> <span class=\"token value attr-value\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">    # seata tc æœåŠ¡æ³¨å†Œåˆ° nacos çš„æœåŠ¡åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key attr-name\">    application</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"seata-tc-server\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key attr-name\">    serverAddr</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"127.0.0.1:8848\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token key attr-name\">    group</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"DEFAULT_GROUP\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token key attr-name\">    namespace</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token key attr-name\">    cluster</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"SH\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token key attr-name\">    username</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"nacos\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token key attr-name\">    password</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"nacos\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  &#125;</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>&#125;</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token key attr-name\">config</span> <span class=\"token value attr-value\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">  # è¯»å– tc æœåŠ¡ç«¯çš„é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼Œè¿™é‡Œæ˜¯ä» nacos é…ç½®ä¸­å¿ƒè¯»å–ï¼Œè¿™æ ·å¦‚æœ tc æ˜¯é›†ç¾¤ï¼Œå¯ä»¥å…±äº«é…ç½®</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token key attr-name\">  type</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"nacos\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">  # é…ç½® nacos åœ°å€ç­‰ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token key attr-name\">  nacos</span> <span class=\"token value attr-value\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token key attr-name\">    serverAddr</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"127.0.0.1:8848\"</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token key attr-name\">    namespace</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token key attr-name\">    group</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"SEATA_GROUP\"</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token key attr-name\">    username</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"nacos\"</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token key attr-name\">    password</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"nacos\"</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token key attr-name\">    dataId</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"seataServer.properties\"</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  &#125;</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>&#125;</pre></td></tr></table></figure><p>Seata-1.7.0 ç‰ˆæœ¬çš„é…ç½®å¦‚ä¸‹ï¼š</p>\n<p>æ‰¾åˆ° yml é…ç½®æ–‡ä»¶</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180927758.png\" alt=\"image-20231018092704361\" /></p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">7091</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> seata<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key atrule\">logging</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span> classpath<span class=\"token punctuation\">:</span>logback<span class=\"token punctuation\">-</span>spring.xml</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">file</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span>user.home<span class=\"token punctuation\">&#125;</span>/logs/seata</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">extend</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">logstash-appender</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token key atrule\">destination</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">4560</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">kafka-appender</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token key atrule\">bootstrap-servers</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">9092</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token key atrule\">topic</span><span class=\"token punctuation\">:</span> logback_to_logstash</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token key atrule\">console</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token key atrule\">user</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> seata</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> seata</pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token key atrule\">seata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token comment\"># support: nacos, consul, apollo, zk, etcd3</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token comment\"># æ”¹è¿™é‡Œä¼šæŠ¥é”™</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> SEATA_GROUP</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token comment\">##if use MSE Nacos with auth, mutex with username/password attribute</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token comment\">#access-key: \"\"</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token comment\">#secret-key: \"\"</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token key atrule\">data-id</span><span class=\"token punctuation\">:</span> seataServer.properties</pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>  <span class=\"token key atrule\">registry</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token comment\"># support: nacos, eureka, redis, zk, consul, etcd3, sofa</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token key atrule\">preferred-networks</span><span class=\"token punctuation\">:</span> 30.240.*</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span> seata<span class=\"token punctuation\">-</span>tc<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> DEFAULT_GROUP</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token key atrule\">cluster</span><span class=\"token punctuation\">:</span> SH</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>      <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>      <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>      <span class=\"token comment\">##if use MSE Nacos with auth, mutex with username/password attribute</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>      <span class=\"token comment\">#access-key: \"\"</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>      <span class=\"token comment\">#secret-key: \"\"</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>  <span class=\"token key atrule\">store</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token comment\"># support: file ã€ db ã€ redis</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token key atrule\">mode</span><span class=\"token punctuation\">:</span> db</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token key atrule\">db</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>      <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span> druid</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>      <span class=\"token key atrule\">db-type</span><span class=\"token punctuation\">:</span> mysql</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>      <span class=\"token key atrule\">driver-class-name</span><span class=\"token punctuation\">:</span> com.mysql.cj.jdbc.Driver</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>      <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> jdbc<span class=\"token punctuation\">:</span>mysql<span class=\"token punctuation\">:</span>//127.0.0.1<span class=\"token punctuation\">:</span>13306/seata<span class=\"token punctuation\">?</span>useUnicode=true<span class=\"token important\">&amp;rewriteBatchedStatements=true&amp;serverTimezone=GMT</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>      <span class=\"token key atrule\">user</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>      <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> dkx.</pre></td></tr><tr><td data-num=\"65\"></td><td><pre>      <span class=\"token key atrule\">min-conn</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>      <span class=\"token key atrule\">max-conn</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>      <span class=\"token key atrule\">global-table</span><span class=\"token punctuation\">:</span> global_table</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>      <span class=\"token key atrule\">branch-table</span><span class=\"token punctuation\">:</span> branch_table</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>      <span class=\"token key atrule\">lock-table</span><span class=\"token punctuation\">:</span> lock_table</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>      <span class=\"token key atrule\">distributed-lock-table</span><span class=\"token punctuation\">:</span> distributed_lock</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>      <span class=\"token key atrule\">query-limit</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>      <span class=\"token key atrule\">max-wait</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5000</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token comment\">#  server:</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token comment\">#    service-port: 8091 #If not configured, the default is '$&#123;server.port&#125; + 1000'</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>  <span class=\"token key atrule\">security</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    <span class=\"token key atrule\">secretKey</span><span class=\"token punctuation\">:</span> SeataSecretKey0c382ef121d778043159209298fd40bf3850a017</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    <span class=\"token key atrule\">tokenValidityInMilliseconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1800000</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>    <span class=\"token key atrule\">ignore</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>      <span class=\"token key atrule\">urls</span><span class=\"token punctuation\">:</span> /<span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.css</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.js</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.html</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.map</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.svg</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.png</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.ico</span><span class=\"token punctuation\">,</span>/console<span class=\"token punctuation\">-</span>fe/public/<span class=\"token important\">**</span><span class=\"token punctuation\">,</span>/api/v1/auth/login</pre></td></tr></table></figure><h2 id=\"4åœ¨nacosæ·»åŠ é…ç½®\"><a class=\"anchor\" href=\"#4åœ¨nacosæ·»åŠ é…ç½®\">#</a> 4. åœ¨ nacos æ·»åŠ é…ç½®</h2>\n<p>ç‰¹åˆ«æ³¨æ„ï¼Œä¸ºäº†è®© tc æœåŠ¡çš„é›†ç¾¤å¯ä»¥å…±äº«é…ç½®ï¼Œæˆ‘ä»¬é€‰æ‹©äº† nacos ä½œä¸ºç»Ÿä¸€é…ç½®ä¸­å¿ƒã€‚å› æ­¤æœåŠ¡ç«¯é…ç½®æ–‡ä»¶ seataServer.properties æ–‡ä»¶éœ€è¦åœ¨ nacos ä¸­é…å¥½ã€‚</p>\n<p>æ ¼å¼å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180750398.png\" alt=\"image-20210622203609227\" /></p>\n<p>é…ç½®å†…å®¹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œdb ä»£è¡¨æ•°æ®åº“</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key attr-name\">store.mode</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">db</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key attr-name\">store.db.datasource</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">druid</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key attr-name\">store.db.dbType</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">mysql</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key attr-name\">store.db.driverClassName</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">com.mysql.jdbc.Driver</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key attr-name\">store.db.url</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">jdbc:mysql://127.0.0.1:3306/seata?useUnicode=true&amp;rewriteBatchedStatements=true</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key attr-name\">store.db.user</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">root</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key attr-name\">store.db.password</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">123</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token key attr-name\">store.db.minConn</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">5</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token key attr-name\">store.db.maxConn</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">30</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token key attr-name\">store.db.globalTable</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">global_table</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token key attr-name\">store.db.branchTable</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">branch_table</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token key attr-name\">store.db.queryLimit</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">100</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token key attr-name\">store.db.lockTable</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">lock_table</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token key attr-name\">store.db.maxWait</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">5000</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># äº‹åŠ¡ã€æ—¥å¿—ç­‰é…ç½®</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token key attr-name\">server.recovery.committingRetryPeriod</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">1000</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token key attr-name\">server.recovery.asynCommittingRetryPeriod</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">1000</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token key attr-name\">server.recovery.rollbackingRetryPeriod</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">1000</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token key attr-name\">server.recovery.timeoutRetryPeriod</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">1000</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token key attr-name\">server.maxCommitRetryTimeout</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">-1</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token key attr-name\">server.maxRollbackRetryTimeout</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">-1</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token key attr-name\">server.rollbackRetryTimeoutUnlockEnable</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token key attr-name\">server.undo.logSaveDays</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">7</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token key attr-name\">server.undo.logDeletePeriod</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">86400000</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\"># å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¼ è¾“æ–¹å¼</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token key attr-name\">transport.serialization</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">seata</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token key attr-name\">transport.compressor</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">none</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\"># å…³é—­ metrics åŠŸèƒ½ï¼Œæé«˜æ€§èƒ½</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token key attr-name\">metrics.enabled</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token key attr-name\">metrics.registryType</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">compact</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token key attr-name\">metrics.exporterList</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">prometheus</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token key attr-name\">metrics.exporterPrometheusPort</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">9898</span></pre></td></tr></table></figure><p><mark>å…¶ä¸­çš„æ•°æ®åº“åœ°å€ã€ç”¨æˆ·åã€å¯†ç éƒ½éœ€è¦ä¿®æ”¹æˆä½ è‡ªå·±çš„æ•°æ®åº“ä¿¡æ¯ã€‚</mark></p>\n<h2 id=\"5åˆ›å»ºæ•°æ®åº“è¡¨\"><a class=\"anchor\" href=\"#5åˆ›å»ºæ•°æ®åº“è¡¨\">#</a> 5. åˆ›å»ºæ•°æ®åº“è¡¨</h2>\n<p>ç‰¹åˆ«æ³¨æ„ï¼štc æœåŠ¡åœ¨ç®¡ç†åˆ†å¸ƒå¼äº‹åŠ¡æ—¶ï¼Œéœ€è¦è®°å½•äº‹åŠ¡ç›¸å…³æ•°æ®åˆ°æ•°æ®åº“ä¸­ï¼Œä½ éœ€è¦æå‰åˆ›å»ºå¥½è¿™äº›è¡¨ã€‚</p>\n<p>æ–°å»ºä¸€ä¸ªåä¸º seata çš„æ•°æ®åº“ï¼Œè¿è¡Œè¯¾å‰èµ„æ–™æä¾›çš„ sql æ–‡ä»¶ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180750346.png\" alt=\"image-20210622204145159\" /></p>\n<p>è¿™äº›è¡¨ä¸»è¦è®°å½•å…¨å±€äº‹åŠ¡ã€åˆ†æ”¯äº‹åŠ¡ã€å…¨å±€é”ä¿¡æ¯ï¼š</p>\n<pre><code class=\"language-mysql\">\nSET NAMES utf8mb4;\nSET FOREIGN_KEY_CHECKS = 0;\n\n-- ----------------------------\n-- åˆ†æ”¯äº‹åŠ¡è¡¨\n-- ----------------------------\nDROP TABLE IF EXISTS `branch_table`;\nCREATE TABLE `branch_table`  (\n  `branch_id` bigint(20) NOT NULL,\n  `xid` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,\n  `transaction_id` bigint(20) NULL DEFAULT NULL,\n  `resource_group_id` varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n  `resource_id` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n  `branch_type` varchar(8) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n  `status` tinyint(4) NULL DEFAULT NULL,\n  `client_id` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n  `application_data` varchar(2000) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n  `gmt_create` datetime(6) NULL DEFAULT NULL,\n  `gmt_modified` datetime(6) NULL DEFAULT NULL,\n  PRIMARY KEY (`branch_id`) USING BTREE,\n  INDEX `idx_xid`(`xid`) USING BTREE\n) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;\n\n-- ----------------------------\n-- å…¨å±€äº‹åŠ¡è¡¨\n-- ----------------------------\nDROP TABLE IF EXISTS `global_table`;\nCREATE TABLE `global_table`  (\n  `xid` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,\n  `transaction_id` bigint(20) NULL DEFAULT NULL,\n  `status` tinyint(4) NOT NULL,\n  `application_id` varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n  `transaction_service_group` varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n  `transaction_name` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n  `timeout` int(11) NULL DEFAULT NULL,\n  `begin_time` bigint(20) NULL DEFAULT NULL,\n  `application_data` varchar(2000) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n  `gmt_create` datetime NULL DEFAULT NULL,\n  `gmt_modified` datetime NULL DEFAULT NULL,\n  PRIMARY KEY (`xid`) USING BTREE,\n  INDEX `idx_gmt_modified_status`(`gmt_modified`, `status`) USING BTREE,\n  INDEX `idx_transaction_id`(`transaction_id`) USING BTREE\n) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;\n\nSET FOREIGN_KEY_CHECKS = 1;\n</code></pre>\n<h2 id=\"6å¯åŠ¨tcæœåŠ¡\"><a class=\"anchor\" href=\"#6å¯åŠ¨tcæœåŠ¡\">#</a> 6. å¯åŠ¨ TC æœåŠ¡</h2>\n<p>è¿›å…¥ bin ç›®å½•ï¼Œè¿è¡Œå…¶ä¸­çš„ seata-server.bat å³å¯ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180750008.png\" alt=\"image-20210622205427318\" /></p>\n<p>å¯åŠ¨æˆåŠŸåï¼Œseata-server åº”è¯¥å·²ç»æ³¨å†Œåˆ° nacos æ³¨å†Œä¸­å¿ƒäº†ã€‚</p>\n<p>æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® nacos åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4ODQ4\">http://localhost:8848</span>ï¼Œç„¶åè¿›å…¥æœåŠ¡åˆ—è¡¨é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ° seata-tc-server çš„ä¿¡æ¯ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180750053.png\" alt=\"image-20210622205901450\" /></p>\n<h1 id=\"äºŒ-å¾®æœåŠ¡é›†æˆseata\"><a class=\"anchor\" href=\"#äºŒ-å¾®æœåŠ¡é›†æˆseata\">#</a> äºŒã€å¾®æœåŠ¡é›†æˆ seata</h1>\n<h2 id=\"1å¼•å…¥ä¾èµ–\"><a class=\"anchor\" href=\"#1å¼•å…¥ä¾èµ–\">#</a> 1. å¼•å…¥ä¾èµ–</h2>\n<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¾®æœåŠ¡ä¸­å¼•å…¥ seata ä¾èµ–ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-alibaba-seata<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclusions</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">&lt;!-- ç‰ˆæœ¬è¾ƒä½ï¼Œ1.3.0ï¼Œå› æ­¤æ’é™¤ --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclusion</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>seata-spring-boot-starter<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>io.seata<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclusion</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclusions</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">&lt;!--seata starter é‡‡ç”¨ 1.4.2 ç‰ˆæœ¬ --></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>io.seata<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>seata-spring-boot-starter<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>$&#123;seata.version&#125;<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h2 id=\"2ä¿®æ”¹é…ç½®æ–‡ä»¶\"><a class=\"anchor\" href=\"#2ä¿®æ”¹é…ç½®æ–‡ä»¶\">#</a> 2. ä¿®æ”¹é…ç½®æ–‡ä»¶</h2>\n<p>éœ€è¦ä¿®æ”¹ application.yml æ–‡ä»¶ï¼Œæ·»åŠ ä¸€äº›é…ç½®ï¼š</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">seata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">registry</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># TC æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„é…ç½®ï¼Œå¾®æœåŠ¡æ ¹æ®è¿™äº›ä¿¡æ¯å»æ³¨å†Œä¸­å¿ƒè·å– tc æœåŠ¡åœ°å€</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\"># å‚è€ƒ tc æœåŠ¡è‡ªå·±çš„ registry.conf ä¸­çš„é…ç½®</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># tc</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> DEFAULT_GROUP</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span> seata<span class=\"token punctuation\">-</span>tc<span class=\"token punctuation\">-</span>server <span class=\"token comment\"># tc æœåŠ¡åœ¨ nacos ä¸­çš„æœåŠ¡åç§°</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token key atrule\">cluster</span><span class=\"token punctuation\">:</span> SH</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token key atrule\">tx-service-group</span><span class=\"token punctuation\">:</span> seata<span class=\"token punctuation\">-</span>demo <span class=\"token comment\"># äº‹åŠ¡ç»„ï¼Œæ ¹æ®è¿™ä¸ªè·å– tc æœåŠ¡çš„ cluster åç§°</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">vgroup-mapping</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># äº‹åŠ¡ç»„ä¸ TC æœåŠ¡ cluster çš„æ˜ å°„å…³ç³»</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token key atrule\">seata-demo</span><span class=\"token punctuation\">:</span> SH</pre></td></tr></table></figure><p>è¦ä» nacos ä¸­æ‰¾åˆ°ä¸€ä¸ªæœåŠ¡ï¼Œæˆ‘éœ€è¦çŸ¥é“ä»€ä¹ˆä¿¡æ¯ã€‚</p>\n<p>æˆ‘ä»¬ä» nacos æ‰¾åˆ°ä¸€ä¸ªæœåŠ¡è‡³å°‘éœ€è¦çŸ¥é“ namespaceï¼Œgroupï¼Œapplication-name å’Œ cluster</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180945757.png\" alt=\"image-20231018094533567\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180948844.png\" alt=\"image-20231018094851842\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>nacos æœåŠ¡åç§°ç»„æˆåŒ…æ‹¬ï¼Ÿ</p>\n<ul>\n<li>namespace + group + serviceName + cluster</li>\n</ul>\n<p>seata å®¢æˆ·ç«¯è·å– tc çš„ cluster åç§°æ–¹å¼</p>\n<ul>\n<li>ä»¥ tx-group-service çš„å€¼ä¸º key åˆ° vgroupMapping ä¸­æŸ¥æ‰¾</li>\n</ul>\n</blockquote>\n<h1 id=\"ä¸‰-tcæœåŠ¡çš„é«˜å¯ç”¨å’Œå¼‚åœ°å®¹ç¾\"><a class=\"anchor\" href=\"#ä¸‰-tcæœåŠ¡çš„é«˜å¯ç”¨å’Œå¼‚åœ°å®¹ç¾\">#</a> ä¸‰ã€TC æœåŠ¡çš„é«˜å¯ç”¨å’Œå¼‚åœ°å®¹ç¾</h1>\n<h2 id=\"1æ¨¡æ‹Ÿå¼‚åœ°å®¹ç¾çš„tcé›†ç¾¤\"><a class=\"anchor\" href=\"#1æ¨¡æ‹Ÿå¼‚åœ°å®¹ç¾çš„tcé›†ç¾¤\">#</a> 1. æ¨¡æ‹Ÿå¼‚åœ°å®¹ç¾çš„ TC é›†ç¾¤</h2>\n<p>è®¡åˆ’å¯åŠ¨ä¸¤å° seata çš„ tc æœåŠ¡èŠ‚ç‚¹ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>èŠ‚ç‚¹åç§°</th>\n<th>ip åœ°å€</th>\n<th>ç«¯å£å·</th>\n<th>é›†ç¾¤åç§°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>seata</td>\n<td>127.0.0.1</td>\n<td>8091</td>\n<td>SH</td>\n</tr>\n<tr>\n<td>seata2</td>\n<td>127.0.0.1</td>\n<td>8092</td>\n<td>HZ</td>\n</tr>\n</tbody>\n</table>\n<p>ä¹‹å‰æˆ‘ä»¬å·²ç»å¯åŠ¨äº†ä¸€å° seata æœåŠ¡ï¼Œç«¯å£æ˜¯ 8091ï¼Œé›†ç¾¤åä¸º SHã€‚</p>\n<p>ç°åœ¨ï¼Œå°† seata ç›®å½•å¤åˆ¶ä¸€ä»½ï¼Œèµ·åä¸º seata2</p>\n<p>ä¿®æ”¹ seata2/conf/registry.conf å†…å®¹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">registry</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token comment\"># tc æœåŠ¡çš„æ³¨å†Œä¸­å¿ƒç±»ï¼Œè¿™é‡Œé€‰æ‹© nacosï¼Œä¹Ÿå¯ä»¥æ˜¯ eurekaã€zookeeper ç­‰</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token directive\"><span class=\"token keyword\">type</span> = <span class=\"token string\">\"nacos\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  nacos</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\"># seata tc æœåŠ¡æ³¨å†Œåˆ° nacos çš„æœåŠ¡åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    application = \"seata-tc-server\"</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    serverAddr = \"127.0.0.1:8848\"</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    group = \"DEFAULT_GROUP\"</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    namespace = \"\"</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    cluster = \"HZ\"</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    username = \"nacos\"</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    password = \"nacos\"</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">config</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token comment\"># è¯»å– tc æœåŠ¡ç«¯çš„é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼Œè¿™é‡Œæ˜¯ä» nacos é…ç½®ä¸­å¿ƒè¯»å–ï¼Œè¿™æ ·å¦‚æœ tc æ˜¯é›†ç¾¤ï¼Œå¯ä»¥å…±äº«é…ç½®</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token directive\"><span class=\"token keyword\">type</span> = <span class=\"token string\">\"nacos\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token comment\"># é…ç½® nacos åœ°å€ç­‰ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  nacos</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    serverAddr = \"127.0.0.1:8848\"</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    namespace = \"\"</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    group = \"SEATA_GROUP\"</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    username = \"nacos\"</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    password = \"nacos\"</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    dataId = \"seataServer.properties\"</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Seata-1.7.0 ç‰ˆæœ¬çš„é…ç½®å¦‚ä¸‹ï¼š</p>\n<p>æ‰¾åˆ° yml é…ç½®æ–‡ä»¶</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181958636.png\" alt=\"image-20231018092704361\" /></p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">7091</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> seata<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key atrule\">logging</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span> classpath<span class=\"token punctuation\">:</span>logback<span class=\"token punctuation\">-</span>spring.xml</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">file</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span>user.home<span class=\"token punctuation\">&#125;</span>/logs/seata</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">extend</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">logstash-appender</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token key atrule\">destination</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">4560</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">kafka-appender</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token key atrule\">bootstrap-servers</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">9092</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token key atrule\">topic</span><span class=\"token punctuation\">:</span> logback_to_logstash</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token key atrule\">console</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token key atrule\">user</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> seata</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> seata</pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token key atrule\">seata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token comment\"># support: nacos, consul, apollo, zk, etcd3</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token comment\"># æ”¹è¿™é‡Œä¼šæŠ¥é”™</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> SEATA_GROUP</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token comment\">##if use MSE Nacos with auth, mutex with username/password attribute</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token comment\">#access-key: \"\"</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token comment\">#secret-key: \"\"</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token key atrule\">data-id</span><span class=\"token punctuation\">:</span> seataServer.properties</pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>  <span class=\"token key atrule\">registry</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token comment\"># support: nacos, eureka, redis, zk, consul, etcd3, sofa</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token key atrule\">preferred-networks</span><span class=\"token punctuation\">:</span> 30.240.*</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span> seata<span class=\"token punctuation\">-</span>tc<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> DEFAULT_GROUP</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token key atrule\">cluster</span><span class=\"token punctuation\">:</span> HZ <span class=\"token comment\"># ä¿®æ”¹é›†ç¾¤åœ°å€</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>      <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>      <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>      <span class=\"token comment\">##if use MSE Nacos with auth, mutex with username/password attribute</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>      <span class=\"token comment\">#access-key: \"\"</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>      <span class=\"token comment\">#secret-key: \"\"</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"56\"></td><td><pre>  <span class=\"token key atrule\">store</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token comment\"># support: file ã€ db ã€ redis</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token key atrule\">mode</span><span class=\"token punctuation\">:</span> db</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token key atrule\">db</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>      <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span> druid</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>      <span class=\"token key atrule\">db-type</span><span class=\"token punctuation\">:</span> mysql</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>      <span class=\"token key atrule\">driver-class-name</span><span class=\"token punctuation\">:</span> com.mysql.cj.jdbc.Driver</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>      <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> jdbc<span class=\"token punctuation\">:</span>mysql<span class=\"token punctuation\">:</span>//127.0.0.1<span class=\"token punctuation\">:</span>13306/seata<span class=\"token punctuation\">?</span>useUnicode=true<span class=\"token important\">&amp;rewriteBatchedStatements=true&amp;serverTimezone=GMT</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>      <span class=\"token key atrule\">user</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"65\"></td><td><pre>      <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> dkx.</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>      <span class=\"token key atrule\">min-conn</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>      <span class=\"token key atrule\">max-conn</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>      <span class=\"token key atrule\">global-table</span><span class=\"token punctuation\">:</span> global_table</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>      <span class=\"token key atrule\">branch-table</span><span class=\"token punctuation\">:</span> branch_table</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>      <span class=\"token key atrule\">lock-table</span><span class=\"token punctuation\">:</span> lock_table</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>      <span class=\"token key atrule\">distributed-lock-table</span><span class=\"token punctuation\">:</span> distributed_lock</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>      <span class=\"token key atrule\">query-limit</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>      <span class=\"token key atrule\">max-wait</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5000</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token comment\">#  server:</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token comment\">#    service-port: 8091 #If not configured, the default is '$&#123;server.port&#125; + 1000'</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>  <span class=\"token key atrule\">security</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    <span class=\"token key atrule\">secretKey</span><span class=\"token punctuation\">:</span> SeataSecretKey0c382ef121d778043159209298fd40bf3850a017</pre></td></tr><tr><td data-num=\"78\"></td><td><pre>    <span class=\"token key atrule\">tokenValidityInMilliseconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1800000</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>    <span class=\"token key atrule\">ignore</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>      <span class=\"token key atrule\">urls</span><span class=\"token punctuation\">:</span> /<span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.css</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.js</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.html</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.map</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.svg</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.png</span><span class=\"token punctuation\">,</span>/<span class=\"token important\">**/*.ico</span><span class=\"token punctuation\">,</span>/console<span class=\"token punctuation\">-</span>fe/public/<span class=\"token important\">**</span><span class=\"token punctuation\">,</span>/api/v1/auth/login</pre></td></tr></table></figure><p>è¿›å…¥ seata2/bin ç›®å½•ï¼Œç„¶åè¿è¡Œå‘½ä»¤ï¼š</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>seata-server<span class=\"token punctuation\">.</span>bat <span class=\"token operator\">-</span>p 8092</pre></td></tr></table></figure><p>1.7.0 ç‰ˆæœ¬å®åœ¨ä¸è¡Œå°±é…ç½®æ–‡ä»¶é‡Œä¿®æ”¹ç«¯å£å·</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310182005822.png\" alt=\"image-20231018200503303\" /></p>\n<p>æ‰“å¼€ nacos æ§åˆ¶å°ï¼ŒæŸ¥çœ‹æœåŠ¡åˆ—è¡¨ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180750772.png\" alt=\"image-20210624151150840\" /></p>\n<p>ç‚¹è¿›è¯¦æƒ…æŸ¥çœ‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180750333.png\" alt=\"image-20210624151221747\" /></p>\n<h2 id=\"2å°†äº‹åŠ¡ç»„æ˜ å°„é…ç½®åˆ°nacos\"><a class=\"anchor\" href=\"#2å°†äº‹åŠ¡ç»„æ˜ å°„é…ç½®åˆ°nacos\">#</a> 2. å°†äº‹åŠ¡ç»„æ˜ å°„é…ç½®åˆ° nacos</h2>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å°† tx-service-group ä¸ cluster çš„æ˜ å°„å…³ç³»éƒ½é…ç½®åˆ° nacos é…ç½®ä¸­å¿ƒã€‚</p>\n<p>æ–°å»ºä¸€ä¸ªé…ç½®ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180751774.png\" alt=\"image-20210624151507072\" /></p>\n<p>é…ç½®çš„å†…å®¹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># äº‹åŠ¡ç»„æ˜ å°„å…³ç³»</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key attr-name\">service.vgroupMapping.seata-demo</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">SH</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key attr-name\">service.enableDegrade</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key attr-name\">service.disableGlobalTransaction</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># ä¸ TC æœåŠ¡çš„é€šä¿¡é…ç½®</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key attr-name\">transport.type</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">TCP</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key attr-name\">transport.server</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">NIO</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token key attr-name\">transport.heartbeat</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">true</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token key attr-name\">transport.enableClientBatchSendRequest</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token key attr-name\">transport.threadFactory.bossThreadPrefix</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">NettyBoss</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token key attr-name\">transport.threadFactory.workerThreadPrefix</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">NettyServerNIOWorker</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token key attr-name\">transport.threadFactory.serverExecutorThreadPrefix</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">NettyServerBizHandler</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token key attr-name\">transport.threadFactory.shareBossWorker</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token key attr-name\">transport.threadFactory.clientSelectorThreadPrefix</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">NettyClientSelector</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token key attr-name\">transport.threadFactory.clientSelectorThreadSize</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">1</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token key attr-name\">transport.threadFactory.clientWorkerThreadPrefix</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">NettyClientWorkerThread</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token key attr-name\">transport.threadFactory.bossThreadSize</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">1</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token key attr-name\">transport.threadFactory.workerThreadSize</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">default</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token key attr-name\">transport.shutdown.wait</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">3</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\"># RM é…ç½®</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token key attr-name\">client.rm.asyncCommitBufferLimit</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">10000</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token key attr-name\">client.rm.lock.retryInterval</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">10</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token key attr-name\">client.rm.lock.retryTimes</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">30</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token key attr-name\">client.rm.lock.retryPolicyBranchRollbackOnConflict</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">true</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token key attr-name\">client.rm.reportRetryCount</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">5</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token key attr-name\">client.rm.tableMetaCheckEnable</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token key attr-name\">client.rm.tableMetaCheckerInterval</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">60000</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token key attr-name\">client.rm.sqlParserType</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">druid</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token key attr-name\">client.rm.reportSuccessEnable</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token key attr-name\">client.rm.sagaBranchRegisterEnable</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\"># TM é…ç½®</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token key attr-name\">client.tm.commitRetryCount</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">5</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token key attr-name\">client.tm.rollbackRetryCount</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">5</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token key attr-name\">client.tm.defaultGlobalTransactionTimeout</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">60000</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token key attr-name\">client.tm.degradeCheck</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token key attr-name\">client.tm.degradeCheckAllowTimes</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">10</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token key attr-name\">client.tm.degradeCheckPeriod</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">2000</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\"># undo æ—¥å¿—é…ç½®</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token key attr-name\">client.undo.dataValidation</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">true</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token key attr-name\">client.undo.logSerialization</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">jackson</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token key attr-name\">client.undo.onlyCareUpdateColumns</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">true</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token key attr-name\">client.undo.logTable</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">undo_log</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token key attr-name\">client.undo.compress.enable</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">true</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token key attr-name\">client.undo.compress.type</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">zip</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token key attr-name\">client.undo.compress.threshold</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">64k</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token key attr-name\">client.log.exceptionRate</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">100</span></pre></td></tr></table></figure><h2 id=\"3å¾®æœåŠ¡è¯»å–nacosé…ç½®\"><a class=\"anchor\" href=\"#3å¾®æœåŠ¡è¯»å–nacosé…ç½®\">#</a> 3. å¾®æœåŠ¡è¯»å– nacos é…ç½®</h2>\n<p>æ¥ä¸‹æ¥ï¼Œéœ€è¦ä¿®æ”¹æ¯ä¸€ä¸ªå¾®æœåŠ¡çš„ application.yml æ–‡ä»¶ï¼Œè®©å¾®æœåŠ¡è¯»å– nacos ä¸­çš„ client.properties æ–‡ä»¶ï¼š</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">seata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> nacos</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> SEATA_GROUP <span class=\"token comment\"># è¿™é‡Œå’Œ nacos æ·»åŠ é…ç½®æ–‡ä»¶ä¸­çš„ group è¦ä¸€è‡´</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">data-id</span><span class=\"token punctuation\">:</span> client.properties</pre></td></tr></table></figure><p>é‡å¯å¾®æœåŠ¡ï¼Œç°åœ¨å¾®æœåŠ¡åˆ°åº•æ˜¯è¿æ¥ tc çš„ SH é›†ç¾¤ï¼Œè¿˜æ˜¯ tc çš„ HZ é›†ç¾¤ï¼Œéƒ½ç»Ÿä¸€ç”± nacos çš„ client.properties æ¥å†³å®šäº†ã€‚</p>\n<p>8092</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310182016810.png\" alt=\"image-20231018201640218\" /></p>\n<p>7091</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310182017126.png\" alt=\"image-20231018201658572\" /></p>\n<p>å¯ä»¥çœ‹åˆ° 8092 æ²¡æœ‰ä»»ä½•äººæ³¨å†Œï¼Œè€Œæ˜¯éƒ½æ³¨å†Œåˆ°äº† 7091 ä¸Šäº†</p>\n<p>æˆ‘ä»¬å» nacos æ§åˆ¶å°ä¸­å¯¹åˆšæ‰åˆ›å»ºçš„é…ç½®æ–‡ä»¶çš„é›†ç¾¤åœ°å€è¿›è¡Œä¿®æ”¹ä¸ºï¼šHZ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310182019284.png\" alt=\"image-20231018201902967\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310182019735.png\" alt=\"image-20231018201919714\" /></p>\n<p>åœ¨ 8092 çš„ seata å¯åŠ¨çª—å£å°±å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>\n<p>æ­¤æ—¶æœåŠ¡å°±å…¨éƒ¨éƒ½åˆ‡æ¢åˆ°äº† 8092 è¿™ä¸ª seata æœåŠ¡ä¸Šäº†ï¼Œ7091 å°±æ²¡ç”¨äº†ç”šè‡³äºåœæ‰ä¹Ÿæ²¡æœ‰é—®é¢˜</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310182027851.png\" alt=\"image-20231018202705207\" /></p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "springcloud-é«˜çº§",
                "seata",
                "è®¡ç®—æœºå­¦ç§‘",
                "springcloud",
                "éƒ¨ç½²",
                "Seata"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/canal/%E5%AE%89%E8%A3%85Canal/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/canal/%E5%AE%89%E8%A3%85Canal/",
            "title": "å®‰è£…å’Œé…ç½®Canal",
            "date_published": "2024-01-06T02:51:08.278Z",
            "content_html": "<h1 id=\"å®‰è£…å’Œé…ç½®canal\"><a class=\"anchor\" href=\"#å®‰è£…å’Œé…ç½®canal\">#</a> å®‰è£…å’Œé…ç½® Canal</h1>\n<p>ä¸‹é¢æˆ‘ä»¬å°±å¼€å¯ mysql çš„ä¸»ä»åŒæ­¥æœºåˆ¶ï¼Œè®© Canal æ¥æ¨¡æ‹Ÿ salve</p>\n<h1 id=\"1å¼€å¯mysqlä¸»ä»\"><a class=\"anchor\" href=\"#1å¼€å¯mysqlä¸»ä»\">#</a> 1. å¼€å¯ MySQL ä¸»ä»</h1>\n<p>Canal æ˜¯åŸºäº MySQL çš„ä¸»ä»åŒæ­¥åŠŸèƒ½ï¼Œå› æ­¤å¿…é¡»å…ˆå¼€å¯ MySQL çš„ä¸»ä»åŠŸèƒ½æ‰å¯ä»¥ã€‚</p>\n<p>è¿™é‡Œä»¥ä¹‹å‰ç”¨ Docker è¿è¡Œçš„ mysql ä¸ºä¾‹ï¼š</p>\n<h2 id=\"11å¼€å¯binlog\"><a class=\"anchor\" href=\"#11å¼€å¯binlog\">#</a> 1.1. å¼€å¯ binlog</h2>\n<p>æ‰“å¼€ mysql å®¹å™¨æŒ‚è½½çš„æ—¥å¿—æ–‡ä»¶ï¼Œæˆ‘çš„åœ¨ <code>/tmp/mysql/conf</code>  ç›®å½•:</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310210931806.png\" alt=\"image-20210813153241537\" /></p>\n<p>ä¿®æ”¹æ–‡ä»¶ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vi</span> /tmp/mysql/conf/my.cnf</pre></td></tr></table></figure><p>æ·»åŠ å†…å®¹ï¼š</p>\n<figure class=\"highlight ini\"><figcaption data-lang=\"ini\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key attr-name\">log-bin</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">/var/lib/mysql/mysql-bin</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># æ•°æ®åº“åç§°</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key attr-name\">binlog-do-db</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">dkx</span></pre></td></tr></table></figure><p>é…ç½®è§£è¯»ï¼š</p>\n<ul>\n<li><code>log-bin=/var/lib/mysql/mysql-bin</code> ï¼šè®¾ç½® binary log æ–‡ä»¶çš„å­˜æ”¾åœ°å€å’Œæ–‡ä»¶åï¼Œå«åš mysql-bin</li>\n<li><code>binlog-do-db=dkx</code> ï¼šæŒ‡å®šå¯¹å“ªä¸ª database è®°å½• binary log eventsï¼Œè¿™é‡Œè®°å½• heima è¿™ä¸ªåº“</li>\n</ul>\n<p>æœ€ç»ˆæ•ˆæœï¼š</p>\n<figure class=\"highlight ini\"><figcaption data-lang=\"ini\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token section\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">mysqld</span><span class=\"token punctuation\">]</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>skip-name-resolve</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key attr-name\">character_set_server</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">utf8</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key attr-name\">datadir</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">/var/lib/mysql</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key attr-name\">server-id</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">1000</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key attr-name\">log-bin</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">/var/lib/mysql/mysql-bin</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key attr-name\">binlog-do-db</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">dkx</span></pre></td></tr></table></figure><p>é‡å¯ mysql</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> restart mysql</pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å›¾ä¸­å‡ºç°äº†æŒ‡å®šæ–‡ä»¶è¡¨ç¤ºæˆåŠŸï¼</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211007103.png\" alt=\"image-20231021100731994\" /></p>\n<h2 id=\"12è®¾ç½®ç”¨æˆ·æƒé™\"><a class=\"anchor\" href=\"#12è®¾ç½®ç”¨æˆ·æƒé™\">#</a> 1.2. è®¾ç½®ç”¨æˆ·æƒé™</h2>\n<p>æ¥ä¸‹æ¥æ·»åŠ ä¸€ä¸ªä»…ç”¨äºæ•°æ®åŒæ­¥çš„è´¦æˆ·ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œè¿™é‡Œä»…æä¾›å¯¹ heima è¿™ä¸ªåº“çš„æ“ä½œæƒé™ã€‚</p>\n<pre><code class=\"language-mysql\">create user canal@'%' IDENTIFIED by 'canal';\nGRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT,SUPER ON *.* TO 'canal'@'%' identified by 'canal';\nFLUSH PRIVILEGES;\n</code></pre>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">USER</span> canal IDENTIFIED <span class=\"token keyword\">BY</span> <span class=\"token string\">'canal'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">GRANT</span> <span class=\"token keyword\">SELECT</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">REPLICATION</span> SLAVE<span class=\"token punctuation\">,</span> <span class=\"token keyword\">REPLICATION</span> CLIENT <span class=\"token keyword\">ON</span> <span class=\"token punctuation\">.</span> <span class=\"token keyword\">TO</span> <span class=\"token string\">'canal'</span><span class=\"token variable\">@'%'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">GRANT</span> <span class=\"token keyword\">ALL</span> <span class=\"token keyword\">PRIVILEGES</span> <span class=\"token keyword\">ON</span> <span class=\"token punctuation\">.</span> <span class=\"token keyword\">TO</span> <span class=\"token string\">'canal'</span><span class=\"token variable\">@'%'</span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>FLUSH <span class=\"token keyword\">PRIVILEGES</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>mysql 8.0.2 å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">USER</span> canal IDENTIFIED <span class=\"token keyword\">BY</span> <span class=\"token string\">'canal'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">GRANT</span> <span class=\"token keyword\">SELECT</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">SHOW</span> <span class=\"token keyword\">VIEW</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">REPLICATION</span> SLAVE<span class=\"token punctuation\">,</span> <span class=\"token keyword\">REPLICATION</span> CLIENT <span class=\"token keyword\">ON</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> <span class=\"token keyword\">TO</span> <span class=\"token string\">'canal'</span><span class=\"token variable\">@'%'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>FLUSH <span class=\"token keyword\">PRIVILEGES</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>é‡å¯ mysql å®¹å™¨å³å¯</p>\n<pre><code>docker restart mysql\n</code></pre>\n<p>æµ‹è¯•è®¾ç½®æ˜¯å¦æˆåŠŸï¼šåœ¨ mysql æ§åˆ¶å°ï¼Œæˆ–è€… Navicat ä¸­ï¼Œè¾“å…¥å‘½ä»¤ï¼š</p>\n<pre><code>show master status;\n</code></pre>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211015054.png\" alt=\"image-20231021101552134\" /></p>\n<h1 id=\"2å®‰è£…canal\"><a class=\"anchor\" href=\"#2å®‰è£…canal\">#</a> 2. å®‰è£… Canal</h1>\n<h2 id=\"21åˆ›å»ºç½‘ç»œ\"><a class=\"anchor\" href=\"#21åˆ›å»ºç½‘ç»œ\">#</a> 2.1. åˆ›å»ºç½‘ç»œ</h2>\n<p>æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç½‘ç»œï¼Œå°† MySQLã€Canalã€MQ æ”¾åˆ°åŒä¸€ä¸ª Docker ç½‘ç»œä¸­ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> network create dkx</pre></td></tr></table></figure><p>è®© mysql åŠ å…¥è¿™ä¸ªç½‘ç»œï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> network connect dkx mysql</pre></td></tr></table></figure><h2 id=\"23å®‰è£…canal\"><a class=\"anchor\" href=\"#23å®‰è£…canal\">#</a> 2.3. å®‰è£… Canal</h2>\n<p>è¯¾å‰èµ„æ–™ä¸­æä¾›äº† canal çš„é•œåƒå‹ç¼©åŒ…:</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211145229.png\" alt=\"image-20210813161804292\" /></p>\n<p>å¤§å®¶å¯ä»¥ä¸Šä¼ åˆ°è™šæ‹Ÿæœºï¼Œç„¶åé€šè¿‡å‘½ä»¤å¯¼å…¥ï¼š</p>\n<pre><code>docker load -i canal.tar\n</code></pre>\n<p>ç„¶åè¿è¡Œå‘½ä»¤åˆ›å»º Canal å®¹å™¨ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-p</span> <span class=\"token number\">11111</span>:11111 <span class=\"token parameter variable\">--name</span> canal <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">canal.destinations</span><span class=\"token operator\">=</span>dkx1 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">canal.instance.master.address</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.249.128:3306  <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">canal.instance.dbUsername</span><span class=\"token operator\">=</span>canal  <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">canal.instance.dbPassword</span><span class=\"token operator\">=</span>canal  <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">canal.instance.connectionCharset</span><span class=\"token operator\">=</span>UTF-8 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">canal.instance.tsdb.enable</span><span class=\"token operator\">=</span>true <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">canal.instance.gtidon</span><span class=\"token operator\">=</span>false  <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">canal.instance.filter.regex</span><span class=\"token operator\">=</span>dkx<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">\\</span><span class=\"token punctuation\">..</span>* <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token parameter variable\">--network</span> dkx1 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token parameter variable\">-d</span> canal/canal-server:v1.1.5</pre></td></tr></table></figure><p>è¯´æ˜:</p>\n<ul>\n<li><code>-p 11111:11111</code> ï¼šè¿™æ˜¯ canal çš„é»˜è®¤ç›‘å¬ç«¯å£</li>\n<li><code>-e canal.instance.master.address=mysql:3306</code> ï¼šæ•°æ®åº“åœ°å€ (åŒä¸€ç½‘ç»œå¯ä»¥ä½¿ç”¨å®¹å™¨åäº’è”) å’Œç«¯å£ï¼Œå¦‚æœä¸çŸ¥é“ mysql å®¹å™¨åœ°å€ï¼Œå¯ä»¥é€šè¿‡ <code>docker inspect å®¹å™¨id</code>  æ¥æŸ¥çœ‹</li>\n<li><code>-e canal.instance.dbUsername=canal</code> ï¼šæ•°æ®åº“ç”¨æˆ·å</li>\n<li><code>-e canal.instance.dbPassword=canal</code>  ï¼šæ•°æ®åº“å¯†ç </li>\n<li><code>-e canal.instance.filter.regex=</code> ï¼šè¦ç›‘å¬çš„è¡¨åç§°</li>\n</ul>\n<p>è¡¨åç§°ç›‘å¬æ”¯æŒçš„è¯­æ³•ï¼š</p>\n<pre><code>mysql æ•°æ®è§£æå…³æ³¨çš„è¡¨ï¼ŒPerlæ­£åˆ™è¡¨è¾¾å¼.\nå¤šä¸ªæ­£åˆ™ä¹‹é—´ä»¥é€—å·(,)åˆ†éš”ï¼Œè½¬ä¹‰ç¬¦éœ€è¦åŒæ–œæ (\\\\) \nå¸¸è§ä¾‹å­ï¼š\n1.  æ‰€æœ‰è¡¨ï¼š.*   or  .*\\\\..*\n2.  canal schemaä¸‹æ‰€æœ‰è¡¨ï¼š canal\\\\..*\n3.  canalä¸‹çš„ä»¥canalæ‰“å¤´çš„è¡¨ï¼šcanal\\\\.canal.*\n4.  canal schemaä¸‹çš„ä¸€å¼ è¡¨ï¼šcanal.test1\n5.  å¤šä¸ªè§„åˆ™ç»„åˆä½¿ç”¨ç„¶åä»¥é€—å·éš”å¼€ï¼šcanal\\\\..*,mysql.test1,mysql.test2 \n</code></pre>\n<p>æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼ŒæŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸäº†ï¼š</p>\n<pre><code class=\"language-shÂ·\">[root@localhost tmp]# docker logs -f canal\nDOCKER_DEPLOY_TYPE=VM\n==&gt; INIT /alidata/init/02init-sshd.sh\n==&gt; EXIT CODE: 0\n==&gt; INIT /alidata/init/fix-hosts.py\n==&gt; EXIT CODE: 0\n==&gt; INIT DEFAULT\nGenerating SSH1 RSA host key: [  OK  ]\nStarting sshd: [  OK  ]\nStarting crond: [  OK  ]\n==&gt; INIT DONE\n==&gt; RUN /home/admin/app.sh\n==&gt; START ...\nstart canal ...\nstart canal successful\n==&gt; START SUCCESSFUL ...\n</code></pre>\n<p>æŸ¥çœ‹ canal æ˜¯å¦ä¸ mysql è¿›è¡Œå»ºç«‹è¿æ¥äº†</p>\n<p>æ­¥éª¤ï¼š</p>\n<p>1ã€è¿›å…¥ canal å†…éƒ¨</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost tmp<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker exec -it canal bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@a02803287608 admin<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>2ã€ä½¿ç”¨å‘½ä»¤ç›‘æ§ canal çš„æ—¥å¿—ä¿¡æ¯</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@a02803287608 admin<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>total <span class=\"token number\">8</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>-rwxr-xr-x. <span class=\"token number\">1</span> admin admin <span class=\"token number\">3941</span> Apr <span class=\"token number\">19</span>  <span class=\"token number\">2021</span> app.sh</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>drwxr-xr-x. <span class=\"token number\">2</span> admin admin   <span class=\"token number\">43</span> Apr <span class=\"token number\">19</span>  <span class=\"token number\">2021</span> bin</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>drwxr-xr-x. <span class=\"token number\">1</span> admin admin   <span class=\"token number\">66</span> Apr <span class=\"token number\">19</span>  <span class=\"token number\">2021</span> canal-server</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>-rwxr-xr-x. <span class=\"token number\">1</span> admin admin  <span class=\"token number\">670</span> Apr <span class=\"token number\">19</span>  <span class=\"token number\">2021</span> health.sh</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>lrwxrwxrwx. <span class=\"token number\">1</span> admin admin   <span class=\"token number\">44</span> Apr <span class=\"token number\">19</span>  <span class=\"token number\">2021</span> node_exporter -<span class=\"token operator\">></span> /home/admin/node_exporter-0.18.1.linux-arm64</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>drwxr-xr-x. <span class=\"token number\">2</span> admin admin   <span class=\"token number\">56</span> Jun  <span class=\"token number\">5</span>  <span class=\"token number\">2019</span> node_exporter-0.18.1.linux-arm64</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@a02803287608 admin<span class=\"token punctuation\">]</span><span class=\"token comment\"># tail -f canal-server/logs/canal/canal.log</span></pre></td></tr></table></figure><p>æ‰“å°æ—¥å¿—å¦‚ä¸‹</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">2023</span>-10-21 <span class=\"token number\">10</span>:31:37.324 <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  com.alibaba.otter.canal.deployer.CanalLauncher - <span class=\"token comment\">## set default uncaught exception handler</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">2023</span>-10-21 <span class=\"token number\">10</span>:31:37.376 <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  com.alibaba.otter.canal.deployer.CanalLauncher - <span class=\"token comment\">## load canal configurations</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2023</span>-10-21 <span class=\"token number\">10</span>:31:37.392 <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  com.alibaba.otter.canal.deployer.CanalStarter - <span class=\"token comment\">## start the canal server.</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">2023</span>-10-21 <span class=\"token number\">10</span>:31:37.466 <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  com.alibaba.otter.canal.deployer.CanalController - <span class=\"token comment\">## start the canal server[172.22.0.3(172.22.0.3):11111]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">2023</span>-10-21 <span class=\"token number\">10</span>:31:39.126 <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  com.alibaba.otter.canal.deployer.CanalStarter - <span class=\"token comment\">## the canal server is running now ......</span></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å¯åŠ¨æ²¡ä»€ä¹ˆé—®é¢˜</p>\n<p>æŸ¥çœ‹ mysql è¿æ¥çš„æ—¥å¿—</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@a02803287608 admin<span class=\"token punctuation\">]</span><span class=\"token comment\"># tail -f canal-server/logs/dkx1/dkx1.log</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">find</span> start position successfully, EntryPosition<span class=\"token punctuation\">[</span>included<span class=\"token operator\">=</span>false,journalName<span class=\"token operator\">=</span>mysql-bin.000006,position<span class=\"token operator\">=</span><span class=\"token number\">4</span>,serverId<span class=\"token operator\">=</span><span class=\"token number\">1000</span>,gtid<span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>null<span class=\"token operator\">></span>,timestamp<span class=\"token operator\">=</span><span class=\"token number\">1697857809000</span><span class=\"token punctuation\">]</span> cost <span class=\"token builtin class-name\">:</span> 521ms , the next step is binlog dump</pre></td></tr></table></figure>",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "springcloud-é«˜çº§",
                "canal",
                "è®¡ç®—æœºå­¦ç§‘",
                "åŸºç¡€",
                "springcloud",
                "Canal"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/OpenResty/%E5%AE%89%E8%A3%85OpenResty/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/OpenResty/%E5%AE%89%E8%A3%85OpenResty/",
            "title": "å®‰è£…OpenResty",
            "date_published": "2024-01-06T02:48:59.643Z",
            "content_html": "<h1 id=\"å®‰è£…openresty\"><a class=\"anchor\" href=\"#å®‰è£…openresty\">#</a> å®‰è£… OpenResty</h1>\n<h1 id=\"1å®‰è£…\"><a class=\"anchor\" href=\"#1å®‰è£…\">#</a> 1. å®‰è£…</h1>\n<p>é¦–å…ˆä½ çš„ Linux è™šæ‹Ÿæœºå¿…é¡»è”ç½‘</p>\n<h2 id=\"1å®‰è£…å¼€å‘åº“\"><a class=\"anchor\" href=\"#1å®‰è£…å¼€å‘åº“\">#</a> <strong>1ï¼‰å®‰è£…å¼€å‘åº“</strong></h2>\n<p>é¦–å…ˆè¦å®‰è£… OpenResty çš„ä¾èµ–å¼€å‘åº“ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> pcre-devel openssl-devel gcc --skip-broken</pre></td></tr></table></figure><h2 id=\"2å®‰è£…openrestyä»“åº“\"><a class=\"anchor\" href=\"#2å®‰è£…openrestyä»“åº“\">#</a> <strong>2ï¼‰å®‰è£… OpenResty ä»“åº“</strong></h2>\n<p>ä½ å¯ä»¥åœ¨ä½ çš„ CentOS ç³»ç»Ÿä¸­æ·»åŠ   <code>openresty</code>  ä»“åº“ï¼Œè¿™æ ·å°±å¯ä»¥ä¾¿äºæœªæ¥å®‰è£…æˆ–æ›´æ–°æˆ‘ä»¬çš„è½¯ä»¶åŒ…ï¼ˆé€šè¿‡  <code>yum check-update</code>  å‘½ä»¤ï¼‰ã€‚è¿è¡Œä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥æ·»åŠ æˆ‘ä»¬çš„ä»“åº“ï¼š</p>\n<pre><code>yum-config-manager --add-repo https://openresty.org/package/centos/openresty.repo\n</code></pre>\n<p>å¦‚æœæç¤ºè¯´å‘½ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿è¡Œï¼š</p>\n<pre><code>yum install -y yum-utils \n</code></pre>\n<p>ç„¶åå†é‡å¤ä¸Šé¢çš„å‘½ä»¤</p>\n<h2 id=\"3å®‰è£…openresty\"><a class=\"anchor\" href=\"#3å®‰è£…openresty\">#</a> <strong>3ï¼‰å®‰è£… OpenResty</strong></h2>\n<p>ç„¶åå°±å¯ä»¥åƒä¸‹é¢è¿™æ ·å®‰è£…è½¯ä»¶åŒ…ï¼Œæ¯”å¦‚  <code>openresty</code> ï¼š</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> openresty</pre></td></tr></table></figure><h2 id=\"4å®‰è£…opmå·¥å…·\"><a class=\"anchor\" href=\"#4å®‰è£…opmå·¥å…·\">#</a> <strong>4ï¼‰å®‰è£… opm å·¥å…·</strong></h2>\n<p>opm æ˜¯ OpenResty çš„ä¸€ä¸ªç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®‰è£…ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„ Lua æ¨¡å—ã€‚</p>\n<p>å¦‚æœä½ æƒ³å®‰è£…å‘½ä»¤è¡Œå·¥å…·  <code>opm</code> ï¼Œé‚£ä¹ˆå¯ä»¥åƒä¸‹é¢è¿™æ ·å®‰è£…  <code>openresty-opm</code>  åŒ…ï¼š</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> openresty-opm</pre></td></tr></table></figure><h2 id=\"5ç›®å½•ç»“æ„\"><a class=\"anchor\" href=\"#5ç›®å½•ç»“æ„\">#</a> <strong>5ï¼‰ç›®å½•ç»“æ„</strong></h2>\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒOpenResty å®‰è£…çš„ç›®å½•æ˜¯ï¼š/usr/local/openresty</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200901485.png\" alt=\"image-20200310225539214\" /></p>\n<p>çœ‹åˆ°é‡Œé¢çš„ nginx ç›®å½•äº†å—ï¼ŒOpenResty å°±æ˜¯åœ¨ Nginx åŸºç¡€ä¸Šé›†æˆäº†ä¸€äº› Lua æ¨¡å—ã€‚</p>\n<h2 id=\"6é…ç½®nginxçš„ç¯å¢ƒå˜é‡\"><a class=\"anchor\" href=\"#6é…ç½®nginxçš„ç¯å¢ƒå˜é‡\">#</a> <strong>6ï¼‰é…ç½® nginx çš„ç¯å¢ƒå˜é‡</strong></h2>\n<p>æ‰“å¼€é…ç½®æ–‡ä»¶ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vi</span> /etc/profile</pre></td></tr></table></figure><p>åœ¨æœ€ä¸‹é¢åŠ å…¥ä¸¤è¡Œï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">NGINX_HOME</span><span class=\"token operator\">=</span>/usr/local/openresty/nginx</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token variable\">$&#123;NGINX_HOME&#125;</span>/sbin:<span class=\"token environment constant\">$PATH</span></pre></td></tr></table></figure><p>NGINX_HOMEï¼šåé¢æ˜¯ OpenResty å®‰è£…ç›®å½•ä¸‹çš„ nginx çš„ç›®å½•</p>\n<p>ç„¶åè®©é…ç½®ç”Ÿæ•ˆï¼š</p>\n<pre><code>source /etc/profile\n</code></pre>\n<h1 id=\"2å¯åŠ¨å’Œè¿è¡Œ\"><a class=\"anchor\" href=\"#2å¯åŠ¨å’Œè¿è¡Œ\">#</a> 2. å¯åŠ¨å’Œè¿è¡Œ</h1>\n<p>OpenResty åº•å±‚æ˜¯åŸºäº Nginx çš„ï¼ŒæŸ¥çœ‹ OpenResty ç›®å½•çš„ nginx ç›®å½•ï¼Œç»“æ„ä¸ windows ä¸­å®‰è£…çš„ nginx åŸºæœ¬ä¸€è‡´ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200901105.png\" alt=\"image-20210811100653291\" /></p>\n<p>æ‰€ä»¥è¿è¡Œæ–¹å¼ä¸ nginx åŸºæœ¬ä¸€è‡´ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># å¯åŠ¨ nginx</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>nginx</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># é‡æ–°åŠ è½½é…ç½®</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>nginx <span class=\"token parameter variable\">-s</span> reload</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># åœæ­¢</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>nginx <span class=\"token parameter variable\">-s</span> stop</pre></td></tr></table></figure><p>nginx çš„é»˜è®¤é…ç½®æ–‡ä»¶æ³¨é‡Šå¤ªå¤šï¼Œå½±å“åç»­æˆ‘ä»¬çš„ç¼–è¾‘ï¼Œè¿™é‡Œå°† nginx.conf ä¸­çš„æ³¨é‡Šéƒ¨åˆ†åˆ é™¤ï¼Œä¿ç•™æœ‰æ•ˆéƒ¨åˆ†ã€‚</p>\n<p>ä¿®æ”¹ <code>/usr/local/openresty/nginx/conf/nginx.conf</code>  æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#user  nobody;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">worker_processes</span>  <span class=\"token number\">1</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">error_log</span>  logs/error.log</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">events</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">worker_connections</span>  <span class=\"token number\">1024</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">http</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">include</span>       mime.types</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">default_type</span>  application/octet-stream</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">sendfile</span>        <span class=\"token boolean\">on</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">keepalive_timeout</span>  <span class=\"token number\">65</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">listen</span>       <span class=\"token number\">8081</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">server_name</span>  localhost</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> /</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">root</span>   html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">index</span>  index.html index.htm</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">error_page</span>   <span class=\"token number\">500</span> <span class=\"token number\">502</span> <span class=\"token number\">503</span> <span class=\"token number\">504</span>  /50x.html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> = /50x.html</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">root</span>   html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨ Linux çš„æ§åˆ¶å°è¾“å…¥å‘½ä»¤ä»¥å¯åŠ¨ nginxï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>nginx</pre></td></tr></table></figure><p>ç„¶åè®¿é—®é¡µé¢ï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTUwLjEwMTo4MDgx\">http://192.168.150.101:8081</span>ï¼Œæ³¨æ„ ip åœ°å€æ›¿æ¢ä¸ºä½ è‡ªå·±çš„è™šæ‹Ÿæœº IPï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200910980.png\" alt=\"image-20231020091008283\" /></p>\n<h1 id=\"3å¤‡æ³¨\"><a class=\"anchor\" href=\"#3å¤‡æ³¨\">#</a> 3. å¤‡æ³¨</h1>\n<p>åŠ è½½ OpenResty çš„ lua æ¨¡å—ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#lua æ¨¡å—</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">lua_package_path</span> <span class=\"token string\">\"/usr/local/openresty/lualib/?.lua;;\"</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#c æ¨¡å—     </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">lua_package_cpath</span> <span class=\"token string\">\"/usr/local/openresty/lualib/?.so;;\"</span></span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>ç›‘å¬æµè§ˆå™¨è¯·æ±‚</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">listen</span>       <span class=\"token number\">8081</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">server_name</span>  localhost</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> /api/item</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>          <span class=\"token comment\"># é»˜è®¤çš„å“åº”ç±»å‹</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>          <span class=\"token directive\"><span class=\"token keyword\">default_type</span> application/json</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>          <span class=\"token comment\"># å“åº”ç»“æœç”± lua/item.lua ä¸‹çš„æ–‡ä»¶å†³å®š</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>          <span class=\"token directive\"><span class=\"token keyword\">content_by_lua_file</span> lua/item.lua</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> /</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">root</span>   html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">index</span>  index.html index.htm</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">error_page</span>   <span class=\"token number\">500</span> <span class=\"token number\">502</span> <span class=\"token number\">503</span> <span class=\"token number\">504</span>  /50x.html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> = /50x.html</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">root</span>   html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>common.lua</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å°è£…å‡½æ•°ï¼Œå‘é€ http è¯·æ±‚ï¼Œå¹¶è§£æå“åº”</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">read_http</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">local</span> resp <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span><span class=\"token function\">capture</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        method <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>HTTP_GET<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        args <span class=\"token operator\">=</span> params<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> resp <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">-- è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œè¿”å› 404</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"http not found, path: \"</span><span class=\"token punctuation\">,</span> path <span class=\"token punctuation\">,</span> <span class=\"token string\">\", args: \"</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">404</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">return</span> resp<span class=\"token punctuation\">.</span>body</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">-- å°†æ–¹æ³•å¯¼å‡º</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">local</span> _M <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>  </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    read_http <span class=\"token operator\">=</span> read_http</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span>  </pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">return</span> _M</pre></td></tr></table></figure><p>é‡Šæ”¾ Redis è¿æ¥ APIï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å…³é—­ redis è¿æ¥çš„å·¥å…·æ–¹æ³•ï¼Œå…¶å®æ˜¯æ”¾å…¥è¿æ¥æ± </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">close_redis</span><span class=\"token punctuation\">(</span>red<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">local</span> pool_max_idle_time <span class=\"token operator\">=</span> <span class=\"token number\">10000</span> <span class=\"token comment\">-- è¿æ¥çš„ç©ºé—²æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">local</span> pool_size <span class=\"token operator\">=</span> <span class=\"token number\">100</span> <span class=\"token comment\">-- è¿æ¥æ± å¤§å°</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">local</span> ok<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> red<span class=\"token punctuation\">:</span><span class=\"token function\">set_keepalive</span><span class=\"token punctuation\">(</span>pool_max_idle_time<span class=\"token punctuation\">,</span> pool_size<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> ok <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"æ”¾å…¥redisè¿æ¥æ± å¤±è´¥: \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>è¯»å– Redis æ•°æ®çš„ APIï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢ redis çš„æ–¹æ³• ip å’Œ port æ˜¯ redis åœ°å€ï¼Œkey æ˜¯æŸ¥è¯¢çš„ key</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">read_redis</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">-- è·å–ä¸€ä¸ªè¿æ¥</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">local</span> ok<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> red<span class=\"token punctuation\">:</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> ok <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"è¿æ¥rediså¤±è´¥ : \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">nil</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">-- æŸ¥è¯¢ redis</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">local</span> resp<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> red<span class=\"token punctuation\">:</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">-- æŸ¥è¯¢å¤±è´¥å¤„ç†</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> resp <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"æŸ¥è¯¢Rediså¤±è´¥: \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">,</span> <span class=\"token string\">\", key = \"</span> <span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\">-- å¾—åˆ°çš„æ•°æ®ä¸ºç©ºå¤„ç†</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">if</span> resp <span class=\"token operator\">==</span> ngx<span class=\"token punctuation\">.</span>null <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        resp <span class=\"token operator\">=</span> <span class=\"token keyword\">nil</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"æŸ¥è¯¢Redisæ•°æ®ä¸ºç©º, key = \"</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token function\">close_redis</span><span class=\"token punctuation\">(</span>red<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">return</span> resp</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>å¼€å¯å…±äº«è¯å…¸ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># å…±äº«å­—å…¸ï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œåç§°å«åšï¼šitem_cacheï¼Œå¤§å° 150m</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">lua_shared_dict</span> item_cache <span class=\"token number\">150m</span></span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure>",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "springcloud-é«˜çº§",
                "OpenResty",
                "è®¡ç®—æœºå­¦ç§‘",
                "springcloud",
                "OpenResty"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%AB%98%E7%BA%A7%E7%AF%87/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-%E9%AB%98%E7%BA%A7/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%AB%98%E7%BA%A7%E7%AF%87/",
            "title": "SpringCloudé«˜çº§ç¯‡",
            "date_published": "2024-01-06T02:42:53.168Z",
            "content_html": "<h1 id=\"ä¸€-å¾®æœåŠ¡ä¿æŠ¤\"><a class=\"anchor\" href=\"#ä¸€-å¾®æœåŠ¡ä¿æŠ¤\">#</a> ä¸€ã€å¾®æœåŠ¡ä¿æŠ¤ğŸ„</h1>\n<ul>\n<li>Sentinel</li>\n</ul>\n<p>å­¦ä¹ å†…å®¹ï¼š</p>\n<ul>\n<li>åˆå§‹ Sentinel</li>\n<li>æµé‡æ§åˆ¶</li>\n<li>éš”ç¦»å’Œé™çº§</li>\n<li>æˆæƒè§„åˆ™</li>\n<li>è§„åˆ™æŒä¹…åŒ–</li>\n</ul>\n<h2 id=\"11-åˆå§‹sentinel\"><a class=\"anchor\" href=\"#11-åˆå§‹sentinel\">#</a> 1.1ã€åˆå§‹ SentinelğŸŒ³</h2>\n<ul>\n<li>é›ªå´©é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</li>\n<li>æœåŠ¡ä¿æŠ¤æŠ€æœ¯å¯¹æ¯”</li>\n<li>Sentinel ä»‹ç»å’Œå®‰è£…</li>\n<li>å¾®æœåŠ¡æ•´åˆ Sentinel</li>\n</ul>\n<h3 id=\"111-é›ªå´©é—®é¢˜\"><a class=\"anchor\" href=\"#111-é›ªå´©é—®é¢˜\">#</a> 1.1.1ã€é›ªå´©é—®é¢˜ğŸŒ²</h3>\n<p>å¾®æœåŠ¡è°ƒç”¨é“¾è·¯ä¸­çš„æŸä¸ªæœåŠ¡æ•…éšœï¼Œå¼•èµ·æ•´ä¸ªé“¾è·¯ä¸­çš„æ‰€æœ‰å¾®æœåŠ¡éƒ½ä¸å¯ç”¨ï¼Œè¿™å°±æ˜¯é›ªå´©ã€‚</p>\n<p><strong>åœºæ™¯</strong>ï¼š</p>\n<p>æ¯”æ–¹è¯´åœ¨æœåŠ¡ A å†…éƒ¨ä¾èµ–äºæœåŠ¡ Bï¼Œè€ŒæœåŠ¡ A å†…éƒ¨å¯èƒ½è¿˜æœ‰ä¸€äº›å…¶å®ƒçš„ä¸šåŠ¡æ¯”å¦‚è¯´å®ƒä¾èµ–äºæœåŠ¡ C æˆ–è€…æ˜¯ä¾èµ–äºæœåŠ¡ D</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161531964.png\" alt=\"image-20231016153100257\" /></p>\n<p>ç°åœ¨å‡è®¾è¯´æœåŠ¡ D å‡ºç°äº†æ•…éšœï¼Œé‚£æœåŠ¡ A å†…éƒ¨ä¾èµ–ä¸æœåŠ¡ D çš„ä¸šåŠ¡è¯·æ±‚å°±ä¸èƒ½æ­£å¸¸è®¿é—®äº†</p>\n<p>å› ä¸ºæœåŠ¡ A è®¿é—®æœåŠ¡ D å°±å¿…ç„¶è¦ç­‰å¾…æœåŠ¡ D çš„å“åº”ç»“æœï¼Œè€Œå› ä¸ºæœåŠ¡ D å‡ºç°äº†æ•…éšœä¸å¯èƒ½è¿”å›ç»“æœå®ƒä¼šé˜»å¡ï¼Œé‚£å°±å¯¼è‡´äº†æœåŠ¡ A å†…éƒ¨ä¸šåŠ¡ä¹Ÿä¼šé˜»å¡ï¼Œé˜»å¡ å®ƒå°±ä¸ä¼šé‡Šæ”¾ tomcat çš„é“¾æ¥ã€‚å½“ç„¶å…¶å®ƒä¸šåŠ¡è¯·æ±‚ä¸å—å½±å“è¿˜å¯ä»¥æ­£å¸¸å·¥ä½œã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161532119.png\" alt=\"image-20231016153207881\" /></p>\n<p>ä½†æ˜¯æ—¢ç„¶æœ‰ç¬¬ä¸€ä¸ªä¾èµ–äºæœåŠ¡ D è¿™æ ·çš„è¯·æ±‚ï¼Œé‚£ä¸€å®šè¿˜ä¼šæœ‰ç¬¬äºŒä¸ªç”šè‡³ç¬¬ä¸‰ä¸ªã€‚è¿™æ ·ä¾èµ–äºæœåŠ¡ D çš„ä¸šåŠ¡è¯·æ±‚è¶Šæ¥è¶Šå¤šï¼Œè€Œå®ƒä»¬éƒ½ä¸ä¼šé‡Šæ”¾è¿æ¥ï¼Œé‚£ä¹ˆæ—¶ä¹…ä¸€å®šä¼šæŠŠæœåŠ¡ A å†…éƒ¨æ‰€æœ‰çš„é“¾æ¥éƒ½ç»™å ç”¨äº†</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ tomcat èµ„æºè€—å°½äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161537530.png\" alt=\"image-20231016153714784\" /></p>\n<p>æ­¤æ—¶å†æœ‰æœåŠ¡è¿›æ¥å“ªæ€•ä¸æ˜¯ä¾èµ–äºæœåŠ¡ D çš„è€Œæ˜¯æœåŠ¡ B çš„ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿè¿›ä¸æ¥äº†ã€‚é‚£å°±å¯ä»¥è®¤ä¸ºæœåŠ¡ A ä¹Ÿå‡ºç°äº†æ•…éšœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161539417.png\" alt=\"image-20231016153923278\" /></p>\n<p>è¿™å°±é€ æˆäº†ä¸€ä¸ªæœåŠ¡çš„æ•…éšœå¯¼è‡´äº†ä¾èµ–äºå®ƒçš„æœåŠ¡æœ€ç»ˆä¹Ÿå‡ºç°äº†æ•…éšœã€‚åœ¨å¾®æœåŠ¡é‡Œè¿™ç§è°ƒç”¨å…³ç³»å¯ä¸æ­¢è¿™ä¹ˆç®€å•</p>\n<p>é‚£ä¹ˆæœåŠ¡ A ä¾èµ–äºæœåŠ¡ D å¯¼è‡´æœ€åç»™æœåŠ¡ D æ‹–å®äº†ï¼Œé‚£è‚¯å®šè¿˜ä¼šæœ‰å…¶å®ƒçš„æœåŠ¡ä¹Ÿä¾èµ–äºæœåŠ¡ Dï¼Œæœ€ç»ˆä¹Ÿä¼šè¢«æ‹–å®ï¼Œå°†æ¥å…¶å®ƒä¾èµ–äºæœåŠ¡ A çš„ä¹Ÿä¼šå‡ºç°æ•…éšœï¼Œæœ€ç»ˆæ•…éšœçš„æœåŠ¡è¶Šæ¥è¶Šå¤šé‚£ä¹ˆæ•´ä¸ªå¾®æœåŠ¡ç¾¤å°±ä¸å¯ç”¨äº†ã€‚</p>\n<p>è¿™ä¸å°±æ˜¯é›ªå´©äº†å—ï¼</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161541181.png\" alt=\"image-20231016154142767\" /></p>\n<h3 id=\"112-è§£å†³é›ªå´©é—®é¢˜\"><a class=\"anchor\" href=\"#112-è§£å†³é›ªå´©é—®é¢˜\">#</a> 1.1.2ã€è§£å†³é›ªå´©é—®é¢˜ğŸŒ²</h3>\n<p><strong>è§£å†³é›ªå´©é—®é¢˜çš„å¸¸è§æ–¹å¼æœ‰å››ç§</strong>ï¼š</p>\n<p>1ã€<mark>è¶…æ—¶å¤„ç†</mark>ï¼šè®¾å®šè¶…æ—¶æ—¶é—´ï¼Œè¯·æ±‚è¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰å“åº”ç»“æœå°±è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œä¸ä¼šæ— ä¼‘æ­¢ç­‰å¾…</p>\n<p>ä¼šåœ¨è°ƒç”¨ä¸šåŠ¡æ—¶åŠ ä¸Šä¸€ä¸ªè¶…æ—¶æ—¶é—´æ¯”å¦‚è¯´ 1 ç§’é’Ÿï¼Œå½“æœåŠ¡ A ä¾èµ–äºæœåŠ¡ C æ—¶è¯·æ±‚æœ€å¤šç­‰å¾… 1 ç§’é’Ÿï¼Œå¦‚æœè¯·æ±‚è¶…è¿‡ 1 ç§’é’Ÿå°±ä¼šç«‹å³ç»“æŸè¿™ä¸ªè¯·æ±‚ï¼Œä¸å†ç­‰å¾…ï¼Œè¿”å›ç»™ç”¨æˆ·æç¤ºä¿¡æ¯ (ä¸å¥½æ„æ€å¤±è´¥äº†)</p>\n<p>ç¼ºç‚¹ï¼šåªèƒ½èµ·åˆ°ç¼“è§£ä½œç”¨ï¼Œä¸èƒ½è§£å†³æ ¹æœ¬é—®é¢˜ï¼Œå› ä¸ºè¯·æ±‚é€Ÿåº¦å¤§äºç­‰å¾…æ—¶é—´å°±ä¼šå‡ºç°é—®é¢˜</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161546216.png\" alt=\"image-20231016154632246\" /></p>\n<p>2ã€<mark>èˆ±å£æ¨¡å¼</mark>ï¼šé™å®šæ¯ä¸ªä¸šåŠ¡èƒ½ä½¿ç”¨çš„çº¿ç¨‹æ•°ï¼Œé¿å…è€—å°½æ•´ä¸ª tomcat çš„èµ„æºï¼Œå› æ­¤ä¹Ÿå«çº¿ç¨‹éš”ç¦»ã€‚</p>\n<p>èˆ±å£æ¨¡å¼æ˜¯æ¥è‡ªäºç°å®ç”Ÿæ´»ä¸­çš„èˆ¹èˆ±çš„è®¾è®¡ï¼Œä¸€äº›å¤§å‹çš„è½®èˆ¹å®ƒéƒ½ä¼šæŠŠèˆ¹ä½“åˆ©ç”¨éš”æ¿åˆ†éš”æˆç‹¬ç«‹çš„å°çš„ç©ºé—´è¿™æ ·çš„éš”æ¿å°±å«åšèˆ±å£ã€‚å› ä¸ºè¿™äº›ç©ºé—´ä¹‹é—´æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œå‡è®¾è¯´èˆ¹ä½“çš„æŸä¸ªéƒ¨ä½æ’ä¸Šäº†å†°å±±æ¼æ°´äº†ã€‚é‚£ä¹ˆæœ€å¤šåªæ˜¯æŠŠéƒ¨åˆ†èˆ¹èˆ±å¡«æ»¡æ°´ï¼Œå› ä¸ºæ˜¯éš”ç¦»çš„æ‰€ä»¥å…¶å®ƒèˆ¹èˆ±ä¸å—å½±å“ã€‚è¿™æ ·å°±æé«˜äº†æ•´è‰˜èˆ¹çš„å®¹ç¾èƒ½åŠ›</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161550959.png\" alt=\"image-20231016155024959\" /></p>\n<p>è¿™ç§æ¨¡å¼å»¶ç»­åˆ°ç¨‹åºè®¾è®¡é‡Œè¾¹æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ</p>\n<p>è¿™æ˜¯æœåŠ¡ A é‡Œé¢çš„èµ„æºä¹Ÿå°±æ˜¯ tomcat å°±å¯ä»¥çœ‹åšæˆæ•´è‰˜èˆ¹ã€‚æˆ‘ä»¬å¯ä»¥æŠŠ tomcat é‡Œé¢çš„èµ„æº (çº¿ç¨‹) åˆ’åˆ†æˆä¸€ä¸ªä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ± ã€‚ç»™æ¯ä¸ªä¸šåŠ¡åˆ†é…ä¸€ä¸ªçº¿ç¨‹æ± ã€‚ç°åœ¨ä¸šåŠ¡ 1 è¿›æ¥åå®ƒä¾èµ–äºæœåŠ¡ Bï¼Œå®ƒæœ€å¤šä½¿ç”¨åä¸ªé™åˆ¶ï¼Œè®¿é—®ä¸šåŠ¡ 2 æ¯”æ–¹è¯´å®ƒä¾èµ–äºæœåŠ¡ Cï¼Œå®ƒä¹Ÿæœ€å¤šä½¿ç”¨åçº¿ç¨‹ã€‚</p>\n<p>ç°åœ¨å‡è®¾è¯´æœåŠ¡ C å‡ºç°æ•…éšœäº†ï¼Œè¿™ä¸ªä¸šåŠ¡ 2 å°±ä¼šé˜»å¡å ç”¨çº¿ç¨‹ï¼Œä½†æ˜¯å®ƒæœ€å¤šå ç”¨åä¸ªï¼Œè¿™æ—¶å®ƒèƒ½å¤Ÿä½¿ç”¨ tomcat çš„èµ„æºæ˜¯æœ‰é™çš„ï¼Œè¿™æ ·å°±æŠŠæ•…éšœéš”ç¦»åˆ°åä¸ªçº¿ç¨‹å†…äº†ï¼Œå› æ­¤ä¹Ÿå«çº¿ç¨‹éš”ç¦»ã€‚å› æ­¤å°±é¿å…äº†æ•´ä¸ª tomcat è¢«è€—å°½çš„æƒ…å†µ</p>\n<p>ç¼ºç‚¹ï¼šèµ„æºæœ‰ä¸€å®šçš„æµªè´¹ï¼Œæ¯”å¦‚è¯´æœåŠ¡ C çœŸçš„å®•æœºäº†ï¼Œç°åœ¨æ¯æ¬¡è¯·æ±‚æ¥è¿˜è®©å®ƒå°è¯•ç€å»è®¿é—®ä¸€ä¸‹æœåŠ¡ C è¿˜è¦å ç”¨åä¸ªçº¿ç¨‹ä¹Ÿæ˜¯ä¸€ç§æµªè´¹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161558553.png\" alt=\"image-20231016155848381\" /></p>\n<p>3ã€<mark>ç†”æ–­é™çº§</mark>ï¼šç”±<mark>æ–­è·¯å™¨</mark>ç»Ÿè®¡ä¸šåŠ¡æ‰§è¡Œçš„å¼‚å¸¸æ¯”ä¾‹ï¼Œå¦‚æœè¶…å‡ºé˜ˆå€¼åˆ™ä¼š<mark>ç†”æ–­</mark>è¯¥ä¸šåŠ¡ï¼Œæ‹¦æˆªè®¿é—®è¯¥ä¸šåŠ¡çš„ä¸€åˆ‡è¯·æ±‚ã€‚</p>\n<p>ç»Ÿè®¡æœåŠ¡ A é‡Œé¢çš„ä¸šåŠ¡ï¼Œæ¯”æ–¹è¯´æœåŠ¡ A é‡Œç¬¬ä¸€æ¬¡ä¸šåŠ¡è®¿é—®æ˜¯æ­£å¸¸çš„ï¼Œç»“æœåé¢ä¸¤æ¬¡éƒ½å‡ºç°äº†æ•…éšœã€‚è¿™æ—¶æ–­è·¯å™¨å°±ä¼šç»Ÿè®¡æ¯”ä¾‹ï¼Œä¸‰ä¸ªè¯·æ±‚ä¸€ä¸ªæ­£å¸¸ä¸¤ä¸ªæ•…éšœï¼Œæ•…éšœæ¯”ä¾‹é«˜è¾¾ 60%ã€‚å‡è®¾è¯´é˜ˆå€¼æ˜¯ 50% è¶…å‡ºäº†é˜ˆå€¼ï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°ç†”æ–­ã€‚</p>\n<p>ä¸€æ—¦è¢«ç†”æ–­å¦‚æœåœ¨æœåŠ¡ A å†…éƒ¨è¿˜æƒ³è¦è®¿é—®æœåŠ¡ D çš„ä¸šåŠ¡å°±æ— æ³•å†å»è®¿é—®æœåŠ¡ D äº†ï¼Œåªè¦æ˜¯è®¿é—®æœåŠ¡ D çš„ä¸šåŠ¡å°±ä¼šè¢«æ‹¦æˆª</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161606208.png\" alt=\"image-20231016160627109\" /></p>\n<p>4ã€<mark>æµé‡æ§åˆ¶</mark>ï¼šé™åˆ¶ä¸šåŠ¡è®¿é—® QPSï¼Œé¿å…æœåŠ¡å› æµé‡çš„çªå¢è€Œæ•…éšœã€‚</p>\n<p>QPSï¼šæ¯ç§’é’Ÿå¤„ç†çš„è¯·æ±‚æ•°é‡</p>\n<p>æ¯”æ–¹è¯´æœ‰ä¸€ä¸ªå¾®æœåŠ¡ï¼Œå®ƒèƒ½æ‰¿å—çš„æœ€å¤§ QPS ä¸º 2ï¼Œä¹Ÿå°±æ˜¯æ¯ç§’é’Ÿæœ€å¤šå¤„ç†ä¸¤ä¸ªè¯·æ±‚ã€‚</p>\n<p>ä½†æ˜¯ç°åœ¨æœ‰æ— æ•°ä¸ªè¯·æ±‚æ¶Œè¿‡æ¥ï¼Œå°±ä¼šå‡ºç°æ•…éšœï¼Œä¸€æ—¦è¿™ä¸ªæœåŠ¡å‡ºç°æ•…éšœï¼Œè€Œä¾èµ–äºè¿™ä¸ªæœåŠ¡çš„å…¶å®ƒæœåŠ¡ä¹Ÿå°±è·Ÿç€å‡ºç°æ•…éšœå°±ä¼šå‡ºç°é›ªå´©é—®é¢˜</p>\n<p>æ‰€ä»¥æˆ‘ä»¬è¦é¿å…æœåŠ¡å› ä¸ºæµé‡è¿‡é«˜è€Œå¼•èµ·æ•…éšœï¼Œè¿™æ—¶å°±éœ€è¦ç”¨åˆ° Sentinel äº†</p>\n<p>ç°åœ¨å‡è®¾è¯´æœ‰æ— æ•°ä¸ªè¯·æ±‚è¿‡æ¥è€Œ Sentinel å¯ä»¥æŒ‰ç…§è¿™ä¸ªæœåŠ¡æ‰€èƒ½å¤Ÿæ‰¿å—çš„é¢‘ç‡å»é‡Šæ”¾è¯·æ±‚ï¼Œè¿™æ—¶å¾®æœåŠ¡å°±èƒ½ä»å®¹åº”å¯¹è¿™äº›è¯·æ±‚äº†å°±é¿å…äº†å‡ºç°æ•…éšœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161613445.png\" alt=\"image-20231016161314587\" /></p>\n<p>æµé‡æ§åˆ¶æ˜¯é¢„é˜²é›ªå´©ï¼Œå‰é¢ä¸‰ç§æ˜¯å·²ç»æœ‰æœåŠ¡æ•…éšœäº†æˆ‘æ€ä¹ˆæ ·å»é¿å…è¿™ä¸ªæ•…éšœä¼ é€’ç»™å…¶å®ƒæœåŠ¡</p>\n<p>ä½†æ˜¯ä¹Ÿä¸èƒ½è¯´ï¼Œé‚£æˆ‘å°±åªç”¨ æµé‡æ§åˆ¶å‘—ï¼Œå…¶å®ƒçš„æˆ‘å°±ä¸ç”¨äº†ï¼Œè¿™æ ·æ˜¾ç„¶æ˜¯ä¸å¯¹çš„ã€‚</p>\n<p>å› ä¸ºé«˜å¹¶å‘å¼•èµ·çš„æœåŠ¡æ•…éšœåªæ˜¯æ•…éšœçš„åŸå› ä¹‹ä¸€ï¼Œå¾€å¾€æœåŠ¡è¿˜ä¼šå› ä¸ºå…¶å®ƒé—®é¢˜è€Œå‡ºç°æ•…éšœã€‚æ¯”æ–¹è¯´ç½‘ç»œé—®é¢˜æˆ–è€…è¯´ fgc å¼•èµ·çš„å‡æ­»é—®é¢˜ï¼Œè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°å…¶å®ƒçš„è§£å†³æ–¹æ¡ˆäº†</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>ä»€ä¹ˆæ˜¯é›ªå´©é—®é¢˜ï¼Ÿ</p>\n<ul>\n<li>å¾®æœåŠ¡ä¹‹é—´ç›¸äº’è°ƒç”¨ï¼Œå› ä¸ºè°ƒç”¨é“¾ä¸­ä¸€ä¸ªæœåŠ¡æ•…éšœï¼Œå¼•èµ·æ•´ä¸ªé“¾è·¯éƒ½æ— æ³•è®¿é—®çš„æƒ…å†µ</li>\n</ul>\n<p>å¦‚ä½•é¿å…å› ç¬é—´é«˜å¹¶å‘æµé‡è€Œå¯¼è‡´æœåŠ¡æ•…éšœï¼Ÿ</p>\n<ul>\n<li>æµé‡æ§åˆ¶</li>\n</ul>\n<p>å¦‚ä½•é¿å…å› æœåŠ¡æ•…éšœå¼•èµ·çš„é›ªå´©é—®é¢˜ï¼Ÿ</p>\n<ul>\n<li>è¶…æ—¶å¤„ç†</li>\n<li>çº¿ç¨‹éš”ç¦»</li>\n<li>é™çº§ç†”æ–­</li>\n</ul>\n</blockquote>\n<h3 id=\"113-æœåŠ¡ä¿æŠ¤æŠ€æœ¯å¯¹æ¯”\"><a class=\"anchor\" href=\"#113-æœåŠ¡ä¿æŠ¤æŠ€æœ¯å¯¹æ¯”\">#</a> 1.1.3ã€æœåŠ¡ä¿æŠ¤æŠ€æœ¯å¯¹æ¯”ğŸŒ²</h3>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Sentinel</th>\n<th>Hystrix</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>éš”ç¦»ç­–ç•¥</td>\n<td>ä¿¡å·é‡éš”ç¦»</td>\n<td>çº¿ç¨‹æ± éš”ç¦» / ä¿¡å·é‡éš”ç¦»</td>\n</tr>\n<tr>\n<td>ç†”æ–­é™çº§ç­–ç•¥</td>\n<td>åŸºäºæ…¢è°ƒç”¨æ¯”ä¾‹æˆ–å¼‚å¸¸æ¯”ä¾‹</td>\n<td>åŸºäºå¤±è´¥æ¯”ä¾‹</td>\n</tr>\n<tr>\n<td>å®æ—¶æŒ‡æ ‡å®ç°</td>\n<td>æ»‘åŠ¨çª—å£</td>\n<td>æ»‘åŠ¨çª—å£ (åŸºäº RxJava)</td>\n</tr>\n<tr>\n<td>è§„åˆ™é…ç½®</td>\n<td>æ”¯æŒå¤šç§æ•°æ®æº</td>\n<td>æ”¯æŒå¤šç§æ•°æ®æº</td>\n</tr>\n<tr>\n<td>æ‰©å±•æ€§</td>\n<td>å¤šä¸ªæ‰©å±•ç‚¹</td>\n<td>æ’ä»¶çš„å½¢å¼</td>\n</tr>\n<tr>\n<td>åŸºäºæ³¨è§£çš„æ”¯æŒ</td>\n<td>æ”¯æŒ</td>\n<td>æ”¯æŒ</td>\n</tr>\n<tr>\n<td>é™æµ</td>\n<td>åŸºäº QPSï¼Œæ”¯æŒåŸºäºè°ƒç”¨å…³ç³»çš„é™æµ</td>\n<td>æœ‰é™çš„æ”¯æŒ</td>\n</tr>\n<tr>\n<td>æµé‡æ•´å½¢</td>\n<td>æ”¯æŒæ…¢å¯åŠ¨ï¼ŒåŒ€é€Ÿæ’é˜Ÿæ¨¡å¼</td>\n<td>ä¸æ”¯æŒ</td>\n</tr>\n<tr>\n<td>ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤</td>\n<td>æ”¯æŒ</td>\n<td>ä¸æ”¯æŒ</td>\n</tr>\n<tr>\n<td>æ§åˆ¶å°</td>\n<td>å¼€ç®±å³ç”¨ï¼Œå¯é…ç½®è§„åˆ™ï¼ŒæŸ¥çœ‹ç§’çº§ç›‘æ§ï¼Œæœºå™¨å‘ç°ç­‰</td>\n<td>ä¸å®Œå–„</td>\n</tr>\n<tr>\n<td>å¸¸è§æ¡†æ¶çš„é€‚é…</td>\n<td>Servletï¼ŒSpring Cloudï¼ŒDubboï¼ŒgRPC ç­‰</td>\n<td>Servletï¼ŒSpring Cloud Netflix</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"12-è®¤è¯†sentinel\"><a class=\"anchor\" href=\"#12-è®¤è¯†sentinel\">#</a> 1.2ã€è®¤è¯† SentinelğŸŒ³</h2>\n<p>Sentinel æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€æ¬¾å¾®æœåŠ¡æµé‡æ§åˆ¶ç»„ä»¶ã€‚å®˜ç½‘åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZW50aW5lbGd1YXJkLmlvL3poLWNuLw==\">https://sentinelguard.io/zh-cn/</span></p>\n<p><strong>Sentinel å…·æœ‰ä»¥ä¸‹ç‰¹å¾</strong>ï¼š</p>\n<p>1ã€<mark>ä¸°å¯Œçš„åº”ç”¨åœºæ™¯</mark>ï¼šSentinel æ‰¿æ¥äº†é˜¿é‡Œå·´å·´è¿› 10 å¹´çš„åŒåä¸€å¤§ä¿ƒæµé‡çš„æ ¸å¿ƒåœºæ™¯ï¼Œä¾‹å¦‚ç§’æ€ (å³çªå‘æµé‡æ§åˆ¶åœ¨ç³»ç»Ÿå®¹é‡å¯ä»¥æ‰¿å—çš„èŒƒå›´)ï¼Œæ¶ˆæ¯å‰Šå³°æ·»è°·ï¼Œé›†ç¾¤æµé‡æ§åˆ¶ï¼Œå®æ—¶ç†”æ–­ä¸‹æ¸¸ä¸å¯ç”¨åº”ç”¨ç­‰ã€‚</p>\n<p>2ã€<mark>å®Œå¤‡çš„å®æ—¶ç›‘æ§</mark>ï¼šSentinel åŒæ—¶æä¾›å®æ—¶çš„ç›‘æ§åŠŸèƒ½ã€‚æ‚¨å¯ä»¥åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°æ¥å…¥åº”ç”¨çš„å•å°é›†ç¾¤ç§’çº§æ•°æ®ï¼Œç”šè‡³ 500 å°ä»¥ä¸‹è§„æ¨¡çš„é›†ç¾¤çš„æ±‡æ€»è¿è¡Œæƒ…å†µ</p>\n<p>3ã€<mark>å¹¿æ³›çš„å¼€æºç”Ÿæ€</mark>ï¼šSentinel æä¾›å¼€ç®±å³ç”¨çš„ä¸å…¶å®ƒå¼€æºæ¡†æ¶ / åº“çš„æ•´åˆæ¨¡å—ï¼Œä¾‹å¦‚ä¸ Spring cloudï¼ŒDubboï¼ŒgRPC çš„æ•´åˆã€‚æ‚¨åªéœ€è¦å¼•å…¥ç›¸åº”çš„ä¾èµ–å¹¶è¿è¡Œç®€å•çš„é…ç½®å³å¯å¿«é€Ÿçš„æ¥å…¥ Sentinel</p>\n<p>4ã€<mark>å®Œå–„çš„ SPI æ‰©å±•ç‚¹</mark>ï¼šSentinel æä¾›ç®€å•æ˜“ç”¨ï¼Œå®Œå–„çš„ SPI æ‰©å±•æ¥å£ã€‚æ‚¨å¯ä»¥é€šè¿‡å®ç°æ‰©å±•æ¥å£æ¥å¿«é€Ÿçš„å®šåˆ¶é€»è¾‘ã€‚ä¾‹å¦‚å®šåˆ¶è§„åˆ™ç®¡ç†ï¼Œé€‚é…åŠ¨æ€æ•°æ®æºç­‰ã€‚</p>\n<h3 id=\"121-å®‰è£…sentinelæ§åˆ¶å°\"><a class=\"anchor\" href=\"#121-å®‰è£…sentinelæ§åˆ¶å°\">#</a> 1.2.1ã€å®‰è£… Sentinel æ§åˆ¶å°ğŸŒ²</h3>\n<p>sentinel å®˜æ–¹æä¾›äº† UI æ§åˆ¶å°ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹ç³»ç»Ÿåšé™æµè®¾ç½®ã€‚å¤§å®¶å¯ä»¥åœ¨<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvU2VudGluZWw=\"> Github</span> ä¸‹è½½ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161747500.png\" alt=\"image-20231016174714403\" /></p>\n<p>1ã€å°†å…¶æ‹·è´åˆ°ä¸€ä¸ªéä¸­æ–‡ç›®å½•ï¼Œç„¶åè¿è¡Œå‘½ä»¤</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">java</span> <span class=\"token parameter variable\">-jar</span> sentinel-dashboard-1.8.6.jar</pre></td></tr></table></figure><p>2ã€ç„¶åè®¿é—®ï¼šlocalhost:8080 å³å¯çœ‹åˆ°æ§åˆ¶å°é¡µé¢ï¼Œé»˜è®¤çš„è´¦å·å’Œå¯†ç éƒ½æ˜¯ sentinel</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161747766.png\" alt=\"image-20231016174746831\" /></p>\n<h2 id=\"13-å®‰è£…sentinelæ§åˆ¶å°\"><a class=\"anchor\" href=\"#13-å®‰è£…sentinelæ§åˆ¶å°\">#</a> 1.3ã€å®‰è£… Sentinel æ§åˆ¶å°ğŸŒ³</h2>\n<p>å¦‚æœè¦ä¿®æ”¹ Sentinel çš„é»˜è®¤ç«¯å£ï¼Œè´¦å·ï¼Œå¯†ç ï¼Œå¯ä»¥é€šè¿‡ä¸‹åˆ—é…ç½®ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>é…ç½®é¡¹</th>\n<th>é»˜è®¤å€¼</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>server.port</td>\n<td>8080</td>\n<td>æœåŠ¡ç«¯å£</td>\n</tr>\n<tr>\n<td>sentinel.dashboard.auth.username</td>\n<td>sentinel</td>\n<td>é»˜è®¤ç”¨æˆ·å</td>\n</tr>\n<tr>\n<td>sentinel.dashboard.auth.password</td>\n<td>sentinel</td>\n<td>é»˜è®¤å¯†ç </td>\n</tr>\n</tbody>\n</table>\n<p>ä½†æ˜¯å®ƒå·²ç»æ˜¯ä¸€ä¸ª jar åŒ…äº†æ€ä¹ˆæ”¹å®ƒçš„é…ç½®æ–‡ä»¶å‘¢ï¼Ÿ</p>\n<p>ä¿®æ”¹é…ç½®æ–¹å¼ï¼š</p>\n<blockquote>\n<p>ä¸¾ä¾‹è¯´æ˜ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>sentinel-dashboard-1.8.6.jar <span class=\"token parameter variable\">-Dserver.port</span><span class=\"token operator\">=</span><span class=\"token number\">8090</span></pre></td></tr></table></figure></blockquote>\n<h2 id=\"14-å¾®æœåŠ¡ä¸sentinelæ•´åˆ\"><a class=\"anchor\" href=\"#14-å¾®æœåŠ¡ä¸sentinelæ•´åˆ\">#</a> 1.4ã€å¾®æœåŠ¡ä¸ Sentinel æ•´åˆğŸŒ³</h2>\n<h3 id=\"141-å¼•å…¥cloud-demo\"><a class=\"anchor\" href=\"#141-å¼•å…¥cloud-demo\">#</a> 1.4.1ã€å¼•å…¥ cloud-demoğŸŒ²</h3>\n<p>è¦ä½¿ç”¨ Sentinel è‚¯å®šè¦ç»“åˆå¾®æœåŠ¡ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ SpringCloud å·¥ç¨‹ï¼Œé¡¹ç›®åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZG91a2FpeGluL3R5cG9yYS5naXQ=\">https://gitee.com/doukaixin/typora.git</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161754232.png\" alt=\"image-20231016175423216\" /></p>\n<p>é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161755797.png\" alt=\"image-20231016175537988\" /></p>\n<p>å¯åŠ¨é¡¹ç›®è¿›è¡Œæµ‹è¯•çœ‹çœ‹æ˜¯å¦è¿˜å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161939226.png\" alt=\"image-20231016193950393\" /></p>\n<p>è®¿é—®é¡µé¢</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161939102.png\" alt=\"image-20231016193935669\" /></p>\n<p>ä¸€åˆ‡æ­£å¸¸åæˆ‘ä»¬å°±å¼€å§‹æ•´åˆ</p>\n<h3 id=\"142-å¾®æœåŠ¡æ•´åˆsentinel\"><a class=\"anchor\" href=\"#142-å¾®æœåŠ¡æ•´åˆsentinel\">#</a> 1.4.2ã€å¾®æœåŠ¡æ•´åˆ SentinelğŸŒ²</h3>\n<p>æˆ‘ä»¬åœ¨ order-service ä¸­æ•´åˆ Sentinelï¼Œå¹¶ä¸”é“¾æ¥ Sentinel çš„æ§åˆ¶å°ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<p>1ã€å¼•å…¥ Sentinel ä¾èµ–ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-alibaba-sentinel<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>2ã€é…ç½®æ§åˆ¶å°åœ°å€</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">sentinel</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">transport</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token key atrule\">dashboard</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8080</span></pre></td></tr></table></figure><p>3ã€è®¿é—®å¾®æœåŠ¡çš„ä»»æ„ç«¯ç‚¹ï¼Œè§¦å‘ Sentinel ç›‘æ§</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161955434.png\" alt=\"image-20231016195535390\" /></p>\n<h2 id=\"15-é™æµè§„åˆ™\"><a class=\"anchor\" href=\"#15-é™æµè§„åˆ™\">#</a> 1.5ã€é™æµè§„åˆ™ğŸŒ³</h2>\n<ul>\n<li>å¿«é€Ÿå…¥é—¨</li>\n<li>æµæ§æ¨¡å¼</li>\n<li>æµæ§æ•ˆæœ</li>\n<li>çƒ­ç‚¹å‚æ•°é™æµ</li>\n</ul>\n<h3 id=\"151-è”Ÿç‚¹é“¾è·¯\"><a class=\"anchor\" href=\"#151-è”Ÿç‚¹é“¾è·¯\">#</a> 1.5.1ã€è”Ÿç‚¹é“¾è·¯ğŸŒ²</h3>\n<p>è”Ÿç‚¹é“¾è·¯ï¼šå°±æ˜¯é¡¹ç›®å†…çš„è°ƒç”¨é“¾è·¯ï¼Œé“¾è·¯ä¸­<mark>è¢«ç›‘æ§</mark>çš„æ¯ä¸ªæ¥å£å°±æ˜¯ä¸€ä¸ªèµ„æºã€‚é»˜è®¤æƒ…å†µä¸‹ Sentinel ä¼šç›‘æ§ SpringMVC çš„æ¯ä¸€ä¸ªç«¯ç‚¹ (Endpoint)ï¼Œå› æ­¤ SpringMVC çš„æ¯ä¸€ä¸ªç«¯ç‚¹ (Endpoint)ï¼Œå°±æ˜¯è°ƒç”¨é“¾è·¯ä¸­çš„ä¸€ä¸ªèµ„æºã€‚</p>\n<p>æµæ§ï¼Œç†”æ–­ç­‰éƒ½æ˜¯<mark>é’ˆå¯¹è”Ÿç‚¹é“¾è·¯ä¸­çš„èµ„æº</mark>æ¥è®¾ç½®çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç‚¹å‡»å¯¹åº”èµ„æºåé¢çš„æŒ‰é’®æ¥è®¾ç½®è§„åˆ™ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162003730.png\" alt=\"image-20231016200306361\" /></p>\n<p>ç‚¹å‡»èµ„æº /order/{orderId} åé¢çš„æµæ§æŒ‰é’®ï¼Œå°±å¯ä»¥å¼¹å‡ºè¡¨å•ã€‚è¡¨å•ä¸­å¯ä»¥æ·»åŠ æµæ§è§„åˆ™ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162009637.png\" alt=\"image-20231016200951539\" /></p>\n<p>å…¶å«ä¹‰æ˜¯é™åˆ¶ /order/{orderId} è¿™ä¸ªèµ„æºçš„å•å‡» QPS ä¸º 1ï¼Œå³æ¯ç§’åªå…è®¸ 1 æ¬¡è¯·æ±‚ï¼Œè¶…å‡ºçš„è¯·æ±‚ä¼šè¢«æ‹¦æˆªå¹¶æŠ¥é”™ã€‚</p>\n<p>é’ˆå¯¹æ¥æºä¸­ defalt è¡¨ç¤ºä¸€åˆ‡è¯·æ±‚éƒ½é™æµ</p>\n<h4 id=\"1511-æ¡ˆä¾‹æµæ§è§„åˆ™å…¥é—¨æ¡ˆä¾‹\"><a class=\"anchor\" href=\"#1511-æ¡ˆä¾‹æµæ§è§„åˆ™å…¥é—¨æ¡ˆä¾‹\">#</a> 1.5.1.1ã€æ¡ˆä¾‹ï¼Œæµæ§è§„åˆ™å…¥é—¨æ¡ˆä¾‹ğŸŒ´</h4>\n<p><strong>éœ€æ±‚</strong>ï¼šç»™ /order/{orderId} è¿™ä¸ªèµ„æºè®¾ç½®æµæ§è§„åˆ™ï¼ŒQPS ä¸èƒ½è¶…è¿‡ 5ã€‚ç„¶ååˆ©ç”¨ jmeter æµ‹è¯•ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162014028.png\" alt=\"image-20231016201450102\" /></p>\n<p>è¿™é‡Œä½¿ç”¨ jemeter è¿›è¡Œå¹¶å‘çš„æµ‹è¯•å·¥å…·å®‰è£…æ–‡ç« ï¼š<a href=\"../Jmeter/Jmeter%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.md\">jmeter å®‰è£…åŠä½¿ç”¨</a>.</p>\n<p>æµ‹è¯•æ–‡ä»¶æ–‡ç« åœ°å€ï¼š<a href=\"../%E6%B5%8B%E8%AF%95%E6%96%87%E4%BB%B6/sentinel%E6%B5%8B%E8%AF%95.jmx\">sentinel æµ‹è¯•.jmx</a>.</p>\n<p>å¯¼å…¥åˆ° jmeter ä¸­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162035976.png\" alt=\"image-20231016203528848\" /></p>\n<p>å¦‚æœç‚¹å‡»æ²¡æœ‰ååº”å°±ç›´æ¥å°† jmx æ–‡ä»¶æ‹–åˆ°è“ç“¶å­é‡Œé¢å°±ç®—å¯¼å…¥äº†</p>\n<p>å³é”®ï¼Œæµæ§å…¥é—¨ï¼Œç‚¹å‡»å¯åŠ¨ï¼Œä¹‹åå¯ä»¥ç‚¹å‡»æŸ¥çœ‹ç»“æœæ ‘æ¥æŸ¥çœ‹è¯·æ±‚çš„æƒ…å†µ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162036099.png\" alt=\"image-20231016203617798\" /></p>\n<p>è¿™æ˜¯è®¾ç½® QPS åçš„è¯·æ±‚æƒ…å†µï¼Œæ²¡æœ‰é™æµçš„æ—¶å€™å…¨æ˜¯é€šè¿‡çš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162037652.png\" alt=\"image-20231016203706692\" /></p>\n<p>æŸ¥çœ‹æ§åˆ¶å°çš„æƒ…å†µ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162032402.png\" alt=\"image-20231016203257242\" /></p>\n<h3 id=\"152-æµæ§æ¨¡å¼\"><a class=\"anchor\" href=\"#152-æµæ§æ¨¡å¼\">#</a> 1.5.2ã€æµæ§æ¨¡å¼ğŸŒ²</h3>\n<p>åœ¨æ·»åŠ é™æµè§„åˆ™æ—¶ï¼Œç‚¹å‡»é«˜çº§é€‰é¡¹ï¼Œå¯ä»¥é€‰æ‹©ä¸‰ç§æµæ§æ¨¡å¼ï¼š</p>\n<ul>\n<li>\n<p>ç›´æ¥ï¼šç»Ÿè®¡å½“å‰èµ„æºçš„è¯·æ±‚ï¼Œè§¦å‘é˜ˆå€¼æ—¶å¯¹å½“å‰èµ„æºç›´æ¥é™æµï¼Œä¹Ÿæ˜¯é»˜è®¤çš„æ¨¡å¼</p>\n</li>\n<li>\n<p>å…³è”ï¼šç»Ÿè®¡ä¸å½“å‰èµ„æºç›¸å…³çš„å¦ä¸€ä¸ªèµ„æºï¼Œè§¦å‘é˜ˆå€¼æ—¶ï¼Œå¯¹å½“å‰èµ„æºé™æµ</p>\n<p>ä¸¤ä¸ªèµ„æºï¼ŒA è§¦å‘äº†é˜ˆå€¼ï¼Œä½†æˆ‘å´å¯¹ B åšäº†é™æµ</p>\n</li>\n<li>\n<p>é“¾è·¯ï¼šç»Ÿè®¡ä»æŒ‡å®šé“¾è·¯è®¿é—®åˆ°æœ¬èµ„æºçš„è¯·æ±‚ï¼Œè§¦å‘é˜ˆå€¼æ—¶ï¼Œå¯¹æŒ‡å®šé“¾è·¯é™æµ</p>\n</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162041214.png\" alt=\"image-20231016204109075\" /></p>\n<h4 id=\"1521-æµæ§æ¨¡å¼-å…³è”\"><a class=\"anchor\" href=\"#1521-æµæ§æ¨¡å¼-å…³è”\">#</a> 1.5.2.1ã€æµæ§æ¨¡å¼ - å…³è”ğŸŒ´</h4>\n<ul>\n<li>å…³è”æ¨¡å¼ï¼šç»Ÿè®¡ä¸å½“å‰èµ„æºç›¸å…³çš„å¦ä¸€ä¸ªèµ„æºï¼Œè§¦å‘é˜ˆå€¼æ—¶ï¼Œå¯¹å½“å‰èµ„æºé™æµ</li>\n<li>ä½¿ç”¨åœºæ™¯ï¼šæ¯”å¦‚ç”¨æˆ·æ”¯ä»˜æ—¶éœ€è¦ä¿®æ”¹è®¢å•çŠ¶æ€ï¼ŒåŒæ—¶ç”¨æˆ·è¦æŸ¥è¯¢è®¢å•ã€‚æŸ¥è¯¢å’Œä¿®æ”¹æ“ä½œä¼šäº‰æŠ¢æ•°æ®åº“é”ï¼Œäº§ç”Ÿç«äº‰ã€‚ä¸šåŠ¡éœ€æ±‚æ˜¯æœ‰é™æ”¯ä»˜å’Œæ›´æ–°è®¢å•çš„ä¸šåŠ¡ï¼Œå› æ­¤å½“ä¿®æ”¹è®¢å•ä¸šåŠ¡è§¦å‘é˜ˆå€¼æ—¶ï¼Œéœ€è¦å¯¹æŸ¥è¯¢è®¢å•ä¸šåŠ¡é™æµã€‚</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162047957.png\" alt=\"image-20231016204748747\" /></p>\n<p>å½“ /write èµ„æºè®¿é—®é‡è§¦å‘é˜ˆå€¼æ—¶ï¼Œå°±ä¼šå¯¹ /read èµ„æºé™æµï¼Œé¿å…å½±å“ /write èµ„æºã€‚</p>\n<h5 id=\"15211-æ¡ˆä¾‹æµæ§æ¨¡å¼-å…³è”\"><a class=\"anchor\" href=\"#15211-æ¡ˆä¾‹æµæ§æ¨¡å¼-å…³è”\">#</a> 1.5.2.1.1ã€æ¡ˆä¾‹ï¼Œæµæ§æ¨¡å¼ - å…³è”ğŸ‹</h5>\n<p>éœ€æ±‚ï¼š</p>\n<ul>\n<li>åœ¨ OrderController æ–°å»ºä¸¤ä¸ªç«¯ç‚¹ï¼š/order/query å’Œ /order/updateï¼Œæ— éœ€å®ç°ä¸šåŠ¡</li>\n<li>é…ç½®æµæ§è§„åˆ™ï¼Œå½“ /order/update èµ„æºè¢«è®¿é—®çš„ QPS è¶…è¿‡ 5 ä¸ªæ—¶ï¼Œå¯¹ /order/query è¯·æ±‚é™æµ</li>\n</ul>\n<p>é‡å¯æœåŠ¡åè”Ÿç‚¹é“¾è·¯é‡Œé¢å°±ä¼šè¢«æ¸…ç©ºäº†ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°å»è¯·æ±‚ä¸€ä¸‹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162054136.png\" alt=\"image-20231016205436554\" /></p>\n<p>åˆ†åˆ«è¯·æ±‚ä¸€ä¸‹ query å’Œ update çš„æ¥å£</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162055490.png\" alt=\"image-20231016205532378\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162055118.png\" alt=\"image-20231016205543133\" /></p>\n<p>å†å»æŸ¥çœ‹è”Ÿç‚¹é“¾è·¯å°±å¯ä»¥çœ‹åˆ°æœ‰ä¿¡æ¯äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162056790.png\" alt=\"image-20231016205631141\" /></p>\n<p>é…ç½®æµæ§è§„åˆ™ï¼Œå½“ /order/update èµ„æºè¢«è®¿é—®çš„ QPS è¶…è¿‡ 5 ä¸ªæ—¶ï¼Œå¯¹ /order/query è¯·æ±‚é™æµã€‚</p>\n<p>æˆ‘ä»¬è¦å¯¹è°è¿›è¡Œé™æµå°±å¯¹è°è¿›è¡Œæµæ§è§„åˆ™</p>\n<p>ç‚¹å‡» query çš„æµæ§</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162058104.png\" alt=\"image-20231016205856014\" /></p>\n<p>é€šè¿‡ jmeter è¿›è¡Œæµ‹è¯•ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162101233.png\" alt=\"image-20231016210113073\" /></p>\n<p>è¯·æ±‚çš„åœ°å€å°±æ˜¯ /order/update</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162101101.png\" alt=\"image-20231016210145527\" /></p>\n<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªè¯·æ±‚ä¸ä¼šå—åˆ°ä»»ä½•å½±å“</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162102511.png\" alt=\"image-20231016210228553\" /></p>\n<p>ä½†ï¼Œå½“è®¿é—® /order/query æ—¶</p>\n<p>å°±å‘ç”Ÿäº†å¼‚å¸¸ï¼Œupdate è§¦å‘é˜ˆå€¼æ—¶å¯¹ query é™æµå°±å®ç°äº†è¿™æ ·ä¸€ç§å…³è”æ¨¡å¼äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162103557.png\" alt=\"image-20231016210318424\" /></p>\n<blockquote>\n<p><strong>å°ç»“</strong>ï¼š</p>\n<p>æ»¡è¶³ä¸‹é¢æ¡ä»¶å¯ä»¥ä½¿ç”¨å…³è”æ¨¡å¼ï¼š</p>\n<ul>\n<li>ä¸¤ä¸ªæœ‰ç«äº‰å…³ç³»çš„èµ„æº</li>\n<li>ä¸€ä¸ªä¼˜å…ˆçº§è¾ƒé«˜ï¼Œä¸€ä¸ªä¼˜å…ˆçº§è¾ƒä½</li>\n</ul>\n</blockquote>\n<h4 id=\"1523-æµæ§æ¨¡å¼-é“¾è·¯\"><a class=\"anchor\" href=\"#1523-æµæ§æ¨¡å¼-é“¾è·¯\">#</a> 1.5.2.3ã€æµæ§æ¨¡å¼ - é“¾è·¯ğŸŒ´</h4>\n<p>é“¾è·¯æ¨¡å¼ï¼šåªé’ˆå¯¹ä»æŒ‡å®šé“¾è·¯è®¿é—®åˆ°æœ¬èµ„æºçš„è¯·æ±‚åšç»Ÿè®¡ï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜ˆå€¼ã€‚</p>\n<p>ä¾‹å¦‚ï¼šæœ‰ä¸¤æ¡è¯·æ±‚é“¾è·¯ä¸€ä¸ªæ˜¯ä» test1 è®¿é—® common èµ„æºå¦ä¸€ä¸ªæ˜¯ä» test2 è®¿é—® common èµ„æºï¼š</p>\n<ul>\n<li>/test1 -&gt; /common</li>\n<li>/test2 -&gt; /common</li>\n</ul>\n<p>å¦‚æœå¸Œæœ›ç»Ÿè®¡ä» /test2 è¿›å…¥åˆ° /common çš„è¯·æ±‚ï¼Œåˆ™å¯ä»¥è¿™æ ·é…ç½®ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162107107.png\" alt=\"image-20231016210716025\" /></p>\n<p>è¿™ä¸ªé…ç½®çš„æ„æ€ï¼š</p>\n<p>åœ¨åšé™æµç»Ÿè®¡æ—¶ï¼Œåªç»Ÿè®¡ä» test2 è¿›å…¥ common çš„è¯·æ±‚ï¼Œtest1 è¿›æ¥çš„ä¸ç®¡ã€‚æ‰€ä»¥è¿™ç§ç»Ÿè®¡æ˜¯å¯¹è¯·æ±‚æ¥æºçš„ä¸€ç§ç»Ÿè®¡</p>\n<p>ä»€ä¹ˆæƒ…å†µä¸‹æˆ‘ä»¬ä¼šç”¨åˆ°è¿™æ ·çš„æ¨¡å¼å‘¢ï¼Ÿé€šè¿‡å¦‚ä¸‹æ¡ˆä¾‹äº†è§£</p>\n<h5 id=\"15231-æ¡ˆä¾‹æµæ§æ¨¡å¼-é“¾è·¯\"><a class=\"anchor\" href=\"#15231-æ¡ˆä¾‹æµæ§æ¨¡å¼-é“¾è·¯\">#</a> 1.5.2.3.1ã€æ¡ˆä¾‹ï¼Œæµæ§æ¨¡å¼ - é“¾è·¯ğŸ‹</h5>\n<p>éœ€æ±‚ï¼šæœ‰æŸ¥è¯¢è®¢å•å’Œåˆ›å»ºè®¢å•ä¸šåŠ¡ï¼Œä¸¤è€…éœ€è¦æŸ¥è¯¢å•†å“ã€‚é’ˆå¯¹ä»æŸ¥è¯¢è®¢å•è¿›å…¥åˆ°æŸ¥è¯¢å•†å“çš„è¯·æ±‚ç»Ÿè®¡ï¼Œå¹¶è®¾ç½®é™æµã€‚</p>\n<p>æ­¥éª¤ï¼š</p>\n<p>1ã€åœ¨ OrderService ä¸­æ·»åŠ ä¸€ä¸ª queryGoods æ–¹æ³•ï¼Œä¸ç”¨å®ç°ä¸šåŠ¡</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@SentinelResource</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"goods\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">queryGoods</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æŸ¥è¯¢å•†å“\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>2ã€åœ¨ OrderController ä¸­ï¼Œæ”¹é€  /order/query ç«¯ç‚¹ï¼Œè°ƒç”¨ OrderService ä¸­çš„ queryGoods æ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"query\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">queryOrder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// æŸ¥è¯¢å•†å“</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   orderService<span class=\"token punctuation\">.</span><span class=\"token function\">queryGoods</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// æŸ¥è¯¢è®¢å•</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æŸ¥è¯¢è®¢å•\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token string\">\"æŸ¥è¯¢è®¢å•æˆåŠŸ\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>3ã€åœ¨ OrderController ä¸­æ·»åŠ ä¸€ä¸ª /order/save çš„ç«¯ç‚¹ï¼Œè°ƒç”¨ OrderService çš„ queryGoods æ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"save\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">saveOrder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   orderService<span class=\"token punctuation\">.</span><span class=\"token function\">queryGoods</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ–°å¢è®¢å•\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token string\">\"æ–°å¢è®¢å•æˆåŠŸ\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>4ã€ç»™ queryGoods è®¾ç½®é™æµè§„åˆ™ï¼Œä» /order/query è¿›å…¥ queryGoods çš„æ–¹æ³•é™åˆ¶ QPS å¿…é¡»å°äº 2</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170741307.png\" alt=\"image-20231017074152072\" /></p>\n<ul>\n<li>\n<p>Sentinel é»˜è®¤åªæ ‡è®° Controller ä¸­çš„æ–¹æ³•ä¸ºèµ„æºï¼Œå¦‚æœè¦æ ‡è®°å…¶å®ƒæ–¹æ³•ï¼Œéœ€è¦åˆ©ç”¨ @SentinelResource æ³¨è§£ï¼Œç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SentinelResource</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"goods\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">queryGoods</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æŸ¥è¯¢å•†å“\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>Sentinel é»˜è®¤ä¼šå°† Controller æ–¹æ³•åš context æ•´åˆï¼Œå¯¼è‡´é“¾è·¯æ¨¡å¼çš„æµæ§å¤±è´¥ï¼Œéœ€è¦ä¿®æ”¹ application.ymlï¼Œæ·»åŠ é…ç½®ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">sentinel</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">transport</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token key atrule\">dashboard</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8080</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">web-context-unify</span><span class=\"token punctuation\">:</span> false // å…³é—­contextæ•´åˆ</pre></td></tr></table></figure></li>\n</ul>\n<p>è®¿é—® order/query å’Œ order/save</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162148402.png\" alt=\"image-20231016214825324\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162148432.png\" alt=\"image-20231016214834464\" /></p>\n<p>æŸ¥çœ‹ sentinel çš„è”Ÿç‚¹é“¾è·¯ä¿¡æ¯</p>\n<p>å¯ä»¥çœ‹åˆ° /order/query ä¸ /order/save å˜æˆäº†ä¸¤ä¸ªç‹¬ç«‹çš„é“¾è·¯äº†ï¼Œåœ¨ä¹‹å‰æ²¡æœ‰å…³é—­ context æ•´åˆæ—¶å®ƒä¿©æ˜¯åŒä¸€ä¸ªè·Ÿé“¾è·¯ä¸‹çš„å­é“¾è·¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310162149544.png\" alt=\"image-20231016214905203\" /></p>\n<p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å¯¹ goods æ·»åŠ æµæ§è§„åˆ™äº†ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„ç¬¬ 4 æ­¥</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170741307.png\" alt=\"\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170755887.png\" alt=\"image-20231017075526647\" /></p>\n<p>ä½¿ç”¨ jmeter è¿›è¡Œæµ‹è¯•</p>\n<p>å‘èµ· 200 ä¸ªè¯·æ±‚æ¯ç§’å‘èµ· 4 ä¸ª ï¼Œè€Œä¸”åŒæ—¶å‘èµ·ä¸¤ä¸ªè¯·æ±‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170802306.png\" alt=\"image-20231017080217215\" /></p>\n<p>å¯ä»¥çœ‹åˆ°è¯·æ±‚ save æ²¡é—®é¢˜</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170806261.png\" alt=\"image-20231017080631501\" /></p>\n<p>å¯ä»¥çœ‹åˆ°è¯·æ±‚ query æ—¶æ˜¯ä¸¤ä¸ªä¸¤ä¸ªçš„ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170806763.png\" alt=\"image-20231017080641204\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>æµæ§æ¨¡å¼æœ‰å“ªäº›ï¼Ÿ</p>\n<ul>\n<li>ç›´æ¥ï¼šå¯¹å½“å‰èµ„æºé™æµ</li>\n<li>å…³è”ï¼šé«˜ä¼˜å…ˆçº§èµ„æºè§¦å‘é˜ˆå€¼ï¼Œå¯¹ä½ä¼˜å…ˆçº§èµ„æºé™æµ</li>\n<li>é“¾è·¯ï¼šé˜ˆå€¼ç»Ÿè®¡æ—¶ï¼Œåªç»Ÿè®¡ä»æŒ‡å®šèµ„æºè¿›å…¥å½“å‰èµ„æºçš„è¯·æ±‚ï¼Œæ˜¯å¯¹è¯·æ±‚æ¥æºçš„é™æµ</li>\n</ul>\n</blockquote>\n<h4 id=\"1524-æµæ§æ•ˆæœ\"><a class=\"anchor\" href=\"#1524-æµæ§æ•ˆæœ\">#</a> 1.5.2.4ã€æµæ§æ•ˆæœğŸŒ²</h4>\n<p>æµæ§æ•ˆæœæ˜¯æŒ‡è¯·æ±‚è¾¾åˆ°æµæ§é˜ˆå€¼æ—¶åº”è¯¥é‡‡å–çš„æªæ–½ï¼ŒåŒ…æ‹¬ä¸‰ç§ï¼š</p>\n<ul>\n<li>å¿«é€Ÿå¤±è´¥ï¼šè¾¾åˆ°é˜ˆå€¼åï¼Œæ–°çš„è¯·æ±‚ä¼šè¢«ç«‹å³æ‹’ç»å¹¶æŠ›å‡º FlowException å¼‚å¸¸ã€‚æ˜¯é»˜è®¤çš„å¤„ç†æ–¹å¼ã€‚</li>\n<li>warm upï¼šé¢„çƒ­æ¨¡å¼ï¼Œå¯¹è¶…å‡ºé˜ˆå€¼çš„è¯·æ±‚åŒæ ·æ˜¯æ‹’ç»å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚ä½†è¿™ç§æ¨¡å¼é˜ˆå€¼ä¼šåŠ¨æ€å˜åŒ–ï¼Œä»ä¸€ä¸ªè¾ƒå°å€¼é€æ¸å¢åŠ åˆ°æœ€å¤§é˜ˆå€¼</li>\n<li>æ’é˜Ÿç­‰å¾…ï¼šè®©æ‰€æœ‰çš„è¯·æ±‚æŒ‰ç…§å…ˆåæ¬¡åºæ’é˜Ÿæ‰§è¡Œï¼Œä¸¤ä¸ªè¯·æ±‚çš„å‰ªä¸ªä¸èƒ½å°äºæŒ‡å®šæ—¶é•¿</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170813160.png\" alt=\"image-20231017081328807\" /></p>\n<h5 id=\"15241-æµæ§æ•ˆæœ-warm-up\"><a class=\"anchor\" href=\"#15241-æµæ§æ•ˆæœ-warm-up\">#</a> 1.5.2.4.1ã€æµæ§æ•ˆæœ - warm upğŸŒ´</h5>\n<p>warm up ä¹Ÿå«é¢„çƒ­æ¨¡å¼ï¼Œæ˜¯åº”å¯¹æœåŠ¡å†·å¯åŠ¨çš„ä¸€ç§æ–¹æ¡ˆã€‚è¯·æ±‚é˜ˆå€¼åˆå§‹å€¼æ˜¯ threshold é™¤ä»¥ coldFactorï¼ŒæŒç»­æŒ‡å®šæ—¶é•¿åï¼Œé€æ¸æé«˜åˆ° threshold å€¼ã€‚è€Œ clodFactor çš„é»˜è®¤å€¼æ˜¯ 3.</p>\n<p>ä¾‹å¦‚ï¼Œæˆ‘è®¾ç½® QPS çš„ threshold ä¸º 10ï¼Œé¢„çƒ­æ—¶é—´ä¸º 5 ç§’ï¼Œé‚£ä¹ˆåˆå§‹é˜ˆå€¼å°±æ˜¯ 10 / 3ï¼Œä¹Ÿå°±æ˜¯ 3ï¼Œç„¶ååœ¨ 5 ç§’åé€æ¸å¢é•¿åˆ° 10</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170818338.png\" alt=\"image-20231017081845114\" /></p>\n<h6 id=\"152411-æ¡ˆä¾‹æµæ§æ•ˆæœ-warm-up\"><a class=\"anchor\" href=\"#152411-æ¡ˆä¾‹æµæ§æ•ˆæœ-warm-up\">#</a> 1.5.2.4.1.1ã€æ¡ˆä¾‹ï¼Œæµæ§æ•ˆæœ - warm upğŸ‹</h6>\n<p>éœ€æ±‚ï¼šç»™ /order/{orderId} è¿™ä¸ªèµ„æºè®¾ç½®é™æµï¼Œæœ€å¤§ QPS ä¸º 10ï¼Œåˆ©ç”¨ warm up æ•ˆæœï¼Œé¢„çƒ­æ—¶é•¿ä¸º 5 ç§’</p>\n<p>è¯·æ±‚ä¸€ä¸‹é€šè¿‡ id æŸ¥è¯¢çš„ uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDg4L29yZGVyLzEwMQ==\">http://localhost:8088/order/101</span></p>\n<p>ç„¶åå›åˆ° Sentinel åˆ·æ–°é¡µé¢ï¼Œå°±å¯ä»¥çœ‹åˆ° orderId äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170823021.png\" alt=\"image-20231017082330841\" /></p>\n<p>ç»™ orderId æ·»åŠ ä¸€ä¸ªæµæ§è§„åˆ™</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170827278.png\" alt=\"image-20231017082705193\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170827270.png\" alt=\"image-20231017082714223\" /></p>\n<p>ä½¿ç”¨ jmeter è¿›è¡Œæµ‹è¯•ï¼š</p>\n<p>å¯ä»¥çœ‹åˆ°é€šè¿‡çš„ QPS è¶Šæ¥è¶Šå¤š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170829082.png\" alt=\"image-20231017082949095\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170830693.png\" alt=\"image-20231017083005138\" /></p>\n<h5 id=\"15242-æµæ§æ•ˆæœ-æ’é˜Ÿç­‰å¾…\"><a class=\"anchor\" href=\"#15242-æµæ§æ•ˆæœ-æ’é˜Ÿç­‰å¾…\">#</a> 1.5.2.4.2ã€æµæ§æ•ˆæœ - æ’é˜Ÿç­‰å¾…ğŸŒ´</h5>\n<p>å½“è¯·æ±‚è¶…è¿‡ QPS é˜ˆå€¼æ—¶ï¼Œå¿«é€Ÿå¤±è´¥å’Œ warm up ä¼šæ‹’ç»æ–°çš„è¯·æ±‚å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚è€Œæ’é˜Ÿç­‰å¾…åˆ™æ˜¯è®©æ‰€æœ‰è¯·æ±‚è¿›å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œç„¶åæŒ‰ç…§é˜ˆå€¼å…è®¸çš„æ—¶é—´é—´éš”ä¾æ¬¡æ‰§è¡Œã€‚åæ¥çš„è¯·æ±‚å¿…é¡»ç­‰å¾…å‰é¢æ‰§è¡Œå®Œæˆã€‚å¦‚æœè¯·æ±‚é¢„æœŸçš„ç­‰å¾…æ—¶é—´è¶…å‡ºæœ€å¤§æ—¶é•¿ï¼Œåˆ™ä¼šè¢«æ‹’ç»ã€‚</p>\n<p>ä¾‹å¦‚ï¼šQPS=5ï¼Œæ„å‘³ç€æ¯ 200ms å¤„ç†ä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„è¯·æ±‚ï¼›timeout=2000ï¼Œæ„å‘³ç€é¢„æœŸç­‰å¾…è¶…è¿‡ 2000ms çš„è¯·æ±‚ä¼šè¢«æ‹’ç»å¹¶æŠ›å‡ºå¼‚å¸¸</p>\n<p>æ¯”å¦‚ä¸‹é¢çš„æ—¶é—´çº¿ï¼Œæœ‰æ— æ•°ä¸ªè¯·æ±‚è¦è¿›å…¥é˜Ÿåˆ—æ‰§è¡Œï¼Œé‚£ç¬¬ä¸€ä¸ªè¿›å…¥é˜Ÿåˆ—çš„è¯·æ±‚å®ƒçš„ç­‰å¾…æ—¶é—´ä¸€å®šæ˜¯ 0msã€‚ä½†æ˜¯åŒä¸€æ—¶åˆ»åˆæ¥äº†ä¸€ä¸ªè¯·æ±‚é‚£ä¹ˆç¬¬äºŒä¸ªè¯·æ±‚å®ƒä¸€å®šè¦ç­‰å¾…è‡³å°‘ 200msï¼Œæ‰€ä»¥å®ƒçš„é¢„æœŸç­‰å¾…æ—¶é—´å°±æ˜¯ 2 ç§’ï¼Œåé¢çš„è¯·æ±‚ä»¥æ­¤ç±»æ¨ã€‚ç›´åˆ°ç­‰åˆ°æ—¶é—´æœ€å¤šä¸º 2000ms æ—¶ï¼Œå†æ¥ä¸€ä¸ªè¯·æ±‚å®ƒçš„ç­‰å¾…æ—¶é—´å°±æ˜¯è¶…å‡ºè¿™ 2000ms çš„æ—¶é—´äº†ï¼Œè€Œè¶…å‡ºçš„è¯·æ±‚å°±ä¼šè¢«æ‹’ç»</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170838123.png\" alt=\"image-20231017083846925\" /></p>\n<p>å¥½å¤„ï¼šå‡è®¾è¯´è¯·æ±‚ QPS æ˜¯æ³¢åŠ¨å‹çš„ï¼Œæ¯”å¦‚è¯´ç¬¬ä¸€ç§’é’Ÿä¸€ä¸ªè¯·æ±‚ä¹Ÿæ²¡æ¥ï¼Œè¿™æ—¶é˜Ÿåˆ—æ˜¯ç©ºçš„ã€‚ç»“æœç¬¬äºŒç§’ä¸€ä¸‹æ¥äº† 10 ä¸ªè¯·æ±‚ï¼Œæ”¾åˆ°é˜Ÿåˆ—é‡Œç„¶åæ¯ 200ms æ”¾è¡Œä¸€ä¸ªæ¢ç®—æˆ QPS å°±æ˜¯ 5ï¼Œæ‰€ä»¥ä¸ç®¡è¿›å…¥çš„ QPS æ˜¯æ€æ ·æ³¢åŠ¨çš„å‡ºå»çš„ QPS ä¸€å®šæ˜¯ç¨³å®šçš„æŒ‰ç…§ 200ms ä¸€ä¸ªçš„é€Ÿåº¦å»æ”¾ã€‚æ‰€ä»¥å°±èµ·åˆ°äº†æµé‡æ•´å½¢çš„ä½œç”¨</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170854889.png\" alt=\"image-20231017085359679\" /></p>\n<h6 id=\"152421-æ¡ˆä¾‹æµæ§æ•ˆæœ-æ’é˜Ÿç­‰å¾…\"><a class=\"anchor\" href=\"#152421-æ¡ˆä¾‹æµæ§æ•ˆæœ-æ’é˜Ÿç­‰å¾…\">#</a> 1.5.2.4.2.1ã€æ¡ˆä¾‹ï¼Œæµæ§æ•ˆæœ - æ’é˜Ÿç­‰å¾…ğŸ‹</h6>\n<p>éœ€æ±‚ï¼šç»™ /order/{orderId} è¿™ä¸ªèµ„æºè®¾ç½®é™æµï¼Œæœ€å¤§ QPS ä¸º 10ï¼Œåˆ©ç”¨æ’é˜Ÿçš„æµæ§æ•ˆæœï¼Œè¶…æ—¶æ—¶é•¿è®¾ç½®ä¸º 5ss</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170859614.png\" alt=\"image-20231017085932633\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170901195.png\" alt=\"image-20231017090152352\" /></p>\n<p>ä½¿ç”¨ jmeter è¿›è¡Œæµ‹è¯•ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170908478.png\" alt=\"image-20231017090853567\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170909192.png\" alt=\"image-20231017090906285\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>æµæ§æ•ˆæœæœ‰å“ªäº›ï¼Ÿ</p>\n<ul>\n<li>å¿«é€Ÿå¤±è´¥ï¼šQPS è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œæ‹’ç»æ–°çš„è¯·æ±‚</li>\n<li>warm upï¼šQPS è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œæ‹’ç»æ–°çš„è¯·æ±‚ï¼›QPS é˜ˆå€¼æ˜¯é€æ¸æå‡çš„ï¼Œå¯ä»¥é¿å…å†·å¯åŠ¨æ—¶é«˜å¹¶å‘å¯¼è‡´æœåŠ¡å®•æœºã€‚</li>\n<li>æ’é˜Ÿç­‰å¾…ï¼šè¯·æ±‚ä¼šè¿›å…¥é˜Ÿåˆ—ï¼ŒæŒ‰ç…§é˜ˆå€¼å…è®¸çš„æ—¶é—´é—´éš”ä¾æ¬¡æ‰§è¡Œè¯·æ±‚ï¼›å¦‚æœè¯·æ±‚é¢„æœŸç­‰å¾…æ—¶é•¿å¤§äºè¶…æ—¶æ—¶é—´ï¼Œç›´æ¥æ‹’ç»</li>\n</ul>\n</blockquote>\n<h3 id=\"153-çƒ­ç‚¹å‚æ•°é™æµ\"><a class=\"anchor\" href=\"#153-çƒ­ç‚¹å‚æ•°é™æµ\">#</a> 1.5.3ã€çƒ­ç‚¹å‚æ•°é™æµğŸŒ²</h3>\n<p>ä¹‹å‰çš„é™æµæ˜¯ç»Ÿè®¡è®¿é—®æŸä¸ªèµ„æºçš„æ‰€æœ‰è¯·æ±‚ï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡ QPS é˜ˆå€¼ã€‚è€Œçƒ­ç‚¹å‚æ•°é™æµæ˜¯åˆ†åˆ«ç»Ÿè®¡<mark>å‚æ•°å€¼ç›¸åŒ</mark>çš„è¯·æ±‚ï¼Œåˆ¤è¯»æ˜¯å¦è¶…è¿‡ QPS é˜ˆå€¼ã€‚</p>\n<p>æ¯”å¦‚è¯´ï¼šæœ‰ä¸€ä¸ªèµ„æºæ˜¯æ ¹æ® id æŸ¥è¯¢å•†å“ï¼Œå…±æœ‰ 4 ä¸ªè¯·æ±‚ã€‚å¦‚æœæŒ‰ç…§åŸæ¥çš„ç»Ÿè®¡æ–¹å¼é‚£ QPS å°±æ˜¯ 4ã€‚è€ŒæŒ‰ç…§çƒ­ç‚¹å‚æ•°å®ƒä¼šæ ¹æ®å‚æ•°å€¼æ¥åˆ¤æ–­ï¼Œå‰ä¸‰ä¸ªè¯·æ±‚ä¼ é€’çš„ id ä¸º 1ï¼Œè€Œæœ€åä¸€ä¸ªä¼ é€’çš„ id ä¸º 2ã€‚æ‰€ä»¥ QPS ç»Ÿè®¡å°±ä¼šåˆ†å¼€ç»Ÿè®¡äº†ï¼Œid ä¸º 1 çš„ç»Ÿè®¡ä¸º 3 ä¸ª QPS å°±ä¸º 3ï¼Œid ä¸º 2 çš„ç»Ÿè®¡ä¸º 1 ä¸ª QPS å°±ä¸º 1</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170919488.png\" alt=\"image-20231017091910421\" /></p>\n<h4 id=\"1531-é…ç½®çƒ­ç‚¹é™æµ\"><a class=\"anchor\" href=\"#1531-é…ç½®çƒ­ç‚¹é™æµ\">#</a> 1.5.3.1ã€é…ç½®çƒ­ç‚¹é™æµğŸŒ´</h4>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170920122.png\" alt=\"image-20231017092015196\" /></p>\n<p>å‚æ•°ç´¢å¼•ï¼šä»£è¡¨å½“å‰åˆ—è¡¨ä¸­ç´¢å¼•ä¸º 0 çš„å‚æ•°ä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ª</p>\n<p>å•æœºé˜ˆå€¼ + ç»Ÿè®¡çª—å£æ—¶é•¿ = n ç§’é’Ÿæœ€å¤šå¤„ç† 5 ä¸ªè¯·æ±‚</p>\n<p>ä»£è¡¨çš„å«ä¹‰æ˜¯ï¼šå¯¹ hot è¿™ä¸ªèµ„æºçš„ 0 å·å‚æ•° (ç¬¬ä¸€ä¸ªå‚æ•°) åšç»Ÿè®¡ï¼Œæ¯ 1 ç§’<strong>ç›¸åŒå‚æ•°å€¼</strong>çš„è¯·æ±‚æ•°ä¸èƒ½è¶…è¿‡ 5</p>\n<h4 id=\"1532-é…ç½®çƒ­ç‚¹é™æµé«˜çº§é¡¹\"><a class=\"anchor\" href=\"#1532-é…ç½®çƒ­ç‚¹é™æµé«˜çº§é¡¹\">#</a> 1.5.3.2ã€é…ç½®çƒ­ç‚¹é™æµé«˜çº§é¡¹ğŸŒ´</h4>\n<p>åœ¨çƒ­ç‚¹å‚æ•°é™æµçš„é«˜çº§é€‰é¡¹ä¸­ï¼Œå¯ä»¥å¯¹éƒ¨åˆ†å‚æ•°è®¾ç½®ä¾‹å¤–é…ç½®ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310170924654.png\" alt=\"image-20231017092441509\" /></p>\n<p>ç»“åˆä¸Šä¸€ä¸ªé…ç½®ï¼Œè¿™é‡Œçš„å«ä¹‰æ˜¯å¯¹ 0 å·çš„ long ç±»å‹å‚æ•°é™æµï¼Œæ¯ 1 ç§’ç›¸åŒå‚æ•°çš„ QPS ä¸èƒ½è¶…è¿‡ 5ï¼Œæœ‰ä¸¤ä¸ªä¾‹å¤–ï¼š</p>\n<p>1ã€å¦‚æœå‚æ•°å€¼æ˜¯ 100ï¼Œåˆ™æ¯ 1 ç§’å…è®¸çš„ QPS ä¸º 10</p>\n<p>2ã€å¦‚æœå‚æ•°å€¼æ˜¯ 101ï¼Œåˆ™æ¯ 1 ç§’å…è®¸çš„ QPS ä¸º 15</p>\n<h4 id=\"1533-æ¡ˆä¾‹çƒ­ç‚¹å‚æ•°é™æµ\"><a class=\"anchor\" href=\"#1533-æ¡ˆä¾‹çƒ­ç‚¹å‚æ•°é™æµ\">#</a> 1.5.3.3ã€æ¡ˆä¾‹ï¼Œçƒ­ç‚¹å‚æ•°é™æµğŸŒ´</h4>\n<p>ç»™ /order/{orderId} è¿™ä¸ªèµ„æºæ·»åŠ çƒ­ç‚¹å‚æ•°é™æµï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>é»˜è®¤çš„çƒ­ç‚¹å‚æ•°è§„åˆ™æ˜¯æ¯ 1 ç§’è¯·æ±‚é‡ä¸è¶…è¿‡ 2</li>\n<li>ç»™ 102 è¿™ä¸ªå‚æ•°è®¾ç½®ä¾‹å¤–ï¼šæ¯ 1 ç§’è¯·æ±‚é‡ä¸è¶…è¿‡ 4</li>\n<li>ç»™ 103 è¿™ä¸ªå‚æ•°è®¾ç½®ä¾‹å¤–ï¼šæ¯ 1 ç§’è¯·æ±‚é‡ä¸è¶…è¿‡ 10</li>\n</ul>\n<blockquote>\n<p>&lt;font color='red'&gt; æ³¨æ„ &lt;/font&gt;ï¼š</p>\n<p>çƒ­ç‚¹å‚æ•°é™æµå¯¹é»˜è®¤çš„ SpringMVC èµ„æºæ— æ•ˆ</p>\n</blockquote>\n<p>æ­¥éª¤ï¼š</p>\n<p>1ã€çƒ­ç‚¹å‚æ•°é™æµå¯¹é»˜è®¤çš„ SpringMVC èµ„æºæ— æ•ˆï¼Œæˆ‘ä»¬ order/{orderId} è¿™ä¸ªèµ„æºæ°å¥½å°±æ˜¯ Sentinel é»˜è®¤å¯¹ SpringMVC ç›‘æ§çš„ä¸€ä¸ªèµ„æºï¼Œæ‰€ä»¥å³ä¾¿é…ç½®äº†çƒ­ç‚¹å‚æ•°ä¹Ÿä¸ä¼šç”Ÿæ•ˆï¼Œåªæœ‰é€šè¿‡ @SentinelResource å»å£°æ˜çš„èµ„æºæ‰å¯ä»¥é…ç½®çƒ­ç‚¹å‚æ•°é™æµ</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SentinelResource</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hot\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&#123;orderId&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">Order</span> <span class=\"token function\">queryOrderByUserId</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"orderId\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Long</span> orderId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// æ ¹æ® id æŸ¥è¯¢è®¢å•å¹¶è¿”å›</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">return</span> orderService<span class=\"token punctuation\">.</span><span class=\"token function\">queryOrderById</span><span class=\"token punctuation\">(</span>orderId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿™æ—¶èµ„æºå°±åŒæ—¶å…·å¤‡äº†ä¸¤ä¸ªåç§°äº†ï¼Œä¸€ä¸ªæ˜¯ order/{orderId} è¿™æ˜¯é»˜è®¤çš„ SpringMVC èµ„æºåç§°ã€‚</p>\n<p>å¦å¤–ä¸€ä¸ªå°±æ˜¯æˆ‘ä»¬è‡ªå·±èµ·çš„ hot</p>\n<p>é‡å¯ orderService æœåŠ¡åè®¿é—®é¡µé¢ uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDg4L29yZGVyLzEwMQ==\">http://localhost:8088/order/101</span></p>\n<p>è¿™æ ·å°±å¯ä»¥çœ‹åˆ°è”Ÿç‚¹é“¾è·¯äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171009407.png\" alt=\"image-20231017100944355\" /></p>\n<p>2ã€é…ç½®çƒ­ç‚¹é™æµï¼Œä¸è¦ç‚¹å‡»æ ‘å½¢åˆ—è¡¨ä¸­çš„çƒ­ç‚¹è¿™ä¸ªè¡¨å•é‡Œé¢æ²¡æœ‰é«˜çº§é…ç½®</p>\n<p>æˆ‘ä»¬ç‚¹å‡»å·¦è¾¹çš„é€‰é¡¹æ ä¸­çš„çƒ­ç‚¹è§„åˆ™ï¼Œè¿›è¡Œé…ç½®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171011792.png\" alt=\"image-20231017101141197\" /></p>\n<p>ç‚¹å‡»æ–°å¢çƒ­ç‚¹é™æµè§„åˆ™å°±ä¼šå¼¹å‡ºä¸€ä¸ªè¡¨å•è¿›è¡Œé…ç½®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171015751.png\" alt=\"image-20231017101511501\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171017813.gif\" alt=\"test\" /></p>\n<p>ä½¿ç”¨ jmeter è¿›è¡Œæµ‹è¯•ï¼š</p>\n<p>order/101 çš„è¯·æ±‚ç»“æœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171021326.png\" alt=\"image-20231017102157624\" /></p>\n<p>order/102 è¯·æ±‚çš„ç»“æœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171022007.png\" alt=\"image-20231017102216489\" /></p>\n<p>order/103 è¯·æ±‚ç»“æœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171022759.png\" alt=\"image-20231017102239351\" /></p>\n<p>Sentinel çš„æ§åˆ¶å°æƒ…å†µ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171022389.png\" alt=\"image-20231017102256408\" /></p>\n<h2 id=\"16-éš”ç¦»å’Œé™çº§\"><a class=\"anchor\" href=\"#16-éš”ç¦»å’Œé™çº§\">#</a> 1.6ã€éš”ç¦»å’Œé™çº§ğŸŒ³</h2>\n<ul>\n<li>FeignClient æ•´åˆ Sentinel</li>\n<li>çº¿ç¨‹éš”ç¦» (èˆ±å£æ¨¡å¼)</li>\n<li>ç†”æ–­é™çº§</li>\n</ul>\n<p><strong>å›é¡¾ï¼Œéš”ç¦»å’Œé™çº§çš„åŸç†</strong></p>\n<p>è™½ç„¶é™æµå¯ä»¥å°½é‡é¿å…å› é«˜å¹¶å‘è€Œå¼•èµ·çš„æœåŠ¡æ•…éšœï¼Œä½†æœåŠ¡è¿˜ä¼šå› ä¸ºå…¶å®ƒåŸå› è€Œæ•…éšœã€‚è€Œè¦å°†è¿™äº›æ•…éšœæ§åˆ¶åœ¨ä¸€å®šèŒƒå›´ï¼Œé¿å…é›ªå´©ï¼Œå°±è¦é çº¿ç¨‹éš”ç¦» (èˆ±å£æ¨¡å¼) å’Œç†”æ–­é™çº§æ‰‹æ®µäº†ã€‚</p>\n<p>ç»™æ¯ä¸ªä¸šåŠ¡åˆ’åˆ†çº¿ç¨‹æ± ï¼Œå½“æœ‰è¯·æ±‚è®¿é—®ä¸šåŠ¡ 1 æ—¶æœ€å¤šä½¿ç”¨åä¸ªçº¿ç¨‹ï¼Œè™½ç„¶æœåŠ¡ C æ•…éšœäº†è¯·æ±‚è¿‡ç¨‹ä¸­ä¼šé˜»å¡ä½†æ˜¯æœ€å¤šåªå ç”¨ 10 ä¸ªçº¿ç¨‹èµ„æº</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171031862.png\" alt=\"image-20231017103151291\" /></p>\n<p>ç†”æ–­é™çº§ä¼šç»Ÿè®¡æ•…éšœæœåŠ¡çš„æ¯”ä¾‹ï¼Œæ¯”å¦‚è¯´æœåŠ¡ A è®¿é—®æœåŠ¡ D æˆåŠŸçš„åªæœ‰ä¸€ä¸ªï¼Œæ•…éšœçš„æœ‰ä¸¤ä¸ªè¿™æ—¶çš„æ¯”ä¾‹å°±æ˜¯ 60%ã€‚æ­¤æ—¶ æ–­è·¯å™¨å°±ä¼šç†”æ–­ä¸šåŠ¡ï¼Œå†æœ‰è¦è¯·æ±‚æœåŠ¡ D çš„ä¸šåŠ¡å°±ä¼šå¿«é€Ÿå¤±è´¥</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171033093.png\" alt=\"image-20231017103347716\" /></p>\n<p>ä¸ç®¡æ˜¯çº¿ç¨‹éš”ç¦»è¿˜æ˜¯ç†”æ–­é™çº§ï¼Œéƒ½æ˜¯å¯¹ &lt;font color='red'&gt; å®¢æˆ·ç«¯ (è°ƒç”¨æ–¹) &lt;/font&gt;. çš„ä¿æŠ¤</p>\n<h3 id=\"161-feignæ•´åˆsentinel\"><a class=\"anchor\" href=\"#161-feignæ•´åˆsentinel\">#</a> 1.6.1ã€Feign æ•´åˆ SentinelğŸŒ²</h3>\n<p>SpringCloud ä¸­ï¼Œå¾®æœåŠ¡è°ƒç”¨éƒ½æ˜¯é€šè¿‡ Feign æ¥å®ç°çš„ï¼Œå› æ­¤åšå®¢æˆ·ç«¯ä¿æŠ¤å¿…é¡»æ•´åˆ Feign å’Œ Sentinel</p>\n<p>1ã€ä¿®æ”¹ OrderService çš„ applicaiton.yml æ–‡ä»¶ï¼Œå¼€å¯ Feign çš„ Sentinel åŠŸèƒ½</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">feign</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token key atrule\">sentinel</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\"># å¼€å¯ feign å¯¹ sentinel çš„æ”¯æŒ</span></pre></td></tr></table></figure><p>2ã€ç»™ FeignClient ç¼–å†™å¤±è´¥åçš„é™çº§é€»è¾‘</p>\n<p>2.1ã€æ–¹å¼ä¸€ï¼šFallbackClassï¼Œæ— æ³•å¯¹è¿œç¨‹è°ƒç”¨çš„å¼‚å¸¸åšå¤„ç†</p>\n<p>2.2ã€æ–¹å¼äºŒï¼šFallbackFactoryï¼Œå¯ä»¥å¯¹è¿œç¨‹è°ƒç”¨çš„å¼‚å¸¸åšå¤„ç†ï¼Œæˆ‘ä»¬é€‰æ‹©è¿™ç§</p>\n<p>2.2.1ã€åœ¨ feign-api é¡¹ç›®ä¸­å®šä¹‰ç±»ï¼Œå®ç° FallbackFactoryï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserClientFallbackFactory</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">FallbackFactory</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">UserClient</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserClient</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> throwable<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// åˆ›å»º UserClient æ¥å£å®ç°ç±»ï¼Œå®ç°å…¶ä¸­çš„æ–¹æ³•ï¼Œç¼–å†™å¤±è´¥é™çº§çš„å¤„ç†é€»è¾‘</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UserClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">findById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token comment\">// è®°å½•å¼‚å¸¸ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æŸ¥è¯¢ç”¨æˆ·å¼‚å¸¸\"</span><span class=\"token punctuation\">,</span> throwable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token comment\">// æ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿”å›é»˜è®¤çš„æ•°æ®ï¼Œè¿™é‡Œæ˜¯ç©ºç”¨æˆ·</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>2.2.2ã€åœ¨ feign-api é¡¹ç›®ä¸­çš„ DefaultFeignConfigration ç±»ä¸­å°† UserClientFallbackFactory æ³¨å†Œä¸ºä¸€ä¸ª Beanï¼š</p>\n<p>å£°æ˜ Bean å¾ˆç®€å•ï¼Œå®šä¹‰å‡½æ•°è¿”å› new å‡ºæ¥çš„å¯¹è±¡å¹¶æ³¨å†Œ Bean å°±è¡Œäº†</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">UserClientFallbackFactory</span> <span class=\"token function\">userClientFallbackFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UserClientFallbackFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>2.2.3ã€åœ¨ feign-api é¡¹ç›®ä¸­çš„ UserClient æ¥å£ä¸­ä½¿ç”¨ UserClientFallbackFactoryï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@FeignClient</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"userservice\"</span><span class=\"token punctuation\">,</span> fallbackFactory <span class=\"token operator\">=</span> <span class=\"token class-name\">UserClientFallbackFactory</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserClient</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">User</span> <span class=\"token function\">findById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>3ã€é‡å¯ orderService æœåŠ¡</p>\n<p>é‡å¤å®ŒæˆåæŸ¥çœ‹ Sentinel çš„è”Ÿç‚¹é“¾è·¯æƒ…å†µï¼Œä¸‹é¢çš„æƒ…å†µè¯´æ˜å®Œæˆäº† Feign ä¸ Sentinel çš„æ•´åˆäº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171304966.png\" alt=\"image-20231017130442973\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>Sentinel æ”¯æŒçš„é›ªå´©è§£å†³æ–¹æ¡ˆï¼š</p>\n<ul>\n<li>çº¿ç¨‹éš”ç¦» (ä»“å£æ¨¡å¼)</li>\n<li>é™çº§ç†”æ–­</li>\n</ul>\n<p>Feign æ•´åˆ Sentinel çš„æ­¥éª¤ï¼š</p>\n<ol>\n<li>åœ¨ application.yml ä¸­é…ç½®ï¼šfeign.sentinel.enable = true</li>\n<li>ç»™ FeignClient ç¼–å†™ FallbackFactory å¹¶æ³¨å†Œä¸º Bean</li>\n<li>å°† FallbackFactory é…ç½®åˆ° FeignClient</li>\n</ol>\n</blockquote>\n<h3 id=\"162-çº¿ç¨‹éš”ç¦»\"><a class=\"anchor\" href=\"#162-çº¿ç¨‹éš”ç¦»\">#</a> 1.6.2ã€çº¿ç¨‹éš”ç¦»ğŸŒ²</h3>\n<p>çº¿ç¨‹éš”ç¦»æœ‰ä¸¤ç§æ–¹å¼å®ç°ï¼š</p>\n<ul>\n<li>çº¿ç¨‹æ± éš”ç¦»</li>\n<li>ä¿¡å·é‡éš”ç¦» (Sentinel é»˜è®¤é‡‡ç”¨)</li>\n</ul>\n<p>é€šè¿‡æ¡ˆä¾‹æ¥æŸ¥çœ‹ä¸¤ä¸ªçº¿ç¨‹éš”ç¦»çš„å·®åˆ«ï¼š</p>\n<p>å‡è®¾è¯´æœ‰å››ä¸ªæœåŠ¡ iï¼Œaï¼Œbï¼Œc ã€‚æœåŠ¡ i é‡Œé¢çš„ä¸šåŠ¡ä¾èµ–äºæœåŠ¡ aï¼Œbï¼Œcã€‚æ¯”æ–¹è¯´æ¥äº†ä¸€ä¸ªè¯·æ±‚ï¼Œå®ƒçš„ä¸šåŠ¡ä¾èµ–äºæœåŠ¡ aï¼Œbã€‚å¦‚æœè¯´æˆ‘ä»¬ç°åœ¨ç”¨çš„æ˜¯çº¿ç¨‹æ± éš”ç¦»é‚£ä¹ˆå®ƒå°±ä¼šç»™è¿™ä¸ªä¸šåŠ¡æ‰€ä¾èµ–çš„æ¯ä¸ªæœåŠ¡éƒ½åˆ›å»ºçº¿ç¨‹æ± ï¼Œè¯·æ±‚æ¥äº†ä»¥åä¸ä¼šä½¿ç”¨è¯·æ±‚æœ¬èº«çš„çº¿ç¨‹ï¼Œè€Œæ˜¯å»åˆ›å»ºçš„çº¿ç¨‹æ± ä¸­åˆ†åˆ«å–ä¸€ä¸ªçº¿ç¨‹è€Œç”¨è¿™ä¸ªçº¿ç¨‹å»è°ƒç”¨ Feign çš„å®¢æˆ·ç«¯ï¼Œå‘èµ·è¿œç¨‹è°ƒç”¨ã€‚è¿™æ ·å‘¢å°±æŠŠä¸¤ä¸ªæœåŠ¡éš”ç¦»äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171315936.png\" alt=\"image-20231017131457045\" /></p>\n<p>è€Œå¦‚æœé‡‡ç”¨çš„æ˜¯ä¿¡å·é‡çš„æ¨¡å¼å°±ç®€å•å¤šäº†ã€‚æ¯”å¦‚è¯´æ¥äº†ä¸€ä¸ªè¯·æ±‚ï¼Œè¦è®¿é—®æœåŠ¡ cã€‚å®ƒä¼šä½¿ç”¨è¯·æ±‚æœ¬èº«çš„çº¿ç¨‹ç›´æ¥å»è°ƒç”¨ Feign çš„å®¢æˆ·ç«¯å»è°ƒç”¨æœåŠ¡ cã€‚é‚£å®ƒæ€ä¹ˆåšéš”ç¦»å‘¢ï¼Ÿå®ƒä¼šåœ¨è¯·æ±‚è¿›å…¥æ—¶åšä¸€ä¸ªåˆ¤æ–­ï¼Œç»´æŒäº†ä¸€ä¸ªè®¡æ•°å™¨ã€‚åˆ¤æ–­ç°åœ¨è®¡æ•°å™¨è¿˜æœ‰æ²¡æœ‰ã€‚æ¯”å¦‚è¯´è®¡æ•°å™¨æ€»æ•°ä¸º 10 æ¯è¿›å…¥ä¸€ä¸ªè¯·æ±‚è®¡æ•°å™¨å°±ä¼šå‡ 1ï¼Œç„¶åå°±å¯ä»¥å»è®¿é—®æœåŠ¡ c äº†ã€‚å½“æ¥äº†åä¸ªè¯·æ±‚è®¡æ•°å™¨è¢«å–å®Œåå†æ¥æ–°è¯·æ±‚å°±ä¼šè¢«æ‹’ç»ã€‚è¿™æ ·å°±ç­‰äºåˆ©ç”¨è®¡æ•°å™¨é™åˆ¶äº†æœ€ç»ˆçº¿ç¨‹çš„æ•°é‡äº†ã€‚å¦‚æœå¤„ç†å®Œè¯·æ±‚è®¡æ•°å™¨è¿˜æ˜¯è¦è¿˜å›å»çš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171319389.png\" alt=\"image-20231017131940276\" /></p>\n<h4 id=\"1621-ä¸¤è€…çš„ä¼˜ç¼ºç‚¹\"><a class=\"anchor\" href=\"#1621-ä¸¤è€…çš„ä¼˜ç¼ºç‚¹\">#</a> 1.6.2.1ã€ä¸¤è€…çš„ä¼˜ç¼ºç‚¹ï¼š</h4>\n<h5 id=\"çº¿ç¨‹æ± éš”ç¦»\"><a class=\"anchor\" href=\"#çº¿ç¨‹æ± éš”ç¦»\">#</a> çº¿ç¨‹æ± éš”ç¦»</h5>\n<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>\n<p>1ã€æ”¯æŒä¸»åŠ¨è¶…æ—¶</p>\n<p>å¦‚æœå‘ç°è¯·æ±‚æœ‰ç‚¹ä¹…äº†å¯ä»¥æ‰‹åŠ¨çš„ç»ˆæ­¢çº¿ç¨‹</p>\n<p>2ã€æ”¯æŒå¼‚æ­¥è°ƒç”¨</p>\n<p>æ¯ä¸€æ¬¡è¯·æ±‚éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹è€Œä¸æ˜¯ tomcat è¯·æ±‚çš„çº¿ç¨‹</p>\n<p><strong>ç¼ºç‚¹</strong>ï¼š</p>\n<p>1ã€çº¿ç¨‹çš„é¢å¤–å¼€é”€æ¯”è¾ƒå¤§</p>\n<p>åœºæ™¯ï¼š</p>\n<p>1ã€ä½æ‰‡å‡º</p>\n<p>æ‰‡å‡ºï¼šæ¯”æ–¹è¯´è¯·æ±‚åˆ°æˆ‘è¿™ä¸ªæœåŠ¡ï¼Œè€Œæˆ‘è¿™ä¸ªæœåŠ¡ä¾èµ–äºå…¶å®ƒçš„ n ä¸ªæœåŠ¡ã€‚å°±æ˜¯ä»æˆ‘è¿™æ¥äº†ï¼Œæ¥äº†ä¸€ä¸ªè€Œåæˆ‘æ‰‡å‡ºäº†å¥½å‡ ä¸ªã€‚å¦‚æœä¾èµ–çš„æœåŠ¡è¶Šå¤šï¼Œé‚£æ‰‡å‡ºä¹Ÿå°±è¶Šé«˜ï¼Œè€Œæ‰‡å‡ºè¶Šé«˜è°ƒç”¨çš„è¶Šå¤šæˆ‘éœ€è¦å¼€å¯çš„çº¿ç¨‹ä¹Ÿè¶Šå¤šï¼Œæ¶ˆè€—ä¹Ÿå°±è¶Šå¤§ã€‚æ‰€ä»¥å®ƒä¸é€‚ç”¨äºé«˜æ‰‡å‡ºçš„åœºæ™¯ï¼</p>\n<h5 id=\"ä¿¡å·é‡éš”ç¦»\"><a class=\"anchor\" href=\"#ä¿¡å·é‡éš”ç¦»\">#</a> ä¿¡å·é‡éš”ç¦»</h5>\n<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>\n<p>1ã€è½»é‡çº§ï¼Œæ— é¢å¤–å¼€é”€</p>\n<p><strong>ç¼ºç‚¹</strong>ï¼š</p>\n<p>1ã€ä¸æ”¯æŒä¸»åŠ¨è¶…æ—¶</p>\n<p>2ã€ä¸æ”¯æŒå¼‚æ­¥è°ƒç”¨</p>\n<p>åœºæ™¯ï¼š</p>\n<p>1ã€é«˜é¢‘è°ƒç”¨</p>\n<p>2ã€é«˜æ‰‡å‡º</p>\n<h4 id=\"1622-çº¿ç¨‹éš”ç¦»-èˆ±å£æ¨¡å¼\"><a class=\"anchor\" href=\"#1622-çº¿ç¨‹éš”ç¦»-èˆ±å£æ¨¡å¼\">#</a> 1.6.2.2ã€çº¿ç¨‹éš”ç¦» (èˆ±å£æ¨¡å¼)ğŸŒ´</h4>\n<p>åœ¨æ·»åŠ é™æµè§„åˆ™æ—¶ï¼Œå¯ä»¥é€‰æ‹©ä¸¤ç§é˜ˆå€¼ç±»å‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171332558.png\" alt=\"image-20231017133257502\" /></p>\n<ul>\n<li>QPSï¼šå°±æ˜¯æ¯ç§’çš„è¯·æ±‚æ•°ï¼Œåœ¨å¿«é€Ÿå…¥é—¨ä¸­å·²ç»æ¼”ç¤ºè¿‡</li>\n<li>çº¿ç¨‹æ•°ï¼šæ˜¯è¯¥èµ„æºèƒ½ä½¿ç”¨çš„ tomcat çº¿ç¨‹æ•°çš„æœ€å¤§å€¼ã€‚ä¹Ÿå°±æ˜¯é€šè¿‡é™åˆ¶çº¿ç¨‹æ•°é‡ï¼Œå®ç° &lt;font color='red'&gt; èˆ±å£æ¨¡å¼ &lt;/font&gt;.</li>\n</ul>\n<h5 id=\"16221-æ¡ˆä¾‹çº¿ç¨‹éš”ç¦»-èˆ±å£æ¨¡å¼\"><a class=\"anchor\" href=\"#16221-æ¡ˆä¾‹çº¿ç¨‹éš”ç¦»-èˆ±å£æ¨¡å¼\">#</a> 1.6.2.2.1ã€æ¡ˆä¾‹ï¼Œçº¿ç¨‹éš”ç¦» (èˆ±å£æ¨¡å¼)ğŸ‹</h5>\n<p>éœ€æ±‚ï¼šç»™ UserClient çš„æŸ¥è¯¢ç”¨æˆ·æ¥å£è®¾ç½®æµæ§è§„åˆ™ï¼Œçº¿ç¨‹æ•°ä¸èƒ½è¶…è¿‡ 2ã€‚ç„¶ååˆ©ç”¨ jmeter æµ‹è¯•ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171336102.png\" alt=\"image-20231017133620881\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171336135.png\" alt=\"image-20231017133657213\" /></p>\n<p>é…ç½®å®Œæˆï¼ä½¿ç”¨ jmeter è¿›è¡Œé«˜å¹¶å‘æµ‹è¯•ï¼š</p>\n<p>å…¶ä¸­çš„çº¿ç¨‹æ•°ä¸º 10ï¼Œæ—¶é—´ä¸º 0ã€‚è¡¨ç¤ºä¸€ç¬é—´å‘ 10 ä¸ªçº¿ç¨‹è¯·æ±‚ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171337544.png\" alt=\"image-20231017133755763\" /></p>\n<p>æµ‹è¯•ç»“æœï¼š</p>\n<p>ä½†æ˜¯æ€ä¹ˆæ²¡æœ‰çœ‹åˆ°è¢«æ‹’ç»çš„è¯·æ±‚å‘¢ï¼Ÿ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171341275.png\" alt=\"image-20231017134110845\" /></p>\n<p>å…¶å®æˆ‘ä»¬åšäº†é™çº§ç­–ç•¥äº†</p>\n<p>åœ¨ FeignClient æ³¨è§£ä¸­åŠ äº† fallbackFactory</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@FeignClient</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"userservice\"</span><span class=\"token punctuation\">,</span> fallbackFactory <span class=\"token operator\">=</span> <span class=\"token class-name\">UserClientFallbackFactory</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserClient</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">User</span> <span class=\"token function\">findById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰€ä»¥å½“çº¿ç¨‹éš”ç¦»è¢«é™çº§ä»¥åå®ƒä¸æ˜¯æŠ¥é”™ï¼Œè€Œæ˜¯ä¼šèµ°è¿™ä¸ªé™çº§é€»è¾‘è¿”å›ä¸€ä¸ªç©ºå¯¹è±¡</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserClientFallbackFactory</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">FallbackFactory</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">UserClient</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserClient</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> throwable<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// åˆ›å»º UserClient æ¥å£å®ç°ç±»ï¼Œå®ç°å…¶ä¸­çš„æ–¹æ³•ï¼Œç¼–å†™å¤±è´¥é™çº§çš„å¤„ç†é€»è¾‘</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UserClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">findById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token comment\">// è®°å½•å¼‚å¸¸ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æŸ¥è¯¢ç”¨æˆ·å¼‚å¸¸\"</span><span class=\"token punctuation\">,</span> throwable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token comment\">// æ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿”å›é»˜è®¤çš„æ•°æ®ï¼Œè¿™é‡Œæ˜¯ç©ºç”¨æˆ·</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨ idea çš„æ§åˆ¶å°ä¼šæ‰“å°å¼‚å¸¸çš„ä¿¡æ¯</p>\n<pre><code>10-17 13:40:38:046 ERROR 1804 --- [nio-8088-exec-3] c.i.f.c.f.UserClientFallbackFactory : æŸ¥è¯¢ç”¨æˆ·å¼‚å¸¸\n</code></pre>\n<p>æˆ‘ä»¬åœ¨å›åˆ° jmeter ç‚¹å‡»è¯·æ±‚æŸ¥çœ‹è¯¦ç»†æƒ…å†µï¼Œæœ‰çš„è·å–çš„æ•°æ®æ˜¯ç©ºçš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171347804.png\" alt=\"image-20231017134731646\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>çº¿ç¨‹éš”ç¦»çš„ä¸¤ç§æ‰‹æ®µæ˜¯ï¼Ÿ</p>\n<ul>\n<li>ä¿¡å·éš”ç¦»</li>\n<li>çº¿ç¨‹æ± éš”ç¦»</li>\n</ul>\n<p>ä¿¡å·é‡éš”ç¦»çš„ç‰¹ç‚¹æ˜¯ï¼Ÿ</p>\n<ul>\n<li>åŸºäºè®¡æ•°å™¨æ¨¡å¼ï¼Œç®€å•ï¼Œå¼€é”€å°</li>\n</ul>\n<p>çº¿ç¨‹æ± éš”ç¦»çš„ç‰¹ç‚¹æ˜¯ï¼Ÿ</p>\n<ul>\n<li>åŸºäºçº¿ç¨‹æ± æ¨¡å¼ï¼Œæœ‰é¢å¤–å¼€é”€ï¼Œä½†éš”ç¦»æ§åˆ¶æ›´å¼º</li>\n</ul>\n</blockquote>\n<h3 id=\"163-ç†”æ–­é™çº§\"><a class=\"anchor\" href=\"#163-ç†”æ–­é™çº§\">#</a> 1.6.3ã€ç†”æ–­é™çº§ğŸŒ²</h3>\n<p>ç†”æ–­é™çº§æ˜¯è§£å†³é›ªå´©é—®é¢˜çš„é‡è¦æ‰‹æ®µã€‚å…¶æ€è·¯æ˜¯ç”± &lt;font color='red'&gt; æ–­è·¯å™¨ &lt;/font &gt; ç»Ÿè®¡æœåŠ¡è°ƒç”¨çš„å¼‚å¸¸æ¯”ä¾‹ï¼Œæ…¢è¯·æ±‚æ¯”ä¾‹ï¼Œå¦‚æœè¶…å‡ºé˜ˆå€¼åˆ™ä¼š &lt; font color='red'&gt; ç†”æ–­ &lt;/font &gt; è¯¥æœåŠ¡ã€‚å³æ‹¦æˆªè®¿é—®è¯¥æœåŠ¡çš„ä¸€åˆ‡è¯·æ±‚ï¼›è€Œå½“è¯·æ±‚æ¢å¤æ—¶ï¼Œæ–­è·¯å™¨ä¼šæ”¾è¡Œè®¿é—®è¯¥æœåŠ¡çš„è¯·æ±‚ã€‚</p>\n<p>æ–­è·¯å™¨å†…éƒ¨ç”±ä¸€ä¸ªçŠ¶æ€æœºæ¥å®ç°çš„ï¼Œè¿™ä¸ªçŠ¶æ€æœºåŒ…å«ä¸‰ç§çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯ï¼šclosedï¼Œopenï¼ŒHalf-Open</p>\n<p>closed çŠ¶æ€ä¸‹ï¼Œæ–­è·¯å™¨ä¸ä¼šæ‹¦æˆªä»»ä½•è¯·æ±‚ã€‚ä¸ç®¡è¯·æ±‚æ˜¯æ­£å¸¸çš„è¿˜æ˜¯å¼‚å¸¸çš„éƒ½å¯ä»¥è®¿é—®ï¼Œå®ƒä¼šå»ç»Ÿè®¡è°ƒç”¨å¼‚å¸¸çš„æ¯”ä¾‹ï¼Œå¦‚æœç»Ÿè®¡è¿‡ç¨‹ä¸­å‘ç°å¼‚å¸¸æ¯”ä¾‹è¿‡é«˜è¾¾åˆ°äº†é˜ˆå€¼å°±ä¼šä» closed çŠ¶æ€åˆ‡æ¢åˆ° open çŠ¶æ€ã€è¿™æ—¶å°±ä¼šæ‹¦æˆªè¿›å…¥è¯¥æœåŠ¡çš„ä¸€äº›è¯·æ±‚äº†ä¹Ÿå°±ç›¸å½“äºæ˜¯ç†”æ–­äº†ã€‚ç†”æ–­æœ‰ä¸€ä¸ªæŒç»­çš„æ—¶é—´ï¼Œå½“ç†”æ–­æ—¶é—´ç»“æŸå°±ä¼šä» open çŠ¶æ€åˆ‡æ¢åˆ° half-open çŠ¶æ€ (åŠå¼€çŠ¶æ€)ã€‚half-open çŠ¶æ€ä¼šæ”¾è¡Œä¸€æ¬¡è¯·æ±‚ï¼Œç„¶åæ ¹æ®è¿™æ¬¡è¯·æ±‚çš„ç»“æœæ¥åˆ¤æ–­ä¸‹ä¸€æ­¥ã€‚</p>\n<p>æ¯”å¦‚è¯´æ”¾è¡Œä¸€æ¬¡è¯·æ±‚å‘ç°è¿™ä¸ªè¯·æ±‚ä¾èµ–æ˜¯å¤±è´¥çš„é‚£ä¹ˆå°±ä¼šå†æ¬¡è¿›å…¥ open çŠ¶æ€</p>\n<p>å¦‚æœæ”¾è¡Œä¸€æ¬¡è¯·æ±‚æ‰§è¡Œå®Œäº†å‘ç°æ˜¯æˆåŠŸçš„é‚£ä¹ˆå°±ä¼šä» half-open åˆ‡æ¢åˆ° closed çŠ¶æ€</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171422210.png\" alt=\"image-20231017142215093\" /></p>\n<p>æˆ‘ä»¬çŸ¥é“æ–­è·¯å™¨è¦æƒ³ä» closed çŠ¶æ€è¿›å…¥åˆ° open çŠ¶æ€éœ€è¦åˆ¤æ–­æœåŠ¡æœ‰æ²¡æœ‰è§¦å‘ç†”æ–­çš„æ¡ä»¶ã€‚è€Œç†”æ–­åˆ¤æ–­çš„æ¡ä»¶å°±æ˜¯ä¾æ®ç†”æ–­ç­–ç•¥æ¥å®Œæˆçš„ï¼Œè€Œåœ¨ Sentinel é‡Œç†”æ–­çš„ç­–ç•¥æœ‰ä¸‰ç§ï¼šæ…¢è°ƒç”¨ï¼Œå¼‚å¸¸æ¯”ä¾‹ï¼Œå¼‚å¸¸æ•°</p>\n<h4 id=\"1631-ç†”æ–­ç­–ç•¥-æ…¢è°ƒç”¨\"><a class=\"anchor\" href=\"#1631-ç†”æ–­ç­–ç•¥-æ…¢è°ƒç”¨\">#</a> 1.6.3.1ã€ç†”æ–­ç­–ç•¥ - æ…¢è°ƒç”¨ğŸŒ´</h4>\n<p><mark>æ…¢è°ƒç”¨</mark>ï¼šä¸šåŠ¡çš„å“åº”æ—¶é•¿ (RT) å¤§äºæŒ‡å®šæ—¶é•¿çš„è¯·æ±‚è®¤å®šä¸ºæ…¢è°ƒç”¨è¯·æ±‚ã€‚åœ¨æŒ‡å®šæ—¶é—´å†…ï¼Œå¦‚æœè¯·æ±‚æ•°é‡è¶…è¿‡è®¾å®šçš„æœ€å°æ•°é‡ï¼Œæ…¢è°ƒç”¨æ¯”ä¾‹å¤§äºè®¾å®šçš„é˜ˆå€¼ï¼Œåˆ™è§¦å‘ç†”æ–­ã€‚ä¾‹å¦‚ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171428040.png\" alt=\"image-20231017142805647\" /></p>\n<p><strong>è§£è¯»</strong>ï¼šRT è¶…è¿‡ 500ms çš„è°ƒç”¨æ˜¯æ…¢è°ƒç”¨ï¼Œç»Ÿè®¡æœ€è¿‘ 10000ms å†…çš„è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚é‡è¶…è¿‡ 10 æ¬¡ï¼Œå¹¶ä¸”æ…¢è°ƒç”¨æ¯”ä¾‹ä¸ä½äº 0.5ï¼Œåˆ™è§¦å‘ç†”æ–­ï¼Œç†”æ–­æ—¶é•¿ä¸º 5 ç§’ã€‚ç„¶åè¿›å…¥ half-open çŠ¶æ€ï¼Œæ”¾è¡Œä¸€æ¬¡è¯·æ±‚åšæµ‹è¯•ã€‚</p>\n<h5 id=\"16311-æ¡ˆä¾‹ç†”æ–­ç­–ç•¥-æ…¢è°ƒç”¨\"><a class=\"anchor\" href=\"#16311-æ¡ˆä¾‹ç†”æ–­ç­–ç•¥-æ…¢è°ƒç”¨\">#</a> 1.6.3.1.1ã€æ¡ˆä¾‹ï¼Œç†”æ–­ç­–ç•¥ - æ…¢è°ƒç”¨ğŸ‹</h5>\n<p>éœ€æ±‚ï¼šç»™ UserClient çš„æŸ¥è¯¢ç”¨æˆ·æ¥å£è®¾ç½®é™çº§è§„åˆ™ï¼Œæ…¢è°ƒç”¨çš„ RT é˜ˆå€¼ä¸º 50msï¼Œç»Ÿè®¡æ—¶é—´ä¸º 1 ç§’ï¼Œ æœ€å°è¯·æ±‚æ•°é‡ä¸º 5ï¼Œå¤±è´¥é˜ˆå€¼æ¯”ä¾‹ä¸º 0.4ï¼Œç†”æ–­æ—¶é•¿ä¸º 5</p>\n<p>é—®é¢˜ï¼šæœ¬åœ°è°ƒç”¨æ—¶é—´ä¸å¯èƒ½é‚£ä¹ˆé•¿æ‰€ä»¥ä¸ºäº†èƒ½å¤Ÿè§¦å‘æ…¢è°ƒç”¨éœ€è¦ä¿®æ”¹ä¸€ä¸‹ä¸šåŠ¡ä»£ç è®©å…¶è¶…è¿‡å“åº”æ—¶é—´</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">queryById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@RequestHeader</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"Truth\"</span><span class=\"token punctuation\">,</span> required <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> truth<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>id <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token comment\">// ä¼‘çœ ï¼Œè§¦å‘ç†”æ–­</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>         <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">60</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"truth: \"</span> <span class=\"token operator\">+</span> truth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token keyword\">return</span> userService<span class=\"token punctuation\">.</span><span class=\"token function\">queryById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>é‡å¯ userService æœåŠ¡</p>\n<p>è®¿é—® order/101 æ—¶å°±ä¼šå»è¯·æ±‚ userId ä¸º 1 çš„ç”¨æˆ·</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171439770.png\" alt=\"image-20231017143949635\" /></p>\n<p>order/102</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171441135.png\" alt=\"image-20231017144136736\" /></p>\n<p>order/101</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171441279.png\" alt=\"image-20231017144150302\" /></p>\n<p>å¯ä»¥çœ‹åˆ° 102 è¯·æ±‚æ—¶é•¿åŸºæœ¬ä¸è¶…è¿‡ 10 æ¯«ç§’ï¼Œè€Œ 101 è¯·æ±‚æ—¶é•¿åŸºæœ¬ä¸ä¸‹ 70 æ¯«ç§’ã€‚è¿™æ ·å°±èƒ½æ»¡è¶³æˆ‘ä»¬è§¦å‘é˜ˆå€¼çš„æƒ…å†µäº†</p>\n<p>ç„¶åå°±å¯ä»¥å»é…ç½®ç†”æ–­é™çº§ç­–ç•¥äº†ï¼Œå» Sentinel æ§åˆ¶å°ä¸­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171445150.png\" alt=\"image-20231017144506913\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171445998.png\" alt=\"image-20231017144515744\" /></p>\n<p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥å»è¿›è¡Œæµ‹è¯•äº†ï¼š</p>\n<p>è¿™æ¬¡çš„æµ‹è¯•å¯ä»¥ä¸ç”¨ jmeter äº†ï¼Œå› ä¸ºéœ€è¦ä¸€ç§’å†… 5 æ¬¡è¯·æ±‚ï¼Œæœ‰ 2 æ¬¡è§¦å‘å°±è¡Œäº†å¾ˆå®¹æ˜“å¯ä»¥å»åˆ·æ–° order/{orderId} çš„è¯·æ±‚é¡µé¢</p>\n<p>ç°åœ¨è®¿é—® order/102ï¼Œæ˜¯æ­£å¸¸å¯ä»¥è®¿é—®çš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171448397.png\" alt=\"image-20231017144804306\" /></p>\n<p>è¿ç»­è¯·æ±‚ 5 æ¬¡ order/101ï¼Œä¹Ÿå°±æ˜¯åˆ·æ–° 5 æ¬¡é¡µé¢</p>\n<p>å†å»è®¿é—® order/102 å°±ä¼šå‘ç° user ä¸­æ²¡æœ‰æ•°æ®äº†ï¼Œå½“ order å»æŸ¥ user çš„é‚£ä¸€åˆ»ç›´æ¥è¢«ç†”æ–­äº†ï¼Œå‹æ ¹æ²¡æœ‰å»æŸ¥ç›´æ¥èµ°é™çº§é€»è¾‘è¿”å› null äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171449564.png\" alt=\"image-20231017144859133\" /></p>\n<p>ç­‰å¾… 5 ç§’åå†å»åˆ·æ–°ä¸€ä¸ª order/102 é¡µé¢ï¼Œç†”æ–­å°±å–æ¶ˆäº†å¯ä»¥è¯·æ±‚åˆ° user çš„æ•°æ®äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171451453.png\" alt=\"image-20231017145103496\" /></p>\n<h4 id=\"1632-ç†”æ–­ç­–ç•¥-å¼‚å¸¸æ¯”ä¾‹å¼‚å¸¸æ•°\"><a class=\"anchor\" href=\"#1632-ç†”æ–­ç­–ç•¥-å¼‚å¸¸æ¯”ä¾‹å¼‚å¸¸æ•°\">#</a> 1.6.3.2ã€ç†”æ–­ç­–ç•¥ - å¼‚å¸¸æ¯”ä¾‹ï¼Œå¼‚å¸¸æ•°ğŸŒ´</h4>\n<ul>\n<li><mark>å¼‚å¸¸æ¯”ä¾‹æˆ–å¼‚å¸¸æ•°</mark>ï¼šç»Ÿè®¡æŒ‡å®šæ—¶é—´å†…çš„ è°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨æ¬¡æ•°è¶…è¿‡æŒ‡å®šçš„è¯·æ±‚æ•°ï¼Œå¹¶ä¸”å‡ºç°å¼‚å¸¸çš„æ¯”ä¾‹è¾¾åˆ°è®¾å®šçš„æ¯”ä¾‹é˜ˆå€¼ (æˆ–è¶…è¿‡æŒ‡å®šå¼‚å¸¸æ•°) ï¼Œåˆ™è§¦å‘ç†”æ–­ã€‚ä¾‹å¦‚ï¼š</li>\n</ul>\n<p>æŒ‰ç…§å¼‚å¸¸çš„æ¯”ä¾‹ç†”æ–­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171454750.png\" alt=\"image-20231017145414614\" /></p>\n<p>è¾¾åˆ°å¼‚å¸¸æ•°é‡ç†”æ–­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171456985.png\" alt=\"image-20231017145619743\" /></p>\n<p><strong>è§£è¯»</strong>ï¼šç»Ÿè®¡æœ€è¿‘ 1000ms å†…çš„è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚é‡è¶…è¿‡ 10 æ¬¡ï¼Œå¹¶ä¸”å¼‚å¸¸æ¯”ä¾‹ä¸ä½äº 0.5ï¼Œåˆ™è§¦å‘ç†”æ–­ï¼Œç†”æ–­æ—¶é•¿ä¸º 5 ç§’ã€‚ç„¶åè¿›å…¥ half-open çŠ¶æ€ï¼Œæ”¾è¡Œä¸€æ¬¡è¯·æ±‚åšæµ‹è¯•ã€‚</p>\n<h5 id=\"16321-æ¡ˆä¾‹ç†”æ–­ç­–ç•¥-å¼‚å¸¸æ¯”ä¾‹\"><a class=\"anchor\" href=\"#16321-æ¡ˆä¾‹ç†”æ–­ç­–ç•¥-å¼‚å¸¸æ¯”ä¾‹\">#</a> 1.6.3.2.1ã€æ¡ˆä¾‹ï¼Œç†”æ–­ç­–ç•¥ - å¼‚å¸¸æ¯”ä¾‹ğŸ‹</h5>\n<p><strong>éœ€æ±‚</strong>ï¼šç»™ UserClient çš„æŸ¥è¯¢ç”¨æˆ·æ¥å£è®¾ç½®é™çº§è§„åˆ™ï¼Œç»Ÿè®¡æ—¶é—´ä¸º 1 ç§’ï¼Œæœ€å°è¯·æ±‚æ•°é‡ä¸º 5ï¼Œå¤±è´¥é˜ˆå€¼æ¯”ä¾‹ä¸º 0.4ï¼Œç†”æ–­æ—¶é•¿ä¸º 5</p>\n<p>&lt;font color='red'&gt; æç¤º &lt;/font&gt;ï¼šä¸ºäº†è§¦å‘å¼‚å¸¸ç»Ÿè®¡ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ UserService ä¸­çš„ä¸šåŠ¡ï¼ŒæŠ›å‡ºå¼‚å¸¸å¦‚ä¸‹ä»£ç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">queryById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@RequestHeader</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"Truth\"</span><span class=\"token punctuation\">,</span> required <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> truth<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>id <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ•…æ„æŠ›å‡ºå¼‚å¸¸ï¼Œè§¦å‘å¼‚å¸¸æ¯”ä¾‹ç†”æ–­\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"truth: \"</span> <span class=\"token operator\">+</span> truth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token keyword\">return</span> userService<span class=\"token punctuation\">.</span><span class=\"token function\">queryById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç»™ UserClient æŸ¥è¯¢ç”¨æˆ·æ¥å£è®¾ç½®é™çº§è§„åˆ™</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171511550.png\" alt=\"image-20231017151144666\" /></p>\n<p>è®¿é—® order/102</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171512960.png\" alt=\"image-20231017151235103\" /></p>\n<p>ç„¶åè¿ç»­è®¿é—® n æ¬¡ order/101</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171516133.png\" alt=\"image-20231017151605944\" /></p>\n<p>åœ¨è®¿é—® order/102 å°±å‘ç°è¢«ç†”æ–­äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171515798.png\" alt=\"image-20231017151556049\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>Sentinel ç†”æ–­é™çº§çš„ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</p>\n<p>1ã€æ…¢è°ƒç”¨æ¯”ä¾‹ï¼šè¶…è¿‡æŒ‡å®šæ—¶é•¿çš„è°ƒç”¨ä¸ºæ…¢è°ƒç”¨ï¼Œç»Ÿè®¡å•ä½æ—¶é•¿å†…æ…¢è°ƒç”¨çš„æ¯”ä¾‹ï¼Œè¶…è¿‡é˜ˆå€¼åˆ™ç†”æ–­</p>\n<p>2ã€å¼‚å¸¸æ¯”ä¾‹ï¼šç»Ÿè®¡å•ä½æ—¶é•¿å†…å¼‚å¸¸è°ƒç”¨çš„æ¯”ä¾‹ï¼Œè¶…è¿‡é˜ˆå€¼åˆ™ç†”æ–­</p>\n<p>3ã€å¼‚å¸¸æ•°ï¼šç»Ÿè®¡å•ä½æ—¶é•¿å†…å¼‚å¸¸è°ƒç”¨çš„æ¬¡æ•°ï¼Œè¶…è¿‡é˜ˆå€¼åˆ™ç†”æ–­</p>\n</blockquote>\n<h2 id=\"17-æˆæƒè§„åˆ™\"><a class=\"anchor\" href=\"#17-æˆæƒè§„åˆ™\">#</a> 1.7ã€æˆæƒè§„åˆ™ğŸŒ³</h2>\n<ul>\n<li>æˆæƒè§„åˆ™</li>\n<li>è‡ªå®šä¹‰å¼‚å¸¸ç»“æœ</li>\n</ul>\n<h3 id=\"171-æˆæƒè§„åˆ™\"><a class=\"anchor\" href=\"#171-æˆæƒè§„åˆ™\">#</a> 1.7.1ã€æˆæƒè§„åˆ™ğŸŒ²</h3>\n<p>æˆæƒè§„åˆ™å¯ä»¥å¯¹è°ƒç”¨æ–¹çš„æ¥æºåšæ§åˆ¶ï¼Œæœ‰ç™½åå•å’Œé»‘åå•ä¸¤ç§æ–¹å¼ã€‚</p>\n<blockquote>\n<p>æˆ‘ä»¬å­¦ä¹ ç½‘å…³çš„æ—¶å€™è®²è¿‡ï¼Œgateway å®ƒä¸å°±æ˜¯æŠŠé—¨çš„å—ã€‚æ‰€æœ‰è¯·æ±‚éƒ½è¦ç»è¿‡ç½‘å…³å»åšèº«ä»½çš„è®¤è¯ï¼Œæ€ä¹ˆåˆ°è¿™å„¿åˆè¦æ•´ä¸€ä¸ªå‘¢ï¼Ÿ</p>\n<p>ä¸‡ä¸€å…¬å¸å‡ºäº†ä¸€ä¸ªå†…é¬¼ï¼Œå®ƒæŠŠå¾®æœåŠ¡åœ°å€æ³„éœ²ç»™äº†å¤–è¾¹å“ªäº›ä¸æ€€å¥½æ„çš„äººï¼Œé‚£è¿™äº›å“¥ä»¬å°±å¯ä»¥ç»•è¿‡ç½‘å…³ç›´æ¥è®¿é—®å¾®æœåŠ¡äº†ã€‚é‚£ç½‘å…³é‡Œåšçš„å†ä¸¥å¯†ä¹Ÿéƒ½æ²¡ç”¨äº†ï¼Œæ‰€ä»¥ Sentinel æˆæƒè§„åˆ™å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆæƒè§„åˆ™ä¼šå»éªŒè¯ä½ è¯·æ±‚ä»å“ªæ¥çš„ã€‚å¦‚æœè¯´ä½ æ˜¯ä»ç½‘å…³è¿‡æ¥çš„é‚£å°±æ”¾è¡Œï¼Œå¦‚æœè¯´ä½ ä»åˆ«çš„åœ°æ–¹æ¥çš„å°±æ‹¦æˆª</p>\n</blockquote>\n<ul>\n<li>ç™½åå•ï¼šæ¥æº (origin) åœ¨ç™½åå•å†…çš„è°ƒç”¨è€…å…è®¸è®¿é—®</li>\n<li>é»‘åå•ï¼šæ¥æº (origin) åœ¨é»‘åå•å†…çš„è°ƒç”¨è€…ä¸å…è®¸è®¿é—®</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171530129.png\" alt=\"image-20231017153026632\" /></p>\n<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬é™å®šåªå…è®¸ä»ç½‘å…³æ¥çš„è¯·æ±‚è®¿é—® order-serviceï¼Œé‚£ä¹ˆæµæ§åº”ç”¨ä¸­å°±å¡«å†™ç½‘å…³çš„åç§°</p>\n<p>é‚£ä¹ˆè¿™æ—¶</p>\n<p orderId=\"\">èµ„æºåå¡«çš„å°±æ˜¯ï¼šorder-service é‡Œé¢çš„å—ä¿æŠ¤èµ„æºï¼Œæ¯”æ–¹è¯´ order/</p>\n<p>æµæ§åº”ç”¨å¡«çš„å°±æ˜¯ï¼šå…è®¸çš„è°ƒç”¨è€…çš„åå­— originï¼Œè¯·æ±‚æ¥æºåç§°ï¼Œé‚£ä¹ˆè¯·æ±‚æ¥æºåç§°æ˜¯æ€ä¹ˆå¾—åˆ°çš„å‘¢ï¼Ÿ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171531533.png\" alt=\"image-20231017153153844\" /></p>\n<p>Sentinel æ˜¯é€šè¿‡ RequestOriginParser è¿™ä¸ªæ¥å£çš„ parseOrigin æ¥è·å–è¯·æ±‚çš„æ¥æºçš„ã€‚</p>\n<p>ä½†æ˜¯è¿™ä¸ªæ–¹æ³•çš„è¿”å›ç»“æœåªèƒ½æ˜¯ defaultï¼Œä¹Ÿå°±æ˜¯è¯´æ— è®ºæ˜¯ä»ç½‘å…³è¿‡æ¥è¿˜æ˜¯æµè§ˆå™¨è¿‡æ¥å®ƒçš„æ¥æºåç§°éƒ½å« default</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">RequestOriginParser</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   * ä»è¯·æ±‚ request å¯¹è±¡ä¸­è·å– originï¼Œè·å–æ–¹å¼è‡ªå®šä¹‰</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">String</span> <span class=\"token function\">parseOrigin</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¿…é¡»è‡ªå·±æƒ³åŠæ³•å®ç°è¿™ä¸ªæ¥å£ç¼–å†™å®ƒçš„ä¸šåŠ¡é€»è¾‘ï¼Œè®©ä»ç½‘å…³è¿‡æ¥çš„è¯·æ±‚å’Œä»æµè§ˆå™¨è¿‡æ¥çš„è¯·æ±‚è¿”å›ä¸åŒçš„ç»“æœï¼Œè¿™æ ·æ¥æºåç§°ä¸åŒå°±å¯ä»¥ç¼–å†™æˆæƒè§„åˆ™äº†</p>\n<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å°è¯•ä» reqeust ä¸­è·å–ä¸€ä¸ªåä¸º origin çš„è¯·æ±‚å¤´ï¼Œä½œä¸º origin çš„å€¼ï¼š</p>\n<p>è¿™é‡Œ gateway è®¿é—®æ¶ˆè´¹è€…ä¹Ÿå°±æ˜¯ orderservice æœåŠ¡æ‰€ä»¥ä¸‹é¢ä¸šåŠ¡ä»£ç æ˜¯å†™åˆ° order æœåŠ¡ä¸­çš„</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HeaderOriginParser</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">RequestOriginParser</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">parseOrigin</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">// 1. è·å–è¯·æ±‚å¤´</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">String</span> header <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"origin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// 2. éç©ºåˆ¤æ–­</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>header<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            header <span class=\"token operator\">=</span> <span class=\"token string\">\"blank\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">return</span> header<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜éœ€è¦åœ¨ gateway æœåŠ¡ä¸­ï¼Œåˆ©ç”¨ç½‘å…³çš„è¿‡æ»¤å™¨æ·»åŠ åä¸º gateway çš„ origin å¤´</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">default-filters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token punctuation\">-</span> AddRequestHeader=origin<span class=\"token punctuation\">,</span>gateway <span class=\"token comment\"># æ·»åŠ åä¸º origin çš„è¯·æ±‚å¤´ï¼Œå€¼ä¸º gateway</span></pre></td></tr></table></figure><p>é‡å¯ orderservice æœåŠ¡å’Œ gateway æœåŠ¡</p>\n<p>éšä¾¿è®¿é—®ä¸€ä¸ª uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDg4L29yZGVyLzEwMQ==\">http://localhost:8088/order/101</span></p>\n<p>ç„¶åæŸ¥çœ‹ Sentinel æ§åˆ¶å°ä¸­çš„è”Ÿç‚¹é“¾è·¯</p>\n<p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥ç»™ /order/{orderId} é…ç½®æˆæƒè§„åˆ™ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171605527.png\" alt=\"image-20231017160506456\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171605725.png\" alt=\"image-20231017160532751\" /></p>\n<p>æ­¤æ—¶æˆ‘ä»¬å†å»è®¿é—® order/101 æœåŠ¡</p>\n<p>æ³¨æ„ï¼šè¿™é‡Œ order/101 æ˜¯ç»•è¿‡äº†ç½‘å…³çš„</p>\n<p>è®¿é—®æ˜¯ä¸æˆåŠŸçš„ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171605535.png\" alt=\"image-20231017160543084\" /></p>\n<p>é‚£æˆ‘ä»¬ä½¿ç”¨ç½‘å…³è¿›è¡Œè®¿é—®çš„</p>\n<p>å¯ä»¥æ­£å¸¸è®¿é—®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171606887.png\" alt=\"image-20231017160611726\" /></p>\n<p>ä½†æ˜¯ç”±äºä¸Šé¢ç›´æ¥è·³è¿‡ç½‘å…³è®¿é—® order/101 çš„æ—¶å€™å°±ä¼šæŠ¥é”™ï¼Œé¡µé¢çš„æŠ¥é”™æç¤ºå¦‚ä¸‹ï¼š</p>\n<p>è¯´æ˜¯é™æµå¼‚å¸¸è¿™å°±ä¸åˆç†äº†ï¼Œæ˜æ˜æ˜¯æˆæƒå¼‚å¸¸æ€ä¹ˆå°±é™æµå¼‚å¸¸äº†å‘¢</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171609433.png\" alt=\"image-20231017160543084\" /></p>\n<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œè‡ªå®šä¹‰å¼‚å¸¸ï¼š</p>\n<h3 id=\"172-è‡ªå®šä¹‰å¼‚å¸¸ç»“æœ\"><a class=\"anchor\" href=\"#172-è‡ªå®šä¹‰å¼‚å¸¸ç»“æœ\">#</a> 1.7.2ã€è‡ªå®šä¹‰å¼‚å¸¸ç»“æœğŸŒ²</h3>\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘ç”Ÿé™æµï¼Œé™çº§ï¼Œæˆæƒæ‹¦æˆªæ—¶ï¼Œéƒ½ä¼šæŠ›å‡ºå¼‚å¸¸åˆ°è°ƒç”¨æ–¹ã€‚å¦‚æœè¦è‡ªå®šä¹‰å¼‚å¸¸æ—¶çš„è¿”å›ç»“æœï¼Œéœ€è¦å®ç° BlockExceptionHanlder æ¥å£ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">BlockExcpetionHandler</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   * å¤„ç†è¯·æ±‚è¢«é™æµï¼Œé™çº§ï¼Œæˆæƒæ‹¦æˆªæ—¶æŠ›å‡ºçš„å¼‚å¸¸ï¼šBlockException</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BlockExcpetion</span> e<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è€Œ BlockException åŒ…å«å¾ˆå¤šä¸ªå­ç±»ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒçš„åœºæ™¯ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>å¼‚å¸¸</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>FlowException</td>\n<td>é™æµå¼‚å¸¸</td>\n</tr>\n<tr>\n<td>ParamFlowException</td>\n<td>çƒ­ç‚¹å‚æ•°é™æµçš„å¼‚å¸¸</td>\n</tr>\n<tr>\n<td>DegradeException</td>\n<td>é™çº§å¼‚å¸¸</td>\n</tr>\n<tr>\n<td>AuthorityException</td>\n<td>æˆæƒè§„åˆ™å¼‚å¸¸</td>\n</tr>\n<tr>\n<td>SystemBlockException</td>\n<td>ç³»ç»Ÿè§„åˆ™å¼‚å¸¸</td>\n</tr>\n</tbody>\n</table>\n<p>æˆ‘ä»¬åœ¨ order-service ä¸­å®šä¹‰ç±»ï¼Œå®ç° BlockExceptionHandler æ¥å£ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SentinelBlockHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">BlockExceptionHandler</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> httpServletRequest<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BlockException</span> e<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">String</span> msg <span class=\"token operator\">=</span> <span class=\"token string\">\"æœªçŸ¥å¼‚å¸¸\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">int</span> status <span class=\"token operator\">=</span> <span class=\"token number\">429</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>e <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">FlowException</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            msg <span class=\"token operator\">=</span> <span class=\"token string\">\"è¯·æ±‚è¢«é™æµäº† !\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>e <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">DegradeException</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            msg <span class=\"token operator\">=</span> <span class=\"token string\">\"è¯·æ±‚è¢«é™çº§äº† !\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>e <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">ParamFlowException</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            msg <span class=\"token operator\">=</span> <span class=\"token string\">\"çƒ­ç‚¹å‚æ•°é™æµ !\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>e <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">AuthorityException</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            msg <span class=\"token operator\">=</span> <span class=\"token string\">\"è¯·æ±‚æ²¡æœ‰æƒé™ !\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            status <span class=\"token operator\">=</span> <span class=\"token number\">401</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        response<span class=\"token punctuation\">.</span><span class=\"token function\">setContentType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"application/json;charset=utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        response<span class=\"token punctuation\">.</span><span class=\"token function\">setStatus</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        response<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&#123;\\\"message\\\": \\\"\"</span> <span class=\"token operator\">+</span> msg <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\",\\\"status\\\": \"</span> <span class=\"token operator\">+</span> status <span class=\"token operator\">+</span> <span class=\"token string\">\"&#125;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>é‡å¯ orderservice æœåŠ¡ï¼Œç„¶åè®¿é—®ä¸€ä¸‹ order/101ã€‚å†å» Sentinel æ§åˆ¶å°æŸ¥çœ‹è”Ÿç‚¹é“¾è·¯å¹¶æ·»åŠ æˆæƒè§„åˆ™ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171629649.png\" alt=\"image-20231017162948414\" /></p>\n<p>ç„¶åå†å¯¹ order/101 è¿›è¡Œç›´æ¥è®¿é—®</p>\n<p>å¯ä»¥çœ‹åˆ°è‡ªå®šä¹‰å¼‚å¸¸æˆåŠŸäº†ï¼</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171630717.png\" alt=\"image-20231017163007309\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>è·å–è¯·æ±‚æ¥æºçš„æ¥å£æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>RequestOriginParser</li>\n</ul>\n<p>å¤„ç† BlockException çš„æ¥å£æ˜¯ä»€ä¹ˆ</p>\n<ul>\n<li>BlockExcpetionHandler</li>\n</ul>\n</blockquote>\n<h2 id=\"18-è§„åˆ™æŒä¹…åŒ–\"><a class=\"anchor\" href=\"#18-è§„åˆ™æŒä¹…åŒ–\">#</a> 1.8ã€è§„åˆ™æŒä¹…åŒ–ğŸŒ³</h2>\n<ul>\n<li>è§„åˆ™ç®¡ç†æ¨¡å¼</li>\n<li>å®ç° push æ¨¡å¼</li>\n</ul>\n<p>Sentinel çš„æ§åˆ¶å°è§„åˆ™ç®¡ç†æœ‰ä¸‰ç§æ¨¡å¼ï¼š</p>\n<ul>\n<li>åŸå§‹æ¨¡å¼ï¼šSentinel çš„é»˜è®¤æ¨¡å¼ï¼Œå°†è§„åˆ™ä¿å­˜åœ¨å†…å­˜ï¼Œé‡å¯æœåŠ¡ä¼šä¸¢å¤±ã€‚</li>\n<li>pull æ¨¡å¼</li>\n<li>push æ¨¡å¼</li>\n</ul>\n<h3 id=\"181-è§„åˆ™ç®¡ç†æ¨¡å¼-pullæ¨¡å¼\"><a class=\"anchor\" href=\"#181-è§„åˆ™ç®¡ç†æ¨¡å¼-pullæ¨¡å¼\">#</a> 1.8.1ã€è§„åˆ™ç®¡ç†æ¨¡å¼ - pull æ¨¡å¼ğŸŒ²</h3>\n<p>pull æ¨¡å¼ï¼šæ§åˆ¶å°å°†é…ç½®çš„è§„åˆ™æ¨é€åˆ° Sentinel å®¢æˆ·ç«¯ï¼Œè€Œå®¢æˆ·ç«¯ä¼šå°†é…ç½®è§„åˆ™ä¿å­˜åœ¨æœ¬åœ°æ–‡ä»¶æˆ–æ•°æ®åº“ä¸­ã€‚ä»¥åä¼šå®šæ—¶å»æœ¬åœ°æ–‡ä»¶æˆ–æ•°æ®åº“ä¸­æŸ¥è¯¢ï¼Œæ›´æ–°æœ¬åœ°è§„åˆ™ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171635037.png\" alt=\"image-20231017163548813\" /></p>\n<p>ç¼ºç‚¹ï¼šå­˜åœ¨æ—¶æ•ˆæ€§é—®é¢˜ï¼Œä»è€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´é—®é¢˜</p>\n<h3 id=\"182-è§„åˆ™ç®¡ç†æ¨¡å¼-pushæ¨¡å¼\"><a class=\"anchor\" href=\"#182-è§„åˆ™ç®¡ç†æ¨¡å¼-pushæ¨¡å¼\">#</a> 1.8.2ã€è§„åˆ™ç®¡ç†æ¨¡å¼ - push æ¨¡å¼ğŸŒ²</h3>\n<p>push æ¨¡å¼ï¼šæ§åˆ¶å°å°†é…ç½®è§„åˆ™æ¨é€åˆ°è¿œç¨‹é…ç½®ä¸­å¿ƒï¼Œä¾‹å¦‚ Nacosã€‚Sentinel å®¢æˆ·ç«¯ç›‘å¬ Nacosï¼Œè·å–é…ç½®å˜æ›´çš„æ¨é€æ¶ˆæ¯ï¼Œå®Œæˆæœ¬åœ°é…ç½®æ›´æ–°</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171639844.png\" alt=\"image-20231017163912849\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>Sentinel çš„ä¸‰ç§é…ç½®ç®¡ç†æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>\n<p>åŸå§‹æ¨¡å¼ï¼šä¿å­˜åœ¨å†…å­˜</p>\n<p>ä¸æ”¯æŒæŒä¹…åŒ–</p>\n</li>\n<li>\n<p>pull æ¨¡å¼ï¼šä¿å­˜åœ¨æœ¬åœ°æ–‡ä»¶æˆ–æ•°æ®åº“ï¼Œå®šæ—¶å»è¯»å–</p>\n<p>å®šæ—¶è½®è¯¢å­˜åœ¨æ—¶æ•ˆæ€§é—®é¢˜ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´</p>\n</li>\n<li>\n<p>push æ¨¡å¼ï¼šä¿å­˜åœ¨ Nacosï¼Œç›‘å¬å˜æ›´å®æ—¶æ›´æ–°</p>\n</li>\n</ul>\n</blockquote>\n<h3 id=\"183-å®ç°pushæ¨¡å¼\"><a class=\"anchor\" href=\"#183-å®ç°pushæ¨¡å¼\">#</a> 1.8.3ã€å®ç° push æ¨¡å¼ğŸŒ²</h3>\n<p>push æ¨¡å¼å®ç°æœ€ä¸ºå¤æ‚ï¼Œä¾èµ–äº Nacosï¼Œå¹¶ä¸”éœ€è¦ä¿®æ”¹ Sentinel æ§åˆ¶å°æºç ã€‚</p>\n<p>è¯¦ç»†æ­¥éª¤å¯ä»¥å‚è€ƒæ–‡ç« <a href=\"../sentinel%E6%8C%81%E4%B9%85%E5%8C%96/sentinel%E8%A7%84%E5%88%99%E6%8C%81%E4%B9%85%E5%8C%96.md\"> sentinel è§„åˆ™æŒä¹…åŒ–</a>.</p>\n<h1 id=\"äºŒ-åˆ†å¸ƒå¼äº‹åŠ¡\"><a class=\"anchor\" href=\"#äºŒ-åˆ†å¸ƒå¼äº‹åŠ¡\">#</a> äºŒã€åˆ†å¸ƒå¼äº‹åŠ¡ğŸ„</h1>\n<ul>\n<li>seata</li>\n</ul>\n<p><strong>äº‹åŠ¡çš„ ACID åŸåˆ™</strong></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171718973.png\" alt=\"image-20231017171810630\" /></p>\n<h2 id=\"21-åˆ†å¸ƒå¼æœåŠ¡æ¡ˆä¾‹\"><a class=\"anchor\" href=\"#21-åˆ†å¸ƒå¼æœåŠ¡æ¡ˆä¾‹\">#</a> 2.1ã€åˆ†å¸ƒå¼æœåŠ¡æ¡ˆä¾‹ğŸŒ³</h2>\n<p>å¾®æœåŠ¡ä¸‹å•ä¸šåŠ¡ï¼Œåœ¨ä¸‹å•æ—¶ä¼šè°ƒç”¨è®¢å•æœåŠ¡ï¼Œåˆ›å»ºè®¢å•å¹¶å†™å…¥æ•°æ®åº“ã€‚ç„¶åè®¢å•æœåŠ¡è°ƒç”¨è´¦æˆ·æœåŠ¡å’Œåº“å­˜æœåŠ¡ï¼š</p>\n<ul>\n<li>è´¦æˆ·æœåŠ¡è´Ÿè´£æ‰£å‡ç”¨æˆ·ä½™é¢</li>\n<li>åº“å­˜æœåŠ¡è´Ÿè´£æ‰£å‡å•†å“åº“å­˜</li>\n</ul>\n<p>æ¯”æ–¹è¯´ä»¥ä¸‹å¾®æœåŠ¡ï¼šé‡Œé¢åŒ…å«ä¸‰ä¸ªæœåŠ¡ è®¢å•æœåŠ¡ï¼Œè´¦æˆ·æœåŠ¡ï¼Œåº“å­˜æœåŠ¡ã€‚ç°åœ¨æœ‰ä¸€ä¸ªç”¨æˆ·ä¸‹å•çš„ä¸šåŠ¡ï¼Œç”¨æˆ·ä¸‹å•æ—¶æˆ‘å¸Œæœ›è®¢å•æœåŠ¡å»åˆ›å»ºè®¢å•å¹¶ä¸”å†™å…¥æ•°æ®åº“ï¼Œè€Œåå®ƒå†å»è°ƒç”¨è´¦æˆ·æœåŠ¡å’Œåº“å­˜æœåŠ¡ã€‚è´¦æˆ·æœåŠ¡å»æ‰£å‡ç”¨æˆ·çš„ä½™é¢ï¼Œè€Œåº“å­˜æœåŠ¡åˆ™å»æ‰£å‡å•†å“åº“å­˜ã€‚é‡Œé¢å°±åŒ…å«äº†ä¸‰ä¸ªä¸åŒçš„å¾®æœåŠ¡è°ƒç”¨ï¼Œè€Œæ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ•°æ®åº“ï¼Œä¹Ÿå°±æ˜¯ç‹¬ç«‹çš„äº‹åŠ¡ã€‚æœ€ç»ˆå¸Œæœ›çš„è‚¯å®šæ˜¯ä¸‹å•ä¸šåŠ¡ä¸€æ—¦æ‰§è¡Œæ¯ä¸€ä¸ªæœåŠ¡éƒ½è¦æˆåŠŸï¼Œå¦‚æœå¤±è´¥éƒ½å¤±è´¥ã€‚ä½†æ˜¯èƒ½ä¸èƒ½è¾¾åˆ°è¿™æ ·çš„ç»“æœå‘¢ä¸‹é¢è¿›è¡ŒéªŒè¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171720793.png\" alt=\"image-20231017172030706\" /></p>\n<h2 id=\"22-æ¼”ç¤ºåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜\"><a class=\"anchor\" href=\"#22-æ¼”ç¤ºåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜\">#</a> 2.2ã€æ¼”ç¤ºåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ ğŸŒ³</h2>\n<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ï¼Œä¸€ä¸ªä¸šåŠ¡è·¨è¶Šå¤šä¸ªæœåŠ¡æˆ–æ•°æ®æºï¼Œæ¯ä¸ªæœåŠ¡éƒ½æ˜¯ä¸€ä¸ªåˆ†æ”¯äº‹åŠ¡ï¼Œè¦ä¿è¯æ‰€æœ‰åˆ†æ”¯äº‹åŠ¡æœ€ç»ˆçŠ¶æ€ä¸€è‡´è¿™æ ·çš„äº‹åŠ¡å°±æ˜¯ &lt;font color='red'&gt; åˆ†å¸ƒå¼äº‹åŠ¡ &lt;/font&gt;.</p>\n<p>1ã€å¯¼å…¥å¾®æœåŠ¡é¡¹ç›®ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZG91a2FpeGluL3R5cG9yYS5naXQ=\">https://gitee.com/doukaixin/typora.git</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171737590.png\" alt=\"image-20231017173700559\" /></p>\n<p>2ã€åˆ›å»ºæ•°æ®åº“ï¼Œåä¸º seata_demoï¼Œç„¶åå¯¼å…¥ SQL æ–‡ä»¶ï¼Œæ”¹ SQL æ–‡ä»¶åœ¨ seata-demo é¡¹ç›®ä¸­çš„ SQL æ–‡ä»¶å¤¹ä¸­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171737039.png\" alt=\"image-20231017173733114\" /></p>\n<p>3ã€å¯åŠ¨ nacosï¼Œæ‰€æœ‰å¾®æœåŠ¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171955624.png\" alt=\"image-20231017195536248\" /></p>\n<p>4ã€æµ‹è¯•ä¸‹å•åŠŸèƒ½ï¼Œå‘é€ Post è¯·æ±‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171956965.png\" alt=\"image-20231017195605740\" /></p>\n<p>å‘é€è¯·æ±‚åæŸ¥çœ‹æ•°æ®åº“</p>\n<p>è´¦æˆ·è¡¨</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171956775.png\" alt=\"image-20231017195643886\" /></p>\n<p>åº“å­˜è¡¨</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171957799.png\" alt=\"image-20231017195701407\" /></p>\n<p>å¯ä»¥å‘ç°ï¼Œè´¦æˆ·ä½™é¢æ‰£äº† 200 å˜æˆäº† 800ï¼Œè€Œåº“å­˜æ‰£äº† 2 å˜æˆäº† 8</p>\n<p>é‚£ä¹ˆæˆ‘ä»¬è®©æ‰£é™¤åº“å­˜çš„æ—¶å€™æŠ¥é”™çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µã€‚</p>\n<p>ç°åœ¨åº“å­˜ä¸å¤Ÿ 10 ä¸ªäº†æˆ‘è¯·æ±‚æ‰£ 10 ä¸ªå°±ä¼šå‘ç”ŸæŠ¥é”™ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171958176.png\" alt=\"image-20231017195804119\" /></p>\n<p>å¯ä»¥çœ‹åˆ°å“åº”ç»“æœ 500 äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171958776.png\" alt=\"image-20231017195845362\" /></p>\n<p>æ­¤æ—¶æˆ‘ä»¬å†æŸ¥çœ‹æ•°æ®åº“çš„æƒ…å†µ</p>\n<p>è´¦æˆ·è¡¨</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171959625.png\" alt=\"image-20231017195918162\" /></p>\n<p>åº“å­˜è¡¨</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310171959448.png\" alt=\"image-20231017195930412\" /></p>\n<p>è´¦æˆ·è¡¨çš„ä½™é¢è¢«æ‰£äº† 200ï¼Œä½†æ˜¯åº“å­˜è¡¨çš„æ•°é‡å´æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œè¿™æ ·æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ã€‚</p>\n<p>ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸‹è¿™ä»¶äº‹å„¿ã€‚</p>\n<p>åœ¨ä¸Šé¢çš„ä¸šåŠ¡ä¸­ï¼Œè®¢å•æœåŠ¡å»åˆ›å»ºäº†è®¢å•ç„¶åå»è°ƒç”¨äº†è´¦æˆ·æœåŠ¡å’Œåº“å­˜æœåŠ¡å®Œæˆä½™é¢æ‰£å‡å’Œåº“å­˜æ‰£å‡ï¼Œå…¶ä¸­è®¢å•æœåŠ¡å’Œè´¦æˆ·æœåŠ¡éƒ½åˆ›å»ºæˆåŠŸäº†ã€‚è€Œåº“å­˜æœåŠ¡åœ¨æ‰§è¡Œçš„æ—¶å€™å´å› ä¸ºåº“å­˜ä¸è¶³è€Œå¤±è´¥äº†ã€‚é‚£æŒ‰ç…§ç†è®ºä¸Šè®²è¿™é‡ŒæŠ¥é”™å‰é¢éƒ½åº”è¯¥è·Ÿç€å›æ»š</p>\n<p>åŸå› ï¼š</p>\n<p>1ã€æ¯ä¸ªæœåŠ¡éƒ½æ˜¯ç‹¬ç«‹çš„åº“å­˜æœåŠ¡æŠ›å‡ºå¼‚å¸¸å…¶å®ƒæœåŠ¡ä¹Ÿä¸çŸ¥é“</p>\n<p>2ã€æ¯ä¸ªæœåŠ¡éƒ½æ˜¯ç‹¬ç«‹çš„æ‰€ä»¥å®ƒä»¬çš„äº‹åŠ¡ä¹Ÿæ˜¯ç‹¬ç«‹çš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310172023838.png\" alt=\"image-20231017202319388\" /></p>\n<p>å¦‚æœè¦è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„é—®é¢˜ï¼Œé¦–å…ˆè¦è€ƒè™‘å››ç‚¹ï¼š</p>\n<p>é¦–å…ˆç¬¬ä¸€ç‚¹ï¼šåˆ†å¸ƒå¼äº‹åŠ¡äº§ç”Ÿçš„åŸå› ï¼Œè¿™ä¸ªä¸Šè¿°åˆ†æè¿‡äº†ã€‚</p>\n<p>ç¬¬äºŒç‚¹ï¼šç†è§£ç†è®ºåŸºç¡€</p>\n<p>ç¬¬ä¸‰ç‚¹ï¼šå¼„æ¸… seata åŸç†</p>\n<p>ç¬¬å››ç‚¹ï¼šåˆ©ç”¨ seata æ‰‹åŠ¨å®è·µï¼Œè§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310172032081.png\" alt=\"image-20231017203228913\" /></p>\n<p>å­¦ä¹ å†…å®¹ï¼š</p>\n<ul>\n<li>ç†è®ºåŸºç¡€</li>\n<li>åˆå§‹ Seata</li>\n<li>æ‰‹åŠ¨å®è·µ</li>\n<li>é«˜å¯ç”¨</li>\n</ul>\n<h2 id=\"23-ç†è®ºåŸºç¡€\"><a class=\"anchor\" href=\"#23-ç†è®ºåŸºç¡€\">#</a> 2.3ã€ç†è®ºåŸºç¡€ğŸŒ³</h2>\n<ul>\n<li>CAP å®šç†</li>\n<li>BASE ç†è®º</li>\n</ul>\n<h3 id=\"231-capå®šç†\"><a class=\"anchor\" href=\"#231-capå®šç†\">#</a> 2.3.1ã€CAP å®šç†ğŸŒ²</h3>\n<p>1998 å¹´ï¼ŒåŠ å·å¤§å­¦çš„è®¡ç®—æœºç§‘å­¦ Eric Brewer æå‡ºï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿæœ‰ä¸‰ä¸ªæŒ‡æ ‡ï¼š</p>\n<p>1ã€Consistency (ä¸€è‡´æ€§)</p>\n<p>2ã€Availability (å¯ç”¨æ€§)</p>\n<p>3ã€Partition tolerance (åˆ†åŒºå®¹é”™æ€§)</p>\n<p>Eric Brewer è¯´ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿæ— æ³•åŒæ—¶æ»¡è¶³è¿™ä¸‰ä¸ªæŒ‡æ ‡ã€‚</p>\n<p>è¿™ä¸ªç»“è®ºå°±å«åš CAP å®šç†ã€‚</p>\n<p>ä¸‰ä¸ªåœ†ä¸ä¼šåŒæ—¶é‡å ï¼Œæœ€å¤šä¸¤ä¸¤é‡å ï¼Œä¹Ÿå°±æ˜¯è¯´åŒæ—¶æ»¡è¶³ä¸¤ä¸ª</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310172037268.png\" alt=\"image-20231017203753986\" /></p>\n<h4 id=\"2311-capå®šç†-consistency\"><a class=\"anchor\" href=\"#2311-capå®šç†-consistency\">#</a> 2.3.1.1ã€CAP å®šç† - ConsistencyğŸŒ´</h4>\n<p>Consistency (ä¸€è‡´æ€§) ï¼šç”¨æˆ·è®¿é—®åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä»»æ„èŠ‚ç‚¹ï¼Œå¾—åˆ°çš„æ•°æ®å¿…é¡»ä¸€è‡´</p>\n<p>æ¯”æ–¹è¯´æœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸Šæœ‰ä¸ªæ•°æ®å« data å€¼ä¸º 0ï¼Œç¬¬äºŒä¸ªèŠ‚ç‚¹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ç°åœ¨ç”¨æˆ·ä¸ç®¡æ˜¯è®¿é—®å“ªä¸ªèŠ‚ç‚¹ï¼Œç»“æœéƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310172043065.png\" alt=\"image-20231017204312228\" /></p>\n<p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘å¯¹èŠ‚ç‚¹ node1 çš„æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œè¿™æ—¶ä¸¤ä¸ªèŠ‚ç‚¹çš„æ•°æ®å°±ä¸ä¸€æ ·äº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310172044702.png\" alt=\"image-20231017204437374\" /></p>\n<p>ä¸ºäº†æ»¡è¶³ä¸€è‡´æ€§å°±ä¸€å®šè¦æŠŠ node1 çš„æ•°æ®åŒæ­¥åˆ° node2 ä¸­ï¼Œä¸€æ—¦æ•°æ®åŒæ­¥å®Œæˆï¼Œæ•°æ®å°±å†æ­¤ä¸€è‡´äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310172044179.png\" alt=\"image-20231017204454104\" /></p>\n<p>æ‰€ä»¥ï¼Œä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨åšæ•°æ®å¤‡ä»½çš„æ—¶å€™ä¸€å®šè¦åŠæ—¶å®Œæˆæ•°æ®åŒæ­¥è¿™æ ·æ‰èƒ½æ»¡è¶³ä¸€è‡´æ€§</p>\n<h4 id=\"2312-capå®šç†-availability\"><a class=\"anchor\" href=\"#2312-capå®šç†-availability\">#</a> 2.3.1.2ã€CAP å®šç† - AvailabilityğŸŒ´</h4>\n<p>Availability (å¯ç”¨æ€§) ï¼šç”¨æˆ·è®¿é—®é›†ç¾¤ä¸­çš„ä»»æ„å¥åº·èŠ‚ç‚¹ï¼Œå¿…é¡»èƒ½å¾—åˆ°å“åº”ï¼Œè€Œä¸æ˜¯è¶…æ—¶æˆ–æ‹’ç»</p>\n<p>æ¯”å¦‚è¯´ node3 çš„è¯·æ±‚è¢«é˜»å¡æˆ–è€…æ‹’ç»äº†ï¼Œé‚£æ‰€æœ‰çš„è¯·æ±‚è¿›æ¥æ— æ³•è®¿é—®äº†ï¼Œè¿™æ—¶ node3 å°±æ˜¯ä¸å¯ç”¨äº†</p>\n<p>æ‰€ä»¥å¯ç”¨æ€§æ˜¯æŒ‡è¿™ä¸ªèŠ‚ç‚¹èƒ½ä¸èƒ½è¢«æ­£å¸¸çš„è®¿é—®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310172048465.png\" alt=\"image-20231017204818409\" /></p>\n<h4 id=\"2313-capå®šç†-partition-tolerance\"><a class=\"anchor\" href=\"#2313-capå®šç†-partition-tolerance\">#</a> 2.3.1.3ã€CAP å®šç† - Partition toleranceğŸŒ´</h4>\n<p>Partition (åˆ†åŒº) ï¼šå› ä¸ºç½‘ç»œæ•…éšœæˆ–å…¶å®ƒåŸå› å¯¼è‡´åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„éƒ¨åˆ†èŠ‚ç‚¹ä¸å…¶å®ƒèŠ‚ç‚¹å¤±å»è¿æ¥ï¼Œå½¢æˆç‹¬ç«‹åˆ†åŒºã€‚</p>\n<p>Tolerance (å®¹é”™) ï¼šåœ¨é›†ç¾¤å‡ºç°åˆ†åŒºæ—¶ï¼Œæ•´ä¸ªç³»ç»Ÿä¹Ÿè¦æŒç»­å¯¹å¤–æä¾›æœåŠ¡</p>\n<p>æ¯”å¦‚è¯´ node3 å› ä¸ºç½‘ç»œæ•…éšœä¸ node1 ä¸ node2 æ–­å¼€äº†è¿æ¥ã€‚node1 ä¸ node2 ä¹‹é—´æ­£å¸¸è®¿é—®ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310172052718.png\" alt=\"image-20231017205201677\" /></p>\n<p>æ­¤æ—¶æ•´ä¸ªé›†ç¾¤å°±ä¼šè¢«åˆ’åˆ†æˆä¸¤ä¸ªåŒºäº†ã€‚node1 å’Œ node2 å®ƒä¿©æ˜¯ä¸€ä¸ªåŒºï¼Œnode3 è‡ªå·±æ˜¯ä¸€ä¸ªåŒºï¼Œè¿™æ—¶å¦‚æœæœ‰ç”¨æˆ·å‘ node2 å†™å…¥äº†ä¸€ä¸ªæ•°æ®ï¼Œnode2 å¯ä»¥æŠŠæ•°æ®åŒæ­¥ç»™ node1 çš„ä½†æ˜¯ node3 ä¸Šä¸èƒ½åŒæ­¥åˆ°æ•°æ®ï¼Œå› æ­¤è¿™ä¸¤ä¸ªåŒºçš„æ•°æ®å°±ä¸ä¸€è‡´äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310172055775.png\" alt=\"image-20231017205544452\" /></p>\n<p>é‚£å¦‚æœæˆ‘ä¸€å®šè¦æ»¡è¶³æ•°æ®çš„ä¸€è‡´æ€§å‘¢ï¼Œé‚£æˆ‘æ˜¯ä¸æ˜¯å¯ä»¥è®© node3 ç­‰å¾… node2 ç½‘ç»œçš„æ¢å¤å’Œæ•°æ®çš„åŒæ­¥ï¼Œåœ¨æ¢å¤ä¹‹å‰æ‰€æœ‰æ¥è®¿é—®æˆ‘çš„è¯·æ±‚æˆ‘éƒ½é˜»å¡åœ¨è¿™é‡Œã€‚å¦‚æœè¿™ä¹ˆåšå¯èƒ½ä¼šæ»¡è¶³æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä½†æ˜¯ node3 æ˜æ˜æ˜¯ä¸€ä¸ªå¥åº·çš„èŠ‚ç‚¹ç»“æœè¿›æ¥çš„è¯·æ±‚ä½ éƒ½å¡åœ¨è¿™é‡Œä¸è®©äººå®¶è®¿é—®ï¼Œé‚£ node3 ä¸å°±æ˜¯ä¸å¯ç”¨äº†å—ï¼Œæ‰€ä»¥å®ƒå°±ä¸æ»¡è¶³ å¯ç”¨æ€§äº†ã€‚</p>\n<p>æˆ‘è¦æƒ³æ»¡è¶³å¯ç”¨æ€§ï¼Œæˆ‘å°±æ²¡åŠæ³•ä¿è¯ä¸€è‡´æ€§ã€‚</p>\n<p>æˆ‘è¦ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œæˆ‘å°±æ²¡åŠæ³•è®© node3 æ˜¯å¯ç”¨æ€§çš„</p>\n<p>å½“ç½‘ç»œå‡ºç°åˆ†åŒºæ—¶ï¼Œå¯ç”¨æ€§å’Œä¸€è‡´æ€§æ²¡æœ‰åŠæ³•åŒæ—¶æ»¡è¶³ã€‚ä½†æ˜¯ç½‘ç»œåˆ†åŒºä¹Ÿæ˜¯ä¸å¯é¿å…çš„ã€‚</p>\n<p>å½“ p ä¸€å®šè¦å®ç°ï¼Œé‚£ä¹ˆè¿™æ—¶ c å’Œ a ä¹‹é—´å°±è¦åšå‡ºæŠ‰æ‹©äº†ã€‚è¦ä¹ˆ c è¦ä¹ˆ a æ²¡æœ‰åŠæ³•åŒæ—¶æ»¡è¶³ã€‚è¿™å°±æ˜¯ CAP å®šç†äº†çš„åŸå› äº†</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>ç®€è¿° CAP å®šç†å†…å®¹ï¼Ÿ</p>\n<ul>\n<li>åˆ†å¸ƒå¼ç³»ç»ŸèŠ‚ç‚¹é€šè¿‡ç½‘ç»œè¿æ¥ï¼Œä¸€å®šä¼šå‡ºç°åˆ†åŒºé—®é¢˜ (P)</li>\n<li>å½“åˆ†åŒºå‡ºç°æ—¶ï¼Œç³»ç»Ÿçš„ä¸€è‡´æ€§ (C) å’Œå¯ç”¨æ€§ (A) å°±æ— æ³•åŒæ—¶æ»¡è¶³</li>\n</ul>\n<p>æ€è€ƒï¼šelasticsearch é›†ç¾¤æ˜¯ CP è¿˜æ˜¯ APï¼Ÿ</p>\n<p>ç­”ï¼šES é›†ç¾¤å½“ç½‘ç»œå‡ºç°æ•…éšœæ—¶ï¼Œæœ‰èŠ‚ç‚¹ä¸å…¶å®ƒèŠ‚ç‚¹æ–­å¼€è¿æ¥çš„æ—¶å€™ã€‚es é›†ç¾¤å¤„äºä¸€ä¸ªè­¦å‘ŠçŠ¶æ€ï¼Œå‡ºç°æ•…éšœçš„èŠ‚ç‚¹è¿‡äº†ä¸€æ®µæ—¶é—´åå°±ä¼šä»é›†ç¾¤ä¸­å‰”é™¤ï¼Œè€Œè¿™ä¸ªèŠ‚ç‚¹ä¸ŠåŸæ¥çš„æ•°æ®åˆ†ç‰‡ã€‚ä¼šåˆ†æ•£åˆ°å…¶å®ƒå¥åº·çš„èŠ‚ç‚¹ä¸Šï¼Œè€Œæ•…éšœèŠ‚ç‚¹ä»é›†ç¾¤ä¸­å‰”é™¤ç”¨æˆ·æ— æ³•è®¿é—®äº†å› æ­¤å°±ç‰ºç‰²äº† å¯ç”¨æ€§äº†ã€‚è€Œæ•°æ®ä¼šè´Ÿè´£å…¶å®ƒèŠ‚ç‚¹æ•°æ®åŒæ­¥å¯ä»¥æ­£å¸¸è¿›è¡Œä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p>\n<p>å› æ­¤ es é›†ç¾¤æ˜¾ç„¶æ˜¯ä¸€ä¸ª CPã€‚æ»¡è¶³é«˜ä¸€è‡´æ€§ä½å¯ç”¨æ€§</p>\n</blockquote>\n<p>æˆ‘ä»¬çŸ¥é“åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ç½‘ç»œåˆ†åŒºæ˜¯ä¸å¯é¿å…çš„ï¼Œæ‰€ä»¥ä¸å¾—ä¸åœ¨ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ä¹‹é—´åšå‡ºä¸€ä¸ªé€‰æ‹©ã€‚</p>\n<p>ä½†æ˜¯è¿™ä¸¤ä¸ªç‰¹æ€§éƒ½å¾ˆé‡è¦æˆ‘ä¸€ä¸ªéƒ½ä¸æƒ³æ”¾å¼ƒæˆ‘è¯¥æ€ä¹ˆåŠå‘¢ï¼ŸBase ç†è®ºæ­£å¥½å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜</p>\n<h3 id=\"232-baseç†è®º\"><a class=\"anchor\" href=\"#232-baseç†è®º\">#</a> 2.3.2ã€BASE ç†è®ºğŸŒ²</h3>\n<p>BASE ç†è®ºæ˜¯å¯¹ CAP çš„ä¸€ç§è§£å†³æ€è·¯ï¼ŒåŒ…å«ä¸‰ä¸ªæ€æƒ³ï¼š</p>\n<ul>\n<li>Basically Available (åŸºæœ¬å¯ç”¨)ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœæ—¶ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼Œå³ä¿è¯æ ¸å¿ƒå¯ç”¨ã€‚</li>\n<li>Soft State (è½¯çŠ¶æ€)ï¼šåœ¨ä¸€å®šæ—¶é—´å†…ï¼Œå…è®¸å‡ºç°ä¸­é—´çŠ¶æ€ï¼Œæ¯”å¦‚ä¸´æ—¶çš„ä¸ä¸€è‡´çŠ¶æ€ã€‚</li>\n<li>Eventually Consistent (æœ€ç»ˆä¸€è‡´æ€§)ï¼šè™½ç„¶æ— æ³•ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œä½†æ˜¯åœ¨è½¯çŠ¶æ€ç»“æŸåï¼Œæœ€ç»ˆè¾¾åˆ°æ•°æ®ä¸€è‡´ã€‚</li>\n</ul>\n<p>è€Œåˆ†å¸ƒå¼äº‹åŠ¡æœ€å¤§çš„é—®é¢˜æ˜¯å„ä¸ªå­äº‹åŠ¡çš„ä¸€è‡´æ€§é—®é¢˜ï¼Œå› æ­¤å¯ä»¥å€Ÿç­¾ CAP å®šç†çš„ BASE ç†è®ºï¼š</p>\n<ul>\n<li>AP æ¨¡å¼ï¼šå„å­äº‹åŠ¡åˆ†åˆ«æ‰§è¡Œå’Œæäº¤ï¼Œå…è®¸å‡ºç°ç»“æœä¸ä¸€è‡´ï¼Œç„¶åé‡‡ç”¨å¼¥è¡¥æªæ–½æ¢å¤æ•°æ®å³å¯ï¼Œå®ç° &lt;font color='red'&gt; æœ€ç»ˆä¸€è‡´ &lt;/font&gt;.</li>\n<li>CP æ¨¡å¼ï¼šå„ä¸ªå­äº‹åŠ¡æ‰§è¡Œåäº’ç›¸ç­‰å¾…ï¼ŒåŒæ—¶æäº¤ï¼ŒåŒæ—¶å›æ»šï¼Œè¾¾æˆ &lt;font color='red'&gt; å¼ºä¸€è‡´ &lt;/font&gt;ã€‚ä½†äº‹åŠ¡ç­‰å¾…è¿‡ç¨‹ä¸­ï¼Œå¤„äºå¼±å¯ç”¨çŠ¶æ€ã€‚</li>\n</ul>\n<h4 id=\"2321-åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹\"><a class=\"anchor\" href=\"#2321-åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹\">#</a> 2.3.2.1ã€åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹ğŸŒ´</h4>\n<p>è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå„ä¸ªå­ç³»ç»Ÿä¹‹é—´å¿…é¡»èƒ½æ„ŸçŸ¥åˆ°å½¼æ­¤çš„äº‹åŠ¡çŠ¶æ€ï¼Œæ‰èƒ½ä¿è¯çŠ¶æ€ä¸€è‡´ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªäº‹åŠ¡åè°ƒè€…æ¥åè°ƒæ¯ä¸€ä¸ªäº‹åŠ¡çš„å‚ä¸è€… (å­ç³»ç»Ÿäº‹åŠ¡)ã€‚</p>\n<p>ç”¨æˆ·ä¸‹å•è°ƒç”¨è®¢å•æœåŠ¡ï¼Œç„¶åå»è°ƒç”¨è´¦æˆ·æœåŠ¡å’Œåº“å­˜æœåŠ¡ã€‚é‚£è¿™ä¸ªåœ°æ–¹æˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªäº‹åŠ¡çš„åè°ƒè€…äº†ï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½è·Ÿäº‹åŠ¡åè°ƒè€…ä¿æŒè”ç³»ï¼Œå¦‚æœä½ ç°åœ¨è¦åšå¼ºä¸€è‡´ã€‚è®¢å•æœåŠ¡æ‰§è¡Œçš„æ—¶å€™ä¸è¦æäº¤ï¼Œæ‰£æ¬¾æœåŠ¡ï¼Œæ‰£åº“å­˜æœåŠ¡ï¼Œä½†æ˜¯åº“å­˜æœåŠ¡æ‰§è¡Œå®Œåå‘ç°å¤±è´¥äº†ã€‚æ€ä¹ˆçŸ¥é“çš„ã€‚å®ƒä»¬è¦æŠŠè‡ªå·±çš„æ‰§è¡Œç»“æœå‘ŠçŸ¥ç»™åè°ƒè€…ï¼Œç„¶ååè°ƒè€…ä¸€çœ‹æœ‰äººå¤±è´¥äº†å°†æ¥å†é€šçŸ¥å…¶å®ƒæœåŠ¡è®©å®ƒä»¬åšå›æ»šï¼Œè¿™æ ·å¤§å®¶å°±èƒ½ä¿æŒä¸€è‡´äº†</p>\n<p>æ¯ä¸€ä¸ªäº‹åŠ¡çš„å‚ä¸è€… (å­ç³»ç»Ÿäº‹åŠ¡)ã€‚</p>\n<p>è¿™é‡Œçš„å­ç³»ç»Ÿäº‹åŠ¡ï¼Œç§°ä¸º &lt;font color='red'&gt; åˆ†æ”¯äº‹åŠ¡ &lt;/font&gt;.ï¼›æœ‰å…³è”çš„å„ä¸ªåˆ†æ”¯äº‹åŠ¡ åœ¨ä¸€èµ·ç§°ä¸º &lt;font color='red'&gt; å…¨å±€äº‹åŠ¡ &lt;/font&gt;.</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310172141933.png\" alt=\"image-20231017214146879\" /></p>\n<p>æ‰€ä»¥äº‹åŠ¡åè°ƒè€…ï¼Œå°±æ˜¯å»åè°ƒå„ä¸ªåˆ†æ”¯äº‹ç‰©çš„çŠ¶æ€è®©å®ƒä»¬è¾¾æˆä¸€è‡´</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>ç®€è¿° BASE ç†è®ºä¸‰ä¸ªæ€æƒ³ï¼š</p>\n<ol>\n<li>åŸºæœ¬å¯ç”¨</li>\n<li>è½¯çŠ¶æ€</li>\n<li>æœ€ç»ˆä¸€è‡´</li>\n</ol>\n<p>è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„æ€æƒ³å’Œæ¨¡å‹ï¼š</p>\n<ol>\n<li>å…¨å±€äº‹åŠ¡ï¼šæ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡</li>\n<li>åˆ†æ”¯äº‹åŠ¡ï¼šåˆ†å¸ƒå¼äº‹åŠ¡ä¸­åŒ…å«çš„æ¯ä¸ªå­ç³»ç»Ÿçš„äº‹åŠ¡</li>\n<li>æœ€ç»ˆä¸€è‡´æ€æƒ³ï¼šå„åˆ†æ”¯äº‹åŠ¡åˆ†åˆ«æ‰§è¡Œå¹¶æäº¤ï¼Œå¦‚æœæœ‰ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå†æƒ³åŠæ³•æ¢å¤æ•°æ®</li>\n<li>å¼ºä¸€è‡´æ€æƒ³ï¼šå„åˆ†æ”¯äº‹åŠ¡æ‰§è¡Œå®Œä¸šåŠ¡ä¸è¦æäº¤ï¼Œç­‰å¾…å½¼æ­¤ç»“æœã€‚è€Œåç»Ÿä¸€æäº¤æˆ–å›æ»š</li>\n</ol>\n</blockquote>\n<h2 id=\"24-åˆå§‹seata\"><a class=\"anchor\" href=\"#24-åˆå§‹seata\">#</a> 2.4ã€åˆå§‹ SeatağŸŒ³</h2>\n<ul>\n<li>Seata çš„æ¶æ„</li>\n<li>éƒ¨ç½² TC æœåŠ¡</li>\n<li>å¾®æœåŠ¡é›†æˆ Seata</li>\n</ul>\n<p>Seata æ˜¯ 2019 å¹´ 1 æœˆä»½èš‚èšé‡‘æœå’Œé˜¿é‡Œå·´å·´å…±åŒå¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚è‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ï¼Œä¸ºç”¨æˆ·æ‰“é€ ä¸€ç«™å¼çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆã€‚</p>\n<p>å®˜ç½‘åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWF0YS5pby96aC1jbi8=\">https://seata.io/zh-cn/</span></p>\n<p><strong>Seata äº‹åŠ¡ç®¡ç†ä¸­æœ‰ä¸‰ä¸ªé‡è¦çš„è§’è‰²</strong>ï¼š</p>\n<p>1ã€TC (Transaction Coordinator) - äº‹åŠ¡åè°ƒè€…ï¼šç»´æŠ¤å…¨å±€å’Œåˆ†å¸ƒå¼äº‹åŠ¡çš„çŠ¶æ€ï¼Œåè°ƒå…¨å±€äº‹åŠ¡æäº¤å’Œå›æ»šã€‚</p>\n<p>2ã€TM (Transaction Manager) - äº‹åŠ¡ç®¡ç†å™¨ï¼šå®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ï¼Œå¼€å§‹å…¨å±€äº‹åŠ¡ï¼Œæäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚</p>\n<p>3ã€RM (Resource Manager) - èµ„æºç®¡ç†å™¨ï¼šç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸ TC äº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310180745437.png\" alt=\"image-20231018074554248\" /></p>\n<p>Seata æ ¹æ®è¦åšå¼ºä¸€è‡´è¿˜æ˜¯æœ€ç»ˆä¸€è‡´åˆå»¶ä¼¸å‡ºäº†å¥½å‡ ç§ä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼š</p>\n<p><strong>Seata æä¾›äº†å››ä¸ªä¸åŒçš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>\n<p>1ã€XA æ¨¡å¼ï¼šå¼ºä¸€è‡´æ€§åˆ†é˜¶æ®µäº‹åŠ¡æ¨¡å¼ï¼Œç‰ºç‰²äº†ä¸€å®šçš„å¯ç”¨æ€§ï¼Œæ— ä¸šåŠ¡ä¾µå…¥</p>\n<p>2ã€TCC æ¨¡å¼ï¼šæœ€ç»ˆä¸€è‡´çš„åˆ†é˜¶æ®µäº‹åŠ¡æ¨¡å¼ï¼Œæœ‰ä¸šåŠ¡ä¾µå…¥</p>\n<p>3ã€AT æ¨¡å¼ï¼šæœ€ç»ˆä¸€è‡´çš„åˆ†é˜¶æ®µäº‹åŠ¡æ¨¡å¼ï¼Œæ— ä¸šåŠ¡ä¾µå…¥ï¼Œä¹Ÿæ˜¯ Seata çš„é»˜è®¤æ¨¡å¼</p>\n<p>4ã€SAGA æ¨¡å¼ï¼šé•¿äº‹åŠ¡æ¨¡å¼ï¼Œæœ‰ä¸šåŠ¡ä¾µå…¥</p>\n<h3 id=\"241-éƒ¨ç½²tcæœåŠ¡\"><a class=\"anchor\" href=\"#241-éƒ¨ç½²tcæœåŠ¡\">#</a> 2.4.1ã€éƒ¨ç½² TC æœåŠ¡ğŸŒ²</h3>\n<p>å‚è€ƒæ–‡ç« ï¼š<a href=\"../Seata/seata%E7%9A%84%E9%83%A8%E7%BD%B2%E5%92%8C%E9%9B%86%E6%88%90.md\">seata çš„éƒ¨ç½²å’Œé›†æˆ</a>.</p>\n<h3 id=\"242-æ‰‹åŠ¨å®è·µ\"><a class=\"anchor\" href=\"#242-æ‰‹åŠ¨å®è·µ\">#</a> 2.4.2ã€æ‰‹åŠ¨å®è·µğŸŒ²</h3>\n<ul>\n<li>XA æ¨¡å¼</li>\n<li>AT æ¨¡å¼</li>\n<li>TCC æ¨¡å¼</li>\n<li>SAGA æ¨¡å¼</li>\n</ul>\n<h4 id=\"2421-xaæ¨¡å¼åŸç†\"><a class=\"anchor\" href=\"#2421-xaæ¨¡å¼åŸç†\">#</a> 2.4.2.1ã€XA æ¨¡å¼åŸç†ğŸŒ´</h4>\n<p>XA è§„åˆ™ æ˜¯ X/Open ç»„ç»‡å®šä¹‰çš„åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç† (DTPï¼ŒDistributed Transaction Processing) æ ‡å‡†ï¼ŒXA è§„èŒƒ æè¿°äº†å…¨å±€çš„ TM ä¸å±€éƒ¨çš„ RM ä¹‹é—´çš„æ¥å£ï¼Œå‡ ä¹æ‰€æœ‰ä¸»æµçš„æ•°æ®åº“éƒ½å¯¹ XA è§„èŒƒ æä¾›äº†æ”¯æŒã€‚</p>\n<p>è¿™ç§æ¨¡å¼ï¼Œå®ƒæŠŠåˆ†å¸ƒå¼äº‹åŠ¡å®šä¹‰æˆäº†ä¸¤ä¸ªé˜¶æ®µã€‚ç¬¬ä¸€é˜¶æ®µä¸º â€œå‡†å¤‡é˜¶æ®µâ€ åœ¨æ­¤é˜¶æ®µä¸­å®ç‰©åè°ƒè€…ä¼šå‘äº‹åŠ¡å‚ä¸è€… (RM) å»å‘èµ·ä¸€ä¸ªå‡†å¤‡çš„è¯·æ±‚ï¼Œåœ¨ä¸Šé¢è®²è¿°ä¸­ RM æ˜¯èµ„æºç®¡ç†å™¨ï¼Œä½†æ˜¯åœ¨ XA æ ‡å‡†ä¸­è¿™ä¸ª RM å…¶å®éƒ½æ˜¯ç”±æ•°æ®åŒºå®ç°çš„ã€‚ä¹Ÿå°±æ˜¯è¯´æ•°æ®åº“æœ¬èº«å®ç°äº† RM åŠŸèƒ½ã€‚äº‹åŠ¡åè°ƒè€…é€šçŸ¥è¿™äº›æ•°æ®åº“å»æ‰§è¡Œè‡ªå·±çš„ä¸šåŠ¡ï¼Œä½†æ˜¯æ‰§è¡Œå®Œä¸è¦æäº¤ï¼Œç„¶åæŠŠæ‰§è¡Œç»“æœå‘ŠçŸ¥äº‹åŠ¡åè°ƒè€…</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181016731.png\" alt=\"Snipaste_2023-10-18_10-16-42\" /></p>\n<p>ç„¶åè¿›è¡Œ â€œç¬¬äºŒé˜¶æ®µâ€ äº‹åŠ¡åè°ƒè€…é€šçŸ¥ RM å¯ä»¥æäº¤äº†ã€‚äº‹åŠ¡ç»“æŸ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181017816.png\" alt=\"image-20231018101741714\" /></p>\n<p>å¦‚æœ ç¬¬ä¸€é˜¶æ®µ æœ‰ä»»æ„ä¸€ä¸ªæœåŠ¡å¤±è´¥äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181018842.png\" alt=\"image-20231018101839751\" /></p>\n<p>é‚£ä¹ˆç¬¬äºŒé˜¶æ®µï¼Œäº‹åŠ¡åè°ƒè€…å°±ä¼šé€šçŸ¥æ‰€æœ‰çš„ RM è¿›è¡Œå›æ»š</p>\n<p>XA æ¨¡å¼ï¼Œå…¶å®å°±æ˜¯åŸºäºæ•°æ®åº“æœ¬èº«çš„ç‰¹æ€§å»å®ç°çš„ä¸€ç§åˆ†å¸ƒå¼äº‹åŠ¡</p>\n<h4 id=\"2422-seataçš„xaæ¨¡å¼\"><a class=\"anchor\" href=\"#2422-seataçš„xaæ¨¡å¼\">#</a> 2.4.2.2ã€seata çš„ XA æ¨¡å¼ğŸŒ´</h4>\n<p>seata çš„ XA æ¨¡å¼åšäº†ä¸€äº›è°ƒæ•´ï¼Œä½†å¤§ä½“ç›¸ä¼¼ï¼š</p>\n<p>TM æ³¨å†Œå…¨å±€äº‹åŠ¡ï¼ŒTM ä½œä¸ºåˆ†å¸ƒå¼å…¥å£è‡ªç„¶å»è°ƒç”¨å¾®æœåŠ¡ï¼Œè°ƒç”¨å¾®æœåŠ¡é‡Œé¢çš„ RM æ‹¦æˆªè¯·æ±‚ï¼Œseata é‡Œé¢ä¹Ÿå®ç°äº† RMï¼Œæ•°æ®åº“ä¹Ÿæœ‰ RMï¼Œåœ¨è¿™ä¸ªæƒ…å†µä¸‹ seata çš„ RM ä»…ä»…æ˜¯ä»£ç†ä½ çš„è¯·æ±‚ã€‚ç„¶ååšä¸€ä¸‹åˆ†æ”¯äº‹åŠ¡çš„æ³¨å†Œï¼Œæ¥ä¸‹æ¥çš„äº‹å°±æ˜¯ç›´æ¥è°ƒç”¨æ•°æ®åº“äº†æ‰§è¡Œä¸šåŠ¡ SQLï¼Œä½†æ˜¯æ‰§è¡Œå®Œä¸æäº¤ï¼Œå»æŠ¥å‘Šä¸€ä¸‹äº‹åŠ¡çš„çŠ¶æ€åˆ° TC å°±è¡Œäº†ã€‚æ‰€ä»¥ TC æ­¤æ—¶å°±å†²å½“äº†äº‹åŠ¡åè°ƒçš„ä½œç”¨äº†</p>\n<p>è‡³æ­¤ï¼Œç¬¬ä¸€é˜¶æ®µç»“æŸ</p>\n<p>ç¬¬äºŒé˜¶æ®µ TM å‘ç°ä¸šåŠ¡ç»“æŸäº†å°±å»é€šçŸ¥ TCï¼Œç„¶å TC å»æ£€æŸ¥äº‹åŠ¡çš„çŠ¶æ€ï¼Œéƒ½æˆåŠŸå°±æˆåŠŸã€‚æœ‰ä¸€ä¸ªå¤±è´¥å°±è¦å›æ»š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181126968.png\" alt=\"image-20231018112632854\" /></p>\n<p>å¦‚æœæˆ‘ä»¬åªçœ‹æ ¸å¿ƒéƒ¨åˆ†å°±å’Œ XA æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„åŒºåˆ«äº†</p>\n<p><strong>RM ä¸€é˜¶æ®µçš„å·¥ä½œ</strong>ï¼š</p>\n<p>1ã€æ³¨å†Œåˆ†æ”¯å®ç‰©åˆ° TC</p>\n<p>2ã€æ‰§è¡Œåˆ†æ”¯ä¸šåŠ¡ sql ä½†ä¸æäº¤</p>\n<p>3ã€æŠ¥å‘Šæ‰§è¡ŒçŠ¶æ€åˆ° TC</p>\n<p><strong>TC äºŒé˜¶æ®µçš„å·¥ä½œ</strong>ï¼š</p>\n<ul>\n<li>TC æ£€æµ‹å„åˆ†æ”¯äº‹åŠ¡æ‰§è¡ŒçŠ¶æ€\n<ul>\n<li>å¦‚æœéƒ½æˆåŠŸï¼Œé€šè¿‡æ‰€æœ‰ RM æäº¤äº‹åŠ¡</li>\n<li>å¦‚æœæœ‰å¤±è´¥ï¼Œé€šè¿‡æ‰€æœ‰ RM å›æ»šäº‹åŠ¡</li>\n</ul>\n</li>\n</ul>\n<p><strong>RM äºŒé˜¶æ®µçš„å·¥ä½œ</strong>ï¼š</p>\n<ul>\n<li>æ¥æ”¶ TC æŒ‡ä»¤ï¼Œæäº¤æˆ–å›æ»šäº‹åŠ¡</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181128704.png\" alt=\"image-20231018112758938\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>XA æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>äº‹åŠ¡çš„å¼ºä¸€è‡´æ€§ï¼Œæ»¡è¶³ ACID åŸåˆ™</li>\n<li>å¸¸ç”¨æ•°æ®åº“éƒ½æ”¯æŒï¼Œå®ç°ç®€å•ï¼Œå¹¶ä¸”æ²¡æœ‰ä»£ç ä¾µå…¥</li>\n</ul>\n<p>XA æ¨¡å¼çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>å› ä¸ºä¸€é˜¶æ®µéœ€è¦é”å®šæ•°æ®åº“èµ„æºï¼Œç­‰å¾…äºŒé˜¶æ®µç»“æŸæ‰é‡Šæ”¾ï¼Œæ€§èƒ½è¾ƒå·®</li>\n<li>ä¾èµ–å…³ç³»å‹æ•°æ®åº“å®ç°äº‹åŠ¡</li>\n</ul>\n</blockquote>\n<h4 id=\"2423-å®ç°xaæ¨¡å¼\"><a class=\"anchor\" href=\"#2423-å®ç°xaæ¨¡å¼\">#</a> 2.4.2.3ã€å®ç° XA æ¨¡å¼ğŸŒ´</h4>\n<p>Seata çš„ starter å·²ç»å®Œæˆäº† XA æ¨¡å¼çš„è‡ªåŠ¨è£…é…ï¼Œå®ç°éå¸¸ç®€å•ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<p>1ã€ä¿®æ”¹ application.yml æ–‡ä»¶ (æ¯ä¸ªå‚ä¸äº‹åŠ¡çš„å¾®æœåŠ¡)ï¼Œå¼€å¯ XA æ¨¡å¼</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">seata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">data-source-proxy-mode</span><span class=\"token punctuation\">:</span> XA <span class=\"token comment\"># å¼€å¯æ•°æ®æºä»£ç†çš„ XA æ¨¡å¼</span></pre></td></tr></table></figure><p>2ã€ç»™å‘èµ·å…¨å±€äº‹åŠ¡çš„å…¥å£æ–¹æ³•æ·»åŠ  @GlobalTransactional æ³¨è§£ï¼Œæœ¬ä¾‹ä¸­æ˜¯ OrderServiceImpl ä¸­çš„ create æ–¹æ³•ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@GlobalTransactional</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">Long</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Order</span> order<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// åˆ›å»ºè®¢å•</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   orderMapper<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token comment\">// æ‰£ç”¨æˆ·ä½™é¢</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      accountClient<span class=\"token punctuation\">.</span><span class=\"token function\">deduct</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">.</span><span class=\"token function\">getUserId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> order<span class=\"token punctuation\">.</span><span class=\"token function\">getMoney</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token comment\">// æ‰£åº“å­˜</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      storageClient<span class=\"token punctuation\">.</span><span class=\"token function\">deduct</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">.</span><span class=\"token function\">getCommodityCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> order<span class=\"token punctuation\">.</span><span class=\"token function\">getCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">FeignException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä¸‹å•å¤±è´¥ï¼ŒåŸå› :&#123;&#125;\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">contentUTF8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token function\">contentUTF8</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token keyword\">return</span> order<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>3ã€é‡å¯æœåŠ¡å¹¶æµ‹è¯•</p>\n<p>ç›®å‰çš„ account_tbl è¡¨å•ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181144973.png\" alt=\"image-20231018114458627\" /></p>\n<p>ç›®å‰ storage_tbl è¡¨å•ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181145948.png\" alt=\"image-20231018114522634\" /></p>\n<p>ä½¿ç”¨ postman è¿›è¡Œå‘é€è¯·æ±‚æµ‹è¯•</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181146511.png\" alt=\"image-20231018114629170\" /></p>\n<p>æµ‹è¯•å account_tbl è¡¨å•ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181146234.png\" alt=\"image-20231018114658167\" /></p>\n<p>æµ‹è¯•å storage_tbl è¡¨å•ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181147047.png\" alt=\"image-20231018114715998\" /></p>\n<p>å¯ä»¥çœ‹åˆ°æ²¡æœ‰é—®é¢˜ï¼Œä¸‹é¢æµ‹è¯• å¼‚å¸¸ çš„æƒ…å†µ</p>\n<p>postman æµ‹è¯•å¦‚ä¸‹ï¼š</p>\n<p>å°†å­˜åº“æ•°é‡æ”¹ä¸º 10ï¼Œå½“å‰çš„åº“å­˜æ•°æ®æ˜¯ä¸è¶³ 10 ä¸ªçš„å› æ­¤æ‰§è¡Œå°±ä¼šå‡ºé—®é¢˜å¯ä»¥çœ‹åˆ°çŠ¶æ€ç  500 å·²ç»å¼‚å¸¸äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181148645.png\" alt=\"image-20231018114814272\" /></p>\n<p>æˆ‘ä»¬çœ‹ä¸‹æ•°æ®åº“æœ‰æ²¡æœ‰å›æ»šå•Š</p>\n<p>æµ‹è¯•å account_tbl è¡¨å•ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181149371.png\" alt=\"image-20231018114937327\" /></p>\n<p>æµ‹è¯•å storage_tbl è¡¨å•ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181149916.png\" alt=\"image-20231018114955744\" /></p>\n<p>å¯ä»¥çœ‹åˆ°æ²¡æœ‰ä»»ä½•å˜åŒ–</p>\n<p>çœ‹ä¸‹ idea çš„æ§åˆ¶å°çš„æ‰“å°ä¿¡æ¯ï¼š</p>\n<p>accountApplication æ‰“å°å‡ºäº†äº‹åŠ¡å›æ»šçš„ä¿¡æ¯ï¼Œå…¶å®ƒçš„æ˜¯æŠ¥é”™çš„ä¿¡æ¯ï¼Œå› ä¸ºæŠ¥é”™æœ¬èº«å°±æ²¡æœ‰æ‰§è¡ŒæˆåŠŸ</p>\n<pre><code>10-18 11:48:06:076  INFO 18016 --- [h_RMROLE_1_2_16] i.s.c.r.p.c.RmBranchRollbackProcessor    : rm handle branch rollback process:xid=192.168.45.1:8091:4251845158843265029,branchId=4251845158843265031,branchType=XA,resourceId=jdbc:mysql:///seata_demo,applicationData=null\n10-18 11:48:06:080  INFO 18016 --- [h_RMROLE_1_2_16] io.seata.rm.AbstractRMHandler            : Branch Rollbacking: 192.168.45.1:8091:4251845158843265029 4251845158843265031 jdbc:mysql:///seata_demo\n10-18 11:48:06:083  INFO 18016 --- [h_RMROLE_1_2_16] i.s.rm.datasource.xa.ResourceManagerXA   : 192.168.45.1:8091:4251845158843265029-4251845158843265031 was rollbacked\n10-18 11:48:06:084  INFO 18016 --- [h_RMROLE_1_2_16] io.seata.rm.AbstractRMHandler            : Branch Rollbacked result: PhaseTwo_Rollbacked\n</code></pre>\n<h4 id=\"2424-atæ¨¡å¼åŸç†\"><a class=\"anchor\" href=\"#2424-atæ¨¡å¼åŸç†\">#</a> 2.4.2.4ã€AT æ¨¡å¼åŸç†ğŸŒ´</h4>\n<p>AT æ¨¡å¼åŒæ ·æ˜¯åˆ†é˜¶æ®µæäº¤çš„äº‹åŠ¡æ¨¡å‹ï¼Œä¸è¿‡å´å¼¥è¡¥äº† XA æ¨¡å‹ä¸­èµ„æºé”å®šå‘¨æœŸè¿‡é•¿çš„ç¼ºé™·ã€‚</p>\n<p>AT æ¨¡å¼æ‰§è¡Œå®Œä¸šåŠ¡ sql åä¼šç›´æ¥æäº¤äº‹åŠ¡ï¼Œè€Œä¸æ˜¯ç­‰å¾…å¯¹æ–¹çš„æ‰§è¡Œã€‚åœ¨æ‰§è¡Œä¸šåŠ¡ sql çš„æ—¶å€™ç”± RM æ‹¦æˆªè¿™æ¬¡çš„æ‰§è¡Œå¹¶ä¸”ç»™æ•°æ®å½¢æˆä¸€ä¸ªå¿«ç…§ï¼Œå¿«ç…§åä¸ºï¼šundo logï¼Œå¦‚æœå¤±è´¥äº†å°±å¯ä»¥æ ¹æ®å¿«ç…§è¿›è¡Œæ¢å¤äº†ã€‚åœ¨ç¬¬ä¸€é˜¶æ®µå°±å·²ç»æäº¤äº†ï¼Œç¬¬äºŒé˜¶æ®µå°† log ç»™åˆ é™¤</p>\n<p>é˜¶æ®µä¸€ RM çš„å·¥ä½œï¼š</p>\n<p>1ã€æ³¨å†Œåˆ†æ”¯äº‹åŠ¡</p>\n<p>2ã€&lt;font color='red'&gt; è®°å½• undo-log (æ•°æ®å¿«ç…§)&lt;/font&gt;.</p>\n<p>3ã€æ‰§è¡Œä¸šåŠ¡ sql å¹¶ &lt;font color='red'&gt; æäº¤ &lt;/font&gt;.</p>\n<p>4ã€æŠ¥å‘Šäº‹åŠ¡çŠ¶æ€</p>\n<p>é˜¶æ®µäºŒæäº¤æ—¶ RM çš„å·¥ä½œï¼š</p>\n<p>1ã€åˆ é™¤ undo-log å³å¯</p>\n<p>é˜¶æ®µäºŒå›æ»šæ—¶ RM çš„å·¥ä½œï¼š</p>\n<p>1ã€æ ¹æ® undo-log æ¢å¤æ•°æ®åˆ°æ›´æ–°å‰</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181329271.png\" alt=\"image-20231018132921268\" /></p>\n<p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¿›è¡Œæ¯”å–»ï¼š</p>\n<p>ä¾‹å¦‚ï¼Œä¸€ä¸ªåˆ†æ”¯ä¸šåŠ¡çš„ SQL æ˜¯è¿™æ ·çš„ï¼šupdate tb_account set money = money - 10 where id = 1</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181333976.png\" alt=\"image-20231018133322819\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>ç®€è¿° AT æ¨¡å¼ä¸ XA æ¨¡å¼æœ€å¤§çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>XA æ¨¡å¼ä¸€é˜¶æ®µä¸æäº¤äº‹åŠ¡ï¼Œé”å®šèµ„æºï¼›AT æ¨¡å¼ä¸€é˜¶æ®µç›´æ¥æäº¤ï¼Œä¸é”å®šèµ„æº</li>\n<li>XA æ¨¡å¼ä¾èµ–æ•°æ®åº“æœºåˆ¶å®ç°å›æ»šï¼›AT æ¨¡å¼åˆ©ç”¨æ•°æ®å¿«ç…§å®ç°æ•°æ®å›æ»š</li>\n<li>XA æ¨¡å¼å¼ºä¸€è‡´ï¼›AT æ¨¡å¼æœ€ç»ˆä¸€è‡´</li>\n</ul>\n</blockquote>\n<h5 id=\"24241-atæ¨¡å¼çš„è„å†™é—®é¢˜\"><a class=\"anchor\" href=\"#24241-atæ¨¡å¼çš„è„å†™é—®é¢˜\">#</a> 2.4.2.4.1ã€AT æ¨¡å¼çš„è„å†™é—®é¢˜ğŸ‹</h5>\n<p>ä¸Šè¿°å¾—çŸ¥ï¼ŒAT æ¨¡å¼ç›¸å¯¹äº XA æ¨¡å¼æ¥è®²ï¼Œæ€§èƒ½å¾—åˆ°äº†ä¸€äº›æå‡ï¼Œå› ä¸º AT æ¨¡å¼åœ¨ç¬¬ä¸€é˜¶æ®µçš„æ—¶å€™æ‰§è¡Œäº‹åŠ¡ä¼šç›´æ¥æäº¤ã€‚è€Œä¸æ˜¯ç­‰å¾…å„ä¸ªåˆ†æ”¯ä¸€èµ·æ‰§è¡Œå®Œï¼Œå› æ­¤èµ„æºé”å®šå‘¨æœŸçŸ­ æ€§èƒ½å°±æ¯”è¾ƒå¥½äº†ã€‚ä½†æ˜¯ä¹Ÿæ­£æ˜¯å› ä¸ºå®ƒæå‰é‡Šæ”¾äº†èµ„æºæ²¡æœ‰å»åšé”ï¼Œè¿™å°±å¯¼è‡´äº†åœ¨å¹¶å‘è®¿é—®æƒ…å†µä¸‹ä¼šå­˜åœ¨ä¸€äº›å®‰å…¨é—®é¢˜ã€‚</p>\n<p>æ¯”å¦‚è¯´æœ‰ä¸ª account è¡¨ï¼Œä¸šåŠ¡æ˜¯ä¿®æ”¹ money å­—æ®µè®©å…¶å‡ 10ï¼Œé‚£ä¹ˆæœ‰ä¸€ä¸ªçº¿ç¨‹å¼€å¯äº†è¿™ä¸ªæ ·äº‹åŠ¡ã€‚äº‹åŠ¡å¼€å¯ç¬¬ä¸€ä»¶äº‹å°±æ˜¯è·å–æ•°æ®åº“é”ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªå¿«ç…§ã€‚ç„¶åæ‰§è¡Œ sql ä» 100 æ”¹ä¸º 90ï¼Œç„¶åæäº¤äº‹åŠ¡ï¼Œäº‹åŠ¡ä¸€æ—¦æäº¤é”å°±é‡Šæ”¾äº†ï¼Œæ•°æ®ä¹Ÿå°±æ”¹äº†ã€‚ç¬¬ä¸€é˜¶æ®µå®Œæˆå°±è½®åˆ°ç¬¬äºŒé˜¶æ®µï¼Œä½†åŒä¸€æ—¶åˆ»å› ä¸ºæ˜¯å¹¶å‘ç°åœ¨æœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¹Ÿå¼€å¯äº†äº‹åŠ¡æ‰§è¡Œè¿™ä¸ªä¸šåŠ¡ã€‚äº‹åŠ¡ 2 ç­‰å¾…äº‹åŠ¡ 1 é‡Šæ”¾é”äº†ï¼Œç„¶åæ‹¿åˆ°é”æ‰èƒ½å»ä¿å­˜å¿«ç…§å¹¶æ‰§è¡Œä¸šåŠ¡ sql å°† 90 æ”¹ ä¸º 80ï¼Œç„¶åæäº¤äº‹åŠ¡å¹¶é‡Šæ”¾é”ã€‚</p>\n<p>å¦‚æœè¿™æ—¶äº‹åŠ¡ 1 æ‹¿åˆ°é”åå®ƒè¦åšå›æ»šï¼Œå› ä¸ºäº‹åŠ¡ 1 çš„ç¬¬äºŒé˜¶æ®µè¿˜æ²¡åšå®Œï¼Œè¿™æ—¶äº‹åŠ¡ 1 çš„å¿«ç…§æ•°æ®ä¸º money=100 è¿™æ˜¯å›æ»šå°±å‡ºé—®é¢˜äº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181351685.png\" alt=\"image-20231018135124412\" /></p>\n<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ AT æ¨¡å¼å¼•å…¥äº†ä¸€ä¸ªå« â€œå…¨å±€é”â€ çš„ä¸œè¥¿</p>\n<p><mark>å…¨å±€é”</mark>ï¼šç”± TC è®°å½•å½“å‰æ­£åœ¨æ“ä½œæŸè¡Œæ•°æ®çš„äº‹åŠ¡ï¼Œæ”¹äº‹åŠ¡æŒæœ‰å…¨å±€é”ï¼Œå…·å¤‡æ‰§è¡Œæƒã€‚</p>\n<p>TC é€šè¿‡ä¸€å¼ è¡¨æ¥è¿›è¡Œè®°å½•ï¼Œåˆ†åˆ«è®°å½•ï¼šå½“å‰ç”±å“ªä¸ªäº‹åŠ¡åœ¨æ“ä½œï¼Œæ“ä½œçš„å“ªå¼ è¡¨ï¼Œä¸»é”® æ“ä½œè¿™å¼ è¡¨çš„å“ªä¸€è¡Œæ•°æ®ã€‚é€šè¿‡è®°å½•æŸ¥çœ‹è¿™ä¸ªè¡¨çš„è¿™è¡Œæ•°æ®å°±åªèƒ½è¢«è¿™ä¸ªäº‹åŠ¡è¿›è¡Œæ“ä½œï¼Œå…¶å®ƒäº‹åŠ¡ä¸èƒ½æ“ä½œã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181402045.png\" alt=\"image-20231018140242928\" /></p>\n<p>å°½ç®¡å¦‚æ­¤ï¼Œäº‹åŠ¡ 1 åœ¨æ“ä½œ money å­—æ®µçš„æ—¶å€™ä¹Ÿå¯èƒ½ä¼šæœ‰ä¸€ä¸ªæ²¡æœ‰è¢« seata ç®¡ç†çš„ä¸šåŠ¡æ¥æ“ä½œ money å­—æ®µæ­¤æ—¶å°±ä¼šäº§ç”Ÿè„å†™çš„é—®é¢˜äº†ã€‚åˆ†å¸ƒå¼äº‹åŠ¡æˆ‘ä»¬åº”è¯¥å°½é‡çš„é¿å…ä¸¤ä¸ªæ“ä½œåŒä¸€ä¸ªå­—æ®µã€‚ä½†æ˜¯å†æ€ä¹ˆé¿å…ä¹Ÿä¸æ˜¯ä¸å¯èƒ½çš„æƒ…å†µ</p>\n<p>AT æ¨¡å¼ä¹Ÿå¯¹è¿™ç§æ–¹å¼åšäº†ä¸€äº›å¤„ç†ã€‚</p>\n<p>å½“äº‹åŠ¡ 1 ç¬¬äºŒé˜¶æ®µè¿›è¡Œå›æ»šæ—¶ï¼Œä¼šæ‹¿åˆ° æ›´æ–°å‰çš„å¿«ç…§å’Œæ›´æ–°åçš„å¿«ç…§ã€‚ç„¶åç”¨æ›´æ–°åçš„å¿«ç…§æ•°æ®å»å¯¹å½“å‰çš„æ•°æ®åº“æ•°æ®åšå¯¹æ¯”ï¼Œåˆ¤æ–­æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´å°±ä¼šè®°å½•å¼‚å¸¸ï¼Œå‘é€è­¦å‘Šï¼Œäººå·¥ä»‹å…¥</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181414617.png\" alt=\"image-20231018141424667\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>AT æ¨¡å¼çš„ä¼˜ç‚¹ï¼š</p>\n<ul>\n<li>ä¸€é˜¶æ®µå®Œæˆç›´æ¥æäº¤äº‹åŠ¡ï¼Œé‡Šæ”¾æ•°æ®åº“èµ„æºï¼Œæ€§èƒ½æ¯”è¾ƒå¥½</li>\n<li>åˆ©ç”¨å…¨å±€é”å®ç°è¯»å†™éš”ç¦»</li>\n<li>æ²¡æœ‰ä»£ç ä¾µå…¥ï¼Œæ¡†æ¶è‡ªåŠ¨å®Œæˆå›æ»šå’Œæäº¤</li>\n</ul>\n<p>AT æ¨¡å¼çš„ç¼ºç‚¹ï¼š</p>\n<ul>\n<li>ä¸¤é˜¶æ®µä¹‹é—´å±äºè½¯çŠ¶æ€ï¼Œå±äºæœ€ç»ˆä¸€è‡´</li>\n<li>æ¡†æ¶çš„å¿«ç…§åŠŸèƒ½ä¼šå½±å“æ€§èƒ½ï¼Œä½†æ¯” XA æ¨¡å¼å¥½å¾ˆå¤š</li>\n</ul>\n</blockquote>\n<h4 id=\"2425-å®ç°atæ¨¡å¼\"><a class=\"anchor\" href=\"#2425-å®ç°atæ¨¡å¼\">#</a> 2.4.2.5ã€å®ç° AT æ¨¡å¼ğŸŒ´</h4>\n<p>AT æ¨¡å¼ä¸­çš„å¿«ç…§ç”Ÿæˆï¼Œå›æ»šç­‰åŠ¨ä½œéƒ½æ˜¯ç”±æ¡†æ¶è‡ªåŠ¨å®Œæˆï¼Œæ²¡æœ‰ä»»ä½•ä»£ç ä¾µå…¥ï¼Œå› æ­¤å®ç°éå¸¸ç®€å•ã€‚</p>\n<p>1ã€å¯¼å…¥ SQL æ–‡ä»¶ï¼šseata-at.sqlã€‚æ‰“å¼€ sql æ–‡ä»¶å…¶ä¸­ lock_table å¯¼å…¥åˆ° TC æœåŠ¡å…³è”çš„æ•°æ®åº“ï¼Œundo_log è¡¨å¯¼å…¥åˆ°å¾®æœåŠ¡ç®¡ç†çš„æ•°æ®åº“ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181426661.png\" alt=\"image-20231018142639716\" /></p>\n<p>2ã€ä¿®æ”¹ application.yml æ–‡ä»¶ï¼Œå°†äº‹åŠ¡æ¨¡å¼ä¿®æ”¹ä¸º AT æ¨¡å¼å³å¯ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">seata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">data-source-proxy-mode</span><span class=\"token punctuation\">:</span> AT <span class=\"token comment\"># å¼€å¯æ•°æ®æºä»£ç†çš„ AT æ¨¡å¼</span></pre></td></tr></table></figure><p>3ã€é‡å¯æœåŠ¡å¹¶æµ‹è¯•</p>\n<p>ç›®å‰çš„æ•°æ®åº“æ•°æ®</p>\n<p>account_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181429533.png\" alt=\"image-20231018142929459\" /></p>\n<p>storage_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181429518.png\" alt=\"image-20231018142946308\" /></p>\n<p>ä½¿ç”¨ postman è¿›è¡Œæµ‹è¯•</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181430146.png\" alt=\"image-20231018143051522\" /></p>\n<p>æµ‹è¯•åçš„ account_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181431746.png\" alt=\"image-20231018143114523\" /></p>\n<p>æµ‹è¯•åçš„ storage_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181431267.png\" alt=\"image-20231018143133064\" /></p>\n<p>ä½¿ç”¨ postman è¿›è¡Œä¸€æ¬¡å¤±è´¥çš„æµ‹è¯•ï¼š</p>\n<p>åº“å­˜æ•°æ®ç°åœ¨ä¸å¤Ÿ 10 ä¸ªæˆ‘ä»¬æ‰£å‡ 10 ä¸ªæ­¤æ—¶å°±ä¼šäº§ç”Ÿå¼‚å¸¸</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181432899.png\" alt=\"image-20231018143222278\" /></p>\n<p>æµ‹è¯•åçš„ account_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181432696.png\" alt=\"image-20231018143252735\" /></p>\n<p>æµ‹è¯•åçš„ storage_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181433130.png\" alt=\"image-20231018143302062\" /></p>\n<p>å¯ä»¥å‘ç°æ²¡æœ‰å‘ç”Ÿä»»ä½•çš„å˜åŒ–å•Šã€‚è¯´æ˜äº‹åŠ¡ç”Ÿæ•ˆäº†ï¼Œæ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡éƒ½å›æ»šäº†</p>\n<p>accountApplication æœåŠ¡åœ¨ idea æ§åˆ¶å°ä¸­æ‰“å°çš„ä¿¡æ¯å¦‚ä¸‹ï¼š</p>\n<p>å¯ä»¥çœ‹åˆ°æœ€ç»ˆåˆ é™¤äº†ä¸€ä¸ªå« undo_log çš„è¡¨çš„æ•°æ®ä¹Ÿå°±æ˜¯å¿«ç…§æ•°æ®</p>\n<pre><code>10-18 14:32:15:309  INFO 19080 --- [h_RMROLE_1_2_16] i.s.c.r.p.c.RmBranchRollbackProcessor    : rm handle branch rollback process:xid=192.168.45.1:8091:4251845158843265037,branchId=4251845158843265039,branchType=AT,resourceId=jdbc:mysql:///seata_demo,applicationData=null\n10-18 14:32:15:310  INFO 19080 --- [h_RMROLE_1_2_16] io.seata.rm.AbstractRMHandler            : Branch Rollbacking: 192.168.45.1:8091:4251845158843265037 4251845158843265039 jdbc:mysql:///seata_demo\n10-18 14:32:15:347  INFO 19080 --- [h_RMROLE_1_2_16] i.s.r.d.undo.AbstractUndoLogManager      : xid 192.168.45.1:8091:4251845158843265037 branch 4251845158843265039, undo_log deleted with GlobalFinished\n10-18 14:32:15:348  INFO 19080 --- [h_RMROLE_1_2_16] io.seata.rm.AbstractRMHandler            : Branch Rollbacked result: PhaseTwo_Rollbacked\n</code></pre>\n<h4 id=\"2426-tccæ¨¡å¼åŸç†\"><a class=\"anchor\" href=\"#2426-tccæ¨¡å¼åŸç†\">#</a> 2.4.2.6ã€TCC æ¨¡å¼åŸç†ğŸŒ´</h4>\n<p>TCC æ¨¡å¼ä¸ AT æ¨¡å¼éå¸¸ç›¸ä¼¼ï¼Œæ¯é˜¶æ®µéƒ½æ˜¯ç‹¬ç«‹äº‹åŠ¡ï¼Œä¸åŒçš„æ˜¯ TCC é€šè¿‡äººå·¥ç¼–ç æ¥å®ç°æ•°æ®æ¢å¤ã€‚éœ€è¦å®ç°ä¸‰ä¸ªæ–¹æ³•ï¼š</p>\n<p>1ã€Tryï¼šèµ„æºçš„æ£€æµ‹å’Œé¢„ç•™</p>\n<p>2ã€Confirmï¼šå®Œæˆèµ„æºæ“ä½œä¸šåŠ¡ï¼›è¦æ±‚ Try æˆåŠŸ Confirm ä¸€å®šè¦èƒ½æˆåŠŸ</p>\n<p>3ã€Cancelï¼šé¢„ç•™èµ„æºé‡Šæ”¾ï¼Œå¯ä»¥ç†è§£ä¸º try çš„åå‘æ“ä½œ</p>\n<p>ä¸¾ä¾‹ï¼Œä¸€ä¸ªæ‰£å‡ç”¨æˆ·ä½™é¢çš„ä¸šåŠ¡ã€‚å‡è®¾è´¦æˆ· A åŸæ¥ä½™é¢æ˜¯ 100ï¼Œéœ€è¦ä½™é¢æ‰£å‡ 30 å…ƒ</p>\n<ul>\n<li>\n<p>é˜¶æ®µä¸€ (Try)ï¼šæ£€æŸ¥ä½™é¢æ˜¯å¦å……è¶³ï¼Œå¦‚æœå……è¶³åˆ™å†»ç»“é‡‘é¢å¢åŠ  30 å…ƒï¼Œå¯ç”¨ä½™é¢æ‰£é™¤ 30</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181448987.png\" alt=\"image-20231018144806649\" /></p>\n</li>\n<li>\n<p>é˜¶æ®µäºŒ (Confirm)ï¼šå‡å¦‚è¦æäº¤ï¼Œåˆ™å†»ç»“é‡‘é¢æ‰£å‡ 30</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181448879.png\" alt=\"image-20231018144815748\" /></p>\n</li>\n<li>\n<p>é˜¶æ®µäºŒ (Cancel)ï¼šå¦‚æœè¦å›æ»šï¼Œåˆ™å†»ç»“é‡‘é¢æ‰£å‡ 30ï¼Œå¯ç”¨ä½™é¢å¢åŠ  30</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181448428.png\" alt=\"image-20231018144824406\" /></p>\n</li>\n</ul>\n<p>TCC çš„å·¥ä½œæ¨¡å‹å›¾ï¼š</p>\n<p>ç”± TM å¼€å¯å¹¶æ³¨å†Œå…¨å±€äº‹åŠ¡åˆ° TC ä¸Šï¼Œç„¶å TM é€šçŸ¥æ¯ä¸€ä¸ªåˆ†æ”¯äº‹åŠ¡å»æ‰§è¡Œï¼Œåˆ†æ”¯äº‹åŠ¡è¢« RM åšæ‹¦æˆªï¼ŒRM å…ˆå»æ³¨å†Œä¸€ä¸‹åˆ†æ”¯äº‹åŠ¡ã€‚ç„¶åå†æ‰§è¡Œæ“ä½œï¼Œç¬¬ä¸€é˜¶æ®µè¿›è¡Œ Tryã€‚Try æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„èµ„æºä¼šç›´æ¥æäº¤ï¼Œæäº¤åæŠ¥å‘Šäº‹åŠ¡çš„çŠ¶æ€ã€‚äºŒé˜¶æ®µï¼šTM é€šçŸ¥ TC äº‹åŠ¡ç»“æŸäº†ï¼Œç„¶å TC åšäº‹åŠ¡çŠ¶æ€çš„åˆ¤æ–­ï¼Œçœ‹çœ‹åˆ†æ”¯èµ„æºå¤Ÿä¸å¤Ÿã€‚å¦‚æœå¤Ÿç›´æ¥ Confirm æäº¤ï¼Œå¦‚æœä¸å¤Ÿå°±æ‰§è¡Œ Cancel é€»è¾‘è¿›è¡Œå›æ»šã€‚</p>\n<p>è€Œè¿™ä¸‰ä¸ª Tryï¼ŒConfirmï¼ŒCancel éƒ½æ˜¯éœ€è¦äººå·¥ç¼–å†™çš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181456139.png\" alt=\"image-20231018145621001\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>TCC æ¨¡å¼çš„æ¯ä¸ªé˜¶æ®µæ˜¯åšä»€ä¹ˆçš„ï¼Ÿ</p>\n<ul>\n<li>Tryï¼šèµ„æºæ£€æŸ¥å’Œé¢„ç•™</li>\n<li>Confirmï¼šä¸šåŠ¡æ‰§è¡Œå’Œæäº¤</li>\n<li>Cancelï¼šé¢„ç•™èµ„æºçš„é‡Šæ”¾</li>\n</ul>\n<p>TCC çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>ä¸€é˜¶æ®µå®Œæˆç›´æ¥æäº¤äº‹åŠ¡ï¼Œé‡Šæ”¾æ•°æ®åº“èµ„æºï¼Œæ€§èƒ½å¥½</li>\n<li>ç›¸æ¯” AT æ¨¡å‹ï¼Œæ— éœ€ç”Ÿæˆå¿«ç…§ï¼Œæ— éœ€ä½¿ç”¨å…¨å±€é”ï¼Œæ€§èƒ½æœ€å¼º</li>\n<li>ä¸ä¾èµ–æ•°æ®åº“äº‹åŠ¡ï¼Œè€Œæ˜¯ä¾èµ–è¡¥å¿æ“ä½œï¼Œå¯ä»¥ç”¨äºéäº‹åŠ¡å‹æ•°æ®åº“æ¯”å¦‚ï¼šredis</li>\n</ul>\n<p>TCC çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>æœ‰ä»£ç ä¾µå…¥ï¼Œéœ€è¦è®¤ä¸ºç¼–å†™ Tryï¼ŒConfirm å’Œ Cancel æ¥å£ï¼Œå¤ªéº»çƒ¦</li>\n<li>è½¯çŠ¶æ€ï¼Œäº‹åŠ¡æ˜¯æœ€ç»ˆä¸€è‡´</li>\n<li>éœ€è¦è€ƒè™‘ Confirm å’Œ Cancel çš„å¤±è´¥æƒ…å†µï¼Œåšå¥½å¹‚ç­‰å¤„ç†</li>\n</ul>\n</blockquote>\n<h5 id=\"24261-æ¡ˆä¾‹æ”¹é€ account-serviceæœåŠ¡åˆ©ç”¨tccå®ç°åˆ†å¸ƒå¼äº‹åŠ¡\"><a class=\"anchor\" href=\"#24261-æ¡ˆä¾‹æ”¹é€ account-serviceæœåŠ¡åˆ©ç”¨tccå®ç°åˆ†å¸ƒå¼äº‹åŠ¡\">#</a> 2.4.2.6.1ã€æ¡ˆä¾‹ï¼Œæ”¹é€  account-service æœåŠ¡ï¼Œåˆ©ç”¨ TCC å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ğŸ‹</h5>\n<p>éœ€æ±‚å¦‚ä¸‹ï¼š</p>\n<p>1ã€ä¿®æ”¹ acoount-serviceï¼Œç¼–å†™ Tryï¼ŒConfirmï¼ŒCancel é€»è¾‘</p>\n<p>2ã€Try ä¸šåŠ¡ï¼šæ·»åŠ å†»ç»“é‡‘é¢ï¼Œæ‰£å‡å¯ç”¨é‡‘é¢</p>\n<p>3ã€Confirm ä¸šåŠ¡ï¼šåˆ é™¤å†»ç»“é‡‘é¢</p>\n<p>4ã€Cancel ä¸šåŠ¡ï¼šåˆ é™¤å†»ç»“é‡‘é¢ï¼Œæ¢å¤å¯ç”¨é‡‘é¢</p>\n<p>5ã€ä¿è¯ Confirmï¼ŒCancel æ¥å£çš„ &lt;font color='red'&gt; å¹‚ç­‰æ€§ &lt;/font&gt;.</p>\n<p>6ã€å…è®¸ &lt;font color='red'&gt; ç©ºå›æ»š &lt;/font&gt;.</p>\n<p>7ã€æ‹’ç» &lt;font color='red'&gt; ä¸šåŠ¡æ‚¬æŒ‚ &lt;/font&gt;.</p>\n<h5 id=\"24262-tccçš„ç©ºå›æ»šå’Œä¸šåŠ¡æ‚¬æŒ‚\"><a class=\"anchor\" href=\"#24262-tccçš„ç©ºå›æ»šå’Œä¸šåŠ¡æ‚¬æŒ‚\">#</a> 2.4.2.6.2ã€TCC çš„ç©ºå›æ»šå’Œä¸šåŠ¡æ‚¬æŒ‚ğŸ‹</h5>\n<blockquote>\n<p>å½“æŸåˆ†æ”¯äº‹åŠ¡çš„ try é˜¶æ®µé˜»å¡æ—¶ï¼Œå¯èƒ½å¯¼è‡´å…¨å±€äº‹åŠ¡è¶…æ—¶è€Œè§¦å‘äºŒé˜¶æ®µçš„ cancel æ“ä½œã€‚åœ¨æœªæ‰§è¡Œ try æ“ä½œæ—¶å…ˆæ‰§è¡Œäº† cancel æ“ä½œï¼Œè¿™æ—¶ cancel ä¸èƒ½åšå›æ»šï¼Œå°±æ˜¯ &lt;font color='red'&gt; ç©ºå›æ»š &lt;/font&gt;.</p>\n<p>å› æ­¤ä¹Ÿä¸èƒ½æŠ¥é”™ã€‚æŠ¥é”™å°±ä¼šé‡è¯•å°±ä¼šé™·å…¥ä¸€ä¸ªæ­»å¾ªç¯ä¸­ã€‚</p>\n<p>å¯¹äºå·²ç»ç©ºå›æ»šçš„ä¸šåŠ¡ï¼Œå¦‚æœä»¥åç»§ç»­æ‰§è¡Œ tryï¼Œå°±æ°¸è¿œä¸å¯èƒ½ Confirm æˆ– Cancelï¼Œè¿™å°±æ˜¯ &lt;font color='red'&gt; ä¸šåŠ¡æ‚¬æŒ‚ &lt;/font&gt;ã€‚åº”å½“é˜»æ­¢æ‰§è¡Œç©ºå›æ»šåçš„ try æ“ä½œï¼Œé¿å…æ‚¬æŒ‚</p>\n</blockquote>\n<p>å½“ç¬¬äºŒä¸ªäº‹åŠ¡å»æ‰§è¡Œçš„æ—¶å€™å°±ä¼šè¢«é˜»å¡ï¼Œé˜»å¡åå¾—ä¸åˆ°æ‰§è¡Œ TM å°±ä¼šå¡åœ¨è¿™é‡Œï¼Œç­‰å¾…è¶…æ—¶åå°±ä¼šæŠ¥ä¸€ä¸ªé”™è¯¯ç»™ TC äº†ï¼ŒTC æ­¤æ—¶å°±ä¼šè¿”å›ä¸€ä¸ªå›æ»šçš„é€šçŸ¥äºæ˜¯ RM å°±ä¼šæ‰§è¡Œ Cancel çš„é€»è¾‘äº†ã€‚</p>\n<p>ç¬¬ä¸€ä¸ªåˆ†æ”¯æ‰§è¡Œ Cancel æ²¡é—®é¢˜å› ä¸ºå®ƒå·²ç» Try äº†ï¼Œä½†æ˜¯ç¬¬äºŒä¸ªåˆ†æ”¯å°±å‡ºé—®é¢˜äº† è¿˜æ²¡å†»ç»“é‡‘é¢å°±å»æ¢å¤é‡‘é¢å»äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181514887.png\" alt=\"image-20231018151440530\" /></p>\n<p>â€‹</p>\n<p><strong>ä¸šåŠ¡åˆ†æ</strong></p>\n<p>ä¸ºäº†å®ç°ç©ºå›æ»šï¼Œé˜²æ­¢ä¸šåŠ¡æ‚¬æŒ‚ï¼Œä»¥åŠå¹‚ç­‰æ€§è¦æ±‚ã€‚æˆ‘ä»¬å¿…é¡»åœ¨æ•°æ®åº“è®°å½•å†»ç»“é‡‘é¢çš„åŒæ—¶ï¼Œè®°å½•å½“å‰äº‹åŠ¡ id å’Œæ‰§è¡ŒçŠ¶æ€ï¼Œä¸ºæ­¤æˆ‘ä»¬è®¾è®¡äº†ä¸€å¼ è¡¨ (account_freeze_tbl è¿™ä¸ªè¡¨åœ¨é¡¹ç›®ä¸­ sql æ–‡ä»¶å¤¹å·²ç»æä¾›äº†)ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181702525.png\" alt=\"image-20231018170230443\" /></p>\n<p>æœ‰äº†è¡¨åæˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºå®ä½“ç±»å’Œ mapper</p>\n<p>å®ä½“ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@TableName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"account_freeze_tbl\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccountFreeze</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@TableId</span><span class=\"token punctuation\">(</span>type <span class=\"token operator\">=</span> <span class=\"token class-name\">IdType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">INPUT</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> xid<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> userId<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> freezeMoney<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> state<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">State</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">TRY</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">CONFIRM</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">CANCEL</span> <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>mapper</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">AccountFreezeMapper</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseMapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AccountFreeze</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h5 id=\"24263-å£°æ˜tccæ¥å£\"><a class=\"anchor\" href=\"#24263-å£°æ˜tccæ¥å£\">#</a> 2.4.2.6.3ã€å£°æ˜ TCC æ¥å£ï¼š</h5>\n<p>TCC çš„ Tryï¼ŒConfirmï¼ŒCancel æ–¹æ³•éƒ½éœ€è¦åœ¨æ¥å£ä¸­åŸºäºæ³¨è§£æ¥å£°æ˜ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@LocalTCC</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">AccountTCCService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\">// Try é€»è¾‘ï¼Œ@TwoPhaseBusinessAction ä¸­çš„ name å±æ€§è¦ä¸å½“å‰æ–¹æ³•åä¸€è‡´ï¼Œç”¨äºæŒ‡å®š Try é€»è¾‘å¯¹åº”æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@TwoPhaseBusinessAction</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"deduct\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            commitMethod <span class=\"token operator\">=</span> <span class=\"token string\">\"confirm\"</span><span class=\"token punctuation\">,</span> rollbackMethod <span class=\"token operator\">=</span> <span class=\"token string\">\"cancel\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">deduct</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@BusinessActionContextParameter</span><span class=\"token punctuation\">(</span>paramName <span class=\"token operator\">=</span> <span class=\"token string\">\"userId\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> userId<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token annotation punctuation\">@BusinessActionContextParameter</span><span class=\"token punctuation\">(</span>paramName <span class=\"token operator\">=</span> <span class=\"token string\">\"money\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">int</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// äºŒé˜¶æ®µ confirm ç¡®è®¤æ–¹æ³•ï¼Œå¯ä»¥å¦å‘½åï¼Œä½†è¦ä¿è¯ä¸ commitMethod ä¸€è‡´</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">// @Param context ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥ä¼ é€’ Try æ–¹æ³•çš„å‚æ•°</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token comment\">// @return boolean æ‰§è¡Œæ˜¯å¦æˆåŠŸ</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token keyword\">boolean</span> <span class=\"token function\">confirm</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BusinessActionContext</span> ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token comment\">// äºŒé˜¶æ®µå›æ»šæ–¹æ³•ï¼Œè¦ä¿è¯ä¸ rollbackMethod ä¸€è‡´</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">boolean</span> <span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BusinessActionContext</span> ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®ç°ç±»ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccountTccServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">AccountTCCService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AccountMapper</span> mapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AccountFreezeMapper</span> freezeMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AccountTccServiceImpl</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AccountMapper</span> mapper<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                                 <span class=\"token class-name\">AccountFreezeMapper</span> freezeMapper<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mapper <span class=\"token operator\">=</span> mapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>freezeMapper <span class=\"token operator\">=</span> freezeMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token annotation punctuation\">@Transactional</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">deduct</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> userId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> money<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token comment\">// 1. è·å–äº‹åŠ¡ id</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token class-name\">String</span> xid <span class=\"token operator\">=</span> <span class=\"token class-name\">RootContext</span><span class=\"token punctuation\">.</span><span class=\"token function\">getXID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\">// 1.1. åˆ¤æ–­ freeze ä¸­æ˜¯å¦æœ‰å†»ç»“è®°å½•ï¼Œå¦‚æœæœ‰ï¼Œä¸€å®šæ˜¯ CANCEL æ‰§è¡Œè¿‡ï¼Œè¦æ‹’ç»ä¸šåŠ¡</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">AccountFreeze</span> freeze1 <span class=\"token operator\">=</span> freezeMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectById</span><span class=\"token punctuation\">(</span>xid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>freeze1 <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// CANCEL æ‰§è¡Œè¿‡ï¼Œè¦æ‹’ç»ä¸šåŠ¡</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">// 2. æ‰£å‡å¯ç”¨ä½™é¢</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        mapper<span class=\"token punctuation\">.</span><span class=\"token function\">deduct</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token comment\">// 3. è®°å½•å†»ç»“é‡‘é¢ï¼Œäº‹åŠ¡çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token class-name\">AccountFreeze</span> freeze <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AccountFreeze</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        freeze<span class=\"token punctuation\">.</span><span class=\"token function\">setUserId</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        freeze<span class=\"token punctuation\">.</span><span class=\"token function\">setFreezeMoney</span><span class=\"token punctuation\">(</span>money<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        freeze<span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AccountFreeze<span class=\"token punctuation\">.</span>State</span><span class=\"token punctuation\">.</span><span class=\"token constant\">TRY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        freeze<span class=\"token punctuation\">.</span><span class=\"token function\">setXid</span><span class=\"token punctuation\">(</span>xid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        freezeMapper<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>freeze<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">confirm</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BusinessActionContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token comment\">// 1. è·å–äº‹åŠ¡ id</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token class-name\">String</span> xid <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">getXid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token comment\">// 2. æ ¹æ® id åˆ é™¤å†»ç»“è®°å½•</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> freezeMapper<span class=\"token punctuation\">.</span><span class=\"token function\">deleteById</span><span class=\"token punctuation\">(</span>xid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token keyword\">return</span> count <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BusinessActionContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token comment\">// 1. ä»ä¸Šä¸‹æ–‡ä¸­è·å– ç”¨æˆ·çš„ id å’Œä½™é¢</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token class-name\">String</span> xid <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">getXid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token class-name\">String</span> userId <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">getActionContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"userId\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token class-name\">AccountFreeze</span> freeze <span class=\"token operator\">=</span> freezeMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectById</span><span class=\"token punctuation\">(</span>xid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token comment\">// 1.1. ç©ºå›æ»šçš„åˆ¤æ–­ï¼Œåˆ¤æ–­ freeze æ˜¯å¦ä¸º nullï¼Œä¸º null è¯æ˜ try æ²¡æœ‰æ‰§è¡Œï¼Œéœ€è¦ç©ºå›æ»š</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>freeze <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token comment\">// è¯æ˜ try æ²¡æœ‰æ‰§è¡Œï¼Œéœ€è¦å›æ»š</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            freeze <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AccountFreeze</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>            freeze<span class=\"token punctuation\">.</span><span class=\"token function\">setUserId</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            freeze<span class=\"token punctuation\">.</span><span class=\"token function\">setFreezeMoney</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            freeze<span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AccountFreeze<span class=\"token punctuation\">.</span>State</span><span class=\"token punctuation\">.</span><span class=\"token constant\">CANCEL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>            freeze<span class=\"token punctuation\">.</span><span class=\"token function\">setXid</span><span class=\"token punctuation\">(</span>xid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>            freezeMapper<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>freeze<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>        <span class=\"token comment\">// 1.2. å¹‚ç­‰åˆ¤æ–­</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>freeze<span class=\"token punctuation\">.</span><span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token class-name\">AccountFreeze<span class=\"token punctuation\">.</span>State</span><span class=\"token punctuation\">.</span><span class=\"token constant\">CANCEL</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>            <span class=\"token comment\">// å·²ç»å¤„ç†è¿‡ä¸€æ¬¡ CANCEL äº†ï¼Œæ— éœ€é‡å¤å¤„ç†</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        <span class=\"token comment\">// 2. æ¢å¤å¯ç”¨ä½™é¢</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>        mapper<span class=\"token punctuation\">.</span><span class=\"token function\">refund</span><span class=\"token punctuation\">(</span>freeze<span class=\"token punctuation\">.</span><span class=\"token function\">getUserId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> freeze<span class=\"token punctuation\">.</span><span class=\"token function\">getFreezeMoney</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>        <span class=\"token comment\">// 3. å°†å†»ç»“é‡‘é¢æ¸…é›¶ï¼ŒçŠ¶æ€æ”¹ä¸º CANCEL</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>        freeze<span class=\"token punctuation\">.</span><span class=\"token function\">setFreezeMoney</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>        freeze<span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AccountFreeze<span class=\"token punctuation\">.</span>State</span><span class=\"token punctuation\">.</span><span class=\"token constant\">CANCEL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>        <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> freezeMapper<span class=\"token punctuation\">.</span><span class=\"token function\">updateById</span><span class=\"token punctuation\">(</span>freeze<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>        <span class=\"token keyword\">return</span> count <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç›®å‰çš„æ•°æ®åº“æ•°æ®</p>\n<p>account_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181752228.png\" alt=\"image-20231018175239070\" /></p>\n<p>storage_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181752894.png\" alt=\"image-20231018175252816\" /></p>\n<p>ä½¿ç”¨ postman è¿›è¡Œæµ‹è¯•</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181753247.png\" alt=\"image-20231018175315999\" /></p>\n<p>è¯·æ±‚å®ŒåæŸ¥çœ‹æ•°æ®åº“çš„æ•°æ®</p>\n<p>account_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181753982.png\" alt=\"image-20231018175345921\" /></p>\n<p>storage_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181754323.png\" alt=\"image-20231018175359525\" /></p>\n<p>æµ‹è¯•å¤±è´¥çš„ postman è¯·æ±‚</p>\n<p>å› ä¸ºæ­¤æ—¶åº“å­˜çš„æ•°é‡ä¸å¤Ÿ 10 ä¸ªï¼Œæˆ‘ä»¬å‡å» 10 ä¸ªå°±ä¼šäº§ç”Ÿå¼‚å¸¸</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181754231.png\" alt=\"image-20231018175428861\" /></p>\n<p>æŸ¥çœ‹æ•°æ®åº“çš„æ•°æ®æƒ…å†µ</p>\n<p>æµ‹è¯•åçš„ account_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181932222.png\" alt=\"image-20231018193221241\" /></p>\n<p>æµ‹è¯•åçš„ storage_tbl è¡¨çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181932553.png\" alt=\"image-20231018193242522\" /></p>\n<p>å¯ä»¥çœ‹åˆ°å®Œæˆäº†æ•°æ®çš„å›æ»š</p>\n<h4 id=\"2427-sagaæ¨¡å¼\"><a class=\"anchor\" href=\"#2427-sagaæ¨¡å¼\">#</a> 2.4.2.7ã€Saga æ¨¡å¼ğŸŒ´</h4>\n<p>Saga æ¨¡å¼æ˜¯ SEATA æä¾›çš„é•¿äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚ä¹Ÿåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p>\n<ul>\n<li>ä¸€é˜¶æ®µï¼šç›´æ¥æäº¤æœ¬åœ°äº‹åŠ¡</li>\n<li>äºŒé˜¶æ®µï¼šæˆåŠŸåˆ™ä»€ä¹ˆéƒ½ä¸åšï¼Œå¤±è´¥åˆ™é€šè¿‡ç¼–å†™è¡¥å¿ä¸šåŠ¡æ¥å›æ»š</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310181938269.png\" alt=\"image-20231018193808535\" /></p>\n<p>Saga æ¨¡å¼ä¼˜ç‚¹ï¼š</p>\n<p>1ã€äº‹åŠ¡å‚ä¸è€…å¯ä»¥åŸºäºäº‹åŠ¡é©±åŠ¨å®ç°å¼‚æ­¥è°ƒç”¨ï¼Œååé«˜</p>\n<p>2ã€ä¸€é˜¶æ®µç›´æ¥æäº¤äº‹åŠ¡ï¼Œæ— é”ï¼Œæ€§èƒ½å¥½</p>\n<p>3ã€ä¸ç”¨ç¼–å†™ TCC ä¸­çš„ä¸‰ä¸ªé˜¶æ®µï¼Œå®ç°ç®€å•</p>\n<p>ç¼ºç‚¹ï¼š</p>\n<p>1ã€è½¯çŠ¶æ€æ”¯æŒæ—¶é—´ä¸ç¡®å®šï¼Œæ—¶æ•ˆæ€§å·®</p>\n<p>2ã€æ²¡æœ‰é”ï¼Œæ²¡æœ‰äº‹åŠ¡éš”ç¦»ï¼Œä¼šæœ‰è„å†™</p>\n<h4 id=\"2428-å››ç§æ¨¡å¼å¯¹æ¯”\"><a class=\"anchor\" href=\"#2428-å››ç§æ¨¡å¼å¯¹æ¯”\">#</a> 2.4.2.8ã€å››ç§æ¨¡å¼å¯¹æ¯”ğŸŒ´</h4>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>XA</th>\n<th>AT</th>\n<th>TCC</th>\n<th>SAGA</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ä¸€è‡´æ€§</td>\n<td>å¼ºä¸€è‡´</td>\n<td>å¼±ä¸€è‡´</td>\n<td>å¼±ä¸€è‡´</td>\n<td>æœ€ç»ˆä¸€è‡´</td>\n</tr>\n<tr>\n<td>éš”ç¦»æ€§</td>\n<td>å®Œå…¨éš”ç¦»</td>\n<td>åŸºäºå…¨å±€é”éš”ç¦»</td>\n<td>åŸºäºèµ„æºé¢„ç•™éš”ç¦»</td>\n<td>æ— éš”ç¦»</td>\n</tr>\n<tr>\n<td>ä»£ç ä¾µå…¥</td>\n<td>æ— </td>\n<td>æ— </td>\n<td>æœ‰ï¼Œè¦ç¼–å†™ä¸‰ä¸ªæ¥å£</td>\n<td>æœ‰ï¼Œè¦ç¼–å†™çŠ¶æ€æœºå’Œè¡¥å¿ä¸šåŠ¡</td>\n</tr>\n<tr>\n<td>æ€§èƒ½</td>\n<td>å·®</td>\n<td>å¥½</td>\n<td>éå¸¸å¥½</td>\n<td>éå¸¸å¥½</td>\n</tr>\n<tr>\n<td>åœºæ™¯</td>\n<td>å¯¹ä¸€è‡´æ€§ï¼Œéš”ç¦»æ€§æœ‰é«˜è¦æ±‚çš„ä¸šåŠ¡</td>\n<td>åŸºäºå…³ç³»å‹æ•°æ®åº“çš„å¤§å¤šæ•°åˆ†å¸ƒå¼åœºæ™¯éƒ½å¯ä»¥</td>\n<td>å¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„äº‹åŠ¡ &lt;br /&gt; æœ‰éå…³ç³»å‹æ•°æ®åº“è¦å‚ä¸çš„äº‹åŠ¡</td>\n<td>ä¸šåŠ¡æµç¨‹é•¿ï¼Œä¸šåŠ¡æµç¨‹å¤š &lt;br /&gt; å‚ä¸è€…åŒ…å«å…¶å®ƒå…¬å¸æˆ–é—ç•™ç³»ç»ŸæœåŠ¡ï¼Œæ— æ³•æä¾› TCC æ¨¡å¼è¦æ±‚çš„ä¸‰ä¸ªæ¥å£</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"ä¸‰-é«˜å¯ç”¨\"><a class=\"anchor\" href=\"#ä¸‰-é«˜å¯ç”¨\">#</a> ä¸‰ã€é«˜å¯ç”¨ğŸ„</h1>\n<ul>\n<li>é«˜å¯ç”¨é›†ç¾¤ç»“æ„</li>\n<li>å®ç°é«˜å¯ç”¨é›†ç¾¤</li>\n</ul>\n<p><strong>TC çš„å¼‚åœ°å¤šæœºæˆ¿å®¹ç¾æ¶æ„</strong></p>\n<p>TC æœåŠ¡ä½œä¸º Seata çš„æ ¸å¿ƒæœåŠ¡ï¼Œä¸€å®šè¦ä¿è¯<mark>é«˜å¯ç”¨</mark>å’Œ<mark>å¼‚åœ°å®¹ç¾</mark>.</p>\n<p>å…·ä½“å®ç°æŸ¥çœ‹æ–‡ç« ï¼š<a href=\"../Seata/seata%E7%9A%84%E9%83%A8%E7%BD%B2%E5%92%8C%E9%9B%86%E6%88%90.md\">seata çš„éƒ¨ç½²å’Œé›†æˆ.md</a>.</p>\n<h1 id=\"å››å¤šçº§ç¼“å­˜\"><a class=\"anchor\" href=\"#å››å¤šçº§ç¼“å­˜\">#</a> å››ï¼Œå¤šçº§ç¼“å­˜ğŸ„</h1>\n<p>äº¿çº§æµé‡çš„ç¼“å­˜æ–¹æ¡ˆ</p>\n<h2 id=\"41-ä¼ ç»Ÿç¼“å­˜çš„é—®é¢˜\"><a class=\"anchor\" href=\"#41-ä¼ ç»Ÿç¼“å­˜çš„é—®é¢˜\">#</a> 4.1ã€ä¼ ç»Ÿç¼“å­˜çš„é—®é¢˜ğŸŒ³</h2>\n<p>ä¼ ç»Ÿçš„ç¼“å­˜ç­–ç•¥ä¸€èˆ¬æ˜¯è¯·æ±‚åˆ°è¾¾ Tomcat åï¼Œå…ˆæŸ¥è¯¢ redisï¼Œå¦‚æœæœªå‘½ä¸­åˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œå­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š</p>\n<p>1ã€è¯·æ±‚è¦ç»è¿‡ Tomcat å¤„ç†ï¼ŒTomcat çš„æ€§èƒ½æˆä¸ºæ•´ä¸ªç³»ç»Ÿçš„ç“¶é¢ˆ</p>\n<p>2ã€Redis ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œä¼šå¯¹æ•°æ®åº“äº§ç”Ÿå†²å‡»</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191526124.png\" alt=\"image-20231019152653849\" /></p>\n<h2 id=\"42-å¤šçº§ç¼“å­˜æ–¹æ¡ˆ\"><a class=\"anchor\" href=\"#42-å¤šçº§ç¼“å­˜æ–¹æ¡ˆ\">#</a> 4.2ã€å¤šçº§ç¼“å­˜æ–¹æ¡ˆğŸŒ³</h2>\n<p>å¤šçº§ç¼“å­˜å°±æ˜¯å……åˆ†åˆ©ç”¨è¯·æ±‚å¤„ç†çš„æ¯ä¸ªç¯èŠ‚ï¼Œåˆ†åˆ«æ·»åŠ ç¼“å­˜ï¼Œå‡è½» Tomcat å‹åŠ›ï¼Œæå‡æœåŠ¡æ€§èƒ½ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191532661.png\" alt=\"image-20231019153224519\" /></p>\n<p>ç”¨ä½œç¼“å­˜çš„ Nginx æ˜¯ä¸šåŠ¡ Nginxï¼Œéœ€è¦éƒ¨ç½²ä¸ºé›†ç¾¤ï¼Œå†æœ‰ä¸“é—¨çš„ Nginx ç”¨æ¥åšåå‘ä»£ç†ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191534434.png\" alt=\"image-20231019153411071\" /></p>\n<h2 id=\"43-jvmè¿›ç¨‹ç¼“å­˜\"><a class=\"anchor\" href=\"#43-jvmè¿›ç¨‹ç¼“å­˜\">#</a> 4.3ã€JVM è¿›ç¨‹ç¼“å­˜ğŸŒ³</h2>\n<ul>\n<li>å¯¼å…¥å•†å“æ¡ˆä¾‹</li>\n<li>åˆå§‹ Caffeine</li>\n<li>å®ç°è¿›ç¨‹ç¼“å­˜</li>\n</ul>\n<h3 id=\"431-å¯¼å…¥å•†å“æ¡ˆä¾‹\"><a class=\"anchor\" href=\"#431-å¯¼å…¥å•†å“æ¡ˆä¾‹\">#</a> 4.3.1ã€å¯¼å…¥å•†å“æ¡ˆä¾‹ğŸŒ²</h3>\n<p>æŸ¥çœ‹æ–‡ç« ï¼š<a href=\"./%E6%A1%88%E4%BE%8B%E5%AF%BC%E5%85%A5%E8%AF%B4%E6%98%8E/%E6%A1%88%E4%BE%8B%E5%AF%BC%E5%85%A5%E8%AF%B4%E6%98%8E.md\">æ¡ˆä¾‹å¯¼å…¥è¯´æ˜</a>.</p>\n<h3 id=\"432-åˆå§‹caffeine\"><a class=\"anchor\" href=\"#432-åˆå§‹caffeine\">#</a> 4.3.2ã€åˆå§‹ CaffeineğŸŒ²</h3>\n<h4 id=\"4321-æœ¬åœ°è¿›ç¨‹ç¼“å­˜\"><a class=\"anchor\" href=\"#4321-æœ¬åœ°è¿›ç¨‹ç¼“å­˜\">#</a> 4.3.2.1ã€æœ¬åœ°è¿›ç¨‹ç¼“å­˜ğŸŒ´</h4>\n<p>ç¼“å­˜åœ¨æ—¥å¸¸å¼€å‘ä¸­èµ·åˆ°è‡³å…³é‡è¦çš„ä½œç”¨ã€‚ç”±äºæ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ•°æ®çš„è¯»å–é€Ÿåº¦æ˜¯éå¸¸å¿«çš„ï¼Œèƒ½å¤§é‡å‡å°‘å¯¹æ•°æ®åº“çš„è®¿é—®ï¼Œå‡å°‘æ•°æ®åº“çš„å‹åŠ›ã€‚æˆ‘ä»¬å§ç¼“å­˜åˆ†ä¸ºä¸¤ç±»ï¼š</p>\n<p>1ã€åˆ†å¸ƒå¼ç¼“å­˜ï¼Œä¾‹å¦‚ Redisï¼š</p>\n<ul>\n<li>ä¼˜ç‚¹ï¼šå­˜å‚¨å®¹é‡æ›´å¤§ï¼Œå¯é æ€§æ›´å¥½ï¼Œå¯ä»¥åœ¨é›†ç¾¤é—´å…±äº«</li>\n<li>ç¼ºç‚¹ï¼šè®¿é—®ç¼“å­˜æœ‰ç½‘ç»œå¼€é”€</li>\n<li>åœºæ™¯ï¼šç¼“å­˜æ•°æ®é‡è¾ƒå¤§ï¼Œå¯é æ€§è¦æ±‚è¾ƒé«˜ï¼Œéœ€è¦åœ¨é›†ç¾¤é—´å…±äº«</li>\n</ul>\n<p>2ã€è¿›ç¨‹æœ¬åœ°ç¼“å­˜ï¼Œä¾‹å¦‚ HashMapï¼ŒGuavaCacheï¼š</p>\n<ul>\n<li>ä¼˜ç‚¹ï¼šè¯»å–æœ¬åœ°å†…å­˜ï¼Œæ²¡æœ‰ç½‘ç»œå¼€é”€ï¼Œé€Ÿåº¦æ›´å¿«</li>\n<li>ç¼ºç‚¹ï¼šå­˜å‚¨å®¹é‡æœ‰é™ï¼Œå¯é æ€§è¾ƒä½ï¼Œæ— æ³•å…±äº«</li>\n<li>åœºæ™¯ï¼šæ€§èƒ½è¦æ±‚è¾ƒé«˜ï¼Œç¼“å­˜æ•°æ®é‡è¾ƒå°</li>\n</ul>\n<p>Caffeine æ˜¯ä¸€ä¸ªåŸºäº java8 å¼€å‘çš„ï¼Œæä¾›äº†è¿‘ä¹æœ€ä½³å‘½ä¸­ç‡çš„é«˜æ€§èƒ½çš„æœ¬åœ°ç¼“å­˜åº“ã€‚ç›®å‰ Spring å†…éƒ¨çš„ç¼“å­˜ä½¿ç”¨çš„å°±æ˜¯ Caffeineã€‚Github åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2Jlbi1tYW5lcy9jYWZmZWluZQ==\">https://github.com/ben-manes/caffeine</span></p>\n<h5 id=\"43211-caffeineç¤ºä¾‹\"><a class=\"anchor\" href=\"#43211-caffeineç¤ºä¾‹\">#</a> 4.3.2.1.1ã€Caffeine ç¤ºä¾‹ğŸ‹</h5>\n<p>å¯ä»¥é€šè¿‡ item-service é¡¹ç›®ä¸­çš„å•å…ƒæµ‹è¯•æ¥å­¦ä¹  Caffeine çš„ä½¿ç”¨ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">testBasicOpsTwo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. æ„å»º cache å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">Cache</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> cache <span class=\"token operator\">=</span> <span class=\"token class-name\">Caffeine</span><span class=\"token punctuation\">.</span><span class=\"token function\">newBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 2. å­˜æ•°æ®</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"éƒ­æ˜ç„¶\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// 3. å–æ•°æ®</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token class-name\">String</span> gf <span class=\"token operator\">=</span> cache<span class=\"token punctuation\">.</span><span class=\"token function\">getIfPresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf = \"</span> <span class=\"token operator\">+</span> gf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token comment\">// 4. å–æ•°æ®ï¼Œå¦‚æœæœªå‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token class-name\">String</span> defaultGF <span class=\"token operator\">=</span> cache<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"defaultGF\"</span><span class=\"token punctuation\">,</span> key <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token comment\">// 4.1. æ ¹æ® key å»æŸ¥è¯¢æ•°æ®åº“</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token keyword\">return</span> <span class=\"token string\">\"æ˜¯ä¸ªå‚»å­\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"defaultGF = \"</span> <span class=\"token operator\">+</span> defaultGF<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">//------------------ æ‰§è¡Œç»“æœ ------------------</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>gf <span class=\"token operator\">=</span> éƒ­æ˜ç„¶</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>defaultGF <span class=\"token operator\">=</span> æ˜¯ä¸ªå‚»å­</pre></td></tr></table></figure><p>Caffeine æä¾›äº†ä¸‰ç§ç¼“å­˜é©±é€ç­–ç•¥ï¼š</p>\n<p>1ã€åŸºäºå®¹é‡ï¼šè®¾ç½®ç¼“å­˜çš„æ•°é‡ä¸Šé™</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">testBasicOpsTwo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. æ„å»º cache å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">Cache</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> cache <span class=\"token operator\">=</span> <span class=\"token class-name\">Caffeine</span><span class=\"token punctuation\">.</span><span class=\"token function\">newBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">maximumSize</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½®ç¼“å­˜å¤§å°ä¸Šé™ä¸º 1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// 2. å­˜æ•°æ®</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"éƒ­æ˜ç„¶\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"éƒ­æ˜ç„¶1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"éƒ­æ˜ç„¶2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token comment\">//        try &#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token comment\">//            // å»¶è¿Ÿ 10msï¼Œç»™æ¸…ç†çº¿ç¨‹ä¸€ç‚¹æ—¶é—´</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token comment\">//            Thread.sleep(100);</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token comment\">//        &#125; catch (InterruptedException e) &#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token comment\">//            throw new RuntimeException(e);</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token comment\">//        &#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token comment\">// 3. å–æ•°æ®</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">getIfPresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">getIfPresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">getIfPresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">//---------------- æ‰“å°ç»“æœ ----------------</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>éƒ­æ˜ç„¶</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>éƒ­æ˜ç„¶<span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>éƒ­æ˜ç„¶<span class=\"token number\">2</span></pre></td></tr></table></figure><p>ä½¿ç”¨çº¿ç¨‹ç¡çœ è®©å…¶ç­‰å¾… 10ms ç»™æ¸…ç†çº¿ç¨‹ä¸€ç‚¹æ—¶é—´</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">testBasicOpsTwo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. æ„å»º cache å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">Cache</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> cache <span class=\"token operator\">=</span> <span class=\"token class-name\">Caffeine</span><span class=\"token punctuation\">.</span><span class=\"token function\">newBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">maximumSize</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½®ç¼“å­˜å¤§å°ä¸Šé™ä¸º 1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// 2. å­˜æ•°æ®</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"éƒ­æ˜ç„¶\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"éƒ­æ˜ç„¶1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"éƒ­æ˜ç„¶2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>       <span class=\"token comment\">// å»¶è¿Ÿ 10msï¼Œç»™æ¸…ç†çº¿ç¨‹ä¸€ç‚¹æ—¶é—´</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>       <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">10l</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>       <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token comment\">// 3. å–æ•°æ®</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">getIfPresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">getIfPresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">getIfPresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">//---------------- æ‰“å°ç»“æœ ----------------</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">null</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">null</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>éƒ­æ˜ç„¶<span class=\"token number\">2</span></pre></td></tr></table></figure><p>2ã€åŸºäºæ—¶é—´ï¼šè®¾ç½®ç¼“å­˜çš„æœ‰æ•ˆæ—¶é—´</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">testBasicOpsTwo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. æ„å»º cache å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">Cache</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> cache <span class=\"token operator\">=</span> <span class=\"token class-name\">Caffeine</span><span class=\"token punctuation\">.</span><span class=\"token function\">newBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">expireAfterWrite</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Duration</span><span class=\"token punctuation\">.</span><span class=\"token function\">ofSeconds</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½®ç¼“å­˜æœ‰æ•ˆæœŸä¸º 10 ç§’ï¼Œä»æœ€åä¸€æ¬¡å†™å…¥å¼€å§‹è®¡æ—¶</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// 2. å­˜æ•°æ®</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"éƒ­æ˜ç„¶\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"éƒ­æ˜ç„¶1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"éƒ­æ˜ç„¶2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token comment\">// 3. å–æ•°æ®</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">getIfPresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token comment\">// å»¶è¿Ÿ 10msï¼Œç»™æ¸…ç†çº¿ç¨‹ä¸€ç‚¹æ—¶é—´</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">11000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">getIfPresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">getIfPresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gf2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">//------------------- æ‰“å°ç»“æœ -------------------</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>éƒ­æ˜ç„¶</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">null</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">null</span></pre></td></tr></table></figure><p>3ã€åŸºäºå¼•ç”¨ï¼šè®¾ç½®ç¼“å­˜ä¸ºè½¯å¼•ç”¨æˆ–å¼±å¼•ç”¨ï¼Œåˆ©ç”¨ GC æ¥å›æ”¶ç¼“å­˜æ•°æ®ã€‚æ€§èƒ½è¾ƒå·®ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚</p>\n<p><mark>è½¯å¼•ç”¨</mark>ï¼šå†…å­˜ä¸è¶³æ—¶æ‰ä¼šå›æ”¶ï¼›       <mark>å¼±å¼•ç”¨</mark>ï¼šå°±ç®—å†…å­˜å……è¶³æ—¶ä¹Ÿä¼šå›æ”¶ï¼›</p>\n<p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªç¼“å­˜å…ƒç´ è¿‡æœŸçš„æ—¶å€™ï¼ŒCaffeine ä¸ä¼šè‡ªåŠ¨ç«‹å³å°†å…¶æ¸…ç†å’Œé©±é€ã€‚è€Œæ˜¯åœ¨ä¸€æ¬¡è¯»æˆ–å†™æ“ä½œåï¼Œæˆ–è€…åœ¨ç©ºé—²æ—¶é—´å®Œæˆå¯¹å¤±æ•ˆæ•°æ®çš„é©±é€ã€‚</p>\n<h3 id=\"433-å®ç°è¿›ç¨‹ç¼“å­˜\"><a class=\"anchor\" href=\"#433-å®ç°è¿›ç¨‹ç¼“å­˜\">#</a> 4.3.3ã€å®ç°è¿›ç¨‹ç¼“å­˜ğŸŒ²</h3>\n<h4 id=\"4331-æ¡ˆä¾‹å®ç°å•†å“çš„æŸ¥è¯¢çš„æœ¬åœ°è¿›ç¨‹ç¼“å­˜\"><a class=\"anchor\" href=\"#4331-æ¡ˆä¾‹å®ç°å•†å“çš„æŸ¥è¯¢çš„æœ¬åœ°è¿›ç¨‹ç¼“å­˜\">#</a> 4.3.3.1ã€æ¡ˆä¾‹ï¼Œå®ç°å•†å“çš„æŸ¥è¯¢çš„æœ¬åœ°è¿›ç¨‹ç¼“å­˜ğŸŒ´</h4>\n<p>åˆ©ç”¨ Caffeine å®ç°ä¸‹åˆ—éœ€æ±‚ï¼š</p>\n<p>1ã€ç»™æ ¹æ® id æŸ¥è¯¢å•†å“çš„ä¸šåŠ¡æ·»åŠ ç¼“å­˜ï¼Œç¼“å­˜æœªå‘½ä¸­æ—¶æŸ¥è¯¢æ•°æ®åº“</p>\n<p>2ã€ç»™æ ¹æ® id æŸ¥è¯¢å•†å“å­˜åº“çš„ä¸šåŠ¡æ·»åŠ ç¼“å­˜ï¼Œç¼“å­˜æœªå‘½ä¸­æ—¶æŸ¥è¯¢æ•°æ®åº“</p>\n<p>3ã€ç¼“å­˜åˆå§‹å¤§å°ä¸º 100</p>\n<p>4ã€ç¼“å­˜ä¸Šé™ä¸º 10000</p>\n<p>æ­¥éª¤ï¼š</p>\n<p>1ã€ç»™æ ¹æ® id æŸ¥è¯¢å•†å“çš„ä¸šåŠ¡æ·»åŠ ç¼“å­˜ï¼Œç¼“å­˜æœªå‘½ä¸­æ—¶æŸ¥è¯¢æ•°æ®åº“</p>\n<p>2ã€ç»™æ ¹æ® id æŸ¥è¯¢å•†å“å­˜åº“çš„ä¸šåŠ¡æ·»åŠ ç¼“å­˜ï¼Œç¼“å­˜æœªå‘½ä¸­æ—¶æŸ¥è¯¢æ•°æ®åº“</p>\n<p>3ã€ç¼“å­˜åˆå§‹å¤§å°ä¸º 100</p>\n<p>4ã€ç¼“å­˜ä¸Šé™ä¸º 10000</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CaffeineConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Cache</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">itemCache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Caffeine</span><span class=\"token punctuation\">.</span><span class=\"token function\">newBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">initialCapacity</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½®ç¼“å­˜åˆå§‹åŒ–å¤§å°</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">maximumSize</span><span class=\"token punctuation\">(</span><span class=\"token number\">10_000</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½®ç¼“å­˜æœ€å¤§ä¸Šé™å€¼</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Cache</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ItemStock</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">itemStockCache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Caffeine</span><span class=\"token punctuation\">.</span><span class=\"token function\">newBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">initialCapacity</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½®ç¼“å­˜åˆå§‹åŒ–å¤§å°</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">maximumSize</span><span class=\"token punctuation\">(</span><span class=\"token number\">10_000</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½®ç¼“å­˜æœ€å¤§ä¸Šé™å€¼</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>5ã€åœ¨ controller å±‚è¿›è¡Œä¸¤ä¸ªç¼“å­˜å¯¹è±¡çš„è‡ªåŠ¨è£…é…</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">Cache</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">></span></span> itemCache<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">Cache</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ItemStock</span><span class=\"token punctuation\">></span></span> itemStockCache<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>6ã€ç¼–å†™ç¼“å­˜ä»£ç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">Item</span> <span class=\"token function\">findById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\">// ä¼˜å…ˆæ ¹æ®ç¼“å­˜æŸ¥ï¼Œå¦‚æœæœªå‘½ä¸­åˆ™æŸ¥è¯¢æ•°æ®åº“</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">return</span> itemCache<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> key <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token keyword\">return</span> itemService<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">ne</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"status\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">eq</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">one</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/stock/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">ItemStock</span> <span class=\"token function\">findStockById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token keyword\">return</span> itemStockCache<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> key <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token keyword\">return</span> stockService<span class=\"token punctuation\">.</span><span class=\"token function\">getById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¯·æ±‚æ¥å£è¿›è¡Œæµ‹è¯•ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDgxL2l0ZW0vMTAwMDE=\">http://localhost:8081/item/10001</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191732546.png\" alt=\"image-20231019173236082\" /></p>\n<p>ç¬¬ä¸€æ¬¡è¯·æ±‚æˆ‘ä»¬å¯ä»¥åœ¨ idea æ§åˆ¶å°ä¸­çœ‹åˆ°æ‰“å°äº†ä¸€æ®µæ‰§è¡Œ SQL çš„æ—¥å¿—ï¼Œè¯´æ˜æŸ¥äº†ä¸€ä¸‹æ•°æ®åº“</p>\n<pre><code>17:31:53:355 DEBUG 5692 --- [nio-8081-exec-1] c.h.item.mapper.ItemMapper.selectOne     : ==&gt;  Preparing: SELECT id,name,title,price,image,category,brand,spec,status,create_time,update_time FROM tb_item WHERE (status &lt;&gt; ? AND id = ?)\n17:31:53:383 DEBUG 5692 --- [nio-8081-exec-1] c.h.item.mapper.ItemMapper.selectOne     : ==&gt; Parameters: 3(Integer), 10001(Long)\n17:31:53:405 DEBUG 5692 --- [nio-8081-exec-1] c.h.item.mapper.ItemMapper.selectOne     : &lt;==      Total: 1\n</code></pre>\n<p>æ¸…ç©º idea æ§åˆ¶å°å†å¯¹è¯¥é¡µé¢è¿›è¡Œä¸€æ¬¡è®¿é—®ï¼Œå› ä¸ºç¼“å­˜ä¸€å¼€å§‹å°±æ˜¯ç©ºçš„</p>\n<p>å½“æˆ‘ä»¬æ‰§è¡Œè¿‡ä¸€æ¬¡åæ•°æ®å°±ä¼šè¢«ç¼“å­˜èµ·æ¥ï¼Œç¬¬äºŒæ¬¡æ‰§è¡Œå°±ç›´æ¥æ‹¿ç¼“å­˜çš„æ•°æ®äº†å¯ä»¥çœ‹åˆ°æ§åˆ¶å°å¾ˆå¹²å‡€æ²¡æœ‰ä¸€ç‚¹æ‰“å°ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191733727.png\" alt=\"image-20231019173347678\" /></p>\n<p>å½“ç„¶åº“å­˜ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†</p>\n<p>è®¿é—® uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDgxL2l0ZW0vc3RvY2svMTAwMDE=\">http://localhost:8081/item/stock/10001</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191735447.png\" alt=\"image-20231019173509976\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191734949.png\" alt=\"image-20231019173456734\" /></p>\n<p>æ¸…ç©ºæ§åˆ¶å°ä¿¡æ¯è¿›è¡Œç¬¬äºŒæ¬¡è®¿é—®ï¼Œæ­¤æ—¶æ•°æ®å·²ç»è¢«ç¼“å­˜èµ·æ¥äº†ã€‚</p>\n<p>äºŒæ¬¡ä¾æ—§å¾ˆå¹²å‡€</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191735198.png\" alt=\"image-20231019173553835\" /></p>\n<h1 id=\"äº”-luaè¯­è¨€å…¥é—¨\"><a class=\"anchor\" href=\"#äº”-luaè¯­è¨€å…¥é—¨\">#</a> äº”ã€Lua è¯­è¨€å…¥é—¨ğŸ„</h1>\n<p>å› ä¸º Nginx å¼€å‘éœ€è¦ä½¿ç”¨ Lua è¯­è¨€æ¥è¿›è¡Œç¼–ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦å­¦ä¹  Lua è¯­è¨€</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191745432.png\" alt=\"image-20231019174517515\" /></p>\n<p>å­¦ä¹ å†…å®¹ï¼š</p>\n<ul>\n<li>åˆå§‹ Lua</li>\n<li>å˜é‡å’Œå¾ªç¯</li>\n<li>æ¡ä»¶æ§åˆ¶ï¼Œå‡½æ•°</li>\n</ul>\n<h2 id=\"51-åˆå§‹lua\"><a class=\"anchor\" href=\"#51-åˆå§‹lua\">#</a> 5.1ã€åˆå§‹ LuağŸŒ³</h2>\n<p>Lua æ˜¯ä¸€ç§è½»é‡çº§å°å·§çš„è„šæœ¬è¯­è¨€ï¼Œç”¨æ ‡å‡† C è¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€æ”¾ï¼Œå…¶è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†åµŒå…¥åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½ã€‚å®˜ç½‘ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5sdWEub3JnLw==\">http://www.lua.org/</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310191751131.png\" alt=\"image-20231019175148607\" /></p>\n<h3 id=\"511-helloworld\"><a class=\"anchor\" href=\"#511-helloworld\">#</a> 5.1.1ã€HelloWorldğŸŒ²</h3>\n<p>1ã€åœ¨ Linux è™šæ‹Ÿæœºçš„ä»»æ„ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ª hello.lua æ–‡ä»¶</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim hello.lua</span></pre></td></tr></table></figure><p>2ã€æ·»åŠ ä¸‹é¢çš„å†…å®¹</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>print<span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World!\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>3ã€è¿è¡Œ</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># lua hello.lua</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Hello World<span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><h3 id=\"512-æ•°æ®ç±»å‹\"><a class=\"anchor\" href=\"#512-æ•°æ®ç±»å‹\">#</a> 5.1.2ã€æ•°æ®ç±»å‹ğŸŒ²</h3>\n<table>\n<thead>\n<tr>\n<th>æ•°æ®ç±»å‹</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>nil</td>\n<td>è¿™ä¸ªæœ€ç®€å•ï¼Œåªæœ‰å€¼ nil å±äºè¯¥ç±»ï¼Œè¡¨ç¤ºä¸€ä¸ªæ— æ•ˆå€¼ (åœ¨æ¡ä»¶è¡¨è¾¾å¼ä¸­ç›¸å½“äº false)</td>\n</tr>\n<tr>\n<td>boolean</td>\n<td>åŒ…å«ä¸¤ä¸ªå€¼ï¼šfalse å’Œ true</td>\n</tr>\n<tr>\n<td>number</td>\n<td>è¡¨ç¤ºåŒç²¾åº¦ç±»å‹çš„å®æµ®ç‚¹æ•°</td>\n</tr>\n<tr>\n<td>string</td>\n<td>å­—ç¬¦ä¸²ç”±ä¸€å¯¹åŒå¼•å·æˆ–å•å¼•å·æ¥è¡¨ç¤º</td>\n</tr>\n<tr>\n<td>function</td>\n<td>ç”± C æˆ– Lua ç¼–å†™çš„å‡½æ•°</td>\n</tr>\n<tr>\n<td>table</td>\n<td>Lua ä¸­çš„è¡¨ (table) å…¶å®æ˜¯ä¸€ä¸ª â€œå…³è”æ•°ç»„â€ (associative arrays)ï¼Œæ•°ç»„çš„ç´¢å¼•å¯ä»¥æ˜¯æ•°å­—ï¼Œå­—ç¬¦ä¸²æˆ–è¡¨ç±»å‹ã€‚åœ¨ Lua é‡Œï¼Œtable çš„åˆ›å»ºæ˜¯é€šè¿‡ â€œæ„é€ è¡¨è¾¾å¼â€ æ¥å®Œæˆï¼Œæœ€ç®€å•æ„é€ è¡¨è¾¾å¼æ˜¯ { }ï¼Œç”¨æ¥åˆ›å»ºä¸€ä¸ªç©ºè¡¨ã€‚</td>\n</tr>\n</tbody>\n</table>\n<p>å¯ä»¥åˆ©ç”¨ type å‡½æ•°æµ‹è¯•ç»™å®šå˜é‡æˆ–è€…å€¼çš„ç±»å‹</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim hello.lua</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># lua hello.lua</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>string</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat hello.lua</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>print<span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World!\"</span><span class=\"token punctuation\">))</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim hello.lua</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># lua hello.lua</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>number</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat hello.lua</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>print<span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">(</span><span class=\"token number\">10.4</span> * <span class=\"token number\">3</span><span class=\"token punctuation\">))</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><h3 id=\"513-å˜é‡\"><a class=\"anchor\" href=\"#513-å˜é‡\">#</a> 5.1.3ã€å˜é‡ğŸŒ²</h3>\n<p>Lua å£°æ˜å˜é‡çš„æ—¶å€™ï¼Œå¹¶ä¸éœ€è¦æŒ‡å®šæ•°æ®ç±»å‹ï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å£°æ˜å­—ç¬¦ä¸²</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> str <span class=\"token operator\">=</span> <span class=\"token string\">'hello'</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">-- å£°æ˜æ•°å­—</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">local</span> num <span class=\"token operator\">=</span> <span class=\"token number\">21</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">-- å£°æ˜å¸ƒå°”ç±»å‹</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">local</span> flag <span class=\"token operator\">=</span> <span class=\"token keyword\">true</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">-- å£°æ˜æ•°ç»„ key ä¸ºç´¢å¼•çš„ table </span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">local</span> arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">'java'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'python'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'lua'</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">-- å£°æ˜ table ï¼Œç±»ä¼¼ java çš„ map</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">local</span> map <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'Jack'</span><span class=\"token punctuation\">,</span> age <span class=\"token operator\">=</span> <span class=\"token number\">21</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è®¿é—® tableï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- è®¿é—®æ•°ç»„ï¼Œlua æ•°ç»„çš„è§’æ ‡ä» 1 å¼€å§‹</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">print</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">-- è®¿é—® table</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">print</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">[</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">print</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²æ‹¼æ¥ä½¿ç”¨  <code>..</code></p>\n<h3 id=\"514-å¾ªç¯\"><a class=\"anchor\" href=\"#514-å¾ªç¯\">#</a> 5.1.4ã€å¾ªç¯ğŸŒ²</h3>\n<p>æ•°ç»„ï¼Œtable éƒ½å¯ä»¥åˆ©ç”¨ for å¾ªç¯æ¥éå†</p>\n<ul>\n<li>éå†æ•°ç»„ï¼š</li>\n</ul>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å£°æ˜æ•°ç»„ key ä¸ºç´¢å¼•çš„ table</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">'java'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'python'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'lua'</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">-- éå†æ•°ç»„</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">for</span> index<span class=\"token punctuation\">,</span> value <span class=\"token keyword\">in</span> <span class=\"token function\">ipairs</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><ul>\n<li>éå† table</li>\n</ul>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å£°æ˜ mapï¼Œä¹Ÿå°±æ˜¯ table</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> map <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'Jack'</span><span class=\"token punctuation\">,</span> age <span class=\"token operator\">=</span> <span class=\"token number\">21</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">-- éå† table</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">for</span> key<span class=\"token punctuation\">,</span>value <span class=\"token keyword\">in</span> <span class=\"token function\">pairs</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><h3 id=\"515-å‡½æ•°\"><a class=\"anchor\" href=\"#515-å‡½æ•°\">#</a> 5.1.5ã€å‡½æ•°ğŸŒ²</h3>\n<p>å®šä¹‰å‡½æ•°çš„è¯­æ³•ï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">function</span> å‡½æ•°å<span class=\"token punctuation\">(</span> argument1<span class=\"token punctuation\">,</span> argument2<span class=\"token punctuation\">,</span> argument3 <span class=\"token punctuation\">...</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token comment\">-- å‡½æ•°ä½“</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">return</span> è¿”å›å€¼</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥æ‰“å°æ•°ç»„ï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">printArr</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token keyword\">for</span> index<span class=\"token punctuation\">,</span> value <span class=\"token keyword\">in</span> <span class=\"token function\">ipairs</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>      <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><h3 id=\"516-æ¡ä»¶æ§åˆ¶\"><a class=\"anchor\" href=\"#516-æ¡ä»¶æ§åˆ¶\">#</a> 5.1.6ã€æ¡ä»¶æ§åˆ¶ğŸŒ²</h3>\n<p>ç±»ä¼¼ Java çš„æ¡ä»¶æ§åˆ¶ï¼Œä¾‹å¦‚ if , else è¯­æ³•ï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>å¸ƒå°”è¡¨è¾¾å¼<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\">-- [å¸ƒå°”è¡¨è¾¾å¼ä¸º true æ—¶æ‰§è¡Œè¯¥è¯­å¥å— --]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token comment\">-- [å¸ƒå°”è¡¨è¾¾å¼ä¸º false æ—¶æ‰§è¡Œè¯¥è¯­å¥å— --]</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>ä¸ java ä¸åŒï¼Œå¸ƒå°”è¡¨è¾¾å¼ä¸­çš„é€»è¾‘è¿ç®—æ˜¯åŸºäºè‹±æ–‡å•è¯ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>æ“ä½œç¬¦</th>\n<th>æè¿°</th>\n<th>å®ä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>and</td>\n<td>é€»è¾‘ä¸æ“ä½œç¬¦ã€‚è‹¥ A ä¸º falseï¼Œåˆ™è¿”å› Aï¼Œå¦åˆ™è¿”å› B</td>\n<td>(A and B) ä¸º false</td>\n</tr>\n<tr>\n<td>or</td>\n<td>é€»è¾‘æˆ–æ“ä½œç¬¦ã€‚è‹¥ A ä¸º trueï¼Œåˆ™è¿”å› Aï¼Œå¦åˆ™è¿”å› B</td>\n<td>(A or B) ä¸º true</td>\n</tr>\n<tr>\n<td>not</td>\n<td>é€»è¾‘éæ“ä½œç¬¦ã€‚ä¸é€»è¾‘è¿ç®—ç»“æœç›¸åï¼Œå¦‚æœæ¡ä»¶ä¸º trueï¼Œé€»è¾‘éä¸º false</td>\n<td>not (A and B) ä¸º true</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"å…­-å¤šçº§ç¼“å­˜\"><a class=\"anchor\" href=\"#å…­-å¤šçº§ç¼“å­˜\">#</a> å…­ã€å¤šçº§ç¼“å­˜ğŸ„</h1>\n<ul>\n<li>å®‰è£… OpenResty</li>\n<li>OpenResty å¿«é€Ÿå…¥é—¨</li>\n<li>è¯·æ±‚å‚æ•°å¤„ç†</li>\n<li>æŸ¥è¯¢ Tomcat</li>\n<li>Redis ç¼“å­˜é¢„çƒ­</li>\n<li>æŸ¥è¯¢ Redis ç¼“å­˜</li>\n<li>Nginx æœ¬åœ°ç¼“å­˜</li>\n</ul>\n<h2 id=\"61-åˆå§‹openresty\"><a class=\"anchor\" href=\"#61-åˆå§‹openresty\">#</a> 6.1ã€åˆå§‹ OpenRestyğŸŒ³</h2>\n<p>OpenResty æ˜¯ä¸€ä¸ªåŸºäº Nginx çš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†é«˜å¹¶å‘ï¼Œæ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ï¼ŒWeb æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚å…·å¤‡ä¸‹åˆ—ç‰¹ç‚¹ï¼š</p>\n<ul>\n<li>å…·å¤‡ Nginx çš„å®Œæ•´åŠŸèƒ½</li>\n<li>åŸºäº Lua è¯­è¨€è¿›è¡Œæ‰©å±•ï¼Œé›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ï¼Œç¬¬ä¸‰æ–¹æ¨¡å—</li>\n<li>å…è®¸ä½¿ç”¨ Lua è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘ï¼Œè‡ªå®šä¹‰åº“</li>\n</ul>\n<p>å®˜æ–¹ç½‘ç«™ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9vcGVucmVzdHkub3JnL2NuLw==\">https://openresty.org/cn/</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200852606.png\" alt=\"image-20231020085036341\" /></p>\n<h3 id=\"611-openrestyå®‰è£…\"><a class=\"anchor\" href=\"#611-openrestyå®‰è£…\">#</a> 6.1.1ã€OpenResty å®‰è£…ğŸŒ²</h3>\n<p>æŸ¥çœ‹æ–‡ç« ï¼š<a href=\"./OpenResty%E5%AE%89%E8%A3%85/%E5%AE%89%E8%A3%85OpenResty.md\">å®‰è£… OpenResty</a>.</p>\n<h3 id=\"612-æ¡ˆä¾‹openrestyå¿«é€Ÿå…¥é—¨å®ç°å•†å“è¯¦æƒ…é¡µæ•°æ®æŸ¥è¯¢\"><a class=\"anchor\" href=\"#612-æ¡ˆä¾‹openrestyå¿«é€Ÿå…¥é—¨å®ç°å•†å“è¯¦æƒ…é¡µæ•°æ®æŸ¥è¯¢\">#</a> 6.1.2ã€æ¡ˆä¾‹ï¼ŒOpenResty å¿«é€Ÿå…¥é—¨ï¼Œå®ç°å•†å“è¯¦æƒ…é¡µæ•°æ®æŸ¥è¯¢ğŸŒ²</h3>\n<p>å•†å“è¯¦æƒ…é¡µç›®å‰å±•ç¤ºçš„æ˜¯å‡æ•°æ®ï¼Œåœ¨æµè§ˆå™¨çš„æ§åˆ¶å°å¯ä»¥çœ‹åˆ°æŸ¥è¯¢å•†å“ä¿¡æ¯çš„è¯·æ±‚ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200915073.png\" alt=\"image-20231020091453815\" /></p>\n<p>è€Œè¿™ä¸ªè¯·æ±‚æœ€ç»ˆè¢«åå‘ä»£ç†åˆ°è™šæ‹Ÿæœºçš„ OpenResty é›†ç¾¤ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200915958.png\" alt=\"image-20231020091503555\" /></p>\n<p>éœ€æ±‚ï¼šåœ¨ OpenResty ä¸­æ¥æ”¶è¿™ä¸ªè¯·æ±‚ï¼Œå¹¶è¿”å›ä¸€æ®µå•†å“çš„å‡æ•°æ®ã€‚</p>\n<p>æ­¥éª¤ï¼šä¸€ã€‚</p>\n<p>1ã€åœ¨ nginx.conf çš„ http ä¸‹é¢ï¼Œæ·»åŠ å¯¹ OpenResty çš„ Lua æ¨¡å—çš„åŠ è½½</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># lua æ¨¡å—</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>lua_package_path <span class=\"token string\">\"/usr/local/openresty/lualib/?.lua;;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># c æ¨¡å—     </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>lua_package_cpath <span class=\"token string\">\"/usr/local/openresty/lualib/?.so;;\"</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>2ã€åœ¨ nginx.conf çš„ server ä¸‹é¢ï¼Œæ·»åŠ å¯¹ /api/item è¿™ä¸ªè·¯å¾„çš„ç›‘å¬</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># è¿™é‡Œå¯ä»¥ç†è§£ä¸ºå°±æ˜¯ SpringMVC ä¸­çš„ Controller</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>location /api/item <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># é»˜è®¤çš„å“åº”ç±»å‹</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>default_type application/json<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># è¿™é‡Œå¯ä»¥ç†è§£ä¸ºå°±æ˜¯ Service ä¸šåŠ¡é€»è¾‘å±‚</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># å“åº”ç»“æœç”± lua/item.lua ä¸‹çš„æ–‡ä»¶å†³å®š</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>content_by_lua_file lua/item.lua<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ­¥éª¤ï¼šäºŒã€‚</p>\n<p>1ã€åœ¨ nginx ç›®å½•åˆ›å»ºæ–‡ä»¶å¤¹ï¼šlua</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir lua</span></pre></td></tr></table></figure><p>2ã€åœ¨ lua æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»ºæ–‡ä»¶ï¼šitem.lua</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\"># touch lua/item.lua</span></pre></td></tr></table></figure><p>3ã€å†…å®¹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">--  è¿”å›å‡æ•°æ®ï¼Œè¿™é‡Œçš„ ngx.say () å‡½æ•°ï¼Œå°±æ˜¯å†™æ•°æ®åˆ° Response ä¸­</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&#123;\"id\":10001, \"name\":\"SALSA AIR\"&#125;'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>è¿™é‡Œé¢çš„å‡æ•°æ®å» uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDElRTQlQjglQUQlRTYlODklOTMlRTUlQkMlODAlRTYlOEUlQTclRTUlODglQjYlRTUlOEYlQjAlRTklODAlODklRTYlOEIlQTl2dWUlRTclODQlQjYlRTUlOTAlOEUlRTglQjUlOEIlRTUlODAlQkNJdGVtJUU0JUI5JTlGJUU1JUIwJUIxJUU2JTk4JUFGT2JqZWN0JUU1JUFGJUI5JUU4JUIxJUExJUVGJUJDJThDJUU1JUIwJTg2JUU5JTg3JThDJUU5JTlEJUEyJUU3JTlBJTg0JUU2JTk1JUIwJUU2JThEJUFFJUU0JUJEJTlDJUU0JUI4JUJBJUU1JTgxJTg3JUU2JTk1JUIwJUU2JThEJUFFJUU0JUJEJUJGJUU3JTk0JUE4\">http://localhost/item.html?id=10001 ä¸­æ‰“å¼€æ§åˆ¶å°é€‰æ‹© vue ç„¶åèµ‹å€¼ Item ä¹Ÿå°±æ˜¯ Object å¯¹è±¡ï¼Œå°†é‡Œé¢çš„æ•°æ®ä½œä¸ºå‡æ•°æ®ä½¿ç”¨</span></p>\n<p>è¿™ä¸ªé¡µé¢æ˜¯ä» nginx ä»£ç†é‡Œé¢è®¿é—®è¿‡æ¥çš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200940251.png\" alt=\"image-20231020094054757\" /></p>\n<p>å°†å‡æ•°æ®æ‹·è´åˆ° ngx.say (â€˜â€™) é‡Œé¢</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200942719.png\" alt=\"image-20231020094215395\" /></p>\n<p>ä¸ºäº†èƒ½åŒºåˆ†ä¸€ä¸‹æ˜¯å¦æˆåŠŸï¼Œæˆ‘ä»¬å°†é‡Œé¢çš„ä¸€äº›æ•°æ®è¿›è¡Œä¸€ä¸‹ä¿®æ”¹</p>\n<p>æ­¤å¤„åªæ˜¯ä¿®æ”¹äº†å°ºå¯¸å’Œä»·æ ¼</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&#123;\"id\":10001,\"name\":\"SALSA AIR\",\"title\":\"RIMOWA 31å¯¸æ‰˜è¿ç®±æ‹‰æ†ç®± SALSA AIRç³»åˆ—æœç»¿è‰² 820.70.36.4\",\"price\":27900,\"image\":\"https://m.360buyimg.com/mobilecms/s720x720_jfs/t6934/364/1195375010/84676/e9f2c55f/597ece38N0ddcbc77.jpg!q70.jpg.webp\",\"category\":\"æ‹‰æ†ç®±\",\"brand\":\"RIMOWA\",\"spec\":\"\",\"status\":1,\"createTime\":\"2019-04-30T16:00:00.000+00:00\",\"updateTime\":\"2019-04-30T16:00:00.000+00:00\",\"stock\":2999,\"sold\":31290&#125;'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>å®Œæ•´çš„ nginx.conf é…ç½®å†…å®¹ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#user  nobody;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">worker_processes</span>  <span class=\"token number\">1</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">error_log</span>  logs/error.log</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">events</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">worker_connections</span>  <span class=\"token number\">1024</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">http</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">include</span>       mime.types</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">default_type</span>  application/octet-stream</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">sendfile</span>        <span class=\"token boolean\">on</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">keepalive_timeout</span>  <span class=\"token number\">65</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\"># lua æ¨¡å—</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">lua_package_path</span> <span class=\"token string\">\"/usr/local/openresty/lualib/?.lua;;\"</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\"># c æ¨¡å—     </span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">lua_package_cpath</span> <span class=\"token string\">\"/usr/local/openresty/lualib/?.so;;\"</span></span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">listen</span>       <span class=\"token number\">8081</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">server_name</span>  localhost</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> /api/item</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>          <span class=\"token comment\"># é»˜è®¤çš„å“åº”ç±»å‹</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>          <span class=\"token directive\"><span class=\"token keyword\">default_type</span> application/json</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>          <span class=\"token comment\"># å“åº”ç»“æœç”± lua/item.lua ä¸‹çš„æ–‡ä»¶å†³å®š</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token directive\"><span class=\"token keyword\">content_by_lua_file</span> lua/item.lua</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> /</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">root</span>   html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">index</span>  index.html index.htm</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">error_page</span>   <span class=\"token number\">500</span> <span class=\"token number\">502</span> <span class=\"token number\">503</span> <span class=\"token number\">504</span>  /50x.html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> = /50x.html</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">root</span>   html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>4ã€é‡æ–°åŠ è½½é…ç½®</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>nginx <span class=\"token parameter variable\">-s</span> reload</pre></td></tr></table></figure><p>æŸ¥çœ‹å•†å“é¡µé¢ï¼Œæ²¡æœ‰åˆ·æ–°å‰</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200946010.png\" alt=\"image-20231020094617482\" /></p>\n<p>åˆ·æ–°å</p>\n<p>å¯ä»¥çœ‹åˆ°å°ºå¯¸å’Œä»·æ ¼è¢«ä¿®æ”¹äº†ä½†æ˜¯ä¸­æ–‡ä¹Ÿä¹±ç äº†ã€‚ã€‚ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200951850.png\" alt=\"image-20231020095132419\" /></p>\n<h2 id=\"62-openrestyè·å–è¯·æ±‚å‚æ•°\"><a class=\"anchor\" href=\"#62-openrestyè·å–è¯·æ±‚å‚æ•°\">#</a> 6.2ã€OpenResty è·å–è¯·æ±‚å‚æ•°ğŸŒ³</h2>\n<p>OpenResty æä¾›äº†å„ç§ API ç”¨æ¥è·å–ä¸åŒç±»å‹çš„è¯·æ±‚å‚æ•°ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310200958589.png\" alt=\"image-20231020095810221\" /></p>\n<h3 id=\"621-æ¡ˆä¾‹è·å–è¯·æ±‚è·¯å¾„ä¸­çš„å•†å“idä¿¡æ¯æ‹¼æ¥åˆ°jsonç»“æœä¸­è¿”å›\"><a class=\"anchor\" href=\"#621-æ¡ˆä¾‹è·å–è¯·æ±‚è·¯å¾„ä¸­çš„å•†å“idä¿¡æ¯æ‹¼æ¥åˆ°jsonç»“æœä¸­è¿”å›\">#</a> 6.2.1ã€æ¡ˆä¾‹ï¼Œè·å–è¯·æ±‚è·¯å¾„ä¸­çš„å•†å“ id ä¿¡æ¯ï¼Œæ‹¼æ¥åˆ° json ç»“æœä¸­è¿”å›ğŸŒ²</h3>\n<p>åœ¨æŸ¥è¯¢å•†å“ä¿¡æ¯çš„è¯·æ±‚ä¸­ï¼Œé€šè¿‡è·¯å¾„å ä½ç¬¦çš„æ–¹å¼ï¼Œä¼ é€’äº†å•†å“ id åˆ°åå°ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201002974.png\" alt=\"image-20231020100241654\" /></p>\n<p>éœ€æ±‚ï¼šåœ¨ OpenResty ä¸­æ¥æ”¶è¿™ä¸ªè¯·æ±‚ï¼Œå¹¶è·å–è·¯å¾„ä¸­çš„ id ä¿¡æ¯ï¼Œæ‹¼æ¥åˆ°ç»“æœçš„ json å­—ç¬¦ä¸²ä¸­è¿”å›</p>\n<p>OpenResty ä¸­æ¥å—è¯·æ±‚</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">location</span> ~ /api/item(\\d+)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token comment\"># é»˜è®¤çš„å“åº”ç±»å‹</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">default_type</span> application/json</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\"># å“åº”ç»“æœç”± lua/item.lua ä¸‹çš„æ–‡ä»¶å†³å®š</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">content_by_lua_file</span> lua/item.lua</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¹¶è·å–è·¯å¾„ä¸­çš„ id ä¿¡æ¯ï¼Œæ‹¼æ¥åˆ°ç»“æœçš„ json å­—ç¬¦ä¸²ä¸­è¿”å›</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- è·å–è·¯å¾„å‚æ•°</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> id <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>var<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">-- è¿”å›ç»“æœ</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&#123;\"id\":'</span> <span class=\"token operator\">..</span> id <span class=\"token operator\">..</span> <span class=\"token string\">',\"name\":\"SALSA AIR\",\"title\":\"RIMOWA 31å¯¸æ‰˜è¿ç®±æ‹‰æ†ç®± SALSA AIRç³»åˆ—æœç»¿è‰² 820.70.36.4\",\"price\":27900,\"image\":\"https://m.360buyimg.com/mobilecms/s720x720_jfs/t6934/364/1195375010/84676/e9f2c55f/597ece38N0ddcbc77.jpg!q70.jpg.webp\",\"category\":\"æ‹‰æ†ç®±\",\"brand\":\"RIMOWA\",\"spec\":\"\",\"status\":1,\"createTime\":\"2019-04-30T16:00:00.000+00:00\",\"updateTime\":\"2019-04-30T16:00:00.000+00:00\",\"stock\":2999,\"sold\":31290&#125;'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>é‡å¯ Linux ä¸­çš„ nginx æœåŠ¡å™¨</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>nginx <span class=\"token parameter variable\">-s</span> reload</pre></td></tr></table></figure><p>è®¿é—®é¡µé¢è¿›è¡Œæµ‹è¯•ï¼š</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDE=\">http://localhost/item.html?id=10001</span></p>\n<p>è¯·æ±‚ç»“æœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201022922.png\" alt=\"image-20231020102241989\" /></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDI=\">http://localhost/item.html?id=10002</span></p>\n<p>è¯·æ±‚ç»“æœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201023953.png\" alt=\"image-20231020102259850\" /></p>\n<p>å¯ä»¥çœ‹åˆ° id å°±ä¸å†æ˜¯å†™æ­»çš„äº†ï¼Œè€Œæ˜¯å¯ä»¥äº‹å®å˜åŒ–çš„</p>\n<h2 id=\"63-æŸ¥è¯¢tomcat\"><a class=\"anchor\" href=\"#63-æŸ¥è¯¢tomcat\">#</a> 6.3ã€æŸ¥è¯¢ TomcatğŸŒ³</h2>\n<p>å…ˆçœ‹ä¸‹å¤šçº§ç¼“å­˜çš„æ¶æ„ã€‚ç›®å‰å·²ç»å‡†å¤‡å¥½äº† nginx åå‘ä»£ç†æœåŠ¡å™¨ï¼Œå®ƒå»æ¥å—å‰ç«¯çš„è¯·æ±‚å¹¶ä¸”è½¬åˆ° OpenRestyï¼ŒæœåŠ¡ç«¯ä¹Ÿç¼–å†™å¥½äº†è¿›ç¨‹ç¼“å­˜ OpenResty ä¹Ÿæ­å¥½äº†ï¼Œä½†æ˜¯ OpenResty æ¥æ”¶åˆ°è¯·æ±‚åè¦æŸ¥è¯¢æ•°æ®ã€‚æˆ‘ä»¬å…ˆå®ç°ä» Tomcat å»æŸ¥ç„¶åå†å­˜å‚¨åˆ°ç¼“å­˜ä¸­ã€‚</p>\n<p>éœ€è¦æ³¨å†Œ OPenResty åœ¨è™šæ‹Ÿæœºä¸Šï¼Œè€Œ Tomcat åœ¨æœ¬æœºä¸Šï¼Œip åœ°å€ä¸åŒ</p>\n<p>ä¸¤ä¸ª ip åœ°å€è®¿é—®çš„ä¾¿æ·æ–¹å¼ï¼šä¸ç®¡è™šæ‹Ÿæœºçš„ ip åœ°å€æ˜¯ä»€ä¹ˆåªè¦å®˜å‰ä¸‰ä½å°±è¡Œäº†ï¼Œç„¶åæŠŠæœ€åä¸€ä½æ›¿æ¢æˆ 1 ä¸€å®šå¾—åˆ°çš„å°±æ˜¯ windows ç”µè„‘çš„ä½ç½®ã€‚å‰ææ˜¯éœ€è¦å…³é—­é˜²ç«å¢™</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201030614.png\" alt=\"image-20231020103028998\" /></p>\n<h3 id=\"631-æ¡ˆä¾‹è·å–è¯·æ±‚è·¯å¾„ä¸­çš„å•†å“idä¿¡æ¯æ ¹æ®idå‘tomcatæŸ¥è¯¢å•†å“ä¿¡æ¯\"><a class=\"anchor\" href=\"#631-æ¡ˆä¾‹è·å–è¯·æ±‚è·¯å¾„ä¸­çš„å•†å“idä¿¡æ¯æ ¹æ®idå‘tomcatæŸ¥è¯¢å•†å“ä¿¡æ¯\">#</a> 6.3.1ã€æ¡ˆä¾‹ï¼Œè·å–è¯·æ±‚è·¯å¾„ä¸­çš„å•†å“ id ä¿¡æ¯ï¼Œæ ¹æ® id å‘ Tomcat æŸ¥è¯¢å•†å“ä¿¡æ¯ğŸŒ²</h3>\n<p>è¿™é‡Œè¦ä¿®æ”¹ item.luaï¼Œæ»¡è¶³ä¸‹é¢çš„éœ€æ±‚ï¼š</p>\n<p>1ã€è·å–è¯·æ±‚å‚æ•°ä¸­çš„ id</p>\n<p>2ã€æ ¹æ® id å‘ Tomcat æœåŠ¡å‘é€è¯·æ±‚ï¼ŒæŸ¥è¯¢å•†å“ä¿¡æ¯</p>\n<p>3ã€æ ¹æ® id å‘ Tomcat æœåŠ¡å‘é€è¯·æ±‚ï¼ŒæŸ¥è¯¢åº“å­˜ä¿¡æ¯</p>\n<p>4ã€ç»„è£…å•†å“ä¿¡æ¯ï¼Œåº“å­˜ä¿¡æ¯ï¼Œåºåˆ—åŒ–ä¸º Json æ ¼å¼å¹¶è¿”å›</p>\n<p>æ­¥éª¤ï¼š</p>\n<p>ä¸€ï¼Œnginx å†…éƒ¨å‘é€ Http è¯·æ±‚</p>\n<p>nginx æä¾›äº†å†…éƒ¨ API ç”¨ä»¥å‘é€ http è¯·æ±‚ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># æ³¨æ„ï¼šè¿™é‡Œçš„ path æ˜¯è·¯å¾„ï¼Œå¹¶ä¸åŒ…å« ip å’Œç«¯å£ã€‚è¿™ä¸ªè¯·æ±‚ä¼šè¢« nginx å†…éƒ¨çš„ server ç›‘å¬å¹¶å¤„ç†</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># è¿™è‚¯å®šä¸è¡Œï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›å¯ä»¥å‘é€ç»™ Tomcat æ‰€ä»¥å°±è¦æŒ‡å®š Tomcat çš„ ip å’Œç«¯å£</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">local</span> resp = ngx.location.capture(<span class=\"token string\">\"/path\"</span>,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   \t<span class=\"token directive\"><span class=\"token keyword\">method</span> = ngx.HTTP_GET, -- è¯·æ±‚æ–¹å¼</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      args =</span> <span class=\"token punctuation\">&#123;</span>a = 1, b = 2<span class=\"token punctuation\">&#125;</span>, -- getæ–¹å¼ä¼ å‚æ•°</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      body = \"c=3&amp;d=4\" -- postæ–¹å¼ä¼ å‚æ•°</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span>)</pre></td></tr></table></figure><p>è¿”å›çš„å“åº”å†…å®¹åŒ…æ‹¬ï¼š</p>\n<ul>\n<li>resp.statusï¼šå“åº”çŠ¶æ€ç </li>\n<li>resp.headerï¼šå“åº”å¤´ï¼Œæ˜¯ä¸€ä¸ª table</li>\n<li>resp.bodyï¼šå“åº”ä½“ï¼Œå°±æ˜¯å“åº”æ•°æ®</li>\n</ul>\n<p>æˆ‘ä»¬å¸Œæœ›è¿™ä¸ªè¯·æ±‚å‘é€åˆ° Tomcat æœåŠ¡å™¨ï¼Œæ‰€ä»¥è¿˜éœ€è¦ç¼–å†™ä¸€ä¸ª server æ¥å¯¹è¿™ä¸ªè·¯å¾„åšåå‘ä»£ç†ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">location</span> /path</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token comment\"># è¿™é‡Œæ˜¯ windows ç”µè„‘çš„ ip å’Œ Java æœåŠ¡ç«¯å£ï¼Œéœ€è¦ç¡®ä¿ windows é˜²ç«å¢™å¤„äºå…³é—­çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">proxy_pass</span> http://192.168.137.169:8081</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™ä»£ç ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">listen</span>       <span class=\"token number\">8081</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">server_name</span>  localhost</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">location</span> /item</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token directive\"><span class=\"token keyword\">proxy_pass</span> http://192.168.137.1:8081</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">location</span> ~ /api/item/(\\d+)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token comment\"># é»˜è®¤çš„å“åº”ç±»å‹</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token directive\"><span class=\"token keyword\">default_type</span> application/json</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token comment\"># å“åº”ç»“æœç”± lua/item.lua ä¸‹çš„æ–‡ä»¶å†³å®š</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token directive\"><span class=\"token keyword\">content_by_lua_file</span> lua/item.lua</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">location</span> /</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token directive\"><span class=\"token keyword\">root</span>   html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token directive\"><span class=\"token keyword\">index</span>  index.html index.htm</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">error_page</span>   <span class=\"token number\">500</span> <span class=\"token number\">502</span> <span class=\"token number\">503</span> <span class=\"token number\">504</span>  /50x.html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">location</span> = /50x.html</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token directive\"><span class=\"token keyword\">root</span>   html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Tomcat çš„åå‘ä»£ç†æå®šäº†ï¼Œä»¥ååªè¦è°ƒç”¨ capture API è¯·æ±‚æ˜¯ item å¼€å¤´å°±ä¸€å®šèƒ½è¾¾åˆ° Tomcatã€‚æ‰€ä»¥ä»¥åå°±å¯ä»¥æ”¾å¿ƒçš„ä½¿ç”¨è¿™å¥— API äº†ï¼Œé‚£ä¹ˆæ—¢ç„¶è¿™ä¸ª API ç»å¸¸è¦ä½¿ç”¨ã€‚é‚£æˆ‘ä»¬å¯ä»¥å°†å‘è¯·æ±‚çš„ä»£ç å°è£…æˆä¸€ä¸ªå‡½æ•°</p>\n<h4 id=\"6311-å°è£…httpæŸ¥è¯¢çš„å‡½æ•°\"><a class=\"anchor\" href=\"#6311-å°è£…httpæŸ¥è¯¢çš„å‡½æ•°\">#</a> 6.3.1.1ã€å°è£… HTTP æŸ¥è¯¢çš„å‡½æ•°ğŸŒ´</h4>\n<p>æˆ‘ä»¬å¯ä»¥å§ http æŸ¥è¯¢çš„è¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œæ”¾åˆ° OPenResty å‡½æ•°åº“ä¸­ï¼Œæ–¹ä¾¿åæœŸä½¿ç”¨ã€‚</p>\n<p>1ã€åœ¨ /usr/local/openresty/lualib ç›®å½•ä¸‹åˆ›å»º common.lua æ–‡ä»¶ï¼š</p>\n<p>ä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªä½ç½®ï¼Ÿ å› ä¸ºåœ¨ä¸Šè¿°é…ç½® nginx åŠ è½½æ¨¡å—ä¸­æŒ‡å®šçš„è·¯å¾„å°±æ˜¯åŠ è½½è¿™ä¸ªä½ç½®çš„ä»»ä½•.lua æ–‡ä»¶</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> /usr/local/openresty/lualib/common.lua</pre></td></tr></table></figure><p>2ã€åœ¨ common.lua ä¸­å°è£… http æŸ¥è¯¢çš„å‡½æ•°</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å°è£…å‡½æ•°ï¼Œå‘é€ http è¯·æ±‚ï¼Œå¹¶è§£æå“åº”</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">read_http</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">local</span> resp <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span><span class=\"token function\">capture</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        method <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>HTTP_GET<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        args <span class=\"token operator\">=</span> params<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> resp <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">-- è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œè¿”å› 404</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"http not found, path: \"</span><span class=\"token punctuation\">,</span> path <span class=\"token punctuation\">,</span> <span class=\"token string\">\", args: \"</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">404</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">return</span> resp<span class=\"token punctuation\">.</span>body</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">-- å°†æ–¹æ³•å¯¼å‡º</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">local</span> _M <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>  </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    read_http <span class=\"token operator\">=</span> read_http</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span>  </pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">return</span> _M</pre></td></tr></table></figure><p>åœ¨ item.lua æ–‡ä»¶ä¸­ç¼–å†™ä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å¯¼å…¥ common å‡½æ•°åº“</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> common <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'common'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">local</span> read_http <span class=\"token operator\">=</span> common<span class=\"token punctuation\">.</span>read_http</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">-- è·å–è·¯å¾„å‚æ•°</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">local</span> id <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>var<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢å•†å“ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">local</span> itemJSON <span class=\"token operator\">=</span> <span class=\"token function\">read_http</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/item/\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢åº“å­˜ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">local</span> stockJSON <span class=\"token operator\">=</span> <span class=\"token function\">read_http</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/item/stock\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">-- è¿”å›ç»“æœ</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span>itemJSON<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>è®¿é—® uri è¿›è¡Œä¸€ä¸‹è¯·æ±‚æµ‹è¯•ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDM=\">http://localhost/item.html?id=10003</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201318784.png\" alt=\"image-20231020131800919\" /></p>\n<p>è¿”å›çš„æ•°æ®</p>\n<pre><code>&#123;\n    &quot;id&quot;: 10003,\n    &quot;name&quot;: &quot;éŸ©ç‰ˆç‰›ä»”è£¤&quot;,\n    &quot;title&quot;: &quot;å”ç‹®æ–°å“ç‰›ä»”è£¤å¥³å­¦ç”ŸéŸ©ç‰ˆå®½æ¾è£¤å­ Aæ¬¾/ä¸­ç‰›ä»”è“ï¼ˆæ— ç»’æ¬¾ï¼‰ 26&quot;,\n    &quot;price&quot;: 84600,\n    &quot;image&quot;: &quot;https://m.360buyimg.com/mobilecms/s720x720_jfs/t26989/116/124520860/644643/173643ea/5b860864N6bfd95db.jpg!q70.jpg.webp&quot;,\n    &quot;category&quot;: &quot;ç‰›ä»”è£¤&quot;,\n    &quot;brand&quot;: &quot;å”ç‹®&quot;,\n    &quot;spec&quot;: &quot;&#123;\\&quot;é¢œè‰²\\&quot;: \\&quot;è“è‰²\\&quot;, \\&quot;å°ºç \\&quot;: \\&quot;26\\&quot;&#125;&quot;,\n    &quot;status&quot;: 1,\n    &quot;createTime&quot;: &quot;2019-05-01T00:00:00.000+00:00&quot;,\n    &quot;updateTime&quot;: &quot;2019-05-01T00:00:00.000+00:00&quot;,\n    &quot;stock&quot;: null,\n    &quot;sold&quot;: null\n&#125;\n</code></pre>\n<p>ç°åœ¨æ‰€æœ‰çš„å•†å“éƒ½èƒ½æ­£å¸¸æŸ¥è¯¢äº†ï¼Œä½†æ˜¯ï¼</p>\n<p>é‡Œé¢çš„ï¼Œé”€é‡å’Œå­˜åº“çš„æ•°æ®è¿˜æ²¡æœ‰ã€‚</p>\n<p>ä½†æ˜¯å¦‚æœè¦æ˜¯æœ‰ 3 å¼ è¡¨ï¼Œ4 å¼ è¡¨ï¼Œ5 å¼ è¡¨éƒ½éœ€è¦æŠŠå®ƒä»¬æ‹¼æ¥èµ·æ¥ï¼Œæ‰€ä»¥æœ€ç»ˆéœ€è¦çš„æ˜¯å®Œæ•´çš„æ•°æ®</p>\n<p>ä½†æ˜¯ itemJSON å¾—åˆ°çš„æ•°æ®æ˜¯ä¸€ä¸ª Json æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦è½¬æ¢ä¸º Lua é‡Œé¢çš„å¯¹è±¡ï¼Œä½¿ç”¨ table è¿™ä¸ªæ•°æ®ç±»å‹æ¥è¿›è¡Œå­˜å‚¨</p>\n<p>å¦‚ä¸‹å°±æ˜¯å°† JSON ååºåˆ—åŒ–ä¸º Lua å¯¹è±¡çš„æ–¹å¼ï¼š</p>\n<h4 id=\"6312-jsonç»“æœå¤„ç†\"><a class=\"anchor\" href=\"#6312-jsonç»“æœå¤„ç†\">#</a> 6.3.1.2ã€JSON ç»“æœå¤„ç†ğŸŒ´</h4>\n<p>OPenResty æä¾›äº†ä¸€ä¸ª cjson çš„æ¨¡å—ç”¨æ¥å¤„ç† JSON çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p>\n<p>å®˜æ–¹åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL29wZW5yZXN0eS9sdWEtY2pzb24v\">https://github.com/openresty/lua-cjson/</span></p>\n<p>è¯¥æ¨¡å—çš„ç›®å½•ä½ç½®å¦‚ä¸‹ï¼š/usr/local/openresty/lualib/</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201330405.png\" alt=\"image-20231020133045031\" /></p>\n<p><strong>ä½¿ç”¨</strong>ï¼š</p>\n<p>1ã€å¯¼å…¥ cjson æ¨¡å—ï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">local</span> cjson <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cjson'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>2ã€åºåˆ—åŒ–ï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">local</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   name <span class=\"token operator\">=</span> <span class=\"token string\">'jack'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   age <span class=\"token operator\">=</span> <span class=\"token number\">21</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">local</span> json <span class=\"token operator\">=</span> cjson<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>3ã€ååºåˆ—åŒ–</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">local</span> json <span class=\"token operator\">=</span> <span class=\"token string\">'&#123;\"name\": \"jack\", \"age\": 21&#125;'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">-- ååºåˆ—åŒ–</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">local</span> obj <span class=\"token operator\">=</span> cjson<span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">print</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>ç»§ç»­ä¸‹é¢çš„ä»£ç æ­¥éª¤ï¼š</p>\n<p>1ã€å°†è¯·æ±‚åˆ°çš„ json æ•°æ®åºåˆ—åŒ–ä¸º lua ä¸­çš„ table æ•°æ®</p>\n<p>2ã€å†å°†åºåˆ—åŒ–çš„æ•°æ®è¿›è¡Œè°ƒç”¨æ‹¼æ¥</p>\n<p>3ã€æ‹¼æ¥å®Œæ¯•åå†å°† lua ä¸­ table æ•°æ®åºåˆ—åŒ–ä¸º json å“åº”åˆ°å‰ç«¯</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å¯¼å…¥ common å‡½æ•°åº“</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> common <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'common'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">local</span> read_http <span class=\"token operator\">=</span> common<span class=\"token punctuation\">.</span>read_http</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">-- å¯¼å…¥ cjson åº“</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">local</span> cjson <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cjson'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">-- è·å–è·¯å¾„å‚æ•°</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">local</span> id <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>var<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢å•†å“ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">local</span> itemJSON <span class=\"token operator\">=</span> <span class=\"token function\">read_http</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/item/\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢åº“å­˜ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">local</span> stockJSON <span class=\"token operator\">=</span> <span class=\"token function\">read_http</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/item/stock/\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">-- JSON è½¬åŒ–ä¸º lua çš„ table</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">local</span> item <span class=\"token operator\">=</span> cjson<span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>itemJSON<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">local</span> sto <span class=\"token operator\">=</span> cjson<span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>stockJSON<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">-- ç»„åˆæ•°æ®</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>item<span class=\"token punctuation\">.</span>stock <span class=\"token operator\">=</span> sto<span class=\"token punctuation\">.</span>stock</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>item<span class=\"token punctuation\">.</span>sold <span class=\"token operator\">=</span> sto<span class=\"token punctuation\">.</span>sold</pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">-- æŠŠ item åºåˆ—åŒ–ä¸º json è¿”å›ç»“æœ</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span>cjson<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>è¯·æ±‚ uri è¿›è¡Œæµ‹è¯•ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDQ=\">http://localhost/item.html?id=10004</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201343013.png\" alt=\"image-20231020134303536\" /></p>\n<p>è¯·æ±‚åˆ°çš„æ•°æ®</p>\n<pre><code>&#123;\n    &quot;spec&quot;: &quot;&#123;\\&quot;é¢œè‰²\\&quot;: \\&quot;ç™½è‰²\\&quot;, \\&quot;å°ºç \\&quot;: \\&quot;36\\&quot;&#125;&quot;,\n    &quot;sold&quot;: 974,\n    &quot;status&quot;: 1,\n    &quot;updateTime&quot;: &quot;2019-05-01T00:00:00.000+00:00&quot;,\n    &quot;title&quot;: &quot;æ£®é©¬(senma)ä¼‘é—²é‹å¥³2019æ˜¥å­£æ–°æ¬¾éŸ©ç‰ˆç³»å¸¦æ¿é‹å­¦ç”Ÿç™¾æ­å¹³åº•å¥³é‹ é»„è‰² 36&quot;,\n    &quot;stock&quot;: 99999,\n    &quot;price&quot;: 10400,\n    &quot;image&quot;: &quot;https://m.360buyimg.com/mobilecms/s720x720_jfs/t1/29976/8/2947/65074/5c22dad6Ef54f0505/0b5fe8c5d9bf6c47.jpg!q70.jpg.webp&quot;,\n    &quot;createTime&quot;: &quot;2019-05-01T00:00:00.000+00:00&quot;,\n    &quot;category&quot;: &quot;ä¼‘é—²é‹&quot;,\n    &quot;name&quot;: &quot;ä¼‘é—²æ¿é‹&quot;,\n    &quot;brand&quot;: &quot;æ£®é©¬&quot;,\n    &quot;id&quot;: 10004\n&#125;\n</code></pre>\n<p>å¯ä»¥çœ‹åˆ°æœ‰åº“å­˜å’Œé”€é‡çš„æ•°æ®äº†</p>\n<h3 id=\"632-tomcaté›†ç¾¤çš„è´Ÿè½½å‡è¡¡\"><a class=\"anchor\" href=\"#632-tomcaté›†ç¾¤çš„è´Ÿè½½å‡è¡¡\">#</a> 6.3.2ã€Tomcat é›†ç¾¤çš„è´Ÿè½½å‡è¡¡ğŸŒ²</h3>\n<p>æˆ‘ä»¬å·²ç»å®ç°äº†ï¼Œä» OPenResty å‘ tomcat å‘é€ä¸€ä¸ª http è¯·æ±‚å»æŸ¥è¯¢å•†å“ä¿¡æ¯è¿”å›é¡µé¢ï¼Œå®Œæˆæ¸²æŸ“ã€‚ä½†æ˜¯åœ¨ä¸Šè¿°å®ç°æ¡ˆä¾‹ä¸­ Tomcat åªæœ‰ä¸€å°</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201346554.png\" alt=\"image-20231020134614455\" /></p>\n<p>åœ¨å®é™…ç”Ÿäº§ä¸­ Tomcat ä¸€å®šæ˜¯ä¸€ä¸ªé›†ç¾¤ã€‚æ‰€ä»¥ OPenResty å†å‘é€è¯·æ±‚æ—¶å¿…é¡»å¾—å¯¹å¤šå° Tomcat å®ç°ä¸€ä¸ªè´Ÿè½½å‡è¡¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201349192.png\" alt=\"image-20231020134913570\" /></p>\n<p>æ¯”æ–¹è¯´ è´Ÿè½½å‡è¡¡æŒ‘é€‰äº† 8081ï¼Œç„¶åè¯·æ±‚å°±ä¼šåˆ°è¾¾ 8081 ç„¶åå»æŸ¥è¯¢æ•°æ®åº“ã€‚</p>\n<p>æŸ¥è¯¢å®Œæ•°æ®åº“åä¼šå½¢æˆä¸€ä¸ª jvm è¿›ç¨‹ç¼“å­˜ï¼Œä¿å­˜åœ¨ 8081 è¿™å°æœåŠ¡å™¨ä¸Šï¼Œç¼“å­˜æœ‰äº†ä»¥åä¸‹æ¬¡å¯ä»¥ç›´æ¥è¯»å–ç¼“å­˜å°±ä¸ç”¨æŸ¥è¯¢æ•°æ®åº“äº†æ€§èƒ½å°±éå¸¸å¥½äº†ã€‚ä½†æ˜¯éå¸¸å¯æƒœçš„æ˜¯è¿›ç¨‹ç¼“å­˜æ˜¯ä¸èƒ½å…±äº«çš„ 8081 æœ‰è¿™ä¸ªç¼“å­˜ï¼Œ8082 å¹¶æ²¡æœ‰ï¼Œè€Œè´Ÿè½½å‡è¡¡çš„è§„åˆ™æ˜¯ è½®è¯¢ã€‚å¦‚æœè¿™æ ·è®¿é—®ç¼“å­˜å°±ä¼šåœ¨å¤šå° Tomcat å»å†—ä½™çš„ä¿å­˜ã€‚ç¬¬ä¸€ä¸ªå ç”¨é¢å¤–ç©ºé—´ï¼Œç¬¬äºŒæ˜¯ç¼“å­˜çš„å‘½ä¸­ç‡ä¹Ÿæœ‰ç‚¹æƒ¨</p>\n<p>å¦‚æœè¯´æˆ‘æƒ³è¦å•†å“ 10001 ç¬¬ä¸€æ¬¡æŸ¥è¯¢å®Œä»¥åæ°¸è¿œéƒ½æœ‰ç¼“å­˜ã€‚é‚£ä¹ˆæˆ‘å¿…é¡»è®© item/10001 è¿™ä¸ªè¯·æ±‚æ¯æ¬¡éƒ½æŒ‡å‘åŒä¸€ä¸ªæœåŠ¡å™¨ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯è¿™ä¸ªç¼“å­˜ä¸€ç›´ç”Ÿæ•ˆã€‚å‡å¦‚è¯´åˆæ¥ä¸€ä¸ª item/10002 é‚£æˆ‘å°±è®©å®ƒæŒ‡å‘ä¸‹ä¸€ä¸ªæœåŠ¡å™¨ã€‚</p>\n<p>ä¸åŒå•†å“æ°¸è¿œè®¿é—®ä¸åŒæœåŠ¡å™¨ï¼Œç›¸åŒå•†å“æ°¸è¿œè®¿é—®åŒä¸€ä¸ªæœåŠ¡å™¨ï¼Œè¿™æ ·å°±èƒ½ä¿è¯ç¼“å­˜æ°¸è¿œå‘½ä¸­ã€‚</p>\n<p>è¿™æ · jvm è¿›ç¨‹ç¼“å­˜æ‰æœ‰æ„ä¹‰ã€‚ä½†æ˜¯ç°åœ¨æ˜¯è½®è¯¢è‚¯å®šåšä¸åˆ°è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹ nginx è´Ÿè½½å‡è¡¡çš„ç®—æ³•äº†ã€‚</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># tomcat é›†ç¾¤é…ç½®</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">upstream</span> tomcat-cluster</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\"># æ ¹æ®è¯·æ±‚è¿‡æ¥çš„è·¯å¾„æ¥è®¡ç®— hash å€¼ç„¶åå†³å®šè®¿é—®å“ªä¸ªæœåŠ¡å™¨</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token directive\"><span class=\"token keyword\">hash</span> <span class=\"token variable\">$request_uri</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">server</span> 192.168.249.128:8081</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">server</span> 192.168.249.128:8082</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä»£ç æ¼”ç¤ºå¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">http</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">include</span>       mime.types</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">default_type</span>  application/octet-stream</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">sendfile</span>        <span class=\"token boolean\">on</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">keepalive_timeout</span>  <span class=\"token number\">65</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\"># lua æ¨¡å—</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">lua_package_path</span> <span class=\"token string\">\"/usr/local/openresty/lualib/?.lua;;\"</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\"># c æ¨¡å—     </span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">lua_package_cpath</span> <span class=\"token string\">\"/usr/local/openresty/lualib/?.so;;\"</span></span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">upstream</span> tomcat-cluster</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">hash</span> <span class=\"token variable\">$request_uri</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">server</span> 192.168.249.128:8081</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">server</span> 192.168.249.128:8082</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">listen</span>       <span class=\"token number\">8081</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">server_name</span>  localhost</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> /item</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">proxy_pass</span> http://tomcat-cluster</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> ~ /api/item/(\\d+)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>          <span class=\"token comment\"># é»˜è®¤çš„å“åº”ç±»å‹</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>          <span class=\"token directive\"><span class=\"token keyword\">default_type</span> application/json</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token comment\"># å“åº”ç»“æœç”± lua/item.lua ä¸‹çš„æ–‡ä»¶å†³å®š</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>          <span class=\"token directive\"><span class=\"token keyword\">content_by_lua_file</span> lua/item.lua</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> /</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">root</span>   html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">index</span>  index.html index.htm</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">error_page</span>   <span class=\"token number\">500</span> <span class=\"token number\">502</span> <span class=\"token number\">503</span> <span class=\"token number\">504</span>  /50x.html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">location</span> = /50x.html</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token directive\"><span class=\"token keyword\">root</span>   html</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨ idea ä¸­å¼€å¯ 8082 ç«¯å£çš„æœåŠ¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201435034.png\" alt=\"image-20231020143541296\" /></p>\n<p>å¯åŠ¨</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201436217.png\" alt=\"image-20231020143629316\" /></p>\n<p>è®¿é—® uri è¿›è¡Œæµ‹è¯•ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDE=\">http://localhost/item.html?id=10001</span></p>\n<p>è¿™ä¸ª uri è®¿é—®è¯·æ±‚åˆ°çš„ Tomcat æœåŠ¡ä¸ºå¦‚ä¸‹ï¼š</p>\n<p>idea æ§åˆ¶å°ä¸­æ‰“å°ä¿¡æ¯ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201441979.png\" alt=\"image-20231020144146827\" /></p>\n<p>è®¿é—® uri è¿›è¡Œæµ‹è¯•ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDI=\">http://localhost/item.html?id=10002</span></p>\n<p>è¿™ä¸ª uri è®¿é—®è¯·æ±‚åˆ°çš„ Tomcat æœåŠ¡ä¸ºå¦‚ä¸‹ï¼š</p>\n<p>idea æ§åˆ¶å°ä¸­æ‰“å°ä¿¡æ¯ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201442866.png\" alt=\"image-20231020144213109\" /></p>\n<p>å°†è¿ä¸ªæœåŠ¡çš„æ§åˆ¶å°æ‰“å°çš„ä¿¡æ¯éƒ½æ¸…ç©ºç„¶åå†å»è®¿é—®ä¸€ä¸‹ 10001 å’Œ 10002</p>\n<p>æ§åˆ¶å°éƒ½æ²¡æœ‰æ‰“å°ä»»ä½•çš„ä¿¡æ¯è¯´æ˜ç¼“å­˜èµ·ä½œç”¨äº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201443037.png\" alt=\"image-20231020144338972\" /></p>\n<h2 id=\"64-æ·»åŠ redisç¼“å­˜çš„éœ€æ±‚\"><a class=\"anchor\" href=\"#64-æ·»åŠ redisç¼“å­˜çš„éœ€æ±‚\">#</a> 6.4ã€æ·»åŠ  Redis ç¼“å­˜çš„éœ€æ±‚ğŸŒ³</h2>\n<p>è¯·æ±‚æˆåŠŸåä¸åº”è¯¥ç›´æ¥æŸ¥è¯¢ jvm è¿›ç¨‹ç¼“å­˜è€Œæ˜¯åº”è¯¥å…ˆåˆ° redis ä¸­çœ‹çœ‹æœ‰æ²¡æœ‰ç¼“å­˜å†å»çœ‹ jvm è¿›ç¨‹ç¼“å­˜</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201447926.png\" alt=\"image-20231020144727615\" /></p>\n<h3 id=\"641-æ·»åŠ redisç¼“å­˜è¦é¢ä¸´çš„é—®é¢˜\"><a class=\"anchor\" href=\"#641-æ·»åŠ redisç¼“å­˜è¦é¢ä¸´çš„é—®é¢˜\">#</a> 6.4.1ã€æ·»åŠ  Redis ç¼“å­˜è¦é¢ä¸´çš„é—®é¢˜ğŸŒ²</h3>\n<h4 id=\"6411-å†·å¯åŠ¨ä¸ç¼“å­˜é¢„çƒ­\"><a class=\"anchor\" href=\"#6411-å†·å¯åŠ¨ä¸ç¼“å­˜é¢„çƒ­\">#</a> 6.4.1.1ã€å†·å¯åŠ¨ä¸ç¼“å­˜é¢„çƒ­ğŸŒ´</h4>\n<p><mark>å†·å¯åŠ¨</mark>ï¼šæœåŠ¡åˆšåˆšå¯åŠ¨æ—¶ï¼ŒRedis ä¸­å¹¶æ²¡æœ‰ç¼“å­˜ï¼Œå¦‚æœæ‰€æœ‰å•†å“æ•°æ®éƒ½åœ¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ˜¯æ·»åŠ ç¼“å­˜ï¼Œå¯èƒ½ä¼šç»™æ•°æ®åº“å¸¦æ¥è¾ƒå¤§å‹åŠ›</p>\n<p><mark>ç¼“å­˜é¢„çƒ­</mark>ï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¤§æ•°æ®ç»Ÿè®¡ç”¨æˆ·è®¿é—®çš„çƒ­ç‚¹æ•°æ®ï¼Œåœ¨é¡¹ç›®å¯åŠ¨æ—¶å°†è¿™äº›çƒ­ç‚¹æ•°æ®æå‰æŸ¥è¯¢å¹¶ä¿å­˜åˆ° Redis ä¸­</p>\n<p>æˆ‘ä»¬æ•°æ®æµé‡è¾ƒå°‘ï¼Œå¯ä»¥åœ¨å¯åŠ¨æ—¶å°†æ‰€æœ‰æ•°æ®éƒ½å­˜å…¥ç¼“å­˜ä¸­ã€‚</p>\n<h4 id=\"6412-ç¼“å­˜é¢„çƒ­\"><a class=\"anchor\" href=\"#6412-ç¼“å­˜é¢„çƒ­\">#</a> 6.4.1.2ã€ç¼“å­˜é¢„çƒ­ğŸŒ´</h4>\n<p>æ­¥éª¤ï¼š</p>\n<p>1ã€åˆ©ç”¨ Docker å®‰è£… Redis</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker run --name redis -p 6379:6379 -d redis redis-server --appendonly yes</span></pre></td></tr></table></figure><p>2ã€åœ¨ item-service æœåŠ¡ä¸­å¼•å…¥ redis ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-data-redis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>3ã€é…ç½® Redis åœ°å€</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">redis</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> 192.168.249.128</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6379</span></pre></td></tr></table></figure><p>4ã€ç¼–å†™åˆå§‹åŒ–ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RedisHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">InitializingBean</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">StringRedisTemplate</span> redisTemplate<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">ItemService</span> itemService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">IItemStockService</span> stockService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ObjectMapper</span> <span class=\"token constant\">MAPPER</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectMapper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">afterPropertiesSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">// åˆå§‹åŒ–ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// 1. æŸ¥è¯¢å•†å“ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Item</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> itemService<span class=\"token punctuation\">.</span><span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// 2. æ”¾å…¥ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Item</span> item <span class=\"token operator\">:</span> list<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token comment\">// 2.1. åºåˆ—åŒ–ä¸º json</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token class-name\">String</span> json <span class=\"token operator\">=</span> <span class=\"token constant\">MAPPER</span><span class=\"token punctuation\">.</span><span class=\"token function\">writeValueAsString</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token comment\">// 2.2. å­˜å…¥ redis</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item:id:\"</span> <span class=\"token operator\">+</span> item<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> json<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token comment\">// 1. æŸ¥è¯¢åº“å­˜ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ItemStock</span><span class=\"token punctuation\">></span></span> list1 <span class=\"token operator\">=</span> stockService<span class=\"token punctuation\">.</span><span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// 2. æ”¾å…¥ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ItemStock</span> itemStock <span class=\"token operator\">:</span> list1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token comment\">// 2.1. åºåˆ—åŒ–ä¸º json</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token class-name\">String</span> json <span class=\"token operator\">=</span> <span class=\"token constant\">MAPPER</span><span class=\"token punctuation\">.</span><span class=\"token function\">writeValueAsString</span><span class=\"token punctuation\">(</span>itemStock<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token comment\">// 2.2. å­˜å…¥ redis</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item:stock:id:\"</span> <span class=\"token operator\">+</span> itemStock<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> json<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>é‡å¯æˆ–å¯åŠ¨ 8081 å’Œ 8082 ä¸¤ä¸ªæœåŠ¡å™¨</p>\n<p>å¯ä»¥çœ‹åˆ°å¯åŠ¨æ—¶ redis åˆå§‹åŒ–ç¼“å­˜å»æŸ¥è¯¢äº†æ•°æ®åº“æ­¤æ—¶å¯ä»¥çœ‹ä¸‹ redis ä¸­çš„æ•°æ®æƒ…å†µ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201513672.png\" alt=\"image-20231020151344361\" /></p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker exec -it redis redis-cli</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> keys *</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item:id:10004\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item:stock:id:10004\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item:id:10002\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item:stock:id:10005\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item:id:10001\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item:stock:id:10001\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item:stock:id:10003\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item:id:10003\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> <span class=\"token number\">9</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item:stock:id:10002\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item:id:10005\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span></pre></td></tr></table></figure><h2 id=\"65-æŸ¥è¯¢redisç¼“å­˜\"><a class=\"anchor\" href=\"#65-æŸ¥è¯¢redisç¼“å­˜\">#</a> 6.5ã€æŸ¥è¯¢ Redis ç¼“å­˜ğŸŒ³</h2>\n<h3 id=\"651-openrestyçš„redisæ¨¡å—\"><a class=\"anchor\" href=\"#651-openrestyçš„redisæ¨¡å—\">#</a> 6.5.1ã€OpenResty çš„ Redis æ¨¡å—ğŸŒ²</h3>\n<p>OPenResty æä¾›äº†æ“ä½œ Redis çš„æ¨¡å—ï¼Œæˆ‘ä»¬åªè¦å¼•å…¥è¯¥æ¨¡å—å°±èƒ½ç›´æ¥ä½¿ç”¨ï¼š</p>\n<p>åœ¨ common.lua æ–‡ä»¶ä¸­è¿›è¡Œç¼–å†™</p>\n<ul>\n<li>å¼•å…¥ Redis æ¨¡å—ï¼Œå¹¶åˆå§‹åŒ– Redis å¯¹è±¡</li>\n</ul>\n<p>ä¸ºä»€ä¹ˆå¼•å…¥æ¨¡å—ä¸­æ–‡ä»¶åä¸­é—´éœ€è¦ä¸€ä¸ª . ï¼Ÿ</p>\n<p>è§£é‡Šï¼šå› ä¸ºæˆ‘ä»¬ä¸Šè¿°æ–‡ç« ä¸­éƒ½æ˜¯å¼•å…¥çš„ lualib ç›®å½•ä¸‹çš„æ¨¡å—å› ä¸ºç›´æ¥åœ¨ lua ç›®å½•æ‰€ä»¥å¯ä»¥ç›´æ¥å†™æ–‡ä»¶åå°±è¡Œäº†ã€‚ä½†æ˜¯è¿™ä¸ª redis å¯ä¸å† lualib æ ¹ç›®å½•ä¸­è€Œæ˜¯åœ¨ resty ç›®å½•ä¸‹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201533407.png\" alt=\"image-20231020153335950\" /></p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å¼•å…¥ redis æ¨¡å—</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> redis <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resty.redis'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">-- åˆå§‹åŒ– redis å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">local</span> red <span class=\"token operator\">=</span> redis<span class=\"token punctuation\">:</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">-- è®¾ç½® redis è¶…æ—¶æ—¶é—´</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>red<span class=\"token punctuation\">:</span><span class=\"token function\">set_timeouts</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><ul>\n<li>å°è£…å‡½æ•°ï¼Œç”¨æ¥é‡Šæ”¾ Redis é“¾æ¥ï¼Œå…¶å®æ˜¯æ”¾å…¥è¿æ¥æ± </li>\n</ul>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å…³é—­ redis è¿æ¥çš„å·¥å…·æ–¹æ³•ï¼Œå…¶å®æ˜¯æ”¾å…¥è¿æ¥æ± </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">close_redis</span><span class=\"token punctuation\">(</span>red<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">local</span> pool_max_idle_time <span class=\"token operator\">=</span> <span class=\"token number\">10000</span> <span class=\"token comment\">-- è¿æ¥çš„ç©ºé—²æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">local</span> pool_size <span class=\"token operator\">=</span> <span class=\"token number\">100</span> <span class=\"token comment\">-- è¿æ¥æ± å¤§å°</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">local</span> ok<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> red<span class=\"token punctuation\">:</span><span class=\"token function\">set_keepalive</span><span class=\"token punctuation\">(</span>pool_max_idle_time<span class=\"token punctuation\">,</span> pool_size<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> ok <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"æ”¾å…¥redisè¿æ¥æ± å¤±è´¥: \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>OPenResty æä¾›äº†æ“ä½œ Redis çš„æ¨¡å—ï¼Œæˆ‘ä»¬åªè¦å¼•å…¥è¯¥æ¨¡å—å°±èƒ½ç›´æ¥ä½¿ç”¨ï¼š</p>\n<ul>\n<li>å°è£…å‡½æ•°ï¼Œä» Redis è¯»æ•°æ®å¹¶è¿”å›ï¼š</li>\n</ul>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢ redis çš„æ–¹æ³• ip å’Œ port æ˜¯ redis åœ°å€ï¼Œkey æ˜¯æŸ¥è¯¢çš„ key</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">read_redis</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">-- è·å–ä¸€ä¸ªè¿æ¥</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">local</span> ok<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> red<span class=\"token punctuation\">:</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> ok <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"è¿æ¥rediså¤±è´¥ : \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">nil</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">-- æŸ¥è¯¢ redis</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">local</span> resp<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> red<span class=\"token punctuation\">:</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">-- æŸ¥è¯¢å¤±è´¥å¤„ç†</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> resp <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"æŸ¥è¯¢Rediså¤±è´¥: \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">,</span> <span class=\"token string\">\", key = \"</span> <span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\">-- å¾—åˆ°çš„æ•°æ®ä¸ºç©ºå¤„ç†</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">if</span> resp <span class=\"token operator\">==</span> ngx<span class=\"token punctuation\">.</span>null <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        resp <span class=\"token operator\">=</span> <span class=\"token keyword\">nil</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"æŸ¥è¯¢Redisæ•°æ®ä¸ºç©º, key = \"</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token function\">close_redis</span><span class=\"token punctuation\">(</span>red<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">return</span> resp</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>å®Œæ•´çš„ä»£ç ç¼–å†™ï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å¼•å…¥ redis æ¨¡å—</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> redis <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resty.redis'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">-- åˆå§‹åŒ– redis å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">local</span> red <span class=\"token operator\">=</span> redis<span class=\"token punctuation\">:</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">-- è®¾ç½® redis è¶…æ—¶æ—¶é—´</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>red<span class=\"token punctuation\">:</span><span class=\"token function\">set_timeouts</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">-- å…³é—­ redis è¿æ¥çš„å·¥å…·æ–¹æ³•ï¼Œå…¶å®æ˜¯æ”¾å…¥è¿æ¥æ± </span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">close_redis</span><span class=\"token punctuation\">(</span>red<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">local</span> pool_max_idle_time <span class=\"token operator\">=</span> <span class=\"token number\">10000</span> <span class=\"token comment\">-- è¿æ¥çš„ç©ºé—²æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">local</span> pool_size <span class=\"token operator\">=</span> <span class=\"token number\">100</span> <span class=\"token comment\">-- è¿æ¥æ± å¤§å°</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">local</span> ok<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> red<span class=\"token punctuation\">:</span><span class=\"token function\">set_keepalive</span><span class=\"token punctuation\">(</span>pool_max_idle_time<span class=\"token punctuation\">,</span> pool_size<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> ok <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"æ”¾å…¥redisè¿æ¥æ± å¤±è´¥: \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢ redis çš„æ–¹æ³• ip å’Œ port æ˜¯ redis åœ°å€ï¼Œkey æ˜¯æŸ¥è¯¢çš„ key</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">read_redis</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">-- è·å–ä¸€ä¸ªè¿æ¥</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">local</span> ok<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> red<span class=\"token punctuation\">:</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> ok <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"è¿æ¥rediså¤±è´¥ : \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">nil</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token comment\">-- æŸ¥è¯¢ redis</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">local</span> resp<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> red<span class=\"token punctuation\">:</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token comment\">-- æŸ¥è¯¢å¤±è´¥å¤„ç†</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> resp <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"æŸ¥è¯¢Rediså¤±è´¥: \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">,</span> <span class=\"token string\">\", key = \"</span> <span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token comment\">-- å¾—åˆ°çš„æ•°æ®ä¸ºç©ºå¤„ç†</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">if</span> resp <span class=\"token operator\">==</span> ngx<span class=\"token punctuation\">.</span>null <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        resp <span class=\"token operator\">=</span> <span class=\"token keyword\">nil</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"æŸ¥è¯¢Redisæ•°æ®ä¸ºç©º, key = \"</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token function\">close_redis</span><span class=\"token punctuation\">(</span>red<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token keyword\">return</span> resp</pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">-- å°è£…å‡½æ•°ï¼Œå‘é€ http è¯·æ±‚ï¼Œå¹¶è§£æå“åº”</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">read_http</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token keyword\">local</span> resp <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span><span class=\"token function\">capture</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        method <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>HTTP_GET<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        args <span class=\"token operator\">=</span> params<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> resp <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token comment\">-- è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œè¿”å› 404</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>ERR<span class=\"token punctuation\">,</span> <span class=\"token string\">\"http æŸ¥è¯¢å¤±è´¥äº†~, path: \"</span><span class=\"token punctuation\">,</span> path <span class=\"token punctuation\">,</span> <span class=\"token string\">\", args: \"</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">404</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token keyword\">return</span> resp<span class=\"token punctuation\">.</span>body</pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token comment\">-- å°†æ–¹æ³•å¯¼å‡º</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token keyword\">local</span> _M <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    read_http <span class=\"token operator\">=</span> read_http<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    read_redis <span class=\"token operator\">=</span> read_redis</pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token punctuation\">&#125;</span>  </pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token keyword\">return</span> _M</pre></td></tr></table></figure><p>åœ¨ item.lua æ–‡ä»¶ä¸­è¿›è¡Œå¯¼å…¥ redis å·¥å…·å‡½æ•°</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">local</span> read_redis <span class=\"token operator\">=</span> common<span class=\"token punctuation\">.</span>read_redis</pre></td></tr></table></figure><p>ç”±äºæ·»åŠ äº† redis ç¼“å­˜é‚£ä¹ˆä¹‹å‰çš„æŸ¥è¯¢å•†å“ä¿¡æ¯å’Œåº“å­˜çš„å‡½æ•°å°±éœ€è¦ä¿®æ”¹äº†ã€‚</p>\n<p>ä½†æ˜¯éœ€è¦ä¿®æ”¹ä¸¤ä¸ªå¤ªéº»çƒ¦äº†æ‰€ä»¥å¯¹å…¶è¿›è¡Œå°è£…å‡½æ•°ï¼š</p>\n<p>éœ€æ±‚ï¼š</p>\n<p>1ã€ä¿®æ”¹ item.luaï¼Œå°è£…ä¸€ä¸ªå‡½æ•° read_dataï¼Œå®ç°å…ˆæŸ¥è¯¢ redisï¼Œå¦‚æœæœªå‘½ä¸­ï¼Œå†æŸ¥è¯¢ tomcat</p>\n<p>2ã€ä¿®æ”¹ item.luaï¼ŒæŸ¥è¯¢å•†å“å’Œåº“å­˜æ—¶éƒ½è°ƒç”¨ read_data è¿™ä¸ªå‡½æ•°</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å°è£…æŸ¥è¯¢å‡½æ•°ï¼Œå…ˆæŸ¥è¯¢ redisï¼Œå¦‚æœæœªå‘½ä¸­å†æŸ¥è¯¢ tomcat</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">read_data</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token comment\">-- æŸ¥è¯¢ redis</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">local</span> resp <span class=\"token operator\">=</span> <span class=\"token function\">read_redis</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.249.128\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6379</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token comment\">-- åˆ¤æ–­ redis æ˜¯å¦å‘½ä¸­</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> resp <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">-- redis æŸ¥è¯¢å¤±è´¥ï¼Œå†æŸ¥è¯¢ tomcat</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    resp <span class=\"token operator\">=</span> <span class=\"token function\">read_http</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token keyword\">return</span> resp</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>ç¼–å†™å®Œå°è£…å‡½æ•°åå°†åŸæ¥çš„è¯·æ±‚å‡½æ•°è¿›è¡Œæ›¿æ¢</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢å•†å“ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> itemJSON <span class=\"token operator\">=</span> <span class=\"token function\">read_data</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item:id:\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/item/\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢åº“å­˜ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">local</span> stockJSON <span class=\"token operator\">=</span> <span class=\"token function\">read_data</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item:stock:id:\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/item/stock/\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>item.lua æ–‡ä»¶çš„å®Œæ•´ä»£ç ï¼š</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å¯¼å…¥ common å‡½æ•°åº“</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> common <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'common'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">local</span> read_http <span class=\"token operator\">=</span> common<span class=\"token punctuation\">.</span>read_http</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">local</span> read_redis <span class=\"token operator\">=</span> common<span class=\"token punctuation\">.</span>read_redis</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">-- å¯¼å…¥ cjson åº“</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">local</span> cjson <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cjson'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">-- å°è£…æŸ¥è¯¢å‡½æ•°ï¼Œå…ˆæŸ¥è¯¢ redisï¼Œå¦‚æœæœªå‘½ä¸­å†æŸ¥è¯¢ tomcat</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">read_data</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token comment\">-- æŸ¥è¯¢ redis</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token keyword\">local</span> resp <span class=\"token operator\">=</span> <span class=\"token function\">read_redis</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.249.128\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6379</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token comment\">-- åˆ¤æ–­ redis æ˜¯å¦å‘½ä¸­</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> resp <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\">-- redis æŸ¥è¯¢å¤±è´¥ï¼Œå†æŸ¥è¯¢ tomcat</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    ngx<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"redisæŸ¥è¯¢å¤±è´¥,å°è¯•æŸ¥è¯¢http, key :\"</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    resp <span class=\"token operator\">=</span> <span class=\"token function\">read_http</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token keyword\">return</span> resp</pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">-- è·å–è·¯å¾„å‚æ•°</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">local</span> id <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>var<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢å•†å“ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">local</span> itemJSON <span class=\"token operator\">=</span> <span class=\"token function\">read_data</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item:id:\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/item/\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">-- æŸ¥è¯¢åº“å­˜ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">local</span> stockJSON <span class=\"token operator\">=</span> <span class=\"token function\">read_data</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item:stock:id:\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/item/stock/\"</span> <span class=\"token operator\">..</span> id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">-- JSON è½¬åŒ–ä¸º lua çš„ table</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token keyword\">local</span> item <span class=\"token operator\">=</span> cjson<span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>itemJSON<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token keyword\">local</span> sto <span class=\"token operator\">=</span> cjson<span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>stockJSON<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\">-- ç»„åˆæ•°æ®</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>item<span class=\"token punctuation\">.</span>stock <span class=\"token operator\">=</span> sto<span class=\"token punctuation\">.</span>stock</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>item<span class=\"token punctuation\">.</span>sold <span class=\"token operator\">=</span> sto<span class=\"token punctuation\">.</span>sold</pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">-- æŠŠ item åºåˆ—åŒ–ä¸º json è¿”å›ç»“æœ</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span>cjson<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>é‡å¯è™šæ‹Ÿæœºä¸­çš„ nginx</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\"># nginx -s reload</span></pre></td></tr></table></figure><p>è®¿é—® uri è¿›è¡Œæµ‹è¯•ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDI=\">http://localhost/item.html?id=10002</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201603830.png\" alt=\"image-20231020160328617\" /></p>\n<p>æŸ¥çœ‹ idea æ§åˆ¶å°</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201603637.png\" alt=\"image-20231020160349587\" /></p>\n<p>å°†æ§åˆ¶å°ä¿¡æ¯æ¸…ç©ºåå†æ¬¡è®¿é—® uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDI=\">http://localhost/item.html?id=10002</span></p>\n<p>æ§åˆ¶å°æƒ…å†µ</p>\n<p>è¯´æ˜æ•°æ®å·²ç»è¢«ç¼“å­˜äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201604800.png\" alt=\"image-20231020160432732\" /></p>\n<p>æˆ‘ä»¬æŠŠä¸¤ä¸ªæœåŠ¡å™¨å…¨å…³äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201605790.png\" alt=\"image-20231020160510420\" /></p>\n<p>å†è®¿é—®ä¸€ä¸‹ uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDI=\">http://localhost/item.html?id=10002</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310201634990.png\" alt=\"image-20231020163445555\" /></p>\n<p>å¯ä»¥çœ‹åˆ°å¦‚æœæ²¡æœ‰å¯åŠ¨ Tomcat ä¹Ÿæ²¡äº‹å„¿å› ä¸ºå…ˆå»çœ‹äº†ä¸‹ Redis å‘ç°æœ‰ç›¸å…³æ•°æ®ç›´æ¥æ‹¿æ¥å°±ä¸æ‰¾æœåŠ¡å™¨äº†ã€‚</p>\n<h2 id=\"66-nginxæœ¬åœ°ç¼“å­˜\"><a class=\"anchor\" href=\"#66-nginxæœ¬åœ°ç¼“å­˜\">#</a> 6.6ã€Nginx æœ¬åœ°ç¼“å­˜ğŸŒ³</h2>\n<p>OPenResty ä¸º Nginx æä¾›äº† shard dict çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ Nginx çš„å¤šä¸ª worker ä¹‹é—´å…±äº«æ•°æ®ï¼Œå®ç°ç¼“å­˜åŠŸèƒ½ã€‚</p>\n<p>1ã€å¼€å¯å…±äº«å­—å…¸ï¼Œåœ¨ nginx.conf çš„ http ä¸‹æ·»åŠ é…ç½®</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># å…±äº«å­—å…¸ï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œåç§°å«åšï¼šitem_cacheï¼Œå¤§å° 150m</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">lua_shared_dict</span> item_cache <span class=\"token number\">150m</span></span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>2ã€æ“ä½œå…±äº«å­—å…¸</p>\n<p>åœ¨ item.lua æ–‡ä»¶ä¸­å¯¼å…¥</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å¯¼å…¥å…±äº«è¯å…¸ï¼Œæœ¬åœ°ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> item_cache <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>shared<span class=\"token punctuation\">.</span>item_cache</pre></td></tr></table></figure><h3 id=\"661-æ¡ˆä¾‹åœ¨æŸ¥è¯¢å•†å“æ—¶ä¼˜å…ˆæŸ¥è¯¢openrestyçš„æœ¬åœ°ç¼“å­˜\"><a class=\"anchor\" href=\"#661-æ¡ˆä¾‹åœ¨æŸ¥è¯¢å•†å“æ—¶ä¼˜å…ˆæŸ¥è¯¢openrestyçš„æœ¬åœ°ç¼“å­˜\">#</a> 6.6.1ã€æ¡ˆä¾‹ï¼Œåœ¨æŸ¥è¯¢å•†å“æ—¶ï¼Œä¼˜å…ˆæŸ¥è¯¢ OPenResty çš„æœ¬åœ°ç¼“å­˜ğŸŒ²</h3>\n<p>éœ€æ±‚ï¼š</p>\n<p>1ã€ä¿®æ”¹ item.lua ä¸­çš„ read_data å‡½æ•°ï¼Œä¼˜å…ˆæŸ¥è¯¢æœ¬åœ°ç¼“å­˜ï¼Œæœªå‘½ä¸­æ—¶åœ¨æŸ¥è¯¢ Redisï¼ŒTomcat</p>\n<p>2ã€æŸ¥è¯¢ Redis æˆ– Tomcat æˆåŠŸåï¼Œå°†æ•°æ®å†™å…¥æœ¬åœ°ç¼“å­˜ï¼Œå¹¶è®¾ç½®æœ‰æ•ˆæœŸ</p>\n<p>3ã€å•†å“åŸºæœ¬ä¿¡æ¯ï¼Œæœ‰æ•ˆæœŸ 30 åˆ†é’Ÿ</p>\n<p>4ã€åº“å­˜ä¿¡æ¯ï¼Œæœ‰æ•ˆæœŸ 1 åˆ†é’Ÿ</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- å°è£…æŸ¥è¯¢å‡½æ•°ï¼Œå…ˆæŸ¥è¯¢ redisï¼Œå¦‚æœæœªå‘½ä¸­å†æŸ¥è¯¢ tomcat</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">read_data</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> expire<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token comment\">-- æŸ¥è¯¢æœ¬åœ°ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">local</span> val <span class=\"token operator\">=</span> item_cache<span class=\"token punctuation\">:</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> val <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">-- æŸ¥è¯¢ redis</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    val <span class=\"token operator\">=</span> <span class=\"token function\">read_redis</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.249.128\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6379</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">-- åˆ¤æ–­æŸ¥è¯¢ç»“æœ</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> val <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">-- redis æŸ¥è¯¢å¤±è´¥ï¼ŒæŸ¥è¯¢ tomcat</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        val <span class=\"token operator\">=</span> <span class=\"token function\">read_http</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token comment\">-- æŸ¥è¯¢æˆåŠŸï¼ŒæŠŠæ•°æ®å†™å…¥æœ¬åœ°ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  item_cache<span class=\"token punctuation\">:</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> val<span class=\"token punctuation\">,</span> expire<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token comment\">-- è¿”å›æ•°æ®</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token keyword\">return</span> val</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>æµ‹è¯•</p>\n<p>åˆ‡æ¢åˆ° nginx ç›®å½•ä¸‹æ¥ç›‘æ§ error.log æ–‡ä»¶çš„æ‰“å°æƒ…å†µ</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\"># nginx -s reload</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\"># pwd</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>/usr/local/openresty/nginx</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\"># tail -f logs/error.log</span></pre></td></tr></table></figure><h1 id=\"ä¸ƒ-ç¼“å­˜åŒæ­¥\"><a class=\"anchor\" href=\"#ä¸ƒ-ç¼“å­˜åŒæ­¥\">#</a> ä¸ƒã€ç¼“å­˜åŒæ­¥ğŸ„</h1>\n<ul>\n<li>æ•°æ®åŒæ­¥ç­–ç•¥</li>\n<li>å®‰è£… Canal</li>\n<li>ç›‘å¬ Canal</li>\n</ul>\n<h2 id=\"71-æ•°æ®åŒæ­¥ç­–ç•¥\"><a class=\"anchor\" href=\"#71-æ•°æ®åŒæ­¥ç­–ç•¥\">#</a> 7.1ã€æ•°æ®åŒæ­¥ç­–ç•¥ğŸŒ³</h2>\n<p>ç¼“å­˜æ•°æ®åŒæ­¥çš„å¸¸è§æ–¹å¼æœ‰ä¸‰ç§ï¼š</p>\n<p><mark>1ã€è®¾ç½®æœ‰æ•ˆæœŸ</mark>ï¼šç»™ç¼“å­˜è®¾ç½®æœ‰æ•ˆæœŸï¼Œåˆ°æœŸåè‡ªåŠ¨åˆ é™¤ã€‚å†æ¬¡æŸ¥è¯¢æ—¶æ›´æ–°</p>\n<p>1.1ã€ä¼˜åŠ¿ï¼šç®€å•ï¼Œæ–¹ä¾¿</p>\n<p>1.2ã€ç¼ºç‚¹ï¼šæ—¶æ•ˆæ€§å·®ï¼Œç¼“å­˜è¿‡æœŸä¹‹å‰å¯èƒ½ä¸ä¸€è‡´</p>\n<p>1.3ã€åœºæ™¯ï¼šæ›´æ–°é¢‘ç‡è¾ƒä½ï¼Œæ—¶æ•ˆæ€§è¦æ±‚ä½çš„ä¸šåŠ¡</p>\n<p><mark>2ã€åŒæ­¥åŒå†™</mark>ï¼šåœ¨ä¿®æ”¹æ•°æ®åº“çš„åŒæ—¶ï¼Œç›´æ¥ä¿®æ”¹ç¼“å­˜</p>\n<p>2.1ã€ä¼˜åŠ¿ï¼šæ—¶æ•ˆæ€§å¼ºï¼Œç¼“å­˜ä¸æ•°æ®åº“å¼ºä¸€è‡´</p>\n<p>2.2ã€ç¼ºç‚¹ï¼šæœ‰ä»£ç ä¾µå…¥ï¼Œè€¦åˆåº¦é«˜</p>\n<p>2.3ã€åœºæ™¯ï¼šå¯¹ä¸€è‡´æ€§ï¼Œæ—¶æ•ˆæ€§è¦æ±‚è¾ƒé«˜çš„ç¼“å­˜æ•°æ®</p>\n<p><mark>3ã€å¼‚æ­¥é€šçŸ¥</mark>ï¼šä¿®æ”¹æ•°æ®åº“æ—¶å‘é€äº‹ä»¶é€šçŸ¥ï¼Œç›¸å…³æœåŠ¡ç›‘å¬åˆ°é€šçŸ¥åä¿®æ”¹ç¼“å­˜æ•°æ®</p>\n<p>3.1ã€ä¼˜åŠ¿ï¼šä½è€¦åˆï¼Œå¯ä»¥åŒæ—¶é€šçŸ¥å¤šä¸ªç¼“å­˜æœåŠ¡</p>\n<p>3.2ã€ç¼ºç‚¹ï¼šæ—¶æ•ˆæ€§ä¸€èˆ¬ï¼Œå¯èƒ½å­˜åœ¨ç»ˆæçˆ±ä½ ä¸ä¸€è‡´çŠ¶æ€</p>\n<p>3.3ã€åœºæ™¯ï¼šæ—¶æ•ˆæ€§è¦æ±‚ä¸€èˆ¬ï¼Œæœ‰å¤šä¸ªæœåŠ¡éœ€è¦åŒæ­¥</p>\n<h3 id=\"711-ç¼“å­˜åŒæ­¥ç­–ç•¥\"><a class=\"anchor\" href=\"#711-ç¼“å­˜åŒæ­¥ç­–ç•¥\">#</a> 7.1.1ã€ç¼“å­˜åŒæ­¥ç­–ç•¥ğŸŒ²</h3>\n<p>å¼‚æ­¥é€šçŸ¥å¯ä»¥ä½¿ç”¨åŸºäº MQ çš„å¼‚æ­¥é€šçŸ¥</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310210915149.png\" alt=\"image-20231021091552370\" /></p>\n<p>ä½†æ˜¯åŸºäº MQ è¿˜æ˜¯è¦ä¿®æ”¹é‡Œé¢çš„ä»£ç å‘é€æ¶ˆæ¯ï¼Œè€Œä¸‹é¢è¦è®²çš„æ˜¯åŸºäº Canal çš„å¼‚æ­¥é€šçŸ¥</p>\n<p>åŸºäº Canal çš„å¼‚æ­¥é€šçŸ¥</p>\n<p>canal å¯ä»¥å»ç›‘å¬æ•°æ®åº“çš„å˜åŒ–</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310210917386.png\" alt=\"image-20231021091750935\" /></p>\n<h3 id=\"712-åˆå§‹canal\"><a class=\"anchor\" href=\"#712-åˆå§‹canal\">#</a> 7.1.2ã€åˆå§‹ CanalğŸŒ²</h3>\n<p>Canal æ„è¯‘ä¸º æ°´é“ / ç®¡é“ / æ²Ÿæ¸ ï¼ŒCanal æ˜¯é˜¿é‡Œå·´å·´æ——ä¸‹çš„ä¸€æ¬¾å¼€æºé¡¹ç›®ï¼ŒåŸºäº Java å¼€å‘ã€‚åŸºäºæ•°æ®åº“å¢é‡æ—¥å¿—è§£æï¼Œæä¾›å¢é‡æ•°æ®è®¢é˜… &amp; æ¶ˆè´¹ã€‚GiHub åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvY2FuYWw=\">https://github.com/alibaba/canal</span></p>\n<p>Canal æ˜¯åŸºäº mysql çš„ä¸»ä»åŒæ­¥æ¥å®ç°çš„ï¼ŒMySQL ä¸»ä»åŒæ­¥çš„åŸç†å¦‚ä¸‹ï¼š</p>\n<p>master å°±æ˜¯ mysql çš„ä¸»èŠ‚ç‚¹ï¼Œslave å°±æ˜¯ mysql çš„ä»èŠ‚ç‚¹ã€‚ä¸»ä»æ•°æ®æ˜¯è¦åšåŒæ­¥çš„ï¼Œé‚£å®ƒæ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿé¦–å…ˆ mysql çš„ä¸»èŠ‚ç‚¹åœ¨åšå¢åˆ æ”¹æŸ¥æ—¶å°±å›å»è®°å½•æ—¥å¿—åˆ° binary.log æ–‡ä»¶ä¸­è¿™ä¸ªæ–‡ä»¶ç§°ä¸ºäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ã€‚å…¶ä¸­è®°å½•çš„å°±æ˜¯ binary log eventsï¼Œé‡Œé¢è®°å½•çš„å°±æ˜¯ä¸šåŠ¡ sqlã€‚slave ä¼šå¼€å¯ä¸€ä¸ªçº¿ç¨‹ä¸æ–­çš„æ¥è¯»å–è¿™ä¸ªæ—¥å¿—æ–‡ä»¶æŠŠè¿™ä¸ªæ–‡ä»¶è¯»è¿‡æ¥æ”¾åˆ°ä¸€ä¸ª relay log æ–‡ä»¶ä¸­ã€‚è¿™æ ·ä¸»èŠ‚ç‚¹åšäº†å“ªäº› sql ä»èŠ‚ç‚¹ ä¹Ÿåšå“ªäº› sql</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310210922728.png\" alt=\"image-20231021092228657\" /></p>\n<p>è€Œ Canal å°±æ˜¯æŠŠè‡ªå·±ä¼ªè£…æˆ MySQL çš„ä¸€ä¸ª Slave èŠ‚ç‚¹ï¼Œä»è€Œç›‘å¬ master çš„ binary log å˜åŒ–ã€‚å†æŠŠå¾—åˆ°çš„å˜åŒ–ä¿¡æ¯é€šçŸ¥ç»™ Canal çš„å®¢æˆ·ç«¯ï¼Œè¿›è€Œå®Œæˆå¯¹å…¶å®ƒæ•°æ®åº“çš„åŒæ­¥ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310210929872.png\" alt=\"image-20231021092859461\" /></p>\n<h3 id=\"713-canalå®‰è£…\"><a class=\"anchor\" href=\"#713-canalå®‰è£…\">#</a> 7.1.3ã€Canal å®‰è£…ğŸŒ²</h3>\n<p>æŸ¥çœ‹æ–‡ç« ï¼š<a href=\"./Canal/%E5%AE%89%E8%A3%85Canal.md\">å®‰è£… Canal</a>.</p>\n<h3 id=\"714-canalå®¢æˆ·ç«¯\"><a class=\"anchor\" href=\"#714-canalå®¢æˆ·ç«¯\">#</a> 7.1.4ã€Canal å®¢æˆ·ç«¯ğŸŒ²</h3>\n<p>Canal æä¾›äº†å„ç§è¯­è¨€çš„å®¢æˆ·ç«¯ï¼Œå½“ Canal ç›‘å¬åˆ° binlog å˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥ Canal çš„å®¢æˆ·ç«¯ã€‚ä¸è¿‡è¿™é‡Œæˆ‘ä»¬ä¼šä½¿ç”¨ Github ä¸Šçš„ç¬¬ä¸‰æ–¹å¼€æºçš„ canal-staterã€‚åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL05vcm1hbkd5bGxlbmhhYWwvY2FuYWwtY2xpZW50\">https://github.com/NormanGyllenhaal/canal-client</span></p>\n<p>å¼•å…¥ä¾èµ–ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>top.javatool<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>canal-spring-boot-starter<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.2.1-RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>ç¼–å†™é…ç½®ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">canal</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">destination</span><span class=\"token punctuation\">:</span> dkx1 <span class=\"token comment\"># canal å®ä¾‹åç§°ï¼Œè¦è·Ÿ canal-server è¿è¡Œæ—¶è®¾ç½®çš„ destiation ä¸€è‡´</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span> 192.168.249.128<span class=\"token punctuation\">:</span><span class=\"token number\">11111</span> <span class=\"token comment\"># canal åœ°å€</span></pre></td></tr></table></figure><p>ç¼–å†™ç›‘å¬å™¨ï¼Œç›‘å¬ Canal æ¶ˆæ¯ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// æŒ‡å®šè¦ç›‘å¬çš„è¡¨</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@CanalTable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tb_item\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span>                                    <span class=\"token comment\">// æŒ‡å®šè¡¨å…³è”çš„å®ä½“ç±»</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">EntryHandler</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Item</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token comment\">// ä¸‹é¢ä¸‰ä¸ªé‡å†™æ–¹æ³•æ˜¯ï¼Œç›‘å¬åˆ°æ•°æ®åº“çš„å¢åˆ æ”¹çš„æ¶ˆæ¯çš„</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">insert</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Item</span> item<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° redis</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° jvm è¿›ç¨‹ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">EntryHandler</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Item</span> before<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Item</span> after<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° redis</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° jvm è¿›ç¨‹ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">EntryHandler</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>before<span class=\"token punctuation\">,</span> after<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Item</span> item<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° redis</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° jvm è¿›ç¨‹ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">EntryHandler</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Canal æ¨é€ç»™ canal-client çš„æ˜¯è¢«ä¿®æ”¹çš„è¿™ä¸€è¡Œæ•°æ® (row) ï¼Œè€Œæˆ‘ä»¬å¼•å…¥çš„ canal-client åˆ™ä¼šå¸®æˆ‘ä»¬æŠŠè¡Œæ•°æ®å°è£…åˆ° item å®ä½“ç±»ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦çŸ¥é“æ•°æ®åº“ä¸å®ä½“çš„æ˜ å°„å…³ç³»ï¼Œè¦ç”¨åˆ° JPA çš„å‡ ä¸ªæ³¨è§£ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@TableName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tb_item\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Item</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@TableId</span><span class=\"token punctuation\">(</span>type <span class=\"token operator\">=</span> <span class=\"token class-name\">IdType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">AUTO</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// æ ‡è®°è¡¨ä¸­çš„ id å­—æ®µ</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Id</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span><span class=\"token comment\">// å•†å“ id</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> å…¶å®ƒå­—æ®µ çœç•¥</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Date</span> updateTime<span class=\"token punctuation\">;</span><span class=\"token comment\">// æ›´æ–°æ—¶é—´</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// @Transient æ ‡è®°ä¸å±äºè¡¨ä¸­çš„å­—æ®µ  å¿½ç•¥</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token annotation punctuation\">@TableField</span><span class=\"token punctuation\">(</span>exist <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@Transient</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> stock<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token annotation punctuation\">@TableField</span><span class=\"token punctuation\">(</span>exist <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token annotation punctuation\">@Transient</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> sold<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™ redis çš„ç¼“å­˜ç±» ï¼Œæ·»åŠ ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªæ–°å¢æˆ–æ›´æ–°ï¼Œä¸€ä¸ªæ˜¯åˆ é™¤</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">saveItem</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Item</span> item<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token class-name\">String</span> json <span class=\"token operator\">=</span> <span class=\"token constant\">MAPPER</span><span class=\"token punctuation\">.</span><span class=\"token function\">writeValueAsString</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item:id:\"</span> <span class=\"token operator\">+</span> item<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> json<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">JsonProcessingException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">deleteItemById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item:id:\"</span> <span class=\"token operator\">+</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®šä¹‰å®Œ redis çš„ç¼“å­˜ç±»é‡Œé¢çš„å‡½æ•°åå†å›åˆ°ç¼–å†™ç›‘å¬å™¨çš„ç±»é‡Œé¢ç¼–å†™ä»£ç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@CanalTable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tb_item\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">EntryHandler</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Item</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RedisHandler</span> redisHandler<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Cache</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">></span></span> cache<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">insert</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Item</span> item<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° jvm è¿›ç¨‹ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° redis</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        redisHandler<span class=\"token punctuation\">.</span><span class=\"token function\">saveItem</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Item</span> before<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Item</span> after<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° jvm è¿›ç¨‹ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>after<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> after<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° redis</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        redisHandler<span class=\"token punctuation\">.</span><span class=\"token function\">saveItem</span><span class=\"token punctuation\">(</span>after<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">EntryHandler</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>before<span class=\"token punctuation\">,</span> after<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Item</span> item<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° jvm è¿›ç¨‹ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        cache<span class=\"token punctuation\">.</span><span class=\"token function\">invalidate</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token comment\">// å†™æ•°æ®åˆ° redis</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        redisHandler<span class=\"token punctuation\">.</span><span class=\"token function\">deleteItemById</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token class-name\">EntryHandler</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡æŸ¥çœ‹ idea æ‰“å°ä¿¡æ¯ï¼š</p>\n<pre><code>meters: 10005(Long)\n14:50:32:387 DEBUG 4956 --- [nio-8081-exec-7] c.h.i.mapper.ItemStockMapper.selectById  : &lt;==      Total: 1\n14:50:32:472  INFO 4956 --- [l-client-thread] t.j.c.client.client.AbstractCanalClient  : è·å–æ¶ˆæ¯ Message[id=-1,entries=[],raw=false,rawEntries=[]]\n14:50:34:474  INFO 4956 --- [l-client-thread] t.j.c.client.client.AbstractCanalClient  : è·å–æ¶ˆæ¯ Message[id=-1,entries=[],raw=false,rawEntries=[]]\n14:50:36:477  INFO 4956 --- [l-client-thread] t.j.c.client.client.AbstractCanalClient  : è·å–æ¶ˆæ¯ Message[id=-1,entries=[],raw=false,rawEntries=[]]\n14:50:38:478  INFO 4956 --- [l-client-thread] t.j.c.client.client.AbstractCanalClient  : è·å–æ¶ˆæ¯ Message[id=-1,entries=[],raw=false,rawEntries=[]]\n14:50:40:472  INFO 4956 --- [l-client-thread] t.j.c.client.client.AbstractCanalClient  : è·å–æ¶ˆæ¯ Message[id=-1,entries=[],raw=false,rawEntries=[]]\n</code></pre>\n<p>è¡¨ç¤º canal ä¸ java æˆåŠŸçš„è¿æ¥åˆ°äº†</p>\n<p>é‚£ä¹ˆæµ‹è¯•ä¸€ä¸‹æ•°æ®åŒæ­¥æ‰“å¼€ 8081 ç«¯å£çš„é¡µé¢</p>\n<p>æ¯”å¦‚è¯´ä¿®æ”¹ 10001 è¿™ä¸ªå•†å“çš„æ•°æ®ï¼š</p>\n<p>åŸæ¥çš„æ•°æ®å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211452116.png\" alt=\"image-20231021145237319\" /></p>\n<p>ä¿®æ”¹åçš„æ•°æ®å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211453292.png\" alt=\"image-20231021145302067\" /></p>\n<p>ç‚¹å‡»ç¡®å®š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211453164.png\" alt=\"image-20231021145357351\" /></p>\n<p>å†æŸ¥çœ‹ idea çš„æ§åˆ¶å°ä¿¡æ¯ï¼š</p>\n<p>å¯ä»¥çœ‹åˆ°æ‰“å°äº†ä¸€å †æ—¥å¿—ä¿¡æ¯</p>\n<pre><code>  version: 1\n  logfileName: &quot;mysql-bin.000006&quot;\n  logfileOffset: 1173\n  serverId: 1000\n  serverenCode: &quot;UTF-8&quot;\n  executeTime: 1697871191000\n  sourceType: MYSQL\n  schemaName: &quot;&quot;\n  tableName: &quot;&quot;\n  eventLength: 91\n&#125;\nentryType: TRANSACTIONBEGIN\nstoreValue: &quot; H&quot;\n, header &#123;\n  version: 1\n  logfileName: &quot;mysql-bin.000006&quot;\n  logfileOffset: 1344\n  serverId: 1000\n  serverenCode: &quot;UTF-8&quot;\n  executeTime: 1697871191000\n  sourceType: MYSQL\n  schemaName: &quot;dkx&quot;\n  tableName: &quot;tb_item&quot;\n  eventLength: 620\n  eventType: UPDATE\n  props &#123;\n    key: &quot;rowsCount&quot;\n    value: &quot;1&quot;\n  &#125;\n&#125;\nentryType: ROWDATA\nstoreValue: &quot;\\b_\\020\\002P\\000b\\324\\n\\n&amp;\\b\\000\\020\\373\\377\\377\\377\\377\\377\\377\\377\\377\\001\\032\\002id \\001(\\0000\\000B\\00510001R\\006bigint\\nd\\b\\001\\020\\f\\032\\005title \\000(\\0000\\000BCRIMOWA 21\\345\\257\\270\\346\\211\\230\\350\\277\\220\\347\\256\\261\\346\\213\\211\\346\\235\\206\\347\\256\\261 SALSA AIR\\347\\263\\273\\345\\210\\227\\346\\236\\234\\347\\273\\277\\350\\211\\262 820.70.36.4R\\fvarchar(264)\\n)\\b\\002\\020\\f\\032\\004name \\000(\\0000\\000B\\tSALSA AIRR\\fvarchar(128)\\n)\\b\\003\\020\\373\\377\\377\\377\\377\\377\\377\\377\\377\\001\\032\\005price \\000(\\0000\\000B\\00516900R\\006bigint\\n\\226\\001\\b\\004\\020\\f\\032\\005image \\000(\\0000\\000Buhttps://m.360buyimg.com/mobilecms/s720x720_jfs/t6934/364/1195375010/84676/e9f2c55f/597ece38N0ddcbc77.jpg!q70.jpg.webpR\\fvarchar(200)\\n-\\b\\005\\020\\f\\032\\bcategory \\000(\\0000\\000B\\t\\346\\213\\211\\346\\235\\206\\347\\256\\261R\\fvarchar(200)\\n\\'\\b\\006\\020\\f\\032\\005brand \\000(\\0000\\000B\\006RIMOWAR\\fvarchar(100)\\nG\\b\\a\\020\\f\\032\\004spec \\000(\\0000\\000B\\'&#123;\\&quot;\\351\\242\\234\\350\\211\\262\\&quot;: \\&quot;\\347\\272\\242\\350\\211\\262\\&quot;, \\&quot;\\345\\260\\272\\347\\240\\201\\&quot;: \\&quot;26\\345\\257\\270\\&quot;&#125;R\\fvarchar(200)\\n\\032\\b\\b\\020\\004\\032\\006status \\000(\\0000\\000B\\0011R\\003int\\n6\\b\\t\\020]\\032\\vcreate_time \\000(\\0000\\000B\\0232019-05-01 00:00:00R\\bdatetime\\n6\\b\\n\\020]\\032\\vupdate_time \\000(\\0000\\000B\\0232019-05-01 00:00:00R\\bdatetime\\022&amp;\\b\\000\\020\\373\\377\\377\\377\\377\\377\\377\\377\\377\\001\\032\\002id \\001(\\0000\\000B\\00510001R\\006bigint\\022d\\b\\001\\020\\f\\032\\005title \\000(\\0000\\000BCRIMOWA 21\\345\\257\\270\\346\\211\\230\\350\\277\\220\\347\\256\\261\\346\\213\\211\\346\\235\\206\\347\\256\\261 SALSA AIR\\347\\263\\273\\345\\210\\227\\346\\236\\234\\347\\273\\277\\350\\211\\262 820.70.36.4R\\fvarchar(264)\\022)\\b\\002\\020\\f\\032\\004name \\000(\\0000\\000B\\tSALSA AIRR\\fvarchar(128)\\022)\\b\\003\\020\\373\\377\\377\\377\\377\\377\\377\\377\\377\\001\\032\\005price \\000(\\0010\\000B\\00528900R\\006bigint\\022\\226\\001\\b\\004\\020\\f\\032\\005image \\000(\\0000\\000Buhttps://m.360buyimg.com/mobilecms/s720x720_jfs/t6934/364/1195375010/84676/e9f2c55f/597ece38N0ddcbc77.jpg!q70.jpg.webpR\\fvarchar(200)\\022-\\b\\005\\020\\f\\032\\bcategory \\000(\\0000\\000B\\t\\346\\213\\211\\346\\235\\206\\347\\256\\261R\\fvarchar(200)\\022\\'\\b\\006\\020\\f\\032\\005brand \\000(\\0000\\000B\\006RIMOWAR\\fvarchar(100)\\022G\\b\\a\\020\\f\\032\\004spec \\000(\\0010\\000B\\'&#123;\\&quot;\\351\\242\\234\\350\\211\\262\\&quot;: \\&quot;\\347\\272\\242\\350\\211\\262\\&quot;, \\&quot;\\345\\260\\272\\347\\240\\201\\&quot;: \\&quot;33\\345\\257\\270\\&quot;&#125;R\\fvarchar(200)\\022\\032\\b\\b\\020\\004\\032\\006status \\000(\\0000\\000B\\0011R\\003int\\0226\\b\\t\\020]\\032\\vcreate_time \\000(\\0000\\000B\\0232019-05-01 00:00:00R\\bdatetime\\0226\\b\\n\\020]\\032\\vupdate_time \\000(\\0000\\000B\\0232019-05-01 00:00:00R\\bdatetime&quot;\n],raw=false,rawEntries=[]]\n</code></pre>\n<p>æˆ‘ä»¬å†å»è®¿é—®å•†å“æ•°æ®çš„å±•ç¤ºé¡µé¢æŸ¥çœ‹æ•°æ®æ˜¯å¦è¢«ä¿®æ”¹äº†</p>\n<p>è®¿é—® uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9pdGVtLmh0bWw/aWQ9MTAwMDEjaW5kZXg=\">http://localhost/item.html?id=10001#index</span></p>\n<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªé¡µé¢çš„æ•°æ®ä¹Ÿè¢«ä¿®æ”¹äº†è¯´æ˜ç¼“å­˜åŒæ­¥æˆåŠŸäº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211504526.png\" alt=\"image-20231021150447258\" /></p>\n<h1 id=\"å…«-æ€»ç»“å¤šçº§ç¼“å­˜æ¶æ„\"><a class=\"anchor\" href=\"#å…«-æ€»ç»“å¤šçº§ç¼“å­˜æ¶æ„\">#</a> å…«ã€æ€»ç»“å¤šçº§ç¼“å­˜æ¶æ„ğŸ„</h1>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211510207.png\" alt=\"image-20231021151019996\" /></p>\n<p>æœ‰ä¸€ä¸ªé¡µé¢å« item.html æ”¾åˆ°äº† windows çš„ nginx æœåŠ¡å™¨ä¸Šã€‚å®ƒçš„ ä¸»è¦ä½œç”¨å°±æ˜¯ä¸€ä¸ªé™æ€èµ„æºæœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨ã€‚å½“ç”¨æˆ·é€šè¿‡æµè§ˆå™¨æ¥è¯·æ±‚å®ƒæ—¶å®ƒå°±å¯ä»¥æŠŠé¡µé¢è¿”å›ç»™ç”¨æˆ·è€Œæµè§ˆå™¨åœ¨æ¸²æŸ“æ—¶å‘ç°ç¼ºå°‘æ•°æ®å°±ä¼šå‘é€ ajax è¯·æ±‚æ¥æŸ¥è¯¢æ•°æ®ã€‚æŸ¥è¯¢åœ°å€å°±æ˜¯ item/10001 è¿™æ—¶çš„ nginx åå‘ä»£ç†æœåŠ¡å™¨ä¸å›å»å¤„ç†ä¸šåŠ¡ï¼Œåªæ˜¯åšåå‘ä»£ç†ï¼Œæ‰€ä»¥å®ƒä¼šæŠŠè¯·æ±‚ä»£ç†ç»™ OPenResty é›†ç¾¤ï¼Œæƒ³è¦å»æŸ¥è¯¢æ•°æ®åˆæœ‰å…ˆå»æœ¬åœ°å¦‚æœæœ‰åˆ™ç›´æ¥è¿”å›ï¼Œæœ¬åœ°å…±äº«è¯å…¸æ•°æ®åªèƒ½åœ¨å½“å‰ nginx ä¸­ä½¿ç”¨ã€‚å¦‚æœæˆ‘ä»¬éƒ¨ç½²æˆ OPenResty é›†ç¾¤å®ƒä»¬ä¹‹é—´çš„å†…å­˜æ˜¯ä¸å…±äº«çš„ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿå¯ä»¥é‡‡ç”¨é€šè¿‡ id è®¡ç®— hash æ¥è·¯ç”±æŒ‡å®šé›†ç¾¤æœåŠ¡å™¨çš„æ–¹å¼è¿™æ ·å°±ä¼šä¿è¯ OPenResty ç¼“å­˜ä¸€ç›´ç”Ÿæ•ˆã€‚æœ¬åœ°ç¼“å­˜å¦‚æœæœªå‘½ä¸­åˆ™å»æŸ¥è¯¢ redis ç¼“å­˜ï¼Œå‘½ä¸­åˆ™è¿”å›ï¼Œæœªå‘½ä¸­åˆ™æŸ¥è¯¢ tomcatã€‚æŸ¥è¯¢ tomcat ä¹Ÿæ˜¯é›†ç¾¤ä¹Ÿåšäº† jvm è¿›ç¨‹ç¼“å­˜ï¼Œtomcat æœåŠ¡å™¨ä¹‹é—´æ˜¯ä¸å…±äº«å†…å­˜çš„æ‰€ä»¥è¿˜éœ€è¦ä½¿ç”¨é€šè¿‡ id è®¡ç®— hash å€¼çš„æ–¹å¼æ¥è·¯ç”±æŒ‡å®š tomcat æœåŠ¡å™¨</p>\n<p>é‚£ä¹ˆå¤šçº§ç¼“å­˜å®Œæˆåå°±ä¼šé¢ä¸´ä¸€ä¸ªé—®é¢˜å°±æ˜¯æ•°æ®åŒæ­¥çš„é—®é¢˜ã€‚</p>\n<p>mysql çš„æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ redis å’Œ tomcat è¿›ç¨‹ç¼“å­˜å’Œ nginx ç¼“å­˜éƒ½éœ€è¦åšåŒæ­¥</p>\n<p>åœ¨ OPenResty ä¸­ä½¿ç”¨çš„è¶…æ—¶åŒæ­¥ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´è¿‡æœŸè‡ªåŠ¨åˆ é™¤å°±å˜æˆæ–°æ•°æ®äº†ï¼Œè¿™ç§æ–¹å¼é€‚åˆäºæ›´æ–°é¢‘ç‡è¾ƒä½çš„æ•°æ®</p>\n<p>è€Œ redis ä¸ mysql ä¹‹é—´çš„æ•°æ®åŒæ­¥é‡‡ç”¨äº† canal ç›‘å¬ mysql çš„æ–¹å¼</p>\n<h1 id=\"ä¹-æœåŠ¡å¼‚æ­¥é€šè®¯\"><a class=\"anchor\" href=\"#ä¹-æœåŠ¡å¼‚æ­¥é€šè®¯\">#</a> ä¹ã€æœåŠ¡å¼‚æ­¥é€šè®¯ğŸ„</h1>\n<p>é«˜çº§ç¯‡ - rabbitmq çš„é«˜çº§ç‰¹æ€§</p>\n<p>æˆ‘ä»¬å·²ç»å­¦ä¹ è¿‡å®ƒçš„åŸºæœ¬ç”¨æ³•äº†ï¼Œå­¦ä¹ äº†å¦‚ä½•åˆ©ç”¨ springamqp æ”¶å’Œå‘æ¶ˆæ¯ï¼Œä½†æ˜¯æ”¶å’Œå‘æ¶ˆæ¯åªæ˜¯ mq çš„æœ€åŸºæœ¬çš„åŠŸèƒ½ã€‚å› ä¸ºåœ¨æ”¶å’Œå‘æ¶ˆæ¯çš„è¿‡ç¨‹å½“ä¸­è¿˜æœ‰å¾ˆå¤šé—®é¢˜éœ€è¦æ€è€ƒéœ€è¦å»è§£å†³è¿™æ—¶å°±éœ€è¦ä½¿ç”¨ mq çš„é«˜çº§ç‰¹æ€§å»è§£å†³äº†</p>\n<p>MQ çš„ä¸€äº›å¸¸è§é—®é¢˜</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211532979.png\" alt=\"image-20231021153238893\" /></p>\n<p>å­¦ä¹ å†…å®¹ï¼š</p>\n<ul>\n<li>æ¶ˆæ¯å¯é æ€§</li>\n<li>æ­»ä¿¡äº¤æ¢æœº</li>\n<li>æƒ°æ€§é˜Ÿåˆ—</li>\n<li>MQ é›†ç¾¤</li>\n</ul>\n<h2 id=\"91-æ¶ˆæ¯å¯é æ€§é—®é¢˜\"><a class=\"anchor\" href=\"#91-æ¶ˆæ¯å¯é æ€§é—®é¢˜\">#</a> 9.1ã€æ¶ˆæ¯å¯é æ€§é—®é¢˜ğŸŒ³</h2>\n<p>æ¶ˆæ¯ä»ç”Ÿäº§è€…å‘é€åˆ° exchangeï¼Œå†åˆ° queueï¼Œå†åˆ°æ¶ˆè´¹è€…ï¼Œæœ‰å“ªäº›å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±çš„å¯èƒ½æ€§ï¼Ÿ</p>\n<p>å…ˆæ¥æ¸©ä¹ ä¸€ä¸‹ mq çš„æ•´ä¸ªæµç¨‹</p>\n<p>æ¶ˆæ¯çš„å‘é€è€…ç§°ä¸º publisherï¼Œå®ƒæŠŠæ¶ˆæ¯æŠ•é€’ç»™äº¤æ¢æœº exchangeï¼Œè€Œäº¤æ¢æœºä¼šæ ¹æ® routingkey å°†æ¶ˆæ¯è·¯ç”±åˆ°é˜Ÿåˆ— queue ä¸­ï¼Œè€Œé˜Ÿåˆ—å†æŠŠæ¶ˆæ¯æŠ•é€’ç»™æ¶ˆè´¹è€… consumer</p>\n<p>åœ¨æ•´ä¸ªè¿™æ ·çš„æµç¨‹å½“ä¸­æ¶ˆæ¯å¯èƒ½ä¼šå‘ç”Ÿä¸¢å¤±</p>\n<ul>\n<li>å‘é€æ—¶ä¸¢å¤±ï¼š\n<ul>\n<li>ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯æœªé€è¾¾ exchange</li>\n<li>æ¶ˆæ¯åˆ°è¾¾ exchange åæœªè¾¾åˆ° queue</li>\n</ul>\n</li>\n<li>MQ å®•æœºï¼Œqueue å°†æ¶ˆæ¯ä¸¢å¤±</li>\n<li>consumer æ¥æ”¶åˆ°æ¶ˆæ¯åæœªæ¶ˆæ¯å°±å®•æœº</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211536652.png\" alt=\"image-20231021153606449\" /></p>\n<p>é’ˆå¯¹ä¸Šè¿°é—®é¢˜æˆ‘ä»¬æ¥å­¦ä¹ å¦‚ä¸‹å†…å®¹ï¼š</p>\n<ul>\n<li>ç”Ÿäº§è€…æ¶ˆæ¯ç¡®è®¤</li>\n<li>æ¶ˆæ¯æŒä¹…åŒ–</li>\n<li>æ¶ˆè´¹è€…æ¶ˆæ¯ç¡®è®¤</li>\n<li>æ¶ˆè´¹å¤±è´¥é‡è¯•æœºåˆ¶</li>\n</ul>\n<h3 id=\"911-ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶\"><a class=\"anchor\" href=\"#911-ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶\">#</a> 9.1.1ã€ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶ğŸŒ²</h3>\n<p>RabbitMQ æä¾›äº† publisher confirm æœºåˆ¶æ¥é¿å…æ¶ˆæ¯å‘é€åˆ° MQ è¿‡ç¨‹ä¸­ä¸¢å¤±ã€‚æ¶ˆæ¯å‘é€åˆ° MQ ä»¥åï¼Œä¼šè¿”å›ä¸€ä¸ªç»“æœç»™å‘é€è€…ï¼Œè¡¨ç¤ºæ¶ˆæ¯æ˜¯å¦å¤„ç†æˆåŠŸã€‚ç»“æœæœ‰ä¸¤ç§è¯·æ±‚ï¼š</p>\n<ul>\n<li>publisher-confirmï¼Œå‘é€è€…ç¡®è®¤\n<ul>\n<li>æ¶ˆæ¯æˆåŠŸæŠ•é€’åˆ°äº¤æ¢æœºï¼Œè¿”å› ack</li>\n<li>æ¶ˆæ¯æœªæŠ•é€’åˆ°äº¤æ¢æœºï¼Œè¿”å› nack</li>\n</ul>\n</li>\n<li>publisher-returnï¼Œå‘é€è€…å›æ‰§\n<ul>\n<li>æ¶ˆæ¯æŠ•é€’åˆ°äº¤æ¢æœºäº†ï¼Œä½†æ˜¯æ²¡æœ‰è·¯ç”±åˆ°é˜Ÿåˆ—ã€‚è¿”å› ACKï¼ŒåŠè·¯ç”±å¤±è´¥åŸå› ã€‚</li>\n</ul>\n</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211546864.png\" alt=\"image-20231021154614145\" /></p>\n<blockquote>\n<p>&lt;font color='red'&gt; æ³¨æ„ &lt;/font&gt;ï¼š</p>\n<p>ç¡®è®¤æœºåˆ¶å‘é€æ¶ˆæ¯æ—¶ï¼Œéœ€è¦ç»™æ¯ä¸ªæ¶ˆæ¯è®¾ç½®ä¸€ä¸ªå…¨å±€å”¯ä¸€ idï¼Œä»¥åŒºåˆ†ä¸åŒæ¶ˆæ¯ï¼Œé¿å… ack å†²çª</p>\n</blockquote>\n<p>å¼•å…¥ demo å·¥ç¨‹</p>\n<p>é¦–å…ˆï¼Œéœ€è¦å¼•å…¥é¡¹ç›®ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZG91a2FpeGluL3R5cG9yYS5naXQ=\">https://gitee.com/doukaixin/typora.git</span></p>\n<p>æ‹‰å–åˆ†æ”¯ï¼šmq-advanced-demo ä»£ç æ¼”ç¤º</p>\n<h2 id=\"92-springamqpå®ç°ç”Ÿäº§è€…ç¡®è®¤\"><a class=\"anchor\" href=\"#92-springamqpå®ç°ç”Ÿäº§è€…ç¡®è®¤\">#</a> 9.2ã€SpringAMQP å®ç°ç”Ÿäº§è€…ç¡®è®¤ğŸŒ³</h2>\n<p>1ã€åœ¨ publisher è¿™ä¸ªå¾®æœåŠ¡çš„ applicaiton.yml ä¸­æ·»åŠ é…ç½®ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">rabbitmq</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> 192.168.249.128 <span class=\"token comment\"># rabbitMQ çš„ ip åœ°å€</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5672</span> <span class=\"token comment\"># ç«¯å£</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> itcast</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123321</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">virtual-host</span><span class=\"token punctuation\">:</span> /</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">#------------------------------------</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">publisher-confirm-type</span><span class=\"token punctuation\">:</span> correlated</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">publisher-returns</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token key atrule\">mandatory</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr></table></figure><p>é…ç½®è¯´æ˜ï¼š</p>\n<ul>\n<li>publishe-confirm-typeï¼šå¼€å¯ publisher-confirmï¼Œè¿™é‡Œæ”¯æŒä¸¤ç§ç±»å‹ï¼š\n<ul>\n<li>simpleï¼šåŒæ­¥ç­‰å¾… confirm ç»“æœï¼Œç›´åˆ°è¶…æ—¶</li>\n<li>correlatedï¼šå¼‚æ­¥å›è°ƒï¼Œå®šä¹‰ ConfirmCallbackï¼ŒMQ è¿”å›ç»“æœæ—¶ä¼šå›è°ƒè¿™ä¸ª ConfirmCallback</li>\n</ul>\n</li>\n<li>publish-returnsï¼šå¼€å¯ publish-return åŠŸèƒ½ï¼ŒåŒæ ·æ˜¯åŸºäº callback æœºåˆ¶ï¼Œä¸è¿‡æ˜¯å®šä¹‰ ReturnCallback</li>\n<li>template.mandatoryï¼šå®šä¹‰æ¶ˆæ¯è·¯ç”±å¤±è´¥æ—¶çš„ç­–ç•¥ã€‚trueï¼Œåˆ™è°ƒç”¨ ReturnCallback; falseï¼šåˆ™ç›´æ¥ä¸¢å¼ƒæ¶ˆæ¯</li>\n</ul>\n<p>2ã€æ¯ä¸ª RabbitTemplate åªèƒ½é…ç½®ä¸€ä¸ª ReturnCallbackï¼Œå› æ­¤éœ€è¦åœ¨é¡¹ç›®å¯åŠ¨è¿‡ç¨‹ä¸­é…ç½®ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//                         å®ç° Spring å·¥å‚çš„é€šçŸ¥</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CommonConfig</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ApplicationContextAware</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// é‡å†™ Bean å·¥å‚å‡†å¤‡å¥½åè°ƒç”¨çš„å‡½æ•°</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ApplicationContext</span> applicationContext<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// å–å‡º RabbitTempalte çš„ Bean</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">RabbitTemplate</span> rabbitTemplate <span class=\"token operator\">=</span> applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RabbitTemplate</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// é…ç½® ReturnCallback</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setReturnCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">,</span> s1<span class=\"token punctuation\">,</span> s2<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token comment\">// è®°å½•æ—¥å¿— &#123;&#125; ä¸ºå ä½ç¬¦</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—å¤±è´¥ï¼Œå“åº”ç ï¼š&#123;&#125;ï¼Œå¤±è´¥åŸå› ï¼š&#123;&#125;ï¼Œ\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                    <span class=\"token string\">\"äº¤æ¢æœºï¼š&#123;&#125;ï¼Œè·¯ç”±keyï¼š&#123;&#125;ï¼Œæ¶ˆæ¯ï¼š&#123;&#125;\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                    i<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">,</span> s1<span class=\"token punctuation\">,</span> s2<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token comment\">// å¦‚æœæœ‰éœ€è¦çš„è¯ï¼Œé‡å‘æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>returncallback æ˜¯ exchange è·¯ç”±ä¸åˆ° queue æ—¶ï¼Œæ‰è§¦å‘çš„å›è°ƒ</p>\n<p>confirmcallback æ˜¯åœ¨æ¶ˆæ¯è¾¾ä¸åˆ°äº¤æ¢æœºæ—¶ï¼Œæ‰å›è°ƒ</p>\n<p>3ã€å‘é€æ¶ˆæ¯ï¼ŒæŒ‡å®šæ¶ˆæ¯ IDï¼Œæ¶ˆæ¯ ConfirmCallback</p>\n<p>å…ˆä½¿ç”¨ test ä»£ç è¿›è¡Œä¸€ä¸‹æµ‹è¯•</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211718275.png\" alt=\"image-20231021171827222\" /></p>\n<p>å‘é€æ¶ˆæ¯çš„ä»£ç ä¸­ï¼Œæœ‰ äº¤æ¢æœºï¼Œä½†æ˜¯ Routingkey ä¸å­˜åœ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»åˆ›å»ºä¸€ä¸‹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211719943.png\" alt=\"image-20231021171807188\" /></p>\n<p>ç‚¹å‡» bind</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211719018.png\" alt=\"image-20231021171942977\" /></p>\n<p>ä½†æ˜¯ï¼åœ¨å‘é€æ¶ˆæ¯çš„æµ‹è¯•ä»£ç ä¸­ä»¥å‰æ˜¯é‚£æ ·å†™çš„ï¼Œä½†æ˜¯ç°åœ¨è¦åšæ¶ˆæ¯ç¡®è®¤æœºåˆ¶æ‰€ä»¥å°±è¦å¤šä¼ é€’ä¸€ä¸ªå‚æ•°äº†</p>\n<p>æµ‹è¯•ä»£ç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@RunWith</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SpringRunner</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootTest</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SpringAmqpTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RabbitTemplate</span> rabbitTemplate<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testSendMessage2SimpleQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">String</span> routingKey <span class=\"token operator\">=</span> <span class=\"token string\">\"simple.test\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// 1. å‡†å¤‡æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">String</span> message <span class=\"token operator\">=</span> <span class=\"token string\">\"hello, spring amqp!\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">// 1.1. å‡†å¤‡ CorrelationData</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// 1.2. æ¶ˆæ¯ ID</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">CorrelationData</span> correlationData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CorrelationData</span><span class=\"token punctuation\">(</span><span class=\"token constant\">UUID</span><span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// 1.3. å‡†å¤‡ ConfirmCallback</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// æˆåŠŸçš„å›è°ƒå‡½æ•°</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        correlationData<span class=\"token punctuation\">.</span><span class=\"token function\">getFuture</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addCallback</span><span class=\"token punctuation\">(</span>confirm <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token comment\">// åˆ¤æ–­ç»“æœ</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>confirm<span class=\"token punctuation\">.</span><span class=\"token function\">isAck</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token comment\">// ACK</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                log<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆæ¯æˆåŠŸæŠ•é€’åˆ°äº¤æ¢æœº ï¼æ¶ˆæ¯ID: &#123;&#125;\"</span><span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token comment\">// NACK</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆæ¯æŠ•é€’åˆ°äº¤æ¢æœºå¤±è´¥äº† ï¼ æ¶ˆæ¯ID: &#123;&#125;\"</span><span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token comment\">// é‡å‘æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token comment\">// å¤±è´¥çš„å›è°ƒå‡½æ•°</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> throwable <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token comment\">// è®°å½•æ—¥å¿—</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆæ¯å‘é€å¤±è´¥ ! \"</span><span class=\"token punctuation\">,</span> throwable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token comment\">// é‡å‘æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token comment\">// 2. å‘é€æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"amq.topic\"</span><span class=\"token punctuation\">,</span> routingKey<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">,</span>correlationData <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿è¡Œè¿™ä¸ªæµ‹è¯•ä»£ç </p>\n<p>idea æ§åˆ¶å°æ‰“å°ä¿¡æ¯å¦‚ä¸‹ï¼š</p>\n<pre><code>æ¶ˆæ¯æˆåŠŸæŠ•é€’åˆ°äº¤æ¢æœº ï¼æ¶ˆæ¯ID: a4abf2f4-85f5-4fdc-bb73-7be9ab91b6bd\n</code></pre>\n<p>æŸ¥çœ‹æ¶ˆæ¯é˜Ÿåˆ—æ˜¯å¦æ¥å—åˆ°äº†ä¸€ä¸ªæ¶ˆæ¯å¹¶æŸ¥çœ‹å†…å®¹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211737447.png\" alt=\"image-20231021173713091\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211737796.png\" alt=\"image-20231021173730615\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>SpringAMQP ä¸­å¤„ç†æ¶ˆæ¯ç¡®è®¤çš„å‡ ç§æƒ…å†µï¼š</p>\n<ul>\n<li>publisher-confirm\n<ul>\n<li>æ¶ˆæ¯æˆåŠŸå‘é€åˆ° exchangeï¼Œè¿”å› ack</li>\n<li>æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œæ²¡æœ‰åˆ°è¾¾äº¤æ¢æœºï¼Œè¿”å› nack</li>\n<li>æ¶ˆæ¯å‘é€è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œæ²¡æœ‰æ”¶åˆ°å›æ‰§</li>\n</ul>\n</li>\n<li>æ¶ˆæ¯æˆåŠŸå‘é€åˆ° exchangeï¼Œä½†æ²¡æœ‰è·¯ç”±åˆ° queue\n<ul>\n<li>è°ƒç”¨ ReturnCallback</li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<p>ä»¥ä¸Šå°±æ˜¯ç”Ÿäº§ç¡®è®¤çš„æœºåˆ¶äº†ã€‚é€šè¿‡è¿™äº›æœºåˆ¶å°±èƒ½å¤Ÿç¡®è®¤æ¶ˆæ¯ èƒ½å¤Ÿåˆ°è¾¾æ¶ˆæ¯é˜Ÿåˆ—</p>\n<h2 id=\"93-æ¶ˆæ¯æŒä¹…åŒ–\"><a class=\"anchor\" href=\"#93-æ¶ˆæ¯æŒä¹…åŒ–\">#</a> 9.3ã€æ¶ˆæ¯æŒä¹…åŒ–ğŸŒ³</h2>\n<p>ç”±äº RabbitMQ é»˜è®¤æ˜¯å†…å­˜å­˜å‚¨ï¼Œå¦‚æœæ­¤æ—¶ mq å‘ç”Ÿäº†å®•æœºï¼Œæ¶ˆæ¯ä¹Ÿæ˜¯æœ‰å¯èƒ½ä¸¢å¤±çš„ã€‚è¦æƒ³è®©æ¶ˆæ¯çœŸæ­£å®‰å…¨ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿è¿™ä¸ªæ¶ˆæ¯èƒ½å¤Ÿåšåˆ°æŒä¹…åŒ–ã€‚ä¹Ÿå°±æ˜¯æŠŠå®ƒå†™å…¥åˆ°ç£ç›˜ä¸­</p>\n<p>åœ¨æ¶ˆè´¹è€…çš„ config ç±»ä¸­è¿›è¡Œé…ç½®</p>\n<p>1ã€äº¤æ¢æœºæŒä¹…åŒ–ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">DirectExchange</span> <span class=\"token function\">simpleExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// ä¸‰ä¸ªå‚æ•°ï¼šäº¤æ¢æœºåç§°ï¼Œæ˜¯å¦æŒä¹…åŒ–ï¼Œå½“æ²¡æœ‰ queue ä¸å…¶ç»‘å®šæ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DirectExchange</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"simple.direct\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>2ã€é˜Ÿåˆ—æŒä¹…åŒ–</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">simpleQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// ä½¿ç”¨ QueueBuilder æ„å»ºé˜Ÿåˆ—ï¼Œdurable å°±æ˜¯æŒä¹…åŒ–çš„</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token class-name\">QueueBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">durable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"simple.queue\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡è¿›è¡Œæµ‹è¯•ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>\n<p>é˜Ÿåˆ—</p>\n<p>å…¶ä¸­çš„ D å°±æ˜¯ durable å°±æ˜¯æŒä¹…åŒ–çš„æ„æ€</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211756121.png\" alt=\"image-20231021175655932\" /></p>\n<p>äº¤æ¢æœº</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211759449.png\" alt=\"image-20231021175939976\" /></p>\n<p>å…³é—­æ‰€æœ‰æœåŠ¡å™¨</p>\n<p>å‘é€ä¸€ä¸‹æ¶ˆæ¯è¿›è¡Œæµ‹è¯•ä¸€ä¸‹æ¶ˆæ¯æ˜¯å¦ä¹Ÿèƒ½æŒä¹…åŒ–</p>\n<p>æˆ‘ä»¬å‘ simple.queue ä¸­å‘é€ä¸€æ¡æ¶ˆæ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211831349.png\" alt=\"image-20231021183122204\" /></p>\n<p>æ­¤æ—¶é˜Ÿåˆ—ä¸­å°±ä¼šå­˜ç•™ä¸€æ¡æ¶ˆæ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211833155.png\" alt=\"image-20231021183339726\" /></p>\n<p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬é˜Ÿåˆ—é‡Œé¢æœ‰æ¶ˆæ¯äº†ï¼Œå¹¶ä¸”é˜Ÿåˆ—å·²ç»æŒä¹…åŒ–äº†ï¼Œæˆ‘ä»¬å†å»é‡å¯ mq æ¥æµ‹è¯•ä¸€ä¸‹</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker restart mq</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>mq</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>å›åˆ°é¡µé¢ä¸­è¿›è¡ŒæŸ¥çœ‹</p>\n<p>å¯ä»¥çœ‹åˆ°æ¶ˆæ¯ æ²¡äº†ï¼</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211835842.png\" alt=\"image-20231021183522398\" /></p>\n<p>è¿™å°±è¯æ˜æ¶ˆæ¯æ²¡æœ‰æŒä¹…åŒ–ï¼Œé‚£æˆ‘ä»¬çš„ç›®çš„æ˜¯è®©æ¶ˆæ¯ä¹Ÿèƒ½æŒä¹…å•Šï¼Œé‚£æ€ä¹ˆåŠï¼Ÿ</p>\n<p>3ã€æ¶ˆæ¯æŒä¹…åŒ–ï¼ŒSpringAMQP ä¸­çš„æ¶ˆæ¯é»˜è®¤æ˜¯æŒä¹…çš„ï¼Œå¯ä»¥é€šè¿‡ MessageProperties ä¸­çš„ DeliveryMode æ¥æŒ‡å®šï¼š</p>\n<p>åœ¨æµ‹è¯•ä»£ç ä¸­è¿›è¡Œç¼–å†™ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testDurableMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">Message</span> message <span class=\"token operator\">=</span> <span class=\"token class-name\">MessageBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">withBody</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello, spring\"</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                                             <span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// æ¶ˆæ¯ä½“</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">setDeliveryMode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageDeliveryMode</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PERSISTENT</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// æŒä¹…åŒ–</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">// 2. å‘é€æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"simple.queue\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨æˆåŠŸåæŸ¥çœ‹é˜Ÿåˆ—æƒ…å†µï¼š</p>\n<p>å¯ä»¥çœ‹åˆ°é˜Ÿåˆ—ä¸­å°±æœ‰äº†ä¸€æ¡æ¶ˆæ¯äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211842026.png\" alt=\"image-20231021184255870\" /></p>\n<p>åœ¨é˜Ÿåˆ—çš„è¯¦æƒ…é¡µé¢é‡Œé¢çš„ get message ä¸­å¯ä»¥çœ‹åˆ° delivery_modeï¼š2 è¡¨ç¤ºæ¶ˆæ¯æŒä¹…åŒ–</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211844251.png\" alt=\"image-20231021184420061\" /></p>\n<p>é‡å¯ mq æµ‹è¯•æ¶ˆæ¯æ˜¯å¦çœŸçš„å°±æ˜¯æŒä¹…åŒ–äº†ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker restart mq</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>mq</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost nginx<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>è®¿é—® mq é˜Ÿé‡Œæƒ…å†µï¼š</p>\n<p>å¯ä»¥çœ‹åˆ°è¿™æ¡æ¶ˆæ¯è¿˜å­˜åœ¨ç€</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310211845144.png\" alt=\"image-20231021184553048\" /></p>\n<h2 id=\"94-æ¶ˆè´¹è€…ç¡®è®¤\"><a class=\"anchor\" href=\"#94-æ¶ˆè´¹è€…ç¡®è®¤\">#</a> 9.4ã€æ¶ˆè´¹è€…ç¡®è®¤ğŸŒ³</h2>\n<p>RabbitMQ æ”¯æŒæ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶ï¼Œå³ï¼šæ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯åå¯ä»¥å‘ MQ å‘é€ ack å›æ‰§ï¼ŒMQ æ”¶åˆ° ack å›æ‰§åæ‰ä¼šåˆ é™¤æ¶ˆæ¯ã€‚è€Œ SpringAMQP åˆ™å…è®¸é…ç½®ä¸‰ç§ç¡®è®¤æ¨¡å¼ï¼š</p>\n<ul>\n<li>manualï¼šæ‰‹åŠ¨ ackï¼Œéœ€è¦åœ¨ä¸šåŠ¡ä»£ç ç»“æŸåï¼Œè°ƒç”¨ api å‘é€ ack</li>\n<li>autoï¼šè‡ªåŠ¨ ackï¼Œç”± Spring æ£€æµ‹ listener ä»£ç æ˜¯å¦å‡ºç°å¼‚å¸¸ï¼Œæ²¡æœ‰å¼‚å¸¸åˆ™è¿”å› ackï¼›æŠ›å‡ºå¼‚å¸¸åˆ™è¿”å› nack</li>\n<li>noneï¼šå…³é—­ ackï¼ŒMQ å‡å®šæ¶ˆè´¹è€…è·å–æ¶ˆæ¯åä¼šæˆåŠŸå¤„ç†ï¼Œå› æ­¤æ¶ˆæ¯æŠ•é€’åç«‹å³è¢«åˆ é™¤</li>\n</ul>\n<p>é…ç½®æ–¹å¼æ˜¯ä¿®æ”¹ application.yml æ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢é…ç½®ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">rabbitmq</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> 192.168.249.128 <span class=\"token comment\"># rabbitMQ çš„ ip åœ°å€</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5672</span> <span class=\"token comment\"># ç«¯å£</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> itcast</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123321</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">virtual-host</span><span class=\"token punctuation\">:</span> /</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">listener</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">simple</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token key atrule\">prefetch</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token key atrule\">acknowledge-mode</span><span class=\"token punctuation\">:</span> auto <span class=\"token comment\"># è‡ªåŠ¨ ack</span></pre></td></tr></table></figure><p>å…ˆçœ‹ä¸‹ mq çš„é˜Ÿåˆ—æƒ…å†µ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310212025971.png\" alt=\"image-20231021202521333\" /></p>\n<p>é˜Ÿåˆ—ä¸­æœ‰ä¸€æ¡æ¶ˆæ¯</p>\n<p>æˆ‘ä»¬åœ¨ consumer çš„æ¶ˆè´¹ä»£ç ç¼–å†™ä¸€ä¸ªå¼‚å¸¸</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SpringRabbitListener</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> <span class=\"token string\">\"simple.queue\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">listenSimpleQueue</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">*</span>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆè´¹è€…æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ï¼šã€\"</span> <span class=\"token operator\">+</span> msg <span class=\"token operator\">+</span> <span class=\"token string\">\"ã€‘\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">/</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯æˆåŠŸ ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>é…ç½®å®Œæˆåå¯åŠ¨ consumer æœåŠ¡è¿›è¡Œæµ‹è¯•</p>\n<p>æ­¤æ—¶ç¨‹åºèµ°åˆ° debug å¤„ï¼Œæ²¡æœ‰æ‰§è¡Œå®Œæ¯•æˆ‘ä»¬çœ‹ä¸‹ç°åœ¨çš„é˜Ÿåˆ—æƒ…å†µ</p>\n<p>å¯ä»¥çœ‹åˆ°å®ƒæ²¡æœ‰åˆ é™¤è¿™æ¡æ¶ˆæ¯è€Œæ˜¯æ ‡è®°ä¸ºäº† Unacked</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310212027453.png\" alt=\"image-20231021202727506\" /></p>\n<p>å¦‚æœç¨‹åºä¸è¿›è¡Œä¸€ç›´ç­‰å¾…åˆ™ä¼šå˜å›åŸæ¥çš„çŠ¶æ€</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310212029138.png\" alt=\"image-20231021202909987\" /></p>\n<p>java ä»£ç ç¨‹åºå¾€ä¸‹èµ°å°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯å®ƒä¼šè¿›è¡Œé‡æ–°æŠ•é€’</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310212048599.gif\" alt=\"test\" /></p>\n<p>ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸å¸Œæœ›å®ƒå°±è¿™æ ·å¤±è´¥äº†å°±æ— è„‘é‡è¯•é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿçœ‹ä¸‹é¢çš„å†…å®¹ã€‚</p>\n<h2 id=\"95-å¤±è´¥é‡è¯•æœºåˆ¶\"><a class=\"anchor\" href=\"#95-å¤±è´¥é‡è¯•æœºåˆ¶\">#</a> 9.5ã€å¤±è´¥é‡è¯•æœºåˆ¶ğŸŒ³</h2>\n<p>å½“æ¶ˆè´¹è€…å‡ºç°å¼‚å¸¸åï¼Œæ¶ˆè´¹ä¼šä¸æ–­ requue (é‡æ–°å…¥é˜Ÿ) åˆ°é˜Ÿåˆ—ï¼Œå†é‡æ–°å‘é€ç»™æ¶ˆè´¹è€…ï¼Œç„¶åå†æ¬¡å¼‚å¸¸ï¼Œå†æ¬¡ requeueï¼Œæ— é™å¾ªç¯ï¼Œå¯¼è‡´ mq çš„æ¶ˆæ¯å¤„ç†é£™å‡ï¼Œå¸¦æ¥ä¸å¿…è¦çš„å‹åŠ›ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310212051338.png\" alt=\"image-20231021205137135\" /></p>\n<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Spring çš„ retry æœºåˆ¶ï¼Œåœ¨æ¶ˆè´¹è€…å‡ºç°å¼‚å¸¸æ—¶åˆ©ç”¨æœ¬åœ°é‡è¯•ï¼Œè€Œä¸æ˜¯æ— é™åˆ¶çš„ requeue åˆ° mq é˜Ÿåˆ—ã€‚</p>\n<p>å½“ç„¶æœ¬åœ°é‡è¯•ä¹Ÿä¸æ˜¯æ— é™è®©å®ƒä¸€ç›´é‡è¯•</p>\n<p>åœ¨æ¶ˆè´¹è€…æœåŠ¡ä¸­è¿›è¡Œé…ç½®ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">rabbitmq</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> 192.168.249.128 <span class=\"token comment\"># rabbitMQ çš„ ip åœ°å€</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5672</span> <span class=\"token comment\"># ç«¯å£</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> itcast</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123321</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">virtual-host</span><span class=\"token punctuation\">:</span> /</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">listener</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">simple</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token key atrule\">prefetch</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token key atrule\">acknowledge-mode</span><span class=\"token punctuation\">:</span> auto</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">#------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token key atrule\">retry</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>          <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\"># å¼€å¯æ¶ˆè´¹è€…å¤±è´¥é‡è¯•</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>          <span class=\"token key atrule\">initial-interval</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1000</span> <span class=\"token comment\"># åˆå§‹çš„å¤±è´¥ç­‰å¾…æ—¶é•¿ä¸º 1 ç§’</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>          <span class=\"token key atrule\">multiplier</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span> <span class=\"token comment\"># ä¸‹æ¬¡å¤±è´¥çš„ç­‰å¾…æ—¶é•¿å€æ•°ï¼Œä¸‹æ¬¡ç­‰å¾…æ—¶é•¿ = multiplier *last-interval</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>          <span class=\"token key atrule\">max-attempts</span><span class=\"token punctuation\">:</span> <span class=\"token number\">4</span> <span class=\"token comment\"># æœ€å¤§é‡è¯•æ¬¡æ•°</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>          <span class=\"token key atrule\">stateless</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\"># true æ— çŠ¶æ€ï¼›false æœ‰çŠ¶æ€ã€‚å¦‚æœä¸šåŠ¡ä¸­åŒ…å«äº‹åŠ¡ï¼Œè¿™é‡Œæ”¹ä¸º false</span></pre></td></tr></table></figure><p>å¯åŠ¨æ¶ˆè´¹è€…æœåŠ¡åè¿›è¡Œæµ‹è¯• idea æ§åˆ¶å°æ‰“å°å¦‚ä¸‹ï¼š</p>\n<p>æŠ¥äº†ä¸€ä¸ªå¼‚å¸¸ï¼Œè¯´é‡è¯•æ¬¡æ•°è€—å°½äº†</p>\n<pre><code>mqp.rabbit.support.ListenerExecutionFailedException: Retry Policy Exhausted\n\tat org.springframework.amqp.rabbit.retry.RejectAndDontRequeueRecoverer.recover(RejectAndDontRequeueRecoverer.java:45) ~[spring-rabbit-2.2.15.RELEASE.jar:2.2.15.RELEASE]\n\tat org.springframework.amqp.rabbit.config.StatelessRetryOperationsInterceptorFactoryBean.lambda$createRecoverer$0(StatelessRetryOperationsInterceptorFactoryBean.java:74) ~[spring-rabbit-2.2.15.RELEASE.jar:2.2.15.RELEASE]\n\tat org.springframework.retry.interceptor.RetryOperationsInterceptor$ItemRecovererCallback.recover(RetryOperationsInterceptor.java:141) ~[spring-retry-1.2.5.RELEASE.jar:na]\n\tat org.springframework.retry.support.RetryTemplate.handleRetryExhausted(RetryTemplate.java:512) ~[spring-retry-1.2.5.RELEASE.jar:na]\n</code></pre>\n<p>è¿™æ¡æ¶ˆæ¯å°±ä¼šè¢«ä¸¢å¼ƒæ‰</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310220940740.png\" alt=\"image-20231022094032330\" /></p>\n<h3 id=\"951-æ¶ˆè´¹è€…å¤±è´¥æ¶ˆæ¯å¤„ç†ç­–ç•¥\"><a class=\"anchor\" href=\"#951-æ¶ˆè´¹è€…å¤±è´¥æ¶ˆæ¯å¤„ç†ç­–ç•¥\">#</a> 9.5.1ã€æ¶ˆè´¹è€…å¤±è´¥æ¶ˆæ¯å¤„ç†ç­–ç•¥ğŸŒ²</h3>\n<p>åœ¨å¼€å¯é‡è¯•æ¨¡å¼åï¼Œé‡è¯•æ¬¡æ•°è€—å°½ï¼Œå¦‚æœæ¶ˆæ¯ä¾ç„¶å¤±è´¥ï¼Œåˆ™éœ€è¦æœ‰ MessageRecoverer æ¥å£æ¥å¤„ç†ï¼Œå®ƒåŒ…å«ä¸‰ç§ä¸åŒçš„å®ç°ï¼š</p>\n<p>1ã€RejectAndDontRequeueRecovererï¼šé‡è¯•è€—å°½åï¼Œç›´æ¥ rejectï¼Œä¸¢å¼ƒæ¶ˆæ¯ã€‚é»˜è®¤å°±æ˜¯è¿™ç§æ–¹å¼</p>\n<p>2ã€ImmediateRequeueMessageRecovererï¼šé‡è¯•è€—å°½åï¼Œè¿”å› nackï¼Œæ¶ˆæ¯é‡æ–°å…¥é˜Ÿ</p>\n<p>3ã€RepublishMessageRecovererï¼šé‡è¯•è€—å°½åï¼Œå°†å¤±è´¥æ¶ˆæ¯æŠ•é€’åˆ°æŒ‡å®šçš„äº¤æ¢æœº</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221014285.png\" alt=\"image-20231022101421805\" /></p>\n<p>æµ‹è¯•ä¸‹ RepublishMessageRcoverer å¤„ç†æ¨¡å¼ï¼š</p>\n<p>1ã€é¦–å…ˆï¼Œå®šä¹‰æ¥æ”¶å¤±è´¥æ¶ˆæ¯çš„äº¤æ¢æœºï¼Œé˜Ÿåˆ—åŠå…¶ç»‘å®šå…³ç³»ï¼š</p>\n<p>2ã€ç„¶åå®šä¹‰ RepublishMessageRecovererï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ErrorMessageConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DirectExchange</span> <span class=\"token function\">errorMessageExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DirectExchange</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"error.direct\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">errorQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"error.queue\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">errorMessageBinding</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">BindingBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token function\">errorQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">(</span><span class=\"token function\">errorMessageExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"error\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MessageRecoverer</span> <span class=\"token function\">republishMessageRecoverer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RabbitTemplate</span> rabbitTemplate<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RepublishMessageRecoverer</span><span class=\"token punctuation\">(</span>rabbitTemplate<span class=\"token punctuation\">,</span> <span class=\"token string\">\"error.direct\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"error\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨æ¶ˆè´¹è€…æœåŠ¡æŸ¥çœ‹ mq çš„äº¤æ¢æœºå’Œé˜Ÿåˆ—æƒ…å†µ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221027869.png\" alt=\"image-20231022102732042\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221027294.png\" alt=\"image-20231022102744943\" /></p>\n<p>å‘é€ä¸€æ¡æ¶ˆæ¯è¿›è¡Œæµ‹è¯•ï¼Œæ‰¾åˆ° simple.queue è¿›è¡Œå‘é€æ¶ˆæ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221030573.png\" alt=\"image-20231022103002600\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221032487.png\" alt=\"image-20231022103250120\" /></p>\n<p>idea æ§åˆ¶å°æ‰“å°æƒ…å†µ</p>\n<pre><code>æ¶ˆè´¹è€…æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ï¼šã€hello spring !ã€‘\næ¶ˆè´¹è€…æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ï¼šã€hello spring !ã€‘\næ¶ˆè´¹è€…æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ï¼šã€hello spring !ã€‘\n10:30:18:538  WARN 6996 --- [ntContainer#0-1] o.s.a.r.retry.RepublishMessageRecoverer  : Republishing failed message to exchange 'error.direct' with routing key error\n</code></pre>\n<p>ç„¶åå†æŸ¥çœ‹é˜Ÿåˆ—æƒ…å†µ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221031933.png\" alt=\"image-20231022103105401\" /></p>\n<p>åœ¨ error.queue é˜Ÿåˆ—çš„è¯¦ç»†æ¶ˆæ¯ä¸­å¯ä»¥çœ‹åˆ°æŠ¥é”™çš„ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221032636.png\" alt=\"image-20231022103202192\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>:</p>\n<p>å¦‚ä½•ç¡®ä¿ RabbitMQ æ¶ˆæ¯çš„å¯é æ€§ï¼Ÿ</p>\n<ol>\n<li>å¼€å¯ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶ï¼Œç¡®ä¿ç”Ÿäº§è€…çš„æ¶ˆæ¯èƒ½åˆ°è¾¾é˜Ÿåˆ—</li>\n<li>å¼€å¯æŒä¹…åŒ–åŠŸèƒ½ï¼Œç¡®ä¿æ¶ˆæ¯æœªæ¶ˆè´¹å‰åœ¨é˜Ÿåˆ—ä¸­ä¸ä¼šä¸¢å¤±</li>\n<li>å¼€å¯æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶ä¸º autoï¼Œç”± spring ç¡®è®¤æ¶ˆæ¯å¤„ç†æˆåŠŸåå®Œæˆ ack</li>\n<li>å¼€å¯æ¶ˆè´¹è€…å¤±è´¥é‡è¯•æœºåˆ¶ï¼Œå¹¶è®¾ç½® MessageRecovererï¼Œå¤šæ¬¡é‡è¯•å¤±è´¥åå°†æ¶ˆæ¯æŠ•é€’åˆ°å¼‚å¸¸äº¤æ¢æœºï¼Œäº¤ç”±äººå·¥å¤„ç†</li>\n</ol>\n</blockquote>\n<h1 id=\"å-æ­»ä¿¡äº¤æ¢æœº\"><a class=\"anchor\" href=\"#å-æ­»ä¿¡äº¤æ¢æœº\">#</a> åã€æ­»ä¿¡äº¤æ¢æœºğŸ„</h1>\n<ul>\n<li>åˆè¯†æ­»ä¿¡äº¤æ¢æœº</li>\n<li>TTL</li>\n<li>å»¶è¿Ÿé˜Ÿåˆ—</li>\n</ul>\n<h2 id=\"101-åˆè¯†æ­»ä¿¡äº¤æ¢æœº\"><a class=\"anchor\" href=\"#101-åˆè¯†æ­»ä¿¡äº¤æ¢æœº\">#</a> 10.1ã€åˆè¯†æ­»ä¿¡äº¤æ¢æœºğŸŒ³</h2>\n<p>å½“ä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ»¡è¶³ä¸‹åˆ—æƒ…å†µä¹‹ä¸€æ—¶ï¼Œå¯ä»¥ç§°ä¸º &lt;font color='red'&gt; æ­»ä¿¡ (dead letter)&lt;/font&gt;ï¼š</p>\n<p>1ã€æ¶ˆè´¹è€…ä½¿ç”¨ basic.reject æˆ– basic.nack å£°æ˜æ¶ˆè´¹å¤±è´¥ï¼Œå¹¶ä¸”æ¶ˆæ¯çš„ requeue å‚æ•°è®¾ç½®ä¸º false</p>\n<p>2ã€æ¶ˆæ¯æ˜¯ä¸€ä¸ªè¿‡æœŸæ¶ˆæ¯ï¼Œè¶…æ—¶æ— äººæ¶ˆè´¹</p>\n<p>3ã€è¦æŠ•é€’çš„é˜Ÿåˆ—æ¶ˆæ¯å †ç§¯æ»¡äº†ï¼Œæœ€æ—©çš„æ¶ˆæ¯å¯èƒ½æˆä¸ºæ­»ä¿¡</p>\n<p>å¦‚æœè¯¥é˜Ÿåˆ—é…ç½®äº† dead-letter-exchange å±æ€§ï¼ŒæŒ‡å®šäº†ä¸€ä¸ªäº¤æ¢æœºï¼Œé‚£ä¹ˆé˜Ÿåˆ—ä¸­çš„æ­»ä¿¡å°±ä¼šæŠ•é€’åˆ°è¿™ä¸ªäº¤æ¢æœºä¸­ï¼Œè€Œè¿™ä¸ªäº¤æ¢æœºç§°ä¸º &lt;font color='red'&gt; æ­»ä¿¡äº¤æ¢æœº &lt;/font&gt;. (Dead Letter Exchange ï¼Œ ç®€ç§° DLX)ã€‚</p>\n<p>å¦‚æœæœ‰ä¸€ä¸ªæ¶ˆæ¯å‘é€åˆ°äº†æ¶ˆè´¹è€…ï¼Œå‡è®¾æ¶ˆè´¹è€…é‡‡ç”¨é»˜è®¤çš„é‡è¯•æœºåˆ¶ä¸æ–­é‡è¯•ç›´åˆ°æ¬¡æ•°è€—å°½å°±ä¼šå°†æ¶ˆæ¯æ‹’ç»ï¼Œè€Œæ¶ˆæ¯ä¸€æ—¦è¢«æ‹’ç»é»˜è®¤æƒ…å†µä¸‹å°±ä¼šè¢«ä¸¢å¼ƒäº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221043785.png\" alt=\"image-20231022104354267\" /></p>\n<p>å¦‚æœè¯´ä¸æƒ³ä¸¢å¤±å°±å¿…é¡»ç»™ simple.queue è¿™ä¸ªé˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœºï¼Œè¿™æ—¶æ¶ˆæ¯å°±ä¸ä¼šè¢«ä¸¢å¼ƒäº†è€Œæ˜¯å˜æˆä¸€ä¸ªæ­»ä¿¡å†å›åˆ°é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—å†æŠ•é€’åˆ°æ­»ä¿¡äº¤æ¢æœºã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221046386.png\" alt=\"image-20231022104628552\" /></p>\n<p>äº¤æ¢æœºä¸èƒ½å­˜å‚¨æ¶ˆæ¯é‚£ä¹ˆä¸ºäº†ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œè¿˜éœ€è¦ç»‘å®šä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™ä¸ªæ¶ˆæ¯å°±ä¼šåˆ°è¾¾ dl.queue é˜Ÿåˆ—ä¸­ç§°ä¸ºæ­»ä¿¡é˜Ÿåˆ—</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221049450.png\" alt=\"image-20231022104901077\" /></p>\n<p>è¿™é‡Œä¸ä¸Šè¿°çš„ æ¶ˆè´¹è€…å¤±è´¥æ¶ˆæ¯å¤„ç†ç­–ç•¥ ä¸€æ ·ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å·®å¼‚çš„ï¼Œå°±æ˜¯åœ¨ä¸Šè¿°æ–¹å¼ä¸­ï¼Œæ‰€æœ‰çš„å¤±è´¥æ¶ˆæ¯éƒ½æ˜¯æœ‰æ¶ˆè´¹è€…æ¥åšæŠ•é€’çš„ã€‚è€Œåœ¨ç°åœ¨çš„æ–¹å¼ä¸­æ˜¯ç”±é˜Ÿåˆ—åšæŠ•é€’çš„</p>\n<p>å¦‚æœåªæ˜¯åšæ¶ˆæ¯çš„å…œåº•å¤„ç†å»ºè®®ä½¿ç”¨ä¸Šè¿°æ–¹å¼ï¼Œå¦‚æœæ˜¯åšæ¶ˆæ¯å…œåº•å¤„ç†ä»¥åŠé¢å¤–çš„åŠŸèƒ½å»ºè®®ä½¿ç”¨å½“å‰æ–¹å¼</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>ä»€ä¹ˆæ ·çš„æ¶ˆæ¯ä¼šæˆä¸ºæ­»ä¿¡ï¼Ÿ</p>\n<p>1ã€æ¶ˆæ¯è¢«æ¶ˆè´¹è€… reject æˆ–è€…è¿”å› nack</p>\n<p>2ã€æ¶ˆæ¯è¶…æ—¶æœªæ¶ˆè´¹</p>\n<p>3ã€é˜Ÿåˆ—æ»¡äº†</p>\n<p>å¦‚ä½•ç»™é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœºï¼Ÿ</p>\n<p>1ã€ç»™é˜Ÿåˆ—è®¾ç½® dead-letter-exchange å±æ€§ï¼ŒæŒ‡å®šä¸€ä¸ªäº¤æ¢æœº</p>\n<p>2ã€ç»™é˜Ÿåˆ—è®¾ç½® dead-letter-routing-key å±æ€§ï¼Œè®¾ç½®æ­»ä¿¡äº¤æ¢æœºä¸æ­»ä¿¡é˜Ÿåˆ—çš„ RoutingKey</p>\n</blockquote>\n<h2 id=\"102-ttl\"><a class=\"anchor\" href=\"#102-ttl\">#</a> 10.2ã€TTLğŸŒ³</h2>\n<p>TTLï¼Œä¹Ÿå°±æ˜¯ Time-To-Liveã€‚å¦‚æœä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ TTL ç»“æŸä»æœªæ¶ˆè´¹ï¼Œåˆ™ä¼šå˜ä¸ºæ­»ä¿¡ï¼ŒTTL è¶…æ—¶åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p>\n<p>1ã€æ¶ˆæ¯æ‰€åœ¨çš„é˜Ÿåˆ—è®¾ç½®äº†å­˜æ´»æ—¶é—´</p>\n<p>2ã€æ¶ˆæ¯æœ¬èº«è®¾ç½®äº†å­˜æ´»æ—¶é—´</p>\n<p>å‡å¦‚ä¸€ä¸ªæ¶ˆæ¯è‡ªå·±è®¾ç½®äº†æ—¶é—´ä¸º 5000 æ¯«ç§’åˆ°æ¶ˆæ¯å‘å‡ºå»ï¼Œåˆ°è¾¾äº†é˜Ÿåˆ—çš„æ—¶å€™å°±ä¼šå¼€å§‹è®¡æ—¶ï¼Œè®¡æ—¶ç»“æŸåè¿™ä¸ªæ¶ˆæ¯å°±ä¼šæˆä¸ºæ­»ä¿¡ï¼Œä»è€ŒæŠ•é€’åˆ°æ­»ä¿¡äº¤æ¢æœº æœ€ç»ˆåˆ°è¾¾äº†æ­»ä¿¡é˜Ÿåˆ—ã€‚è¿™æ—¶å¦‚æœæ°å¥½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…åœ¨ç›‘å¬æ­»ä¿¡é˜Ÿåˆ—å®ƒå°±ä¼šæ”¶åˆ°è¿™ä¸ªæ­»ä¿¡æ¶ˆæ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221102065.gif\" alt=\"test\" /></p>\n<p>æˆ‘ä»¬å£°æ˜ä¸€ç»„æ­»ä¿¡äº¤æ¢æœºå’Œé˜Ÿåˆ—ï¼ŒåŸºäºæ³¨è§£æ–¹å¼ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>bindings <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@QueueBinding</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   value <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Queue</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"dl.queue\"</span><span class=\"token punctuation\">,</span> durable <span class=\"token operator\">=</span> <span class=\"token string\">\"true\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   exchange <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Exchange</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"dl.direct\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   key <span class=\"token operator\">=</span> <span class=\"token string\">\"dl\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">listenDlQueue</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆè´¹è€…æ¥æ”¶åˆ°äº†dl.queueçš„å»¶è¿Ÿæ¶ˆæ¯\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¦ç»™é˜Ÿåˆ—è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œéœ€è¦åœ¨å£°æ˜é˜Ÿåˆ—çš„ç±»ä¸­ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TTLMessageConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DirectExchange</span> <span class=\"token function\">ttlDirectExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DirectExchange</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ttl.direct\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">ttlQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">QueueBuilder</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">durable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ttl.queue\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// æŒ‡å®šé˜Ÿåˆ—åç§°ï¼Œå¹¶æŒä¹…åŒ–</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">ttl</span><span class=\"token punctuation\">(</span><span class=\"token number\">10000</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½®é˜Ÿåˆ—çš„è¶…æ—¶æ—¶é—´ï¼Œ10 ç§’</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">deadLetterExchange</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dl.direct\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// æŒ‡å®šæ­»ä¿¡äº¤æ¢æœº</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">deadLetterRoutingKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dl\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// æŒ‡å®šæ­»ä¿¡ RoutingKey</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">ttlBinding</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">BindingBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token function\">ttlQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">(</span><span class=\"token function\">ttlDirectExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ttl\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™å‘å¸ƒè€…ä»£ç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testTTLMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">Message</span> message <span class=\"token operator\">=</span> <span class=\"token class-name\">MessageBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">withBody</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello, ttl message\"</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                                             <span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">setDeliveryMode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageDeliveryMode</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PERSISTENT</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">// 2. å‘é€æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ttl.direct\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ttl\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token comment\">// 3. è®°å½•æ—¥å¿—</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆæ¯å·²ç»æˆåŠŸå‘é€äº† ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡è¿›è¡Œæµ‹è¯•ï¼š</p>\n<p>æ¶ˆæ¯å‘å¸ƒè€…å‘é€å‡ºå»çš„æ—¶é—´ä¸ºï¼š46</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221122622.png\" alt=\"image-20231022112215176\" /></p>\n<p>æ¶ˆæ¯æ¥æ”¶è€…æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶é—´ä¸ºï¼š56</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221122464.png\" alt=\"image-20231022112249139\" /></p>\n<p>å»¶è¿Ÿäº† 10 ç§’é’Ÿçš„æ—¶é—´ï¼Œè¿™æ ·å»¶è¿Ÿæ¶ˆæ¯å°±å®ç°äº†</p>\n<p>ä¸Šè¿°æ˜¯åŸºäºé˜Ÿåˆ—å®ç°çš„å»¶è¿Ÿæ¶ˆæ¯ï¼Œä¸‹é¢æ¥å­¦ä¹ ç»™æ¶ˆæ¯è®¾ç½®å»¶è¿Ÿæ—¶é—´</p>\n<p>å‘é€æ¶ˆæ¯æ—¶ï¼Œç»™æ¶ˆæ¯æœ¬èº«è®¾ç½®è¶…æ—¶æ—¶é—´ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testTTLMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">Message</span> message <span class=\"token operator\">=</span> <span class=\"token class-name\">MessageBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">withBody</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello, ttl message\"</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                                             <span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">setDeliveryMode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageDeliveryMode</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PERSISTENT</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">setExpiration</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"5000\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½®æ¶ˆæ¯çš„å»¶è¿Ÿæ—¶é—´ä¸º 5 ç§’</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token comment\">// 2. å‘é€æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ttl.direct\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ttl\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token comment\">// 3. è®°å½•æ—¥å¿—</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆæ¯å·²ç»æˆåŠŸå‘é€äº† ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡å™¨æµ‹è¯•æŸ¥çœ‹æ¶ˆæ¯å»¶è¿Ÿå¤šä¹…æ—¶é—´ï¼š</p>\n<p>å‘é€è€…å‘é€æ¶ˆæ¯æ—¶é—´ä¸ºï¼š16</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221127666.png\" alt=\"image-20231022112741830\" /></p>\n<p>æ¥å—è€…æ”¶åˆ°æ¶ˆæ¯æ—¶é—´ä¸ºï¼š21</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221128275.png\" alt=\"image-20231022112808892\" /></p>\n<p>æ¶ˆæ¯å»¶è¿Ÿäº† 5 ç§’çš„æ—¶é—´ï¼Œ<mark>å½“é˜Ÿåˆ—ä¸æ¶ˆæ¯æœ¬èº«éƒ½è®¾ç½®äº†å»¶è¿Ÿæ—¶é—´æ—¶ï¼Œä»¥æœ€çŸ­çš„æ—¶é—´ä¸ºå‡†</mark>ã€‚</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>æ¶ˆæ¯è¶…æ—¶çš„ä¸¤ç§æ–¹å¼æ˜¯ï¼Ÿ</p>\n<p>1ã€ç»™é˜Ÿåˆ—è®¾ç½® ttl å±æ€§ï¼Œè¿›å…¥é˜Ÿåˆ—åè¶…è¿‡ ttl æ—¶é—´çš„æ¶ˆæ¯å˜ä¸ºæ­»ä¿¡</p>\n<p>2ã€ç»™æ¶ˆæ¯è®¾ç½® ttl å±æ€§ï¼Œé˜Ÿåˆ—æ¥æ”¶åˆ°æ¶ˆæ¯è¶…è¿‡ ttl æ—¶é—´åå˜ä¸ºæ­»ä¿¡</p>\n<p>3ã€ä¸¤è€…å…±å­˜æ—¶ï¼Œä»¥æ—¶é—´çŸ­çš„ ttl ä¸ºå‡†</p>\n<p>å¦‚ä½•å®ç°å‘é€ä¸€ä¸ªæ¶ˆæ¯ 20 ç§’åæ¶ˆè´¹è€…æ‰æ”¶åˆ°æ¶ˆæ¯ï¼Ÿ</p>\n<p>1ã€ç»™æ¶ˆæ¯çš„ç›®æ ‡é˜Ÿåˆ—æŒ‡å®šæ­»ä¿¡äº¤æ¢æœº</p>\n<p>2ã€æ¶ˆè´¹è€…ç›‘å¬ä¸æ­»ä¿¡äº¤æ¢æœºç»‘å®šçš„é˜Ÿåˆ—</p>\n<p>3ã€å‘é€æ¶ˆæ¯æ—¶ç»™æ¶ˆæ¯è®¾ç½® tll ä¸º 20 ç§’</p>\n</blockquote>\n<p>ä¸‹é¢å­¦ä¹ å»¶è¿Ÿé˜Ÿåˆ—çš„æ’ä»¶æ¥å®ç°å»¶è¿Ÿæ¶ˆæ¯</p>\n<h2 id=\"103-å»¶è¿Ÿé˜Ÿåˆ—\"><a class=\"anchor\" href=\"#103-å»¶è¿Ÿé˜Ÿåˆ—\">#</a> 10.3ã€å»¶è¿Ÿé˜Ÿåˆ—ğŸŒ³</h2>\n<p>åˆ©ç”¨ TTL ç»“åˆæ­»ä¿¡äº¤æ¢æœºï¼Œæˆ‘ä»¬å®ç°äº†æ¶ˆæ¯å‘å‡ºåï¼Œæ¶ˆè´¹è€…å»¶è¿Ÿæ”¶åˆ°æ¶ˆæ¯çš„æ•ˆæœã€‚è¿™ç§æ¶ˆæ¯æ¨¡å¼å°±ç§°ä¸º &lt;font color='red'&gt; å»¶è¿Ÿé˜Ÿåˆ— (Delay Queue) æ¨¡å¼ &lt;/font&gt;.</p>\n<p>å»¶è¿Ÿé˜Ÿåˆ—çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬ï¼š</p>\n<p>1ã€å»¶è¿Ÿå‘é€çŸ­ä¿¡</p>\n<p>2ã€ç”¨æˆ·ä¸‹å•ï¼Œå¦‚æœç”¨æˆ·åœ¨ 15 åˆ†é’Ÿå†…æœªæ”¯ä»˜ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆ</p>\n<p>3ã€é¢„çº¦å·¥ä½œä¼šè®®ï¼Œ20 åˆ†é’Ÿåè‡ªåŠ¨é€šçŸ¥æ‰€æœ‰å‚ä¼šäººå‘˜</p>\n<h3 id=\"1031-å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶\"><a class=\"anchor\" href=\"#1031-å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶\">#</a> 10.3.1ã€å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶ğŸŒ²</h3>\n<p>å› ä¸ºå»¶è¿Ÿé˜Ÿåˆ—çš„éœ€æ±‚éå¸¸å¤šï¼Œæ‰€ä»¥ RabbitMQ çš„å®˜æ–¹ä¹Ÿæ¨å‡ºäº†ä¸€ä¸ªæ’ä»¶ï¼ŒåŸç”Ÿæ”¯æŒå»¶è¿Ÿé˜Ÿåˆ—æ•ˆæœã€‚</p>\n<p>è¯¦ç»†å®‰è£…æŸ¥çœ‹æ–‡ç« ï¼š<a href=\"../RabbitMQ/%E9%AB%98%E7%BA%A7%E7%AF%87/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97.md\">RabbitMQ éƒ¨ç½²æŒ‡å—</a>.</p>\n<h3 id=\"1032-springamqpä½¿ç”¨å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶\"><a class=\"anchor\" href=\"#1032-springamqpä½¿ç”¨å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶\">#</a> 10.3.2ã€SpringAMQP ä½¿ç”¨å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶ğŸŒ²</h3>\n<p>DelayExchange çš„æœ¬è´¨è¿˜æ˜¯å®˜æ–¹çš„ä¸‰ç§äº¤æ¢æœºï¼Œåªæ˜¯æ·»åŠ äº†å»¶è¿ŸåŠŸèƒ½ã€‚å› æ­¤ä½¿ç”¨æ—¶åªéœ€è¦å£°æ˜ä¸€ä¸ªäº¤æ¢æœºï¼Œäº¤æ¢æœºçš„ç±»å‹å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œç„¶åè®¾å®š delayed å±æ€§ä¸º true å³å¯</p>\n<p>åŸºäºæ³¨è§£æ–¹å¼ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>bindings <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@QueueBinding</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   value <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Queue</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.queue\"</span><span class=\"token punctuation\">,</span> durable <span class=\"token operator\">=</span> <span class=\"token string\">\"true\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   exchange <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Exchange</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.direct\"</span><span class=\"token punctuation\">,</span> delayed <span class=\"token operator\">=</span> <span class=\"token string\">\"true\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   key <span class=\"token operator\">=</span> <span class=\"token string\">\"delay\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">listenDelayExchange</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆè´¹è€…æ¥æ”¶åˆ°äº†delay.queueçš„å»¶è¿Ÿæ¶ˆæ¯ , &#123;&#125;\"</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å…ˆå¯åŠ¨æ¶ˆè´¹è€…æœåŠ¡è®©å®ƒå…ˆç­‰ç€</p>\n<p>æŸ¥çœ‹ mq çš„äº¤æ¢æœºæƒ…å†µï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221614876.png\" alt=\"image-20231022161400235\" /></p>\n<p>ç„¶åæˆ‘ä»¬å‘è¿™ä¸ª delay ä¸º true çš„äº¤æ¢æœºä¸­å‘é€æ¶ˆæ¯ï¼Œä¸€å®šè¦ç»™æ¶ˆæ¯æ·»åŠ ä¸€ä¸ª header: x-delayï¼Œå€¼ä¸ºå»¶è¿Ÿçš„æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testSndDelayMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">Message</span> message <span class=\"token operator\">=</span> <span class=\"token class-name\">MessageBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">withBody</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello, ttl message\"</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                                             <span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">setDeliveryMode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageDeliveryMode</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PERSISTENT</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-delay\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½®æ¶ˆæ¯çš„å»¶è¿Ÿæ—¶é—´ä¸º 5 ç§’</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// 1.1. å‡†å¤‡ CorrelationData</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">// 1.2. æ¶ˆæ¯ ID</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token class-name\">CorrelationData</span> correlationData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CorrelationData</span><span class=\"token punctuation\">(</span><span class=\"token constant\">UUID</span><span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token comment\">// 2. å‘é€æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"delay.direct\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"delay\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">,</span>correlationData <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆæ¯å‘é€æˆåŠŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å†å¯åŠ¨å‘å¸ƒè€…æµ‹è¯•ä»£ç è¿›è¡Œå‘å¸ƒï¼š</p>\n<p>å‘å¸ƒåæµ‹è¯•ä»£ç ä¼šæç¤ºä¸€ä¸ªé”™è¯¯ä½†æ˜¯è¿™ä¸ªé”™è¯¯æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºå»¶è¿Ÿå®ƒä¼šè¯¯ä»¥ä¸ºéœ€è¦é‡è¯•ï¼Œå°±ä¼šè§¦å‘é‡å‘æœºåˆ¶ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸éœ€è¦å¯¹å»¶è¿Ÿæ¶ˆæ¯è¿›è¡Œé‡è¯•ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹å…¶åšä¸€ä¸‹åˆ¤æ–­</p>\n<pre><code>ERROR 17588 --- [nectionFactory1] cn.itcast.mq.config.CommonConfig         : æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—å¤±è´¥ï¼Œå“åº”ç ï¼š312ï¼Œå¤±è´¥åŸå› ï¼šNO_ROUTEï¼Œäº¤æ¢æœºï¼šdelay.directï¼Œè·¯ç”±keyï¼šdelayï¼Œæ¶ˆæ¯ï¼š(Body:'[B@71c09e9d(byte[18])' MessageProperties [headers=&#123;spring_returned_message_correlation=b85f2836-22b6-406e-9e49-d5f44a07af32&#125;, contentType=application/octet-stream, contentLength=0, receivedDeliveryMode=PERSISTENT, priority=0, receivedDelay=5000, deliveryTag=0])\n</code></pre>\n<p>å¯¹ receivedDelay è¿›è¡Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨å€¼</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//                         å®ç° Spring å·¥å‚çš„é€šçŸ¥</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CommonConfig</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ApplicationContextAware</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// é‡å†™ Bean å·¥å‚å‡†å¤‡å¥½åè°ƒç”¨çš„å‡½æ•°</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ApplicationContext</span> applicationContext<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// å–å‡º RabbitTempalte çš„ Bean</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">RabbitTemplate</span> rabbitTemplate <span class=\"token operator\">=</span> applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RabbitTemplate</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// é…ç½® ReturnCallback</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setReturnCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">,</span> s1<span class=\"token punctuation\">,</span> s2<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token comment\">// åˆ¤æ–­æ˜¯å¦æ˜¯å»¶è¿Ÿæ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getReceivedDelay</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token comment\">// æ˜¯ä¸€ä¸ªå»¶è¿Ÿæ¶ˆæ¯ï¼Œå¿½ç•¥è¿™ä¸ªé”™è¯¯æç¤º</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token comment\">// è®°å½•æ—¥å¿— &#123;&#125; ä¸ºå ä½ç¬¦</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—å¤±è´¥ï¼Œå“åº”ç ï¼š&#123;&#125;ï¼Œå¤±è´¥åŸå› ï¼š&#123;&#125;ï¼Œ\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                    <span class=\"token string\">\"äº¤æ¢æœºï¼š&#123;&#125;ï¼Œè·¯ç”±keyï¼š&#123;&#125;ï¼Œæ¶ˆæ¯ï¼š&#123;&#125;\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                    i<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">,</span> s1<span class=\"token punctuation\">,</span> s2<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">// å¦‚æœæœ‰éœ€è¦çš„è¯ï¼Œé‡å‘æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨è¿è¡Œå‘å¸ƒè€…æµ‹è¯•ä»£ç åæ‰“å°å¦‚ä¸‹ï¼š</p>\n<p>å¯ä»¥çœ‹åˆ°å°±æ²¡æœ‰é”™è¯¯æç¤ºäº†ï¼Œä¹Ÿå°±è§£å†³äº†æ˜æ˜æ²¡æœ‰é”™è¯¯å´é‡è¯•çš„é—®é¢˜äº†</p>\n<pre><code>16:22:35:703  INFO 2568 --- [           main] cn.itcast.mq.spring.SpringAmqpTest       : æ¶ˆæ¯å‘é€æˆåŠŸ\n</code></pre>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶çš„ä½¿ç”¨æ­¥éª¤åŒ…æ‹¬å“ªäº›ï¼Ÿ</p>\n<p>1ã€å£°æ˜ä¸€ä¸ªäº¤æ¢æœºï¼Œæ·»åŠ  delayed å±æ€§ä¸º true</p>\n<p>2ã€å‘é€æ¶ˆæ¯æ—¶ï¼Œæ·»åŠ  x-delay å¤´ï¼Œå€¼ä¸ºè¶…æ—¶æ—¶é—´</p>\n</blockquote>\n<h1 id=\"åä¸€-æƒ°æ€§é˜Ÿåˆ—\"><a class=\"anchor\" href=\"#åä¸€-æƒ°æ€§é˜Ÿåˆ—\">#</a> åä¸€ã€æƒ°æ€§é˜Ÿåˆ—ğŸ„</h1>\n<ul>\n<li>æ¶ˆæ¯å †ç§¯é—®é¢˜</li>\n<li>æƒ°æ€§é˜Ÿåˆ—</li>\n</ul>\n<h2 id=\"111-æ¶ˆæ¯å †ç§¯é—®é¢˜\"><a class=\"anchor\" href=\"#111-æ¶ˆæ¯å †ç§¯é—®é¢˜\">#</a> 11.1ã€æ¶ˆæ¯å †ç§¯é—®é¢˜ğŸŒ³</h2>\n<p>å½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„é€Ÿåº¦è¶…è¿‡äº†æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯çš„é€Ÿåº¦ï¼Œå°±ä¼šå¯¼è‡´é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å †ç§¯ï¼Œç›´åˆ°é˜Ÿåˆ—å­˜å‚¨æ¶ˆæ¯è¾¾åˆ°ä¸Šé™ã€‚æœ€æ—©æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œå¯èƒ½å°±ä¼šæˆä¸ºæ­»ä¿¡ï¼Œä¼šè¢«ä¸¢å¼ƒï¼Œè¿™å°±æ˜¯ &lt;font color='red'&gt; æ¶ˆæ¯å †ç§¯ &lt;/font &gt; é—®é¢˜ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221629911.gif\" alt=\"test\" /></p>\n<p><strong>è§£å†³æ¶ˆæ¯å †ç§¯æœ‰ä¸‰ç§æ€è·¯</strong>ï¼š</p>\n<p>1ã€å¢åŠ æ›´å¤šæ¶ˆè´¹è€…ï¼Œæé«˜æ¶ˆè´¹é€Ÿåº¦</p>\n<p>2ã€åœ¨æ¶ˆè´¹è€…å†…å¼€å¯çº¿ç¨‹æ± åŠ å¿«æ¶ˆæ¯å¤„ç†é€Ÿåº¦</p>\n<p>3ã€æ‰©å¤§é˜Ÿåˆ—å®¹ç§¯ï¼Œæé«˜å †ç§¯ä¸Šé™</p>\n<h2 id=\"112-æƒ°æ€§é˜Ÿåˆ—\"><a class=\"anchor\" href=\"#112-æƒ°æ€§é˜Ÿåˆ—\">#</a> 11.2ã€æƒ°æ€§é˜Ÿåˆ—ğŸŒ³</h2>\n<p>ä» RabbitMQ çš„ 3.6.0 ç‰ˆæœ¬å¼€å§‹ï¼Œå°±å¢åŠ äº† Lazy Queues çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯ &lt;font color='red'&gt; æƒ°æ€§é˜Ÿåˆ— &lt;/font&gt;.</p>\n<p>æƒ°æ€§é˜Ÿåˆ—çš„ç‰¹å¾å¦‚ä¸‹ï¼š</p>\n<p>1ã€æ¥å—åˆ°æ¶ˆæ¯åç›´æ¥å­˜å…¥ç£ç›˜è€Œéå†…å­˜</p>\n<p>2ã€æ¶ˆè´¹è€…è¦æ¶ˆè´¹æ—¶æ‰ä¼šä»ç£ç›˜ä¸­è¯»å–å¹¶åŠ è½½åˆ°å†…å­˜</p>\n<p>3ã€æ”¯æŒæ•°ç™¾ä¸‡æ¡çš„æ¶ˆæ¯å­˜å‚¨</p>\n<p>è€Œè¦è®¾ç½®ä¸€ä¸ªé˜Ÿåˆ—ä¸ºæƒ°æ€§é˜Ÿåˆ—ï¼Œåªéœ€è¦åœ¨å£°æ˜é˜Ÿåˆ—æ—¶ï¼ŒæŒ‡å®š x-queue-mode å±æ€§ä¸º lazy å³å¯ã€‚å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå°†ä¸€ä¸ªè¿è¡Œä¸­çš„é˜Ÿåˆ—ä¿®æ”¹ä¸ºæƒ°æ€§é˜Ÿåˆ—ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmqctl set_policy <span class=\"token class-name\">Lazy</span> <span class=\"token string\">\"^lazy-queue$\"</span> '<span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"queue-mode\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"lazy\"</span><span class=\"token punctuation\">&#125;</span>' <span class=\"token operator\">--</span>apply<span class=\"token operator\">-</span><span class=\"token keyword\">to</span> <span class=\"token namespace\">queues</span></pre></td></tr></table></figure><p>ç”¨ SpringAMQP å£°æ˜æƒ°æ€§é˜Ÿåˆ—åˆ†ä¸¤ç§æ–¹å¼ï¼š</p>\n<p>@Bean æ–¹å¼</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LazyConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">lazyQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">QueueBuilder</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">durable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lazy.queue\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">lazy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// å¼€å¯ x-queue-mode ä¸º lazy</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ³¨è§£æ–¹å¼ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queuesToDeclare <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Queue</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tname <span class=\"token operator\">=</span> <span class=\"token string\">\"lazy.queue\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   durable <span class=\"token operator\">=</span> <span class=\"token string\">\"true\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token string\">\"arguments\"</span> <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Argument</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"x-queue-mode\"</span><span class=\"token punctuation\">,</span> value <span class=\"token operator\">=</span> <span class=\"token string\">\"lazy\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">listenLazyQueue</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¥æ”¶åˆ° lazy.queueçš„æ¶ˆæ¯: &#123;&#125;\"</span> <span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–å†™æµ‹è¯•ä»£ç è¿›è¡Œç™¾ä¸‡æ¶ˆæ¯æµ‹è¯•ï¼š</p>\n<p>å…ˆå¯¹ delay.direct æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œç™¾ä¸‡æ¶ˆæ¯çš„æµ‹è¯•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testLazyQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">&lt;</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token comment\">// 1. å‡†å¤‡æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token class-name\">Message</span> message <span class=\"token operator\">=</span> <span class=\"token class-name\">MessageBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">withBody</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello, ttl message\"</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                                                <span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">setDeliveryMode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageDeliveryMode</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NON_PERSISTENT</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token comment\">// 2. å‘é€æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"delay.direct\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å®ƒæ²¡æœ‰å­˜å‚¨ç£ç›˜è€Œå´å‘¢çˆ†çº¢äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221657687.png\" alt=\"image-20231022165706663\" /></p>\n<p>ä¸‹é¢æµ‹è¯•æƒ°æ€§é˜Ÿåˆ—çš„æƒ…å†µï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testLazyQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">&lt;</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token comment\">// 1. å‡†å¤‡æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token class-name\">Message</span> message <span class=\"token operator\">=</span> <span class=\"token class-name\">MessageBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">withBody</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello, ttl message\"</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                                                <span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">setDeliveryMode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageDeliveryMode</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NON_PERSISTENT</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token comment\">// 2. å‘é€æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lazy.queue\"</span><span class=\"token punctuation\">,</span>  message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ¶ˆæ¯éƒ½å­˜å‚¨åˆ°äº†ç£ç›˜ä¸­ï¼Œè¿™æ ·æ€§èƒ½å°±ä¼šæ¯”è¾ƒå¥½</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221702921.png\" alt=\"image-20231022170213243\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>æ¶ˆæ¯å †ç§¯é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Ÿ</p>\n<p>1ã€é˜Ÿåˆ—ä¸Šç»‘å®šå¤šä¸ªæ¶ˆè´¹è€…ï¼Œæé«˜æ¶ˆè´¹é€Ÿåº¦</p>\n<p>2ã€ç»™æ¶ˆè´¹è€…å¼€å¯çº¿ç¨‹æ± ï¼Œæé«˜æ¶ˆè´¹é€Ÿåº¦</p>\n<p>3ã€ä½¿ç”¨æƒ°æ€§é˜Ÿåˆ—ï¼Œå¯ä»¥å† mq ä¸­ä¿å­˜æ›´å¤šæ¶ˆæ¯</p>\n<p>æƒ°æ€§é˜Ÿåˆ—çš„ä¼˜ç‚¹æœ‰å“ªäº›ï¼Ÿ</p>\n<p>1ã€åŸºäºç£ç›˜å­˜å‚¨ï¼Œæ¶ˆæ¯ä¸Šé™é«˜</p>\n<p>2ã€æ²¡æœ‰é—´æ­‡æ€§çš„ page-outï¼Œæ€§èƒ½æ¯”è¾ƒç¨³å®š</p>\n<p>æƒ°æ€§é˜Ÿåˆ—çš„ç¼ºç‚¹æœ‰å“ªäº›ï¼Ÿ</p>\n<p>1ã€åŸºäºç£ç›˜å­˜å‚¨ï¼Œæ¶ˆæ¯æ—¶æ•ˆæ€§ä¼šé™ä½</p>\n<p>2ã€æ€§èƒ½å—é™äºç£ç›˜çš„ IO</p>\n</blockquote>\n<h1 id=\"åäºŒ-mqé›†ç¾¤\"><a class=\"anchor\" href=\"#åäºŒ-mqé›†ç¾¤\">#</a> åäºŒã€MQ é›†ç¾¤ğŸ„</h1>\n<ul>\n<li>é›†ç¾¤åˆ†ç±»</li>\n<li>æ™®é€šé›†ç¾¤</li>\n<li>é•œåƒé›†ç¾¤</li>\n<li>ä»²è½½é˜Ÿåˆ—</li>\n</ul>\n<h2 id=\"121-é›†ç¾¤åˆ†ç±»\"><a class=\"anchor\" href=\"#121-é›†ç¾¤åˆ†ç±»\">#</a> 12.1ã€é›†ç¾¤åˆ†ç±»ğŸŒ³</h2>\n<p>RabbitMQ æ˜¯åŸºäº Erlang è¯­è¨€ç¼–å†™ï¼Œè€Œ Erlang åˆæ˜¯ä¸€ä¸ªé¢å‘å¹¶å‘çš„è¯­è¨€ï¼Œå¤©ç„¶æ”¯æŒé›†ç¾¤æ¨¡å¼ï¼Œæ­å»ºæ¯”è¾ƒç®€å•ã€‚RabbitMQ çš„é›†ç¾¤æœ‰ä¸¤ç§æ¨¡å¼ï¼š</p>\n<p>1ã€<mark>æ™®é€šé›†ç¾¤</mark>ï¼šæ˜¯ä¸€ç§åˆ†å¸ƒå¼é›†ç¾¤ï¼Œå°†é˜Ÿåˆ—åˆ†æ•£åˆ°é›†ç¾¤çš„å„ä¸ªèŠ‚ç‚¹ï¼Œä»è€Œæé«˜æ•´ä¸ªé›†ç¾¤çš„å¹¶å‘èƒ½åŠ›ã€‚</p>\n<p>2ã€<mark>é•œåƒé›†ç¾¤</mark>ï¼šæ˜¯ä¸€ç§ä¸»ä»é›†ç¾¤ï¼Œæ™®é€šé›†ç¾¤çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ äº†ä¸»ä»å¤‡ä»½åŠŸèƒ½ï¼Œæé«˜é›†ç¾¤çš„æ•°æ®å¯ç”¨æ€§ã€‚</p>\n<p>é•œåƒé›†ç¾¤è™½ç„¶æ”¯æŒä¸»ä»ï¼Œä½†ä¸»ä»åŒæ­¥å¹¶ä¸æ˜¯å¼ºä¸€è‡´çš„ï¼ŒæŸäº›æƒ…å†µä¸‹å¯èƒ½æœ‰æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚å› æ­¤åœ¨ RabbitMQ çš„ 3.8 ç‰ˆæœ¬ä»¥åï¼Œæ¨å‡ºäº†æ–°çš„åŠŸèƒ½ï¼š<mark>ä»²è½½é˜Ÿåˆ—</mark> æ¥ä»£æ›¿é•œåƒé›†ç¾¤ï¼Œåº•å±‚é‡‡ç”¨ Raft åè®®ç¡®ä¿ä¸»ä»çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p>\n<h3 id=\"1211-æ™®é€šé›†ç¾¤\"><a class=\"anchor\" href=\"#1211-æ™®é€šé›†ç¾¤\">#</a> 12.1.1ã€æ™®é€šé›†ç¾¤ğŸŒ²</h3>\n<p>æ™®é€šé›†ç¾¤ï¼Œæˆ–è€…å«æ ‡å‡†é›†ç¾¤ (classic cluster) ï¼Œå…·å¤‡ä¸‹åˆ—ç‰¹å¾ï¼š</p>\n<ul>\n<li>ä¼šåœ¨é›†ç¾¤çš„å„ä¸ªèŠ‚ç‚¹é—´å…±äº«éƒ¨åˆ†æ•°æ®ï¼Œ åŒ…æ‹¬ï¼šäº¤æ¢æœºï¼Œé˜Ÿåˆ—å…ƒä¿¡æ¯ã€‚ä¸åŒ…å«é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚</li>\n</ul>\n<p>æ¯”å¦‚è¯´æœ‰ä¸‰å° RabbitMQï¼Œç„¶ååˆ›å»ºä¸€ä¸ªäº¤æ¢æœº</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221716648.png\" alt=\"image-20231022171634984\" /></p>\n<p>ç”±äºäº¤æ¢æœºå¯ä»¥åœ¨å„ä¸ªèŠ‚ç‚¹é—´å…±äº«ï¼Œæ‰€ä»¥å°†æ¥è¿™ä¸‰ä¸ªèŠ‚ç‚¹éƒ½èƒ½çœ‹åˆ°</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221717792.png\" alt=\"image-20231022171726859\" /></p>\n<p>ä½†æ˜¯ï¼Œç°åœ¨è¦åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—è¿™ä¸ªé˜Ÿåˆ—å« queue1 å®ƒæ˜¯åœ¨ç¬¬ä¸€ä¸ªäº¤æ¢æœºä¸Šå£°æ˜çš„ï¼Œæ­¤æ—¶é˜Ÿåˆ—æ˜¯ä¸å…±äº«çš„ã€‚ä½†æ˜¯æœ‰é˜Ÿåˆ—å…ƒä¿¡æ¯ï¼Œæ¯”å¦‚è¯´ queue1 å®ƒä¼šæœ‰å…¶å®ƒèŠ‚ç‚¹ä¸Šæœ‰ queue1 çš„åå­—ï¼Œä½ç½®ç­‰ä¿¡æ¯ã€‚ç›¸å½“äºæ˜¯ä¸€ä¸ªå¼•ç”¨</p>\n<ul>\n<li>å½“è®¿é—®é›†ç¾¤æŸèŠ‚ç‚¹æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—ä¸åœ¨è¯¥èŠ‚ç‚¹ï¼Œä¼šä»æ•°æ®æ‰€åœ¨èŠ‚ç‚¹ä¼ é€’åˆ°å½“å‰èŠ‚ç‚¹å¹¶è¿”å›</li>\n</ul>\n<p>æ¯”å¦‚è¯´ç°åœ¨æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ç»‘å®šåˆ°äº† queue1 ä½†æ˜¯åœ¨è®¿é—®çš„æ—¶å€™ä¸å°å¿ƒè®¿é—®åˆ°äº†ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹ã€‚è¿™ä¸ªèŠ‚ç‚¹ä¸Šæ²¡æœ‰ queue1 ä½†æ˜¯æœ‰ queue1 çš„å…ƒä¿¡æ¯ï¼Œå½“è·å–æ•°æ®çš„æ—¶å€™å°±ä¼šæ ¹æ®ç¬¬ä¸‰èŠ‚ç‚¹æœ‰ queue1 çš„ä½ç½®ä¿¡æ¯æ¥æ‰¾åˆ° queue1 ç„¶åæ‹¿åˆ°æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221722945.png\" alt=\"image-20231022172221484\" /></p>\n<ul>\n<li>é˜Ÿåˆ—æ‰€åœ¨èŠ‚ç‚¹å®•æœºï¼Œé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å°±ä¼šä¸¢å¤±</li>\n</ul>\n<p>æ¯”å¦‚è¯´ queue1 æŒ‚äº†ï¼Œå› ä¸ºç¬¬ä¸‰èŠ‚ç‚¹å’Œ queue1 æ˜¯å¼•ç”¨å…³ç³»å†æ¥å–æ•°æ®çš„æ—¶å€™å°±å–ä¸åˆ°äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221723703.png\" alt=\"image-20231022172351386\" /></p>\n<h4 id=\"12111-æ­å»ºæ™®é€šé›†ç¾¤\"><a class=\"anchor\" href=\"#12111-æ­å»ºæ™®é€šé›†ç¾¤\">#</a> 12.1.1.1ã€æ­å»ºæ™®é€šé›†ç¾¤ğŸŒ´</h4>\n<p>æ­å»ºæ™®é€šé›†ç¾¤å¯ä»¥å‚è€ƒæ–‡ç« ï¼š<a href=\"../RabbitMQ/%E9%AB%98%E7%BA%A7%E7%AF%87/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97.md\">RabbitMQ éƒ¨ç½²æŒ‡å—</a>.</p>\n<h3 id=\"1212-é•œåƒé›†ç¾¤\"><a class=\"anchor\" href=\"#1212-é•œåƒé›†ç¾¤\">#</a> 12.1.2ã€é•œåƒé›†ç¾¤ğŸŒ²</h3>\n<p>æ¯”æ–¹è¯´ï¼Œä¸‰ä¸ªèŠ‚ç‚¹ï¼Œäº¤æ¢æœºéƒ½èƒ½çœ‹åˆ°ã€‚é‚£é˜Ÿåˆ—å‘¢è¿™æ—¶å°±è¦çœ‹ä½ æ˜¯ä¸æ˜¯é•œåƒäº†ã€‚æ¯”æ–¹è¯´åœ¨ queue1 è¿™ä¸ªèŠ‚ç‚¹ä¸Šåˆ›å»ºäº†ä¸€ä¸ªé˜Ÿåˆ—ã€‚å› ä¸ºæ˜¯åœ¨èŠ‚ç‚¹ 1 ä¸Šåˆ›å»ºçš„ queue1 é˜Ÿåˆ—æ‰€ä»¥èŠ‚ç‚¹ 1 å°±æ˜¯ queue1 çš„ä¸»èŠ‚ç‚¹ï¼Œç„¶åæˆ‘ä»¬è¿˜å¯ä»¥æŒ‘å‡ºä¸€ä¸ªé•œåƒèŠ‚ç‚¹ã€‚æ¯”å¦‚è¯´åœ¨èŠ‚ç‚¹äºŒä¸Šåšä¸€ä¸ªé•œåƒï¼Œé‚£ä¹ˆèŠ‚ç‚¹äºŒå°±ä¼šæ‰¾èŠ‚ç‚¹ä¸€å»åŒæ­¥ queue1 çš„æ‰€æœ‰æ•°æ®ã€‚è¿™æ ·å®ƒä¿©çš„æ•°æ®å°±å…±äº«äº†ã€‚</p>\n<p>è€Œä¸»èŠ‚ç‚¹å’Œé•œåƒèŠ‚ç‚¹æ˜¯å¯ä»¥äº’ç›¸å¤‡ä»½çš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221753072.png\" alt=\"image-20231022175329422\" /></p>\n<p>é•œåƒé›†ç¾¤ï¼šæœ¬è´¨æ˜¯ä¸»ä»æ¨¡å¼ï¼Œå…·å¤‡ä¸‹é¢çš„ç‰¹å¾ï¼š</p>\n<p>1ã€äº¤æ¢æœºï¼Œé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šåœ¨å„ä¸ª mq çš„é•œåƒèŠ‚ç‚¹ä¹‹é—´åŒæ­¥å¤‡ä»½ã€‚</p>\n<p>2ã€åˆ›å»ºé˜Ÿåˆ—çš„èŠ‚ç‚¹è¢«ç§°ä¸ºè¯¥é˜Ÿåˆ—çš„<strong>ä¸»èŠ‚ç‚¹</strong>ï¼Œå¤‡ä»½åˆ°çš„å…¶å®ƒèŠ‚ç‚¹å«åšè¯¥é˜Ÿåˆ—çš„<strong>é•œåƒ</strong>èŠ‚ç‚¹ã€‚</p>\n<p>3ã€ä¸€ä¸ªé˜Ÿåˆ—çš„ä¸»èŠ‚ç‚¹å¯èƒ½æ˜¯å¦ä¸€ä¸ªé˜Ÿåˆ—çš„é•œåƒèŠ‚ç‚¹</p>\n<p>4ã€æ‰€æœ‰æ“ä½œéƒ½æ˜¯ä¸»èŠ‚ç‚¹å®Œæˆï¼Œç„¶ååŒæ­¥ç»™é•œåƒèŠ‚ç‚¹</p>\n<p>5ã€ä¸»å®•æœºåï¼Œé•œåƒèŠ‚ç‚¹ä¼šæ›¿ä»£æˆæ–°çš„ä¸»</p>\n<p>æ¯”æ–¹è¯´ queue1 å®ƒçš„é•œåƒèŠ‚ç‚¹æ˜¯åœ¨ queue2 ä¸Šï¼Œqueue2 è¿™ä¸ªé˜Ÿåˆ—æ˜¯åœ¨èŠ‚ç‚¹ 2 ä¸Šçš„ï¼Œä½†æ˜¯å®ƒå¯ä»¥å†èŠ‚ç‚¹ 3 ä¸Šå¤‡ä»½ï¼Œè€Œ queue3 æ˜¯åœ¨èŠ‚ç‚¹ 3 ä¸Šï¼Œè€Œå®ƒçš„é•œåƒèŠ‚ç‚¹æ˜¯åœ¨èŠ‚ç‚¹ 1 ä¸Šã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221942543.png\" alt=\"image-20231022194205210\" /></p>\n<h4 id=\"12121-æ­å»ºé•œåƒé›†ç¾¤\"><a class=\"anchor\" href=\"#12121-æ­å»ºé•œåƒé›†ç¾¤\">#</a> 12.1.2.1ã€æ­å»ºé•œåƒé›†ç¾¤ğŸŒ´</h4>\n<p>æ­å»ºé•œåƒé›†ç¾¤å¯ä»¥å‚è€ƒæ–‡ç« ï¼š<a href=\"../RabbitMQ/%E9%AB%98%E7%BA%A7%E7%AF%87/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97.md\">RabbitMQ éƒ¨ç½²æŒ‡å—</a>.</p>\n<h3 id=\"1213-ä»²è½½é˜Ÿåˆ—\"><a class=\"anchor\" href=\"#1213-ä»²è½½é˜Ÿåˆ—\">#</a> 12.1.3ã€ä»²è½½é˜Ÿåˆ—ğŸŒ²</h3>\n<p>ä»²è½½é˜Ÿåˆ—ï¼šä»²è½½é˜Ÿåˆ—æ˜¯åœ¨ 3.8 ç‰ˆæœ¬ä»¥åæ‰æœ‰çš„æ–°åŠŸèƒ½ï¼Œç”¨æ¥æ›¿ä»£é•œåƒé˜Ÿåˆ—ï¼Œå…·å¤‡ä¸‹åˆ—ç‰¹å¾ï¼š</p>\n<p>1ã€ä¸é•œåƒé˜Ÿåˆ—ä¸€æ ·ï¼Œéƒ½æ˜¯ä¸»ä»æ¨¡å¼ï¼Œæ”¯æŒä¸»ä»æ•°æ®åŒæ­¥</p>\n<p>2ã€ä½¿ç”¨éå¸¸ç®€å•ï¼Œæ²¡æœ‰å¤æ‚çš„é…ç½®</p>\n<p>3ã€ä¸»ä»åŒæ­¥åŸºäº Raft åè®®ï¼Œå¼ºä¸€è‡´</p>\n<h4 id=\"12131-ä»²è½½é˜Ÿåˆ—æ­å»º\"><a class=\"anchor\" href=\"#12131-ä»²è½½é˜Ÿåˆ—æ­å»º\">#</a> 12.1.3.1ã€ä»²è½½é˜Ÿåˆ—æ­å»ºğŸŒ´</h4>\n<p>ä»²è½½é˜Ÿåˆ—æ­å»ºå¯ä»¥å‚è€ƒæ–‡ç« ï¼š<a href=\"../RabbitMQ/%E9%AB%98%E7%BA%A7%E7%AF%87/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97.md\">RabbitMQ éƒ¨ç½²æŒ‡å—</a>.</p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "springcloud-é«˜çº§",
                "è®¡ç®—æœºå­¦ç§‘",
                "springcloud"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/RabbitMQ/%E9%AB%98%E7%BA%A7/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/RabbitMQ/%E9%AB%98%E7%BA%A7/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/",
            "title": "RabbitMQéƒ¨ç½²æŒ‡å—-é›†ç¾¤éƒ¨ç½²",
            "date_published": "2024-01-06T02:39:34.999Z",
            "content_html": "<h1 id=\"rabbitmqéƒ¨ç½²æŒ‡å—\"><a class=\"anchor\" href=\"#rabbitmqéƒ¨ç½²æŒ‡å—\">#</a> RabbitMQ éƒ¨ç½²æŒ‡å—</h1>\n<h1 id=\"1å•æœºéƒ¨ç½²\"><a class=\"anchor\" href=\"#1å•æœºéƒ¨ç½²\">#</a> 1. å•æœºéƒ¨ç½²</h1>\n<p>æˆ‘ä»¬åœ¨ Centos7 è™šæ‹Ÿæœºä¸­ä½¿ç”¨ Docker æ¥å®‰è£…ã€‚</p>\n<h2 id=\"11ä¸‹è½½é•œåƒ\"><a class=\"anchor\" href=\"#11ä¸‹è½½é•œåƒ\">#</a> 1.1. ä¸‹è½½é•œåƒ</h2>\n<p>æ–¹å¼ä¸€ï¼šåœ¨çº¿æ‹‰å–</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> pull rabbitmq:3.8-management</pre></td></tr></table></figure><p>æ–¹å¼äºŒï¼šä»æœ¬åœ°åŠ è½½</p>\n<p>åœ¨è¯¾å‰èµ„æ–™å·²ç»æä¾›äº†é•œåƒåŒ…ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221138546.png\" alt=\"image-20210423191210349\" /></p>\n<p>ä¸Šä¼ åˆ°è™šæ‹Ÿæœºä¸­åï¼Œä½¿ç”¨å‘½ä»¤åŠ è½½é•œåƒå³å¯ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> load <span class=\"token parameter variable\">-i</span> mq.tar</pre></td></tr></table></figure><h2 id=\"12å®‰è£…mq\"><a class=\"anchor\" href=\"#12å®‰è£…mq\">#</a> 1.2. å®‰è£… MQ</h2>\n<p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥è¿è¡Œ MQ å®¹å™¨ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_USER</span><span class=\"token operator\">=</span>itcast <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_PASS</span><span class=\"token operator\">=</span><span class=\"token number\">123321</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> <span class=\"token parameter variable\">-v</span> mq-plugins:/plugins <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token parameter variable\">--name</span> mq <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> <span class=\"token parameter variable\">--hostname</span> mq1 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token parameter variable\">-p</span> <span class=\"token number\">15672</span>:15672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> <span class=\"token parameter variable\">-p</span> <span class=\"token number\">5672</span>:5672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre> <span class=\"token parameter variable\">-d</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> rabbitmq:3.8-management</pre></td></tr></table></figure><h1 id=\"2å®‰è£…delayexchangeæ’ä»¶\"><a class=\"anchor\" href=\"#2å®‰è£…delayexchangeæ’ä»¶\">#</a> 2. å®‰è£… DelayExchange æ’ä»¶</h1>\n<p>æˆ‘ä»¬è¦ä½¿ç”¨çš„æ˜¯å»¶è¿Ÿé˜Ÿåˆ—ä½†æ˜¯åå­—å´æ˜¯å»¶è¿Ÿäº¤æ¢æœºï¼Œä¸ºä»€ä¹ˆå«è¿™ä¸ªåå­—å‘¢ç®€å•è¯´ä¸‹å®ƒçš„åŸç†ï¼š</p>\n<p>æˆ‘ä»¬åœ¨ä½¿ç”¨è¿™ä¸ªæ’ä»¶çš„æ—¶å€™å®ƒä¸æ˜¯åŸºäºé˜Ÿåˆ—å»åšçš„è€Œæ˜¯äº¤æ¢æœºã€‚æˆ‘ä»¬å‘æ¶ˆæ¯åˆ°äº¤æ¢æœºï¼Œè€Œäº¤æ¢æœºä¼šå¸®ä½ å»¶è¿Ÿçš„æŠ•é€’åˆ°é˜Ÿåˆ—é‡Œ</p>\n<p>å®˜æ–¹çš„å®‰è£…æŒ‡å—åœ°å€ä¸ºï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnJhYmJpdG1xLmNvbS9wb3N0cy8yMDE1LzA0L3NjaGVkdWxpbmctbWVzc2FnZXMtd2l0aC1yYWJiaXRtcQ==\">https://blog.rabbitmq.com/posts/2015/04/scheduling-messages-with-rabbitmq</span></p>\n<p>ä¸Šè¿°æ–‡æ¡£æ˜¯åŸºäº linux åŸç”Ÿå®‰è£… RabbitMQï¼Œç„¶åå®‰è£…æ’ä»¶ã€‚</p>\n<p>å› ä¸ºæˆ‘ä»¬ä¹‹å‰æ˜¯åŸºäº Docker å®‰è£… RabbitMQï¼Œæ‰€ä»¥ä¸‹é¢æˆ‘ä»¬ä¼šè®²è§£åŸºäº Docker æ¥å®‰è£… RabbitMQ æ’ä»¶ã€‚</p>\n<h2 id=\"21ä¸‹è½½æ’ä»¶\"><a class=\"anchor\" href=\"#21ä¸‹è½½æ’ä»¶\">#</a> 2.1. ä¸‹è½½æ’ä»¶</h2>\n<p>RabbitMQ æœ‰ä¸€ä¸ªå®˜æ–¹çš„æ’ä»¶ç¤¾åŒºï¼Œåœ°å€ä¸ºï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmFiYml0bXEuY29tL2NvbW11bml0eS1wbHVnaW5zLmh0bWw=\">https://www.rabbitmq.com/community-plugins.html</span></p>\n<p>å…¶ä¸­åŒ…å«å„ç§å„æ ·çš„æ’ä»¶ï¼ŒåŒ…æ‹¬æˆ‘ä»¬è¦ä½¿ç”¨çš„ DelayExchange æ’ä»¶ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221139975.png\" alt=\"image-20210713104511055\" /></p>\n<p>å¤§å®¶å¯ä»¥å»å¯¹åº”çš„ GitHub é¡µé¢ä¸‹è½½ 3.8.9 ç‰ˆæœ¬çš„æ’ä»¶ï¼Œåœ°å€ä¸º https://github.com/rabbitmq/rabbitmq-delayed-message-exchange/releases/tag/3.8.9 è¿™ä¸ªå¯¹åº” RabbitMQ çš„ 3.8.5 ä»¥ä¸Šç‰ˆæœ¬ã€‚</p>\n<p>è¯¾å‰èµ„æ–™ä¹Ÿæä¾›äº†ä¸‹è½½å¥½çš„æ’ä»¶ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221139733.png\" alt=\"image-20210713104808909\" /></p>\n<h2 id=\"22ä¸Šä¼ æ’ä»¶\"><a class=\"anchor\" href=\"#22ä¸Šä¼ æ’ä»¶\">#</a> 2.2. ä¸Šä¼ æ’ä»¶</h2>\n<p>å› ä¸ºæˆ‘ä»¬æ˜¯åŸºäº Docker å®‰è£…ï¼Œæ‰€ä»¥éœ€è¦å…ˆæŸ¥çœ‹ RabbitMQ çš„æ’ä»¶ç›®å½•å¯¹åº”çš„æ•°æ®å·ã€‚å¦‚æœä¸æ˜¯åŸºäº Docker çš„åŒå­¦ï¼Œè¯·å‚è€ƒç¬¬ä¸€ç« éƒ¨åˆ†ï¼Œé‡æ–°åˆ›å»º Docker å®¹å™¨ã€‚</p>\n<p>æˆ‘ä»¬ä¹‹å‰è®¾å®šçš„ RabbitMQ çš„æ•°æ®å·åç§°ä¸º <code>mq-plugins</code> ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢å‘½ä»¤æŸ¥çœ‹æ•°æ®å·ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> volume inspect mq-plugins</pre></td></tr></table></figure><p>å¯ä»¥å¾—åˆ°ä¸‹é¢ç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221139695.png\" alt=\"image-20210713105135701\" /></p>\n<p>æ¥ä¸‹æ¥ï¼Œå°†æ’ä»¶ä¸Šä¼ åˆ°è¿™ä¸ªç›®å½•å³å¯ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221139638.png\" alt=\"image-20210713105339785\" /></p>\n<h2 id=\"23å®‰è£…æ’ä»¶\"><a class=\"anchor\" href=\"#23å®‰è£…æ’ä»¶\">#</a> 2.3. å®‰è£…æ’ä»¶</h2>\n<p>æœ€åå°±æ˜¯å®‰è£…äº†ï¼Œéœ€è¦è¿›å…¥ MQ å®¹å™¨å†…éƒ¨æ¥æ‰§è¡Œå®‰è£…ã€‚æˆ‘çš„å®¹å™¨åä¸º <code>mq</code> ï¼Œæ‰€ä»¥æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> mq <span class=\"token function\">bash</span></pre></td></tr></table></figure><p>æ‰§è¡Œæ—¶ï¼Œè¯·å°†å…¶ä¸­çš„  <code>-it</code>  åé¢çš„ <code>mq</code>  æ›¿æ¢ä¸ºä½ è‡ªå·±çš„å®¹å™¨å.</p>\n<p>è¿›å…¥å®¹å™¨å†…éƒ¨åï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤å¼€å¯æ’ä»¶ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmq-plugins <span class=\"token builtin class-name\">enable</span> rabbitmq_delayed_message_exchange</pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221139444.png\" alt=\"image-20210713105829435\" /></p>\n<p>è®¿é—® mq å‰ç«¯å£°æ˜ä¸€ä¸ªäº¤æ¢æœºè¿›è¡Œæµ‹è¯•ï¼š</p>\n<p>DelayExchange æ’ä»¶çš„åŸç†æ˜¯å¯¹å®˜æ–¹åŸç”Ÿçš„ Exchange åšäº†åŠŸèƒ½çš„å‡çº§ï¼š</p>\n<p>1ã€å°† DelayExchange æ¥å—çš„æ¶ˆæ¯æš‚å­˜åœ¨å†…å­˜ä¸­ (å®˜æ–¹çš„ Exchange æ˜¯æ— æ³•å­˜å‚¨æ¶ˆæ¯çš„)</p>\n<p>2ã€åœ¨ DelayExchange ä¸­è®¡æ—¶ï¼Œè¶…æ—¶åæ‰æŠ•é€’æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221553081.png\" alt=\"image-20231022155351657\" /></p>\n<p>å‘é€è¿™ä¸ªæ¶ˆæ¯çš„æ—¶å€™å»¶è¿Ÿå¤šä¹…éœ€è¦åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™è®¾ç½®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221557138.png\" alt=\"image-20231022155755822\" /></p>\n<h1 id=\"3é›†ç¾¤éƒ¨ç½²\"><a class=\"anchor\" href=\"#3é›†ç¾¤éƒ¨ç½²\">#</a> 3. é›†ç¾¤éƒ¨ç½²</h1>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å®‰è£… RabbitMQ çš„é›†ç¾¤ã€‚</p>\n<h2 id=\"21é›†ç¾¤åˆ†ç±»\"><a class=\"anchor\" href=\"#21é›†ç¾¤åˆ†ç±»\">#</a> 2.1. é›†ç¾¤åˆ†ç±»</h2>\n<p>åœ¨ RabbitMQ çš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œè®²è¿°äº†ä¸¤ç§é›†ç¾¤çš„é…ç½®æ–¹å¼ï¼š</p>\n<ul>\n<li>æ™®é€šæ¨¡å¼ï¼šæ™®é€šæ¨¡å¼é›†ç¾¤ä¸è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œæ¯ä¸ª MQ éƒ½æœ‰è‡ªå·±çš„é˜Ÿåˆ—ã€æ•°æ®ä¿¡æ¯ï¼ˆå…¶å®ƒå…ƒæ•°æ®ä¿¡æ¯å¦‚äº¤æ¢æœºç­‰ä¼šåŒæ­¥ï¼‰ã€‚ä¾‹å¦‚æˆ‘ä»¬æœ‰ 2 ä¸ª MQï¼šmq1ï¼Œå’Œ mq2ï¼Œå¦‚æœä½ çš„æ¶ˆæ¯åœ¨ mq1ï¼Œè€Œä½ è¿æ¥åˆ°äº† mq2ï¼Œé‚£ä¹ˆ mq2 ä¼šå» mq1 æ‹‰å–æ¶ˆæ¯ï¼Œç„¶åè¿”å›ç»™ä½ ã€‚å¦‚æœ mq1 å®•æœºï¼Œæ¶ˆæ¯å°±ä¼šä¸¢å¤±ã€‚</li>\n<li>é•œåƒæ¨¡å¼ï¼šä¸æ™®é€šæ¨¡å¼ä¸åŒï¼Œé˜Ÿåˆ—ä¼šåœ¨å„ä¸ª mq çš„é•œåƒèŠ‚ç‚¹ä¹‹é—´åŒæ­¥ï¼Œå› æ­¤ä½ è¿æ¥åˆ°ä»»ä½•ä¸€ä¸ªé•œåƒèŠ‚ç‚¹ï¼Œå‡å¯è·å–åˆ°æ¶ˆæ¯ã€‚è€Œä¸”å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œå¹¶ä¸ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ä¸è¿‡ï¼Œè¿™ç§æ–¹å¼å¢åŠ äº†æ•°æ®åŒæ­¥çš„å¸¦å®½æ¶ˆè€—ã€‚</li>\n</ul>\n<p>æˆ‘ä»¬å…ˆæ¥çœ‹æ™®é€šæ¨¡å¼é›†ç¾¤ï¼Œæˆ‘ä»¬çš„è®¡åˆ’éƒ¨ç½² 3 èŠ‚ç‚¹çš„ mq é›†ç¾¤ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>ä¸»æœºå</th>\n<th>æ§åˆ¶å°ç«¯å£</th>\n<th>amqp é€šä¿¡ç«¯å£</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>mq1</td>\n<td>8081 ---&gt; 15672</td>\n<td>8071 ---&gt; 5672</td>\n</tr>\n<tr>\n<td>mq2</td>\n<td>8082 ---&gt; 15672</td>\n<td>8072 ---&gt; 5672</td>\n</tr>\n<tr>\n<td>mq3</td>\n<td>8083 ---&gt; 15672</td>\n<td>8073  ---&gt; 5672</td>\n</tr>\n</tbody>\n</table>\n<p>é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ ‡ç¤ºé»˜è®¤éƒ½æ˜¯ï¼š <code>rabbit@[hostname]</code> ï¼Œå› æ­¤ä»¥ä¸Šä¸‰ä¸ªèŠ‚ç‚¹çš„åç§°åˆ†åˆ«ä¸ºï¼š</p>\n<ul>\n<li>rabbit@mq1</li>\n<li>rabbit@mq2</li>\n<li>rabbit@mq3</li>\n</ul>\n<h2 id=\"22è·å–cookie\"><a class=\"anchor\" href=\"#22è·å–cookie\">#</a> 2.2. è·å– cookie</h2>\n<p>RabbitMQ åº•å±‚ä¾èµ–äº Erlangï¼Œè€Œ Erlang è™šæ‹Ÿæœºå°±æ˜¯ä¸€ä¸ªé¢å‘åˆ†å¸ƒå¼çš„è¯­è¨€ï¼Œé»˜è®¤å°±æ”¯æŒé›†ç¾¤æ¨¡å¼ã€‚é›†ç¾¤æ¨¡å¼ä¸­çš„æ¯ä¸ª RabbitMQ èŠ‚ç‚¹ä½¿ç”¨ cookie æ¥ç¡®å®šå®ƒä»¬æ˜¯å¦è¢«å…è®¸ç›¸äº’é€šä¿¡ã€‚</p>\n<p>è¦ä½¿ä¸¤ä¸ªèŠ‚ç‚¹èƒ½å¤Ÿé€šä¿¡ï¼Œå®ƒä»¬å¿…é¡»å…·æœ‰ç›¸åŒçš„å…±äº«ç§˜å¯†ï¼Œç§°ä¸º<strong> Erlang cookie</strong>ã€‚cookie åªæ˜¯ä¸€ä¸²æœ€å¤š 255 ä¸ªå­—ç¬¦çš„å­—æ¯æ•°å­—å­—ç¬¦ã€‚</p>\n<p>æ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹å¿…é¡»å…·æœ‰<strong>ç›¸åŒçš„ cookie</strong>ã€‚å®ä¾‹ä¹‹é—´ä¹Ÿéœ€è¦å®ƒæ¥ç›¸äº’é€šä¿¡ã€‚</p>\n<p>æˆ‘ä»¬å…ˆåœ¨ä¹‹å‰å¯åŠ¨çš„ mq å®¹å™¨ä¸­è·å–ä¸€ä¸ª cookie å€¼ï¼Œä½œä¸ºé›†ç¾¤çš„ cookieã€‚æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> mq <span class=\"token function\">cat</span> /var/lib/rabbitmq/.erlang.cookie</pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° cookie å€¼å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>DVNQQPDKLNCMEPRBYEHX</pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œåœæ­¢å¹¶åˆ é™¤å½“å‰çš„ mq å®¹å™¨ï¼Œæˆ‘ä»¬é‡æ–°æ­å»ºé›†ç¾¤ã€‚</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token function\">rm</span> <span class=\"token parameter variable\">-f</span> mq</pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221139218.png\" alt=\"image-20210717212345165\" /></p>\n<h2 id=\"23å‡†å¤‡é›†ç¾¤é…ç½®\"><a class=\"anchor\" href=\"#23å‡†å¤‡é›†ç¾¤é…ç½®\">#</a> 2.3. å‡†å¤‡é›†ç¾¤é…ç½®</h2>\n<p>åœ¨ /tmp ç›®å½•æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ rabbitmq.confï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /tmp</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># åˆ›å»ºæ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">touch</span> rabbitmq.conf</pre></td></tr></table></figure><p>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>loopback_users.guest = false</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>listeners.tcp.default = 5672</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>cluster_formation.peer_discovery_backend = rabbit_peer_discovery_classic_config</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>cluster_formation.classic_config.nodes.1 = rabbit@mq1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>cluster_formation.classic_config.nodes.2 = rabbit@mq2</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>cluster_formation.classic_config.nodes.3 = rabbit@mq3</pre></td></tr></table></figure><p>å†åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œè®°å½• cookie</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /tmp</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># åˆ›å»º cookie æ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">touch</span> .erlang.cookie</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># å†™å…¥ cookie</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"FXZMCVGLBIXZCDEMMVZQ\"</span> <span class=\"token operator\">></span> .erlang.cookie</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># ä¿®æ”¹ cookie æ–‡ä»¶çš„æƒé™</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">chmod</span> <span class=\"token number\">600</span> .erlang.cookie</pre></td></tr></table></figure><p>å‡†å¤‡ä¸‰ä¸ªç›®å½•ï¼Œmq1ã€mq2ã€mq3ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /tmp</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># åˆ›å»ºç›®å½•</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">mkdir</span> mq1 mq2 mq3</pre></td></tr></table></figure><p>ç„¶åæ‹·è´ rabbitmq.confã€cookie æ–‡ä»¶åˆ° mq1ã€mq2ã€mq3ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># è¿›å…¥ /tmp</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /tmp</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># æ‹·è´</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">cp</span> rabbitmq.conf mq1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">cp</span> rabbitmq.conf mq2</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">cp</span> rabbitmq.conf mq3</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">cp</span> .erlang.cookie mq1</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">cp</span> .erlang.cookie mq2</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">cp</span> .erlang.cookie mq3</pre></td></tr></table></figure><h2 id=\"24å¯åŠ¨é›†ç¾¤\"><a class=\"anchor\" href=\"#24å¯åŠ¨é›†ç¾¤\">#</a> 2.4. å¯åŠ¨é›†ç¾¤</h2>\n<p>åˆ›å»ºä¸€ä¸ªç½‘ç»œï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> network create mq-net</pre></td></tr></table></figure><p>è¿è¡Œå‘½ä»¤</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--net</span> mq-net <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token parameter variable\">-v</span> <span class=\"token variable\">$&#123;<span class=\"token environment constant\">PWD</span>&#125;</span>/mq1/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token parameter variable\">-v</span> <span class=\"token variable\">$&#123;<span class=\"token environment constant\">PWD</span>&#125;</span>/.erlang.cookie:/var/lib/rabbitmq/.erlang.cookie <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_USER</span><span class=\"token operator\">=</span>itcast <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_PASS</span><span class=\"token operator\">=</span><span class=\"token number\">123321</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token parameter variable\">--name</span> mq1 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token parameter variable\">--hostname</span> mq1 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token parameter variable\">-p</span> <span class=\"token number\">8071</span>:5672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token parameter variable\">-p</span> <span class=\"token number\">8081</span>:15672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>rabbitmq:3.8-management</pre></td></tr></table></figure><figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--net</span> mq-net <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token parameter variable\">-v</span> <span class=\"token variable\">$&#123;<span class=\"token environment constant\">PWD</span>&#125;</span>/mq2/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token parameter variable\">-v</span> <span class=\"token variable\">$&#123;<span class=\"token environment constant\">PWD</span>&#125;</span>/.erlang.cookie:/var/lib/rabbitmq/.erlang.cookie <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_USER</span><span class=\"token operator\">=</span>itcast <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_PASS</span><span class=\"token operator\">=</span><span class=\"token number\">123321</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token parameter variable\">--name</span> mq2 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token parameter variable\">--hostname</span> mq2 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token parameter variable\">-p</span> <span class=\"token number\">8072</span>:5672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token parameter variable\">-p</span> <span class=\"token number\">8082</span>:15672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>rabbitmq:3.8-management</pre></td></tr></table></figure><figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--net</span> mq-net <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token parameter variable\">-v</span> <span class=\"token variable\">$&#123;<span class=\"token environment constant\">PWD</span>&#125;</span>/mq3/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token parameter variable\">-v</span> <span class=\"token variable\">$&#123;<span class=\"token environment constant\">PWD</span>&#125;</span>/.erlang.cookie:/var/lib/rabbitmq/.erlang.cookie <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_USER</span><span class=\"token operator\">=</span>itcast <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_PASS</span><span class=\"token operator\">=</span><span class=\"token number\">123321</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token parameter variable\">--name</span> mq3 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token parameter variable\">--hostname</span> mq3 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token parameter variable\">-p</span> <span class=\"token number\">8073</span>:5672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token parameter variable\">-p</span> <span class=\"token number\">8083</span>:15672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>rabbitmq:3.8-management</pre></td></tr></table></figure><h2 id=\"25æµ‹è¯•\"><a class=\"anchor\" href=\"#25æµ‹è¯•\">#</a> 2.5. æµ‹è¯•</h2>\n<p>åœ¨ mq1 è¿™ä¸ªèŠ‚ç‚¹ä¸Šæ·»åŠ ä¸€ä¸ªé˜Ÿåˆ—ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221139410.png\" alt=\"image-20210717222833196\" /></p>\n<p>å¦‚å›¾ï¼Œåœ¨ mq2 å’Œ mq3 ä¸¤ä¸ªæ§åˆ¶å°ä¹Ÿéƒ½èƒ½çœ‹åˆ°ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221139214.png\" alt=\"image-20210717223057902\" /></p>\n<h3 id=\"251æ•°æ®å…±äº«æµ‹è¯•\"><a class=\"anchor\" href=\"#251æ•°æ®å…±äº«æµ‹è¯•\">#</a> 2.5.1. æ•°æ®å…±äº«æµ‹è¯•</h3>\n<p>ç‚¹å‡»è¿™ä¸ªé˜Ÿåˆ—ï¼Œè¿›å…¥ç®¡ç†é¡µé¢ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221139412.png\" alt=\"image-20210717223421750\" /></p>\n<p>ç„¶ååˆ©ç”¨æ§åˆ¶å°å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°è¿™ä¸ªé˜Ÿåˆ—ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140585.png\" alt=\"image-20210717223320238\" /></p>\n<p>ç»“æœåœ¨ mq2ã€mq3 ä¸Šéƒ½èƒ½çœ‹åˆ°è¿™æ¡æ¶ˆæ¯ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140067.png\" alt=\"image-20210717223603628\" /></p>\n<h3 id=\"252å¯ç”¨æ€§æµ‹è¯•\"><a class=\"anchor\" href=\"#252å¯ç”¨æ€§æµ‹è¯•\">#</a> 2.5.2. å¯ç”¨æ€§æµ‹è¯•</h3>\n<p>æˆ‘ä»¬è®©å…¶ä¸­ä¸€å°èŠ‚ç‚¹ mq1 å®•æœºï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> stop mq1</pre></td></tr></table></figure><p>ç„¶åç™»å½• mq2 æˆ– mq3 çš„æ§åˆ¶å°ï¼Œå‘ç° simple.queue ä¹Ÿä¸å¯ç”¨äº†ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140781.png\" alt=\"image-20210717223800203\" /></p>\n<p>è¯´æ˜æ•°æ®å¹¶æ²¡æœ‰æ‹·è´åˆ° mq2 å’Œ mq3ã€‚</p>\n<h1 id=\"4é•œåƒæ¨¡å¼\"><a class=\"anchor\" href=\"#4é•œåƒæ¨¡å¼\">#</a> 4. é•œåƒæ¨¡å¼</h1>\n<p>åœ¨åˆšåˆšçš„æ¡ˆä¾‹ä¸­ï¼Œä¸€æ—¦åˆ›å»ºé˜Ÿåˆ—çš„ä¸»æœºå®•æœºï¼Œé˜Ÿåˆ—å°±ä¼šä¸å¯ç”¨ã€‚ä¸å…·å¤‡é«˜å¯ç”¨èƒ½åŠ›ã€‚å¦‚æœè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¿…é¡»ä½¿ç”¨å®˜æ–¹æä¾›çš„é•œåƒé›†ç¾¤æ–¹æ¡ˆã€‚</p>\n<p>å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmFiYml0bXEuY29tL2hhLmh0bWw=\">https://www.rabbitmq.com/ha.html</span></p>\n<h2 id=\"41é•œåƒæ¨¡å¼çš„ç‰¹å¾\"><a class=\"anchor\" href=\"#41é•œåƒæ¨¡å¼çš„ç‰¹å¾\">#</a> 4.1. é•œåƒæ¨¡å¼çš„ç‰¹å¾</h2>\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé˜Ÿåˆ—åªä¿å­˜åœ¨åˆ›å»ºè¯¥é˜Ÿåˆ—çš„èŠ‚ç‚¹ä¸Šã€‚è€Œé•œåƒæ¨¡å¼ä¸‹ï¼Œåˆ›å»ºé˜Ÿåˆ—çš„èŠ‚ç‚¹è¢«ç§°ä¸ºè¯¥é˜Ÿåˆ—çš„<strong>ä¸»èŠ‚ç‚¹</strong>ï¼Œé˜Ÿåˆ—è¿˜ä¼šæ‹·è´åˆ°é›†ç¾¤ä¸­çš„å…¶å®ƒèŠ‚ç‚¹ï¼Œä¹Ÿå«åšè¯¥é˜Ÿåˆ—çš„<strong>é•œåƒ</strong>èŠ‚ç‚¹ã€‚</p>\n<p>ä½†æ˜¯ï¼Œä¸åŒé˜Ÿåˆ—å¯ä»¥åœ¨é›†ç¾¤ä¸­çš„ä»»æ„èŠ‚ç‚¹ä¸Šåˆ›å»ºï¼Œå› æ­¤ä¸åŒé˜Ÿåˆ—çš„ä¸»èŠ‚ç‚¹å¯ä»¥ä¸åŒã€‚ç”šè‡³ï¼Œ<strong>ä¸€ä¸ªé˜Ÿåˆ—çš„ä¸»èŠ‚ç‚¹å¯èƒ½æ˜¯å¦ä¸€ä¸ªé˜Ÿåˆ—çš„é•œåƒèŠ‚ç‚¹</strong>ã€‚</p>\n<p>ç”¨æˆ·å‘é€ç»™é˜Ÿåˆ—çš„ä¸€åˆ‡è¯·æ±‚ï¼Œä¾‹å¦‚å‘é€æ¶ˆæ¯ã€æ¶ˆæ¯å›æ‰§é»˜è®¤éƒ½ä¼šåœ¨ä¸»èŠ‚ç‚¹å®Œæˆï¼Œå¦‚æœæ˜¯ä»èŠ‚ç‚¹æ¥æ”¶åˆ°è¯·æ±‚ï¼Œä¹Ÿä¼šè·¯ç”±åˆ°ä¸»èŠ‚ç‚¹å»å®Œæˆã€‚<strong>é•œåƒèŠ‚ç‚¹ä»…ä»…èµ·åˆ°å¤‡ä»½æ•°æ®ä½œç”¨</strong>ã€‚</p>\n<p>å½“ä¸»èŠ‚ç‚¹æ¥æ”¶åˆ°æ¶ˆè´¹è€…çš„ ACK æ—¶ï¼Œæ‰€æœ‰é•œåƒéƒ½ä¼šåˆ é™¤èŠ‚ç‚¹ä¸­çš„æ•°æ®ã€‚</p>\n<p>æ€»ç»“å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>é•œåƒé˜Ÿåˆ—ç»“æ„æ˜¯ä¸€ä¸»å¤šä»ï¼ˆä»å°±æ˜¯é•œåƒï¼‰</li>\n<li>æ‰€æœ‰æ“ä½œéƒ½æ˜¯ä¸»èŠ‚ç‚¹å®Œæˆï¼Œç„¶ååŒæ­¥ç»™é•œåƒèŠ‚ç‚¹</li>\n<li>ä¸»å®•æœºåï¼Œé•œåƒèŠ‚ç‚¹ä¼šæ›¿ä»£æˆæ–°çš„ä¸»ï¼ˆå¦‚æœåœ¨ä¸»ä»åŒæ­¥å®Œæˆå‰ï¼Œä¸»å°±å·²ç»å®•æœºï¼Œå¯èƒ½å‡ºç°æ•°æ®ä¸¢å¤±ï¼‰</li>\n<li>ä¸å…·å¤‡è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œå› ä¸ºæ‰€æœ‰æ“ä½œéƒ½ä¼šæœ‰ä¸»èŠ‚ç‚¹å®Œæˆï¼ˆä½†æ˜¯ä¸åŒé˜Ÿåˆ—ï¼Œå…¶ä¸»èŠ‚ç‚¹å¯ä»¥ä¸åŒï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªæé«˜ååé‡ï¼‰</li>\n</ul>\n<h2 id=\"42é•œåƒæ¨¡å¼çš„é…ç½®\"><a class=\"anchor\" href=\"#42é•œåƒæ¨¡å¼çš„é…ç½®\">#</a> 4.2. é•œåƒæ¨¡å¼çš„é…ç½®</h2>\n<p>é•œåƒæ¨¡å¼çš„é…ç½®æœ‰ 3 ç§æ¨¡å¼ï¼š</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">ha-mode</th>\n<th style=\"text-align:left\">ha-params</th>\n<th style=\"text-align:left\">æ•ˆæœ</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">å‡†ç¡®æ¨¡å¼ exactly</td>\n<td style=\"text-align:left\">é˜Ÿåˆ—çš„å‰¯æœ¬é‡ count</td>\n<td style=\"text-align:left\">é›†ç¾¤ä¸­é˜Ÿåˆ—å‰¯æœ¬ï¼ˆä¸»æœåŠ¡å™¨å’Œé•œåƒæœåŠ¡å™¨ä¹‹å’Œï¼‰çš„æ•°é‡ã€‚count å¦‚æœä¸º 1 æ„å‘³ç€å•ä¸ªå‰¯æœ¬ï¼šå³é˜Ÿåˆ—ä¸»èŠ‚ç‚¹ã€‚count å€¼ä¸º 2 è¡¨ç¤º 2 ä¸ªå‰¯æœ¬ï¼š1 ä¸ªé˜Ÿåˆ—ä¸»å’Œ 1 ä¸ªé˜Ÿåˆ—é•œåƒã€‚æ¢å¥è¯è¯´ï¼šcount = é•œåƒæ•°é‡ + 1ã€‚å¦‚æœç¾¤é›†ä¸­çš„èŠ‚ç‚¹æ•°å°‘äº countï¼Œåˆ™è¯¥é˜Ÿåˆ—å°†é•œåƒåˆ°æ‰€æœ‰èŠ‚ç‚¹ã€‚å¦‚æœæœ‰é›†ç¾¤æ€»æ•°å¤§äº count+1ï¼Œå¹¶ä¸”åŒ…å«é•œåƒçš„èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œåˆ™å°†åœ¨å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">all</td>\n<td style=\"text-align:left\">(none)</td>\n<td style=\"text-align:left\">é˜Ÿåˆ—åœ¨ç¾¤é›†ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œé•œåƒã€‚é˜Ÿåˆ—å°†é•œåƒåˆ°ä»»ä½•æ–°åŠ å…¥çš„èŠ‚ç‚¹ã€‚é•œåƒåˆ°æ‰€æœ‰èŠ‚ç‚¹å°†å¯¹æ‰€æœ‰ç¾¤é›†èŠ‚ç‚¹æ–½åŠ é¢å¤–çš„å‹åŠ›ï¼ŒåŒ…æ‹¬ç½‘ç»œ I / Oï¼Œç£ç›˜ I / O å’Œç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µã€‚æ¨èä½¿ç”¨ exactlyï¼Œè®¾ç½®å‰¯æœ¬æ•°ä¸ºï¼ˆN / 2 +1ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">nodes</td>\n<td style=\"text-align:left\"><em>node names</em></td>\n<td style=\"text-align:left\">æŒ‡å®šé˜Ÿåˆ—åˆ›å»ºåˆ°å“ªäº›èŠ‚ç‚¹ï¼Œå¦‚æœæŒ‡å®šçš„èŠ‚ç‚¹å…¨éƒ¨ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå‡ºç°å¼‚å¸¸ã€‚å¦‚æœæŒ‡å®šçš„èŠ‚ç‚¹åœ¨é›†ç¾¤ä¸­å­˜åœ¨ï¼Œä½†æ˜¯æš‚æ—¶ä¸å¯ç”¨ï¼Œä¼šåˆ›å»ºèŠ‚ç‚¹åˆ°å½“å‰å®¢æˆ·ç«¯è¿æ¥åˆ°çš„èŠ‚ç‚¹ã€‚</td>\n</tr>\n</tbody>\n</table>\n<p>è¿™é‡Œæˆ‘ä»¬ä»¥ rabbitmqctl å‘½ä»¤ä½œä¸ºæ¡ˆä¾‹æ¥è®²è§£é…ç½®è¯­æ³•ã€‚</p>\n<p>è¯­æ³•ç¤ºä¾‹ï¼š</p>\n<h3 id=\"421exactlyæ¨¡å¼\"><a class=\"anchor\" href=\"#421exactlyæ¨¡å¼\">#</a> 4.2.1.exactly æ¨¡å¼</h3>\n<pre><code>rabbitmqctl set_policy ha-two &quot;^two\\.&quot; '&#123;&quot;ha-mode&quot;:&quot;exactly&quot;,&quot;ha-params&quot;:2,&quot;ha-sync-mode&quot;:&quot;automatic&quot;&#125;'\n</code></pre>\n<ul>\n<li><code>rabbitmqctl set_policy</code> ï¼šå›ºå®šå†™æ³•</li>\n<li><code>ha-two</code> ï¼šç­–ç•¥åç§°ï¼Œè‡ªå®šä¹‰</li>\n<li><code>&quot;^two\\.&quot;</code> ï¼šåŒ¹é…é˜Ÿåˆ—çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œç¬¦åˆå‘½åè§„åˆ™çš„é˜Ÿåˆ—æ‰ç”Ÿæ•ˆï¼Œè¿™é‡Œæ˜¯ä»»ä½•ä»¥ <code>two.</code>  å¼€å¤´çš„é˜Ÿåˆ—åç§°</li>\n<li><code>'&#123;&quot;ha-mode&quot;:&quot;exactly&quot;,&quot;ha-params&quot;:2,&quot;ha-sync-mode&quot;:&quot;automatic&quot;&#125;'</code> : ç­–ç•¥å†…å®¹\n<ul>\n<li><code>&quot;ha-mode&quot;:&quot;exactly&quot;</code> ï¼šç­–ç•¥æ¨¡å¼ï¼Œæ­¤å¤„æ˜¯ exactly æ¨¡å¼ï¼ŒæŒ‡å®šå‰¯æœ¬æ•°é‡</li>\n<li><code>&quot;ha-params&quot;:2</code> ï¼šç­–ç•¥å‚æ•°ï¼Œè¿™é‡Œæ˜¯ 2ï¼Œå°±æ˜¯å‰¯æœ¬æ•°é‡ä¸º 2ï¼Œ1 ä¸» 1 é•œåƒ</li>\n<li><code>&quot;ha-sync-mode&quot;:&quot;automatic&quot;</code> ï¼šåŒæ­¥ç­–ç•¥ï¼Œé»˜è®¤æ˜¯ manualï¼Œå³æ–°åŠ å…¥çš„é•œåƒèŠ‚ç‚¹ä¸ä¼šåŒæ­¥æ—§çš„æ¶ˆæ¯ã€‚å¦‚æœè®¾ç½®ä¸º automaticï¼Œåˆ™æ–°åŠ å…¥çš„é•œåƒèŠ‚ç‚¹ä¼šæŠŠä¸»èŠ‚ç‚¹ä¸­æ‰€æœ‰æ¶ˆæ¯éƒ½åŒæ­¥ï¼Œä¼šå¸¦æ¥é¢å¤–çš„ç½‘ç»œå¼€é”€</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"422allæ¨¡å¼\"><a class=\"anchor\" href=\"#422allæ¨¡å¼\">#</a> 4.2.2.all æ¨¡å¼</h3>\n<pre><code>rabbitmqctl set_policy ha-all &quot;^all\\.&quot; '&#123;&quot;ha-mode&quot;:&quot;all&quot;&#125;'\n</code></pre>\n<ul>\n<li><code>ha-all</code> ï¼šç­–ç•¥åç§°ï¼Œè‡ªå®šä¹‰</li>\n<li><code>&quot;^all\\.&quot;</code> ï¼šåŒ¹é…æ‰€æœ‰ä»¥ <code>all.</code>  å¼€å¤´çš„é˜Ÿåˆ—å</li>\n<li><code>'&#123;&quot;ha-mode&quot;:&quot;all&quot;&#125;'</code> ï¼šç­–ç•¥å†…å®¹\n<ul>\n<li><code>&quot;ha-mode&quot;:&quot;all&quot;</code> ï¼šç­–ç•¥æ¨¡å¼ï¼Œæ­¤å¤„æ˜¯ all æ¨¡å¼ï¼Œå³æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šç§°ä¸ºé•œåƒèŠ‚ç‚¹</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"423nodesæ¨¡å¼\"><a class=\"anchor\" href=\"#423nodesæ¨¡å¼\">#</a> 4.2.3.nodes æ¨¡å¼</h3>\n<pre><code>rabbitmqctl set_policy ha-nodes &quot;^nodes\\.&quot; '&#123;&quot;ha-mode&quot;:&quot;nodes&quot;,&quot;ha-params&quot;:[&quot;rabbit@nodeA&quot;, &quot;rabbit@nodeB&quot;]&#125;'\n</code></pre>\n<ul>\n<li><code>rabbitmqctl set_policy</code> ï¼šå›ºå®šå†™æ³•</li>\n<li><code>ha-nodes</code> ï¼šç­–ç•¥åç§°ï¼Œè‡ªå®šä¹‰</li>\n<li><code>&quot;^nodes\\.&quot;</code> ï¼šåŒ¹é…é˜Ÿåˆ—çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œç¬¦åˆå‘½åè§„åˆ™çš„é˜Ÿåˆ—æ‰ç”Ÿæ•ˆï¼Œè¿™é‡Œæ˜¯ä»»ä½•ä»¥ <code>nodes.</code>  å¼€å¤´çš„é˜Ÿåˆ—åç§°</li>\n<li><code>'&#123;&quot;ha-mode&quot;:&quot;nodes&quot;,&quot;ha-params&quot;:[&quot;rabbit@nodeA&quot;, &quot;rabbit@nodeB&quot;]&#125;'</code> : ç­–ç•¥å†…å®¹\n<ul>\n<li><code>&quot;ha-mode&quot;:&quot;nodes&quot;</code> ï¼šç­–ç•¥æ¨¡å¼ï¼Œæ­¤å¤„æ˜¯ nodes æ¨¡å¼</li>\n<li><code>&quot;ha-params&quot;:[&quot;rabbit@mq1&quot;, &quot;rabbit@mq2&quot;]</code> ï¼šç­–ç•¥å‚æ•°ï¼Œè¿™é‡ŒæŒ‡å®šå‰¯æœ¬æ‰€åœ¨èŠ‚ç‚¹åç§°</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"43æµ‹è¯•\"><a class=\"anchor\" href=\"#43æµ‹è¯•\">#</a> 4.3. æµ‹è¯•</h2>\n<p>æˆ‘ä»¬ä½¿ç”¨ exactly æ¨¡å¼çš„é•œåƒï¼Œå› ä¸ºé›†ç¾¤èŠ‚ç‚¹æ•°é‡ä¸º 3ï¼Œå› æ­¤é•œåƒæ•°é‡å°±è®¾ç½®ä¸º 2.</p>\n<p>è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> mq1 rabbitmqctl set_policy ha-two <span class=\"token string\">\"^two\\.\"</span> <span class=\"token string\">'&#123;\"ha-mode\":\"exactly\",\"ha-params\":2,\"ha-sync-mode\":\"automatic\"&#125;'</span></pre></td></tr></table></figure><p>ä¸‹é¢ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„é˜Ÿåˆ—ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140154.png\" alt=\"image-20210717231751411\" /></p>\n<p>åœ¨ä»»æ„ä¸€ä¸ª mq æ§åˆ¶å°æŸ¥çœ‹é˜Ÿåˆ—ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140517.png\" alt=\"image-20210717231829505\" /></p>\n<h3 id=\"431æµ‹è¯•æ•°æ®å…±äº«\"><a class=\"anchor\" href=\"#431æµ‹è¯•æ•°æ®å…±äº«\">#</a> 4.3.1. æµ‹è¯•æ•°æ®å…±äº«</h3>\n<p>ç»™ two.queue å‘é€ä¸€æ¡æ¶ˆæ¯ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140429.png\" alt=\"image-20210717231958996\" /></p>\n<p>ç„¶ååœ¨ mq1ã€mq2ã€mq3 çš„ä»»æ„æ§åˆ¶å°æŸ¥çœ‹æ¶ˆæ¯ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140006.png\" alt=\"image-20210717232108584\" /></p>\n<h3 id=\"432æµ‹è¯•é«˜å¯ç”¨\"><a class=\"anchor\" href=\"#432æµ‹è¯•é«˜å¯ç”¨\">#</a> 4.3.2. æµ‹è¯•é«˜å¯ç”¨</h3>\n<p>ç°åœ¨ï¼Œæˆ‘ä»¬è®© two.queue çš„ä¸»èŠ‚ç‚¹ mq1 å®•æœºï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> stop mq1</pre></td></tr></table></figure><p>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140157.png\" alt=\"image-20210717232257420\" /></p>\n<p>æŸ¥çœ‹é˜Ÿåˆ—çŠ¶æ€ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140733.png\" alt=\"image-20210717232322646\" /></p>\n<p>å‘ç°ä¾ç„¶æ˜¯å¥åº·çš„ï¼å¹¶ä¸”å…¶ä¸»èŠ‚ç‚¹åˆ‡æ¢åˆ°äº† rabbit@mq2 ä¸Š</p>\n<h1 id=\"5ä»²è£é˜Ÿåˆ—\"><a class=\"anchor\" href=\"#5ä»²è£é˜Ÿåˆ—\">#</a> 5. ä»²è£é˜Ÿåˆ—</h1>\n<p>ä» RabbitMQ 3.8 ç‰ˆæœ¬å¼€å§‹ï¼Œå¼•å…¥äº†æ–°çš„ä»²è£é˜Ÿåˆ—ï¼Œä»–å…·å¤‡ä¸é•œåƒé˜Ÿé‡Œç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½†ä½¿ç”¨æ›´åŠ æ–¹ä¾¿ã€‚</p>\n<h2 id=\"51æ·»åŠ ä»²è£é˜Ÿåˆ—\"><a class=\"anchor\" href=\"#51æ·»åŠ ä»²è£é˜Ÿåˆ—\">#</a> 5.1. æ·»åŠ ä»²è£é˜Ÿåˆ—</h2>\n<p>åœ¨ä»»æ„æ§åˆ¶å°æ·»åŠ ä¸€ä¸ªé˜Ÿåˆ—ï¼Œä¸€å®šè¦é€‰æ‹©é˜Ÿåˆ—ç±»å‹ä¸º Quorum ç±»å‹ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140068.png\" alt=\"image-20210717234329640\" /></p>\n<p>åœ¨ä»»æ„æ§åˆ¶å°æŸ¥çœ‹é˜Ÿåˆ—ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140859.png\" alt=\"image-20210717234426209\" /></p>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œä»²è£é˜Ÿåˆ—çš„ + 2 å­—æ ·ã€‚ä»£è¡¨è¿™ä¸ªé˜Ÿåˆ—æœ‰ 2 ä¸ªé•œåƒèŠ‚ç‚¹ã€‚</p>\n<p>å› ä¸ºä»²è£é˜Ÿåˆ—é»˜è®¤çš„é•œåƒæ•°ä¸º 5ã€‚å¦‚æœä½ çš„é›†ç¾¤æœ‰ 7 ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆé•œåƒæ•°è‚¯å®šæ˜¯ 5ï¼›è€Œæˆ‘ä»¬é›†ç¾¤åªæœ‰ 3 ä¸ªèŠ‚ç‚¹ï¼Œå› æ­¤é•œåƒæ•°é‡å°±æ˜¯ 3.</p>\n<h2 id=\"52springamqpåˆ›å»ºä»²è½½é˜Ÿåˆ—\"><a class=\"anchor\" href=\"#52springamqpåˆ›å»ºä»²è½½é˜Ÿåˆ—\">#</a> 5.2.SpringAMQP åˆ›å»ºä»²è½½é˜Ÿåˆ—</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">QuorumConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">quorumQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">QueueBuilder</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">durable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"quorum.queue2\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// æŒä¹…åŒ–</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">quorum</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// ä»²è½½é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>SpringAMQP é“¾æ¥é›†ç¾¤ï¼Œåªéœ€è¦åœ¨ yml ä¸­é…ç½®å³å¯ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">rabbitmq</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">addresses</span><span class=\"token punctuation\">:</span> 192.168.249.128<span class=\"token punctuation\">:</span><span class=\"token number\">8071</span><span class=\"token punctuation\">,</span> 192.168.249.128<span class=\"token punctuation\">:</span><span class=\"token number\">8072</span><span class=\"token punctuation\">,</span> 192.168.249.128<span class=\"token punctuation\">:</span><span class=\"token number\">8073</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\"># port: 5672 # ç«¯å£</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> itcast</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123321</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">virtual-host</span><span class=\"token punctuation\">:</span> /</pre></td></tr></table></figure><h2 id=\"53æµ‹è¯•\"><a class=\"anchor\" href=\"#53æµ‹è¯•\">#</a> 5.3. æµ‹è¯•</h2>\n<p>å¯ä»¥å‚è€ƒå¯¹é•œåƒé›†ç¾¤çš„æµ‹è¯•ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p>\n<h2 id=\"53é›†ç¾¤æ‰©å®¹\"><a class=\"anchor\" href=\"#53é›†ç¾¤æ‰©å®¹\">#</a> 5.3. é›†ç¾¤æ‰©å®¹</h2>\n<h3 id=\"531åŠ å…¥é›†ç¾¤\"><a class=\"anchor\" href=\"#531åŠ å…¥é›†ç¾¤\">#</a> 5.3.1. åŠ å…¥é›†ç¾¤</h3>\n<p>1ï¼‰å¯åŠ¨ä¸€ä¸ªæ–°çš„ MQ å®¹å™¨ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--net</span> mq-net <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token parameter variable\">-v</span> <span class=\"token variable\">$&#123;<span class=\"token environment constant\">PWD</span>&#125;</span>/.erlang.cookie:/var/lib/rabbitmq/.erlang.cookie <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_USER</span><span class=\"token operator\">=</span>itcast <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_PASS</span><span class=\"token operator\">=</span><span class=\"token number\">123321</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token parameter variable\">--name</span> mq4 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token parameter variable\">--hostname</span> mq5 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token parameter variable\">-p</span> <span class=\"token number\">8074</span>:15672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token parameter variable\">-p</span> <span class=\"token number\">8084</span>:15672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>rabbitmq:3.8-management</pre></td></tr></table></figure><p>2ï¼‰è¿›å…¥å®¹å™¨æ§åˆ¶å°ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> mq4 <span class=\"token function\">bash</span></pre></td></tr></table></figure><p>3ï¼‰åœæ­¢ mq è¿›ç¨‹</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmqctl stop_app</pre></td></tr></table></figure><p>4ï¼‰é‡ç½® RabbitMQ ä¸­çš„æ•°æ®ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmqctl reset</pre></td></tr></table></figure><p>5ï¼‰åŠ å…¥ mq1ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmqctl join_cluster rabbit@mq1</pre></td></tr></table></figure><p>6ï¼‰å†æ¬¡å¯åŠ¨ mq è¿›ç¨‹</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmqctl start_app</pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140463.png\" alt=\"image-20210718001909492\" /></p>\n<h3 id=\"532å¢åŠ ä»²è£é˜Ÿåˆ—å‰¯æœ¬\"><a class=\"anchor\" href=\"#532å¢åŠ ä»²è£é˜Ÿåˆ—å‰¯æœ¬\">#</a> 5.3.2. å¢åŠ ä»²è£é˜Ÿåˆ—å‰¯æœ¬</h3>\n<p>æˆ‘ä»¬å…ˆæŸ¥çœ‹ä¸‹ quorum.queue è¿™ä¸ªé˜Ÿåˆ—ç›®å‰çš„å‰¯æœ¬æƒ…å†µï¼Œè¿›å…¥ mq1 å®¹å™¨ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> mq1 <span class=\"token function\">bash</span></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmq-queues quorum_status <span class=\"token string\">\"quorum.queue\"</span></pre></td></tr></table></figure><p>ç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140047.png\" alt=\"image-20210718002118357\" /></p>\n<p>ç°åœ¨ï¼Œæˆ‘ä»¬è®© mq4 ä¹ŸåŠ å…¥è¿›æ¥ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmq-queues add_member <span class=\"token string\">\"quorum.queue\"</span> <span class=\"token string\">\"rabbit@mq4\"</span></pre></td></tr></table></figure><p>ç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140584.png\" alt=\"image-20210718002253226\" /></p>\n<p>å†æ¬¡æŸ¥çœ‹ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmq-queues quorum_status <span class=\"token string\">\"quorum.queue\"</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140083.png\" alt=\"image-20210718002342603\" /></p>\n<p>æŸ¥çœ‹æ§åˆ¶å°ï¼Œå‘ç° quorum.queue çš„é•œåƒæ•°é‡ä¹Ÿä»åŸæ¥çš„ +2 å˜æˆäº† +3ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310221140839.png\" alt=\"image-20210718002422365\" /></p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "RabbitMQ",
                "é«˜çº§",
                "è®¡ç®—æœºå­¦ç§‘",
                "é›†ç¾¤",
                "springcloud",
                "RabbitMQ",
                "éƒ¨ç½²"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/RabbitMQ/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/RabbitMQ/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/",
            "title": "RabbitMQéƒ¨ç½²æŒ‡å—-å•å‡»éƒ¨ç½²",
            "date_published": "2024-01-06T02:37:51.674Z",
            "content_html": "<h1 id=\"rabbitmqéƒ¨ç½²æŒ‡å—\"><a class=\"anchor\" href=\"#rabbitmqéƒ¨ç½²æŒ‡å—\">#</a> RabbitMQ éƒ¨ç½²æŒ‡å—</h1>\n<h1 id=\"1å•æœºéƒ¨ç½²\"><a class=\"anchor\" href=\"#1å•æœºéƒ¨ç½²\">#</a> 1. å•æœºéƒ¨ç½²</h1>\n<p>æˆ‘ä»¬åœ¨ Centos7 è™šæ‹Ÿæœºä¸­ä½¿ç”¨ Docker æ¥å®‰è£…ã€‚</p>\n<h2 id=\"11ä¸‹è½½é•œåƒ\"><a class=\"anchor\" href=\"#11ä¸‹è½½é•œåƒ\">#</a> 1.1. ä¸‹è½½é•œåƒ</h2>\n<p>æ–¹å¼ä¸€ï¼šåœ¨çº¿æ‹‰å–</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> pull rabbitmq:3-management</pre></td></tr></table></figure><p>æ–¹å¼äºŒï¼šä»æœ¬åœ°åŠ è½½</p>\n<p>åœ¨è¯¾å‰èµ„æ–™å·²ç»æä¾›äº†é•œåƒåŒ…ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310101608790.png\" alt=\"image-20210423191210349\" /></p>\n<p>ä¸Šä¼ åˆ°è™šæ‹Ÿæœºä¸­åï¼Œä½¿ç”¨å‘½ä»¤åŠ è½½é•œåƒå³å¯ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> load <span class=\"token parameter variable\">-i</span> mq.tar</pre></td></tr></table></figure><p>ä½¿ç”¨å‘½ä»¤æ¥æŸ¥çœ‹ä¸€ä¸‹</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker images</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>REPOSITORY                   TAG       IMAGE ID       CREATED         SIZE</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>rabbitmq                     latest    24cc95a2cb57   <span class=\"token number\">6</span> days ago      217MB</pre></td></tr></table></figure><h2 id=\"12å®‰è£…mq\"><a class=\"anchor\" href=\"#12å®‰è£…mq\">#</a> 1.2. å®‰è£… MQ</h2>\n<p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥è¿è¡Œ MQ å®¹å™¨ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_USER</span><span class=\"token operator\">=</span>itcast <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_PASS</span><span class=\"token operator\">=</span><span class=\"token number\">123321</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> <span class=\"token parameter variable\">--name</span> mq <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token parameter variable\">--hostname</span> mq1 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> <span class=\"token comment\"># ui ç®¡ç†å¹³å°çš„ç«¯å£å·</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token parameter variable\">-p</span> <span class=\"token number\">15672</span>:15672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> <span class=\"token comment\"># æ¶ˆæ¯é€šä¿¡çš„ç«¯å£å·</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre> <span class=\"token parameter variable\">-p</span> <span class=\"token number\">5672</span>:5672 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token parameter variable\">-d</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> rabbitmq:3-management</pre></td></tr></table></figure><p>æŸ¥çœ‹å¯åŠ¨çŠ¶æ€</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker ps</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>CONTAINER ID   IMAGE                   COMMAND                  CREATED         STATUS         PORTS                                                                                                                                                 NAMES</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>5ca16a608743   rabbitmq:3-management   <span class=\"token string\">\"docker-entrypoint.sâ€¦\"</span>   <span class=\"token number\">2</span> minutes ago   Up <span class=\"token number\">2</span> minutes   <span class=\"token number\">4369</span>/tcp, <span class=\"token number\">5671</span>/tcp, <span class=\"token number\">0.0</span>.0.0:5672-<span class=\"token operator\">></span><span class=\"token number\">5672</span>/tcp, :::5672-<span class=\"token operator\">></span><span class=\"token number\">5672</span>/tcp, <span class=\"token number\">15671</span>/tcp, <span class=\"token number\">15691</span>-15692/tcp, <span class=\"token number\">25672</span>/tcp, <span class=\"token number\">0.0</span>.0.0:15672-<span class=\"token operator\">></span><span class=\"token number\">15672</span>/tcp, :::15672-<span class=\"token operator\">></span><span class=\"token number\">15672</span>/tcp   mq</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>æ§åˆ¶å°æ‰“å°äº†ç«¯å£ä¸ºï¼š15671ï¼Œåœ¨å¯åŠ¨å®¹å™¨æ—¶é…ç½®äº†è´¦å·ä¸ºï¼šitcastï¼Œå¯†ç ä¸ºï¼š123321</p>\n<p>è®¿é—® uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMjQ5LjEyODoxNTY3Mg==\">http://192.168.249.128:15672</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310101627722.png\" alt=\"image-20231010162721293\" /></p>\n<p><strong>é¡µé¢åŠŸèƒ½ä»‹ç»</strong>ï¼š</p>\n<blockquote>\n<p>Overviewï¼šæ€»è§ˆ</p>\n<p>ä½œç”¨ï¼šæŸ¥çœ‹èŠ‚ç‚¹çš„ä¸€äº›è¯¦ç»†ä¿¡æ¯</p>\n</blockquote>\n<blockquote>\n<p>Connectionsï¼šè¿æ¥</p>\n<p>æ— è®ºæ˜¯æ¶ˆæ¯å‘å¸ƒè€…è¿˜æ˜¯æ¶ˆæ¯æ¶ˆè´¹è€…éƒ½åº”è¯¥è·Ÿ mq å»ºç«‹è¿æ¥</p>\n</blockquote>\n<blockquote>\n<p>Channelsï¼šé€šé“</p>\n<p>å»ºç«‹è¿æ¥åä¸€å®šè¦åˆ›å»ºä¸€ä¸ªé€šé“ï¼Œå®Œåç”Ÿäº§è€… æˆ–è€…æ˜¯æ¶ˆè´¹è€…æ‰èƒ½åŸºäº Channel å®Œæˆæ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶</p>\n</blockquote>\n<blockquote>\n<p>Exchangesï¼šäº¤æ¢æœº</p>\n<p>æ˜¯æ¶ˆæ¯çš„è·¯ç”±</p>\n</blockquote>\n<blockquote>\n<p>Queuesï¼šé˜Ÿåˆ—</p>\n</blockquote>\n<blockquote>\n<p>Adminï¼šç”¨æˆ·ç®¡ç†</p>\n<ul>\n<li>Virtual Hostï¼šè™šæ‹Ÿæœºå¯ä»¥å¯¹æ¯ä¸ªç”¨æˆ·è¿›è¡Œä¸€ä¸ªéš”ç¦»é˜²æ­¢æ“ä½œå†²çª</li>\n</ul>\n</blockquote>\n<h1 id=\"2é›†ç¾¤éƒ¨ç½²\"><a class=\"anchor\" href=\"#2é›†ç¾¤éƒ¨ç½²\">#</a> 2. é›†ç¾¤éƒ¨ç½²</h1>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å®‰è£… RabbitMQ çš„é›†ç¾¤ã€‚</p>\n<h2 id=\"21é›†ç¾¤åˆ†ç±»\"><a class=\"anchor\" href=\"#21é›†ç¾¤åˆ†ç±»\">#</a> 2.1. é›†ç¾¤åˆ†ç±»</h2>\n<p>åœ¨ RabbitMQ çš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œè®²è¿°äº†ä¸¤ç§é›†ç¾¤çš„é…ç½®æ–¹å¼ï¼š</p>\n<ul>\n<li>æ™®é€šæ¨¡å¼ï¼šæ™®é€šæ¨¡å¼é›†ç¾¤ä¸è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œæ¯ä¸ª MQ éƒ½æœ‰è‡ªå·±çš„é˜Ÿåˆ—ã€æ•°æ®ä¿¡æ¯ï¼ˆå…¶å®ƒå…ƒæ•°æ®ä¿¡æ¯å¦‚äº¤æ¢æœºç­‰ä¼šåŒæ­¥ï¼‰ã€‚ä¾‹å¦‚æˆ‘ä»¬æœ‰ 2 ä¸ª MQï¼šmq1ï¼Œå’Œ mq2ï¼Œå¦‚æœä½ çš„æ¶ˆæ¯åœ¨ mq1ï¼Œè€Œä½ è¿æ¥åˆ°äº† mq2ï¼Œé‚£ä¹ˆ mq2 ä¼šå» mq1 æ‹‰å–æ¶ˆæ¯ï¼Œç„¶åè¿”å›ç»™ä½ ã€‚å¦‚æœ mq1 å®•æœºï¼Œæ¶ˆæ¯å°±ä¼šä¸¢å¤±ã€‚</li>\n<li>é•œåƒæ¨¡å¼ï¼šä¸æ™®é€šæ¨¡å¼ä¸åŒï¼Œé˜Ÿåˆ—ä¼šåœ¨å„ä¸ª mq çš„é•œåƒèŠ‚ç‚¹ä¹‹é—´åŒæ­¥ï¼Œå› æ­¤ä½ è¿æ¥åˆ°ä»»ä½•ä¸€ä¸ªé•œåƒèŠ‚ç‚¹ï¼Œå‡å¯è·å–åˆ°æ¶ˆæ¯ã€‚è€Œä¸”å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œå¹¶ä¸ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ä¸è¿‡ï¼Œè¿™ç§æ–¹å¼å¢åŠ äº†æ•°æ®åŒæ­¥çš„å¸¦å®½æ¶ˆè€—ã€‚</li>\n</ul>\n<p>æˆ‘ä»¬å…ˆæ¥çœ‹æ™®é€šæ¨¡å¼é›†ç¾¤ã€‚</p>\n<h2 id=\"22è®¾ç½®ç½‘ç»œ\"><a class=\"anchor\" href=\"#22è®¾ç½®ç½‘ç»œ\">#</a> 2.2. è®¾ç½®ç½‘ç»œ</h2>\n<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è®© 3 å° MQ äº’ç›¸çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ã€‚</p>\n<p>åˆ†åˆ«åœ¨ 3 å°æœºå™¨ä¸­ï¼Œè®¾ç½® /etc/hosts æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>\n<pre><code>192.168.150.101 mq1\n192.168.150.102 mq2\n192.168.150.103 mq3\n</code></pre>\n<p>å¹¶åœ¨æ¯å°æœºå™¨ä¸Šæµ‹è¯•ï¼Œæ˜¯å¦å¯ä»¥ ping é€šå¯¹æ–¹ï¼š</p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "RabbitMQ",
                "è®¡ç®—æœºå­¦ç§‘",
                "springcloud",
                "RabbitMQ",
                "éƒ¨ç½²"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Nacos/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Nacos/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/",
            "title": "Nacoså®‰è£…æŒ‡å—",
            "date_published": "2024-01-06T02:33:28.230Z",
            "content_html": "<h1 id=\"nacoså®‰è£…æŒ‡å—\"><a class=\"anchor\" href=\"#nacoså®‰è£…æŒ‡å—\">#</a> Nacos å®‰è£…æŒ‡å—</h1>\n<h1 id=\"1windowså®‰è£…\"><a class=\"anchor\" href=\"#1windowså®‰è£…\">#</a> 1.Windows å®‰è£…</h1>\n<p>å¼€å‘é˜¶æ®µé‡‡ç”¨å•æœºå®‰è£…å³å¯ã€‚</p>\n<h2 id=\"11ä¸‹è½½å®‰è£…åŒ…\"><a class=\"anchor\" href=\"#11ä¸‹è½½å®‰è£…åŒ…\">#</a> 1.1. ä¸‹è½½å®‰è£…åŒ…</h2>\n<p>åœ¨ Nacos çš„ GitHub é¡µé¢ï¼Œæä¾›æœ‰ä¸‹è½½é“¾æ¥ï¼Œå¯ä»¥ä¸‹è½½ç¼–è¯‘å¥½çš„ Nacos æœåŠ¡ç«¯æˆ–è€…æºä»£ç ï¼š</p>\n<p>GitHub ä¸»é¡µï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvbmFjb3M=\">https://github.com/alibaba/nacos</span></p>\n<p>GitHub çš„ Release ä¸‹è½½é¡µï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvbmFjb3MvcmVsZWFzZXM=\">https://github.com/alibaba/nacos/releases</span></p>\n<p>å¦‚å›¾ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218392.png\" alt=\"image-20210402161102887\" /></p>\n<p>æœ¬è¯¾ç¨‹é‡‡ç”¨ 1.4.1. ç‰ˆæœ¬çš„ Nacosï¼Œè¯¾å‰èµ„æ–™å·²ç»å‡†å¤‡äº†å®‰è£…åŒ…ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218840.png\" alt=\"image-20210402161130261\" /></p>\n<p>windows ç‰ˆæœ¬ä½¿ç”¨ <code>nacos-server-1.4.1.zip</code>  åŒ…å³å¯ã€‚</p>\n<h2 id=\"12è§£å‹\"><a class=\"anchor\" href=\"#12è§£å‹\">#</a> 1.2. è§£å‹</h2>\n<p>å°†è¿™ä¸ªåŒ…è§£å‹åˆ°ä»»æ„éä¸­æ–‡ç›®å½•ä¸‹ï¼Œå¦‚å›¾ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218669.png\" alt=\"image-20210402161843337\" /></p>\n<p>ç›®å½•è¯´æ˜ï¼š</p>\n<ul>\n<li>binï¼šå¯åŠ¨è„šæœ¬</li>\n<li>confï¼šé…ç½®æ–‡ä»¶</li>\n</ul>\n<h2 id=\"13ç«¯å£é…ç½®\"><a class=\"anchor\" href=\"#13ç«¯å£é…ç½®\">#</a> 1.3. ç«¯å£é…ç½®</h2>\n<p>Nacos çš„é»˜è®¤ç«¯å£æ˜¯ 8848ï¼Œå¦‚æœä½ ç”µè„‘ä¸Šçš„å…¶å®ƒè¿›ç¨‹å ç”¨äº† 8848 ç«¯å£ï¼Œè¯·å…ˆå°è¯•å…³é—­è¯¥è¿›ç¨‹ã€‚</p>\n<p><strong>å¦‚æœæ— æ³•å…³é—­å ç”¨ 8848 ç«¯å£çš„è¿›ç¨‹</strong>ï¼Œä¹Ÿå¯ä»¥è¿›å…¥ nacos çš„ conf ç›®å½•ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218946.png\" alt=\"image-20210402162008280\" /></p>\n<p>ä¿®æ”¹å…¶ä¸­çš„å†…å®¹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218758.png\" alt=\"image-20210402162251093\" /></p>\n<h2 id=\"14å¯åŠ¨\"><a class=\"anchor\" href=\"#14å¯åŠ¨\">#</a> 1.4. å¯åŠ¨</h2>\n<p>å¯åŠ¨éå¸¸ç®€å•ï¼Œè¿›å…¥ bin ç›®å½•ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218561.png\" alt=\"image-20210402162350977\" /></p>\n<p>ç„¶åæ‰§è¡Œå‘½ä»¤å³å¯ï¼š</p>\n<ul>\n<li>\n<p>windows å‘½ä»¤ï¼š</p>\n<pre><code>startup.cmd -m standalone\n</code></pre>\n</li>\n</ul>\n<p>æ‰§è¡Œåçš„æ•ˆæœå¦‚å›¾ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218179.png\" alt=\"image-20210402162526774\" /></p>\n<h2 id=\"15è®¿é—®\"><a class=\"anchor\" href=\"#15è®¿é—®\">#</a> 1.5. è®¿é—®</h2>\n<p>åœ¨æµè§ˆå™¨è¾“å…¥åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzEyNy4wLjAuMTo4ODQ4L25hY29zJUU1JThEJUIzJUU1JThGJUFGJUVGJUJDJTlB\">http://127.0.0.1:8848/nacos å³å¯ï¼š</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218689.png\" alt=\"image-20210402162630427\" /></p>\n<p>é»˜è®¤çš„è´¦å·å’Œå¯†ç éƒ½æ˜¯ nacosï¼Œè¿›å…¥åï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218382.png\" alt=\"image-20210402162709515\" /></p>\n<h1 id=\"2linuxå®‰è£…\"><a class=\"anchor\" href=\"#2linuxå®‰è£…\">#</a> 2.Linux å®‰è£…</h1>\n<p>Linux æˆ–è€… Mac å®‰è£…æ–¹å¼ä¸ Windows ç±»ä¼¼ã€‚</p>\n<h2 id=\"21å®‰è£…jdk\"><a class=\"anchor\" href=\"#21å®‰è£…jdk\">#</a> 2.1. å®‰è£… JDK</h2>\n<p>Nacos ä¾èµ–äº JDK è¿è¡Œï¼Œæ‰€ä»¥ Linux ä¸Šä¹Ÿéœ€è¦å®‰è£… JDK æ‰è¡Œã€‚</p>\n<p>ä¸Šä¼  jdk å®‰è£…åŒ…ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218243.png\" alt=\"image-20210402172334810\" /></p>\n<p>ä¸Šä¼ åˆ°æŸä¸ªç›®å½•ï¼Œä¾‹å¦‚ï¼š <code>/usr/local/</code></p>\n<p>ç„¶åè§£å‹ç¼©ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">tar</span> <span class=\"token parameter variable\">-xvf</span> jdk-8u144-linux-x64.tar.gz</pre></td></tr></table></figure><p>ç„¶åé‡å‘½åä¸º java</p>\n<p>é…ç½®ç¯å¢ƒå˜é‡ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">JAVA_HOME</span><span class=\"token operator\">=</span>/usr/local/java</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token environment constant\">$PATH</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$JAVA_HOME</span>/bin</pre></td></tr></table></figure><p>åˆ·æ–°ç¯å¢ƒå˜é‡ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">source</span> /etc/profile</pre></td></tr></table></figure><h2 id=\"22ä¸Šä¼ å®‰è£…åŒ…\"><a class=\"anchor\" href=\"#22ä¸Šä¼ å®‰è£…åŒ…\">#</a> 2.2. ä¸Šä¼ å®‰è£…åŒ…</h2>\n<p>å¦‚å›¾ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218879.png\" alt=\"image-20210402161102887\" /></p>\n<p>ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨è¯¾å‰èµ„æ–™ä¸­çš„ tar.gzï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218287.png\" alt=\"image-20210402161130261\" /></p>\n<p>ä¸Šä¼ åˆ° Linux æœåŠ¡å™¨çš„æŸä¸ªç›®å½•ï¼Œä¾‹å¦‚ <code>/usr/local/src</code>  ç›®å½•ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218025.png\" alt=\"image-20210402163715580\" /></p>\n<h2 id=\"23è§£å‹\"><a class=\"anchor\" href=\"#23è§£å‹\">#</a> 2.3. è§£å‹</h2>\n<p>å‘½ä»¤è§£å‹ç¼©å®‰è£…åŒ…ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">tar</span> <span class=\"token parameter variable\">-xvf</span> nacos-server-1.4.1.tar.gz</pre></td></tr></table></figure><p>ç„¶ååˆ é™¤å®‰è£…åŒ…ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">rm</span> <span class=\"token parameter variable\">-rf</span> nacos-server-1.4.1.tar.gz</pre></td></tr></table></figure><p>ç›®å½•ä¸­æœ€ç»ˆæ ·å¼ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218677.png\" alt=\"image-20210402163858429\" /></p>\n<p>ç›®å½•å†…éƒ¨ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051218771.png\" alt=\"image-20210402164414827\" /></p>\n<h2 id=\"24ç«¯å£é…ç½®\"><a class=\"anchor\" href=\"#24ç«¯å£é…ç½®\">#</a> 2.4. ç«¯å£é…ç½®</h2>\n<p>ä¸ windows ä¸­ç±»ä¼¼</p>\n<h2 id=\"25å¯åŠ¨\"><a class=\"anchor\" href=\"#25å¯åŠ¨\">#</a> 2.5. å¯åŠ¨</h2>\n<p>åœ¨ nacos/bin ç›®å½•ä¸­ï¼Œè¾“å…¥å‘½ä»¤å¯åŠ¨ Nacosï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sh</span> startup.sh <span class=\"token parameter variable\">-m</span> standalone</pre></td></tr></table></figure><h1 id=\"3nacosçš„ä¾èµ–\"><a class=\"anchor\" href=\"#3nacosçš„ä¾èµ–\">#</a> 3.Nacos çš„ä¾èµ–</h1>\n<p>çˆ¶å·¥ç¨‹ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-alibaba-dependencies<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.2.5.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>type</span><span class=\"token punctuation\">></span></span>pom<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>type</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>import<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- nacos å®¢æˆ·ç«¯ä¾èµ–åŒ… --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-alibaba-nacos-discovery<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure>",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "Nacos",
                "è®¡ç®—æœºå­¦ç§‘",
                "åŸºç¡€",
                "springcloud",
                "Nacos"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Nacos/nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Nacos/nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/",
            "title": "Nacosé›†ç¾¤æ­å»º",
            "date_published": "2024-01-06T02:33:28.222Z",
            "content_html": "<h1 id=\"nacosé›†ç¾¤æ­å»º\"><a class=\"anchor\" href=\"#nacosé›†ç¾¤æ­å»º\">#</a> Nacos é›†ç¾¤æ­å»º</h1>\n<p>1. é›†ç¾¤ç»“æ„å›¾</p>\n<p>å®˜æ–¹ç»™å‡ºçš„ Nacos é›†ç¾¤å›¾ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061439329.png\" alt=\"image-20210409210621117\" /></p>\n<p>å…¶ä¸­åŒ…å« 3 ä¸ª nacos èŠ‚ç‚¹ï¼Œç„¶åä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ä»£ç† 3 ä¸ª Nacosã€‚è¿™é‡Œè´Ÿè½½å‡è¡¡å™¨å¯ä»¥ä½¿ç”¨ nginxã€‚</p>\n<p>æˆ‘ä»¬è®¡åˆ’çš„é›†ç¾¤ç»“æ„ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061439932.png\" alt=\"image-20210409211355037\" /></p>\n<p>ä¸‰ä¸ª nacos èŠ‚ç‚¹çš„åœ°å€ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>èŠ‚ç‚¹</th>\n<th>ip</th>\n<th>port</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>nacos1</td>\n<td>192.168.150.1</td>\n<td>8845</td>\n</tr>\n<tr>\n<td>nacos2</td>\n<td>192.168.150.1</td>\n<td>8846</td>\n</tr>\n<tr>\n<td>nacos3</td>\n<td>192.168.150.1</td>\n<td>8847</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"2æ­å»ºé›†ç¾¤\"><a class=\"anchor\" href=\"#2æ­å»ºé›†ç¾¤\">#</a> 2. æ­å»ºé›†ç¾¤</h1>\n<p>æ­å»ºé›†ç¾¤çš„åŸºæœ¬æ­¥éª¤ï¼š</p>\n<ul>\n<li>æ­å»ºæ•°æ®åº“ï¼Œåˆå§‹åŒ–æ•°æ®åº“è¡¨ç»“æ„</li>\n<li>ä¸‹è½½ nacos å®‰è£…åŒ…</li>\n<li>é…ç½® nacos</li>\n<li>å¯åŠ¨ nacos é›†ç¾¤</li>\n<li>nginx åå‘ä»£ç†</li>\n</ul>\n<h2 id=\"21åˆå§‹åŒ–æ•°æ®åº“\"><a class=\"anchor\" href=\"#21åˆå§‹åŒ–æ•°æ®åº“\">#</a> 2.1. åˆå§‹åŒ–æ•°æ®åº“</h2>\n<p>Nacos é»˜è®¤æ•°æ®å­˜å‚¨åœ¨å†…åµŒæ•°æ®åº“ Derby ä¸­ï¼Œä¸å±äºç”Ÿäº§å¯ç”¨çš„æ•°æ®åº“ã€‚</p>\n<p>å®˜æ–¹æ¨èçš„æœ€ä½³å®è·µæ˜¯ä½¿ç”¨å¸¦æœ‰ä¸»ä»çš„é«˜å¯ç”¨æ•°æ®åº“é›†ç¾¤ï¼Œä¸»ä»æ¨¡å¼çš„é«˜å¯ç”¨æ•°æ®åº“å¯ä»¥å‚è€ƒ<strong>ä¼ æ™ºæ•™è‚²</strong>çš„åç»­é«˜æ‰‹è¯¾ç¨‹ã€‚</p>\n<p>è¿™é‡Œæˆ‘ä»¬ä»¥å•ç‚¹çš„æ•°æ®åº“ä¸ºä¾‹æ¥è®²è§£ã€‚</p>\n<p>é¦–å…ˆæ–°å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå‘½åä¸º nacosï¼Œè€Œåå¯¼å…¥ä¸‹é¢çš„ SQLï¼š</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>config_info<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'data_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>content<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">longtext</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'content'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>md5<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'md5'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>src_user<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">text</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'source user'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>src_ip<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'source ip'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>app_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç§Ÿæˆ·å­—æ®µ'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>c_desc<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>c_use<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>effect<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>type<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>c_schema<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">text</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>uk_configinfo_datagrouptenant<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8 <span class=\"token keyword\">COLLATE</span><span class=\"token operator\">=</span>utf8_bin <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'config_info'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">/*   è¡¨åç§° = config_info_aggr   */</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>config_info_aggr<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'data_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'group_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>datum_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'datum_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>content<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">longtext</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å†…å®¹'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>app_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç§Ÿæˆ·å­—æ®µ'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>uk_configinfoaggr_datagrouptenantdatum<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>datum_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8 <span class=\"token keyword\">COLLATE</span><span class=\"token operator\">=</span>utf8_bin <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'å¢åŠ ç§Ÿæˆ·å­—æ®µ'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\">/*   è¡¨åç§° = config_info_beta   */</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>config_info_beta<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'data_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'group_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>app_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'app_name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>content<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">longtext</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'content'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>beta_ips<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'betaIps'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>md5<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'md5'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>src_user<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">text</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'source user'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>src_ip<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'source ip'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç§Ÿæˆ·å­—æ®µ'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>uk_configinfobeta_datagrouptenant<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8 <span class=\"token keyword\">COLLATE</span><span class=\"token operator\">=</span>utf8_bin <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'config_info_beta'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token comment\">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token comment\">/*   è¡¨åç§° = config_info_tag   */</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>config_info_tag<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'data_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'group_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'tenant_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tag_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'tag_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>app_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'app_name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>content<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">longtext</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'content'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>md5<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'md5'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>src_user<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">text</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'source user'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>src_ip<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'source ip'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>uk_configinfotag_datagrouptenanttag<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tag_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8 <span class=\"token keyword\">COLLATE</span><span class=\"token operator\">=</span>utf8_bin <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'config_info_tag'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre></pre></td></tr><tr><td data-num=\"82\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre><span class=\"token comment\">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre><span class=\"token comment\">/*   è¡¨åç§° = config_tags_relation   */</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>config_tags_relation<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tag_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'tag_name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tag_type<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'tag_type'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'data_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'group_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'tenant_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>nid<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>nid<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>uk_configtagrelation_configidtag<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tag_name<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tag_type<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>idx_tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8 <span class=\"token keyword\">COLLATE</span><span class=\"token operator\">=</span>utf8_bin <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'config_tag_relation'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre></pre></td></tr><tr><td data-num=\"99\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre><span class=\"token comment\">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre><span class=\"token comment\">/*   è¡¨åç§° = group_capacity   */</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_capacity<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¸»é”®ID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Group IDï¼Œç©ºå­—ç¬¦è¡¨ç¤ºæ•´ä¸ªé›†ç¾¤'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>quota<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>usage<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä½¿ç”¨é‡'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>max_size<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>max_aggr_count<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°ï¼Œï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>max_aggr_size<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>max_history_count<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€å¤§å˜æ›´å†å²æ•°é‡'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>uk_group_id<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8 <span class=\"token keyword\">COLLATE</span><span class=\"token operator\">=</span>utf8_bin <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'é›†ç¾¤ã€å„Groupå®¹é‡ä¿¡æ¯è¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre></pre></td></tr><tr><td data-num=\"118\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre><span class=\"token comment\">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre><span class=\"token comment\">/*   è¡¨åç§° = his_config_info   */</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>his_config_info<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>nid<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>app_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'app_name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>content<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">longtext</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>md5<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>src_user<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">text</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>src_ip<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>op_type<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç§Ÿæˆ·å­—æ®µ'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>nid<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>idx_gmt_create<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>idx_gmt_modified<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>idx_did<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>data_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8 <span class=\"token keyword\">COLLATE</span><span class=\"token operator\">=</span>utf8_bin <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'å¤šç§Ÿæˆ·æ”¹é€ '</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre></pre></td></tr><tr><td data-num=\"142\"></td><td><pre></pre></td></tr><tr><td data-num=\"143\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre><span class=\"token comment\">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre><span class=\"token comment\">/*   è¡¨åç§° = tenant_capacity   */</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre><span class=\"token comment\">/******************************************/</span></pre></td></tr><tr><td data-num=\"147\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_capacity<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"148\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¸»é”®ID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"149\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Tenant ID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"150\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>quota<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>usage<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä½¿ç”¨é‡'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"152\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>max_size<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>max_aggr_count<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>max_aggr_size<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"155\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>max_history_count<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€å¤§å˜æ›´å†å²æ•°é‡'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"156\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"157\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"159\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>uk_tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"160\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8 <span class=\"token keyword\">COLLATE</span><span class=\"token operator\">=</span>utf8_bin <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'ç§Ÿæˆ·å®¹é‡ä¿¡æ¯è¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"161\"></td><td><pre></pre></td></tr><tr><td data-num=\"162\"></td><td><pre></pre></td></tr><tr><td data-num=\"163\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_info<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"164\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"165\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>kp<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'kp'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"166\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">default</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'tenant_id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"167\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">default</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'tenant_name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"168\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_desc<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'tenant_desc'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"169\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>create_source<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'create_source'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"170\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"171\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"172\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"173\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>uk_tenant_info_kptenantid<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>kp<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"174\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>idx_tenant_id<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>tenant_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"175\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8 <span class=\"token keyword\">COLLATE</span><span class=\"token operator\">=</span>utf8_bin <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'tenant_info'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"176\"></td><td><pre></pre></td></tr><tr><td data-num=\"177\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>users<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"178\"></td><td><pre>\t<span class=\"token identifier\"><span class=\"token punctuation\">`</span>username<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"179\"></td><td><pre>\t<span class=\"token identifier\"><span class=\"token punctuation\">`</span>password<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"180\"></td><td><pre>\t<span class=\"token identifier\"><span class=\"token punctuation\">`</span>enabled<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">boolean</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span></pre></td></tr><tr><td data-num=\"181\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"182\"></td><td><pre></pre></td></tr><tr><td data-num=\"183\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>roles<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"184\"></td><td><pre>\t<span class=\"token identifier\"><span class=\"token punctuation\">`</span>username<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"185\"></td><td><pre>\t<span class=\"token identifier\"><span class=\"token punctuation\">`</span>role<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"186\"></td><td><pre>\t<span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">INDEX</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>idx_user_role<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>username<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">ASC</span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>role<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">ASC</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span></pre></td></tr><tr><td data-num=\"187\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"188\"></td><td><pre></pre></td></tr><tr><td data-num=\"189\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>permissions<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"190\"></td><td><pre>    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>role<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"191\"></td><td><pre>    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>resource<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"192\"></td><td><pre>    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>action<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"193\"></td><td><pre>    <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">INDEX</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>uk_role_permission<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>role<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>resource<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>action<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span></pre></td></tr><tr><td data-num=\"194\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"195\"></td><td><pre></pre></td></tr><tr><td data-num=\"196\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> users <span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">,</span> enabled<span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'nacos'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"197\"></td><td><pre></pre></td></tr><tr><td data-num=\"198\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> roles <span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> role<span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'nacos'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ROLE_ADMIN'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"22ä¸‹è½½nacos\"><a class=\"anchor\" href=\"#22ä¸‹è½½nacos\">#</a> 2.2. ä¸‹è½½ nacos</h2>\n<p>nacos åœ¨ GitHub ä¸Šæœ‰ä¸‹è½½åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvbmFjb3MvdGFncyVFRiVCQyU4QyVFNSU4RiVBRiVFNCVCQiVBNSVFOSU4MCU4OSVFNiU4QiVBOSVFNCVCQiVCQiVFNiU4NCU4RiVFNyU4OSU4OCVFNiU5QyVBQyVFNCVCOCU4QiVFOCVCRCVCRCVFMyU4MCU4Mg==\">https://github.com/alibaba/nacos/tagsï¼Œå¯ä»¥é€‰æ‹©ä»»æ„ç‰ˆæœ¬ä¸‹è½½ã€‚</span></p>\n<p>æœ¬ä¾‹ä¸­æ‰ç”¨ 1.4.1 ç‰ˆæœ¬ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061439539.png\" alt=\"image-20210409212119411\" /></p>\n<h2 id=\"23é…ç½®nacos\"><a class=\"anchor\" href=\"#23é…ç½®nacos\">#</a> 2.3. é…ç½® Nacos</h2>\n<p>å°†è¿™ä¸ªåŒ…è§£å‹åˆ°ä»»æ„éä¸­æ–‡ç›®å½•ä¸‹ï¼Œå¦‚å›¾ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061439220.png\" alt=\"image-20210402161843337\" /></p>\n<p>ç›®å½•è¯´æ˜ï¼š</p>\n<ul>\n<li>binï¼šå¯åŠ¨è„šæœ¬</li>\n<li>confï¼šé…ç½®æ–‡ä»¶</li>\n</ul>\n<p>è¿›å…¥ nacos çš„ conf ç›®å½•ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ cluster.conf.exampleï¼Œé‡å‘½åä¸º cluster.confï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061440003.png\" alt=\"image-20210409212459292\" /></p>\n<p>ç„¶åæ·»åŠ å†…å®¹ï¼š</p>\n<p>é›†ç¾¤ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯</p>\n<p>å¦‚æœæ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹é‚£ä¸‹é¢ä¸‰ä¸ªéƒ½åº”è¯¥æ˜¯çœŸå®æœºå™¨çš„ ip åœ°å€å’Œç«¯å£å·</p>\n<pre><code>127.0.0.1:8845\n127.0.0.1.8846\n127.0.0.1.8847\n</code></pre>\n<p>ç„¶åä¿®æ”¹ application.properties æ–‡ä»¶ï¼Œæ·»åŠ æ•°æ®åº“é…ç½®</p>\n<p>å°†é…ç½®æ–‡ä»¶ä¸­å¦‚ä¸‹çš„é…ç½®çš„æ³¨é‡Šå…¨éƒ¨å»æ‰ä¹Ÿå°±æ˜¯æ‰“å¼€</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key attr-name\">spring.datasource.platform</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">mysql</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key attr-name\">db.num</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">1</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key attr-name\">db.url.0</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key attr-name\">db.user.0</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">root</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key attr-name\">db.password.0</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">123</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061439107.png\" alt=\"image-20231006143926134\" /></p>\n<h2 id=\"24å¯åŠ¨\"><a class=\"anchor\" href=\"#24å¯åŠ¨\">#</a> 2.4. å¯åŠ¨</h2>\n<p>å°† nacos æ–‡ä»¶å¤¹å¤åˆ¶ä¸‰ä»½ï¼Œåˆ†åˆ«å‘½åä¸ºï¼šnacos1ã€nacos2ã€nacos3</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061440201.png\" alt=\"image-20210409213335538\" /></p>\n<p>ç„¶ååˆ†åˆ«ä¿®æ”¹ä¸‰ä¸ªæ–‡ä»¶å¤¹ä¸­çš„ application.propertiesï¼Œ</p>\n<p>nacos1:</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key attr-name\">server.port</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">8845</span></pre></td></tr></table></figure><p>nacos2:</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key attr-name\">server.port</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">8846</span></pre></td></tr></table></figure><p>nacos3:</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key attr-name\">server.port</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">8847</span></pre></td></tr></table></figure><p>ç„¶ååˆ†åˆ«å¯åŠ¨ä¸‰ä¸ª nacos èŠ‚ç‚¹ï¼š</p>\n<p>&lt;font color='red'&gt; æ³¨æ„ &lt;/font&gt;ï¼šæ­¤æ—¶å¯åŠ¨ä¸éœ€è¦åŠ å‚æ•°äº†ï¼Œç›´æ¥å¯åŠ¨å³å¯ã€‚å› ä¸ºç°åœ¨æ˜¯é›†ç¾¤å¯åŠ¨ (é»˜è®¤)</p>\n<pre><code>startup.cmd\n</code></pre>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061454156.png\" alt=\"image-20231006145123931\" /></p>\n<p>ç„¶åä¾æ¬¡è®¿é—®ä¸€ä¸‹ url çœ‹çœ‹æ˜¯å¦æ­£å¸¸å¯åŠ¨äº†</p>\n<p>æ­£å¸¸å¯åŠ¨äº†ï¼</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061453370.png\" alt=\"image-20231006145253400\" /></p>\n<h2 id=\"25nginxåå‘ä»£ç†\"><a class=\"anchor\" href=\"#25nginxåå‘ä»£ç†\">#</a> 2.5.nginx åå‘ä»£ç†</h2>\n<p>æ‰¾åˆ°è¯¾å‰èµ„æ–™æä¾›çš„ nginx å®‰è£…åŒ…ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061440828.png\" alt=\"image-20210410103253355\" /></p>\n<p>è§£å‹åˆ°ä»»æ„éä¸­æ–‡ç›®å½•ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061440364.png\" alt=\"image-20210410103322874\" /></p>\n<p>ä¿®æ”¹ conf/nginx.conf æ–‡ä»¶ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">http</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token directive\"><span class=\"token keyword\">upstream</span> nacos-cluster</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    \t<span class=\"token directive\"><span class=\"token keyword\">server</span> 127.0.0.1:8845</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token directive\"><span class=\"token keyword\">server</span> 127.0.0.1:8846</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token directive\"><span class=\"token keyword\">server</span> 127.0.0.1:8847</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    \t<span class=\"token directive\"><span class=\"token keyword\">listen</span>       <span class=\"token number\">80</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    \t<span class=\"token directive\"><span class=\"token keyword\">server_name</span>  localhost</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    \t<span class=\"token directive\"><span class=\"token keyword\">location</span> /nacos</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">proxy_pass</span> http://nacos-cluster</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    \t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®Œæ•´çš„é…ç½®æ–‡ä»¶ä¿¡æ¯ï¼š</p>\n<pre><code>\n#user  nobody;\nworker_processes  1;\n\n#error_log  logs/error.log;\n#error_log  logs/error.log  notice;\n#error_log  logs/error.log  info;\n\n#pid        logs/nginx.pid;\n\n\nevents &#123;\n    worker_connections  1024;\n&#125;\n\n\nhttp &#123;\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    #log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '\n    #                  '$status $body_bytes_sent &quot;$http_referer&quot; '\n    #                  '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';\n\n    #access_log  logs/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    #keepalive_timeout  0;\n    keepalive_timeout  65;\n\n    #gzip  on;\n\n    server &#123;\n        listen       88;\n        server_name  localhost;\n\n        location / &#123;\n            root   html;\n            index  index.html index.htm;\n        &#125;\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n    &#125;\n\tupstream nacos-cluster &#123;\n    \t\tserver 127.0.0.1:8845;\n\t\tserver 127.0.0.1:8846;\n\t\tserver 127.0.0.1:8847;\n\t&#125;\n\n\tserver &#123;\n    \t\tlisten       80;\n    \t\tserver_name  localhost;\n\n    \t\tlocation /nacos &#123;\n        \t\tproxy_pass http://nacos-cluster;\n    \t\t&#125;\n\t&#125;\n&#125;\n</code></pre>\n<p>é…ç½®å®Œæˆåå¯åŠ¨ nginxï¼Œæ‰§è¡Œå‘½ä»¤ï¼šstart nginx.exe</p>\n<p>è®¿é—®ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4OC8lRTYlOUYlQTUlRTclOUMlOEIlRTYlOTglQUYlRTUlOTAlQTYlRTglODMlQkQlRTYlQUQlQTMlRTUlQjglQjglRTglQUUlQkYlRTklOTclQUU=\">http://localhost:88 / æŸ¥çœ‹æ˜¯å¦èƒ½æ­£å¸¸è®¿é—®</span></p>\n<p>nginx å¯åŠ¨æˆåŠŸï¼</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061521543.png\" alt=\"image-20231006152139209\" /></p>\n<p>è€Œååœ¨æµè§ˆå™¨è®¿é—®ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9uYWNvcyVFNSU4RCVCMyVFNSU4RiVBRiVFMyU4MCU4Mg==\">http://localhost/nacos å³å¯ã€‚</span></p>\n<p>åˆ°è¿™å„¿ï¼é›†ç¾¤æ­å»ºå°±æˆåŠŸäº†ã€‚çœ‹ç€åƒæ˜¯è®¿é—®çš„ä¸€ä¸ª nacosï¼Œäº‹å®ä¸Šå®ƒä¼šåœ¨ä¸‰ä¸ª nacos ä¹‹é—´åšä¸€ä¸ªè´Ÿè½½å‡è¡¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061522455.png\" alt=\"image-20231006152205310\" /></p>\n<p>é—®é¢˜æ¥äº†ï¼Œjava ä»£ç è¯¥å¦‚ä½•é…å‘¢ï¼Œåœ¨ java çš„ yml é…ç½®æ–‡ä»¶ä¸­å°† nacos çš„æœåŠ¡åœ°å€æ”¹ä¸ºå¯¹åº”çš„ç«¯å£ä¹Ÿå°±æ˜¯ 80 ç«¯å£</p>\n<p>ä»£ç ä¸­ bootstrap.yml æ–‡ä»¶é…ç½®å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> userservice <span class=\"token comment\"># æœåŠ¡åç§°</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">profiles</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">active</span><span class=\"token punctuation\">:</span> dev <span class=\"token comment\"># ç¯å¢ƒ</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">80</span> <span class=\"token comment\"># nacos åœ°å€ï¼Œè¿™é‡Œæ‰¾çš„æ˜¯ nginx åå‘ä»£ç†çš„åœ°å€å®ƒä¼šæ ¹æ®è´Ÿè½½å‡è¡¡æ¥å¯åŠ¨ nacos</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token key atrule\">file-extension</span><span class=\"token punctuation\">:</span> yaml <span class=\"token comment\"># é…ç½®æ–‡ä»¶åç¼€å</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># ä¸‰è¦ç´ ï¼šæœåŠ¡åç§°ï¼Œç¯å¢ƒï¼Œåç¼€å è€Œè¿™ä¸‰ä¸ªå†³å®šäº† DateId</span></pre></td></tr></table></figure><p>å¯åŠ¨ user-service æœåŠ¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061528874.png\" alt=\"image-20231006152811433\" /></p>\n<p>æˆ‘ä»¬æŸ¥çœ‹ nacos æ§åˆ¶å°ä¸­çš„æœåŠ¡åˆ—è¡¨ã€‚</p>\n<p>å¯ä»¥çœ‹åˆ°æˆåŠŸçš„æ³¨å†Œè¿›æ¥äº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061528168.png\" alt=\"image-20231006152847028\" /></p>\n<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œç‚¹å‡»å‘å¸ƒ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061544827.png\" alt=\"image-20231006154304156\" /></p>\n<p>å‘å¸ƒåæŸ¥çœ‹æ•°æ®åº“ä¸­çš„ config_info è¡¨é‡Œé¢çš„ä¿¡æ¯ï¼Œå°±å¯ä»¥çœ‹åˆ°å¤šäº†ä¸€æ¡ä¿¡æ¯å°±æ˜¯åˆ›å»ºçš„ç¯å¢ƒé…ç½®æ–‡ä»¶çš„ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061545446.png\" alt=\"image-20231006154339296\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>é›†ç¾¤æ­å»ºæ­¥éª¤ï¼š</p>\n<ol>\n<li>æ­å»º MySQL é›†ç¾¤å¹¶åˆå§‹åŒ–æ•°æ®åº“è¡¨</li>\n<li>ä¸‹è½½è§£å‹ nacos</li>\n<li>ä¿®æ”¹é›†ç¾¤é…ç½® (èŠ‚ç‚¹ä¿¡æ¯)ï¼Œæ•°æ®åº“é…ç½®</li>\n<li>åˆ†åˆ«å¯åŠ¨å¤šä¸ª nacos èŠ‚ç‚¹</li>\n<li>nginx åå‘ä»£ç†</li>\n</ol>\n</blockquote>\n<h2 id=\"26ä¼˜åŒ–\"><a class=\"anchor\" href=\"#26ä¼˜åŒ–\">#</a> 2.6. ä¼˜åŒ–</h2>\n<ul>\n<li>\n<p>å®é™…éƒ¨ç½²æ—¶ï¼Œéœ€è¦ç»™åšåå‘ä»£ç†çš„ nginx æœåŠ¡å™¨è®¾ç½®ä¸€ä¸ªåŸŸåï¼Œè¿™æ ·åç»­å¦‚æœæœ‰æœåŠ¡å™¨è¿ç§» nacos çš„å®¢æˆ·ç«¯ä¹Ÿæ— éœ€æ›´æ”¹é…ç½®.</p>\n</li>\n<li>\n<p>Nacos çš„å„ä¸ªèŠ‚ç‚¹åº”è¯¥éƒ¨ç½²åˆ°å¤šä¸ªä¸åŒæœåŠ¡å™¨ï¼Œåšå¥½å®¹ç¾å’Œéš”ç¦»</p>\n</li>\n</ul>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "Nacos",
                "è®¡ç®—æœºå­¦ç§‘",
                "é›†ç¾¤",
                "springcloud",
                "Nacos"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Elasticsearch/%E5%AE%89%E8%A3%85elasticsearch/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Elasticsearch/%E5%AE%89%E8%A3%85elasticsearch/",
            "title": "å®‰è£…elasticsearch",
            "date_published": "2024-01-06T02:31:36.590Z",
            "content_html": "<h1 id=\"å®‰è£…elasticsearch\"><a class=\"anchor\" href=\"#å®‰è£…elasticsearch\">#</a> å®‰è£… elasticsearch</h1>\n<h1 id=\"1éƒ¨ç½²å•ç‚¹es\"><a class=\"anchor\" href=\"#1éƒ¨ç½²å•ç‚¹es\">#</a> 1. éƒ¨ç½²å•ç‚¹ es</h1>\n<h2 id=\"11åˆ›å»ºç½‘ç»œ\"><a class=\"anchor\" href=\"#11åˆ›å»ºç½‘ç»œ\">#</a> 1.1. åˆ›å»ºç½‘ç»œ</h2>\n<p>å› ä¸ºæˆ‘ä»¬è¿˜éœ€è¦éƒ¨ç½² kibana å®¹å™¨ï¼Œå› æ­¤éœ€è¦è®© es å’Œ kibana å®¹å™¨äº’è”ã€‚è¿™é‡Œå…ˆåˆ›å»ºä¸€ä¸ªç½‘ç»œï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> network create es-net</pre></td></tr></table></figure><h2 id=\"12åŠ è½½é•œåƒ\"><a class=\"anchor\" href=\"#12åŠ è½½é•œåƒ\">#</a> 1.2. åŠ è½½é•œåƒ</h2>\n<p>è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ elasticsearch çš„ 7.12.1 ç‰ˆæœ¬çš„é•œåƒï¼Œè¿™ä¸ªé•œåƒä½“ç§¯éå¸¸å¤§ï¼Œæ¥è¿‘ 1Gã€‚ä¸å»ºè®®å¤§å®¶è‡ªå·± pullã€‚</p>\n<p>è¯¾å‰èµ„æ–™æä¾›äº†é•œåƒçš„ tar åŒ…ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112020462.png\" alt=\"image-20210510165308064\" /></p>\n<p>å¤§å®¶å°†å…¶ä¸Šä¼ åˆ°è™šæ‹Ÿæœºä¸­ï¼Œç„¶åè¿è¡Œå‘½ä»¤åŠ è½½å³å¯ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># å¯¼å…¥æ•°æ®</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> load <span class=\"token parameter variable\">-i</span> es.tar</pre></td></tr></table></figure><p>åŒç†è¿˜æœ‰ <code>kibana</code>  çš„ tar åŒ…ä¹Ÿéœ€è¦è¿™æ ·åšã€‚</p>\n<h2 id=\"13è¿è¡Œ\"><a class=\"anchor\" href=\"#13è¿è¡Œ\">#</a> 1.3. è¿è¡Œ</h2>\n<p>è¿è¡Œ docker å‘½ä»¤ï¼Œéƒ¨ç½²å•ç‚¹ esï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token parameter variable\">--name</span> es <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token parameter variable\">-e</span> <span class=\"token string\">\"ES_JAVA_OPTS=-Xms512m -Xmx512m\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token parameter variable\">-e</span> <span class=\"token string\">\"discovery.type=single-node\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token parameter variable\">-v</span> es-data:/usr/share/elasticsearch/data <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token parameter variable\">-v</span> es-plugins:/usr/share/elasticsearch/plugins <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token parameter variable\">--privileged</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token parameter variable\">--network</span> es-net <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token parameter variable\">-p</span> <span class=\"token number\">9200</span>:9200 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token parameter variable\">-p</span> <span class=\"token number\">9300</span>:9300 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>elasticsearch:7.12.1</pre></td></tr></table></figure><p>å‘½ä»¤è§£é‡Šï¼š</p>\n<ul>\n<li><code>-e &quot;cluster.name=es-docker-cluster&quot;</code> ï¼šè®¾ç½®é›†ç¾¤åç§°</li>\n<li><code>-e &quot;http.host=0.0.0.0&quot;</code> ï¼šç›‘å¬çš„åœ°å€ï¼Œå¯ä»¥å¤–ç½‘è®¿é—®</li>\n<li><code>-e &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</code> ï¼šå†…å­˜å¤§å°</li>\n<li><code>-e &quot;discovery.type=single-node&quot;</code> ï¼šéé›†ç¾¤æ¨¡å¼</li>\n<li><code>-v es-data:/usr/share/elasticsearch/data</code> ï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®š es çš„æ•°æ®ç›®å½•</li>\n<li><code>-v es-logs:/usr/share/elasticsearch/logs</code> ï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®š es çš„æ—¥å¿—ç›®å½•</li>\n<li><code>-v es-plugins:/usr/share/elasticsearch/plugins</code> ï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®š es çš„æ’ä»¶ç›®å½•</li>\n<li><code>--privileged</code> ï¼šæˆäºˆé€»è¾‘å·è®¿é—®æƒ</li>\n<li><code>--network es-net</code>  ï¼šåŠ å…¥ä¸€ä¸ªåä¸º es-net çš„ç½‘ç»œä¸­</li>\n<li><code>-p 9200:9200</code> ï¼šç«¯å£æ˜ å°„é…ç½®</li>\n</ul>\n<p>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTUwLjEwMTo5MjAw\">http://192.168.150.101:9200</span> å³å¯çœ‹åˆ° elasticsearch çš„å“åº”ç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112020815.png\" alt=\"image-20210506101053676\" /></p>\n<h1 id=\"2éƒ¨ç½²kibana\"><a class=\"anchor\" href=\"#2éƒ¨ç½²kibana\">#</a> 2. éƒ¨ç½² kibana</h1>\n<p>kibana å¯ä»¥ç»™æˆ‘ä»¬æä¾›ä¸€ä¸ª elasticsearch çš„å¯è§†åŒ–ç•Œé¢ï¼Œä¾¿äºæˆ‘ä»¬å­¦ä¹ ã€‚</p>\n<h2 id=\"21éƒ¨ç½²\"><a class=\"anchor\" href=\"#21éƒ¨ç½²\">#</a> 2.1. éƒ¨ç½²</h2>\n<p>è¿è¡Œ docker å‘½ä»¤ï¼Œéƒ¨ç½² kibana</p>\n<p>kibana éœ€è¦å’Œ elaticsearch å¤„äºåŒä¸€ä¸ªç½‘ç»œä¸­</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token parameter variable\">--name</span> kibana <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># å› ä¸ºå®ƒä»¬ä¸¤ä¸ªä¸ºåŒä¸€ä¸ªç½‘ç»œï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨å®¹å™¨åäº’è”</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">ELASTICSEARCH_HOSTS</span><span class=\"token operator\">=</span>http://es:9200 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token parameter variable\">--network</span><span class=\"token operator\">=</span>es-net <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token parameter variable\">-p</span> <span class=\"token number\">5601</span>:5601  <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>kibana:7.12.1</pre></td></tr></table></figure><ul>\n<li><code>--network es-net</code>  ï¼šåŠ å…¥ä¸€ä¸ªåä¸º es-net çš„ç½‘ç»œä¸­ï¼Œä¸ elasticsearch åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­</li>\n<li><code>-e ELASTICSEARCH_HOSTS=http://es:9200&quot;</code> ï¼šè®¾ç½® elasticsearch çš„åœ°å€ï¼Œå› ä¸º kibana å·²ç»ä¸ elasticsearch åœ¨ä¸€ä¸ªç½‘ç»œï¼Œå› æ­¤å¯ä»¥ç”¨å®¹å™¨åç›´æ¥è®¿é—® elasticsearch</li>\n<li><code>-p 5601:5601</code> ï¼šç«¯å£æ˜ å°„é…ç½®</li>\n</ul>\n<p>kibana å¯åŠ¨ä¸€èˆ¬æ¯”è¾ƒæ…¢ï¼Œéœ€è¦å¤šç­‰å¾…ä¸€ä¼šï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> logs <span class=\"token parameter variable\">-f</span> kibana</pre></td></tr></table></figure><p>æŸ¥çœ‹è¿è¡Œæ—¥å¿—ï¼Œå½“æŸ¥çœ‹åˆ°ä¸‹é¢çš„æ—¥å¿—ï¼Œè¯´æ˜æˆåŠŸï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112020301.png\" alt=\"image-20210109105135812\" /></p>\n<p>æ­¤æ—¶ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥åœ°å€è®¿é—®ï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTUwLjEwMTo1NjAx\">http://192.168.150.101:5601</span>ï¼Œå³å¯çœ‹åˆ°ç»“æœ</p>\n<h2 id=\"22devtools\"><a class=\"anchor\" href=\"#22devtools\">#</a> 2.2.DevTools</h2>\n<p>kibana ä¸­æä¾›äº†ä¸€ä¸ª DevTools ç•Œé¢ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112020356.png\" alt=\"image-20210506102630393\" /></p>\n<p>è¿™ä¸ªç•Œé¢ä¸­å¯ä»¥ç¼–å†™ DSL æ¥æ“ä½œ elasticsearchã€‚å¹¶ä¸”å¯¹ DSL è¯­å¥æœ‰è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ã€‚</p>\n<h1 id=\"3å®‰è£…ikåˆ†è¯å™¨\"><a class=\"anchor\" href=\"#3å®‰è£…ikåˆ†è¯å™¨\">#</a> 3. å®‰è£… IK åˆ†è¯å™¨</h1>\n<h2 id=\"31åœ¨çº¿å®‰è£…ikæ’ä»¶è¾ƒæ…¢\"><a class=\"anchor\" href=\"#31åœ¨çº¿å®‰è£…ikæ’ä»¶è¾ƒæ…¢\">#</a> 3.1. åœ¨çº¿å®‰è£… ik æ’ä»¶ï¼ˆè¾ƒæ…¢ï¼‰</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># è¿›å…¥å®¹å™¨å†…éƒ¨</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> elasticsearch /bin/bash</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># åœ¨çº¿ä¸‹è½½å¹¶å®‰è£…</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>./bin/elasticsearch-plugin  <span class=\"token function\">install</span> https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.12.1/elasticsearch-analysis-ik-7.12.1.zip</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#é€€å‡º</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token builtin class-name\">exit</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#é‡å¯å®¹å™¨</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">docker</span> restart elasticsearch</pre></td></tr></table></figure><h2 id=\"32ç¦»çº¿å®‰è£…ikæ’ä»¶æ¨è\"><a class=\"anchor\" href=\"#32ç¦»çº¿å®‰è£…ikæ’ä»¶æ¨è\">#</a> 3.2. ç¦»çº¿å®‰è£… ik æ’ä»¶ï¼ˆæ¨èï¼‰</h2>\n<h3 id=\"1æŸ¥çœ‹æ•°æ®å·ç›®å½•\"><a class=\"anchor\" href=\"#1æŸ¥çœ‹æ•°æ®å·ç›®å½•\">#</a> 1ï¼‰æŸ¥çœ‹æ•°æ®å·ç›®å½•</h3>\n<p>å®‰è£…æ’ä»¶éœ€è¦çŸ¥é“ elasticsearch çš„ plugins ç›®å½•ä½ç½®ï¼Œè€Œæˆ‘ä»¬ç”¨äº†æ•°æ®å·æŒ‚è½½ï¼Œå› æ­¤éœ€è¦æŸ¥çœ‹ elasticsearch çš„æ•°æ®å·ç›®å½•ï¼Œé€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹:</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> volume inspect es-plugins</pre></td></tr></table></figure><p>æ˜¾ç¤ºç»“æœï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"CreatedAt\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2022-05-06T10:06:34+08:00\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token property\">\"Driver\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"local\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token property\">\"Labels\"</span><span class=\"token operator\">:</span> <span class=\"token null keyword\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token property\">\"Mountpoint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/var/lib/docker/volumes/es-plugins/_data\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token property\">\"Name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"es-plugins\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"Options\"</span><span class=\"token operator\">:</span> <span class=\"token null keyword\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token property\">\"Scope\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"local\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>è¯´æ˜ plugins ç›®å½•è¢«æŒ‚è½½åˆ°äº†ï¼š <code>/var/lib/docker/volumes/es-plugins/_data </code> è¿™ä¸ªç›®å½•ä¸­ã€‚</p>\n<h3 id=\"2è§£å‹ç¼©åˆ†è¯å™¨å®‰è£…åŒ…\"><a class=\"anchor\" href=\"#2è§£å‹ç¼©åˆ†è¯å™¨å®‰è£…åŒ…\">#</a> 2ï¼‰è§£å‹ç¼©åˆ†è¯å™¨å®‰è£…åŒ…</h3>\n<p>ä¸‹é¢æˆ‘ä»¬éœ€è¦æŠŠè¯¾å‰èµ„æ–™ä¸­çš„ ik åˆ†è¯å™¨è§£å‹ç¼©ï¼Œé‡å‘½åä¸º ik</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112020922.png\" alt=\"image-20210506110249144\" /></p>\n<h3 id=\"3ä¸Šä¼ åˆ°eså®¹å™¨çš„æ’ä»¶æ•°æ®å·ä¸­\"><a class=\"anchor\" href=\"#3ä¸Šä¼ åˆ°eså®¹å™¨çš„æ’ä»¶æ•°æ®å·ä¸­\">#</a> 3ï¼‰ä¸Šä¼ åˆ° es å®¹å™¨çš„æ’ä»¶æ•°æ®å·ä¸­</h3>\n<p>ä¹Ÿå°±æ˜¯ <code>/var/lib/docker/volumes/es-plugins/_data </code> ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112020853.png\" alt=\"image-20210506110704293\" /></p>\n<h3 id=\"4é‡å¯å®¹å™¨\"><a class=\"anchor\" href=\"#4é‡å¯å®¹å™¨\">#</a> 4ï¼‰é‡å¯å®¹å™¨</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 4ã€é‡å¯å®¹å™¨</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> restart es</pre></td></tr></table></figure><figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># æŸ¥çœ‹ es æ—¥å¿—</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> logs <span class=\"token parameter variable\">-f</span> es</pre></td></tr></table></figure><p>çœ‹åˆ°è¿™æ¡ä¿¡æ¯è¯´æ˜å®‰è£…æˆåŠŸäº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112200825.png\" alt=\"image-20231011220033681\" /></p>\n<h3 id=\"5æµ‹è¯•\"><a class=\"anchor\" href=\"#5æµ‹è¯•\">#</a> 5ï¼‰æµ‹è¯•ï¼š</h3>\n<p>IK åˆ†è¯å™¨åŒ…å«ä¸¤ç§æ¨¡å¼ï¼š</p>\n<ul>\n<li>\n<p><code>ik_smart</code> ï¼šæœ€å°‘åˆ‡åˆ†</p>\n<ul>\n<li>å¯ä»¥æœç´¢åˆ°çš„è¯çš„èŒƒå›´æ¯”è¾ƒå°</li>\n</ul>\n</li>\n<li>\n<p><code>ik_max_word</code> ï¼šæœ€ç»†åˆ‡åˆ†</p>\n<ul>\n<li>å¯ä»¥æœç´¢åˆ°çš„è¯çš„èŒƒå›´æ¯”è¾ƒå¤§</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /_analyze</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ik_max_word\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"é»‘é©¬ç¨‹åºå‘˜å­¦ä¹ javaå¤ªæ£’äº†\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç»“æœï¼š</p>\n<p>ik_smart</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"tokens\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"é»‘é©¬\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ç¨‹åºå‘˜\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å­¦ä¹ \"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"java\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ENGLISH\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¤ªæ£’äº†\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">14</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ik_max_word</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"tokens\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"é»‘é©¬\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ç¨‹åºå‘˜\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ç¨‹åº\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å‘˜\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_CHAR\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å­¦ä¹ \"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"java\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ENGLISH\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¤ªæ£’äº†\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">14</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">6</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¤ªæ£’\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">13</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">7</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"äº†\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">13</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">14</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_CHAR\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">8</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>  <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"33-æ‰©å±•è¯è¯å…¸\"><a class=\"anchor\" href=\"#33-æ‰©å±•è¯è¯å…¸\">#</a> 3.3 æ‰©å±•è¯è¯å…¸</h2>\n<p>éšç€äº’è”ç½‘çš„å‘å±•ï¼Œâ€œé€ è¯è¿åŠ¨â€ ä¹Ÿè¶Šå‘çš„é¢‘ç¹ã€‚å‡ºç°äº†å¾ˆå¤šæ–°çš„è¯è¯­ï¼Œåœ¨åŸæœ‰çš„è¯æ±‡åˆ—è¡¨ä¸­å¹¶ä¸å­˜åœ¨ã€‚æ¯”å¦‚ï¼šâ€œå¥¥åŠ›ç»™â€ï¼Œâ€œä¼ æ™ºæ’­å®¢â€ ç­‰ã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬çš„è¯æ±‡ä¹Ÿéœ€è¦ä¸æ–­çš„æ›´æ–°ï¼ŒIK åˆ†è¯å™¨æä¾›äº†æ‰©å±•è¯æ±‡çš„åŠŸèƒ½ã€‚</p>\n<p>1ï¼‰æ‰“å¼€ IK åˆ†è¯å™¨ config ç›®å½•ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112020613.png\" alt=\"image-20210506112225508\" /></p>\n<p>2ï¼‰åœ¨ IKAnalyzer.cfg.xml é…ç½®æ–‡ä»¶å†…å®¹æ·»åŠ ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">properties</span> <span class=\"token name\">SYSTEM</span> <span class=\"token string\">\"http://java.sun.com/dtd/properties.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>comment</span><span class=\"token punctuation\">></span></span>IK Analyzer æ‰©å±•é…ç½®<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>comment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">&lt;!-- ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ *** æ·»åŠ æ‰©å±•è¯å…¸ --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>entry</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ext_dict<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>ext.dic<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>entry</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>3ï¼‰æ–°å»ºä¸€ä¸ª ext.dicï¼Œå¯ä»¥å‚è€ƒ config ç›®å½•ä¸‹å¤åˆ¶ä¸€ä¸ªé…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ä¼ æ™ºæ•™è‚²</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>å¥¥åŠ›ç»™</pre></td></tr></table></figure><p>4ï¼‰é‡å¯ elasticsearch</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> restart es</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># æŸ¥çœ‹ æ—¥å¿—</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">docker</span> logs <span class=\"token parameter variable\">-f</span> elasticsearch</pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112020980.png\" alt=\"image-20201115230900504\" /></p>\n<p>æ—¥å¿—ä¸­å·²ç»æˆåŠŸåŠ è½½ ext.dic é…ç½®æ–‡ä»¶</p>\n<p>5ï¼‰æµ‹è¯•æ•ˆæœï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /_analyze</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ik_max_word\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ä¼ æ™ºæ’­å®¢Javaå°±ä¸šè¶…è¿‡90%,å¥¥åŠ›ç»™ï¼\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>æ³¨æ„å½“å‰æ–‡ä»¶çš„ç¼–ç å¿…é¡»æ˜¯ UTF-8 æ ¼å¼ï¼Œä¸¥ç¦ä½¿ç”¨ Windows è®°äº‹æœ¬ç¼–è¾‘</p>\n</blockquote>\n<h2 id=\"34-åœç”¨è¯è¯å…¸\"><a class=\"anchor\" href=\"#34-åœç”¨è¯è¯å…¸\">#</a> 3.4 åœç”¨è¯è¯å…¸</h2>\n<p>åœ¨äº’è”ç½‘é¡¹ç›®ä¸­ï¼Œåœ¨ç½‘ç»œé—´ä¼ è¾“çš„é€Ÿåº¦å¾ˆå¿«ï¼Œæ‰€ä»¥å¾ˆå¤šè¯­è¨€æ˜¯ä¸å…è®¸åœ¨ç½‘ç»œä¸Šä¼ é€’çš„ï¼Œå¦‚ï¼šå…³äºå®—æ•™ã€æ”¿æ²»ç­‰æ•æ„Ÿè¯è¯­ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨æœç´¢æ—¶ä¹Ÿåº”è¯¥å¿½ç•¥å½“å‰è¯æ±‡ã€‚</p>\n<p>IK åˆ†è¯å™¨ä¹Ÿæä¾›äº†å¼ºå¤§çš„åœç”¨è¯åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬åœ¨ç´¢å¼•æ—¶å°±ç›´æ¥å¿½ç•¥å½“å‰çš„åœç”¨è¯æ±‡è¡¨ä¸­çš„å†…å®¹ã€‚</p>\n<p>1ï¼‰IKAnalyzer.cfg.xml é…ç½®æ–‡ä»¶å†…å®¹æ·»åŠ ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">properties</span> <span class=\"token name\">SYSTEM</span> <span class=\"token string\">\"http://java.sun.com/dtd/properties.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>comment</span><span class=\"token punctuation\">></span></span>IK Analyzer æ‰©å±•é…ç½®<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>comment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">&lt;!-- ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>entry</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ext_dict<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>ext.dic<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>entry</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>         <span class=\"token comment\">&lt;!-- ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•åœæ­¢è¯å­—å…¸  *** æ·»åŠ åœç”¨è¯è¯å…¸ --></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>entry</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ext_stopwords<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>stopword.dic<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>entry</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>3ï¼‰åœ¨ stopword.dic æ·»åŠ åœç”¨è¯</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ç‰›é€¼</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>çš„</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>å°</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>é»‘</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>å­</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>IKUN</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>å¤</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>é¸¡</pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„ï¼š<mark>ç‰›é€¼</mark>è¿™ä¸ªè¯ï¼Œè¿›è¡Œåˆ†è¯æ—¶ä¼šå‡ºç°ç‰›ï¼Œé€¼ ã€‚å› ä¸ºå¦‚ä¸‹è§£é‡Šï¼š</p>\n<p>IK æŸ¥è¯¢åœç”¨è¯å¬å›çš„æ—¶å€™ä¼šå…ˆå°†æŸ¥è¯¢è¯æ ¹æ®åˆ†è¯è¯åº“é…ç½®è¿›è¡Œåˆ†è¯ï¼Œæ¯”å¦‚ &quot;ç‰›é€¼&quot; è¿™ä¸ªè¯ä¼šè¢«åˆ†ä¸º &quot;ç‰›&quot;ï¼Œ&quot;é€¼&quot;ï¼Œä¹‹åä¼šæ ¹æ®åœç”¨è¯åº“å»çœ‹æ˜¯å¦ &quot;ç‰›&quot;ï¼Œ&quot;é€¼&quot; ä¸¤ä¸ªè¯å†åº“å†…ï¼Œå¦‚åœ¨åº“å†…å°±ä¸ä¼šå¬å›ã€‚</p>\n<p>è¯´èµ·æ¥ å¯èƒ½æŠ½è±¡çœ‹å¦‚ä¸‹çš„æƒ…å†µå§ï¼š</p>\n<p>å½“æˆ‘ä»¬æŸ¥è¯¢ â€œç‰›é€¼çš„æ—¶å€™â€ ç»“æœå¦‚ä¸‹ï¼š</p>\n<p>è¿™é‡Œä½ è‚¯å®šå›æƒ³ï¼Œæˆ‘ä¸æ˜¯åœç”¨äº†å—æ€ä¹ˆè¿˜æœ‰æ˜¾ç¤ºå‘¢ï¼Œé‚£ä½ å°±é”™äº†å› ä¸ºå®ƒè¢«åˆ†è¯ä¸º ä¸€ä¸ª â€œç‰›â€ ä¸€ä¸ª â€œé€¼â€ å®ƒå¹¶ä¸æ˜¯ â€œç‰›é€¼â€ äº† ï¼Œæˆ‘ä»¬å†å¾€ä¸‹çœ‹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310120847300.png\" alt=\"image-20231012084748860\" /></p>\n<p>æˆ‘æŸ¥è¯¢ â€œå°â€ çš„æ—¶å€™ç»“æœä»€ä¹ˆä¹Ÿæ²¡æœ‰ å› ä¸ºä¸€ä¸ªå­—è¢«åˆ†è¯è¿˜æ˜¯ä¸€ä¸ªè¯è€Œè¿™ä¸€ä¸ªè¯è¿˜æ˜¯è¢«åœç”¨çš„ä¸€æ¬¡å°±èƒ½åŒ¹é…åˆ°æ‰€ä»¥å°±åœç”¨çœ‹ä¸åˆ°äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310120849089.png\" alt=\"image-20231012084916676\" /></p>\n<p>4ï¼‰é‡å¯ elasticsearch</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># é‡å¯æœåŠ¡</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> restart elasticsearch</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">docker</span> restart kibana</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># æŸ¥çœ‹ æ—¥å¿—</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">docker</span> logs <span class=\"token parameter variable\">-f</span> elasticsearch</pre></td></tr></table></figure><p>æ—¥å¿—ä¸­å·²ç»æˆåŠŸåŠ è½½ stopword.dic é…ç½®æ–‡ä»¶</p>\n<p>5ï¼‰æµ‹è¯•æ•ˆæœï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /_analyze</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ik_max_word\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ä¼ æ™ºæ’­å®¢Javaå°±ä¸šç‡è¶…è¿‡95%,ä¹ å¤§å¤§éƒ½ç‚¹èµ,å¥¥åŠ›ç»™ï¼\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>æ³¨æ„å½“å‰æ–‡ä»¶çš„ç¼–ç å¿…é¡»æ˜¯ UTF-8 æ ¼å¼ï¼Œä¸¥ç¦ä½¿ç”¨ Windows è®°äº‹æœ¬ç¼–è¾‘</p>\n</blockquote>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>åˆ†è¯å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>åˆ›å»ºå€’æ’ç´¢å¼•æ—¶å¯¹æ–‡æ¡£åˆ†è¯</li>\n<li>ç”¨æˆ·æœç´¢æ—¶ï¼Œå¯¹è¾“å…¥çš„å†…å®¹åˆ†è¯</li>\n</ul>\n<p>IK åˆ†è¯å™¨æœ‰å‡ ç§æ¨¡å¼ï¼Ÿ</p>\n<ul>\n<li>ik_smartï¼šæ™ºèƒ½åˆ‡åˆ†ï¼Œç²—ç²’åº¦</li>\n<li>ik_max_wordï¼šæœ€ç»†åˆ‡åˆ†ï¼Œç»†ç²’åº¦</li>\n</ul>\n<p>IK åˆ†è¯å™¨å¦‚ä½•æ‰©å±•è¯æ¡ï¼Ÿå¦‚ä½•åœç”¨è¯æ¡ï¼Ÿ</p>\n<ul>\n<li>åˆ©ç”¨ config ç›®å½•çš„ IkAnalyzer.cfg.xml æ–‡ä»¶æ·»åŠ æ‰©å±•è¯å…¸å’Œåœç”¨è¯å…¸</li>\n<li>åœ¨è¯å…¸ä¸­æ·»åŠ æ‰©å±•è¯æ¡æˆ–è€…åœç”¨è¯æ¡</li>\n</ul>\n</blockquote>\n<h1 id=\"4éƒ¨ç½²esé›†ç¾¤\"><a class=\"anchor\" href=\"#4éƒ¨ç½²esé›†ç¾¤\">#</a> 4. éƒ¨ç½² es é›†ç¾¤</h1>\n<p>éƒ¨ç½² es é›†ç¾¤å¯ä»¥ç›´æ¥ä½¿ç”¨ docker-compose æ¥å®Œæˆï¼Œä¸è¿‡è¦æ±‚ä½ çš„ Linux è™šæ‹Ÿæœºè‡³å°‘æœ‰<strong> 4G</strong> çš„å†…å­˜ç©ºé—´</p>\n<p>é¦–å…ˆç¼–å†™ä¸€ä¸ª docker-compose æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>version: <span class=\"token string\">'2.2'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>services:</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  es01:</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    image: docker.elastic.co/elasticsearch/elasticsearch:7.12.1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    container_name: es01</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    environment:</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      - <span class=\"token assign-left variable\">node.name</span><span class=\"token operator\">=</span>es01</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      - <span class=\"token assign-left variable\">cluster.name</span><span class=\"token operator\">=</span>es-docker-cluster</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      - <span class=\"token assign-left variable\">discovery.seed_hosts</span><span class=\"token operator\">=</span>es02,es03</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      - <span class=\"token assign-left variable\">cluster.initial_master_nodes</span><span class=\"token operator\">=</span>es01,es02,es03</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      - <span class=\"token assign-left variable\">bootstrap.memory_lock</span><span class=\"token operator\">=</span>true</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      - <span class=\"token string\">\"ES_JAVA_OPTS=-Xms512m -Xmx512m\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    ulimits:</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      memlock:</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        soft: <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        hard: <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    volumes:</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      - data01:/usr/share/elasticsearch/data</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    ports:</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      - <span class=\"token number\">9200</span>:9200</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    networks:</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      - elastic</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  es02:</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    image: docker.elastic.co/elasticsearch/elasticsearch:7.12.1</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    container_name: es02</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    environment:</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      - <span class=\"token assign-left variable\">node.name</span><span class=\"token operator\">=</span>es02</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      - <span class=\"token assign-left variable\">cluster.name</span><span class=\"token operator\">=</span>es-docker-cluster</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      - <span class=\"token assign-left variable\">discovery.seed_hosts</span><span class=\"token operator\">=</span>es01,es03</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      - <span class=\"token assign-left variable\">cluster.initial_master_nodes</span><span class=\"token operator\">=</span>es01,es02,es03</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      - <span class=\"token assign-left variable\">bootstrap.memory_lock</span><span class=\"token operator\">=</span>true</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      - <span class=\"token string\">\"ES_JAVA_OPTS=-Xms512m -Xmx512m\"</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    ulimits:</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      memlock:</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        soft: <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        hard: <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    volumes:</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      - data02:/usr/share/elasticsearch/data</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    networks:</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      - elastic</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  es03:</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    image: docker.elastic.co/elasticsearch/elasticsearch:7.12.1</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    container_name: es03</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    environment:</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      - <span class=\"token assign-left variable\">node.name</span><span class=\"token operator\">=</span>es03</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>      - <span class=\"token assign-left variable\">cluster.name</span><span class=\"token operator\">=</span>es-docker-cluster</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      - <span class=\"token assign-left variable\">discovery.seed_hosts</span><span class=\"token operator\">=</span>es01,es02</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      - <span class=\"token assign-left variable\">cluster.initial_master_nodes</span><span class=\"token operator\">=</span>es01,es02,es03</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      - <span class=\"token assign-left variable\">bootstrap.memory_lock</span><span class=\"token operator\">=</span>true</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>      - <span class=\"token string\">\"ES_JAVA_OPTS=-Xms512m -Xmx512m\"</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    ulimits:</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>      memlock:</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        soft: <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        hard: <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    volumes:</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>      - data03:/usr/share/elasticsearch/data</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    networks:</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>      - elastic</pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>volumes:</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>  data01:</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    driver: <span class=\"token builtin class-name\">local</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>  data02:</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    driver: <span class=\"token builtin class-name\">local</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>  data03:</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    driver: <span class=\"token builtin class-name\">local</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>networks:</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>  elastic:</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    driver: bridge</pre></td></tr></table></figure><p>å°†è¯¥é…ç½®æ–‡ä»¶ä¸Šä¼ åˆ° Linux ä¸­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161059412.png\" alt=\"image-20231016105943788\" /></p>\n<p>es è¿è¡Œéœ€è¦ä¿®æ”¹ä¸€äº› Linux ç³»ç»Ÿæƒé™ï¼Œä¿®æ”¹  <code>/etc/sysctl.conf</code>  æ–‡ä»¶ï¼š</p>\n<pre><code class=\"language-shÂ·\">vi /etc/sysctl.conf\n</code></pre>\n<p>æ·»åŠ ä¸‹é¢å†…å®¹ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">vm.max_map_count</span><span class=\"token operator\">=</span><span class=\"token number\">262144</span></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œå‘½ä»¤ï¼Œè®©é…ç½®ç”Ÿæ•ˆï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sysctl -p</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>vm.max_map_count <span class=\"token operator\">=</span> <span class=\"token number\">262144</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>Run  <code>docker-compose</code>  to bring up the cluster:</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker-compose up -d</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Starting es03 <span class=\"token punctuation\">..</span>. <span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Starting es01 <span class=\"token punctuation\">..</span>. <span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Starting es02 <span class=\"token punctuation\">..</span>. <span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker ps -a</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>CONTAINER ID   IMAGE                   COMMAND                  CREATED         STATUS                            PORTS                                                                                                                                                 NAMES</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>c3c4b0e1ffdc   elasticsearch:7.12.1    <span class=\"token string\">\"/bin/tini -- /usr/lâ€¦\"</span>   <span class=\"token number\">2</span> minutes ago   Up <span class=\"token number\">13</span> seconds                     <span class=\"token number\">0.0</span>.0.0:9200-<span class=\"token operator\">></span><span class=\"token number\">9200</span>/tcp, :::9200-<span class=\"token operator\">></span><span class=\"token number\">9200</span>/tcp, <span class=\"token number\">9300</span>/tcp                                                                                                   es01</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>073f8e46e296   elasticsearch:7.12.1    <span class=\"token string\">\"/bin/tini -- /usr/lâ€¦\"</span>   <span class=\"token number\">2</span> minutes ago   Up <span class=\"token number\">13</span> seconds                     <span class=\"token number\">9300</span>/tcp, <span class=\"token number\">0.0</span>.0.0:9201-<span class=\"token operator\">></span><span class=\"token number\">9200</span>/tcp, :::9201-<span class=\"token operator\">></span><span class=\"token number\">9200</span>/tcp                                                                                                   es02</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>aca2f691e3e2   elasticsearch:7.12.1    <span class=\"token string\">\"/bin/tini -- /usr/lâ€¦\"</span>   <span class=\"token number\">2</span> minutes ago   Up <span class=\"token number\">13</span> seconds                     <span class=\"token number\">9300</span>/tcp, <span class=\"token number\">0.0</span>.0.0:9202-<span class=\"token operator\">></span><span class=\"token number\">9200</span>/tcp, :::9202-<span class=\"token operator\">></span><span class=\"token number\">9200</span>/tcp                                                                                                   es03</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>61161df3ec6a   kibana:7.12.1           <span class=\"token string\">\"/bin/tini -- /usr/lâ€¦\"</span>   <span class=\"token number\">4</span> days ago      Up <span class=\"token number\">18</span> minutes                     <span class=\"token number\">0.0</span>.0.0:5601-<span class=\"token operator\">></span><span class=\"token number\">5601</span>/tcp, :::5601-<span class=\"token operator\">></span><span class=\"token number\">5601</span>/tcp                                                                                                             kibana</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>318bc511f26c   elasticsearch:7.12.1    <span class=\"token string\">\"/bin/tini -- /usr/lâ€¦\"</span>   <span class=\"token number\">4</span> days ago      Exited <span class=\"token punctuation\">(</span><span class=\"token number\">137</span><span class=\"token punctuation\">)</span> About a minute ago                                                                                                                                                         es</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>46756ed1a2ee   rabbitmq:3-management   <span class=\"token string\">\"docker-entrypoint.sâ€¦\"</span>   <span class=\"token number\">4</span> days ago      Up <span class=\"token number\">18</span> minutes                     <span class=\"token number\">4369</span>/tcp, <span class=\"token number\">5671</span>/tcp, <span class=\"token number\">0.0</span>.0.0:5672-<span class=\"token operator\">></span><span class=\"token number\">5672</span>/tcp, :::5672-<span class=\"token operator\">></span><span class=\"token number\">5672</span>/tcp, <span class=\"token number\">15671</span>/tcp, <span class=\"token number\">15691</span>-15692/tcp, <span class=\"token number\">25672</span>/tcp, <span class=\"token number\">0.0</span>.0.0:15672-<span class=\"token operator\">></span><span class=\"token number\">15672</span>/tcp, :::15672-<span class=\"token operator\">></span><span class=\"token number\">15672</span>/tcp   mq</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><h2 id=\"41-é›†ç¾¤çŠ¶æ€ç›‘æ§\"><a class=\"anchor\" href=\"#41-é›†ç¾¤çŠ¶æ€ç›‘æ§\">#</a> 4.1ã€é›†ç¾¤çŠ¶æ€ç›‘æ§</h2>\n<p>kibana å¯ä»¥ç›‘æ§ es é›†ç¾¤ï¼Œä¸è¿‡æ–°ç‰ˆæœ¬éœ€è¦ä¾èµ– es çš„ x-pack åŠŸèƒ½ï¼Œé…ç½®æ¯”è¾ƒå¤æ‚ã€‚</p>\n<p>è¿™é‡Œæ¨èä½¿ç”¨ cerebro æ¥ç›‘æ§ es é›†ç¾¤çŠ¶æ€ï¼Œå®˜æ–¹ç½‘å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2xtZW5lemVzL2NlcmVicm8=\">https://github.com/lmenezes/cerebro</span></p>\n<p>ä¸‹è½½åè¿›è¡Œè§£å‹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161113552.png\" alt=\"image-20231016111307167\" /></p>\n<p>è§£å‹åè¿›å…¥ bin ç›®å½•ä¸­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161113838.png\" alt=\"image-20231016111341471\" /></p>\n<p>åŒå‡»è¿è¡Œ cerebro.bat å³å¯è¿è¡Œ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161115237.png\" alt=\"image-20231016111523818\" /></p>\n<p>å¯åŠ¨å®Œæˆåè®¿é—®ï¼šlocalhost:9000 åœ°å€ï¼Œè¯æ˜æ­£å¸¸å¯åŠ¨æˆåŠŸäº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161115161.png\" alt=\"image-20231016111547168\" /></p>\n<p>è¿™æ—¶å°±å¯ä»¥è®¿é—®è™šæ‹Ÿæœºä¸­ es çš„å“ªä¸ªå…±åŒç«¯å£å·çš„åœ°å€äº†ï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMjQ5LjEyODo5MjAw\">http://192.168.249.128:9200</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161154359.png\" alt=\"image-20231016115434836\" /></p>\n<h2 id=\"42-åˆ›å»ºç´¢å¼•åº“\"><a class=\"anchor\" href=\"#42-åˆ›å»ºç´¢å¼•åº“\">#</a> 4.2ã€åˆ›å»ºç´¢å¼•åº“</h2>\n<h3 id=\"421-åˆ©ç”¨kibanaçš„devtoolsåˆ›å»ºç´¢å¼•åº“\"><a class=\"anchor\" href=\"#421-åˆ©ç”¨kibanaçš„devtoolsåˆ›å»ºç´¢å¼•åº“\">#</a> 4.2.1ã€åˆ©ç”¨ kibana çš„ DevTools åˆ›å»ºç´¢å¼•åº“</h3>\n<p>åœ¨ DevTools ä¸­è¾“å…¥æŒ‡ä»¤ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>PUT /indexName</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"settings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token property\">\"number_of_shards\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// åˆ†ç‰‡æ•°é‡</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"number_of_replicas\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token comment\">// å‰¯æœ¬æ•°é‡</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token property\">\"mappings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>         <span class=\"token comment\">//mapping æ˜ å°„å®šä¹‰ ...</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161201547.png\" alt=\"image-20231016120105950\" /></p>\n<p>å¡«å†™å®Œæˆåç‚¹å‡» create åˆ›å»ºç´¢å¼•åº“</p>\n<p>å›åˆ°é¦–é¡µ</p>\n<p>å¯ä»¥çœ‹åˆ°æ•°æ®è¢«æˆåŠŸçš„åˆ†æˆäº†ä¸‰ç‰‡ï¼Œåç§°ä¸º itcast</p>\n<p>ä½†æ˜¯è¿˜åŠ äº†ä¸€ä¸ªå‰¯æœ¬ï¼Œæ¯ä¸€ç‰‡éƒ½åŠ ä¸€ä¸ªå‰¯æœ¬å°±æ˜¯ 3 * 2 = 6 ç‰‡</p>\n<p>å…¶ä¸­å®çº¿å°±æ˜¯ä½åˆ†ç‰‡ï¼Œè™šçº¿å°±æ˜¯å‰¯æœ¬åˆ†ç‰‡ï¼ˆå°±æ˜¯æ‹·è´äº†ä¸€ä»½ï¼‰</p>\n<p>æ¯ä¸€ä¸ªåˆ†ç‰‡å®ƒçš„å¤‡ä»½éƒ½åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œè¿™æ ·å°±ç¡®ä¿äº†ä»»æ„ä¸€å°æœºå™¨å®•æœºï¼Œé‚£çš„å¤‡ä»½ä¾ç„¶è¿˜ä¿ç•™ç€é¿å…å‡ºç°æ•°æ®æ•…éšœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161202468.png\" alt=\"image-20231016120225681\" /></p>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "Elasticsearch",
                "è®¡ç®—æœºå­¦ç§‘",
                "åŸºç¡€",
                "springcloud",
                "Elasticsearch"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Elasticsearch/%E6%A1%88%E4%BE%8Bsql/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Elasticsearch/%E6%A1%88%E4%BE%8Bsql/",
            "title": "esæ¡ˆä¾‹",
            "date_published": "2024-01-06T02:31:36.585Z",
            "content_html": "<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> Navicat Premium Data Transfer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> Source Server         : local</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> Source Server Type    : MySQL</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> Source Server Version : 50622</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> Source Host           : localhost:3306</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> Source Schema         : heima</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> Target Server Type    : MySQL</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> Target Server Version : 50622</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> File Encoding         : 65001</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> Date: 06/05/2021 18:31:05</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">SET</span> NAMES utf8mb4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">-- Table structure for tb_hotel</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span>  <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…’åº—id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…’åº—åç§°'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>address<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…’åº—åœ°å€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>price<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…’åº—ä»·æ ¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>score<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…’åº—è¯„åˆ†'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>brand<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…’åº—å“ç‰Œ'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>city<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æ‰€åœ¨åŸå¸‚'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>star_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…’åº—æ˜Ÿçº§ï¼Œ1æ˜Ÿåˆ°5æ˜Ÿï¼Œ1é’»åˆ°5é’»'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>business<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å•†åœˆ'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>latitude<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'çº¬åº¦'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>longitude<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç»åº¦'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>pic<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…’åº—å›¾ç‰‡'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> <span class=\"token operator\">=</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> <span class=\"token operator\">=</span> utf8mb4_general_ci ROW_FORMAT <span class=\"token operator\">=</span> Compact<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">-- Records of tb_hotel</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\">-- ----------------------------</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">36934</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(ä¸Šæµ·å®å±±è·¯åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é™å®‰äº¤é€šè·¯40å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">336</span><span class=\"token punctuation\">,</span> <span class=\"token number\">37</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››å·åŒ—è·¯å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.251433'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.47522'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/3E/40/Cii9EVkyLrKIXo1vAAHgrxo_pUcAALcKQLD688AAeDH564_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">38609</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—(ä¸Šæµ·èµ¤å³°è·¯åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¹¿çµäºŒè·¯126å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">249</span><span class=\"token punctuation\">,</span> <span class=\"token number\">35</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››å·åŒ—è·¯å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.282444'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.479385'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/DF/96/Cii-TFkx0ImIQZeiAAITil0LM7cAALCYwKXHQ4AAhOi377_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">38665</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—ä¸Šæµ·ä¸­å±±åŒ—è·¯å…°ç”°è·¯åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å…°ç”°è·¯38å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">226</span><span class=\"token punctuation\">,</span> <span class=\"token number\">35</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é•¿é£å…¬å›­åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.244288'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.422419'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/EF/86/Cii-Tlk2mV2IMZ-_AAEucgG3dx4AALaawEjiycAAS6K083_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">38812</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(ä¸Šæµ·æ¼•æºªè·¯åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¾æ±‡é¾™åè¥¿è·¯315å¼„58å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">298</span><span class=\"token punctuation\">,</span> <span class=\"token number\">37</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å…«ä¸‡äººä½“è‚²åœºåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.174377'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.442875'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/E0/0E/Cii-TlkyIr2IEWNoAAHQYv7i5CkAALD-QP2iJwAAdB6245_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">39106</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—ï¼ˆä¸Šæµ·è˜åº„åœ°é“ç«™åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é—µè¡Œè˜åº„é•‡ä¸ƒè˜è·¯299å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">348</span><span class=\"token punctuation\">,</span> <span class=\"token number\">41</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è˜åº„å·¥ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.113812'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.375869'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/D8/11/Cii-T1ku2zGIGR7uAAF1NYY9clwAAKxZAHO8HgAAXVN368_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">39141</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(ä¸Šæµ·äº”è§’åœºå¤æ—¦åŒæµå¤§å­¦åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¨æµ¦å›½æƒè·¯315å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">349</span><span class=\"token punctuation\">,</span> <span class=\"token number\">38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±Ÿæ¹¾ã€äº”è§’åœºå•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.290057'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.508804'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/C7/E3/Cii-T1knFXCIJzNYAAFB8-uFNAEAAKYkQPcw1IAAUIL012_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">45845</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·è¥¿è—å¤§å¦ä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è™¹æ¡¥è·¯100å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">589</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¾å®¶æ±‡åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.192714'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.434717'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/48GNb9GZpJDCejVAcQHYWwYyU8T_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">45870</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ä¸´æ¸¯è±ªç”Ÿå¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ–°å…ƒå—è·¯555å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">896</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è±ªç”Ÿ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ»´æ°´æ¹–ä¸´æ¸¯åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'30.871729'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.81959'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2F5HoQvBgypoDUE46752ppnQaTqs_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">46829</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·æµ¦è¥¿ä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ’ä¸°è·¯338å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">726</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ç«è½¦ç«™åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.242977'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.455864'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/x87VCoyaR8cTuYFZmKHe8VC6Wk1_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">47066</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·æµ¦ä¸œä¸œç«™åç¾è¾¾é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ–½æ–°è·¯958å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">408</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œæœºåœºæ ¸å¿ƒåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.147989'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.759199'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2pNujAVaQbXACzkHp8bQMm6zqwhp_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">47478</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—(ä¸Šæµ·æ¾æ±Ÿä¸­å¿ƒåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¾æ±Ÿè£ä¹ä¸œè·¯677å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">428</span><span class=\"token punctuation\">,</span> <span class=\"token number\">35</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä½˜å±±ã€æ¾æ±Ÿå¤§å­¦åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.016712'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.261606'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/filebroker/cdn/res/07/36/073662e1718fccefb7130a9da44ddf5c_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">56201</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·é½é²ä¸‡æ€¡å¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸œæ–¹è·¯838å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">873</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œé™†å®¶å˜´é‡‘èè´¸æ˜“åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.226031'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.525801'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/B6/Cii-TF3eXKeIJeN7AASiKHbTtx4AAGRegDSBzMABKJA111_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">56214</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·æµ¦ä¸œåç¾è¾¾å¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ–°é‡‘æ¡¥è·¯18å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">830</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œé‡‘æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.244916'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.590752'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3jtXiuMKZEXJAuKuAkc47yLCjUBt_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">56227</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·åœ£æ·˜æ²™ä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å—æ¡¥é•‡å—æ¡¥è·¯1å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">899</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¥‰è´¤å¼€å‘åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'30.910917'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.456525'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/B9/Cii-U13eXSiIdJjXAARSA6FywFYAAGRnwHvy1AABFIb158_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">56392</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·é“¶æ˜Ÿçš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç•ªç¦ºè·¯400å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">809</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¾å®¶æ±‡åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.202768'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.429524'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/37ucQ38K3UFdcRqntJ8M5dt884HR_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">56852</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·è´¢å¤§è±ªç”Ÿå¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ­¦ä¸œè·¯188å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">592</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è±ªç”Ÿ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±Ÿæ¹¾/äº”è§’åœºå•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.304182'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.492936'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2jGHezLZvPZqC9cBGesbP5vAhCXi_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">56912</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·åå‡¯åç¾è¾¾å¹¿åœºé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœˆåè·¯9å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">747</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¥‰è´¤å¼€å‘åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'30.814382'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.464521'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/45iaCNCuZavJTxwTLskhVKzwynLD_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">56977</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·äº”è§’åœºåç¾è¾¾å¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é»„å…´è·¯1888å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">499</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±Ÿæ¹¾/äº”è§’åœºå•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.292932'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.519759'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/26VREqAQdaGFvJdAJALVtjxcNMpL_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60214</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·é‡‘èŒ‚å›æ‚¦å¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸–çºªå¤§é“88å·ï¼ˆ54æ¥¼åŠç†å…¥ä½ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">699</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œé™†å®¶å˜´é‡‘èè´¸æ˜“åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.235152'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.506082'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/7Azm3jvGUHuXe3eS1DrixAWVTXY_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60223</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å¸Œå°”é¡¿é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é™å®‰åå±±è·¯250å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2688</span><span class=\"token punctuation\">,</span> <span class=\"token number\">37</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸Œå°”é¡¿'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é™å®‰å¯ºåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.219306'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.445427'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/filebroker/cdn/res/92/10/9210e74442aceceaf6e196d61fc3b6b1_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60359</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å¤–é«˜æ¡¥çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¨é«˜åŒ—è·¯1000å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3299</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œå¤–é«˜æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.338944'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.590611'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/VcKUM9zUSiVgDhFioc6mWQoX9ES_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60363</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·æ–°ä¸–ç•Œä¸½ç¬™å¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å—äº¬è¥¿è·¯88å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1341</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸½ç¬™'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äººæ°‘å¹¿åœºåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.23462'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.47327'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2j31b7X3YzGkf4Li3phS6TG1mtwm_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60398</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å¤æ—¦çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é‚¯éƒ¸è·¯199å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">924</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±Ÿæ¹¾/äº”è§’åœºå•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.295382'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.502537'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2H1Gk8LHaBWZfYvR6NYYcGTvACmL_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60487</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å¤–æ»©èŒ‚æ‚¦å¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é»„æµ¦è·¯199å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">689</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤–æ»©åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.245409'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.492969'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2Swp2h1fdj9zCUKsk63BQvVgKLTo_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60522</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å˜‰è±ªæ·®æµ·å›½é™…è±ªç”Ÿé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±¾é˜³è·¯1å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">425</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è±ªç”Ÿ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·®æµ·è·¯/æ–°å¤©åœ°åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.215497'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.456297'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/38UBi4QYuaF8jN94CxQ7tb7tjtmZ_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60916</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ç»¿åœ°ä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ²ªå®œå…¬è·¯3101å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">328</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å˜‰å®šæ–°åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.368523'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.258567'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3VLwG9tTQQnp3M3MTeMTdx9nas9B_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60922</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·è™¹æ¡¥ç¥¥æºå¸Œå°”é¡¿é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çº¢æ¾ä¸œè·¯1116å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1108</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸Œå°”é¡¿'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è™¹æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.18746'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.395312'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/tQRqDTFkHnHzMZiDKjcGV81ekvc_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60935</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·è™¹å£ä¸‰è‡³å–œæ¥ç™»é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››å¹³è·¯59å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1899</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››å·åŒ—è·¯å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.2579'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.487954'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3C3gxLxLjVwnkxJwJm8rd3f38kcd_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">61075</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·é›…å±…ä¹ä¸‡è±ªé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿è—ä¸­è·¯555å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1152</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äººæ°‘å¹¿åœºåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.236681'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.473529'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3FoT16PkXavKsssvktVvVq5Si6Cr_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">61083</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·æ»´æ°´æ¹–çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è‡ªç”±è´¸æ˜“è¯•éªŒåŒºä¸´æ¸¯æ–°ç‰‡åŒºå—å²›1å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">971</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ»´æ°´æ¹–ä¸´æ¸¯åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'30.890867'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.937241'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/312e971Rnj9qFyR3pPv4bTtpj1hX_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">309208</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬ç‹åºœäº•å¸Œå°”é¡¿é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç‹åºœäº•ä¸œè¡—8å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1679</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸Œå°”é¡¿'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤©å®‰é—¨/ç‹åºœäº•åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.914539'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.413392'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/10/Cii-TF3ePt2IX9UEAALb6VYBSmoAAGKMgGsuW8AAtwB147_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">394559</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬ä¸œæ–¹å›æ‚¦å¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é•¿å®‰è¡—1å·ä¸œæ–¹å¹¿åœº'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">686</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤©å®‰é—¨/ç‹åºœäº•åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.909635'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.414621'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3mFqcNSh7eEo9yc3Rw2P5HDNTdDe_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">394617</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬å®è¾°é¥­åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å»ºå›½é—¨å†…å¤§è¡—ç”²18å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">418</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è±ªç”Ÿ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬ç«™/å»ºå›½é—¨åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.905768'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.428153'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/NEYa6EfDHuhhb19Ct85WBbkKHZU_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">394796</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬æ–°äº‘å—çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸œåŒ—ä¸‰ç¯è¥¿åæ²³å¤ªé˜³å®«æ¡¥ä¸œåŒ—è§’äº‘å—å¤§å¦'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">485</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›½å±•ä¸­å¿ƒåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.972409'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.434698'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/dfP8K782eTsohQWSRdkd7St9LA2_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">395434</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬å¸Œå°”é¡¿é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸œä¸‰ç¯åŒ—è·¯ä¸œæ–¹è·¯1å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">350</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸Œå°”é¡¿'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç‡•è/æœé˜³å…¬å›­å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.952703'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.462387'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3fwNbKGhk6XCrkdVyxwhC5uGpLVy_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">395702</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬é¦–éƒ½æœºåœºå¸Œå°”é¡¿é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¦–éƒ½æœºåœº3å·èˆªç«™æ¥¼ä¸‰ç»è·¯1å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">222</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸Œå°”é¡¿'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¦–éƒ½æœºåœº/æ–°å›½å±•åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.048969'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.619566'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/10/Cii-U13ePtuIMRSjAAFZ58NGQrMAAGKMgADZ1QAAVn_167_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">395787</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬æµ·èˆªå¤§å¦ä¸‡è±ªé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'éœ„äº‘è·¯ç”²26å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1302</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç‡•è/æœé˜³å…¬å›­å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.959861'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.467363'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3zFiWi2C9SmbcQwCZgJFQC9ahvs5_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">395799</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬å›½é™…è‰ºè‹‘çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç‹åºœäº•å¤§è¡—48å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">636</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤©å®‰é—¨/ç‹åºœäº•åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.918994'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.411277'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/10/Cii-U13ePvyIahjPAAMykV278aEAAGKOQO9e4UAAzKp283_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">395815</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬æ˜è±ªåç¾è¾¾é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤©ç«ºé•‡åºœå‰ä¸€è¡—13å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">558</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¦–éƒ½æœºåœº/æ–°å›½å±•åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.062832'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.580678'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/13/Cii-U13eP2mIKCwvAAODTZXT-fAAAGKVAA9taIAA4Nl245_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">396189</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬æœé˜³æ‚ å”çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰ä¸°åŒ—é‡Œ3å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">944</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é‡Œå±¯/å·¥ä½“/ä¸œç›´é—¨åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.92129'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.43847'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/tT6ipLain1ZovR5gnQ7tJ4KKym5_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">396471</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³é…’åº—ï¼ˆåŒ—äº¬èŠ±å›­è·¯åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ·æ·€åŒ—å¤ªå¹³åº„èŠ±å›­è·¯ç”²17å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">381</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é©¬ç”¸ã€å®‰è´åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.970837'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.365244'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/filebroker/cdn/res/17/00/1700926908bae6ba3e5ef96de7b7d4cc_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">396506</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬é‡‘éš…å–œæ¥ç™»é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—ä¸‰ç¯ä¸œè·¯36å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">357</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é©¬ç”¸/å®‰è´åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.967163'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.4099'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/29FW2WtGzzUtPhWR1LKxcFZAVa9P_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">413460</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(åŒ—äº¬å¤©å›åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸œåŸå¤©å›ä¸œé‡Œç”²48å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">753</span><span class=\"token punctuation\">,</span> <span class=\"token number\">38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‰é—¨ã€å´‡æ–‡é—¨å•†è´¸åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.875786'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.421987'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/C7/D8/Cii-T1knCK6IWTtxAAI0plLButMAAKYTAJu-woAAjS-422_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">413476</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(åŒ—äº¬å—ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸°å°é©¬å®¶å ¡è¥¿è·¯22å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">478</span><span class=\"token punctuation\">,</span> <span class=\"token number\">37</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ°¸å®šé—¨ã€å—ç«™ã€å¤§çº¢é—¨ã€å—è‹‘åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.845363'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.372327'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/26/B7/Cii-U1knCtaISM4VAAHkEQd-mrAAAKw0ALVCwEAAeQp741_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">414168</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(åŒ—äº¬è¥¿ç›´é—¨åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿åŸå¹³å®‰é‡Œè¥¿å¤§è¡—ç¿ èŠ±è¡—è‚²å¹¼èƒ¡åŒç”²20-22å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">419</span><span class=\"token punctuation\">,</span> <span class=\"token number\">37</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿å•ã€é‡‘èè¡—åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.931338'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.364982'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/bc/66/bc666859edf4fc072a8006c66758058d_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">414481</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(åŒ—äº¬å›¢ç»“æ¹–åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœé˜³å›¢ç»“æ¹–åŒ—é‡Œ9å·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">525</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç‡•èã€ä¸‰é‡Œå±¯å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.928457'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.466132'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/38/2D/Cii9EFkv2-uIPTaBAALX6P-rbdUAALPpwHv4ykAAtgA277_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">414698</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—ï¼ˆåŒ—äº¬798è‰ºæœ¯åŒºåº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœé˜³åŒ—äº¬å¸‚æœé˜³åŒºé…’ä»™æ¡¥åŒ—è·¯ï¼ˆ798è‰ºæœ¯åŒºåŒ—é—¨ï¼‰å½©è™¹è·¯6å·-ç”µé€šåˆ›æ„å¹¿åœºå¤§é™¢å†…'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">553</span><span class=\"token punctuation\">,</span> <span class=\"token number\">37</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœ›äº¬ã€é…’ä»™æ¡¥ã€798åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.990671'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.498452'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/D8/11/Cii-T1ku2zqIN7SiAAEdvT6RrjUAAKxZQKFooYAAR3V090_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">415600</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(åŒ—äº¬æœé˜³åŒ—è·¯ä¼ åª’å¤§å­¦è¤¡è£¢å¡åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é—´æˆ¿ä¹¡è¤¡è£¢å¡æ‘é’å¹´æ²Ÿè¥¿ä¾§558å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">259</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¼ åª’å¤§å­¦/ç®¡åº„åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.923212'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.560023'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3NezpxNZWQMdNXibwbMkQuAZjDyJ_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">415659</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—ï¼ˆåŒ—äº¬ç´«ç«¹æ¡¥åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ·æ·€åŒ—æ´¼è·¯ç”²3å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">781</span><span class=\"token punctuation\">,</span> <span class=\"token number\">42</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿ç›´é—¨åŠåŒ—äº¬å±•è§ˆé¦†åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.936138'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.302405'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/3C/22/Cii9EVkxPMqIZJz-AAIh0esETAIAALXbgNQkH8AAiHp053_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">416121</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(åŒ—äº¬è¥¿å®¢ç«™åŒ—å¹¿åœºåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è²èŠ±æ± ä¸œè·¯120-2å·6å±‚'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">275</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬è¥¿ç«™/ä¸½æ³½å•†åŠ¡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.896449'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.317382'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/42DTRnKbiYoiGFVzrV9ZJUxNbvRo_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">416260</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(åŒ—äº¬é€šå·å…«é‡Œæ¡¥åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ°¸é¡ºé•‡è¥¿é©¬åº„å°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">534</span><span class=\"token punctuation\">,</span> <span class=\"token number\">38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœå›­ç¯å²›ã€é€šå·åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.915443'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.631871'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/DF/5A/Cii-TlkxkeGIKM0oAAGOb64RvToAALBAAH9Fg8AAY6H201_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">416268</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢é…’åº—(åŒ—äº¬ä¼ åª’å¤§å­¦è´¢æ»¡è¡—åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœé˜³è·¯é«˜äº•176å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">524</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›½è´¸åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.918277'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.53015'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/13/Cii-TF3eP5GIJIOLAAUwsIVCxdAAAGKXgK5a0IABTDI239_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">416307</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—(åŒ—äº¬æ–°å›½å±•é¦–éƒ½æœºåœºåæ²™å³ªåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åæ²™å³ªé•‡è£•æ°‘å¤§è¡—32å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">350</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¦–éƒ½æœºåœº/æ–°å›½å±•åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.099019'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.543655'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/3E/Cii-TF3eRgGIHCkKAAP_ATvriiQAAGL0AIoLtUAA_8Z513_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">432335</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(ä¸Šæµ·åŒ—å¤–æ»©å›½é™…å®¢è¿ä¸­å¿ƒåœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å”å±±è·¯145å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">249</span><span class=\"token punctuation\">,</span> <span class=\"token number\">35</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—å¤–æ»©åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.252585'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.498753'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/c1/ba/c1baf64418437c56617f89840c6411ef_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">433576</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(ä¸Šæµ·å—äº¬è·¯æ­¥è¡Œè¡—åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å—äº¬ä¸œè·¯480å·ä¿å®‰åŠå†…'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">379</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äººæ°‘å¹¿åœºåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.236454'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.480948'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/BA/Cii-U13eXVaIQmdaAAWxgzdXXxEAAGRrgNIOkoABbGb143_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">434082</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—Â·neo(ä¸Šæµ·å¤–æ»©åŸéšåº™å°å—é—¨åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤å…´ä¸œè·¯260å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">392</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è±«å›­åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.220706'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.498769'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/B6/Cii-U13eXLGIdHFzAAIG-5cEwDEAAGRfQNNIV0AAgcT627_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">441836</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(åŒ—äº¬å›½å±•ä¸‰å…ƒæ¡¥åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿åæ²³ä¸œé‡Œ36å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">458</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›½å±•ä¸­å¿ƒåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.966238'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.450142'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/39/Cii-TF3eRTGITp1UAAYIilRD7skAAGLngIuAnQABgii479_w200_h200_c1_t0.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">485775</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(ä¸Šæµ·é—µè¡Œåä¸œå¸ˆèŒƒå¤§å­¦å´æ³¾åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å´æ³¾é•‡å®ç§€è·¯977å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">161</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº¤å¤§/é—µè¡Œç»æµå¼€å‘åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.047135'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.46224'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/V8pz15CkiMX5xYJRmbbp5zkKWJ8_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">489756</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(åŒ—äº¬å¹³è°·åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ–‡åŒ–åŒ—è¡—4-16å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">544</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¹³è°·åŸåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.14308'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'117.111554'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/2e/b4/2eb4edb22ddb981307d8570beb1d746d_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">517915</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—Â·neo(æ·±åœ³è‰åŸ”åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸ƒå‰è·¯1036å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">159</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç”°è´/æ°´è´ç å®åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.583191'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.118499'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/228vhBCQmFRFWQBYX1cgoFQb6x58_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">527938</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å¥½æ—¥å­çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç¦åä¸€è·¯28å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">590</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¼šå±•ä¸­å¿ƒ/CBD'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.537153'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.053529'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/b6Ztz5jn4MngK3Hzfxuu9JGsjrm_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">541619</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(ä¸Šæµ·è˜åº„åœ°é“ç«™é¾™ä¹‹æ¢¦å•†ä¸šå¹¿åœºåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è˜åº„é•‡è˜æµœè·¯172å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">149</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è˜åº„å·¥ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.105797'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.37755'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3mKs3jETvJDj3dDdkRB9UyLLvPna_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">542068</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·èŒ‚ä¸šåç¾è¾¾å¹¿åœºé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ²ªå—è·¯938å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">646</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œæ–°å›½é™…åšè§ˆä¸­å¿ƒ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.182761'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.554106'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2139uDFUZ2VKxrathwSeeE4DwyFU_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">546869</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å½­å¹´ä¸‡ä¸½é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å˜‰å®¾è·¯2002å·ï¼ˆæ¯—é‚»é‡‘å…‰åè´­ç‰©å¹¿åœºï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">701</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡ä¸½'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç½—æ¹–å£å²¸/ç«è½¦ç«™'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.540989'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.122665'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/gwAbqEXFUpjUBmnxUfK89p3zBBT_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">581859</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³é…’åº—ï¼ˆåŒ—äº¬ä¸°ç›Šæ¡¥åº—ï¼‰ï¼ˆåŸç”³æ™¨é…’åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸°å°ä¸°ç®¡è·¯8å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">648</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬è¥¿ç«™ã€ä¸½æ³½å•†åŠ¡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.857707'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.312482'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/97/43/97438481b9e79abad429e5c30d7f303f_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">584697</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—ï¼ˆæ·±åœ³åå¼ºèµ›æ ¼å¹¿åœºåº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åå¼ºå—è·¯3024å·èµ›æ ¼è‹‘1æ ‹'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">362</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åå¼ºåŒ—å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.539831'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.087899'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/D8/11/Cii-T1ku2zmIcP4sAAEw8iuLXFgAAKxZQH7HVYAATEK972_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">593228</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—ï¼ˆåŒ—äº¬é¢å’Œå›­åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ·æ·€å¢çº¢æ——è·¯åŠŸå¾·å¯ºæ¡¥åŒ—ä¾§'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">730</span><span class=\"token punctuation\">,</span> <span class=\"token number\">38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¦™å±±ã€å…«å¤§å¤„é£æ™¯åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.003959'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.256718'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/55/84/55841f502c5a711e66dd5454b64f559b_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">598591</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ä¸½æ˜‚è±ªç”Ÿå¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é‡‘æ–°è·¯99å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">529</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è±ªç”Ÿ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œé‡‘æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.252496'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.600085'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2KfPPyPx9rWyVXif2CUuxv61Nryc_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">607915</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­é…’åº—(æ·±åœ³çš‡å²—åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ»¨æ²³å¤§é“6033å·æµ·æ»¨å¹¿åœºå›½çš‡å¤§å¦3æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">313</span><span class=\"token punctuation\">,</span> <span class=\"token number\">42</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å²—å£å²¸/ç¦ç”°å£å²¸'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.528101'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.064221'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/qMyCJVYuW21nsCeEBt8CMfmEhra_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">608374</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(ä¸Šæµ·æµ¦ä¸œæœºåœºé¾™ä¸œå¤§é“åˆåº†åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸œå·å…¬è·¯5863å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">160</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œæœºåœºæ ¸å¿ƒåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.237662'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.718556'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/LUYxGGV4pzjKeN5a69K4deU8JD8_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">609023</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—Â·neo(ä¸Šæµ·å¤–é«˜æ¡¥ä¿ç¨åŒºåŒ—åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'èŠ±å±±è·¯1209å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">266</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œå¤–é«˜æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.351148'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.585606'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3cJ6KTfms9cfEnME8WRkQQBXBkYm_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">609372</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è±ªæ´¾ç‰¹åç¾è¾¾å¹¿åœºé…’åº—(æ·±åœ³åŒ—ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ°‘æ²»è¡—é“æ¢…é¾™è·¯ä¸æ°‘æ—ºè·¯äº¤æ±‡å¤„'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">498</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³åŒ—ç«™åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.620501'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.033874'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3G5TnUCPbjGYHAVWfvuixw8bs69t_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">624417</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å›æ‚¦é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å®å®‰å—è·¯1881å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">442</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±¡åŸ/äº¬åŸº100'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.537247'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.111182'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/45/EA/Cii-TF3ZpVmIVDJ9AAXvJftz_AgAAFrrQKbI4oABe89086_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">628327</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—Â·neo(æ·±åœ³ç½—æ¹–å£å²¸å›½è´¸åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äººæ°‘å—è·¯2011å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">223</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç½—æ¹–å£å²¸/ç«è½¦ç«™'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.536734'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.118336'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2rKHmQWHYiY8GZA3xBHpFKCLZwZo_w200_h200_c1_t0.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">629023</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢é…’åº—(åŒ—äº¬åé‡Œæ²³æ¬¢ä¹è°·åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åå…«é‡Œåº—ä¹¡å‘¨å®¶åº„288å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">390</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŠ²æ¾/æ½˜å®¶å›­åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.853354'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.483437'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/28hnDdqn5uzuzCKYkw2x4pYmunXM_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">629729</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(ä¸Šæµ·å¼ æ±Ÿé«˜ç§‘å›­åŒºåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œæ–°åŒºè”¡ä¼¦è·¯103å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">267</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œå¼ æ±Ÿåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.196154'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.62071'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/d9/61/d961508a10865b9b29c033064f31b913_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">635963</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³é¾™å²—ç æ±Ÿçš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¾™å²—ä¸­å¿ƒåŸé¾™ç¿”å¤§é“9009å·ç æ±Ÿå¹¿åœº'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">737</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¾™å²—ä¸­å¿ƒåŒº/å¤§è¿æ–°åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.722941'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.250002'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/45/EA/Cii-U13ZpWGIasKjAAY1SNE36KMAAFrrwMNoAwABjVg973_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">636080</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å¤§ä¸­åå–œæ¥ç™»é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç¦åè·¯ä¸€å·å¤§ä¸­åå›½é™…äº¤æ˜“å¹¿åœº'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1556</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¼šå±•ä¸­å¿ƒ/CBD'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.535567'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.062005'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3hQRTmAUW9PegTjxMiEfYwh2HnKp_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">644417</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å¤–é«˜æ¡¥å–œæ¥ç™»é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è‡ªç”±è´¸æ˜“è¯•éªŒåŒºåŸºéš†è·¯28å·ï¼ˆäºŒå·é—¨å†…ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2419</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œå¤–é«˜æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.350989'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.588751'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/1Rrtg9n7PdMEivVDhsehbJBrEre_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">648219</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·é‡‘æ¡¥çº¢æ«ä¸‡è±ªé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ–°é‡‘æ¡¥è·¯15å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">891</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œé‡‘æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.244061'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.591153'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/B6/Cii-TF3eXKuIR_a0AAUx-Xd2JLQAAGRfACSpvUABTIR560_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">657192</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å®å®‰ä¸­å¤©ç¾æ™¯åç¾è¾¾é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ–°æ¡¥è¡—é“ä¸‡ä¸°ç¤¾åŒºä¸­å¿ƒè·¯7-1å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">498</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å›½é™…ä¼šå±•ä¸­å¿ƒå•†åœˆ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.716473'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.826391'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/45/EA/Cii-U13ZpVeIRbhTAAOzGZSDtlcAAFrrQEWM-AAA7Mx626_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">659496</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³é…’åº—(æ·±åœ³å›½ç‹åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¾™åæ–°åŒºé¾™åé¾™è§‚è¥¿è·¯95å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">714</span><span class=\"token punctuation\">,</span> <span class=\"token number\">37</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³åŒ—ç«™åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.65892'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.006817'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/b4/76/b476cacc575a7ff237128ba2fd63923a_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">670673</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬é¾™åŸåç¾è¾¾é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ˜Œå¹³è·¯319å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">506</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›é¾™è§‚/å¤©é€šè‹‘åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.084219'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.304313'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/T3WruZV3S4MfcxdD1HFVhZjaBLW_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">672207</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢è‡³å°Šé…’åº—(åŒ—äº¬æœ›äº¬798åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é…’ä»™æ¡¥åŒ—è·¯9å·è§å±é‡Œ4å·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">579</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœ›äº¬/é…’ä»™æ¡¥/798åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.98835'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.491217'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2y56zwK8kd2tBuRUyF7XeJ2ucvWM_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">684720</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢é…’åº—(æ·±åœ³ç½—æ¹–å£å²¸ç«è½¦åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ²¿æ²³å—è·¯1064å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">208</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç½—æ¹–å£å²¸/ç«è½¦ç«™'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.533753'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.122491'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2LFgB2iFawKKoGADwzhW6jpCSaJT_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">696948</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·æ–°å›­åç¾è¾¾å¹¿åœºé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¼•å®è·¯509å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1290</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å…‰å¤§ä¼šå±•ä¸­å¿ƒ/æ¼•æ²³æ³¾åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.163802'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.405618'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/B6/Cii-TF3eXHuIE57sAAZx8iP6rMIAAGRbgAH09gABnIK621_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">706343</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—ï¼ˆåŒ—äº¬è¥¿å®¢ç«™åŒ—å¹¿åœºåº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸°å°è²èŠ±æ± ä¸œè·¯126å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">268</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬è¥¿ç«™ã€ä¸½æ³½å•†åŠ¡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.896623'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.315586'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/E3/46/Cii-TlkzMXWIL0sAAAGG8a3YwiwAALJlgG-r5YAAYcJ067_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">707357</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³é…’åº—ï¼ˆä¸Šæµ·å—ç«™å…‰å¤§åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¾æ±‡æ¡‚æ—è·¯46å·ï¼ˆé’¦å·å—è·¯è·¯å£å¾€å—100ç±³ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3288</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å…‰å¤§ä¼šå±•ä¸­å¿ƒ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.156297'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.419948'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/f7/13/f713f8f98d777d8d53aafefb37a79ef6_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">711837</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—ï¼ˆåŒ—äº¬ç«‹æ°´æ¡¥åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœé˜³å®‰ç«‹è·¯3å·1å¹¢3å±‚'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">268</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºšè¿æ‘ã€å¥¥ä½“ä¸­å¿ƒåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.043717'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.410962'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/b3/87/b3876eaf16af62521cf6fb474504b8ca_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">727679</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(æ·±åœ³æ­¥è¡Œè¡—è€è¡—åœ°é“ç«™äºŒåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç½—æ¹–åŒºä¸œé—¨ä¸­è·¯2216å·åä½³å¹¿åœº12-14æ¥¼ï¼ˆä¸œé—¨å¤©æ¡¥ä¸œå¤´ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">742</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸œé—¨å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.54585'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.122227'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/39/99/Cii9EFkwVMKIP_mCAAI3fOHlS1wAALSDAMeO2MAAjeU309_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">728180</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(æ·±åœ³å®å®‰è¥¿ä¹¡åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿ä¹¡å¤§é“298-7å·ï¼ˆå¯Œé€šåŸäºŒæœŸå…¬äº¤ç«™æ—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">184</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å®å®‰ä½“è‚²ä¸­å¿ƒå•†åœˆ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.569693'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.860186'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/FHdugqgUgYLPMoC4u4rdTbAPrVF_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">728415</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—Â·neo(æ·±åœ³ä¸œé—¨æ­¥è¡Œè¡—æ™’å¸ƒåœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ™’å¸ƒè·¯67å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">152</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸œé—¨å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.550183'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.120771'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/25/57/Cii-U13PFNWISSnQAAEpTtoilsQAAEVWgEvur8AASlm647_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">728461</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­é…’åº—(æ·±åœ³ä¼šå±•ä¸­å¿ƒåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ–°æ´²è·¯ä¸–çºªå·¥è‰ºå“å¹¿åœº307æ ‹'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">258</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å²—å£å²¸/ç¦ç”°å£å²¸'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.518026'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.046061'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/25/56/Cii-TF3PFKOIPl0JAANm4ge6DdMAAEVTQK2SP8AA2b6365_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">728604</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—Â·neo(æ·±åœ³å—å±±åœ°é“ç«™å—å±±å¸‚åœºåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å—æ–°è·¯é¡ºå¯Œè¡—18å·åŒ–å·å¤§å¦'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">198</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç§‘æŠ€å›­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.525561'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.920058'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/25/57/Cii-TF3PFLmIDGWiAAPHkaNTuOIAAEVVQBGazAAA8ep611_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">730454</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(æ·±åœ³ä¸‡è±¡åŸåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç½—æ¹–åŒºå˜‰å®¾è·¯4025å·åŸå¸‚å¤©åœ°å¹¿åœºå†…'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">552</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç½—æ¹–å£å²¸/ç«è½¦ç«™'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.537078'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.113733'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/C8/4C/Cii-Tlknhz2IFnYNAAInF2jEK14AAKbcQNB5M8AAicv660_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">730569</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(æ·±åœ³æ¢…æ—å“è¶ŠåŸåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å­–å²­åœ°é“å£Cå‡ºå£å·¦æ‰‹è¾¹ï¼Œé’å¹´å­¦é™¢å¯¹é¢'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">269</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è²èŠ±å±±/æ¢…æ—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.568701'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.068464'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/D8/0B/Cii-Tlku2dOISeGXAAAUw3MvPrIAAKxYALB2VAAABTb555_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">730968</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(æ·±åœ³å®å®‰åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å®å®‰åŒºå®å®‰25åŒºåˆ›ä¸šäºŒè·¯æ­¥è¡Œè¡—é‡‘éº’éºŸæœè£…å¹¿åœº4æ ‹'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">314</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å®å®‰ä¸­å¿ƒåŒº/å‰æµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.568162'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.900968'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/D8/0B/Cii-T1ku2cqIWTOOAAAS_bvRI5UAAKxXwILCFYAABMV285_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">751035</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(ä¸Šæµ·è‡ªè´¸åŒºåŒ—é—¨åœ°é“ç«™åº—)(åŸå¤–é«˜æ¡¥åœ°é“åŒ—ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'èŠ±å±±è·¯706å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">328</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œå¤–é«˜æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.348029'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.576896'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/3A/21/Cii-U1kwxUCINXaHAAGmh7z6qRAAALUdwMKGREAAaaf928_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">844350</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(æ·±åœ³ä¸–ç•Œä¹‹çª—åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å—å±±åŒºç™½çŸ³æ´²æ²™æ²³è¡—2å·é‡‘ä¸‰è§’å¤§å¦'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">769</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åä¾¨åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.540501'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.968858'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/D8/11/Cii-TFku2zmIOdjCAAAQJpLFhEEAAKxZQIEvQ0AABA-920_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2316304</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(æ·±åœ³åŒé¾™åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¾™å²—è¡—é“é¾™å²—å¢Ÿç¤¾åŒºé¾™å¹³ä¸œè·¯62å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">135</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¾™å²—ä¸­å¿ƒåŒº/å¤§è¿æ–°åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.730828'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.278337'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/4AzEoQ44awd1D2g95a6XDtJf3dkw_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"143\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2329005</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³é…’åº—(æ·±åœ³åä¹‹æ²™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç¦å¼ºè·¯æ–°æ´²ä¹è¡—28å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">651</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å²—å£å²¸/ç¦ç”°å£å²¸'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.524835'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.048214'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/88/f0/88f05cd11990ef39ae187886c76f40a5_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2351601</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³è›‡å£å¸Œå°”é¡¿å—æµ·é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœ›æµ·è·¯1177å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">509</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸Œå°”é¡¿'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³æ¹¾å£å²¸/è›‡å£'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.479373'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.916013'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/45/EA/Cii-TF3ZpXOIfa6fAAJjiUOiuYgAAFrtgDtgpQAAmOh799_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2359697</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(åŒ—äº¬ä¸Šåœ°å®‰å®åº„ä¸œè·¯åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¸…æ²³å°è¥å®‰å®åº„ä¸œè·¯18å·20å·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">420</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šåœ°äº§ä¸šå›­/è¥¿ä¸‰æ——'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.041322'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.333316'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2wj2f8mo9WZQCmzm51cwkZ9zvyp8_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5865979</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬ä¸½éƒ½çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å°†å°è·¯6å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1168</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœ›äº¬/é…’ä»™æ¡¥/798åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.978133'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.478642'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/Yo4xL3RUsYUnDDc5QcQWj7sCrUX_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"147\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5870456</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å®åä¸‡è±ªé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¹¿ä¸­è¥¿è·¯333å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">922</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤§å®å›½é™…å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.279371'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.446327'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/BA/Cii-U13eXVqIZXDFAAUC_xbrQDAAAGRrwPRyOcABQMX057_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"148\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5871652</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·åœ£è¯ºäºšçš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é‡‘æ²™æ±Ÿè·¯1699å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">770</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é•¿é£å…¬å›­åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.232346'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.377709'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/J4sP7qRSHa9rFYnKTW75ZPB393M_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"149\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5872067</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å´‡æ˜é‡‘èŒ‚å‡¯æ‚¦é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é™ˆå®¶é•‡æ½æµ·è·¯799å¼„'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1024</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‡¯æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å´‡æ˜å²›/é•¿å…´å²›/æ¨ªæ²™å²›'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.466563'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.799671'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/fsKrbnNsmSsYnNLmhh3ZvVjZ5cA_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"150\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5873072</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—ï¼ˆä¸Šæµ·ç«è½¦ç«™åŒ—å¹¿åœºåº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é—¸åŒ—èŠ·æ±Ÿè¥¿è·¯796å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">190</span><span class=\"token punctuation\">,</span> <span class=\"token number\">41</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ç«è½¦ç«™åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.255579'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.452903'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m2.tuniucdn.com/filebroker/cdn/res/96/6d/966d6596e6cb7b48c9cc1d7da79b57c8_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">7094829</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­é…’åº—(æ·±åœ³åå¼ºå—åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¾å²­è·¯9å·ï¼ˆå—å›­å°å­¦å¯¹é¢ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">215</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åå¼ºåŒ—å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.536842'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.094316'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3WDhaZZ9yALHw8yNiU6HJyrdC3u5_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"152\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">189429168</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(åŒ—äº¬å¤§å…´é»„æ‘æ¸…æºè·¯åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¸…æºè¥¿è·¯55å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">392</span><span class=\"token punctuation\">,</span> <span class=\"token number\">38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤§å…´å†œä¸šç”Ÿæ€è§‚å…‰åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.743751'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.321676'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/4F/25/Cii9EFk3LmOIFtnDAAHm5kdIiM8AAL1FQM8kG0AAeb-418_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">197487869</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(åŒ—äº¬ç¬¬äºŒå¤–å›½è¯­å¤§å­¦å—é—¨åŒæ¡¥åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é—´æˆ¿ä¹¡æ–°æˆ¿æ‘1å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">321</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¼ åª’å¤§å­¦/ç®¡åº„åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.90635'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.565528'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/ZkgDAs8tTMvgFHdVPpikNqENEn1_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">197488318</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—ï¼ˆåŒ—äº¬ç«‹æ°´æ¡¥åœ°é“å—ç«™åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœé˜³åŒ—è‹‘è·¯18å·é™¢3å·æ¥¼4å±‚'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">344</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºšè¿æ‘ã€å¥¥ä½“ä¸­å¿ƒåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.043689'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.414138'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/36/4D/Cii9EVkvP72IYYjgAAF7yZeWV-wAALMQACOARMAAXvh983_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"155\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">197492277</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—ï¼ˆåŒ—äº¬å¹³è°·å…´è°·ç¯å²›åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¹³è°·å¹³è°·å¤§è¡—31å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">614</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¹³è°·åŸåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.159255'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'117.12401'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/38/D5/Cii9EFkwFCiII79zAAHKsXy_LAoAALQuQEmEZ4AAcrJ339_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"156\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">197492479</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(åŒ—äº¬é¡ºä¹‰ä¸­å¿ƒåœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å…‰æ˜å—å¤§è¡—14å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">306</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¡ºä¹‰æ¸©æ³‰ä¼‘é—²åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.124783'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.65751'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2hNBSjmMTk6JQ2o8ixr5s3ioevhB_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"157\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">197496182</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢é…’åº—(åŒ—äº¬å›¢ç»“æ¹–åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›¢ç»“æ¹–è·¯9å·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">341</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç‡•è/æœé˜³å…¬å›­å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.930731'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.466602'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2gK41VpMb4AwyNkwQEkfFo83uTUU_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">197496980</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—(åŒ—äº¬æ¸©éƒ½æ°´åŸç‹åºœåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ˜Œå¹³åŒ—ä¸ƒå®¶é•‡å¹³è¥¿åºœæ‘ï¼ˆæ¸©éƒ½æ°´åŸä¸œ200ç±³ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">585</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å°æ±¤å±±æ¸©æ³‰åº¦å‡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.10144'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.380641'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/C7/CB/Cii-T1km_5eICnpJAAHOWN1GylMAAKYJwF0Hp8AAc5w000_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"159\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">197516492</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—ï¼ˆåŒ—äº¬å—è‹‘ä¸œé«˜åœ°åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸°å°å—å¤§çº¢é—¨è·¯ä¸œè¥æˆ¿15å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">651</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ°¸å®šé—¨ã€å—ç«™ã€å¤§çº¢é—¨ã€å—è‹‘åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.78996'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.42081'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/3B/D8/Cii-U1kxKGWIQlaxAAIdkjkSALkAALXDQMFbTsAAh2q158_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"160\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">197835483</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(æ·±åœ³å¤§å­¦æ¡ƒå›­åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å—å±±åŒºæ¡ƒå›­è¥¿è·¯160å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">431</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç§‘æŠ€å›­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.532576'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.916362'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/38/40/Cii9EFkv4XKIQN85AAFUcDrkXe0AALPvwPRn08AAVSI037_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"161\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">197837109</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—Â·neo(æ·±åœ³é¾™å²—å¤§é“å¸ƒå‰åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸ƒå‰é•‡æ·±æƒ è·¯é¾™ç å•†åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">127</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸ƒå‰/æ·±åœ³ä¸œç«™'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.602482'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.123284'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/25/58/Cii-TF3PFZOIA7jwAAKInGFN4xgAAEVbAGeP4AAAoi0485_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"162\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">198323591</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­é…’åº—(æ·±åœ³åŒ—ç«™é¾™åæ±½è½¦ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¾™åæ–°åŒºå»ºè¾‰è·¯2å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">209</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³åŒ—ç«™åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.671313'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.02784'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2dkB2HzbaBUJ7adZZfZaeS9JCvjP_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"163\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200208940</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·æµ¦ä¸œå–œæ¥ç™»ç”±ç”±å…¬å¯“'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦å»ºè·¯38å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3168</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œæ–°å›½é™…åšè§ˆä¸­å¿ƒ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.208553'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.518552'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/m3Nrm37Yx6YV4NwqRvSYnFRNSGk_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"164\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200210163</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(ä¸Šæµ·å¾å®¶æ±‡å®œå±±è·¯åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¾æ±‡é’¦å·åŒ—è·¯78å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">219</span><span class=\"token punctuation\">,</span> <span class=\"token number\">35</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å…‰å¤§ä¼šå±•ä¸­å¿ƒ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.180615'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.422916'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/DF/96/Cii-Tlkx0TOIGtOzAAEe_xcDxeIAALCZQJyxf4AAR8X941_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"165\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200214437</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·æµ¦ä¸œæœºåœºåç¾è¾¾å¹¿åœºé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œæœºåœºå¯èˆªè·¯1100å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">600</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œæœºåœºæ ¸å¿ƒåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.160969'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.799086'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2D2gbXDgrMx76uWfwzmoWpmSCCXx_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"166\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200214538</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ç»¿åœ°ä¸‡è±ªé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±Ÿæ»¨è·¯99å·ï¼ˆæ‰“æµ¦è·¯åº•ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">720</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ‰“æµ¦æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.192103'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.47298'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/268jVMuWdYok5ehGFhQ2QNhBhUhs_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"167\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200214715</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·æµ¦ä¸œå–œæ¥ç™»ç”±ç”±å¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦å»ºè·¯38å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2489</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œæ–°å›½é™…åšè§ˆä¸­å¿ƒ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.208739'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.518305'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/36t2KUGs4h5YgYSaLSkr5pMXLM54_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"168\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200214824</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(ä¸Šæµ·é™†å®¶å˜´å…«ä½°ä¼´åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å´‚å±±è·¯689å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">249</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œé™†å®¶å˜´é‡‘èè´¸æ˜“åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.220656'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.525127'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/3D/95/Cii9EVkx0JCIRDFfAAIMnl8npiYAALaawHMG2kAAgy2536_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"169\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200215226</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·é¢–å¥•çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åšå›­è·¯6555å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">907</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å˜‰å®šæ–°åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.272533'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.19179'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3Uyfi2aBRETE1K5PChiLVZCwtDLF_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"170\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200215286</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ä¸‡è±ªè™¹æ¡¥å¤§é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è™¹æ¡¥è·¯2270å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">910</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è™¹æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.191529'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.375577'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/52/B6/Cii-TF3eXK6IBQoRAAbgs1dyxJwAAGRfAPXbPQABuDL314_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"171\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200215365</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(ä¸Šæµ·è™¹æ¡¥æ¼•æ²³æ³¾å¤åŒ—åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è™¹æ¢…è·¯2971å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">189</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è™¹æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.180968'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.392415'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2WPfVp6auQkYoHzAdSbxwHAtQFfa_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"172\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200215548</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—ï¼ˆä¸Šæµ·è™¹æ¡¥æ¢çº½ä¹äº­ä¸­å¿ƒè·¯åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¾æ±Ÿä¹äº­é•‡ä¸­å¿ƒè·¯128å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">198</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸ƒå®å¤é•‡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.119363'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.322768'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/42/40/Cii-U1kziVOIGTw-AAGRMfcIwJwAALi6ACRnUsAAZFJ536_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"173\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">200216665</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³é…’åº—ï¼ˆä¸Šæµ·å¥‰è´¤å—æ¡¥ä¸­å¿ƒåº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¥‰è´¤æ²ªæ­å…¬è·¯1758-8å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1289</span><span class=\"token punctuation\">,</span> <span class=\"token number\">38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¥‰è´¤å¼€å‘åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'30.934646'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.451449'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/DC/A8/Cii-T1kw5leIQAA3AAFzNYtL4loAAK9OQOyk4sAAXNN152_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"174\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">219484323</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(æ·±åœ³è§‚æ¾œç« é˜åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å®å®‰åŒºç« é˜æ‘æ¡‚æœˆè·¯ç« é˜å¸‚åœºæ±‡é¾™å³°æ™¯ä¸€æœŸAæ ‹2-4å±‚'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">725</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è§‚æ¾œ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.746493'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.023'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/3C/8C/Cii-U1kxXqaIeqeuAAHwF4GDmOcAALYFQI9zMMAAfAv100_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"175\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">223318960</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢é…’åº—(æ·±åœ³æ·±å—å¤§é“åå¼ºè·¯åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±å—ä¸­è·¯2081å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">637</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åå¼ºåŒ—å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.540313'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.088611'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2M7am7D8rPTeTQAhxqBeMSANaqGr_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"176\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">233036941</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(ä¸Šæµ·ä¸œæ—å¯ºåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœ±æ³¾é•‡æ–‡å•†è·¯79å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">218</span><span class=\"token punctuation\">,</span> <span class=\"token number\">37</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é‡‘å±±æ«æ³¾å¤é•‡åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'30.895912'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.160238'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G4/M00/35/13/Cii_J1zr5PyIY3acAAFCnHJPxLUAAGX-ABvcIMAAUK0087_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"177\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">234719711</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—Â·neo(åŒ—äº¬æœé˜³åŒ—è·¯åé‡Œå ¡åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœé˜³åŒ—è·¯å…«é‡Œåº„å—é‡Œ26å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">378</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›½è´¸åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.922472'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.501118'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2rHdXNCmycnUxw99AniFC25ZDSfJ_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"178\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">234719728</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—ï¼ˆåŒ—äº¬æˆ¿å±±åŸå…³åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æˆ¿å±±åŸå…³é•‡åŸéšåº™è¡—10å·(åŸæˆ¿å±±è€å…¬å®‰å±€)'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">392</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.705216'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'115.981904'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/3F/66/Cii9EFkyeImIB3ZVAAHcTtTFt4oAALdsgICDO0AAdxm378_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"179\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">235196477</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢é…’åº—(åŒ—äº¬æ€»éƒ¨åŸºåœ°åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸°è‘†è·¯106å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">379</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ€»éƒ¨åŸºåœ°/ä¸°å°ä½“è‚²ä¸­å¿ƒ/å—å®«åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.815383'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.291012'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3J7Hcvwt5xZJL3NkS4wPJ6csmFb9_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"180\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">339777429</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å˜‰å®šå–œæ¥ç™»é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'èŠå›­æ–°åŒºå˜‰å”å…¬è·¯66å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1286</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å˜‰å®šæ–°åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.394595'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.245773'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2v2fKuo5bzhunSBC1n1E42cLTkZV_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"181\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">339952837</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(åŒ—äº¬è‰¯ä¹¡è¥¿è·¯åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è‰¯ä¹¡è¥¿è·¯7å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">159</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æˆ¿å±±é£æ™¯åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.73167'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.132482'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3Dpgf5RTTzrxpeN5y3RLnRVtxMEA_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"182\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">343341695</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢é…’åº—(åŒ—äº¬ä¸­å…³æ‘è½¯ä»¶å›­åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸œåŒ—æ—ºè¥¿è·¯8å·ä¸­å…³æ‘è½¯ä»¶å›­ä¸€æœŸ9å·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">245</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šåœ°äº§ä¸šå›­/è¥¿ä¸‰æ——'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.044663'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.29607'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3hSkPeWRQ3VK1heRQpHzJNMTanQz_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"183\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">365011120</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢é…’åº—(åŒ—äº¬çŸ³æ™¯å±±ä¸‡è¾¾å¹¿åœºåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é²è°·ä¸œè¡—ç”²26å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">505</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å…¬ä¸»åŸ/äº”æ£µæ¾/çŸ³æ™¯å±±æ¸¸ä¹å›­åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.895479'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.240386'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3iwohdQzyZP9azUkYAwTFj7WzBwd_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"184\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">368343863</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(ä¸Šæµ·é‡‘æ¡¥åšå…´è·¯åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åšå…´è·¯1119å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">218</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œé‡‘æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.266272'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.593829'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/w5ERtGJEmdgdgy5qtLPatR1xfm4_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"185\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">368701368</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å¤§ä¸­åå¸Œå°”é¡¿é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç¦ç”°æ·±å—å¤§é“1003å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1666</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸Œå°”é¡¿'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¼šå±•ä¸­å¿ƒ/CBD'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.539313'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.069763'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/4EnHseZ73LXdFJY7DSdJ8xqAcjXe_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"186\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1393017952</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­é…’åº—(æ·±åœ³å®å®‰æ¾å²—åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¾å²—é•‡æ²³æ»¨åŒ—è·¯12å·ç››åå¤§å¦'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">166</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¾å²—å•†ä¸šä¸­å¿ƒåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.768912'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.83325'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/4NehRjdHyZDKxTjAxTYv27FHq8LJ_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"187\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1400304687</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(æ·±åœ³æ¨ªå²—åœ°é“ç«™æ–°é©¬å•†è´¸åŸåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¾™å²—å¤§é“æ¨ªå²—æ®µ4004å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">149</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¾™å²—ä¸­å¿ƒåŒº/å¤§è¿æ–°åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.642629'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.202799'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/25/5A/Cii-TF3PFkiIb27dAAEqdDcKl3YAAEViQGVWY0AASqM960_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"188\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1406627919</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³ä¸­æ´²ä¸‡è±ªé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ·å¾·ä¸€é“88å·ä¸­æ´²æ§è‚¡ä¸­å¿ƒAåº§'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">204</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ·å²¸åŸ/åæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.517293'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.933785'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3wsinQAcuWtCdmv1yxauVG2PSYpC_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"189\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1418471719</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å®é¾™ä¸½ç¬™é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é‡‘æµ·è·¯2449å¼„2å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">860</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸½ç¬™'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦ä¸œé‡‘æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.26571'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.650132'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3myGUurFCriEVMGPy9yYMPFdb9Zh_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"190\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1455383931</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(æ·±åœ³å®å®‰å®¢è¿ä¸­å¿ƒç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿ä¹¡æ²³è¥¿é‡‘é›…æ–°è‹‘34æ ‹'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">169</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å®å®‰å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.590272'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.881933'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2w9cbbpzjjsyd2wRhFrnUpBMT8b4_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"191\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1457521002</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—(æ·±åœ³è¥¿ä¸½èŒ¶å…‰åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç å…‰åŒ—è·¯280å·å¤©ä¸‹æ¹˜å†›1æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">517</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤§å­¦åŸ/è¥¿ä¸½åŠ¨ç‰©å›­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.576187'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.956166'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/E3/E0/Cii-Tlkzdl6IfQYfAAHCgNVDe1sAALK6gPBDhQAAcKY242_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"192\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1463484295</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å’Œå¹³è±ªç”Ÿé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ²ªå—å…¬è·¯2653-2å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">650</span><span class=\"token punctuation\">,</span> <span class=\"token number\">41</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è±ªç”Ÿ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‘¨æµ¦åº·æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.146478'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.568218'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/ZxM9gWHqj657ndRsHw4j4p3CQ5k_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"193\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1514269829</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(ä¸Šæµ·ä¸œå·è·¯ç¢§æ±Ÿå•†ä¸šå¹¿åœºåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸œå·è·¯2645å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">218</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº¤å¤§/é—µè¡Œç»æµå¼€å‘åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.008875'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.402813'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/R92UunuCRXiG826G9Ptu7orqs7b_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"194\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1557882030</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³é…’åº—ï¼ˆæ·±åœ³ä¸œé—¨è€è¡—åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç½—æ¹–åŒºä¸œé—¨æ–°å›­è·¯37å·ç›Šå¾·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">336</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç»´ä¹Ÿçº³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸œé—¨å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.549413'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.118866'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/45/83/Cii9EFk0opCIPl9CAAKHl3Egm6oAALoKwLNWlwAAoev470_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"195\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1557997004</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·äº”è§’åœºå‡¯æ‚¦é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å›½å®šä¸œè·¯88å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1104</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‡¯æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±Ÿæ¹¾/äº”è§’åœºå•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.300645'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.51918'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3a3Zz9cDgbJEEJ1GcXzKhTh21YqK_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"196\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1565094427</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å›½é™…æ—…æ¸¸åº¦å‡åŒºä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç§€æµ¦è·¯3999å¼„17å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">713</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¿ªå£«å°¼åº¦å‡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.132913'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.63464'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/KPBUPunPDETYWg8WaJDSmiZC65z_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"197\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1584362548</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(ä¸Šæµ·æµ¦ä¸œå›½é™…æ—…æ¸¸åº¦å‡åŒºå¾¡æ¡¥åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¾¡é’è·¯315-317å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">339</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‘¨æµ¦åº·æ¡¥åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.15719'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.572392'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2ybd3wqdoBtBeKcPxmyso9y1hNXa_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"198\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1630005459</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©è¿é”é…’åº—ï¼ˆæ·±åœ³åœ°ç‹å¤§å¦çº¢æ¡‚è·¯åº—ï¼‰ï¼ˆåŸçº¢æ¡‚è·¯åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç½—æ¹–åŒºå®å®‰å—è·¯2078å·æ·±æ¸¯è±ªè‹‘ï¼ˆä¸çº¢æ¡‚è·¯äº¤æ±‡å¤„ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">143</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'7å¤©é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.550341'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.10965'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G2/M00/EA/18/Cii-T1k1KaGIIkQVAAD4fD_T3FcAALTtABiCJ8AAPiU164_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"199\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1637944903</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—åŒ—äº¬åæµ·åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿åŸåŒ—äº¬å¸‚è¥¿åŸåŒºå¾·èƒœé—¨å†…å¤§è¡—å…´åèƒ¡åŒäº”ç¦é‡Œ2å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">213</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.934452'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.38184'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/48/0C/Cii9EVk1JNuILdBWAAHv5O89TjMAALrFgJ8bwcAAe_8197_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"200\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1649956165</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å—é’åç¾è¾¾é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åå¤ä¸œè·¯811å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">299</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¿ªå£«å°¼åº¦å‡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.195206'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.664791'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2RHmQgTpte3UVSDJ5KbqobbZGRnE_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"201\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1714520967</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8é…’åº—(åŒ—äº¬å®‰åæ¡¥é»„å¯ºå¤§è¡—åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é»„å¯ºå¤§è¡—12å·é™¢16å·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">559</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é€Ÿ8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é©¬ç”¸ã€å®‰è´åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.962742'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.388431'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G1/M00/4A/21/Cii-U1k1o-uIdcUZAAIbmIKVlKAAALtvQGBb6kAAhuw170_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"202\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1725781423</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ä¸‰è¿ªåç¾è¾¾é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¹¿å¯Œæ—è·¯600å¼„7å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">690</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åç¾è¾¾'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä½˜å±±/æ¾æ±Ÿå¤§å­¦åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.058023'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.246536'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/NoHym6tuKwVazxy33wRNTNuQWd2_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"203\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1734220581</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­é…’åº—(æ·±åœ³å¤§é¹ä½³å…†ä¸šåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤§é¹è¡—é“æ–°å›­è¡—12å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">378</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¾ƒåœºå°¾/å¤§é¹æ‰€åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.592661'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.475167'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3nWzyWt63gtwPzRf5xbHvwKM27vU_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"204\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1754929048</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ç¯çƒæ¸¯å‡¯æ‚¦é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å®å¤è·¯718å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1336</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‡¯æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸­å±±å…¬å›­å•†ä¸šåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.232041'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.412492'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/45/B6/Cii-U13ZY-CIF-8MAAXkwQoY7FIAAFpQgEE1bgABeTZ750_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"205\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1762661667</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³ä½³å…†ä¸šä¸‡è±ªé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ£•æ¦ˆå¤§é“33å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">223</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¾ƒåœºå°¾/å¤§é¹æ‰€åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.569193'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.459325'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/45/EC/Cii-TF3ZqE-IYM0NAAY6GIHLZNsAAFr2QDhR8EABjow444_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"206\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1765008760</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(åŒ—äº¬è¥¿ç›´é—¨åŒ—äº¬åŒ—ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿ç›´é—¨åŒ—å¤§è¡—49å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">356</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿ç›´é—¨/åŒ—äº¬å±•è§ˆé¦†åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.945106'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.353827'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/4CLwbCE9346jYn7nFsJTQXuBExTJ_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"207\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1880614409</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å´‡æ˜ç”±ç”±å–œæ¥ç™»é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ½æµ·è·¯2888å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2198</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å´‡æ˜å²›/é•¿å…´å²›/æ¨ªæ²™å²›'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.462167'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.823103'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/21gDCGgRT3xFqCd3FxBh633j6Qsu_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"208\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1889333146</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—(åŒ—äº¬è¥¿å®¢ç«™ä¸½æ³½æ¡¥åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¥¿ä¸‰ç¯å—è·¯44å·-218'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">459</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬è¥¿ç«™/ä¸½æ³½å•†åŠ¡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.869638'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.313075'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/kG5corYUDC7U1qE8RAY6xCVnGxq_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"209\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1908594080</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å»ºå·¥æµ¦æ±Ÿçš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é™ˆè¡Œå…¬è·¯3701å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">843</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ¦æ±Ÿé•‡åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.090063'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.489728'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/45/B7/Cii-U13ZZDWIePrGAAPyImW93N0AAFpRgMmj4MAA_I6005_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"210\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1913922369</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ä¸­å»ºä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'èŸ æ–‡è·¯333å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">889</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è™¹æ¡¥æœºåœº/å›½å®¶ä¼šå±•ä¸­å¿ƒ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.185504'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.287709'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/39Afm5Bxgd784eMeFB5DrcsPnhT_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"211\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1916002015</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·è‹å®ç¯çƒä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸¹å·´è·¯99å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">689</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é•¿é£å…¬å›­åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.22292'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.379912'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/svpYHdmVDck91NqAhjtngcXth2G_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"212\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1928731731</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·åº·æ¡¥ä¸‡è±ªé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åº·æ–°å…¬è·¯4499å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">811</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è¿ªå£«å°¼åº¦å‡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.119187'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.618966'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3inpPxTnvRjMCEB39K9FuHaXohYw_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"213\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1931442052</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³æœºåœºå‡¯æ‚¦é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å®å®‰å›½é™…æœºåœºåœ°é¢äº¤é€šä¸­å¿ƒï¼ˆGTCï¼‰18å·å‡ºå£'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">291</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‡¯æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å®å®‰æœºåœºå•†åœˆ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.622498'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.812341'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/45/EC/Cii-TF3ZqVeIJcTPAAUq_Ou_CrcAAFr4gKufPUABSsU446_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"214\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1931602865</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³è”æŠ•ä¸œæ–¹ä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¾å²—ä¸œæ–¹å¤§é“46å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">688</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¾å²—å•†ä¸šä¸­å¿ƒåŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.760746'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.856961'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/45/EC/Cii-U13ZqVyIOjdpAARI9aeBh-IAAFr4gOQh7oABEkN297_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"215\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1937347815</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬æœ›äº¬å‡¯æ‚¦é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¹¿é¡ºå—å¤§è¡—8å·é™¢2å·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">617</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‡¯æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœ›äº¬/é…’ä»™æ¡¥/798åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.991546'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.476288'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2gLT4ZgJ8ZuS7sSmXzYoCXnV248p_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"216\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1942938880</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬ä¹å¤šæ¸¯ä¸‡è±ªé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŸå—è¡—é“å—å£è·¯29å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">227</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ˜Œå¹³åŸåŒº/åä¸‰é™µåº¦å‡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.23264'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.188888'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3mBWaZeaqq54E7kX2n7g9b2CZX6q_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"217\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1942992995</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å˜‰å®šå‡¯æ‚¦é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è£•æ°‘å—è·¯1366å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">758</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‡¯æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å˜‰å®šæ–°åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.352298'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.263314'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/53/2D/Cii-U13edkqIfZhLAAJEW25WIF4AAGVxQIg38sAAkRz517_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"218\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1951709780</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³åŒæ³°ä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç¦æµ·è¡—é“å®å®‰å¤§é“ 6259å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">617</span><span class=\"token punctuation\">,</span> <span class=\"token number\">48</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å›½é™…ä¼šå±•ä¸­å¿ƒå•†åœˆ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.678611'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.805695'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3oUfktphxMAWq9hUxD9uqdjRdZGB_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"219\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1973839294</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³æ¹¾ä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç§‘æŠ€å—è·¯16å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">508</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç§‘æŠ€å›­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.531101'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.950615'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/8C9QscRsvTWCx92wt17GAegEMFn_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"220\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1975922994</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶é…’åº—Â·neo(æ·±åœ³å—å±±æµ·å²¸åŸå—æ²¹åœ°é“ç«™åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å—å•†è·¯84-6å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">238</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦‚å®¶'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ·å²¸åŸ/åæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.513566'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.9291'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/25/5E/Cii-TF3PGD-IQ0FcAAFIZC82AnkAAEVvAKdj4YAAUh8638_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"221\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1989806195</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³åšæ—å¤©ç‘å–œæ¥ç™»é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç•™ä»™å¤§é“4088å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1369</span><span class=\"token punctuation\">,</span> <span class=\"token number\">48</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤§å­¦åŸ/è¥¿ä¸½åŠ¨ç‰©å›­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.582918'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.97219'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/4Rx55fZoneUeKbE3TCRSPB6WQ6bw_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"222\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1996823660</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ç´«ç«¹ä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç´«æ˜Ÿè·¯588å·3å¹¢'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">642</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº¤å¤§/é—µè¡Œç»æµå¼€å‘åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.02118'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.465186'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/53/2F/Cii-TF3edraIPzK9AAH_p8vdHKoAAGV3AJgSVEAAf-_019_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"223\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1997830708</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢è‡³å°šé…’åº—(åŒ—äº¬ä¸Šåœ°è½¯ä»¶å›­åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¸…æ²³å°è¥è¥¿è·¯48å·æ±‡è‹‘ä»å’Œå¤§å¦ä¸€å±‚'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">753</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šåœ°äº§ä¸šå›­/è¥¿ä¸‰æ——'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.034623'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.323925'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2sKjxS1hFYyBFVKVBqo2x2hSFvGj_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"224\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2003479905</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·æ¦•æ¸¯ä¸‡æ€¡é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ–°æ¾æ±Ÿè·¯1277å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">798</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡æ€¡'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä½˜å±±/æ¾æ±Ÿå¤§å­¦åŸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.038198'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.210178'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2GM761BYH8k15qkNrJrja3cwfr2D_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"225\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2009548883</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢è‡³å°šé…’åº—(åŒ—äº¬é¦–éƒ½æœºåœºæ–°å›½å±•åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åºœå‰äºŒè¡—6å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">611</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é¦–éƒ½æœºåœº/æ–°å›½å±•åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.063953'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.576829'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/43zCTomkMSkUfZByZxn77YH2XidJ_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"226\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2011785622</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬ä¸–å›­å‡¯æ‚¦é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é˜œåº·å—è·¯1å·é™¢1å·æ¥¼A'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">558</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‡¯æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”æ˜Ÿçº§'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å»¶åº†ä¼‘é—²åº¦å‡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.440732'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'115.963259'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/uhGcQze3zZQxe4avSU8BysgYVvx_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"227\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2022598930</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·å®åå–œæ¥ç™»é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å—å¥‰å…¬è·¯3111å¼„228å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2899</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¥‰è´¤å¼€å‘åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'30.921659'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.575572'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb2/t1/G6/M00/45/BD/Cii-TF3ZaBmIStrbAASnoOyg7FoAAFpYwEoz9oABKe4992_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"228\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2022881967</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³ç›ç”°å‡¯æ‚¦é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ·æ™¯äºŒè·¯1025å·1-6å±‚ã€30-50å±‚'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">650</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å‡¯æ‚¦'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç›ç”°åŒºæ”¿åºœ/æ²™å¤´è§’'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.551323'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.23781'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2RFMLSujkczEn1HoybD6dUpN9pzr_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"229\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2031683181</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢è‡³å°šé…’åº—(åŒ—äº¬é›å’Œå®«å’Œå¹³é‡Œåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å°é»„åº„1åŒº15å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">299</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å’Œé¢'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å››é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é©¬ç”¸/å®‰è´åœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.962361'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.412931'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/4Xqm5BN9pZTamwmYS3eLxL417YYt_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"230\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2045052822</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å›½é™…ä¼šå±•ä¸­å¿ƒçš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å±•äº‘è·¯6å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">675</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å›½é™…ä¼šå±•ä¸­å¿ƒå•†åœˆ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.686581'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.777655'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/4DGZygQpE4iSpcBDCoXJvjNr4oiR_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"231\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2048042240</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬å¤§å…´å¸Œå°”é¡¿é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'é«˜ç±³åº—å—é‡Œ18å·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1283</span><span class=\"token punctuation\">,</span> <span class=\"token number\">48</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸Œå°”é¡¿'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¤§å…´åŒ—äº¬æ–°æœºåœºåœ°åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.76875'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.339199'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3B32F8zSU2CJCWzs1hoH2o4WcquR_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"232\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2048047291</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬æ–°é’æµ·å–œæ¥ç™»é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸½æ³½é‡‘èå•†åŠ¡åŒºå‡¤å‡°å˜´åŒ—è·¯ä¸é‡‘ä¸­éƒ½è¥¿è·¯äº¤å‰å£è¥¿è¥è¡—8å·é™¢1å·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">723</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å–œæ¥ç™»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬è¥¿ç«™/ä¸½æ³½å•†åŠ¡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.864026'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.322505'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/4DPQMu5sMM7XR1mvcjoqtWngc7TF_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"233\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2048050570</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­é…’åº—ï¼ˆæ·±åœ³åªå±±ç«è½¦ç«™åº—ï¼‰'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ–°å’Œè·¯127-2å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">436</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åªå±±é«˜é“ç«™å•†åœˆ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.700753'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.339089'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2nXN2bWjfoqoTkPwHvLJQPYz17qD_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"234\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2048671293</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­é…’åº—(æ·±åœ³è§‚æ¾œäº”å’Œå¤§é“åº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è§‚æ¹–è¡—é“äº”å’Œå¤§é“327å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">234</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è§‚æ¾œ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.684459'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.07708'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2JrQi83S9qgDEkXqWpe5iyi44Uh2_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"235\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2051661320</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­é…’åº—(æ·±åœ³ç½—æ¹–å£å²¸ä¸‡è±¡åŸäºŒåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ¡‚å›­è¡—é“å®å®‰å—è·¯1050å·å˜‰å®¾èŠ±å›­Cæ ‹'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">667</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‰é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±¡åŸ/äº¬åŸº100'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.540352'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'114.112668'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/34FRP7HLPhvKZP1a6tXu4XrJeiaw_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"236\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2056105938</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬é€šå·åŒ—æŠ•å¸Œå°”é¡¿é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ–°åä¸œè¡—289å·2å·æ¥¼'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1068</span><span class=\"token punctuation\">,</span> <span class=\"token number\">48</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸Œå°”é¡¿'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æœå›­ç¯å²›/é€šå·åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'39.908805'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'116.659748'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/NGKdpec3tZJNUUNWJ5pd67Cp5AY_w200_h200_c1_t0.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"237\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2056126831</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·è™¹æ¡¥é‡‘è‡£çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç”³é•¿è·¯630å¼„1-3 å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2488</span><span class=\"token punctuation\">,</span> <span class=\"token number\">48</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'è™¹æ¡¥æœºåœº/å›½å®¶ä¼šå±•ä¸­å¿ƒ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.19036'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.31535'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/PvFh4Vzc84xXhm5N41F6AqdAqyJ_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"238\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2056132395</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³æ·±é“çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±å—å¤§é“9819å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">340</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç§‘æŠ€å›­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.538923'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.944794'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/eBLtrED2uJs7yURWfjnWge9dT1P_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"239\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2056298828</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·ä¸­ä¼˜åŸå¸‚ä¸‡è±ªé…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ²ªå—å…¬è·¯7688å¼„1å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1200</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡è±ª'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸Šæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å—æ±‡/é‡ç”ŸåŠ¨ç‰©å›­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'31.030053'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'121.662943'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2gBATEyysyQWmw3wZL863HGdqjaq_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"240\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2058250574</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³æ¹¾ä¸‡ä¸½é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç²¤æµ·è¡—é“é«˜æ–°åŒºç¤¾åŒºç§‘æŠ€å—è·¯18å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">351</span><span class=\"token punctuation\">,</span> <span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸‡ä¸½'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç§‘æŠ€å›­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.531674'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.951882'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2YWUpZsvPVkRiKgdPg95LJxaFmB6_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"241\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2060510277</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬é‡‘éš…å…«è¾¾å²­çš‡å† å‡æ—¥é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¦«æ°´åŒ—è¡—1å·1-14å¹¢'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1026</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'çš‡å† å‡æ—¥'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åŒ—äº¬'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å»¶åº†ä¼‘é—²åº¦å‡åŒº'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'40.476483'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'115.97481'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/3Dzq2KxgiQbmb1sbc5iK6xqpVuFr_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"242\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2060618247</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­é…’åº—(æ·±åœ³æµ·å²¸åŸåº—)'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ç²¤æµ·è¡—é“åæµ·ç¤¾åŒºåæµ·ç¬¬äºŒç»Ÿå»ºæ¥¼å•†ä¸šè£™æ¥¼ç¬¬äºŒå±‚B'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">562</span><span class=\"token punctuation\">,</span> <span class=\"token number\">49</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ±‰åº­'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äºŒé’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æµ·å²¸åŸ/åæµ·'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.507276'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.931251'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/TBoXdgEx5Yjc2HobeC3fPWWnSJi_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"243\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tb_hotel<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2062643512</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å›½é™…ä¼šå±•ä¸­å¿ƒå¸Œå°”é¡¿é…’åº—'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å±•ä¸°è·¯80å·'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">285</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¸Œå°”é¡¿'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'äº”é’»'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ·±åœ³å›½é™…ä¼šå±•ä¸­å¿ƒå•†åœˆ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22.705335'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'113.77794'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://m.tuniucdn.com/fb3/s1/2n9c/2SHUVXNrN5NsXsTUwcd1yaHKbrGq_w200_h200_c1_t0.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"244\"></td><td><pre></pre></td></tr><tr><td data-num=\"245\"></td><td><pre><span class=\"token keyword\">SET</span> FOREIGN_KEY_CHECKS <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure>",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "Elasticsearch",
                "è®¡ç®—æœºå­¦ç§‘",
                "springcloud",
                "Elasticsearch",
                "æ¡ˆä¾‹"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Docker/Linux%E4%B8%ADDocker%E7%9A%84%E4%B8%8B%E8%BD%BD%E5%92%8C%E5%AE%89%E8%A3%85/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Docker/Linux%E4%B8%ADDocker%E7%9A%84%E4%B8%8B%E8%BD%BD%E5%92%8C%E5%AE%89%E8%A3%85/",
            "title": "Linuxä¸­Dockerçš„ä¸‹è½½å’Œå®‰è£…",
            "date_published": "2024-01-06T02:25:24.172Z",
            "content_html": "<h1 id=\"0å®‰è£…docker\"><a class=\"anchor\" href=\"#0å®‰è£…docker\">#</a> 0. å®‰è£… Docker</h1>\n<p>Docker åˆ†ä¸º CE å’Œ EE ä¸¤å¤§ç‰ˆæœ¬ã€‚CE å³ç¤¾åŒºç‰ˆï¼ˆå…è´¹ï¼Œæ”¯æŒå‘¨æœŸ 7 ä¸ªæœˆï¼‰ï¼ŒEE å³ä¼ä¸šç‰ˆï¼Œå¼ºè°ƒå®‰å…¨ï¼Œä»˜è´¹ä½¿ç”¨ï¼Œæ”¯æŒå‘¨æœŸ 24 ä¸ªæœˆã€‚</p>\n<p>Docker CE åˆ†ä¸º  <code>stable</code>   <code>test</code>  å’Œ  <code>nightly</code>  ä¸‰ä¸ªæ›´æ–°é¢‘é“ã€‚</p>\n<p>å®˜æ–¹ç½‘ç«™ä¸Šæœ‰å„ç§ç¯å¢ƒä¸‹çš„ <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vaW5zdGFsbC8=\">å®‰è£…æŒ‡å—</span>ï¼Œè¿™é‡Œä¸»è¦ä»‹ç» Docker CE åœ¨ CentOS ä¸Šçš„å®‰è£…ã€‚</p>\n<h1 id=\"1centoså®‰è£…docker\"><a class=\"anchor\" href=\"#1centoså®‰è£…docker\">#</a> 1.CentOS å®‰è£… Docker</h1>\n<p>Docker CE æ”¯æŒ 64 ä½ç‰ˆæœ¬ CentOS 7ï¼Œå¹¶ä¸”è¦æ±‚å†…æ ¸ç‰ˆæœ¬ä¸ä½äº 3.10ï¼Œ CentOS 7 æ»¡è¶³æœ€ä½å†…æ ¸çš„è¦æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ CentOS 7 å®‰è£… Dockerã€‚</p>\n<h2 id=\"11å¸è½½å¯é€‰\"><a class=\"anchor\" href=\"#11å¸è½½å¯é€‰\">#</a> 1.1. å¸è½½ï¼ˆå¯é€‰ï¼‰</h2>\n<p>å¦‚æœä¹‹å‰å®‰è£…è¿‡æ—§ç‰ˆæœ¬çš„ Dockerï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤å¸è½½ï¼š</p>\n<pre><code>yum remove docker \\\ndocker-client \\\ndocker-client-latest \\\ndocker-common \\\ndocker-latest \\\ndocker-latest-logrotate \\\ndocker-logrotate \\\ndocker-selinux \\\ndocker-engine-selinux \\\ndocker-engine \\\ndocker-ce\n</code></pre>\n<h2 id=\"12å®‰è£…docker\"><a class=\"anchor\" href=\"#12å®‰è£…docker\">#</a> 1.2. å®‰è£… docker</h2>\n<p>é¦–å…ˆéœ€è¦å¤§å®¶è™šæ‹Ÿæœºè”ç½‘ï¼Œå®‰è£… yum å·¥å…·</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> yum-utils <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>device-mapper-persistent-data <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>lvm2 --skip-broken</pre></td></tr></table></figure><p>ç„¶åæ›´æ–°æœ¬åœ°é•œåƒæºï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># è®¾ç½® docker é•œåƒæº</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>yum-config-manager <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    --add-repo <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token parameter variable\">-i</span> <span class=\"token string\">'s/download.docker.com/mirrors.aliyun.com\\/docker-ce/g'</span> /etc/yum.repos.d/docker-ce.repo</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>yum makecache fast</pre></td></tr></table></figure><p>ç„¶åè¾“å…¥å‘½ä»¤ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> docker-ce</pre></td></tr></table></figure><p>docker-ce ä¸ºç¤¾åŒºå…è´¹ç‰ˆæœ¬ã€‚ç¨ç­‰ç‰‡åˆ»ï¼Œdocker å³å¯å®‰è£…æˆåŠŸã€‚</p>\n<h2 id=\"13å¯åŠ¨docker\"><a class=\"anchor\" href=\"#13å¯åŠ¨docker\">#</a> 1.3. å¯åŠ¨ docker</h2>\n<p>Docker åº”ç”¨éœ€è¦ç”¨åˆ°å„ç§ç«¯å£ï¼Œé€ä¸€å»ä¿®æ”¹é˜²ç«å¢™è®¾ç½®ã€‚éå¸¸éº»çƒ¦ï¼Œå› æ­¤å»ºè®®å¤§å®¶ç›´æ¥å…³é—­é˜²ç«å¢™ï¼</p>\n<p>å¯åŠ¨ docker å‰ï¼Œä¸€å®šè¦å…³é—­é˜²ç«å¢™åï¼ï¼</p>\n<p>å¯åŠ¨ docker å‰ï¼Œä¸€å®šè¦å…³é—­é˜²ç«å¢™åï¼ï¼</p>\n<p>å¯åŠ¨ docker å‰ï¼Œä¸€å®šè¦å…³é—­é˜²ç«å¢™åï¼ï¼</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># å…³é—­</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>systemctl stop firewalld</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># ç¦æ­¢å¼€æœºå¯åŠ¨é˜²ç«å¢™</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>systemctl disable firewalld</pre></td></tr></table></figure><p>é€šè¿‡å‘½ä»¤å¯åŠ¨ dockerï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl start <span class=\"token function\">docker</span>  <span class=\"token comment\"># å¯åŠ¨ docker æœåŠ¡</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>systemctl stop <span class=\"token function\">docker</span>  <span class=\"token comment\"># åœæ­¢ docker æœåŠ¡</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>systemctl restart <span class=\"token function\">docker</span>  <span class=\"token comment\"># é‡å¯ docker æœåŠ¡</span></pre></td></tr></table></figure><p>ç„¶åè¾“å…¥å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹ docker ç‰ˆæœ¬ï¼š</p>\n<pre><code>docker -v\n</code></pre>\n<p>å¦‚å›¾ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081526343.png\" alt=\"image-20210418154704436\" /></p>\n<h2 id=\"14é…ç½®é•œåƒåŠ é€Ÿ\"><a class=\"anchor\" href=\"#14é…ç½®é•œåƒåŠ é€Ÿ\">#</a> 1.4. é…ç½®é•œåƒåŠ é€Ÿ</h2>\n<p>docker å®˜æ–¹é•œåƒä»“åº“ç½‘é€Ÿè¾ƒå·®ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®å›½å†…é•œåƒæœåŠ¡ï¼š</p>\n<p>å‚è€ƒé˜¿é‡Œäº‘çš„é•œåƒåŠ é€Ÿæ–‡æ¡£ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jci5jb25zb2xlLmFsaXl1bi5jb20vY24taGFuZ3pob3UvaW5zdGFuY2VzL21pcnJvcnM=\">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</span></p>\n<h1 id=\"2centos7å®‰è£…dockercompose\"><a class=\"anchor\" href=\"#2centos7å®‰è£…dockercompose\">#</a> 2.CentOS7 å®‰è£… DockerCompose</h1>\n<h2 id=\"21ä¸‹è½½\"><a class=\"anchor\" href=\"#21ä¸‹è½½\">#</a> 2.1. ä¸‹è½½</h2>\n<p>Linux ä¸‹éœ€è¦é€šè¿‡å‘½ä»¤ä¸‹è½½ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># å®‰è£…</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-L</span> https://github.com/docker/compose/releases/download/1.23.1/docker-compose-<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">uname</span> <span class=\"token parameter variable\">-s</span><span class=\"token variable\">`</span></span>-<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">uname</span> <span class=\"token parameter variable\">-m</span><span class=\"token variable\">`</span></span> <span class=\"token operator\">></span> /usr/local/bin/docker-compose</pre></td></tr></table></figure><p>å¦‚æœä¸‹è½½é€Ÿåº¦è¾ƒæ…¢ï¼Œæˆ–è€…ä¸‹è½½å¤±è´¥ï¼Œå¯ä»¥ä½¿ç”¨è¯¾å‰èµ„æ–™æä¾›çš„ docker-compose æ–‡ä»¶ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081526880.png\" alt=\"image-20210417133020614\" /></p>\n<p>ä¸Šä¼ åˆ° <code>/usr/local/bin/</code>  ç›®å½•ä¹Ÿå¯ä»¥ã€‚</p>\n<p>åœ¨å½“å‰ç›®å½•ä¸‹ä¹Ÿå¯ä»¥æ‰¾åˆ° docker-compose æ–‡ä»¶</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310092029811.png\" alt=\"image-20231009202915017\" /></p>\n<h2 id=\"22ä¿®æ”¹æ–‡ä»¶æƒé™\"><a class=\"anchor\" href=\"#22ä¿®æ”¹æ–‡ä»¶æƒé™\">#</a> 2.2. ä¿®æ”¹æ–‡ä»¶æƒé™</h2>\n<p>ä¿®æ”¹æ–‡ä»¶æƒé™ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># ä¿®æ”¹æƒé™</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">chmod</span> +x /usr/local/bin/docker-compose</pre></td></tr></table></figure><h2 id=\"23baseè‡ªåŠ¨è¡¥å…¨å‘½ä»¤\"><a class=\"anchor\" href=\"#23baseè‡ªåŠ¨è¡¥å…¨å‘½ä»¤\">#</a> 2.3.Base è‡ªåŠ¨è¡¥å…¨å‘½ä»¤ï¼š</h2>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># è¡¥å…¨å‘½ä»¤</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-L</span> https://raw.githubusercontent.com/docker/compose/1.29.1/contrib/completion/bash/docker-compose <span class=\"token operator\">></span> /etc/bash_completion.d/docker-compose</pre></td></tr></table></figure><p>å¦‚æœå‡ºé”™å¯ä»¥å°è¯•å¼€ï¼šæ¢¯å­ã€‚</p>\n<p>å¦‚æœè¿™é‡Œå‡ºç°é”™è¯¯ï¼Œéœ€è¦ä¿®æ”¹è‡ªå·±çš„ hosts æ–‡ä»¶ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"199.232.68.133 raw.githubusercontent.com\"</span> <span class=\"token operator\">>></span> /etc/hosts</pre></td></tr></table></figure><h1 id=\"3dockeré•œåƒä»“åº“\"><a class=\"anchor\" href=\"#3dockeré•œåƒä»“åº“\">#</a> 3.Docker é•œåƒä»“åº“</h1>\n<p>æ­å»ºé•œåƒä»“åº“å¯ä»¥åŸºäº Docker å®˜æ–¹æä¾›çš„ DockerRegistry æ¥å®ç°ã€‚</p>\n<p>å®˜ç½‘åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS9fL3JlZ2lzdHJ5\">https://hub.docker.com/_/registry</span></p>\n<h2 id=\"31ç®€åŒ–ç‰ˆé•œåƒä»“åº“\"><a class=\"anchor\" href=\"#31ç®€åŒ–ç‰ˆé•œåƒä»“åº“\">#</a> 3.1. ç®€åŒ–ç‰ˆé•œåƒä»“åº“</h2>\n<p>Docker å®˜æ–¹çš„ Docker Registry æ˜¯ä¸€ä¸ªåŸºç¡€ç‰ˆæœ¬çš„ Docker é•œåƒä»“åº“ï¼Œå…·å¤‡ä»“åº“ç®¡ç†çš„å®Œæ•´åŠŸèƒ½ï¼Œä½†æ˜¯æ²¡æœ‰å›¾å½¢åŒ–ç•Œé¢ã€‚</p>\n<p>æ­å»ºæ–¹å¼æ¯”è¾ƒç®€å•ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token parameter variable\">--restart</span><span class=\"token operator\">=</span>always <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token parameter variable\">--name</span> registry\t<span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token parameter variable\">-p</span> <span class=\"token number\">5000</span>:5000 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token parameter variable\">-v</span> registry-data:/var/lib/registry <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    registry</pre></td></tr></table></figure><p>å‘½ä»¤ä¸­æŒ‚è½½äº†ä¸€ä¸ªæ•°æ®å· registry-data åˆ°å®¹å™¨å†…çš„ /var/lib/registry ç›®å½•ï¼Œè¿™æ˜¯ç§æœ‰é•œåƒåº“å­˜æ”¾æ•°æ®çš„ç›®å½•ã€‚</p>\n<p>è®¿é—® http://YourIp:5000/v2/_catalog å¯ä»¥æŸ¥çœ‹å½“å‰ç§æœ‰é•œåƒæœåŠ¡ä¸­åŒ…å«çš„é•œåƒ</p>\n<h2 id=\"32å¸¦æœ‰å›¾å½¢åŒ–ç•Œé¢ç‰ˆæœ¬\"><a class=\"anchor\" href=\"#32å¸¦æœ‰å›¾å½¢åŒ–ç•Œé¢ç‰ˆæœ¬\">#</a> 3.2. å¸¦æœ‰å›¾å½¢åŒ–ç•Œé¢ç‰ˆæœ¬</h2>\n<p>ä½¿ç”¨ DockerCompose éƒ¨ç½²å¸¦æœ‰å›¾è±¡ç•Œé¢çš„ DockerRegistryï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3.0'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">registry</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> registry</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token punctuation\">-</span> ./registry<span class=\"token punctuation\">-</span>data<span class=\"token punctuation\">:</span>/var/lib/registry</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">-</span> CATALOG_ELEMENTS_LIMIT=\"1000\"</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">ui</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> joxit/docker<span class=\"token punctuation\">-</span>registry<span class=\"token punctuation\">-</span>ui<span class=\"token punctuation\">:</span>static</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">-</span> 8080<span class=\"token punctuation\">:</span><span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">-</span> REGISTRY_TITLE=ä¼ æ™ºæ•™è‚²ç§æœ‰ä»“åº“</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token punctuation\">-</span> REGISTRY_URL=http<span class=\"token punctuation\">:</span>//registry<span class=\"token punctuation\">:</span><span class=\"token number\">5000</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token punctuation\">-</span> registry</pre></td></tr></table></figure><h2 id=\"321åˆ›å»ºdocker-composeymlæ–‡ä»¶\"><a class=\"anchor\" href=\"#321åˆ›å»ºdocker-composeymlæ–‡ä»¶\">#</a> 3.2.1. åˆ›å»º docker-compose.yml æ–‡ä»¶</h2>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost etc<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir registry-ui</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost etc<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd registry-ui/</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost etc<span class=\"token punctuation\">]</span><span class=\"token comment\"># touch docker-compose.yml</span></pre></td></tr></table></figure><p>æ‰“å¼€ docker-compose.yml æ–‡ä»¶ç¼–å†™ä¸Šé¢çš„ä»£ç </p>\n<h2 id=\"33é…ç½®dockerä¿¡ä»»åœ°å€\"><a class=\"anchor\" href=\"#33é…ç½®dockerä¿¡ä»»åœ°å€\">#</a> 3.3. é…ç½® Docker ä¿¡ä»»åœ°å€</h2>\n<p>æˆ‘ä»¬çš„ç§æœé‡‡ç”¨çš„æ˜¯ http åè®®ï¼Œé»˜è®¤ä¸è¢« Docker ä¿¡ä»»ï¼Œæ‰€ä»¥éœ€è¦åšä¸€ä¸ªé…ç½®ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># æ‰“å¼€è¦ä¿®æ”¹çš„æ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">vi</span> /etc/docker/daemon.json</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># æ·»åŠ å†…å®¹ï¼š</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token string\">\"insecure-registries\"</span>:<span class=\"token punctuation\">[</span><span class=\"token string\">\"http://192.168.150.101:8080\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># é‡åŠ è½½</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>systemctl daemon-reload</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># é‡å¯ docker</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>systemctl restart <span class=\"token function\">docker</span></pre></td></tr></table></figure><h2 id=\"34æ‰§è¡Œå‘½ä»¤åˆ›å»ºå®¹å™¨å¹¶æ‰§è¡Œ\"><a class=\"anchor\" href=\"#34æ‰§è¡Œå‘½ä»¤åˆ›å»ºå®¹å™¨å¹¶æ‰§è¡Œ\">#</a> 3.4. æ‰§è¡Œå‘½ä»¤åˆ›å»ºå®¹å™¨å¹¶æ‰§è¡Œ</h2>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost registry-ui<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker-compose up -d</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Creating network <span class=\"token string\">\"registry-ui_default\"</span> with the default driver</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Pulling registry <span class=\"token punctuation\">(</span>registry:<span class=\"token punctuation\">)</span><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>latest: Pulling from library/registry</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>96526aa774ef: Pull complete</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>cc37b24bb099: Pull complete</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>1d8a1aa97222: Pull complete</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>e3ff0af69d79: Pull complete</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>17443307a4fc: Pull complete</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Digest: sha256:12a6ddd56d2de5611ff0d9735ac0ac1d1e44073c7d042477329e589c46867e4e</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Status: Downloaded newer image <span class=\"token keyword\">for</span> registry:latest</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>Pulling ui <span class=\"token punctuation\">(</span>joxit/docker-registry-ui:static<span class=\"token punctuation\">)</span><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>static: Pulling from joxit/docker-registry-ui</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>540db60ca938: Pull complete</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>197dc8475a23: Pull complete</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>39ea657007e5: Pull complete</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>37afbf7d4c3d: Pull complete</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>0c01f42c3df7: Pull complete</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>d590d87c9181: Pull complete</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>3333c94ae44f: Pull complete</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>33d7cca6fc9f: Pull complete</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>076b2dd9bdd1: Pull complete</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>b70198f04ee7: Pull complete</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>1fb6c5acc953: Pull complete</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>Digest: sha256:b0657b6be748173583516e411bd71552e54cb7d5dda94964726297ce8774415c</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>Status: Downloaded newer image <span class=\"token keyword\">for</span> joxit/docker-registry-ui:static</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>Creating registry-ui_registry_1 <span class=\"token punctuation\">..</span>. <span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>Creating registry-ui_ui_1       <span class=\"token punctuation\">..</span>. <span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost registry-ui<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure>",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "Docker",
                "è®¡ç®—æœºå­¦ç§‘",
                "åŸºç¡€",
                "springcloud",
                "Docker"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Elasticsearch/springcloud-elasticsearch/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Elasticsearch/springcloud-elasticsearch/",
            "title": "ä¹ã€åˆ†å¸ƒå¼æœç´¢",
            "date_published": "2024-01-06T02:23:03.909Z",
            "content_html": "<h2 id=\"ä¹-åˆ†å¸ƒå¼æœç´¢\"><a class=\"anchor\" href=\"#ä¹-åˆ†å¸ƒå¼æœç´¢\">#</a> ä¹ã€åˆ†å¸ƒå¼æœç´¢ğŸ„</h2>\n<p>elasticsearch åŸºç¡€</p>\n<ul>\n<li>åˆå§‹ elasticsearch</li>\n<li>ç´¢å¼•åº“æ“ä½œ</li>\n<li>æ–‡æ¡£æ“ä½œ</li>\n<li>RestAPI</li>\n</ul>\n<h3 id=\"91-åˆå§‹elasticsearch\"><a class=\"anchor\" href=\"#91-åˆå§‹elasticsearch\">#</a> 9.1ã€åˆå§‹ elasticsearchğŸŒ³</h3>\n<ul>\n<li>äº†è§£ ES</li>\n<li>å€’æ’ç´¢å¼•</li>\n<li>es çš„ä¸€äº›æ¦‚å¿µ</li>\n<li>å®‰è£… esï¼Œkibana</li>\n</ul>\n<h4 id=\"911-ä»€ä¹ˆæ˜¯elasticsearch\"><a class=\"anchor\" href=\"#911-ä»€ä¹ˆæ˜¯elasticsearch\">#</a> 9.1.1ã€ä»€ä¹ˆæ˜¯ elasticsearchğŸŒ²</h4>\n<p>elasticsearch æ˜¯ä¸€æ¬¾éå¸¸å¼ºå¤§çš„å¼€æº<mark>æœç´¢å¼•æ“</mark>ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ä»<mark>æµ·é‡æ•°æ®ä¸­å¿«é€Ÿæ‰¾åˆ°éœ€è¦çš„å†…å®¹</mark>ã€‚</p>\n<p>elasticsearch ç»“åˆ kibanaï¼ŒLogstashï¼ŒBeatsï¼Œä¹Ÿå°±æ˜¯ elastic stack (ELK)ã€‚è¢«å¹¿æ³›åº”ç”¨åœ¨æ—¥å¿—æ•°æ®åˆ†æï¼Œå®æ—¶ç›‘æ§ç­‰é¢†åŸŸã€‚</p>\n<p>elasticsearch æ˜¯ elastic stack çš„æ ¸å¿ƒï¼Œè´Ÿè´£å­˜å‚¨ï¼Œæœç´¢ï¼Œåˆ†ææ•°æ®ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111754105.png\" alt=\"image-20231011175401979\" /></p>\n<p>Elasticsearch çš„åº•å±‚å®ç°å°±æ˜¯<mark> Lucene</mark> çš„æŠ€æœ¯</p>\n<p>Lucene æ˜¯ä¸€ä¸ª Java è¯­è¨€çš„<mark>æœç´¢å¼•æ“ç±»åº“</mark>ï¼Œæ˜¯ Apache å…¬å¸çš„é¡¶çº§é¡¹ç›®ï¼Œç”± Doug Cutting äº 1999 å¹´ç ”å‘ã€‚</p>\n<p>å®˜ç½‘åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9sdWNlbmUuYXBhY2hlLm9yZy8=\">https://lucene.apache.org/</span></p>\n<p>Lucene çš„ä¼˜åŠ¿ï¼š</p>\n<ul>\n<li>æ˜“æ‰©å±•</li>\n<li>é«˜æ€§èƒ½ (åŸºäºå€’æ’ç´¢å¼•)</li>\n</ul>\n<p>2004 å¹´ Shay Banon åŸºäº Lucene å¼€å‘äº† Compass</p>\n<p>2010 å¹´ Shay Banon é‡å†™äº† Compassï¼Œå–åä¸º Elasticsearch</p>\n<p>å®˜ç½‘åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9jbi8=\">https://www.elastic.co/cn/</span></p>\n<p>ç›®å‰æœ€æ–°çš„ç‰ˆæœ¬æ˜¯ï¼š7.12.1</p>\n<p>ç›¸æ¯”ä¸ luceneï¼Œelasticsearch å…·å¤‡ä¸‹åˆ—ä¼˜åŠ¿ï¼š</p>\n<ul>\n<li>æ”¯æŒåˆ†å¸ƒå¼ï¼Œå¯æ°´å¹³æ‰©å±•</li>\n<li>æä¾› Restful æ¥å£ï¼Œå¯è¢«ä»»ä½•è¯­è¨€è°ƒç”¨</li>\n</ul>\n<p><strong>ä¸ºä»€ä¹ˆå­¦ä¹  elasticsearch?</strong>ã€‚</p>\n<p>æœç´¢å¼•æ“æŠ€æœ¯æ’åï¼š</p>\n<p>1ã€Elasticsearchï¼šå¼€æºçš„åˆ†å¸ƒå¼æœç´¢å¼•æ“</p>\n<p>2ã€Splunkï¼šå•†ä¸šé¡¹ç›®</p>\n<p>3ã€Solrï¼šApache çš„å¼€æºæœç´¢å¼•æ“</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111923929.png\" alt=\"image-20231011192322393\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>ä»€ä¹ˆæ˜¯ elasticsearch?</p>\n<ul>\n<li>ä¸€ä¸ªå¼€æºçš„<mark>åˆ†å¸ƒå¼æœç´¢å¼•æ“</mark>ï¼Œå¯ä»¥ç”¨æ¥å®ç°æœç´¢ï¼Œæ—¥å¿—ç»Ÿè®¡ï¼Œåˆ†æï¼Œç³»ç»Ÿç›‘æ§ç­‰åŠŸèƒ½</li>\n</ul>\n<p>ä»€ä¹ˆæ˜¯ elastic stack (LEK)ï¼Ÿ</p>\n<ul>\n<li>æ˜¯ä»¥ elasticsearch ä¸ºæ ¸å¿ƒçš„æŠ€æœ¯æ ˆï¼ŒåŒ…æ‹¬ beatsï¼ŒLogstashï¼Œkibanaï¼Œelasticsearch</li>\n</ul>\n<p>ä»€ä¹ˆæ˜¯ Lucene?</p>\n<ul>\n<li>æ˜¯ Apache çš„å¼€æºæœç´¢å¼•æ“ç±»åº“ï¼Œæä¾›äº†æœç´¢å¼•æ“çš„æ ¸å¿ƒ API</li>\n</ul>\n</blockquote>\n<h3 id=\"92-æ­£å‘ç´¢å¼•å’Œå€’æ’ç´¢å¼•\"><a class=\"anchor\" href=\"#92-æ­£å‘ç´¢å¼•å’Œå€’æ’ç´¢å¼•\">#</a> 9.2ã€æ­£å‘ç´¢å¼•å’Œå€’æ’ç´¢å¼•ğŸŒ³</h3>\n<p>ä¼ ç»Ÿæ•°æ®åº“ (å¦‚ MySQL) é‡‡ç”¨æ­£å‘ç´¢å¼•ï¼Œä¾‹å¦‚ç»™ä¸‹è¡¨ (tb_goods) ä¸­çš„ id åˆ›å»ºç´¢å¼•ï¼š</p>\n<p>æ­£å‘ç´¢å¼•ï¼šåšå±€éƒ¨å†…éƒ¨æ£€ç´¢çš„æ—¶å€™æ€§èƒ½æ¯”è¾ƒå·®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111933421.png\" alt=\"image-20231011193327307\" /></p>\n<p>elasticsearch é‡‡ç”¨å€’æ’ç´¢å¼•ï¼š</p>\n<ul>\n<li>æ–‡æ¡£ (document)ï¼šæ¯æ¡æ•°æ®å°±æ˜¯ä¸€ä¸ªæ–‡æ¡£\n<ul>\n<li>ä»£è¡¨çš„å°±æ˜¯æ•°æ®ï¼Œæ¯ä¸€æ¡æ•°æ®å°±æ˜¯ä¸€ä¸ªæ–‡æ¡£</li>\n</ul>\n</li>\n<li>è¯æ¡ (term)ï¼šæ–‡æ¡£æŒ‰ç…§è¯­ä¹‰åˆ†æˆçš„è¯è¯­\n<ul>\n<li>å¦‚æœæ˜¯ä¸­æ–‡å°±æŒ‰ç…§ä¸­æ–‡çš„è¯­ä¹‰è¿›è¡Œåˆ†è¯</li>\n</ul>\n</li>\n</ul>\n<p>å€’æ’ç´¢å¼•ï¼Œä¼šå½¢æˆä¸€ä¸ª<mark>æ–°çš„è¡¨</mark>ã€‚è¿™å¼ <mark>è¡¨é‡Œé¢æœ‰ä¸¤ä¸ªå­—æ®µ</mark>ï¼Œä¸€ä¸ªå­—æ®µæ˜¯<mark>è¯æ¡</mark>å¦ä¸€ä¸ªæ˜¯<mark>æ–‡æ¡£ id</mark>ã€‚</p>\n<p>å€’æ’ç´¢å¼•ï¼Œå®ƒåœ¨å­˜å‚¨æ—¶ä¼šå…ˆæŠŠæ–‡æ¡£ä¸­çš„<mark>å†…å®¹åˆ†æˆè¯æ¡å»å­˜å‚¨</mark>ã€‚æ¯”æ–¹è¯´æˆ‘æ‹¿åˆ°äº†ç¬¬ä¸€æ¡æ•°æ®é‚£æˆ‘è¦å¯¹æ ‡é¢˜åˆ›å»ºå€’æ’ç´¢å¼•ï¼Œé‚£ä¹ˆæˆ‘å°±æ¥å§æ ‡é¢˜å†…å®¹åšä¸ªåˆ†è¯å¾—åˆ°ä¸¤ä¸ªè¯è¯­å°ç±³å’Œæ‰‹æœºï¼Œç„¶åæŠŠæ¯ä¸ªè¿™ä¸¤ä¸ªè¯è¯­å­˜åˆ°è¯æ¡é‡Œï¼Œç„¶ååé¢è®°å½•å®ƒçš„æ–‡æ¡£ idã€‚<mark>é‡å¤çš„è¯è¯­ä¸ä¼šå­˜å…¥è¯æ¡è€Œæ˜¯åœ¨å·²å­˜åœ¨çš„è¯æ¡åé¢è¿½åŠ ä¸Šè¿™ä¸ªé‡å¤çš„è¯è¯­çš„ id</mark>.</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111945438.gif\" alt=\"test\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111953084.png\" alt=\"image-20231011195333829\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>:</p>\n<p>ä»€ä¹ˆæ˜¯æ–‡æ¡£å’Œè¯æ¡ï¼Ÿ</p>\n<ul>\n<li>æ¯ä¸€æ¡æ•°æ®å°±æ˜¯ä¸€ä¸ªæ–‡æ¡£</li>\n<li>å¯¹æ–‡æ¡£ä¸­çš„å†…å®¹åˆ†è¯ï¼Œå¾—åˆ°çš„è¯è¯­å°±æ˜¯è¯æ¡</li>\n</ul>\n<p>ä»€ä¹ˆæ˜¯æ­£å‘ç´¢å¼•ï¼Ÿ</p>\n<ul>\n<li>åŸºäºæ–‡æ¡£ id åˆ›å»ºç´¢å¼•ã€‚æŸ¥è¯¢è¯æ¡æ—¶å¿…é¡»å…ˆæ‰¾åˆ°æ–‡æ¡£ï¼Œè€Œååˆ¤æ–­æ˜¯å¦åŒ…å«è¯æ¡</li>\n</ul>\n<p>ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•ï¼Ÿ</p>\n<ul>\n<li>å¯¹æ–‡æ¡£å†…å®¹åˆ†è¯ï¼Œå¯¹è¯æ¡åˆ›å»ºç´¢å¼•ï¼Œå¹¶è®°å½•è¯æ¡æ‰€åœ¨æ–‡æ¡£çš„ä¿¡æ¯ã€‚æŸ¥è¯¢æ—¶å…ˆæ ¹æ®è¯æ¡æŸ¥è¯¢åˆ°æ–‡æ¡£ idï¼Œè€Œåè·å–åˆ°æ–‡æ¡£</li>\n</ul>\n</blockquote>\n<h3 id=\"93-æ–‡æ¡£\"><a class=\"anchor\" href=\"#93-æ–‡æ¡£\">#</a> 9.3ã€æ–‡æ¡£ğŸŒ³</h3>\n<p>elasticsearch æ˜¯é¢å‘æ–‡æ¡£å­˜å‚¨çš„ï¼Œå¯ä»¥æ˜¯æ•°æ®åº“ä¸­çš„ä¸€æ¡å•†å“æ•°æ®ï¼Œä¸€ä¸ªè®¢å•ä¿¡æ¯ã€‚</p>\n<p>æ–‡æ¡£æ•°æ®ä¼šè¢«åºåˆ—åŒ–ä¸º json æ ¼å¼åå­˜å‚¨åœ¨ elasticsearch ä¸­ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112001435.png\" alt=\"image-20231011200117293\" /></p>\n<h3 id=\"94-ç´¢å¼•-index\"><a class=\"anchor\" href=\"#94-ç´¢å¼•-index\">#</a> 9.4ã€ç´¢å¼• (index)ğŸŒ³</h3>\n<ul>\n<li>ç´¢å¼• (index)ï¼šç›¸åŒç±»å‹çš„æ–‡æ¡£çš„é›†åˆ</li>\n<li>æ˜ å°„ (mapping)ï¼šç´¢å¼•ä¸­æ–‡æ¡£çš„å­—æ®µçº¦æŸä¿¡æ¯ï¼Œç±»ä¼¼è¡¨çš„ç»“æ„çº¦æŸ</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112003417.png\" alt=\"image-20231011200324370\" /></p>\n<h3 id=\"95-æ¦‚å¿µå¯¹æ¯”\"><a class=\"anchor\" href=\"#95-æ¦‚å¿µå¯¹æ¯”\">#</a> 9.5ã€æ¦‚å¿µå¯¹æ¯”ğŸŒ³</h3>\n<table>\n<thead>\n<tr>\n<th>MySQL</th>\n<th>Elasticsearch</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Table</td>\n<td>Index</td>\n<td>ç´¢å¼• (index)ï¼Œå°±æ˜¯æ–‡æ¡£çš„é›†åˆï¼Œç±»ä¼¼æ•°æ®åº“çš„è¡¨ (table)</td>\n</tr>\n<tr>\n<td>Row</td>\n<td>Document</td>\n<td>æ–‡æ¡£ (document)ï¼Œå°±æ˜¯ä¸€æ¡æ¡çš„æ•°æ®ï¼Œç±»ä¼¼æ•°æ®åº“ä¸­çš„è¡Œ (Row)ï¼Œæ–‡æ¡£éƒ½æ˜¯ JSON æ ¼å¼</td>\n</tr>\n<tr>\n<td>Column</td>\n<td>Field</td>\n<td>å­—æ®µ (Field)ï¼Œå°±æ˜¯ JSON æ–‡æ¡£ä¸­çš„å­—æ®µï¼Œç±»ä¼¼æ•°æ®åº“ä¸­çš„åˆ— (Column)</td>\n</tr>\n<tr>\n<td>Schema</td>\n<td>Mapping</td>\n<td>Mapping (æ˜ å°„) æ˜¯ç´¢å¼•ä¸­æ–‡æ¡£çš„çº¦æŸï¼Œä¾‹å¦‚å­—æ®µç±»å‹çº¦æŸã€‚ç±»ä¼¼æ•°æ®åº“çš„è¡¨ç»“æ„ (Schema)</td>\n</tr>\n<tr>\n<td>SQL</td>\n<td>DSL</td>\n<td>DSL æ˜¯ elasticsearch æä¾›çš„ JSON é£æ ¼çš„è¯·æ±‚è¯­å¥ï¼Œç”¨æ¥æ“ä½œ elasticsearchï¼Œå®ç° CRUD</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"95-æ¶æ„\"><a class=\"anchor\" href=\"#95-æ¶æ„\">#</a> 9.5ã€æ¶æ„ğŸŒ³</h3>\n<p>MySQLï¼šæ“…é•¿äº‹åŠ¡ç±»å‹æ“ä½œï¼Œå¯ä»¥ç¡®ä¿æ•°æ®çš„å®‰å…¨å’Œä¸€è‡´æ€§</p>\n<p>Elasticsearchï¼šæ“…é•¿æµ·é‡æ•°æ®çš„æœç´¢ï¼Œåˆ†æï¼Œè®¡ç®—</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112013859.png\" alt=\"image-20231011201341793\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>æ–‡æ¡£ï¼šä¸€æ¡æ•°æ®å°±æ˜¯ä¸€ä¸ªæ–‡æ¡£ï¼Œes ä¸­æ˜¯ json æ ¼å¼</p>\n<p>å­—æ®µï¼šjson æ–‡æ¡£ä¸­çš„å­—æ®µ</p>\n<p>ç´¢å¼•ï¼šåŒç±»å‹æ–‡æ¡£çš„é›†åˆ</p>\n<p>æ˜ å°„ï¼šç´¢å¼•ä¸­æ–‡æ¡£çš„çº¦æŸï¼Œæ¯”å¦‚å­—æ®µåç§°ï¼Œç±»å‹</p>\n<p>elasticsearch ä¸æ•°æ®åº“çš„å…³ç³»ï¼š</p>\n<ul>\n<li>æ•°æ®åº“è´Ÿè´£äº‹åŠ¡ç±»å‹æ“ä½œ</li>\n<li>elasticsearch è´Ÿè´£æµ·é‡æ•°æ®çš„æœç´¢ï¼Œåˆ†æï¼Œè®¡ç®—</li>\n</ul>\n</blockquote>\n<h3 id=\"96-å®‰è£…å’Œéƒ¨ç½²\"><a class=\"anchor\" href=\"#96-å®‰è£…å’Œéƒ¨ç½²\">#</a> 9.6ã€å®‰è£…å’Œéƒ¨ç½²ğŸŒ³</h3>\n<p><a href=\"./Elasearch/%E5%AE%89%E8%A3%85elasticsearch.md\">æŸ¥çœ‹ elaticsearch å®‰è£…å’Œéƒ¨ç½²</a>ã€‚</p>\n<h3 id=\"97-åˆ†è¯å™¨\"><a class=\"anchor\" href=\"#97-åˆ†è¯å™¨\">#</a> 9.7ã€åˆ†è¯å™¨ğŸŒ³</h3>\n<p>es åœ¨åˆ›å»ºå€’æ’ç´¢å¼•æ—¶éœ€è¦å¯¹æ–‡æ¡£è¿›è¡Œåˆ†è¯ï¼›åœ¨æœç´¢æ—¶ï¼Œéœ€è¦å¯¹ç”¨æˆ·è¾“å…¥å†…å®¹åˆ†è¯ã€‚ä½†é»˜è®¤çš„åˆ†è¯è§„åˆ™å¯¹ä¸­æ–‡å¤„ç†å¹¶ä¸å‹å¥½ã€‚æˆ‘ä»¬åœ¨ kibana çš„ DevTools ä¸­æµ‹è¯•ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310112105308.png\" alt=\"image-20231011210532721\" /></p>\n<p>è¯­æ³•è¯´æ˜ï¼š</p>\n<ul>\n<li>POSTï¼šè¯·æ±‚æ–¹å¼</li>\n<li>/_analyzeï¼šè¯·æ±‚è·¯å¾„ï¼Œè¿™é‡Œçœç•¥äº† http://192.168.150.101:9200ï¼Œæœ‰ kibana å¸®æˆ‘ä»¬è¡¥å……</li>\n<li>è¯·æ±‚å‚æ•°ï¼Œjson é£æ ¼ï¼š\n<ul>\n<li>analyzerï¼šåˆ†è¯å™¨ç±»å‹ï¼Œè¿™é‡Œæ˜¯é»˜è®¤çš„ standard åˆ†è¯å™¨</li>\n<li>textï¼šè¦åˆ†è¯çš„å†…å®¹</li>\n</ul>\n</li>\n</ul>\n<p>kibana ä¸­æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p>\n<pre><code>&#123;\n  &quot;tokens&quot; : [\n    &#123;\n      &quot;token&quot; : &quot;é»‘&quot;,\n      &quot;start_offset&quot; : 0,\n      &quot;end_offset&quot; : 1,\n      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,\n      &quot;position&quot; : 0\n    &#125;,\n    &#123;\n      &quot;token&quot; : &quot;é©¬&quot;,\n      &quot;start_offset&quot; : 1,\n      &quot;end_offset&quot; : 2,\n      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,\n      &quot;position&quot; : 1\n    &#125;,\n    &#123;\n      &quot;token&quot; : &quot;ç¨‹&quot;,\n      &quot;start_offset&quot; : 2,\n      &quot;end_offset&quot; : 3,\n      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,\n      &quot;position&quot; : 2\n    &#125;,\n    &#123;\n      &quot;token&quot; : &quot;åº&quot;,\n      &quot;start_offset&quot; : 3,\n      &quot;end_offset&quot; : 4,\n      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,\n      &quot;position&quot; : 3\n    &#125;,\n    &#123;\n      &quot;token&quot; : &quot;å‘˜&quot;,\n      &quot;start_offset&quot; : 4,\n      &quot;end_offset&quot; : 5,\n      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,\n      &quot;position&quot; : 4\n    &#125;,\n    &#123;\n      &quot;token&quot; : &quot;å­¦&quot;,\n      &quot;start_offset&quot; : 5,\n      &quot;end_offset&quot; : 6,\n      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,\n      &quot;position&quot; : 5\n    &#125;,\n    &#123;\n      &quot;token&quot; : &quot;ä¹ &quot;,\n      &quot;start_offset&quot; : 6,\n      &quot;end_offset&quot; : 7,\n      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,\n      &quot;position&quot; : 6\n    &#125;,\n    &#123;\n      &quot;token&quot; : &quot;java&quot;,\n      &quot;start_offset&quot; : 7,\n      &quot;end_offset&quot; : 11,\n      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,\n      &quot;position&quot; : 7\n    &#125;,\n    &#123;\n      &quot;token&quot; : &quot;å¤ª&quot;,\n      &quot;start_offset&quot; : 11,\n      &quot;end_offset&quot; : 12,\n      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,\n      &quot;position&quot; : 8\n    &#125;,\n    &#123;\n      &quot;token&quot; : &quot;æ£’&quot;,\n      &quot;start_offset&quot; : 12,\n      &quot;end_offset&quot; : 13,\n      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,\n      &quot;position&quot; : 9\n    &#125;,\n    &#123;\n      &quot;token&quot; : &quot;äº†&quot;,\n      &quot;start_offset&quot; : 13,\n      &quot;end_offset&quot; : 14,\n      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,\n      &quot;position&quot; : 10\n    &#125;\n  ]\n&#125;\n</code></pre>\n<p>å¯ä»¥çœ‹åˆ°å®ƒå¯¹è‹±æ–‡çš„åˆ†è¯æŒºå¥½çš„ä½†æ˜¯å¯¹ä¸­æ–‡çš„åˆ†è¯å´ä¸å¥½</p>\n<p>è§£å†³åŠæ³•ï¼š</p>\n<p>å¤„ç†ä¸­æ–‡åˆ†è¯ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨ IK åˆ†è¯å™¨ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21lZGNsL2VsYXN0aWNzZWFyY2gtYW5hbHlzaXMtaWs=\">https://github.com/medcl/elasticsearch-analysis-ik</span></p>\n<p>å®‰è£…å’Œä½¿ç”¨ IK åˆ†è¯å™¨ï¼Œå‚è€ƒæ–‡ç« ï¼š<a href=\"./Elasearch/%E5%AE%89%E8%A3%85elasticsearch.md\">æŸ¥çœ‹ IK å®‰è£…</a>.</p>\n<h3 id=\"98-ç´¢å¼•åº“æ“ä½œ\"><a class=\"anchor\" href=\"#98-ç´¢å¼•åº“æ“ä½œ\">#</a> 9.8ã€ç´¢å¼•åº“æ“ä½œğŸŒ³</h3>\n<ul>\n<li>mapping æ˜ å°„å±æ€§</li>\n<li>ç´¢å¼•åº“çš„ CRUD</li>\n</ul>\n<h4 id=\"981-mappingå±æ€§\"><a class=\"anchor\" href=\"#981-mappingå±æ€§\">#</a> 9.8.1ã€mapping å±æ€§ğŸŒ²</h4>\n<p>mapping æ˜¯å¯¹ç´¢å¼•åº“ä¸­æ–‡æ¡£çš„<mark>çº¦æŸ</mark>ï¼Œå¸¸è§çš„ mapping å±æ€§åŒ…æ‹¬ï¼š</p>\n<ul>\n<li>typeï¼šå­—æ®µæ•°æ®ç±»å‹ï¼Œå¸¸è§çš„ç®€å•ç±»å‹æœ‰\n<ul>\n<li>å­—ç¬¦ä¸²ï¼štext (å¯åˆ†è¯çš„æ–‡æœ¬)ï¼Œkeyword (ç²¾ç¡®å€¼ï¼Œä¾‹å¦‚ï¼šå“ç‰Œï¼Œå›½å®¶ï¼Œip åœ°å€)</li>\n<li>æ•°å€¼ï¼šlongï¼Œintegerï¼Œshortï¼Œbyteï¼Œdoubleï¼Œfloat</li>\n<li>å¸ƒå°”ï¼šboolean</li>\n<li>æ—¥æœŸï¼šdate</li>\n<li>å¯¹è±¡ï¼šobject</li>\n</ul>\n</li>\n<li>åœ¨ elasticsearch ä¸­æ˜¯æ²¡æœ‰æ•°ç»„è¿™ç§ç±»å‹çš„ï¼Œä½†æ˜¯å®ƒå…è®¸æŸä¸€ä¸ªå­—æ®µæœ‰å¤šä¸ªå€¼</li>\n<li>indexï¼šæ˜¯å¦åˆ›å»ºå€’æ’ç´¢å¼•ï¼Œé»˜è®¤ä¸º true (å…¨åˆ›å»ºå€’æ’ç´¢å¼•)</li>\n<li>analyzerï¼šä½¿ç”¨å“ªç§åˆ†è¯å™¨ (ç»“åˆ text ä½¿ç”¨é™¤äº† text ä»¥å¤–å…¶å®ƒéƒ½ä¸éœ€è¦ç”¨)\n<ul>\n<li>å€¼ï¼šåˆ†è¯å™¨åç§°ï¼šik_smart æˆ–è€… ik_max_word</li>\n</ul>\n</li>\n<li>propertiesï¼šè¯¥å­—æ®µçš„å­å­—æ®µ\n<ul>\n<li>name æœ‰ä¸¤ä¸ªå­å­—æ®µå¯ä»¥ä½¿ç”¨ properties æ¥æŒ‡å®šå­å­—æ®µäº†</li>\n</ul>\n</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310120907321.png\" alt=\"image-20231012090710123\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>mapping å¸¸è§å±æ€§æœ‰å“ªäº›ï¼Ÿ</p>\n<ul>\n<li>typeï¼šæ•°æ®ç±»å‹</li>\n<li>indexï¼šæ˜¯å¦ç´¢å¼•</li>\n<li>analyzerï¼šåˆ†è¯å™¨</li>\n<li>propertiesï¼šå­å­—æ®µ</li>\n</ul>\n<p>type å¸¸è§çš„æœ‰å“ªäº›ï¼Ÿ</p>\n<ul>\n<li>å­—ç¬¦ä¸²ï¼štextï¼Œkeyword</li>\n<li>æ•°å­—ï¼šlongï¼Œintegerï¼Œshortï¼Œbyteï¼Œdoubleï¼Œfloat</li>\n<li>å¸ƒå°”ï¼šboolean</li>\n<li>æ—¥æœŸï¼šdate</li>\n<li>å¯¹è±¡ object</li>\n</ul>\n</blockquote>\n<h4 id=\"982-åˆ›å»ºç´¢å¼•åº“\"><a class=\"anchor\" href=\"#982-åˆ›å»ºç´¢å¼•åº“\">#</a> 9.8.2ã€åˆ›å»ºç´¢å¼•åº“ğŸŒ²</h4>\n<p>ES ä¸­é€šè¿‡ Restful è¯·æ±‚æ“ä½œç´¢å¼•åº“ï¼Œæ–‡æ¡£ã€‚è¯·æ±‚å†…å®¹ç”¨ DSL è¯­å¥æ¥è¡¨ç¤ºã€‚åˆ›å»ºç´¢å¼•åº“å’Œ mapping çš„ DSL è¯­æ³•å¦‚ä¸‹ï¼š</p>\n<p>PUT æ·»åŠ ç´¢å¼•</p>\n<p>info ç”¨æˆ·ä¿¡æ¯å†…å®¹å¾ˆé•¿æ‰€ä»¥æ˜¯å¯åˆ†è¯çš„ textï¼Œåˆ†è¯å™¨æ˜¯ ik_smartã€‚email é‚®ç®± æ²¡æœ‰åˆ†è¯çš„å¿…è¦ï¼Œå› ä¸ºå®ƒä½œä¸ºä¸€ä¸ªæ•´ä½“æ‰æœ‰æ„ä¹‰æ‰€ä»¥ä½¿ç”¨ keyword ä¸è¿›è¡Œåˆ†è¯ï¼Œå› æ­¤ä¸è¿›è¡Œåˆ†è¯ä¹Ÿå°±ä¸éœ€è¦ analyzer äº†ï¼Œä½¿ç”¨ index=false è¡¨ç¤ºè¿™ä¸ªå­—æ®µä¸å‚ä¸åˆ›å»ºå€’æ’ç´¢å¼•ã€‚name åç§°ï¼Œå¸¦æœ‰åµŒå¥—ï¼Œå®ƒæœ‰æŒ‡å®šçš„ propertiesï¼Œé‡Œé¢è¿˜æœ‰ä¸€ä¸ª firstNameã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310120918101.png\" alt=\"image-20231012091855829\" /></p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>PUT /dkx</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"mappings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"info\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ik_smart\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token property\">\"email\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"object\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>          <span class=\"token property\">\"firstName\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>          <span class=\"token property\">\"lastName\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"acknowledged\"</span> <span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"shards_acknowledged\"</span> <span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"index\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"dkx\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åˆ›å»ºæˆåŠŸï¼</p>\n<h4 id=\"983-æŸ¥çœ‹åˆ é™¤ç´¢å¼•åº“\"><a class=\"anchor\" href=\"#983-æŸ¥çœ‹åˆ é™¤ç´¢å¼•åº“\">#</a> 9.8.3ã€æŸ¥çœ‹ï¼Œåˆ é™¤ç´¢å¼•åº“ğŸŒ²</h4>\n<p>æŸ¥çœ‹ç´¢å¼•åº“è¯­æ³•ï¼š</p>\n<pre><code>GET /ç´¢å¼•åº“å\n</code></pre>\n<p>ç¤ºä¾‹ï¼š</p>\n<pre><code>GET /dkx\n</code></pre>\n<p>åˆ é™¤ç´¢å¼•åº“çš„è¯­æ³•ï¼š</p>\n<pre><code>DELETE /ç´¢å¼•åº“å\n</code></pre>\n<p>ç¤ºä¾‹ï¼š</p>\n<pre><code>DELETE /dkx\n</code></pre>\n<h4 id=\"984-ä¿®æ”¹ç´¢å¼•åº“\"><a class=\"anchor\" href=\"#984-ä¿®æ”¹ç´¢å¼•åº“\">#</a> 9.8.4ã€ä¿®æ”¹ç´¢å¼•åº“ğŸŒ²</h4>\n<p>äº‹å®ä¸Šåœ¨ ES ä¸­ç´¢å¼•åº“æ˜¯ä¸å…è®¸ä¿®æ”¹çš„</p>\n<p>å› ä¸ºç´¢å¼•åº“åˆ›å»ºå®Œäº†ä»¥åå®ƒçš„æ•°æ®ç»“æ„ä¹Ÿå°±æ˜¯ mapping æ˜ å°„éƒ½å·²ç»å®šä¹‰å¥½äº†ã€‚ES ä¼šåŸºäºè¿™äº› mapping å»åˆ›å»ºå€’æ’ç´¢å¼•ï¼Œå¦‚æœå»ä¿®æ”¹æŸä¸€ä¸ªå­—æ®µå°±ä¼šå¯¼è‡´æ•´ä½“å€’æ’ç´¢å¼•å½»åº•å¤±æ•ˆï¼Œè¿™æ ·å¸¦æ¥çš„å½±å“æ˜¯éå¸¸å¤§çš„ã€‚</p>\n<p>æ‰€ä»¥åœ¨ ES ä¸­æ˜¯ç¦æ­¢ä¿®æ”¹ç´¢å¼•åº“çš„ï¼</p>\n<p>ç´¢å¼•åº“å’Œ mapping ä¸€æ—¦åˆ›å»ºæ— æ³•ä¿®æ”¹ï¼Œä½†æ˜¯å¯ä»¥æ·»åŠ æ–°çš„å­—æ®µï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>PUT /ç´¢å¼•åº“å/_mapping</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token comment\">// è¿™é‡Œå¿…é¡»æ˜¯æ–°çš„å­—æ®µåä¸èƒ½å’Œå­˜åœ¨çš„é‡å¤å¦åˆ™å®ƒä»¥ä¸ºä½ è¦ä¿®æ”¹å°±æŠ¥é”™</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"æ–°å­—æ®µå\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>         <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"integer\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>PUT /dkx/_mapping</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token property\">\"age\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>         type<span class=\"token operator\">:</span> <span class=\"token string\">\"integer\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ¡ˆä¾‹æ¼”ç¤ºå›¾ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310121021571.gif\" alt=\"test\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>ç´¢å¼•åº“æ“ä½œæœ‰å“ªäº›ï¼Ÿ</p>\n<ul>\n<li>åˆ›å»ºç´¢å¼•åº“ï¼šPUT / ç´¢å¼•åº“å</li>\n<li>æŸ¥è¯¢ç´¢å¼•åº“ï¼šGET / ç´¢å¼•åº“å</li>\n<li>åˆ é™¤ç´¢å¼•åº“ï¼š DELETE / ç´¢å¼•åº“å</li>\n<li>æ·»åŠ å­—æ®µï¼šPUT / ç´¢å¼•åº“å /_mapping</li>\n</ul>\n</blockquote>\n<h4 id=\"985-æ–‡æ¡£æ“ä½œ\"><a class=\"anchor\" href=\"#985-æ–‡æ¡£æ“ä½œ\">#</a> 9.8.5ã€æ–‡æ¡£æ“ä½œğŸŒ²</h4>\n<ul>\n<li>æ–°å¢æ–‡æ¡£</li>\n<li>æŸ¥è¯¢æ–‡æ¡£</li>\n<li>åˆ é™¤æ–‡æ¡£</li>\n<li>ä¿®æ”¹æ–‡æ¡£</li>\n</ul>\n<h5 id=\"9851-æ·»åŠ æ–‡æ¡£\"><a class=\"anchor\" href=\"#9851-æ·»åŠ æ–‡æ¡£\">#</a> 9.8.5.1ã€æ·»åŠ æ–‡æ¡£ğŸŒ´</h5>\n<p>æ–°å¢æ–‡æ¡£çš„ DSL è¯­æ³•å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>POST /ç´¢å¼•åº“å/_doc/æ–‡æ¡£id</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"å­—æ®µ1\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"å€¼1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token property\">\"å­—æ®µ2\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"å€¼2\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token property\">\"å­—æ®µ3\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token property\">\"å­å±æ€§1\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"å€¼3\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token property\">\"å­å±æ€§2\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"å€¼4\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">// ...</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310121028570.png\" alt=\"image-20231012102808294\" /></p>\n<h5 id=\"9852-æŸ¥çœ‹åˆ é™¤æ–‡æ¡£\"><a class=\"anchor\" href=\"#9852-æŸ¥çœ‹åˆ é™¤æ–‡æ¡£\">#</a> 9.8.5.2ã€æŸ¥çœ‹ï¼Œåˆ é™¤æ–‡æ¡£ğŸŒ´</h5>\n<p>æŸ¥çœ‹æ–‡æ¡£è¯­æ³•ï¼š</p>\n<pre><code>GET /ç´¢å¼•åº“å/_doc/æ–‡æ¡£id\n</code></pre>\n<p>ç¤ºä¾‹ï¼š</p>\n<pre><code>GET /dkx/_doc/1\n</code></pre>\n<p>åˆ é™¤æ–‡æ¡£çš„è¯­æ³•ï¼š</p>\n<pre><code>DELETE /ç´¢å¼•åº“å/_doc/æ–‡æ¡£id\n</code></pre>\n<p>ç¤ºä¾‹ï¼š</p>\n<pre><code>DELETE /dkx/_doc/1\n</code></pre>\n<h5 id=\"9853-ä¿®æ”¹æ–‡æ¡£\"><a class=\"anchor\" href=\"#9853-ä¿®æ”¹æ–‡æ¡£\">#</a> 9.8.5.3ã€ä¿®æ”¹æ–‡æ¡£ğŸŒ´</h5>\n<p>æ–¹å¼ä¸€ï¼šå…¨é‡ä¿®æ”¹ï¼Œä¼šåˆ é™¤æ—§æ–‡æ¡£ï¼Œæ·»åŠ æ–°æ–‡æ¡£ï¼Œå¦‚æœæ²¡æœ‰æ—§æ–‡æ¡£å°±æ˜¯æ–°å¢</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>PUT /ç´¢å¼•åº“å/_doc/æ–‡æ¡£id</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"å­—æ®µ1\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"å€¼1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token property\">\"å­—æ®µ2\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"å€¼2\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token comment\">//... ç•¥</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310121039009.png\" alt=\"image-20231012103906432\" /></p>\n<p>æ–¹å¼äºŒï¼šå¢é‡ä¿®æ”¹ï¼Œä¿®æ”¹æŒ‡å®šå­—æ®µå€¼</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>POST /ç´¢å¼•åº“å/_update/æ–‡æ¡£id</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"doc\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token property\">\"å­—æ®µå\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"æ–°çš„å€¼\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310121042126.png\" alt=\"image-20231012104219010\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>æ–‡æ¡£æ“ä½œæœ‰å“ªäº›ï¼Ÿ</p>\n<ul>\n<li jsonæ–‡æ¡£=\"\">åˆ›å»ºæ–‡æ¡£ï¼šPOST / ç´¢å¼•åº“å /_cod/ æ–‡æ¡£ id</li>\n<li>æŸ¥è¯¢æ–‡æ¡£ï¼šGET / ç´¢å¼•åº“å /_doc/ æ–‡æ¡£ id</li>\n<li>åˆ é™¤æ–‡æ¡£ï¼šDELETE / ç´¢å¼•åº“å /_doc/ æ–‡æ¡£ id</li>\n<li>ä¿®æ”¹æ–‡æ¡£ï¼š\n<ul>\n<li jsonæ–‡æ¡£=\"\">å…¨é‡ä¿®æ”¹ï¼šPUT / ç´¢å¼•åº“å /_doc/ æ–‡æ¡£ id</li>\n<li>å¢é‡ä¿®æ”¹ï¼šPOST / ç´¢å¼•åº“å /_update/ æ–‡æ¡£ id {â€œdocâ€: {å­—æ®µ}}</li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<h4 id=\"986-restclientæ“ä½œç´¢å¼•åº“\"><a class=\"anchor\" href=\"#986-restclientæ“ä½œç´¢å¼•åº“\">#</a> 9.8.6ã€RestClient æ“ä½œç´¢å¼•åº“ğŸŒ²</h4>\n<ul>\n<li>åˆ›å»ºç´¢å¼•åº“</li>\n<li>åˆ é™¤ç´¢å¼•åº“</li>\n<li>åˆ¤æ–­ç´¢å¼•åº“æ˜¯å¦å­˜åœ¨</li>\n</ul>\n<h5 id=\"9861-ä»€ä¹ˆæ˜¯restclient\"><a class=\"anchor\" href=\"#9861-ä»€ä¹ˆæ˜¯restclient\">#</a> 9.8.6.1ã€ä»€ä¹ˆæ˜¯ RestClientğŸŒ´</h5>\n<p>ES å®˜æ–¹æä¾›äº†å„ç§ä¸åŒè¯­è¨€çš„å®¢æˆ·ç«¯ï¼Œç”¨æ¥æ“ä½œ ESã€‚è¿™äº›å®¢æˆ·ç«¯çš„æœ¬è´¨å°±æ˜¯ç»„è£… DSL è¯­å¥ï¼Œé€šè¿‡ http è¯·æ±‚å‘é€ç»™ ESã€‚å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9ndWlkZS9lbi9lbGFzdGljc2VhcmNoL2NsaWVudC9pbmRleC5odG1s\">https://www.elastic.co/guide/en/elasticsearch/client/index.html</span></p>\n<h5 id=\"9862-æ¡ˆä¾‹åˆ©ç”¨javarestclientå®ç°åˆ›å»ºåˆ é™¤ç´¢å¼•åº“åˆ¤æ–­ç´¢å¼•åº“æ˜¯å¦å­˜åœ¨\"><a class=\"anchor\" href=\"#9862-æ¡ˆä¾‹åˆ©ç”¨javarestclientå®ç°åˆ›å»ºåˆ é™¤ç´¢å¼•åº“åˆ¤æ–­ç´¢å¼•åº“æ˜¯å¦å­˜åœ¨\">#</a> 9.8.6.2ã€æ¡ˆä¾‹ï¼Œåˆ©ç”¨ JavaRestClient å®ç°åˆ›å»ºï¼Œåˆ é™¤ç´¢å¼•åº“ï¼Œåˆ¤æ–­ç´¢å¼•åº“æ˜¯å¦å­˜åœ¨ğŸŒ´</h5>\n<p>æ ¹æ® sql æ–‡ä»¶æ•°æ®åˆ›å»ºç´¢å¼•åº“<a href=\"./Elasearch/%E6%A1%88%E4%BE%8Bsql.md\"> sql æ–‡ä»¶</a>ã€‚ç´¢å¼•åº“åä¸º hotelï¼Œmapping å±æ€§æ ¹æ®æ•°æ®åº“ç»“æ„å®šä¹‰ã€‚</p>\n<p>åŸºæœ¬æ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<p>1ã€idea ä¸­å¯¼å…¥ hotel-demo é¡¹ç›®ï¼Œé¡¹ç›®åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZG91a2FpeGluL3R5cG9yYS5naXQ=\">https://gitee.com/doukaixin/typora.git</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310121121088.png\" alt=\"image-20231012112156928\" /></p>\n<p>2ã€åˆ†ææ•°æ®ç»“æ„ï¼Œå®šä¹‰ mapping å±æ€§</p>\n<p>mapping è¦è€ƒè™‘çš„é—®é¢˜ï¼š</p>\n<p>å­—æ®µåï¼Œæ•°æ®ç±»å‹ï¼Œæ˜¯å¦å‚ä¸æœç´¢ï¼Œæ˜¯å¦åˆ†è¯ï¼Œå¦‚æœåˆ†è¯ï¼Œåˆ†è¯å™¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<p>å…¶ä¸­ï¼Œå­—æ®µåå’Œæ•°æ®ç±»å‹å¯ä»¥åŸºäºè¡¨ç»“æ„ä¸€ç›®äº†ç„¶ï¼Œæ˜¯å¦å‚ä¸æœç´¢ä¸æ˜¯å¦åˆ†è¯å°±æ¯”è¾ƒç‰¹æ®Šäº†ï¼Œå®ƒä»¬ä¸ä¸šåŠ¡å¼ºç›¸å…³çš„ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬å½“å‰çš„é…’åº—ä¸šåŠ¡ï¼Œé…’åº—åç§°å°±ä¸€å®šæ˜¯è¦å‚ä¸æœç´¢åŠŸèƒ½çš„å®ƒä¹Ÿè¦åˆ†è¯å› ä¸ºå†…å®¹æ¯”è¾ƒé•¿ï¼Œè€Œåˆ†è¯å™¨æˆ‘ä»¬è‚¯å®šä¼šä½¿ç”¨ ik_max_word å°½å¯èƒ½å¤šçš„åˆ†è¯æœç´¢èŒƒå›´å¤§ä¸€äº›ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310121124067.png\" alt=\"image-20231012112427548\" /></p>\n<p>æ ¹æ®ä¸Šè¿°åˆ†æå»åˆ›å»ºå¯¹åº”çš„ç´¢å¼•åº“</p>\n<blockquote>\n<p>å°æç¤ºï¼š</p>\n<p>ES ä¸­æ”¯æŒä¸¤ç§åœ°ç†åæ ‡æ•°æ®ç±»å‹ï¼š</p>\n<ul>\n<li>\n<p>geo_pointï¼šç”±çº¬åº¦ (latitude) å’Œå¾„åº¦ (longitude) ç¡®å®šçš„ä¸€ä¸ªç‚¹ã€‚ä¾‹å¦‚ï¼š</p>\n<p>â€œ32.82342343ï¼Œ120.3153263â€</p>\n</li>\n<li>\n<p>geo_shapeï¼šæœ‰å¤šä¸ª geo_point ç»„æˆçš„å¤æ‚å‡ ä½•å›¾å½¢ã€‚ä¾‹å¦‚ä¸€æ¡ç›´çº¿ï¼Œ</p>\n<p>â€œLINESTRING(-77.12312312ï¼Œ-77.1235343 38.2323234)â€</p>\n</li>\n</ul>\n</blockquote>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>PUT /dkx</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"mappings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ik_max_word\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token property\">\"address\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"integer\"</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token property\">\"score\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"integer\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token property\">\"brand\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token property\">\"city\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token property\">\"starName\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token property\">\"business\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>       # é…’åº—åœ¨åœ°å›¾ä¸Šç”¨ä¸€ä¸ªç‚¹æ¥è¡¨ç¤ºæ‰€ä»¥ä½¿ç”¨geo_pointï¼Œè€Œä¸Šå›¾çš„sqlä¸­é…’åº—æ˜¯ä¸¤ä¸ªå­—æ®µä¸€ä¸ªç»åº¦ä¸€ä¸ªçº¬åº¦ï¼Œè€Œåœ¨ESä¸­ä¸€ä¸ªgeo_pointä»£è¡¨äº†ç»çº¬åº¦ï¼Œæ‰€ä»¥ä½¿ç”¨ä¸€ä¸ªå­—æ®µæ¥åŒ…è£¹geo_point</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token property\">\"location\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"geo_point\"</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token property\">\"pic\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è™½ç„¶å®šä¹‰å®Œäº†é…’åº—çš„æ‰€æœ‰å­—æ®µäº†ä½†æ˜¯æœ‰ä¸€ä¸ªå°çš„é—®é¢˜ã€‚é‚£æˆ‘ä»¬çš„ nameï¼Œbrandï¼Œbusinne ç­‰å­—æ®µè¿™äº›éƒ½è¦å‚ä¸æœç´¢ï¼Œé‚£è¿™äº›å°†æ¥éƒ½è¦å‚ä¸æœç´¢ä¹Ÿå°±æ„å‘³ç€å°†æ¥ç”¨æˆ·è¾“å…¥å…³é”®å­—æˆ‘å¯èƒ½è¦æ ¹æ®å¤šä¸ªå­—æ®µæœç´¢ï¼Œä¹Ÿå°±æ˜¯æŸ¥è¯¢æ¡ä»¶ä¸æ˜¯ä¸€ä¸ªå€¼è€Œæ˜¯å¤šä¸ªå€¼ã€‚é‚£æ ¹æ®ä¸€ä¸ªå­—æ®µæœæ•ˆç‡é«˜ï¼Œè¿˜æ˜¯æ ¹æ®å¤šä¸ªå­—æ®µæœæ•ˆç‡é«˜å‘¢ï¼Ÿæ˜¾ç„¶æ˜¯ä¸€ä¸ªå­—æ®µæœã€‚ä½†æ˜¯éœ€æ±‚æ˜¯å¸Œæœ›ç”¨æˆ·è¾“å…¥åç§°èƒ½æœåˆ°ï¼Œè¾“å…¥å“ç‰Œä¹Ÿèƒ½æœåˆ°ï¼Œè¾“å…¥å•†åœˆä¹Ÿèƒ½æœåˆ°ï¼Œå¤šä¸ªæœç´¢æ¡ä»¶è€Œæˆ‘åˆæƒ³æ€§èƒ½å¥½è¯¥æ€ä¹ˆåŠï¼Ÿ</p>\n<p>ES æä¾›äº†ä¸€ä¸ªåŠŸèƒ½å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¦‚ä¸‹å°æç¤º</p>\n<blockquote>\n<p><strong>å°æç¤º</strong>ï¼š</p>\n<p>å­—æ®µæ‹·è´å¯ä»¥ä½¿ç”¨ copy_to å±æ€§å°†å½“å‰å­—æ®µæ‹·è´åˆ°æŒ‡å®šå­—æ®µã€‚ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"all\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ik_max_word\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token property\">\"brand\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token property\">\"copy_to\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"all\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></blockquote>\n<p>å®Œæ•´çš„ç´¢å¼•åº“å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>PUT /dkx</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"mappings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ik_max_word\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token property\">\"copy_to\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"all\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token property\">\"address\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"integer\"</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token property\">\"score\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"integer\"</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token property\">\"brand\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token property\">\"copy_to\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"all\"</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token property\">\"city\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token property\">\"starName\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token property\">\"business\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token property\">\"copy_to\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"all\"</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token property\">\"location\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"geo_point\"</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token property\">\"pic\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>      <span class=\"token property\">\"all\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ik_max_word\"</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>3ã€åˆå§‹åŒ– JavaRestClient</p>\n<p>3.1ã€å¼•å…¥ es çš„ RestHighLevelClient ä¾èµ–ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.elasticsearch.client<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>elasticsearch-rest-high-level-client<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">&lt;!-- åœ¨ properties ä¸­å£°æ˜äº†ç‰ˆæœ¬åœ¨è¿™é‡Œå¯ä»¥ä¸åŠ ç‰ˆæœ¬ --></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>3.2ã€å› ä¸º SpringBoot é»˜è®¤çš„ ES ç‰ˆæœ¬æ˜¯ 7.6.2ã€æ‰€ä»¥æˆ‘ä»¬éœ€è¦è¦†ç›–é»˜è®¤çš„ ES ç‰ˆæœ¬ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>java.version</span><span class=\"token punctuation\">></span></span>1.8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>java.version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\">&lt;!-- ä½¿ç”¨ elasticsearch å¿…é¡»åœ¨ properties ä¸­å¼ºåˆ¶å£°æ˜ç‰ˆæœ¬å· --></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">&lt;!-- ç»Ÿä¸€æ§åˆ¶ elasticsearch ç‰ˆæœ¬å·ï¼Œæ˜¯å› ä¸ºä¾èµ–å†…éƒ¨çš„ç‰ˆæœ¬ä¸ç»Ÿä¸€ --></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>elasticsearch.version</span><span class=\"token punctuation\">></span></span>7.12.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>elasticsearch.version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>3.3ã€åˆå§‹åŒ– RestHighLevelClientï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@BeforeEach</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RestHighLevelClient</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RestClient</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">HttpHost</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http:/192.168.249.128:9200\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    å¾®æœåŠ¡é›†ç¾¤å¯ä»¥å†™å¤šä¸ª</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    HttpHost.create (\"http:/192.168.249.128:9200\"),</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    HttpHost.create (\"http:/192.168.249.128:9200\"),</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    HttpHost.create (\"http:/192.168.249.128:9200\")</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>4ã€åˆ©ç”¨ JavaRestClient åˆ›å»ºç´¢å¼•åº“</p>\n<p>éœ€è¦æ³¨æ„ï¼šdkx è¿™ä¸ªç´¢å¼•åº“å·²ç»åˆ›å»ºè¿‡äº†å†åˆ›å»ºå°±ä¼šæŠ¥é”™å¦‚ä¸‹ï¼š</p>\n<p>éœ€è¦å…ˆå°†å…¶åˆ é™¤åå†è¿›è¡Œæµ‹è¯•</p>\n<pre><code>[dkx/CGJFBdUgTFCV46PbgurYiA] ElasticsearchStatusException[Elasticsearch exception [type=resource_already_exists_exception, reason=index [dkx/CGJFBdUgTFCV46PbgurYiA] already exists]\n]\n</code></pre>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310121425282.png\" alt=\"image-20231012142539675\" /></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">createHotelIndex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. åˆ›å»º Request å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">CreateIndexRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CreateIndexRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 2. å‡†å¤‡è¯·æ±‚çš„å‚æ•°ï¼šDSL è¯­å¥</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token comment\">// é€šè¿‡ç±»è·¯å¾„æ¥è·å– hote.json é…ç½®æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token class-name\">String</span> path <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContextClassLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getResource</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hote.json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token comment\">// å¦‚æœè·å–ç»å¯¹è·¯å¾„ä¸­å«æœ‰ä¸­æ–‡å¯èƒ½ä¼šä¹±ç æ‰€ä»¥éœ€è¦è¿›è¡Œç¼–ç å¤„ç†</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      path <span class=\"token operator\">=</span> <span class=\"token class-name\">URLDecoder</span><span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> <span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token comment\">// é€šè¿‡å­—ç¬¦è¾“å…¥æµæ¥è¯»å–æŒ‡å®šä½ç½®çš„ json æ–‡ä»¶å†…å®¹</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token class-name\">FileReader</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      msg <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> reader<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>         <span class=\"token comment\">// å°†è¯»å–åˆ°çš„å†…å®¹æ‹¼æ¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>         msg <span class=\"token operator\">+=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token punctuation\">)</span>i<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token comment\">//msg æ˜¯è¯»å–çš„ json æ–‡ä»¶é‡Œé¢æ˜¯åˆ›å»ºç´¢å¼•åº“çš„ DSL è¯­å¥</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">,</span> <span class=\"token class-name\">XContentType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>   <span class=\"token comment\">// 3. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      client<span class=\"token punctuation\">.</span><span class=\"token function\">indices</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>hote.json</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"mappings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ik_max_word\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token property\">\"copy_to\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"all\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token property\">\"address\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"integer\"</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token property\">\"score\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"integer\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token property\">\"brand\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token property\">\"copy_to\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"all\"</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token property\">\"city\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token property\">\"starName\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token property\">\"business\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token property\">\"copy_to\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"all\"</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token property\">\"location\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"geo_point\"</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      <span class=\"token property\">\"pic\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>      <span class=\"token property\">\"all\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ik_max_word\"</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨ kibana ä¸­æ‰§è¡Œ GET è¯·æ±‚ï¼Œè¯·æ±‚ /dkx ç´¢å¼•åº“æŸ¥çœ‹æ˜¯å¦å­˜åœ¨</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310121533685.png\" alt=\"image-20231012153324541\" /></p>\n<p>5ã€åˆ©ç”¨ JavaRestClient åˆ é™¤ç´¢å¼•åº“</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">deleteHoteIndex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. åˆ›å»º Request å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">DeleteIndexRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DeleteIndexRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token comment\">// 2. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      client<span class=\"token punctuation\">.</span><span class=\"token function\">indices</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>6ã€åˆ©ç”¨ JavaRestClient åˆ¤æ–­ç´¢å¼•åº“æ˜¯å¦å­˜åœ¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">exitHoteIndex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. åˆ›å»º Request è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">GetIndexRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GetIndexRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token comment\">// 2. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token keyword\">boolean</span> exists <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">indices</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">exists</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>exists <span class=\"token operator\">?</span> <span class=\"token string\">\"å­˜åœ¨\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ä¸å­˜åœ¨\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p><strong>æ€»ç»“</strong>:</p>\n<p>ç´¢å¼•åº“æ“ä½œçš„åŸºæœ¬æ­¥éª¤ï¼š</p>\n<ul>\n<li>åˆå§‹åŒ– RestHighLevelClient</li>\n<li>åˆ›å»º XxxIndexRequestã€‚Xxx æ˜¯ CREATEï¼ŒGetï¼ŒDelete</li>\n<li>å‡†å¤‡ DSL (CREATE æ—¶éœ€è¦)</li>\n<li>å‘é€è¯·æ±‚ã€‚è°ƒç”¨ RestHighLevelClient#indices ().xxx () æ–¹æ³•ï¼Œxxx æ˜¯ createï¼Œexistsï¼Œdelete</li>\n</ul>\n</blockquote>\n<h4 id=\"987-restclientæ“ä½œæ–‡æ¡£\"><a class=\"anchor\" href=\"#987-restclientæ“ä½œæ–‡æ¡£\">#</a> 9.8.7ã€RestClient æ“ä½œæ–‡æ¡£ğŸŒ²</h4>\n<ul>\n<li>æ–°å¢æ–‡æ¡£</li>\n<li>æŸ¥è¯¢æ–‡æ¡£</li>\n<li>åˆ é™¤æ–‡æ¡£</li>\n<li>ä¿®æ”¹æ–‡æ¡£</li>\n<li>æ‰¹é‡å¯¼å…¥æ–‡æ¡£</li>\n</ul>\n<h5 id=\"9871-æ¡ˆä¾‹åˆ©ç”¨javarestclientå®ç°æ–‡æ¡£çš„crud\"><a class=\"anchor\" href=\"#9871-æ¡ˆä¾‹åˆ©ç”¨javarestclientå®ç°æ–‡æ¡£çš„crud\">#</a> 9.8.7.1ã€æ¡ˆä¾‹ï¼Œåˆ©ç”¨ JavaRestClient å®ç°æ–‡æ¡£çš„ CRUDğŸŒ´</h5>\n<p>å»æ•°æ®åº“æŸ¥è¯¢é…’åº—æ•°æ®ï¼Œå¯¼å…¥åˆ° dkx ç´¢å¼•åº“ï¼Œå®ç°é…’åº—æ•°æ®çš„ CRUD</p>\n<p><strong>åŸºæœ¬æ­¥éª¤å¦‚ä¸‹</strong>ï¼š</p>\n<p>1ã€åˆå§‹åŒ– JavaRestClient</p>\n<p>æ–°å»ºä¸€ä¸ªæµ‹è¯•ç±»ï¼Œå®ç°æ–‡æ¡£ç›¸å…³æ“ä½œï¼Œå¹¶ä¸”å®Œæˆ JavaRestClient çš„åˆå§‹åŒ–</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootTest</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HoteIndexTest1</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RestHighLevelClient</span> client<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"5\"></td><td><pre> \t <span class=\"token annotation punctuation\">@BeforeEach</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RestHighLevelClient</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RestClient</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token class-name\">HttpHost</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://192.168.249.128:9200\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@AfterEach</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">tearDown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>2ã€åˆ©ç”¨ JavaRestClient æ–°å¢é…’åº—æ•°æ®</p>\n<p>å…ˆé€šè¿‡ mysql æŸ¥è¯¢é…’åº—æ•°æ®ï¼Œç„¶åç»™è¿™æ¡æ•°æ®åˆ›å»ºå€’æ’ç´¢å¼•ï¼Œå³å¯å®Œæˆæ·»åŠ ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">IHotelService</span> iHotelService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testAddDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token comment\">// æ ¹æ® id æŸ¥è¯¢é…’åº—æ•°æ®</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token class-name\">Hotel</span> byId <span class=\"token operator\">=</span> iHotelService<span class=\"token punctuation\">.</span><span class=\"token function\">getById</span><span class=\"token punctuation\">(</span><span class=\"token number\">36934L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">// è½¬æ¢ä¸ºæ–‡æ¡£ç±»å‹</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token class-name\">HotelDoc</span> hotelDoc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>byId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡ Request å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token class-name\">IndexRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IndexRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">id</span><span class=\"token punctuation\">(</span>hotelDoc<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token comment\">// 2. å‡†å¤‡ JSON æ–‡æ¡£</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSONString</span><span class=\"token punctuation\">(</span>hotelDoc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">XContentType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token comment\">// 3. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      client<span class=\"token punctuation\">.</span><span class=\"token function\">index</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310121557188.png\" alt=\"image-20231012155720876\" /></p>\n<p>åˆ° kibana ä¸­é€šè¿‡å‘½ä»¤ï¼šGET /dkx/_doc/36934 æŸ¥çœ‹æ˜¯å¦æˆåŠŸæ·»åŠ äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310121638859.png\" alt=\"image-20231012163857506\" /></p>\n<p>3ã€åˆ©ç”¨ JavaRestClient æ ¹æ® id æŸ¥è¯¢é…’åº—æ•°æ®</p>\n<p>æ ¹æ® id æŸ¥è¯¢åˆ°çš„æ–‡æ¡£æ•°æ®æ˜¯ jsonï¼Œéœ€è¦ååºåˆ—åŒ–ä¸º java å¯¹è±¡ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testGetDocumentById</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡ Request</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">GetRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GetRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"36934\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 2. å‘é€è¯·æ±‚ï¼Œå¾—åˆ°å“åº”</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token class-name\">GetResponse</span> documentFields<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      documentFields <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token comment\">// 3. è§£æå“åº”ç»“æœ</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token class-name\">String</span> json <span class=\"token operator\">=</span> documentFields<span class=\"token punctuation\">.</span><span class=\"token function\">getSourceAsString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token comment\">// é€šè¿‡ JSON.parseObject å°† json æ•°æ®è§£æä¸ºæŒ‡å®šçš„å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token class-name\">HotelDoc</span> hotelDoc <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseObject</span><span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>hotelDoc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">//--------------------- æ‰“å°ç»“æœ ---------------------</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">36934</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token number\">7</span>å¤©è¿é”é…’åº—<span class=\"token punctuation\">(</span>ä¸Šæµ·å®å±±è·¯åœ°é“ç«™åº—<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> address<span class=\"token operator\">=</span>é™å®‰äº¤é€šè·¯<span class=\"token number\">40</span>å·<span class=\"token punctuation\">,</span> price<span class=\"token operator\">=</span><span class=\"token number\">336</span><span class=\"token punctuation\">,</span> score<span class=\"token operator\">=</span><span class=\"token number\">37</span><span class=\"token punctuation\">,</span> brand<span class=\"token operator\">=</span><span class=\"token number\">7</span>å¤©é…’åº—<span class=\"token punctuation\">,</span> city<span class=\"token operator\">=</span>ä¸Šæµ·<span class=\"token punctuation\">,</span> starName<span class=\"token operator\">=</span>äºŒé’»<span class=\"token punctuation\">,</span> business<span class=\"token operator\">=</span>å››å·åŒ—è·¯å•†ä¸šåŒº<span class=\"token punctuation\">,</span> location<span class=\"token operator\">=</span><span class=\"token number\">31.251433</span><span class=\"token punctuation\">,</span> <span class=\"token number\">121.47522</span><span class=\"token punctuation\">,</span> pic<span class=\"token operator\">=</span>https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>m<span class=\"token punctuation\">.</span>tuniucdn<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>fb2<span class=\"token operator\">/</span>t1<span class=\"token operator\">/</span><span class=\"token constant\">G1</span><span class=\"token operator\">/</span><span class=\"token constant\">M00</span><span class=\"token operator\">/</span><span class=\"token number\">3</span>E<span class=\"token operator\">/</span><span class=\"token number\">40</span><span class=\"token operator\">/</span><span class=\"token class-name\">Cii9EVkyLrKIXo1vAAHgrxo_pUcAALcKQLD688AAeDH564_w200_h200_c1_t0</span><span class=\"token punctuation\">.</span>jpg<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310121629666.png\" alt=\"image-20231012162936320\" /></p>\n<p>4ã€åˆ©ç”¨ JavaRestClient åˆ é™¤é…’åº—æ•°æ®</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testDeleteDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡ Request</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">DeleteRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DeleteRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"36934\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 2. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      client<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310121659241.png\" alt=\"image-20231012165946036\" /></p>\n<p>å¦‚æœåˆ é™¤åå†å»é€šè¿‡ java ä»£ç å»æŸ¥è¯¢è¿”å›ç»“æœå°±æ˜¯ null</p>\n<p>5ã€åˆ©ç”¨ JavaRestClient ä¿®æ”¹é…’åº—æ•°æ®</p>\n<p>ä¿®æ”¹æ–‡æ¡£æ•°æ®æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>\n<p>æ–¹å¼ä¸€ï¼šå…¨é‡æ›´æ–°ã€‚å†æ¬¡å†™å…¥ id ä¸€æ ·çš„æ–‡æ¡£ï¼Œå°±ä¼šåˆ é™¤æ—§æ–‡æ¡£ï¼Œæ·»åŠ æ–°æ–‡æ¡£ï¼Œå®ƒçš„ java ä»£ç å’Œæ·»åŠ æ²¡æœ‰åŒºåˆ«</p>\n<p>æ–¹å¼äºŒï¼šå±€éƒ¨æ›´æ–°ã€‚åªæ›´æ–°éƒ¨åˆ†å­—æ®µï¼Œæˆ‘ä»¬æ¼”ç¤ºæ–¹å¼äºŒ</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testUpdateDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡ Request</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">UpdateRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UpdateRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"36934\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 2. å‡†å¤‡è¯·æ±‚å‚æ•°</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">doc</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token comment\">// ä½¿ç”¨ é€—å·éš”å¼€ ä¸¤ä¸ªä¸€å¯¹</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token string\">\"price\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"952\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token string\">\"starName\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"äº”é’»\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token comment\">// 3. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      client<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310121643267.png\" alt=\"image-20231012164318114\" /></p>\n<p>ä¿®æ”¹å‰é€šè¿‡ id è·å–æ•°æ®</p>\n<pre><code>HotelDoc(id=36934, name=7å¤©è¿é”é…’åº—(ä¸Šæµ·å®å±±è·¯åœ°é“ç«™åº—), address=é™å®‰äº¤é€šè·¯40å·, price=336, score=37, brand=7å¤©é…’åº—, city=ä¸Šæµ·, starName=äºŒé’», business=å››å·åŒ—è·¯å•†ä¸šåŒº, location=31.251433, 121.47522, pic=https://m.tuniucdn.com/fb2/t1/G1/M00/3E/40/Cii9EVkyLrKIXo1vAAHgrxo_pUcAALcKQLD688AAeDH564_w200_h200_c1_t0.jpg)\n</code></pre>\n<p>ä¿®æ”¹åé€šè¿‡ id è·å–æ•°æ®</p>\n<pre><code>HotelDoc(id=36934, name=7å¤©è¿é”é…’åº—(ä¸Šæµ·å®å±±è·¯åœ°é“ç«™åº—), address=é™å®‰äº¤é€šè·¯40å·, price=952, score=37, brand=7å¤©é…’åº—, city=ä¸Šæµ·, starName=äº”é’», business=å››å·åŒ—è·¯å•†ä¸šåŒº, location=31.251433, 121.47522, pic=https://m.tuniucdn.com/fb2/t1/G1/M00/3E/40/Cii9EVkyLrKIXo1vAAHgrxo_pUcAALcKQLD688AAeDH564_w200_h200_c1_t0.jpg)\n</code></pre>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>æ–‡æ¡£æ“ä½œçš„åŸºæœ¬æ­¥éª¤ï¼š</p>\n<ul>\n<li>åˆå§‹åŒ– RestHighLevelClient</li>\n<li>åˆ›å»º XxxRequestã€‚XXX æ˜¯ Indexï¼ŒGetï¼ŒUpdateï¼ŒDelete</li>\n<li>å‡†å¤‡å‚æ•° (Index å’Œ Update æ—¶éœ€è¦)</li>\n<li>å‘é€è¯·æ±‚ã€‚è°ƒç”¨ RestHighLevelClient#.xxx () æ–¹æ³•ï¼Œxxx æ˜¯ Indexï¼ŒGetï¼ŒUpdateï¼ŒDelete</li>\n<li>è§£æç»“æœ (Get æ—¶éœ€è¦)</li>\n</ul>\n</blockquote>\n<h4 id=\"988-æ¡ˆä¾‹åˆ©ç”¨javarestclientæ‰¹é‡å¯¼å…¥é…’åº—æ•°æ®åˆ°es\"><a class=\"anchor\" href=\"#988-æ¡ˆä¾‹åˆ©ç”¨javarestclientæ‰¹é‡å¯¼å…¥é…’åº—æ•°æ®åˆ°es\">#</a> 9.8.8ã€æ¡ˆä¾‹ï¼Œåˆ©ç”¨ JavaRestClient æ‰¹é‡å¯¼å…¥é…’åº—æ•°æ®åˆ° ESğŸŒ²</h4>\n<p>éœ€æ±‚ï¼šæ‰¹é‡æŸ¥è¯¢é…’åº—æ•°æ®ï¼Œç„¶åæ‰¹é‡å¯¼å…¥ç´¢å¼•åº“ä¸­</p>\n<p>æ€è·¯ï¼š</p>\n<p>1ã€åˆ©ç”¨ mybatis-plus æŸ¥è¯¢é…’åº—æ•°æ®</p>\n<p>2ã€å°†æŸ¥è¯¢åˆ°çš„é…’åº—æ•°æ® (Hotel) è½¬æ¢ä¸º æ–‡æ¡£ç±»å‹æ•°æ® (HotelDoc)</p>\n<p>3ã€åˆ©ç”¨ JavaRestClient ä¸­çš„ Bulk æ‰¹å¤„ç†ï¼Œå®ç°æ‰¹é‡æ–°å¢æ–‡æ¡£ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootTest</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HoteIndexTest1</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RestHighLevelClient</span> client<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">IHotelService</span> iHotelService<span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testBulkRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// æ‰¹é‡æŸ¥è¯¢é…’åº—æ•°æ®</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Hotel</span><span class=\"token punctuation\">></span></span> hotels <span class=\"token operator\">=</span> iHotelService<span class=\"token punctuation\">.</span><span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 1. åˆ›å»º Request</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">BulkRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BulkRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// 2. å‡†å¤‡å‚æ•°ï¼Œæ·»åŠ å¤šä¸ªæ–°å¢çš„ Request</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">// 2.1 å¯¹æŸ¥è¯¢å‡ºçš„é…’åº—æ•°æ®è¿›è¡Œéå†</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Hotel</span> hotel<span class=\"token operator\">:</span> hotels<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token comment\">// è½¬æ¢ä¸ºæ–‡æ¡£ç±»å‹ HotelDoc</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token class-name\">HotelDoc</span> hotelDoc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>hotel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token comment\">// åˆ›å»ºæ–°å¢æ–‡æ¡£çš„ Request å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            request<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">IndexRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                    <span class=\"token punctuation\">.</span><span class=\"token function\">id</span><span class=\"token punctuation\">(</span>hotel<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                    <span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSONString</span><span class=\"token punctuation\">(</span>hotelDoc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">XContentType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\">// 3. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            client<span class=\"token punctuation\">.</span><span class=\"token function\">bulk</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span>   </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t<span class=\"token annotation punctuation\">@BeforeEach</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RestHighLevelClient</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RestClient</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token class-name\">HttpHost</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://192.168.249.128:9200\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token annotation punctuation\">@AfterEach</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">tearDown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åˆ° kibana é¡µé¢é€šè¿‡å‘½ä»¤ï¼šGET /dkx/_search æŸ¥çœ‹ç»“æœ</p>\n<p>å¯ä»¥çœ‹åˆ°æŸ¥è¯¢å‡ºäº† 201 æ¡æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310121723744.png\" alt=\"image-20231012172343307\" /></p>\n<h3 id=\"99-dslæŸ¥è¯¢æ–‡æ¡£\"><a class=\"anchor\" href=\"#99-dslæŸ¥è¯¢æ–‡æ¡£\">#</a> 9.9ã€DSL æŸ¥è¯¢æ–‡æ¡£ğŸŒ³</h3>\n<ul>\n<li>DSL æŸ¥è¯¢åˆ†ç±»</li>\n<li>å…¨æ–‡æ£€ç´¢æŸ¥è¯¢</li>\n<li>ç²¾å‡†æŸ¥è¯¢</li>\n<li>åœ°ç†åæ ‡æŸ¥è¯¢</li>\n<li>ç»„åˆæŸ¥è¯¢</li>\n</ul>\n<h4 id=\"991-dsl-queryçš„åˆ†ç±»\"><a class=\"anchor\" href=\"#991-dsl-queryçš„åˆ†ç±»\">#</a> 9.9.1ã€DSL Query çš„åˆ†ç±»ğŸŒ²</h4>\n<p>Elasticsearch æä¾›äº†åŸºäº JSON çš„ DSL (Domain Specific Language) æ¥å®šä¹‰æŸ¥è¯¢ã€‚å¸¸è§çš„æŸ¥è¯¢ç±»å‹åŒ…æ‹¬ï¼š</p>\n<ul>\n<li>æŸ¥è¯¢æ‰€æœ‰ï¼šæŸ¥è¯¢å‡ºæ‰€æœ‰æ•°æ®ï¼Œä¸€èˆ¬æµ‹è¯•ç”¨ã€‚ä¾‹å¦‚ï¼šmatch_all</li>\n<li>å…¨æ–‡æ£€ç´¢ (full text) æŸ¥è¯¢ï¼šåˆ©ç”¨åˆ†è¯å™¨å¯¹ç”¨æˆ·è¾“å…¥å†…å®¹åˆ†è¯ï¼Œç„¶åå»å€’æ’ç´¢å¼•åº“ä¸­åŒ¹é…ã€‚ä¾‹å¦‚ï¼š\n<ul>\n<li>match_query</li>\n<li>multi_match_query</li>\n</ul>\n</li>\n<li>ç²¾ç¡®æŸ¥è¯¢ï¼šæ ¹æ®ç²¾ç¡®è¯æ¡å€¼æŸ¥æ‰¾æ•°æ®ï¼Œä¸€èˆ¬æ˜¯æŸ¥æ‰¾ keywordï¼Œæ•°å€¼ï¼Œæ—¥æœŸï¼Œboolean ç­‰ç±»å‹å­—æ®µã€‚ä¾‹å¦‚ï¼š\n<ul>\n<li>ids</li>\n<li>range</li>\n<li>term</li>\n</ul>\n</li>\n<li>åœ°ç† (geo) æŸ¥è¯¢ï¼šæ ¹æ®ç»çº¬åº¦æŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼š\n<ul>\n<li>geo_distance</li>\n<li>geo_bounding_box</li>\n</ul>\n</li>\n<li>å¤åˆ (compound) æŸ¥è¯¢ï¼šå¤åˆæŸ¥è¯¢å¯ä»¥å°†ä¸Šè¿°å„ç§æŸ¥è¯¢æ¡ä»¶ç»„åˆèµ·æ¥ï¼Œåˆå¹¶æŸ¥è¯¢æ¡ä»¶ã€‚ä¾‹å¦‚ï¼š\n<ul>\n<li>bool</li>\n<li>function_score</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"9911-dsl-queryåŸºæœ¬è¯­æ³•\"><a class=\"anchor\" href=\"#9911-dsl-queryåŸºæœ¬è¯­æ³•\">#</a> 9.9.1.1ã€DSL Query åŸºæœ¬è¯­æ³•ğŸŒ´</h5>\n<p>æŸ¥è¯¢çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /indexName/_search</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token property\">\"æŸ¥è¯¢ç±»å‹\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>         <span class=\"token property\">\"æŸ¥è¯¢æ¡ä»¶\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"æ¡ä»¶å€¼\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310121738538.png\" alt=\"image-20231012173803886\" /></p>\n<blockquote>\n<p>æ€»ç»“ï¼š</p>\n<p>æŸ¥è¯¢ DSL çš„åŸºæœ¬è¯­æ³•æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>GET / ç´¢å¼•åº“å /_search</li>\n<li>{â€œqueryâ€: {â€œæŸ¥è¯¢ç±»å‹â€:{â€œFIELDâ€:â€TEXTâ€}}}</li>\n</ul>\n</blockquote>\n<h4 id=\"992-å…¨æ–‡æ£€ç´¢æŸ¥è¯¢\"><a class=\"anchor\" href=\"#992-å…¨æ–‡æ£€ç´¢æŸ¥è¯¢\">#</a> 9.9.2ã€å…¨æ–‡æ£€ç´¢æŸ¥è¯¢ğŸŒ²</h4>\n<p>match æŸ¥è¯¢ï¼šå…¨æ–‡æ£€ç´¢æŸ¥è¯¢çš„ä¸€ç§ï¼Œä¼šå¯¹ç”¨æˆ·è¾“å…¥å†…å®¹åˆ†è¯ï¼Œç„¶åå»å€’æ’ç´¢å¼•æ£€ç´¢ï¼Œè¯­æ³•ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /indexName/_search</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>         <span class=\"token property\">\"FIELD\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"TEXT\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310121802836.png\" alt=\"image-20231012180230588\" /></p>\n<p>multi_matchï¼šä¸ match æŸ¥è¯¢ç±»ä¼¼ï¼Œåªä¸è¿‡å…è®¸åŒæ—¶æŸ¥è¯¢å¤šä¸ªå­—æ®µï¼Œè¯­æ³•ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /indexName/_search</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token property\">\"multi_match\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>         <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"TEXT\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>         <span class=\"token property\">\"fields\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"FIELD1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"FIELD12\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310121933446.png\" alt=\"image-20231012193303357\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>match å’Œ muliti_match çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>matchï¼šæ ¹æ®ä¸€ä¸ªå­—æ®µæŸ¥è¯¢</li>\n<li>multi_matchï¼šæ ¹æ®å¤šä¸ªå­—æ®µæŸ¥è¯¢ï¼Œå‚ä¸æŸ¥è¯¢å­—æ®µè¶Šå¤šï¼ŒæŸ¥è¯¢æ€§èƒ½è¶Šå·®</li>\n</ul>\n</blockquote>\n<h4 id=\"993-ç²¾ç¡®æŸ¥è¯¢\"><a class=\"anchor\" href=\"#993-ç²¾ç¡®æŸ¥è¯¢\">#</a> 9.9.3ã€ç²¾ç¡®æŸ¥è¯¢ğŸŒ²</h4>\n<p>ç²¾ç¡®æŸ¥è¯¢ä¸€èˆ¬æ˜¯æŸ¥æ‰¾ keywordï¼Œæ•°å€¼ï¼Œæ—¥æœŸï¼Œboolean ç­‰ç±»å‹å­—æ®µã€‚æ‰€ä»¥<mark>ä¸ä¼š</mark>å¯¹æœç´¢æ¡ä»¶åˆ†è¯ã€‚å¸¸è§çš„æœ‰ï¼š</p>\n<ul>\n<li>termï¼šæ ¹æ®è¯æ¡ç²¾ç¡®å€¼æŸ¥è¯¢</li>\n<li>rangeï¼šæ ¹æ®å€¼çš„èŒƒå›´æŸ¥è¯¢</li>\n</ul>\n<h5 id=\"9931-ç²¾ç¡®æŸ¥è¯¢-è¯­æ³•\"><a class=\"anchor\" href=\"#9931-ç²¾ç¡®æŸ¥è¯¢-è¯­æ³•\">#</a> 9.9.3.1ã€ç²¾ç¡®æŸ¥è¯¢ - è¯­æ³•ğŸŒ´</h5>\n<p>ç²¾ç¡®æŸ¥è¯¢ä¸€èˆ¬æ˜¯æ ¹æ® idï¼Œæ•°å€¼ï¼Œkeyword ç±»å‹ï¼Œæˆ–å¸ƒå°”å­—æ®µæ¥æŸ¥è¯¢ã€‚è¯­æ³•å¦‚ä¸‹ï¼š</p>\n<p>term æŸ¥è¯¢ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//term æŸ¥è¯¢</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>GET /indexName/_search</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"term\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>         <span class=\"token property\">\"FIELD\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"VLAUE\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310121959434.png\" alt=\"image-20231012195904980\" /></p>\n<p>range æŸ¥è¯¢ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//range æŸ¥è¯¢</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>GET /indexName/_search</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"range\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>         <span class=\"token property\">\"FIELD\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>           <span class=\"token property\">\"gte\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>           <span class=\"token property\">\"lte\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310122000353.png\" alt=\"image-20231012200031386\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>ç²¾ç¡®æŸ¥è¯¢å¸¸è§çš„æœ‰å“ªäº›ï¼Ÿ</p>\n<ul>\n<li>term æŸ¥è¯¢ï¼šæ ¹æ®è¯æ¡ç²¾ç¡®åŒ¹é…ï¼Œä¸€èˆ¬æœç´¢ keyword ç±»å‹ï¼Œæ•°å€¼ç±»å‹ï¼Œå¸ƒå°”ç±»å‹ï¼Œæ—¥æœŸç±»å‹å­—æ®µ</li>\n<li>range æŸ¥è¯¢ï¼šæ ¹æ®æ•°å€¼èŒƒå›´æŸ¥è¯¢ï¼Œå¯ä»¥æ˜¯æ•°å€¼ï¼Œæ—¥æœŸçš„èŒƒå›´</li>\n</ul>\n</blockquote>\n<h4 id=\"994-åœ°ç†æŸ¥è¯¢\"><a class=\"anchor\" href=\"#994-åœ°ç†æŸ¥è¯¢\">#</a> 9.9.4ã€åœ°ç†æŸ¥è¯¢ğŸŒ²</h4>\n<p>æ ¹æ®ç»çº¬åº¦æŸ¥è¯¢ã€‚å¸¸è§çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬ï¼š</p>\n<ul>\n<li>æºç¨‹ï¼šæœç´¢æˆ‘é™„è¿‘çš„é…’åº—</li>\n<li>æ»´æ»´ï¼šæœç´¢æˆ‘é™„è¿‘çš„å‡ºç§Ÿè½¦</li>\n<li>å¾®ä¿¡ï¼šæœç´¢æˆ‘é™„è¿‘çš„äºº</li>\n</ul>\n<p>æ ¹æ®ç»çº¬åº¦æŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼š</p>\n<ul>\n<li>geo_bounding_boxï¼šæŸ¥è¯¢ geo_point å€¼è½åœ¨æŸä¸ªçŸ©å½¢èŒƒå›´çš„æ‰€æœ‰æ–‡æ¡£</li>\n</ul>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//geo_bounding_box æŸ¥è¯¢</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>GET /indexName/_search</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"geo_bounding_box\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>         <span class=\"token property\">\"FIELD\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token property\">\"top_left\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>               <span class=\"token property\">\"lat\"</span><span class=\"token operator\">:</span> <span class=\"token number\">31.1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>           \t\t<span class=\"token property\">\"lon\"</span><span class=\"token operator\">:</span> <span class=\"token number\">121.5</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token property\">\"bottom_right\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>               <span class=\"token property\">\"lat\"</span><span class=\"token operator\">:</span> <span class=\"token number\">30.9</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>               <span class=\"token property\">\"lon\"</span><span class=\"token operator\">:</span> <span class=\"token number\">121.7</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨æœç´¢çš„æ—¶å€™æ ¹æ® â€œtop_leftâ€ å’Œ â€œbottom_rightâ€ ä¸¤ä¸ªç‚¹åˆ†åˆ«ç”»ä¸€ä¸ªæ¨ªçº¿å’Œç«–çº¿ çš„ ç»çº¬åº¦è¿›è¡Œç›¸äº¤å½¢æˆçš„ä¸€ä¸ªçŸ©å½¢èŒƒå›´</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310122020535.png\" alt=\"image-20231012202007403\" /></p>\n<p>æ ¹æ®ç»çº¬åº¦æŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼š</p>\n<ul>\n<li>geo_distanceï¼šæŸ¥è¯¢åˆ°æŒ‡å®šä¸­å¿ƒç‚¹å°äºæŸä¸ªè·ç¦»å€¼çš„æ‰€æœ‰æ–‡æ¡£</li>\n</ul>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//geo_distance æŸ¥è¯¢</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>GET /indexName/_search</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"geo_distance\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>         <span class=\"token property\">\"distance\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"15km\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>         <span class=\"token property\">\"FIELD\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"31.21,121.5\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310131024931.png\" alt=\"image-20231013102411621\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310122027316.png\" alt=\"image-20231012202733050\" /></p>\n<h4 id=\"995-å¤åˆæŸ¥è¯¢\"><a class=\"anchor\" href=\"#995-å¤åˆæŸ¥è¯¢\">#</a> 9.9.5ã€å¤åˆæŸ¥è¯¢ğŸŒ²</h4>\n<p>å¤åˆ (compound) æŸ¥è¯¢ï¼šå¤åˆæŸ¥è¯¢å¯ä»¥å°†å…¶å®ƒç®€å•æŸ¥è¯¢ç»„åˆèµ·æ¥ï¼Œå®ç°æ›´å¤æ‚çš„æœç´¢é€»è¾‘ï¼Œä¾‹å¦‚ï¼š</p>\n<ul>\n<li>fuction scoreï¼šç®—åˆ†å‡½æ•°æŸ¥è¯¢ï¼Œå¯ä»¥æ§åˆ¶æ–‡æ¡£ç›¸å…³æ€§ç®—åˆ†ï¼Œæ§åˆ¶æ–‡æ¡£æ’åã€‚ä¾‹å¦‚ç™¾åº¦ç«ä»·</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310130800939.png\" alt=\"image-20231013080014517\" /></p>\n<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœç´¢ â€œè™¹æ¡¥å¦‚å®¶â€ ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>\n<p>è¿™ä¸ªè¯åœ¨ç¬¬ä¸€æ¡æ–‡æ¡£ä¸­å‡ºç°äº†ä¸€æ¬¡ï¼Œè€Œè¿™ä¸ªæ–‡æ¡£ä¸­è¯æ¡çš„æ€»æ•°æ˜¯ï¼š5</p>\n<p>æ‰€ä»¥è¯æ¡é¢‘ç‡å°±æ˜¯ 1 / 5 = 0.2 åˆ†ã€‚è¯æ¡å‡ºç°çš„é¢‘ç‡è¶Šå¤šå¾—åˆ†è¶Šé«˜</p>\n<p>è¯æ˜ä½ è·Ÿè¿™ä¸ªè¯ç›¸å…³æ€§ä¹Ÿè¶Šé«˜</p>\n<p>ä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼š</p>\n<p>å¦‚å®¶è¿™ä¸ªè¯åœ¨è¿™å‡ ç¯‡æ–‡æ¡£ä¸­éƒ½æœ‰å‡ºç°ï¼Œé‚£å†å»å§è¿™ä¸ª â€œå¦‚å®¶â€ è¿›è¡Œç´¯åŠ è¿˜æœ‰æ„ä¹‰å—ï¼Ÿã€‚æ²¡æœ‰æ„ä¹‰</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310130801156.png\" alt=\"image-20231013080054602\" /></p>\n<p>æ‰€ä»¥æˆ‘ä»¬å°±å¼•å…¥ä¸€ä¸ªæ–°çš„ç®—æ³•ï¼šTFIDF ç®—æ³•</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310130807792.png\" alt=\"image-20231013080723131\" /></p>\n<p>æˆ‘ä»¬ä»¥å¦‚å®¶ä¸ºä¾‹ï¼Œé‚£ä¹ˆåŒ…å«å¦‚å®¶çš„æ–‡æ¡£æœ‰ä¸‰ä¸ªï¼Œè€Œæ–‡æ¡£æ€»æ•°ä¹Ÿæ˜¯ä¸‰é‚£ 3 /3 = 1 é‚£ Log/1 = 0 ã€‚é‚£ä»£è¡¨å¦‚å®¶è¿™ä¸ªæƒé‡å°±æ˜¯ 0 ã€‚é‚£ç›¸åè™¹æ¡¥è¿™ä¸ªè¯æ”¯å‡ºç°åœ¨ä¸€ä¸ªæ–‡æ¡£ä¸­ï¼Œæ‰€ä»¥åˆ†æ¯å°±æ˜¯ 1 ï¼Œè€Œæ–‡æ¡£æ€»æ•°æ˜¯ 3 æ‰€ä»¥ç»“æœå°±æ˜¯ 3</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310130812773.png\" alt=\"image-20231013081248428\" /></p>\n<p>è¿™ä¸ªç®—æ³•ä¹Ÿæ˜¯å»åšç´¯åŠ åªä¸è¿‡å®ƒåœ¨åš tf å’Œ idf çš„æ—¶å€™ç®—æ³•ä¸Šé¢ä¼šæ›´åŠ å¤æ‚ä¸€ç‚¹ï¼Œä¸ºä»€ä¹ˆè¦æ¼”å˜ä¸€ç§æ–°çš„ç®—æ³•å‘¢ï¼Ÿ</p>\n<p>æ˜¯å› ä¸ºè¿™ç§ç®—æ³•å®ƒä¸ä¼šå—è¯é¢‘å½±å“è¾ƒå¤§</p>\n<p>åœ¨ä¼ ç»Ÿçš„ tf ç®—æ³•ä¸­è¯é¢‘è¶Šé«˜ï¼Œå°†æ¥å¾—åˆ†ä¼šæ— é™å¢åŠ ã€‚ä¼šè¶Šæ¥è¶Šé«˜ï¼Œä½†æ˜¯ BM25 ç®—æ³•å‘¢ï¼Œæœ€ç»ˆçš„åˆ†ä¼šè¶‹äºä¸€ä¸ªæ°´å¹³ï¼Œä¹Ÿå°±æ˜¯å®ƒä¸ä¼šæ— é™å¢é•¿ã€‚æ‰€ä»¥ç›¸å¯¹æ¥è®²è¿™ç§ç®—æ³•ä¼šæ›´å¥½ä¸€ç‚¹å¾—åˆ†ä¼šæ›´å¹³å’Œä¸€ç‚¹ã€‚å› æ­¤åœ¨ ES é«˜ç‰ˆæœ¬ä¸­éƒ½ä¼šé‡‡ç”¨é»˜è®¤éƒ½ä¼šé‡‡ç”¨ BM25 ç®—æ³•</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310130817842.png\" alt=\"image-20231013081755494\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>elasticsearch ä¸­çš„ç›¸å…³æ€§æ‰“åˆ†ç®—æ³•æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>TF-IDFï¼šåœ¨ elasticsearch5.0 ä¹‹å‰ï¼Œä¼šéšç€è¯é¢‘å¢åŠ è€Œè¶Šæ¥è¶Šå¤§</li>\n<li>BM25ï¼šåœ¨ elasticsearch5.0 ä¹‹åï¼Œä¼šéšç€è¯é¢‘å¢åŠ è€Œå¢å¤§ï¼Œä½†å¢é•¿æ›²çº¿ä¼šè¶‹äºæ°´å¹³</li>\n</ul>\n</blockquote>\n<h5 id=\"9961-function-score-query\"><a class=\"anchor\" href=\"#9961-function-score-query\">#</a> 9.9.6.1ã€Function Score QueryğŸŒ´</h5>\n<p>ä½¿ç”¨ fucntion score query ï¼Œå¯ä»¥ä¿®æ”¹æ–‡æ¡£çš„ç›¸å…³æ€§ç®—åˆ† (query score) ï¼Œæ ¹æ®æ–°å¾—åˆ°çš„ç®—åˆ†æ’åºã€‚</p>\n<blockquote>\n<p>æˆ‘ä»¬çŸ¥é“ ES åœ¨æœç´¢æ–‡æ¡£çš„æ—¶å€™ä¼šå¯¹æ–‡æ¡£åšç›¸å…³æ€§çš„ä¸€ä¸ªæ‰“åˆ†ï¼Œæ–‡æ¡£ä¸æœç´¢å…³é”®å­—çš„ç›¸å…³åº¦è¶Šé«˜é‚£ä¹ˆæ‰“åˆ†å°±è‡ªç„¶å°±è¶Šé«˜ã€‚æ’åä¹Ÿä¼šè¶Šé å‰ã€‚ä¸è¿‡æœ‰äº›æ—¶å€™æˆ‘ä»¬å¸Œæœ›äººä¸ºçš„å»æ§åˆ¶æ–‡æ¡£çš„æ’åï¼Œæ¯”å¦‚è¯´æœ‰éƒ¨åˆ†æ–‡æ¡£äººå®¶æé’±äº†æˆ‘å°±è®©å®ƒæ’åé å‰ä¸€ç‚¹ï¼Œç®—åˆ†é«˜ä¸€ç‚¹é‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±è¦ç”¨åˆ° Function Score Query äº†ã€‚è¿™ä¸ªæŸ¥è¯¢å¯ä»¥åœ¨åŸå§‹çš„ç›¸å…³æ€§ç®—æ³•çš„åŸºç¡€ä¸ŠåŠ ä»¥ä¿®æ”¹å¾—åˆ°ä¸€ä¸ªæƒ³è¦çš„ç®—åˆ†ä»è€Œå»å½±å“æ–‡æ¡£çš„æ’å</p>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310130933092.png\" alt=\"image-20231013093343922\" /></p>\n<h6 id=\"99611-æ¡ˆä¾‹ç»™-å¦‚å®¶-è¿™ä¸ªå“ç‰Œçš„é…’åº—æ’åé å‰ä¸€äº›\"><a class=\"anchor\" href=\"#99611-æ¡ˆä¾‹ç»™-å¦‚å®¶-è¿™ä¸ªå“ç‰Œçš„é…’åº—æ’åé å‰ä¸€äº›\">#</a> 9.9.6.1.1ã€æ¡ˆä¾‹ï¼Œç»™ â€œå¦‚å®¶â€ è¿™ä¸ªå“ç‰Œçš„é…’åº—æ’åé å‰ä¸€äº›ğŸ‹</h6>\n<p>æŠŠè¿™ä¸ªé—®é¢˜ç¿»è¯‘ä¸€ä¸‹ï¼Œfunction score éœ€è¦çš„ä¸‰è¦ç´ ï¼š</p>\n<p>1ã€å“ªäº›æ–‡æ¡£éœ€è¦ç®—åˆ†åŠ æƒï¼Ÿ</p>\n<ul>\n<li>å“ç‰Œä¸ºå¦‚å®¶çš„é…’åº—</li>\n</ul>\n<p>2ã€ç®—åˆ†å‡½æ•°æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>weight å°±å¯ä»¥</li>\n</ul>\n<p>3ã€åŠ æƒæ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>æ±‚å’Œ</li>\n</ul>\n<p>å…ˆæ­£å¸¸çš„è¿›è¡ŒæŸ¥è¯¢æŸ¥çœ‹ç»“æœ</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /dkx/_search</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"function_score\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>          <span class=\"token property\">\"all\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"å¤–æ»©\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç»“æœ</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"took\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">61</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"timed_out\"</span> <span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"_shards\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"total\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token property\">\"successful\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token property\">\"skipped\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token property\">\"failed\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token property\">\"hits\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token property\">\"total\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token property\">\"value\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token property\">\"relation\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"eq\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token property\">\"max_score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">6.024319</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token property\">\"hits\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token property\">\"_index\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token property\">\"_type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token property\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"60487\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token property\">\"_score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">6.024319</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token property\">\"_source\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>          <span class=\"token property\">\"address\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"é»„æµ¦è·¯199å·\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>          <span class=\"token property\">\"brand\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å›æ‚¦\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>          <span class=\"token property\">\"business\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¤–æ»©åœ°åŒº\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>          <span class=\"token property\">\"city\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ä¸Šæµ·\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token property\">\"id\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">60487</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>          <span class=\"token property\">\"latitude\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"31.245409\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>          <span class=\"token property\">\"longitude\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"121.492969\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>          <span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ä¸Šæµ·å¤–æ»©èŒ‚æ‚¦å¤§é…’åº—\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>          <span class=\"token property\">\"pic\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"https://m.tuniucdn.com/fb3/s1/2n9c/2Swp2h1fdj9zCUKsk63BQvVgKLTo_w200_h200_c1_t0.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>          <span class=\"token property\">\"price\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">689</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>          <span class=\"token property\">\"score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>          <span class=\"token property\">\"starName\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"äº”æ˜Ÿçº§\"</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token property\">\"_index\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token property\">\"_type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token property\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"432335\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token property\">\"_score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">4.849986</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token property\">\"_source\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>          <span class=\"token property\">\"address\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å”å±±è·¯145å·\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>          <span class=\"token property\">\"brand\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"7å¤©é…’åº—\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>          <span class=\"token property\">\"business\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"åŒ—å¤–æ»©åœ°åŒº\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>          <span class=\"token property\">\"city\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ä¸Šæµ·\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>          <span class=\"token property\">\"id\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">432335</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>          <span class=\"token property\">\"latitude\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"31.252585\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>          <span class=\"token property\">\"longitude\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"121.498753\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>          <span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"7å¤©è¿é”é…’åº—(ä¸Šæµ·åŒ—å¤–æ»©å›½é™…å®¢è¿ä¸­å¿ƒåœ°é“ç«™åº—)\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>          <span class=\"token property\">\"pic\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"https://m2.tuniucdn.com/filebroker/cdn/res/c1/ba/c1baf64418437c56617f89840c6411ef_w200_h200_c1_t0.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>          <span class=\"token property\">\"price\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">249</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>          <span class=\"token property\">\"score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">35</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>          <span class=\"token property\">\"starName\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"äºŒé’»\"</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        <span class=\"token property\">\"_index\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token property\">\"_type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token property\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"434082\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>        <span class=\"token property\">\"_score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">3.8909411</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token property\">\"_source\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>          <span class=\"token property\">\"address\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¤å…´ä¸œè·¯260å·\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>          <span class=\"token property\">\"brand\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>          <span class=\"token property\">\"business\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"è±«å›­åœ°åŒº\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>          <span class=\"token property\">\"city\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ä¸Šæµ·\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>          <span class=\"token property\">\"id\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">434082</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>          <span class=\"token property\">\"latitude\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"31.220706\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>          <span class=\"token property\">\"longitude\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"121.498769\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>          <span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶é…’åº—Â·neo(ä¸Šæµ·å¤–æ»©åŸéšåº™å°å—é—¨åœ°é“ç«™åº—)\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>          <span class=\"token property\">\"pic\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"https://m.tuniucdn.com/fb2/t1/G6/M00/52/B6/Cii-U13eXLGIdHFzAAIG-5cEwDEAAGRfQNNIV0AAgcT627_w200_h200_c1_t0.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>          <span class=\"token property\">\"price\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">392</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>          <span class=\"token property\">\"score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>          <span class=\"token property\">\"starName\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"äºŒé’»\"</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° â€œå¦‚å®¶é…’åº—â€ æ’åœ¨æœ€åä¸€ä¸ªæˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„ä»£ç è®©å…¶æ’åä¸ºç¬¬ä¸€</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /dkx/_search</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"function_score\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>          <span class=\"token property\">\"all\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"å¤–æ»©\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token property\">\"functions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token comment\">// ç®—åˆ†å‡½æ•°</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>          <span class=\"token property\">\"filter\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// æ»¡è¶³çš„æ¡ä»¶ï¼Œå“ç‰Œå¿…é¡»æ˜¯å¦‚å®¶</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token property\">\"term\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>              <span class=\"token property\">\"brand\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>          <span class=\"token property\">\"weight\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span> <span class=\"token comment\">// ç®—åˆ†æƒé‡ä¸º 10</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token property\">\"boost_mode\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"sum\"</span> <span class=\"token comment\">// ç®—åˆ†æ¨¡å¼ä½¿ç”¨ fucntion_score ä¸ query_score ç›¸é™¤çš„æ–¹å¼ç®—åˆ†</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç»“æœï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"took\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">72</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"timed_out\"</span> <span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"_shards\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"total\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token property\">\"successful\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token property\">\"skipped\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token property\">\"failed\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token property\">\"hits\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token property\">\"total\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token property\">\"value\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token property\">\"relation\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"eq\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token property\">\"max_score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">13.890942</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token property\">\"hits\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token property\">\"_index\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token property\">\"_type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token property\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"434082\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token property\">\"_score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">13.890942</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token property\">\"_source\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>          <span class=\"token property\">\"address\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¤å…´ä¸œè·¯260å·\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>          <span class=\"token property\">\"brand\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>          <span class=\"token property\">\"business\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"è±«å›­åœ°åŒº\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>          <span class=\"token property\">\"city\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ä¸Šæµ·\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token property\">\"id\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">434082</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>          <span class=\"token property\">\"latitude\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"31.220706\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>          <span class=\"token property\">\"longitude\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"121.498769\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>          <span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶é…’åº—Â·neo(ä¸Šæµ·å¤–æ»©åŸéšåº™å°å—é—¨åœ°é“ç«™åº—)\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>          <span class=\"token property\">\"pic\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"https://m.tuniucdn.com/fb2/t1/G6/M00/52/B6/Cii-U13eXLGIdHFzAAIG-5cEwDEAAGRfQNNIV0AAgcT627_w200_h200_c1_t0.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>          <span class=\"token property\">\"price\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">392</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>          <span class=\"token property\">\"score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>          <span class=\"token property\">\"starName\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"äºŒé’»\"</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token property\">\"_index\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token property\">\"_type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token property\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"60487\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token property\">\"_score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">7.024319</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token property\">\"_source\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>          <span class=\"token property\">\"address\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"é»„æµ¦è·¯199å·\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>          <span class=\"token property\">\"brand\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å›æ‚¦\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>          <span class=\"token property\">\"business\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¤–æ»©åœ°åŒº\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>          <span class=\"token property\">\"city\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ä¸Šæµ·\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>          <span class=\"token property\">\"id\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">60487</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>          <span class=\"token property\">\"latitude\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"31.245409\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>          <span class=\"token property\">\"longitude\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"121.492969\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>          <span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ä¸Šæµ·å¤–æ»©èŒ‚æ‚¦å¤§é…’åº—\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>          <span class=\"token property\">\"pic\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"https://m.tuniucdn.com/fb3/s1/2n9c/2Swp2h1fdj9zCUKsk63BQvVgKLTo_w200_h200_c1_t0.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>          <span class=\"token property\">\"price\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">689</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>          <span class=\"token property\">\"score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>          <span class=\"token property\">\"starName\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"äº”æ˜Ÿçº§\"</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        <span class=\"token property\">\"_index\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token property\">\"_type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token property\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"432335\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>        <span class=\"token property\">\"_score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">5.849986</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token property\">\"_source\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>          <span class=\"token property\">\"address\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å”å±±è·¯145å·\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>          <span class=\"token property\">\"brand\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"7å¤©é…’åº—\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>          <span class=\"token property\">\"business\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"åŒ—å¤–æ»©åœ°åŒº\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>          <span class=\"token property\">\"city\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ä¸Šæµ·\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>          <span class=\"token property\">\"id\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">432335</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>          <span class=\"token property\">\"latitude\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"31.252585\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>          <span class=\"token property\">\"longitude\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"121.498753\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>          <span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"7å¤©è¿é”é…’åº—(ä¸Šæµ·åŒ—å¤–æ»©å›½é™…å®¢è¿ä¸­å¿ƒåœ°é“ç«™åº—)\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>          <span class=\"token property\">\"pic\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"https://m2.tuniucdn.com/filebroker/cdn/res/c1/ba/c1baf64418437c56617f89840c6411ef_w200_h200_c1_t0.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>          <span class=\"token property\">\"price\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">249</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>          <span class=\"token property\">\"score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">35</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>          <span class=\"token property\">\"starName\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"äºŒé’»\"</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p><strong>æ€»ç»“</strong>:</p>\n<p>function score query å®šä¹‰çš„ä¸‰è¦ç´ æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>è¿‡æ»¤æ¡ä»¶ï¼šå“ªäº›æ–‡æ¡£è¦åŠ åˆ†</li>\n<li>ç®—åˆ†å‡½æ•°ï¼šå¦‚ä½•è®¡ç®— function score</li>\n<li>åŠ æƒæ–¹å¼ï¼šfunction score ä¸ query score å¦‚ä½•è¿ç®—</li>\n</ul>\n</blockquote>\n<h5 id=\"9962-boolean-query\"><a class=\"anchor\" href=\"#9962-boolean-query\">#</a> 9.9.6.2ã€Boolean QueryğŸŒ´</h5>\n<p>å¸ƒå°”æŸ¥è¯¢æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæŸ¥è¯¢å­å¥çš„ç»„åˆã€‚å­æŸ¥è¯¢çš„ç»„åˆæ–¹å¼æœ‰ï¼š</p>\n<ul>\n<li>mustï¼šå¿…é¡»åŒ¹é…æ¯ä¸ªå­æŸ¥è¯¢ï¼Œç±»ä¼¼ â€œä¸â€</li>\n<li>shouldï¼šé€‰æ‹©æ€§åŒ¹é…å­æŸ¥è¯¢ï¼Œç±»ä¼¼ â€œæˆ–â€</li>\n<li>must_notï¼šå¿…é¡»ä¸åŒ¹é…ï¼Œä¸å‚ä¸ç®—åˆ†ï¼Œç±»ä¼¼ â€œéâ€</li>\n<li>filterï¼šå¿…é¡»åŒ¹é…ï¼Œä¸å‚ä¸ç®—åˆ†</li>\n</ul>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /indexName/_seach</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token property\">\"bool\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>         <span class=\"token comment\">//must é‡Œé¢æ˜¯ä¸€ä¸ªæ•°ç»„ä¹Ÿå°±æ˜¯è¯´å¯ä»¥å®šä¹‰å¤šä¸ªæŸ¥è¯¢æ¡ä»¶</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>         <span class=\"token property\">\"must\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token comment\">// è¦æ±‚æŸ¥è¯¢çš„åŸå¸‚å¿…é¡» æ˜¯ \"ä¸Šæµ·\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"term\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"city\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ä¸Šæµ·\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>         <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>         <span class=\"token property\">\"should\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token comment\">// ä¸¤ä¸ªå“ç‰Œä¸­çš„ä»»æ„ä¸€ä¸ªéƒ½å¯ä»¥å› ä¸ºæ˜¯ \"æˆ–\" çš„å…³ç³» ä¸€ä¸ªæœ‰è¡¨ç¤ºä¸º true</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"term\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"brand\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"çš‡å† å‡æ—¥\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"term\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"brand\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"åç¾è¾¾\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>         <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>         <span class=\"token property\">\"must_not\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token comment\">// å–åï¼Œlte æ˜¯å°äºç­‰äºï¼Œç”±äºå–åæ“ä½œ æ‰€ä»¥æ˜¯æŸ¥è¯¢ä»·æ ¼ å¤§äºç­‰äº 500 çš„</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"range\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"lte\"</span><span class=\"token operator\">:</span> <span class=\"token number\">500</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>         <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>         <span class=\"token property\">\"filter\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token comment\">// è¿‡æ»¤ï¼ŒæŸ¥è¯¢ç”¨æˆ·è¯„ä»·åˆ†å¤§äº 45 åˆ†çš„</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"range\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"score\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"gte\"</span><span class=\"token operator\">:</span> <span class=\"token number\">45</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>         <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h6 id=\"99621-åˆ©ç”¨boolæŸ¥è¯¢å®ç°åŠŸèƒ½\"><a class=\"anchor\" href=\"#99621-åˆ©ç”¨boolæŸ¥è¯¢å®ç°åŠŸèƒ½\">#</a> 9.9.6.2.1ã€åˆ©ç”¨ bool æŸ¥è¯¢å®ç°åŠŸèƒ½ğŸ‹</h6>\n<p><strong>éœ€æ±‚</strong>ï¼šæœç´¢åå­—åŒ…å« â€œå¦‚å®¶â€ ï¼Œ ä»·æ ¼ä¸é«˜äº 400ï¼Œåœ¨åæ ‡ 31.21ï¼Œ121.5 å‘¨å›´ 10km èŒƒå›´å†…çš„é…’åº—ã€‚</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /dkx/_search <span class=\"token comment\">// GET è¯·æ±‚ / ç´¢å¼•åº“å / æŸ¥è¯¢å…¨éƒ¨æ–‡æ¡£</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"bool\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"must\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>          <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token property\">\"must_not\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>          <span class=\"token property\">\"range\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>              <span class=\"token property\">\"gt\"</span><span class=\"token operator\">:</span> <span class=\"token number\">400</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token property\">\"filter\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>          <span class=\"token property\">\"geo_distance\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token property\">\"distance\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"10km\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token property\">\"location\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>              <span class=\"token property\">\"lat\"</span><span class=\"token operator\">:</span> <span class=\"token number\">31.21</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>              <span class=\"token property\">\"lon\"</span><span class=\"token operator\">:</span> <span class=\"token number\">121.5</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç»“æœï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"took\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">173</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"timed_out\"</span> <span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"_shards\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"total\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token property\">\"successful\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token property\">\"skipped\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token property\">\"failed\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token property\">\"hits\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token property\">\"total\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token property\">\"value\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token property\">\"relation\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"eq\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token property\">\"max_score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1.716119</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token property\">\"hits\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token property\">\"_index\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token property\">\"_type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token property\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"433576\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token property\">\"_score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1.716119</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token property\">\"_source\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>          <span class=\"token property\">\"address\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å—äº¬ä¸œè·¯480å·ä¿å®‰åŠå†…\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>          <span class=\"token property\">\"brand\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>          <span class=\"token property\">\"business\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"äººæ°‘å¹¿åœºåœ°åŒº\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>          <span class=\"token property\">\"city\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ä¸Šæµ·\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token property\">\"id\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">433576</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>          <span class=\"token property\">\"location\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"31.236454, 121.480948\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>          <span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶é…’åº—(ä¸Šæµ·å—äº¬è·¯æ­¥è¡Œè¡—åº—)\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>          <span class=\"token property\">\"pic\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"https://m.tuniucdn.com/fb2/t1/G6/M00/52/BA/Cii-U13eXVaIQmdaAAWxgzdXXxEAAGRrgNIOkoABbGb143_w200_h200_c1_t0.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>          <span class=\"token property\">\"price\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">379</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>          <span class=\"token property\">\"score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>          <span class=\"token property\">\"starName\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"äºŒé’»\"</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token property\">\"_index\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token property\">\"_type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token property\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"434082\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token property\">\"_score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1.5234909</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token property\">\"_source\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>          <span class=\"token property\">\"address\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¤å…´ä¸œè·¯260å·\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>          <span class=\"token property\">\"brand\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>          <span class=\"token property\">\"business\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"è±«å›­åœ°åŒº\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>          <span class=\"token property\">\"city\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ä¸Šæµ·\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>          <span class=\"token property\">\"id\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">434082</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>          <span class=\"token property\">\"location\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"31.220706, 121.498769\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>          <span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶é…’åº—Â·neo(ä¸Šæµ·å¤–æ»©åŸéšåº™å°å—é—¨åœ°é“ç«™åº—)\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>          <span class=\"token property\">\"pic\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"https://m.tuniucdn.com/fb2/t1/G6/M00/52/B6/Cii-U13eXLGIdHFzAAIG-5cEwDEAAGRfQNNIV0AAgcT627_w200_h200_c1_t0.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>          <span class=\"token property\">\"price\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">392</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>          <span class=\"token property\">\"score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>          <span class=\"token property\">\"starName\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"äºŒé’»\"</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token property\">\"_index\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token property\">\"_type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        <span class=\"token property\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"1584362548\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token property\">\"_score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1.4174237</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token property\">\"_source\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>          <span class=\"token property\">\"address\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¾¡é’è·¯315-317å·\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>          <span class=\"token property\">\"brand\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>          <span class=\"token property\">\"business\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å‘¨æµ¦åº·æ¡¥åœ°åŒº\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>          <span class=\"token property\">\"city\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ä¸Šæµ·\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>          <span class=\"token property\">\"id\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1584362548</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>          <span class=\"token property\">\"location\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"31.15719, 121.572392\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>          <span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶é…’åº—(ä¸Šæµ·æµ¦ä¸œå›½é™…æ—…æ¸¸åº¦å‡åŒºå¾¡æ¡¥åœ°é“ç«™åº—)\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>          <span class=\"token property\">\"pic\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"https://m.tuniucdn.com/fb3/s1/2n9c/2ybd3wqdoBtBeKcPxmyso9y1hNXa_w200_h200_c1_t0.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>          <span class=\"token property\">\"price\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">339</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>          <span class=\"token property\">\"score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>          <span class=\"token property\">\"starName\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"äºŒé’»\"</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>bool æŸ¥è¯¢æœ‰å‡ ç§é€»è¾‘å…³ç³»ï¼Ÿ</p>\n<ul>\n<li>mustï¼šå¿…é¡»åŒ¹é…çš„æ¡ä»¶ï¼Œå¯ä»¥ç†è§£ä¸º â€œä¸â€</li>\n<li>shouldï¼šé€‰æ‹©æ€§åŒ¹é…çš„æ¡ä»¶ï¼Œå¯ä»¥ç†è§£ä¸º â€œæˆ–â€</li>\n<li>must_notï¼šå¿…é¡»ä¸åŒ¹é…çš„æ¡ä»¶ï¼Œä¸å‚ä¸æ‰“åˆ†</li>\n<li>filterï¼šå¿…é¡»åŒ¹é…çš„æ¡ä»¶ï¼Œä¸å‚ä¸æ‰“åˆ†</li>\n</ul>\n</blockquote>\n<h4 id=\"996-æœç´¢ç»“æœå¤„ç†\"><a class=\"anchor\" href=\"#996-æœç´¢ç»“æœå¤„ç†\">#</a> 9.9.6ã€æœç´¢ç»“æœå¤„ç†ğŸŒ²</h4>\n<ul>\n<li>æ’åº</li>\n<li>åˆ†é¡µ</li>\n<li>é«˜äº®</li>\n</ul>\n<h5 id=\"9961-æ’åº\"><a class=\"anchor\" href=\"#9961-æ’åº\">#</a> 9.9.6.1ã€æ’åºğŸŒ´</h5>\n<p>elasticsearch æ”¯æŒå¯¹æœç´¢ç»“æœæ’åºï¼Œé»˜è®¤æ˜¯æ ¹æ®ç›¸å…³åº¦ç®—åˆ† (_score) æ¥æ’åºã€‚å¯ä»¥æ’åºå­—æ®µç±»å‹æœ‰ï¼škeyword ç±»å‹ï¼Œæ•°å€¼ç±»å‹ï¼Œåœ°ç†åæ ‡ç±»å‹ï¼Œæ—¥æœŸç±»å‹ç­‰ã€‚</p>\n<p><strong>&lt;font color='red'&gt; æ³¨æ„ &lt;/font&gt;.</strong>ï¼šä¸€æ—¦è¿›è¡Œæ’åº score å°±ä¼šæ”¾å¼ƒæ‰“åˆ†ï¼Œå› ä¸ºæ‰“åˆ†å°±æ²¡æœ‰æ„ä¹‰äº†</p>\n<p>å­—æ®µ</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /indexName/_search</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token property\">\"match_all\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token property\">\"sort\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>         <span class=\"token property\">\"FIELD\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"desc\"</span> <span class=\"token comment\">// æ’åºå­—æ®µå’Œæ’åºæ–¹å¼ ASC , DESC</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ°ç†åæ ‡</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /indexName/_search</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token property\">\"match_all\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token property\">\"sort\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>         <span class=\"token property\">\"_geo_distance\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token property\">\"FIELD\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"çº¬åº¦ï¼Œç»åº¦\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token property\">\"order\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"asc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token property\">\"unit\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"km\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h6 id=\"99611-æ¡ˆä¾‹å¯¹é…’åº—æ•°æ®æŒ‰ç…§ç”¨æˆ·è¯„ä»·é™åºæ’åºè¯„ä»·ç›¸åŒçš„æŒ‰ç…§ä»·æ ¼å‡åºæ’åº\"><a class=\"anchor\" href=\"#99611-æ¡ˆä¾‹å¯¹é…’åº—æ•°æ®æŒ‰ç…§ç”¨æˆ·è¯„ä»·é™åºæ’åºè¯„ä»·ç›¸åŒçš„æŒ‰ç…§ä»·æ ¼å‡åºæ’åº\">#</a> 9.9.6.1.1ã€æ¡ˆä¾‹ï¼Œå¯¹é…’åº—æ•°æ®æŒ‰ç…§ç”¨æˆ·è¯„ä»·é™åºæ’åºï¼Œè¯„ä»·ç›¸åŒçš„æŒ‰ç…§ä»·æ ¼å‡åºæ’åºğŸ‹</h6>\n<p>è¯„ä»·æ˜¯ score å­—æ®µï¼Œä»·æ ¼æ˜¯ price å­—æ®µï¼ŒæŒ‰ç…§é¡ºåºæ·»åŠ ä¸¤ä¸ªæ’åºè§„åˆ™å³å¯ã€‚</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /dkx/_search</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"match_all\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token property\">\"sort\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token property\">\"score\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"desc\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"asc\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h6 id=\"99612-æ¡ˆä¾‹å®ç°å¯¹é…’åº—æ•°æ®æŒ‰ç…§åˆ°ä½ çš„ä½ç½®åæ ‡è·ç¦»å‡åºæ’åº\"><a class=\"anchor\" href=\"#99612-æ¡ˆä¾‹å®ç°å¯¹é…’åº—æ•°æ®æŒ‰ç…§åˆ°ä½ çš„ä½ç½®åæ ‡è·ç¦»å‡åºæ’åº\">#</a> 9.9.6.1.2ã€æ¡ˆä¾‹ï¼Œå®ç°å¯¹é…’åº—æ•°æ®æŒ‰ç…§åˆ°ä½ çš„ä½ç½®åæ ‡è·ç¦»å‡åºæ’åºğŸ‹</h6>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre># æ‰¾åˆ° <span class=\"token number\">31.034661</span><span class=\"token punctuation\">,</span> <span class=\"token number\">121.612282</span> å‘¨å›´çš„é…’åº—ï¼Œè·ç¦»å‡åºæ’åº</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>GET /dkx/_search</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"match_all\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token property\">\"sort\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token property\">\"_geo_distance\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        # locationçš„ä¸¤ç§å†™æ³•éƒ½å¯ä»¥</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        # <span class=\"token property\">\"location\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"31.034661, 121.612282\"</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token property\">\"location\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>          <span class=\"token property\">\"lat\"</span><span class=\"token operator\">:</span> <span class=\"token number\">31.034661</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>          <span class=\"token property\">\"lon\"</span><span class=\"token operator\">:</span> <span class=\"token number\">121.612282</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token property\">\"order\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"desc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token property\">\"unit\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"km\"</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h5 id=\"9962-åˆ†é¡µ\"><a class=\"anchor\" href=\"#9962-åˆ†é¡µ\">#</a> 9.9.6.2ã€åˆ†é¡µğŸŒ´</h5>\n<p>elasticsearch é»˜è®¤æƒ…å†µä¸‹åªè¿”å› top 10 çš„æ•°æ®ã€‚è€Œå¦‚æœè¦æŸ¥è¯¢æ›´å¤šæ•°æ®å°±éœ€è¦ä¿®æ”¹åˆ†é¡µå‚æ•°äº†ã€‚</p>\n<p>elasticsearch ä¸­é€šè¿‡ä¿®æ”¹ fromï¼Œsize å‚æ•°æ¥æ§åˆ¶è¦è¿”å›çš„åˆ†é¡µç»“æœï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /indexName/_search</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token property\">\"match_all\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token property\">\"from\"</span><span class=\"token operator\">:</span> <span class=\"token number\">990</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// åˆ†é¡µå¼€å§‹çš„ä½ç½®ï¼Œé»˜è®¤ä¸º 0</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// æœŸæœ›è·å–çš„æ–‡æ¡£æ€»æ•°</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token property\">\"sort\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>         <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"dsc\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><mark>è®¡ç®—å…¬å¼</mark>ï¼šfrom - 1 * size = å½“å‰é¡µæ•°</p>\n<p>è™½ç„¶ ES çš„åˆ†é¡µæŸ¥è¯¢ä¸ mysql å¾ˆåƒä½†æ˜¯å…¶åº•å±‚åŸç†æœ‰å¾ˆå¤§å·®åˆ«ã€‚ES åº•å±‚é‡‡ç”¨çš„æ˜¯å€’æ’ç´¢å¼•ï¼Œå®ƒçš„ç»“æ„å…¶å®æ˜¯ä¸åˆ©äºåšåˆ†é¡µçš„ï¼Œæ‰€ä»¥ ES é‡‡ç”¨çš„æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç§åˆ†é¡µï¼Œæ¯”æ–¹è¯´è¦æŸ¥ <code>990~1000</code>  è¿™æ˜¯æ¡æ•°æ®ã€‚å¯¹äº ES æ¥è¯´å®ƒåªèƒ½æŸ¥å‡ºä» <code>0~1000</code>  ä¸ªæ‰€æœ‰çš„æ•°æ®ï¼Œç„¶åå»æˆªå– <code>990~1000</code>  çš„ä¸€éƒ¨åˆ†æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310131132651.png\" alt=\"image-20231013113208351\" /></p>\n<p>è¿™ç§æƒ…å†µåœ¨å•ç‚¹æŸ¥è¯¢çš„æ—¶å€™æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ˜¯é›†ç¾¤ ES å°±ä¼šæŠŠæ•°æ®è¿›è¡Œæ‹†åˆ†ï¼Œæ”¾åˆ°ä¸åŒçš„æœºå™¨ä¸Šã€‚æ‹†åˆ†çš„æ¯ä¸€ä»½ç§°ä¸ºåˆ†ç‰‡ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ç‰‡ä¸Šçš„æ•°æ®éƒ½ä¸ä¸€æ ·</p>\n<h6 id=\"99621-æ·±åº¦åˆ†é¡µé—®é¢˜\"><a class=\"anchor\" href=\"#99621-æ·±åº¦åˆ†é¡µé—®é¢˜\">#</a> 9.9.6.2.1ã€æ·±åº¦åˆ†é¡µé—®é¢˜ğŸ‹</h6>\n<p>ES æ˜¯åˆ†å¸ƒå¼çš„ï¼Œæ‰€ä»¥ä¼šé¢ä¸´æ·±åº¦åˆ†é¡µé—®é¢˜ã€‚ä¾‹å¦‚æŒ‰ price æ’åºåï¼Œè·å– from=990ï¼Œsize=10 çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310131135634.png\" alt=\"image-20231013113540176\" /></p>\n<p>1ã€é¦–å…ˆåœ¨æ¯ä¸ªæ•°æ®åˆ†ç‰‡ä¸Šéƒ½æ’åºå¹¶æŸ¥è¯¢åˆ° 1000 æ¡æ–‡æ¡£</p>\n<p>2ã€ç„¶åå°†æ‰€æœ‰èŠ‚ç‚¹çš„ç»“æœèšåˆï¼Œåœ¨å†…å­˜ä¸­é‡æ–°æ’åºé€‰å‡ºå‰ 1000 æ¡æ–‡æ¡£</p>\n<p>3ã€æœ€åä»è¿™ 1000 æ¡ä¸­ï¼Œé€‰å–ä» 990 å¼€å§‹çš„ 10 æ¡æ–‡æ¡£</p>\n<p>å¦‚æœæœç´¢é¡µæ•°è¿‡æ·±ï¼Œæˆ–è€…ç»“æœé›† (from + size) è¶Šå¤§ï¼Œå¯¹å†…å­˜å’Œ CPU çš„æ¶ˆè€—ä¹Ÿè¶Šé«˜ã€‚å› æ­¤ ES è®¾å®šç»“æœé›†æŸ¥è¯¢çš„ä¸Šé™æ˜¯ 10000</p>\n<p>å¦‚ä¸‹æ¼”ç¤ºè¶…å‡º 10000 æ¡ä¼šæ€ä¹ˆæ ·</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /dkx/_search</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"match_all\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token property\">\"from\"</span><span class=\"token operator\">:</span> <span class=\"token number\">9990</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token property\">\"sort\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"asc\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">//----------------------- æŸ¥è¯¢ç»“æœ -----------------------</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token property\">\"took\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">33</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token property\">\"timed_out\"</span> <span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token property\">\"_shards\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token property\">\"total\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token property\">\"successful\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token property\">\"skipped\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token property\">\"failed\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token property\">\"hits\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token property\">\"total\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token property\">\"value\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">201</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token property\">\"relation\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"eq\"</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token property\">\"max_score\"</span> <span class=\"token operator\">:</span> <span class=\"token null keyword\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token property\">\"hits\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>9990 - 1 * 10 ä¹Ÿå°±æ˜¯åˆšå¥½ 10000 æ¡æ•°æ®ï¼Œä½†æ˜¯å¦‚æœåŠ  1</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /dkx/_search</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"match_all\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token property\">\"from\"</span><span class=\"token operator\">:</span> <span class=\"token number\">9991</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token property\">\"sort\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"asc\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310131143199.png\" alt=\"image-20231013114259949\" /></p>\n<p>æŸ¥è¯¢æŠ¥é”™äº†</p>\n<h6 id=\"99622-æ·±åº¦åˆ†é¡µè§£å†³æ–¹æ¡ˆ\"><a class=\"anchor\" href=\"#99622-æ·±åº¦åˆ†é¡µè§£å†³æ–¹æ¡ˆ\">#</a> 9.9.6.2.2ã€æ·±åº¦åˆ†é¡µè§£å†³æ–¹æ¡ˆğŸ‹</h6>\n<p>é’ˆå¯¹æ·±åº¦åˆ†é¡µï¼ŒES æä¾›äº†ä¸¤ç§è§£å†³æ–¹æ¡ˆ</p>\n<ul>\n<li>search afterï¼šåˆ†é¡µæ—¶éœ€è¦æ’åºï¼ŒåŸç†æ˜¯ä»ä¸Šä¸€æ¬¡çš„æ’åºå€¼å¼€å§‹ï¼ŒæŸ¥è¯¢ä¸‹ä¸€é¡µæ•°æ®ã€‚å®˜æ–¹æ¨èä½¿ç”¨çš„æ–¹å¼ã€‚</li>\n<li>scrollï¼šåŸç†å°†æ’åºæ•°æ®å½¢æˆå¿«ç…§ï¼Œä¿å­˜åœ¨å†…å­˜ã€‚å®˜æ–¹å·²ç»ä¸æ¨èä½¿ç”¨ã€‚</li>\n</ul>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>from + size</p>\n<ul>\n<li>ä¼˜ç‚¹ï¼šæ”¯æŒéšæœºç¿»é¡µ</li>\n<li>ç¼ºç‚¹ï¼šæ·±åº¦åˆ†é¡µé—®é¢˜ï¼Œé»˜è®¤æŸ¥è¯¢ä¸Šé™ (from + size) æ˜¯ 10000</li>\n<li>åœºæ™¯ï¼šç™¾åº¦ï¼Œäº¬ä¸œï¼Œè°·æ­Œï¼Œæ·˜å®è¿™æ ·çš„éšæœºç¿»é¡µæœç´¢</li>\n</ul>\n<p>after searchï¼š</p>\n<ul>\n<li>ä¼˜ç‚¹ï¼šæ²¡æœ‰æŸ¥è¯¢ä¸Šé™ (å•æ¬¡æŸ¥è¯¢çš„ size ä¸è¶…è¿‡ 10000)</li>\n<li>ç¼ºç‚¹ï¼šåªèƒ½å‘åé€é¡µæŸ¥è¯¢ï¼Œä¸æ”¯æŒéšæœºç¿»é¡µ</li>\n<li>åœºæ™¯ï¼šæ²¡æœ‰éšæœºç¿»é¡µéœ€æ±‚çš„æœç´¢ï¼Œä¾‹å¦‚æ‰‹æœºå‘ä¸‹æ»šåŠ¨ç¿»é¡µ</li>\n</ul>\n<p>scrollï¼š</p>\n<ul>\n<li>ä¼˜ç‚¹ï¼šæ²¡æœ‰æŸ¥è¯¢ä¸Šé™ (å•æ¬¡æŸ¥è¯¢çš„ size ä¸è¶…è¿‡ 10000)</li>\n<li>ç¼ºç‚¹ï¼šä¼šæœ‰é¢å¤–å†…å­˜æ¶ˆè€—ï¼Œå¹¶ä¸”æœç´¢ç»“æœæ˜¯éå®æ—¶çš„</li>\n<li>åœºæ™¯ï¼šæµ·é‡æ•°æ®çš„è·å–å’Œè¿ç§»ã€‚ä» ES7.1 å¼€å§‹ä¸æ¨èï¼Œå»ºè®®ä½¿ç”¨ after search æ–¹æ¡ˆã€‚</li>\n</ul>\n</blockquote>\n<h5 id=\"9963-é«˜äº®\"><a class=\"anchor\" href=\"#9963-é«˜äº®\">#</a> 9.9.6.3ã€é«˜äº®ğŸŒ´</h5>\n<p><strong>é«˜äº®</strong>ï¼šå°±æ˜¯åœ¨æœç´¢ç»“æœä¸­æŠŠæœç´¢å…³é”®å­—çªå‡ºæ˜¾ç¤ºã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310131156938.png\" alt=\"image-20231013115559310\" /></p>\n<p>åŸç†æ˜¯è¿™æ ·çš„ï¼š</p>\n<ul>\n<li>å°†æœç´¢ç»“æœä¸­çš„å…³é”®å­—ç”¨æ ‡ç­¾æ ‡è®°å‡ºæ¥</li>\n<li>åœ¨é¡µé¢ä¸­ç»™æ ‡ç­¾æ·»åŠ  css æ ·å¼</li>\n</ul>\n<p>è¯­æ³•ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /indexName/_search</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>         <span class=\"token property\">\"FIELD\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"TEXT\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token property\">\"highlight\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token property\">\"fields\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// æŒ‡å®šè¦é«˜äº®çš„å­—æ®µ</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>         <span class=\"token property\">\"FIELD\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token property\">\"pre_tags\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;em>\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// ç”¨æ¥æ ‡è®°é«˜äº®å­—æ®µçš„å‰ç½®æ ‡ç­¾</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token property\">\"post_tags\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;/em>\"</span> <span class=\"token comment\">// ç”¨æ¥æ ‡è®°é«˜äº®å­—æ®µçš„åç½®æ ‡ç­¾</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä»£ç æ¼”ç¤ºï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre># é«˜äº®æŸ¥è¯¢ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒESæœç´¢å­—æ®µå¿…é¡»ä¸é«˜äº®å­—æ®µä¸€è‡´ï¼Œå¦åˆ™ä¸ä¼šé«˜äº®</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>GET /dkx/_search</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token property\">\"all\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token property\">\"highlight\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token property\">\"fields\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">//------------------- ç»“æœ -------------------</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token property\">\"_index\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token property\">\"_type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token property\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"339952837\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token property\">\"_score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2.7569861</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token property\">\"_source\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>          <span class=\"token property\">\"address\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"è‰¯ä¹¡è¥¿è·¯7å·\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>          <span class=\"token property\">\"brand\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>          <span class=\"token property\">\"business\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"æˆ¿å±±é£æ™¯åŒº\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token property\">\"city\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"åŒ—äº¬\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>          <span class=\"token property\">\"id\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">339952837</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>          <span class=\"token property\">\"location\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"39.73167, 116.132482\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>          <span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶é…’åº—(åŒ—äº¬è‰¯ä¹¡è¥¿è·¯åº—)\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>          <span class=\"token property\">\"pic\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"https://m.tuniucdn.com/fb3/s1/2n9c/3Dpgf5RTTzrxpeN5y3RLnRVtxMEA_w200_h200_c1_t0.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>          <span class=\"token property\">\"price\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">159</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>          <span class=\"token property\">\"score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">46</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>          <span class=\"token property\">\"starName\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"äºŒé’»\"</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>&lt;font color='red'&gt; æ³¨æ„ &lt;/font&gt;ï¼šé«˜äº®æŸ¥è¯¢ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒES æœç´¢å­—æ®µå¿…é¡»ä¸é«˜äº®å­—æ®µä¸€è‡´ï¼Œå¦åˆ™ä¸ä¼šé«˜äº®</p>\n<p>æ¼”ç¤ºä»£ç ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre># é«˜äº®æŸ¥è¯¢ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒESæœç´¢å­—æ®µå¿…é¡»ä¸é«˜äº®å­—æ®µä¸€è‡´ï¼Œå¦åˆ™ä¸ä¼šé«˜äº®</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>GET /dkx/_search</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token property\">\"highlight\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token property\">\"fields\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">//----------------------------- ç»“æœ -----------------------------</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token string\">\"&lt;em>å¦‚å®¶&lt;/em>é…’åº—(åŒ—äº¬è‰¯ä¹¡è¥¿è·¯åº—)\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° name å­—æ®µåŠ ä¸Šäº†é«˜äº®æ ‡ç­¾äº†ï¼Œä½†æ˜¯ ã€‚æˆ‘ä¸å¸Œæœ›åœ¨æŸ¥è¯¢ä¸­æŒ‡å®š name å­—æ®µå› ä¸º all æœç´¢åˆ°çš„æ›´å¤š</p>\n<p>è§£å†³åŠæ³•å¦‚ä¸‹ï¼š</p>\n<p>&quot;require_field_match&quot;: &quot;true&quot; ï¼šæ˜¯å¦éœ€è¦å­—æ®µé«˜äº®åŒ¹é…ï¼Œé»˜è®¤æ˜¯ true éœ€è¦é«˜äº®å­—æ®µä¸æŸ¥è¯¢å­—æ®µåŒ¹é…</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre># é«˜äº®æŸ¥è¯¢ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒESæœç´¢å­—æ®µå¿…é¡»ä¸é«˜äº®å­—æ®µä¸€è‡´ï¼Œå¦åˆ™ä¸ä¼šé«˜äº®</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>GET /dkx/_search</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token property\">\"all\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token property\">\"highlight\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token property\">\"fields\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>         <span class=\"token comment\">// ä¿®æ”¹ä¸º false è®©å…¶ä¸ä¸æŸ¥è¯¢å­—æ®µåŒ¹é…å°±å¯ä»¥é«˜äº®äº†\t</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token property\">\"require_field_match\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"false\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>æœç´¢ç»“æœå¤„ç†æ•´ä½“è¯­æ³•ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /dkx/_search</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>       <span class=\"token property\">\"all\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token property\">\"from\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// åˆ†é¡µå¼€å§‹çš„ä½ç½®</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// æœŸæœ›è·å–çš„æ–‡æ¡£æ€»æ•°</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token property\">\"sort\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>         <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"asc\"</span> <span class=\"token comment\">// æ™®é€šæ’åº</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>         <span class=\"token property\">\"_geo_distance\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// è·ç¦»æ’åº</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token property\">\"location\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"31.040699,121.618075\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token property\">\"order\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"asc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token property\">\"unit\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"km\"</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token property\">\"highlight\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token property\">\"fields\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// é«˜äº®å­—æ®µ</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>         <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token property\">\"pre_tags\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;em>\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// ç”¨æ¥æ ‡è®°é«˜äº®å­—æ®µçš„å‰ç½®æ ‡ç­¾</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token property\">\"post_tags\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;/em>\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// ç”¨æ¥æ ‡è®°é«˜äº®å­—æ®µçš„åç½®æ ‡ç­¾</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token property\">\"require_field_match\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"false\"</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></blockquote>\n<h4 id=\"997-restclientæŸ¥è¯¢æ–‡æ¡£\"><a class=\"anchor\" href=\"#997-restclientæŸ¥è¯¢æ–‡æ¡£\">#</a> 9.9.7ã€RestClient æŸ¥è¯¢æ–‡æ¡£ğŸŒ²</h4>\n<ul>\n<li>å¿«é€Ÿå…¥é—¨</li>\n<li>match æŸ¥è¯¢</li>\n<li>ç²¾ç¡®æŸ¥è¯¢</li>\n<li>å¤åˆæŸ¥è¯¢</li>\n<li>æ’åºï¼Œåˆ†é¡µï¼Œé«˜äº®</li>\n</ul>\n<h5 id=\"9971-å¿«é€Ÿå…¥é—¨\"><a class=\"anchor\" href=\"#9971-å¿«é€Ÿå…¥é—¨\">#</a> 9.9.7.1ã€å¿«é€Ÿå…¥é—¨ğŸŒ´</h5>\n<p>æˆ‘ä»¬é€šè¿‡ match_all æ¥æ¼”ç¤ºä¸‹åŸºæœ¬çš„ APIï¼Œå…ˆçœ‹è¯·æ±‚ DSL çš„ç»„ç»‡ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310131223853.png\" alt=\"image-20231013122353640\" /></p>\n<p>æ ¸å¿ƒçš„ APIï¼š</p>\n<p>request.source()ï¼š</p>\n<p>é‡Œé¢å°è£…äº†ï¼šæ’åºï¼Œåˆ†é¡µï¼Œé«˜äº®ç­‰æ‰€æœ‰åŠŸèƒ½ã€‚</p>\n<p>QueryBuildersï¼š</p>\n<p>é‡Œé¢æœ‰å„ç§å„æ ·çš„æŸ¥è¯¢ matchQueryï¼ŒmatchAllQueryï¼ŒboolQuery ç­‰ç­‰ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310131947096.png\" alt=\"image-20231013194730970\" /></p>\n<p>ä»£ç æ¼”ç¤ºï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testMatchAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡ Request</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">SearchRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SearchRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 2. å‡†å¤‡ DSL</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">QueryBuilders</span><span class=\"token punctuation\">.</span><span class=\"token function\">matchAllQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// 3. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      search <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">search</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token comment\">// 4. è§£æå“åº”</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token class-name\">SearchHits</span> hits <span class=\"token operator\">=</span> search<span class=\"token punctuation\">.</span><span class=\"token function\">getHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token comment\">// 4.1. è·å–æ€»æ•°</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token keyword\">long</span> value <span class=\"token operator\">=</span> hits<span class=\"token punctuation\">.</span><span class=\"token function\">getTotalHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å…±æœç´¢åˆ°\"</span> <span class=\"token operator\">+</span> value <span class=\"token operator\">+</span> <span class=\"token string\">\"æ¡æ•°æ®\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token comment\">// 4.2. æ–‡æ¡£æ•°ç»„</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token class-name\">SearchHit</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> hits1 <span class=\"token operator\">=</span> hits<span class=\"token punctuation\">.</span><span class=\"token function\">getHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token comment\">// 4.3. éå†æ–‡æ¡£æ•°ç»„</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SearchHit</span> hit <span class=\"token operator\">:</span> hits1<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token comment\">// 4.4. è·å–æ–‡æ¡£ source</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token class-name\">String</span> json <span class=\"token operator\">=</span> hit<span class=\"token punctuation\">.</span><span class=\"token function\">getSourceAsString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token comment\">// 4.5. ååºåˆ—åŒ–ä¸º HotelDoc å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token class-name\">HotelDoc</span> hotelDoc <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseObject</span><span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"HotelDoc: \"</span> <span class=\"token operator\">+</span> hotelDoc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">//----------------------- æ‰“å°ç»“æœ -----------------------</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>å…±æœç´¢åˆ°<span class=\"token number\">201</span>æ¡æ•°æ®</pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token class-name\">HotelDoc</span><span class=\"token operator\">:</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">36934</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token number\">7</span>å¤©è¿é”é…’åº—<span class=\"token punctuation\">(</span>ä¸Šæµ·å®å±±è·¯åœ°é“ç«™åº—<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> address<span class=\"token operator\">=</span>é™å®‰äº¤é€šè·¯<span class=\"token number\">40</span>å·<span class=\"token punctuation\">,</span> price<span class=\"token operator\">=</span><span class=\"token number\">336</span><span class=\"token punctuation\">,</span> score<span class=\"token operator\">=</span><span class=\"token number\">37</span><span class=\"token punctuation\">,</span> brand<span class=\"token operator\">=</span><span class=\"token number\">7</span>å¤©é…’åº—<span class=\"token punctuation\">,</span> city<span class=\"token operator\">=</span>ä¸Šæµ·<span class=\"token punctuation\">,</span> starName<span class=\"token operator\">=</span>äºŒé’»<span class=\"token punctuation\">,</span> business<span class=\"token operator\">=</span>å››å·åŒ—è·¯å•†ä¸šåŒº<span class=\"token punctuation\">,</span> location<span class=\"token operator\">=</span><span class=\"token number\">31.251433</span><span class=\"token punctuation\">,</span> <span class=\"token number\">121.47522</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                   <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr></table></figure><p>RestAPI ä¸­å…¶ä¸­æ„å»º DSL æ˜¯é€šè¿‡ HighLevelRestClient ä¸­çš„ resource () æ¥å®ç°çš„ï¼Œå…¶ä¸­åŒ…å«äº†æŸ¥è¯¢ï¼Œæ’åºï¼Œåˆ†é¡µï¼Œé«˜äº®ç­‰æ‰€æœ‰åŠŸèƒ½ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310131954682.png\" alt=\"image-20231013194937001\" /></p>\n<p>RestAPI ä¸­å…¶ä¸­æ„å»ºæŸ¥è¯¢æ¡ä»¶çš„æ ¸å¿ƒéƒ¨åˆ†æ˜¯ç”±ä¸€åä¸º QueryBuilders çš„å·¥å…·ç±»æä¾›çš„ï¼Œå…¶ä¸­åŒ…å«äº†å„ç§æŸ¥è¯¢æ–¹æ³•ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310131954893.png\" alt=\"image-20231013195054455\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>æŸ¥è¯¢çš„åŸºæœ¬æ­¥éª¤æ˜¯ï¼š</p>\n<ol>\n<li>åˆ›å»º SearchRequest å¯¹è±¡</li>\n<li>å‡†å¤‡ Request.source ()ï¼Œä¹Ÿå°±æ˜¯ DSLã€‚\n<ol>\n<li>QueryBuilders æ¥æ„å»ºæŸ¥è¯¢æ¡ä»¶</li>\n<li>ä¼ å…¥ Request.source () çš„ query () æ–¹æ³•</li>\n</ol>\n</li>\n<li>å‘é€è¯·æ±‚ï¼Œå¾—åˆ°ç»“æœ</li>\n<li>è§£æç»“æœ (å‚è€ƒ JSON ç»“æœï¼Œä»å¤–åˆ°å†…ï¼Œé€å±‚è§£æ)</li>\n</ol>\n</blockquote>\n<h5 id=\"9972-å…¨æ–‡æ£€ç´¢æŸ¥è¯¢\"><a class=\"anchor\" href=\"#9972-å…¨æ–‡æ£€ç´¢æŸ¥è¯¢\">#</a> 9.9.7.2ã€å…¨æ–‡æ£€ç´¢æŸ¥è¯¢ğŸŒ´</h5>\n<p>å…¨æ–‡æ£€ç´¢çš„ match å’Œ multi_match æŸ¥è¯¢ä¸ match_all çš„ API åŸºæœ¬ä¸€è‡´ã€‚å·®åˆ«æ˜¯æŸ¥è¯¢æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯ query çš„éƒ¨åˆ†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310132252478.png\" alt=\"image-20231013225059138\" /></p>\n<p>åŒæ ·æ˜¯åˆ©ç”¨ QueryBuilders æä¾›çš„æ–¹æ³•ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testMatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡ request</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">SearchRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SearchRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 2. å‡†å¤‡ DSL</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">QueryBuilders</span><span class=\"token punctuation\">.</span><span class=\"token function\">matchQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"å¦‚å®¶\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// 3. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      search <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">search</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token comment\">// 4. è§£æå“åº”</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token class-name\">SearchHits</span> hits <span class=\"token operator\">=</span> search<span class=\"token punctuation\">.</span><span class=\"token function\">getHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token keyword\">long</span> value <span class=\"token operator\">=</span> hits<span class=\"token punctuation\">.</span><span class=\"token function\">getTotalHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å…±æœç´¢åˆ°\"</span> <span class=\"token operator\">+</span> value <span class=\"token operator\">+</span> <span class=\"token string\">\"æ¡æ•°æ®\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token class-name\">SearchHit</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> hits1 <span class=\"token operator\">=</span> hits<span class=\"token punctuation\">.</span><span class=\"token function\">getHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SearchHit</span> hit <span class=\"token operator\">:</span> hits1<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token class-name\">String</span> json <span class=\"token operator\">=</span> hit<span class=\"token punctuation\">.</span><span class=\"token function\">getSourceAsString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token class-name\">HotelDoc</span> hotelDoc <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseObject</span><span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hotelDoc: \"</span> <span class=\"token operator\">+</span> hotelDoc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">//-------------------- æ‰“å°ç»“æœ --------------------</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>å…±æœç´¢åˆ°<span class=\"token number\">30</span>æ¡æ•°æ®</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>hotelDoc<span class=\"token operator\">:</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">339952837</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span>å¦‚å®¶é…’åº—<span class=\"token punctuation\">(</span>åŒ—äº¬è‰¯ä¹¡è¥¿è·¯åº—<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> address<span class=\"token operator\">=</span>è‰¯ä¹¡è¥¿è·¯<span class=\"token number\">7</span>å·<span class=\"token punctuation\">,</span> price<span class=\"token operator\">=</span><span class=\"token number\">159</span><span class=\"token punctuation\">,</span> score<span class=\"token operator\">=</span><span class=\"token number\">46</span><span class=\"token punctuation\">,</span> brand<span class=\"token operator\">=</span>å¦‚å®¶<span class=\"token punctuation\">,</span> city<span class=\"token operator\">=</span>åŒ—äº¬<span class=\"token punctuation\">,</span> starName<span class=\"token operator\">=</span>äºŒé’»<span class=\"token punctuation\">,</span> business<span class=\"token operator\">=</span>æˆ¿å±±é£æ™¯åŒº<span class=\"token punctuation\">,</span> location<span class=\"token operator\">=</span><span class=\"token number\">39.73167</span><span class=\"token punctuation\">,</span> <span class=\"token number\">116.132482</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                   <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr></table></figure><p>æ–¹æ³•çš„æŠ½å–</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testMatchAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡ Request</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">SearchRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SearchRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 2. å‡†å¤‡ DSL</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">QueryBuilders</span><span class=\"token punctuation\">.</span><span class=\"token function\">matchAllQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// 3. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      search <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">search</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token comment\">// 4. è°ƒç”¨è§£æå“åº”å‡½æ•°</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span>search<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testMatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡ request</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   <span class=\"token class-name\">SearchRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SearchRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token comment\">// 2. å‡†å¤‡ DSL</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">QueryBuilders</span><span class=\"token punctuation\">.</span><span class=\"token function\">matchQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"å¦‚å®¶\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   <span class=\"token comment\">// 3. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>   <span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      search <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">search</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>   <span class=\"token comment\">// 4. è°ƒç”¨è§£æå“åº”å‡½æ•°</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>   <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span>search<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>   <span class=\"token comment\">// 4. è§£æå“åº”</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>   <span class=\"token class-name\">SearchHits</span> hits <span class=\"token operator\">=</span> search<span class=\"token punctuation\">.</span><span class=\"token function\">getHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>   <span class=\"token keyword\">long</span> value <span class=\"token operator\">=</span> hits<span class=\"token punctuation\">.</span><span class=\"token function\">getTotalHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å…±æœç´¢åˆ°\"</span> <span class=\"token operator\">+</span> value <span class=\"token operator\">+</span> <span class=\"token string\">\"æ¡æ•°æ®\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>   <span class=\"token class-name\">SearchHit</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> hits1 <span class=\"token operator\">=</span> hits<span class=\"token punctuation\">.</span><span class=\"token function\">getHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>   <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SearchHit</span> hit <span class=\"token operator\">:</span> hits1<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>   <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>      <span class=\"token class-name\">String</span> json <span class=\"token operator\">=</span> hit<span class=\"token punctuation\">.</span><span class=\"token function\">getSourceAsString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      <span class=\"token class-name\">HotelDoc</span> hotelDoc <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseObject</span><span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hotelDoc: \"</span> <span class=\"token operator\">+</span> hotelDoc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h5 id=\"9973-ç²¾ç¡®æŸ¥è¯¢\"><a class=\"anchor\" href=\"#9973-ç²¾ç¡®æŸ¥è¯¢\">#</a> 9.9.7.3ã€ç²¾ç¡®æŸ¥è¯¢ğŸŒ´</h5>\n<p>ç²¾ç¡®æŸ¥è¯¢å¸¸è§çš„æœ‰ term æŸ¥è¯¢å’Œ range æŸ¥è¯¢ï¼ŒåŒæ ·åˆ©ç”¨ QueryBuilder å®ç°ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310132252500.png\" alt=\"image-20231013210337545\" /></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testJingque</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡ Request</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">SearchRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SearchRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token comment\">// 2. å‡†å¤‡ DSL</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 2.1 è¯æ¡æŸ¥è¯¢</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">QueryBuilders</span><span class=\"token punctuation\">.</span><span class=\"token function\">termQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"city\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"æ·±åœ³\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// 2.2 èŒƒå›´æŸ¥è¯¢</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">QueryBuilders</span><span class=\"token punctuation\">.</span><span class=\"token function\">rangeQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"price\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">gte</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">lte</span><span class=\"token punctuation\">(</span><span class=\"token number\">150</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token comment\">// 3. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      search <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">search</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span>search<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token comment\">// 4. è§£æå“åº”</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token class-name\">SearchHits</span> hits <span class=\"token operator\">=</span> search<span class=\"token punctuation\">.</span><span class=\"token function\">getHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   <span class=\"token keyword\">long</span> value <span class=\"token operator\">=</span> hits<span class=\"token punctuation\">.</span><span class=\"token function\">getTotalHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å…±æœç´¢åˆ°\"</span> <span class=\"token operator\">+</span> value <span class=\"token operator\">+</span> <span class=\"token string\">\"æ¡æ•°æ®\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   <span class=\"token class-name\">SearchHit</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> hits1 <span class=\"token operator\">=</span> hits<span class=\"token punctuation\">.</span><span class=\"token function\">getHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SearchHit</span> hit <span class=\"token operator\">:</span> hits1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token class-name\">String</span> json <span class=\"token operator\">=</span> hit<span class=\"token punctuation\">.</span><span class=\"token function\">getSourceAsString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token class-name\">HotelDoc</span> hotelDoc <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseObject</span><span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hotelDoc: \"</span> <span class=\"token operator\">+</span> hotelDoc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">//----------------- æ‰“å°ç»“æœ -----------------</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>å…±æœç´¢åˆ°<span class=\"token number\">5</span>æ¡æ•°æ®</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>hotelDoc<span class=\"token operator\">:</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">541619</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span>å¦‚å®¶é…’åº—<span class=\"token punctuation\">(</span>ä¸Šæµ·è˜åº„åœ°é“ç«™é¾™ä¹‹æ¢¦å•†ä¸šå¹¿åœºåº—<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> address<span class=\"token operator\">=</span>è˜åº„é•‡è˜æµœè·¯<span class=\"token number\">172</span>å·<span class=\"token punctuation\">,</span> price<span class=\"token operator\">=</span><span class=\"token number\">149</span><span class=\"token punctuation\">,</span> score<span class=\"token operator\">=</span><span class=\"token number\">44</span><span class=\"token punctuation\">,</span> brand<span class=\"token operator\">=</span>å¦‚å®¶<span class=\"token punctuation\">,</span> city<span class=\"token operator\">=</span>ä¸Šæµ·<span class=\"token punctuation\">,</span> starName<span class=\"token operator\">=</span>äºŒé’»<span class=\"token punctuation\">,</span> business<span class=\"token operator\">=</span>è˜åº„å·¥ä¸šåŒº<span class=\"token punctuation\">,</span> location<span class=\"token operator\">=</span><span class=\"token number\">31.105797</span><span class=\"token punctuation\">,</span> <span class=\"token number\">121.37755</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                   <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr></table></figure><h5 id=\"9974-å¤åˆæŸ¥è¯¢-boolean-query\"><a class=\"anchor\" href=\"#9974-å¤åˆæŸ¥è¯¢-boolean-query\">#</a> 9.9.7.4ã€å¤åˆæŸ¥è¯¢ - boolean queryğŸŒ´</h5>\n<p>ç²¾ç¡®æŸ¥è¯¢å¸¸è§çš„æœ‰ term æŸ¥è¯¢å’Œ range æŸ¥è¯¢ï¼ŒåŒæ ·åˆ©ç”¨ QueryBuilders å®ç°ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310141059562.png\" alt=\"image-20231014105919882\" /></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testBooleanQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡ Request</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">SearchRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SearchRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 2. å‡†å¤‡ DSL</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token comment\">// 2.1. å‡†å¤‡ BoolQuery</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token class-name\">BoolQueryBuilder</span> boolQuery <span class=\"token operator\">=</span> <span class=\"token class-name\">QueryBuilders</span><span class=\"token punctuation\">.</span><span class=\"token function\">boolQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">// 2.2. æ·»åŠ  term</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   boolQuery<span class=\"token punctuation\">.</span><span class=\"token function\">must</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">QueryBuilders</span><span class=\"token punctuation\">.</span><span class=\"token function\">termQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"city\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"æ·±åœ³\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token comment\">// 2.3. æ·»åŠ  range</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   boolQuery<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">QueryBuilders</span><span class=\"token punctuation\">.</span><span class=\"token function\">rangeQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"price\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">lte</span><span class=\"token punctuation\">(</span><span class=\"token number\">250</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token comment\">// 2.4. å°†æ¡ä»¶æ·»åŠ åˆ° å‘é€è¯·æ±‚ä¸­</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span>boolQuery<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token comment\">// 3. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      search <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">search</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span>search<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   <span class=\"token comment\">// 4. è§£æå“åº”</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>   <span class=\"token class-name\">SearchHits</span> hits <span class=\"token operator\">=</span> search<span class=\"token punctuation\">.</span><span class=\"token function\">getHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token keyword\">long</span> value <span class=\"token operator\">=</span> hits<span class=\"token punctuation\">.</span><span class=\"token function\">getTotalHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å…±æœç´¢åˆ°\"</span> <span class=\"token operator\">+</span> value <span class=\"token operator\">+</span> <span class=\"token string\">\"æ¡æ•°æ®\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>   <span class=\"token class-name\">SearchHit</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> hits1 <span class=\"token operator\">=</span> hits<span class=\"token punctuation\">.</span><span class=\"token function\">getHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SearchHit</span> hit <span class=\"token operator\">:</span> hits1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token class-name\">String</span> json <span class=\"token operator\">=</span> hit<span class=\"token punctuation\">.</span><span class=\"token function\">getSourceAsString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token class-name\">HotelDoc</span> hotelDoc <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseObject</span><span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hotelDoc: \"</span> <span class=\"token operator\">+</span> hotelDoc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">//-------------------- æ‰“å°ç»“æœ --------------------</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>å…±æœç´¢åˆ°<span class=\"token number\">18</span>æ¡æ•°æ®</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>hotelDoc<span class=\"token operator\">:</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">517915</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span>å¦‚å®¶é…’åº—Â·<span class=\"token function\">neo</span><span class=\"token punctuation\">(</span>æ·±åœ³è‰åŸ”åœ°é“ç«™åº—<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> address<span class=\"token operator\">=</span>å¸ƒå‰è·¯<span class=\"token number\">1036</span>å·<span class=\"token punctuation\">,</span> price<span class=\"token operator\">=</span><span class=\"token number\">159</span><span class=\"token punctuation\">,</span> score<span class=\"token operator\">=</span><span class=\"token number\">44</span><span class=\"token punctuation\">,</span> brand<span class=\"token operator\">=</span>å¦‚å®¶<span class=\"token punctuation\">,</span> city<span class=\"token operator\">=</span>æ·±åœ³<span class=\"token punctuation\">,</span> starName<span class=\"token operator\">=</span>äºŒé’»<span class=\"token punctuation\">,</span> business<span class=\"token operator\">=</span>ç”°è´<span class=\"token operator\">/</span>æ°´è´ç å®åŸ<span class=\"token punctuation\">,</span> location<span class=\"token operator\">=</span><span class=\"token number\">22.583191</span><span class=\"token punctuation\">,</span> <span class=\"token number\">114.118499</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                   <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr></table></figure><blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>è¦æ„å»ºæŸ¥è¯¢æ¡ä»¶ï¼Œåªè¦è®°ä½ä¸€ä¸ªç±»ï¼šQueryBuilders</p>\n</blockquote>\n<h5 id=\"9975-æœç´¢ç»“æœå¤„ç†\"><a class=\"anchor\" href=\"#9975-æœç´¢ç»“æœå¤„ç†\">#</a> 9.9.7.5ã€æœç´¢ç»“æœå¤„ç†ğŸŒ´</h5>\n<h6 id=\"99751-æ’åºå’Œåˆ†é¡µ\"><a class=\"anchor\" href=\"#99751-æ’åºå’Œåˆ†é¡µ\">#</a> 9.9.7.5.1ã€æ’åºå’Œåˆ†é¡µğŸ‹</h6>\n<p>æœç´¢ç»“æœçš„æ’åºå’Œåˆ†é¡µæ˜¯ä¸ query åŒçº§çš„å‚æ•°ï¼Œå¯¹åº”çš„ API å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310141103708.png\" alt=\"image-20231014110315292\" /></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testPageAndSort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// é¡µç ï¼Œæ¯é¡µå¤§å°</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">int</span> page <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>size <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡ Request</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token class-name\">SearchRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SearchRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// 2. å‡†å¤‡ DSL</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">QueryBuilders</span><span class=\"token punctuation\">.</span><span class=\"token function\">matchAllQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token comment\">// 2.1. æ’åº sort</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"price\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SortOrder</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ASC</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token comment\">// 2.2. åˆ†é¡µ from size</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>page <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token comment\">// 3. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      search <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">search</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span>search<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   <span class=\"token comment\">// 4. è§£æå“åº”</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   <span class=\"token class-name\">SearchHits</span> hits <span class=\"token operator\">=</span> search<span class=\"token punctuation\">.</span><span class=\"token function\">getHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>   <span class=\"token keyword\">long</span> value <span class=\"token operator\">=</span> hits<span class=\"token punctuation\">.</span><span class=\"token function\">getTotalHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å…±æœç´¢åˆ°\"</span> <span class=\"token operator\">+</span> value <span class=\"token operator\">+</span> <span class=\"token string\">\"æ¡æ•°æ®\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>   <span class=\"token class-name\">SearchHit</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> hits1 <span class=\"token operator\">=</span> hits<span class=\"token punctuation\">.</span><span class=\"token function\">getHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SearchHit</span> hit <span class=\"token operator\">:</span> hits1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token class-name\">String</span> json <span class=\"token operator\">=</span> hit<span class=\"token punctuation\">.</span><span class=\"token function\">getSourceAsString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token class-name\">HotelDoc</span> hotelDoc <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseObject</span><span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hotelDoc: \"</span> <span class=\"token operator\">+</span> hotelDoc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">//----------------------- æ‰“å°ç»“æœ -----------------------</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>å…±æœç´¢åˆ°<span class=\"token number\">201</span>æ¡æ•°æ®</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>hotelDoc<span class=\"token operator\">:</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">197837109</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span>å¦‚å®¶é…’åº—Â·<span class=\"token function\">neo</span><span class=\"token punctuation\">(</span>æ·±åœ³é¾™å²—å¤§é“å¸ƒå‰åœ°é“ç«™åº—<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> address<span class=\"token operator\">=</span>å¸ƒå‰é•‡æ·±æƒ è·¯é¾™ç å•†åŸ<span class=\"token punctuation\">,</span> price<span class=\"token operator\">=</span><span class=\"token number\">127</span><span class=\"token punctuation\">,</span> score<span class=\"token operator\">=</span><span class=\"token number\">43</span><span class=\"token punctuation\">,</span> brand<span class=\"token operator\">=</span>å¦‚å®¶<span class=\"token punctuation\">,</span> city<span class=\"token operator\">=</span>æ·±åœ³<span class=\"token punctuation\">,</span> starName<span class=\"token operator\">=</span>äºŒé’»<span class=\"token punctuation\">,</span> business<span class=\"token operator\">=</span>å¸ƒå‰<span class=\"token operator\">/</span>æ·±åœ³ä¸œç«™<span class=\"token punctuation\">,</span> location<span class=\"token operator\">=</span><span class=\"token number\">22.602482</span><span class=\"token punctuation\">,</span> <span class=\"token number\">114.123284</span><span class=\"token punctuation\">,</span> pic<span class=\"token operator\">=</span>https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>m<span class=\"token punctuation\">.</span>tuniucdn<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>fb2<span class=\"token operator\">/</span>t1<span class=\"token operator\">/</span><span class=\"token constant\">G6</span><span class=\"token operator\">/</span><span class=\"token constant\">M00</span><span class=\"token operator\">/</span><span class=\"token number\">25</span><span class=\"token operator\">/</span><span class=\"token number\">58</span><span class=\"token operator\">/</span><span class=\"token class-name\">Cii</span><span class=\"token operator\">-</span><span class=\"token class-name\">TF3PFZOIA7jwAAKInGFN4xgAAEVbAGeP4AAAoi0485_w200_h200_c1_t0</span><span class=\"token punctuation\">.</span>jpg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>hotelDoc<span class=\"token operator\">:</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">2316304</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span>å¦‚å®¶é…’åº—<span class=\"token punctuation\">(</span>æ·±åœ³åŒé¾™åœ°é“ç«™åº—<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> address<span class=\"token operator\">=</span>é¾™å²—è¡—é“é¾™å²—å¢Ÿç¤¾åŒºé¾™å¹³ä¸œè·¯<span class=\"token number\">62</span>å·<span class=\"token punctuation\">,</span> price<span class=\"token operator\">=</span><span class=\"token number\">135</span><span class=\"token punctuation\">,</span> score<span class=\"token operator\">=</span><span class=\"token number\">45</span><span class=\"token punctuation\">,</span> brand<span class=\"token operator\">=</span>å¦‚å®¶<span class=\"token punctuation\">,</span> city<span class=\"token operator\">=</span>æ·±åœ³<span class=\"token punctuation\">,</span> starName<span class=\"token operator\">=</span>äºŒé’»<span class=\"token punctuation\">,</span> business<span class=\"token operator\">=</span>é¾™å²—ä¸­å¿ƒåŒº<span class=\"token operator\">/</span>å¤§è¿æ–°åŸ<span class=\"token punctuation\">,</span> location<span class=\"token operator\">=</span><span class=\"token number\">22.730828</span><span class=\"token punctuation\">,</span> <span class=\"token number\">114.278337</span><span class=\"token punctuation\">,</span> pic<span class=\"token operator\">=</span>https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>m<span class=\"token punctuation\">.</span>tuniucdn<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>fb3<span class=\"token operator\">/</span>s1<span class=\"token operator\">/</span><span class=\"token number\">2</span>n9c<span class=\"token operator\">/</span><span class=\"token number\">4</span>AzEoQ44awd1D2g95a6XDtJf3dkw_w200_h200_c1_t0<span class=\"token punctuation\">.</span>jpg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>hotelDoc<span class=\"token operator\">:</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">1630005459</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token number\">7</span>å¤©è¿é”é…’åº—ï¼ˆæ·±åœ³åœ°ç‹å¤§å¦çº¢æ¡‚è·¯åº—ï¼‰ï¼ˆåŸçº¢æ¡‚è·¯åº—ï¼‰<span class=\"token punctuation\">,</span> address<span class=\"token operator\">=</span>ç½—æ¹–åŒºå®å®‰å—è·¯<span class=\"token number\">2078</span>å·æ·±æ¸¯è±ªè‹‘ï¼ˆä¸çº¢æ¡‚è·¯äº¤æ±‡å¤„ï¼‰<span class=\"token punctuation\">,</span> price<span class=\"token operator\">=</span><span class=\"token number\">143</span><span class=\"token punctuation\">,</span> score<span class=\"token operator\">=</span><span class=\"token number\">39</span><span class=\"token punctuation\">,</span> brand<span class=\"token operator\">=</span><span class=\"token number\">7</span>å¤©é…’åº—<span class=\"token punctuation\">,</span> city<span class=\"token operator\">=</span>æ·±åœ³<span class=\"token punctuation\">,</span> starName<span class=\"token operator\">=</span>äºŒé’»<span class=\"token punctuation\">,</span> business<span class=\"token operator\">=</span><span class=\"token punctuation\">,</span> location<span class=\"token operator\">=</span><span class=\"token number\">22.550341</span><span class=\"token punctuation\">,</span> <span class=\"token number\">114.10965</span><span class=\"token punctuation\">,</span> pic<span class=\"token operator\">=</span>https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>m<span class=\"token punctuation\">.</span>tuniucdn<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>fb2<span class=\"token operator\">/</span>t1<span class=\"token operator\">/</span><span class=\"token constant\">G2</span><span class=\"token operator\">/</span><span class=\"token constant\">M00</span><span class=\"token operator\">/</span><span class=\"token constant\">EA</span><span class=\"token operator\">/</span><span class=\"token number\">18</span><span class=\"token operator\">/</span><span class=\"token class-name\">Cii</span><span class=\"token operator\">-</span><span class=\"token class-name\">T1k1KaGIIkQVAAD4fD_T3FcAALTtABiCJ8AAPiU164_w200_h200_c1_t0</span><span class=\"token punctuation\">.</span>jpg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>hotelDoc<span class=\"token operator\">:</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">541619</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span>å¦‚å®¶é…’åº—<span class=\"token punctuation\">(</span>ä¸Šæµ·è˜åº„åœ°é“ç«™é¾™ä¹‹æ¢¦å•†ä¸šå¹¿åœºåº—<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> address<span class=\"token operator\">=</span>è˜åº„é•‡è˜æµœè·¯<span class=\"token number\">172</span>å·<span class=\"token punctuation\">,</span> price<span class=\"token operator\">=</span><span class=\"token number\">149</span><span class=\"token punctuation\">,</span> score<span class=\"token operator\">=</span><span class=\"token number\">44</span><span class=\"token punctuation\">,</span> brand<span class=\"token operator\">=</span>å¦‚å®¶<span class=\"token punctuation\">,</span> city<span class=\"token operator\">=</span>ä¸Šæµ·<span class=\"token punctuation\">,</span> starName<span class=\"token operator\">=</span>äºŒé’»<span class=\"token punctuation\">,</span> business<span class=\"token operator\">=</span>è˜åº„å·¥ä¸šåŒº<span class=\"token punctuation\">,</span> location<span class=\"token operator\">=</span><span class=\"token number\">31.105797</span><span class=\"token punctuation\">,</span> <span class=\"token number\">121.37755</span><span class=\"token punctuation\">,</span> pic<span class=\"token operator\">=</span>https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>m<span class=\"token punctuation\">.</span>tuniucdn<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>fb3<span class=\"token operator\">/</span>s1<span class=\"token operator\">/</span><span class=\"token number\">2</span>n9c<span class=\"token operator\">/</span><span class=\"token number\">3</span>mKs3jETvJDj3dDdkRB9UyLLvPna_w200_h200_c1_t0<span class=\"token punctuation\">.</span>jpg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>hotelDoc<span class=\"token operator\">:</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">1400304687</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span>å¦‚å®¶é…’åº—<span class=\"token punctuation\">(</span>æ·±åœ³æ¨ªå²—åœ°é“ç«™æ–°é©¬å•†è´¸åŸåº—<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> address<span class=\"token operator\">=</span>é¾™å²—å¤§é“æ¨ªå²—æ®µ<span class=\"token number\">4004</span>å·<span class=\"token punctuation\">,</span> price<span class=\"token operator\">=</span><span class=\"token number\">149</span><span class=\"token punctuation\">,</span> score<span class=\"token operator\">=</span><span class=\"token number\">43</span><span class=\"token punctuation\">,</span> brand<span class=\"token operator\">=</span>å¦‚å®¶<span class=\"token punctuation\">,</span> city<span class=\"token operator\">=</span>æ·±åœ³<span class=\"token punctuation\">,</span> starName<span class=\"token operator\">=</span>äºŒé’»<span class=\"token punctuation\">,</span> business<span class=\"token operator\">=</span>é¾™å²—ä¸­å¿ƒåŒº<span class=\"token operator\">/</span>å¤§è¿æ–°åŸ<span class=\"token punctuation\">,</span> location<span class=\"token operator\">=</span><span class=\"token number\">22.642629</span><span class=\"token punctuation\">,</span> <span class=\"token number\">114.202799</span><span class=\"token punctuation\">,</span> pic<span class=\"token operator\">=</span>https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>m<span class=\"token punctuation\">.</span>tuniucdn<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>fb2<span class=\"token operator\">/</span>t1<span class=\"token operator\">/</span><span class=\"token constant\">G6</span><span class=\"token operator\">/</span><span class=\"token constant\">M00</span><span class=\"token operator\">/</span><span class=\"token number\">25</span><span class=\"token operator\">/</span><span class=\"token number\">5</span>A<span class=\"token operator\">/</span><span class=\"token class-name\">Cii</span><span class=\"token operator\">-</span><span class=\"token class-name\">TF3PFkiIb27dAAEqdDcKl3YAAEViQGVWY0AASqM960_w200_h200_c1_t0</span><span class=\"token punctuation\">.</span>jpg<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h6 id=\"99752-é«˜äº®\"><a class=\"anchor\" href=\"#99752-é«˜äº®\">#</a> 9.9.7.5.2ã€é«˜äº®ğŸ‹</h6>\n<p>é«˜äº® API åŒ…æ‹¬è¯·æ±‚ DSL æ„å»ºå’Œç»“æœè§£æä¸¤éƒ¨åˆ†ã€‚æˆ‘ä»¬å…ˆçœ‹è¯·æ±‚çš„ DSL æ„å»ºï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310141251993.png\" alt=\"image-20231014125137358\" /></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testHighlight</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡ Request</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">SearchRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SearchRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 2. å‡†å¤‡ DSL</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token comment\">// 2.1.query æŸ¥è¯¢</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">QueryBuilders</span><span class=\"token punctuation\">.</span><span class=\"token function\">matchQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"å¦‚å®¶\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">// 2.2. é«˜äº®</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">highlighter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HighlightBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                                <span class=\"token punctuation\">.</span><span class=\"token function\">field</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                                <span class=\"token punctuation\">.</span><span class=\"token function\">requireFieldMatch</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                               <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token comment\">// 3. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      search <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">search</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span>search<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   <span class=\"token comment\">// 4. è§£æå“åº”</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   <span class=\"token class-name\">SearchHits</span> hits <span class=\"token operator\">=</span> search<span class=\"token punctuation\">.</span><span class=\"token function\">getHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>   <span class=\"token keyword\">long</span> value <span class=\"token operator\">=</span> hits<span class=\"token punctuation\">.</span><span class=\"token function\">getTotalHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å…±æœç´¢åˆ°\"</span> <span class=\"token operator\">+</span> value <span class=\"token operator\">+</span> <span class=\"token string\">\"æ¡æ•°æ®\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>   <span class=\"token class-name\">SearchHit</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> hits1 <span class=\"token operator\">=</span> hits<span class=\"token punctuation\">.</span><span class=\"token function\">getHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SearchHit</span> hit <span class=\"token operator\">:</span> hits1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token class-name\">String</span> json <span class=\"token operator\">=</span> hit<span class=\"token punctuation\">.</span><span class=\"token function\">getSourceAsString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token class-name\">HotelDoc</span> hotelDoc <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseObject</span><span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hotelDoc: \"</span> <span class=\"token operator\">+</span> hotelDoc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">//--------------------- æ‰“å°ç»“æœ ---------------------</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>å…±æœç´¢åˆ°<span class=\"token number\">30</span>æ¡æ•°æ®</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>hotelDoc<span class=\"token operator\">:</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">339952837</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span>å¦‚å®¶é…’åº—<span class=\"token punctuation\">(</span>åŒ—äº¬è‰¯ä¹¡è¥¿è·¯åº—<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> address<span class=\"token operator\">=</span>è‰¯ä¹¡è¥¿è·¯<span class=\"token number\">7</span>å·<span class=\"token punctuation\">,</span> price<span class=\"token operator\">=</span><span class=\"token number\">159</span><span class=\"token punctuation\">,</span> score<span class=\"token operator\">=</span><span class=\"token number\">46</span><span class=\"token punctuation\">,</span> brand<span class=\"token operator\">=</span>å¦‚å®¶<span class=\"token punctuation\">,</span> city<span class=\"token operator\">=</span>åŒ—äº¬<span class=\"token punctuation\">,</span> starName<span class=\"token operator\">=</span>äºŒé’»<span class=\"token punctuation\">,</span> business<span class=\"token operator\">=</span>æˆ¿å±±é£æ™¯åŒº<span class=\"token punctuation\">,</span> location<span class=\"token operator\">=</span><span class=\"token number\">39.73167</span><span class=\"token punctuation\">,</span> <span class=\"token number\">116.132482</span><span class=\"token punctuation\">,</span> pic<span class=\"token operator\">=</span>https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>m<span class=\"token punctuation\">.</span>tuniucdn<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>fb3<span class=\"token operator\">/</span>s1<span class=\"token operator\">/</span><span class=\"token number\">2</span>n9c<span class=\"token operator\">/</span><span class=\"token number\">3D</span>pgf5RTTzrxpeN5y3RLnRVtxMEA_w200_h200_c1_t0<span class=\"token punctuation\">.</span>jpg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>hotelDoc<span class=\"token operator\">:</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">1455383931</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span>å¦‚å®¶é…’åº—<span class=\"token punctuation\">(</span>æ·±åœ³å®å®‰å®¢è¿ä¸­å¿ƒç«™åº—<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> address<span class=\"token operator\">=</span>è¥¿ä¹¡æ²³è¥¿é‡‘é›…æ–°è‹‘<span class=\"token number\">34</span>æ ‹<span class=\"token punctuation\">,</span> price<span class=\"token operator\">=</span><span class=\"token number\">169</span><span class=\"token punctuation\">,</span> score<span class=\"token operator\">=</span><span class=\"token number\">45</span><span class=\"token punctuation\">,</span> brand<span class=\"token operator\">=</span>å¦‚å®¶<span class=\"token punctuation\">,</span> city<span class=\"token operator\">=</span>æ·±åœ³<span class=\"token punctuation\">,</span> starName<span class=\"token operator\">=</span>äºŒé’»<span class=\"token punctuation\">,</span> business<span class=\"token operator\">=</span>å®å®‰å•†ä¸šåŒº<span class=\"token punctuation\">,</span> location<span class=\"token operator\">=</span><span class=\"token number\">22.590272</span><span class=\"token punctuation\">,</span> <span class=\"token number\">113.881933</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                   <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„æ‰“å°ç»“æœä¸­å¯ä»¥çœ‹åˆ°å¹¶æ²¡æœ‰æ‰¾åˆ°é«˜äº®çš„éƒ¨åˆ†å•Šã€‚è¿™æ˜¯å› ä¸ºæ‰“å°çš„æ˜¯ source çš„éƒ¨åˆ†</p>\n<p>é«˜äº®çš„éƒ¨åˆ†åœ¨å¦ä¸€ä¸ªéƒ¨åˆ†ä¸­å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310141305411.png\" alt=\"image-20231014130537007\" /></p>\n<h6 id=\"997521-é«˜äº®ç»“æœè§£æ\"><a class=\"anchor\" href=\"#997521-é«˜äº®ç»“æœè§£æ\">#</a> 9.9.7.5.2.1ã€é«˜äº®ç»“æœè§£æï¼š</h6>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testHighlight</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡ Request</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">SearchRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SearchRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 2. å‡†å¤‡ DSL</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token comment\">// 2.1.query æŸ¥è¯¢</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">QueryBuilders</span><span class=\"token punctuation\">.</span><span class=\"token function\">matchQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"å¦‚å®¶\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">// 2.2. é«˜äº®</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">highlighter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HighlightBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                                <span class=\"token punctuation\">.</span><span class=\"token function\">field</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                                <span class=\"token punctuation\">.</span><span class=\"token function\">requireFieldMatch</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                               <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token comment\">// 3. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      search <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">search</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span>search<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   <span class=\"token comment\">// 4. è§£æå“åº”</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   <span class=\"token class-name\">SearchHits</span> hits <span class=\"token operator\">=</span> search<span class=\"token punctuation\">.</span><span class=\"token function\">getHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>   <span class=\"token keyword\">long</span> value <span class=\"token operator\">=</span> hits<span class=\"token punctuation\">.</span><span class=\"token function\">getTotalHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å…±æœç´¢åˆ°\"</span> <span class=\"token operator\">+</span> value <span class=\"token operator\">+</span> <span class=\"token string\">\"æ¡æ•°æ®\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>   <span class=\"token class-name\">SearchHit</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> hits1 <span class=\"token operator\">=</span> hits<span class=\"token punctuation\">.</span><span class=\"token function\">getHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SearchHit</span> hit <span class=\"token operator\">:</span> hits1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token class-name\">String</span> json <span class=\"token operator\">=</span> hit<span class=\"token punctuation\">.</span><span class=\"token function\">getSourceAsString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token class-name\">HotelDoc</span> hotelDoc <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseObject</span><span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token comment\">// è·å–é«˜äº®ç»“æœ</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">HighlightField</span><span class=\"token punctuation\">></span></span> highlightFields <span class=\"token operator\">=</span> hit<span class=\"token punctuation\">.</span><span class=\"token function\">getHighlightFields</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token comment\">// CollectionUtilsï¼šSpring æä¾›çš„å·¥å…·ç±» isEmpty åˆ¤æ–­ Map é›†åˆæ˜¯å¦ä¸ºç©º</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span> <span class=\"token class-name\">CollectionUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>highlightFields<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>         <span class=\"token comment\">// æ ¹æ®å­—æ®µåè·å–é«˜äº®ç»“æœ</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>         <span class=\"token class-name\">HighlightField</span> name <span class=\"token operator\">=</span> highlightFields<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>         <span class=\"token comment\">// åˆ¤æ–­æ ¹æ®å­—æ®µè·å–çš„å†…å®¹æ˜¯å¦ä¸º null</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>         <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>         <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token comment\">// è·å–é«˜äº®å€¼</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token class-name\">String</span> content <span class=\"token operator\">=</span> name<span class=\"token punctuation\">.</span><span class=\"token function\">getFragments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token comment\">// è¦†ç›–éé«˜äº®ç»“æœ</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            hotelDoc<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hotelDoc: \"</span> <span class=\"token operator\">+</span> hotelDoc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token comment\">//----------------- æ‰“å°ç»“æœ -----------------</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>å…±æœç´¢åˆ°<span class=\"token number\">30</span>æ¡æ•°æ®</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>hotelDoc<span class=\"token operator\">:</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">339952837</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>em<span class=\"token punctuation\">></span></span>å¦‚å®¶<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>em<span class=\"token operator\">></span>é…’åº—<span class=\"token punctuation\">(</span>åŒ—äº¬è‰¯ä¹¡è¥¿è·¯åº—<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> address<span class=\"token operator\">=</span>è‰¯ä¹¡è¥¿è·¯<span class=\"token number\">7</span>å·<span class=\"token punctuation\">,</span> price<span class=\"token operator\">=</span><span class=\"token number\">159</span><span class=\"token punctuation\">,</span> score<span class=\"token operator\">=</span><span class=\"token number\">46</span><span class=\"token punctuation\">,</span> brand<span class=\"token operator\">=</span>å¦‚å®¶<span class=\"token punctuation\">,</span> city<span class=\"token operator\">=</span>åŒ—äº¬<span class=\"token punctuation\">,</span> starName<span class=\"token operator\">=</span>äºŒé’»<span class=\"token punctuation\">,</span> business<span class=\"token operator\">=</span>æˆ¿å±±é£æ™¯åŒº<span class=\"token punctuation\">,</span> location<span class=\"token operator\">=</span><span class=\"token number\">39.73167</span><span class=\"token punctuation\">,</span> <span class=\"token number\">116.132482</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                   <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr></table></figure><blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<ul>\n<li>\n<p>æ‰€æœ‰æœç´¢ DSL çš„æ„å»ºï¼Œè®°ä½ä¸€ä¸ª APIï¼š</p>\n<p>SearchRequest çš„ source () æ–¹æ³•</p>\n</li>\n<li>\n<p>é«˜äº®ç»“æœè§£ææ˜¯å‚è€ƒ JSON ç»“æœï¼Œé€å±‚è§£æ</p>\n</li>\n</ul>\n</blockquote>\n<h6 id=\"99753-è·ç¦»æ’åº\"><a class=\"anchor\" href=\"#99753-è·ç¦»æ’åº\">#</a> 9.9.7.5.3ã€è·ç¦»æ’åºğŸ‹</h6>\n<p>è·ç¦»æ’åºä¸æ™®é€šå­—æ®µæ’åºæœ‰æ‰€å·®å¼‚ï¼ŒAPI å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310141655675.png\" alt=\"image-20231014165529717\" /></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testJvliSort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡ Request</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">SearchRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SearchRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 2.3. æ’åº</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token class-name\">String</span> location <span class=\"token operator\">=</span> <span class=\"token string\">\"31.251433, 121.47522\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>location <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>location<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token comment\">// 2.4. æ ¹æ®è·ç¦»è¿›è¡Œæ’åº</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SortBuilders</span><span class=\"token punctuation\">.</span><span class=\"token function\">geoDistanceSort</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"location\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                                                         <span class=\"token keyword\">new</span> <span class=\"token class-name\">GeoPoint</span><span class=\"token punctuation\">(</span>location<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                                                        <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                            <span class=\"token punctuation\">.</span><span class=\"token function\">order</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SortOrder</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ASC</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                            <span class=\"token punctuation\">.</span><span class=\"token function\">unit</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DistanceUnit</span><span class=\"token punctuation\">.</span><span class=\"token constant\">KILOMETERS</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                           <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token comment\">// 3. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      search <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">search</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   <span class=\"token comment\">// 4. è§£æå“åº”ç»“æœ</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span>search<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>   <span class=\"token comment\">// 4. è§£æå“åº”</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>   <span class=\"token class-name\">SearchHits</span> hits <span class=\"token operator\">=</span> search<span class=\"token punctuation\">.</span><span class=\"token function\">getHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>   <span class=\"token keyword\">long</span> value <span class=\"token operator\">=</span> hits<span class=\"token punctuation\">.</span><span class=\"token function\">getTotalHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å…±æœç´¢åˆ°\"</span> <span class=\"token operator\">+</span> value <span class=\"token operator\">+</span> <span class=\"token string\">\"æ¡æ•°æ®\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>   <span class=\"token class-name\">SearchHit</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> hits1 <span class=\"token operator\">=</span> hits<span class=\"token punctuation\">.</span><span class=\"token function\">getHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SearchHit</span> hit <span class=\"token operator\">:</span> hits1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token class-name\">String</span> json <span class=\"token operator\">=</span> hit<span class=\"token punctuation\">.</span><span class=\"token function\">getSourceAsString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token class-name\">HotelDoc</span> hotelDoc <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseObject</span><span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token comment\">// è·å–é«˜äº®ç»“æœ</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">HighlightField</span><span class=\"token punctuation\">></span></span> highlightFields <span class=\"token operator\">=</span> hit<span class=\"token punctuation\">.</span><span class=\"token function\">getHighlightFields</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token comment\">// CollectionUtilsï¼šSpring æä¾›çš„å·¥å…·ç±» isEmpty åˆ¤æ–­ Map é›†åˆæ˜¯å¦ä¸ºç©º</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span> <span class=\"token class-name\">CollectionUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>highlightFields<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>         <span class=\"token comment\">// æ ¹æ®å­—æ®µåè·å–é«˜äº®ç»“æœ</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>         <span class=\"token class-name\">HighlightField</span> name <span class=\"token operator\">=</span> highlightFields<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>         <span class=\"token comment\">// åˆ¤æ–­æ ¹æ®å­—æ®µè·å–çš„å†…å®¹æ˜¯å¦ä¸º null</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>         <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>         <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token comment\">// è·å–é«˜äº®å€¼</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token class-name\">String</span> content <span class=\"token operator\">=</span> name<span class=\"token punctuation\">.</span><span class=\"token function\">getFragments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token comment\">// è¦†ç›–éé«˜äº®ç»“æœ</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            hotelDoc<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hotelDoc: \"</span> <span class=\"token operator\">+</span> hotelDoc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token comment\">//-------------------- æ‰“å°ç»“æœ --------------------</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>å…±æœç´¢åˆ°<span class=\"token number\">201</span>æ¡æ•°æ®</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>hotelDoc<span class=\"token operator\">:</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">36934</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token number\">7</span>å¤©è¿é”é…’åº—<span class=\"token punctuation\">(</span>ä¸Šæµ·å®å±±è·¯åœ°é“ç«™åº—<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> address<span class=\"token operator\">=</span>é™å®‰äº¤é€šè·¯<span class=\"token number\">40</span>å·<span class=\"token punctuation\">,</span> price<span class=\"token operator\">=</span><span class=\"token number\">336</span><span class=\"token punctuation\">,</span> score<span class=\"token operator\">=</span><span class=\"token number\">37</span><span class=\"token punctuation\">,</span> brand<span class=\"token operator\">=</span><span class=\"token number\">7</span>å¤©é…’åº—<span class=\"token punctuation\">,</span> city<span class=\"token operator\">=</span>ä¸Šæµ·<span class=\"token punctuation\">,</span> starName<span class=\"token operator\">=</span>äºŒé’»<span class=\"token punctuation\">,</span> business<span class=\"token operator\">=</span>å››å·åŒ—è·¯å•†ä¸šåŒº<span class=\"token punctuation\">,</span> location<span class=\"token operator\">=</span><span class=\"token number\">31.251433</span><span class=\"token punctuation\">,</span> <span class=\"token number\">121.47522</span><span class=\"token punctuation\">,</span> pic<span class=\"token operator\">=</span>https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>m<span class=\"token punctuation\">.</span>tuniucdn<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>fb2<span class=\"token operator\">/</span>t1<span class=\"token operator\">/</span><span class=\"token constant\">G1</span><span class=\"token operator\">/</span><span class=\"token constant\">M00</span><span class=\"token operator\">/</span><span class=\"token number\">3</span>E<span class=\"token operator\">/</span><span class=\"token number\">40</span><span class=\"token operator\">/</span><span class=\"token class-name\">Cii9EVkyLrKIXo1vAAHgrxo_pUcAALcKQLD688AAeDH564_w200_h200_c1_t0</span><span class=\"token punctuation\">.</span>jpg<span class=\"token punctuation\">,</span> distance<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> isAD<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>hotelDoc<span class=\"token operator\">:</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">60935</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span>ä¸Šæµ·è™¹å£ä¸‰è‡³å–œæ¥ç™»é…’åº—<span class=\"token punctuation\">,</span> address<span class=\"token operator\">=</span>å››å¹³è·¯<span class=\"token number\">59</span>å·<span class=\"token punctuation\">,</span> price<span class=\"token operator\">=</span><span class=\"token number\">1899</span><span class=\"token punctuation\">,</span> score<span class=\"token operator\">=</span><span class=\"token number\">46</span><span class=\"token punctuation\">,</span> brand<span class=\"token operator\">=</span>å–œæ¥ç™»<span class=\"token punctuation\">,</span> city<span class=\"token operator\">=</span>ä¸Šæµ·<span class=\"token punctuation\">,</span> starName<span class=\"token operator\">=</span>äº”æ˜Ÿçº§<span class=\"token punctuation\">,</span> business<span class=\"token operator\">=</span>å››å·åŒ—è·¯å•†ä¸šåŒº<span class=\"token punctuation\">,</span> location<span class=\"token operator\">=</span><span class=\"token number\">31.2579</span><span class=\"token punctuation\">,</span> <span class=\"token number\">121.487954</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                   <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr></table></figure><h6 id=\"99754-ç»„åˆæŸ¥è¯¢-function-score\"><a class=\"anchor\" href=\"#99754-ç»„åˆæŸ¥è¯¢-function-score\">#</a> 9.9.7.5.4ã€ç»„åˆæŸ¥è¯¢ - function scoreğŸ‹</h6>\n<p>Function Score æŸ¥è¯¢å¯ä»¥æ§åˆ¶æ–‡æ¡£çš„ç›¸å…³æ€§ç®—åˆ†ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310141739473.png\" alt=\"image-20231014173905116\" /></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testFunctionScore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡ Request</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">SearchRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SearchRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 2. å‡†å¤‡ DSL</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token comment\">// ç®—åˆ†æ§åˆ¶</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token class-name\">FunctionScoreQueryBuilder</span> functionScoreQueryBuilder <span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token class-name\">QueryBuilders</span><span class=\"token punctuation\">.</span><span class=\"token function\">functionScoreQuery</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token comment\">// æŸ¥è¯¢ name = å¤–æ»©</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token class-name\">QueryBuilders</span><span class=\"token punctuation\">.</span><span class=\"token function\">matchQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"å¤–æ»©\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token keyword\">new</span> <span class=\"token class-name\">FunctionScoreQueryBuilder<span class=\"token punctuation\">.</span>FilterFunctionBuilder</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>         <span class=\"token keyword\">new</span> <span class=\"token class-name\">FunctionScoreQueryBuilder<span class=\"token punctuation\">.</span>FilterFunctionBuilder</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token comment\">// è¿‡æ»¤å­—æ®µ</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token class-name\">QueryBuilders</span><span class=\"token punctuation\">.</span><span class=\"token function\">termQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"brand\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"å¦‚å®¶\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token comment\">// åŠ æƒ</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token class-name\">ScoreFunctionBuilders</span><span class=\"token punctuation\">.</span><span class=\"token function\">weightFactorFunction</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>         <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span>functionScoreQueryBuilder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token comment\">// 3. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   <span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      search <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">search</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>   <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span>search<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>   <span class=\"token comment\">// 4. è§£æå“åº”</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>   <span class=\"token class-name\">SearchHits</span> hits <span class=\"token operator\">=</span> search<span class=\"token punctuation\">.</span><span class=\"token function\">getHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>   <span class=\"token keyword\">long</span> value <span class=\"token operator\">=</span> hits<span class=\"token punctuation\">.</span><span class=\"token function\">getTotalHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å…±æœç´¢åˆ°\"</span> <span class=\"token operator\">+</span> value <span class=\"token operator\">+</span> <span class=\"token string\">\"æ¡æ•°æ®\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>   <span class=\"token class-name\">SearchHit</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> hits1 <span class=\"token operator\">=</span> hits<span class=\"token punctuation\">.</span><span class=\"token function\">getHits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SearchHit</span> hit <span class=\"token operator\">:</span> hits1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      <span class=\"token class-name\">String</span> json <span class=\"token operator\">=</span> hit<span class=\"token punctuation\">.</span><span class=\"token function\">getSourceAsString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token class-name\">HotelDoc</span> hotelDoc <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseObject</span><span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>      <span class=\"token comment\">// è·å–é«˜äº®ç»“æœ</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>      <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">HighlightField</span><span class=\"token punctuation\">></span></span> highlightFields <span class=\"token operator\">=</span> hit<span class=\"token punctuation\">.</span><span class=\"token function\">getHighlightFields</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>      <span class=\"token comment\">// CollectionUtilsï¼šSpring æä¾›çš„å·¥å…·ç±» isEmpty åˆ¤æ–­ Map é›†åˆæ˜¯å¦ä¸ºç©º</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span> <span class=\"token class-name\">CollectionUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>highlightFields<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>         <span class=\"token comment\">// æ ¹æ®å­—æ®µåè·å–é«˜äº®ç»“æœ</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>         <span class=\"token class-name\">HighlightField</span> name <span class=\"token operator\">=</span> highlightFields<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>         <span class=\"token comment\">// åˆ¤æ–­æ ¹æ®å­—æ®µè·å–çš„å†…å®¹æ˜¯å¦ä¸º null</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>         <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>         <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token comment\">// è·å–é«˜äº®å€¼</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token class-name\">String</span> content <span class=\"token operator\">=</span> name<span class=\"token punctuation\">.</span><span class=\"token function\">getFragments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token comment\">// è¦†ç›–éé«˜äº®ç»“æœ</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            hotelDoc<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hotelDoc: \"</span> <span class=\"token operator\">+</span> hotelDoc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token comment\">//--------------------- æ‰“å°ç»“æœ ---------------------</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>å…±æœç´¢åˆ°<span class=\"token number\">3</span>æ¡æ•°æ®</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>hotelDoc<span class=\"token operator\">:</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">434082</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span>å¦‚å®¶é…’åº—Â·<span class=\"token function\">neo</span><span class=\"token punctuation\">(</span>ä¸Šæµ·å¤–æ»©åŸéšåº™å°å—é—¨åœ°é“ç«™åº—<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> address<span class=\"token operator\">=</span>å¤å…´ä¸œè·¯<span class=\"token number\">260</span>å·<span class=\"token punctuation\">,</span> price<span class=\"token operator\">=</span><span class=\"token number\">392</span><span class=\"token punctuation\">,</span> score<span class=\"token operator\">=</span><span class=\"token number\">44</span><span class=\"token punctuation\">,</span> brand<span class=\"token operator\">=</span>å¦‚å®¶<span class=\"token punctuation\">,</span> city<span class=\"token operator\">=</span>ä¸Šæµ·<span class=\"token punctuation\">,</span> starName<span class=\"token operator\">=</span>äºŒé’»<span class=\"token punctuation\">,</span> business<span class=\"token operator\">=</span>è±«å›­åœ°åŒº<span class=\"token punctuation\">,</span> location<span class=\"token operator\">=</span><span class=\"token number\">31.220706</span><span class=\"token punctuation\">,</span> <span class=\"token number\">121.498769</span><span class=\"token punctuation\">,</span> pic<span class=\"token operator\">=</span>https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>m<span class=\"token punctuation\">.</span>tuniucdn<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>fb2<span class=\"token operator\">/</span>t1<span class=\"token operator\">/</span><span class=\"token constant\">G6</span><span class=\"token operator\">/</span><span class=\"token constant\">M00</span><span class=\"token operator\">/</span><span class=\"token number\">52</span><span class=\"token operator\">/</span><span class=\"token constant\">B6</span><span class=\"token operator\">/</span><span class=\"token class-name\">Cii</span><span class=\"token operator\">-</span><span class=\"token class-name\">U13eXLGIdHFzAAIG</span><span class=\"token operator\">-</span><span class=\"token number\">5</span>cEwDEAAGRfQNNIV0AAgcT627_w200_h200_c1_t0<span class=\"token punctuation\">.</span>jpg<span class=\"token punctuation\">,</span> distance<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> isAD<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>hotelDoc<span class=\"token operator\">:</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">60487</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span>ä¸Šæµ·å¤–æ»©èŒ‚æ‚¦å¤§é…’åº—<span class=\"token punctuation\">,</span> address<span class=\"token operator\">=</span>é»„æµ¦è·¯<span class=\"token number\">199</span>å·<span class=\"token punctuation\">,</span> price<span class=\"token operator\">=</span><span class=\"token number\">689</span><span class=\"token punctuation\">,</span> score<span class=\"token operator\">=</span><span class=\"token number\">44</span><span class=\"token punctuation\">,</span> brand<span class=\"token operator\">=</span>å›æ‚¦<span class=\"token punctuation\">,</span> city<span class=\"token operator\">=</span>ä¸Šæµ·<span class=\"token punctuation\">,</span> starName<span class=\"token operator\">=</span>äº”æ˜Ÿçº§<span class=\"token punctuation\">,</span> business<span class=\"token operator\">=</span>å¤–æ»©åœ°åŒº<span class=\"token punctuation\">,</span> location<span class=\"token operator\">=</span><span class=\"token number\">31.245409</span><span class=\"token punctuation\">,</span> <span class=\"token number\">121.492969</span><span class=\"token punctuation\">,</span> pic<span class=\"token operator\">=</span>https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>m<span class=\"token punctuation\">.</span>tuniucdn<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>fb3<span class=\"token operator\">/</span>s1<span class=\"token operator\">/</span><span class=\"token number\">2</span>n9c<span class=\"token operator\">/</span><span class=\"token number\">2</span>Swp2h1fdj9zCUKsk63BQvVgKLTo_w200_h200_c1_t0<span class=\"token punctuation\">.</span>jpg<span class=\"token punctuation\">,</span> distance<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> isAD<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>hotelDoc<span class=\"token operator\">:</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">=</span><span class=\"token number\">432335</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token number\">7</span>å¤©è¿é”é…’åº—<span class=\"token punctuation\">(</span>ä¸Šæµ·åŒ—å¤–æ»©å›½é™…å®¢è¿ä¸­å¿ƒåœ°é“ç«™åº—<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> address<span class=\"token operator\">=</span>å”å±±è·¯<span class=\"token number\">145</span>å·<span class=\"token punctuation\">,</span> price<span class=\"token operator\">=</span><span class=\"token number\">249</span><span class=\"token punctuation\">,</span> score<span class=\"token operator\">=</span><span class=\"token number\">35</span><span class=\"token punctuation\">,</span> brand<span class=\"token operator\">=</span><span class=\"token number\">7</span>å¤©é…’åº—<span class=\"token punctuation\">,</span> city<span class=\"token operator\">=</span>ä¸Šæµ·<span class=\"token punctuation\">,</span> starName<span class=\"token operator\">=</span>äºŒé’»<span class=\"token punctuation\">,</span> business<span class=\"token operator\">=</span>åŒ—å¤–æ»©åœ°åŒº<span class=\"token punctuation\">,</span> location<span class=\"token operator\">=</span><span class=\"token number\">31.252585</span><span class=\"token punctuation\">,</span> <span class=\"token number\">121.498753</span><span class=\"token punctuation\">,</span> pic<span class=\"token operator\">=</span>https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>m2<span class=\"token punctuation\">.</span>tuniucdn<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>filebroker<span class=\"token operator\">/</span>cdn<span class=\"token operator\">/</span>res<span class=\"token operator\">/</span>c1<span class=\"token operator\">/</span>ba<span class=\"token operator\">/</span>c1baf64418437c56617f89840c6411ef_w200_h200_c1_t0<span class=\"token punctuation\">.</span>jpg<span class=\"token punctuation\">,</span> distance<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> isAD<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h6 id=\"es-restclienté»‘é©¬æ—…æ¸¸æ¡ˆä¾‹é¡¹ç›®åœ°å€httpsgiteecomdoukaixintyporagit\"><a class=\"anchor\" href=\"#es-restclienté»‘é©¬æ—…æ¸¸æ¡ˆä¾‹é¡¹ç›®åœ°å€httpsgiteecomdoukaixintyporagit\">#</a> ES-RestClient é»‘é©¬æ—…æ¸¸æ¡ˆä¾‹ï¼Œé¡¹ç›®åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZG91a2FpeGluL3R5cG9yYS5naXQ=\">https://gitee.com/doukaixin/typora.git</span></h6>\n<h3 id=\"910-æ·±å…¥elasticsearch\"><a class=\"anchor\" href=\"#910-æ·±å…¥elasticsearch\">#</a> 9.10ã€æ·±å…¥ elasticsearchğŸŒ³</h3>\n<ul>\n<li>æ•°æ®èšåˆ</li>\n<li>è‡ªåŠ¨è¡¥å…¨</li>\n<li>æ•°æ®åŒæ­¥</li>\n<li>é›†ç¾¤</li>\n</ul>\n<h4 id=\"9101-æ•°æ®èšåˆ\"><a class=\"anchor\" href=\"#9101-æ•°æ®èšåˆ\">#</a> 9.10.1ã€æ•°æ®èšåˆğŸŒ²</h4>\n<ul>\n<li>èšåˆçš„ç§ç±»</li>\n<li>DSL å®ç°èšåˆ</li>\n<li>RestAPI å®ç°èšåˆ</li>\n</ul>\n<h5 id=\"91011-èšåˆçš„åˆ†ç±»\"><a class=\"anchor\" href=\"#91011-èšåˆçš„åˆ†ç±»\">#</a> 9.10.1.1ã€èšåˆçš„åˆ†ç±»ğŸŒ´</h5>\n<p>èšåˆ (aggregations) å¯ä»¥å®ç°å¯¹æ–‡æ¡£æ•°æ®çš„ç»Ÿè®¡ï¼Œåˆ†æï¼Œè¿ç®—ã€‚èšåˆå¸¸è§çš„æœ‰ä¸‰ç±»ï¼š</p>\n<p>&lt;font color='red'&gt; æ³¨æ„ &lt;/font&gt;ï¼šèšåˆçš„å­—æ®µä¸€å®šæ˜¯ä¸åˆ†è¯çš„ã€‚å¯ä»¥æ˜¯ keywordï¼Œæ—¥æœŸï¼Œæ•°å€¼ï¼Œå¸ƒå°”ï¼Œä½†ç»å¯¹ä¸å¯ä»¥æ˜¯ text ç±»å‹çš„</p>\n<ul>\n<li>æ¡¶ (Bucket) èšåˆï¼šç”¨æ¥å¯¹æ–‡æ¡£åšåˆ†ç»„\n<ul>\n<li>TermAggregationï¼šæŒ‰ç…§æ–‡æ¡£å­—æ®µå€¼åˆ†ç»„</li>\n<li>Date Histogramï¼šæŒ‰ç…§æ—¥æœŸé˜¶æ¢¯åˆ†ç»„ï¼Œä¾‹å¦‚ ä¸€å‘¨ä¸ºä¸€ç»„ï¼Œæˆ–è€… ä¸€æœˆä¸ºä¸€ç»„</li>\n</ul>\n</li>\n<li>åº¦é‡ (Metric) èšåˆï¼šç”¨ä»¥è®¡ç®—ä¸€äº›å€¼ï¼Œæ¯”å¦‚ï¼šæœ€å¤§å€¼ï¼Œæœ€å°å€¼ï¼Œå¹³å‡å€¼ç­‰\n<ul>\n<li>Avgï¼šæ±‚å¹³å‡å€¼</li>\n<li>Maxï¼šæ±‚æœ€å¤§å€¼</li>\n<li>Minï¼šæ±‚æœ€å°å€¼</li>\n<li>Statsï¼šåŒæ—¶æ±‚ maxï¼Œminï¼Œavgï¼Œsum ç­‰</li>\n</ul>\n</li>\n<li>ç®¡é“ (pipeline) èšåˆï¼šå¯¹å…¶å®ƒèšåˆçš„ç»“æœä¸ºåŸºç¡€åšèšåˆ</li>\n</ul>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>ä»€ä¹ˆæ˜¯èšåˆï¼Ÿ</p>\n<ul>\n<li>èšåˆæ˜¯å¯¹æ–‡æ¡£æ•°æ®çš„ç»Ÿè®¡ï¼Œåˆ†æï¼Œè®¡ç®—</li>\n</ul>\n<p>èšåˆçš„å¸¸è§ç§ç±»æœ‰å“ªäº›ï¼Ÿ</p>\n<ul>\n<li>Bucketï¼šå¯¹æ–‡æ¡£æ•°æ®åˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ç»„æ•°é‡</li>\n<li>Metricï¼šå¯¹æ–‡æ¡£æ•°æ®åšè®¡ç®—ï¼Œä¾‹å¦‚ avg</li>\n<li>Pipelineï¼šåŸºäºå…¶å®ƒèšåˆç»“æœå†åšèšåˆ</li>\n</ul>\n<p>å‚ä¸èšåˆçš„å­—æ®µç±»å‹å¿…é¡»æ˜¯ï¼š</p>\n<ul>\n<li>keyword</li>\n<li>æ•°å€¼</li>\n<li>æ—¥æœŸ</li>\n<li>å¸ƒå°”</li>\n</ul>\n</blockquote>\n<h6 id=\"910111-dslå®ç°bucketèšåˆ\"><a class=\"anchor\" href=\"#910111-dslå®ç°bucketèšåˆ\">#</a> 9.10.1.1.1ã€DSL å®ç° Bucket èšåˆğŸ‹</h6>\n<p>ç°åœ¨ï¼Œæˆ‘ä»¬è¦ç»Ÿè®¡æ‰€æœ‰æ•°æ®ä¸­çš„é…’åº—å“ç‰Œæœ‰å‡ ç§ï¼Œæ­¤æ—¶å¯ä»¥æ ¹æ®é…’åº—å“ç‰Œçš„åç§°åšèšåˆã€‚</p>\n<p>ç±»å‹ä¸º term ç±»å‹ï¼ŒDSL ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /indexName/_search</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// è®¾ç½® size ä¸º 0, ç»“æœä¸­ä¸åŒ…å«æ–‡æ¡£ï¼ŒåªåŒ…å«èšåˆç»“æœ</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token property\">\"aggs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// å®šä¹‰èšåˆ</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"brandAgg\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// ç»™èšåˆèµ·ä¸ªåå­—</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>         <span class=\"token property\">\"terms\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// èšåˆçš„ç±»å‹ï¼ŒæŒ‰ç…§å“ç‰Œå€¼èšåˆï¼Œæ‰€ä»¥é€‰æ‹© term</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token property\">\"field\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"brand\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// å‚ä¸èšåˆçš„å­—æ®µ</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span> <span class=\"token comment\">// å¸Œæœ›è·å–çš„èšåˆç»“æœæ•°é‡</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä»£ç æ¼”ç¤ºï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre># èšåˆåŠŸèƒ½</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>GET /dkx/_search</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token property\">\"aggs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token property\">\"brandAgg\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token property\">\"terms\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"field\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"brand\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">//----------------- æŸ¥è¯¢ç»“æœ -----------------</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token property\">\"buckets\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>          <span class=\"token property\">\"key\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"7å¤©é…’åº—\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>          <span class=\"token property\">\"doc_count\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">30</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>          <span class=\"token property\">\"key\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>          <span class=\"token property\">\"doc_count\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">30</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>          <span class=\"token property\">\"key\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"çš‡å† å‡æ—¥\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>          <span class=\"token property\">\"doc_count\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">17</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>          <span class=\"token property\">\"key\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"é€Ÿ8\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>          <span class=\"token property\">\"doc_count\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">15</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>   ...</pre></td></tr></table></figure><p>é»˜è®¤æ˜¯å€’åºæ’åºå€¼è¶Šå¤§çš„è¶Šé å‰ï¼Œæ’åºçš„è§„åˆ™æ˜¯å¯ä»¥è¿›è¡Œä¿®æ”¹çš„</p>\n<h6 id=\"910112-bucketèšåˆ-èšåˆç»“æœæ’åº\"><a class=\"anchor\" href=\"#910112-bucketèšåˆ-èšåˆç»“æœæ’åº\">#</a> 9.10.1.1.2ã€Bucket èšåˆ - èšåˆç»“æœæ’åºğŸ‹</h6>\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒBucket èšåˆä¼šç»Ÿè®¡ Bucket å†…çš„æ–‡æ¡£æ•°é‡ï¼Œè®°ä¸º <code>_count</code> ï¼Œå¹¶æŒ‰ç…§ <code>_count</code>  é™åºæ’åºã€‚</p>\n<p>æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ç»“æœæ’åºæ–¹å¼ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /indexName/_search</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token property\">\"aggs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"brandAgg\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>         <span class=\"token property\">\"terms\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token property\">\"field\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"brand\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token property\">\"order\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>               <span class=\"token property\">\"_count\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"asc\"</span> <span class=\"token comment\">// æŒ‰ç…§_count å‡åºæ’åˆ—</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä»£ç æ¼”ç¤ºï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre># èšåˆåŠŸèƒ½</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>GET /dkx/_search</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token property\">\"aggs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token property\">\"brandAgg\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token property\">\"terms\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"field\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"brand\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token property\">\"order\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>          <span class=\"token property\">\"_count\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"asc\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">//-------------- æ‰“å°ç»“æœ --------------</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token property\">\"brandAgg\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token property\">\"doc_count_error_upper_bound\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token property\">\"sum_other_doc_count\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">130</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token property\">\"buckets\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>          <span class=\"token property\">\"key\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ä¸‡ä¸½\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>          <span class=\"token property\">\"doc_count\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token property\">\"key\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ä¸½ç¬™\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>          <span class=\"token property\">\"doc_count\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>          <span class=\"token property\">\"key\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å›æ‚¦\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>          <span class=\"token property\">\"doc_count\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>         ...</pre></td></tr></table></figure><h6 id=\"910113-bucketèšåˆ-é™å®šèšåˆèŒƒå›´\"><a class=\"anchor\" href=\"#910113-bucketèšåˆ-é™å®šèšåˆèŒƒå›´\">#</a> 9.10.1.1.3ã€Bucket èšåˆ - é™å®šèšåˆèŒƒå›´ğŸ‹</h6>\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒBucket èšåˆæ˜¯å¯¹ç´¢å¼•åº“çš„æ‰€æœ‰æ–‡æ¡£åšèšåˆï¼Œæˆ‘ä»¬å¯ä»¥é™å®šè¦èšåˆçš„æ–‡æ¡£èŒƒå›´ï¼Œåªè¦æ·»åŠ  query æ¡ä»¶å³å¯ã€‚</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /indexName/_search</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token property\">\"range\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>         <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token property\">\"lte\"</span><span class=\"token operator\">:</span> <span class=\"token number\">200</span> <span class=\"token comment\">// åªå¯¹ 200 å…ƒä»¥ä¸‹çš„æ–‡æ¡£èšåˆ</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token property\">\"aggs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token property\">\"brandAgg\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>         <span class=\"token property\">\"terms\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token property\">\"field\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"brand\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä»£ç æ¼”ç¤ºï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre># èšåˆåŠŸèƒ½ï¼Œé™å®šèšåˆèŒƒå›´</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>GET /dkx/_search</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"range\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token property\">\"lte\"</span><span class=\"token operator\">:</span> <span class=\"token number\">200</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token property\">\"aggs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token property\">\"brandAgg\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token property\">\"terms\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token property\">\"field\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"brand\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token property\">\"order\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>          <span class=\"token property\">\"_count\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"asc\"</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">//---------------- æ‰“å°ç»“æœ ----------------</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token property\">\"buckets\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token property\">\"key\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"7å¤©é…’åº—\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>          <span class=\"token property\">\"doc_count\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>          <span class=\"token property\">\"key\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"æ±‰åº­\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>          <span class=\"token property\">\"doc_count\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>          <span class=\"token property\">\"key\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"é€Ÿ8\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>          <span class=\"token property\">\"doc_count\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>          <span class=\"token property\">\"key\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>          <span class=\"token property\">\"doc_count\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">13</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>      <span class=\"token punctuation\">]</span></pre></td></tr></table></figure><blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>aggs ä»£è¡¨èšåˆï¼Œä¸ query åŒçº§ï¼Œæ­¤æ—¶ query çš„ä½œç”¨æ˜¯ï¼Ÿ</p>\n<ul>\n<li>é™å®šèšåˆçš„æ–‡æ¡£èŒƒå›´</li>\n</ul>\n<p>èšåˆå¿…é¡»å¾—ä¸‰è¦ç´ ï¼š</p>\n<ul>\n<li>èšåˆåç§°</li>\n<li>èšåˆç±»å‹</li>\n<li>èšåˆå­—æ®µ</li>\n</ul>\n<p>èšåˆå¯é…ç½®å±æ€§æœ‰ï¼š</p>\n<ul>\n<li>sizeï¼šæŒ‡å®šèšåˆç»“æœæ•°é‡</li>\n<li>orderï¼šæŒ‡å®šèšåˆç»“æœæ’åºæ–¹å¼</li>\n<li>fieldï¼šæŒ‡å®šèšåˆå­—æ®µ</li>\n</ul>\n</blockquote>\n<h6 id=\"910114-dslå®ç°metricsèšåˆ\"><a class=\"anchor\" href=\"#910114-dslå®ç°metricsèšåˆ\">#</a> 9.10.1.1.4ã€DSL å®ç° Metrics èšåˆğŸ‹</h6>\n<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦æ±‚è·å–æ¯ä¸ªå“ç‰Œçš„ç”¨æˆ·è¯„åˆ†çš„ minï¼Œmaxï¼Œavg ç­‰å€¼ã€‚</p>\n<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ stats èšåˆï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /indexName/_search</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token property\">\"aggs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"brandAgg\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>         <span class=\"token property\">\"terms\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token property\">\"field\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"brand\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>         <span class=\"token property\">\"aggs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// æ˜¯ brands èšåˆçš„å­èšåˆï¼Œä¹Ÿå°±æ˜¯åˆ†ç»„åæ¯ç»„åˆ†åˆ«è®¡ç®—</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token property\">\"score_stats\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// èšåˆåç§°</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>               <span class=\"token property\">\"stats\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// èšåˆç±»å‹ï¼Œè¿™é‡Œ stats å¯ä»¥è®¡ç®— minï¼Œmaxï¼Œavg ç­‰</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                  <span class=\"token property\">\"field\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"score\"</span> <span class=\"token comment\">// èšåˆå­—æ®µï¼Œè¿™é‡Œæ˜¯ score</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>               <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä»£ç æ¼”ç¤ºï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre># åµŒå¥—èšåˆmetrics</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>GET /dkx/_search</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token property\">\"aggs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token property\">\"brandAgg\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token property\">\"terms\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"field\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"brand\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token property\">\"aggs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token property\">\"score_stats\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>          <span class=\"token property\">\"stats\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token property\">\"field\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"score\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">//------------------------- æ‰“å°ç»“æœ -------------------------</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token property\">\"buckets\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>          <span class=\"token property\">\"key\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"7å¤©é…’åº—\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>          <span class=\"token property\">\"doc_count\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>          <span class=\"token property\">\"score_stats\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token property\">\"count\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token property\">\"min\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">35.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token property\">\"max\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">43.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token property\">\"avg\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">37.86666666666667</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token property\">\"sum\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1136.0</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>          <span class=\"token property\">\"key\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>          <span class=\"token property\">\"doc_count\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>          <span class=\"token property\">\"score_stats\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token property\">\"count\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token property\">\"min\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">43.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token property\">\"max\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">47.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token property\">\"avg\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">44.833333333333336</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token property\">\"sum\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1345.0</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>   ...</pre></td></tr></table></figure><p>å¯¹ score_stats ä¸­çš„ avg åšä¸€ä¸ªæ’åº</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre># åµŒå¥—èšåˆmetrics</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>GET /dkx/_search</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token property\">\"aggs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token property\">\"brandAgg\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token property\">\"terms\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"field\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"brand\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token property\">\"order\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>          <span class=\"token property\">\"score_stats.avg\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"desc\"</span> <span class=\"token comment\">// å¯¹ score_stats ä¸­çš„ avg è¿›è¡Œé™åºæ’åº</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token property\">\"aggs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token property\">\"score_stats\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>          <span class=\"token property\">\"stats\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token property\">\"field\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"score\"</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">//---------------------- æ‰“å°ç»“æœ ----------------------</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token property\">\"buckets\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token property\">\"key\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ä¸‡ä¸½\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>          <span class=\"token property\">\"doc_count\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>          <span class=\"token property\">\"score_stats\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token property\">\"count\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token property\">\"min\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">46.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token property\">\"max\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">47.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token property\">\"avg\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">46.5</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token property\">\"sum\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">93.0</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>          <span class=\"token property\">\"key\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å‡¯æ‚¦\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>          <span class=\"token property\">\"doc_count\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>          <span class=\"token property\">\"score_stats\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token property\">\"count\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token property\">\"min\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">45.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token property\">\"max\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">47.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token property\">\"avg\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">46.25</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token property\">\"sum\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">370.0</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>   ...</pre></td></tr></table></figure><h5 id=\"91012-restapiå®ç°èšåˆ\"><a class=\"anchor\" href=\"#91012-restapiå®ç°èšåˆ\">#</a> 9.10.1.2ã€RestAPI å®ç°èšåˆğŸŒ´</h5>\n<p>æˆ‘ä»¬ä»¥å“ç‰Œèšåˆä¸ºä¾‹ï¼Œæ¼”ç¤ºä¸‹ Java çš„ RestClient ä½¿ç”¨ï¼Œå…ˆçœ‹è¯·æ±‚ç»„è£…ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310142115151.png\" alt=\"image-20231014211458877\" /></p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>@Test</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>public void testAggreation()</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡ Request</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   SearchRequest request = new SearchRequest(<span class=\"token string\">\"dkx\"</span>);</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// 2. å‡†å¤‡ DSL</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// 2.1. è®¾ç½® size å»æ‰æ–‡æ¡£æ•°æ®</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>request.source().size(<span class=\"token number\">0</span>);</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// 2.2. èšåˆ</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>request.source().aggregation(AggregationBuilders</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                             .terms(<span class=\"token string\">\"brandAgg\"</span>)</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                             .field(<span class=\"token string\">\"brand\"</span>)</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                             .size(<span class=\"token number\">10</span>)</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                            );</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">// 3. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>SearchResponse search;</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>try <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   search = client.search(request<span class=\"token punctuation\">,</span> RequestOptions.DEFAULT);</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span> catch (IOException e) <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   throw new RuntimeException(e);</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>System.out.println(search);</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">//-------------------- æ‰“å°ç»“æœ --------------------</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"took\"</span><span class=\"token operator\">:</span><span class=\"token number\">83</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"timed_out\"</span><span class=\"token operator\">:</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"_shards\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"successful\"</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"skipped\"</span><span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"failed\"</span><span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"hits\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span><span class=\"token number\">201</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"relation\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"eq\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"max_score\"</span><span class=\"token operator\">:</span><span class=\"token null keyword\">null</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"hits\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"aggregations\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"sterms#brandAgg\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"doc_count_error_upper_bound\"</span><span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"sum_other_doc_count\"</span><span class=\"token operator\">:</span><span class=\"token number\">39</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"buckets\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"7å¤©é…’åº—\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"doc_count\"</span><span class=\"token operator\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"å¦‚å®¶\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"doc_count\"</span><span class=\"token operator\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"çš‡å† å‡æ—¥\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"doc_count\"</span><span class=\"token operator\">:</span><span class=\"token number\">17</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"é€Ÿ8\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"doc_count\"</span><span class=\"token operator\">:</span><span class=\"token number\">15</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"ä¸‡æ€¡\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"doc_count\"</span><span class=\"token operator\">:</span><span class=\"token number\">13</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"åç¾è¾¾\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"doc_count\"</span><span class=\"token operator\">:</span><span class=\"token number\">13</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"å’Œé¢\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"doc_count\"</span><span class=\"token operator\">:</span><span class=\"token number\">12</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"ä¸‡è±ª\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"doc_count\"</span><span class=\"token operator\">:</span><span class=\"token number\">11</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"å–œæ¥ç™»\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"doc_count\"</span><span class=\"token operator\">:</span><span class=\"token number\">11</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"å¸Œå°”é¡¿\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"doc_count\"</span><span class=\"token operator\">:</span><span class=\"token number\">10</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h6 id=\"910121-èšåˆç»“æœè§£æ\"><a class=\"anchor\" href=\"#910121-èšåˆç»“æœè§£æ\">#</a> 9.10.1.2.1ã€èšåˆç»“æœè§£æğŸŒ´</h6>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310142127780.png\" alt=\"image-20231014212710555\" /></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testAggreation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡ Request</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">SearchRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SearchRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 2. å‡†å¤‡ DSL</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token comment\">// 2.1. è®¾ç½® size å»æ‰æ–‡æ¡£æ•°æ®</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">// 2.2. èšåˆ</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">aggregation</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AggregationBuilders</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                                <span class=\"token punctuation\">.</span><span class=\"token function\">terms</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"brandAgg\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                                <span class=\"token punctuation\">.</span><span class=\"token function\">field</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"brand\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                                <span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                               <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token comment\">// 3. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      search <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">search</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token comment\">// 4. è°ƒç”¨å‡½æ•°è§£æå“åº”ç»“æœ</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   <span class=\"token function\">handleAgg</span><span class=\"token punctuation\">(</span>search<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handleAgg</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token class-name\">Aggregations</span> aggregations <span class=\"token operator\">=</span> search<span class=\"token punctuation\">.</span><span class=\"token function\">getAggregations</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>   <span class=\"token comment\">// 4.1. æ ¹æ®èšåˆåç§°è·å–èšåˆç»“æœ</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>   <span class=\"token class-name\">Terms</span> brandTerms <span class=\"token operator\">=</span> aggregations<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"brandAgg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>   <span class=\"token comment\">// 4.2. è·å– Buckets</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Terms<span class=\"token punctuation\">.</span>Bucket</span><span class=\"token punctuation\">></span></span> buckets <span class=\"token operator\">=</span> brandTerms<span class=\"token punctuation\">.</span><span class=\"token function\">getBuckets</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>   <span class=\"token comment\">// 4.3. éå†æ¡¶</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Terms<span class=\"token punctuation\">.</span>Bucket</span> bucket <span class=\"token operator\">:</span> buckets<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token comment\">// 4.4. è·å– key</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token class-name\">String</span> keyAsString <span class=\"token operator\">=</span> bucket<span class=\"token punctuation\">.</span><span class=\"token function\">getKeyAsString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>keyAsString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">//------------------- æ‰“å°ç»“æœ -------------------</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token number\">7</span>å¤©é…’åº—</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>å¦‚å®¶</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>çš‡å† å‡æ—¥</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>é€Ÿ<span class=\"token number\">8</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>ä¸‡æ€¡</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>åç¾è¾¾</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>å’Œé¢</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>ä¸‡è±ª</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>å–œæ¥ç™»</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>å¸Œå°”é¡¿</pre></td></tr></table></figure><h4 id=\"9102-è‡ªåŠ¨è¡¥å…¨\"><a class=\"anchor\" href=\"#9102-è‡ªåŠ¨è¡¥å…¨\">#</a> 9.10.2ã€è‡ªåŠ¨è¡¥å…¨ğŸŒ²</h4>\n<ul>\n<li>æ‹¼éŸ³åˆ†è¯å™¨</li>\n<li>è‡ªå®šä¹‰åˆ†è¯å™¨</li>\n<li>è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢</li>\n<li>å®ç°é…’åº—æœç´¢æ¡†è‡ªåŠ¨è¡¥å…¨</li>\n</ul>\n<h5 id=\"91021-è‡ªåŠ¨è¡¥å…¨éœ€æ±‚è¯´æ˜\"><a class=\"anchor\" href=\"#91021-è‡ªåŠ¨è¡¥å…¨éœ€æ±‚è¯´æ˜\">#</a> 9.10.2.1ã€è‡ªåŠ¨è¡¥å…¨éœ€æ±‚è¯´æ˜ğŸŒ´</h5>\n<p>å½“ç”¨æˆ·åœ¨æœç´¢æ¡†è¾“å…¥å­—ç¬¦æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥æç¤ºå‡ºä¸è¯¥å­—ç¬¦æœ‰å…³çš„æœç´¢é¡¹ï¼Œå¦‚å›¾ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310142231178.png\" alt=\"image-20231014223100805\" /></p>\n<h5 id=\"91022-ä½¿ç”¨æ‹¼éŸ³åˆ†è¯\"><a class=\"anchor\" href=\"#91022-ä½¿ç”¨æ‹¼éŸ³åˆ†è¯\">#</a> 9.10.2.2ã€ä½¿ç”¨æ‹¼éŸ³åˆ†è¯ğŸŒ´</h5>\n<p>è¦å®ç°æ ¹æ®å­—æ¯åšä¸å…¨ï¼Œå°±å¿…é¡»å¯¹æ–‡æ¡£æŒ‰ç…§æ‹¼éŸ³åˆ†è¯ã€‚åœ¨ GitHub ä¸Šæ°å¥½æœ‰ elasticsearch çš„æ‹¼éŸ³åˆ†è¯æ’ä»¶ã€‚åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21lZGNsL2VsYXN0aWNzZWFyY2gtYW5hbHlzaXMtcGlueWluL3JlbGVhc2Vz\">https://github.com/medcl/elasticsearch-analysis-pinyin/releases</span></p>\n<p>å®‰è£…æ–¹å¼ä¸ IK åˆ†è¯å™¨ä¸€æ ·ï¼Œåˆ†ä¸‰æ­¥ï¼š</p>\n<p>1ã€è§£å‹</p>\n<p>2ã€ä¸Šä¼ åˆ°è™šæ‹Ÿæœºä¸­ï¼Œelasticsearch çš„ plugin ç›®å½•</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310142242869.png\" alt=\"image-20231014224223983\" /></p>\n<p>3ã€é‡å¯ elasticsearch</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@192 _data<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker restart es</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>es</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@192 _data<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>4ã€æµ‹è¯•</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310142248099.png\" alt=\"image-20231014224855664\" /></p>\n<h5 id=\"91023-è‡ªå®šä¹‰åˆ†è¯å™¨\"><a class=\"anchor\" href=\"#91023-è‡ªå®šä¹‰åˆ†è¯å™¨\">#</a> 9.10.2.3ã€è‡ªå®šä¹‰åˆ†è¯å™¨ğŸŒ´</h5>\n<p>elasticsearch ä¸­åˆ†è¯å™¨ (analyzer) çš„ç»„æˆåŒ…å«ä¸‰éƒ¨åˆ†ï¼š</p>\n<ul>\n<li>character filtersï¼šåœ¨ tokenizer ä¹‹å‰å¯¹æœ¬æ–‡è¿›è¡Œå¤„ç†ã€‚ä¾‹å¦‚åˆ é™¤å­—ç¬¦ï¼Œæ›¿æ¢å­—ç¬¦</li>\n<li>tokenizerï¼šå°†æ–‡æœ¬æŒ‰ç…§ä¸€å®šçš„è§„åˆ™åˆ‡å‰²æˆè¯æ¡ (term)ã€‚ä¾‹å¦‚ keywordï¼Œå°±æ˜¯ä¸åˆ†è¯ï¼›è¿˜æœ‰ ik_smart</li>\n<li>tokenizer filterï¼šå°† tokenizer è¾“å‡ºçš„è¯æ¡åšè¿›ä¸€æ­¥å¤„ç†ã€‚ä¾‹å¦‚å¤§å°å†™è½¬æ¢ï¼ŒåŒä¹‰è¯å¤„ç†ï¼Œæ‹¼éŸ³å¤„ç†ç­‰</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310151109094.png\" alt=\"image-20231015110900632\" /></p>\n<p>æˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºç´¢å¼•åº“æ—¶ï¼Œé€šè¿‡ settings æ¥é…ç½®è‡ªå®šä¹‰çš„ analyzer (åˆ†è¯å™¨)ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310151115651.png\" alt=\"image-20231015111515104\" /></p>\n<p>ä»£ç æ¼”ç¤ºï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre># è‡ªå®šä¹‰åˆ†è¯å™¨</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>PUT /test</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"settings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"analysis\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token property\">\"my_analzer\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>          <span class=\"token property\">\"tokenizer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ik_max_word\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>          <span class=\"token property\">\"filter\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"py\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token property\">\"filter\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token property\">\"py\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>          <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"pinyin\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>          <span class=\"token property\">\"keep_full_pinyin\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>          <span class=\"token property\">\"keep_joined_full_pinyin\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>          <span class=\"token property\">\"keep_original\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>          <span class=\"token property\">\"limit_first_letter_length\"</span><span class=\"token operator\">:</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>          <span class=\"token property\">\"remove_duplicated_term\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>          <span class=\"token property\">\"none_chinese_pinyin_tokenize\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token property\">\"mappings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my_analzer\"</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æµ‹è¯•</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>POST /test/_analyze <span class=\"token comment\">// ä½¿ç”¨ my_analzer è‡ªå®šä¹‰åˆ†è¯å™¨éœ€è¦å¸¦ä¸Š test ç´¢å¼•åº“å</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"å¦‚å®¶é…’åº—è¿˜ä¸é”™å˜›\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my_analzer\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">//------------------ æŸ¥è¯¢ç»“æœ ------------------</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token property\">\"tokens\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"å¦‚å®¶\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"rujia\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"rj\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"é…’åº—\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"jiudian\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>      <span class=\"token property\">\"token\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"jd\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      <span class=\"token property\">\"start_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>      <span class=\"token property\">\"end_offset\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"CN_WORD\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      <span class=\"token property\">\"position\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>   ...</pre></td></tr></table></figure><p>æ·»åŠ ä¸¤ä¸ª name å­—æ®µç„¶åå†é€šè¿‡æ‹¼éŸ³æµ‹è¯•æ˜¯å¦èƒ½æŸ¥è¯¢åˆ°</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>POST /test/_doc/<span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ç‹®å­\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>POST /test/_doc/<span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"æŸ¿å­\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æŸ¥è¯¢æµ‹è¯•ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /test/_search</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shizi\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//---------------------- æŸ¥è¯¢ç»“æœ ----------------------</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token property\">\"hits\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token property\">\"_index\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"test\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token property\">\"_type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token property\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token property\">\"_score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0.25069216</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token property\">\"_source\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>          <span class=\"token property\">\"id\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>          <span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ç‹®å­\"</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token property\">\"_index\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"test\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token property\">\"_type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token property\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token property\">\"_score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0.25069216</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token property\">\"_source\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token property\">\"id\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>          <span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"æŸ¿å­\"</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>ä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœæŸ¥è¯¢çš„æ˜¯ä¸­æ–‡çš„ â€œç‹®å­â€ ä¹Ÿå°±æŸ¥è¯¢å‡ºåŒéŸ³çš„ç»“æœæµ‹è¯•å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /test/_search</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"æ‰å…¥ç‹®å­ç¬¼\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//-------------------- æŸ¥è¯¢ç»“æœ --------------------</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token property\">\"hits\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token property\">\"_index\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"test\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token property\">\"_type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token property\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token property\">\"_score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0.33425623</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token property\">\"_source\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>          <span class=\"token property\">\"id\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>          <span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ç‹®å­\"</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token property\">\"_index\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"test\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token property\">\"_type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token property\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token property\">\"_score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0.3085442</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token property\">\"_source\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token property\">\"id\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>          <span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"æŸ¿å­\"</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>æ‹¼éŸ³åˆ†è¯å™¨åˆé€‚åœ¨åˆ›å»ºå€’æ’ç´¢å¼•çš„æ—¶å€™ä½¿ç”¨ï¼Œä½†ä¸èƒ½åœ¨æœç´¢çš„æ—¶å€™ä½¿ç”¨ã€‚</p>\n<p>åˆ›å»ºå€’æ’ç´¢å¼•æ—¶ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310151144762.png\" alt=\"image-20231015114300456\" /></p>\n<p>æˆ‘ä»¬è¦åˆ†å¼€ï¼Œåˆ›å»ºæ—¶å’Œæœç´¢æ—¶ä½¿ç”¨ä¸åŒçš„åˆ†è¯å™¨</p>\n<p>å› æ­¤å­—æ®µåœ¨åˆ›å»ºå€’æ’ç´¢å¼•æ—¶åº”è¯¥ç”¨  <code>my_analyer</code>  åˆ†è¯å™¨ï¼Œå­—æ®µåœ¨æœç´¢æ—¶åº”è¯¥ä½¿ç”¨  <code>ik_smart</code>  åˆ†è¯å™¨ï¼›</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre># è‡ªå®šä¹‰åˆ†è¯å™¨</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>PUT /test</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"settings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"analysis\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token property\">\"my_analzer\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>          <span class=\"token property\">\"tokenizer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ik_max_word\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>          <span class=\"token property\">\"filter\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"py\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token property\">\"filter\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token property\">\"py\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>          ...</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token property\">\"mappings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my_analzer\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// åˆ›å»ºç´¢å¼•æ—¶ä½¿ç”¨çš„åˆ†è¯å™¨</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>         <span class=\"token property\">\"search_analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ik_smart\"</span> <span class=\"token comment\">// æœç´¢æ—¶ä½¿ç”¨çš„åˆ†è¯å™¨</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä»£ç æ¼”ç¤ºï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre># è‡ªå®šä¹‰åˆ†è¯å™¨</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>PUT /test</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"settings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"analysis\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token property\">\"my_analzer\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>          <span class=\"token property\">\"tokenizer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ik_max_word\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>          <span class=\"token property\">\"filter\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"py\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token property\">\"filter\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token property\">\"py\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>          <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"pinyin\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>          <span class=\"token property\">\"keep_full_pinyin\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>          <span class=\"token property\">\"keep_joined_full_pinyin\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>          <span class=\"token property\">\"keep_original\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>          <span class=\"token property\">\"limit_first_letter_length\"</span><span class=\"token operator\">:</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>          <span class=\"token property\">\"remove_duplicated_term\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>          <span class=\"token property\">\"none_chinese_pinyin_tokenize\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token property\">\"mappings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my_analzer\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token property\">\"search_analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ik_smart\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>POST /test/_doc/<span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ç‹®å­\"</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>POST /test/_doc/<span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"æŸ¿å­\"</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æµ‹è¯•æŸ¥è¯¢ç»“æœï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /test/_search</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"æ‰å…¥ç‹®å­ç¬¼\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//--------------------- æŸ¥è¯¢ç»“æœ ---------------------</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token property\">\"hits\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token property\">\"_index\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"test\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token property\">\"_type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token property\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token property\">\"_score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">0.9530773</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token property\">\"_source\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>          <span class=\"token property\">\"id\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>          <span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"ç‹®å­\"</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">]</span></pre></td></tr></table></figure><blockquote>\n<p>æ€»ç»“ï¼š</p>\n<p>å¦‚ä½•ä½¿ç”¨æ‹¼éŸ³åˆ†è¯å™¨ï¼Ÿ</p>\n<ol>\n<li>ä¸‹è½½ pinyin åˆ†è¯å™¨</li>\n<li>è§£å‹å¹¶æ”¾åˆ° elasticsearch çš„ plugin ç›®å½•</li>\n<li>é‡å¯å³å¯</li>\n</ol>\n<p>å¦‚ä½•è‡ªå®šä¹‰åˆ†è¯å™¨ï¼Ÿ</p>\n<ol>\n<li>åˆ›å»ºç´¢å¼•åº“æ—¶ï¼Œåœ¨ settings ä¸­é…ç½®ï¼Œå¯ä»¥åŒ…å«ä¸‰éƒ¨åˆ†</li>\n<li>character filter</li>\n<li>tokenizer</li>\n<li>filter</li>\n</ol>\n<p>æ‹¼éŸ³åˆ†è¯å™¨æ³¨æ„äº‹é¡¹ï¼Ÿ</p>\n<ul>\n<li>ä¸ºäº†é¿å…æœç´¢åˆ°åŒéŸ³å­—ï¼Œæœç´¢æ—¶ä¸è¦ä½¿ç”¨æ‹¼éŸ³åˆ†è¯å™¨</li>\n</ul>\n</blockquote>\n<h5 id=\"91024-completion-suggesteræŸ¥è¯¢\"><a class=\"anchor\" href=\"#91024-completion-suggesteræŸ¥è¯¢\">#</a> 9.10.2.4ã€completion suggester æŸ¥è¯¢ğŸŒ´</h5>\n<p>elasticsearch æä¾›äº† Completion Suggester æŸ¥è¯¢æ¥å®ç°è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ã€‚è¿™ä¸ªæŸ¥è¯¢ä¼šåŒ¹é…ä»¥ç”¨æˆ·è¾“å…¥å†…å®¹å¼€å¤´çš„è¯æ¡å¹¶è¿”å›ã€‚ä¸ºäº†æé«˜è¡¥å…¨æŸ¥è¯¢çš„æ•ˆç‡ï¼Œå¯¹äºæ–‡æ¡£ä¸­å­—æ®µçš„ç±»å‹æœ‰ä¸€äº›çº¦æŸ</p>\n<ul>\n<li>å‚ä¸è¡¥å…¨æŸ¥è¯¢çš„å­—æ®µå¿…é¡»æ˜¯ completion ç±»å‹ã€‚</li>\n<li>å­—æ®µçš„å†…å®¹ä¸€èˆ¬æ˜¯ç”¨æ¥è¡¥å…¨çš„å¤šä¸ªè¯æ¡å½¢æˆçš„æ•°ç»„ã€‚</li>\n</ul>\n<p>æ–‡æ¡£ä¸­ titleï¼š[â€œSonyâ€, â€œWH-1000XM3â€] ã€‚å­—æ®µå€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œâ€œå“ç‰Œâ€, â€œäº§å“â€ã€‚å®ƒæ˜¯å½¢æˆäº†ä¸¤ä¸ªè¯æ¡è€Œä¸æ˜¯ä¸€ä¸ªè¯æ¡ä¸ºä»€ä¹ˆè¦åˆ†å¼€å‘¢ï¼Ÿ</p>\n<p>åŸå› ï¼šè‡ªåŠ¨è¡¥å…¨æ˜¯æ ¹æ®è¯æ¡åšè‡ªåŠ¨è¡¥å…¨çš„ï¼Œå¦‚æœå°†ä¸¤ä¸ªä¿¡æ¯ä½•ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²å°†æ¥åšè‡ªåŠ¨è¡¥å…¨æ—¶å°±åªèƒ½é€šè¿‡ S æ¥è¡¥å…¨äº†ï¼Œè€Œè¾“å…¥ W æ—¶æ˜¯ä¸ä¼šè¡¥å…¨äº§å“åç§°çš„ï¼Œåˆ†æˆæ•°ç»„å°±æ˜¯ä¸¤ä¸ªè¯ã€‚ç”¨æˆ·è¾“å…¥ S æ—¶èƒ½è¡¥å…¨ â€œSonyâ€ï¼Œç”¨æˆ·è¾“å…¥ W æ—¶èƒ½è¡¥å…¨ â€œWH-1000XM3â€ï¼Œæˆ‘ä»¬å°½é‡å§è¯è¯­åˆ†æˆä¸€ä¸ªä¸€ä¸ªè¯æ¡æ”¾åˆ°æ•°ç»„ä¸­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310151210270.png\" alt=\"image-20231015121026947\" /></p>\n<p>æŸ¥è¯¢è¯­æ³•å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>GET /test/_search</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token property\">\"suggest\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"title_suggest\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>         <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"s\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// å…³é”®å­—</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>         <span class=\"token property\">\"completion\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token property\">\"field\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// è¡¥å…¨æŸ¥è¯¢çš„å­—æ®µ</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token property\">\"skip_duplicates\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// è·³è¿‡é‡å¤çš„</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span> <span class=\"token comment\">// è·å–å‰ 10 æ¡ç»“æœ</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä»£ç æ¼”ç¤ºï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre># è‡ªåŠ¨è¡¥å…¨çš„ç´¢å¼•åº“</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>PUT /test1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"mappings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"completion\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre># æ·»åŠ ç¤ºä¾‹æ•°æ®</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>POST /test1/_doc</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Sony\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"WH-1000XM3\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>POST /test1/_doc</pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"SK-II\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PITERA\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>POST /test1/_doc</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Nintendo\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"switch\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æµ‹è¯•æŸ¥è¯¢è¡¥å…¨ç»“æœï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre># è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>GET /test1/_search</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"suggest\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"titleSuggest\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"so\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token property\">\"completion\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"field\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token property\">\"skip_duplicates\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">//------------------- æŸ¥è¯¢ç»“æœ -------------------</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token property\">\"options\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>          <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token property\">\"text\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"Sony\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token property\">\"_index\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"test1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token property\">\"_type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token property\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"reCRMYsBNslGvgguxrYc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token property\">\"_score\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token property\">\"_source\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>              <span class=\"token property\">\"title\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                <span class=\"token string\">\"Sony\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token string\">\"WH-1000XM3\"</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>              <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token punctuation\">]</span></pre></td></tr></table></figure><blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>è‡ªåŠ¨è¡¥å…¨å¯¹å­—æ®µçš„è¦æ±‚ï¼š</p>\n<ul>\n<li>ç±»å‹æ˜¯ completion ç±»å‹</li>\n<li>å­—æ®µå€¼æ˜¯å¤šæ¬¡è¯æ¡çš„æ•°ç»„</li>\n</ul>\n</blockquote>\n<h5 id=\"91025-restapiå®ç°è‡ªåŠ¨è¡¥å…¨\"><a class=\"anchor\" href=\"#91025-restapiå®ç°è‡ªåŠ¨è¡¥å…¨\">#</a> 9.10.2.5ã€RestAPI å®ç°è‡ªåŠ¨è¡¥å…¨ğŸŒ´</h5>\n<p>å…ˆçœ‹è¯·æ±‚å‚æ•°æ„é€ çš„ APIï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310151435297.png\" alt=\"image-20231015143537333\" /></p>\n<p>ä»£ç æ¼”ç¤ºï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>@Test</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>public void testSuggest()</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 1. å‡†å¤‡ Request</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    SearchRequest request = new SearchRequest(<span class=\"token string\">\"dkx\"</span>);</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// 2. å‡†å¤‡ DSL</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    request.source().suggest(new SuggestBuilder()</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            .addSuggestion(</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                    <span class=\"token string\">\"mySuggestion\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                    SuggestBuilders</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                            .completionSuggestion(<span class=\"token string\">\"suggestion\"</span>)</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                            .prefix(<span class=\"token string\">\"so\"</span>)</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                            .size(<span class=\"token number\">10</span>)</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            ));</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\">// 3. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    SearchResponse search;</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    try <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>         search = client.search(request<span class=\"token punctuation\">,</span> RequestOptions.DEFAULT);</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>     <span class=\"token punctuation\">&#125;</span> catch (IOException e) <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>         throw new RuntimeException(e);</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>     <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>     System.out.println(search);</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">//---------------------- æ‰“å°ç»“æœ ----------------------</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token property\">\"suggest\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"mySuggestion\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"so\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"offset\"</span><span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"length\"</span><span class=\"token operator\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"options\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"æ¾å²—å•†ä¸šä¸­å¿ƒåŒº\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"1393017952\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"address\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"æ¾å²—é•‡æ²³æ»¨åŒ—è·¯12å·ç››åå¤§å¦\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"brand\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"æ±‰åº­\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"business\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"æ¾å²—å•†ä¸šä¸­å¿ƒåŒº\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"city\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"æ·±åœ³\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span><span class=\"token number\">1393017952</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"location\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"22.768912, 113.83325\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"æ±‰åº­é…’åº—(æ·±åœ³å®å®‰æ¾å²—åœ°é“ç«™åº—)\"</span><span class=\"token punctuation\">,</span></pre></td></tr></table></figure><h6 id=\"910251-ç»“æœè§£æ\"><a class=\"anchor\" href=\"#910251-ç»“æœè§£æ\">#</a> 9.10.2.5.1ã€ç»“æœè§£æğŸ‹</h6>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310151448335.png\" alt=\"image-20231015144817860\" /></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testSuggest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡ Request</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">SearchRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SearchRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// 2. å‡†å¤‡ DSL</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">suggest</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">SuggestBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                            <span class=\"token punctuation\">.</span><span class=\"token function\">addSuggestion</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                               <span class=\"token string\">\"suggestions\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                               <span class=\"token class-name\">SuggestBuilders</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                               <span class=\"token punctuation\">.</span><span class=\"token function\">completionSuggestion</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"suggestion\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                               <span class=\"token punctuation\">.</span><span class=\"token function\">prefix</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"so\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                               <span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token comment\">// 3. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      search <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">search</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token comment\">// 4. è§£æç»“æœ</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   <span class=\"token function\">handleSuggestion</span><span class=\"token punctuation\">(</span>search<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handleSuggestion</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SearchResponse</span> search<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>   <span class=\"token class-name\">Suggest</span> suggest <span class=\"token operator\">=</span> search<span class=\"token punctuation\">.</span><span class=\"token function\">getSuggest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token comment\">// 4.1. æ ¹æ®è¡¥å…¨æŸ¥è¯¢åç§°ï¼Œè·å–è¡¥å…¨ç»“æœ</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>   <span class=\"token class-name\">CompletionSuggestion</span> suggestion <span class=\"token operator\">=</span> suggest<span class=\"token punctuation\">.</span><span class=\"token function\">getSuggestion</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"suggestions\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>   <span class=\"token comment\">// 4.2. è·å– options</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">CompletionSuggestion<span class=\"token punctuation\">.</span>Entry<span class=\"token punctuation\">.</span>Option</span><span class=\"token punctuation\">></span></span> options <span class=\"token operator\">=</span> suggestion<span class=\"token punctuation\">.</span><span class=\"token function\">getOptions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>   <span class=\"token comment\">// 4.3. éå†ç»“æœ</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">CompletionSuggestion<span class=\"token punctuation\">.</span>Entry<span class=\"token punctuation\">.</span>Option</span> option <span class=\"token operator\">:</span> options<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token comment\">// 4.4. è·å– text çš„å€¼</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token class-name\">String</span> content <span class=\"token operator\">=</span> option<span class=\"token punctuation\">.</span><span class=\"token function\">getText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token comment\">//-------------------- æ‰“å°ç»“æœ --------------------</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>æ¾å²—å•†ä¸šä¸­å¿ƒåŒº</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>æ¾å²—å•†ä¸šä¸­å¿ƒåŒº</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>æ¾æ±Ÿå¤§å­¦åŸ</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>æ¾æ±Ÿå¤§å­¦åŸ</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>æ¾æ±Ÿå¤§å­¦åŸ</pre></td></tr></table></figure><h4 id=\"9103-æ•°æ®åŒæ­¥\"><a class=\"anchor\" href=\"#9103-æ•°æ®åŒæ­¥\">#</a> 9.10.3ã€æ•°æ®åŒæ­¥ğŸŒ²</h4>\n<ul>\n<li>æ•°æ®åŒæ­¥æ€è·¯åˆ†æ</li>\n<li>å®ç° elasticsearch ä¸æ•°æ®åº“æ•°æ®åŒæ­¥</li>\n</ul>\n<h5 id=\"91031-æ•°æ®åŒæ­¥é—®é¢˜åˆ†æ\"><a class=\"anchor\" href=\"#91031-æ•°æ®åŒæ­¥é—®é¢˜åˆ†æ\">#</a> 9.10.3.1ã€æ•°æ®åŒæ­¥é—®é¢˜åˆ†æğŸŒ´</h5>\n<p>elasticsearch ä¸­çš„é…’åº—æ•°æ®æ¥è‡ªäº mysql æ•°æ®åº“ï¼Œå› æ­¤ mysql æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œelasticsearch ä¹Ÿå¿…é¡»è·Ÿç€æ”¹å˜ï¼Œè¿™ä¸ªå°±æ˜¯ elasticsearch ä¸ mysql ä¹‹é—´çš„<mark>æ•°æ®åŒæ­¥</mark>ã€‚</p>\n<h6 id=\"910311-æ–¹æ¡ˆä¸€åŒæ­¥è°ƒç”¨\"><a class=\"anchor\" href=\"#910311-æ–¹æ¡ˆä¸€åŒæ­¥è°ƒç”¨\">#</a> 9.10.3.1.1ã€æ–¹æ¡ˆä¸€ï¼šåŒæ­¥è°ƒç”¨ğŸ‹</h6>\n<p>ç¼ºç‚¹ï¼šä¸šåŠ¡è€¦åˆ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310151525267.png\" alt=\"image-20231015152527620\" /></p>\n<h6 id=\"910312-æ–¹æ¡ˆäºŒå¼‚æ­¥é€šçŸ¥\"><a class=\"anchor\" href=\"#910312-æ–¹æ¡ˆäºŒå¼‚æ­¥é€šçŸ¥\">#</a> 9.10.3.1.2ã€æ–¹æ¡ˆäºŒï¼šå¼‚æ­¥é€šçŸ¥ğŸ‹</h6>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310151528971.png\" alt=\"image-20231015152813104\" /></p>\n<h6 id=\"910313-æ–¹æ¡ˆä¸‰ç›‘å¬binlog\"><a class=\"anchor\" href=\"#910313-æ–¹æ¡ˆä¸‰ç›‘å¬binlog\">#</a> 9.10.3.1.3ã€æ–¹æ¡ˆä¸‰ï¼šç›‘å¬ binlogğŸ‹</h6>\n<p>åœ¨ mysql ä¸­ binlog é»˜è®¤æ˜¯å…³é—­çš„ï¼Œä½†æ˜¯å¼€å¯äº† binlog åœ¨ mysql é‡Œåš CRUD æ—¶éƒ½ä¼šå°†ç›¸åº”çš„æ“ä½œè®°å½•åœ¨ binlog ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ mysql å˜åŒ–äº† binlog å°±ä¼šå˜åŒ–ï¼Œè€Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Canal è¿™æ ·çš„ä¸­é—´ä»¶å»ç›‘å¬ binlogã€‚ä¸€æ—¦ binlog å‘ç”Ÿå˜åŒ–å°±å»é€šçŸ¥å¾®æœåŠ¡æ›´æ–° es æ•°æ®</p>\n<p>ç¼ºç‚¹ï¼šå¢åŠ äº† mysql çš„å‹åŠ›</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310151529543.png\" alt=\"image-20231015152942969\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>:</p>\n<p>æ–¹å¼ä¸€ï¼šåŒæ­¥è°ƒç”¨</p>\n<ul>\n<li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œç²—æš´</li>\n<li>ç¼ºç‚¹ï¼šä¸šåŠ¡è€¦åˆåº¦å¤ªé«˜</li>\n</ul>\n<p>æ–¹å¼äºŒï¼šå¼‚æ­¥é€šçŸ¥</p>\n<ul>\n<li>ä¼˜ç‚¹ï¼šä½è€¦åˆï¼Œå®ç°éš¾åº¦ä¸€èˆ¬</li>\n<li>ç¼ºç‚¹ï¼šä¾èµ– mq çš„å¯é æ€§</li>\n</ul>\n<p>æ–¹å¼ä¸‰ï¼šç›‘å¬ binlog</p>\n<ul>\n<li>ä¼˜ç‚¹ï¼šå®Œå…¨è§£é™¤æœåŠ¡é—´è€¦åˆ</li>\n<li>ç¼ºç‚¹ï¼šå¼€å¯ binlog å¢åŠ æ•°æ®åº“è´Ÿæ‹…ï¼Œå®ç°å¤æ‚åº¦é«˜</li>\n</ul>\n</blockquote>\n<h5 id=\"91032-åˆ©ç”¨mqå®ç°mysqlä¸elasticsearchæ•°æ®åŒæ­¥\"><a class=\"anchor\" href=\"#91032-åˆ©ç”¨mqå®ç°mysqlä¸elasticsearchæ•°æ®åŒæ­¥\">#</a> 9.10.3.2ã€åˆ©ç”¨ MQ å®ç° mysql ä¸ elasticsearch æ•°æ®åŒæ­¥ğŸŒ´</h5>\n<p>åˆ©ç”¨è¯¾å‰èµ„æ–™æä¾›çš„ hotel-admin é¡¹ç›®ä½œä¸ºé…’åº—ç®¡ç†çš„å¾®æœåŠ¡ã€‚å½“æ•°æ®åº“å‘ç”Ÿ CRUD æ—¶ï¼Œè¦æ±‚å¯¹ elasticsearch ä¸­æ•°æ®ä¹Ÿè¦å®Œæˆç›¸åŒæ“ä½œã€‚</p>\n<p>æ­¥éª¤ï¼š</p>\n<ul>\n<li>å¯¼å…¥ hotel-admin é¡¹ç›® (é¡¹ç›®åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZG91a2FpeGluL3R5cG9yYS5naXQ=\">https://gitee.com/doukaixin/typora.git</span>)ï¼Œå¯åŠ¨å¹¶æµ‹è¯•é…’åº—æ•°æ®çš„ CRUD</li>\n<li>å£°æ˜ exchangeï¼Œqueueï¼ŒRoutingkey</li>\n<li>åœ¨ hotel-admin ä¸­çš„å¢ï¼Œåˆ ï¼Œæ”¹ä¸šåŠ¡ä¸­å®Œæˆæ¶ˆæ¯å‘é€</li>\n<li>åœ¨ hotel-demo (é¡¹ç›®åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZG91a2FpeGluL3R5cG9yYS5naXQ=\">https://gitee.com/doukaixin/typora.git</span>) ä¸­å®Œæˆæ¶ˆæ¯ç›‘å¬ï¼Œå¹¶æ›´æ–° elasticsearch ä¸­æ•°æ®</li>\n<li>å¯åŠ¨å¹¶æµ‹è¯•æ•°æ®åŒæ­¥åŠŸèƒ½</li>\n</ul>\n<p>1ã€å¯¼å…¥ hotel-admin é¡¹ç›®ï¼Œå¯åŠ¨å¹¶æµ‹è¯•é…’åº—æ•°æ®çš„ CRUD</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310151942076.png\" alt=\"image-20231015194242526\" /></p>\n<p>2ã€å£°æ˜ exchangeï¼Œqueueï¼ŒRoutingkey</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310151945245.png\" alt=\"image-20231015194554807\" /></p>\n<p>2.1ã€åˆ›å»º MqConstans ç±»è®°å½•é˜Ÿåˆ—åç§°å’Œ Routingkey</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MqConstans</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// äº¤æ¢æœº</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">HOTEL_EXCHANGE</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"hotel.topic\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// ç›‘å¬æ–°å¢å’Œä¿®æ”¹çš„é˜Ÿé‡Œ</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">HOTEL_INSERT_QUEUE</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"hotel.insert.queue\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// ç›‘å¬åˆ é™¤çš„é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">HOTEL_DELETE_QUEUE</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"hotel.delete.queue\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// æ–°å¢æˆ–ä¿®æ”¹çš„ RoutingKey</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">HOTEL_INSERT_KEY</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"hotel.insert\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// åˆ é™¤çš„ RoutingKey</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">HOTEL_DELETE_KEY</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"hotel.delete\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>2.2ã€åˆ›å»º MqConfig é…ç½®ç±»ï¼Œé…ç½®é˜Ÿåˆ—ä¸äº¤æ¢æœºçš„å…³ç³»ç»‘å®š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MqConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// å®šä¹‰äº¤æ¢æœº Bean</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">TopicExchange</span> <span class=\"token function\">topicExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\">//nameï¼šäº¤æ¢æœºåç§° ï¼Œdurableï¼šæ˜¯å¦æŒä¹…åŒ–ï¼ŒautoDeleteï¼šæ˜¯å¦è‡ªåŠ¨è§£é™¤ç»‘å®šå…³ç³»</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TopicExchange</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MqConstans</span><span class=\"token punctuation\">.</span><span class=\"token constant\">HOTEL_EXCHANGE</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// å®šä¹‰é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">insertQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">//nameï¼šé˜Ÿåˆ—åç§°ï¼Œdurableï¼šæ˜¯å¦æŒä¹…åŒ–</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MqConstans</span><span class=\"token punctuation\">.</span><span class=\"token constant\">HOTEL_INSERT_QUEUE</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">// å®šä¹‰é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">deleteQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">//nameï¼šé˜Ÿåˆ—åç§°ï¼Œdurableï¼šæ˜¯å¦æŒä¹…åŒ–</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MqConstans</span><span class=\"token punctuation\">.</span><span class=\"token constant\">HOTEL_DELETE_QUEUE</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token comment\">// ç»‘å®šå…³ç³»</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">insertQueueBinding</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token comment\">// å°† insertQueue é˜Ÿåˆ—ç»‘å®šåˆ°äº¤æ¢æœºä¸Šï¼Œå¹¶ç»‘å®š Routingkey</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">BindingBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token function\">insertQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">(</span><span class=\"token function\">topicExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MqConstans</span><span class=\"token punctuation\">.</span><span class=\"token constant\">HOTEL_INSERT_KEY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">deleteQueueBinding</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token comment\">// å°† insertQueue é˜Ÿåˆ—ç»‘å®šåˆ°äº¤æ¢æœºä¸Šï¼Œå¹¶ç»‘å®š Routingkey</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">BindingBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token function\">insertQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">(</span><span class=\"token function\">topicExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MqConstans</span><span class=\"token punctuation\">.</span><span class=\"token constant\">HOTEL_DELETE_KEY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>3ã€åœ¨ hotel-admin ä¸­çš„å¢ï¼Œåˆ ï¼Œæ”¹ä¸šåŠ¡ä¸­å®Œæˆæ¶ˆæ¯å‘é€</p>\n<p>3.1ã€åœ¨ hotel-admin é¡¹ç›®ä¸­ä¹Ÿæ·»åŠ  constans/MqConstans ç±»æ–¹ä¾¿è°ƒç”¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MqConstans</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// äº¤æ¢æœº</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">HOTEL_EXCHANGE</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"hotel.topic\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// ç›‘å¬æ–°å¢å’Œä¿®æ”¹çš„é˜Ÿé‡Œ</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">HOTEL_INSERT_QUEUE</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"hotel.insert.queue\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// ç›‘å¬åˆ é™¤çš„é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">HOTEL_DELETE_QUEUE</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"hotel.delete.queue\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// æ–°å¢æˆ–ä¿®æ”¹çš„ RoutingKey</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">HOTEL_INSERT_KEY</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"hotel.insert\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// åˆ é™¤çš„ RoutingKey</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">HOTEL_DELETE_KEY</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"hotel.delete\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>3.2ã€é…ç½® RabbitMQ çš„ yml å¹¶å¯¼å…¥ä¾èµ–</p>\n<p>3.3ã€åœ¨ Controller ä¸­ç¼–å†™å‘ç”Ÿæ¶ˆæ¯çš„ä»£ç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hotel\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HotelController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">IHotelService</span> hotelService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RabbitTemplate</span> rabbitTemplate<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Hotel</span> <span class=\"token function\">queryById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">return</span> hotelService<span class=\"token punctuation\">.</span><span class=\"token function\">getById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/list\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">PageResult</span> <span class=\"token function\">hotelList</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"page\"</span><span class=\"token punctuation\">,</span> defaultValue <span class=\"token operator\">=</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Integer</span> page<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"size\"</span><span class=\"token punctuation\">,</span> defaultValue <span class=\"token operator\">=</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Integer</span> size</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">Page</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Hotel</span><span class=\"token punctuation\">></span></span> result <span class=\"token operator\">=</span> hotelService<span class=\"token punctuation\">.</span><span class=\"token function\">page</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Page</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PageResult</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span><span class=\"token function\">getTotal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">.</span><span class=\"token function\">getRecords</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token annotation punctuation\">@PostMapping</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">saveHotel</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">Hotel</span> hotel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        hotelService<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>hotel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MqConstans</span><span class=\"token punctuation\">.</span><span class=\"token constant\">HOTEL_EXCHANGE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">MqConstans</span><span class=\"token punctuation\">.</span><span class=\"token constant\">HOTEL_INSERT_KEY</span><span class=\"token punctuation\">,</span> hotel<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token annotation punctuation\">@PutMapping</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">updateById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">Hotel</span> hotel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hotel<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InvalidParameterException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"idä¸èƒ½ä¸ºç©º\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        hotelService<span class=\"token punctuation\">.</span><span class=\"token function\">updateById</span><span class=\"token punctuation\">(</span>hotel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MqConstans</span><span class=\"token punctuation\">.</span><span class=\"token constant\">HOTEL_EXCHANGE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">MqConstans</span><span class=\"token punctuation\">.</span><span class=\"token constant\">HOTEL_INSERT_KEY</span><span class=\"token punctuation\">,</span> hotel<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token annotation punctuation\">@DeleteMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">deleteById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        hotelService<span class=\"token punctuation\">.</span><span class=\"token function\">removeById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MqConstans</span><span class=\"token punctuation\">.</span><span class=\"token constant\">HOTEL_EXCHANGE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">MqConstans</span><span class=\"token punctuation\">.</span><span class=\"token constant\">HOTEL_DELETE_KEY</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>4ã€åœ¨ hotel-demo ä¸­å®Œæˆæ¶ˆæ¯ç›‘å¬ï¼Œå¹¶æ›´æ–° elasticsearch ä¸­æ•°æ®</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">insertOrupdateByid</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">Hotel</span> hotel <span class=\"token operator\">=</span> <span class=\"token function\">getById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">HotelDoc</span> hotelDoc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HotelDoc</span><span class=\"token punctuation\">(</span>hotel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡ Request</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token class-name\">IndexRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IndexRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">id</span><span class=\"token punctuation\">(</span>hotel<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token comment\">// 2. å‡†å¤‡ DSL</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   request<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSONString</span><span class=\"token punctuation\">(</span>hotelDoc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">XContentType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">// 3. å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      client<span class=\"token punctuation\">.</span><span class=\"token function\">index</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">deleteById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token comment\">// 1. å‡†å¤‡ Request</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token class-name\">DeleteRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DeleteRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dkx\"</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token comment\">// 2. å‡†å¤‡ DSL</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      client<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>5ã€å¯åŠ¨å¹¶æµ‹è¯•æ•°æ®åŒæ­¥åŠŸèƒ½</p>\n<p>&lt;font color='red'&gt; æ³¨æ„ &lt;/font&gt;ï¼šè¦å¯åŠ¨ RabbitMQ å¦åˆ™é“¾æ¥å°±ä¼šæŠ¥é”™</p>\n<p>å¯åŠ¨ä¸¤ä¸ªé¡¹ç›®åæŸ¥çœ‹ é˜Ÿåˆ— æƒ…å†µ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310152133072.png\" alt=\"image-20231015213307513\" /></p>\n<p>å†çœ‹ä¸€ä¸‹äº¤æ¢æœº</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310152133845.png\" alt=\"image-20231015213344108\" /></p>\n<p>è¯æ˜ é˜Ÿåˆ—å’Œäº¤æ¢æœºåˆ›å»ºæˆåŠŸäº†ã€‚</p>\n<p>æŸ¥çœ‹å®ƒä»¬çš„ç»‘å®šå…³ç³»</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310152134821.png\" alt=\"image-20231015213451830\" /></p>\n<p>ä¸¤ä¸ª BindingKey åˆ†åˆ«ç»‘å®šäº† Routingkey</p>\n<p>æ¥ä¸‹æ¥è¿›è¡Œä¿®æ”¹æµ‹è¯•ï¼Œæ¯”å¦‚è¯´å…ˆä¿®æ”¹è¿™ä¸ªå¹¿å‘Šä½çš„ä»·æ ¼çœ‹ä¸‹ï¼Œæ‰¾åˆ°å®ƒçš„ id</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310160743271.png\" alt=\"image-20231016074258159\" /></p>\n<p>ç„¶ååœ¨é…’åº—ç®¡ç†ä¸­æ‰¾åˆ°è¿™ä¸ªå¯¹åº”çš„ id ä¿¡æ¯ï¼Œå¯¹å…¶è¿›è¡Œä¿®æ”¹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310160744989.png\" alt=\"image-20231016074402893\" /></p>\n<p>ç°åœ¨çš„ä»·æ ¼æ˜¯ 589ï¼Œä¿®æ”¹ä¸º 1058</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310160745904.png\" alt=\"image-20231016074503675\" /></p>\n<p>ç„¶åå»æŸ¥çœ‹ç½‘é¡µçš„ä»·æ ¼æ˜¯å¦æ›´æ–°äº†</p>\n<p>å¯ä»¥çœ‹åˆ°ä»·æ ¼è¢«æ”¹å˜äº†ï¼Œè¯´æ˜æ•°æ®åŒæ­¥æˆåŠŸäº†ã€‚</p>\n<p>ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªé—®é¢˜å°±æ˜¯ æ¯æ¬¡ä¿®æ”¹åå¹¿å‘Šå°±æ²¡äº†ï¼Œè‡ªç„¶æƒé‡ä¹Ÿå°±ä¸‹é™çœ‹ä¸åˆ°å®ƒæ˜¯ç¬¬ä¸€ä¸ªäº†ï¼Œè¿™é‡Œéœ€è¦åšæŒä¹…åŒ–å¦åˆ™æ¯æ¬¡æ›´æ–° isAD çš„çŠ¶æ€å°±æ¶ˆæ¯äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310160812307.png\" alt=\"image-20231016081236685\" /></p>\n<p>æµ‹è¯•åˆ é™¤ï¼Œåˆ é™¤å¦‚ä¸‹é€‰ä¸­çš„é…’åº—ä¿¡æ¯</p>\n<p>æ‰¾åˆ°å¯¹åº”çš„ idï¼Œç„¶åå»ç®¡ç†é¡µé¢è¿›è¡Œåˆ é™¤æ“ä½œ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310160925485.png\" alt=\"image-20231016092546878\" /></p>\n<p>åœ¨é…’åº—ç®¡ç†é¡µé¢æ‰¾åˆ°å¯¹åº”ä¿¡æ¯è¿›è¡Œåˆ é™¤æ“ä½œã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310160926330.png\" alt=\"image-20231016092628220\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310160926213.png\" alt=\"image-20231016092649279\" /></p>\n<p>åˆ é™¤åæŸ¥çœ‹é…’åº—ä¿¡æ¯ç½‘é¡µï¼Œå¯ä»¥çœ‹åˆ°å°‘äº†ä¸€æ¡ä¿¡æ¯ä¹Ÿå°±è¯æ˜äº†é‚£æ¡ä¿¡æ¯è¢«åˆ é™¤äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310160930574.png\" alt=\"image-20231016092713820\" /></p>\n<h4 id=\"9104-elasticsearché›†ç¾¤\"><a class=\"anchor\" href=\"#9104-elasticsearché›†ç¾¤\">#</a> 9.10.4ã€elasticsearch é›†ç¾¤ğŸŒ²</h4>\n<ul>\n<li>æ­å»º ES é›†ç¾¤</li>\n<li>é›†ç¾¤è„‘è£‚é—®é¢˜</li>\n<li>é›†ç¾¤æ•…éšœè½¬ç§»</li>\n<li>é›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨</li>\n<li>é›†ç¾¤åˆ†å¸ƒå¼æŸ¥è¯¢</li>\n</ul>\n<h5 id=\"91041-esé›†ç¾¤ç»“æ„\"><a class=\"anchor\" href=\"#91041-esé›†ç¾¤ç»“æ„\">#</a> 9.10.4.1ã€ES é›†ç¾¤ç»“æ„ğŸŒ´</h5>\n<p>å•å‡»çš„ elasticsearch åšæ•°æ®å­˜å‚¨ï¼Œå¿…ç„¶é¢ä¸´ä¸¤ä¸ªé—®é¢˜ï¼šæµ·é‡æ•°æ®å­˜å‚¨é—®é¢˜ï¼Œå•ç‚¹æ•…éšœé—®é¢˜ã€‚</p>\n<ul>\n<li>æµ·é‡æ•°æ®å­˜å‚¨é—®é¢˜ï¼šå°†ç´¢å¼•åº“ä»é€»è¾‘ä¸Šæ‹†åˆ†ä¸º N ä¸ªåˆ†ç‰‡ (shard) ï¼Œå­˜å‚¨åˆ°å¤šä¸ªèŠ‚ç‚¹</li>\n<li>å•ç‚¹æ•…éšœé—®é¢˜ï¼šå°†åˆ†ç‰‡æ•°æ®åœ¨ä¸åŒèŠ‚ç‚¹å¤‡ä»½ (replica)</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161025488.png\" alt=\"image-20231016102545479\" /></p>\n<h5 id=\"91042-æ­å»ºesé›†ç¾¤\"><a class=\"anchor\" href=\"#91042-æ­å»ºesé›†ç¾¤\">#</a> 9.10.4.2ã€æ­å»º ES é›†ç¾¤ğŸŒ´</h5>\n<p>æˆ‘ä»¬è®¡åˆ’åˆ©ç”¨ 3 ä¸ª docker å®¹å™¨æ¨¡æ‹Ÿ 3 ä¸ª es çš„èŠ‚ç‚¹ã€‚å…·ä½“æ­¥éª¤å‚è€ƒ elasticsearch æ–‡ç« ï¼š<a href=\"./Elasearch/%E5%AE%89%E8%A3%85elasticsearch.md\">æŸ¥çœ‹</a>.</p>\n<h5 id=\"91043-esé›†ç¾¤çš„èŠ‚ç‚¹è§’è‰²\"><a class=\"anchor\" href=\"#91043-esé›†ç¾¤çš„èŠ‚ç‚¹è§’è‰²\">#</a> 9.10.4.3ã€ES é›†ç¾¤çš„èŠ‚ç‚¹è§’è‰²ğŸŒ´</h5>\n<p>elasticsearch ä¸­é›†ç¾¤èŠ‚ç‚¹æœ‰ä¸åŒçš„èŒè´£åˆ’åˆ†ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>èŠ‚ç‚¹ç±»å‹</th>\n<th>é…ç½®å‚æ•°</th>\n<th>é»˜è®¤å€¼</th>\n<th>èŠ‚ç‚¹èŒè´£</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>master  eligible</td>\n<td>node.master</td>\n<td>true</td>\n<td>å¤‡é€‰ä¸»èŠ‚ç‚¹ï¼šä¸»èŠ‚ç‚¹å¯ä»¥ç®¡ç†å’Œè®°å½•é›†ç¾¤çŠ¶æ€ï¼Œå†³å®š &lt;br /&gt; åˆ†ç‰‡åœ¨å“ªä¸ªèŠ‚ç‚¹ï¼Œå¤„ç†åˆ›å»ºå’Œåˆ é™¤ç´¢å¼•åº“çš„è¯·æ±‚</td>\n</tr>\n<tr>\n<td>data</td>\n<td>node.data</td>\n<td>true</td>\n<td>æ•°æ®èŠ‚ç‚¹ï¼šå­˜å‚¨æ•°æ®ï¼Œæœç´¢ï¼Œèšåˆï¼ŒCRUD</td>\n</tr>\n<tr>\n<td>ingest</td>\n<td>node.ingest</td>\n<td>true</td>\n<td>æ•°æ®å­˜å‚¨ä¹‹å‰çš„é¢„å¤„ç†</td>\n</tr>\n<tr>\n<td>coordinating</td>\n<td>ä¸Šé¢ 3 ä¸ªå‚æ•°éƒ½ä¸º false&lt;br /&gt; åˆ™ä¸º coordinating èŠ‚ç‚¹</td>\n<td>æ— </td>\n<td>è·¯ç”±è¯·æ±‚åˆ°å…¶å®ƒèŠ‚ç‚¹ &lt;br /&gt; åˆå¹¶å…¶å®ƒèŠ‚ç‚¹å¤„ç†çš„ç»“æœï¼Œè¿”å›ç»™ç”¨æˆ·</td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"91044-esé›†ç¾¤çš„åˆ†å¸ƒå¼æŸ¥è¯¢\"><a class=\"anchor\" href=\"#91044-esé›†ç¾¤çš„åˆ†å¸ƒå¼æŸ¥è¯¢\">#</a> 9.10.4.4ã€ES é›†ç¾¤çš„åˆ†å¸ƒå¼æŸ¥è¯¢ğŸŒ´</h5>\n<p>elasticsearch ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è§’è‰²éƒ½æœ‰è‡ªå·±ä¸ç”¨çš„èŒè´£ï¼Œå› æ­¤å»ºè®®é›†ç¾¤éƒ¨ç½²æ—¶ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ç‹¬ç«‹çš„è§’è‰²ã€‚</p>\n<p>ä¸‹å›¾ä¸­ï¼Œæœ‰ä¸‰ä¸ª coordinating èŠ‚ç‚¹ (åè°ƒèŠ‚ç‚¹) è¿˜æœ‰ n ä¸ªæ•°æ®èŠ‚ç‚¹ å’Œ ä¸‰ä¸ªå€™é€‰ä¸»èŠ‚ç‚¹ã€‚å°†æ¥æœ‰ä¸€ä¸ªèŠ‚ç‚¹æŒ‚äº†å°±å¯ä»¥ä»ä¸‰ä¸ªå€™é€‰ä¸»èŠ‚ç‚¹ä¸­é€‰å–ä¸€ä¸ªå‡ºæ¥ã€‚LB ä¸ºè´Ÿè½½å‡è¡¡å™¨ï¼Œå¯¹åè°ƒèŠ‚ç‚¹åšè´Ÿè½½å‡è¡¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161339823.png\" alt=\"image-20231016133909366\" /></p>\n<p>ç¼ºç‚¹ï¼š</p>\n<p>å€™é€‰ä¸»èŠ‚ç‚¹ç»“æ„ä¼šæœ‰ä¸€ä¸ªè„‘è£‚é—®é¢˜</p>\n<h5 id=\"91045-esé›†ç¾¤çš„è„‘è£‚\"><a class=\"anchor\" href=\"#91045-esé›†ç¾¤çš„è„‘è£‚\">#</a> 9.10.4.5ã€ES é›†ç¾¤çš„è„‘è£‚ğŸŒ´</h5>\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ mster gligible èŠ‚ç‚¹ï¼Œå› æ­¤ä¸€æ—¦ master èŠ‚ç‚¹å®•æœºï¼Œå…¶å®ƒå€™é€‰èŠ‚ç‚¹ä¼šé€‰ä¸¾ä¸€ä¸ªæˆä¸ºä¸»èŠ‚ç‚¹ã€‚å½“ä¸»èŠ‚ç‚¹ä¸å…¶å®ƒèŠ‚ç‚¹ç½‘ç»œæ•…éšœæ—¶ï¼Œå¯èƒ½å‘ç”Ÿè„‘è£‚é—®é¢˜ã€‚</p>\n<p>ä»€ä¹ˆæ˜¯è„‘è£‚å‘¢ï¼Ÿ</p>\n<p>æ¯”æ–¹è¯´ï¼Œæœ‰ä¸‰ä¸ªå€™é€‰ä¸»èŠ‚ç‚¹ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹ç°åœ¨å½“é€‰ä¸ºä¸»èŠ‚ç‚¹ã€‚å‰©ä¸‹ä¸¤ä¸ªæ˜¯å€™é€‰èŠ‚ç‚¹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161346747.png\" alt=\"image-20231016134608313\" /></p>\n<p>ç°åœ¨å‡è®¾è¯´å‘ç”Ÿäº†ç½‘ç»œæ•…éšœ</p>\n<p>ä¸æ˜¯å®•æœºäº†ï¼Œæ˜¯å› ä¸ºç½‘ç»œçš„åŸå› å¯¼è‡´ï¼Œnode2 å’Œ node3 è·Ÿ node1 è¿æ¥ä¸ä¸Šäº†ï¼Œä½†æ˜¯ node1 è·Ÿå…¶å®ƒéƒ¨åˆ†æ•°æ®èŠ‚ç‚¹è¿˜æ˜¯å¯ä»¥è¿åŒçš„ã€‚node2 å’Œ node3 å’Œä¸€äº›æ•°æ®èŠ‚ç‚¹ä¹Ÿæ˜¯å¯ä»¥è¿åŒçš„ã€‚è¿™ä¸ªæ—¶å€™å°±ç­‰äºé›†ç¾¤è¢«åˆ†å¼€äº†ã€‚</p>\n<p>å½“ node2 å’Œ node3 è¿ä¸ä¸Š node1 çš„æ—¶å€™å®ƒä¼šè®¤ä¸º node1 æŒ‚äº†ï¼Œå°±ä¼šåœ¨ node2 å’Œ node3 ä¸­åˆé€‰ä¸¾å‡ºä¸€ä¸ªè€å¤§</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161347107.png\" alt=\"image-20231016134716821\" /></p>\n<p>æ¯”æ–¹è¯´é€‰ä¸¾çš„è€å¤§ä¸º node3</p>\n<p>è¿™æ˜¯é›†ç¾¤é‡Œé¢å°±ç­‰äºå‡ºç°äº†ä¸¤ä¸ªè€å¤§</p>\n<p>ç°åœ¨å°±å‡ºé—®é¢˜äº†ï¼Œå› ä¸ºæœ‰ä¸¤ä¸ªè€å¤§ï¼Œä¸€éƒ¨åˆ†æ•°æ®èŠ‚ç‚¹è·Ÿ node1 ç»“åˆå°†æ¥åš CRUD çš„æ—¶å€™ç”± node1 æ¥æ§åˆ¶</p>\n<p>è¿˜æœ‰å¦ä¸€éƒ¨åˆ†ç”± node3 æ¥æ§åˆ¶ï¼Œå®ƒä»¬å„è‡ªå»å¤„ç†å„è‡ªçš„é›†ç¾¤ã€‚ä¸€æ—¦ç½‘ç»œæ¢å¤ï¼Œå½“ç”¨æˆ·æ¥è®¿é—®æ—¶å°±ä¼šå‡ºç°ä¸¤è¾¹æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚è¿™å¯å°±å‡ºå¤§äº‹å„¿äº†ï¼Œè¿™å°±æ˜¯è„‘è£‚é—®é¢˜ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161350808.png\" alt=\"image-20231016135040891\" /></p>\n<p>ä¸ºäº†é¿å…è„‘è£‚ï¼Œéœ€è¦è¦æ±‚é€‰ç¥¨è¶…è¿‡ (eligible èŠ‚ç‚¹æ•°é‡ + 1) / 2 æ‰èƒ½å½“é€‰ä¸ºä¸»ï¼Œå› æ­¤ eligible èŠ‚ç‚¹æ•°é‡æœ€å¥½æ˜¯å¥‡æ•°ã€‚å¯¹åº”é…ç½®é¡¹æ˜¯ discovery.zen.minimun_master_nodesï¼Œåœ¨ es7.0 ä»¥åï¼Œå·²ç»æˆä¸ºé»˜è®¤é…ç½®ï¼Œå› æ­¤ä¸€èˆ¬ä¸ä¼šå‘ç”Ÿè„‘è£‚é—®é¢˜ã€‚</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>master eligible èŠ‚ç‚¹çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>å‚ä¸é›†ç¾¤é€‰ä¸»</li>\n<li>ä¸»èŠ‚ç‚¹å¯ä»¥ç®¡ç†é›†ç¾¤çŠ¶æ€ï¼Œç®¡ç†åˆ†ç‰‡ä¿¡æ¯ï¼Œå¤„ç†åˆ›å»ºå’Œåˆ é™¤ç´¢å¼•åº“çš„è¯·æ±‚</li>\n</ul>\n<p>data èŠ‚ç‚¹çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>æ•°æ®çš„ CRUD</li>\n</ul>\n<p>coordinator èŠ‚ç‚¹çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>è·¯ç”±è¯·æ±‚åˆ°å…¶å®ƒèŠ‚ç‚¹</li>\n<li>åˆå¹¶æŸ¥è¯¢åˆ°çš„ç»“æœï¼Œè¿”å›ç»™ç”¨æˆ·</li>\n</ul>\n</blockquote>\n<h5 id=\"91046-æµ‹è¯•å¼•å‡ºé—®é¢˜\"><a class=\"anchor\" href=\"#91046-æµ‹è¯•å¼•å‡ºé—®é¢˜\">#</a> 9.10.4.6ã€æµ‹è¯•å¼•å‡ºé—®é¢˜ğŸŒ´</h5>\n<p>å½“æ–°å¢æ–‡æ¡£æ—¶ï¼Œåº”è¯¥ä¿å­˜åˆ°ä¸åŒåˆ†ç‰‡ï¼Œä¿è¯æ•°æ®å‡è¡¡ï¼Œé‚£ä¹ˆ coordinating node å¦‚ä½•ç¡®å®šæ•°æ®è¯¥å­˜å‚¨åˆ°å“ªä¸ªåˆ†ç‰‡å‘¢ï¼Ÿ</p>\n<p>è¿™é‡Œç”±äºè™šæ‹Ÿæœºä¸­æ²¡æœ‰å¯åŠ¨ kibana æ‰€ä»¥ä½¿ç”¨ postmanï¼Œapi æ¥å£æµ‹è¯•å·¥å…·æ¥è¿›è¡Œæ·»åŠ æ–‡æ¡£æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161409037.png\" alt=\"image-20231016140915224\" /></p>\n<p>è¿›è¡ŒæŸ¥è¯¢æ–‡æ¡£çš„æ•°æ®æƒ…å†µ</p>\n<p>ä¸‰æ¡æ•°æ®å°±æŸ¥è¯¢å‡ºæ¥äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161413380.png\" alt=\"image-20231016141318310\" /></p>\n<p>æŸ¥è¯¢ç«¯å£ä¸º 9201 ä¸º es02 çš„æ•°æ®æƒ…å†µ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161414897.png\" alt=\"image-20231016141452636\" /></p>\n<p>æŸ¥è¯¢ç«¯å£ä¸º 9202 ä¸º es03 çš„æ•°æ®æƒ…å†µ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161415226.png\" alt=\"image-20231016141537985\" /></p>\n<p>å¯ä»¥çœ‹åˆ°éƒ½æ˜¯åŒæ ·çš„ç»“æœï¼Œæˆ‘æ˜¯åœ¨ 9200 æ’å…¥çš„æ–‡æ¡£æ•°æ®ç»“æœåœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥æŸ¥åˆ°ã€‚é‚£é—®é¢˜æ¥äº†è¿™äº›æ•°æ®åˆ°åº•æ˜¯å­˜åˆ°å“ªä¸ªåˆ†ç‰‡ä¸Šäº†å‘¢ï¼Ÿ</p>\n<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ â€œexplainâ€ å‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥è®©æˆ‘ä»¬çœ‹åˆ°æŸ¥è¯¢çš„ç»“æœåˆ°åº•åœ¨å“ªé‡Œ</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"explain\"</span> <span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token property\">\"match_all\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æŸ¥è¯¢çš„ç»“æœï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"hits\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>                <span class=\"token property\">\"_shard\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[itcast][0]\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                <span class=\"token property\">\"_node\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tzSKl2laTTKoDwMz4AfkAQ\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"itcast\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"5\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"è¯•ç€æ’å…¥ä¸€æ¡ id = 1\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token property\">\"_explanation\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                    <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                    <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"*:*\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                    <span class=\"token property\">\"details\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token property\">\"_shard\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[itcast][1]\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token property\">\"_node\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tzSKl2laTTKoDwMz4AfkAQ\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"itcast\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"3\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"è¯•ç€æ’å…¥ä¸€æ¡ id = 1\"</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token property\">\"_explanation\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                    <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                    <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"*:*\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                    <span class=\"token property\">\"details\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token property\">\"_shard\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[itcast][2]\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token property\">\"_node\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nrhAcc9RQX2XXJoxYWFYPg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"itcast\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"è¯•ç€æ’å…¥ä¸€æ¡ id = 1\"</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token property\">\"_explanation\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                    <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                    <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"*:*\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                    <span class=\"token property\">\"details\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° id ä¸º 5 çš„åœ¨ 0 å·åˆ†ç‰‡ï¼Œid ä¸º 3 çš„åœ¨ 1 å·åˆ†ç‰‡ï¼Œid ä¸º 1 çš„åœ¨ 2 å·åˆ†ç‰‡</p>\n<p>åˆšå¥½è¿™ä¸‰æ¡æ•°æ®åœ¨æ¯ä¸ªåˆ†ç‰‡ä¸Šéƒ½æœ‰ä¸€ä¸ªï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘æ˜æ˜æ˜¯åœ¨ 9200 æ’å…¥çš„æ•°æ®æ€ä¹ˆä¼šå‡ºç°åœ¨ä¸‰å°æœºå™¨ä¸Šå‘¢ï¼Œè¿™è¯´æ˜ åè°ƒèŠ‚ç‚¹ ç¡®å®æ˜¯å·¥ä½œäº†ã€‚é‚£é—®é¢˜æ˜¯å®ƒæ˜¯æ€ä¹ˆå·¥ä½œçš„å‘¢ï¼Ÿ</p>\n<p>elasticsearch ä¼šé€šè¿‡ hash ç®—æ³•æ¥è®¡ç®—æ–‡æ¡£åº”è¯¥å­˜å‚¨åˆ°å“ªä¸ªåˆ†ç‰‡ï¼š</p>\n<pre><code>shard = hash(_routing) % number_of_shards\n</code></pre>\n<p>ç”¨ hash è®¡ç®—çš„ç»“æœå»å¯¹ number_of_shards è¿›è¡Œå–ä½™ï¼Œåªè¦_routing å€¼å˜åŒ–é‚£ä¹ˆè®¡ç®—å‡ºçš„ç»“æœä¹Ÿä¼šéšç€å˜åŒ–</p>\n<p>è¯´æ˜ï¼š</p>\n<ul>\n<li>_routing é»˜è®¤æ˜¯æ–‡æ¡£ id</li>\n<li>ç®—æ³•ä¸åˆ†ç‰‡æ•°é‡æœ‰å…³ï¼Œå› æ­¤ç´¢å¼•åº“ä¸€æ—¦åˆ›å»ºï¼Œåˆ†ç‰‡æ•°é‡ä¸èƒ½ä¿®æ”¹ (å¦‚æœæ”¹äº†æ•°æ®å°±æ‰¾ä¸åˆ°äº†)ï¼</li>\n</ul>\n<h5 id=\"91047-é€šè¿‡æ¡ˆä¾‹è¿›è¡Œåˆ†æ\"><a class=\"anchor\" href=\"#91047-é€šè¿‡æ¡ˆä¾‹è¿›è¡Œåˆ†æ\">#</a> 9.10.4.7ã€é€šè¿‡æ¡ˆä¾‹è¿›è¡Œåˆ†æğŸŒ´</h5>\n<p>æ¯”æ–¹è¯´ç°åœ¨æ¥åšæ–°å¢</p>\n<p>æ–°å¢æ–‡æ¡£æµç¨‹ï¼š</p>\n<p>å¦‚ä¸‹æœ‰é›†ç¾¤ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯ node1ï¼Œnode2ï¼Œnode3ã€‚åœ¨è¿™ä¸ªé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½ä¼šæœ‰ä¸€äº›åˆ†ç‰‡ã€‚å…¶ä¸­æ·±è“è‰²å« primarisha ä¸»åˆ†ç‰‡ï¼Œp-0ï¼Œp-1ï¼Œp-2 åˆ†åˆ«å°±æ˜¯ 0 å·ä¸»åˆ†ç‰‡ï¼Œ1 å·ä¸»åˆ†ç‰‡ï¼Œ2 å·ä¸»åˆ†ç‰‡ã€‚æ¯ä¸ªåˆ†ç‰‡éƒ½è¦æœ‰å‰¯æœ¬ï¼Œæµ…è“è‰²å°±æ˜¯å‰¯æœ¬ r-0 å°±æ˜¯ 0 å·åˆ†ç‰‡çš„å‰¯æœ¬åˆ†ç‰‡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161431150.png\" alt=\"image-20231016143113264\" /></p>\n<p>å¦‚æœè¯´æˆ‘ç°åœ¨è¦æ’å…¥ä¸€æ¡æ–‡æ¡£ï¼Œæ–‡æ¡£çš„ id ä¸º 1 ã€‚è¯·æ±‚åˆ°è¾¾äº† node1ã€‚è¿™æ˜¯ node1 å°±å……å½“äº†åè°ƒèŠ‚ç‚¹çš„è§’è‰²</p>\n<p>åè°ƒè§’è‰²è¦ç”¨ä¸Šè¿°çš„å“ˆå¸Œè¿ç®—äº†ï¼Œå‡è®¾è¯´æ–‡æ¡£ id ä¸º 1 å“ˆå¸Œè¿ç®—ç»“æœä¸º 2ï¼Œé‚£å°±æ„å‘³ç€å®ƒè¦å­˜å‚¨åˆ° 2 å·åˆ†ç‰‡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161435085.png\" alt=\"image-20231016143543105\" /></p>\n<p>äºæ˜¯å°±æŠŠè¯·æ±‚è·¯ç”±åˆ° node3 èŠ‚ç‚¹äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161437775.png\" alt=\"image-20231016143719016\" /></p>\n<p>ç„¶åå°±æŠŠæ•°æ®å†™å…¥åˆ° 2 å·åˆ†ç‰‡äº†ï¼Œå†™å…¥åå‘ç°è‡ªå·±æ˜¯è€å¤§è¿˜æ˜¯ä¸»åˆ†ç‰‡ï¼Œæ‰€ä»¥å®ƒå°±è¦æŠŠä¸»åˆ†ç‰‡æ•°æ®åŒæ­¥ç»™ä»åˆ†ç‰‡ã€‚ä»åˆ†ç‰‡çš„å‰¯æœ¬åˆ†ç‰‡åœ¨ 1 å·åˆ†ç‰‡ä¸­ äºæ˜¯è¯·æ±‚å°±åŒæ­¥è¿‡å»äº†</p>\n<p>è¿™æ ·ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡å°±éƒ½ä¿å­˜äº†è¿™ä¸ªæ•°æ®äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161440114.png\" alt=\"image-20231016144022919\" /></p>\n<p>æœ€ç»ˆæŠŠç›¸åº”ç»“æœè¿”å›ç»™åè°ƒèŠ‚ç‚¹ï¼Œç„¶åå†è¿”å›ç»™ç”¨æˆ·</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161442717.png\" alt=\"image-20231016144216794\" /></p>\n<p>å¦‚æœæ˜¯ id å»æŸ¥è¯¢ä¹Ÿæ˜¯ç›¸åŒçš„é“ç†ï¼Œåˆ é™¤ï¼Œä¿®æ”¹éƒ½æ˜¯å¦‚æ­¤ã€‚æ‰€ä»¥å‡¡æ˜¯æ ¹æ® id æ“ä½œéƒ½æ˜¯è¿™ä¸ªæµç¨‹</p>\n<p>ä½†æ˜¯ä¸Šé¢ä»£ç ä¸­è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å¦‚ä¸‹ä»£ç ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"explain\"</span> <span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token property\">\"match_all\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å½“å‘é€è¯·æ±‚æ—¶ï¼Œå¹¶ä¸çŸ¥é“è¦æŸ¥è¯¢çš„æ•°æ®åœ¨å“ªä¸ªåˆ†ç‰‡ä¸Šï¼Œæ²¡æœ‰ id å•Šï¼Œé‚£è¿™ç§æƒ…å†µä¸‹åè°ƒèŠ‚ç‚¹åˆæ˜¯æ€ä¹ˆå·¥ä½œçš„å‘¢ï¼Ÿ</p>\n<p>é‚£è¿™å°±æ˜¯åˆ†å¸ƒå¼æŸ¥è¯¢çš„è¿‡ç¨‹äº†ï¼š</p>\n<p>elasticsearch çš„æŸ¥è¯¢åˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼š</p>\n<ul>\n<li>\n<p>scatter phaseï¼šåˆ†æ•£é˜¶æ®µï¼Œcoordinating node ä¼šæŠŠè¯·æ±‚å‘åˆ°æ¯ä¸€ä¸ªåˆ†ç‰‡</p>\n<p>æ¯ä¸ªåˆ†ç‰‡éƒ½æŸ¥è¯¢äº†åè¿›å…¥èšé›†é˜¶æ®µ</p>\n</li>\n<li>\n<p>gather phaseï¼šèšé›†é˜¶æ®µï¼Œcoordinating node æ±‡æ€» data node çš„æœç´¢ç»“æœï¼Œå¹¶å¤„ç†ä¸ºæœ€ç»ˆç»“æœé›†è¿”å›ç»™ç”¨æˆ·</p>\n</li>\n</ul>\n<p>åè°ƒèŠ‚ç‚¹ä¸ºè™šçº¿ï¼Œè¡¨ç¤ºè¿™é‡Œçš„åè°ƒèŠ‚ç‚¹å¯ä»¥æ˜¯ä¸‰ä¸ªèŠ‚ç‚¹ä¸­ä»»æ„ä¸€ä¸ªï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯åè°ƒèŠ‚ç‚¹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161447068.png\" alt=\"image-20231016144743512\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>åˆ†å¸ƒå¼æ–°å¢å¦‚ä½•ç¡®å®šåˆ†ç‰‡ï¼Ÿ</p>\n<ul>\n<li>coordinating node æ ¹æ® id åš hash è¿ç®—ï¼Œå¾—åˆ°ç»“æœ shard æ•°é‡å–ä½™ï¼Œä½™æ•°å°±æ˜¯å¯¹åº”çš„åˆ†ç‰‡</li>\n</ul>\n<p>åˆ†å¸ƒå¼æŸ¥è¯¢ï¼š</p>\n<ul>\n<li>åˆ†æ•£é˜¶æ®µï¼šcoordinating node å°†æŸ¥è¯¢è¯·æ±‚åˆ†å‘ç»™ä¸åŒåˆ†é…</li>\n<li>æ”¶é›†é˜¶æ®µï¼šå°†æŸ¥è¯¢ç»“æœæ±‡æ€»åˆ° coordinating nodeï¼Œæ•´ç†å¹¶è¿”å›ç»™ç”¨æˆ·</li>\n</ul>\n</blockquote>\n<h5 id=\"91048-esé›†ç¾¤çš„æ•…éšœè½¬ç§»\"><a class=\"anchor\" href=\"#91048-esé›†ç¾¤çš„æ•…éšœè½¬ç§»\">#</a> 9.10.4.8ã€ES é›†ç¾¤çš„æ•…éšœè½¬ç§»ğŸŒ²</h5>\n<p>é›†ç¾¤çš„ master èŠ‚ç‚¹ä¼šç›‘æ§é›†ç¾¤ä¸­çš„èŠ‚ç‚¹çŠ¶æ€ï¼Œå¦‚æœå‘ç°æœ‰èŠ‚ç‚¹å®•æœºï¼Œä¼šç«‹å³å°†å®•æœºèŠ‚ç‚¹çš„åˆ†ç‰‡æ•°æ®è¿ç§»åˆ°å…¶å®ƒèŠ‚ç‚¹ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ï¼Œè¿™ä¸ªå«åšæ•…éšœè½¬ç§»ã€‚</p>\n<p>æ¯”æ–¹è¯´ï¼Œæœ‰é›†ç¾¤ä¸‰ä¸ªèŠ‚ç‚¹ node1ï¼Œnode2ï¼Œnode3 æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æœ‰åˆ†ç‰‡ç›®å‰ä¸»èŠ‚ç‚¹æ˜¯ node1ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161457402.png\" alt=\"image-20231016145745390\" /></p>\n<p>ç°åœ¨å‡è®¾è¯´å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹å‡ºç°äº†æ•…éšœï¼Œæ¯”å¦‚è¯´ node1 ä¸»èŠ‚ç‚¹æŒ‚äº†ã€‚æ­¤æ—¶ä¸¤ä¸ªå€™é€‰èŠ‚ç‚¹å°±ä¼šé€‰å‡ºä¸€ä¸ªä¸»èŠ‚ç‚¹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161500046.png\" alt=\"image-20231016150004147\" /></p>\n<p>æ¯”æ–¹è¯´é€‰ä¸­äº† node2ï¼Œè¿™æ—¶é›†ç¾¤å°±æœ‰ä¸»äº†ï¼Œä¸»èŠ‚ç‚¹å°±è¦å‘æŒ¥è‡ªå·±çš„å·¥ä½œäº†ã€‚å®ƒè¦æŸ¥çœ‹ä¸‹é›†ç¾¤çš„å¥åº·çŠ¶æ€äº†ï¼Œåˆ†ç‰‡çŠ¶æ€ã€‚</p>\n<p>å®ƒä¸€çœ‹è¿™ä¸è¡Œå•Šï¼Œå› ä¸º p-1 æœ‰ä¸»åˆ†ç‰‡ï¼Œä½†æ˜¯æ²¡æœ‰å‰¯æœ¬åˆ†ç‰‡ã€‚p-2 æœ‰ä¸»åˆ†ç‰‡æœ‰å‰¯æœ¬åˆ†ç‰‡ã€‚p-0 åªæœ‰å‰¯æœ¬åˆ†ç‰‡ï¼Œæ²¡æœ‰ä¸»åˆ†ç‰‡ã€‚</p>\n<p>é‚£ä¹Ÿå°±æ˜¯è¯´ 1 å·  åˆ†ç‰‡ å’Œ 0 å·åˆ†ç‰‡çš„æ•°æ®æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºåªæœ‰ä¸€ä»½ä¸€æ—¦æŒ‚äº†å°±å®Œäº†ã€‚</p>\n<p>è¿™æ—¶é›†ç¾¤çš„çŠ¶æ€å°±ä¸æ˜¯å¥åº·çš„äº†ï¼Œè€Œæ˜¯å¤„äºå±é™©çš„è¾¹ç¼˜</p>\n<p>è¿™æ—¶ä¸»èŠ‚ç‚¹å°±ä¼šåšä¸ªæªæ–½ã€‚å®ƒä¼šæ£€æŸ¥æŒ‚æ‰çš„èŠ‚ç‚¹å®ƒä¸Šé¢æœ‰ä»€ä¹ˆåˆ†ç‰‡ï¼Œç„¶åæŠŠå®ƒè¿ç§»åˆ°å¥åº·çš„èŠ‚ç‚¹ä¸Šã€‚ç¡®ä¿ä»»ä½•ä¸€ä¸ªåˆ†ç‰‡éƒ½è‡³å°‘æœ‰ä¸¤ä»½ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªä¸»åˆ†ç‰‡ï¼Œä¸€ä¸ªå‰¯æœ¬åˆ†ç‰‡ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161507621.png\" alt=\"image-20231016150711670\" /></p>\n<p>æˆ‘ä»¬çœ‹ä¸‹æ§åˆ¶å°</p>\n<p>ç°åœ¨ es01 æ˜¯ä¸»èŠ‚ç‚¹ï¼Œé›†ç¾¤çŠ¶æ€æ˜¯å¥åº·çš„ï¼Œæˆ‘ä»¬æŠŠ es01 ç»™å®ƒåœæ‰</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161510371.png\" alt=\"image-20231016151046860\" /></p>\n<p>é€šè¿‡å‘½ä»¤ï¼š <code>docker-compose stop es01</code>  è¿™æ ·ä¸»èŠ‚ç‚¹å°±è¢«åœæ‰äº†</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker-compose stop es01</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Stopping es01 <span class=\"token punctuation\">..</span>. <span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>æˆ‘ä»¬å†å»çœ‹æ§åˆ¶å°ï¼Œå‘ç°ä¸»å˜æˆäº† es02ï¼Œå¹¶ä¸”æŠŠæ•°æ®è¿›è¡Œäº†è¿ç§»</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161514231.png\" alt=\"image-20231016151445895\" /></p>\n<p>é‚£ä¹ˆæ•°æ®æœ‰æ²¡æœ‰ä¸¢å¤±å‘¢ï¼Œæˆ‘ä»¬æœç´¢æŸ¥çœ‹ä¸€ä¸‹ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"match_all\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æŸ¥è¯¢ç»“æœï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"took\"</span><span class=\"token operator\">:</span> <span class=\"token number\">27</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"timed_out\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"_shards\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token property\">\"successful\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token property\">\"skipped\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"failed\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token property\">\"hits\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token property\">\"relation\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eq\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token property\">\"max_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token property\">\"hits\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"itcast\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"5\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"è¯•ç€æ’å…¥ä¸€æ¡ id = 1\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"itcast\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"3\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"è¯•ç€æ’å…¥ä¸€æ¡ id = 1\"</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"itcast\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"è¯•ç€æ’å…¥ä¸€æ¡ id = 1\"</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ•°æ®æ²¡æœ‰ä¸¢å¤±</p>\n<p>å¦‚æœæˆ‘å†é‡å¯ es01 èŠ‚ç‚¹ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š <code>docker-compose start es01</code></p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker-compose start es01</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Starting es01 <span class=\"token punctuation\">..</span>. <span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>å†åˆ‡å›åˆ°æ§åˆ¶å°çœ‹ä¸‹æƒ…å†µ</p>\n<p>æˆ‘ä»¬å‘ç° es01 åˆå›æ¥äº†ï¼Œä½†æ˜¯ä¸æ˜¯ä¸»äº†ã€‚ä½†æ˜¯ç°åœ¨çš„ä¸»èŠ‚ç‚¹åˆæŠŠæ•°æ®ç»™è¿ç§»å›å»äº†</p>\n<p>ç¡®ä¿ æ¯ä¸€ä¸ªåˆ†ç‰‡ä¸Šéƒ½ä¼šæœ‰æ•°æ®ï¼Œç¡®ä¿æ•°æ®æ˜¯å‡è¡¡çš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310161519914.png\" alt=\"image-20231016151901158\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>:</p>\n<p>æ•…éšœè½¬ç§»ï¼š</p>\n<ul>\n<li>master å®•æœºåï¼ŒEligibleMaster é€‰ä¸¾ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ã€‚</li>\n<li>master èŠ‚ç‚¹ç›‘æ§åˆ†ç‰‡ï¼ŒèŠ‚ç‚¹çŠ¶æ€ï¼Œå°†æ•…éšœèŠ‚ç‚¹ä¸Šçš„åˆ†ç‰‡è½¬ç§»åˆ°æ­£å¸¸èŠ‚ç‚¹ï¼Œç¡®ä¿æ•°æ®å®‰å…¨</li>\n</ul>\n</blockquote>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "Elasticsearch",
                "è®¡ç®—æœºå­¦ç§‘",
                "springcloud",
                "Elasticsearch"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/RabbitMQ/springcloud-%E5%BC%82%E6%AD%A5%E9%80%9A%E8%AE%AF/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/RabbitMQ/springcloud-%E5%BC%82%E6%AD%A5%E9%80%9A%E8%AE%AF/",
            "title": "å…«ã€RabbitMQæœåŠ¡å¼‚æ­¥é€šè®¯",
            "date_published": "2024-01-06T02:20:47.085Z",
            "content_html": "<h2 id=\"å…«-æœåŠ¡å¼‚æ­¥é€šè®¯\"><a class=\"anchor\" href=\"#å…«-æœåŠ¡å¼‚æ­¥é€šè®¯\">#</a> å…«ã€æœåŠ¡å¼‚æ­¥é€šè®¯ğŸ„</h2>\n<p>å®ç”¨ç¯‡ - RabbitMQ</p>\n<p><strong>å­¦ä¹ å†…å®¹</strong>ï¼š</p>\n<ul>\n<li>åˆå§‹ MQ</li>\n<li>RabbitMQ å¿«é€Ÿå…¥é—¨</li>\n<li>SpringAMQP</li>\n</ul>\n<h3 id=\"81-åˆå§‹mq\"><a class=\"anchor\" href=\"#81-åˆå§‹mq\">#</a> 8.1ã€åˆå§‹ MQğŸŒ³</h3>\n<ul>\n<li>åŒæ­¥é€šè®¯</li>\n<li>å¼‚æ­¥é€šè®¯</li>\n<li>MQ å¸¸è§æ¡†æ¶</li>\n</ul>\n<h4 id=\"811-åŒæ­¥è°ƒç”¨çš„é—®é¢˜\"><a class=\"anchor\" href=\"#811-åŒæ­¥è°ƒç”¨çš„é—®é¢˜\">#</a> 8.1.1ã€åŒæ­¥è°ƒç”¨çš„é—®é¢˜ğŸŒ²</h4>\n<p>å¾®æœåŠ¡é—´åŸºäº Feign çš„è°ƒç”¨å°±å±äºåŒæ­¥æ–¹å¼ï¼Œå­˜åœ¨ä¸€äº›é—®é¢˜ã€‚</p>\n<blockquote>\n<p>æˆ‘ä»¬åšä¸€ä¸ªè´­ä¹°å•†å“çš„ä¸šåŠ¡ï¼Œç”¨æˆ·æ”¯ä»˜è°ƒç”¨æ”¯ä»˜æœåŠ¡ã€‚æ”¯ä»˜æˆåŠŸåéœ€è¦è°ƒç”¨è®¢å•ä¸šåŠ¡ï¼Œä¿®æ”¹è®¢å•çŠ¶æ€ã€‚ç„¶åè¿˜è¦å»è°ƒç”¨ä»“å‚¨æœåŠ¡ï¼Œå› ä¸ºè¦ç»™ç”¨æˆ·å‘è´§ã€‚</p>\n<p>æ”¯ä»˜æœåŠ¡è°ƒç”¨è®¢å•æœåŠ¡ä¹Ÿå¥½ï¼Œè°ƒç”¨ä»“å‚¨æœåŠ¡ä¹Ÿå¥½å®ƒéƒ½éœ€è¦ç­‰å¾…å¯¹æ–¹çš„å“åº”ã€‚æ‰€ä»¥è¿™ç§è°ƒç”¨æ˜¯äº‹å®çš„è°ƒç”¨ä¹Ÿå°±æ˜¯åŒæ­¥è°ƒç”¨</p>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310101513894.png\" alt=\"image-20231010151319336\" /></p>\n<p>å®ƒçš„é—®é¢˜ï¼š</p>\n<p>1ã€è€¦åˆé—®é¢˜</p>\n<p>å¦‚æœéœ€è¦å¢åŠ ä¸šåŠ¡è€Œéœ€è¦æ”¹åŠ¨æ”¯ä»˜æœåŠ¡çš„ä»£ç </p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310101516352.png\" alt=\"image-20231010151616770\" /></p>\n<p>2ã€æ€§èƒ½ä¸‹é™</p>\n<p>ç”¨æˆ·æ¥è°ƒç”¨æ”¯ä»˜ä¸šåŠ¡ï¼Œå‡å¦‚è¯´æ”¯ä»˜ä¸šåŠ¡è€—æ—¶ 50msï¼Œç´§æ¥ç€æ”¯ä»˜æœåŠ¡è°ƒç”¨å…¶å®ƒæœåŠ¡ï¼Œå…¶å®ƒæœåŠ¡éƒ½è€—æ—¶ 150msã€‚æ”¯ä»˜æœåŠ¡è°ƒç”¨å†è°ƒç”¨å…¶å®ƒæœåŠ¡æ˜¯åŒæ­¥è°ƒç”¨æ‰€ä»¥å®ƒå¿…é¡»ç­‰å¾…å…¶å®ƒæœåŠ¡çš„æ‰§è¡Œç»“æœæ‰èƒ½æ‰§è¡Œå…¶å®ƒçš„å·¥ä½œã€‚è€Œè¿™ä¸€å¥—æµç¨‹ä¸‹æ¥å°±è¾¾åˆ°äº†è€—æ—¶ï¼š500msã€‚è¿™æ ·çš„ä¸šåŠ¡ä¹Ÿå¤ªçƒ‚äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310101518339.png\" alt=\"image-20231010151851047\" /></p>\n<p>3ã€èµ„æºæµªè´¹</p>\n<p>æ”¯ä»˜æœåŠ¡åœ¨ä¸èƒ½æ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œæ—¶ä¸€ç›´éƒ½æ˜¯åœ¨å ç”¨ CPUï¼Œå ç”¨å†…å­˜çš„</p>\n<p>4ã€çº§è”å¤±è´¥é—®é¢˜</p>\n<p>å‡å¦‚è¯´ä¸­é—´æŸä¸ªæœåŠ¡æŠ¥é”™äº†å°±ä¼šäº§ç”Ÿé˜»å¡ï¼Œç­‰å¾…æ—¶é•¿è¾ƒé•¿ç»“æœä¸”æ˜¯å¤±è´¥çš„ã€‚ç”¨æˆ·ä½“éªŒæå·®</p>\n<p>ç»¼ä¸Šæ‰€è¿°ï¼š</p>\n<p>åŒæ­¥è°ƒç”¨å°½ç®¡æ—¶æ•ˆæ€§è¿˜ä¸é”™ä½†æ˜¯å´å­˜åœ¨å…¶å®ƒé—®é¢˜</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310101527400.png\" alt=\"image-20231010152713676\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>åŒæ­¥è°ƒç”¨çš„ä¼˜ç‚¹ï¼š</p>\n<ul>\n<li>æ—¶æ•ˆæ€§è¾ƒå¼ºï¼Œå¯ä»¥ç«‹å³å¾—åˆ°ç»“æœ</li>\n</ul>\n<p>åŒæ­¥è°ƒç”¨çš„é—®é¢˜ï¼š</p>\n<ul>\n<li>è€¦åˆåº¦é«˜</li>\n<li>æ€§èƒ½å’Œååèƒ½åŠ›ä¸‹é™</li>\n<li>æœ‰é¢å¤–çš„èµ„æºæ¶ˆè€—</li>\n<li>æœ‰çº§è”å¤±è´¥é—®é¢˜</li>\n</ul>\n</blockquote>\n<h4 id=\"812-å¼‚æ­¥è°ƒç”¨æ–¹æ¡ˆ\"><a class=\"anchor\" href=\"#812-å¼‚æ­¥è°ƒç”¨æ–¹æ¡ˆ\">#</a> 8.1.2ã€å¼‚æ­¥è°ƒç”¨æ–¹æ¡ˆğŸŒ²</h4>\n<p>å¼‚æ­¥è°ƒç”¨å¸¸è§å®ç°å°±æ˜¯äº‹ä»¶é©±åŠ¨æ¨¡å¼</p>\n<p>å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ä¸œè¥¿å«ï¼šBroker (äº‹ä»¶ä»£ç†è€…)</p>\n<p>æ”¯ä»˜æœåŠ¡é€šçŸ¥ Brokerï¼ŒBroker é€šè¿‡å…¶å®ƒæœåŠ¡</p>\n<p>åœ¨æ•´ä¸ªè¿‡ç¨‹å½“ä¸­ï¼Œæ”¯ä»˜æœåŠ¡å®Œæˆäº‹ä»¶å‘å¸ƒåå°±ç«‹å³ç»“æŸäº†è‡ªå·±çš„ä¸šåŠ¡ï¼Œå¯ä»¥å»è¿”å›ç»™ç”¨æˆ·äº†ï¼Œè€Œä¸éœ€è¦å»ç­‰å…¶å®ƒæœåŠ¡å®Œæˆç»“æœ</p>\n<p>è¿™ç§æ–¹å¼å°±æ˜¯å¼‚æ­¥æ–¹å¼</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310101533471.png\" alt=\"image-20231010153325787\" /></p>\n<p>ä¼˜åŠ¿ï¼š</p>\n<p>1ã€æœåŠ¡è§£è€¦</p>\n<p>æœ‰æ–°çš„ä¸šåŠ¡åªéœ€è¦è®¢é˜… Broker å°±è¡Œäº†è·Ÿæ”¯ä»˜æœåŠ¡æ²¡æœ‰ä»»ä½•å…³ç³»</p>\n<p>2ã€æ€§èƒ½æå‡ï¼Œååé‡æé«˜</p>\n<p>3ã€æ²¡æœ‰å¼ºä¾èµ–å…³ç³»ï¼Œä¸æ‹…å¿ƒçº§è”å¤±è´¥é—®é¢˜</p>\n<p>4ã€æµé‡å‰Šå³°</p>\n<p>è§£é‡Š â€œæµé‡å‰Šå³°â€ ï¼šå‡å¦‚è¯´ä¸€ç¬é—´æ¥äº†ä¸‰ä¸ªè¯·æ±‚ï¼Œè®¢å•æœåŠ¡ï¼Œä»“å‚¨æœåŠ¡ï¼ŒçŸ­ä¿¡æœåŠ¡æ¯ä¸€æ—¶åˆ»åªèƒ½å¤„ç†ä¸€ä¸ªï¼Œè¿™æ—¶ Broker å¯ä»¥èµ·åˆ°ç¼“å†²çš„ ä½œç”¨ã€‚ç„¶åå…¶å®ƒæœåŠ¡å°±ä¸€ä¸ªä¸€ä¸ªå¤„ç†ï¼Œå¤„ç†å®Œäº†å°±åˆ° Broker å»å–ï¼Œè¿™æ ·è¿™äº›æœåŠ¡å°±èƒ½ä¸€ç›´æŒ‰ç…§è‡ªå·±å¹³æ—¶çš„å¤„ç†é€Ÿåº¦æ¥å·¥ä½œã€‚ä¸€åˆ‡å‹åŠ›ç”± Broker æ‰›ç€ï¼Œè¿™æ ·ä¸€ä¸ªé«˜åº¦çš„å¹¶å‘å°±å¯ä»¥å˜æˆä½åº¦çš„å¹¶å‘ï¼Œè¿™ï¼å°±æ˜¯ æµé‡å‰Šå³°</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310101542090.png\" alt=\"image-20231010154228957\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>:</p>\n<p>å¼‚æ­¥é€šä¿¡çš„ä¼˜ç‚¹ï¼š</p>\n<ul>\n<li>è€¦åˆåº¦ä½</li>\n<li>ååé‡æå‡</li>\n<li>æ•…éšœéš”ç¦»</li>\n<li>æµé‡å‰Šå³°</li>\n</ul>\n<p>å¼‚æ­¥é€šä¿¡çš„ç¼ºç‚¹ï¼š</p>\n<ul>\n<li>ä¾èµ–äº Broker çš„å¯é æ€§ï¼Œå®‰å…¨æ€§ï¼Œååèƒ½åŠ›</li>\n<li>æ¶æ„å¤æ‚äº†ï¼Œä¸šåŠ¡æ²¡æœ‰æ˜æ˜¾çš„æµç¨‹çº¿ï¼Œä¸å¥½è¿½è¸ªç®¡ç†</li>\n</ul>\n</blockquote>\n<h4 id=\"813-ä»€ä¹ˆæ˜¯mq\"><a class=\"anchor\" href=\"#813-ä»€ä¹ˆæ˜¯mq\">#</a> 8.1.3ã€ä»€ä¹ˆæ˜¯ MQğŸŒ²</h4>\n<p>MQ (MessageQueue) ï¼Œä¸­æ–‡æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå­—é¢æ¥çœ‹å°±æ˜¯å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—ã€‚ä¹Ÿå°±æ˜¯äº‹ä»¶é©±åŠ¨æ¶æ„ä¸­çš„ Broker</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>RabbitMQ</th>\n<th>ActiveMQ</th>\n<th>RocketMQ</th>\n<th>KafKa</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>å…¬å¸ / ç¤¾åŒº</td>\n<td>Rabbit</td>\n<td>Apache</td>\n<td>é˜¿é‡Œ</td>\n<td>Apache</td>\n</tr>\n<tr>\n<td>å¼€å‘è¯­è¨€</td>\n<td>Erlang</td>\n<td>Java</td>\n<td>Java</td>\n<td>Scala&amp;Java</td>\n</tr>\n<tr>\n<td>åè®®æ”¯æŒ</td>\n<td>AMQPï¼ŒXMPPï¼ŒSTOMP</td>\n<td>OpenWireï¼ŒSTOMPï¼ŒRESTï¼ŒXMPPï¼ŒAMQP</td>\n<td>è‡ªå®šä¹‰åè®®</td>\n<td>è‡ªå®šä¹‰åè®®</td>\n</tr>\n<tr>\n<td>å¯ç”¨æ€§</td>\n<td>é«˜</td>\n<td>ä¸€èˆ¬</td>\n<td>é«˜</td>\n<td>é«˜</td>\n</tr>\n<tr>\n<td>å•æœºååé‡</td>\n<td>ä¸€èˆ¬</td>\n<td>å·®</td>\n<td>é«˜</td>\n<td>éå¸¸é«˜</td>\n</tr>\n<tr>\n<td>æ¶ˆæ¯å»¶è¿Ÿ</td>\n<td>å¾®ç§’çº§</td>\n<td>æ¯«ç§’çº§</td>\n<td>æ¯«ç§’çº§</td>\n<td>æ¯«ç§’ä»¥å†…</td>\n</tr>\n<tr>\n<td>æ¶ˆæ¯å¯é æ€§</td>\n<td>é«˜</td>\n<td>ä¸€èˆ¬</td>\n<td>é«˜</td>\n<td>ä¸€èˆ¬</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"814-rabbitmqå¿«é€Ÿå…¥é—¨\"><a class=\"anchor\" href=\"#814-rabbitmqå¿«é€Ÿå…¥é—¨\">#</a> 8.1.4ã€RabbitMQ å¿«é€Ÿå…¥é—¨ğŸŒ²</h4>\n<ul>\n<li>RabbitMQ æ¦‚è¿°å’Œå®‰è£…</li>\n<li>å¸¸è§æ¶ˆæ¯æ¨¡å‹</li>\n<li>å¿«é€Ÿå…¥é—¨</li>\n</ul>\n<h5 id=\"8141-rabbitmqæ¦‚è¿°\"><a class=\"anchor\" href=\"#8141-rabbitmqæ¦‚è¿°\">#</a> 8.1.4.1ã€RabbitMQ æ¦‚è¿°ğŸŒ´</h5>\n<p>RabbitMQ æ˜¯åŸºäº Erlang è¯­è¨€å¼€å‘çš„å¼€æºæ¶ˆæ¯é€šä¿¡ä¸­é—´ä»¶ï¼Œå®˜ç½‘åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmFiYml0bXEuY29tLw==\">https://www.rabbitmq.com/</span></p>\n<p>å®‰è£… RabbitMQ å¯ä»¥ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†æ–‡ç« ï¼š<a href=\"./RabbitMQ/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97.md\">RabbitMQ å®‰è£…éƒ¨ç½²æŒ‡å—</a>.</p>\n<blockquote>\n<p>RabbitMQ çš„ç»“æ„å’Œæ¦‚å¿µ</p>\n<p>Publisher æ˜¯æ¶ˆæ¯å‘é€è€…ï¼Œconsumer å°±æ˜¯æ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œå‘é€è€…ä¼šæŠŠæ¶ˆæ¯å‘é€åˆ° exchange ä¹Ÿå°±æ˜¯äº¤æ¢æœºã€‚äº¤æ¢æœºè´Ÿè´£è·¯ç”±æŠŠæ¶ˆæ¯æŠ•é€’åˆ° queue é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—è´Ÿè´£æš‚å­˜æ¶ˆæ¯ï¼Œç„¶åæ¶ˆè´¹è€…å†å»ä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ç„¶åå¤„ç†æ¶ˆæ¯</p>\n<p>VirtulHost å°±æ˜¯è™šæ‹Ÿä¸»æœºï¼Œå°†æ¥æœ‰å¤šä¸ªç”¨æˆ·å®ƒä¼šæœ‰è‡ªå·±çš„ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œå„ä¸ªè™šæ‹Ÿä¸»æœºä¹‹é—´äº’ç›¸éš”ç¦»é¿å…å¹²æ‰°</p>\n<p>è¿™å°±æ˜¯æ•´ä½“ MQ çš„æ¶æ„äº†</p>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310102044747.png\" alt=\"image-20231010204307956\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>RabbitMQ ä¸­çš„å‡ ä¸ªæ¦‚å¿µï¼š</p>\n<ul>\n<li>channelï¼šæ“ä½œ MQ çš„å·¥å…·</li>\n<li>exchangeï¼šè·¯ç”±æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­</li>\n<li>queueï¼šç¼“å­˜æ¶ˆæ¯</li>\n<li>virtual hostï¼šè™šæ‹Ÿä¸»æœºï¼Œæ˜¯å¯¹ queueï¼Œexchange ç­‰èµ„æºçš„é€»è¾‘åˆ†ç»„</li>\n</ul>\n</blockquote>\n<h5 id=\"8142-å¸¸è§æ¶ˆæ¯æ¨¡å‹\"><a class=\"anchor\" href=\"#8142-å¸¸è§æ¶ˆæ¯æ¨¡å‹\">#</a> 8.1.4.2ã€å¸¸è§æ¶ˆæ¯æ¨¡å‹ğŸŒ´</h5>\n<p>MQ çš„å®˜æ–¹æ–‡æ¡£ä¸­ç»™å‡ºäº† 5 ä¸ª MQ çš„ demo ç¤ºä¾‹ï¼Œå¯¹åº”äº†å‡ ç§ä¸åŒçš„ç”¨æ³•ï¼š</p>\n<ul>\n<li>åŸºæœ¬æ¶ˆæ¯é˜Ÿåˆ— (BasicQueue)</li>\n<li>å·¥ä½œæ¶ˆæ¯é˜Ÿåˆ— (WorkQueue)</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310102052128.png\" alt=\"image-20231010205233688\" /></p>\n<ul>\n<li>\n<p>å‘å¸ƒè®¢é˜… (Publish ï¼ŒSubscribe)ï¼Œåˆæ ¹æ®äº¤æ¢æœºç±»å‹ä¸åŒåˆ†ä¸ºä¸‰ç§ï¼š</p>\n<ul>\n<li>Fanout Exchangeï¼šå¹¿æ’­</li>\n<li>Direct Exchangeï¼šè·¯ç”±</li>\n<li>Topic Exchangeï¼šä¸»é¢˜</li>\n</ul>\n<p>å›¾ä¸­ï¼Œç´«è‰²çš„å°±æ˜¯äº¤æ¢æœº</p>\n</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310102054075.png\" alt=\"image-20231010205422743\" /></p>\n<h5 id=\"8143-helloworldæ¡ˆä¾‹\"><a class=\"anchor\" href=\"#8143-helloworldæ¡ˆä¾‹\">#</a> 8.1.4.3ã€HelloWorld æ¡ˆä¾‹ğŸŒ´</h5>\n<p>å®˜æ–¹çš„ HelloWorld æ˜¯åŸºäºæœ€åŸºç¡€çš„æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å‹æ¥å®ç°çš„ï¼ŒåªåŒ…æ‹¬ä¸‰ä¸ªè§’è‰²ï¼š</p>\n<ul>\n<li>publisherï¼šæ¶ˆæ¯å‘å¸ƒè€…ï¼Œå°†æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ— queue</li>\n<li>queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè´Ÿè´£æ¥å—å¹¶ç¼“å­˜æ¶ˆæ¯</li>\n<li>consumerï¼šè®¢é˜…é˜Ÿåˆ—ï¼Œå¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310102056496.png\" alt=\"image-20231010205637991\" /></p>\n<p>å‘å¸ƒè€…ä»£ç ï¼š</p>\n<p>debug è¿è¡Œä»£ç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>rabbitmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Channel</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>rabbitmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Connection</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>rabbitmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ConnectionFactory</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>junit<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Test</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">TimeoutException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PublisherTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testSendMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TimeoutException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 1. å»ºç«‹è¿æ¥</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token operator\">*</span>        <span class=\"token class-name\">ConnectionFactory</span> factory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// 1.1. è®¾ç½®è¿æ¥å‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šä¸»æœºåã€ç«¯å£å·ã€vhostã€ç”¨æˆ·åã€å¯†ç </span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        factory<span class=\"token punctuation\">.</span><span class=\"token function\">setHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.249.128\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        factory<span class=\"token punctuation\">.</span><span class=\"token function\">setPort</span><span class=\"token punctuation\">(</span><span class=\"token number\">5672</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        factory<span class=\"token punctuation\">.</span><span class=\"token function\">setVirtualHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        factory<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"itcast\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        factory<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"123321\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token comment\">// 1.2. å»ºç«‹è¿æ¥</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> factory<span class=\"token punctuation\">.</span><span class=\"token function\">newConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">// 2. åˆ›å»ºé€šé“ Channel</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">Channel</span> channel <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// 3. åˆ›å»ºé˜Ÿåˆ—</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token class-name\">String</span> queueName <span class=\"token operator\">=</span> <span class=\"token string\">\"simple.queue\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        channel<span class=\"token punctuation\">.</span><span class=\"token function\">queueDeclare</span><span class=\"token punctuation\">(</span>queueName<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token comment\">// 4. å‘é€æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token class-name\">String</span> message <span class=\"token operator\">=</span> <span class=\"token string\">\"hello, rabbitmq!\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicPublish</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> queueName<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å‘é€æ¶ˆæ¯æˆåŠŸï¼šã€\"</span> <span class=\"token operator\">+</span> message <span class=\"token operator\">+</span> <span class=\"token string\">\"ã€‘\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token comment\">// 5. å…³é—­é€šé“å’Œè¿æ¥</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        channel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä»£ç èµ°åˆ°å»ºç«‹è¿æ¥æ²¡æœ‰æŠ¥é”™çš„è¯ï¼ŒæŸ¥çœ‹ä¸‹ RabbitMQ çš„ ui ç®¡ç†å¹³å°ä¸­çš„ Connections</p>\n<p>é‡Œé¢å°±ä¼šå‡ºç°ä¸€ä¸ªä¸»æœºçš„è¿æ¥ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110748590.png\" alt=\"image-20231011074738545\" /></p>\n<p>å†å¾€ä¸‹åˆ›å»ºé€šé“</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110749797.png\" alt=\"image-20231011074927559\" /></p>\n<p>å†å¾€ä¸‹åˆ›å»ºé˜Ÿåˆ—</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110750475.png\" alt=\"image-20231011075033895\" /></p>\n<p>å†å¾€ä¸‹å‡†å¤‡å‘é€æ¶ˆæ¯å¾€é˜Ÿåˆ—ä¸­å‘é€ queNameï¼Œå°†æ¶ˆæ¯è½¬ä¸ºå­—èŠ‚å‘é€ getBytes ()</p>\n<p>ä¸‹é¢å°±å¯ä»¥çœ‹åˆ°é˜Ÿåˆ—ä¸­æœ‰ä¸€æ¡æ¶ˆæ¯ï¼šReady = 1</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110756263.png\" alt=\"image-20231011075619843\" /></p>\n<p>æˆ‘ä»¬å¯ä»¥ç‚¹å‡» Nameï¼Œç‚¹å‡»è¿›å»ç„¶åç‚¹å‡» Get Message é‡Œé¢å¯ä»¥çœ‹åˆ°å‘é€çš„æ¶ˆæ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110758298.png\" alt=\"image-20231011075826602\" /></p>\n<p>æ¶ˆè´¹è€…ä»£ç </p>\n<p>debug è¿è¡Œ</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>rabbitmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">TimeoutException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ConsumerTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TimeoutException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// 1. å»ºç«‹è¿æ¥</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">ConnectionFactory</span> factory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// 1.1. è®¾ç½®è¿æ¥å‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šä¸»æœºåã€ç«¯å£å·ã€vhostã€ç”¨æˆ·åã€å¯†ç </span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        factory<span class=\"token punctuation\">.</span><span class=\"token function\">setHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.249.128\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        factory<span class=\"token punctuation\">.</span><span class=\"token function\">setPort</span><span class=\"token punctuation\">(</span><span class=\"token number\">5672</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        factory<span class=\"token punctuation\">.</span><span class=\"token function\">setVirtualHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        factory<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"itcast\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        factory<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"123321\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// 1.2. å»ºç«‹è¿æ¥</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> factory<span class=\"token punctuation\">.</span><span class=\"token function\">newConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token comment\">// 2. åˆ›å»ºé€šé“ Channel</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">Channel</span> channel <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">// 3. åˆ›å»ºé˜Ÿåˆ—</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">String</span> queueName <span class=\"token operator\">=</span> <span class=\"token string\">\"simple.queue\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        channel<span class=\"token punctuation\">.</span><span class=\"token function\">queueDeclare</span><span class=\"token punctuation\">(</span>queueName<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">// 4. è®¢é˜…æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicConsume</span><span class=\"token punctuation\">(</span>queueName<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultConsumer</span><span class=\"token punctuation\">(</span>channel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handleDelivery</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> consumerTag<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Envelope</span> envelope<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                                       <span class=\"token class-name\">AMQP<span class=\"token punctuation\">.</span>BasicProperties</span> properties<span class=\"token punctuation\">,</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> body<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token comment\">// 5. å¤„ç†æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token class-name\">String</span> message <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€\"</span> <span class=\"token operator\">+</span> message <span class=\"token operator\">+</span> <span class=\"token string\">\"ã€‘\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç­‰å¾…æ¥æ”¶æ¶ˆæ¯ã€‚ã€‚ã€‚ã€‚\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨æ¶ˆè´¹è€…ä»£ç ä¸­åˆè¿›è¡Œäº†åˆ›å»ºé˜Ÿåˆ—ï¼Œå‘å¸ƒè€…å·²ç»äº§ç”Ÿæ—¶åˆ›å»ºäº†ä¸€ä¸ªé˜Ÿåˆ—äº†ï¼Œä½†æ˜¯æ¶ˆè´¹è€…ä¸ºä»€ä¹ˆåˆè¦åˆ›å»ºé˜Ÿåˆ—å‘¢ï¼Ÿ</p>\n<p>è¿™æ˜¯å› ä¸ºï¼Œå‘å¸ƒè€…å’Œæ¶ˆè´¹è€…å®ƒä»¬å¯åŠ¨çš„é¡ºåºä¸ç¡®å®šã€‚ä¸‡ä¸€æ¶ˆè´¹è€…å…ˆå¯åŠ¨çš„å‘¢ï¼Œé‚£æ‰¾é˜Ÿåˆ—æ‰¾ä¸åˆ°æ€ä¹ˆåŠã€‚ä¸ºäº†é¿å…è¿™ç§é—®é¢˜å‘ç”Ÿå®ƒä»¬å„è‡ªéƒ½å»å£°æ˜é˜Ÿåˆ—ï¼Œè™½ç„¶ä»£ç æ˜¯é‡å¤çš„ä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹ RabbitMQ-ui æ§åˆ¶å°çš„ Queue ç®¡ç†é¡µé¢</p>\n<p>å®ƒå¹¶æ²¡æœ‰å»åˆ›å»ºè¿™ä¸ªé˜Ÿåˆ—ï¼Œæ‰€ä»¥å‘å¸ƒè€…ä¸æ¶ˆè´¹è€…éƒ½å†™åªæ˜¯ä¸€ä¸ªä¿é™©æªæ–½é˜²æ­¢ä¸å­˜åœ¨é˜Ÿåˆ—</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110844291.png\" alt=\"image-20231011084433956\" /></p>\n<p>ç¬¬å››æ­¥æ¶ˆè´¹æ¶ˆæ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110845508.png\" alt=\"image-20231011084522086\" /></p>\n<p>æ¶ˆè´¹è€…æœ€ç»ˆåœ¨ idea æ§åˆ¶å°çš„æ‰“å°ä¿¡æ¯</p>\n<pre><code>ç­‰å¾…æ¥æ”¶æ¶ˆæ¯ã€‚ã€‚ã€‚ã€‚\næ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, rabbitmq!ã€‘\n</code></pre>\n<p>å…ˆæ‰“å°äº† main å‡½æ•°çš„ â€œç­‰å¾…æ¥æ”¶æ¶ˆæ¯ã€‚ã€‚ã€‚ã€‚â€ è¿™æ®µè¯ï¼Œè€Œåæ‰“å°äº† æ¶ˆè´¹çš„æ¶ˆæ¯ã€‚</p>\n<p>å› ä¸ºå›è°ƒæœºåˆ¶æ¶ˆè´¹è€…å¤„ç†å‡½æ•° handleDelivery ä¸é˜Ÿåˆ—è¿›è¡Œäº†ç»‘å®š queueNameã€‚ä½†æ˜¯æ¶ˆæ¯è¿˜å¹¶æ²¡æœ‰è¿‡æ¥ç„¶åå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œæ‰“å°äº† â€œç­‰å¾…æ¥æ”¶æ¶ˆæ¯ã€‚ã€‚ã€‚ã€‚â€ ï¼Œç­‰ rabbitMQ æŠŠæ¶ˆæ¯æŠ•é€’å›æ¥äº†å†æ‰“å° â€œæ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, rabbitmq!ã€‘â€ï¼Œè¿™å°±è¯´æ˜ RabbitMQ å¤„ç†æ¶ˆæ¯æ˜¯å¼‚æ­¥çš„</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>åŸºæœ¬æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯å‘é€æµç¨‹ï¼š</p>\n<ol>\n<li>å»ºç«‹ connection</li>\n<li>åˆ›å»º channel</li>\n<li>åˆ©ç”¨ channel å£°æ˜é˜Ÿåˆ—</li>\n<li>åˆ©ç”¨ channel å‘é˜Ÿåˆ—å‘é€æ¶ˆæ¯</li>\n</ol>\n<p>åŸºæœ¬æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯æ¥æ”¶æµç¨‹ï¼š</p>\n<ol>\n<li>å»ºç«‹ connection</li>\n<li>åˆ›å»º channel</li>\n<li>åˆ©ç”¨ channel å£°æ˜é˜Ÿåˆ—</li>\n<li>å®šä¹‰ consumer çš„æ¶ˆè´¹è¡Œä¸º handleDelivery ()</li>\n<li>åˆ©ç”¨ channel å°†æ¶ˆè´¹è€…ä¸é˜Ÿåˆ—ç»‘å®š</li>\n</ol>\n</blockquote>\n<h4 id=\"815-springamqp\"><a class=\"anchor\" href=\"#815-springamqp\">#</a> 8.1.5ã€SpringAMQPğŸŒ²</h4>\n<ul>\n<li>Basic Queue ç®€å•é˜Ÿåˆ—æ¨¡å‹</li>\n<li>Work Queue å·¥ä½œé˜Ÿåˆ—æ¨¡å‹</li>\n<li>å‘å¸ƒï¼Œè®¢é˜…æ¨¡å‹ - Fanout</li>\n<li>å‘å¸ƒï¼Œè®¢é˜…æ¨¡å‹ - Direct</li>\n<li>å‘å¸ƒï¼Œè®¢é˜…æ¨¡å‹ - Topic</li>\n<li>æ¶ˆæ¯è½¬æ¢å™¨</li>\n</ul>\n<h5 id=\"8151-ä»€ä¹ˆæ˜¯springamqp\"><a class=\"anchor\" href=\"#8151-ä»€ä¹ˆæ˜¯springamqp\">#</a> 8.1.5.1ã€ä»€ä¹ˆæ˜¯ SpringAMQPğŸŒ´</h5>\n<p>SpringAMQP å®˜æ–¹åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zcHJpbmcuaW8vcHJvamVjdHMvc3ByaW5nLWFtcXA=\">https://spring.io/projects/spring-amqp</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110903769.png\" alt=\"image-20231011090014596\" /></p>\n<h5 id=\"8152-æ¡ˆä¾‹åˆ©ç”¨springamqpå®ç°helloworldä¸­çš„åŸºç¡€æ¶ˆæ¯é˜Ÿåˆ—åŠŸèƒ½\"><a class=\"anchor\" href=\"#8152-æ¡ˆä¾‹åˆ©ç”¨springamqpå®ç°helloworldä¸­çš„åŸºç¡€æ¶ˆæ¯é˜Ÿåˆ—åŠŸèƒ½\">#</a> 8.1.5.2ã€æ¡ˆä¾‹ï¼Œåˆ©ç”¨ SpringAMQP å®ç° HelloWorld ä¸­çš„åŸºç¡€æ¶ˆæ¯é˜Ÿåˆ—åŠŸèƒ½ğŸŒ´</h5>\n<p><strong>æµç¨‹å¦‚ä¸‹</strong>ï¼š</p>\n<p>1ã€åœ¨çˆ¶å·¥ç¨‹ä¸­å¼•å…¥ spring-amqp çš„ä¾èµ–</p>\n<p>å› ä¸º publisher å’Œ consumer æœåŠ¡éƒ½éœ€è¦ amqp ä¾èµ–ï¼Œå› æ­¤è¿™é‡ŒæŠŠä¾èµ–ç›´æ¥æ”¾åˆ°çˆ¶å·¥ç¨‹ mq-demo ä¸­ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--AMQP ä¾èµ–ï¼ŒåŒ…å« RabbitMQ--></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-amqp<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>2ã€åœ¨ publisher æœåŠ¡ä¸­åˆ©ç”¨ RabbitTemplate å‘é€æ¶ˆæ¯åˆ° simple.queue åˆ°è¿™ä¸ªé˜Ÿåˆ—</p>\n<p>åœ¨ publisher ä¸­ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼Œå‘ simple.queue å‘é€æ¶ˆæ¯</p>\n<p>2.1ã€åœ¨ publisher æœåŠ¡ä¸­ç¼–å†™ application.ymlï¼Œæ·»åŠ  mq è¿æ¥ä¿¡æ¯ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">rabbitmq</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> 192.168.249.128 <span class=\"token comment\"># RabbitMQ çš„ ip åœ°å€</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5672</span> <span class=\"token comment\"># RabbitMQ çš„ç«¯å£å·</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> itcast <span class=\"token comment\"># ç”¨æˆ·å</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123321</span> <span class=\"token comment\"># å¯†ç </span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">virtual-host</span><span class=\"token punctuation\">:</span> / <span class=\"token comment\"># è™šæ‹Ÿä¸»æœº</span></pre></td></tr></table></figure><p>2.2ã€åœ¨ publisher æœåŠ¡ä¸­æ–°å»ºä¸€ä¸ªæµ‹è¯•ç±»ï¼Œç¼–å†™æµ‹è¯•æ–¹æ³•ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>junit<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Test</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>junit<span class=\"token punctuation\">.</span>runner<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RunWith</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>rabbit<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RabbitTemplate</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Autowired</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>test<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SpringBootTest</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>test<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>junit4<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SpringRunner</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * @2023/10/119:18</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @function</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @comment</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootTest</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token annotation punctuation\">@RunWith</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SpringRunner</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SpringAmqpTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RabbitTemplate</span> rabbitTemplate<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token class-name\">String</span> queueName <span class=\"token operator\">=</span> <span class=\"token string\">\"simple.queue\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">String</span> message <span class=\"token operator\">=</span> <span class=\"token string\">\"hello,Spring Amqp\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>queueName<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æŸ¥çœ‹ rabbitmq çš„ ui ç®¡ç†å¹³å°çš„é˜Ÿåˆ—ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110922013.png\" alt=\"image-20231011092250032\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110923115.png\" alt=\"image-20231011092326888\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>ä»€ä¹ˆæ˜¯ AMQP</p>\n<ul>\n<li>åº”ç”¨é—´æ¶ˆæ¯é€šä¿¡çš„ä¸€ç§åè®®ï¼Œä¸è¯­è¨€å’Œå¹³å°æ— å…³</li>\n</ul>\n<p>SpringAMQP å¦‚ä½•å‘é€æ¶ˆæ¯ï¼Ÿ</p>\n<ul>\n<li>å¼•å…¥ amqp çš„ starter ä¾èµ–</li>\n<li>é…ç½® RabbitMQ åœ°å€</li>\n<li>åˆ©ç”¨ RabbitTemplate çš„ convertAndSend æ–¹æ³•å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šé˜Ÿåˆ—ä¸­</li>\n</ul>\n</blockquote>\n<p>3ã€åœ¨ consumer æœåŠ¡ä¸­ç¼–å†™æ¶ˆè´¹é€»è¾‘ï¼Œç»‘å®š simple.queue è¿™ä¸ªé˜Ÿåˆ—</p>\n<p>åœ¨ consumer ä¸­ç¼–å†™æ¶ˆæ¯é€»è¾‘ï¼Œç›‘å¬ simple.queue</p>\n<p>3.1ã€åœ¨ consumer æœåŠ¡ä¸­ç¼–å†™ application.ymlï¼Œæ·»åŠ  mq è¿æ¥ä¿¡æ¯ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">rabbitmq</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> 192.168.249.128 <span class=\"token comment\"># RabbitMQ çš„ ip åœ°å€</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5672</span> <span class=\"token comment\"># RabbitMQ çš„ç«¯å£å·</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> itcast <span class=\"token comment\"># ç”¨æˆ·å</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123321</span> <span class=\"token comment\"># å¯†ç </span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">virtual-host</span><span class=\"token punctuation\">:</span> / <span class=\"token comment\"># è™šæ‹Ÿä¸»æœº</span></pre></td></tr></table></figure><p>3.2ã€åœ¨ consumer æœåŠ¡ä¸­æ–°å»ºä¸€ä¸ªç±»ï¼Œç¼–å†™æ¶ˆè´¹é€»è¾‘ï¼š</p>\n<p>ä¸èƒ½å†™åœ¨ test ä¸­è¿›è¡Œæµ‹è¯•æ˜¯å› ä¸ºå®ƒéœ€è¦è¢« Spring æ‰€ç®¡ç†æ³¨å†Œä¸º Bean</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>rabbit<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RabbitListener</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Component</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * @2023/10/119:34</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * @function</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * @comment</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SpringRabbitListener</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> <span class=\"token string\">\"simple.queue\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">listenerSimpleQueue</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆè´¹è€…æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">//---------------------- æ‰“å°ç»“æœ ----------------------</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token punctuation\">.</span>   ____          _            __ _ _</pre></td></tr><tr><td data-num=\"22\"></td><td><pre> <span class=\"token operator\">/</span>\\\\ <span class=\"token operator\">/</span> ___'_ __ _ <span class=\"token function\">_</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">)</span>_ __  __ _ \\ \\ \\ \\</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">)</span>\\___ <span class=\"token operator\">|</span> <span class=\"token char\">'_ | '</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span> '_ \\<span class=\"token operator\">/</span> _` <span class=\"token operator\">|</span> \\ \\ \\ \\</pre></td></tr><tr><td data-num=\"24\"></td><td><pre> \\\\<span class=\"token operator\">/</span>  ___<span class=\"token punctuation\">)</span><span class=\"token operator\">|</span> <span class=\"token operator\">|</span>_<span class=\"token punctuation\">)</span><span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span>  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  '  <span class=\"token operator\">|</span>____<span class=\"token operator\">|</span> <span class=\"token punctuation\">.</span>__<span class=\"token operator\">|</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span>_<span class=\"token operator\">|</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span>_\\__<span class=\"token punctuation\">,</span> <span class=\"token operator\">|</span> <span class=\"token operator\">/</span> <span class=\"token operator\">/</span> <span class=\"token operator\">/</span> <span class=\"token operator\">/</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre> <span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">|</span>_<span class=\"token operator\">|=</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">|</span>___<span class=\"token operator\">/=</span><span class=\"token operator\">/</span>_<span class=\"token operator\">/</span>_<span class=\"token operator\">/</span>_<span class=\"token operator\">/</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre> <span class=\"token operator\">::</span> <span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Boot</span> <span class=\"token operator\">::</span>        <span class=\"token punctuation\">(</span>v2<span class=\"token punctuation\">.</span><span class=\"token number\">3.9</span><span class=\"token punctuation\">.</span><span class=\"token constant\">RELEASE</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span> <span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">37</span><span class=\"token operator\">:</span><span class=\"token number\">32</span><span class=\"token operator\">:</span><span class=\"token number\">584</span>  <span class=\"token constant\">INFO</span> <span class=\"token number\">1164</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>           main<span class=\"token punctuation\">]</span> <span class=\"token class-name\"><span class=\"token namespace\">cn<span class=\"token punctuation\">.</span>itcast<span class=\"token punctuation\">.</span>mq<span class=\"token punctuation\">.</span></span>ConsumerApplication</span>         <span class=\"token operator\">:</span> <span class=\"token class-name\">Starting</span> <span class=\"token class-name\">ConsumerApplication</span> on <span class=\"token class-name\">Jfier</span> <span class=\"token keyword\">with</span> <span class=\"token class-name\">PID</span> <span class=\"token number\">1164</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">E</span><span class=\"token operator\">:</span>\\å¾®æœåŠ¡\\å®ç”¨ç¯‡\\èµ„æ–™\\day04<span class=\"token operator\">-</span><span class=\"token constant\">MQ</span>\\èµ„æ–™\\mq<span class=\"token operator\">-</span>demo\\consumer\\target\\classes started by <span class=\"token class-name\">Administrator</span> in <span class=\"token class-name\">E</span><span class=\"token operator\">:</span>\\å¾®æœåŠ¡\\å®ç”¨ç¯‡\\èµ„æ–™\\day04<span class=\"token operator\">-</span><span class=\"token constant\">MQ</span>\\èµ„æ–™\\mq<span class=\"token operator\">-</span>demo<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span> <span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">37</span><span class=\"token operator\">:</span><span class=\"token number\">32</span><span class=\"token operator\">:</span><span class=\"token number\">594</span>  <span class=\"token constant\">INFO</span> <span class=\"token number\">1164</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>           main<span class=\"token punctuation\">]</span> <span class=\"token class-name\"><span class=\"token namespace\">cn<span class=\"token punctuation\">.</span>itcast<span class=\"token punctuation\">.</span>mq<span class=\"token punctuation\">.</span></span>ConsumerApplication</span>         <span class=\"token operator\">:</span> <span class=\"token class-name\">No</span> active profile set<span class=\"token punctuation\">,</span> falling back <span class=\"token keyword\">to</span> <span class=\"token keyword\">default</span> profiles<span class=\"token operator\">:</span> <span class=\"token keyword\">default</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span> <span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">37</span><span class=\"token operator\">:</span><span class=\"token number\">34</span><span class=\"token operator\">:</span><span class=\"token number\">476</span>  <span class=\"token constant\">INFO</span> <span class=\"token number\">1164</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>           main<span class=\"token punctuation\">]</span> <span class=\"token class-name\"><span class=\"token namespace\">o<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">.</span>r<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span></span>CachingConnectionFactory</span>       <span class=\"token operator\">:</span> <span class=\"token class-name\">Attempting</span> <span class=\"token keyword\">to</span> <span class=\"token namespace\">connect</span> <span class=\"token keyword\">to</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">192.168</span><span class=\"token number\">.249</span><span class=\"token number\">.128</span><span class=\"token operator\">:</span><span class=\"token number\">5672</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span> <span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">37</span><span class=\"token operator\">:</span><span class=\"token number\">34</span><span class=\"token operator\">:</span><span class=\"token number\">531</span>  <span class=\"token constant\">INFO</span> <span class=\"token number\">1164</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>           main<span class=\"token punctuation\">]</span> <span class=\"token class-name\"><span class=\"token namespace\">o<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">.</span>r<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span></span>CachingConnectionFactory</span>       <span class=\"token operator\">:</span> <span class=\"token class-name\">Created</span> <span class=\"token keyword\">new</span> connection<span class=\"token operator\">:</span> rabbitConnectionFactory#<span class=\"token number\">640d</span>c4c6<span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token operator\">/</span><span class=\"token class-name\">SimpleConnection</span><span class=\"token annotation punctuation\">@7a0f244f</span> <span class=\"token punctuation\">[</span>delegate<span class=\"token operator\">=</span>amqp<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>itcast<span class=\"token annotation punctuation\">@192.168.249.128</span><span class=\"token operator\">:</span><span class=\"token number\">5672</span><span class=\"token operator\">/</span><span class=\"token punctuation\">,</span> localPort<span class=\"token operator\">=</span> <span class=\"token number\">3380</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span> <span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">37</span><span class=\"token operator\">:</span><span class=\"token number\">34</span><span class=\"token operator\">:</span><span class=\"token number\">610</span>  <span class=\"token constant\">INFO</span> <span class=\"token number\">1164</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>           main<span class=\"token punctuation\">]</span> <span class=\"token class-name\"><span class=\"token namespace\">cn<span class=\"token punctuation\">.</span>itcast<span class=\"token punctuation\">.</span>mq<span class=\"token punctuation\">.</span></span>ConsumerApplication</span>         <span class=\"token operator\">:</span> <span class=\"token class-name\">Started</span> <span class=\"token class-name\">ConsumerApplication</span> in <span class=\"token number\">2.755</span> seconds <span class=\"token punctuation\">(</span><span class=\"token constant\">JVM</span> running <span class=\"token keyword\">for</span> <span class=\"token number\">4.791</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>æ¶ˆè´¹è€…æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span></pre></td></tr></table></figure><blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>SPringAMQP å¦‚ä½•æ¥æ”¶æ¶ˆæ¯ï¼Ÿ</p>\n<ul>\n<li>å¼•å…¥ amqp çš„ starter ä¾èµ–</li>\n<li>é…ç½® RabbitMQ åœ°å€</li>\n<li>å®šä¹‰ç±»ï¼Œæ·»åŠ  @Component æ³¨è§£</li>\n<li>ç±»ä¸­å£°æ˜æ–¹æ³•ï¼Œæ·»åŠ  @RabbitListener æ³¨è§£ï¼Œæ–¹æ³•å‚æ•°å°±æ˜¯æ¶ˆæ¯</li>\n</ul>\n</blockquote>\n<h4 id=\"816-work-queueå·¥ä½œé˜Ÿåˆ—\"><a class=\"anchor\" href=\"#816-work-queueå·¥ä½œé˜Ÿåˆ—\">#</a> 8.1.6ã€Work Queue å·¥ä½œé˜Ÿåˆ—ğŸŒ²</h4>\n<p>å®ƒä¹Ÿå…·å¤‡æ¶ˆæ¯å‘å¸ƒå’Œæ¶ˆè´¹ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯å®ƒåé¢æŒ‚äº†ä¸¤ä¸ªæ¶ˆè´¹è€…ã€‚ä¸¤ä¸ªæ¶ˆè´¹è€…å…±åŒå¤„ç†å‘å¸ƒè€…çš„æ¶ˆæ¯ï¼Œ</p>\n<p>æ¯”å¦‚å‘å¸ƒè€…å‘é€ 50 æ¶ˆæ¯ï¼Œconsumer1 æ¶ˆè´¹ 25ï¼Œconsumer2 æ¶ˆè´¹ 25ã€‚è¢«æ¶ˆè´¹è¿‡çš„æ¶ˆæ¯å°±ä¼šè¢«åˆ é™¤ä¸å¯èƒ½ä¼šå†è¢«å…¶å®ƒæ¶ˆè´¹è€…æ¶ˆè´¹å·²ç»æ¶ˆè´¹è¿‡çš„æ¶ˆæ¯ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110943473.png\" alt=\"image-20231011094302230\" /></p>\n<h5 id=\"8161-æ¨¡æ‹Ÿworkqueueå®ç°ä¸€ä¸ªé˜Ÿåˆ—ç»‘å®šå¤šä¸ªæ¶ˆè´¹è€…\"><a class=\"anchor\" href=\"#8161-æ¨¡æ‹Ÿworkqueueå®ç°ä¸€ä¸ªé˜Ÿåˆ—ç»‘å®šå¤šä¸ªæ¶ˆè´¹è€…\">#</a> 8.1.6.1ã€æ¨¡æ‹Ÿ WorkQueueï¼Œå®ç°ä¸€ä¸ªé˜Ÿåˆ—ç»‘å®šå¤šä¸ªæ¶ˆè´¹è€…ğŸŒ´</h5>\n<p><strong>åŸºæœ¬æ€è·¯å¦‚ä¸‹</strong>ï¼š</p>\n<p>1ã€åœ¨ publisher æœåŠ¡ä¸­å®šä¹‰æµ‹è¯•æ–¹æ³•ï¼Œæ¯ç§’äº§ç”Ÿ 50 æ¡æ¶ˆæ¯ï¼Œå‘é€åˆ° simple.queue</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">workQueueTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">String</span> queueName <span class=\"token operator\">=</span> <span class=\"token string\">\"simple.queue\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">String</span> message <span class=\"token operator\">=</span> <span class=\"token string\">\"hello,Spring Amqp __ \"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">&lt;</span> <span class=\"token number\">50</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>         <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>queueName<span class=\"token punctuation\">,</span> message <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>2ã€åœ¨ consumer æœåŠ¡ä¸­å®šä¹‰ä¸¤ä¸ªæ¶ˆæ¯ç›‘å¬è€…ï¼Œéƒ½ç›‘å¬ simple.queue é˜Ÿåˆ—</p>\n<p>2.1ã€æ¶ˆè´¹è€… 1 æ¯ç§’å¤„ç† 50 æ¡æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€… 2 æ¯ç§’å¤„ç† 10 æ¡æ¶ˆæ¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> <span class=\"token string\">\"simple.queue\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">listenerSimpleQueue1</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> <span class=\"token string\">\"simple.queue\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">listenerSimpleQueue2</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>err<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆè´¹è€…2......æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">//-------------------- æ‰“å°ç»“æœ --------------------</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token punctuation\">.</span>   ____          _            __ _ _</pre></td></tr><tr><td data-num=\"24\"></td><td><pre> <span class=\"token operator\">/</span>\\\\ <span class=\"token operator\">/</span> ___'_ __ _ <span class=\"token function\">_</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">)</span>_ __  __ _ \\ \\ \\ \\</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">)</span>\\___ <span class=\"token operator\">|</span> <span class=\"token char\">'_ | '</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span> '_ \\<span class=\"token operator\">/</span> _` <span class=\"token operator\">|</span> \\ \\ \\ \\</pre></td></tr><tr><td data-num=\"26\"></td><td><pre> \\\\<span class=\"token operator\">/</span>  ___<span class=\"token punctuation\">)</span><span class=\"token operator\">|</span> <span class=\"token operator\">|</span>_<span class=\"token punctuation\">)</span><span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span>  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  '  <span class=\"token operator\">|</span>____<span class=\"token operator\">|</span> <span class=\"token punctuation\">.</span>__<span class=\"token operator\">|</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span>_<span class=\"token operator\">|</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span>_\\__<span class=\"token punctuation\">,</span> <span class=\"token operator\">|</span> <span class=\"token operator\">/</span> <span class=\"token operator\">/</span> <span class=\"token operator\">/</span> <span class=\"token operator\">/</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre> <span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">|</span>_<span class=\"token operator\">|=</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">|</span>___<span class=\"token operator\">/=</span><span class=\"token operator\">/</span>_<span class=\"token operator\">/</span>_<span class=\"token operator\">/</span>_<span class=\"token operator\">/</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre> <span class=\"token operator\">::</span> <span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Boot</span> <span class=\"token operator\">::</span>        <span class=\"token punctuation\">(</span>v2<span class=\"token punctuation\">.</span><span class=\"token number\">3.9</span><span class=\"token punctuation\">.</span><span class=\"token constant\">RELEASE</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">1</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">47.564155</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">0</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">47.564155</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">3</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">47.602944400</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">5</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">47.634311</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">7</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">47.663563900</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">9</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">47.693902600</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">11</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">47.724277700</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">13</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">47.754720</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">2</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">47.784759800</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">15</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">47.784759800</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">17</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">47.814876500</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">19</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">47.845253300</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">21</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">47.876696200</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">23</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">47.907389600</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">25</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">47.938559800</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">27</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">47.968268500</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">29</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">47.998623300</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">4</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">47.998623300</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">31</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">48.028620600</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">33</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">48.058770700</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">35</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">48.089572100</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">37</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">48.119707200</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">39</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">48.149984400</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">41</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">48.179999600</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">6</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">48.210307400</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">43</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">48.210307400</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">45</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">48.240964800</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">47</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">48.270986500</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">1</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">49</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">48.301165400</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">8</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">48.423433300</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">10</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">48.636403400</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">12</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">48.848982300</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">14</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">49.060187200</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">16</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">49.273197100</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">18</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">49.484165800</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">20</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">49.696880900</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">22</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">49.908464300</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">24</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">50.121477600</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">26</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">50.333586300</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">28</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">50.548236400</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">30</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">50.759585700</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">32</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">50.973508400</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">34</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">51.185203800</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">36</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">51.399855600</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">38</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">51.610433700</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">40</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">51.823352100</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">42</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">52.035381900</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">44</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">52.248226300</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">46</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">52.462320400</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>æ¶ˆè´¹è€…<span class=\"token number\">2.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>æ¥æ”¶åˆ°simple<span class=\"token punctuation\">.</span>queueçš„æ¶ˆæ¯ä¸ºï¼šhello<span class=\"token punctuation\">,</span><span class=\"token class-name\">Spring</span> <span class=\"token class-name\">Amqp</span> __ <span class=\"token number\">48</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token constant\">T10</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">52.677121500</span></pre></td></tr></table></figure><p>æ¶ˆè´¹è€… 1 å¾ˆå¿«å°±ç»“æŸäº†ï¼Œè€Œæ¶ˆè´¹è€… 2 å´èŠ±äº†å¾ˆé•¿å¾ˆé•¿çš„æ—¶é—´ã€‚æˆ‘ä»¬è®¤ä¸ºçš„å¿«çš„å¤šæ¶ˆè´¹ç‚¹ï¼Œæ…¢çš„å°‘æ¶ˆè´¹ç‚¹è€Œäº‹å®å´æ˜¯å¹³å‡åˆ†é…ç»™äº†ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€… 1 é‚£æ‹¿çš„æ˜¯æ‰€æœ‰çš„å¥‡æ•°ï¼Œæ¶ˆè´¹è€… 2 æ‹¿åˆ°çš„æ˜¯æ‰€æœ‰çš„å¶æ•°ã€‚</p>\n<p>è¿™æ˜¯å› ä¸º RabbitMQ ä¸€ä¸ªæœºåˆ¶é€ æˆçš„ï¼Œå°±æ˜¯ï¼šæ¶ˆæ¯é¢„å–æœºåˆ¶</p>\n<p>è§£é‡Šæ¶ˆæ¯é¢„å–ï¼š</p>\n<p>å½“æœ‰å¤§é‡çš„æ¶ˆæ¯åˆ°è¾¾é˜Ÿåˆ—æ—¶ï¼Œé˜Ÿåˆ—ä¸­ä¼šæŠŠæ¶ˆæ¯è¿›è¡ŒæŠ•é€’ï¼Œconsumer1 å’Œ consumer2 ä¼šæå‰æŠŠæ¶ˆæ¯æ‹¿è¿‡æ¥è¿™å°±æ˜¯æ¶ˆæ¯é¢„å–ï¼Œä¸ç®¡èƒ½ä¸èƒ½å¤„ç†å…ˆæ‹¿è¿‡æ¥å†è¯´</p>\n<p>äºæ˜¯ä¸¤ä¸ªäººå°±å¹³å‡åˆ†é…æ‰€æœ‰çš„æ¶ˆæ¯ä¸€äººåˆ†äº† 25 æ¡ï¼Œä½†æ˜¯å‘¢ consumer1 å¤„ç†çš„å¿«å¾ˆå¿«å°±æå®šäº†ï¼Œconsumer2 å¤„ç†çš„æ…¢éœ€è¦ä¸€æ®µæ—¶é—´</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111024244.png\" alt=\"image-20231011102418214\" /></p>\n<h6 id=\"å¯ä»¥å¯¹æ¶ˆæ¯é¢„å–è¿›è¡Œé…ç½®é™åˆ¶\"><a class=\"anchor\" href=\"#å¯ä»¥å¯¹æ¶ˆæ¯é¢„å–è¿›è¡Œé…ç½®é™åˆ¶\">#</a> å¯ä»¥å¯¹æ¶ˆæ¯é¢„å–è¿›è¡Œé…ç½®é™åˆ¶ğŸ‹</h6>\n<p>ä¿®æ”¹ application.yml æ–‡ä»¶ï¼Œè®¾ç½® preFetch è¿™ä¸ªå€¼ï¼Œå¯ä»¥æ§åˆ¶é¢„å–æ¶ˆæ¯çš„ä¸Šé™ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">rabbitmq</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> 192.168.249.128 <span class=\"token comment\"># RabbitMQ çš„ ip åœ°å€</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5672</span> <span class=\"token comment\"># RabbitMQ çš„ç«¯å£å·</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> itcast <span class=\"token comment\"># ç”¨æˆ·å</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123321</span> <span class=\"token comment\"># å¯†ç </span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">virtual-host</span><span class=\"token punctuation\">:</span> / <span class=\"token comment\"># è™šæ‹Ÿä¸»æœº</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">listener</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">simple</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token key atrule\">prefetch</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span> <span class=\"token comment\"># æ¯æ¬¡åªè·å–ä¸€æ¡æ¶ˆæ¯ï¼Œå¤„ç†å®Œæˆæ‰èƒ½è·å–ä¸‹ä¸€ä¸ªæ¶ˆæ¯</span></pre></td></tr></table></figure><p>è®¾ç½®å®Œæˆåå†è¿›è¡Œæµ‹è¯•ï¼š</p>\n<pre><code>æ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 0---2023-10-11T10:30:40.386440300\næ¶ˆè´¹è€…2......æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 1---2023-10-11T10:30:40.398703100\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 2---2023-10-11T10:30:40.413527700\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 3---2023-10-11T10:30:40.444268700\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 4---2023-10-11T10:30:40.473866400\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 5---2023-10-11T10:30:40.504620300\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 6---2023-10-11T10:30:40.535400300\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 7---2023-10-11T10:30:40.566022200\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 8---2023-10-11T10:30:40.595970600\næ¶ˆè´¹è€…2......æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 9---2023-10-11T10:30:40.611076800\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 10---2023-10-11T10:30:40.626201300\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 11---2023-10-11T10:30:40.657505500\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 12---2023-10-11T10:30:40.688200\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 13---2023-10-11T10:30:40.717912700\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 14---2023-10-11T10:30:40.748533200\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 15---2023-10-11T10:30:40.778181500\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 16---2023-10-11T10:30:40.808905800\næ¶ˆè´¹è€…2......æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 17---2023-10-11T10:30:40.823251200\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 18---2023-10-11T10:30:40.837450100\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 19---2023-10-11T10:30:40.867629400\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 20---2023-10-11T10:30:40.897964100\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 21---2023-10-11T10:30:40.927968900\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 22---2023-10-11T10:30:40.959483800\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 23---2023-10-11T10:30:40.988862\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 24---2023-10-11T10:30:41.019388500\næ¶ˆè´¹è€…2......æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 25---2023-10-11T10:30:41.034540\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 26---2023-10-11T10:30:41.049536900\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 27---2023-10-11T10:30:41.079546800\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 28---2023-10-11T10:30:41.110340600\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 29---2023-10-11T10:30:41.141704800\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 30---2023-10-11T10:30:41.171164300\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 31---2023-10-11T10:30:41.201884700\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 32---2023-10-11T10:30:41.231497200\næ¶ˆè´¹è€…2......æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 33---2023-10-11T10:30:41.246620400\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 34---2023-10-11T10:30:41.262814300\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 35---2023-10-11T10:30:41.293344400\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 36---2023-10-11T10:30:41.322739\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 37---2023-10-11T10:30:41.352387700\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 38---2023-10-11T10:30:41.382386800\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 39---2023-10-11T10:30:41.412727200\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 40---2023-10-11T10:30:41.443659\næ¶ˆè´¹è€…2......æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 41---2023-10-11T10:30:41.458969\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 42---2023-10-11T10:30:41.475290100\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 43---2023-10-11T10:30:41.504816800\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 44---2023-10-11T10:30:41.535720400\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 45---2023-10-11T10:30:41.565967900\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 46---2023-10-11T10:30:41.596477300\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 47---2023-10-11T10:30:41.625940900\næ¶ˆè´¹è€…1æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 48---2023-10-11T10:30:41.658033\næ¶ˆè´¹è€…2......æ¥æ”¶åˆ°simple.queueçš„æ¶ˆæ¯ä¸ºï¼šhello,Spring Amqp __ 49---2023-10-11T10:30:41.674047\n</code></pre>\n<p>è¿™æ—¶æ¶ˆè´¹è€…æ‰“å°çš„æ¶ˆæ¯ç‰¹å¿«å°±ç»“æŸäº†ï¼Œå¿«çš„å‘¢å¤šæ¶ˆè´¹ï¼Œæ…¢çš„å‘¢å°±æ…¢æ…¢æ¥æ¶ˆè´¹ã€‚èµ·åˆ°èƒ½è€…å¤šåŠ³çš„åŠŸèƒ½</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<ul>\n<li>å¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼ŒåŒä¸€æ¡æ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†</li>\n<li>é€šè¿‡è®¾ç½® prefetch æ¥æ§åˆ¶æ¶ˆè´¹è€…é¢„å–çš„æ¶ˆæ¯æ•°é‡</li>\n</ul>\n</blockquote>\n<h4 id=\"817-å‘å¸ƒpublishè®¢é˜…subscribe\"><a class=\"anchor\" href=\"#817-å‘å¸ƒpublishè®¢é˜…subscribe\">#</a> 8.1.7ã€å‘å¸ƒ (publish)ï¼Œè®¢é˜… (subscribe)ğŸŒ²</h4>\n<p>å‘å¸ƒè®¢é˜…æ¨¡å¼ä¸ä¹‹å‰æ¡ˆä¾‹çš„åŒºåˆ«å°±æ˜¯å…è®¸å°†åŒä¸€æ¶ˆæ¯å‘é€ç»™å¤šä¸ªæ¶ˆè´¹è€…ã€‚å®ç°æ–¹å¼æ˜¯åŠ å…¥äº† exchange (äº¤æ¢æœº)</p>\n<blockquote>\n<p>ä¸Šé¢å­¦ä¹ äº† RabbitMQ çš„ä¸¤ä¸ªæ¡ˆä¾‹ä¸€ä¸ªæ˜¯ç®€å•é˜Ÿåˆ—æ¡ˆä¾‹å¦ä¸€ä¸ªæ˜¯ WorkQueue æ¡ˆä¾‹ï¼Œè¿™ä¸¤ä¸ªæ¡ˆä¾‹æœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹å°±æ˜¯ï¼Œæ‰€å‘å‡ºçš„æ¶ˆæ¯åªå¯èƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ã€‚å› ä¸ºä¸€æ—¦æ¶ˆè´¹å®Œå°±ä¼šä»é˜Ÿåˆ—ä¸­åˆ é™¤è€Œè¿™ä¸€ç‰¹ç‚¹å°±æ— æ³•æ»¡è¶³ä¸€ä¸ªéœ€æ±‚æ¯”å¦‚ä»¥å‰è¯´çš„ æ”¯ä»˜æœåŠ¡å‘å¸ƒçš„æ¶ˆæ¯è¦è¢«ï¼Œè®¢å•æœåŠ¡ï¼Œä»“å‚¨æœåŠ¡ï¼ŒçŸ­ä¿¡æœåŠ¡ã€‚è¿™ä¸‰ä¸ªæœåŠ¡å„è‡ªå»å®Œæˆè‡ªå·±çš„ä¸šåŠ¡ï¼Œä¹Ÿå°±æ˜¯è¯´å‘å¸ƒçš„è¿™æ¡ç”¨æˆ·æ”¯ä»˜æˆåŠŸçš„æ¶ˆæ¯è¦è¢«ä¸‰ä¸ªæœåŠ¡éƒ½æ¥æ”¶åˆ°ã€‚</p>\n<p>è¿™æ—¶å°±éœ€è¦ç”¨åˆ°è¿™ç« çš„çŸ¥è¯†äº†</p>\n</blockquote>\n<p>&lt;center&gt; æ¨¡å‹ç»“æ„ &lt;/center&gt;</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111042266.png\" alt=\"image-20231011104256966\" /></p>\n<p><strong>å¸¸è§ exchange ç±»å‹åŒ…æ‹¬</strong>ï¼š</p>\n<ul>\n<li>Fanoutï¼šå¹¿æ’­</li>\n<li>Directï¼šè·¯ç”±</li>\n<li>Topicï¼šè¯é¢˜</li>\n</ul>\n<p>&lt;font color='red'&gt; æ³¨æ„ &lt;/font&gt;ï¼šexchange è´Ÿè´£æ¶ˆæ¯è·¯ç”±ï¼Œè€Œä¸æ˜¯å­˜å‚¨ï¼Œè·¯ç”±å¤±è´¥åˆ™æ¶ˆæ¯ä¸¢å¤±</p>\n<h5 id=\"8171-å‘å¸ƒè®¢é˜…-fanout-exchange\"><a class=\"anchor\" href=\"#8171-å‘å¸ƒè®¢é˜…-fanout-exchange\">#</a> 8.1.7.1ã€å‘å¸ƒè®¢é˜… - Fanout ExchangeğŸŒ´</h5>\n<p>Fanout Exchange ä¼šå°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯è·¯ç”±åˆ°æ¯ä¸€ä¸ªè·Ÿå…¶ç»‘å®šçš„ queue</p>\n<blockquote>\n<p>å°±åƒæ··ç¤¾ä¼šçš„ç¤¾ä¼šäººä¸€æ ·ï¼Œåé¢ä¸¤ä¸ª consumer è·Ÿç€ publisher æ··ï¼Œåªè¦è·Ÿç€ publisher æ··é‚£ä»€ä¹ˆé’±å•Šä»€ä¹ˆçš„éƒ½ä¸ç”¨å‘æ„</p>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111051241.gif\" alt=\"test\" /></p>\n<h5 id=\"8172-åˆ©ç”¨springamqpæ¼”ç¤ºfanoutexchangeçš„ä½¿ç”¨\"><a class=\"anchor\" href=\"#8172-åˆ©ç”¨springamqpæ¼”ç¤ºfanoutexchangeçš„ä½¿ç”¨\">#</a> 8.1.7.2ã€åˆ©ç”¨ SpringAMQP æ¼”ç¤º FanoutExchange çš„ä½¿ç”¨ğŸŒ´</h5>\n<p>å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p>\n<p>1ã€åœ¨ consumer æœåŠ¡ä¸­ï¼Œåˆ©ç”¨ä»£ç å£°æ˜é˜Ÿåˆ—ï¼Œäº¤æ¢æœºï¼Œå¹¶å°†ä¸¤è€…ç»‘å®š</p>\n<p>2ã€åœ¨ consumer æœåŠ¡ä¸­ï¼Œç¼–å†™ä¸¤ä¸ªæ¶ˆè´¹è€…æ–¹æ³•ï¼Œåˆ†åˆ«ç›‘å¬ fanout.queue1 å’Œ fanout.queue2</p>\n<p>3ã€åœ¨ publisher ä¸­ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼Œå‘ itcast.fanout å‘é€æ¶ˆæ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111110248.png\" alt=\"image-20231011111040177\" /></p>\n<p><strong>æ­¥éª¤</strong>ï¼š</p>\n<p>1ã€åœ¨ consumer æœåŠ¡å£°æ˜ Exchangeï¼ŒQueueï¼ŒBinding</p>\n<p>SpringAMQP æä¾›äº†å£°æ˜äº¤æ¢æœºï¼Œé˜Ÿåˆ—ï¼Œç»‘å®šå…³ç³»çš„ APIï¼Œä¾‹å¦‚ï¼š</p>\n<p>åœ¨ consumer æœåŠ¡åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œæ·»åŠ  @Configuration æ³¨è§£ï¼Œå¹¶å£°æ˜ FanoutExchangeï¼ŒQueue å’Œç»‘å®šå…³ç³»å¯¹è±¡ Bindingï¼Œä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Binding</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">BindingBuilder</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FanoutExchange</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Queue</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Bean</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * @2023/10/1111:17</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @function</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @comment</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FanoutConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">// itcast.fanout</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">FanoutExchange</span> <span class=\"token function\">fanoutExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FanoutExchange</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"itcast.fanout\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">// fanout.queue1</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">fanoutQueue1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fanout.queue1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token comment\">// ç»‘å®šé˜Ÿåˆ— 1 åˆ°äº¤æ¢æœº</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">fanoutBinding</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Queue</span> fanoutQueue1<span class=\"token punctuation\">,</span> <span class=\"token class-name\">FanoutExchange</span> fanoutExchange<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">BindingBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>fanoutQueue1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">(</span>fanoutExchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token comment\">// fanout.queue2</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">fanoutQueue2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fanout.queue2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token comment\">// ç»‘å®šé˜Ÿåˆ— 2 åˆ°äº¤æ¢æœº</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">fanoutBinding1</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Queue</span> fanoutQueue2<span class=\"token punctuation\">,</span> <span class=\"token class-name\">FanoutExchange</span> fanoutExchange<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">BindingBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>fanoutQueue2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">(</span>fanoutExchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>2ã€åœ¨ consumer æœåŠ¡å£°æ˜ä¸¤ä¸ªæ¶ˆè´¹è€…</p>\n<p>åœ¨ consumer æœåŠ¡çš„ SpringRabbitListener ç±»ä¸­ï¼Œæ·»åŠ ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«ç›‘å¬ fanout.queue1 å’Œ fanout.queue2</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>rabbit<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RabbitListener</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Component</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * @2023/10/119:34</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * @function</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * @comment</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SpringRabbitListener</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> <span class=\"token string\">\"fanout.queue1\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">listenerFanoutQueue1</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆè´¹è€…æ¥æ”¶åˆ°fanout.queue1çš„æ¶ˆæ¯ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> <span class=\"token string\">\"fanout.queue2\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">listenerFanoutQueue2</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆè´¹è€…æ¥æ”¶åˆ°fanout.queue2çš„æ¶ˆæ¯ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>3ã€åœ¨ publisher æœåŠ¡å‘é€æ¶ˆæ¯åˆ° FanoutExchange</p>\n<p>åœ¨ publisher æœåŠ¡çš„ SpringAmqpTest ç±»ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testFanoutExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// äº¤æ¢æœºåç§°</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">String</span> exchangeName <span class=\"token operator\">=</span> <span class=\"token string\">\"itcast.fanout\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token class-name\">String</span> message <span class=\"token operator\">=</span> <span class=\"token string\">\"hello , every one\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// å‘é€æ¶ˆæ¯ï¼Œå‚æ•°åˆ†åˆ«æ˜¯ï¼šäº¤äº’æœºåç§°ï¼ŒRoutingkey (æš‚æ—¶ä¸ºç©º)ï¼Œæ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchangeName<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨æ¶ˆè´¹è€…çš„å¯åŠ¨ç±»ï¼Œç„¶åå¯åŠ¨å‘å¸ƒè€…çš„ test å‡½æ•°è¿›è¡Œæµ‹è¯•</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111142286.png\" alt=\"image-20231011114245056\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>äº¤æ¢æœºçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>æ¥æ”¶ publisher å‘é€çš„æ¶ˆæ¯</li>\n<li>å°†æ¶ˆæ¯æŒ‰ç…§è·¯ç”±è§„åˆ™è·¯ç”±åˆ°ä¸ä¹‹ç»‘å®šçš„é˜Ÿåˆ—</li>\n<li>ä¸èƒ½ç¼“å­˜æ¶ˆæ¯ï¼Œè·¯ç”±å¤±è´¥ï¼Œæ¶ˆæ¯ä¸¢å¤±</li>\n<li>FanoutExchange çš„ä¼šå°†æ¶ˆæ¯è·¯ç”±åˆ°æ¯ä¸ªç»‘å®šçš„é˜Ÿåˆ—</li>\n</ul>\n<p>å£°æ˜é˜Ÿåˆ—ï¼Œäº¤æ¢æœºï¼Œç»‘å®šå…³ç³»çš„ Bean æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>Queue</li>\n<li>FanoutExchange</li>\n<li>Binding</li>\n</ul>\n</blockquote>\n<h4 id=\"818-å‘å¸ƒè®¢é˜…-directexchange\"><a class=\"anchor\" href=\"#818-å‘å¸ƒè®¢é˜…-directexchange\">#</a> 8.1.8ã€å‘å¸ƒè®¢é˜… - DirectExchangeğŸŒ²</h4>\n<p>DirectExchange ä¼šå°†æ¥æ”¶çš„æ¶ˆæ¯æ ¹æ®<mark>è§„åˆ™è·¯ç”±åˆ°æŒ‡å®šçš„ Queue</mark>ï¼Œå› æ­¤ç§°ä¸ºè·¯ç”±æ¨¡å¼ (routers)ã€‚</p>\n<p><strong>è§„åˆ™</strong>ï¼š</p>\n<ul>\n<li>æ¯ä¸€ä¸ª Queue éƒ½ä¸ Exchange è®¾ç½®ä¸€ä¸ª BindingKeyï¼Œå°†æ¥åˆ©ç”¨æš—å·è¿›è¡Œé€šä¿¡ï¼Œå¯ä»¥æœ‰å¤šä¸ª Key</li>\n<li>å‘å¸ƒè€…å‘é€æ¶ˆæ¯æ—¶ï¼ŒæŒ‡å®šæ¶ˆæ¯çš„ RoutingKey</li>\n<li>Exchange å°†æ¶ˆæ¯è·¯ç”±åˆ° BindingKey ä¸æ¶ˆæ¯ RoutingKey ä¸€è‡´çš„é˜Ÿåˆ—</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111152624.png\" alt=\"image-20231011115208085\" /></p>\n<h5 id=\"8181-åˆ©ç”¨springamqpæ¼”ç¤ºdirectexchangeçš„ä½¿ç”¨\"><a class=\"anchor\" href=\"#8181-åˆ©ç”¨springamqpæ¼”ç¤ºdirectexchangeçš„ä½¿ç”¨\">#</a> 8.1.8.1ã€åˆ©ç”¨ SpringAMQP æ¼”ç¤º DirectExchange çš„ä½¿ç”¨ğŸŒ´</h5>\n<p><strong>å®ç°æ€è·¯å¦‚ä¸‹</strong>ï¼š</p>\n<p>1ã€åˆ©ç”¨ @RabbitListener å£°æ˜ Exchangeï¼ŒQueueï¼ŒRoutingKey</p>\n<p>2ã€åœ¨ consumer æœåŠ¡ä¸­ï¼Œç¼–å†™ä¸¤ä¸ªæ¶ˆè´¹è€…æ–¹æ³•ï¼Œåˆ†åˆ«ç›‘å¬ direct.queue1 å’Œ direct.queue2</p>\n<p>3ã€åœ¨ publisher ä¸­ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼Œå‘ itcast.direct å‘é€æ¶ˆæ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111158674.png\" alt=\"image-20231011115803693\" /></p>\n<p>æ­¥éª¤ï¼š</p>\n<p>1ã€åˆ©ç”¨ @RabbitListener å£°æ˜ Exchangeï¼ŒQueueï¼ŒRoutingKey</p>\n<p>2ã€åœ¨ consumer æœåŠ¡ä¸­ï¼Œç¼–å†™ä¸¤ä¸ªæ¶ˆè´¹è€…æ–¹æ³•ï¼Œåˆ†åˆ«ç›‘å¬ direct.queue1 å’Œ direct.queue2</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>bindings <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@QueueBinding</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token comment\">// å£°æ˜é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   value <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Queue</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"direct.queue1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// å£°æ˜äº¤æ¢æœº</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   exchange <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Exchange</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"itcast.direct\"</span><span class=\"token punctuation\">,</span> type <span class=\"token operator\">=</span> <span class=\"token class-name\">ExchangeTypes</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DIRECT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// ç»‘å®š key</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   key <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"red\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"blue\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">listenDirectQueue1</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆè´¹è€…æ¥æ”¶åˆ°direct.queue1çš„æ¶ˆæ¯ï¼š[\"</span> <span class=\"token operator\">+</span> msg <span class=\"token operator\">+</span> <span class=\"token string\">\"]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>bindings <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@QueueBinding</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token comment\">// å£°æ˜é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   value <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Queue</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"direct.queue1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token comment\">// å£°æ˜äº¤æ¢æœº</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   exchange <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Exchange</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"itcast.direct\"</span><span class=\"token punctuation\">,</span> type <span class=\"token operator\">=</span> <span class=\"token class-name\">ExchangeTypes</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DIRECT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token comment\">// ç»‘å®š key</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   key <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"red\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"yellow\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">listenDirectQueue2</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆè´¹è€…æ¥æ”¶åˆ°direct.queue2çš„æ¶ˆæ¯ï¼š[\"</span> <span class=\"token operator\">+</span> msg <span class=\"token operator\">+</span> <span class=\"token string\">\"]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡çœ‹ä¸‹ rabbitmq-ui ç®¡ç†é¡µé¢</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111347685.png\" alt=\"image-20231011134749247\" /></p>\n<p>3ã€åœ¨ publisher ä¸­ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼Œå‘ itcast.direct å‘é€æ¶ˆæ¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testDirectExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// äº¤æ¢æœºåç§°</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">String</span> exchangeName <span class=\"token operator\">=</span> <span class=\"token string\">\"itcast.direct\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token class-name\">String</span> message <span class=\"token operator\">=</span> <span class=\"token string\">\"hello , blue\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token comment\">// å‘é€æ¶ˆæ¯ï¼Œå°†æ¶ˆæ¯å‘é€ç»™ key ä¸º blue çš„ Queue</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchangeName<span class=\"token punctuation\">,</span> <span class=\"token string\">\"blue\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">//------------------ æ‰“å°ç»“æœ ------------------</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>æ¶ˆè´¹è€…æ¥æ”¶åˆ°direct<span class=\"token punctuation\">.</span>queue1çš„æ¶ˆæ¯ï¼š<span class=\"token punctuation\">[</span>hello <span class=\"token punctuation\">,</span> blue<span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>å°†ç»‘å®šçš„ key æ”¹ä¸º yellow å‘¢ï¼Œè®°å¾—å°†å‘é€æ¶ˆæ¯æ”¹ä¸º â€œhello yellowâ€</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å‘é€æ¶ˆæ¯ï¼Œå°†æ¶ˆæ¯å‘é€ç»™ key ä¸º blue çš„ Queue</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchangeName<span class=\"token punctuation\">,</span> <span class=\"token string\">\"yellow\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//---------------- æ‰“å°ç»“æœ ----------------</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>æ¶ˆè´¹è€…æ¥æ”¶åˆ°direct<span class=\"token punctuation\">.</span>queue2çš„æ¶ˆæ¯ï¼š<span class=\"token punctuation\">[</span>hello <span class=\"token punctuation\">,</span> yellow<span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>å°†ç»‘å®šçš„ key æ”¹ä¸º red å‘¢ï¼Œè®°å¾—å°†å‘é€æ¶ˆæ¯æ”¹ä¸º â€œhello redâ€</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å‘é€æ¶ˆæ¯ï¼Œå°†æ¶ˆæ¯å‘é€ç»™ key ä¸º blue çš„ Queue</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchangeName<span class=\"token punctuation\">,</span> <span class=\"token string\">\"red\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>æ¶ˆè´¹è€…æ¥æ”¶åˆ°direct<span class=\"token punctuation\">.</span>queue2çš„æ¶ˆæ¯ï¼š<span class=\"token punctuation\">[</span>hello <span class=\"token punctuation\">,</span> red<span class=\"token punctuation\">]</span>æ¶ˆè´¹è€…æ¥æ”¶åˆ°direct<span class=\"token punctuation\">.</span>queue1çš„æ¶ˆæ¯ï¼š<span class=\"token punctuation\">[</span>hello <span class=\"token punctuation\">,</span> red<span class=\"token punctuation\">]</span></pre></td></tr></table></figure><blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>æè¿°ä¸‹ Direct äº¤æ¢æœºä¸ Fanout äº¤æ¢æœºçš„å·®å¼‚ï¼Ÿ</p>\n<ul>\n<li>Fanout äº¤æ¢æœºå°†æ¶ˆæ¯è·¯ç”±ç»™æ¯ä¸€ä¸ªä¸ä¹‹ç»‘å®šçš„é˜Ÿåˆ—</li>\n<li>Direct äº¤æ¢æœºæ ¹æ® RoutingKey åˆ¤æ–­è·¯ç”±ç»™å“ªä¸ªé˜Ÿåˆ—</li>\n<li>å¦‚æœå¤šä¸ªé˜Ÿåˆ—å…·æœ‰ç›¸åŒçš„ RoutingKeyï¼Œåˆ™ä¸ Fanout åŠŸèƒ½ç±»ä¼¼</li>\n</ul>\n<p>åŸºäº @RabbitListener æ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºæœ‰å“ªäº›å¸¸è§æ³¨è§£ï¼Ÿ</p>\n<ul>\n<li>@Queue</li>\n<li>Exchange</li>\n</ul>\n</blockquote>\n<h4 id=\"819-å‘å¸ƒè®¢é˜…-topicexchange\"><a class=\"anchor\" href=\"#819-å‘å¸ƒè®¢é˜…-topicexchange\">#</a> 8.1.9ã€å‘å¸ƒè®¢é˜… - TopicExchangeğŸŒ²</h4>\n<p>TopicExchange ä¸ DirectExchange ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äº routingKey å¿…é¡»æ˜¯å¤šä¸ªå•è¯çš„åˆ—è¡¨ï¼Œå¹¶ä¸”ä»¥ ã€‚ åˆ†å‰²ã€‚</p>\n<p>Queue ä¸ Exchange æŒ‡å®š BindingKey æ—¶å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼š</p>\n<p><code>#</code> ï¼šä»£æŒ‡ 0 ä¸ªæˆ–å¤šä¸ªå•è¯</p>\n<p><code>*</code> ï¼šä»£æŒ‡ä¸€ä¸ªå•è¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111449230.png\" alt=\"image-20231011144903570\" /></p>\n<h5 id=\"8191-åˆ©ç”¨springamqpæ¼”ç¤ºtopicexchangeçš„ä½¿ç”¨\"><a class=\"anchor\" href=\"#8191-åˆ©ç”¨springamqpæ¼”ç¤ºtopicexchangeçš„ä½¿ç”¨\">#</a> 8.1.9.1ã€åˆ©ç”¨ SpringAMQP æ¼”ç¤º TopicExchange çš„ä½¿ç”¨ğŸŒ´</h5>\n<p>å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p>\n<p>1ã€åˆ©ç”¨ @RabbitListener å£°æ˜ Exchangeï¼ŒQueueï¼ŒRoutingKey</p>\n<p>2ã€åœ¨ consumer æœåŠ¡ä¸­ï¼Œç¼–å†™ä¸¤ä¸ªæ¶ˆè´¹è€…æ–¹æ³•ï¼Œåˆ†åˆ«ç›‘å¬ topic.queue1 å’Œ topic.queue2</p>\n<p>3ã€åœ¨ publisher ä¸­ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼Œå‘ itcast.topic å‘é€æ¶ˆæ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111452582.png\" alt=\"image-20231011145232937\" /></p>\n<p>æ­¥éª¤ï¼š</p>\n<p>1ã€åˆ©ç”¨ @RabbitListener å£°æ˜ Exchangeï¼ŒQueueï¼ŒRoutingKey</p>\n<p>2ã€åœ¨ consumer æœåŠ¡ä¸­ï¼Œç¼–å†™ä¸¤ä¸ªæ¶ˆè´¹è€…æ–¹æ³•ï¼Œåˆ†åˆ«ç›‘å¬ topic.queue1 å’Œ topic.queue2</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ExchangeTypes</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>rabbit<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Exchange</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>rabbit<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Queue</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>rabbit<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">QueueBinding</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>rabbit<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RabbitListener</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Component</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * @2023/10/119:34</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @function</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @comment</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SpringRabbitListener</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>bindings <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@QueueBinding</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            value <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Queue</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"topic.queue1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            exchange <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Exchange</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"itcast.topic\"</span><span class=\"token punctuation\">,</span> type <span class=\"token operator\">=</span> <span class=\"token class-name\">ExchangeTypes</span><span class=\"token punctuation\">.</span><span class=\"token constant\">TOPIC</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            key <span class=\"token operator\">=</span> <span class=\"token string\">\"china.#\"</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">listenTopicQueue1</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆè´¹è€…æ¥æ”¶åˆ°topic.queue1çš„æ¶ˆæ¯ï¼š[\"</span> <span class=\"token operator\">+</span> msg <span class=\"token operator\">+</span> <span class=\"token string\">\"]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>bindings <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@QueueBinding</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            value <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Queue</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"topic.queue2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            exchange <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Exchange</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"itcast.topic\"</span><span class=\"token punctuation\">,</span> type <span class=\"token operator\">=</span> <span class=\"token class-name\">ExchangeTypes</span><span class=\"token punctuation\">.</span><span class=\"token constant\">TOPIC</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            key <span class=\"token operator\">=</span> <span class=\"token string\">\"#.news\"</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">listenTopicQueue2</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆè´¹è€…æ¥æ”¶åˆ°topic.queue2çš„æ¶ˆæ¯ï¼š[\"</span> <span class=\"token operator\">+</span> msg <span class=\"token operator\">+</span> <span class=\"token string\">\"]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>3ã€åœ¨ publisher ä¸­ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼Œå‘ itcast.topic å‘é€æ¶ˆæ¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testSendTopicExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">String</span> exchangeName <span class=\"token operator\">=</span> <span class=\"token string\">\"itcast.topic\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token class-name\">String</span> message <span class=\"token operator\">=</span> <span class=\"token string\">\"éƒ­æ˜ç„¶ä¸Šå¸‚äº†ä¸è¦888ä¸è¦999åªè¦9.9å°±èƒ½å¸¦å›å®¶\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchangeName<span class=\"token punctuation\">,</span> <span class=\"token string\">\"china.news\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">//-------------------------- æ‰“å°ç»“æœ --------------------------</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>æ¶ˆè´¹è€…æ¥æ”¶åˆ°topic<span class=\"token punctuation\">.</span>queue2çš„æ¶ˆæ¯ï¼š<span class=\"token punctuation\">[</span>éƒ­æ˜ç„¶ä¸Šå¸‚äº†ä¸è¦<span class=\"token number\">888</span>ä¸è¦<span class=\"token number\">999</span>åªè¦<span class=\"token number\">9.9</span>å°±èƒ½å¸¦å›å®¶<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>æ¶ˆè´¹è€…æ¥æ”¶åˆ°topic<span class=\"token punctuation\">.</span>queue1çš„æ¶ˆæ¯ï¼š<span class=\"token punctuation\">[</span>éƒ­æ˜ç„¶ä¸Šå¸‚äº†ä¸è¦<span class=\"token number\">888</span>ä¸è¦<span class=\"token number\">999</span>åªè¦<span class=\"token number\">9.9</span>å°±èƒ½å¸¦å›å®¶<span class=\"token punctuation\">]</span></pre></td></tr></table></figure><blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>æè¿°ä¸‹ Direct äº¤æ¢æœºä¸ Topic äº¤æ¢æœºçš„å·®å¼‚ï¼Ÿ</p>\n<ul>\n<li>Topic äº¤æ¢æœºæ”¯æŒé€šé…ç¬¦ï¼Œä¸æ”¯æŒå¤šä¸ª key</li>\n<li>bindingKeyï¼šé€šé…ç¬¦ï¼Œroutingkeyï¼šå¤šä¸ªå•è¯</li>\n<li>#ï¼š0 ä¸ªæˆ–å¤šä¸ª</li>\n<li>*ï¼šä¸€ä¸ª</li>\n</ul>\n</blockquote>\n<h4 id=\"8110-æµ‹è¯•å‘é€objectç±»å‹æ¶ˆæ¯\"><a class=\"anchor\" href=\"#8110-æµ‹è¯•å‘é€objectç±»å‹æ¶ˆæ¯\">#</a> 8.1.10ã€æµ‹è¯•å‘é€ Object ç±»å‹æ¶ˆæ¯ğŸŒ²</h4>\n<p><strong>è¯´æ˜</strong>ï¼šåœ¨ SpringAMQP çš„å‘é€æ–¹æ³•ä¸­ï¼Œæ¥æ”¶æ¶ˆæ¯çš„ç±»å‹æ˜¯ Objectï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥å‘é€ä»»æ„å¯¹è±¡ç±»å‹çš„æ¶ˆæ¯ï¼ŒSpringAMQP ä¼šå¸®æˆ‘ä»¬åºåˆ—åŒ–ä¸ºå­—èŠ‚åå‘é€</p>\n<p>å¯ä»¥çœ‹åˆ°å‡½æ•°å‚æ•°éƒ½æ˜¯ Object ç±»å‹çš„ï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºå¯ä»¥ä¼ é€’ä»»æ„ç±»å‹çš„ java å¯¹è±¡è¿›å»äº†å—ï¼Ÿ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111554481.png\" alt=\"image-20231011155439361\" /></p>\n<p>åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—</p>\n<p>æˆ‘ä»¬åœ¨ consumer ä¸­åˆ©ç”¨ @Bean å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Queue</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Bean</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * @2023/10/1111:17</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * @function</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * @comment</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FanoutConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">objectQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"object.queue\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æŸ¥çœ‹ rabbitmq çš„ ui ç®¡ç†é¡µé¢</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111602511.png\" alt=\"image-20231011160243062\" /></p>\n<p>åœ¨ publisher ä¸­å‘é€æ¶ˆæ¯ä»¥æµ‹è¯•ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testSendObjectQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> map <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   map<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"åˆ˜æ¡‘\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   map<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"age\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">18</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"object.queue\"</span><span class=\"token punctuation\">,</span> map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æŸ¥çœ‹æ¶ˆæ¯å‘é€çš„è¯¦ç»†ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111611580.png\" alt=\"image-20231011161154919\" /></p>\n<h5 id=\"81101-æ¶ˆæ¯è½¬æ¢å™¨\"><a class=\"anchor\" href=\"#81101-æ¶ˆæ¯è½¬æ¢å™¨\">#</a> 8.1.10.1ã€æ¶ˆæ¯è½¬æ¢å™¨ğŸŒ´</h5>\n<p>Spring åœ¨å¯¹æ¶ˆæ¯å¯¹è±¡çš„å¤„ç†æ˜¯ç”± org.springframework.amqp.support.converter.MessageConverter æ¥å¤„ç†çš„ã€‚è€Œé»˜è®¤å®ç°æ˜¯ SimpleMessageConverterï¼ŒåŸºäº JDK çš„ ObjectOutputStream å®Œæˆåºåˆ—åŒ–ã€‚</p>\n<p>å¦‚æœè¦ä¿®æ”¹åªéœ€è¦å®šä¹‰ä¸€ä¸ª MessageConverter ç±»å‹çš„ Bean å³å¯ã€‚æ¨èç”¨ JSON æ–¹å¼åºåˆ—åŒ–ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<p>1ã€æˆ‘ä»¬åœ¨ publisher æœåŠ¡å¼•å…¥ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.fasterxml.jackson.core<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>jackson-databind<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>2ã€æˆ‘ä»¬åœ¨ publisher æœåŠ¡å¯åŠ¨ç±»ä¸­å£°æ˜ MessageConverter</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>support<span class=\"token punctuation\">.</span>converter<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Jackson2JsonMessageConverter</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>support<span class=\"token punctuation\">.</span>converter<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MessageConverter</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SpringApplication</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>autoconfigure<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SpringBootApplication</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Bean</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootApplication</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PublisherApplication</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PublisherApplication</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MessageConverter</span> <span class=\"token function\">messageConverter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Jackson2JsonMessageConverter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ¸…ç©ºä¹‹å‰çš„é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111643872.png\" alt=\"image-20231011164323272\" /></p>\n<p>å†æ¬¡è¿è¡Œæµ‹è¯•å‡½æ•°ï¼Œç„¶åæŸ¥çœ‹ RabbitMQ ä¸­çš„æ¶ˆæ¯è¯¦ç»†æƒ…å†µ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111644952.png\" alt=\"image-20231011164413896\" /></p>\n<p>æ¶ˆæ¯å‘é€çš„æ—¶å€™æŠŠå¯¹è±¡åºåˆ—åŒ–ä¸º JSONï¼Œæ¥æ”¶æ—¶åè¿‡æ¥ååºåˆ—åŒ–ä¸ºå¯¹è±¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111644991.png\" alt=\"image-20231011164436624\" /></p>\n<p>3ã€æ¶ˆè´¹è€…æ¥å—æ¶ˆæ¯</p>\n<p>æˆ‘ä»¬éœ€è¦å†æ¶ˆè´¹è€…é‡Œé¢ä¹ŸåŠ ä¸Š MessageConverter è¿›è¡Œååºåˆ—åŒ–ã€‚å¦åˆ™å–æ¶ˆæ¯å°±ä¼šæŠ¥é”™</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>support<span class=\"token punctuation\">.</span>converter<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Jackson2JsonMessageConverter</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>support<span class=\"token punctuation\">.</span>converter<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MessageConverter</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Bean</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * @2023/10/1117:31</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * @function</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * @comment</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RabbitMQConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MessageConverter</span> <span class=\"token function\">messageConverter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Jackson2JsonMessageConverter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨æ¶ˆè´¹è€…å¯åŠ¨ç±»ï¼Œå¯åŠ¨ç”Ÿäº§è€…çš„æµ‹è¯•å‡½æ•°æŸ¥çœ‹ç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111736739.png\" alt=\"image-20231011173617788\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>:</p>\n<p>SpringAMQP ä¸­æ¶ˆæ¯çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</p>\n<ul>\n<li>åˆ©ç”¨ MessageConverter å®ç°çš„ï¼Œé»˜è®¤æ˜¯ JDK çš„åºåˆ—åŒ–</li>\n<li>æ³¨æ„å‘é€ä¸æ¥æ”¶æ–¹å¿…é¡»ä½¿ç”¨ç›¸åŒçš„ MessageConverter</li>\n</ul>\n</blockquote>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "RabbitMQ",
                "è®¡ç®—æœºå­¦ç§‘",
                "springcloud",
                "RabbitMQ"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Docker/springcloud-docker/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Docker/springcloud-docker/",
            "title": "ä¸ƒã€Docker",
            "date_published": "2024-01-06T02:17:57.755Z",
            "content_html": "<h2 id=\"ä¸ƒ-docker\"><a class=\"anchor\" href=\"#ä¸ƒ-docker\">#</a> ä¸ƒã€DockerğŸ„</h2>\n<p>æŸ¥çœ‹ docker å®‰è£…ï¼š<a href=\"./Docker/Centos7%E5%AE%89%E8%A3%85Docker.md\">Docker å®‰è£…</a>.</p>\n<ul>\n<li>åˆå§‹ Docker</li>\n<li>Docker çš„åŸºæœ¬æ“ä½œ</li>\n<li>Dockerfile è‡ªå®šä¹‰é•œåƒ</li>\n<li>Docker-Compose</li>\n<li>Docker é•œåƒæœåŠ¡</li>\n</ul>\n<h3 id=\"71-åˆå§‹docker\"><a class=\"anchor\" href=\"#71-åˆå§‹docker\">#</a> 7.1ã€åˆå§‹ DockerğŸŒ³</h3>\n<ul>\n<li>ä»€ä¹ˆæ˜¯ Docker</li>\n<li>Docker å’Œè™šæ‹Ÿæœºçš„åŒºåˆ«</li>\n<li>Docker æ¶æ„</li>\n<li>å®‰è£… Docker</li>\n</ul>\n<blockquote>\n<p>é¡¹ç›®éƒ¨ç½²çš„é—®é¢˜</p>\n<ul>\n<li>ä¾èµ–å…³ç³»å¤æ‚ï¼Œå®¹æ˜“å‡ºç°å…¼å®¹æ€§é—®é¢˜</li>\n<li>å¼€å‘ï¼Œæµ‹è¯•ï¼Œç”Ÿäº§ç¯å¢ƒæœ‰å·®å¼‚</li>\n</ul>\n<p>å¤§å‹é¡¹ç›®ç»„ä»¶è¾ƒå¤šï¼Œè¿è¡Œç¯å¢ƒä¹Ÿè¾ƒä¸ºå¤æ‚ï¼Œéƒ¨ç½²æ—¶ä¼šç¢°åˆ°ä¸€äº›é—®é¢˜ï¼š</p>\n<p>æ‰€æœ‰çš„åº”è¯¥éƒ½ä¼šéƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œè€Œå¤§å¤šæ•°æœåŠ¡éƒ½ä¼šé‡‡ç”¨ Linux æ“ä½œç³»ç»Ÿï¼Œåœ¨å®‰è£…åˆ° Linux æ“ä½œç³»ç»Ÿä¹‹å‰è¦åšä¸€äº›å‡†å¤‡å·¥ä½œã€‚å› ä¸ºè¿™äº›åº”ç”¨éƒ½ä¼šæœ‰è‡ªå·±æ‰€éœ€è¦çš„ä¾èµ–å’Œå‡½æ•°åº“ã€‚è¿™æ—¶å¦‚æ­¤å¤æ‚çš„ä¾èµ–å…³ç³»å¾ˆå®¹æ˜“å‡ºç°ï¼Œå…¼å®¹æ€§é—®é¢˜ï¼ŒåºŸäº†åŠå¤©åŠ²æŠŠè¿™äº›é—®é¢˜éƒ½è§£å†³äº†ä½ ä¼šå‘ç°è¿™åªæ˜¯å¼€å§‹æå®šäº†å¼€å‘ç¯å¢ƒï¼Œè¿˜æœ‰æµ‹è¯•ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒï¼Œé¢„å‘ç¯å¢ƒç­‰ç­‰ã€‚æœ€å¯æ€•çš„æ˜¯è¿™äº›ç¯å¢ƒå®ƒä»¬çš„ Linux æ“ä½œç³»ç»Ÿæœ‰å¯èƒ½ä¸åŒ</p>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310080937247.png\" alt=\"image-20231008093734523\" /></p>\n<h4 id=\"711-dockerå¦‚ä½•è§£å†³ä¾èµ–çš„å…¼å®¹é—®é¢˜\"><a class=\"anchor\" href=\"#711-dockerå¦‚ä½•è§£å†³ä¾èµ–çš„å…¼å®¹é—®é¢˜\">#</a> 7.1.1ã€Docker å¦‚ä½•è§£å†³ä¾èµ–çš„å…¼å®¹é—®é¢˜ï¼ŸğŸŒ²</h4>\n<ul>\n<li>å°†åº”ç”¨çš„ Libs (å‡½æ•°åº“)ï¼ŒDeps (ä¾èµ–)ï¼Œé…ç½®ä¸åº”ç”¨ä¸€èµ·æ‰“åŒ…</li>\n<li>å°†æ¯ä¸ªåº”è¯¥æ”¾åˆ°ä¸€ä¸ªéš”ç¦»<strong>å®¹å™¨</strong>å»è¿è¡Œï¼Œé¿å…äº’ç›¸å¹²æ‰°</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310080942590.png\" alt=\"image-20231008094222259\" /></p>\n<p>ç°åœ¨ä¸ç”¨è€ƒè™‘ä¾èµ–çš„é—®é¢˜äº†ï¼Œä½†æ˜¯è¿™åªæ˜¯è§£å†³äº†æ··ä¹±ä¾èµ–çš„é—®é¢˜ã€‚æœ‰äº† Docker ä¸ç”¨å»ç®¡äº†åº”ç”¨ç¨‹åºéšæ—¶å¯ä»¥è¿è¡Œä½†æ˜¯ä»…é™äºåŒä¸€ä¸ªæ“ä½œç³»ç»Ÿã€‚å› ä¸ºåœ¨æ‰“åŒ…è¿™ä¸ªåº”ç”¨æ—¶è‚¯å®šä¼šåŸºäºæŸç§æ“ä½œç³»ç»Ÿæ‰“åŒ…å§ï¼Œæ¯”å¦‚è¿™ä¸ªåº”è¯¥æ˜¯ ubuntu ç‰ˆæœ¬çš„é‚£ä¹ˆå®ƒçš„å‡½æ•°åº“å’Œä¾èµ–è‚¯å®šä¹Ÿæ˜¯ ubuntu ç‰ˆæœ¬çš„ã€‚æŠŠè¿™ä¸ªæ‰“åŒ…å¥½çš„ç¨‹åºæ”¾åˆ° CentOs ä¸Šè‚¯å®šä¸èƒ½è¿è¡Œï¼Œé‚£ä¹ˆ Docker æ˜¯æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„å‘¢ï¼Ÿ</p>\n<p>è¦æƒ³çŸ¥é“ Docker å¦‚ä½•è·¨ç³»ç»Ÿè¿è¡Œï¼Œæˆ‘ä»¬å¾—å…ˆçŸ¥é“æ“ä½œç³»ç»Ÿçš„ç»“æ„</p>\n<h4 id=\"712-åŸºæœ¬äº†è§£æ“ä½œç³»ç»Ÿç»“æ„\"><a class=\"anchor\" href=\"#712-åŸºæœ¬äº†è§£æ“ä½œç³»ç»Ÿç»“æ„\">#</a> 7.1.2ã€åŸºæœ¬äº†è§£æ“ä½œç³»ç»Ÿç»“æ„ğŸŒ²</h4>\n<p>ä»¥ ubuntu ä¸ºä¾‹è®²è®²æ“ä½œç³»ç»Ÿç»“æ„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310080947687.png\" alt=\"image-20231008094755054\" /></p>\n<p>æ‰€æœ‰çš„ Linux æ“ä½œç³»ç»Ÿéƒ½å¯ä»¥åˆ†ä¸ºä¸¤å±‚ï¼š</p>\n<p>ä¸€å±‚æ˜¯å¤§å®¶å…±äº«çš„å†…æ ¸ (Linux å†…æ ¸)</p>\n<p>è€ŒåŒºåˆ«åœ¨äºä¸åŒæ“ä½œç³»ç»Ÿä¹‹é—´å®ƒä»¬çš„ä¸Šå±‚ç³»ç»Ÿåº”ç”¨ä¸åŒ</p>\n<blockquote>\n<p>é‚£å†…æ ¸åšä»€ä¹ˆçš„å‘¢ï¼Ÿ</p>\n<p>å†…æ ¸ä¸ç¡¬ä»¶äº¤äº’ï¼Œæä¾›æ“ä½œç¡¬ä»¶çš„æŒ‡ä»¤</p>\n</blockquote>\n<blockquote>\n<p>ç³»ç»Ÿåº”ç”¨åšä»€ä¹ˆçš„å‘¢ï¼Ÿ</p>\n<p>å°†å†…æ ¸çš„æŒ‡ä»¤è¿›è¡Œä¸€ä¸ªç»„è£…ï¼Œå†å°è£…å½¢æˆå‡½æ•°ï¼ŒåŒºåŸŸå¤šçš„å‡½æ•°å˜æˆå‡½æ•°åº“ï¼Œç¨‹åºå‘˜å¯ä»¥åŸºäºè¿™äº›å‡½æ•°åº“è¿›è¡Œå¼€å‘ã€‚ç¨‹åºè°ƒç”¨å‡½æ•°åº“ï¼Œå‡½æ•°åº“è°ƒç”¨å†…æ ¸æŒ‡ä»¤ï¼ŒæŒ‡ä»¤è°ƒç”¨è®¡ç®—æœºç¡¬ä»¶ä»è€Œå®ç°åº”ç”¨çš„æ‰§è¡Œ</p>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310080957223.png\" alt=\"image-20231008095659859\" /></p>\n<p>è¿™å°±æ˜¯ Linux ç³»ç»Ÿçš„åŸºæœ¬ç»“æ„ä»¥åŠåº”ç”¨çš„æ‰§è¡ŒåŸç†äº†</p>\n<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šä¸ºä»€ä¹ˆ Ubuntu ç³»ç»Ÿä¸Šçš„åº”ç”¨ä¸ºä»€ä¹ˆä¸èƒ½åœ¨ CentOs ä¸Šè¿è¡Œå‘¢ï¼Ÿ</p>\n<p>Ubuntu å’Œ CentOS éƒ½æ˜¯åŸºäº Linux å†…æ ¸ï¼Œåªæ˜¯ç³»ç»Ÿåº”ç”¨ä¸åŒï¼Œæä¾›çš„å‡½æ•°åº“æœ‰å·®å¼‚</p>\n<p>è¿™æ—¶æŠŠ Ubuntu ä¸Šçš„åº”ç”¨æ¯”å¦‚è¯´ mysql ç»™å®ƒè¿ç§»åˆ° CentOS ä¸Šå°è¯•å»æ‰§è¡Œå½“å®ƒå»è°ƒç”¨ä¸€ä¸ªå‡½æ•°åº“æ—¶ï¼Œå› ä¸ºä»£ç æ˜¯å†™æ­»çš„è€Œå‘ç°è¿™ä¸ªå‡½æ•°åº“åœ¨ centos ä¸Šæ ¹æœ¬ä¸å­˜åœ¨æˆ–è€…åå­—ä¸ä¸€æ ·é‚£ä¹ˆç¨‹åºå°±ä¼šæŠ¥é”™ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ åº”ç”¨ä¸èƒ½è·¨ç³»ç»Ÿè¿è¡Œçš„åŸå› </p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310080958994.png\" alt=\"image-20231008095848662\" /></p>\n<p>é‚£é’ˆå¯¹ä¸Šé¢çš„é—®é¢˜ Docker å¹²äº†ä»€ä¹ˆäº‹å„¿å‘¢ï¼Ÿ</p>\n<ul>\n<li>Docker å°†ç”¨æˆ·ç¨‹åºä¸æ‰€éœ€è¦è°ƒç”¨çš„ç³»ç»Ÿ (æ¯”å¦‚ Ubuntu) å‡½æ•°åº“ä¸€èµ·æ‰“åŒ…</li>\n<li>Docker è¿è¡Œåˆ°ä¸åŒæ“ä½œç³»ç»Ÿæ—¶ï¼Œç›´æ¥åŸºäºæ‰“åŒ…çš„åº“å‡½æ•°ï¼Œå€ŸåŠ©äºæ“ä½œç³»ç»Ÿçš„ Linux å†…æ ¸æ¥è¿è¡Œã€‚</li>\n</ul>\n<p>å°†å½“å‰ç³»ç»Ÿçš„å‡½æ•°åº“ä¸åº”ç”¨ä¸€èµ·æ‰“åŒ…é‚£ä¹ˆéšä¾¿æ”¾åˆ°ä»»ä½•çš„ Linux æ“ä½œç³»ç»Ÿä¸Šåªè¦æ˜¯ Linux å†…æ ¸ï¼Œåº”ç”¨åœ¨æ‰§è¡Œçš„æ—¶å€™è°ƒç”¨æ‰“åŒ…å¥½çš„å‡½æ•°åº“ï¼Œè€Œè¿™ä¸ªå‡½æ•°åº“ç›´æ¥è°ƒç”¨æ“ä½œç³»ç»Ÿçš„å†…æ ¸è€Œå†…æ ¸ç›´æ¥è®¿é—®ç¡¬ä»¶è¿™ä¸ªè°ƒç”¨å°±å®Œæˆäº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081059529.png\" alt=\"image-20231008105934407\" /></p>\n<p>è‡³æ­¤ï¼ŒDocker å°±è§£å†³äº†è·¨ç³»ç»Ÿçš„é—®é¢˜äº†ï¼Œå¯ä»¥ç†è§£ä¸º Docker æ‰“åŒ…å¥½çš„åº”ç”¨å¯ä»¥è¿è¡Œåœ¨ä»»ä½•çš„ Linux å†…æ ¸çš„æ“ä½œç³»ç»Ÿä¸Š</p>\n<blockquote>\n<p><strong>Docker</strong>ï¼š</p>\n<p>Docker å¦‚ä½•è§£å†³å¤§å‹é¡¹ç›®ä»¥æ¥å…³ç³»å¤æ‚ï¼Œä¸åŒç»„ä»¶ä¾èµ–çš„å…¼å®¹æ€§é—®é¢˜ï¼Ÿ</p>\n<ul>\n<li>Docker å…è®¸å¼€å‘ä¸­å°†åº”ç”¨ï¼Œä¾èµ–ï¼Œå‡½æ•°åº“ï¼Œé…ç½®ä¸€èµ· &lt;font color='red'&gt; æ‰“åŒ… &lt;/font&gt;ï¼Œå½¢æˆå¯ç§»æ¤é•œåƒ</li>\n<li>Docker åº”ç”¨è¿è¡Œåœ¨å®¹å™¨ä¸­ï¼Œä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’ &lt;font color='red'&gt; éš”ç¦» &lt;/font&gt;.</li>\n</ul>\n<p>Docker å¦‚ä½•è§£å†³å¼€å‘ï¼Œæµ‹è¯•ï¼Œç”Ÿäº§ç¯å¢ƒæœ‰å·®å¼‚çš„é—®é¢˜</p>\n<ul>\n<li>Docker é•œåƒä¸­åŒ…å«å®Œæ•´è¿è¡Œç¯å¢ƒï¼ŒåŒ…æ‹¬ç³»ç»Ÿå‡½æ•°åº“ï¼Œä»…ä¾èµ–ç³»ç»Ÿçš„ Linux å†…æ ¸ï¼Œå› æ­¤å¯ä»¥åœ¨ä»»æ„ Linux æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œ</li>\n</ul>\n</blockquote>\n<blockquote>\n<p>æ€»ç»“ï¼š</p>\n<p>Docker æ˜¯ä¸€ä¸ªå¿«é€Ÿäº¤ä»˜åº”ç”¨ï¼Œè¿è¡Œåº”ç”¨çš„æŠ€æœ¯ï¼š</p>\n<ol>\n<li>å¯ä»¥å°†ç¨‹åºåŠå…¶ä¾èµ–ï¼Œè¿è¡Œç¯å¢ƒä¸€èµ·æ‰“åŒ…ä¸ºä¸€ä¸ªé•œåƒï¼Œå¯ä»¥è¿ç§»åˆ°ä»»æ„ Linux æ“ä½œç³»ç»Ÿ</li>\n<li>è¿è¡Œæ—¶åˆ©ç”¨æ²™ç®±æœºåˆ¶å½¢æˆéš”ç¦»å®¹å™¨ï¼Œå„ä¸ªåº”ç”¨äº’ä¸å¹²æ‰°</li>\n<li>å¯åŠ¨ï¼Œç§»é™¤éƒ½å¯ä»¥é€šè¿‡ä¸€è¡Œå‘½ä»¤å®Œæˆï¼Œæ–¹ä¾¿å¿«æ·</li>\n</ol>\n</blockquote>\n<h3 id=\"72-dockerä¸è™šæ‹Ÿæœº\"><a class=\"anchor\" href=\"#72-dockerä¸è™šæ‹Ÿæœº\">#</a> 7.2ã€Docker ä¸è™šæ‹ŸæœºğŸŒ³</h3>\n<p>æˆ‘ä»¬çŸ¥é“ Docker å¯ä»¥å®ç°ä¸€ä¸ªåº”ç”¨å¯ä»¥åœ¨ä¸åŒçš„ Linux æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œå’Œéƒ¨ç½²ã€‚è€Œè™šæ‹Ÿæœºä¹Ÿå¯ä»¥è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœï¼Œé‚£å®ƒä»¬ä¸¤ä¸ªçš„å®ç°åˆæœ‰ä»€ä¹ˆæ ·çš„å·®åˆ«å‘¢</p>\n<p>é¦–å…ˆå›é¡¾ä¸‹ Docker çš„å®ç°åŸç†ï¼ŒDocker ä¼šæŠŠåº”ç”¨åŠå…¶æ‰€éœ€è¦çš„ä¾èµ–ï¼Œå‡½æ•°åº“ï¼Œç”šè‡³äºæ“ä½œç³»ç»Ÿå‡½æ•°åº“ä¹Ÿä¸€èµ·æ‰“åŒ…ï¼Œè¿™æ · å½“åº”ç”¨è¿è¡Œæ—¶å¯ä»¥ç›´æ¥è°ƒç”¨æœ¬åœ°å‡½æ•°åº“è€Œåä¸æ“ä½œç³»ç»Ÿçš„å†…æ ¸è¿›è¡Œäº¤äº’ã€‚è¿™æ ·å°±ä¸ç”¨å…³å¿ƒæ“ä½œç³»ç»Ÿæ˜¯ä»€ä¹ˆç³»ç»Ÿäº†ï¼Œäºæ˜¯å°±èƒ½å®ç°è·¨ç³»ç»Ÿè¿è¡Œäº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081112122.png\" alt=\"image-20231008111240399\" /></p>\n<p>é‚£è™šæ‹Ÿæœºå‘¢ï¼Ÿ</p>\n<p>å®ƒæ€ä¹ˆå®ç°åœ¨ä¸€ä¸ªç³»ç»Ÿé‡Œè£…äº†å¦ä¸€ä¸ªç³»ç»Ÿå‘¢ã€‚å®ƒæ˜¯ç”¨äº†ä¸€ä¸ªåä¸ºï¼šHyperisor çš„æŠ€æœ¯ï¼Œå¯ä»¥æ¨¡æ‹Ÿå‡ºä¸€ä¸ªè®¡ç®—æœºçš„å„ç§å„æ ·çš„ç¡¬ä»¶æ¯”å¦‚ CPUï¼Œå†…å­˜ç­‰ç­‰ï¼Œç„¶ååœ¨è¿™ä¸ªæ¨¡æ‹Ÿå‡ºçš„è®¡ç®—æœºä¸Šå°±å¯ä»¥å»å®‰è£…ä»»æ„ä½ æƒ³è¦çš„æ“ä½œç³»ç»Ÿäº†ï¼Œè€Œæ“ä½œç³»ç»Ÿåˆå¯ä»¥å®‰è£…ä»»æ„é€‚åˆçš„ä¾èµ–ï¼Œå‡½æ•°åº“ä»¥åŠåº”ç”¨ï¼Œé‚£è¿™æ ·å®ƒä¸å°±å®ç°è·¨ç³»ç»Ÿçš„éƒ¨ç½²äº†å—</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081116627.png\" alt=\"image-20231008111617105\" /></p>\n<p>è™šæ‹Ÿæœºæ˜¯åœ¨ä¸€ä¸ªç³»ç»Ÿé‡Œè£…äº†å¦å¤–ä¸€ä¸ªç³»ç»Ÿï¼Œæ‰€ä»¥å½“åº”ç”¨æ‰§è¡Œæ—¶ï¼Œå®ƒä¼šä»¥ä¸ºè‡ªå·±åœ¨ä¸€å°çœŸå®çš„ç”µè„‘ä¸Šã€‚å› æ­¤å®ƒä¼šå…ˆè°ƒç”¨è™šæ‹Ÿæœºå†…ç½®çš„æ“ä½œç³»ç»Ÿè€Œå®ƒåœ¨ä¸ Hypervisor è¿›è¡Œäº¤äº’ï¼Œç„¶åå†æŠŠä¿¡æ¯ä¼ é€’ç»™å¤–éƒ¨çš„æ“ä½œç³»ç»Ÿï¼Œå¤–éƒ¨æ“ä½œç³»ç»Ÿå†å»è°ƒç”¨è®¡ç®—æœºç¡¬ä»¶ï¼Œäºæ˜¯åº”ç”¨æ‰§è¡Œå°±å®Œæˆäº†ã€‚</p>\n<p>å¯ä»¥çœ‹åˆ°è™šæ‹Ÿæœºå¯åŠ¨åº”ç”¨ç»è¿‡äº†å±‚å±‚ä¼ é€’æ‰€ä»¥æ€§èƒ½æ˜¯æ¯”è¾ƒå·®çš„</p>\n<p>&lt;center&gt; ä¸¤è€…ä¹‹é—´çš„å·®å¼‚ &lt;/center&gt;</p>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th>Docker</th>\n<th>è™šæ‹Ÿæœº</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ€§èƒ½</td>\n<td>æ¥è¿‘åŸç”Ÿ</td>\n<td>æ€§èƒ½è¾ƒå·®</td>\n</tr>\n<tr>\n<td>ç¡¬ç›˜å ç”¨</td>\n<td>ä¸€èˆ¬ä¸º MB</td>\n<td>ä¸€èˆ¬ä¸º GB</td>\n</tr>\n<tr>\n<td>å¯åŠ¨</td>\n<td>ç§’çº§</td>\n<td>åˆ†é’Ÿçº§</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>Docker å’Œè™šæ‹Ÿæœºçš„å·®å¼‚ï¼š</p>\n<ul>\n<li>Docker æ˜¯ä¸€ä¸ªç³»ç»Ÿè¿›ç¨‹ï¼›è™šæ‹Ÿæœºæ˜¯åœ¨æ“ä½œç³»ç»Ÿä¸­çš„æ“ä½œç³»ç»Ÿ</li>\n<li>Docker ä½“ç§¯å°ï¼Œå¯åŠ¨é€Ÿåº¦å¿«ï¼Œæ€§èƒ½å¥½ï¼›è™šæ‹Ÿæœºä½“ç§¯å¤§ï¼Œå¯åŠ¨é€Ÿåº¦æ…¢ï¼Œæ€§èƒ½ä¸€èˆ¬</li>\n</ul>\n</blockquote>\n<h3 id=\"72-é•œåƒå’Œå®¹å™¨\"><a class=\"anchor\" href=\"#72-é•œåƒå’Œå®¹å™¨\">#</a> 7.2ã€é•œåƒå’Œå®¹å™¨ğŸŒ³</h3>\n<p><strong>é•œåƒ (Image)</strong>ï¼šDocker å°†åº”ç”¨ç¨‹åºåŠå…¶æ‰€éœ€çš„ä¾èµ–ï¼Œå‡½æ•°åº“ï¼Œç¯å¢ƒï¼Œé…ç½®ç­‰æ–‡ä»¶æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œç§°ä¸ºé•œåƒã€‚</p>\n<p>ç®€å•å¯ä»¥ç†è§£ä¸ºï¼Œé•œåƒå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081127213.png\" alt=\"image-20231008112658929\" /></p>\n<p><strong>å®¹å™¨ (Container)</strong>ï¼šé•œåƒä¸­çš„åº”ç”¨ç¨‹åºè¿è¡Œåå½¢æˆçš„è¿›ç¨‹å°±æ˜¯ &lt;font color='red'&gt; å®¹å™¨ &lt;/font&gt;ï¼Œåªæ˜¯ Docker ä¼šç»™å®¹å™¨åšéš”ç¦»ï¼Œå¯¹å¤–ä¸å¯è§ã€‚</p>\n<p>ç®€å•å¯ä»¥ç†è§£ä¸ºï¼ŒæŠŠè¿™ä¸ª mysql åº”ç”¨è¿è¡Œèµ·æ¥å½¢æˆçš„è¿™ä¸ªè¿›ç¨‹å°±æ˜¯å®¹å™¨ï¼Œåªä¸è¿‡åœ¨ Docker é‡Œé¢å®¹å™¨è¿˜è¦åšéš”ç¦»</p>\n<p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥å°†å®¹å™¨çœ‹åšæ˜¯ä¸€ä¸ªå°ç›’å­ï¼Œè¿™ä¸ªç›’å­é‡Œé¢å°†æ¥ä¼šåˆ©ç”¨ Linux æ‰‹æ®µç»™å®ƒå½¢æˆéš”ç¦»ç©ºé—´ã€‚é‡Œé¢ä¼šæœ‰è‡ªå·±ç‹¬ç«‹çš„ CPU èµ„æºï¼Œå†…å­˜èµ„æºï¼Œç”šè‡³äºè¿˜æœ‰ç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿã€‚é‚£ä¹ˆå› æ­¤åœ¨è¿™ä¸ªå®¹å™¨å†…è¿è¡Œçš„è¿™ä¸ªè¿›ç¨‹ï¼Œå®ƒå°±ä¼šä»¥ä¸ºè‡ªå·±æ˜¯åœ¨è¿™å°è®¡ç®—æœºä¸Šçš„å”¯ä¸€è¿›ç¨‹äº†ä»è€Œèµ·åˆ°ä¸€ç§éš”ç¦»çš„æ•ˆæœï¼Œå°†æ¥ mysql é•œåƒä¸ç®¡æ˜¯å¯åŠ¨ä¸€ä¸ªå®¹å™¨è¿˜æ˜¯å¤šä¸ªå®¹å™¨ï¼Œå®ƒä»¬ä¹‹é—´éƒ½æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œå½“å®¹å™¨è¿è¡Œçš„è¿‡ç¨‹ä¸­å¿…ç„¶ä¼šåšæ•°æ®è¯»å†™çš„æ“ä½œã€‚æ¯”æ–¹è¯´ mysql è¦å»å­˜æ•°æ®ï¼Œå­˜å‚¨åˆ° data ç›®å½•ä¸­ã€‚ä½†æ˜¯ä¸èƒ½å°†æ•°æ®å†™åˆ°é•œåƒçš„ data ç›®å½•ä¸­å»ã€‚é•œåƒéƒ½æ˜¯åªè¯»çš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081248648.png\" alt=\"image-20231008124821994\" /></p>\n<h3 id=\"73-å…±äº«é•œåƒ\"><a class=\"anchor\" href=\"#73-å…±äº«é•œåƒ\">#</a> 7.3ã€å…±äº«é•œåƒğŸŒ³</h3>\n<h4 id=\"731-dockerå’Œdockerhub\"><a class=\"anchor\" href=\"#731-dockerå’Œdockerhub\">#</a> 7.3.1ã€Docker å’Œ DockerHubğŸŒ²</h4>\n<ul>\n<li>DockerHubï¼šæ˜¯ä¸€ä¸ª Docker é•œåƒçš„æ‰˜ç®¡å¹³å°ã€‚è¿™æ ·çš„å¹³å°ç§°ä¸º Docker Registryã€‚</li>\n</ul>\n<p>ç¨‹åºå‘˜å¯ä»¥åˆ©ç”¨ Docker æä¾›çš„ä¸€äº›å‘½ä»¤å»å®Œæˆé•œåƒçš„æ„å»ºï¼Œæ„å»ºå‡º mysqlï¼Œredis ç­‰ç­‰å„ç§å„æ ·çš„é•œåƒ</p>\n<p>ç„¶åæŠŠè¿™äº›é•œåƒä¸Šä¼ åˆ° DockerHub æœåŠ¡å™¨ä¸Š</p>\n<ul>\n<li>å›½å†…ä¹Ÿæœ‰ç±»ä¼¼äº DockerHub çš„å…¬å¼€æœåŠ¡ï¼Œæ¯”å¦‚ ç½‘æ˜“äº‘é•œåƒæœåŠ¡ï¼Œé˜¿é‡Œäº‘é•œåƒåº“ç­‰ã€‚</li>\n<li>å¯ä»¥æ­å»ºç§æœ‰çš„äº‘æœåŠ¡</li>\n</ul>\n<p>è¿™äº›éƒ½å« Docker Registry</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081254620.png\" alt=\"image-20231008125404165\" /></p>\n<p>æˆ‘ä»¬è¦æ€ä¹ˆåˆ©ç”¨ Docker å®Œæˆé•œåƒæ„å»ºæˆ–è€…æ˜¯ä»è¿œç«¯æ‹‰å–é•œåƒå‘¢åˆè¯¥æ€ä¹ˆå»è¿è¡Œå®¹å™¨å‘¢ï¼Ÿ</p>\n<p>è¿™å°±éœ€è¦äº†è§£ Docker çš„æ¶æ„äº†</p>\n<h3 id=\"74-dockeræ¶æ„\"><a class=\"anchor\" href=\"#74-dockeræ¶æ„\">#</a> 7.4ã€Docker æ¶æ„ğŸŒ³</h3>\n<p>Docker æ˜¯ä¸€ä¸ª CS æ¶æ„çš„ç¨‹åºï¼Œç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p>\n<ul>\n<li>\n<p>æœåŠ¡ç«¯ (server)ï¼šDocker å®ˆæŠ¤è¿›ç¨‹ï¼Œè´Ÿè´£å¤„ç† Docker æŒ‡ä»¤ï¼Œç®¡ç†é•œåƒï¼Œå®¹å™¨ç­‰</p>\n<p>è´Ÿè´£æ¥æ”¶ç”¨æˆ·æŒ‡ä»¤å®Œæˆé•œåƒå’Œå®¹å™¨çš„å„ç§å„æ ·çš„æ“ä½œï¼Œä¸ç®¡æ˜¯æ„å»ºé•œåƒè¿˜æ˜¯ä»è¿œç«¯æ‹‰å–é•œåƒè¿˜æ˜¯è¿è¡Œå®¹å™¨éƒ½æ˜¯ç”± server ç«¯æ¥å®Œæˆçš„ ï¼Œé‚£è°ç»™ server ç«¯ä¸‹æŒ‡ä»¤å‘¢ï¼Ÿè‡ªç„¶å°±æ˜¯ client ç«¯äº†</p>\n</li>\n<li>\n<p>å®¢æˆ·ç«¯ (client)ï¼šé€šè¿‡å‘½ä»¤æˆ– RestAPI å‘ Docker æœåŠ¡ç«¯å‘é€æŒ‡ä»¤ã€‚å¯ä»¥åœ¨æœ¬åœ°æˆ–è¿œç¨‹å‘æœåŠ¡ç«¯å‘é€æŒ‡ä»¤ã€‚</p>\n<p>è¿™ä¸ªè¦çœ‹åœ¨å“ªå‘é€æŒ‡ä»¤ï¼Œå¦‚æœæ˜¯åœ¨ Docker æ‰€åœ¨çš„æœºå™¨ä¸Šå°±ç›´æ¥ç”¨å‘½ä»¤å°±å¯ä»¥äº†ã€‚å¦‚æœæ˜¯è¿œç¨‹æ“ä½œ Docker å°±ç”¨ RestAPI å‘</p>\n</li>\n</ul>\n<p>æ¯”æ–¹è¯´å°±æ˜¯æœ¬åœ°å‘é€šè¿‡å‘½ä»¤ï¼šdokcer build å¯ä»¥æ„å»ºé•œåƒï¼Œè¿™ä¸ªå‘½ä»¤åˆ°è¾¾ docker server åä¼šè¢« docker çš„å®ˆæŠ¤è¿›ç¨‹ docker daemon æ¥æ”¶å’Œå¤„ç†ã€‚å®ƒä¼šåˆ©ç”¨ä½ æä¾›çš„æ•°æ®æ„å»ºæˆä¸€ä¸ªé•œåƒã€‚é™¤äº†è¿™ç§æ–¹å¼è·å–é•œåƒä»¥å¤–æˆ‘ä»¬è¿˜å¯ä»¥å» docker registry ä¸­æ‹‰å–é•œåƒï¼Œä½¿ç”¨å‘½ä»¤ï¼šdocker pull è¿™ä¸ªå‘½ä»¤å‘é€åˆ° docker server ç«¯å docker daemon å°±ä¼šå» docker registry ä¸­æ‹‰å–æˆ‘ä»¬æŒ‡å®šçš„é•œåƒäº†ã€‚ä¸‹é¢å°±æ˜¯è¿è¡Œé•œåƒåˆ›å»ºå®¹å™¨äº†ï¼Œä½¿ç”¨å‘½ä»¤ï¼šdocker run è¿™ä¸ªå‘½ä»¤å‘é€åˆ° docker server ç«¯å docker daemon å°±ä¼šå»å¸®åŠ©æˆ‘ä»¬å®Œæˆå®¹å™¨çš„åˆ›å»ºï¼Œç„¶åéƒ¨ç½²å°±å®Œæˆäº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081307167.png\" alt=\"image-20231008130700555\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>é•œåƒï¼š</p>\n<ul>\n<li>å°†åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–ï¼Œç¯å¢ƒï¼Œé…ç½®æ‰“åŒ…åœ¨ä¸€èµ·</li>\n</ul>\n<p>å®¹å™¨ï¼š</p>\n<ul>\n<li>é•œåƒè¿è¡Œèµ·æ¥å°±æ˜¯å®¹å™¨ï¼Œä¸€ä¸ªé•œåƒå¯ä»¥è¿è¡Œå¤šä¸ªå®¹å™¨</li>\n</ul>\n<p>Docker ç»“æ„ï¼š</p>\n<ul>\n<li>æœåŠ¡ç«¯ï¼šæ¥æ”¶å‘½ä»¤æˆ–è¿œç¨‹è¯·æ±‚ï¼Œæ“ä½œé•œåƒæˆ–å®¹å™¨</li>\n<li>å®¢æˆ·ç«¯ï¼šå‘é€å‘½ä»¤æˆ–è€…è¯·æ±‚åˆ° Docker æœåŠ¡ç«¯</li>\n</ul>\n<p>DockerHubï¼š</p>\n<ul>\n<li>ä¸€ä¸ªé•œåƒæ‰˜ç®¡çš„æœåŠ¡å™¨ï¼Œç±»ä¼¼çš„è¿˜æœ‰é˜¿é‡Œäº‘é•œåƒæœåŠ¡ï¼Œç»Ÿç§°ä¸º DockerRegistry</li>\n</ul>\n</blockquote>\n<h3 id=\"75-dockeråŸºæœ¬æ“ä½œ\"><a class=\"anchor\" href=\"#75-dockeråŸºæœ¬æ“ä½œ\">#</a> 7.5ã€Docker åŸºæœ¬æ“ä½œğŸŒ³</h3>\n<ul>\n<li>é•œåƒæ“ä½œ</li>\n<li>å®¹å™¨æ“ä½œ</li>\n<li>æ•°æ®å· (å®¹å™¨æ•°æ®ç®¡ç†)</li>\n</ul>\n<h4 id=\"751-é•œåƒç›¸å…³å‘½ä»¤\"><a class=\"anchor\" href=\"#751-é•œåƒç›¸å…³å‘½ä»¤\">#</a> 7.5.1ã€é•œåƒç›¸å…³å‘½ä»¤ğŸŒ²</h4>\n<ul>\n<li>\n<p>é•œåƒåç§°ä¸€èˆ¬åˆ†ä¸¤éƒ¨åˆ†ç»„æˆï¼š[repository]:[tag]</p>\n<p>tag ä¸€èˆ¬æŒ‡ ç‰ˆæœ¬</p>\n</li>\n<li>\n<p>åœ¨æ²¡æœ‰æŒ‡å®š tag æ—¶ï¼Œé»˜è®¤æ˜¯ latestï¼Œä»£è¡¨æœ€æ–°ç‰ˆæœ¬çš„é•œåƒ</p>\n</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081604324.png\" alt=\"image-20231008160421226\" /></p>\n<h5 id=\"7511-é•œåƒæ“ä½œå‘½ä»¤\"><a class=\"anchor\" href=\"#7511-é•œåƒæ“ä½œå‘½ä»¤\">#</a> 7.5.1.1ã€é•œåƒæ“ä½œå‘½ä»¤ğŸŒ´</h5>\n<p>Docker é•œåƒçš„æ“ä½œæ— éå°±æ˜¯ CRUDï¼Œæ¯”å¦‚ local (æœ¬åœ°) å°±æ˜¯æœ¬åœ°çš„ Dockerï¼Œæˆ‘è¦åœ¨è¿™ä¸ªä¸Šé¢å®Œæˆé•œåƒçš„æ“ä½œã€‚æ¯”æ–¹è¯´è·å–é•œåƒï¼Œä¸€èˆ¬æœ‰ä¸¤ç§è·å–æ–¹æ³•ã€‚ç¬¬ä¸€ç§ä¸ºï¼šæœ¬åœ°è·å–ï¼Œç¬¬äºŒç§ä¸ºï¼šè¿œç«¯è·å–ã€‚</p>\n<p>æœ¬åœ°è·å–ï¼š</p>\n<p>éœ€è¦ä¸€ä¸ªåä¸º Dockerfile æ–‡ä»¶ï¼Œåˆ©ç”¨ docker build å‘½ä»¤æŠŠå®ƒæ„å»ºæˆä¸€ä¸ªé•œåƒï¼Œä½¿ç”¨å‘½ä»¤ï¼šdocker pull ä» docker registry çš„æœåŠ¡é‡Œæ‹‰å–é•œåƒï¼Œè·å–åˆ°é•œåƒæƒ³æŸ¥çœ‹ä¸‹å¯ä»¥ä½¿ç”¨å‘½ä»¤ï¼šdocker imagesï¼Œåˆ é™¤é•œåƒä½¿ç”¨å‘½ä»¤ï¼šdocker rmi</p>\n<p>åˆ†äº«é•œåƒæœ‰ä¸¤ç§æ–¹å¼ï¼š</p>\n<p>æ–¹å¼ä¸€ï¼š</p>\n<p>ä½¿ç”¨å‘½ä»¤ docker push å°†é•œåƒæ¨é€åˆ°é•œåƒæœåŠ¡å™¨</p>\n<p>æ–¹å¼äºŒï¼š</p>\n<p>ä½¿ç”¨ docker save å°†é•œåƒæ‰“åŒ…ä¸º zip ç„¶åä½¿ç”¨ u ç›˜æ‹·è´ç»™åˆ«äººã€‚ä½¿ç”¨ docker load å°† zip åŠ è½½ä¸ºé•œåƒ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081612068.png\" alt=\"image-20231008161250665\" /></p>\n<h4 id=\"752-æ¡ˆä¾‹ä»dockerhubä¸­æ‹‰å–ä¸€ä¸ªnginxé•œåƒå¹¶æŸ¥çœ‹\"><a class=\"anchor\" href=\"#752-æ¡ˆä¾‹ä»dockerhubä¸­æ‹‰å–ä¸€ä¸ªnginxé•œåƒå¹¶æŸ¥çœ‹\">#</a> 7.5.2ã€æ¡ˆä¾‹ï¼Œä» DockerHub ä¸­æ‹‰å–ä¸€ä¸ª nginx é•œåƒå¹¶æŸ¥çœ‹ğŸŒ²</h4>\n<p><strong>éœ€æ±‚</strong>ï¼šä» DockerHub ä¸­æ‹‰å–ä¸€ä¸ª nginx é•œåƒå¹¶æŸ¥çœ‹</p>\n<p>1ã€é¦–å…ˆå»é•œåƒä»“åº“æœç´¢ nginx é•œåƒï¼Œæ¯”å¦‚<span class=\"exturl\" data-url=\"aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS8=\"> DockerHub</span>:</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081618473.png\" alt=\"image-20231008161836139\" /></p>\n<p>nginx åé¢çš„å‹‹ç« è¡¨ç¤ºè¿™ä¸ªæ˜¯å®˜ç½‘çš„æ­£ç‰ˆé•œåƒ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081621315.png\" alt=\"image-20231008162135908\" /></p>\n<p>ç‚¹å¼€åå¯å¤åˆ¶å‘½ä»¤ï¼Œé»˜è®¤æ‹‰å–çš„æ˜¯æœ€æ–°ç‰ˆæœ¬çš„ nginx</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081624383.png\" alt=\"image-20231008162412714\" /></p>\n<p>2ã€æ ¹æ®æŸ¥çœ‹åˆ°çš„é•œåƒåç§°ï¼Œæ‹‰å–è‡ªå·±éœ€è¦çš„é•œåƒï¼Œé€šè¿‡å‘½ä»¤ï¼šdocker pull nginx</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081626723.png\" alt=\"image-20231008162646280\" /></p>\n<p>3ã€é€šè¿‡å‘½ä»¤ï¼šdocker images æŸ¥çœ‹æ‹‰å–åˆ°çš„é•œåƒ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081627490.png\" alt=\"image-20231008162714111\" /></p>\n<h4 id=\"753-æ¡ˆä¾‹åˆ©ç”¨docker-saveå°†nginxé•œåƒå¯¼å‡ºç£ç›˜ç„¶åå†é€šè¿‡loadåŠ è½½å›æ¥\"><a class=\"anchor\" href=\"#753-æ¡ˆä¾‹åˆ©ç”¨docker-saveå°†nginxé•œåƒå¯¼å‡ºç£ç›˜ç„¶åå†é€šè¿‡loadåŠ è½½å›æ¥\">#</a> 7.5.3ã€æ¡ˆä¾‹ï¼Œåˆ©ç”¨ docker save å°† nginx é•œåƒå¯¼å‡ºç£ç›˜ï¼Œç„¶åå†é€šè¿‡ load åŠ è½½å›æ¥ğŸŒ²</h4>\n<p><strong>æ­¥éª¤</strong>ï¼š</p>\n<p>1ã€åˆ©ç”¨ <code>docker xx --help</code>  å‘½ä»¤æŸ¥çœ‹ docker save å’Œ docker load çš„è¯­æ³•</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker save --help</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># å‘½ä»¤ç¤ºä¾‹ï¼šdocker save [é€‰é¡¹] é•œåƒåç§°</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Usage:  <span class=\"token function\">docker</span> save <span class=\"token punctuation\">[</span>OPTIONS<span class=\"token punctuation\">]</span> IMAGE <span class=\"token punctuation\">[</span>IMAGE<span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># ä¿å­˜ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒåˆ°ä¸€ä¸ª tar æ–‡ä»¶ä¸­ (tar å‹ç¼©æ–‡ä»¶)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Save one or <span class=\"token function\">more</span> images to a <span class=\"token function\">tar</span> archive <span class=\"token punctuation\">(</span>streamed to STDOUT by default<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Aliases:</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token function\">docker</span> image save, <span class=\"token function\">docker</span> save</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># é€‰é¡¹è¯´æ˜</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Options:</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># -o è¾“å‡ºçš„æ„æ€ï¼Œè¾“å‡ºåˆ°ä¸€ä¸ªæŒ‡å®šçš„æ–‡ä»¶å½“ä¸­</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  -o, <span class=\"token parameter variable\">--output</span> string   Write to a file, instead of STDOUT</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>docker save å¯¼å‡ºé•œåƒä¸ºå‹ç¼©æ–‡ä»¶</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker images</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>nginx        latest    61395b4c586d   <span class=\"token number\">2</span> weeks ago   187MB</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker save -o nginx.tar nginx:latest</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls -ahl</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>total 183M</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>dr-xr-x---.  <span class=\"token number\">4</span> root root  <span class=\"token number\">191</span> Oct  <span class=\"token number\">8</span> 04:47 <span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>dr-xr-xr-x. <span class=\"token number\">17</span> root root  <span class=\"token number\">224</span> Jul <span class=\"token number\">15</span> 05:11 <span class=\"token punctuation\">..</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>-rw-------.  <span class=\"token number\">1</span> root root <span class=\"token number\">1</span>.4K Jul <span class=\"token number\">15</span> 05:12 anaconda-ks.cfg</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>-rw-------.  <span class=\"token number\">1</span> root root   <span class=\"token number\">78</span> Jul <span class=\"token number\">15</span> 05:20 .bash_history</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>-rw-r--r--.  <span class=\"token number\">1</span> root root   <span class=\"token number\">18</span> Dec <span class=\"token number\">28</span>  <span class=\"token number\">2013</span> .bash_logout</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>-rw-r--r--.  <span class=\"token number\">1</span> root root  <span class=\"token number\">176</span> Dec <span class=\"token number\">28</span>  <span class=\"token number\">2013</span> .bash_profile</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>-rw-r--r--.  <span class=\"token number\">1</span> root root  <span class=\"token number\">176</span> Dec <span class=\"token number\">28</span>  <span class=\"token number\">2013</span> .bashrc</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>-rw-r--r--.  <span class=\"token number\">1</span> root root  <span class=\"token number\">100</span> Dec <span class=\"token number\">28</span>  <span class=\"token number\">2013</span> .cshrc</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>drwxr-xr-x.  <span class=\"token number\">3</span> root root   <span class=\"token number\">20</span> Oct  <span class=\"token number\">8</span> 03:52 etc</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>-rw-------.  <span class=\"token number\">1</span> root root 183M Oct  <span class=\"token number\">8</span> 04:47 nginx.tar</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>drwxr-----.  <span class=\"token number\">3</span> root root   <span class=\"token number\">19</span> Jul <span class=\"token number\">15</span> 05:30 .pki</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>-rw-r--r--.  <span class=\"token number\">1</span> root root  <span class=\"token number\">129</span> Dec <span class=\"token number\">28</span>  <span class=\"token number\">2013</span> .tcshrc</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>-rw-------.  <span class=\"token number\">1</span> root root  <span class=\"token number\">841</span> Oct  <span class=\"token number\">8</span> 03:56 .viminfo</pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>docker load å¯¼å…¥ å‹ç¼©æ–‡ä»¶</p>\n<p>å…ˆå°† docker ä¸­çš„é•œåƒåˆ é™¤</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker rmi nginx:latest</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Untagged: nginx:latest</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Untagged: nginx@sha256:32da30332506740a2f7c34d5dc70467b7f14ec67d912703568daff790ab3f755</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Deleted: sha256:61395b4c586da2b9b3b7ca903ea6a448e6783dfdd7f768ff2c1a0f3360aaba99</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Deleted: sha256:1c69f36a0d9b59b762eaba410fa9fd01b85140670a8d49199a7b37702cc956c0</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Deleted: sha256:bac209bfab6997cccf20779ae98d5f77a66867734499ecf604a50a5826f6b8a4</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Deleted: sha256:859676f4cd3004af025a02dade096ad6f9391d94d1b1a983fc6098debe435055</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Deleted: sha256:cbbd97cee0d824e5e82f9a4b2e93c5eb3c66fd72a2624d5c1521dc3395bfd1e2</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Deleted: sha256:0b41545d8c3de3b78778d591a8da3d9dfa5fa8807baef5edf21e5eb94ded792d</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Deleted: sha256:7e87866b23143eb30086086a669b2e902368a5836446a885b2411d3feef18bef</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Deleted: sha256:d310e774110ab038b30c6a5f7b7f7dd527dbe527854496bd30194b9ee6ea496e</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker images</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>REPOSITORY   TAG       IMAGE ID   CREATED   SIZE</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>docker load --help</code>  æ¥æŸ¥çœ‹å‘½ä»¤çš„è¯´æ˜</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker load --help</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># å‘½ä»¤ç¤ºä¾‹ï¼šdocker load [é€‰é¡¹]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Usage:  <span class=\"token function\">docker</span> load <span class=\"token punctuation\">[</span>OPTIONS<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># ä» tar å­˜æ¡£æˆ– STDIN åŠ è½½å›¾åƒ</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Load an image from a <span class=\"token function\">tar</span> archive or STDIN</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Aliases:</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token function\">docker</span> image load, <span class=\"token function\">docker</span> load</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># -i ï¼šè¾“å…¥ï¼ŒæŒ‡å®šè¯»å–å“ªä¸€ä¸ªæ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># -q ï¼šä¸ä¼šæ‰“å°æ—¥å¿—</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Options:</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  -i, <span class=\"token parameter variable\">--input</span> string   Read from <span class=\"token function\">tar</span> archive file, instead of STDIN</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  -q, <span class=\"token parameter variable\">--quiet</span>          Suppress the load output</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>ä½¿ç”¨ docker load å‘½ä»¤åŠ è½½é•œåƒ</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker load -i nginx.tar</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>d310e774110a: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">77</span>.81MB/77.81MB</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>eb7e3384f0ab: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>    113MB/113MB</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>1dc45c680d0f: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">3</span>.584kB/3.584kB</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>ea43d4f82a03: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">4</span>.608kB/4.608kB</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>9c6261b5d198: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>   <span class=\"token number\">2</span>.56kB/2.56kB</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>a7e2a768c198: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>   <span class=\"token number\">5</span>.12kB/5.12kB</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>d26d4f0eb474: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">7</span>.168kB/7.168kB</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Loaded image: nginx:latest</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker images</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>nginx        latest    61395b4c586d   <span class=\"token number\">2</span> weeks ago   187MB</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>é•œåƒæ“ä½œæœ‰å“ªäº›ï¼Ÿ</p>\n<ul>\n<li>docker images</li>\n<li>docker rmi</li>\n<li>docker pull</li>\n<li>docker push</li>\n<li>docker save</li>\n<li>docker load</li>\n</ul>\n</blockquote>\n<h4 id=\"754-è‡ªå·±ç»ƒä¹ å»dockerhubæœç´¢å¹¶æ‹‰å–ä¸€ä¸ªredisé•œåƒ\"><a class=\"anchor\" href=\"#754-è‡ªå·±ç»ƒä¹ å»dockerhubæœç´¢å¹¶æ‹‰å–ä¸€ä¸ªredisé•œåƒ\">#</a> 7.5.4ã€(è‡ªå·±ç»ƒä¹ ) å» DockerHub æœç´¢å¹¶æ‹‰å–ä¸€ä¸ª Redis é•œåƒğŸŒ²</h4>\n<p>1ã€å» DockerHub æœç´¢ Redis é•œåƒ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081702255.png\" alt=\"image-20231008170209077\" /></p>\n<p>2ã€æŸ¥çœ‹ Redis é•œåƒçš„åç§°å’Œç‰ˆæœ¬</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081702756.png\" alt=\"image-20231008170243226\" /></p>\n<p>3ã€åˆ©ç”¨ docker pull å‘½ä»¤æ‹‰å–é•œåƒï¼Œå¹¶ä½¿ç”¨ docker images æŸ¥çœ‹æ‹‰å–çš„æƒ…å†µ</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker pull redis</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Using default tag: latest</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>latest: Pulling from library/redis</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a803e7c4b030: Already exists</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>57e05a1ddec3: Pull complete</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>4635c857038a: Pull complete</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>10001c6989b4: Pull complete</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>f93feb85ceb4: Pull complete</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>4f4fb700ef54: Pull complete</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>320349bd761d: Pull complete</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Digest: sha256:b68c6efe2c5f2d7d7d14a2749f66d6d81645ec0cacb92572b2fb7d5c42c82031</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>Status: Downloaded newer image <span class=\"token keyword\">for</span> redis:latest</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>docker.io/library/redis:latest</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker images</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>nginx        latest    61395b4c586d   <span class=\"token number\">2</span> weeks ago   187MB</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>redis        latest    7c4b517da47d   <span class=\"token number\">4</span> weeks ago   153MB</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>4ã€åˆ©ç”¨ docker save å‘½ä»¤å°† redis:latest æ‰“åŒ…ä¸ºä¸€ä¸ª redis.tar åŒ…</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker save -o redis.tar redis:latest</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>anaconda-ks.cfg  etc  redis.tar</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>5ã€åˆ©ç”¨ docker rmi åˆ é™¤æœ¬åœ°çš„ redis:latest</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker rmi redis:latest</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Untagged: redis:latest</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Untagged: redis@sha256:b68c6efe2c5f2d7d7d14a2749f66d6d81645ec0cacb92572b2fb7d5c42c82031</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Deleted: sha256:7c4b517da47d331a47827390b9e8eb1be7ee68133af9c332660001b4d447828d</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Deleted: sha256:06dafc2b2808183db1be226fd99e9dd9d374db9ef86480ccdec56bcb644c821a</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Deleted: sha256:d31af4bfba5cce8499ed4df2f666ef1cf911d0936156af46da79d4b510c7687a</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Deleted: sha256:f14f2bfc00d1db007798b7b81d043df4130673ae33591960d0917c484eded7f0</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Deleted: sha256:7778474585964f4869bd7b40e56a375312fc91284c26f7b84967efd383219a20</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Deleted: sha256:8fbe6eb1ebe310862ce5ebf21c01744994203df7d3f53fecabf53db86c3f4578</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Deleted: sha256:57489dc8f39be6c5bfe929829682b1dcd6c7497e2f5878f450557a381afacb52</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker images</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>nginx        latest    61395b4c586d   <span class=\"token number\">2</span> weeks ago   187MB</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>6ã€åˆ©ç”¨ docker load é‡æ–°åŠ è½½ redis.tar æ–‡ä»¶</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker load -i redis.tar</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ae2dc73bba26: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">10</span>.75kB/10.75kB</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>7c13dd56eefc: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">4</span>.141MB/4.141MB</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>33409257a91d: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">75</span>.28MB/75.28MB</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>c0a7ac48293c: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">1</span>.536kB/1.536kB</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>5f70bf18a086: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">1</span>.024kB/1.024kB</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>e6642d3d7b17: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">4</span>.096kB/4.096kB</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Loaded image: redis:latest</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker images</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>nginx        latest    61395b4c586d   <span class=\"token number\">2</span> weeks ago   187MB</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>redis        latest    7c4b517da47d   <span class=\"token number\">4</span> weeks ago   153MB</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><h4 id=\"755-å®¹å™¨ç›¸å…³å‘½ä»¤\"><a class=\"anchor\" href=\"#755-å®¹å™¨ç›¸å…³å‘½ä»¤\">#</a> 7.5.5ã€å®¹å™¨ç›¸å…³å‘½ä»¤ğŸŒ²</h4>\n<p>åˆ›å»ºæ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªå‘½ä»¤å°±æ˜¯ docker run äº†ï¼Œè¿™ä¸ªå‘½ä»¤ä¸ä»…ä»…å¯ä»¥å¸®æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®¹å™¨è€Œä¸”è¿˜å¯ä»¥è®©è¿™ä¸ªå®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ã€‚å®¹å™¨é™¤äº†è¿è¡ŒçŠ¶æ€è¿˜æœ‰ï¼Œæš‚åœï¼Œåœæ­¢ä¸¤ä¸ªçŠ¶æ€ã€‚åªéœ€è¦ç®€å•çš„å‘½ä»¤å°±å¯ä»¥å®ç°ä¸¤ä¸ªçŠ¶æ€ä¹‹é—´çš„åˆ‡æ¢äº†</p>\n<p>docker puse å¯ä»¥è®©å®¹å™¨ä»è¿è¡ŒçŠ¶æ€è¿›å…¥åˆ°æš‚åœçŠ¶æ€</p>\n<p>docker unpuse è®©å®¹å™¨ä»æš‚åœçŠ¶æ€æ¢å¤åˆ°è¿è¡ŒçŠ¶æ€</p>\n<p>docker stop å¯ä»¥è®©å®¹å™¨ä»è¿è¡ŒçŠ¶æ€è¿›å…¥åœæ­¢çŠ¶æ€</p>\n<p>docker start è®©å®¹å™¨ä»åœæ­¢çŠ¶æ€æ¢å¤åˆ°è¿è¡ŒçŠ¶æ€</p>\n<p>docker stop $(docker ps -q) åœæ­¢å…¨éƒ¨è¿è¡Œä¸­çš„å®¹å™¨</p>\n<p>docker rm $(docker ps -aq) åˆ é™¤å…¨éƒ¨å®¹å™¨ è¿è¡Œä¸­çš„éœ€è¦å¼ºåˆ¶åˆ é™¤ -f</p>\n<p><code>docker stop $(docker ps -q) &amp; docker rm $(docker ps -aq)</code>  å…ˆåœæ­¢å…¨éƒ¨å®¹å™¨å†åˆ é™¤å…¨éƒ¨å®¹å™¨</p>\n<blockquote>\n<p>é‚£ä¸ºä»€ä¹ˆæš‚åœå¯ä»¥ç”¨ puse å’Œ unpause è€Œåœæ­¢å´æ˜¯ stop å’Œ start å‘¢ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯ unstopã€‚</p>\n<p><strong>åŸå› </strong>ï¼š</p>\n<p>å®ƒä»¬åœ¨æ“ä½œç³»ç»Ÿçš„å¤„ç†æ–¹å¼ä¸åŒï¼Œå¦‚æœå®¹å™¨è¿›å…¥æš‚åœçŠ¶æ€ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†å®¹å™¨å†…çš„è¿›ç¨‹æŒ‚èµ·ï¼Œå®¹å™¨å…³è”çš„å†…å­˜æš‚å­˜èµ·æ¥ã€‚CPU ä¸å†æ‰§è¡Œè¿™ä¸ªè¿›ç¨‹ï¼Œå¦‚æœå°†å®ƒæ¢å¤é‚£ä¹ˆå†…å­˜ç©ºé—´æ¢å¤ç¨‹åºæ¥ç€è¿è¡Œï¼Œé‚£ä¹ˆå®¹å™¨å°±åˆè¿›å…¥è¿è¡ŒçŠ¶æ€äº†ã€‚</p>\n<p>ä½†æ˜¯åœæ­¢ä¸åŒï¼Œåœæ­¢ç›´æ¥æŠŠè¿™ä¸ªè¿›ç¨‹æ€æ­»ï¼Œå®¹å™¨æ‰€å çš„å†…å­˜å›æ”¶ã€‚æŠŠä¿ç•™ä¸‹æ¥çš„å°±ä»…å‰©å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿäº†ä¹Ÿå°±æ˜¯é‚£äº›é™æ€çš„ä¸œè¥¿ï¼Œå› æ­¤åœæ­¢æ˜¯æ²¡æœ‰åŠæ³•è¿›è¡Œæ¢å¤çš„å› ä¸ºè¿›ç¨‹å·²ç»è¢«æ€æ­»äº†ã€‚</p>\n<p>è¿™å°±æ˜¯æš‚åœå’Œåœæ­¢çš„åŒºåˆ«äº†ã€‚</p>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081724327.png\" alt=\"image-20231008172423860\" /></p>\n<h5 id=\"7551-æŸ¥çœ‹å®¹å™¨çš„çŠ¶æ€\"><a class=\"anchor\" href=\"#7551-æŸ¥çœ‹å®¹å™¨çš„çŠ¶æ€\">#</a> 7.5.5.1ã€æŸ¥çœ‹å®¹å™¨çš„çŠ¶æ€ğŸŒ´</h5>\n<p>Docker æä¾›äº†ä¸€ä¸ªå‘½ä»¤å«ï¼šdocker ps å¯ä»¥æŸ¥çœ‹æ‰€æœ‰è¿è¡Œçš„å®¹å™¨ä»¥åŠçŠ¶æ€ï¼Œè¿˜æœ‰ä¸€ä¸ªå‘½ä»¤ä¸ºï¼šdocker logs æŸ¥çœ‹å®¹å™¨è¿è¡Œçš„æ—¥å¿—</p>\n<p>å¦‚æœæƒ³æ·±å…¥å†…éƒ¨äº†è§£ä¸€ä¸‹ï¼ŒDocker è¿˜æä¾›äº†ä¸€ä¸ªå‘½ä»¤ï¼šdocker exec å¯ä»¥è¿›å…¥å®¹å™¨çš„å†…éƒ¨è¿›è¡Œæ“ä½œ</p>\n<p>docker rm åˆ é™¤å®¹å™¨</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081728094.png\" alt=\"image-20231008172804953\" /></p>\n<h5 id=\"7552-åˆ›å»ºè¿è¡Œä¸€ä¸ªnginxå®¹å™¨\"><a class=\"anchor\" href=\"#7552-åˆ›å»ºè¿è¡Œä¸€ä¸ªnginxå®¹å™¨\">#</a> 7.5.5.2ã€åˆ›å»ºè¿è¡Œä¸€ä¸ª Nginx å®¹å™¨ğŸŒ´</h5>\n<p>1ã€å» docker hub æŸ¥çœ‹ Nginx çš„å®¹å™¨è¿è¡Œå‘½ä»¤</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081744053.png\" alt=\"image-20231008174414666\" /></p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">--name</span> some-nginx <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-p</span> <span class=\"token number\">8080</span>:80 some-content-nginx</pre></td></tr></table></figure><p><strong>å‘½ä»¤è§£è¯»</strong>ï¼š</p>\n<ul>\n<li>docker runï¼šåˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªå®¹å™¨</li>\n<li><code>--name</code> ï¼šç»™å®¹å™¨èµ·ä¸€ä¸ªåå­—ï¼Œæ¯”å¦‚å«åš mn</li>\n<li>-pï¼šå°†å®¿ä¸»æœºç«¯å£ä¸å®¹å™¨ç«¯å£æ˜ å°„ï¼Œå†’å·å·¦ä¾§æ˜¯å®¿ä¸»æœºç«¯å£ï¼Œå³åˆ™æ˜¯å®¹å™¨ç«¯å£</li>\n<li>-dï¼šåå°è¿è¡Œå®¹å™¨</li>\n<li>nginxï¼šé•œåƒåç§°ï¼Œä¾‹å¦‚ nginx</li>\n</ul>\n<blockquote>\n<p>å°†å®¿ä¸»æœºç«¯å£ä¸å®¹å™¨ç«¯å£æ˜ å°„æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p>\n<p>æ¯”æ–¹è¯´æœ‰ä¸€å° centos çš„æœåŠ¡å™¨ ip åœ°å€ä¸ºï¼š192.168.150.101 ç°åœ¨æˆ‘ä»¬åœ¨è¿™å°æœåŠ¡å™¨ä¸Šéƒ¨ç½²äº†ä¸€å° Nginx å®¹å™¨å®ƒçš„ç«¯å£æ˜¯ 80ï¼Œå¦‚æœç”¨æˆ·æƒ³è¦æ¥è®¿é—® Nginx å®¹å™¨ä¸èƒ½ç›´æ¥è®¿é—®ï¼Œå› ä¸ºå®¹å™¨æ˜¯å¯¹å¤–éš”ç¦»çš„ã€‚ä¸èƒ½è®¿é—®æ€ä¹ˆåŠå‘¢ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åšä¸€ä¸ªç«¯å£æ˜ å°„</p>\n<p><strong>ç«¯å£æ˜ å°„çš„è§£é‡Š</strong>ï¼š</p>\n<p>æ¯”å¦‚è¯´å®¿ä¸»æœºæœ‰è‡ªå·±å¾ˆå¤šç«¯å£ï¼Œå…¶ä¸­ä¸€ä¸ªç«¯å£ä¸ºï¼š80ï¼Œè®©å®¿ä¸»æœºçš„ 80 è·Ÿå®¹å™¨çš„ 80 äº§ç”Ÿä¸€ä¸ªå…³è”æ˜ å°„ï¼Œé‚£è¿™æ ·ä¸€æ¥ä»»ä½•è¿›å…¥å®¿ä¸»æœº 80 çš„è¿™ä¸ªè¯·æ±‚å°±éƒ½ä¼šè¢«è½¬å‘åˆ°å®¹å™¨çš„ 80 ç«¯å£å»æ‰§è¡Œäº†ã€‚è¿™æ ·å°±ç­‰äºæ˜¯ nginx å¤„ç†äº†è¿™ä¸ªè¯·æ±‚</p>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081758073.png\" alt=\"image-20231008175824602\" /></p>\n<p>æ‰€ä»¥ç«¯å£æ˜ å°„çš„ä½œç”¨æ˜¯æŠŠä¸€ä¸ªæœ¬æ¥å®Œå…¨éš”ç¦»çš„å®¹å™¨å¯¹å¤–æš´æ¼è®©ç”¨æˆ·å¯ä»¥è®¿é—®</p>\n<p>2ã€æ‰§è¡Œå‘½ä»¤åˆ›å»ºå®¹å™¨å¹¶è¿è¡Œ</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker run --name mn -p 80:80 -d nginx</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>9672ddfc088cdf53966332bf06da44b6daf7093427c12ed636818bcaae20e312</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>9672ddfc088cdf53966332bf06da44b6daf7093427c12ed636818bcaae20e312ï¼šå®¹å™¨çš„å”¯ä¸€ id</p>\n<p>3ã€æŸ¥çœ‹å®¹å™¨çš„çŠ¶æ€</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker ps</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                               NAMES</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>9672ddfc088c   nginx     <span class=\"token string\">\"/docker-entrypoint.â€¦\"</span>   <span class=\"token number\">14</span> minutes ago   Up <span class=\"token number\">14</span> minutes   <span class=\"token number\">0.0</span>.0.0:80-<span class=\"token operator\">></span><span class=\"token number\">80</span>/tcp, :::80-<span class=\"token operator\">></span><span class=\"token number\">80</span>/tcp   mn</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>4ã€è®¿é—®æœåŠ¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081821712.png\" alt=\"image-20231008182123920\" /></p>\n<p>å¯ä»¥è®¿é—®è¯´æ˜å®¹å™¨éƒ¨ç½²æˆåŠŸã€‚</p>\n<p>5ã€æŸ¥çœ‹è®¿é—® nginx åçš„æ—¥å¿—ä¿¡æ¯</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker logs mn</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>/docker-entrypoint.sh: Looking <span class=\"token keyword\">for</span> shell scripts <span class=\"token keyword\">in</span> /docker-entrypoint.d/</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">10</span>-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">10</span>-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 <span class=\"token keyword\">in</span> /etc/nginx/conf.d/default.conf</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>/docker-entrypoint.sh: Sourcing /docker-entrypoint.d/15-local-resolvers.envsh</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>/docker-entrypoint.sh: Configuration complete<span class=\"token punctuation\">;</span> ready <span class=\"token keyword\">for</span> start up</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">2023</span>/10/08 <span class=\"token number\">10</span>:04:30 <span class=\"token punctuation\">[</span>notice<span class=\"token punctuation\">]</span> <span class=\"token number\">1</span><span class=\"token comment\">#1: using the \"epoll\" event method</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">2023</span>/10/08 <span class=\"token number\">10</span>:04:30 <span class=\"token punctuation\">[</span>notice<span class=\"token punctuation\">]</span> <span class=\"token number\">1</span><span class=\"token comment\">#1: nginx/1.25.2</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">2023</span>/10/08 <span class=\"token number\">10</span>:04:30 <span class=\"token punctuation\">[</span>notice<span class=\"token punctuation\">]</span> <span class=\"token number\">1</span><span class=\"token comment\">#1: built by gcc 12.2.0 (Debian 12.2.0-14)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">2023</span>/10/08 <span class=\"token number\">10</span>:04:30 <span class=\"token punctuation\">[</span>notice<span class=\"token punctuation\">]</span> <span class=\"token number\">1</span><span class=\"token comment\">#1: OS: Linux 3.10.0-1160.el7.x86_64</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">2023</span>/10/08 <span class=\"token number\">10</span>:04:30 <span class=\"token punctuation\">[</span>notice<span class=\"token punctuation\">]</span> <span class=\"token number\">1</span><span class=\"token comment\">#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">2023</span>/10/08 <span class=\"token number\">10</span>:04:30 <span class=\"token punctuation\">[</span>notice<span class=\"token punctuation\">]</span> <span class=\"token number\">1</span><span class=\"token comment\">#1: start worker processes</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">2023</span>/10/08 <span class=\"token number\">10</span>:04:30 <span class=\"token punctuation\">[</span>notice<span class=\"token punctuation\">]</span> <span class=\"token number\">1</span><span class=\"token comment\">#1: start worker process 29</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">2023</span>/10/08 <span class=\"token number\">10</span>:04:30 <span class=\"token punctuation\">[</span>notice<span class=\"token punctuation\">]</span> <span class=\"token number\">1</span><span class=\"token comment\">#1: start worker process 30</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">2023</span>/10/08 <span class=\"token number\">10</span>:04:30 <span class=\"token punctuation\">[</span>notice<span class=\"token punctuation\">]</span> <span class=\"token number\">1</span><span class=\"token comment\">#1: start worker process 31</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token number\">2023</span>/10/08 <span class=\"token number\">10</span>:04:30 <span class=\"token punctuation\">[</span>notice<span class=\"token punctuation\">]</span> <span class=\"token number\">1</span><span class=\"token comment\">#1: start worker process 32</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token number\">192.168</span>.249.1 - - <span class=\"token punctuation\">[</span>08/Oct/2023:10:21:11 +0000<span class=\"token punctuation\">]</span> <span class=\"token string\">\"GET / HTTP/1.1\"</span> <span class=\"token number\">200</span> <span class=\"token number\">615</span> <span class=\"token string\">\"-\"</span> <span class=\"token string\">\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36\"</span> <span class=\"token string\">\"-\"</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><h6 id=\"75521-æŒç»­è¾“å‡ºæ—¥å¿—\"><a class=\"anchor\" href=\"#75521-æŒç»­è¾“å‡ºæ—¥å¿—\">#</a> 7.5.5.2.1ã€æŒç»­è¾“å‡ºæ—¥å¿—ğŸ‹</h6>\n<p>æ¯æ¬¡è¯·æ±‚éƒ½è¦æ‰§è¡ŒæŒ‡ä»¤æ‰èƒ½æŸ¥çœ‹æ—¥å¿—å¾ˆéº»çƒ¦é€šè¿‡ <code>docker logs --help</code>  æ¥æŸ¥çœ‹æœ‰æ²¡æœ‰éœ€è¦çš„å¸®åŠ©</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker logs --help</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Usage:  <span class=\"token function\">docker</span> logs <span class=\"token punctuation\">[</span>OPTIONS<span class=\"token punctuation\">]</span> CONTAINER</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Fetch the logs of a container</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Aliases:</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token function\">docker</span> container logs, <span class=\"token function\">docker</span> logs</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Options:</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token parameter variable\">--details</span>        Show extra details provided to logs</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token comment\"># æŒç»­è¾“å‡ºæ—¥å¿—    </span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  -f, <span class=\"token parameter variable\">--follow</span>         Follow log output</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token parameter variable\">--since</span> string   Show logs since timestamp <span class=\"token punctuation\">(</span>e.g. <span class=\"token string\">\"2013-01-02T13:23:37Z\"</span><span class=\"token punctuation\">)</span> or relative <span class=\"token punctuation\">(</span>e.g. <span class=\"token string\">\"42m\"</span> <span class=\"token keyword\">for</span> <span class=\"token number\">42</span> minutes<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  -n, <span class=\"token parameter variable\">--tail</span> string    Number of lines to show from the end of the logs <span class=\"token punctuation\">(</span>default <span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  -t, <span class=\"token parameter variable\">--timestamps</span>     Show timestamps</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token parameter variable\">--until</span> string   Show logs before a timestamp <span class=\"token punctuation\">(</span>e.g. <span class=\"token string\">\"2013-01-02T13:23:37Z\"</span><span class=\"token punctuation\">)</span> or relative <span class=\"token punctuation\">(</span>e.g. <span class=\"token string\">\"42m\"</span> <span class=\"token keyword\">for</span> <span class=\"token number\">42</span> minutes<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é€‰é¡¹ä¸­æœ‰ä¸€ä¸ªæŒç»­è¾“å‡ºæ—¥å¿—çš„é€‰é¡¹</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>docker run å‘½ä»¤çš„å¸¸è§å‚æ•°æœ‰å“ªäº›ï¼Ÿ</p>\n<ul>\n<li><code>--name</code> ï¼šæŒ‡å®šå®¹å™¨åç§°</li>\n<li><code>-p</code> ï¼šæŒ‡å®šç«¯å£æ˜ å°„</li>\n<li><code>-d</code> ï¼šè®©å®¹å™¨åå°è¿è¡Œ</li>\n</ul>\n<p>æŸ¥çœ‹å®¹å™¨æ—¥å¿—çš„å‘½ä»¤ï¼š</p>\n<ul>\n<li>docker logs</li>\n<li>æ·»åŠ  - f å‚æ•°å¯ä»¥æŒç»­æŸ¥çœ‹æ—¥å¿—</li>\n</ul>\n<p>æŸ¥çœ‹å®¹å™¨çŠ¶æ€ï¼š</p>\n<ul>\n<li>docker ps</li>\n</ul>\n</blockquote>\n<h5 id=\"7553-è¿›å…¥nginxå®¹å™¨ä¿®æ”¹htmlæ–‡ä»¶å†…å®¹æ·»åŠ -ä¼ æ™ºæ•™è‚²æ¬¢è¿æ‚¨\"><a class=\"anchor\" href=\"#7553-è¿›å…¥nginxå®¹å™¨ä¿®æ”¹htmlæ–‡ä»¶å†…å®¹æ·»åŠ -ä¼ æ™ºæ•™è‚²æ¬¢è¿æ‚¨\">#</a> 7.5.5.3ã€è¿›å…¥ Nginx å®¹å™¨ï¼Œä¿®æ”¹ HTML æ–‡ä»¶å†…å®¹ï¼Œæ·»åŠ  â€œä¼ æ™ºæ•™è‚²æ¬¢è¿æ‚¨â€ğŸŒ´</h5>\n<p>1ã€è¿›å…¥å®¹å™¨ã€‚è¿›å…¥æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ nginx å®¹å™¨çš„å‘½ä»¤ä¸ºï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> mn <span class=\"token function\">bash</span></pre></td></tr></table></figure><p><strong>å‘½ä»¤è§£è¯»</strong>ï¼š</p>\n<ul>\n<li>docker execï¼šè¿›å…¥å®¹å™¨å†…éƒ¨ï¼Œæ‰§è¡Œä¸€ä¸ªå‘½ä»¤</li>\n<li>-itï¼šç»™å½“å‰è¿›å…¥çš„å®¹å™¨åˆ›å»ºä¸€ä¸ªæ ‡å‡†è¾“å…¥ï¼Œè¾“å‡ºç»ˆç«¯ï¼Œå…è®¸æˆ‘ä»¬ä¸å®¹å™¨äº¤äº’</li>\n<li>mnï¼šè¦è¿›å…¥çš„å®¹å™¨çš„åç§°</li>\n<li>bashï¼šè¿›å…¥å®¹å™¨åæ‰§è¡Œçš„å‘½ä»¤ï¼Œbash æ˜¯ä¸€ä¸ª linux ç»ˆç«¯äº¤äº’å‘½ä»¤</li>\n</ul>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker exec -it mn bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>root@9672ddfc088c:/<span class=\"token comment\">#</span></pre></td></tr></table></figure><p>é€šè¿‡ ls å‘½ä»¤æŸ¥çœ‹å†…éƒ¨éƒ½æœ‰ä»€ä¹ˆï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>root@9672ddfc088c:/<span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>bin   dev                  docker-entrypoint.sh  home  lib32  libx32  mnt  proc  run   srv  tmp  var</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>boot  docker-entrypoint.d  etc                   lib   lib64  media   opt  root  sbin  sys  usr</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>root@9672ddfc088c:/<span class=\"token comment\">#</span></pre></td></tr></table></figure><p>è¿™äº›æˆ‘ä»¬å¸¸è§çš„æ˜¯ linux æ ¹ç›®å½•ç»“æ„ï¼Œä½†æ˜¯è¿™æ˜¯é˜‰å‰²ç‰ˆçš„ã€‚å®¹å™¨çš„å†…éƒ¨ä¼šæœ‰è‡ªå·±çš„ä¸€å¥—æ–‡ä»¶ç³»ç»Ÿï¼Œçœ‹èµ·æ¥å’Œ linux çš„ç³»ç»Ÿç›®å½•ä¸€æ ·ï¼Œä½†æ˜¯è¿™é‡Œåªæœ‰ nginx è¿è¡Œå®ƒè‡ªå·±éœ€è¦çš„æ–‡ä»¶</p>\n<p>è¦æƒ³çœ‹ nginx å­˜æ”¾åˆ°å“ªé‡Œäº†æˆ‘ä»¬éœ€è¦å» Docker Hub çš„ nginx å‘å¸ƒé¡µé¢æŸ¥çœ‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081844719.png\" alt=\"image-20231008184405334\" /></p>\n<p>2ã€è¿›å…¥ nginx çš„ HTML æ‰€åœ¨ç›®å½• /user/share/nginx/html</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /user/share/nginx/html</pre></td></tr></table></figure><p>3ã€ä¿®æ”¹ index.html çš„å†…å®¹</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token parameter variable\">-i</span> <span class=\"token parameter variable\">-e</span> <span class=\"token string\">'s#Welcome to nginx#ä¼ æ™ºæ•™è‚²æ¬¢è¿æ‚¨#g'</span> <span class=\"token parameter variable\">-e</span> <span class=\"token string\">'s#&lt;head>#&lt;head>&lt;meta charset=\"utf-8\">#g'</span> index.html</pre></td></tr></table></figure><p>å†å»è®¿é—® nginx é¦–é¡µ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081913648.png\" alt=\"image-20231008191300720\" /></p>\n<h4 id=\"756-æŸ¥çœ‹åœæ­¢çš„å®¹å™¨\"><a class=\"anchor\" href=\"#756-æŸ¥çœ‹åœæ­¢çš„å®¹å™¨\">#</a> 7.5.6ã€æŸ¥çœ‹åœæ­¢çš„å®¹å™¨ğŸŒ²</h4>\n<p>å…ˆæŸ¥çœ‹ docker å®¹å™¨çš„è¿è¡ŒçŠ¶æ€</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker ps</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>CONTAINER ID   IMAGE     COMMAND                  CREATED             STATUS             PORTS                               NAMES</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>9672ddfc088c   nginx     <span class=\"token string\">\"/docker-entrypoint.â€¦\"</span>   About an hour ago   Up About an hour   <span class=\"token number\">0.0</span>.0.0:80-<span class=\"token operator\">></span><span class=\"token number\">80</span>/tcp, :::80-<span class=\"token operator\">></span><span class=\"token number\">80</span>/tcp   mn</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>åœæ­¢è¯¥å®¹å™¨</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker stop mn</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>mn</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker ps</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœæ­¢åé€šè¿‡ docker ps æŸ¥çœ‹çŠ¶æ€å°±çœ‹ä¸åˆ° nginx å®¹å™¨äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ docker ps -a æ¥è¿›è¡ŒæŸ¥çœ‹è¢«æ€æ­»çš„å®¹å™¨</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker ps -a</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>CONTAINER ID   IMAGE     COMMAND                  CREATED             STATUS                          PORTS     NAMES</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>9672ddfc088c   nginx     <span class=\"token string\">\"/docker-entrypoint.â€¦\"</span>   About an hour ago   Exited <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> About a minute ago             mn</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><blockquote>\n<p>æ€»ç»“ï¼š</p>\n<p>æŸ¥çœ‹å®¹å™¨çŠ¶æ€</p>\n<ul>\n<li>docker ps</li>\n<li>æ·»åŠ  - a å‚æ•°æŸ¥çœ‹æ‰€æœ‰çŠ¶æ€çš„å®¹å™¨</li>\n</ul>\n<p>åˆ é™¤å®¹å™¨</p>\n<ul>\n<li>docker rm</li>\n<li>ä¸èƒ½åˆ é™¤è¿è¡Œä¸­çš„å®¹å™¨ï¼Œé™¤éæ·»åŠ  - f å‚æ•°</li>\n</ul>\n<p>è¿›å…¥å®¹å™¨ï¼š</p>\n<ul>\n<li>å‘½ä»¤æ˜¯ <code>docker exec -it [å®¹å™¨å][è¦æ‰§è¡Œçš„å‘½ä»¤]</code></li>\n<li>exec å‘½ä»¤å¯ä»¥è¿›å…¥å®¹å™¨ä¿®æ”¹æ–‡ä»¶ï¼Œä½†æ˜¯åœ¨å®¹å™¨å†…ä¿®æ”¹æ–‡ä»¶æ—¶ä¸æ¨èçš„</li>\n</ul>\n</blockquote>\n<h4 id=\"757-æ•°æ®å·\"><a class=\"anchor\" href=\"#757-æ•°æ®å·\">#</a> 7.5.7ã€æ•°æ®å·ğŸŒ²</h4>\n<p>å®¹å™¨ä¸æ•°æ®è€¦åˆçš„é—®é¢˜</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310082044250.png\" alt=\"image-20231008204446853\" /></p>\n<p>ä¸Šé¢çš„é—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Œè¿™å°±è¦å­¦ä¹  <mark>æ•°æ®å·</mark> æ¥è§£å†³äº†</p>\n<p>æ•°æ®å· (volume) æ˜¯ä¸€ä¸ªè™šæ‹Ÿç›®å½•ï¼ŒæŒ‡å‘å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„æŸä¸ªç›®å½•ã€‚</p>\n<blockquote>\n<p>æ¯”å¦‚è¯´æœ‰ä¸€ä¸ª Docker ä¸»æœºï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªä¸»æœºä¸Šå°±ä¼šç”± Docker å»ç®¡ç†å¾ˆå¤šå¾ˆå¤šçš„æ•°æ®å·ã€‚è€Œæ‰€æœ‰çš„æ•°æ®å·ä¸€å®šéƒ½ä¼šæŒ‡å‘å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„ä¸€ä¸ªç›®å½•è¿™ä¸ªç›®å½•å°±æ˜¯ï¼švar/lib/docker/volumesã€‚</p>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310082048323.png\" alt=\"image-20231008204850370\" /></p>\n<blockquote>\n<p>æ¯”æ–¹è¯´æˆ‘ä»¬ç°åœ¨åˆ©ç”¨ Docker åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ•°æ®å·ï¼Œè¿™ä¸ªæ•°æ®å·çš„åå­—å« htmlï¼Œé‚£ä¹ˆ Docker ä¸€å®šä¼šåœ¨ /var/lib/docker/volumes æŒ‡å®šçš„å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸‹åˆ›å»ºå‡ºä¸€ä¸ª html çš„ç›®å½•</p>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310082050696.png\" alt=\"image-20231008205044637\" /></p>\n<blockquote>\n<p>æ¯”æ–¹è¯´æˆ‘åˆåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ•°æ®å· confï¼Œå®ƒåŒæ ·ä¼šåœ¨ docker æŒ‡å®šçš„ volumes ç›®å½•ä¸‹å†åˆ›å»ºä¸€ä¸ª conf çœŸæ˜¯ç›®å½•</p>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310082051742.png\" alt=\"image-20231008205151242\" /></p>\n<blockquote>\n<p>æ¯ä¸€ä¸ªæ•°æ®å·éƒ½è·Ÿä¸€ä¸ªçœŸæ˜¯ç›®å½•è¿›è¡Œæ˜ å°„ã€‚æ‰€ä»¥å¯ä»¥è®¤ä¸ºæ•°æ®å·æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„å¹¶ä¸çœŸå®å­˜åœ¨çš„ã€‚åªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œè€ŒçœŸæ­£æŒ‡å‘çš„æ˜¯ (å®¿ä¸»æœº) ç¡¬ç›˜ä¸Šçš„çœŸå®æ–‡ä»¶å¤¹</p>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310082053614.png\" alt=\"image-20231008205305336\" /></p>\n<blockquote>\n<p>å®¹å™¨åˆ›å»ºåå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ•°æ®å·ï¼Œnginx çš„å†…éƒ¨ç›®å½•ä¸æ•°æ®å·è¿›è¡Œå…³è”ï¼Œå½“å®¹å™¨ä¸­ nginx ä¸æ•°æ®å·è¿›è¡Œå…³è”æ—¶ï¼Œå®ƒçš„æœ¬è´¨å…¶å®æ˜¯å’Œå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„ html å’Œ conf ç›®å½•è¿›è¡Œå…³è”çš„ã€‚è¿™æ—¶ docker å°±ä¼šå»ç®¡ç†è¿™ä¸ªå®¹å™¨äº†ï¼Œæ¯”æ–¹è¯´åœ¨å®¹å™¨çš„ html ç›®å½•é‡Œå†™äº†ç‚¹ä»€ä¹ˆä¸œè¥¿ï¼Œè¿™äº›ä¸œè¥¿ä¼šç«‹å³å†™å…¥åˆ°å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿé‡Œã€‚è€Œåè¿‡æ¥å¦‚æœåœ¨å®¿ä¸»æœºé‡Œå¯¹ html ç›®å½•é‡ŒæŸä¸€ä¸ªæ–‡ä»¶è¿›è¡Œäº†ä¿®æ”¹é‚£ä¹ˆä¹Ÿä¼šç«‹å³ååº”åˆ°å®¹å™¨å†…çš„ html ç›®å½•ä¸­</p>\n<p>å¯ä»¥ç†è§£ä¸º å®¹å™¨ ä¸ å®¿ä¸»æœº ä¹‹é—´ çš„æ•°æ®åŒæ­¥æ˜¯é€šè¿‡æ•°æ®å·è¿™ä¸ªä¸­é—´æ¡¥æ¢å®Œæˆçš„</p>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310082056426.png\" alt=\"image-20231008205636159\" /></p>\n<blockquote>\n<p>è¿™æ—¶å°±å†ä¹Ÿä¸ç”¨è¿›å…¥å®¹å™¨å†…å»åšä¿®æ”¹äº†ç›´æ¥åœ¨å®¿ä¸»æœºé€šè¿‡é«˜çº§ç¼–è¾‘å·¥å…·è¿›è¡Œä¿®æ”¹</p>\n</blockquote>\n<h5 id=\"7571-æ•°æ®å…±äº«\"><a class=\"anchor\" href=\"#7571-æ•°æ®å…±äº«\">#</a> 7.5.7.1ã€æ•°æ®å…±äº«ğŸŒ´</h5>\n<p>å°†å¦ä¸€ä¸ªå®¹å™¨æŒ‚è½½åˆ°æ•°æ®å·çš„ç›®å½•ä¸Šä¹Ÿèƒ½è®¿é—®æ“ä½œé‡Œé¢çš„æ•°æ®å’Œé…ç½®çš„ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310082103306.png\" alt=\"image-20231008210328135\" /></p>\n<h5 id=\"7572-æ•°æ®å®‰å…¨åˆ é™¤é—®é¢˜\"><a class=\"anchor\" href=\"#7572-æ•°æ®å®‰å…¨åˆ é™¤é—®é¢˜\">#</a> 7.5.7.2ã€æ•°æ®å®‰å…¨åˆ é™¤é—®é¢˜ğŸŒ´</h5>\n<p>å°†å®¹å™¨åˆ é™¤ï¼Œæ•°æ®å·ä¸ä¼šè¢«åˆ é™¤ï¼Œè¿˜å¯ä»¥å°†æ–°çš„å®¹å™¨é‡æ–°æŒ‚è½½åˆ°æ•°æ®å·ä¸Šé‡Œé¢çš„é…ç½®å’Œæ•°æ®éƒ½å›æ¥äº†</p>\n<h5 id=\"7573-æ“ä½œæ•°æ®å·\"><a class=\"anchor\" href=\"#7573-æ“ä½œæ•°æ®å·\">#</a> 7.5.7.3ã€æ“ä½œæ•°æ®å·ğŸŒ´</h5>\n<p>æ•°æ®å·æ“ä½œçš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> volume<span class=\"token punctuation\">[</span>COMMAND<span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>docker volume å‘½ä»¤æ˜¯æ•°æ®å·æ“ä½œï¼Œæ ¹æ®å‘½ä»¤åè·Ÿéšçš„ command æ¥ç¡®å®šä¸‹ä¸€æ­¥çš„æ“ä½œï¼š</p>\n<ul>\n<li>create åˆ›å»ºä¸€ä¸ª volume</li>\n<li>inspect æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ª volume çš„ä¿¡æ¯</li>\n<li>ls åˆ—å‡ºæ‰€æœ‰çš„ volume</li>\n<li>prune åˆ é™¤æœªä½¿ç”¨çš„ volume</li>\n<li>rm åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šçš„ volume</li>\n</ul>\n<h6 id=\"75731-æ¡ˆä¾‹åˆ›å»ºä¸€ä¸ªæ•°æ®å·å¹¶æŸ¥çœ‹æ•°æ®å·åœ¨å®¿ä¸»æœºçš„ç›®å½•ä½ç½®\"><a class=\"anchor\" href=\"#75731-æ¡ˆä¾‹åˆ›å»ºä¸€ä¸ªæ•°æ®å·å¹¶æŸ¥çœ‹æ•°æ®å·åœ¨å®¿ä¸»æœºçš„ç›®å½•ä½ç½®\">#</a> 7.5.7.3.1ã€æ¡ˆä¾‹ï¼Œåˆ›å»ºä¸€ä¸ªæ•°æ®å·ï¼Œå¹¶æŸ¥çœ‹æ•°æ®å·åœ¨å®¿ä¸»æœºçš„ç›®å½•ä½ç½®ğŸ‹</h6>\n<p>1ã€åˆ›å»ºä¸€ä¸ªåä¸º html çš„æ•°æ®å·</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker volume create html</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>html</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>2ã€æŸ¥çœ‹åˆ›å»ºå¥½çš„æ•°æ®å· ä½¿ç”¨å‘½ä»¤åˆ—å‡ºæ‰€æœ‰çš„æ•°æ®å·</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker volume ls</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>DRIVER    VOLUME NAME</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">local</span>     2c26106500b13248f06d9d3d89e3f9cc4395f02bc013e4ad20ef405b504b1ca0</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">local</span>     96f2fa7ba9c8131ae29e9e046d86d33c48ba9a14ad145b42837e281c0f8a0c00</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token builtin class-name\">local</span>     356ef50e5c9ff24e07f8bcc1f9d581f41df05ce8688025f2294d2333fd86842b</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token builtin class-name\">local</span>     d3c6bed2dc6b02bd7755c7e20a02a6679d5bc1bdc08e302adb0615f6d68b3b3a</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token builtin class-name\">local</span>     html</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>3ã€æŸ¥çœ‹ html æ•°æ®å·çš„æ‰€åœ¨ç›®å½•</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker inspect html</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"CreatedAt\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2023-10-08T20:59:39-04:00\"</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token string\">\"Driver\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"local\"</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token string\">\"Labels\"</span><span class=\"token builtin class-name\">:</span> null,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\"># å­˜å‚¨ç›®å½•ï¼Œä¹Ÿå°±æ˜¯æŒ‚è½½ç‚¹</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token string\">\"Mountpoint\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"/var/lib/docker/volumes/html/_data\"</span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token string\">\"Name\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"html\"</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token string\">\"Options\"</span><span class=\"token builtin class-name\">:</span> null,</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token string\">\"Scope\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"local\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>4ã€ä½¿ç”¨ prune ç§»é™¤æœ¬åœ°æœªä½¿ç”¨çš„æ•°æ®å·</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker volume prune</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>WARNING<span class=\"token operator\">!</span> This will remove anonymous <span class=\"token builtin class-name\">local</span> volumes not used by at least one container.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Are you sure you want to continue? <span class=\"token punctuation\">[</span>y/N<span class=\"token punctuation\">]</span> y</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Deleted Volumes:</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>2c26106500b13248f06d9d3d89e3f9cc4395f02bc013e4ad20ef405b504b1ca0</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>96f2fa7ba9c8131ae29e9e046d86d33c48ba9a14ad145b42837e281c0f8a0c00</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>d3c6bed2dc6b02bd7755c7e20a02a6679d5bc1bdc08e302adb0615f6d68b3b3a</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Total reclaimed space: 0B</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>5ã€ä½¿ç”¨ docker volume ls åˆ—å‡ºæ‰€æœ‰çš„æ•°æ®å·</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker volume ls</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>DRIVER    VOLUME NAME</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">local</span>     356ef50e5c9ff24e07f8bcc1f9d581f41df05ce8688025f2294d2333fd86842b</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">local</span>     html</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>å°‘äº†ä¸€äº›æ•°æ®å·é‚£äº›è¢«ç§»é™¤äº†</p>\n<p>6ã€ä½¿ç”¨ rm åˆ é™¤ä¸€ä¸ªæŒ‡å®šçš„æ•°æ®å·ï¼Œå¦‚æœæ— æ³•åˆ é™¤å¯ä»¥åŠ ä¸Šå‚æ•° -f å¼ºåˆ¶åˆ é™¤</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker volume rm html</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>html</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker volume ls</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>DRIVER    VOLUME NAME</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token builtin class-name\">local</span>     356ef50e5c9ff24e07f8bcc1f9d581f41df05ce8688025f2294d2333fd86842b</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><blockquote>\n<p>æ•°æ®å·çš„ä½œç”¨ï¼š</p>\n<ul>\n<li>j å°†å®¹å™¨ä¸æ•°æ®åˆ†ç¦»ï¼Œè§£è€¦åˆï¼Œæ–¹ä¾¿æ“ä½œå®¹å™¨å†…æ•°æ®ï¼Œä¿è¯æ•°æ®å®‰å…¨</li>\n</ul>\n<p>æ•°æ®å·æ“ä½œï¼š</p>\n<ul>\n<li><code>docker volume create [åç§°]</code>  åˆ›å»ºä¸€ä¸ªæ•°æ®å·</li>\n<li><code>docker volume ls</code>  åˆ—å‡ºæ‰€æœ‰å­˜åœ¨çš„æ•°æ®å·</li>\n<li><code>docker volume inspect [åç§°]</code>  æŸ¥çœ‹æŒ‡å®šæ•°æ®å·çš„è¯¦ç»†ä¿¡æ¯æˆ–æ‰€åœ¨ç›®å½•</li>\n<li><code>docker volume rm [åç§°]</code>  åˆ é™¤æŒ‡å®šçš„æ•°æ®å·ï¼Œå¯ä»¥åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œå¯ä»¥å¼ºåˆ¶åˆ é™¤</li>\n<li><code>docker volume prune</code>  ç§»é™¤æœªä½¿ç”¨çš„æ•°æ®å·</li>\n</ul>\n</blockquote>\n<h5 id=\"7574-æŒ‚è½½æ•°æ®å·\"><a class=\"anchor\" href=\"#7574-æŒ‚è½½æ•°æ®å·\">#</a> 7.5.7.4ã€æŒ‚è½½æ•°æ®å·ğŸŒ´</h5>\n<p>æˆ‘ä»¬åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œå¯ä»¥é€šè¿‡  <code>-v</code>  å‚æ•°æ¥æŒ‚è½½ä¸€ä¸ªæ•°æ®å·åˆ°æŸä¸ªå®¹å™¨ç›®å½•</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310090914664.png\" alt=\"image-20231009091445924\" /></p>\n<p>è¿™é‡Œé¢å”¯ä¸€æ²¡è§è¿‡çš„å°±æ˜¯  <code>-v</code>  å‚æ•°äº†ï¼Œè§£é‡Šå¦‚ä¸‹ï¼š</p>\n<p>å‰åŠéƒ¨åˆ†çš„ html ä¸ºæ•°æ®å·ï¼šååŠéƒ¨åˆ†ä¸ºå®¹å™¨å†…çš„ç›®å½•ã€‚</p>\n<p>è¿™è¡Œå‘½ä»¤çš„æ„æ€å°±æ˜¯å°†åä¸º html çš„æ•°æ®å·æŒ‚è½½åˆ°å®¹å™¨å†…çš„ /root/html ç›®å½•ä¸‹</p>\n<h6 id=\"75741-æ¡ˆä¾‹åˆ›å»ºä¸€ä¸ªnginxå®¹å™¨ä¿®æ”¹å®¹å™¨å†…çš„htmlç›®å½•å†…çš„indexhtmlå†…å®¹\"><a class=\"anchor\" href=\"#75741-æ¡ˆä¾‹åˆ›å»ºä¸€ä¸ªnginxå®¹å™¨ä¿®æ”¹å®¹å™¨å†…çš„htmlç›®å½•å†…çš„indexhtmlå†…å®¹\">#</a> 7.5.7.4.1ã€æ¡ˆä¾‹ï¼Œåˆ›å»ºä¸€ä¸ª Nginx å®¹å™¨ï¼Œä¿®æ”¹å®¹å™¨å†…çš„ html ç›®å½•å†…çš„ index.html å†…å®¹ğŸ‹</h6>\n<blockquote>\n<p><strong>éœ€æ±‚è¯´æ˜</strong>ï¼š</p>\n<p>ä¸Šä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬è¿›å…¥ nginx å®¹å™¨å†…éƒ¨ï¼Œå·²ç»çŸ¥é“ nginx çš„ html ç›®å½•æ‰€åœ¨ä½ç½® /user/share/nginx/html ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªç›®å½•æŒ‚è½½åˆ° html è¿™ä¸ªæ•°æ®å·ä¸Šï¼Œæ–¹ä¾¿æ“ä½œå…¶ä¸­çš„å†…å®¹ã€‚</p>\n</blockquote>\n<p><strong>æç¤º</strong>ï¼šè¿è¡Œå®¹å™¨æ—¶ä½¿ç”¨  <code>-v</code>  å‚æ•°æŒ‚è½½æ•°æ®å·</p>\n<p><strong>æ­¥éª¤</strong>ï¼š</p>\n<p>&lt;font color='red'&gt; æé†’ &lt;/font&gt;ï¼šå¦‚æœæ•°æ®å·ä¸å­˜åœ¨åœ¨åˆ›å»ºå®¹å™¨çš„æ—¶å€™é‡Œé¢ <code>-v</code>  å‚æ•°æ‰§è¡Œæ•°æ®å·å°±ä¼šè‡ªåŠ¨è¢«åˆ›å»º</p>\n<p>1ã€åˆ›å»ºå®¹å™¨å¹¶æŒ‚è½½æ•°æ®å·åˆ°å®¹å™¨å†…çš„ HTML ç›®å½•</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker run --name mn -p 80:80 -v html:/usr/share/nginx/html -d nginx</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a4e6d36a4c1ccb8948d93990839244207cb1db9856a607680350871c13fc7458</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker ps</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS        PORTS                               NAMES</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>a4e6d36a4c1c   nginx     <span class=\"token string\">\"/docker-entrypoint.â€¦\"</span>   <span class=\"token number\">2</span> seconds ago   Up <span class=\"token number\">1</span> second   <span class=\"token number\">0.0</span>.0.0:80-<span class=\"token operator\">></span><span class=\"token number\">80</span>/tcp, :::80-<span class=\"token operator\">></span><span class=\"token number\">80</span>/tcp   mn</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>2ã€è¿›å…¥ html æ•°æ®å·æ‰€åœ¨ä½ç½®ï¼Œå¹¶ä¿®æ”¹ HTML å†…å®¹</p>\n<p>2.1ã€é¦–å…ˆçœ‹ä¸€ä¸‹ html æ•°æ®å·çš„å…·ä½“ä½ç½®</p>\n<p>2.2ã€è¿›å…¥åˆ°ç›®å½•</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker volume inspect html</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"CreatedAt\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2023-10-08T21:26:51-04:00\"</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token string\">\"Driver\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"local\"</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token string\">\"Labels\"</span><span class=\"token builtin class-name\">:</span> null,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token string\">\"Mountpoint\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"/var/lib/docker/volumes/html/_data\"</span>,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token string\">\"Name\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"html\"</span>,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token string\">\"Options\"</span><span class=\"token builtin class-name\">:</span> null,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token string\">\"Scope\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"local\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /var/lib/docker/volumes/html/_data</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost _data<span class=\"token punctuation\">]</span><span class=\"token comment\"># </span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost _data<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls -ahl</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>total <span class=\"token number\">8</span>.0K</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>drwxr-xr-x. <span class=\"token number\">2</span> root root  <span class=\"token number\">40</span> Oct  <span class=\"token number\">9</span> 02:54 <span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>drwx-----x. <span class=\"token number\">3</span> root root  <span class=\"token number\">19</span> Oct  <span class=\"token number\">8</span> <span class=\"token number\">21</span>:26 <span class=\"token punctuation\">..</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>-rw-r--r--. <span class=\"token number\">1</span> root root <span class=\"token number\">497</span> Aug <span class=\"token number\">15</span> <span class=\"token number\">13</span>:03 50x.html</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>-rw-r--r--. <span class=\"token number\">1</span> root root <span class=\"token number\">615</span> Aug <span class=\"token number\">15</span> <span class=\"token number\">13</span>:03 index.html</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost _data<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091459700.png\" alt=\"image-20231009145716659\" /></p>\n<p>æˆ‘ä»¬å¯ä»¥å³é”® index.html ç›´æ¥åœ¨ windows ä¸Šè¿›è¡Œä¿®æ”¹ç„¶åä¿å­˜é‚£ä¹ˆ nginx å®¹å™¨å†…çš„ index.html ä¹Ÿå°±è¢«ä¿®æ”¹äº†</p>\n<p>æ”¹å®Œä¿å­˜åè¿™ä¸ªå·¥å…·ä¼šæç¤ºæ˜¯å¦ä¿å­˜åˆ° Linux ç³»ç»Ÿä¸­ index æ–‡ä»¶å»è¿˜æ˜¯å¾ˆæ™ºèƒ½çš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091505065.png\" alt=\"image-20231009150527902\" /></p>\n<p>ä¸‹é¢å°±æ˜¯ä¿®æ”¹äº†å†…å®¹æˆåŠŸäº†ï¼Œä½†æ˜¯ä¹±ç </p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091505224.png\" alt=\"image-20231009150556316\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>æ•°æ®å·æŒ‚è½½æ–¹å¼ï¼š</p>\n<ul>\n<li><code>-v volumeName: /targetContainerPath</code></li>\n<li>å¦‚æœå®¹å™¨è¿è¡Œæ—¶ volume ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨è¢«åˆ›å»ºå‡ºæ¥</li>\n</ul>\n</blockquote>\n<p>é€šè¿‡æ¡ˆä¾‹æ¼”ç¤ºå®¿ä¸»æœºç›´æ¥ä¸å®¹å™¨è¿›è¡ŒæŒ‚è½½</p>\n<h6 id=\"75742-å®¿ä¸»æœºç›´æ¥ä¸å®¹å™¨è¿›è¡ŒæŒ‚è½½\"><a class=\"anchor\" href=\"#75742-å®¿ä¸»æœºç›´æ¥ä¸å®¹å™¨è¿›è¡ŒæŒ‚è½½\">#</a> 7.5.7.4.2ã€å®¿ä¸»æœºç›´æ¥ä¸å®¹å™¨è¿›è¡ŒæŒ‚è½½ğŸ‹</h6>\n<p>æ¡ˆä¾‹ï¼Œåˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ª MYSQL å®¹å™¨ï¼Œå°†å®¿ä¸»æœºç›®å½•ç›´æ¥æŒ‚è½½åˆ°å®¹å™¨</p>\n<p>æç¤ºï¼šç›®å½•æŒ‚è½½ä¸æ•°æ®å·æŒ‚è½½çš„è¯­æ³•æ˜¯ç±»ä¼¼çš„ï¼š</p>\n<ul>\n<li><code>-v [å®¿ä¸»æœºç›®å½•]:[å®¹å™¨ç›®å½•]</code></li>\n<li><code>-v [å®¿ä¸»æœºæ–‡ä»¶]:[å®¹å™¨å†…æ–‡ä»¶]</code></li>\n</ul>\n<p>å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p>\n<p>1ã€åœ¨å°†è¯¾å‰èµ„æ–™ä¸­çš„ mysql.tar æ–‡ä»¶ä¸Šä¼ åˆ°è™šæ‹Ÿæœºï¼Œé€šè¿‡ load å‘½ä»¤åŠ è½½ä¸ºé•œåƒ</p>\n<p>æ“ä½œï¼šç›´æ¥æ‹–è¿›å»å³å¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091539535.png\" alt=\"image-20231009153911060\" /></p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost tmp<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker load -i mysql.tar</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>5dacd731af1b: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">58</span>.45MB/58.45MB</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>f411d8bde01c: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">338</span>.4kB/338.4kB</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>0aa7d65147ef: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">10</span>.44MB/10.44MB</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>3437f67a712b: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">4</span>.472MB/4.472MB</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>ec41e34b35a0: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">1</span>.536kB/1.536kB</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>458d25c646d8: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">46</span>.15MB/46.15MB</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>97874ea0e7f9: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">31</span>.74kB/31.74kB</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>5075b9328698: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">3</span>.584kB/3.584kB</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>364557e875f1: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">257</span>.3MB/257.3MB</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>9209148debed: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">9</span>.728kB/9.728kB</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>82582edf9553: Loading layer <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span>  <span class=\"token number\">1</span>.536kB/1.536kB</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>Loaded image: mysql:5.7.25</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost tmp<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost tmp<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker images</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>nginx        latest    61395b4c586d   <span class=\"token number\">2</span> weeks ago   187MB</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>redis        latest    7c4b517da47d   <span class=\"token number\">4</span> weeks ago   153MB</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>mysql        <span class=\"token number\">5.7</span>.25    98455b9624a9   <span class=\"token number\">4</span> years ago   372MB</pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost tmp<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>2ã€åˆ›å»ºç›®å½• /tem/mysql/data</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost tmp<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir -p mysql/data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost tmp<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir -p mysql/conf</span></pre></td></tr></table></figure><p>3ã€åˆ›å»ºç›®å½• /tmp/mysql/confï¼Œå°†è¯¾å‰èµ„æ–™æä¾›çš„ hmy.cnf æ–‡ä»¶ä¸Šä¼ åˆ° /tmp/mysql/conf</p>\n<p>hmy.conf é…ç½®æ–‡ä»¶å†…å®¹ï¼š</p>\n<pre><code>[mysqld]\nskip-name-resolve\ncharacter_set_server=utf8\ndatadir=/var/lib/mysql\nserver-id=1000\n</code></pre>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091545686.png\" alt=\"image-20231009154459349\" /></p>\n<p>4ã€å» DockerHub æŸ¥é˜…èµ„æ–™ï¼Œåˆ›å»ºå¹¶è¿è¡Œ MySQL å®¹å™¨</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token parameter variable\">--name</span> some-mysql <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># ç¯å¢ƒå˜é‡ environment variables è®¾ç½® mysql å¯†ç </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">MYSQL_ROOT_PASSWORD</span><span class=\"token operator\">=</span><span class=\"token number\">123</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># è®¾ç½®å®¿ä¸»æœºä¸å®¹å™¨çš„ç«¯å£éƒ½ä¸º 3306</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token parameter variable\">-p</span> <span class=\"token number\">3306</span>:3306</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># æŒ‚è½½é…ç½®æ–‡ä»¶ç›®å½•ï¼Œå‰é¢æ˜¯å®¿ä¸»æœºç›®å½•åé¢æ˜¯å®¹å™¨å†…çš„é…ç½®æ–‡ä»¶ç›®å½•å¯ä»¥å»å®˜ç½‘æŸ¥çœ‹</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token parameter variable\">-v</span> /tmp/mysql/conf/hmy.cnf:/etc/mysql/conf.d/hmy.cnf <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># æŒ‚è½½æ•°æ®ç›®å½•</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token parameter variable\">-v</span> /tmp/mysql/data:/var/lib/mysql <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token parameter variable\">-d</span> mysql:5.7.25</pre></td></tr></table></figure><p>å¯å¤åˆ¶å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token parameter variable\">--name</span> some-mysql <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">MYSQL_ROOT_PASSWORD</span><span class=\"token operator\">=</span><span class=\"token number\">123</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token parameter variable\">-p</span> <span class=\"token number\">3306</span>:3306 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token parameter variable\">-v</span> /tmp/mysql/conf/hmy.cnf:/etc/mysql/conf.d/hmy.cnf <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token parameter variable\">-v</span> /tmp/mysql/data:/var/lib/mysql <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token parameter variable\">-d</span> mysql:5.7.25</pre></td></tr></table></figure><p>my.conf å°±æ˜¯ mysql çš„é»˜è®¤é…ç½®æ–‡ä»¶äº†ä½†æ˜¯å¹¶ä¸å»ºè®®å»è¦†ç›–å®ƒï¼Œå®ƒé‡Œé¢ä¸œè¥¿å¾ˆå¤šï¼Œæˆ‘ä»¬åªæ˜¯å¸Œæœ›è¦ç®€åŒ–çš„é…ç½® ä¸‹é¢æ–‡æ¡£è¯´ï¼Œmy.conf é…ç½®æ–‡ä»¶é‡ŒåŒ…å«äº†ä¸¤ä¸ªç›®å½•ä¸€ä¸ªæ˜¯ /etc/mysql/conf.d æˆ– /etc/mysql/mysql/conf.d å…¶ä¸­.d åç¼€å°±æ˜¯ç›®å½•çš„æ„æ€ï¼Œå› æ­¤æ”¾åˆ°è¿™ä¸¤ä¸ªåŒ…å«çš„ç›®å½•é‡Œé¢çš„ä¸€åˆ‡æ–‡ä»¶éƒ½ä¼šè¢«åŠ è½½åˆ°ä¸€èµ·ä½œä¸ºåˆå¹¶é…ç½®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091602833.png\" alt=\"image-20231009160248603\" /></p>\n<p>è¦æ±‚ï¼š</p>\n<ol>\n<li>æŒ‚è½½ /tmp/myql/data åˆ° mysql å®¹å™¨å†…æ•°æ®å­˜å‚¨åˆ°ç›®å½•</li>\n<li>æŒ‚è½½ /tmp/myql/conf/hmy/cnf åˆ° mysql å®¹å™¨çš„é…ç½®æ–‡ä»¶</li>\n<li>è®¾ç½® MySQL å¯†ç </li>\n</ol>\n<p>æ‰“å¼€é“¾æ¥ mysql çš„å·¥å…·è¿›è¡Œè¿æ¥ï¼Œè¿æ¥çš„æ˜¯ Linux ä¸­çš„ mysql</p>\n<p>è¿æ¥å¯†ç æ˜¯ä¸Šé¢åˆ›å»ºå®¹å™¨çš„æ—¶å€™çš„å¯†ç ä¹Ÿå°±æ˜¯ 123</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091640299.png\" alt=\"image-20231009164005163\" /></p>\n<p>è¿æ¥æˆåŠŸï¼</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091640185.png\" alt=\"image-20231009164040831\" /></p>\n<p>æŸ¥çœ‹å®¿ä¸»æœºçš„ data ç›®å½•å¯ä»¥çœ‹åˆ°é‡Œé¢çš„ mysql æ•°æ®å°±å…¨éƒ½å†™è¿›æ¥äº†</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>âœ  /tmp <span class=\"token builtin class-name\">cd</span> mysql/data</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>âœ  data <span class=\"token function\">ls</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>auto.cnf    ca.pem           client-key.pem  ibdata1      ib_logfile1  mysql               private_key.pem  server-cert.pem  sys</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>ca-key.pem  client-cert.pem  ib_buffer_pool  ib_logfile0  ibtmp1       performance_schema  public_key.pem   server-key.pem</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>âœ  data</pre></td></tr></table></figure><h5 id=\"7575-æ•°æ®å·æŒ‚è½½å’Œç›®å½•ç›´æ¥æŒ‚è½½çš„åŒºåˆ«\"><a class=\"anchor\" href=\"#7575-æ•°æ®å·æŒ‚è½½å’Œç›®å½•ç›´æ¥æŒ‚è½½çš„åŒºåˆ«\">#</a> 7.5.7.5ã€æ•°æ®å·æŒ‚è½½å’Œç›®å½•ç›´æ¥æŒ‚è½½çš„åŒºåˆ«ğŸŒ´</h5>\n<p>å½“æˆ‘ä»¬ç”¨æ•°æ®å·æ—¶ï¼ŒDocker ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åˆ›å»ºæ•°æ®å·å¯¹åº”çš„ç›®å½•ï¼Œè¿™æ ·æ•°æ®å·å°±æŒ‡å‘äº†å®¿ä¸»æœºçš„ html ç›®å½•ã€‚è€Œ Docker æŒ‚è½½æ—¶åªéœ€è¦æŒ‚è½½åˆ°æ•°æ®å·çš„ html ç›®å½•ä¸Šå°±å¯ä»¥äº†ã€‚å®ƒä¸éœ€è¦å…³ç³»å®¿ä¸»æœºçš„ html ç›®å½•åœ¨å“ªé‡Œï¼Œè¿™ç§æ–¹å¼ç­‰äºå…¨æƒäº¤ç»™äº† Docker å»å¤„ç†</p>\n<p>è¿™æ˜¯æ•°æ®å·æŒ‚è½½çš„ä¼˜åŠ¿ï¼Œä½†æ˜¯åŠ£åŠ¿å‘¢ï¼Ÿ</p>\n<p>åŠ£åŠ¿å°±æ˜¯ï¼Œç›®å½•ä¸æ˜¯æˆ‘ä»¬åˆ›å»ºçš„ï¼Œåˆ°å“ªåˆ›å»ºäº†æˆ‘ä»¬ä¹Ÿä¸çŸ¥é“ç›®å½•ç»“æ„ä¹Ÿæ¯”è¾ƒæ·±æƒ³å»æ‰¾æ¯”è¾ƒéº»çƒ¦</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091651091.png\" alt=\"image-20231009165142878\" /></p>\n<p>è€Œç¬¬äºŒç§æ–¹å¼ç›´æ¥æŒ‚è½½ï¼Œå®¿ä¸»æœºç›®å½•æ˜¯æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„ï¼Œåˆ›å»ºç›®å½•çš„æ—¶å€™æŒºéº»çƒ¦çš„ä½†æ˜¯è‡ªå·±çŸ¥é“è¿™ä¸ªç›®å½•åœ¨å“ªï¼Œå°†æ¥æŒ‚è½½çš„æ—¶å€™ä¹Ÿæ²¡æœ‰äººå¸®æˆ‘åšä»€ä¹ˆä»£ç†ã€‚æˆ‘ç›´æ¥æŒ‚ä¸Šå»å°±è¡Œäº†ã€‚å› æ­¤æˆ‘æƒ³å¿«é€Ÿå®šä½è¿™ä¸ªæ–‡ä»¶åœ¨å“ªå°±å¯ä»¥ä¸€ç›®äº†ç„¶ï¼Œè¿™å°±æ˜¯ç›´æ¥æŒ‚è½½çš„ä¼˜åŠ¿ï¼ŒåŠ£åŠ¿å°±æ˜¯è‡ªå·±æŒ‚è½½</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091654555.png\" alt=\"image-20231009165439938\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>:</p>\n<ol>\n<li>docker run çš„å‘½ä»¤é€šè¿‡ -v å‚æ•°æŒ‚è½½æ–‡ä»¶æˆ–ç›®å½•åˆ°å®¹å™¨ä¸­ï¼š\n<ol>\n<li><code>-v volume [åç§°]</code>  ï¼šå®¹å™¨å†…ç›®å½•</li>\n<li><code>-v</code>  å®¿ä¸»æœºæ–‡ä»¶ï¼šå®¹å™¨å†…æ–‡ä»¶</li>\n<li><code>-v</code>  å®¿ä¸»æœºç›®å½•ï¼šå®¹å™¨å†…ç›®å½•</li>\n</ol>\n</li>\n<li>æ•°æ®å·æŒ‚è½½ä¸ç›®å½•ç›´æ¥æŒ‚è½½çš„åŒºåˆ«ï¼š\n<ol>\n<li>æ•°æ®å·æŒ‚è½½è€¦åˆåº¦ä½ï¼Œç”± docker æ¥ç®¡ç†ç›®å½•ï¼Œä½†æ˜¯ç›®å½•è¾ƒæ·±ï¼Œä¸å¥½æ‰¾</li>\n<li>ç›®å½•ç›´æ¥æŒ‚è½½è€¦åˆåº¦é«˜ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±ç®¡ç†ç›®å½•ï¼Œä¸è¿‡ç›®å½•å®¹æ˜“æ‰¾åˆ°</li>\n</ol>\n</li>\n</ol>\n</blockquote>\n<h3 id=\"76-dockerfileè‡ªå®šä¹‰é•œåƒ\"><a class=\"anchor\" href=\"#76-dockerfileè‡ªå®šä¹‰é•œåƒ\">#</a> 7.6ã€Dockerfile è‡ªå®šä¹‰é•œåƒğŸŒ³</h3>\n<h4 id=\"è‡ªå®šä¹‰é•œåƒ\"><a class=\"anchor\" href=\"#è‡ªå®šä¹‰é•œåƒ\">#</a> è‡ªå®šä¹‰é•œåƒ</h4>\n<h5 id=\"761-é•œåƒç»“æ„\"><a class=\"anchor\" href=\"#761-é•œåƒç»“æ„\">#</a> 7.6.1ã€é•œåƒç»“æ„ğŸŒ´</h5>\n<ul>\n<li>é•œåƒæ˜¯å°†åº”ç”¨ç¨‹åºåŠå…¶éœ€è¦çš„ç³»ç»Ÿå‡½æ•°åº“ï¼Œç¯å¢ƒï¼Œé…ç½®ï¼Œä¾èµ–æ‰“åŒ…è€Œæˆã€‚</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091711487.png\" alt=\"image-20231009171118975\" /></p>\n<p>å¦‚æœè¦åˆ¶ä½œä¸€ä¸ªé•œåƒï¼Œå°±ä¸€å®šè¦å…ˆäº†è§£å®ƒå†…éƒ¨çš„æ„æˆ</p>\n<p>ä¸Šé¢è¯´åˆ°é•œåƒå°±æ˜¯ç³»ç»Ÿå‡½æ•°åº“ï¼Œç¯å¢ƒï¼Œé…ç½®ï¼Œä¾èµ–ç»„æˆçš„ï¼Œè€Œä¸”å®ƒä»¬ä¹‹é—´æœ‰ç›¸äº’ä¹‹é—´çš„ä¾èµ–å…³ç³»æˆ–è€…é¡ºåºã€‚é•œåƒä¸ä»…ä»…æ˜¯æŠŠä¸€å¯¹ä¸œè¥¿ç»„åˆåœ¨ä¸€èµ·è€Œä¸”è¿˜è¦æŒ‰ç…§ä¸€å®šé¡ºåºå»ç¿»å±‚</p>\n<p>ä¸‹é¢ä»¥ mysql ä¸ºä¾‹è®²è®²é•œåƒç»“æ„ï¼Œæˆ‘ä»¬æŠŠ mysql ç»“æ„æ‰“æ•£</p>\n<p>ä¸‹å›¾ä¸­ mysql é•œåƒç»“æ„åˆ†æˆäº† n å±‚ï¼Œå®ƒå°±æ˜¯æŒ‰ç…§ä¸Šé¢çš„ä¾èµ–é¡ºåºæ¥åˆ†å±‚çš„ï¼Œè¦æƒ³æ„å»ºä¸€ä¸ªé•œåƒï¼Œæœ€åº•å±‚ä¸€å®šæ˜¯å®ƒæ‰€åœ¨çš„ç³»ç»Ÿå‡½æ•°åº“ï¼Œè€Œæœ€ä¸‹é¢å°±æ˜¯ç”¨äº† Ubuntu æ“ä½œç³»ç»Ÿï¼ŒæŠŠ mysql å®‰è£…åŒ…æ‹·è´ä¸‹æ¥ç„¶ååœ¨æ­¤åŸºäºä¸Šä½¿ç”¨ rpm è¿›è¡Œå®‰è£… mysqlï¼Œå®‰è£…å®Œäº†è¿›è¡Œé…ç½®æ–‡ä»¶çš„é…ç½®ç­‰ç­‰ï¼Œæ‰€æœ‰çš„å®‰è£…é…ç½®å®Œæµç¨‹å°±å®Œæˆçš„å·®ä¸å¤šäº†ï¼Œè¿˜å·®ä¸€ä¸ªå…¥å£ Entrypoint é€šè¿‡è¿™ä¸ªå…¥å£å¯åŠ¨ç¨‹åºçš„ï¼Œè¿™å°±æ˜¯é•œåƒçš„æ„æˆæµç¨‹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091724288.png\" alt=\"image-20231009172404559\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>é•œåƒæ˜¯åˆ†å±‚ç»“æ„ï¼Œæ¯ä¸€å±‚ç§°ä¸ºä¸€ä¸ª Layer</p>\n<ul>\n<li>BaseImage å±‚ï¼šåŒ…å«åŸºæœ¬çš„ç³»ç»Ÿå‡½æ•°åº“ï¼Œç¯å¢ƒå˜é‡ï¼Œæ–‡ä»¶ç³»ç»Ÿ</li>\n<li>Entrypointï¼šå…¥å£ï¼Œæ˜¯é•œåƒä¸­åº”ç”¨å¯åŠ¨çš„å‘½ä»¤</li>\n<li>å…¶å®ƒï¼šåœ¨ BaseImage åŸºç¡€ä¸Šæ·»åŠ ä¾èµ–ï¼Œå®‰è£…ç¨‹åºï¼Œå®Œæˆæ•´ä¸ªåº”ç”¨çš„å®‰è£…å’Œé…ç½®</li>\n</ul>\n</blockquote>\n<h3 id=\"762-ä»€ä¹ˆæ˜¯dockerfile\"><a class=\"anchor\" href=\"#762-ä»€ä¹ˆæ˜¯dockerfile\">#</a> 7.6.2ã€ä»€ä¹ˆæ˜¯ DockerfileğŸŒ²</h3>\n<p>Dockerfile å°±æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªä¸ªçš„æŒ‡ä»¤ (Instruction) ï¼Œç”¨æŒ‡ä»¤æ¥è¯´æ˜è¦æ‰§è¡Œä»€ä¹ˆæ“ä½œæ¥æ„å»ºé•œåƒã€‚æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šå½¢æˆä¸€å±‚ Layer</p>\n<table>\n<thead>\n<tr>\n<th>æŒ‡ä»¤</th>\n<th>è¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>FROM</td>\n<td>æŒ‡å®šåŸºç¡€é•œåƒ</td>\n<td>FROM centos:6</td>\n</tr>\n<tr>\n<td>ENV</td>\n<td>è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå¯åœ¨åé¢æŒ‡ä»¤ä½¿ç”¨</td>\n<td>ENV key value</td>\n</tr>\n<tr>\n<td>COPY</td>\n<td>æ‹·è´æœ¬åœ°æ–‡ä»¶åˆ°é•œåƒçš„æŒ‡å®šç›®å½•</td>\n<td>COPY ./mysql-5.7.rpm /tmp</td>\n</tr>\n<tr>\n<td>RUN</td>\n<td>æ‰§è¡Œ Linux çš„ shell å‘½ä»¤ï¼Œä¸€èˆ¬æ˜¯å®‰è£…è¿‡ç¨‹çš„å‘½ä»¤</td>\n<td>RUN yum install gcc</td>\n</tr>\n<tr>\n<td>EXPOSE</td>\n<td>æŒ‡å®šå®¹å™¨è¿è¡Œæ—¶ç›‘å¬çš„ç«¯å£ï¼Œæ˜¯ç»™é•œåƒä½¿ç”¨è€…çœ‹çš„</td>\n<td>EXPOSE 8080</td>\n</tr>\n<tr>\n<td>ENTPYOINT</td>\n<td>é•œåƒä¸­åº”ç”¨çš„å¯åŠ¨å‘½ä»¤ï¼Œå®¹å™¨è¿è¡Œæ—¶è°ƒç”¨</td>\n<td>ENTPYPOINT java -jar x</td>\n</tr>\n</tbody>\n</table>\n<p>æ›´æ–°è¯¦ç»†è¯­æ³•è¯´æ˜ï¼Œè¯·å‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVy\">https://docs.docker.com/engine/reference/builder</span></p>\n<h3 id=\"763-æ¡ˆä¾‹åŸºäºubuntué•œåƒæ„å»ºä¸€ä¸ªæ–°é•œåƒè¿è¡Œä¸€ä¸ªjavaé¡¹ç›®\"><a class=\"anchor\" href=\"#763-æ¡ˆä¾‹åŸºäºubuntué•œåƒæ„å»ºä¸€ä¸ªæ–°é•œåƒè¿è¡Œä¸€ä¸ªjavaé¡¹ç›®\">#</a> 7.6.3ã€æ¡ˆä¾‹ï¼ŒåŸºäº Ubuntu é•œåƒæ„å»ºä¸€ä¸ªæ–°é•œåƒï¼Œè¿è¡Œä¸€ä¸ª java é¡¹ç›®ğŸŒ²</h3>\n<p>æ­¥éª¤ï¼š</p>\n<p>1ã€æ–°å»ºä¸€ä¸ªç©ºæ–‡ä»¶å¤¹ docker-demo</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>âœ  /tmp <span class=\"token function\">mkdir</span> docker-demo</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>âœ  /tmp <span class=\"token builtin class-name\">cd</span> docker-demo</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>âœ  docker-demo l</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>total <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>drwxrwxr-x.  <span class=\"token number\">2</span> dkx  dkx    <span class=\"token number\">6</span> Oct  <span class=\"token number\">9</span> 05:52 <span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>drwxrwxrwt. <span class=\"token number\">11</span> root root <span class=\"token number\">228</span> Oct  <span class=\"token number\">9</span> 05:52 <span class=\"token punctuation\">..</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>âœ  docker-demo</pre></td></tr></table></figure><p>2ã€æ‹·è´ docker-demo.jar æ–‡ä»¶åˆ° docker-demo è¿™ä¸ªç›®å½•ä¸­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091756545.png\" alt=\"image-20231009175606996\" /></p>\n<p>3ã€æ‹·è´ jdk8.tar.gz æ–‡ä»¶åˆ° docker-demo è¿™ä¸ªç›®å½•</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091801025.png\" alt=\"image-20231009180127529\" /></p>\n<p>4ã€æ‹·è´ Dockerfile åˆ° docker-demo ç›®å½•</p>\n<p>Dockerfile å†…å®¹</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># æŒ‡å®šåŸºç¡€é•œåƒ</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>FROM ubuntu:16.04</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># é…ç½®ç¯å¢ƒå˜é‡ï¼ŒJDK çš„å®‰è£…ç›®å½•</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>ENV <span class=\"token assign-left variable\">JAVA_DIR</span><span class=\"token operator\">=</span>/usr/local</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># æ‹·è´ jdk å’Œ java é¡¹ç›®çš„åŒ…</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>COPY ./jdk8.tar.gz <span class=\"token variable\">$JAVA_DIR</span>/</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>COPY ./docker-demo.jar /tmp/app.jar</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># å®‰è£… JDK</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>RUN <span class=\"token builtin class-name\">cd</span> <span class=\"token variable\">$JAVA_DIR</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">tar</span> <span class=\"token parameter variable\">-xf</span> ./jdk8.tar.gz <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">mv</span> ./jdk1.8.0_144 ./java8</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># é…ç½®ç¯å¢ƒå˜é‡</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>ENV <span class=\"token assign-left variable\">JAVA_HOME</span><span class=\"token operator\">=</span><span class=\"token variable\">$JAVA_DIR</span>/java8</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>ENV <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token environment constant\">$PATH</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$JAVA_HOME</span>/bin</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\"># æš´éœ²ç«¯å£</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>EXPOSE <span class=\"token number\">8090</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\"># å…¥å£ï¼Œjava é¡¹ç›®çš„å¯åŠ¨å‘½ä»¤</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>ENTRYPOINT <span class=\"token function\">java</span> <span class=\"token parameter variable\">-jar</span> /tmp/app.jar</pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091802428.png\" alt=\"image-20231009180246866\" /></p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>âœ  docker-demo ll</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>total 202M</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>-rw-r--r--. <span class=\"token number\">1</span> dkx dkx  25M Oct  <span class=\"token number\">9</span> 06:02 docker-demo.jar</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>-rw-r--r--. <span class=\"token number\">1</span> dkx dkx  <span class=\"token number\">494</span> Oct  <span class=\"token number\">9</span> 06:02 Dockerfile</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>-rw-r--r--. <span class=\"token number\">1</span> dkx dkx 177M Oct  <span class=\"token number\">9</span> 06:02 jdk8.tar.gz</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>âœ  docker-demo</pre></td></tr></table></figure><p>6ã€åœ¨ docker-demo ç›®å½•ä¸­è¿è¡Œå‘½ä»¤ï¼š <code>docker build -t javaweb:1.0 .</code></p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>âœ  docker-demo <span class=\"token function\">sudo</span> <span class=\"token function\">docker</span> build <span class=\"token parameter variable\">-t</span> javaweb:1.0 <span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>sudo<span class=\"token punctuation\">]</span> password <span class=\"token keyword\">for</span> dkx:</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> Building <span class=\"token number\">46</span>.3s <span class=\"token punctuation\">(</span><span class=\"token number\">9</span>/9<span class=\"token punctuation\">)</span> FINISHED                                                                                                          docker:default</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load build definition from Dockerfile                                                                                                 <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring dockerfile: 591B                                                                                                                 <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load .dockerignore                                                                                                                    <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring context: 2B                                                                                                                      <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load metadata <span class=\"token keyword\">for</span> docker.io/library/ubuntu:16.04                                                                                      <span class=\"token number\">5</span>.6s</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span>/4<span class=\"token punctuation\">]</span> FROM docker.io/library/ubuntu:16.04@sha256:1f1a2d56de1d604801a9671f301190704c25d604a416f59e03c04f5c6ffee0d6                               <span class=\"token number\">30</span>.9s</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> resolve docker.io/library/ubuntu:16.04@sha256:1f1a2d56de1d604801a9671f301190704c25d604a416f59e03c04f5c6ffee0d6                                <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> sha256:1f1a2d56de1d604801a9671f301190704c25d604a416f59e03c04f5c6ffee0d6 <span class=\"token number\">1</span>.42kB / <span class=\"token number\">1</span>.42kB                                                       <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> sha256:a3785f78ab8547ae2710c89e627783cfa7ee7824d3468cae6835c9f4eae23ff7 <span class=\"token number\">1</span>.15kB / <span class=\"token number\">1</span>.15kB                                                       <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> sha256:b6f50765242581c887ff1acc2511fa2d885c52d8fb3ac8c4bba131fd86567f2e <span class=\"token number\">3</span>.36kB / <span class=\"token number\">3</span>.36kB                                                       <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> sha256:58690f9b18fca6469a14da4e212c96849469f9b1be6661d2342a4bf01774aa50 <span class=\"token number\">46</span>.50MB / <span class=\"token number\">46</span>.50MB                                                    <span class=\"token number\">27</span>.2s</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> sha256:b51569e7c50720acf6860327847fe342a1afbe148d24c529fb81df105e3eed01 857B / 857B                                                           <span class=\"token number\">0</span>.9s</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> sha256:da8ef40b9ecabc2679fe2419957220c0272a965c5cf7e0269fa1aeeb8c56f2e1 528B / 528B                                                           <span class=\"token number\">0</span>.8s</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> sha256:fb15d46c38dcd1ea0b1990006c3366ecd10c79d374f341687eb2cb23a2c8672e 170B / 170B                                                           <span class=\"token number\">1</span>.5s</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> extracting sha256:58690f9b18fca6469a14da4e212c96849469f9b1be6661d2342a4bf01774aa50                                                            <span class=\"token number\">3</span>.5s</pre></td></tr><tr><td data-num=\"19\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> extracting sha256:b51569e7c50720acf6860327847fe342a1afbe148d24c529fb81df105e3eed01                                                            <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"20\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> extracting sha256:da8ef40b9ecabc2679fe2419957220c0272a965c5cf7e0269fa1aeeb8c56f2e1                                                            <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"21\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> extracting sha256:fb15d46c38dcd1ea0b1990006c3366ecd10c79d374f341687eb2cb23a2c8672e                                                            <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"22\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load build context                                                                                                                    <span class=\"token number\">1</span>.6s</pre></td></tr><tr><td data-num=\"23\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring context: <span class=\"token number\">211</span>.19MB                                                                                                                <span class=\"token number\">1</span>.6s</pre></td></tr><tr><td data-num=\"24\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span>/4<span class=\"token punctuation\">]</span> COPY ./jdk8.tar.gz /usr/local/                                                                                                             <span class=\"token number\">0</span>.7s</pre></td></tr><tr><td data-num=\"25\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token number\">3</span>/4<span class=\"token punctuation\">]</span> COPY ./docker-demo.jar /tmp/app.jar                                                                                                        <span class=\"token number\">0</span>.1s</pre></td></tr><tr><td data-num=\"26\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span>/4<span class=\"token punctuation\">]</span> RUN <span class=\"token builtin class-name\">cd</span> /usr/local  <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">tar</span> <span class=\"token parameter variable\">-xf</span> ./jdk8.tar.gz  <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">mv</span> ./jdk1.8.0_144 ./java8                                                                  <span class=\"token number\">4</span>.8s</pre></td></tr><tr><td data-num=\"27\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> exporting to image                                                                                                                               <span class=\"token number\">4</span>.0s</pre></td></tr><tr><td data-num=\"28\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> exporting layers                                                                                                                              <span class=\"token number\">3</span>.9s</pre></td></tr><tr><td data-num=\"29\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> writing image sha256:7163e4e0d2b830e1f411e6d50c40cb258e0110888af48e8ddce9642f72f564c1                                                         <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"30\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> naming to docker.io/library/javaweb:1.0                                                                                                       <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>âœ  docker-demo</pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°é•œåƒæ„å»ºå¥½äº†</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker images</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>REPOSITORY   TAG       IMAGE ID       CREATED              SIZE</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>javaweb      <span class=\"token number\">1.0</span>       7163e4e0d2b8   About a minute ago   722MB</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>nginx        latest    61395b4c586d   <span class=\"token number\">2</span> weeks ago          187MB</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>redis        latest    7c4b517da47d   <span class=\"token number\">4</span> weeks ago          153MB</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>mysql        <span class=\"token number\">5.7</span>.25    98455b9624a9   <span class=\"token number\">4</span> years ago          372MB</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>åˆ›å»ºå®¹å™¨å¹¶è¿è¡Œ</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker run --name web -p 8090:8090 -d javaweb:1.0</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>de4fc104d20fd0c7a44fe227aa07bbba8fb5fd6c7ca04400e7b90c93375573a5</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker ps</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS                                                  NAMES</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>de4fc104d20f   javaweb:1.0    <span class=\"token string\">\"/bin/sh -c 'java -jâ€¦\"</span>   <span class=\"token number\">4</span> seconds ago   Up <span class=\"token number\">2</span> seconds   <span class=\"token number\">0.0</span>.0.0:8090-<span class=\"token operator\">></span><span class=\"token number\">8090</span>/tcp, :::8090-<span class=\"token operator\">></span><span class=\"token number\">8090</span>/tcp              web</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>10d26568836c   mysql:5.7.25   <span class=\"token string\">\"docker-entrypoint.sâ€¦\"</span>   <span class=\"token number\">2</span> hours ago     Up <span class=\"token number\">2</span> hours     <span class=\"token number\">0.0</span>.0.0:3306-<span class=\"token operator\">></span><span class=\"token number\">3306</span>/tcp, :::3306-<span class=\"token operator\">></span><span class=\"token number\">3306</span>/tcp, <span class=\"token number\">33060</span>/tcp   some-mysql</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>2ba6c6cf79f4   nginx          <span class=\"token string\">\"/docker-entrypoint.â€¦\"</span>   <span class=\"token number\">4</span> hours ago     Up <span class=\"token number\">4</span> hours     <span class=\"token number\">0.0</span>.0.0:80-<span class=\"token operator\">></span><span class=\"token number\">80</span>/tcp, :::80-<span class=\"token operator\">></span><span class=\"token number\">80</span>/tcp                      mn</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>è®¿é—®é¡µé¢ uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMjQ5LjEyODo4MDkwL2hlbGxvL2NvdW50\">http://192.168.249.128:8090/hello/count</span></p>\n<p>è®¿é—®æˆåŠŸ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091907846.png\" alt=\"image-20231009190718545\" /></p>\n<p>&lt;font color='red'&gt; é—®é¢˜ &lt;/font&gt;ï¼š</p>\n<p>å¦‚æœæ¯ä¸ªå¾®æœåŠ¡æ„å»ºéƒ½è¦è¿›è¡Œä¸‹é¢çš„æµç¨‹ä¼šå¾ˆéº»çƒ¦</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># æŒ‡å®šåŸºç¡€é•œåƒ</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>FROM ubuntu:16.04</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># é…ç½®ç¯å¢ƒå˜é‡ï¼ŒJDK çš„å®‰è£…ç›®å½•</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>ENV <span class=\"token assign-left variable\">JAVA_DIR</span><span class=\"token operator\">=</span>/usr/local</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># æ‹·è´ jdk å’Œ java é¡¹ç›®çš„åŒ…</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>COPY ./jdk8.tar.gz <span class=\"token variable\">$JAVA_DIR</span>/</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>COPY ./docker-demo.jar /tmp/app.jar</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># å®‰è£… JDK</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>RUN <span class=\"token builtin class-name\">cd</span> <span class=\"token variable\">$JAVA_DIR</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">tar</span> <span class=\"token parameter variable\">-xf</span> ./jdk8.tar.gz <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">mv</span> ./jdk1.8.0_144 ./java8</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># é…ç½®ç¯å¢ƒå˜é‡</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>ENV <span class=\"token assign-left variable\">JAVA_HOME</span><span class=\"token operator\">=</span><span class=\"token variable\">$JAVA_DIR</span>/java8</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>ENV <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token environment constant\">$PATH</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$JAVA_HOME</span>/bin</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\"># æš´éœ²ç«¯å£</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>EXPOSE <span class=\"token number\">8090</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\"># å…¥å£ï¼Œjava é¡¹ç›®çš„å¯åŠ¨å‘½ä»¤</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>ENTRYPOINT <span class=\"token function\">java</span> <span class=\"token parameter variable\">-jar</span> /tmp/app.jar</pre></td></tr></table></figure><p>ä»é…ç½®ç¯å¢ƒå‰ n å±‚çš„å†…å®¹ä¸ä¼šå˜ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å‰ n å±‚æå‰æ„å»ºå¥½åšä¸€ä¸ªé•œåƒã€‚ä»¥åå°±éƒ½åœ¨è¿™ä¸ªæ„å»ºå¥½çš„åŸºç¡€ä¸Šå»æ„å»ºé•œåƒæ˜¯ä¸æ˜¯å°±æ–¹ä¾¿å¤šäº†ã€‚</p>\n<p>ä½†å®é™…ä¸Šå·²ç»æœ‰äººå¸®æˆ‘ä»¬åšå¥½äº†è¿™ä»¶äº‹å„¿äº†ã€‚</p>\n<p>å°±æ˜¯å¦‚ä¸‹ï¼š</p>\n<h3 id=\"764-åŸºäºjava8-alpineé•œåƒå°†ä¸€ä¸ªjavaé¡¹ç›®æ„å»ºä¸ºé•œåƒ\"><a class=\"anchor\" href=\"#764-åŸºäºjava8-alpineé•œåƒå°†ä¸€ä¸ªjavaé¡¹ç›®æ„å»ºä¸ºé•œåƒ\">#</a> 7.6.4ã€åŸºäº java:8-alpine é•œåƒï¼Œå°†ä¸€ä¸ª java é¡¹ç›®æ„å»ºä¸ºé•œåƒğŸŒ²</h3>\n<p><strong>å®ç°æ€è·¯å¦‚ä¸‹</strong>ï¼š</p>\n<p>1ã€æ–°å»ºä¸€ä¸ªç©ºçš„ç›®å½•ï¼Œç„¶ååœ¨ç›®å½•ä¸­æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åä¸º Dockerfile</p>\n<p>2ã€æ‹·è´ docker-demo.jar åˆ°è¿™ä¸ªç›®å½•ä¸­</p>\n<p>3ã€ç¼–å†™ Dockerfile æ–‡ä»¶ï¼š</p>\n<ol>\n<li>åŸºäº java:8-alpine ä½œä¸ºåŸºç¡€é•œåƒ</li>\n<li>å°† app.jar æ‹·è´åˆ°é•œåƒä¸­</li>\n<li>æš´æ¼ç«¯å£</li>\n<li>ç¼–å†™å…¥å£ ENTRYPOINT</li>\n</ol>\n<p>4ã€ä½¿ç”¨ docker build å‘½ä»¤æ„å»ºé•œåƒ</p>\n<p>5ã€ä½¿ç”¨ docker run åˆ›å»ºå®¹å™¨å¹¶è¿è¡Œ</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># æŒ‡å®šåŸºç¡€é•œåƒ</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>FROM java:8-alpine</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># æš´éœ²ç«¯å£</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>EXPOSE <span class=\"token number\">8090</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># å…¥å£ï¼Œjava é¡¹ç›®çš„å¯åŠ¨å‘½ä»¤</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>ENTRYPOINT <span class=\"token function\">java</span> <span class=\"token parameter variable\">-jar</span> /tmp/app.jar</pre></td></tr></table></figure><p>ç›´æ¥èŠ‚çœäº†å¤§é‡çš„ä»£ç å·¥ä½œ</p>\n<p>ä¿®æ”¹å®Œæˆä¿å­˜åï¼Œè¦†ç›– Linuxï¼Œ/tmp/docker-demo ä¸­çš„ Dockerfile æ–‡ä»¶</p>\n<p>è¦†ç›–æˆåŠŸ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091923461.png\" alt=\"image-20231009192320991\" /></p>\n<p>ä½¿ç”¨ cat å‘½ä»¤æŸ¥çœ‹ä¸‹ä¿®æ”¹æƒ…å†µ</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /tmp/docker-demo/Dockerfile</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># æŒ‡å®šåŸºç¡€é•œåƒ</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>FROM java:8-alpine</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># æš´éœ²ç«¯å£</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>EXPOSE <span class=\"token number\">8090</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># å…¥å£ï¼Œjava é¡¹ç›®çš„å¯åŠ¨å‘½ä»¤</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>ENTRYPOINT <span class=\"token function\">java</span> <span class=\"token parameter variable\">-jar</span> /tmp/app.jar<span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>å†æ¬¡è¿›è¡Œæ„å»ºé•œåƒ</p>\n<p>å¦‚æœæ„å»ºé‡åˆ°æŠ¥é”™å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>âœ  docker-demo <span class=\"token function\">sudo</span> <span class=\"token function\">docker</span> build <span class=\"token parameter variable\">-t</span> javaweb:1.0 <span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> Building <span class=\"token number\">2</span>.7s <span class=\"token punctuation\">(</span><span class=\"token number\">3</span>/3<span class=\"token punctuation\">)</span> FINISHED                                                                                                           docker:default</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load .dockerignore                                                                                                                    <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring context: 2B                                                                                                                      <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load build definition from Dockerfile                                                                                                 <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring dockerfile: 245B                                                                                                                 <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> ERROR <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load metadata <span class=\"token keyword\">for</span> docker.io/library/openjava:8-alpine                                                                           <span class=\"token number\">2</span>.6s</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>------</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> <span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load metadata <span class=\"token keyword\">for</span> docker.io/library/openjava:8-alpine:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>------</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Dockerfile:2</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>--------------------</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token number\">1</span> <span class=\"token operator\">|</span>     <span class=\"token comment\"># æŒ‡å®šåŸºç¡€é•œåƒ</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token number\">2</span> <span class=\"token operator\">|</span> <span class=\"token operator\">>></span><span class=\"token operator\">></span> FROM openjava:8-alpine</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token number\">3</span> <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token number\">4</span> <span class=\"token operator\">|</span>     <span class=\"token comment\"># æš´éœ²ç«¯å£</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>--------------------</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>ERROR: failed to solve: openjava:8-alpine: pull access denied, repository does not exist or may require authorization: server message: insufficient_scope: authorization failed</pre></td></tr></table></figure><p>åˆ™éœ€è¦å°† Dockerfile æ–‡ä»¶ä¸­çš„ java:8-alpine æ”¹ä¸º openjdk:8-alpine</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># æŒ‡å®šåŸºç¡€é•œåƒ</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>FROM openjdk:8-alpine</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># æš´éœ²ç«¯å£</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>EXPOSE <span class=\"token number\">8090</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># å…¥å£ï¼Œjava é¡¹ç›®çš„å¯åŠ¨å‘½ä»¤</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>ENTRYPOINT <span class=\"token function\">java</span> <span class=\"token parameter variable\">-jar</span> /tmp/app.jar</pre></td></tr></table></figure><p>å†æ¬¡è¿›è¡Œæ„å»ºé•œåƒ</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>âœ  docker-demo <span class=\"token function\">sudo</span> <span class=\"token function\">docker</span> build <span class=\"token parameter variable\">-t</span> javaweb:1.0 <span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> Building <span class=\"token number\">89</span>.8s <span class=\"token punctuation\">(</span><span class=\"token number\">5</span>/5<span class=\"token punctuation\">)</span> FINISHED                                                                                                          docker:default</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load .dockerignore                                                                                                                    <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring context: 2B                                                                                                                      <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load build definition from Dockerfile                                                                                                 <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring dockerfile: 244B                                                                                                                 <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load metadata <span class=\"token keyword\">for</span> docker.io/library/openjdk:8-alpine                                                                                  <span class=\"token number\">6</span>.1s</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span>/1<span class=\"token punctuation\">]</span> FROM docker.io/library/openjdk:8-alpine@sha256:94792824df2df33402f201713f932b58cb9de94a0cd524164a0f2283343547b3                           <span class=\"token number\">83</span>.6s</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> resolve docker.io/library/openjdk:8-alpine@sha256:94792824df2df33402f201713f932b58cb9de94a0cd524164a0f2283343547b3                            <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> sha256:a3562aa0b991a80cfe8172847c8be6dbf6e46340b759c2b782f8b8be45342717 <span class=\"token number\">3</span>.40kB / <span class=\"token number\">3</span>.40kB                                                       <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> sha256:e7c96db7181be991f19a9fb6975cdbbd73c65f4a2681348e63a141a2192a5f10 <span class=\"token number\">2</span>.76MB / <span class=\"token number\">2</span>.76MB                                                      <span class=\"token number\">10</span>.9s</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> sha256:f910a506b6cb1dbec766725d70356f695ae2bf2bea6224dbe8c7c6ad4f3664a2 238B / 238B                                                           <span class=\"token number\">0</span>.8s</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> sha256:c2274a1a0e2786ee9101b08f76111f9ab8019e368dce1e325d3c284a0ca33397 <span class=\"token number\">70</span>.73MB / <span class=\"token number\">70</span>.73MB                                                    <span class=\"token number\">80</span>.6s</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> sha256:94792824df2df33402f201713f932b58cb9de94a0cd524164a0f2283343547b3 <span class=\"token number\">1</span>.64kB / <span class=\"token number\">1</span>.64kB                                                       <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> sha256:44b3cea369c947527e266275cee85c71a81f20fc5076f6ebb5a13f19015dce71 947B / 947B                                                           <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> extracting sha256:e7c96db7181be991f19a9fb6975cdbbd73c65f4a2681348e63a141a2192a5f10                                                            <span class=\"token number\">0</span>.2s</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> extracting sha256:f910a506b6cb1dbec766725d70356f695ae2bf2bea6224dbe8c7c6ad4f3664a2                                                            <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> extracting sha256:c2274a1a0e2786ee9101b08f76111f9ab8019e368dce1e325d3c284a0ca33397                                                            <span class=\"token number\">2</span>.8s</pre></td></tr><tr><td data-num=\"19\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> exporting to image                                                                                                                               <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"20\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> exporting layers                                                                                                                              <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"21\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> writing image sha256:d92b26b799ba6c537e486f7619b96f16ae44e8d4fb296ab05cd80e9d764f5b30                                                         <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"22\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> naming to docker.io/library/javaweb:1.0                                                                                                       <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>âœ  docker-demo</pre></td></tr></table></figure><p>æ„å»ºå®Œæˆï¼</p>\n<p>å†æ¬¡è¿›è¡Œè®¿é—®é¡µé¢ uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMjQ5LjEyODo4MDkwL2hlbGxvL2NvdW50\">http://192.168.249.128:8090/hello/count</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091951847.png\" alt=\"image-20231009194918244\" /></p>\n<blockquote>\n<p>æ€»ç»“:</p>\n<ol>\n<li>Dockerfile çš„æœ¬è´¨æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œé€šè¿‡æŒ‡ä»¤æè¿°é•œåƒçš„æ„å»ºè¿‡ç¨‹</li>\n<li>Dockerfile çš„ç¬¬ä¸€è¡Œå¿…é¡»æ˜¯ FROMï¼Œä»ä¸€ä¸ªåŸºç¡€é•œåƒæ¥æ„å»º</li>\n<li>åŸºç¡€é•œåƒå¯ä»¥æ˜¯åŸºæœ¬æ“ä½œç³»ç»Ÿï¼Œå¦‚ Ubuntuã€‚ä¹Ÿå¯ä»¥æ˜¯å…¶å®ƒäººåˆ¶ä½œå¥½çš„é•œåƒï¼Œä¾‹å¦‚ï¼šjava:8-alpine äº¦æˆ–è€… openjdk:8-alpine</li>\n</ol>\n</blockquote>\n<h3 id=\"765-dockercompose\"><a class=\"anchor\" href=\"#765-dockercompose\">#</a> 7.6.5ã€DockerComposeğŸŒ²</h3>\n<ul>\n<li>åˆå§‹ DockerCompose</li>\n<li>éƒ¨ç½²å¾®æœåŠ¡é›†ç¾¤</li>\n</ul>\n<p>å®é™…ç”Ÿäº§ç¯å¢ƒä¸­å¾®æœåŠ¡å¾ˆå¤šå¾ˆå¤šï¼Œæ•°åä¸Šç™¾ç”šè‡³ä¸Šåƒä¸ªå¾®æœåŠ¡æˆ‘ä»¬å¦‚æœä¸€ä¸ªä¸€ä¸ªå»æ„å»ºè¿™å¯å¾—ç´¯æ­»äº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æœ‰ä¸€ç§é›†ç¾¤éƒ¨ç½²çš„æ‰‹æ®µï¼Œé‚£ä¹ˆè¿™å°±æ˜¯æˆ‘ä»¬è¦å­¦ä¹ çš„ DockerCompose äº†</p>\n<h4 id=\"7651-ä»€ä¹ˆæ˜¯dockercompose\"><a class=\"anchor\" href=\"#7651-ä»€ä¹ˆæ˜¯dockercompose\">#</a> 7.6.5.1ã€ä»€ä¹ˆæ˜¯ DockerComposeğŸŒ´</h4>\n<ul>\n<li>DockerCompose å¯ä»¥åŸºäº Compose æ–‡ä»¶å¸®æˆ‘ä»¬å¿«é€Ÿçš„éƒ¨ç½²åˆ†å¸ƒå¼åº”ç”¨ï¼Œè€Œæ— éœ€æ‰‹åŠ¨ä¸€ä¸ªä¸€ä¸ªåˆ›å»ºå’Œè¿è¡Œå®¹å™¨ï¼</li>\n<li>Compose æ–‡ä»¶æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œ é€šè¿‡æŒ‡ä»¤å®šä¹‰é›†ç¾¤ä¸­çš„æ¯ä¸ªå®¹å™¨å¦‚æœè¿è¡Œã€‚</li>\n<li>Compose æ–‡ä»¶æ˜¯æŠŠ Docker run å‘½ä»¤é›†åˆè¿›æ¥çš„ç„¶åæŠŠè¯­æ³•è½¬æ¢äº†ä¸€ä¸‹</li>\n</ul>\n<p>DockerCompose æ–‡ä»¶å°±æ˜¯æŠŠ Docker run çš„å„ç§å‚æ•°è½¬æ¢æˆæŒ‡ä»¤å»å®šä¹‰äº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310092019582.png\" alt=\"image-20231009201930379\" /></p>\n<ul>\n<li>DockerCompose çš„è¯¦ç»†è¯­æ³•å‚è€ƒå®˜ç½‘ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vY29tcG9zZS9jb21wb3NlLWZpbGUv\">https://docs.docker.com/compose/compose-file/</span></li>\n</ul>\n<p>ä¸Šé¢äº†è§£åæˆ‘ä»¬å°±è¿›è¡Œå®‰è£… DockerComposeï¼š<a href=\"./Docker/Centos7%E5%AE%89%E8%A3%85Docker.md\">æŸ¥çœ‹å®‰è£…æ–‡ç« </a>.</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>DockerCompose æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p>\n<ul>\n<li>å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿéƒ¨ç½²åˆ†å¸ƒå¼åº”ç”¨ï¼Œæ— éœ€ä¸€ä¸ªä¸€ä¸ªå¾®æœåŠ¡å»æ„å»ºé•œåƒå’Œéƒ¨ç½²</li>\n</ul>\n</blockquote>\n<h4 id=\"7652-dockercomposeéƒ¨ç½²\"><a class=\"anchor\" href=\"#7652-dockercomposeéƒ¨ç½²\">#</a> 7.6.5.2ã€DockerCompose éƒ¨ç½²ğŸŒ´</h4>\n<p><strong>æ¡ˆä¾‹ï¼Œå°†ä¹‹å‰å­¦ä¹ çš„ cloud-demo å¾®æœåŠ¡é›†ç¾¤åˆ©ç”¨ DockerCompose éƒ¨ç½²</strong>.</p>\n<p>å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p>\n<p>1ã€åˆ›å»ºä¸ cloud-demo é¡¹ç›®ç›®å½•ç›¸åŒçš„å‡ ä¸ªæ–‡ä»¶å¤¹</p>\n<p>ä¸‰ä¸ªå¾®æœåŠ¡éœ€è¦ä¾èµ–äº mysql æ‰€ä»¥éœ€è¦å‡†å¤‡ mysql çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310092043951.png\" alt=\"image-20231009204357169\" /></p>\n<p>2ã€æ¯ä¸ªæ–‡ä»¶å¤¹é‡Œé¢å­˜æ”¾ Dockerfile æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># åŸºç¡€é•œåƒ</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>FROM java:8-alpine</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># æ‹·è´å½“å‰ç›®å½•ä¸­çš„ app.jar åˆ° tem ç›®å½•ä¸­ï¼Œå°†è¿è¡Œçš„ jar åŒ…æ‹·è´åˆ°é•œåƒä¸­</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>COPY ./app.jar /tmp/app.jar</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># å¯åŠ¨è„šæœ¬</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>ENTRYPOINT <span class=\"token function\">java</span> <span class=\"token parameter variable\">-jar</span> /tmp/app.jar</pre></td></tr></table></figure><p>é™¤äº† mysql çš„ç›®å½•ä¸­å†åˆ›å»ºä¸¤ä¸ªç›®å½•</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310092047841.png\" alt=\"image-20231009204740200\" /></p>\n<p>conf ç›®å½•ä¸­å­˜æ”¾ mysql é…ç½®æ–‡ä»¶</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310092048636.png\" alt=\"image-20231009204801023\" /></p>\n<p>data ç›®å½•é‡Œé¢å­˜æ”¾æ•°æ®åº“çš„æ•°æ®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310092048062.png\" alt=\"image-20231009204831646\" /></p>\n<p>3ã€æœ€å¤–å±‚åˆ›å»ºä¸€ä¸ª docker-compose.yml æ–‡ä»¶</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310092049638.png\" alt=\"image-20231009204929278\" /></p>\n<p>å†…å®¹ä¸ºï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.2\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nacos/nacos<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># ç¯å¢ƒé…ç½®ï¼Œå¯åŠ¨å‚æ•°</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">MODE</span><span class=\"token punctuation\">:</span> standalone</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"8848:8848\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">mysql</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mysql<span class=\"token punctuation\">:</span>5.7.25</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token key atrule\">MYSQL_ROOT_PASSWORD</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\"># æ•°æ®å·æŒ‚è½½</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># ä½¿ç”¨ Linux æŒ‡ä»¤ pwd è·å–å½“å‰ç›®å½•ä½ç½®ç„¶åä»è¿™ä¸ªä½ç½®æ‰¾å¯¹åº”çš„ç›®å½•ï¼Œä¸å†™ç¡¬ç¼–ç </span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"$PWD/mysql/data:/var/lib/mysql\"</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"$PWD/mysql/conf:/etc/mysql/conf.d/\"</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token key atrule\">userservice</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token comment\"># æœåŠ¡æ„å»ºåŸºäº dockerfile å®Œæˆæ„å»ºï¼Œåœ¨å½“å‰ç›®å½•ä¸‹çš„ user-service ç›®å½•ä¸‹æ‰¾åˆ° dockerfile è¿›è¡Œæ„å»ºé•œåƒ</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span> ./user<span class=\"token punctuation\">-</span>service</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token comment\"># æœåŠ¡æ„å»ºåŸºäº dockerfile å®Œæˆæ„å»ºï¼Œåœ¨å½“å‰ç›®å½•ä¸‹çš„ order-service ç›®å½•ä¸‹æ‰¾åˆ° dockerfile è¿›è¡Œæ„å»ºé•œåƒ</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token key atrule\">orderservice</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span> ./order<span class=\"token punctuation\">-</span>service</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token comment\"># ç½‘å…³æ„å»ºåŸºäº dockerfile å®Œæˆæ„å»ºï¼Œåœ¨å½“å‰ç›®å½•ä¸‹çš„ gateway ç›®å½•ä¸‹æ‰¾åˆ° dockerfile è¿›è¡Œæ„å»ºé•œåƒ</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span> ./gateway</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token comment\"># åªæœ‰ç½‘å…³æš´æ¼äº†ç«¯å£ï¼Œå‰©ä¸‹ä¸Šé¢çš„å¾®æœåŠ¡éƒ½æ²¡æœ‰æš´æ¼ï¼Œå› ä¸ºç½‘å…³æ‰æ˜¯å…¥å£è€Œä¸åº”è¯¥å°†å¾®æœåŠ¡æš´æ¼å‡ºå»</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"10010:10010\"</span></pre></td></tr></table></figure><p>å°†æ¥ DockerCompose å°±ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨çš„å»æ„å»ºè¿™ä¸‰ä¸ªå¾®æœåŠ¡çš„é•œåƒäº†ï¼Œå®ç°ä¸€æ¬¡æ€§éƒ¨ç½²</p>\n<p>4ã€ä¿®æ”¹è‡ªå·±çš„ cloud-demo é¡¹ç›®ï¼Œå°†æ•°æ®åº“ï¼Œnacos åœ°å€éƒ½å‘½åä¸º docker-compose ä¸­çš„æœåŠ¡å</p>\n<p>ä¸èƒ½æŠŠ nacosï¼Œæ•°æ®åº“ä¹‹ç±»çš„é…ç½®åœ°å€å†™æ­»ï¼Œå› ä¸ºå¾®æœåŠ¡å¯èƒ½é…ç½®åœ¨ä¸åŒçš„æœºå™¨ä¸Š</p>\n<blockquote>\n<p>ç”¨ DockerCompose éƒ¨ç½²æ—¶æ‰€æœ‰çš„æœåŠ¡ä¹‹é—´éƒ½å¯ä»¥ç”¨æœåŠ¡åç§°å»äº’ç›¸è®¿é—®ï¼Œè¿™æ˜¯ DockerCompose åº•å±‚åšäº†ä¸€äº›é…ç½®</p>\n</blockquote>\n<p>user-service ä¸­çš„ nacos é…ç½®</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> userservice <span class=\"token comment\"># æœåŠ¡åç§°</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">profiles</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">active</span><span class=\"token punctuation\">:</span> dev <span class=\"token comment\"># ç¯å¢ƒ</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> nacos<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span> <span class=\"token comment\"># nacos åœ°å€</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">discovery</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\"># cluster-name: TJ</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token key atrule\">file-extension</span><span class=\"token punctuation\">:</span> yaml <span class=\"token comment\"># é…ç½®æ–‡ä»¶åç¼€å</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># ä¸‰è¦ç´ ï¼šæœåŠ¡åç§°ï¼Œç¯å¢ƒï¼Œåç¼€å è€Œè¿™ä¸‰ä¸ªå†³å®šäº† DateId</span></pre></td></tr></table></figure><p>user-service ä¸­çš„ mysql é…ç½®</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> jdbc<span class=\"token punctuation\">:</span>mysql<span class=\"token punctuation\">:</span>//mysql<span class=\"token punctuation\">:</span>3306/cloud_user<span class=\"token punctuation\">?</span>useSSL=false<span class=\"token important\">&amp;characterEncoding=utf-8&amp;serverTimezone=UTC</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> dkx.</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">driver-class-name</span><span class=\"token punctuation\">:</span> com.mysql.cj.jdbc.Driver</pre></td></tr></table></figure><p>åŒæ ·å°† order-service ä¸­çš„ mysql å’Œ nacos åœ°å€é…ç½®æ”¹è¿‡æ¥</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> jdbc<span class=\"token punctuation\">:</span>mysql<span class=\"token punctuation\">:</span>//mysql<span class=\"token punctuation\">:</span>3306/cloud_order<span class=\"token punctuation\">?</span>useSSL=false<span class=\"token important\">&amp;characterEncoding=utf-8&amp;serverTimezone=UTC</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> dkx.</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">driver-class-name</span><span class=\"token punctuation\">:</span> com.mysql.cj.jdbc.Driver</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> orderservice</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> nacos<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token key atrule\">discovery</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\"># cluster-name: HZ # é›†ç¾¤åç§°</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\"># namespace: ed32fa6f-e9e3-4483-b860-7bcd9731d0d9 # å‘½åç©ºé—´ï¼Œå¡« ID dev ç¯å¢ƒ</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token key atrule\">ephemeral</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\"># è®¾ç½®æ˜¯å¦ä¸ºä¸´æ—¶å®ä¾‹ è®¾ç½®ä¸ºéä¸´æ—¶å®ä¾‹</span></pre></td></tr></table></figure><p>ä¿®æ”¹ç½‘å…³æœåŠ¡çš„ nacos åœ°å€é…ç½®</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#=========== è¿™äº›é…ç½®è®©ç½‘å…³èƒ½å¤Ÿè”ç³»ä¸Š nacos å®ç°æœåŠ¡æ³¨å†Œå’Œå‘ç° ====</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span>                                              <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10010</span> <span class=\"token comment\"># ç½‘å…³ç«¯å£                              #||</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>                                              <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span>                                       <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> gateway <span class=\"token comment\"># æœåŠ¡åç§°                           #||</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span>                                              <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span>                                            <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> nacos<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span> <span class=\"token comment\"># nacos åœ°å€          #||</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#========================================================</span></pre></td></tr></table></figure><p>5ã€ä½¿ç”¨ maven æ‰“åŒ…å·¥å…·ï¼Œå°†é¡¹ç›®ä¸­çš„æ¯ä¸ªå¾®æœåŠ¡éƒ½æ‰“åŒ…ä¸º app.jar æ–‡ä»¶</p>\n<p>å¦‚æœè¦è®©é¡¹ç›®æ‰“åŒ…ä¸º app.jar åç§°åˆ™éœ€è¦åœ¨ pom.xml æ–‡ä»¶ä¸­é…ç½®å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>build</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>finalName</span><span class=\"token punctuation\">></span></span>app<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>finalName</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>build</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨æ‰€æœ‰éœ€è¦æ‰“åŒ…çš„æœåŠ¡ä¸­çš„ pom æ–‡ä»¶é‡Œé¢è¿›è¡Œé…ç½®</p>\n<p>å…ˆè¿›è¡Œä¸€ä¸‹ clean æ¸…ç©ºä¸€ä¸ªç„¶åå†è¿›è¡Œ install å®‰è£…æœ¬åœ°</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310092114297.png\" alt=\"image-20231009211435849\" /></p>\n<p>6ã€å°†æ‰“åŒ…å¥½çš„ app.jar æ‹·è´åˆ° cloud-demo ä¸­çš„æ¯ä¸€ä¸ªå¯¹åº”çš„å­ç›®å½•ä¸­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310092123149.png\" alt=\"image-20231009212348796\" /></p>\n<p>7ã€å°† cloud-demo ä¸Šä¼ è‡³è™šæ‹Ÿæœºï¼Œåˆ©ç”¨ docker-compose up -d æ¥éƒ¨ç½²</p>\n<p>å‚æ•°è¯´æ˜ï¼šup - åˆ›å»ºå¹¶æ‰§è¡Œå®¹å™¨</p>\n<p>â€‹\t\t\t -d - åå°è¿è¡Œ</p>\n<p>å…¶å®ƒå‚æ•° help å‚è§</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310092126664.png\" alt=\"image-20231009212636444\" /></p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost tmp<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd cloud-demo/</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost cloud-demo<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>docker-compose.yml  gateway  mysql  order-service  user-service</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost cloud-demo<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>ä½¿ç”¨å‘½ä»¤è¿›è¡Œéƒ¨ç½²</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost cloud-demo<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker-compose up -d</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Building userservice</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> Building <span class=\"token number\">3</span>.5s <span class=\"token punctuation\">(</span><span class=\"token number\">7</span>/7<span class=\"token punctuation\">)</span> FINISHED                                                                                                           docker:default</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load build definition from Dockerfile                                                                                                 <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring dockerfile: 182B                                                                                                                 <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load .dockerignore                                                                                                                    <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring context: 2B                                                                                                                      <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load metadata <span class=\"token keyword\">for</span> docker.io/library/openjdk:8-alpine                                                                                  <span class=\"token number\">2</span>.7s</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load build context                                                                                                                    <span class=\"token number\">0</span>.3s</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring context: <span class=\"token number\">39</span>.30MB                                                                                                                 <span class=\"token number\">0</span>.3s</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> CACHED <span class=\"token punctuation\">[</span><span class=\"token number\">1</span>/2<span class=\"token punctuation\">]</span> FROM docker.io/library/openjdk:8-alpine@sha256:94792824df2df33402f201713f932b58cb9de94a0cd524164a0f2283343547b3                     <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span>/2<span class=\"token punctuation\">]</span> COPY ./app.jar /tmp/app.jar                                                                                                                <span class=\"token number\">0</span>.2s</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> exporting to image                                                                                                                               <span class=\"token number\">0</span>.3s</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> exporting layers                                                                                                                              <span class=\"token number\">0</span>.2s</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> writing image sha256:ab22b9b33217d7b1e7287dc7b16564ba7a683bcc390e961ffb7d6f77069ea697                                                         <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> naming to docker.io/library/cloud-demo_userservice                                                                                            <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>WARNING: Image <span class=\"token keyword\">for</span> <span class=\"token function\">service</span> userservice was built because it did not already exist. To rebuild this image you must use <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">docker-compose</span> build<span class=\"token variable\">`</span></span> or <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">docker-compose</span> up <span class=\"token parameter variable\">--build</span><span class=\"token variable\">`</span></span><span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>Building orderservice</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> Building <span class=\"token number\">1</span>.4s <span class=\"token punctuation\">(</span><span class=\"token number\">7</span>/7<span class=\"token punctuation\">)</span> FINISHED                                                                                                           docker:default</pre></td></tr><tr><td data-num=\"20\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load build definition from Dockerfile                                                                                                 <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"21\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring dockerfile: 182B                                                                                                                 <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"22\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load .dockerignore                                                                                                                    <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"23\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring context: 2B                                                                                                                      <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"24\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load metadata <span class=\"token keyword\">for</span> docker.io/library/openjdk:8-alpine                                                                                  <span class=\"token number\">0</span>.6s</pre></td></tr><tr><td data-num=\"25\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load build context                                                                                                                    <span class=\"token number\">0</span>.3s</pre></td></tr><tr><td data-num=\"26\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring context: <span class=\"token number\">41</span>.82MB                                                                                                                 <span class=\"token number\">0</span>.3s</pre></td></tr><tr><td data-num=\"27\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> CACHED <span class=\"token punctuation\">[</span><span class=\"token number\">1</span>/2<span class=\"token punctuation\">]</span> FROM docker.io/library/openjdk:8-alpine@sha256:94792824df2df33402f201713f932b58cb9de94a0cd524164a0f2283343547b3                     <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"28\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span>/2<span class=\"token punctuation\">]</span> COPY ./app.jar /tmp/app.jar                                                                                                                <span class=\"token number\">0</span>.1s</pre></td></tr><tr><td data-num=\"29\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> exporting to image                                                                                                                               <span class=\"token number\">0</span>.2s</pre></td></tr><tr><td data-num=\"30\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> exporting layers                                                                                                                              <span class=\"token number\">0</span>.2s</pre></td></tr><tr><td data-num=\"31\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> writing image sha256:4fb619347bfb2d9aac0e824d4334973c18761b4ee64c1f9fddbd3b6041b8fad1                                                         <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"32\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> naming to docker.io/library/cloud-demo_orderservice                                                                                           <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>WARNING: Image <span class=\"token keyword\">for</span> <span class=\"token function\">service</span> orderservice was built because it did not already exist. To rebuild this image you must use <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">docker-compose</span> build<span class=\"token variable\">`</span></span> or <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">docker-compose</span> up <span class=\"token parameter variable\">--build</span><span class=\"token variable\">`</span></span><span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>Building gateway</pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> Building <span class=\"token number\">1</span>.2s <span class=\"token punctuation\">(</span><span class=\"token number\">7</span>/7<span class=\"token punctuation\">)</span> FINISHED                                                                                                           docker:default</pre></td></tr><tr><td data-num=\"36\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load build definition from Dockerfile                                                                                                 <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"37\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring dockerfile: 182B                                                                                                                 <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"38\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load .dockerignore                                                                                                                    <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"39\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring context: 2B                                                                                                                      <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"40\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load metadata <span class=\"token keyword\">for</span> docker.io/library/openjdk:8-alpine                                                                                  <span class=\"token number\">0</span>.6s</pre></td></tr><tr><td data-num=\"41\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load build context                                                                                                                    <span class=\"token number\">0</span>.3s</pre></td></tr><tr><td data-num=\"42\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring context: <span class=\"token number\">39</span>.92MB                                                                                                                 <span class=\"token number\">0</span>.3s</pre></td></tr><tr><td data-num=\"43\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> CACHED <span class=\"token punctuation\">[</span><span class=\"token number\">1</span>/2<span class=\"token punctuation\">]</span> FROM docker.io/library/openjdk:8-alpine@sha256:94792824df2df33402f201713f932b58cb9de94a0cd524164a0f2283343547b3                     <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"44\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span>/2<span class=\"token punctuation\">]</span> COPY ./app.jar /tmp/app.jar                                                                                                                <span class=\"token number\">0</span>.1s</pre></td></tr><tr><td data-num=\"45\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> exporting to image                                                                                                                               <span class=\"token number\">0</span>.2s</pre></td></tr><tr><td data-num=\"46\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> exporting layers                                                                                                                              <span class=\"token number\">0</span>.2s</pre></td></tr><tr><td data-num=\"47\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> writing image sha256:53993c010033dc8356f48ddd183ad1768544070ceb7e803ada30d20e9b3ae316                                                         <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"48\"></td><td><pre> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> naming to docker.io/library/cloud-demo_gateway                                                                                                <span class=\"token number\">0</span>.0s</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>WARNING: Image <span class=\"token keyword\">for</span> <span class=\"token function\">service</span> gateway was built because it did not already exist. To rebuild this image you must use <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">docker-compose</span> build<span class=\"token variable\">`</span></span> or <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">docker-compose</span> up <span class=\"token parameter variable\">--build</span><span class=\"token variable\">`</span></span><span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>Creating cloud-demo_nacos_1        <span class=\"token punctuation\">..</span>. <span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>Creating cloud-demo_userservice_1  <span class=\"token punctuation\">..</span>. <span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>Creating cloud-demo_mysql_1        <span class=\"token punctuation\">..</span>. <span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>Creating cloud-demo_gateway_1      <span class=\"token punctuation\">..</span>. <span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>Creating cloud-demo_orderservice_1 <span class=\"token punctuation\">..</span>. <span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost cloud-demo<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>éƒ¨ç½²æˆåŠŸä½¿ç”¨å‘½ä»¤æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼šdocker-compose logs -f</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost cloud-demo<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker-compose logs -f</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Attaching to cloud-demo_orderservice_1, cloud-demo_gateway_1, cloud-demo_userservice_1, cloud-demo_mysql_1, cloud-demo_nacos_1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>gateway_1       <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>gateway_1       <span class=\"token operator\">|</span>   <span class=\"token builtin class-name\">.</span>   ____          _            __ _ _</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>gateway_1       <span class=\"token operator\">|</span>  /<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">\\</span> / ___<span class=\"token string\">'_ __ _ _(_)_ __  __ _ \\ \\ \\ \\</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>gateway_1       | ( ( )\\___ | '</span>_ <span class=\"token operator\">|</span> <span class=\"token string\">'_| | '</span>_ <span class=\"token punctuation\">\\</span>/ _` <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span> <span class=\"token punctuation\">\\</span> <span class=\"token punctuation\">\\</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>gateway_1       <span class=\"token operator\">|</span>  <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">\\</span>/  ___<span class=\"token punctuation\">)</span><span class=\"token operator\">|</span> <span class=\"token operator\">|</span>_<span class=\"token punctuation\">)</span><span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span>  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>gateway_1       <span class=\"token operator\">|</span>   '  <span class=\"token operator\">|</span>____<span class=\"token operator\">|</span> .__<span class=\"token operator\">|</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span>_<span class=\"token operator\">|</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span>_<span class=\"token punctuation\">\\</span>__, <span class=\"token operator\">|</span> / / / /</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>gateway_1       <span class=\"token operator\">|</span>  <span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">|</span>_<span class=\"token operator\">|</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">|</span>___/<span class=\"token operator\">=</span>/_/_/_/</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>gateway_1       <span class=\"token operator\">|</span>  :: Spring Boot ::        <span class=\"token punctuation\">(</span>v2.3.9.RELEASE<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>gateway_1       <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>gateway_1       <span class=\"token operator\">|</span> <span class=\"token number\">10</span>-09 <span class=\"token number\">13</span>:37:38:143  INFO <span class=\"token number\">1</span> --- <span class=\"token punctuation\">[</span>           main<span class=\"token punctuation\">]</span> cn.itcast.gateway.GatewayApplication     <span class=\"token builtin class-name\">:</span> No active profile set, falling back to default profiles: default</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>gateway_1       <span class=\"token operator\">|</span> <span class=\"token number\">10</span>-09 <span class=\"token number\">13</span>:37:41:667  INFO <span class=\"token number\">1</span> --- <span class=\"token punctuation\">[</span>           main<span class=\"token punctuation\">]</span> o.s.cloud.context.scope.GenericScope     <span class=\"token builtin class-name\">:</span> BeanFactory <span class=\"token assign-left variable\">id</span><span class=\"token operator\">=</span>87ef38f0-5652-3427-832e-5397c91e63b6</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span></pre></td></tr></table></figure><p>å¯åŠ¨æ—¶ nacos ä¼šæŠ¥é”™å› ä¸ºå®ƒå¯åŠ¨çš„æ¯”è¾ƒæ…¢æˆ‘ä»¬éœ€è¦å…ˆå¯åŠ¨ nacos æ‰§è¡Œå‘½ä»¤ï¼š <code>docker-compose up -d nacos</code></p>\n<p>ç­‰å¾… nacos å¯åŠ¨å®Œæˆåå¯ä»¥è®¿é—® uri æµ‹è¯•ä¸€ä¸‹ï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMjQ5LjEyODo4ODQ4L25hY29z\">http://192.168.249.128:8848/nacos</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310101029911.png\" alt=\"image-20231010102946333\" /></p>\n<p>å¦‚æœæœ‰æŠ¥é”™ä¿¡æ¯å¯ä»¥ä½¿ç”¨å‘½ä»¤é‡å¯æœåŠ¡ <code>docker-compose restart gateway userservice orderservice</code></p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost cloud-demo<span class=\"token punctuation\">]</span><span class=\"token comment\"># docker-compose restart gateway userservice orderservice</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Restarting cloud-demo_orderservice_1 <span class=\"token punctuation\">..</span>. <span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Restarting cloud-demo_gateway_1      <span class=\"token punctuation\">..</span>. <span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Restarting cloud-demo_userservice_1  <span class=\"token punctuation\">..</span>. <span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost cloud-demo<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><h3 id=\"766-dockeré•œåƒä»“åº“\"><a class=\"anchor\" href=\"#766-dockeré•œåƒä»“åº“\">#</a> 7.6.6ã€Docker é•œåƒä»“åº“ğŸŒ²</h3>\n<ul>\n<li>æ­å»ºç§æœ‰é•œåƒä»“åº“</li>\n<li>å‘é•œåƒä»“åº“æ¨é€é•œåƒ</li>\n<li>ä»é•œåƒä»“åº“æ‹‰å–é•œåƒ</li>\n</ul>\n<h4 id=\"7661-å¸¸è§é•œåƒä»“åº“æœåŠ¡\"><a class=\"anchor\" href=\"#7661-å¸¸è§é•œåƒä»“åº“æœåŠ¡\">#</a> 7.6.6.1ã€å¸¸è§é•œåƒä»“åº“æœåŠ¡ğŸŒ´</h4>\n<p>é•œåƒä»“åº“ (Docker Registry) æœ‰å…¬å…±å’Œç§æœ‰çš„ä¸¤ç§å½¢å¼ï¼š</p>\n<ul>\n<li>å…¬å…±ä»“åº“ï¼šä¾‹å¦‚ Docker å®˜æ–¹çš„ Docker Hubï¼Œå›½å†…ä¹Ÿæœ‰ä¸€äº›æœåŠ¡å•†æä¾›ç±»ä¼¼äº Docker Hub çš„å…¬å¼€æœåŠ¡ï¼Œæ¯”å¦‚ ç½‘æ˜“äº‘é•œåƒæœåŠ¡ï¼ŒDaoCloud é•œåƒæœåŠ¡ï¼Œé˜¿é‡Œäº‘é•œåƒæœåŠ¡ç­‰ã€‚</li>\n<li>é™¤äº†ä½¿ç”¨å…¬å¼€ä»“åº“å¤–ï¼Œç”¨æˆ·è¿˜å¯ä»¥åœ¨æœ¬åœ°æ­å»ºç§æœ‰ Docker Registryã€‚ä¼ä¸šè‡ªå·±çš„é•œåƒæœ€å¥½æ˜¯é‡‡ç”¨ç§æœ‰ Docker Registry æ¥å®ç°ã€‚</li>\n</ul>\n<h4 id=\"7662-åˆ›å»ºç§æœé•œåƒä»“åº“æŸ¥çœ‹æ–‡ç« \"><a class=\"anchor\" href=\"#7662-åˆ›å»ºç§æœé•œåƒä»“åº“æŸ¥çœ‹æ–‡ç« \">#</a> 7.6.6.2ã€åˆ›å»ºç§æœé•œåƒä»“åº“æŸ¥çœ‹æ–‡ç« ğŸŒ´</h4>\n<p><a href=\"./Docker/Centos7%E5%AE%89%E8%A3%85Docker.md\">æŸ¥çœ‹ Docker å¸¦æœ‰å›¾å½¢åŒ–é•œåƒä»“åº“</a>.</p>\n<h4 id=\"7663-åœ¨ç§æœ‰é•œåƒä»“åº“æ¨é€æˆ–æ‹‰å–é•œåƒ\"><a class=\"anchor\" href=\"#7663-åœ¨ç§æœ‰é•œåƒä»“åº“æ¨é€æˆ–æ‹‰å–é•œåƒ\">#</a> 7.6.6.3ã€åœ¨ç§æœ‰é•œåƒä»“åº“æ¨é€æˆ–æ‹‰å–é•œåƒğŸŒ´</h4>\n<p>æ¨é€é•œåƒåˆ°ç§æœ‰é•œåƒæœåŠ¡å¿…é¡»å…ˆ tagï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<p>1ã€é‡æ–° tag æœ¬åœ°é•œåƒï¼Œåç§°å‰ç¼€ä¸ºç§æœ‰ä»“åº“çš„åœ°å€ï¼š192.168.150.101:8080/</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> tag nginx:latest <span class=\"token number\">192.168</span>.150.101:8080/nginx:1.0</pre></td></tr></table></figure><p>ä½¿ç”¨ docker images æŸ¥çœ‹æ‰“åŒ…å¥½çš„é•œåƒ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310101215960.png\" alt=\"image-20231010121530321\" /></p>\n<p>2ã€æ¨é€é•œåƒ</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> push <span class=\"token number\">192.168</span>.150.101:8080/nginx:1.0</pre></td></tr></table></figure><p>3ã€æ‹‰å–é•œåƒ</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> pull <span class=\"token number\">192.168</span>.150.101:8080/nginx:1.0</pre></td></tr></table></figure><blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<ol>\n<li>æ¨é€æœ¬åœ°é•œåƒåˆ°ä»“åº“å‰éƒ½å¿…é¡»é‡å‘½å (docker tag) é•œåƒï¼Œä»¥é•œåƒä»“åº“åœ°å€ä¸ºå‰ç¼€</li>\n<li>é•œåƒä»“åº“æ¨é€å‰éœ€è¦æŠŠä»“åº“åœ°å€é…ç½®åˆ° docker æœåŠ¡çš„ daemon.json æ–‡ä»¶ä¸­ï¼Œè¢« docker ä¿¡ä»»</li>\n<li>æ¨é€ä½¿ç”¨ docker push å‘½ä»¤</li>\n<li>æ‹‰å–ä½¿ç”¨ docker pull å‘½ä»¤</li>\n</ol>\n</blockquote>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "Docker",
                "è®¡ç®—æœºå­¦ç§‘",
                "springcloud",
                "Docker"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-gateway/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-gateway/",
            "title": "å…­ã€ç»Ÿä¸€ç½‘å…³Gateway",
            "date_published": "2024-01-06T02:16:29.782Z",
            "content_html": "<h2 id=\"å…­-ç»Ÿä¸€ç½‘å…³gateway\"><a class=\"anchor\" href=\"#å…­-ç»Ÿä¸€ç½‘å…³gateway\">#</a> å…­ã€ç»Ÿä¸€ç½‘å…³ GatewayğŸ„</h2>\n<ul>\n<li>ä¸ºä»€ä¹ˆéœ€è¦ç½‘å…³</li>\n<li>gateway å¿«é€Ÿå…¥é—¨</li>\n<li>æ–­è¨€å·¥å‚</li>\n<li>è¿‡æ»¤å™¨å·¥å‚</li>\n<li>å…¨å±€è¿‡æ»¤å™¨</li>\n<li>è·¨åŸŸé—®é¢˜</li>\n</ul>\n<h3 id=\"61-ä¸ºä»€ä¹ˆéœ€è¦ç½‘å…³\"><a class=\"anchor\" href=\"#61-ä¸ºä»€ä¹ˆéœ€è¦ç½‘å…³\">#</a> 6.1ã€ä¸ºä»€ä¹ˆéœ€è¦ç½‘å…³ğŸŒ³</h3>\n<p>å…ˆçœ‹ä¸‹ç°åœ¨çš„å¾®æœåŠ¡ç»“æ„ï¼š</p>\n<p>æˆ‘ä»¬æœ‰å¾ˆå¤šä¸ªä¸åŒçš„æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡éƒ½éœ€è¦å»è®¿é—®æ•°æ®åº“å®Œæˆè‡ªå·±çš„ä¸šåŠ¡åŠŸèƒ½ï¼Œå¹¶ä¸”å¾®æœåŠ¡éƒ½å¯ä»¥åœ¨ nacos é‡Œé¢å®ŒæˆæœåŠ¡æ³¨å†Œï¼Œé…ç½®ç®¡ç†ã€‚å½“å¾®æœåŠ¡å†…éƒ¨åˆç›¸äº’è°ƒç”¨å…³ç³»æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ feign ç»„ä»¶å»åšäº†ã€‚è€Œå¤–éƒ¨ç”¨æˆ·éœ€è¦è®¿é—®æ—¶åˆ™è®©å®ƒç›´æ¥å‘è¯·æ±‚åˆ°å¾®æœåŠ¡å°±è¡Œäº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071145537.png\" alt=\"image-20231007114556885\" /></p>\n<p>ä½†æ˜¯ï¼è¿™é‡Œå…¶å®å­˜åœ¨ä¸€ä¸ªé—®é¢˜ã€‚</p>\n<p>æˆ‘ä»¬å¾®æœåŠ¡ç›´æ¥æ‘†åœ¨é‚£é‡Œå…è®¸ä»»ä½•äººå‘è¯·æ±‚æ¥è®¿é—®æ˜¯ä¸æ˜¯ä¸å¤ªå®‰å…¨å‘¢ï¼Ÿä½ è¦çŸ¥é“ä¸æ˜¯æ‰€æœ‰ä¸šåŠ¡éƒ½å¯¹å¤–å…¬å¼€çš„</p>\n<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹ç”¨æˆ·çš„èº«ä»½è¿›è¡ŒéªŒè¯ï¼Œå¦‚æœè¯´ä½ æ˜¯ç¬¦å·æ¡ä»¶çš„äººå‘˜æ‰èƒ½è®©ä½ è¿›å»çœ‹ç›¸å…³çš„å†…å®¹å’Œæ“ä½œå¦åˆ™æ‹¦ä½ä¸è®©è¿›ã€‚</p>\n<p>é‚£è¿™ä»¶äº‹å„¿å°±æ˜¯ç”±ç½‘å…³æ¥åšçš„ã€‚</p>\n<p>ä¸€åˆ‡è¯·æ±‚ä¸€å®šå…ˆåˆ°ç½‘å…³å†åˆ°å¾®æœåŠ¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071149540.png\" alt=\"image-20231007114955240\" /></p>\n<p>è¿™å°±æ˜¯ç½‘å…³åŠŸèƒ½ä¹‹ä¸€ï¼šèº«ä»½è®¤è¯å’Œæƒé™æ ¡éªŒ</p>\n<p>ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ã€‚</p>\n<p>æ¯”å¦‚è¯´æŸç”¨æˆ·è¦åšä¸€ä¸ªç”¨æˆ·æŸ¥è¯¢ï¼Œé‚£ä¹ˆç½‘å…³èƒ½å¤„ç†ç”¨æˆ·æŸ¥è¯¢çš„ä¸šåŠ¡å—ï¼Ÿä¸èƒ½ï¼è‚¯å®šè¦æŠŠè¯·æ±‚è½¬å‘åˆ°å¯¹åº”çš„å¤„ç†ç”¨æˆ·æŸ¥è¯¢çš„æœåŠ¡ã€‚æ¯”å¦‚è¯´ userServiceã€‚å› æ­¤ç½‘å…³å¿…é¡»åšä¸€ä»¶äº‹å„¿äº†ï¼Œå®ƒéœ€è¦æ ¹æ®ç”¨æˆ·è¯·æ±‚åˆ¤æ–­æ˜¯æ‰¾ userService è¿˜æ˜¯ orderService å¦‚æœå¼„é”™äº†å°±è¦å‡ºé—®é¢˜äº†ã€‚</p>\n<p>è€Œè¿™ä¸ªåŠ¨ä½œæˆ‘ä»¬ç§°ä¹‹ä¸ºï¼šæœåŠ¡è·¯ç”±ï¼Œè´Ÿè½½å‡è¡¡</p>\n<h3 id=\"62-ç½‘å…³åŠŸèƒ½\"><a class=\"anchor\" href=\"#62-ç½‘å…³åŠŸèƒ½\">#</a> 6.2ã€ç½‘å…³åŠŸèƒ½ï¼šğŸŒ³</h3>\n<ul>\n<li>èº«ä»½è®¤è¯å’Œæƒé™æ ¡éªŒ</li>\n<li>æœåŠ¡è·¯ç”±ï¼Œè´Ÿè½½å‡è¡¡</li>\n<li>è¯·æ±‚é™æµ</li>\n</ul>\n<h3 id=\"63-ç½‘å…³çš„æŠ€æœ¯å®ç°\"><a class=\"anchor\" href=\"#63-ç½‘å…³çš„æŠ€æœ¯å®ç°\">#</a> 6.3ã€ç½‘å…³çš„æŠ€æœ¯å®ç°ğŸŒ³</h3>\n<p>åœ¨ SpringCloud ä¸­ç½‘å…³çš„å®ç°åŒ…æ‹¬ä¸¤ç§ï¼š</p>\n<ul>\n<li>gateway</li>\n<li>zuul</li>\n</ul>\n<blockquote>\n<p>zuul ä¸ gateway å¯¹æ¯”ï¼š</p>\n<p>Zuul æ˜¯åŸºäº Servlet çš„å®ç°ï¼Œå±äºé˜»å¡å¼ç¼–ç¨‹ã€‚è€Œ SpringCloudGateway åˆ™æ˜¯åŸºäº Spring5 ä¸­æä¾›çš„ WebFluxï¼Œå±äºå“åº”å¼ç¼–ç¨‹çš„å®ç°ï¼Œå…·å¤‡æ›´å¥½çš„æ€§èƒ½ã€‚</p>\n</blockquote>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>ç½‘å…³çš„ä½œç”¨ï¼š</p>\n<ul>\n<li>å¯¹ç”¨æˆ·è¯·æ±‚åšèº«ä»½è®¤è¯ï¼Œæƒé™æ ¡éªŒ</li>\n<li>å°†ç”¨æˆ·è¯·æ±‚è·¯ç”±åˆ°å¾®æœåŠ¡ï¼Œå¹¶å®ç°è´Ÿè½½å‡è¡¡</li>\n<li>å¯¹ç”¨æˆ·è¯·æ±‚åšé™æµ</li>\n</ul>\n</blockquote>\n<h3 id=\"64-æ­å»ºç½‘å…³æœåŠ¡\"><a class=\"anchor\" href=\"#64-æ­å»ºç½‘å…³æœåŠ¡\">#</a> 6.4ã€æ­å»ºç½‘å…³æœåŠ¡ğŸŒ³</h3>\n<p>æ­å»ºç½‘å…³æœåŠ¡çš„æ­¥éª¤ï¼š</p>\n<p>1ã€åˆ›å»ºæ–°çš„ moduleï¼Œå¼•å…¥ SpringCloudGateway çš„ä¾èµ–å’Œ nacos çš„æœåŠ¡å‘ç°ä¾èµ–ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- ç½‘å…³ä¾èµ– --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-gateway<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">&lt;!--nacos æœåŠ¡å‘ç°ä¾èµ– --></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-alibaba-nacos-discovery<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>2ã€ç¼–å†™è·¯ç”±é…ç½®åŠ nacos åœ°å€</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#=========== è¿™äº›é…ç½®è®©ç½‘å…³èƒ½å¤Ÿè”ç³»ä¸Š nacos å®ç°æœåŠ¡æ³¨å†Œå’Œå‘ç° ====</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span>                                              <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10010</span> <span class=\"token comment\"># ç½‘å…³ç«¯å£                              #||</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>                                              <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span>                                       <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> gateway <span class=\"token comment\"># æœåŠ¡åç§°                           #||</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span>                                              <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span>                                            <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span> <span class=\"token comment\"># nacos åœ°å€          #||</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#========================================================</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#========================= ç½‘å…³è·¯ç”±é…ç½® =====================</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span>                                           <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># ç½‘å…³è·¯ç”±é…ç½®                              ||</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">-</span>service <span class=\"token comment\"># è·¯ç”± idï¼Œè‡ªå®šä¹‰ï¼Œåªè¦å”¯ä¸€å³å¯    ||</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\"># uri æœ‰ä¸¤ç§æ–¹å¼çš„å†™æ³•                             ||</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\"># uri: http://127.0.0.1:8081 # è·¯ç”±çš„ç›®æ ‡åœ°å€ http å°±æ˜¯å›ºå®šåœ°å€</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>          <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//userservice <span class=\"token comment\"># è·¯ç”±çš„ç›®æ ‡åœ°å€ lb (LoadBalance) å°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œåé¢è·ŸæœåŠ¡åç§°</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>          <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># è·¯ç”±æ–­è¨€ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè·¯ç”±è§„åˆ™çš„æ¡ä»¶</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token punctuation\">-</span> Path=/user/<span class=\"token important\">**</span> <span class=\"token comment\"># è¿™ä¸ªæ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œåªè¦ä»¥ /user/ å¼€å¤´å°±ç¬¦åˆè¦æ±‚</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> order<span class=\"token punctuation\">-</span>service                            <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>          <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//orderservice                       <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>          <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span>                                  <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token punctuation\">-</span> Path=/order/<span class=\"token important\">**</span>                           <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">#=========================================================</span></pre></td></tr></table></figure><p>è®¿é—® gateway ç½‘å…³ uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDoxMDAxMC91c2VyLzE=\">http://localhost:10010/user/1</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071601031.png\" alt=\"image-20231007160105779\" /></p>\n<p>503 çš„å„ç§åŸå› ï¼š</p>\n<p>1ã€æ³¨æ„ yml é…ç½®æ–‡ä»¶ä¸­çš„ uri é…ç½® lb// æœåŠ¡åï¼Œæ˜¯å¦ä¸ nacos ä¸­çš„è‡ªå®šä¹‰æœåŠ¡åç›¸åŒã€‚</p>\n<ul>\n<li>è§£é‡Šï¼šgateway çš„è·¯ç”±è§„åˆ™æ˜¯åŸºäº nacos é…ç½®ä¸­å¿ƒæ¥å®šä½é¡¹ç›®çš„</li>\n</ul>\n<p>2ã€å¦‚æœé…ç½®æ–‡ä»¶æ²¡é—®é¢˜ï¼ŒSpring Cloud 2020 ç‰ˆæœ¬æŠ¥ 503 é”™è¯¯ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ  loadbalancer ä¾èµ–</p>\n<ul>\n<li>\n<p>åœ¨å½“å‰é¡¹ç›®çš„ pom.xml æ–‡ä»¶ä¸­å¯¼å…¥å¦‚ä¸‹ä¾èµ–å³å¯</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-loadbalancer<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n</ul>\n<p>å†æ¬¡è®¿é—® gateway ç½‘å…³ uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDoxMDAxMC91c2VyLzE=\">http://localhost:10010/user/1</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071600956.png\" alt=\"image-20231007160021450\" /></p>\n<p>&lt;center&gt; è·¯ç”±è¿‡ç¨‹æµç¨‹å›¾ &lt;/center&gt;</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071618234.png\" alt=\"image-20231007161853807\" /></p>\n<p>å¾®æœåŠ¡éƒ½å¯ä»¥æ³¨å†Œåˆ° nacos æ³¨å†Œä¸­å¿ƒï¼Œè¿™æ—¶ç”¨æˆ·å‘é€äº†è¯·æ±‚ï¼Œè¯·æ±‚è¿›å…¥ç½‘å…³ä½†æ˜¯ç½‘å…³æ— æ³•å¤„ç†è¿™ä¸ªä¸šåŠ¡ã€‚æ‰€ä»¥å®ƒåªèƒ½æ˜¯åŸºäºè·¯ç”±è§„åˆ™å»åšåˆ¤æ–­ï¼Œè€Œä¸Šé¢æˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªè§„åˆ™ä¸€ä¸ªæ˜¯æŠŠ user è¯·æ±‚å¼€å¤´çš„è·¯å¾„ä»£ç†åˆ° userserviceï¼Œå¦ä¸€ä¸ªæ˜¯æŠŠ order è¯·æ±‚å¼€å¤´çš„è·¯å¾„ä»£ç†åˆ° orderserviceã€‚ç½‘å…³æ‹¿ç€ userserivce å»æ³¨å†Œä¸­å¿ƒæ‹‰å–æœåŠ¡åˆ—è¡¨ç„¶ååšè´Ÿè½½å‡è¡¡ï¼Œè‡³æ­¤æµç¨‹å®Œæ¯•ï¼</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>ç½‘å…³æ­å»ºæ­¥éª¤ï¼š</p>\n<ol>\n<li>åˆ›å»ºé¡¹ç›®ï¼Œå¼•å…¥ nacos æœåŠ¡å‘ç°å’Œ gateway ä¾èµ–</li>\n<li>é…ç½® application.ymlï¼ŒåŒ…æ‹¬æœåŠ¡åŸºæœ¬ä¿¡æ¯ï¼Œnacos åœ°å€ï¼Œè·¯ç”±</li>\n</ol>\n<p>è·¯ç”±é…ç½®åŒ…æ‹¬ï¼š</p>\n<ol>\n<li>è·¯ç”± idï¼šè·¯ç”±çš„å”¯ä¸€æ ‡ç¤º</li>\n<li>è·¯ç”±ç›®æ ‡ (uri)ï¼šè·¯ç”±çš„ç›®æ ‡åœ°å€ï¼Œhttp ä»£è¡¨å›ºå®šåœ°å€ï¼Œlb ä»£è¡¨æ ¹æ®æœåŠ¡åè´Ÿè½½å‡è¡¡</li>\n<li>è·¯ç”±æ–­è¨€ (predicates)ï¼šåˆ¤æ–­è·¯ç”±çš„è§„åˆ™</li>\n<li>è¿‡æ»¤å™¨ (filters)ï¼šå¯¹è¯·æ±‚æˆ–å“åº”åšå¤„ç†</li>\n</ol>\n</blockquote>\n<h3 id=\"65-è·¯ç”±æ–­è¨€å·¥å‚route-predicate-factory\"><a class=\"anchor\" href=\"#65-è·¯ç”±æ–­è¨€å·¥å‚route-predicate-factory\">#</a> 6.5ã€è·¯ç”±æ–­è¨€å·¥å‚ Route Predicate FactoryğŸŒ³</h3>\n<p>ç½‘å…³è·¯ç”±å¯ä»¥é…ç½®çš„å†…å®¹åŒ…æ‹¬ï¼š</p>\n<ul>\n<li>è·¯ç”± idï¼šè·¯ç”±å”¯ä¸€æ ‡ç¤º</li>\n<li>uriï¼šè·¯ç”±ç›®çš„åœ°ï¼Œæ”¯æŒ lb å’Œ http ä¸¤ç§</li>\n<li>&lt;font color='red'&gt;predicatesï¼šè·¯ç”±æ–­è¨€ï¼Œåˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œç¬¦åˆåˆ™è½¬å‘åˆ°è·¯ç”±ç›®çš„åœ° &lt;/font&gt;.</li>\n<li>filtersï¼šè·¯ç”±è¿‡æ»¤å™¨ï¼Œå¤„ç†è¯·æ±‚æˆ–å“åº”</li>\n</ul>\n<p>æ–­è¨€æˆ‘ä»¬çŸ¥é“å°±æ˜¯ä¸€ç§åˆ¤æ–­çš„è§„åˆ™ï¼Œé‚£æ–­è¨€å·¥å‚åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>\n<h4 id=\"651-è·¯ç”±æ–­è¨€å·¥å‚route-predicate-factory\"><a class=\"anchor\" href=\"#651-è·¯ç”±æ–­è¨€å·¥å‚route-predicate-factory\">#</a> 6.5.1ã€è·¯ç”±æ–­è¨€å·¥å‚ Route Predicate FactoryğŸŒ²</h4>\n<ul>\n<li>\n<p>æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å†™çš„æ–­è¨€è§„åˆ™åªæ˜¯å­—ç¬¦ä¸²ï¼Œè¿™äº›å­—ç¬¦ä¸²ä¼šè¢« (æ–­è¨€å·¥å‚) Prediacte Factory è¯»å–å¹¶å¤„ç†ï¼Œè½¬å˜ä¸ºè·¯ç”±åˆ¤æ–­çš„æ¡ä»¶</p>\n</li>\n<li>\n<p>ä¾‹å¦‚ Path=/user/*** æ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œè¿™ä¸ªè§„åˆ™æ˜¯ç”±</p>\n<p>org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory ç±»æ¥å¤„ç†çš„</p>\n</li>\n<li>\n<p>åƒè¿™æ ·çš„æ–­è¨€å·¥å‚åœ¨ SpringCloudGateway è¿˜æœ‰åå‡ ä¸ªï¼Œæ¯ä¸ªéƒ½æœ‰è‡ªå·±çš„åˆ¤æ–­è§„åˆ™å’Œæ¡ä»¶</p>\n</li>\n</ul>\n<p><strong>Spring æä¾›äº† 11 ç§åŸºæœ¬çš„ Predicate å·¥å‚</strong>ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>è¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>After</td>\n<td>æ˜¯æŸä¸ªæ—¶é—´ç‚¹åçš„è¯·æ±‚</td>\n<td>- After=2037-01-20T17:42:47.789-07:00[America/Denver]</td>\n</tr>\n<tr>\n<td>Before</td>\n<td>æ˜¯æŸä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚</td>\n<td>- Before=2031-04-13T15:14:47.433+08:00[Asia/Shanghai]</td>\n</tr>\n<tr>\n<td>Between</td>\n<td>æ˜¯æŸä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚</td>\n<td>- Between=2037-01-20T17:42:47.789-07:00[America/Denver]&lt;br /&gt;,2037-01-21T17:42:47.789-07:00[America/Denver]</td>\n</tr>\n<tr>\n<td>Cookie</td>\n<td>è¯·æ±‚å¿…é¡»åŒ…å«æŸäº› Cookie</td>\n<td>- Cookie=chocolateï¼Œch.p</td>\n</tr>\n<tr>\n<td>Header</td>\n<td>è¯·æ±‚å¿…é¡»åŒ…å«æŸäº› header</td>\n<td>- Header=X-Request-Idï¼Œ\\d+</td>\n</tr>\n<tr>\n<td>Host</td>\n<td>è¯·æ±‚å¿…é¡»æ˜¯è®¿é—®æŸä¸ª host (åŸŸå)</td>\n<td><code>- Host**.somehost.orgï¼Œ**.anotherhost.org</code></td>\n</tr>\n<tr>\n<td>Method</td>\n<td>è¯·æ±‚æ–¹å¼å¿…é¡»æ˜¯æŒ‡å®šæ–¹å¼</td>\n<td>- Method=GETï¼ŒPOST</td>\n</tr>\n<tr>\n<td>Path</td>\n<td>è¯·æ±‚è·¯å¾„å¿…é¡»ç¬¦åˆæŒ‡å®šè§„åˆ™</td>\n<td>- Path=/red/{segment}ï¼Œ/blue/**</td>\n</tr>\n<tr>\n<td>Query</td>\n<td>è¯·æ±‚å‚æ•°å¿…é¡»åŒ…å«æŒ‡å®šå‚æ•°</td>\n<td>- Query=nameï¼Œjack æˆ–è€… - Query=name</td>\n</tr>\n<tr>\n<td>RemoteAddr</td>\n<td>è¯·æ±‚è€…çš„ ip å¿…é¡»æ˜¯æŒ‡å®šèŒƒå›´</td>\n<td>- RemoteAddr=192.168.1.1/24</td>\n</tr>\n<tr>\n<td>Weight</td>\n<td>æƒé‡å¤„ç†</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>åŠŸèƒ½æ¼”ç¤ºï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#=========== è¿™äº›é…ç½®è®©ç½‘å…³èƒ½å¤Ÿè”ç³»ä¸Š nacos å®ç°æœåŠ¡æ³¨å†Œå’Œå‘ç° ====</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span>                                              <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10010</span> <span class=\"token comment\"># ç½‘å…³ç«¯å£                              #||</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>                                              <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span>                                       <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> gateway <span class=\"token comment\"># æœåŠ¡åç§°                           #||</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span>                                              <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span>                                            <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span> <span class=\"token comment\"># nacos åœ°å€          #||</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#========================================================</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#========================= ç½‘å…³è·¯ç”±é…ç½® =====================</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span>                                           <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># ç½‘å…³è·¯ç”±é…ç½®                              ||</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> user_service <span class=\"token comment\"># è·¯ç”± idï¼Œè‡ªå®šä¹‰ï¼Œåªè¦å”¯ä¸€å³å¯    ||</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\"># uri æœ‰ä¸¤ç§æ–¹å¼çš„å†™æ³•                             ||</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\"># uri: http://127.0.0.1:8081 # è·¯ç”±çš„ç›®æ ‡åœ°å€ http å°±æ˜¯å›ºå®šåœ°å€</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>          <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//userservice <span class=\"token comment\"># è·¯ç”±çš„ç›®æ ‡åœ°å€ lb (LoadBalance) å°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œåé¢è·ŸæœåŠ¡åç§°</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>          <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># è·¯ç”±æ–­è¨€ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè·¯ç”±è§„åˆ™çš„æ¡ä»¶</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token punctuation\">-</span> Path=/user/<span class=\"token important\">**</span> <span class=\"token comment\"># è¿™ä¸ªæ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œåªè¦ä»¥ /user/ å¼€å¤´å°±ç¬¦åˆè¦æ±‚</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> order_service                            <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>          <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//orderservice                       <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>          <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span>                                  <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token punctuation\">-</span> Path=/order/<span class=\"token important\">**</span>                           <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token comment\"># é…ç½®æ–­è¨€è§„åˆ™æ˜¯åœ¨ 2037 å¹´ä¹‹åæ‰èƒ½è®¿é—®</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token punctuation\">-</span> After=2037<span class=\"token punctuation\">-</span>01<span class=\"token punctuation\">-</span>20T17<span class=\"token punctuation\">:</span>42<span class=\"token punctuation\">:</span>47.789<span class=\"token punctuation\">-</span>07<span class=\"token punctuation\">:</span>00<span class=\"token punctuation\">[</span>America/Denver<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#========================================================</span></pre></td></tr></table></figure><p>è®¿é—® uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzEyNy4wLjAuMToxMDAxMC9vcmRlci8xMDE=\">http://127.0.0.1:10010/order/101</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071706489.png\" alt=\"image-20231007170619279\" /></p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#=========== è¿™äº›é…ç½®è®©ç½‘å…³èƒ½å¤Ÿè”ç³»ä¸Š nacos å®ç°æœåŠ¡æ³¨å†Œå’Œå‘ç° ====</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span>                                              <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10010</span> <span class=\"token comment\"># ç½‘å…³ç«¯å£                              #||</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>                                              <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span>                                       <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> gateway <span class=\"token comment\"># æœåŠ¡åç§°                           #||</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span>                                              <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span>                                            <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span> <span class=\"token comment\"># nacos åœ°å€          #||</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#========================================================</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#========================= ç½‘å…³è·¯ç”±é…ç½® =====================</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span>                                           <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># ç½‘å…³è·¯ç”±é…ç½®                              ||</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> user_service <span class=\"token comment\"># è·¯ç”± idï¼Œè‡ªå®šä¹‰ï¼Œåªè¦å”¯ä¸€å³å¯    ||</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\"># uri æœ‰ä¸¤ç§æ–¹å¼çš„å†™æ³•                             ||</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\"># uri: http://127.0.0.1:8081 # è·¯ç”±çš„ç›®æ ‡åœ°å€ http å°±æ˜¯å›ºå®šåœ°å€</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>          <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//userservice <span class=\"token comment\"># è·¯ç”±çš„ç›®æ ‡åœ°å€ lb (LoadBalance) å°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œåé¢è·ŸæœåŠ¡åç§°</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>          <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># è·¯ç”±æ–­è¨€ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè·¯ç”±è§„åˆ™çš„æ¡ä»¶</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token punctuation\">-</span> Path=/user/<span class=\"token important\">**</span> <span class=\"token comment\"># è¿™ä¸ªæ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œåªè¦ä»¥ /user/ å¼€å¤´å°±ç¬¦åˆè¦æ±‚</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> order_service                            <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>          <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//orderservice                       <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>          <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span>                                  <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token punctuation\">-</span> Path=/order/<span class=\"token important\">**</span>                           <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token comment\"># é…ç½®æ–­è¨€è§„åˆ™æ˜¯åœ¨ 2037 å¹´ä¹‹åæ‰èƒ½è®¿é—®</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token punctuation\">-</span> Before=2037<span class=\"token punctuation\">-</span>01<span class=\"token punctuation\">-</span>20T17<span class=\"token punctuation\">:</span>42<span class=\"token punctuation\">:</span>47.789<span class=\"token punctuation\">-</span>07<span class=\"token punctuation\">:</span>00<span class=\"token punctuation\">[</span>America/Denver<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#========================================================</span></pre></td></tr></table></figure><p>è®¿é—® uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzEyNy4wLjAuMToxMDAxMC9vcmRlci8xMDE=\">http://127.0.0.1:10010/order/101</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071707263.png\" alt=\"image-20231007170751853\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<ul>\n<li>\n<p>PredicateFactory çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<p>è¯»å–ç”¨æˆ·å®šä¹‰çš„æ–­è¨€æ¡ä»¶ï¼Œå¯¹è¯·æ±‚åšåˆ¤æ–­</p>\n</li>\n<li>\n<p>Path=/user/** æ˜¯ä»€ä¹ˆå«ä¹‰ï¼Ÿ</p>\n<p>è·¯å¾„æ˜¯ä»¥ /user å¼€å¤´çš„å°±è®¤ä¸ºæ˜¯ç¬¦åˆçš„</p>\n</li>\n</ul>\n</blockquote>\n<h3 id=\"66-è·¯ç”±è¿‡æ»¤gatewayfilter\"><a class=\"anchor\" href=\"#66-è·¯ç”±è¿‡æ»¤gatewayfilter\">#</a> 6.6ã€è·¯ç”±è¿‡æ»¤ GatewayFilterğŸŒ³</h3>\n<p>GatewayFilter æ˜¯ç½‘å…³ä¸­æä¾›çš„ä¸€ç§è¿‡æ»¤å™¨ï¼Œå¯ä»¥å¯¹è¿›å…¥ç½‘å…³çš„<mark>è¯·æ±‚</mark>å’Œå¾®æœåŠ¡è¿”å›çš„<mark>å“åº”</mark>åš<mark>å¤„ç†</mark>ã€‚</p>\n<p>è¯·æ±‚ï¼š</p>\n<blockquote>\n<p>å½“ç”¨æˆ·å‘ç½‘å…³å‘èµ·è¯·æ±‚æ—¶ï¼Œéœ€è¦å…ˆåšè·¯ç”±é‡Œé¢ä¼šæœ‰ä¸€ä¸ªæ–­è¨€å·¥å‚å®ƒå¯ä»¥åŸºäºæˆ‘ä»¬é…ç½®çš„è§„åˆ™å®Œæˆè¯·æ±‚è·¯ç”±å»åˆ¤æ–­åˆ°åº•åº”è¯¥åˆ°å“ªä¸ªå¾®æœåŠ¡ã€‚ä½†æ˜¯è·¯ç”±ä¹‹åä¹Ÿå¹¶ä¸èƒ½ç›´æ¥å‘å¾®æœåŠ¡å‘èµ·è¯·æ±‚ã€‚å› ä¸ºæˆ‘ä»¬è¿˜å¯ä»¥ç»™è·¯ç”±é…ç½®å„ç§å„æ ·çš„è¿‡æ»¤å™¨</p>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071746074.png\" alt=\"image-20231007174642784\" /></p>\n<blockquote>\n<p>è¿™äº›è¿‡æ»¤å™¨ä¼šå½¢æˆä¸€ä¸ªè¿‡æ»¤å™¨é“¾ã€‚é‚£ä¹ˆç”¨æˆ·çš„è¯·æ±‚å°±ä¸€å®šè¦ç»è¿‡è¿™äº›è¿‡æ»¤å™¨é“¾ï¼Œç„¶åæ‰èƒ½åˆ°è¾¾å¾®æœåŠ¡ã€‚</p>\n<p>é‚£ä¹ˆåœ¨è¿™ä¸ªè¿‡ç¨‹å½“ä¸­è¿‡æ»¤å™¨å°±å¯ä»¥å¯¹è¿›å…¥ç½‘å…³çš„è¯·æ±‚åšå„ç§å¤„ç†ã€‚æ¯”å¦‚è¯´å¯¹è¯·æ±‚å¤´æˆ–è€…è¯·æ±‚å‚æ•°åšä»€ä¹ˆå¤„ç†éƒ½æ˜¯æ²¡é—®é¢˜çš„ã€‚</p>\n</blockquote>\n<p>å“åº”ï¼š</p>\n<blockquote>\n<p>å½“ç”¨æˆ·è¯·æ±‚ç»™å¾®æœåŠ¡åï¼Œå¾®æœåŠ¡å¤„ç†å®Œäº†è¦è¿”å›ä¸€ä¸ªç»“æœã€‚è€Œè¿™ä¸ªç»“æœè‚¯å®šä¹Ÿæ˜¯å…ˆåˆ°è¾¾äº†ç½‘å…³ï¼Œç½‘å…³åŒæ ·ä¼šç»è¿‡è¿‡æ»¤å™¨é“¾æ¥é€å±‚å¤„ç†è¿™ä¸ªå“åº”ç»“æœï¼Œæœ€ç»ˆæ‰ä¼šè¿”å›ç»™ç”¨æˆ·</p>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071754515.png\" alt=\"image-20231007175153476\" /></p>\n<blockquote>\n<p>é‚£ä¹ˆåœ¨è¿™ä¸ªè¿‡ç¨‹å½“ä¸­è¿‡æ»¤å™¨å¯ä»¥å¯¹å“åº”åšäº›ä»€ä¹ˆäº‹å„¿å‘¢ï¼Ÿæ¯”å¦‚è¯´æŠŠå“åº”å¤´æ£€æŸ¥ä¸€ä¸‹åŠ ä¸€äº›å¤´ä¿¡æ¯ä¹‹ç±»çš„</p>\n</blockquote>\n<p>å¯¹è¯·æ±‚æˆ–å“åº”åšå‡ºå„ç§å„æ ·çš„å¤„ç†ï¼Œå…·ä½“èƒ½åšå‡ºä»€ä¹ˆæ ·çš„å¤„ç†é‚£å°±è¦çœ‹ Spring é‡Œé¢æä¾›çš„è¿‡æ»¤å·¥å‚äº†</p>\n<h4 id=\"661-è¿‡æ»¤å™¨å·¥å‚gatewayfilterfactory\"><a class=\"anchor\" href=\"#661-è¿‡æ»¤å™¨å·¥å‚gatewayfilterfactory\">#</a> 6.6.1ã€è¿‡æ»¤å™¨å·¥å‚ GatewayFilterFactoryğŸŒ²</h4>\n<p>Spring æä¾›äº† 31 ç§ä¸åŒçš„è·¯ç”±è¿‡æ»¤å™¨å·¥å‚ã€‚ä¾‹å¦‚ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>AddRequestHeader</td>\n<td>ç»™å½“å‰è¯·æ±‚æ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´</td>\n</tr>\n<tr>\n<td>RemoveRequestHeader</td>\n<td>ç§»é™¤è¯·æ±‚ä¸­çš„ä¸€ä¸ªè¯·æ±‚å¤´</td>\n</tr>\n<tr>\n<td>AddResponseHeader</td>\n<td>ç»™å“åº”ç»“æœä¸­æ·»åŠ ä¸€ä¸ªå“åº”å¤´</td>\n</tr>\n<tr>\n<td>RemoveResponseHeader</td>\n<td>ä»å“åº”ç»“æœä¸­ç§»é™¤æœ‰ä¸€ä¸ªå“åº”å¤´</td>\n</tr>\n<tr>\n<td>RequestRateLimiter</td>\n<td>é™åˆ¶è¯·æ±‚çš„æµé‡</td>\n</tr>\n<tr>\n<td>â€¦</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"6611-ä»£ç æ¡ˆä¾‹\"><a class=\"anchor\" href=\"#6611-ä»£ç æ¡ˆä¾‹\">#</a> 6.6.1.1ã€ä»£ç æ¡ˆä¾‹ğŸŒ´</h5>\n<p><strong>ç»™æ‰€æœ‰è¿›å…¥ userservice çš„è¯·æ±‚æ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´</strong>.</p>\n<p>ç»™æ‰€æœ‰è¿›å…¥ userservice çš„è¯·æ±‚æ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´ï¼šTruth=itcast is freaking awesome!</p>\n<p>å®ç°æ–¹å¼ï¼š</p>\n<p>åœ¨ gateway ä¸­ä¿®æ”¹ application.yml æ–‡ä»¶ï¼Œç»™ userservice çš„è·¯ç”±æ·»åŠ è¿‡æ»¤å™¨ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span>                                          </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># ç½‘å…³è·¯ç”±é…ç½®                              </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> user_service <span class=\"token comment\"># è·¯ç”± idï¼Œè‡ªå®šä¹‰ï¼Œåªè¦å”¯ä¸€å³å¯   </span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\"># uri æœ‰ä¸¤ç§æ–¹å¼çš„å†™æ³•                             </span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\"># uri: http://127.0.0.1:8081 # è·¯ç”±çš„ç›®æ ‡åœ°å€ http å°±æ˜¯å›ºå®šåœ°å€</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>          <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//userservice <span class=\"token comment\"># è·¯ç”±çš„ç›®æ ‡åœ°å€ lb (LoadBalance) å°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œåé¢è·ŸæœåŠ¡åç§°</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>          <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># è·¯ç”±æ–­è¨€ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè·¯ç”±è§„åˆ™çš„æ¡ä»¶</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token punctuation\">-</span> Path=/user/<span class=\"token important\">**</span> <span class=\"token comment\"># è¿™ä¸ªæ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œåªè¦ä»¥ /user/ å¼€å¤´å°±ç¬¦åˆè¦æ±‚</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>          <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># è¿‡æ»¤å™¨</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token punctuation\">-</span> AddRequestHeader=Truth<span class=\"token punctuation\">,</span>Itcast is freaking awesome<span class=\"token tag\">!</span> <span class=\"token comment\"># æ·»åŠ è¯·æ±‚å¤´</span></pre></td></tr></table></figure><p>åœ¨ UserController ç±»ä¸­ç¼–å†™ queryById ä½¿ç”¨æ³¨è§£ @RequestHeader è·å–è¯·æ±‚å¤´çš„ä¿¡æ¯ï¼ŒåŠ ä¸Š require=false è¡¨ç¤ºæ²¡è·å–åˆ°ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œä¸åŠ ä¼šæŠ¥é”™ã€‚è¾“å‡ºè¯·æ±‚å¤´çš„ä¿¡æ¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserService</span> userService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">queryById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@RequestHeader</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"Truth\"</span><span class=\"token punctuation\">,</span> required <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> truth<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"truth: \"</span> <span class=\"token operator\">+</span> truth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">return</span> userService<span class=\"token punctuation\">.</span><span class=\"token function\">queryById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è®¿é—® uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDoxMDAxMC91c2VyLzE=\">http://localhost:10010/user/1</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071926883.png\" alt=\"image-20231007192552616\" /></p>\n<p>å¯ä»¥æ­£å¸¸è®¿é—®æˆ‘ä»¬æŸ¥çœ‹ idea æ§åˆ¶å°ä¸­ user-service çš„æ‰“å°æœ‰æ²¡æœ‰è¯·æ±‚ä½“ä¿¡æ¯è¾“å‡ºçš„é‚£å¥è¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071928357.png\" alt=\"image-20231007192850157\" /></p>\n<p>å¯ä»¥çœ‹åˆ°è¯·æ±‚å¤´ä¿¡æ¯è¢«æ‰“å°å‡ºæ¥äº†ã€‚</p>\n<p>ä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œæˆ‘å¦‚æœæƒ³è¦ç»™å…¨éƒ¨çš„å¾®æœåŠ¡éƒ½åŠ è¯·æ±‚å¤´ä¿¡æ¯å‘¢ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨é»˜è®¤è¿‡æ»¤å™¨æ¥é…ç½®</p>\n<h5 id=\"6612-é»˜è®¤è¿‡æ»¤å™¨\"><a class=\"anchor\" href=\"#6612-é»˜è®¤è¿‡æ»¤å™¨\">#</a> 6.6.1.2ã€é»˜è®¤è¿‡æ»¤å™¨ğŸŒ´</h5>\n<p>å¦‚æœè¦å¯¹æ‰€æœ‰çš„è·¯ç”±éƒ½ç”Ÿæ•ˆï¼Œåˆ™å¯ä»¥å°†è¿‡æ»¤å™¨å·¥å‚å†™åˆ° default ä¸‹ã€‚æ ¼å¼å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span>                                          </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># ç½‘å…³è·¯ç”±é…ç½®                              </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> user_service <span class=\"token comment\"># è·¯ç”± idï¼Œè‡ªå®šä¹‰ï¼Œåªè¦å”¯ä¸€å³å¯   </span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\"># uri æœ‰ä¸¤ç§æ–¹å¼çš„å†™æ³•                             </span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\"># uri: http://127.0.0.1:8081 # è·¯ç”±çš„ç›®æ ‡åœ°å€ http å°±æ˜¯å›ºå®šåœ°å€</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>          <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//userservice <span class=\"token comment\"># è·¯ç”±çš„ç›®æ ‡åœ°å€ lb (LoadBalance) å°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œåé¢è·ŸæœåŠ¡åç§°</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>          <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># è·¯ç”±æ–­è¨€ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè·¯ç”±è§„åˆ™çš„æ¡ä»¶</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token punctuation\">-</span> Path=/user/<span class=\"token important\">**</span> <span class=\"token comment\"># è¿™ä¸ªæ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œåªè¦ä»¥ /user/ å¼€å¤´å°±ç¬¦åˆè¦æ±‚</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token key atrule\">default-filters</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># é»˜è®¤è¿‡æ»¤å™¨ï¼Œä¼šå¯¹æ‰€æœ‰çš„è·¯ç”±è¯·æ±‚éƒ½ç”Ÿæ•ˆ</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">-</span> AddRequestHeader=Truth<span class=\"token punctuation\">,</span>Itcast is freaking awesome<span class=\"token tag\">!</span> <span class=\"token comment\"># æ·»åŠ è¯·æ±‚å¤´</span></pre></td></tr></table></figure><p>å¤šè®¿é—®å‡ æ¬¡ uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDoxMDAxMC91c2VyLzE=\">http://localhost:10010/user/1</span></p>\n<p>æŸ¥çœ‹æ¯ä¸ªæœåŠ¡çš„æ‰“å°ä¿¡æ¯æ˜¯å¦æœ‰è¯·æ±‚å¤´ä¿¡æ¯</p>\n<p>8081</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071938856.png\" alt=\"image-20231007193808029\" /></p>\n<p>8082</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071938158.png\" alt=\"image-20231007193834963\" /></p>\n<p>8083</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071939348.png\" alt=\"image-20231007193903983\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<ul>\n<li>è¿‡æ»¤å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\n<ol>\n<li>å¯¹è·¯ç”±çš„è¯·æ±‚æˆ–å“åº”åšåŠ å·¥å¤„ç†ï¼Œæ¯”å¦‚æ·»åŠ è¯·æ±‚å¤´</li>\n<li>é…ç½®åœ¨è·¯ç”±ä¸‹çš„è¿‡æ»¤å™¨åªå¯¹å½“å‰è·¯ç”±çš„è¯·æ±‚ç”Ÿæ•ˆ</li>\n</ol>\n</li>\n<li>defaultFilters çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\n<ol>\n<li>å¯¹æ‰€æœ‰è·¯ç”±éƒ½ç”Ÿæ•ˆçš„è¿‡æ»¤å™¨</li>\n</ol>\n</li>\n</ul>\n</blockquote>\n<h4 id=\"662-å…¨å±€è¿‡æ»¤å™¨globalfilter\"><a class=\"anchor\" href=\"#662-å…¨å±€è¿‡æ»¤å™¨globalfilter\">#</a> 6.6.2ã€å…¨å±€è¿‡æ»¤å™¨ GlobalFilterğŸŒ²</h4>\n<p>å…¨å±€è¿‡æ»¤å™¨çš„ä½œç”¨ä¹Ÿæ˜¯å¤„ç†ä¸€åˆ‡è¿›å…¥ç½‘å…³çš„è¯·æ±‚å’Œå¾®æœåŠ¡å“åº”ï¼Œä¸ GatewayFilter çš„ä½œç”¨ä¸€æ ·ã€‚</p>\n<p>åŒºåˆ«åœ¨äº GatewayFilter é€šè¿‡é…ç½®å®šä¹‰ï¼Œå¤„ç†é€»è¾‘æ˜¯å›ºå®šçš„ã€‚è€Œ GlobalFilter çš„é€»è¾‘éœ€è¦è‡ªå·±å†™ä»£ç å®ç°å¯æ“ä½œæ€§æ›´é«˜ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ClobalFilter</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   * å¤„ç†å½“å‰è¯·æ±‚ï¼Œæœ‰å¿…è¦çš„è¯é€šè¿‡ &#123;@link GatewayFilterChain&#125; å°†è¯·æ±‚äº¤ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨å¤„ç†</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   *</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   * @param exchange è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œé‡Œé¢å¯ä»¥è·å– Requestï¼ŒResponse ç­‰ä¿¡æ¯</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   * @param chain ç”¨æ¥æŠŠè¯·æ±‚å§”æ‰˜ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   * @return &#123;@code Mono&lt;Void>&#125; è¿”å›æ ‡ç¤ºå½“å‰è¿‡æ»¤å™¨ä¸šåŠ¡ç»“æŸ</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   */</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token class-name\">Mono</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Void</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ServerWebExchange</span> exchange<span class=\"token punctuation\">,</span> <span class=\"token class-name\">GatewayFilterChain</span> chain<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h5 id=\"6621-ä»£ç æ¡ˆä¾‹\"><a class=\"anchor\" href=\"#6621-ä»£ç æ¡ˆä¾‹\">#</a> 6.6.2.1ã€ä»£ç æ¡ˆä¾‹ğŸŒ´</h5>\n<p><strong>å®šä¹‰å…¨å±€è¿‡æ»¤å™¨ï¼Œæ‹¦æˆªå¹¶åˆ¤æ–­ç”¨æˆ·èº«ä»½</strong>.</p>\n<p>éœ€æ±‚ï¼šå®šä¹‰å…¨å±€è¿‡æ»¤å™¨ï¼Œæ‹¦æˆªè¯·æ±‚ï¼Œåˆ¤æ–­è¯·æ±‚çš„å‚æ•°æ˜¯å¦æ»¡è¶³ä¸‹é¢æ¡ä»¶ï¼š</p>\n<ul>\n<li>å‚æ•°ä¸­æ˜¯å¦æœ‰ authorization</li>\n<li>authorization å‚æ•°å€¼æ˜¯å¦ä¸º admin</li>\n</ul>\n<p>å¦‚æœåŒæ—¶æ»¡è¶³åˆ™æ”¾è¡Œï¼Œå¦åˆ™æ‹¦æˆª</p>\n<p>åœ¨ gateway æœåŠ¡ä¸­åˆ›å»ºä¸€ä¸ª AuthorizeFilter ç±»å®ç° GlobalFilter æ¥å£å¹¶é‡å†™è¿‡æ»¤å™¨æ–¹æ³•æ¥è¾¾åˆ°è‡ªå·±çš„ç›®çš„</p>\n<p>ç›®çš„ï¼šè¯·æ±‚å¤´æœ‰ authorization=admin çš„ä¿¡æ¯åˆ™å¯ä»¥è®¿é—®ç½‘å…³åçš„æœåŠ¡ï¼Œå¦åˆ™æ‹¦æˆª</p>\n<p>@Orderï¼šé…ç½®å¤šä¸ªè¿‡æ»¤å™¨çš„æ‰§è¡Œä¼˜å…ˆçº§ 21 äº¿åˆ°è´Ÿ 21 äº¿  æ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</p>\n<p>ä¹Ÿå¯ä»¥å®ç° Ordered å¹¶é‡å†™ getOrder å‡½æ•°æ¥å®ç°å¤šè¿‡æ»¤å™¨æ‰§è¡Œä¼˜å…ˆçº§</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span>gateway<span class=\"token punctuation\">.</span>filter<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">GatewayFilterChain</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span>gateway<span class=\"token punctuation\">.</span>filter<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">GlobalFilter</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Order</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpStatus</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span>reactive<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServerHttpRequest</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Component</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MultiValueMap</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServerWebExchange</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">reactor<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>publisher<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Mono</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * @2023/10/719:53</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * @function</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> * @comment</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">// @Orderï¼šè®¾ç½®å¤šä¸ªè¿‡æ»¤å™¨æ‰§è¡Œçš„ä¼˜å…ˆçº§é¡ºåºï¼Œå¯ä»¥é€šè¿‡æ³¨è§£ä¹Ÿå¯ä»¥é€šè¿‡æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token annotation punctuation\">@Order</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AuthorizeFilter</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">GlobalFilter</span><span class=\"token comment\">/*, Ordered*/</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Mono</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Void</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ServerWebExchange</span> exchange<span class=\"token punctuation\">,</span> <span class=\"token class-name\">GatewayFilterChain</span> chain<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token comment\">// 1. è·å–è¯·æ±‚å‚æ•°</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">ServerHttpRequest</span> request <span class=\"token operator\">=</span> exchange<span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token class-name\">MultiValueMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> params <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getQueryParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">// 2. è·å–å‚æ•°ä¸­çš„ authorization å‚æ•°</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token class-name\">String</span> auth <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">getFirst</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"authorization\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token comment\">// 3. åˆ¤æ–­å‚æ•°å€¼æ˜¯å¦ç­‰äº admin</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>auth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token comment\">// 4. æ˜¯ï¼Œæ”¾è¡Œ</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token keyword\">return</span> chain<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token comment\">// 5. å¦æ‹¦æˆª</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token comment\">// 5.1 è®¾ç½®çŠ¶æ€ç è¿”å›ç»™ç”¨æˆ·</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        exchange<span class=\"token punctuation\">.</span><span class=\"token function\">getResponse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpStatus</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UNAUTHORIZED</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token comment\">// 5.2 æ‹¦æˆªè¯·æ±‚</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token keyword\">return</span> exchange<span class=\"token punctuation\">.</span><span class=\"token function\">getResponse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setComplete</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    é‡å†™æ‰§è¡Œè¿‡æ»¤å™¨ä¼˜å…ˆçº§çš„æ–¹æ³•</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    @Override</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    public int getOrder () &#123;</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        return -1;</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    &#125;</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è®¿é—® uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzEyNy4wLjAuMToxMDAxMC91c2VyLzE=\">http://127.0.0.1:10010/user/1</span></p>\n<p>æ¬¡ uri æ²¡æœ‰å†™åœ¨è¯·æ±‚å¤´ä¿¡æ¯ authorization=admin</p>\n<p>ç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310072014686.png\" alt=\"image-20231007201452411\" /></p>\n<p>ç”±äºè®¿é—®è¢«æ‹¦æˆªæ‰€ä»¥æœåŠ¡åœ¨ idea ä¸­æ§åˆ¶å°æ²¡æœ‰æ‰“å°ä»»ä½•è¯·æ±‚çš„å“åº”æ•°æ®</p>\n<p>è¿™æ¬¡æºå¸¦ä¸Šè¯·æ±‚å¤´ä¿¡æ¯ authorization=admin å†è¿›è¡Œè®¿é—® uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzEyNy4wLjAuMToxMDAxMC91c2VyLzE/YXV0aG9yaXphdGlvbj1hZG1pbg==\">http://127.0.0.1:10010/user/1?authorization=admin</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310072015402.png\" alt=\"image-20231007201545206\" /></p>\n<p>è®¿é—®æˆåŠŸï¼</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<ul>\n<li>\n<p>å…¨å±€è¿‡æ»¤å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<p>å¯¹æ‰€æœ‰è·¯ç”±éƒ½ç”Ÿæ•ˆçš„è¿‡æ»¤å™¨ï¼Œå¹¶ä¸”å¯ä»¥è‡ªå®šä¹‰å¤„ç†é€»è¾‘</p>\n</li>\n<li>\n<p>å®ç°å…¨å±€è¿‡æ»¤å™¨çš„æ­¥éª¤ï¼Ÿ</p>\n<ol>\n<li>å®ç° GlobalFilter æ¥å£</li>\n<li>æ·»åŠ  @Order æ³¨è§£æˆ–å®ç° Ordered æ¥å£</li>\n<li>ç¼–å†™å¤„ç†é€»è¾‘</li>\n</ol>\n</li>\n</ul>\n</blockquote>\n<h4 id=\"663-è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº\"><a class=\"anchor\" href=\"#663-è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº\">#</a> 6.6.3ã€è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåºğŸŒ²</h4>\n<p>è¯·æ±‚è¿›å…¥ç½‘å…³ä¼šç¢°åˆ°ä¸‰ç±»è¿‡æ»¤å™¨ï¼šå½“å‰è·¯ç”±çš„è¿‡æ»¤å™¨ï¼ŒDefaultFilterï¼ŒGlobalFilter</p>\n<p>&lt;font color='red'&gt; è¯·æ±‚è·¯ç”±å &lt;/font&gt;ï¼Œä¼šå°†å½“å‰è·¯ç”±è¿‡æ»¤å™¨å’Œ DefaultFilterï¼ŒGlobalFilterï¼Œåˆå¹¶åˆ°ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ (é›†åˆ) ä¸­ï¼Œæ’åºåä¾æ¬¡æ‰§è¡Œæ¯ä¸ªè¿‡æ»¤å™¨</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310072025396.png\" alt=\"image-20231007202537098\" /></p>\n<p>ç½‘å…³ä¸­æ‰€æœ‰è¿‡æ»¤å™¨æœ€ç»ˆéƒ½æ˜¯ GatewayFilter ç±»å‹ï¼Œæ—¢ç„¶æ˜¯åŒä¸€ç§ç±»å‹é‚£å°±å¯ä»¥å­˜åˆ°ä¸€ä¸ªé›†åˆä¸­å»åšæ’åºäº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310072029369.png\" alt=\"image-20231007202943934\" /></p>\n<p>æ–°çš„é—®é¢˜æ˜¯ï¼Œæ€ä¹ˆæ’åºå‘¢ï¼Ÿ</p>\n<ul>\n<li>æ¯ä¸€ä¸ªè¿‡æ»¤å™¨éƒ½å¿…é¡»æŒ‡å®šä¸€ä¸ª int ç±»å‹çš„ order å€¼ï¼Œ<mark>order å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ‰§è¡Œé¡ºåºè¶Šé å‰</mark>ã€‚</li>\n<li>GlobalFilter é€šè¿‡å®ç° Ordered æ¥å£ï¼Œæˆ–è€…æ·»åŠ  @Order æ³¨è§£æ¥æŒ‡å®š order å€¼ï¼Œç”±æˆ‘ä»¬è‡ªå·±æŒ‡å®š</li>\n<li>è·¯ç”±è¿‡æ»¤å™¨å’Œ defaultFilter çš„ order ç”± Spring æŒ‡å®šï¼Œé»˜è®¤æ˜¯æŒ‰ç…§å£°æ˜é¡ºåºä» 1 é€’å¢ã€‚</li>\n<li>&lt;font color='red'&gt; å½“è¿‡æ»¤å™¨çš„ order å€¼ä¸€æ ·æ—¶ &lt;/font&gt;ï¼Œä¼šæŒ‰ç…§ defaultFilter &gt; è·¯ç”±è¿‡æ»¤å™¨ &gt; GlobalFilter çš„é¡ºåºæ‰§è¡Œã€‚</li>\n</ul>\n<p>é»˜è®¤æŒ‰ç…§å£°æ˜é¡ºåºä» 1 é€’å¢çš„è§£é‡Šï¼š</p>\n<blockquote>\n<p>æ¯ä¸ªè¿‡æ»¤å™¨å£°æ˜æ—¶æœ‰ä¸€ä¸ª order å€¼æ ‡è®°æ¯åŠ ä¸€ä¸ªå°±ä¼šé€’å¢ order å€¼ï¼Œè€Œä¸”è·¯ç”±è¿‡æ»¤å™¨å’Œ defaultFilter ä¸¤ä¸ª order æ˜¯åˆ†å¼€çš„ï¼Œè¿˜æœ‰è‡ªå®šä¹‰çš„ GlobalFilter æˆ‘ä»¬è‡ªå·±è®¾ç½® order å€¼ä¹Ÿå¯èƒ½ä¼šä¸€æ ·ï¼Œå€¼éƒ½å†²çªäº†è¯¥æ€ä¹ˆæ’åºå‘¢ï¼Ÿ</p>\n</blockquote>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span>                                          </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># ç½‘å…³è·¯ç”±é…ç½®                              </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> user_service <span class=\"token comment\"># è·¯ç”± idï¼Œè‡ªå®šä¹‰ï¼Œåªè¦å”¯ä¸€å³å¯   </span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\"># uri æœ‰ä¸¤ç§æ–¹å¼çš„å†™æ³•                             </span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\"># uri: http://127.0.0.1:8081 # è·¯ç”±çš„ç›®æ ‡åœ°å€ http å°±æ˜¯å›ºå®šåœ°å€</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>          <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//userservice <span class=\"token comment\"># è·¯ç”±çš„ç›®æ ‡åœ°å€ lb (LoadBalance) å°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œåé¢è·ŸæœåŠ¡åç§°</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>          <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># è·¯ç”±æ–­è¨€ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè·¯ç”±è§„åˆ™çš„æ¡ä»¶</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token punctuation\">-</span> Path=/user/<span class=\"token important\">**</span> <span class=\"token comment\"># è¿™ä¸ªæ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œåªè¦ä»¥ /user/ å¼€å¤´å°±ç¬¦åˆè¦æ±‚</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>          <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token punctuation\">-</span> AddRequestHeader=Truth<span class=\"token punctuation\">,</span>Itcast is freaking awesome<span class=\"token tag\">!</span> <span class=\"token comment\"># order 1</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token punctuation\">-</span> AxxxHeader=Truth<span class=\"token punctuation\">,</span>Itcast is freaking awesome<span class=\"token tag\">!</span> <span class=\"token comment\"># order 2</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token punctuation\">-</span> AxxxHeader=Truth<span class=\"token punctuation\">,</span>Itcast is freaking awesome<span class=\"token tag\">!</span> <span class=\"token comment\"># order 3</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token key atrule\">default-filters</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># é»˜è®¤è¿‡æ»¤å™¨ï¼Œä¼šå¯¹æ‰€æœ‰çš„è·¯ç”±è¯·æ±‚éƒ½ç”Ÿæ•ˆ</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">-</span> AddRequestHeader=Truth<span class=\"token punctuation\">,</span>Itcast is freaking awesome<span class=\"token tag\">!</span> <span class=\"token comment\"># order 1</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">-</span> AxxxHeader=Truth<span class=\"token punctuation\">,</span>Itcast is freaking awesome<span class=\"token tag\">!</span> <span class=\"token comment\"># order 2</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">-</span> AxxxHeader=Truth<span class=\"token punctuation\">,</span>Itcast is freaking awesome<span class=\"token tag\">!</span> <span class=\"token comment\"># order 3</span></pre></td></tr></table></figure><p>å¯ä»¥å‚è€ƒä¸‹é¢å‡ ä¸ªç±»çš„æºç æ¥æŸ¥çœ‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310072041796.png\" alt=\"image-20231007204141622\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<ul>\n<li>è·¯ç”±è¿‡æ»¤å™¨ï¼ŒdefaultFilterï¼Œå…¨å±€è¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºï¼Ÿ\n<ol>\n<li>order å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</li>\n<li>å½“ order å€¼ä¸€æ ·æ—¶ï¼Œé¡ºåºæ˜¯ defaultFilter æœ€å…ˆï¼Œç„¶åæ˜¯å±€éƒ¨çš„è·¯ç”±è¿‡æ»¤å™¨ï¼Œæœ€åæ˜¯å…¨å±€è¿‡æ»¤å™¨</li>\n</ol>\n</li>\n</ul>\n</blockquote>\n<h3 id=\"67-è·¨åŸŸé—®é¢˜å¤„ç†\"><a class=\"anchor\" href=\"#67-è·¨åŸŸé—®é¢˜å¤„ç†\">#</a> 6.7ã€è·¨åŸŸé—®é¢˜å¤„ç†ğŸŒ³</h3>\n<blockquote>\n<p>åœ¨å­¦ä¹ å‰åç«¯åˆ†ç¦»é¡¹ç›®æ—¶å·²ç»å­¦ä¹ è¿‡äº†è§£å†³è·¨åŸŸé—®é¢˜ï¼Œé‚£ä¸ºä»€ä¹ˆåœ¨å¾®æœåŠ¡ä¸­è¿˜è¦å­¦ä¹ è·¨åŸŸé—®é¢˜å‘¢ï¼Ÿ</p>\n<p>è¿™æ˜¯å› ä¸ºåœ¨å¾®æœåŠ¡ä¸­æ‰€æœ‰çš„è¯·æ±‚éƒ½è¦å…ˆç»è¿‡ç½‘å…³å†åˆ°å¾®æœåŠ¡ï¼Œä¹Ÿå°±æ˜¯è¯´è·¨åŸŸè¯·æ±‚ä½ ä¸éœ€è¦åœ¨æ¯ä¸ªå¾®æœåŠ¡é‡Œéƒ½å»å¤„ç†ã€‚ä»…ä»…åœ¨ç½‘å…³å¤„ç†å°±å¯ä»¥äº†ï¼Œä½†æ˜¯ç½‘å…³åˆè·Ÿæˆ‘ä»¬ä»¥å‰å®ç°ä¸ä¸€æ ·ï¼Œç½‘å…³æ˜¯åŸºäº WebFlux å®ç°çš„ï¼Œæ²¡æœ‰ Servlet ç›¸å…³çš„ API å› æ­¤æˆ‘ä»¬ä»¥å‰æ‰€å­¦çš„è§£å†³æ–¹æ¡ˆä¸ä¸€å®šèƒ½å¤Ÿé€‚ç”¨ã€‚</p>\n</blockquote>\n<p>è·¨åŸŸï¼šåŸŸåä¸ä¸€è‡´å°±æ˜¯è·¨åŸŸï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p>\n<ul>\n<li>åŸŸåä¸åŒï¼š<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy50YW9iYW8ueG4tLWNvbXd3dy1rNzZqLnRhb2Jhby54bi0tb3Jnd3d3LWs3NmouamQueG4tLWNvbW1pYW9zaGEtamg3cS5qcy5jb20=\">www.taobao.com å’Œ www.taobao.org å’Œ www.jd.com å’Œ miaosha.js.com</span></li>\n<li>åŸŸåç›¸åŒï¼Œç«¯å£ä¸åŒï¼šlocalhost:8080 å’Œ loclahost:8081</li>\n<li>ä½†æ˜¯æˆ‘ä»¬å‰é¢å­¦ä¹ ä¸€ç›´ç”¨çš„ 8080 è®¿é—® 8081 ç«¯å£çš„æ•°æ®å°±æ²¡æœ‰å‡ºç°ä»€ä¹ˆé—®é¢˜å•Šè¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ</li>\n</ul>\n<p><strong>åŸå› </strong>ï¼šè·¨åŸŸé—®é¢˜ï¼š<mark>æµè§ˆå™¨ç¦æ­¢</mark>è¯·æ±‚çš„å‘èµ·è€…ä¸æœåŠ¡ç«¯å‘ç”Ÿè·¨åŸŸ<mark> ajax è¯·æ±‚</mark>ï¼Œè¯·æ±‚è¢«æµè§ˆå™¨æ‹¦æˆªçš„é—®é¢˜</p>\n<p>order-service å’Œ user-service å’Œæµè§ˆå™¨æ²¡æœ‰å…³ç³»ï¼Œä¹Ÿæ²¡æœ‰ç”¨åˆ° ajax æ‰€ä»¥ä¸ä¼šå‡ºç°è·¨åŸŸé—®é¢˜</p>\n<p><mark>è§£å†³æ–¹æ¡ˆ</mark>ï¼šCORS</p>\n<h4 id=\"671-æ¼”ç¤ºæ¡ˆä¾‹\"><a class=\"anchor\" href=\"#671-æ¼”ç¤ºæ¡ˆä¾‹\">#</a> 6.7.1ã€æ¼”ç¤ºæ¡ˆä¾‹ğŸŒ²</h4>\n<p>å‰ç«¯é¡µé¢</p>\n<p>index.html</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>X-UA-Compatible<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ie=edge<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Document<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://unpkg.com/axios/dist/axios.min.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://localhost:10010/user/1?authorization=admin\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resp</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>resp<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>è®¿é—®é¡µé¢åæŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„æ‰“å°ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310072111173.png\" alt=\"image-20231007211114669\" /></p>\n<p>è¿™é‡Œæœ‰ä¸¥é‡çš„é—®é¢˜å› ä¸º gateway æœåŠ¡é…ç½®æ–‡ä»¶å…è®¸è·¨åŸŸçš„è¯·æ±‚ä¸å¯èƒ½æ˜¯ä¸Šå›¾ä¸­ uri çš„æ ·å­ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ä¸ªæœåŠ¡å™¨å¯åŠ¨é¡µé¢ç„¶åå°† uri å…è®¸è·¨åŸŸè¯·æ±‚å³å¯ï¼Œæ¯”å¦‚æˆ‘ä¸‹é¢æ˜¯ä½¿ç”¨ tomcat å¯åŠ¨çš„è¿™ä¸ªé¡µé¢ç«¯å£å·ä¸ºï¼š8898</p>\n<p>å¯ä»¥çœ‹åˆ°æŠ¥é”™äº†è¯´æ˜¯è·¨åŸŸé—®é¢˜</p>\n<p><strong>ç½‘å…³å¤„ç†è·¨åŸŸé‡‡ç”¨çš„åŒæ ·æ˜¯ CORS æ–¹æ¡ˆï¼Œå¹¶ä¸”åªéœ€è¦ç®€å•é…ç½®å³å¯å®ç°</strong>ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#=========== è¿™äº›é…ç½®è®©ç½‘å…³èƒ½å¤Ÿè”ç³»ä¸Š nacos å®ç°æœåŠ¡æ³¨å†Œå’Œå‘ç° ====</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span>                                              <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10010</span> <span class=\"token comment\"># ç½‘å…³ç«¯å£                              #||</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>                                              <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span>                                       <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> gateway <span class=\"token comment\"># æœåŠ¡åç§°                           #||</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span>                                              <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span>                                            <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span> <span class=\"token comment\"># nacos åœ°å€          #||</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#========================================================</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#========================= ç½‘å…³è·¯ç”±é…ç½® =====================</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span>                                           <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># ç½‘å…³è·¯ç”±é…ç½®                              ||</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> user_service <span class=\"token comment\"># è·¯ç”± idï¼Œè‡ªå®šä¹‰ï¼Œåªè¦å”¯ä¸€å³å¯    ||</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\"># uri æœ‰ä¸¤ç§æ–¹å¼çš„å†™æ³•                             ||</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\"># uri: http://127.0.0.1:8081 # è·¯ç”±çš„ç›®æ ‡åœ°å€ http å°±æ˜¯å›ºå®šåœ°å€</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>          <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//userservice <span class=\"token comment\"># è·¯ç”±çš„ç›®æ ‡åœ°å€ lb (LoadBalance) å°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œåé¢è·ŸæœåŠ¡åç§°</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>          <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># è·¯ç”±æ–­è¨€ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè·¯ç”±è§„åˆ™çš„æ¡ä»¶</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token punctuation\">-</span> Path=/user/<span class=\"token important\">**</span> <span class=\"token comment\"># è¿™ä¸ªæ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œåªè¦ä»¥ /user/ å¼€å¤´å°±ç¬¦åˆè¦æ±‚</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#          filters: # è¿‡æ»¤å™¨</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#            - AddRequestHeader=Truth,Itcast is freaking awesome! # æ·»åŠ è¯·æ±‚å¤´</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> order_service                            <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>          <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//orderservice                       <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>          <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span>                                  <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token punctuation\">-</span> Path=/order/<span class=\"token important\">**</span>                           <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token comment\"># é…ç½®æ–­è¨€è§„åˆ™æ˜¯åœ¨ 2037 å¹´ä¹‹åæ‰èƒ½è®¿é—®</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token punctuation\">-</span> Before=2037<span class=\"token punctuation\">-</span>01<span class=\"token punctuation\">-</span>20T17<span class=\"token punctuation\">:</span>42<span class=\"token punctuation\">:</span>47.789<span class=\"token punctuation\">-</span>07<span class=\"token punctuation\">:</span>00<span class=\"token punctuation\">[</span>America/Denver<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token key atrule\">default-filters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">-</span> AddRequestHeader=Truth<span class=\"token punctuation\">,</span>Itcast is freaking awesome<span class=\"token tag\">!</span> <span class=\"token comment\"># æ·»åŠ è¯·æ±‚å¤´</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">#=========================== å…¨å±€çš„è·¨åŸŸå¤„ç† =============================</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token key atrule\">globalcors</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># å…¨å±€çš„è·¨åŸŸå¤„ç†                                    #||</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token comment\"># ajax é‡‡ç”¨çš„æ˜¯ cors æ–¹æ¡ˆï¼Œcors æ˜¯æµè§ˆå™¨å»é—®æœåŠ¡å™¨è®©ä¸è®©è¿™ä¸ªè¯·æ±‚è·¨åŸŸï¼Œ     ||</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token comment\"># ä½†æ˜¯è¿™ä¸ªè¯·æ±‚æ–¹å¼æ˜¯  optionï¼Œé»˜è®¤æƒ…å†µä¸‹è¿™ç§è¯·æ±‚ä¼šè¢«ç½‘å…³æ‹¦æˆªçš„ï¼Œè€ŒåŠ ä¸Šè¿™ä¸ªé…ç½®å°±æ˜¯ä¸æ‹¦æˆª           # option è¯·æ±‚ï¼Œè¿™æ · cors è¯·æ±‚å°±èƒ½æ­£å¸¸å‘å‡ºäº†ã€‚                         ||</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token key atrule\">add-to-simple-url-handler-mapping</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\"># è§£å†³ options è¯·æ±‚è¢«æ‹¦æˆªé—®é¢˜</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token key atrule\">corsConfigurations</span><span class=\"token punctuation\">:</span>                                        <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>          <span class=\"token key atrule\">'[/**]'</span><span class=\"token punctuation\">:</span>                                                 <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token key atrule\">allowedOrigins</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># å…è®¸å“ªäº›ç½‘ç«™çš„è·¨åŸŸè¯·æ±‚                   #||</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>              <span class=\"token comment\"># - \"http://localhost:8090\"                            #||</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token punctuation\">-</span> <span class=\"token string\">\"http://localhost:8898\"</span>                    <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token key atrule\">allowedMethods</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># å…è®¸çš„è·¨åŸŸ ajax çš„è¯·æ±‚æ–¹å¼                #||</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>              <span class=\"token punctuation\">-</span> <span class=\"token string\">\"GET\"</span>                                              <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>              <span class=\"token punctuation\">-</span> <span class=\"token string\">\"POST\"</span>                                             <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>              <span class=\"token punctuation\">-</span> <span class=\"token string\">\"DELETE\"</span>                                           <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>              <span class=\"token punctuation\">-</span> <span class=\"token string\">\"PUT\"</span>                                              <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>              <span class=\"token punctuation\">-</span> <span class=\"token string\">\"OPTIONS\"</span>                                          <span class=\"token comment\">#||</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            <span class=\"token key atrule\">allowedHeaders</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"*\"</span> <span class=\"token comment\"># å…è®¸åœ¨è¯·æ±‚ä¸­æºå¸¦çš„å¤´ä¿¡æ¯             #||</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token key atrule\">allowCredentials</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\"># æ˜¯å¦å…è®¸æºå¸¦ cookie              #||</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token key atrule\">maxAge</span><span class=\"token punctuation\">:</span> <span class=\"token number\">360000</span> <span class=\"token comment\"># è¿™æ¬¡è·¨åŸŸæ£€æµ‹çš„æœ‰æ•ˆæœŸ                     #||</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token comment\">#====================================================================</span></pre></td></tr></table></figure><p>é‡å¯ Gateway æœåŠ¡ç„¶åå†è®¿é—® uriï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4ODk4L2luZGV4Lmh0bWw=\">http://localhost:8898/index.html</span></p>\n<p>é…ç½®æ–‡ä»¶ä¸­æœ¬æœºåœ°å€æ˜¯ localhost å°±ä¸è¦ç”¨ 127.0.0.1 è¿™æ ·ä¹Ÿä¼šè¢«è·¨åŸŸæ‹¦æˆª</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310072130838.png\" alt=\"image-20231007213052264\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>CORS è·¨åŸŸè¦é…ç½®çš„å‚æ•°åŒ…æ‹¬å“ªå‡ ä¸ªï¼Ÿ</p>\n<ul>\n<li>å…è®¸å“ªäº›åŸŸåè·¨åŸŸï¼Ÿ</li>\n<li>å…è®¸å“ªäº›è¯·æ±‚å¤´ï¼Ÿ</li>\n<li>å…è®¸å“ªäº›è¯·æ±‚æ–¹å¼ï¼Ÿ</li>\n<li>æ˜¯å¦å…è®¸ä½¿ç”¨ cookieï¼Ÿ</li>\n<li>æœ‰æ•ˆæœŸæ˜¯å¤šä¹…ï¼Ÿ</li>\n</ul>\n</blockquote>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "è®¡ç®—æœºå­¦ç§‘",
                "springcloud"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-http%E5%AE%A2%E6%88%B7%E7%AB%AFFeign/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-http%E5%AE%A2%E6%88%B7%E7%AB%AFFeign/",
            "title": "äº”ã€httpå®¢æˆ·ç«¯Feign",
            "date_published": "2024-01-06T02:14:22.114Z",
            "content_html": "<h2 id=\"äº”-httpå®¢æˆ·ç«¯feign\"><a class=\"anchor\" href=\"#äº”-httpå®¢æˆ·ç«¯feign\">#</a> äº”ã€http å®¢æˆ·ç«¯ FeignğŸ„</h2>\n<ul>\n<li>Feign æ›¿ä»£ RestTemplate</li>\n<li>è‡ªå®šä¹‰é…ç½®</li>\n<li>Feign ä½¿ç”¨ä¼˜åŒ–</li>\n<li>æœ€ä½³å®è·µ</li>\n</ul>\n<h3 id=\"51-resttemplateæ–¹å¼è°ƒç”¨å­˜åœ¨çš„é—®é¢˜\"><a class=\"anchor\" href=\"#51-resttemplateæ–¹å¼è°ƒç”¨å­˜åœ¨çš„é—®é¢˜\">#</a> 5.1ã€RestTemplate æ–¹å¼è°ƒç”¨å­˜åœ¨çš„é—®é¢˜ğŸŒ³</h3>\n<p>å…ˆæ¥çœ‹æˆ‘ä»¬ä»¥å‰åˆ©ç”¨ RestTemplate å‘èµ·è¿œç¨‹è°ƒç”¨çš„ä»£ç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 2. åˆ©ç”¨ RestTemplate å‘èµ· http è¯·æ±‚ï¼ŒæŸ¥è¯¢ç”¨æˆ·</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// 2.1 url è·¯å¾„</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token class-name\">String</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"http://userservice/user/\"</span> <span class=\"token operator\">+</span> order<span class=\"token punctuation\">.</span><span class=\"token function\">getUserId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 2.2 å‘é€è¯·æ±‚ï¼Œå®ç°è¿œç¨‹è°ƒç”¨</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// é»˜è®¤è¿”å› json æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šè¿”å›çš„ç±»å‹ä¸º user å¯¹è±¡ç±»å‹</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> restTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">getForObject</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>&lt;font color='red'&gt; ä¸Šé¢å­˜åœ¨ä¸‹é¢çš„é—®é¢˜ &lt;/font&gt;ï¼š</p>\n<ul>\n<li>ä»£ç å¯è¯»æ€§å·®ï¼Œç¼–ç¨‹ä½“éªŒä¸ç»Ÿä¸€</li>\n<li>å‚æ•°å¤æ‚ URL éš¾ä»¥ç»´æŠ¤</li>\n</ul>\n<h3 id=\"52-feignçš„ä»‹ç»\"><a class=\"anchor\" href=\"#52-feignçš„ä»‹ç»\">#</a> 5.2ã€Feign çš„ä»‹ç»ğŸŒ³</h3>\n<p>Feign æ˜¯ä¸€ä¸ªå£°æ˜å¼çš„ http å®¢æˆ·ç«¯ï¼Œå®˜æ–¹åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL09wZW5GZWlnbi9mZWlnbg==\">https://github.com/OpenFeign/feign</span></p>\n<p>å…¶ä½œç”¨å°±æ˜¯å¸®åŠ©æˆ‘ä»¬ä¼˜é›…çš„å®ç° http è¯·æ±‚çš„å‘é€ï¼Œè§£å†³ä¸Šé¢æåˆ°çš„é—®é¢˜ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061557922.png\" alt=\"image-20231006155457781\" /></p>\n<h3 id=\"53-å®šä¹‰å’Œä½¿ç”¨feignå®¢æˆ·ç«¯\"><a class=\"anchor\" href=\"#53-å®šä¹‰å’Œä½¿ç”¨feignå®¢æˆ·ç«¯\">#</a> 5.3ã€å®šä¹‰å’Œä½¿ç”¨ Feign å®¢æˆ·ç«¯ğŸŒ³</h3>\n<p>ä½¿ç”¨ Feign çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<p>1ã€å¼•å…¥ä¾èµ–ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--feign å®¢æˆ·ç«¯ä¾èµ– --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-openfeign<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>2ã€åœ¨ order-service çš„å¯åŠ¨ç±»æ·»åŠ æ³¨è§£å¼€å¯ Feign çš„åŠŸèƒ½ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@EnableFeignClients</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@MapperScan</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cn.itcast.order.mapper\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootApplication</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderApplication</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderApplication</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    @Bean</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    @LoadBalanced</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    public RestTemplate restTemplate()</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    &#123;</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        return new RestTemplate();</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    &#125;</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token comment\">/*  @Bean</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    public IRule randomRule()</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    &#123;</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        return new RandomRule();</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    &#125;*/</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061559467.png\" alt=\"image-20231006155927233\" /></p>\n<p>3ã€ç¼–å†™ Feign å®¢æˆ·ç«¯</p>\n<p>å£°æ˜ä¸€ä¸ªè¿œç¨‹è°ƒç”¨ï¼Œå®šä¹‰äº†ä¸€ä¸ªæ¥å£å« UserClient è¿™ä¸ªæ¥å£å°†æ¥å°è£…çš„å°±æ˜¯æ‰€æœ‰å¯¹ userservice å‘èµ·çš„è¿œç¨‹è°ƒç”¨ã€‚</p>\n<p>åœ¨æ¥å£ä¸Šæ·»åŠ äº†æ³¨è§£ @FeignClient (â€œæœåŠ¡åç§°â€) å¹¶ä¸”æŒ‡å®šäº†æœåŠ¡åç§°</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@FeignClient</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"userservice\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserClient</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">User</span> <span class=\"token function\">findById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä¸»è¦æ˜¯åŸºäº SpringMVC çš„æ³¨è§£æ¥å£°æ˜è¿œç¨‹è°ƒç”¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š</p>\n<ul>\n<li>æœåŠ¡åç§°ï¼šuserservice</li>\n<li>è¯·æ±‚æ–¹å¼ï¼šGET</li>\n<li id=\"\">è¯·æ±‚è·¯å¾„ï¼š/user/</li>\n<li>è¯·æ±‚å‚æ•°ï¼šLogin id</li>\n<li>è¿”å›å€¼ç±»å‹ï¼šUser</li>\n</ul>\n<p>4ã€ä¿®æ”¹ order-service ä¸­çš„ queryOrderById çš„æ–¹æ³•å†…å®¹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">OrderMapper</span> orderMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserClient</span> userClient<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Order</span> <span class=\"token function\">queryOrderById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> orderId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 1. æŸ¥è¯¢è®¢å•</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">Order</span> order <span class=\"token operator\">=</span> orderMapper<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>orderId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 2. ç”¨ Feign è¿œç¨‹è°ƒç”¨</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> userClient<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">.</span><span class=\"token function\">getUserId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// 3. å°è£… User å¯¹è±¡åˆ° Order</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        order<span class=\"token punctuation\">.</span><span class=\"token function\">setUser</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// 4. è¿”å›</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">return</span> order<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ order-service ä¸ user-service æ˜¯å¦åœ¨åŒä¸€ä¸ª namespace ä¸­ï¼Œå¦åˆ™è®¿é—®å°±ä¼šæŠ¥é”™ 500 çŠ¶æ€ç ã€‚</p>\n<p>æŠ¥é”™å…·ä½“ä¿¡æ¯ä¸ºï¼š</p>\n<pre><code>Load balancer does not have available server for client: userservice\n//ç¿»è¯‘\nè´Ÿè½½å‡è¡¡å™¨æ²¡æœ‰å®¢æˆ·ç«¯å¯ç”¨çš„æœåŠ¡å™¨:userservice\n</code></pre>\n<p>&lt;font color='red'&gt; ç½ªé­ç¥¸é¦– &lt;/font&gt;.</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token key atrule\">discovery</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token key atrule\">cluster-name</span><span class=\"token punctuation\">:</span> HZ <span class=\"token comment\"># é›†ç¾¤åç§°</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\"># è¿™ä¸ª namespace å°±æ˜¯ç½ªé­ç¥¸é¦–</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\"># namespace: ed32fa6f-e9e3-4483-b860-7bcd9731d0d9 # å‘½åç©ºé—´ï¼Œå¡« ID dev ç¯å¢ƒ</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token key atrule\">ephemeral</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\"># è®¾ç½®æ˜¯å¦ä¸ºä¸´æ—¶å®ä¾‹ è®¾ç½®ä¸ºéä¸´æ—¶å®ä¾‹</span></pre></td></tr></table></figure><p>ä¸Šé¢çš„æŠ¥é”™ä¸­å¯ä»¥å…ˆå» nacos æ§åˆ¶å°çœ‹ä¸€ä¸‹æ³¨å†Œä¸­å¿ƒçš„æƒ…å†µè¿™æ˜¯ä¸ªå¥½ä¹ æƒ¯ä¸ç„¶å°±æ˜¯æ‰¾é”™åŠå¤©ã€‚</p>\n<p>å¯åŠ¨ order-service æœåŠ¡å’Œ user-service æœåŠ¡è®¿é—® urlï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDgwL29yZGVyLzEwMQ==\">http://localhost:8080/order/101</span></p>\n<p>ç»“æœï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061640421.png\" alt=\"image-20231006164032976\" /></p>\n<p>å†å°†ä¸¤ä¸ª user-service å¯åŠ¨ç„¶ååˆ·æ–°é¡µé¢è®¿é—® 10 æ¬¡ urlï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDgwL29yZGVyLzEwMSVFNiU5RiVBNSVFNyU5QyU4QmlkZWElRTYlOEUlQTclRTUlODglQjYlRTUlOEYlQjAlRTclOUElODQlRTYlODklOTMlRTUlOEQlQjA=\">http://localhost:8080/order/101 æŸ¥çœ‹ idea æ§åˆ¶å°çš„æ‰“å°</span></p>\n<p>8081</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061651107.png\" alt=\"image-20231006165128092\" /></p>\n<p>8082</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061651416.png\" alt=\"image-20231006165138249\" /></p>\n<p>8083</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061651654.png\" alt=\"image-20231006165147393\" /></p>\n<p>éƒ½è®¿é—®åˆ°äº†ï¼Œè¯´æ˜æˆ‘ä»¬ä¸ä»…ä»…å®ç°äº†è¿œç¨‹è°ƒç”¨è€Œä¸”è¿˜å®ç°äº†è´Ÿè½½å‡è¡¡ã€‚Feign éå¸¸çš„å¼ºå¤§åº•å±‚è¿˜é›†æˆäº†è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>Feign çš„ä½¿ç”¨æ­¥éª¤</p>\n<ol>\n<li>å¼•å…¥ä¾èµ–</li>\n<li>æ·»åŠ  @EnableFeignClients æ³¨è§£</li>\n<li>ç¼–å†™ FeignClient æ¥å£</li>\n<li>ä½¿ç”¨ FeignClient ä¸­å®šä¹‰çš„æ–¹æ³•ä»£æ›¿ RestTemplate</li>\n</ol>\n</blockquote>\n<h3 id=\"54-è‡ªå®šä¹‰feigné…ç½®\"><a class=\"anchor\" href=\"#54-è‡ªå®šä¹‰feigné…ç½®\">#</a> 5.4ã€è‡ªå®šä¹‰ Feign é…ç½®ğŸŒ³</h3>\n<p>Feign è¿è¡Œè‡ªå®šä¹‰é…ç½®æ¥è¦†ç›–é»˜è®¤é…ç½®ï¼Œå¯ä»¥ä¿®æ”¹çš„é…ç½®å¦‚ä¸‹ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>ç±»å‹</th>\n<th>ä½œç”¨</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>&lt;font color='red'&gt;feign.Logger.Level&lt;/font&gt;</td>\n<td>ä¿®æ”¹æ—¥å¿—çº§åˆ«</td>\n<td>åŒ…å«å››ç§ä¸åŒçš„çº§åˆ«ï¼šNONEï¼ŒBASICï¼ŒHEADERSï¼ŒFULL</td>\n</tr>\n<tr>\n<td>feign.codec.Decoder</td>\n<td>å“åº”ç»“æœçš„è§£æå™¨</td>\n<td>http è¿œç¨‹è°ƒç”¨çš„ç»“æœåšè§£æï¼Œä¾‹å¦‚è§£æ json å­—ç¬¦ä¸²ä¸º java å¯¹è±¡</td>\n</tr>\n<tr>\n<td>feign.codec.Encoder</td>\n<td>è¯·æ±‚å‚æ•°ç¼–ç </td>\n<td>å°†è¯·æ±‚å‚æ•°ç¼–ç ï¼Œä¾¿äºé€šè¿‡ http è¯·æ±‚å‘é€</td>\n</tr>\n<tr>\n<td>feign.contract</td>\n<td>æ”¯æŒçš„æ³¨è§£æ ¼å¼</td>\n<td>é»˜è®¤æ˜¯ SpringMVC çš„æ³¨è§£</td>\n</tr>\n<tr>\n<td>feign.Retryer</td>\n<td>å¤±è´¥é‡è¯•æœºåˆ¶</td>\n<td>è¯·æ±‚å¤±è´¥çš„é‡è¯•æœºåˆ¶ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰ï¼Œä¸è¿‡ä¼šä½¿ç”¨ Ribbon çš„é‡è¯•</td>\n</tr>\n</tbody>\n</table>\n<p>ä¸€èˆ¬æˆ‘ä»¬éœ€è¦é…ç½®çš„å°±æ˜¯æ—¥å¿—çº§åˆ«ã€‚</p>\n<p>feign.Logger.Levelï¼š</p>\n<p>NONEï¼šæ²¡æœ‰ä»»ä½•æ—¥å¿—</p>\n<p>BASICï¼šå‘èµ·ä¸€æ¬¡ http è¯·æ±‚æ—¶ï¼Œè®°å½•è¯·æ±‚æ˜¯ä»€ä¹ˆæ—¶å€™å‘çš„ï¼Œä»€ä¹ˆæ—¶å€™ç»“æŸçš„ï¼Œè€—æ—¶ç­‰åŸºæœ¬ä¿¡æ¯</p>\n<p>HEADERSï¼šé™¤äº†è¯·æ±‚ä¿¡æ¯è¿˜æœ‰è¯·æ±‚å¤´å’Œå“åº”ä½“ä¿¡æ¯</p>\n<p>FULLï¼šå®Œæ•´çš„è®°å½•æ—¥å¿—</p>\n<h4 id=\"541-é…ç½®feignæ—¥å¿—æœ‰ä¸¤ç§æ–¹å¼\"><a class=\"anchor\" href=\"#541-é…ç½®feignæ—¥å¿—æœ‰ä¸¤ç§æ–¹å¼\">#</a> 5.4.1ã€é…ç½® Feign æ—¥å¿—æœ‰ä¸¤ç§æ–¹å¼ï¼šğŸŒ²</h4>\n<h5 id=\"æ–¹å¼ä¸€\"><a class=\"anchor\" href=\"#æ–¹å¼ä¸€\">#</a> æ–¹å¼ä¸€ğŸŒ´</h5>\n<p>æ–¹å¼ä¸€ï¼šé…ç½®æ–‡ä»¶æ–¹å¼</p>\n<p>1ã€å…¨å±€ç”Ÿæ•ˆ</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">feign</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># è¿™é‡Œ default å°±æ˜¯å…¨å±€é…ç½®ï¼Œå¦‚æœæ˜¯å†™æœåŠ¡åç§°ï¼Œåˆ™æ˜¯é’ˆå¯¹æŸä¸ªå¾®æœåŠ¡çš„é…ç½®</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token key atrule\">loggerLevel</span><span class=\"token punctuation\">:</span> FULL <span class=\"token comment\"># å®Œæ•´æ—¥å¿—</span></pre></td></tr></table></figure><p>2ã€å±€éƒ¨ç”Ÿæ•ˆ</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">feign</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">userservice</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># è¿™é‡Œ default å°±æ˜¯å…¨å±€é…ç½®ï¼Œå¦‚æœæ˜¯å†™æœåŠ¡åç§°ï¼Œåˆ™æ˜¯é’ˆå¯¹æŸä¸ªå¾®æœåŠ¡çš„é…ç½®</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token key atrule\">loggerLevel</span><span class=\"token punctuation\">:</span> FULL <span class=\"token comment\"># å®Œæ•´æ—¥å¿—</span></pre></td></tr></table></figure><p>å¯åŠ¨ order-service æœåŠ¡è®¿é—® utlï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzEyNy4wLjAuMTo4MDgwL29yZGVyLzEwMQ==\">http://127.0.0.1:8080/order/101</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310070911106.png\" alt=\"image-20231007091133634\" /></p>\n<h5 id=\"æ–¹å¼äºŒ\"><a class=\"anchor\" href=\"#æ–¹å¼äºŒ\">#</a> æ–¹å¼äºŒğŸŒ´</h5>\n<p>é…ç½® Feign æ—¥å¿—çš„æ–¹å¼äºŒï¼šjava ä»£ç æ–¹å¼ï¼Œéœ€è¦å…ˆå£°æ˜ä¸€ä¸ª Beanï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FeignClientConfiguration</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Logger<span class=\"token punctuation\">.</span>Level</span> <span class=\"token function\">feignLogLevel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Logger<span class=\"token punctuation\">.</span>Level</span><span class=\"token punctuation\">.</span><span class=\"token constant\">BASIC</span><span class=\"token punctuation\">;</span> # æ—¥å¿—çº§åˆ«</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>1ã€è€Œåå¦‚æœæ˜¯å…¨å±€é…ç½®ï¼Œåˆ™æŠŠå®ƒæ”¾åˆ° @EnableFeignClients è¿™ä¸ªæ³¨è§£ä¸­ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@EnableFeignClients</span><span class=\"token punctuation\">(</span>defaultConfiguration <span class=\"token operator\">=</span> <span class=\"token class-name\">FeignClientConfiguration</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>2ã€ å¦‚æœæ˜¯å±€éƒ¨é…ç½®ï¼Œåˆ™æŠŠå®ƒæ”¾åˆ° @FeignClient è¿™ä¸ªæ³¨è§£ä¸­ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@FeignClient</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"userservice\"</span><span class=\"token punctuation\">,</span> configuration <span class=\"token operator\">=</span> <span class=\"token class-name\">FeignClientConfiguration</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>é‡æ–°å¯åŠ¨ order-service æœåŠ¡è®¿é—® utlï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzEyNy4wLjAuMTo4MDgwL29yZGVyLzEwMQ==\">http://127.0.0.1:8080/order/101</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310070914510.png\" alt=\"image-20231007091445317\" /></p>\n<p>&lt;font color='red'&gt; æ³¨æ„ &lt;/font&gt;ï¼šå¦‚æœé…ç½®æ–‡ä»¶æ–¹å¼ä¸ä»£ç æ–¹å¼åŒæ—¶å¼€å¯çš„è¯ï¼Œå®ƒä¼šä½¿ç”¨é…ç½®æ–‡ä»¶çš„æ–¹å¼ã€‚</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>Feign çš„æ—¥å¿—é…ç½®ï¼š</p>\n<ol>\n<li>\n<p>æ–¹å¼ä¸€æ˜¯é…ç½®æ–‡ä»¶ï¼Œfeign.client.config.xxx.loggerLevel</p>\n<ol>\n<li>å¦‚æœ xxx æ˜¯ default åˆ™ä»£è¡¨å…¨å±€</li>\n<li>å¦‚æœ xxx æ˜¯æœåŠ¡åç§°ï¼Œä¾‹å¦‚ userservice åˆ™ä»£è¡¨å±€é™äºæŸæœåŠ¡</li>\n</ol>\n</li>\n<li>\n<p>æ–¹å¼äºŒæ˜¯ java ä»£ç é…ç½® Logger.Level è¿™ä¸ª Bean</p>\n<ol>\n<li>å¦‚æœåœ¨ @EnableFeignClients æ³¨è§£å£°æ˜åˆ™ä»£è¡¨å…¨å±€</li>\n<li>å¦‚æœåœ¨ @FeignClient æ³¨è§£ä¸­å£°æ˜åˆ™ä»£è¡¨å±€é™äºæŸæœåŠ¡</li>\n</ol>\n<ul>\n<li>&lt;font color='red'&gt; æ³¨æ„ &lt;/font&gt;ï¼šè¿™ä¸¤ä¸ªæ³¨è§£ä¸€ä¸ªæ˜¯å¯åŠ¨ç±»çš„ï¼Œä¸€ä¸ªæ˜¯è¿œç¨‹è°ƒç”¨æ¥å£çš„ã€‚</li>\n</ul>\n</li>\n</ol>\n</blockquote>\n<h3 id=\"55-feignçš„æ€§èƒ½ä¼˜åŒ–\"><a class=\"anchor\" href=\"#55-feignçš„æ€§èƒ½ä¼˜åŒ–\">#</a> 5.5ã€Feign çš„æ€§èƒ½ä¼˜åŒ–ğŸŒ³</h3>\n<p>Feign åº•å±‚çš„å®¢æˆ·ç«¯å®ç°ï¼š</p>\n<ul>\n<li>URLConnectionï¼šé»˜è®¤å®ç°ï¼Œä¸æ”¯æŒè¿æ¥æ± </li>\n<li>Apache HttpClientï¼šæ”¯æŒè¿æ¥æ± </li>\n<li>OKHttpï¼šæ”¯æŒè¿æ¥æ± </li>\n</ul>\n<p>å› æ­¤ä¼˜åŒ– Feign çš„æ€§èƒ½ä¸»è¦åŒ…æ‹¬ï¼š</p>\n<ol>\n<li>ä½¿ç”¨è¿æ¥æ± ä»£æ›¿é»˜è®¤çš„ URLConnection</li>\n<li>æ—¥å¿—çº§åˆ«ï¼Œæœ€å¥½ç”¨ basic æˆ– noneï¼Œå› ä¸ºå¼€æ—¥å¿—ä¹Ÿä¼šæ‹‰ä½æ€§èƒ½</li>\n</ol>\n<h4 id=\"551-feignçš„æ€§èƒ½ä¼˜åŒ–-è¿æ¥æ± é…ç½®\"><a class=\"anchor\" href=\"#551-feignçš„æ€§èƒ½ä¼˜åŒ–-è¿æ¥æ± é…ç½®\">#</a> 5.5.1ã€Feign çš„æ€§èƒ½ä¼˜åŒ– - è¿æ¥æ± é…ç½®ğŸŒ²</h4>\n<p>Feign æ·»åŠ  HttpClient çš„æ”¯æŒï¼š</p>\n<p>å¼•å…¥ä¾èµ–ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--httpClient çš„ä¾èµ– --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>io.github.openfeign<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>feign-httpclient<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>é…ç½®è¿æ¥æ± ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">feign</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token key atrule\">httpclient</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\"># å¼€å¯ feign å¯¹ httpClient çš„æ”¯æŒ</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token key atrule\">max-connections</span><span class=\"token punctuation\">:</span> <span class=\"token number\">200</span> <span class=\"token comment\"># æœ€å¤§çš„è¿æ¥æ•°</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token key atrule\">max-connections-per-route</span><span class=\"token punctuation\">:</span> <span class=\"token number\">50</span> <span class=\"token comment\"># æ¯ä¸ªè·¯å¾„çš„æœ€å¤§è¿æ¥æ•°</span></pre></td></tr></table></figure><blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>Feign çš„ä¼˜åŒ–ï¼š</p>\n<ol>\n<li>æ—¥å¿—çº§åˆ«å°½é‡ç”¨ basic</li>\n<li>ä½¿ç”¨ HttpClient æˆ– OKHttp ä»£æ›¿ URLConnection\n<ol>\n<li>å¼•å…¥ feign-httpClient ä¾èµ–</li>\n<li>é…ç½®æ–‡ä»¶å¼€å¯ httpClient åŠŸèƒ½ï¼Œè®¾ç½®è¿æ¥æ± å‚æ•°</li>\n</ol>\n</li>\n</ol>\n</blockquote>\n<h3 id=\"56-feignçš„æœ€ä½³å®è·µ\"><a class=\"anchor\" href=\"#56-feignçš„æœ€ä½³å®è·µ\">#</a> 5.6ã€Feign çš„æœ€ä½³å®è·µğŸŒ³</h3>\n<h4 id=\"561-æ–¹å¼ä¸€\"><a class=\"anchor\" href=\"#561-æ–¹å¼ä¸€\">#</a> 5.6.1ã€æ–¹å¼ä¸€ğŸŒ²</h4>\n<p>æ–¹å¼ä¸€ (ç»§æ‰¿)ï¼šç»™æ¶ˆè´¹è€…çš„ FeignClient å’Œæä¾›è€…çš„ controller å®šä¹‰ç»Ÿä¸€çš„çˆ¶æ¥å£ä½œä¸ºæ ‡å‡†</p>\n<blockquote>\n<p>åœ¨ UserClient æ¥å£ä¸­ä½¿ç”¨ GetMapping å£°æ˜è¿œç¨‹è°ƒç”¨æ‰€éœ€è¦çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¯·æ±‚æ–¹å¼ï¼Œå‚æ•°ï¼Œè·¯å¾„ï¼Œè¿”å›å€¼ç­‰ã€‚</p>\n<p>è¿™ä¸ªæ¥å£æœ€ç»ˆçš„ç›®çš„æ˜¯ä»€ä¹ˆï¼šæ˜¯è®©æ¶ˆè´¹è€…åŸºäºè¿™äº›å£°æ˜ä¿¡æ¯å‘é€ä¸€æ¬¡ http çš„è¯·æ±‚ï¼Œè€Œè¿™ä¸ªè¯·æ±‚å°±ä¼šè¾¾åˆ° userservice æœåŠ¡å¯¹åº”çš„ä¸€ä¸ªå®ä¾‹ä¸Š UserController çš„ queryByIdã€‚æˆ‘ä»¬æ‹¿è¿™ä¸¤ä¸ªåšä¸€ä¸ªå¯¹æ¯”ï¼šè¯·æ±‚æ–¹å¼éƒ½æ˜¯ GETï¼Œè¯·æ±‚è·¯å¾„ findById æ˜¯ â€œuser/{id}â€ï¼Œè€Œ queryById æ˜¯ â€œ/{id}â€ åŸå› æ˜¯ ç±»ä¸Šå·²ç»æœ‰ â€œ/userâ€ äº†ï¼Œæ–¹æ³•åä¸ä¸€æ ·ä¸ç”¨ç®¡ã€‚å‚æ•°ä¸€æ ·ã€‚</p>\n<p>æ‰€ä»¥ä¸¤ä¸ªæ–¹æ³•å¯¹æ¯”ç»“æœæ˜¯ï¼šé™¤äº†æ–¹æ³•åå¤–ï¼Œå…¶å®ƒéƒ½ä¸€æ ·ã€‚è€Œè¿™ä¸¤ä¸ªæ–¹æ³•çš„å£°æ˜æ˜¯å¿…é¡»è¦ä¸€æ ·çš„å¦åˆ™æŠ¥é”™</p>\n<p>order-service åŸºäº UserClient è®¿é—® UserService è€Œ UserClient ä¸­å£°æ˜äº†è¯·æ±‚æ–¹å¼ï¼Œè¯·æ±‚å‚æ•°ï¼Œè¯·æ±‚è·¯å¾„ç­‰ä¿¡æ¯ã€‚é‚£ä¹ˆ order-service å°±åŸºäºè¿™äº›ä¿¡æ¯å‘é€ http è¯·æ±‚ï¼Œè€Œ UserService æ°å¥½åœ¨æ¥æ”¶è¿™ä¸ªè¯·æ±‚ã€‚å¦‚æœ UserClient ä¸­çš„ findById ä¸ UserController ä¸­çš„ queryById å£°æ˜çš„ä¸ä¸€æ ·ï¼Œæ¯”å¦‚å‘é€çš„æ˜¯ post è¯·æ±‚è€Œæ¥æ”¶çš„æ˜¯ get è¯·æ±‚å®ƒä»¬å°±åŒ¹é…ä¸åˆ°äº†ã€‚</p>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310070954683.png\" alt=\"image-20231007095439949\" /></p>\n<p>&lt;font color='red'&gt; é—®é¢˜ &lt;/font&gt;ï¼šæ—¢ç„¶å®ƒä»¬ä¸¤ä¸ªä¸€æ¨¡ä¸€æ ·é‚£ä¹ˆå°±æ„å‘³ç€å¯ä»¥åšä¸€ä¸‹æŠ½å–</p>\n<p>å‡å¦‚å®šä¹‰äº†ä¸€ä¸ªæ¥å£å« UserAPIï¼Œç°åœ¨æˆ‘æƒ³å®šä¹‰ä¸€ä¸ª Feign å®¢æˆ·ç«¯æ¥å£ç±»å°±ä¸ç”¨å†å†™äº†ç›´æ¥ç»§æ‰¿ UserAPI å°±å¥½äº†</p>\n<p>è¿˜æœ‰ UserController ï¼Œç›´æ¥å®ç° UserAPI è¿™ä¸ªæ¥å£ã€‚å°±æ˜¯ç»™ Feign å®¢æˆ·ç«¯å’Œ Controller å®šä¹‰ç»Ÿä¸€æ ‡å‡†ï¼Œå®ƒä¿©å°±å¯ä»¥ä¸ç”¨å†å»å†™äº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071011316.png\" alt=\"image-20231007101108979\" /></p>\n<p>ä½†æ˜¯è¿™ç§æ–¹å¼ä¹Ÿæœ‰ä¸€ä¸ªé—®é¢˜å¦‚ä¸‹æ˜¯ Spring å®˜ç½‘ç»™å‡ºçš„ä¸€æ®µè¯´æ˜ï¼š</p>\n<p>ç®€å•ç†è§£ä¸‹é¢çš„è¯´æ˜å°±æ˜¯ï¼šä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¸æ¨èå»å…±äº«æ¥å£åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´ï¼Œå®ƒä¼šé€ æˆç´§è€¦åˆ</p>\n<p>ä»€ä¹ˆæ˜¯ç´§è€¦åˆå‘¢ï¼šä¸¤ä¸ªå¾®æœåŠ¡ userservice å’Œ orderservice éƒ½å·²ç»å®ç°ç›¸åŒæ¥å£äº†ä» api å±‚é¢éƒ½å·²ç»è€¦åˆäº†ä¸ºç´§è€¦åˆï¼Œå°†æ¥ UserAPI ä¸­å£°æ˜å˜äº† UserClient ä¸ UserController éƒ½è¦è·Ÿç€å˜</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071012804.png\" alt=\"image-20231007101211588\" /></p>\n<p>è€Œä¸”è¿™ç§æ–¹æ¡ˆå¯¹ SpringMVC ä¸èµ·ä½œç”¨</p>\n<h4 id=\"562-æ–¹å¼äºŒ\"><a class=\"anchor\" href=\"#562-æ–¹å¼äºŒ\">#</a> 5.6.2ã€æ–¹å¼äºŒğŸŒ²</h4>\n<p>æ–¹å¼äºŒ (æŠ½å–)ï¼šå°† FeignClient æŠ½å–ä¸ºç‹¬ç«‹æ¨¡å—ï¼Œå¹¶ä¸”æŠŠæ¥å£æœ‰å…³çš„ POJOï¼Œé»˜è®¤çš„ Feign é…ç½®éƒ½æ”¾åˆ°è¿™ä¸ªæ¨¡å—ä¸­ï¼Œæä¾›ç»™æ‰€æœ‰æ¶ˆè´¹è€…ä½¿ç”¨</p>\n<p>è§£é‡Šï¼š</p>\n<p>UserController å¯¹å¤–æš´æ¼æŸ¥è¯¢ç”¨æˆ·çš„æ¥å£ï¼Œæœ‰ä¸¤ä¸ªå¾®æœåŠ¡ order-service å’Œ pay-service å‡å¦‚å®ƒä¿©éƒ½éœ€è¦å»æŸ¥è¯¢ç”¨æˆ·ï¼Œä¹‹å‰çš„æ–¹å¼æ˜¯å„å†™å„è‡ªçš„ UserClient ç„¶åéƒ½å»è°ƒ UserController æŸ¥è¯¢ç”¨æˆ·æ¥å£ï¼Œå¦‚æœè¯´å°†æ¥å¾®æœåŠ¡è¶Šæ¥è¶Šå¤šåå‡ ä¸ªéƒ½æ¥è°ƒ UserController é‚£ UserClient å°±ç­‰äºå†™äº†åå¤šéäº†è¿™æ ·å°±æ˜¯é‡å¤å¼€å‘äº†ï¼Œå¾ˆéº»çƒ¦ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071024820.png\" alt=\"image-20231007102445971\" /></p>\n<p>æ‰€ä»¥å‡†å¤‡ä¸€ä¸ª feign-api (é¡¹ç›® - ç‹¬ç«‹æ¨¡å—) ï¼Œå®ƒä¸ºæ¶ˆè´¹è€…æŠŠ Client å®šä¹‰å¥½ï¼Œæ¥å£å®šä¹‰è¿‡ç¨‹ä¸­çš„å®ä½“ç±»ï¼ŒFeign çš„é…ç½®å®ƒéƒ½ç®¡äº†</p>\n<p>å°†æ¥æ¶ˆè´¹è€…è¦ä½¿ç”¨å°±å¼•ä¾èµ–å°±å¯ä»¥äº†ï¼Œå¼•å…¥äº†åç›´æ¥è°ƒç”¨ UserController æŸ¥è¯¢ç”¨æˆ·</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071027366.png\" alt=\"image-20231007102717991\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>Feign çš„æœ€ä½³å®è·µï¼š</p>\n<ol>\n<li>è®© controller å’Œ FeignClient ç»§æ‰¿åŒä¸€æ¥å£</li>\n<li>å°† FeignClientï¼ŒPOJOï¼ŒFeign çš„é»˜è®¤é…ç½®éƒ½å®šä¹‰åˆ°ä¸€ä¸ªé¡¹ç›®ä¸­ (ç‹¬ç«‹æ¨¡å—) ç»Ÿä¸€æŠ½å–å‡ºæ¥æ‰“ jar åŒ…ï¼Œä¾›æ‰€æœ‰æ¶ˆè´¹è€…ä½¿ç”¨</li>\n</ol>\n</blockquote>\n<h4 id=\"563-æ¼”ç¤ºæ–¹å¼äºŒ\"><a class=\"anchor\" href=\"#563-æ¼”ç¤ºæ–¹å¼äºŒ\">#</a> 5.6.3ã€æ¼”ç¤ºæ–¹å¼äºŒğŸŒ²</h4>\n<h5 id=\"5631-æŠ½å–feignclient\"><a class=\"anchor\" href=\"#5631-æŠ½å–feignclient\">#</a> 5.6.3.1ã€æŠ½å– FeignClientğŸŒ´</h5>\n<p><strong>å®ç°æœ€ä½³å®è·µæ–¹å¼äºŒçš„æ­¥éª¤å¦‚ä¸‹</strong>ï¼š</p>\n<p>1ã€é¦–å…ˆåˆ›å»ºä¸€ä¸ª moduleï¼Œå‘½åä¸º feign-apiï¼Œç„¶åå¼•å…¥ feign çš„ starter ä¾èµ–</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071056767.png\" alt=\"image-20231007105607975\" /></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>xsi</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2001/XMLSchema-instance<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>         <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>schemaLocation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modelVersion</span><span class=\"token punctuation\">></span></span>4.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modelVersion</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>cn.itcast.demo<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>cloud-demo<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>feign-api1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>packaging</span><span class=\"token punctuation\">></span></span>jar<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>packaging</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>feign-api1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>url</span><span class=\"token punctuation\">></span></span>http://maven.apache.org<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>url</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project.build.sourceEncoding</span><span class=\"token punctuation\">></span></span>UTF-8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project.build.sourceEncoding</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-openfeign<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>junit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>junit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>4.12<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>2ã€å°† order-service ä¸­ç¼–å†™çš„ UserClientï¼ŒUserï¼ŒFeignConfiguration éƒ½å¤åˆ¶åˆ° feign-api é¡¹ç›®ä¸­</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071101541.png\" alt=\"image-20231007110150030\" /></p>\n<p>3ã€å°† order-service ä¸­çš„ configï¼Œclientsï¼ŒUser éƒ½åˆ é™¤ï¼Œåœ¨ order-service ä¸­å¼•å…¥ feign-api çš„ä¾èµ–</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071103048.png\" alt=\"image-20231007110347974\" /></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- å¼•å…¥ feign-api--></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>cn.itcast.demo<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>feign-api1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>4ã€ä¿®æ”¹ order-service ä¸­çš„æ‰€æœ‰ä¸ä¸Šè¿°ä¸‰ä¸ªç»„ä»¶æœ‰å…³çš„ import éƒ¨åˆ†ï¼Œæ”¹æˆå¯¼å…¥ feign-api ä¸­çš„åŒ…</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071106503.png\" alt=\"image-20231007110622216\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071106713.png\" alt=\"image-20231007110644248\" /></p>\n<p>5ã€é‡å¯æµ‹è¯•</p>\n<p>ä½†æ˜¯å‘¢è¿™é‡Œç»†å¿ƒçš„å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†æœ‰åœ°æ–¹ä¸å¯¹åŠ²å¯åŠ¨åä¹Ÿä¼šæŠ¥é”™ï¼</p>\n<p>æŠ¥é”™ä¸ºï¼šæ‰¾ä¸åˆ° UserClient çš„ Bean</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071114496.png\" alt=\"image-20231007111359869\" /></p>\n<p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>\n<blockquote>\n<p>åŸå› ï¼š</p>\n<p>é¡¹ç›®å¯åŠ¨ SpringBoot å¯åŠ¨ç±»æ‰«æåŒ…çš„èŒƒå›´æ˜¯ cn.itcast.orderã€‚è€Œ UserClient å¯¼å…¥çš„åŒ…è·¯å¾„å´æ˜¯ cn.itcast.feign.clients.UserClient</p>\n<p>SpringBoot ä» order åŒ…å¼€å§‹æ‰«æè€Œå¯¼å…¥ä¾èµ–çš„è·¯å¾„ä» itcast å°±ä¸ä¸€æ ·äº†ï¼Œæœ‰ä¸€ä¸ªè§£å†³åŠæ³•å°±æ˜¯å°† SpringBoot æ‰«æçš„èŒƒå›´æ‰©å¤§ï¼Œä½†æ˜¯ï¼ï¼ï¼è¿™æ˜¯ä¸åˆç†çš„ã€‚ä¸èƒ½è¿™æ ·</p>\n</blockquote>\n<h6 id=\"56311-å¦‚ä¸‹ä¸¤ç§è§£å†³æ–¹æ¡ˆ\"><a class=\"anchor\" href=\"#56311-å¦‚ä¸‹ä¸¤ç§è§£å†³æ–¹æ¡ˆ\">#</a> 5.6.3.1.1ã€å¦‚ä¸‹ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼šğŸ‹</h6>\n<p>å½“å®šä¹‰çš„ FeignClient ä¸åœ¨ SpringBootApplication çš„æ‰«æåŒ…èŒƒå›´æ—¶ï¼Œè¿™äº› FeignClient æ— æ³•ä½¿ç”¨ã€‚æœ‰ä¸¤ç§æ–¹å¼è§£å†³ï¼š</p>\n<p>æ–¹å¼ä¸€ï¼šæŒ‡å®š FeignClient æ‰€åœ¨åŒ… (å…¨æ‹¿æ¥)</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@EnableFeignClients</span><span class=\"token punctuation\">(</span>basePackages <span class=\"token operator\">=</span> <span class=\"token string\">\"cn.itcast.feign.clients\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>æ–¹å¼äºŒï¼šæŒ‡å®š FeignClient å­—èŠ‚ç  (ç²¾å‡†æ‰“å‡»ï¼Œæ¨èä½¿ç”¨ï¼šç”¨å“ªä¸ªå°±æŒ‡å®šé‚£ä¸ª)</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@EnableFeignClients</span><span class=\"token punctuation\">(</span>clients <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token class-name\">UserClient</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼è§£å†³ä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">cn<span class=\"token punctuation\">.</span>itcast<span class=\"token punctuation\">.</span>feign<span class=\"token punctuation\">.</span>clients<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">UserClient</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">cn<span class=\"token punctuation\">.</span>itcast<span class=\"token punctuation\">.</span>feign<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FeignClientConfiguration</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>mybatis<span class=\"token punctuation\">.</span>spring<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MapperScan</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SpringApplication</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>autoconfigure<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SpringBootApplication</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span>openfeign<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">EnableFeignClients</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@EnableFeignClients</span><span class=\"token punctuation\">(</span>clients <span class=\"token operator\">=</span> <span class=\"token class-name\">UserClient</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> defaultConfiguration <span class=\"token operator\">=</span> <span class=\"token class-name\">FeignClientConfiguration</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token annotation punctuation\">@MapperScan</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cn.itcast.order.mapper\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootApplication</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderApplication</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderApplication</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å†æ¬¡å¯åŠ¨é¡¹ç›®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310071126898.png\" alt=\"image-20231007112615337\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>ä¸åŒåŒ…çš„ FeignClient çš„å¯¼å…¥æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>\n<ol>\n<li>åœ¨ @EnableFeignClients æ³¨è§£ä¸­æ·»åŠ  basePackagesï¼ŒæŒ‡å®š FeignClient æ‰€åœ¨çš„åŒ…</li>\n<li>åœ¨ @EnableFeignClients æ³¨è§£ä¸­æ·»åŠ  clientsï¼ŒæŒ‡å®šå…·ä½“ FeignClient çš„å­—èŠ‚ç </li>\n</ol>\n</blockquote>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "è®¡ç®—æœºå­¦ç§‘",
                "springcloud"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Nacos/springcloud-Nacos%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Nacos/springcloud-Nacos%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/",
            "title": "å››ã€Nacosæ³¨å†Œä¸­å¿ƒ",
            "date_published": "2024-01-06T02:13:19.460Z",
            "content_html": "<h2 id=\"å››-nacosæ³¨å†Œä¸­å¿ƒ\"><a class=\"anchor\" href=\"#å››-nacosæ³¨å†Œä¸­å¿ƒ\">#</a> å››ã€Nacos æ³¨å†Œä¸­å¿ƒğŸ„</h2>\n<ul>\n<li>è®¤è¯†å’Œå®‰è£… Nacos</li>\n<li>Nacos å¿«é€Ÿå…¥é—¨</li>\n<li>Nacos æœåŠ¡åˆ†çº§å­˜å‚¨æ¨¡å‹</li>\n<li>Nacos ç¯å¢ƒéš”ç¦»</li>\n</ul>\n<h3 id=\"41-è®¤è¯†nacos\"><a class=\"anchor\" href=\"#41-è®¤è¯†nacos\">#</a> 4.1ã€è®¤è¯† NacosğŸŒ³</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL25hY29zLmlvL3poLWNuLw==\">Nacos</span> æ˜¯é˜¿é‡Œå·´å·´çš„äº§å“ï¼Œç°åœ¨æ˜¯<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zcHJpbmcuaW8vcHJvamVjdHMvc3ByaW5nLWNsb3Vk\"> SpringCloud</span> ä¸­çš„ä¸€ä¸ªç»„ä»¶ã€‚ç›¸æ¯”<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL05ldGZsaXgvZXVyZWth\"> Eureka</span> åŠŸèƒ½æ›´åŠ ä¸°å¯Œï¼Œåœ¨å›½å†…å—æ¬¢è¿ç¨‹åº¦è¾ƒé«˜ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051155062.png\" alt=\"image-20231005115513961\" /></p>\n<p><strong>å®‰è£…å’Œå¯åŠ¨æ•™ç¨‹è¯¦ç»†æŸ¥çœ‹</strong>ï¼š<a href=\"Nacos/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97.md\">ç‚¹å‡»æŸ¥çœ‹</a>.</p>\n<h3 id=\"42-æœåŠ¡æ³¨å†Œåˆ°nacos\"><a class=\"anchor\" href=\"#42-æœåŠ¡æ³¨å†Œåˆ°nacos\">#</a> 4.2ã€æœåŠ¡æ³¨å†Œåˆ° NacosğŸŒ³</h3>\n<p>1ã€åœ¨ cloud-demo çˆ¶å·¥ç¨‹ä¸­æ·»åŠ  spring-cloud-alibaba çš„ç®¡ç†ä¾èµ–ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--nacos ç®¡ç†ä¾èµ– --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-alibaba-dependencies<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.2.5.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>type</span><span class=\"token punctuation\">></span></span>pom<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>type</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>import<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>2ã€æ³¨é‡Šæ‰ order-service å’Œ user-service ä¸­åŸæœ‰çš„ eureka ä¾èµ–ã€‚</p>\n<p>3ã€æ·»åŠ  nacos çš„å®¢æˆ·ç«¯ä¾èµ–ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- nacos å®¢æˆ·ç«¯ä¾èµ–åŒ… --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-alibaba-nacos-discovery<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>4ã€ä¿®æ”¹ user-service &amp; order-service ä¸­çš„ application.yml æ–‡ä»¶ï¼Œæ³¨é‡Š eureka åœ°å€ï¼Œæ·»åŠ  nacos åœ°å€ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span> <span class=\"token comment\"># nacos æœåŠ¡åœ°å€</span></pre></td></tr></table></figure><p>5ã€å¯åŠ¨å¹¶æµ‹è¯•</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051308798.png\" alt=\"image-20231005130842602\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<ol>\n<li>Nacos æœåŠ¡æ­å»º\n<ol>\n<li>ä¸‹è½½å®‰è£…åŒ…</li>\n<li>è§£å‹</li>\n<li>åœ¨ bin ç›®å½•ä¸‹è¿è¡ŒæŒ‡ä»¤ï¼šstartup.cmd -m standalone</li>\n</ol>\n</li>\n<li>Nacos æœåŠ¡æ³¨å†Œæˆ–å‘ç°\n<ol>\n<li>å¼•å…¥ nacos.discovery ä¾èµ–</li>\n<li>é…ç½® nacos åœ°å€ spring.cloud.nacos.server-addr</li>\n</ol>\n</li>\n</ol>\n</blockquote>\n<h3 id=\"43-nacosæœåŠ¡åˆ†çº§å­˜å‚¨æ¨¡å‹\"><a class=\"anchor\" href=\"#43-nacosæœåŠ¡åˆ†çº§å­˜å‚¨æ¨¡å‹\">#</a> 4.3ã€Nacos æœåŠ¡åˆ†çº§å­˜å‚¨æ¨¡å‹ğŸŒ³</h3>\n<p><strong>æœåŠ¡</strong>ï¼šæä¾›ç”¨æˆ·æŸ¥è¯¢çš„ user service ï¼Œæä¾›è®¢å•æŸ¥è¯¢çš„ order-service éƒ½å«<mark>æœåŠ¡</mark>.</p>\n<p>user-service è¿˜éƒ¨ç½²äº†å¤šä¸ªå®ä¾‹ï¼š8081ï¼Œ8082ï¼Œ8083</p>\n<p>æ‰€ä»¥æˆ‘ä»¬ä¹‹å‰æ˜¯åˆ†ä¸ºä¸¤å±‚æ¦‚å¿µçš„ï¼š</p>\n<p>ä¸€å±‚æ˜¯æœåŠ¡ï¼Œè€Œç¬¬äºŒå±‚å°±æ˜¯å®ä¾‹ï¼Œä¸€ä¸ªæœåŠ¡å¯ä»¥åŒ…å«å¤šä¸ªå®ä¾‹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051420619.png\" alt=\"image-20231005142022420\" /></p>\n<p>ä¸è¿‡éšç€ä¸šåŠ¡è§„æ¨¡è¶Šæ¥è¶Šæ‰©å¤§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦è€ƒè™‘æ›´å¤šçš„é—®é¢˜äº†ã€‚</p>\n<blockquote>\n<p>æ¯”å¦‚è¯´æˆ‘ä»¬æŠŠæ‰€æœ‰çš„å®ä¾‹éƒ½éƒ¨ç½²åˆ°ä¸€ä¸ªæœºæˆ¿ï¼Œè¿™å°±åƒæŠŠæ‰€æœ‰çš„é¸¡è›‹éƒ½æ”¾åˆ°ä¸€ä¸ªç¯®å­é‡Œä¸€æ ·ï¼Œä¸å°å¿ƒå°†ç¯®å­æ‰“ç¿»äº†é‚£ä¹ˆé‡Œé¢æ‰€æœ‰çš„è›‹ä¹Ÿå°±å…¨éƒ¨éƒ½æ‰“äº†ï¼Œå¦‚æœæ˜¯æœºæˆ¿å“ªå¤©å¤©ç¾äººç¥¸å‡ºäº†äº‹å„¿ï¼Œé‚£è¿™æ•´ä¸ªæœåŠ¡ä¸å°±å®Œäº†ã€‚æ‰€ä»¥ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬ä¼šå°†ä¸€ä¸ªæœåŠ¡çš„å¤šä¸ªå®ä¾‹éƒ¨ç½²åˆ°å¤šä¸ªæœºæˆ¿ã€‚</p>\n</blockquote>\n<p>ç‰¹åˆ«åƒé˜¿é‡Œå·´å·´ï¼Œäº¬ä¸œè¿™æ ·çš„å¤§å…¬å¸ï¼Œç»™å…¨å›½å„åœ°éƒ½æ•´ä¸€ä¸ªã€‚è¿™å°±åƒæˆ‘ä»¬æŠŠé¸¡è›‹åˆ†æ•£å¼€äº†ï¼Œä¸€ä¸ªæ‰“äº†æˆ‘è¿˜æœ‰å¥½å‡ ç¯®å­å‘¢ã€‚</p>\n<p>è¿™æ ·å°±èƒ½åšåˆ°ä¸€ç§å« <strong>å®¹ç¾</strong>.</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051425151.png\" alt=\"image-20231005142511407\" /></p>\n<p>è€Œ Nacos æœåŠ¡åˆ†çº§å­˜å‚¨æ¨¡å‹å°±æ˜¯å¼•å…¥äº†è¿™æ ·ä¸€ä¸ªæœºæˆ¿çš„æ¦‚å¿µæˆ–è€…å«åœ°åŸŸçš„æ¦‚å¿µã€‚å®ƒæŠŠåŒåœ¨ä¸€ä¸ªæœºæˆ¿çš„å¤šä¸ªå®ä¾‹ç§°ä¸ºä¸€ä¸ªé›†ç¾¤</p>\n<p>æ¯”å¦‚è¯´ï¼šæ­å·ä¸¤ä¸ªæœºæˆ¿çš„ userService å®ä¾‹å°±ç§°ä¹‹ä¸ºæ­å·çš„ userService é›†ç¾¤</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051430517.png\" alt=\"image-20231005143046790\" /></p>\n<p>æ‰€ä»¥åœ¨ Nacos æœåŠ¡åˆ†çº§å­˜å‚¨æ¨¡å‹ä¸­ä¸€çº§æ˜¯æœåŠ¡å¾€ä¸‹æ˜¯é›†ç¾¤å†å¾€ä¸‹å°±æ˜¯å®ä¾‹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051432046.png\" alt=\"image-20231005143242380\" /></p>\n<p><strong>ä¸ºä»€ä¹ˆ Nacos è¦å¼•å…¥è¿™æ ·çš„ä¸€ä¸ªæœåŠ¡åˆ†çº§çš„æ¨¡å‹å‘¢ï¼Ÿæˆ‘åŸæ¥ç›´æ¥ç”¨æœåŠ¡æ‰¾å®ä¾‹ä¸å¥½å—ï¼Ÿä¸ºä»€ä¹ˆè¦å¤šåŠ ä¸€ä¸ªåœ°åŸŸåˆ’åˆ†é›†ç¾¤çš„ä¸€ä¸ªæ¦‚å¿µï¼Ÿ</strong></p>\n<h4 id=\"431-æœåŠ¡è·¨é›†ç¾¤è°ƒç”¨é—®é¢˜\"><a class=\"anchor\" href=\"#431-æœåŠ¡è·¨é›†ç¾¤è°ƒç”¨é—®é¢˜\">#</a> 4.3.1ã€æœåŠ¡è·¨é›†ç¾¤è°ƒç”¨é—®é¢˜ğŸŒ²</h4>\n<p>æˆ‘ä»¬è®¾æƒ³è¿™æ ·ä¸€ç§æƒ…å†µï¼š</p>\n<p>æ¯”æ–¹è¯´ æˆ‘æœ‰ä¸€ä¸ªæ­å·çš„æœºæˆ¿é‡Œé¢æœ‰ order-service é›†ç¾¤è¿˜æœ‰ user-service çš„é›†ç¾¤ã€‚è¿˜æœ‰è¿˜æœ‰ä¸€ä¸ªä¸Šæµ·çš„æœºæˆ¿é‡Œé¢ä¹Ÿæ˜¯åŒæ ·çš„é…ç½®</p>\n<p>ç°åœ¨ï¼Œorder-service éœ€è¦è®¿é—® user-service é‚£ä¹ˆæœ‰ä¸¤ç§é€‰æ‹©ï¼šä¸€ç§æ˜¯åœ¨è‡ªå·±æœ¬åœ°å±€åŸŸç½‘å†…è®¿é—®ï¼Œå¦ä¸€ç§æ˜¯å»å¤–é¢æœºæˆ¿è®¿é—®</p>\n<p>å±€åŸŸç½‘å†…è®¿é—®é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œå»¶è¿Ÿæ¯”è¾ƒä½</p>\n<blockquote>\n<p>æœåŠ¡è°ƒç”¨å°½å¯èƒ½é€‰æ‹©æœ¬åœ°é›†ç¾¤çš„æœåŠ¡ï¼Œè·¨é›†ç¾¤è°ƒç”¨å»¶è¿Ÿè¾ƒé«˜</p>\n<p>æœ¬åœ°é›†ç¾¤ä¸å¯è®¿é—®æ—¶ï¼Œå†å»è®¿é—®å…¶å®ƒé›†ç¾¤</p>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051442382.png\" alt=\"image-20231005144140180\" /></p>\n<p>ä½†æ˜¯ç°åœ¨æˆ‘ä»¬è¿˜æ²¡æœ‰é…ç½®é›†ç¾¤å±æ€§ï¼Œçœ‹ä¸‹ nacos æ§åˆ¶å°</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051506788.png\" alt=\"image-20231005150616402\" /></p>\n<p>å¯ä»¥çœ‹åˆ°é›†ç¾¤åç§°ä¸ºï¼šDefault é»˜è®¤ï¼Œæ²¡æœ‰é›†ç¾¤</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051507220.png\" alt=\"image-20231005150745644\" /></p>\n<h3 id=\"44-æœåŠ¡é›†ç¾¤å±æ€§\"><a class=\"anchor\" href=\"#44-æœåŠ¡é›†ç¾¤å±æ€§\">#</a> 4.4ã€æœåŠ¡é›†ç¾¤å±æ€§ğŸŒ³</h3>\n<p>1ã€ä¿®æ”¹ application.ymlï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span> <span class=\"token comment\"># nacos æœåŠ¡ç«¯åœ°å€</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token key atrule\">discovery</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token key atrule\">cluster-name</span><span class=\"token punctuation\">:</span> HZ <span class=\"token comment\"># é…ç½®é›†ç¾¤åç§°ï¼Œä¹Ÿå°±æ˜¯æœºæˆ¿ä½ç½®ï¼Œè¿™é‡Œ HZ ä»£æŒ‡æ­å·</span></pre></td></tr></table></figure><p>2ã€æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªæœåŠ¡æ¥æ¨¡æ‹Ÿæ¼”ç¤ºé›†ç¾¤ä¸‰ä¸ªåˆ†åˆ«ä»£è¡¨ä¸åŒçš„ä½ç½®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051510774.png\" alt=\"image-20231005151045217\" /></p>\n<p>å…·ä½“çš„æ“ä½œæ­¥éª¤çœ‹åŠ¨å›¾ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051518637.gif\" alt=\"test\" /></p>\n<p>3ã€æŸ¥çœ‹ nacos çš„æƒ…å†µ</p>\n<p>å¯ä»¥çœ‹åˆ°æˆåŠŸå¯åŠ¨äº†ä¸‰ä¸ªé›†ç¾¤</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051513016.png\" alt=\"image-20231005151355371\" /></p>\n<p>æŸ¥çœ‹è¯¦ç»†ï¼Œåˆ«åˆ†æ˜¯ä¸åŒçš„ä½ç½®çš„é›†ç¾¤</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051515250.png\" alt=\"image-20231005151517180\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<ol>\n<li>Nacos æœåŠ¡åˆ†çº§å­˜å‚¨æ¨¡å‹\n<ol>\n<li>ä¸€çº§æ˜¯æœåŠ¡ï¼Œä¾‹å¦‚ userservice</li>\n<li>äºŒçº§æ˜¯é›†ç¾¤ï¼Œä¾‹å¦‚æ­å·æˆ–ä¸Šæµ·</li>\n<li>ä¸‰çº§æ˜¯å®ä¾‹ï¼Œä¾‹å¦‚æ­å·æœºæˆ¿çš„æŸå°éƒ¨ç½²äº† userservice çš„æœåŠ¡å™¨</li>\n</ol>\n</li>\n<li>å¦‚ä½•è®¾ç½®å®ä¾‹çš„é›†ç¾¤å±æ€§\n<ol>\n<li>ä¿®æ”¹ application.yml æ–‡ä»¶ï¼Œæ·»åŠ  spring.cloud.nacos.discovery.cluster-name å±æ€§å³å¯</li>\n</ol>\n</li>\n</ol>\n</blockquote>\n<p>æˆ‘ä»¬å°† user-service çš„ 8081 æœåŠ¡å’Œ 8082 æœåŠ¡è¿˜æœ‰ 8083 æœåŠ¡åˆ†åˆ«è®¾ç½®åˆ°äº†ä¸åŒä½ç½®çš„é›†ç¾¤ä½†æ˜¯æˆ‘ä»¬æœ€ç»ˆæƒ³è¦å®ç°çš„æ˜¯ order-service è¿œç¨‹è°ƒç”¨ user-service æ—¶ï¼Œä¼˜å…ˆé€‰æ‹©æœ¬åœ°é›†ç¾¤ã€‚é‚£å› æ­¤å‘¢æˆ‘ä»¬è¿˜éœ€è¦ç»™ order-service ä¹Ÿé…ç½®ä¸€ä¸ªé›†ç¾¤å±æ€§</p>\n<h4 id=\"441-æ ¹æ®é›†ç¾¤è´Ÿè½½å‡è¡¡\"><a class=\"anchor\" href=\"#441-æ ¹æ®é›†ç¾¤è´Ÿè½½å‡è¡¡\">#</a> 4.4.1ã€æ ¹æ®é›†ç¾¤è´Ÿè½½å‡è¡¡ğŸŒ²</h4>\n<p>1ã€åœ¨ order-service æœåŠ¡ä¸­çš„ application.yml ä¸­è¿›è¡Œé…ç½®</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span> <span class=\"token comment\"># nacos æœåŠ¡ç«¯åœ°å€</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token key atrule\">discovery</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token key atrule\">cluster-name</span><span class=\"token punctuation\">:</span> HZ <span class=\"token comment\"># é…ç½®é›†ç¾¤åç§°ï¼Œä¹Ÿå°±æ˜¯æœºæˆ¿ä½ç½®ï¼Œè¿™é‡Œ HZ ä»£æŒ‡æ­å·</span></pre></td></tr></table></figure><p>é…ç½®å®Œæˆåå¯åŠ¨ order-service æœåŠ¡</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051531329.png\" alt=\"image-20231005153152984\" /></p>\n<p>æŸ¥çœ‹ nacos ä¿¡æ¯ order-service æ˜¯å¦ä¸ user-service å¤„äº HZ é›†ç¾¤</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051533345.png\" alt=\"image-20231005153349541\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051534369.png\" alt=\"image-20231005153426289\" /></p>\n<p>2ã€ç„¶ååœ¨ order-service ä¸­è®¾ç½®è´Ÿè½½å‡è¡¡çš„ IRule ä¸º NacosRuleï¼Œè¿™ä¸ªè§„åˆ™ä¼˜å…ˆä¼šå¯»æ‰¾ä¸è‡ªå·±åŒé›†ç¾¤çš„æœåŠ¡ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># ç»™æŒ‡å®šçš„å¾®æœåŠ¡è¿›è¡Œé›†ç¾¤è´Ÿè½½å‡è¡¡çš„é…ç½®</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">userservice</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">ribbon</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">NFLoadBalancerRuleClassName</span><span class=\"token punctuation\">:</span> com.alibaba.cloud.nacos.ribbon.NacosRule <span class=\"token comment\"># è´Ÿè½½å‡è¡¡è§„åˆ™</span></pre></td></tr></table></figure><p>3ã€è®¿é—® order-service æœåŠ¡ 3 æ¬¡æŸ¥çœ‹è½®è¯¢ç»“æœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051630022.gif\" alt=\"test\" /></p>\n<p>è®¿é—®ç¬¬ä¸€æ¬¡ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>http://127.0.0.1:8080/order/101</pre></td></tr></table></figure><p>è®¿é—®ç¬¬äºŒæ¬¡ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>http://127.0.0.1:8080/order/102</pre></td></tr></table></figure><p>è®¿é—®ç¬¬ä¸‰æ¬¡ï¼š</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>http://127.0.0.1:8080/order/103</pre></td></tr></table></figure><p>8081</p>\n<pre><code>Creating a new SqlSession\nSqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@20d32e8c] was not registered for synchronization because synchronization is not active\nJDBC Connection [HikariProxyConnection@773117158 wrapping com.mysql.cj.jdbc.ConnectionImpl@1a9c99e4] will not be managed by Spring\n==&gt;  Preparing: select * from tb_user where id = ? \n==&gt; Parameters: 1(Long)\n&lt;==    Columns: id, username, address\n&lt;==        Row: 1, æŸ³å²©, æ¹–å—çœè¡¡é˜³å¸‚\n&lt;==      Total: 1\nClosing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@20d32e8c]\nCreating a new SqlSession\nSqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@4c31c2cf] was not registered for synchronization because synchronization is not active\nJDBC Connection [HikariProxyConnection@1123427641 wrapping com.mysql.cj.jdbc.ConnectionImpl@1a9c99e4] will not be managed by Spring\n==&gt;  Preparing: select * from tb_user where id = ? \n==&gt; Parameters: 2(Long)\n&lt;==    Columns: id, username, address\n&lt;==        Row: 2, æ–‡äºŒç‹—, é™•è¥¿çœè¥¿å®‰å¸‚\n&lt;==      Total: 1\nClosing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@4c31c2cf]\nCreating a new SqlSession\nSqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@16810291] was not registered for synchronization because synchronization is not active\nJDBC Connection [HikariProxyConnection@407305777 wrapping com.mysql.cj.jdbc.ConnectionImpl@1a9c99e4] will not be managed by Spring\n==&gt;  Preparing: select * from tb_user where id = ? \n==&gt; Parameters: 3(Long)\n&lt;==    Columns: id, username, address\n&lt;==        Row: 3, åæ²‰é±¼, æ¹–åŒ—çœåå °å¸‚\n&lt;==      Total: 1\nClosing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@16810291]\n</code></pre>\n<p>8082</p>\n<pre><code></code></pre>\n<p>8083</p>\n<pre><code></code></pre>\n<p>å¯ä»¥çœ‹åˆ°ä¼˜å…ˆé€‰æ‹©çš„æ˜¯æœ¬åœ°é›†ç¾¤çš„æœåŠ¡ï¼Œä½†æ˜¯ä¹Ÿä¼šæœ‰å¯èƒ½é€‰æ‹©è¿œç¨‹çš„é›†ç¾¤ã€‚</p>\n<p>å®ƒå¹¶ä¸æ˜¯è½®è¯¢è°ƒç”¨æœ¬æœºé›†ç¾¤æˆ–è€…è¿œç¨‹é›†ç¾¤è€Œæ˜¯ä¸€ç§æ²¡æœ‰è§„å¾‹çš„éšæœºçš„è°ƒç”¨æ–¹å¼</p>\n<p>å¦‚æœè¯´ user-service:8081 è¿™ä¸ªæœåŠ¡æŒ‚æ‰äº†å‘¢ï¼Ÿ å°† 8081 å…³é—­æˆ‘ä»¬å†æ¬¡è®¿é—®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051635074.png\" alt=\"image-20231005163505936\" /></p>\n<p>æ­¤æ—¶ 8083 å°±è¢«è¯·æ±‚äº†æ‰“å°å‡ºäº†æ¶ˆæ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051635696.png\" alt=\"image-20231005163557083\" /></p>\n<p>ä½†æ˜¯åœ¨ order-service ä¸­æ§åˆ¶å°ä¸­å°±ä¼šæ‰“å°ä¸€ä¸ªè­¦å‘Š</p>\n<p>è­¦å‘Šçš„æ„æ€å°±æ˜¯ï¼šå‘ç”Ÿäº†ä¸€æ¬¡è·¨é›†ç¾¤çš„è®¿é—® order-service è®¿é—® user-service ä½ç½®ä¸º HZ çš„é›†ç¾¤ä½†æ˜¯å´è®¿é—®äº† SH</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051637118.png\" alt=\"image-20231005163756874\" /></p>\n<p>é€šè¿‡è¿™æ¬¡æµ‹è¯•æˆ‘ä»¬å¾—å‡º NacosRule å®ƒå…¶å®ä¼˜å…ˆè®¿é—®çš„æ˜¯æœ¬åœ°ï¼Œæœ¬åœ°æ²¡æœ‰å®ƒæ‰ä¼šè¿›è¡Œè·¨é›†ç¾¤è®¿é—®ï¼Œè€Œè·¨é›†ç¾¤å°±ä¼šå‘å‡ºä¸€æ¬¡è­¦å‘Š</p>\n<p>3ã€æ³¨æ„å°† user-service çš„æƒé‡éƒ½è®¾ç½®ä¸º 1</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051641100.png\" alt=\"image-20231005164127314\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<ol>\n<li>NacosRule è´Ÿè½½å‡è¡¡ç­–ç•¥\n<ol>\n<li>ä¼˜å…ˆé€‰æ‹©åŒé›†ç¾¤æœåŠ¡å®ä¾‹åˆ—è¡¨</li>\n<li>æœ¬åœ°é›†ç¾¤æ‰¾ä¸åˆ°æä¾›è€…ï¼Œæ‰å»å…¶å®ƒé›†ç¾¤å¯»æ‰¾ï¼Œå¹¶ä¸”ä¼šæŠ¥è­¦å‘Š</li>\n<li>ç¡®å®šäº†å¯ç”¨å®ä¾‹åˆ—è¡¨åï¼Œå†é‡‡ç”¨éšæœºè´Ÿè½½å‡è¡¡æŒ‘é€‰å®ä¾‹</li>\n</ol>\n</li>\n</ol>\n</blockquote>\n<h4 id=\"442-æ ¹æ®æƒé‡è´Ÿè½½å‡è¡¡\"><a class=\"anchor\" href=\"#442-æ ¹æ®æƒé‡è´Ÿè½½å‡è¡¡\">#</a> 4.4.2ã€æ ¹æ®æƒé‡è´Ÿè½½å‡è¡¡ğŸŒ²</h4>\n<blockquote>\n<p>ä¸Šé›†ï¼Œæˆ‘ä»¬å­¦ä¹ äº† Nacos çš„è´Ÿè½½å‡è¡¡çš„ä¸€ç§è§„åˆ™ NacosRuleï¼Œå®ƒå¯ä»¥åšåˆ°<mark>é›†ç¾¤ä¼˜å…ˆçš„è´Ÿè½½å‡è¡¡</mark>ã€‚ä¸è¿‡æˆ‘ä»¬éƒ¨ç½²çš„æ—¶å€™å¯èƒ½å‡ºç°è¿™æ ·çš„æƒ…å†µï¼Œç”±äºä¼ä¸šè®¾å¤‡ä¼šæ›´æ–°è¿­ä»£æœ‰äº›æœºå™¨æ€§èƒ½æ¯”è¾ƒå¥½ï¼Œè¿˜æœ‰ä¸€äº›å±äºæ˜¯ç¥–ä¼ è®¾å¤‡äº†æ€§èƒ½éå¸¸å·®ï¼Œå¯ä»¥è¯´è€å¼±ç—…æ®‹ã€‚è¿™æ—¶å€™æˆ‘ä»¬è‚¯å®šå¸Œæœ›è¿™äº›æ€§èƒ½å¥½çš„æœºå™¨å®ƒæ‰¿æ‹…æ›´å¤šçš„ç”¨æˆ·è¯·æ±‚ï¼Œè€Œå“ªäº›æ€§èƒ½å·®ä¸€ç‚¹çš„è‡ªç„¶æ‰¿æ‹…å°‘ä¸€ç‚¹çš„ç”¨æˆ·è¯·æ±‚ã€‚ä½†æ˜¯æˆ‘ä»¬ç›®å‰çœ‹æ¥ NacosRule åšåˆ°çš„æ˜¯é›†ç¾¤ä¼˜å…ˆè€Œååšéšæœºã€‚å½“ç”¨æˆ·è¯·æ±‚å®Œäº†ä»¥åå®ƒå¯ä¸ä¼šç®¡ä½ æœºå™¨æ€§èƒ½å¥½è¿˜æ˜¯å·®çš„æ‹‰è¿‡æ¥å°±æ˜¯ä¸€é¡¿å«è¿™æ—¶æ€§èƒ½å·®çš„æœºå™¨è‚¯å®šå°±å‡ºé—®é¢˜äº†ã€‚</p>\n<p>é‚£ä¹ˆæˆ‘ä»¬è¦æ€ä¹ˆå»æ§åˆ¶ä¸åŒæœåŠ¡å®ƒè¯·æ±‚çš„é‡å‘¢ï¼Ÿ</p>\n<p>Nacos ç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§æƒé‡çš„é…ç½®</p>\n</blockquote>\n<p><strong>å®é™…éƒ¨ç½²ä¸­ä¼šå‡ºç°è¿™æ ·çš„åœºæ™¯</strong>ï¼š</p>\n<ul>\n<li>æœåŠ¡å™¨è®¾å¤‡æ€§èƒ½æœ‰å·®å¼‚ï¼Œéƒ¨åˆ†å®ä¾‹æ‰€åœ¨æœºå™¨æ€§èƒ½è¾ƒå¥½ï¼Œå¦ä¸€äº›è¾ƒå·®ï¼Œæˆ‘ä»¬å¸Œæœ›æ€§èƒ½å¥½çš„æœºå™¨æ‰¿æ‹…æ›´å¤šçš„ç”¨æˆ·è¯·æ±‚</li>\n</ul>\n<p>Nacos æä¾›äº†æƒé‡é…ç½®æ¥æ§åˆ¶è®¿é—®é¢‘ç‡ï¼Œæƒé‡è¶Šå¤§åˆ™è®¿é—®é¢‘ç‡è¶Šé«˜</p>\n<h4 id=\"443-æƒé‡é…ç½®æ“ä½œ\"><a class=\"anchor\" href=\"#443-æƒé‡é…ç½®æ“ä½œ\">#</a> 4.4.3ã€æƒé‡é…ç½®æ“ä½œï¼šğŸŒ²</h4>\n<p>1ã€åœ¨ Nacos æ§åˆ¶å°å¯ä»¥è®¾ç½®å®ä¾‹çš„æƒé‡å€¼ï¼Œé¦–å…ˆé€‰ä¸­å®ä¾‹åé¢çš„ç¼–è¾‘æŒ‰é’®</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051655722.png\" alt=\"image-20231005165528544\" /></p>\n<p>2ã€å°†æƒé‡è®¾ç½®ä¸º 0.1ï¼Œæµ‹è¯•å¯ä»¥å‘ç° 8081 è¢«è®¿é—®åˆ°çš„é¢‘ç‡å¤§å¤§é™ä½</p>\n<p>æƒé‡å€¼é…ç½®èŒƒå›´ï¼š0 ~ 1</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051656163.png\" alt=\"image-20231005165622001\" /></p>\n<p>æŸ¥çœ‹ä¸‹ç›®å‰çš„é›†ç¾¤æƒ…å†µ</p>\n<p>order-service</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051659631.png\" alt=\"image-20231005165920414\" /></p>\n<p>user-service</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051700588.png\" alt=\"image-20231005170021931\" /></p>\n<p>åœ¨æ²¡æœ‰é…ç½®æƒé‡å€¼éƒ½æ˜¯ç›¸åŒçš„æƒ…å†µä¸‹è®¿é—® 3 æ¬¡ order-service æ‰“å°çš„ä¿¡æ¯å¦‚ä¸‹</p>\n<p>user-service:8081 æ‰“å°äº†å…¨éƒ¨çš„ä¿¡æ¯ï¼Œ8082,8083 éƒ½æ²¡æœ‰</p>\n<p>æˆ‘ä»¬å°† 8081 è¿™ä¸ªé›†ç¾¤çš„æƒé‡å€¼è®¾ç½®ä¸º 0 åœ¨è¿›è¡Œæµ‹è¯•</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051940128.png\" alt=\"image-20231005194035918\" /></p>\n<p>è®¿é—® order-service åˆ·æ–°é¡µé¢ 10 æ¬¡æ‰“å°çš„ä¿¡æ¯å¦‚ä¸‹</p>\n<p>8081 æ²¡æœ‰ä¿¡æ¯ï¼Œ8082 æœ‰ä¿¡æ¯ï¼Œ8083 æœ‰ä¿¡æ¯</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<ol>\n<li>å®ä¾‹çš„æƒé‡æ§åˆ¶\n<ol>\n<li>Nacos æ§åˆ¶å°å¯ä»¥è®¾ç½®å®ä¾‹çš„æƒé‡å€¼ï¼Œ0 ~ 1 ä¹‹é—´</li>\n<li>åŒé›†ç¾¤å†…çš„å¤šä¸ªå®ä¾‹ï¼Œæƒé‡è¶Šé«˜è¢«è®¿é—®çš„é¢‘ç‡è¶Šé«˜</li>\n<li>æƒé‡è®¾ç½®ä¸º 0 åˆ™å®Œå…¨ä¸ä¼šè¢«è®¿é—®</li>\n</ol>\n</li>\n</ol>\n</blockquote>\n<h3 id=\"45-ç¯å¢ƒéš”ç¦»-namespace\"><a class=\"anchor\" href=\"#45-ç¯å¢ƒéš”ç¦»-namespace\">#</a> 4.5ã€ç¯å¢ƒéš”ç¦» - namespaceğŸŒ³</h3>\n<p>Nacos ä¸­æœåŠ¡å­˜å‚¨å’Œæ•°æ®å­˜å‚¨çš„æœ€å¤–å±‚éƒ½æ˜¯ä¸€ä¸ªåä¸º namespace çš„ä¸œè¥¿ï¼Œç”¨æ¥åšæœ€å¤–å±‚éš”ç¦»</p>\n<blockquote>\n<p>å°†æ¥å¯ä»¥æœ‰å¤šä¸ª namespace å¯ä»¥ç†è§£ä¸ºå¤šä¸ªè›‹ï¼Œç›¸äº’ä¹‹é—´æ˜¯éš”ç¦»å¼€çš„ï¼Œåœ¨ namespace å†…éƒ¨æœ‰ä¸€ä¸ª group å±æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´åŒä¸€ä¸ªå‘½åç©ºé—´çš„å¤šä¸ªä¸œè¥¿æˆ‘ä»¬å°†æ¥è¿˜å¯ä»¥åˆ†ç»„ï¼Œç»„å†…å°±æ˜¯å…·ä½“çš„ä¸œè¥¿äº†ã€‚æ¯”å¦‚è¯´æœåŠ¡ï¼ŒæœåŠ¡å†å¾€ä¸‹å°±æ˜¯é›†ç¾¤ï¼Œå†å¾€ä¸‹å°±æ˜¯å®ä¾‹ã€‚</p>\n</blockquote>\n<p>è¿™é‡Œæˆ‘ä»¬çš„ç¯å¢ƒéš”ç¦»å…¶å®å°±æ˜¯åœ¨å¯¹æœåŠ¡åšéš”ç¦»</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310052013655.png\" alt=\"image-20231005201313765\" /></p>\n<p>ä¸ºä»€ä¹ˆéœ€è¦éš”ç¦»å‘¢ï¼Ÿ</p>\n<p>æœåŠ¡åˆ’åˆ†ï¼Œå®ä¾‹åˆ’åˆ†è¿™æ˜¯åŸºäºä¸šåŠ¡å»åšçš„åˆ’åˆ†æˆ–è€…æ˜¯åœ°åŸŸä½†äº‹å®ä¸Šæˆ‘ä»¬è¿˜ä¼šæœ‰å¼€å‘ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒï¼Œæµ‹è¯•ç¯å¢ƒçš„å˜åŒ–æ‰€ä»¥æˆ‘ä»¬ä¼šåŸºäºè¿™ç§ç¯å¢ƒå˜åŒ–å»åšéš”ç¦»ã€‚</p>\n<p>æˆ‘ä»¬å¯ä»¥å§ä¸šåŠ¡ç›¸å…³åº¦æ¯”è¾ƒé«˜çš„æ”¾åœ¨ä¸€ç»„ä¸­</p>\n<p>1ã€åœ¨ Nacos æ§åˆ¶å°å¯ä»¥åˆ›å»º namespaceï¼Œç”¨æ¥éš”ç¦»ä¸åŒç¯å¢ƒ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310052024412.png\" alt=\"image-20231005202456034\" /></p>\n<p>2ã€ç„¶åå¡«å†™ä¸€ä¸ªæ–°çš„å‘½åç©ºé—´ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310052025744.png\" alt=\"image-20231005202536537\" /></p>\n<p>3ã€ä¿å­˜åä¼šåœ¨æ§åˆ¶å°çœ‹åˆ°è¿™ä¸ªå‘½åç©ºé—´çš„ id</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310052026832.png\" alt=\"image-20231005202632739\" /></p>\n<p>4ã€ä¿®æ”¹ order-service çš„ application.ymlï¼Œæ·»åŠ  namespace</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> jdbc<span class=\"token punctuation\">:</span>mysql<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span>3306/cloud_user<span class=\"token punctuation\">?</span>useSSL=false<span class=\"token important\">&amp;characterEncoding=utf-8&amp;serverTimezone=UTC</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> dkx.</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">driver-class-name</span><span class=\"token punctuation\">:</span> com.mysql.cj.jdbc.Driver</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> userservice</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span> <span class=\"token comment\"># nacos æœåŠ¡ç«¯åœ°å€</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token key atrule\">discovery</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token key atrule\">cluster-name</span><span class=\"token punctuation\">:</span> TJ <span class=\"token comment\"># é›†ç¾¤åç§°ï¼Œè¿™é‡Œ HZ ä»£æŒ‡æ­å·</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> ed32fa6f<span class=\"token punctuation\">-</span>e9e3<span class=\"token punctuation\">-</span>4483<span class=\"token punctuation\">-</span>b860<span class=\"token punctuation\">-</span>7bcd9731d0d9 <span class=\"token comment\"># å‘½åç©ºé—´ï¼Œå¡« ID</span></pre></td></tr></table></figure><p>5ã€åˆ·æ–° nacos é¡µé¢</p>\n<p>order-service å°±ä¸åœ¨ public ä¸­äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310052032144.png\" alt=\"image-20231005203254198\" /></p>\n<p>è€Œæ˜¯åˆ°äº† dev ä¸­äº†ï¼Œå®ƒä»¬ä¸¤ä¸ªå·²ç»ä¸æ˜¯åŒä¸€ä¸ªä½ç½®çš„æœåŠ¡äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310052033504.png\" alt=\"image-20231005203322946\" /></p>\n<p>æˆ‘ä»¬è®¿é—®çš„è¯å°±ä¼šæŠ¥é”™ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310052034062.png\" alt=\"image-20231005203400951\" /></p>\n<p><strong>idea æ§åˆ¶å°æŠ¥é”™æç¤ºä¸º</strong>ï¼š&lt;font color='red'&gt; æ‰¾ä¸åˆ°å¯ç”¨çš„å®ä¾‹ &lt;/font&gt;.</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310052034175.png\" alt=\"image-20231005203453936\" /></p>\n<p>æ‰€ä»¥è¦æƒ³è®©æœåŠ¡å¯ä»¥è®¿é—®å¿…é¡»æ˜¯åŒä¸€ä¸ªç¯å¢ƒä¸‹</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<ol>\n<li>Nacos ç¯å¢ƒéš”ç¦»\n<ol>\n<li>namespace ç”¨æ¥åšç¯å¢ƒéš”ç¦»</li>\n<li>æ¯ä¸ª namespace éƒ½æœ‰å”¯ä¸€ id</li>\n<li>ä¸åŒ namespace ä¸‹çš„æœåŠ¡ä¸å¯è§\n<ul>\n<li>å¦‚æœæƒ³è¦ä¸¤ä¸ªæœåŠ¡å¯ä»¥è®¿é—®å¿…é¡»æŠŠå®ƒä»¬æ”¾åˆ°åŒä¸€ä¸ª namespace ä¸‹</li>\n</ul>\n</li>\n</ol>\n</li>\n</ol>\n</blockquote>\n<h3 id=\"46-nacosæ³¨å†Œä¸­å¿ƒç»†èŠ‚åˆ†æ\"><a class=\"anchor\" href=\"#46-nacosæ³¨å†Œä¸­å¿ƒç»†èŠ‚åˆ†æ\">#</a> 4.6ã€nacos æ³¨å†Œä¸­å¿ƒç»†èŠ‚åˆ†æğŸŒ³</h3>\n<p>æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œéƒ½ä¼šæŠŠè‡ªå·±çš„ä¿¡æ¯æäº¤ç»™æ³¨å†Œä¸­å¿ƒã€‚è€Œæ³¨å†Œä¸­å¿ƒå°±ä¼šæŠŠè¿™äº›ä¿¡æ¯ä¿ç•™ä¸‹æ¥</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310052039311.png\" alt=\"image-20231005203942965\" /></p>\n<p>å½“æœåŠ¡æ¶ˆè´¹è€…è¦æ¶ˆè´¹æ—¶å®ƒå°±å¯ä»¥å»æ‰¾æ³¨å†Œä¸­å¿ƒæ‹‰å–æœåŠ¡ä¿¡æ¯äº†ã€‚ä¸è¿‡è¿™ä¸ªæ‹‰å–çš„åŠ¨ä½œä¸æ˜¯æ¯ä¸€æ¬¡éƒ½è¦åšçš„å®ƒä¼šå°†æ‹‰å–åˆ°çš„æœåŠ¡ä¿¡æ¯ç¼“å­˜åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­</p>\n<p>å½“ç„¶å¦‚æœç¼“å­˜ä¸€ç›´ä¸æ›´æ–°ä¹Ÿæ˜¯ä¸è¡Œçš„ä¸‡ä¸€æœåŠ¡æä¾›è€…ä¿¡æ¯å˜åŒ–äº†å‘¢ï¼Œæ‰€ä»¥è¿™ä¸ªåˆ—è¡¨ä¼šæ¯éš” 30 ç§’é‡æ–°æ‹‰å–ä¸€æ¬¡ï¼Œè¿›è¡Œä¸€ä¸ªæ›´æ–°</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310052042295.png\" alt=\"image-20231005204255542\" /></p>\n<p>æ¶ˆè´¹è€…æ‹¿åˆ°æœåŠ¡åˆ—è¡¨ä»¥åå†å»è´Ÿè½½å‡è¡¡æŒ‘é€‰ä¸€ä¸ªå‘èµ·è¿œç¨‹è°ƒç”¨å°±å¯ä»¥äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310052045232.png\" alt=\"image-20231005204549665\" /></p>\n<p>ä½†æ˜¯ nacos ä¸ eureka è¿˜æ˜¯æœ‰ä¸€äº›å·®åˆ«ï¼Œå·®åˆ«å°±åœ¨äºæœåŠ¡æä¾›è€…çš„å¥åº·æ£€æµ‹</p>\n<p>nacos ä¼šæŠŠ<mark>æœåŠ¡æä¾›è€…åˆ’åˆ†æˆ</mark><strong>ä¸´æ—¶å®ä¾‹</strong>å’Œ<strong>éä¸´æ—¶å®ä¾‹</strong>ã€‚</p>\n<p>åœ¨ nacos é¡µé¢ä¸­æŒ‘é€‰ä¸€ä¸ªæœåŠ¡æŸ¥çœ‹ è¯¦æƒ…å°±å¯ä»¥çœ‹åˆ° ä¸´æ—¶å®ä¾‹è¿˜æ˜¯éä¸´æ—¶å®ä¾‹äº†</p>\n<p>å¦‚ä¸‹å›¾ï¼Œnacos ä¸­é»˜è®¤å°±æ˜¯ä¸´æ—¶å®ä¾‹ï¼Œè€Œä¸´æ—¶å®ä¾‹ä¸éä¸´æ—¶å®ä¾‹åœ¨ nacos ä¸­åšå¥åº·ç›‘æµ‹æ˜¯ä¸ä¸€æ ·çš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310052048533.png\" alt=\"image-20231005204834080\" /></p>\n<h4 id=\"461-ä¸´æ—¶å®ä¾‹\"><a class=\"anchor\" href=\"#461-ä¸´æ—¶å®ä¾‹\">#</a> 4.6.1ã€ä¸´æ—¶å®ä¾‹ğŸŒ²</h4>\n<p>ä¸´æ—¶å®ä¾‹ï¼Œå¬å…¶åè®¤ä¸ºå®ƒæ˜¯å°†æ¥å¯èƒ½äººä¸ºçš„æŠŠæœåŠ¡åœæ‰çš„ï¼Œæ‰€ä»¥å®ƒåœ¨ nacos ä¸­åšå¥åº·ç›‘æµ‹æ—¶é‡‡ç”¨çš„æ˜¯å¿ƒè·³æ£€æµ‹</p>\n<p>å¦‚æœæœåŠ¡æä¾›è€…å¿ƒè·³ä¸è·³äº†è¶…è¿‡æ—¶é—´å°±ä¼šè¢« nacos ä»æœåŠ¡åˆ—è¡¨ä¸­å‰”é™¤</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310052051280.png\" alt=\"image-20231005205144644\" /></p>\n<h4 id=\"462-éä¸´æ—¶å®ä¾‹\"><a class=\"anchor\" href=\"#462-éä¸´æ—¶å®ä¾‹\">#</a> 4.6.2ã€éä¸´æ—¶å®ä¾‹ğŸŒ²</h4>\n<blockquote>\n<p>éä¸´æ—¶å®ä¾‹ä¸­ nacos ä¸ä¼šå»åšå¿ƒè·³ï¼Œé‚£ä¹ˆè¿™æ—¶å¥åº·ç›‘æµ‹æ˜¯æ€ä¹ˆç›‘æµ‹çš„å‘¢ï¼Ÿ</p>\n<p>æ˜¯ç”± nacos ä¸»åŠ¨å‘è¯·æ±‚å»è¯¢é—®æœåŠ¡æä¾›è€…ï¼šâ€œè¯¶ï¼ä½ è¿˜æ´»ç€å—ï¼Ÿâ€ï¼Œå¦‚æœå®ƒæ²¡å›åº” nacos å¹¶ä¸ä¼šå°†å®ƒä»æœåŠ¡åˆ—è¡¨ä¸­å‰”é™¤è€Œæ˜¯æ ‡è®°ä¸ºä¸å¥åº·äº†ï¼Œå®ƒä»¬ç­‰ç€è¿™ä¸ªæœåŠ¡æ¢å¤å¥åº·</p>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310052056840.png\" alt=\"image-20231005205645566\" /></p>\n<p>è¿™æ˜¯ä¸€ä¸ª nacos ä¸ eureka ä¹‹é—´çš„å·®åˆ«ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªå·®åˆ«åœ¨äºæ¶ˆè´¹è€…</p>\n<p>eureka é‡‡ç”¨çš„æ˜¯å®šæ—¶æ‹‰å–æ¯éš” 30 ç§’æ‹‰å–ä¸€æ¬¡ï¼Œå¦‚æœæœ‰æœåŠ¡æä¾›è€…åœ¨ 30 ç§’å†…æŒ‚æ‰äº†é‚£æ¶ˆè´¹è€…ä¸çŸ¥é“å§ï¼Œå®ƒä¸çŸ¥é“æä¾›è€…æŒ‚äº†è¿˜ç›´æ¥å»æ¶ˆè´¹å°±ä¼šå‡ºé—®é¢˜äº†ã€‚</p>\n<p>æ‰€ä»¥ eureka åšæœåŠ¡å®šæ—¶æ‹‰å–å®ƒæœåŠ¡åˆ—è¡¨æ›´æ–°çš„è¿™ä¸ªæ•ˆç‡æ¯”è¾ƒå·® (æ›´æ–°ä¸å¤ŸåŠæ—¶)</p>\n<p>è€Œ nacos å®ƒåšäº†ä¸€ä¸ªå«æ¨é€æ¶ˆæ¯ã€‚ä¹Ÿå°±æ˜¯ eureka é‡‡ç”¨çš„æ˜¯ pullï¼Œè€Œ nacos é‡‡ç”¨çš„æ˜¯ pull+push ä¸¤è€…ç»“åˆ</p>\n<p>å‡è®¾ nacos å‘ç°æœåŠ¡æä¾›è€…æŒ‚äº†ï¼Œå®ƒå°±ä¼šç«‹å³å‘é€ä¸€æ¡æ¶ˆæ¯æ¨é€ç»™æˆ‘ä»¬çš„æœåŠ¡æ¶ˆè´¹è€…ï¼Œç„¶åæœåŠ¡æ¶ˆè´¹è€…å°±èµ¶ç´§æ›´æ–°</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310052101513.png\" alt=\"image-20231005210145076\" /></p>\n<p>è¿™å°±æ˜¯ eureka ä¸ nacos ä¹‹é—´çš„ä¸€äº›å·®åˆ«äº†ï¼</p>\n<h4 id=\"463-ä¸´æ—¶å®ä¾‹å’Œéä¸´æ—¶å®ä¾‹\"><a class=\"anchor\" href=\"#463-ä¸´æ—¶å®ä¾‹å’Œéä¸´æ—¶å®ä¾‹\">#</a> 4.6.3ã€ä¸´æ—¶å®ä¾‹å’Œéä¸´æ—¶å®ä¾‹ğŸŒ²</h4>\n<p>æœåŠ¡æ³¨å†Œåˆ° nacos æ—¶ï¼Œå¯ä»¥é€‰æ‹©æ³¨å†Œä¸ºä¸´æ—¶å®ä¾‹æˆ–éä¸´æ—¶å®ä¾‹ï¼Œé€šè¿‡ä¸‹é¢çš„é…ç½®æ¥è®¾ç½®ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token key atrule\">discovery</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token key atrule\">ephemeral</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span> <span class=\"token comment\"># è®¾ç½®æ˜¯å¦ä¸ºä¸´æ—¶å®ä¾‹ è®¾ç½®ä¸ºéä¸´æ—¶å®ä¾‹</span></pre></td></tr></table></figure><p>ä¸´æ—¶å®ä¾‹å®•æœºæ—¶ï¼Œä¼šä» nacos çš„æœåŠ¡åˆ—è¡¨ä¸­å‰”é™¤ï¼Œè€Œéä¸´æ—¶å®ä¾‹åˆ™ä¸ä¼š</p>\n<p>â€‹\tåœ¨ order-service ä¸­è¿›è¡Œé…ç½®ä¸ºéä¸´æ—¶å®ä¾‹ï¼Œå†å» nacos ä¸­æŸ¥çœ‹ orderservice çš„è¯¦æƒ…</p>\n<p>å¯ä»¥çœ‹åˆ°ä¸´æ—¶å®ä¾‹ä¸º falseï¼Œè¡¨ç¤ºä¸ºéä¸´æ—¶å®ä¾‹äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310052131922.png\" alt=\"image-20231005213059792\" /></p>\n<p>è¿™æ—¶æˆ‘ä»¬å°† order-service æœåŠ¡åœæ‰</p>\n<p>ç”±äºæ˜¯éä¸´æ—¶å®ä¾‹ï¼Œå°±ç®—æœåŠ¡æä¾›è€…æŒ‚æ‰äº† æ³¨å†Œä¸­å¿ƒ ä¹Ÿä¸ä¼šå°†å…¶ä»æœåŠ¡åˆ—è¡¨ä¸­å‰”é™¤æ‰ï¼Œæ ‡çº¢è¡¨ç¤ºè¿™ä¸ªæœåŠ¡æŒ‚æ‰äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310052132484.png\" alt=\"image-20231005213247819\" /></p>\n<p>å¦‚æœæ”¹ä¸ºä¸´æ—¶å®ä¾‹</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token key atrule\">discovery</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token key atrule\">ephemeral</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\"># è®¾ç½®æ˜¯å¦ä¸ºä¸´æ—¶å®ä¾‹ è®¾ç½®ä¸ºéä¸´æ—¶å®ä¾‹</span></pre></td></tr></table></figure><p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310052134138.png\" alt=\"image-20231005213417852\" /></p>\n<p>æˆ‘ä»¬å†æ¬¡å°† order-service æœåŠ¡åœæ‰ï¼Œç„¶åå†åˆ·æ–°é¡µé¢æˆ–è€…è¿”å›åˆ°è¿™ä¸ªé¡µé¢æ—¶å‘ç°å…³æ‰çš„æœåŠ¡è¢« æ³¨å†Œä¸­å¿ƒ ç»™å‰”é™¤æ‰äº†ä¸åœ¨æœåŠ¡åˆ—è¡¨ä¸­äº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310052134361.png\" alt=\"image-20231005213452133\" /></p>\n<h5 id=\"4631-capç†è®º\"><a class=\"anchor\" href=\"#4631-capç†è®º\">#</a> 4.6.3.1ã€CAP ç†è®ºğŸŒ´</h5>\n<p>C ä¸€è‡´æ€§ï¼ŒA é«˜å¯ç”¨ï¼ŒP åˆ†åŒºå®¹é”™æ€§</p>\n<ul>\n<li>\n<p>eureka åªæ”¯æŒ AP</p>\n</li>\n<li>\n<p>nacos æ”¯æŒ CP å’Œ AP ä¸¤ç§</p>\n<p>nacos æ˜¯æ ¹æ®é…ç½®è¯†åˆ« CP æˆ– AP æ¨¡å¼ï¼Œå¦‚æœæ³¨å†Œ Nacos çš„ client èŠ‚ç‚¹æ³¨å†Œæ—¶æ˜¯ ephemeral=true å³ä¸ºä¸´æ—¶èŠ‚ç‚¹ï¼Œé‚£ä¹ˆ Nacos é›†ç¾¤å¯¹è¿™ä¸ª client èŠ‚ç‚¹æ•ˆæœå°±æ˜¯ APï¼Œåä¹‹åˆ™æ˜¯ CPï¼Œæ—¢ä¸æ˜¯ä¸´æ—¶èŠ‚ç‚¹</p>\n</li>\n</ul>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<ol>\n<li>Nacos ä¸ eureka çš„å…±åŒç‚¹\n<ol>\n<li>éƒ½æ”¯æŒæœåŠ¡æ³¨å†Œå’ŒæœåŠ¡æ‹‰å–</li>\n<li>éƒ½æ”¯æŒæœåŠ¡æä¾›è€…å¿ƒè·³æ–¹å¼åšå¥åº·æ£€æµ‹</li>\n</ol>\n</li>\n<li>Nacos ä¸ Eureka çš„åŒºåˆ«\n<ol>\n<li>Nacos æ”¯æŒæœåŠ¡ç«¯ä¸»åŠ¨æ£€æµ‹æä¾›è€…çŠ¶æ€ï¼š\n<ol>\n<li>ä¸´æ—¶å®ä¾‹é‡‡ç”¨å¿ƒè·³æ¨¡å¼</li>\n<li>éä¸´æ—¶å®ä¾‹é‡‡ç”¨ä¸»åŠ¨æ£€æµ‹æ¨¡å¼</li>\n</ol>\n</li>\n<li>ä¸´æ—¶å®ä¾‹å¿ƒè·³ä¸æ­£å¸¸ä¼šè¢«å‰”é™¤ï¼Œéä¸´æ—¶å®ä¾‹åˆ™ä¸ä¼šè¢«å‰”é™¤ (é™¤éæ‰‹åŠ¨åˆ é™¤)</li>\n<li>Nacos æ”¯æŒæœåŠ¡åˆ—è¡¨å˜æ›´çš„æ¶ˆæ¯æ¨é€æ¨¡å¼ï¼ŒæœåŠ¡åˆ—è¡¨æ›´æ–°åŠæ—¶</li>\n<li>Nacos é›†ç¾¤é»˜è®¤é‡‡ç”¨ AP æ–¹å¼ï¼Œå½“é›†ç¾¤ä¸­å­˜åœ¨éä¸´æ—¶å®ä¾‹æ—¶ï¼Œé‡‡ç”¨ CP æ¨¡å¼ï¼›Eureka é‡‡ç”¨ AP æ–¹å¼</li>\n</ol>\n</li>\n</ol>\n</blockquote>\n<h3 id=\"47-nacosé…ç½®ç®¡ç†\"><a class=\"anchor\" href=\"#47-nacosé…ç½®ç®¡ç†\">#</a> 4.7ã€Nacos é…ç½®ç®¡ç†ğŸŒ³</h3>\n<ul>\n<li>ç»Ÿä¸€é…ç½®ç®¡ç†</li>\n<li>é…ç½®çƒ­æ›´æ–°</li>\n<li>é…ç½®å…±äº«</li>\n<li>æ­å»º Naocs é›†ç¾¤</li>\n</ul>\n<h4 id=\"471-ç»Ÿä¸€é…ç½®ç®¡ç†\"><a class=\"anchor\" href=\"#471-ç»Ÿä¸€é…ç½®ç®¡ç†\">#</a> 4.7.1ã€ç»Ÿä¸€é…ç½®ç®¡ç†ğŸŒ²</h4>\n<p>ä¸Šé¢å­¦ä¹ æˆ‘ä»¬æ­å»ºäº†ä¸¤ä¸ªå¾®æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡é‡Œé¢çš„ä¸šåŠ¡éƒ½éœ€è¦å®Œæˆæ•°æ®åº“çš„æŸ¥è¯¢ï¼Œå¹¶ä¸”æœåŠ¡ä¹‹é—´è¿˜ä¼šæœ‰ä¸€ä¸ªç›¸äº’è°ƒç”¨ã€‚è€Œå®Œæˆç›¸äº’è°ƒç”¨æˆ‘ä»¬çš„åšæ³•æ˜¯è®©æœåŠ¡æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼Œç„¶åæ¶ˆè´¹è€…å°±å¯ä»¥ä»æ³¨å†Œä¸­å¿ƒå®ŒæˆæœåŠ¡çš„å‘ç°ï¼Œå®ç°æœåŠ¡è·å–å’Œè´Ÿè½½å‡è¡¡ã€‚å®Œæˆè¿œç¨‹è°ƒç”¨</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310060840065.png\" alt=\"image-20231006084042876\" /></p>\n<p>é‚£ä¹ˆéšç€æˆ‘ä»¬å¾®æœåŠ¡è¶Šæ¥è¶Šå¤šï¼Œæˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½ä¼šè¾¾åˆ°æ•°åä¸Šç™¾ç”šè‡³ä¸Šåƒå°æœåŠ¡å™¨çš„æƒ…å†µï¼Œè¿™æ—¶å°±æœ‰ä¸€ä¸ªé—®é¢˜ã€‚</p>\n<p>&lt;font color='red'&gt;<strong> é—®é¢˜ä¸€</strong> &lt;/font&gt;ï¼šå¦‚æœæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸ªé…ç½®æ–‡ä»¶è€Œè¿™ä¸ªé…ç½®æ–‡ä»¶å¯èƒ½è·Ÿæˆ‘æ•°åä¸Šç™¾ä¸ªå¾®æœåŠ¡éƒ½æœ‰å…³ç³»ï¼Œé‚£è¿™ä¸ªæ—¶å€™æˆ‘æ˜¯ä¸æ˜¯è¦é€ä¸ªå¾®æœåŠ¡å»è°ƒæ•´é…ç½®å‘¢ï¼Ÿ</p>\n<p>è¿™æ ·å¾ˆéº»çƒ¦ã€‚</p>\n<p>&lt;font color='red'&gt;<strong> é—®é¢˜äºŒ</strong> &lt;/font&gt;ï¼šä¿®æ”¹é…ç½®åè¿™äº›å…³è”çš„æœåŠ¡æ˜¯ä¸æ˜¯éƒ½éœ€è¦é‡å¯å•Š</p>\n<p>æ‰€ä»¥æˆ‘ä»¬çš„éœ€æ±‚å°±æ˜¯å¯ä»¥å°†é…ç½®æ–‡ä»¶è¿›è¡Œ<mark>ç»Ÿä¸€çš„ç®¡ç†</mark>.</p>\n<p><strong>ç»Ÿä¸€ç®¡ç†</strong>ï¼šæˆ‘ä¸éœ€è¦ä¿®æ”¹æ•°åä¸Šç™¾ä¸ªå¾®æœåŠ¡çš„é…ç½®æ–‡ä»¶è€Œæ˜¯åªéœ€è¦ä¿®æ”¹ä¸€ä¸ªåœ°æ–¹çš„é…ç½®æ–‡ä»¶å°±å¯ä»¥äº†ã€‚</p>\n<ul>\n<li>\n<p><strong>é…ç½®æ›´æ”¹çƒ­æ›´æ–°</strong>.</p>\n<p>å¸Œæœ›é…ç½®æ›´æ”¹åä¸éœ€è¦é‡å¯ï¼Œè€Œå¯ä»¥ç«‹é©¬ç”Ÿæ•ˆè¿™å°±æ˜¯ <mark>é…ç½®æ›´æ”¹çƒ­æ›´æ–°</mark>.</p>\n</li>\n</ul>\n<p>è€Œè¦å®ç° â€œé…ç½®æ›´æ”¹çƒ­æ›´æ–°â€ æˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ª â€œé…ç½®ç®¡ç†æœåŠ¡â€</p>\n<blockquote>\n<p><strong>é…ç½®ç®¡ç†æœåŠ¡çš„ä½œç”¨</strong>ï¼š</p>\n<p>ä¼šå»è®°å½•å¾®æœåŠ¡ä¸­çš„ä¸€äº›æ ¸å¿ƒçš„é…ç½®ï¼Œé‚£ä¹ˆå¾®æœåŠ¡å¯åŠ¨çš„æ—¶å€™å°±å¯ä»¥å»è¯»å– <mark>é…ç½®ç®¡ç†æœåŠ¡</mark> ä¸­çš„é…ç½®å†å’Œæœ¬åœ°çš„é…ç½®ç»“åˆä½œä¸ºå®Œæ•´é…ç½®å»ä½¿ç”¨äº†ã€‚å°†æ¥å¦‚æœé…ç½®è¦å‘ç”Ÿä¿®æ”¹æˆ‘ä»¬ä¸éœ€è¦é€ä¸ªæœåŠ¡ä¿®æ”¹ï¼Œè€Œæ˜¯æ‰¾åˆ° <mark>é…ç½®ç®¡ç†æœåŠ¡</mark> åœ¨å®ƒä¸Šé¢æŠŠéœ€è¦ä¿®æ”¹çš„é…ç½®ä¿®æ”¹ä¸€ä¸‹ï¼Œ<mark>é…ç½®ç®¡ç†æœåŠ¡</mark> å‘ç°é…ç½®ä¿®æ”¹äº†ä»¥åå®ƒä¼šç«‹å³<mark>é€šçŸ¥å¾®æœåŠ¡</mark>ï¼Œå¾®æœåŠ¡å†å»è¯»å– <mark>é…ç½®ç®¡ç†æœåŠ¡</mark> ä¸­ä¿®æ”¹åçš„é…ç½®æ–‡ä»¶å¹¶ä¸”ä¸ç”¨é‡å¯è¿›è¡Œçƒ­æ›´æ–°ç”Ÿæ•ˆ</p>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310060900914.png\" alt=\"image-20231006090015625\" /></p>\n<p>æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ nacos çš„é…ç½®ç®¡ç†ï¼Œè€Œæˆ‘ä»¬çŸ¥é“ nacos å·²ç»æœ‰æ³¨å†Œä¸­å¿ƒåŠŸèƒ½äº†ã€‚æ‰€ä»¥æˆ‘ä»¬é…ç½®ä¸­å¿ƒä¹Ÿå¥½ï¼Œæ³¨å†Œä¸­å¿ƒä¹Ÿå¥½ï¼ŒåŒæ—¶éƒ½æ˜¯ç”± nacos å»å®ç°çš„ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310060902958.png\" alt=\"image-20231006090222743\" /></p>\n<p>1ã€åœ¨ Nacos ä¸­æ·»åŠ é…ç½®ä¿¡æ¯ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310060916710.png\" alt=\"image-20231006091626481\" /></p>\n<p>2ã€åœ¨å¼¹å‡ºè¡¨å•ä¸­å¡«å†™é…ç½®ä¿¡æ¯ï¼š</p>\n<p>&lt;font color='red'&gt; æ³¨æ„é¡¹ &lt;/font&gt;ï¼š</p>\n<ol>\n<li>DataIdï¼šéœ€è¦å…·å¤‡å”¯ä¸€æ€§</li>\n<li>é…ç½®å†…å®¹ï¼šåªéœ€è¦é…ç½®æœ‰çƒ­æ›´æ–°éœ€æ±‚çš„å†…å®¹è€Œä¸æ˜¯å°†æœåŠ¡ä¸­é…ç½®æ–‡ä»¶çš„å†…å®¹å…¨æ‹·è´è¿›å»</li>\n</ol>\n<p>å¡«å†™å®Œæ¯•åï¼Œç‚¹å‡»å‘å¸ƒ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061049488.png\" alt=\"image-20231006104947319\" /></p>\n<p>3ã€å‘å¸ƒå®Œæˆåè¿”å›æŸ¥çœ‹</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310060915386.png\" alt=\"image-20231006091517632\" /></p>\n<p>å…ˆçœ‹å¦‚ä¸‹å›¾ æ²¡æœ‰ Nacos æ—¶æœåŠ¡å¦‚ä½•è·å–é…ç½®ï¼Œé…ç½®è·å–çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310060921217.png\" alt=\"image-20231006092110607\" /></p>\n<p>ä¸Šé¢æµç¨‹ä¸­è¯»å–çš„æ˜¯æœ¬åœ°çš„é…ç½®æ–‡ä»¶ï¼Œä½†ç°åœ¨æˆ‘ä»¬å¤šäº†ä¸€ä¸ªä¸œè¥¿å°±æ˜¯ nacos ä¸­çš„é…ç½®æ–‡ä»¶ã€‚</p>\n<p>å°†æ¥æˆ‘ä»¬çš„é¡¹ç›®ä¼šæŠŠ nacos çš„é…ç½®ä¸æœ¬åœ°é…ç½®åšä¸€ä¸ªåˆå¹¶è€Œåå†å»å®Œæˆåç»­çš„å®¹å™¨åˆ›å»º bean çš„åˆ›å»ºåŠ¨ä½œã€‚</p>\n<p>æ‰€ä»¥ nacos è¯»å–è¦åŠ å…¥åˆ°ä¸Šé¢æµç¨‹å½“ä¸­é‚£ä¹ˆå°±ä¼šå˜æˆå¦‚ä¸‹çš„æ­¥éª¤ï¼š</p>\n<p>é¡¹ç›®å¯åŠ¨å…ˆè¯»å– nacos é…ç½®æ–‡ä»¶å†å»è¯»å–æœ¬åœ°é…ç½®æ–‡ä»¶ä¸¤è€…åˆå¹¶æœ€ååˆ›å»º bean</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310060925392.png\" alt=\"image-20231006092504157\" /></p>\n<p>&lt;font color='red'&gt; é—®é¢˜ &lt;/font&gt;ï¼š</p>\n<ul>\n<li><strong>ç¬¬ä¸€</strong>ï¼šå»å“ªè¯»å–</li>\n<li><strong>ç¬¬äºŒ</strong>ï¼šè¯»å–è°</li>\n</ul>\n<p>æˆ‘ä»¬è¯»å– nacos é…ç½®æ–‡ä»¶æ—¶éœ€è¦æå‰çŸ¥é“ nacos çš„åœ°å€ï¼Œé‚£ä¹ˆéœ€è¦ä¸€ä¸ªå¯åŠ¨ä¼˜å…ˆçº§é«˜äº application.yml çš„ä¸œè¥¿æ¥å­˜å‚¨ nacos åœ°å€ã€‚</p>\n<p>æ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ â€œbootstrap.ymlâ€ é…ç½®æ–‡ä»¶ï¼Œè¿™æ˜¯ SpringBoot ä¸­æä¾›çš„ã€‚è¿™ä¸ªæ–‡ä»¶çš„ä¼˜å…ˆçº§é«˜äº application.yml</p>\n<p>å½“é¡¹ç›®å¯åŠ¨ä¼˜å…ˆè¯»å– â€œbootstrap.ymlâ€ é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬åªè¦æŠŠ nacos åœ°å€ï¼Œæ–‡ä»¶ç›¸å…³ä¿¡æ¯éƒ½é…ç½®è¿›å»é‚£ä¹ˆå®ƒå°±å¯ä»¥å®Œæˆ nacos é…ç½®çš„è¯»å–äº†ã€‚è€Œåå†è·Ÿæœ¬åœ°ç»“åˆå®Œæˆåç»­åŠ¨ä½œ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310060930844.png\" alt=\"image-20231006093027358\" /></p>\n<p><strong>é‚£ä¹ˆå°±éœ€è¦æ³¨æ„äº†</strong>ï¼š</p>\n<ul>\n<li><mark>ä¸ nacos åœ°å€å’Œé…ç½®æ–‡ä»¶æœ‰å…³çš„æ‰€æœ‰ä¿¡æ¯éƒ½åº”è¯¥æ”¾åˆ° â€œbootstrap.ymlâ€ å½“ä¸­</mark>ã€‚</li>\n</ul>\n<h4 id=\"472-æ“ä½œæ­¥éª¤\"><a class=\"anchor\" href=\"#472-æ“ä½œæ­¥éª¤\">#</a> 4.7.2ã€æ“ä½œæ­¥éª¤ï¼šğŸŒ²</h4>\n<p>1ã€å¼•å…¥ Nacos çš„é…ç½®ç®¡ç†å®¢æˆ·ç«¯ä¾èµ–ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--nacos é…ç½®ç®¡ç†ä¾èµ– --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-alibaba-nacos-config<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>2ã€åœ¨ userservice ä¸­çš„ resource ç›®å½•æ·»åŠ ä¸€ä¸ª &lt;font color='red'&gt;bootstrap.yml&lt;/font &gt; æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯å¼•å¯¼æ–‡ä»¶ï¼Œä¼˜å…ˆçº§é«˜äº application.yml</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> userservice <span class=\"token comment\"># æœåŠ¡åç§°</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">profiles</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">active</span><span class=\"token punctuation\">:</span> dev <span class=\"token comment\"># ç¯å¢ƒ</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span> <span class=\"token comment\"># nacos åœ°å€</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token key atrule\">file-extension</span><span class=\"token punctuation\">:</span> yaml <span class=\"token comment\"># é…ç½®æ–‡ä»¶åç¼€å</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># ä¸‰è¦ç´ ï¼šæœåŠ¡åç§°ï¼Œç¯å¢ƒï¼Œåç¼€å è€Œè¿™ä¸‰ä¸ªå†³å®šäº† DateId</span></pre></td></tr></table></figure><p>å¤šç¯å¢ƒé…ç½®å’Œå…±äº«é…ç½® ä¸åœ¨æœ¬æ¡ˆä¾‹èŒƒå›´ä¸­ï¼Œåªæ˜¯æ¼”ç¤ºå¯ä»¥è¿™æ ·åš</p>\n<p>å¤šç¯å¢ƒé…ç½®ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> content<span class=\"token punctuation\">-</span>service</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span> <span class=\"token comment\"># nacos åœ°å€</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> dev <span class=\"token comment\"># å‘½åç©ºé—´</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> xuecheng<span class=\"token punctuation\">-</span>plus<span class=\"token punctuation\">-</span>project <span class=\"token comment\"># ç»„åç§°</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token key atrule\">file-extension</span><span class=\"token punctuation\">:</span> yaml <span class=\"token comment\"># æ–‡ä»¶åç¼€</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token key atrule\">refresh-enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\"># æ˜¯å¦å¼€å¯è‡ªåŠ¨åˆ·æ–°å€¼</span></pre></td></tr></table></figure><p>å…±äº«é…ç½® / æ‰©å±•é…ç½®</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> content<span class=\"token punctuation\">-</span>api <span class=\"token comment\"># æœåŠ¡å</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> 192.168.249.128<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">discovery</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> dev</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> xuecheng<span class=\"token punctuation\">-</span>plus<span class=\"token punctuation\">-</span>project</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># é…ç½®æ–‡ä»¶ç›¸å…³ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> dev</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> xuecheng<span class=\"token punctuation\">-</span>plus<span class=\"token punctuation\">-</span>project</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token key atrule\">file-extension</span><span class=\"token punctuation\">:</span> yaml</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token key atrule\">refresh-enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\"># å…±äº«é…ç½® / æ‰©å±•é…ç½®</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token key atrule\">extension-configs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">data-id</span><span class=\"token punctuation\">:</span> content<span class=\"token punctuation\">-</span>service<span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">&#123;</span>spring.profiles.active<span class=\"token punctuation\">&#125;</span>.yaml</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> xuecheng<span class=\"token punctuation\">-</span>plus<span class=\"token punctuation\">-</span>project</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token key atrule\">refresh</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token key atrule\">profiles</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token key atrule\">active</span><span class=\"token punctuation\">:</span> dev <span class=\"token comment\">#ç¯å¢ƒå</span></pre></td></tr></table></figure><p>3ã€æˆ‘ä»¬åœ¨ user-service ä¸­å°† pattern.dateformat è¿™ä¸ªå±æ€§æ³¨å…¥åˆ° UserController ä¸­åšæµ‹è¯•ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// æ³¨å…¥ nacos ä¸­çš„é…ç½®å±æ€§</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;pattern.dateformat&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> dateformat<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// ç¼–å†™ controllerï¼Œé€šè¿‡æ—¥æœŸæ ¼å¼åŒ–å™¨æ¥æ ¼å¼åŒ–ç°åœ¨æ—¶é—´å¹¶è¿”å›</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"now\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dateFormat = \"</span><span class=\"token operator\">+</span>dateformat<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">LocalDateTime</span><span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DateTimeFormatter</span><span class=\"token punctuation\">.</span><span class=\"token function\">ofPattern</span><span class=\"token punctuation\">(</span>dateformat<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>4ã€è¯·æ±‚æ¥å£æŸ¥çœ‹ç»“æœ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061054265.png\" alt=\"image-20231006105444087\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061056279.png\" alt=\"image-20231006105458931\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>å°†é…ç½®äº¤ç»™ nacos ç®¡ç†çš„æ­¥éª¤</p>\n<ol>\n<li>åœ¨ nacos ä¸­æ·»åŠ é…ç½®æ–‡ä»¶</li>\n<li>åœ¨å¾®æœåŠ¡ä¸­å¼•å…¥ nacos çš„ config ä¾èµ–</li>\n<li>åœ¨å¾®æœåŠ¡ä¸­æ·»åŠ  bootstrap.ymlï¼Œé…ç½® nacos åœ°å€ï¼Œå½“å‰ç¯å¢ƒï¼ŒæœåŠ¡åç§°ï¼Œæ–‡ä»¶åç¼€åã€‚è¿™äº›å†³å®šäº†ç¨‹åºå¯åŠ¨æ—¶å» nacos è¯»å–å“ªä¸ªæ–‡ä»¶ï¼Œå†™é”™ä¸€ä¸ªå°±ä¼šæŠ¥é”™ï¼</li>\n</ol>\n</blockquote>\n<h4 id=\"473-é…ç½®è‡ªåŠ¨åˆ·æ–°\"><a class=\"anchor\" href=\"#473-é…ç½®è‡ªåŠ¨åˆ·æ–°\">#</a> 4.7.3ã€é…ç½®è‡ªåŠ¨åˆ·æ–°ğŸŒ²</h4>\n<p>æˆ‘ä»¬æ”¹ä¸€ä¸‹ nacos ä¸­é…ç½®æ–‡ä»¶çš„ä¿¡æ¯ï¼Œç‚¹å‡»ç¼–è¾‘è¿›è¡Œä¿®æ”¹æŒ‡å®šçš„ nacos é…ç½®æ–‡ä»¶ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061058197.png\" alt=\"image-20231006105819948\" /></p>\n<p>åŸæ¥çš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061057556.png\" alt=\"image-20231006105744125\" /></p>\n<p>ä¿®æ”¹åçš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061059763.png\" alt=\"image-20231006105913419\" /></p>\n<p>ä¿®æ”¹å®Œç‚¹å‡»å‘å¸ƒï¼Œç„¶åå†å»è¯·æ±‚è·å–æ—¥æœŸæ ¼å¼åŒ–çš„æ¥å£</p>\n<p>å¯ä»¥çœ‹åˆ°æ²¡æœ‰å˜åŒ–</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061100940.png\" alt=\"image-20231006110004691\" /></p>\n<p>è¦æƒ³å®ç°é…ç½®çš„è‡ªåŠ¨æ›´æ–°æˆ‘ä»¬éœ€è¦å¦‚ä¸‹æ“ä½œï¼š</p>\n<p>Nacos ä¸­çš„é…ç½®æ–‡ä»¶å˜æ›´åï¼Œå¾®æœåŠ¡æ— éœ€é‡å¯å°±å¯ä»¥æ„ŸçŸ¥ã€‚ä¸è¿‡éœ€è¦é€šè¿‡ä¸‹é¢ä¸¤ç§é…ç½®å®ç°ï¼š</p>\n<h5 id=\"474-refreshscope\"><a class=\"anchor\" href=\"#474-refreshscope\">#</a> 4.7.4ã€@RefreshScopeğŸŒ´</h5>\n<ul>\n<li>æ–¹å¼ä¸€ï¼šåœ¨ @Value æ³¨å…¥çš„å˜é‡æ‰€åœ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @RefreshScope</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061103130.png\" alt=\"image-20231006110317505\" /></p>\n<p>åŠ ä¸Šæ³¨è§£åé‡å¯æœåŠ¡ï¼Œå› ä¸ºä¸Šæ¬¡çš„æ›´æ”¹æ²¡æœ‰ç”Ÿæ•ˆè¿™é‡Œåˆå°† nacos é…ç½®æ–‡ä»¶çš„ä¿¡æ¯æ”¹ä¸ºåŸæ¥çš„äº†ã€‚å†æ¬¡è¿›è¡Œä¿®æ”¹æµ‹è¯•</p>\n<p>ä¿®æ”¹å‰</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061106769.png\" alt=\"image-20231006110621029\" /></p>\n<p>ä¿®æ”¹å</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061107482.png\" alt=\"image-20231006110720366\" /></p>\n<p>åœ¨æ²¡æœ‰é‡å¯æœåŠ¡çš„æƒ…å†µä¸‹åˆ·æ–°ä¸¤ä¸‹ä» nacos é…ç½®æ–‡ä»¶ä¸­è·å–çš„æ ¼å¼åŒ–æ—¥æœŸå°±å‘ç”Ÿäº†æ”¹å˜ï¼Œè¯´æ˜çƒ­æ›´æ–°ç”Ÿæ•ˆäº†ã€‚</p>\n<h5 id=\"475-configurationproperties\"><a class=\"anchor\" href=\"#475-configurationproperties\">#</a> 4.7.5ã€@ConfigurationPropertiesğŸŒ´</h5>\n<ul>\n<li>æ–¹å¼äºŒï¼šä½¿ç”¨ @ConfigurationProperties æ³¨è§£</li>\n</ul>\n<p>é€šè¿‡ @ConfigurationProperties æ³¨è§£è¯»å–ä¸€ä¸ªå‰ç¼€ä¸º pattern çš„é…ç½®ä¿¡æ¯ (çº¦å®šå¤§äºé…ç½®)</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061113170.png\" alt=\"image-20231006111308948\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061120271.png\" alt=\"image-20231006112043132\" /></p>\n<p>é‡å¯æœåŠ¡ï¼Œæµ‹è¯•ç»“æœ</p>\n<p>ä¿®æ”¹å‰</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061122192.png\" alt=\"image-20231006112226998\" /></p>\n<p>ä¿®æ”¹å</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061123665.png\" alt=\"image-20231006112303423\" /></p>\n<p>åˆ·æ–°é¡µé¢</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061123281.png\" alt=\"image-20231006112317230\" /></p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>Nacos é…ç½®æ›´æ”¹åï¼Œå¾®æœåŠ¡å¯ä»¥å®ç°çƒ­æ›´æ–°ï¼Œæ–¹å¼ï¼š</p>\n<ol>\n<li>é€šè¿‡ @Value æ³¨è§£æ³¨å…¥ï¼Œç»“åˆ @RefreshScope æ¥åˆ·æ–°</li>\n<li>é€šè¿‡ @ConfigurationProperties æ³¨å…¥ï¼Œè‡ªåŠ¨åˆ·æ–° (å»ºè®®ä½¿ç”¨ï¼Œå› ä¸ºæ–¹ä¾¿)</li>\n</ol>\n<p>&lt;font color='red'&gt;<strong> æ³¨æ„äº‹é¡¹</strong> &lt;/font&gt;ï¼š</p>\n<ul>\n<li>ä¸æ˜¯æ‰€æœ‰çš„é…ç½®éƒ½é€‚åˆæ”¾åˆ°é…ç½®ä¸­å¿ƒï¼Œç»´æŠ¤èµ·æ¥æ¯”è¾ƒéº»çƒ¦</li>\n<li>å»ºè®®å°†ä¸€äº›å…³é”®å‚æ•°ï¼Œéœ€è¦è¿è¡Œæ—¶è°ƒæ•´çš„å‚æ•°æ”¾åˆ° nacos é…ç½®ä¸­å¿ƒï¼Œä¸€èˆ¬éƒ½æ˜¯è‡ªå®šä¹‰é…ç½®</li>\n</ul>\n</blockquote>\n<h4 id=\"474-å¤šç¯å¢ƒé…ç½®å…±äº«\"><a class=\"anchor\" href=\"#474-å¤šç¯å¢ƒé…ç½®å…±äº«\">#</a> 4.7.4ã€å¤šç¯å¢ƒé…ç½®å…±äº«ğŸŒ²</h4>\n<blockquote>\n<p>åœºæ™¯ï¼š</p>\n<p>æœ‰ä¸€ä¸ªé…ç½®å±æ€§ï¼Œå®ƒåœ¨å¼€å‘ï¼Œç”Ÿäº§å’Œæµ‹è¯•ç­‰ç¯å¢ƒä¸‹çš„å€¼éƒ½æ˜¯ä¸€æ ·çš„ï¼Œé‚£åƒè¿™æ ·çš„é…ç½®æˆ‘åœ¨æ¯ä¸ªé…ç½®æ–‡ä»¶é‡Œéƒ½å†™ä¸€ä»½ã€‚æ˜¯ä¸æ˜¯æœ‰ç‚¹æµªè´¹å‘€ï¼Œè€Œä¸”å°†æ¥å¦‚æœè¦æ”¹åŠ¨æˆ‘è¿˜å¾—åœ¨æ¯ä¸ªé…ç½®æ–‡ä»¶éƒ½å»æ”¹è¿™æ ·å¾ˆéº»çƒ¦ã€‚æˆ‘ä»¬æƒ³æ‰¾ä¸€ä¸ªåœ°æ–¹æˆ‘é…ç½®ä¸€æ¬¡ä»¥åä¸ç®¡ç¯å¢ƒæ€ä¹ˆå˜è¿™ä¸ªé…ç½®éƒ½èƒ½å¤Ÿè¢«åŠ è½½ã€‚é‚£è¿™å°±æ˜¯å¤šç¯å¢ƒå…±äº«çš„éœ€æ±‚äº†ï¼</p>\n</blockquote>\n<p>å¾®æœåŠ¡å¯åŠ¨æ—¶ä¼šä» nacos è¯»å–å¤šä¸ªé…ç½®æ–‡ä»¶ï¼š</p>\n<p>ç¬¬ä¸€ä¸ªï¼šå®ƒçš„æ„æˆæœ‰ä¸‰éƒ¨åˆ†</p>\n<ol>\n<li>æœåŠ¡åç§°</li>\n<li>ç¯å¢ƒ</li>\n<li>åç¼€å</li>\n</ol>\n<ul>\n<li>[<span class=\"exturl\" data-url=\"aHR0cDovL3NwcmluZy5hcHBsaWNhdGlvbi5uYW1l\">spring.application.name</span>]-[spring.profiles.active].yamlï¼Œä¾‹å¦‚ï¼šuserservice-dev.yaml</li>\n</ul>\n<p>ç¬¬äºŒä¸ªï¼šå®ƒçš„æ„æˆæœ‰äºŒéƒ¨åˆ†ï¼Œè·Ÿç¯å¢ƒæ²¡æœ‰å…³ç³»</p>\n<ol>\n<li>æœåŠ¡åç§°</li>\n<li>åç¼€å</li>\n</ol>\n<ul>\n<li>[<span class=\"exturl\" data-url=\"aHR0cDovL3NwcmluZy5hcHBsaWNhdGlvbi5uYW1l\">spring.application.name</span>].yamlï¼Œä¾‹å¦‚ï¼šuserservice.yaml</li>\n</ul>\n<p>æ— è®º profile å¦‚ä½•å˜åŒ–ï¼Œ[<span class=\"exturl\" data-url=\"aHR0cDovL3NwcmluZy5hcHBsaWNhdGlvbi5uYW1l\">spring.application.name</span>].yaml è¿™ä¸ªæ–‡ä»¶ä¸€å®šä¼šåŠ è½½ï¼Œå› æ­¤å¤šç¯å¢ƒå…±äº«é…ç½®å¯ä»¥å†™å…¥è¿™ä¸ªæ–‡ä»¶</p>\n<blockquote>\n<p>æ¯”å¦‚è¯´å¦‚ä¸‹å›¾ï¼Œæœ‰ dev.yaml å’Œ userservice.yaml å°†æ¥æœ‰æµ‹è¯•ç¯å¢ƒåœ¨å®šä¹‰ä¸€ä¸ª userservice-test.yamlã€‚ä½†æ˜¯ä¸ç®¡æ˜¯ dev è¿˜æ˜¯ userservice-testï¼Œuserservice.yaml ä¸€å®šä¼šè¢«å…±äº«</p>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061141107.png\" alt=\"image-20231006114137708\" /></p>\n<p>ç¼–å†™è·å– envSharedValue çš„ä»£ç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@ConfigurationProperties</span><span class=\"token punctuation\">(</span>prefix <span class=\"token operator\">=</span> <span class=\"token string\">\"pattern\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PatternProperties</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> dateformat<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> envSharedValue<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">PatternProperties</span> patternProperties<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"prop\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">PatternProperties</span> <span class=\"token function\">patternProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">return</span> patternProperties<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨ user-service æœåŠ¡ï¼</p>\n<p>ä½†æ˜¯éœ€è¦æ³¨æ„å½“å‰æœåŠ¡çš„ç¯å¢ƒï¼š</p>\n<p>å½“å‰å¤„äº dev å¼€å‘ç¯å¢ƒä¸‹ï¼Œæ‰€ä»¥æ—¢å¯ä»¥è®¿é—®åˆ° userservice ç¯å¢ƒä¹Ÿå¯ä»¥è®¿é—®åˆ° dev ç¯å¢ƒ</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> userservice <span class=\"token comment\"># æœåŠ¡åç§°</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">profiles</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">active</span><span class=\"token punctuation\">:</span> dev <span class=\"token comment\"># ç¯å¢ƒ</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span> <span class=\"token comment\"># nacos åœ°å€</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token key atrule\">file-extension</span><span class=\"token punctuation\">:</span> yaml <span class=\"token comment\"># é…ç½®æ–‡ä»¶åç¼€å</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># ä¸‰è¦ç´ ï¼šæœåŠ¡åç§°ï¼Œç¯å¢ƒï¼Œåç¼€å è€Œè¿™ä¸‰ä¸ªå†³å®šäº† DateId</span></pre></td></tr></table></figure><p>ç„¶åå†å¯åŠ¨ä¸€ä¸ª test ç¯å¢ƒçš„æœåŠ¡è¿™æ¬¡ä¸ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ä»£ç ï¼Œè€Œæ˜¯åœ¨ idea å¯åŠ¨å‚æ•°ä¸­è®¾ç½® ç¯å¢ƒ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061210818.png\" alt=\"image-20231006121029595\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061211188.png\" alt=\"image-20231006121106691\" /></p>\n<p>ä¸¤ä¸ªæœåŠ¡å¯åŠ¨å®Œæˆåï¼Œè¿›è¡Œè¯·æ±‚ user-service æœåŠ¡ï¼š</p>\n<p>è®¿é—®ï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzEyNy4wLjAuMTo4MDgxL3VzZXIvcHJvcA==\">http://127.0.0.1:8081/user/prop</span> è¿™æ˜¯ dev ç¯å¢ƒï¼Œå¯ä»¥çœ‹åˆ°æ˜¾ç¤ºäº† æ ¼å¼åŒ–æ—¥æœŸå’Œ envSharedValue ä¿¡æ¯</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061234508.png\" alt=\"image-20231006123404747\" /></p>\n<p>è®¿é—®ï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzEyNy4wLjAuMTo4MDgyL3VzZXIvcHJvcA==\">http://127.0.0.1:8082/user/prop</span> è¿™æ˜¯ test ç¯å¢ƒï¼Œå¯ä»¥çœ‹åˆ°ä¾ç„¶å¯ä»¥è·å–åˆ° userservice ç¯å¢ƒçš„å€¼ï¼Œè€Œ dev ç¯å¢ƒçš„æ ¼å¼åŒ–æ—¥æœŸçš„å€¼è·å–ä¸åˆ°äº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061234043.png\" alt=\"image-20231006123455577\" /></p>\n<p>åŒä¸Šæµ‹è¯•å¯ä»¥è¯æ˜ï¼Œ8081ï¼šdev ç¯å¢ƒï¼Œ8082ï¼štest ç¯å¢ƒã€‚éƒ½å‡å¯ä»¥å¾—åˆ° userserivce ç¯å¢ƒçš„å€¼</p>\n<p>è¯æ˜äº† userservice.yaml æ–‡ä»¶æ˜¯è¢«ä¸åŒç¯å¢ƒæ‰€å…±äº«çš„ã€‚</p>\n<h5 id=\"4741-æµ‹è¯•é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§\"><a class=\"anchor\" href=\"#4741-æµ‹è¯•é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§\">#</a> 4.7.4.1ã€æµ‹è¯•é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§ğŸŒ´</h5>\n<p>å‡å¦‚è¯´ userservice ä¸ dev é…ç½®æ–‡ä»¶ä¸­æœ‰ç›¸åŒçš„å±æ€§é‚£å®ƒä¼šä»¥è°çš„ä¸ºå‡†å‘¢ï¼Ÿ</p>\n<p>æµ‹è¯•ä¸€ã€åœ¨æœ¬åœ°å’Œè¿œç«¯éƒ½é…ç½®ç›¸åŒçš„å±æ€§çœ‹çœ‹ä»¥è°çš„ä¸ºå‡†</p>\n<p>åœ¨æœ¬åœ°é…ç½®æ–‡ä»¶ä¸­é…ç½®ä¸€ä¸ªå€¼</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">pattern</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> æœ¬åœ°ç¯å¢ƒlocal</pre></td></tr></table></figure><p>åœ¨ PatternProperties ç±»ä¸­ä¹ŸåŠ ä¸Šè¿™ä¸ªå±æ€§</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@ConfigurationProperties</span><span class=\"token punctuation\">(</span>prefix <span class=\"token operator\">=</span> <span class=\"token string\">\"pattern\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PatternProperties</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> dateformat<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> envSharedValue<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å†åˆ° nacos æ§åˆ¶å°ä¸­ç»™ userservice ç¯å¢ƒåŠ ä¸Šè¿™ä¸ªå±æ€§</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061245246.png\" alt=\"image-20231006124535158\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061245100.png\" alt=\"image-20231006124517976\" /></p>\n<p>é‡å¯ user-service æœåŠ¡ã€‚è¯·æ±‚ user-service çš„ urlï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzEyNy4wLjAuMTo4MDgxL3VzZXIvcHJvcA==\">http://127.0.0.1:8081/user/prop</span></p>\n<p>ç»“æœæ˜¯ userservice ç¯å¢ƒä¸­çš„å±æ€§å€¼ã€‚è¿™å°±è¯æ˜äº† æœ¬åœ°ä¸è¿œç«¯ï¼Œè¿œç«¯çš„ä¼˜å…ˆçº§é«˜ï¼</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061247510.png\" alt=\"image-20231006124719747\" /></p>\n<p>æˆ‘ä»¬å†å°† nacos æ§åˆ¶å°ä¸­çš„ dev ç¯å¢ƒä¹ŸåŠ ä¸Šè¿™ä¸ªå±æ€§</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061249639.png\" alt=\"image-20231006124900533\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061249996.png\" alt=\"image-20231006124929760\" /></p>\n<p>å†å»è¯·æ±‚ user-service çš„ urlï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzEyNy4wLjAuMTo4MDgxL3VzZXIvcHJvcA==\">http://127.0.0.1:8081/user/prop</span></p>\n<p>è¿™æ¬¡ç»“æœæ˜¯è‡ªå·±çš„ç¯å¢ƒé…ç½®çš„å±æ€§å€¼äº†</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061251197.png\" alt=\"image-20231006125141160\" /></p>\n<h5 id=\"4742-å¤šç§é…ç½®çš„ä¼˜å…ˆçº§\"><a class=\"anchor\" href=\"#4742-å¤šç§é…ç½®çš„ä¼˜å…ˆçº§\">#</a> 4.7.4.2ã€å¤šç§é…ç½®çš„ä¼˜å…ˆçº§ï¼šğŸŒ´</h5>\n<ul>\n<li>æœåŠ¡å - profile.yaml &gt; æœåŠ¡åç§°.yaml &gt; æœ¬åœ°é…ç½®</li>\n</ul>\n<p>&lt;center&gt; ä¼˜å…ˆçº§å…³ç³»å›¾ &lt;/center&gt;</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310061254076.png\" alt=\"image-20231006125407644\" /></p>\n<p>å¦‚æœæƒ³è®©æœ¬åœ°é…ç½®ä¼˜å…ˆåˆ™é…ç½®å¦‚ä¸‹å†…å®¹ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># é…ç½®æœ¬åœ°ä¼˜å…ˆ</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token key atrule\">override-none</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr></table></figure><blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>å¾®æœåŠ¡ä¼šä» nacos è¯»å–çš„é…ç½®æ–‡ä»¶ï¼š</p>\n<ol>\n<li>[æœåŠ¡å]-[spring.profile.active].yamlï¼Œç¯å¢ƒé…ç½®</li>\n<li>[æœåŠ¡å].yamlï¼Œé»˜è®¤é…ç½®ï¼Œå¤šç¯å¢ƒå…±äº«</li>\n</ol>\n<p>ä¼˜å…ˆçº§ï¼š</p>\n<ul>\n<li>[æœåŠ¡å]-[ç¯å¢ƒ].yaml &gt; [æœåŠ¡å].yaml &gt; æœ¬åœ°é…ç½®</li>\n</ul>\n</blockquote>\n<h4 id=\"475-nacosé›†ç¾¤æ­å»º\"><a class=\"anchor\" href=\"#475-nacosé›†ç¾¤æ­å»º\">#</a> 4.7.5ã€Nacos é›†ç¾¤æ­å»ºğŸŒ²</h4>\n<p>Nacos ç”Ÿäº§ç¯å¢ƒä¸‹ä¸€å®šè¦éƒ¨ç½²ä¸ºé›†ç¾¤çŠ¶æ€ï¼Œéƒ¨ç½²æ–¹å¼å‚è€ƒè¯¾å‰èµ„æ–™ä¸­çš„æ–‡æ¡£ï¼š</p>\n<blockquote>\n<p>åœ¨å‰é¢çš„å­¦ä¹ ä¸­æˆ‘ä»¬å­¦ä¹ åˆ°äº† Nacos çš„åŸºæœ¬ç”¨æ³•ï¼Œä¸è¿‡ä¹‹å‰æˆ‘ä»¬ä¸€ç›´ä½¿ç”¨çš„éƒ½æ˜¯å•ç‚¹çš„ nacosã€‚è¿™ç§æ–¹å¼æˆ‘ä»¬è‡ªå·±æµ‹è¯•çš„æ—¶å€™ç©ç©å¯è¿˜è¡Œï¼Œå¦‚æœæ˜¯åœ¨ä¼ä¸šç”Ÿäº§ç¯å¢ƒä¸‹ä¹Ÿè¿™ä¹ˆæã€‚é‚£å¯å°±è¦å‡ºå¤§é—®é¢˜äº†ã€‚</p>\n<p>å› ä¸ºåœ¨ä¼ä¸šå½“ä¸­æˆ‘ä»¬æ›´å¼ºè°ƒçš„æ˜¯é«˜å¯ç”¨æ‰€ä»¥ nacos ä¸€å®šè¦åšæˆä¸€ä¸ªé›†ç¾¤ï¼Œä¸‹é¢æˆ‘ä»¬å­¦ä¹ å¦‚ä½•æ­å»º nacos é›†ç¾¤</p>\n</blockquote>\n<p>æŸ¥çœ‹ nacos é…åˆ nginx åŸºæœ¬é›†ç¾¤æ­å»ºï¼š<a href=\"./Nacos/nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA.md\">nacos é›†ç¾¤æ­å»ºæ–‡ç« </a>.</p>\n<blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>é›†ç¾¤æ­å»ºæ­¥éª¤ï¼š</p>\n<ol>\n<li>æ­å»º MySQL é›†ç¾¤å¹¶åˆå§‹åŒ–æ•°æ®åº“è¡¨</li>\n<li>ä¸‹è½½è§£å‹ nacos</li>\n<li>ä¿®æ”¹é›†ç¾¤é…ç½® (èŠ‚ç‚¹ä¿¡æ¯)ï¼Œæ•°æ®åº“é…ç½®</li>\n<li>åˆ†åˆ«å¯åŠ¨å¤šä¸ª nacos èŠ‚ç‚¹</li>\n<li>nginx åå‘ä»£ç†</li>\n</ol>\n</blockquote>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "Nacos",
                "è®¡ç®—æœºå­¦ç§‘",
                "springcloud",
                "Nacos"
            ]
        },
        {
            "id": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/",
            "url": "https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/springcloud-Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/",
            "title": "ä¸‰ã€Ribbonè´Ÿè½½å‡è¡¡",
            "date_published": "2024-01-06T02:10:22.185Z",
            "content_html": "<h1 id=\"ä¸‰-ribbonè´Ÿè½½å‡è¡¡\"><a class=\"anchor\" href=\"#ä¸‰-ribbonè´Ÿè½½å‡è¡¡\">#</a> ä¸‰ã€Ribbon è´Ÿè½½å‡è¡¡ğŸ„</h1>\n<ul>\n<li>è´Ÿè½½å‡è¡¡åŸç†</li>\n<li>è´Ÿè½½å‡è¡¡ç­–ç•¥</li>\n<li>æ‡’åŠ è½½</li>\n</ul>\n<h3 id=\"31-è´Ÿè½½å‡è¡¡æµç¨‹\"><a class=\"anchor\" href=\"#31-è´Ÿè½½å‡è¡¡æµç¨‹\">#</a> 3.1ã€è´Ÿè½½å‡è¡¡æµç¨‹ğŸŒ³</h3>\n<p>ç›´æ¥é€šè¿‡ http:userservice/user/1 æ— æ³•è®¿é—®ã€‚å¹¶ &lt;font color='red'&gt; ä¸æ˜¯ &lt;/font &gt; ä¸€ä¸ª   &lt;font color='red'&gt; çœŸå®å¯ç”¨çš„åœ°å€ &lt;/font&gt;.</p>\n<p>å½“ order-service å‘èµ·è¯·æ±‚æ—¶ï¼Œæ˜¯æ— æ³•åˆ°è¾¾ user-service æœåŠ¡çš„ï¼Œå› æ­¤ä¸€å®šä¼šæœ‰äººå°†è¯·æ±‚æ‹¦æˆªä¸‹æ¥åšä¸€ä¸‹å¤„ç†æ‰¾åˆ°çœŸæ˜¯ ip å’Œç«¯å£æ‰è¡Œ</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310050854814.png\" alt=\"image-20231005085431639\" /></p>\n<p>order-service å‘é€è¯·æ±‚è¢« Ribbon æ‹¦æˆªå®ƒå¾—åˆ°è¯·æ±‚æŒ‡å®šçš„æ˜¯å“ªä¸ªæœåŠ¡ (userservice)ï¼Œç„¶åå°±å»æ‰¾ eureka æ‹‰å– userservice çš„æœåŠ¡åˆ—è¡¨ã€‚</p>\n<p>æ‹¿åˆ°æœåŠ¡åˆ—è¡¨åå†è¿›è¡Œè´Ÿè½½å‡è¡¡æŒ‘é€‰ä¸€ä¸ªè¿›è¡Œè¯·æ±‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310041945961.png\" alt=\"image-20231004194527737\" /></p>\n<p>å…·ä½“ Ribbon ä»€ä¹ˆæ—¶å€™æ‹¦æˆªå¤„ç†è¿™äº›è¯·æ±‚çš„å…·ä½“çœ‹æºç ï¼š</p>\n<p>åœ¨ RestTemplate çš„ Bean ä¸­æ·»åŠ çš„ @LoadBalanced æ³¨è§£å°±ä»£è¡¨å°†æ¥ RestTemplate å‘èµ·çš„è¯·æ±‚è¦è¢« Ribbon è¿›è¡Œæ‹¦æˆªå’Œå¤„ç†äº†ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@LoadBalanced</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">RestTemplate</span> <span class=\"token function\">restTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RestTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>é‚£ä¹ˆæ‹¦æˆªçš„åŠ¨ä½œæ˜¯è°æ¥å®Œæˆçš„å‘¢ï¼Ÿ</p>\n<p>æ˜¯ LoadBalancerInterceptor æ¥å®Œæˆçš„ã€‚å®ƒå®ç°äº†ä¸€ä¸ªæ¥å£ ClientHttpRequestInterceptor è¿™ä¸ªæ¥å£æ˜¯å¹²ä»€ä¹ˆå‘¢çš„ï¼Ÿ</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoadBalancerInterceptor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ClientHttpRequestInterceptor</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr></table></figure><p>ClientHttpRequestInterceptor å®ƒä¼šå»æ‹¦æˆªç”±å®¢æˆ·ç«¯å‘èµ·çš„ http è¯·æ±‚ï¼Œè€Œ RestTemplate ä¸æ­£æ˜¯ä¸€ä¸ªå‘ http è¯·æ±‚çš„å®¢æˆ·ç«¯å—ï¼Œæ‰€ä»¥å°±ä¼šè¢«è¿™ä¸ªæ‹¦æˆªå™¨æ‰€æ‹¦æˆª</p>\n<p>ClientHttpRequestInterceptor è¿™ä¸ªæ¥å£ä¸­å®šä¹‰çš„ä¸€ä¸ªæ–¹æ³•ä¸ºï¼šintercept</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">ClientHttpResponse</span> <span class=\"token function\">intercept</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> body<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ClientHttpRequestExecution</span> execution<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬å›åˆ°å®ƒçš„å®ç°ç±» LoadBalancerInterceptor è¿™ä¸ªæ‹¦æˆªå™¨æ—¢ç„¶å®ç°äº† ClientHttpRequestInterceptor æ¥å£å°±ä¸€å®šä¼šå®ç° intercept æ–¹æ³•</p>\n<p>æˆ‘ä»¬åœ¨é‡å†™æ–¹æ³•å¤„æ‰“ä¸Šæ–­ç‚¹ * è¡¨ç¤ºæ–­ç‚¹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">ClientHttpResponse</span> <span class=\"token function\">intercept</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">HttpRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> body<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ClientHttpRequestExecution</span> execution<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">*</span>   <span class=\"token class-name\">URI</span> originalUri <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getURI</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">String</span> serviceName <span class=\"token operator\">=</span> originalUri<span class=\"token punctuation\">.</span><span class=\"token function\">getHost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">Assert</span><span class=\"token punctuation\">.</span><span class=\"token function\">state</span><span class=\"token punctuation\">(</span>serviceName <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Request URI does not contain a valid hostname: \"</span> <span class=\"token operator\">+</span> originalUri<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ClientHttpResponse</span><span class=\"token punctuation\">)</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>loadBalancer<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>serviceName<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>requestFactory<span class=\"token punctuation\">.</span><span class=\"token function\">createRequest</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">,</span> execution<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥è®¤ä¸ºç”± RestTemplate å‘èµ·çš„è¯·æ±‚å°±ä¸€å®šä¼šè¢« intercept æ‹¦æˆª</p>\n<p>å¼€å¯ debug è®¿é—® urlï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzEyNy4wLjAuMTo4MDgwL29yZGVyLzEwMQ==\">http://127.0.0.1:8080/order/101</span></p>\n<p>å°±ä¼šæ‰§è¡Œåˆ°æ–­ç‚¹å¤„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310050930000.png\" alt=\"image-20231005093021344\" /></p>\n<p>è¯æ˜è¿™ä¸ªè¯·æ±‚ç¡®å®è¢«æ‹¦æˆªäº†ï¼Œè·å–è¯·æ±‚åœ°å€æ‹¿åˆ°çš„æ˜¯ http://userservice/user/1 è¿™ä¸å°±æ˜¯å“ªä¸ªæ— æ³•ç›´æ¥è®¿é—®çš„åœ°å€å—</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310050932340.png\" alt=\"image-20231005093231384\" /></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">ClientHttpResponse</span> <span class=\"token function\">intercept</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">HttpRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> body<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ClientHttpRequestExecution</span> execution<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token comment\">// è·å–è¯·æ±‚åœ°å€</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token class-name\">URI</span> originalUri <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getURI</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// http://userservice/user/1</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// è·å–ä¸»æœºå (ä¸æ˜¯æŒ‡æœ¬åœ°ä¸»æœºå) url ä¸­çš„ä¸»æœºåä¹Ÿå°±æ˜¯æœåŠ¡åç§°</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token comment\">// æ‹¿åˆ°æœåŠ¡åç§°åæ‰¾ eureka æ‹‰å–æœåŠ¡åˆ—è¡¨ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token class-name\">String</span> serviceName <span class=\"token operator\">=</span> originalUri<span class=\"token punctuation\">.</span><span class=\"token function\">getHost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// serviceName: userservice</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token comment\">// å¾—åˆ°æœåŠ¡åç§°åæ€ä¹ˆå®Œæˆæ‹‰å–çš„å‘¢</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token class-name\">Assert</span><span class=\"token punctuation\">.</span><span class=\"token function\">state</span><span class=\"token punctuation\">(</span>serviceName <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Request URI does not contain a valid hostname: \"</span> <span class=\"token operator\">+</span> originalUri<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\">// Ribbon çš„è´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯å»æ‰§è¡Œ</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>loadBalancer<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>serviceName<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>requestFactory<span class=\"token punctuation\">.</span><span class=\"token function\">createRequest</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">,</span> execution<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿›å…¥ execute æ–¹æ³•ï¼Œæ‰§è¡Œ getLoadBalancer å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åä¸ºï¼šDynamicServerListLoadBalancer å°±æ˜¯åŠ¨æ€æœåŠ¡åˆ—è¡¨è´Ÿè½½å‡è¡¡å™¨</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310050945434.png\" alt=\"image-20231005094542640\" /></p>\n<p>åœ¨æœåŠ¡åˆ—è¡¨ä¸­å¯ä»¥çœ‹åˆ° 8081ï¼Œ8082 æˆåŠŸçš„è¢«æ‹‰å–åˆ°äº†å·²ç»ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310050947059.png\" alt=\"image-20231005094741094\" /></p>\n<p>æ‰€ä»¥ getLoadBalancer è¿™ä¸ªæ–¹æ³•å°±æ˜¯åœ¨æ ¹æ®æœåŠ¡åç§°æ‰¾ eureka æ‹‰å–æœåŠ¡åˆ—è¡¨ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯è´Ÿè½½å‡è¡¡äº†</p>\n<p>è¿›å…¥ getServer çœ‹çœ‹æ˜¯æ€ä¹ˆåšçš„</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310050949067.png\" alt=\"image-20231005094951601\" /></p>\n<p>rule (è§„åˆ™) åœ¨ DynamicServerListLoadBalancer ä¸­é€‰æ‹©ä¸€ä¸ªé‚£ä¹ˆé€‰æ‹©æ—¶æ˜¯æœ‰ä¸€ç§è§„åˆ™æ¥é€‰çš„é‚£ä¹ˆè¿™ä¸ª rule æ˜¯ä¸ªä»€ä¹ˆç±»å‹å¯¹è±¡å‘¢</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310050953275.png\" alt=\"image-20231005095131490\" /></p>\n<p>å«åš IRule (I å°±æ˜¯æ¥å£çš„æ„æ€ Rule å°±æ˜¯è§„åˆ™çš„æ„æ€) é‚£ä¹ˆå°±æ˜¯ä¸€ä¸ªè§„åˆ™çš„æ¥å£çš„æ„æ€ï¼Œé‚£å®ƒä¸€å®šä¼šæœ‰å®ç°ç±»é€šè¿‡ ctrl+h æŸ¥çœ‹å®ç°ç±»</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310050953846.png\" alt=\"image-20231005095318356\" /></p>\n<p>å®ƒçš„å®ç°ç±»éƒ½æœ‰ä»¥ä¸‹å‡ ä¸ª</p>\n<p>RandomRuleï¼šéšæœºè§„åˆ™</p>\n<p>RoundRobinRuleï¼šè½®è¯¢è°ƒåº¦</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310050955516.png\" alt=\"image-20231005095544615\" /></p>\n<p>è€Œå®ƒé»˜è®¤çš„è´Ÿè½½å‡è¡¡è§„åˆ™ï¼šZoneAvoidanceRule</p>\n<p>é‚£ä¹ˆçœ‹åˆ°è¿™é‡Œæˆ‘ä»¬å°±æ¸…æ¥šäº†è´Ÿè½½å‡è¡¡çš„ç­–ç•¥æ˜¯ç”± IRule æ¥å£æ¥å†³å®šçš„</p>\n<p>ç„¶åè¿›è¡Œè¿”å› getServer æ‹¿åˆ°ä¸€ä¸ªæœåŠ¡ä¸º 8081ï¼Œæ‹¿åˆ°æœåŠ¡ä¿¡æ¯äº†å°±å¯ä»¥ç”¨çœŸæ˜¯çš„ ipï¼Œç«¯å£æ¥æ›¿ä»£åŸæ¥çš„ http://userservice/user/1 æœåŠ¡åç§°ã€‚å»å‘é€çœŸå®çš„è¯·æ±‚äº†ã€‚</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310051001998.png\" alt=\"image-20231005095838892\" /></p>\n<p><strong>æ€»ç»“ä¸€ä¸‹</strong>ï¼š</p>\n<p>å½“è¯·æ±‚è¿›å…¥ Ribbon åä¼šæ€ä¹ˆå»å¤„ç†å‘¢ï¼Œè¯·æ±‚ä¼šè¢«ä¸€ä¸ªæ‹¦æˆªå™¨ æ‹¦æˆªåä¸ºï¼šLoadBalancerInterceptor æ‹¦æˆªåä¼šå¾—åˆ°è¯·æ±‚çš„æœåŠ¡åç§° userservice ç„¶åå°†æœåŠ¡åç§°äº¤ç»™ RibbonLoadBalancerClient å®ƒå†å°†æœåŠ¡äº¤ç»™ DynamicServerListLoadBalancer å®ƒä¼šå» eureka ä¸­æ‹‰å–æœåŠ¡åˆ—è¡¨ä¿¡æ¯ï¼Œç„¶åä»æœåŠ¡åˆ—è¡¨ä¸­æŒ‘é€‰ä¸€ä¸ªè€Œè¿™ä¸ªè´Ÿè½½å‡è¡¡æ˜¯ IRule æ¥åšçš„æ ¹æ®è§„åˆ™æŒ‘ä¸€ä¸ªå‡ºæ¥é€‰ä¸­äº† 8081 æœåŠ¡ï¼Œå°†å€¼è¿”å›ç»™ RibbonLoadBalancerClient ç„¶åç”¨è¿™ä¸ª ipï¼Œç«¯å£æ›¿æ¢æœåŠ¡åç§°å¾—åˆ°çœŸå®çš„è¯·æ±‚åœ°å€æœ€åå°±è¯·æ±‚åˆ°äº† 8081 æœåŠ¡</p>\n<p>è¿™å°±æ˜¯æ•´ä¸ª Ribbon å·¥ä½œçš„æµç¨‹äº†ï¼</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310042032809.png\" alt=\"image-20231004203247209\" /></p>\n<h4 id=\"311-iruleæ¥å£å®ç°\"><a class=\"anchor\" href=\"#311-iruleæ¥å£å®ç°\">#</a> 3.1.1ã€IRule æ¥å£å®ç°ğŸŒ²</h4>\n<p>IRule æ¥å£å†³å®šäº†è´Ÿè½½å‡è¡¡çš„ç­–ç•¥ï¼Œä¸‹é¢è¯¦ç»†å­¦ä¹  IRule è¿™ä¸ªæ¥å£éƒ½æœ‰å“ªäº›å®ç°ä»¥åŠè‡ªå·±å¦‚ä½•ä¿®æ”¹å®ƒçš„æ¯ä¸ªå®ç°</p>\n<p>Ribbon çš„è´Ÿè½½å‡è¡¡è§„åˆ™æ˜¯ä¸€ä¸ªå«åš IRule çš„æ¥å£æ¥å®šä¹‰çš„ï¼Œæ¯ä¸€ä¸ªå­æ¥å£éƒ½æ˜¯ä¸€ç§è§„åˆ™ï¼š</p>\n<p>&lt;center&gt;IRule æ¥å£ç»§æ‰¿å…³ç³»ç»“æ„å›¾ &lt;/center&gt;</p>\n<p><img data-src=\"https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310042036620.png\" alt=\"image-20231004203629391\" /></p>\n<h3 id=\"32-è´Ÿè½½å‡è¡¡ç­–ç•¥\"><a class=\"anchor\" href=\"#32-è´Ÿè½½å‡è¡¡ç­–ç•¥\">#</a> 3.2ã€è´Ÿè½½å‡è¡¡ç­–ç•¥ğŸŒ³</h3>\n<table>\n<thead>\n<tr>\n<th>å†…ç½®è´Ÿè½½å‡è¡¡è§„åˆ™ç±»</th>\n<th>è§„åˆ™æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>RoundRobinRule</td>\n<td>ç®€å•è½®è¯¢æœåŠ¡åˆ—è¡¨æ¥é€‰æ‹©æœåŠ¡å™¨ã€‚å®ƒæ˜¯ Ribbon é»˜è®¤çš„è´Ÿè½½å‡è¡¡è§„åˆ™</td>\n</tr>\n<tr>\n<td>AvailabilityFilteringRule</td>\n<td>å¯¹ä»¥ä¸‹ä¸¤ç§æœåŠ¡å™¨è¿›è¡Œå¿½ç•¥ï¼š&lt;br /&gt;(1) åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™å°æœåŠ¡å™¨å¦‚æœ 3 æ¬¡è¿æ¥å¤±è´¥ï¼Œè¿™å°æœåŠ¡å™¨å°±ä¼šè¢«è®¾ç½®ä¸º â€œçŸ­è·¯â€ çŠ¶æ€ã€‚çŸ­è·¯çŠ¶æ€å°† &lt; br /&gt; æŒç»­ 30 ç§’ï¼Œå¦‚æœå†æ¬¡è¿æ¥å¤±è´¥ï¼ŒçŸ­è·¯çš„æŒç»­å°±ä¼šå‡ ä½•çº§çš„å¢åŠ ã€‚&lt;br /&gt;(2) å¹¶å‘æ•°è¿‡é«˜çš„æœåŠ¡å™¨ã€‚å¦‚æœä¸€ä¸ªæœåŠ¡å™¨çš„å¹¶å‘è¿æ¥æ•°è¿‡é«˜ï¼Œé…ç½®äº† AvailabilityFilterngRule è§„åˆ™çš„å®¢æˆ·ç«¯ä¹Ÿä¼šå°†å…¶å¿½ç•¥ã€‚å¹¶å‘è¿æ¥æ•°çš„ä¸Šé™ï¼Œå¯ä»¥ç”±å®¢æˆ·ç«¯çš„ &lt; clientName&gt;&lt;/clientConfigNameSpace&gt;.ActiveConnectionsLimit å±æ€§è¿›è¡Œé…ç½®ã€‚</td>\n</tr>\n<tr>\n<td>WeightedResponseTimeRule</td>\n<td>ä¸ºæ¯ä¸€ä¸ªæœåŠ¡å™¨èµ‹äºˆä¸€ä¸ªæƒé‡å€¼ã€‚æœåŠ¡å™¨å“åº”æ—¶é—´è¶Šé•¿ï¼Œè¿™ä¸ªæœåŠ¡å™¨çš„æƒé‡å°±è¶Šå°ã€‚è¿™ä¸ªè§„åˆ™ä¼šéšæœºé€‰æ‹©æœåŠ¡å™¨ï¼Œè¿™ä¸ªæƒé‡å€¼ä¼šå½±å“æœåŠ¡å™¨çš„é€‰æ‹©ã€‚</td>\n</tr>\n<tr>\n<td>&lt;font color='red'&gt;ZoneAvoidanceRule&lt;/font&gt;</td>\n<td>ä»¥åŒºåŸŸå¯ç”¨çš„æœåŠ¡å™¨ä¸ºåŸºç¡€è¿›è¡ŒæœåŠ¡å™¨çš„é€‰æ‹©ã€‚ä½¿ç”¨ Zone å¯¹æœåŠ¡å™¨è¿›è¡Œåˆ†ç±»ï¼Œè¿™ä¸ª Zone å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæœºæˆ¿ï¼Œä¸€ä¸ªæœºæ¶ç­‰ã€‚è€Œåå†å¯¹ Zone å†…çš„å¤šä¸ªæœåŠ¡åšè½®è¯¢ã€‚</td>\n</tr>\n<tr>\n<td>BestAvailableRule</td>\n<td>å¿½ç•¥å“ªäº›çŸ­è·¯çš„æœåŠ¡å™¨ï¼Œå¹¶é€‰æ‹©å¹¶å‘æ•°è¾ƒä½çš„æœåŠ¡å™¨ã€‚</td>\n</tr>\n<tr>\n<td>RandomRule</td>\n<td>éšæœºé€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„æœåŠ¡å™¨ã€‚</td>\n</tr>\n<tr>\n<td>RetryRule</td>\n<td>é‡è¯•æœºåˆ¶çš„é€‰æ‹©é€»è¾‘ã€‚</td>\n</tr>\n</tbody>\n</table>\n<p>é€šè¿‡å®šä¹‰ IRule å®ç°å¯ä»¥ä¿®æ”¹è´Ÿè½½å‡è¡¡è§„åˆ™ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p>\n<p>1ã€ä»£ç æ–¹å¼ï¼šåœ¨ order-service ä¸­çš„ OrderAppliction ç±»ä¸­ï¼Œå®šä¹‰ä¸€ä¸ªæ–°çš„ IRule</p>\n<p>è¿™æ ·å°±ä¼šè®©è´Ÿè½½å‡è¡¡è§„åˆ™ä»è½®è¯¢å˜æˆéšæœºè§„åˆ™</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">IRule</span> <span class=\"token function\">randomRule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RandomRule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>2ã€é…ç½®æ–‡ä»¶æ–¹å¼ï¼šåœ¨ order-service çš„ application.yml æ–‡ä»¶ä¸­ï¼Œæ·»åŠ æ–°çš„é…ç½®ä¹Ÿå¯ä»¥ä¿®æ”¹è§„åˆ™ï¼š</p>\n<p>å…ˆæŒ‡å®šæœåŠ¡åç§°ï¼Œå†å»æ‰§è¡Œè´Ÿè½½å‡è¡¡è§„åˆ™å› æ­¤è¿™ç§é…ç½®æ–¹æ¡ˆå®ƒæ˜¯é’ˆå¯¹æŸä¸ªå¾®æœåŠ¡è€Œè¨€çš„ã€‚</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">userservice</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># æœåŠ¡åç§°</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">ribbon</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">NFLoadBalancerRuleClassName</span><span class=\"token punctuation\">:</span> com.netflix.loadbalancer.RandomRule <span class=\"token comment\"># è´Ÿè½½å‡è¡¡è§„åˆ™</span></pre></td></tr></table></figure><h3 id=\"33-é¥¥é¥¿åŠ è½½\"><a class=\"anchor\" href=\"#33-é¥¥é¥¿åŠ è½½\">#</a> 3.3ã€é¥¥é¥¿åŠ è½½ğŸŒ³</h3>\n<p><mark>Ribbon é»˜è®¤æ˜¯é‡‡ç”¨æ‡’åŠ è½½</mark>ï¼Œå³ç¬¬ä¸€æ¬¡è®¿é—®æ—¶æ‰ä¼šå»åˆ›å»º LoadBalanceClientï¼Œè¯·æ±‚æ—¶é—´ä¼šå¾ˆé•¿ã€‚</p>\n<p>è€Œé¥¥é¥¿åŠ è½½åˆ™ä¼šåœ¨<mark>é¡¹ç›®å¯åŠ¨æ—¶åˆ›å»º</mark>ï¼Œé™ä½ç¬¬ä¸€æ¬¡è®¿é—®æ—¶çš„è€—æ—¶ï¼Œé€šè¿‡ä¸‹é¢é…ç½®å¼€å¯é¥¥é¥¿åŠ è½½ï¼š</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">userservice</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># æœåŠ¡å</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">ribbon</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\"># NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RandomRule # è´Ÿè½½å‡è¡¡è§„åˆ™</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">eager-load</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\"># å¼€å¯é¥¥é¥¿åŠ è½½</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">clients</span><span class=\"token punctuation\">:</span> userservice <span class=\"token comment\"># æŒ‡å®šå¯¹ userservice è¿™ä¸ªæœåŠ¡é¥¥é¥¿åŠ è½½</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token comment\"># å¦‚æœå¤šä¸ªæœåŠ¡éœ€è¦é¥¥é¥¿åŠ è½½åˆ™å†™å¦‚ä¸‹æ ¼å¼</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token comment\"># clients:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token comment\">#     - userservice</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token comment\">#     - æœåŠ¡å 1</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token comment\">#     - æœåŠ¡å 2</span></pre></td></tr></table></figure><blockquote>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<ol>\n<li>Ribbon è´Ÿè½½å‡è¡¡è§„åˆ™\n<ul>\n<li>è§„åˆ™æ¥å£æ˜¯ IRule</li>\n<li>é»˜è®¤å®ç°æ˜¯ ZoneAvoidanceRuleï¼Œæ ¹æ® zone é€‰æ‹©æœåŠ¡åˆ—è¡¨ï¼Œç„¶åè½®è¯¢</li>\n</ul>\n</li>\n<li>è´Ÿè½½å‡è¡¡è‡ªå®šä¹‰æ–¹å¼\n<ul>\n<li>ä»£ç æ–¹å¼ï¼šé…ç½®çµæ´»ï¼Œä½†ä¿®æ”¹æ—¶éœ€è¦é‡æ–°æ‰“åŒ…å‘å¸ƒ</li>\n<li>é…ç½®æ–¹å¼ï¼šç›´è§‚ï¼Œæ–¹ä¾¿ï¼Œæ— éœ€é‡æ–°æ‰“åŒ…å‘å¸ƒï¼Œä½†æ˜¯æ— æ³•åšå…¨å±€é…ç½®</li>\n</ul>\n</li>\n<li>é¥¥é¥¿åŠ è½½\n<ul>\n<li>å¼€å¯é¥¥é¥¿åŠ è½½</li>\n<li>æŒ‡å®šé¥¥é¥¿åŠ è½½çš„å¾®æœåŠ¡åç§°</li>\n</ul>\n</li>\n</ol>\n</blockquote>\n",
            "tags": [
                "è®¡ç®—æœºå­¦ç§‘",
                "java",
                "spring",
                "springcloud",
                "è®¡ç®—æœºå­¦ç§‘",
                "springcloud"
            ]
        }
    ]
}