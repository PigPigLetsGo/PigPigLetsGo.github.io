<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Dkx の Java小窝" href="https://pigpigletsgo.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Dkx の Java小窝" href="https://pigpigletsgo.github.io/atom.xml"><link rel="alternate" type="application/json" title="Dkx の Java小窝" href="https://pigpigletsgo.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="计算机学科,springcloud,RabbitMQ"><link rel="canonical" href="https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/RabbitMQ/springcloud-%E5%BC%82%E6%AD%A5%E9%80%9A%E8%AE%AF/"><title>八、RabbitMQ 服务异步通讯 - RabbitMQ - springcloud - spring - java - 计算机学科 | Dou的个人博客 = Dkx の Java 小窝 = 别怕路长梦远</title><meta name="generator" content="Hexo 5.4.2"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">八、RabbitMQ 服务异步通讯</h1><div class="meta"><span class="item" title="创建时间：2024-01-24 18:48:46"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2024-01-24T18:48:46+08:00">2024-01-24</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>27k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>25 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Dou的个人博客</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/6c7f469735b99a6a04773240429dc7e0.jpg"></li><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/5da180f23a92b4141ea87338ac84c765.jpg"></li><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/5651daf17bf5de77514e658264d7cccc.jpg"></li><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/a8d0ac76b87f7593653e29559d61b32d.jpg"></li><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/a8d0ac76b87f7593653e29559d61b32d.jpg"></li><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/a8d0ac76b87f7593653e29559d61b32d.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/" itemprop="item" rel="index" title="分类于 计算机学科"><span itemprop="name">计算机学科</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/java/" itemprop="item" rel="index" title="分类于 java"><span itemprop="name">java</span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/java/spring/" itemprop="item" rel="index" title="分类于 spring"><span itemprop="name">spring</span></a><meta itemprop="position" content="3"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/java/spring/springcloud/" itemprop="item" rel="index" title="分类于 springcloud"><span itemprop="name">springcloud</span></a><meta itemprop="position" content="4"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/java/spring/springcloud/RabbitMQ/" itemprop="item" rel="index" title="分类于 RabbitMQ"><span itemprop="name">RabbitMQ</span></a><meta itemprop="position" content="5"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/RabbitMQ/springcloud-%E5%BC%82%E6%AD%A5%E9%80%9A%E8%AE%AF/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Dkx"><meta itemprop="description" content="别怕路长梦远, 欢迎来我的博客空间"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Dkx の Java 小窝"></span><div class="body md" itemprop="articleBody"><h2 id="八-服务异步通讯"><a class="anchor" href="#八-服务异步通讯">#</a> 八、服务异步通讯🎄</h2><p>实用篇 - RabbitMQ</p><p><strong>学习内容</strong>：</p><ul><li>初始 MQ</li><li>RabbitMQ 快速入门</li><li>SpringAMQP</li></ul><h3 id="81-初始mq"><a class="anchor" href="#81-初始mq">#</a> 8.1、初始 MQ🌳</h3><ul><li>同步通讯</li><li>异步通讯</li><li>MQ 常见框架</li></ul><h4 id="811-同步调用的问题"><a class="anchor" href="#811-同步调用的问题">#</a> 8.1.1、同步调用的问题🌲</h4><p>微服务间基于 Feign 的调用就属于同步方式，存在一些问题。</p><blockquote><p>我们做一个购买商品的业务，用户支付调用支付服务。支付成功后需要调用订单业务，修改订单状态。然后还要去调用仓储服务，因为要给用户发货。</p><p>支付服务调用订单服务也好，调用仓储服务也好它都需要等待对方的响应。所以这种调用是事实的调用也就是同步调用</p></blockquote><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310101513894.png" alt="image-20231010151319336"></p><p>它的问题：</p><p>1、耦合问题</p><p>如果需要增加业务而需要改动支付服务的代码</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310101516352.png" alt="image-20231010151616770"></p><p>2、性能下降</p><p>用户来调用支付业务，假如说支付业务耗时 50ms，紧接着支付服务调用其它服务，其它服务都耗时 150ms。支付服务调用再调用其它服务是同步调用所以它必须等待其它服务的执行结果才能执行其它的工作。而这一套流程下来就达到了耗时：500ms。这样的业务也太烂了</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310101518339.png" alt="image-20231010151851047"></p><p>3、资源浪费</p><p>支付服务在不能执行下一步操作时一直都是在占用 CPU，占用内存的</p><p>4、级联失败问题</p><p>假如说中间某个服务报错了就会产生阻塞，等待时长较长结果且是失败的。用户体验极差</p><p>综上所述：</p><p>同步调用尽管时效性还不错但是却存在其它问题</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310101527400.png" alt="image-20231010152713676"></p><blockquote><p><strong>总结</strong>：</p><p>同步调用的优点：</p><ul><li>时效性较强，可以立即得到结果</li></ul><p>同步调用的问题：</p><ul><li>耦合度高</li><li>性能和吞吐能力下降</li><li>有额外的资源消耗</li><li>有级联失败问题</li></ul></blockquote><h4 id="812-异步调用方案"><a class="anchor" href="#812-异步调用方案">#</a> 8.1.2、异步调用方案🌲</h4><p>异步调用常见实现就是事件驱动模式</p><p>引入了一个新的东西叫：Broker (事件代理者)</p><p>支付服务通知 Broker，Broker 通过其它服务</p><p>在整个过程当中，支付服务完成事件发布后就立即结束了自己的业务，可以去返回给用户了，而不需要去等其它服务完成结果</p><p>这种方式就是异步方式</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310101533471.png" alt="image-20231010153325787"></p><p>优势：</p><p>1、服务解耦</p><p>有新的业务只需要订阅 Broker 就行了跟支付服务没有任何关系</p><p>2、性能提升，吞吐量提高</p><p>3、没有强依赖关系，不担心级联失败问题</p><p>4、流量削峰</p><p>解释 “流量削峰” ：假如说一瞬间来了三个请求，订单服务，仓储服务，短信服务每一时刻只能处理一个，这时 Broker 可以起到缓冲的 作用。然后其它服务就一个一个处理，处理完了就到 Broker 去取，这样这些服务就能一直按照自己平时的处理速度来工作。一切压力由 Broker 扛着，这样一个高度的并发就可以变成低度的并发，这！就是 流量削峰</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310101542090.png" alt="image-20231010154228957"></p><blockquote><p><strong>总结</strong>:</p><p>异步通信的优点：</p><ul><li>耦合度低</li><li>吞吐量提升</li><li>故障隔离</li><li>流量削峰</li></ul><p>异步通信的缺点：</p><ul><li>依赖于 Broker 的可靠性，安全性，吞吐能力</li><li>架构复杂了，业务没有明显的流程线，不好追踪管理</li></ul></blockquote><h4 id="813-什么是mq"><a class="anchor" href="#813-什么是mq">#</a> 8.1.3、什么是 MQ🌲</h4><p>MQ (MessageQueue) ，中文是消息队列，字面来看就是存放消息的队列。也就是事件驱动架构中的 Broker</p><table><thead><tr><th></th><th>RabbitMQ</th><th>ActiveMQ</th><th>RocketMQ</th><th>KafKa</th></tr></thead><tbody><tr><td>公司 / 社区</td><td>Rabbit</td><td>Apache</td><td>阿里</td><td>Apache</td></tr><tr><td>开发语言</td><td>Erlang</td><td>Java</td><td>Java</td><td>Scala&amp;Java</td></tr><tr><td>协议支持</td><td>AMQP，XMPP，STOMP</td><td>OpenWire，STOMP，REST，XMPP，AMQP</td><td>自定义协议</td><td>自定义协议</td></tr><tr><td>可用性</td><td>高</td><td>一般</td><td>高</td><td>高</td></tr><tr><td>单机吞吐量</td><td>一般</td><td>差</td><td>高</td><td>非常高</td></tr><tr><td>消息延迟</td><td>微秒级</td><td>毫秒级</td><td>毫秒级</td><td>毫秒以内</td></tr><tr><td>消息可靠性</td><td>高</td><td>一般</td><td>高</td><td>一般</td></tr></tbody></table><h4 id="814-rabbitmq快速入门"><a class="anchor" href="#814-rabbitmq快速入门">#</a> 8.1.4、RabbitMQ 快速入门🌲</h4><ul><li>RabbitMQ 概述和安装</li><li>常见消息模型</li><li>快速入门</li></ul><h5 id="8141-rabbitmq概述"><a class="anchor" href="#8141-rabbitmq概述">#</a> 8.1.4.1、RabbitMQ 概述🌴</h5><p>RabbitMQ 是基于 Erlang 语言开发的开源消息通信中间件，官网地址：<span class="exturl" data-url="aHR0cHM6Ly93d3cucmFiYml0bXEuY29tLw==">https://www.rabbitmq.com/</span></p><p>安装 RabbitMQ 可以点击查看详细文章：<a href="./RabbitMQ/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97.md">RabbitMQ 安装部署指南</a>.</p><blockquote><p>RabbitMQ 的结构和概念</p><p>Publisher 是消息发送者，consumer 就是消息消费者，发送者会把消息发送到 exchange 也就是交换机。交换机负责路由把消息投递到 queue 队列，队列负责暂存消息，然后消费者再去从队列中获取消息然后处理消息</p><p>VirtulHost 就是虚拟主机，将来有多个用户它会有自己的一个虚拟主机，各个虚拟主机之间互相隔离避免干扰</p><p>这就是整体 MQ 的架构了</p></blockquote><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310102044747.png" alt="image-20231010204307956"></p><blockquote><p><strong>总结</strong>：</p><p>RabbitMQ 中的几个概念：</p><ul><li>channel：操作 MQ 的工具</li><li>exchange：路由消息到队列中</li><li>queue：缓存消息</li><li>virtual host：虚拟主机，是对 queue，exchange 等资源的逻辑分组</li></ul></blockquote><h5 id="8142-常见消息模型"><a class="anchor" href="#8142-常见消息模型">#</a> 8.1.4.2、常见消息模型🌴</h5><p>MQ 的官方文档中给出了 5 个 MQ 的 demo 示例，对应了几种不同的用法：</p><ul><li>基本消息队列 (BasicQueue)</li><li>工作消息队列 (WorkQueue)</li></ul><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310102052128.png" alt="image-20231010205233688"></p><ul><li><p>发布订阅 (Publish ，Subscribe)，又根据交换机类型不同分为三种：</p><ul><li>Fanout Exchange：广播</li><li>Direct Exchange：路由</li><li>Topic Exchange：主题</li></ul><p>图中，紫色的就是交换机</p></li></ul><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310102054075.png" alt="image-20231010205422743"></p><h5 id="8143-helloworld案例"><a class="anchor" href="#8143-helloworld案例">#</a> 8.1.4.3、HelloWorld 案例🌴</h5><p>官方的 HelloWorld 是基于最基础的消息队列模型来实现的，只包括三个角色：</p><ul><li>publisher：消息发布者，将消息发送到队列 queue</li><li>queue：消息队列，负责接受并缓存消息</li><li>consumer：订阅队列，处理队列中的消息</li></ul><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310102056496.png" alt="image-20231010205637991"></p><p>发布者代码：</p><p>debug 运行代码</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Channel</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Connection</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">ConnectionFactory</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeoutException</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PublisherTest</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSendMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token comment">// 1. 建立连接</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">*</span>        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token comment">// 1.1. 设置连接参数，分别是：主机名、端口号、vhost、用户名、密码</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.249.128"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"itcast"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123321"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token comment">// 1.2. 建立连接</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token comment">// 2. 创建通道 Channel</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token comment">// 3. 创建队列</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token class-name">String</span> queueName <span class="token operator">=</span> <span class="token string">"simple.queue"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token comment">// 4. 发送消息</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">"hello, rabbitmq!"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> queueName<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"发送消息成功：【"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"】"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token comment">// 5. 关闭通道和连接</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>代码走到建立连接没有报错的话，查看下 RabbitMQ 的 ui 管理平台中的 Connections</p><p>里面就会出现一个主机的连接信息</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110748590.png" alt="image-20231011074738545"></p><p>再往下创建通道</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110749797.png" alt="image-20231011074927559"></p><p>再往下创建队列</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110750475.png" alt="image-20231011075033895"></p><p>再往下准备发送消息往队列中发送 queName，将消息转为字节发送 getBytes ()</p><p>下面就可以看到队列中有一条消息：Ready = 1</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110756263.png" alt="image-20231011075619843"></p><p>我们可以点击 Name，点击进去然后点击 Get Message 里面可以看到发送的消息</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110758298.png" alt="image-20231011075826602"></p><p>消费者代码</p><p>debug 运行</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeoutException</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerTest</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token comment">// 1. 建立连接</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token comment">// 1.1. 设置连接参数，分别是：主机名、端口号、vhost、用户名、密码</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.249.128"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"itcast"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123321"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token comment">// 1.2. 建立连接</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token comment">// 2. 创建通道 Channel</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token comment">// 3. 创建队列</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token class-name">String</span> queueName <span class="token operator">=</span> <span class="token string">"simple.queue"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token comment">// 4. 订阅消息</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                                       <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                <span class="token comment">// 5. 处理消息</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"接收到消息：【"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"】"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"等待接收消息。。。。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>在消费者代码中又进行了创建队列，发布者已经产生时创建了一个队列了，但是消费者为什么又要创建队列呢？</p><p>这是因为，发布者和消费者它们启动的顺序不确定。万一消费者先启动的呢，那找队列找不到怎么办。为了避免这种问题发生它们各自都去声明队列，虽然代码是重复的但是我们可以看下 RabbitMQ-ui 控制台的 Queue 管理页面</p><p>它并没有去创建这个队列，所以发布者与消费者都写只是一个保险措施防止不存在队列</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110844291.png" alt="image-20231011084433956"></p><p>第四步消费消息</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110845508.png" alt="image-20231011084522086"></p><p>消费者最终在 idea 控制台的打印信息</p><pre><code>等待接收消息。。。。
接收到消息：【hello, rabbitmq!】
</code></pre><p>先打印了 main 函数的 “等待接收消息。。。。” 这段话，而后打印了 消费的消息。</p><p>因为回调机制消费者处理函数 handleDelivery 与队列进行了绑定 queueName。但是消息还并没有过来然后再继续往下执行打印了 “等待接收消息。。。。” ，等 rabbitMQ 把消息投递回来了再打印 “接收到消息：【hello, rabbitmq!】”，这就说明 RabbitMQ 处理消息是异步的</p><blockquote><p><strong>总结</strong>：</p><p>基本消息队列的消息发送流程：</p><ol><li>建立 connection</li><li>创建 channel</li><li>利用 channel 声明队列</li><li>利用 channel 向队列发送消息</li></ol><p>基本消息队列的消息接收流程：</p><ol><li>建立 connection</li><li>创建 channel</li><li>利用 channel 声明队列</li><li>定义 consumer 的消费行为 handleDelivery ()</li><li>利用 channel 将消费者与队列绑定</li></ol></blockquote><h4 id="815-springamqp"><a class="anchor" href="#815-springamqp">#</a> 8.1.5、SpringAMQP🌲</h4><ul><li>Basic Queue 简单队列模型</li><li>Work Queue 工作队列模型</li><li>发布，订阅模型 - Fanout</li><li>发布，订阅模型 - Direct</li><li>发布，订阅模型 - Topic</li><li>消息转换器</li></ul><h5 id="8151-什么是springamqp"><a class="anchor" href="#8151-什么是springamqp">#</a> 8.1.5.1、什么是 SpringAMQP🌴</h5><p>SpringAMQP 官方地址：<span class="exturl" data-url="aHR0cHM6Ly9zcHJpbmcuaW8vcHJvamVjdHMvc3ByaW5nLWFtcXA=">https://spring.io/projects/spring-amqp</span></p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110903769.png" alt="image-20231011090014596"></p><h5 id="8152-案例利用springamqp实现helloworld中的基础消息队列功能"><a class="anchor" href="#8152-案例利用springamqp实现helloworld中的基础消息队列功能">#</a> 8.1.5.2、案例，利用 SpringAMQP 实现 HelloWorld 中的基础消息队列功能🌴</h5><p><strong>流程如下</strong>：</p><p>1、在父工程中引入 spring-amqp 的依赖</p><p>因为 publisher 和 consumer 服务都需要 amqp 依赖，因此这里把依赖直接放到父工程 mq-demo 中：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!--AMQP 依赖，包含 RabbitMQ--></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>2、在 publisher 服务中利用 RabbitTemplate 发送消息到 simple.queue 到这个队列</p><p>在 publisher 中编写测试方法，向 simple.queue 发送消息</p><p>2.1、在 publisher 服务中编写 application.yml，添加 mq 连接信息：</p><figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.249.128 <span class="token comment"># RabbitMQ 的 ip 地址</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span> <span class="token comment"># RabbitMQ 的端口号</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">username</span><span class="token punctuation">:</span> itcast <span class="token comment"># 用户名</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123321</span> <span class="token comment"># 密码</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> / <span class="token comment"># 虚拟主机</span></pre></td></tr></table></figure><p>2.2、在 publisher 服务中新建一个测试类，编写测试方法：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RabbitTemplate</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringRunner</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="9"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num="10"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num="11"></td><td><pre> * @2023/10/119:18</pre></td></tr><tr><td data-num="12"></td><td><pre> * @function</pre></td></tr><tr><td data-num="13"></td><td><pre> * @comment</pre></td></tr><tr><td data-num="14"></td><td><pre> */</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token annotation punctuation">@SpringBootTest</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringAmqpTest</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token annotation punctuation">@Autowired</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token class-name">String</span> queueName <span class="token operator">=</span> <span class="token string">"simple.queue"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">"hello,Spring Amqp"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>查看 rabbitmq 的 ui 管理平台的队列信息</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110922013.png" alt="image-20231011092250032"></p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110923115.png" alt="image-20231011092326888"></p><blockquote><p><strong>总结</strong>：</p><p>什么是 AMQP</p><ul><li>应用间消息通信的一种协议，与语言和平台无关</li></ul><p>SpringAMQP 如何发送消息？</p><ul><li>引入 amqp 的 starter 依赖</li><li>配置 RabbitMQ 地址</li><li>利用 RabbitTemplate 的 convertAndSend 方法发送消息到指定队列中</li></ul></blockquote><p>3、在 consumer 服务中编写消费逻辑，绑定 simple.queue 这个队列</p><p>在 consumer 中编写消息逻辑，监听 simple.queue</p><p>3.1、在 consumer 服务中编写 application.yml，添加 mq 连接信息：</p><figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.249.128 <span class="token comment"># RabbitMQ 的 ip 地址</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span> <span class="token comment"># RabbitMQ 的端口号</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">username</span><span class="token punctuation">:</span> itcast <span class="token comment"># 用户名</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123321</span> <span class="token comment"># 密码</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> / <span class="token comment"># 虚拟主机</span></pre></td></tr></table></figure><p>3.2、在 consumer 服务中新建一个类，编写消费逻辑：</p><p>不能写在 test 中进行测试是因为它需要被 Spring 所管理注册为 Bean</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RabbitListener</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="5"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num="6"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num="7"></td><td><pre> * @2023/10/119:34</pre></td></tr><tr><td data-num="8"></td><td><pre> * @function</pre></td></tr><tr><td data-num="9"></td><td><pre> * @comment</pre></td></tr><tr><td data-num="10"></td><td><pre> */</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token annotation punctuation">@Component</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringRabbitListener</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">"simple.queue"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenerSimpleQueue</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"消费者接收到simple.queue的消息为："</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">//---------------------- 打印结果 ----------------------</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">.</span>   ____          _            __ _ _</pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token operator">/</span>\\ <span class="token operator">/</span> ___'_ __ _ <span class="token function">_</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span>_ __  __ _ \ \ \ \</pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">(</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span>\___ <span class="token operator">|</span> <span class="token char">'_ | '</span>_<span class="token operator">|</span> <span class="token operator">|</span> '_ \<span class="token operator">/</span> _` <span class="token operator">|</span> \ \ \ \</pre></td></tr><tr><td data-num="24"></td><td><pre> \\<span class="token operator">/</span>  ___<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token operator">|</span>_<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">||</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span>  <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  '  <span class="token operator">|</span>____<span class="token operator">|</span> <span class="token punctuation">.</span>__<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_\__<span class="token punctuation">,</span> <span class="token operator">|</span> <span class="token operator">/</span> <span class="token operator">/</span> <span class="token operator">/</span> <span class="token operator">/</span></pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">|</span>_<span class="token operator">|=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">|</span>___<span class="token operator">/=</span><span class="token operator">/</span>_<span class="token operator">/</span>_<span class="token operator">/</span>_<span class="token operator">/</span></pre></td></tr><tr><td data-num="27"></td><td><pre> <span class="token operator">::</span> <span class="token class-name">Spring</span> <span class="token class-name">Boot</span> <span class="token operator">::</span>        <span class="token punctuation">(</span>v2<span class="token punctuation">.</span><span class="token number">3.9</span><span class="token punctuation">.</span><span class="token constant">RELEASE</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">584</span>  <span class="token constant">INFO</span> <span class="token number">1164</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mq<span class="token punctuation">.</span></span>ConsumerApplication</span>         <span class="token operator">:</span> <span class="token class-name">Starting</span> <span class="token class-name">ConsumerApplication</span> on <span class="token class-name">Jfier</span> <span class="token keyword">with</span> <span class="token class-name">PID</span> <span class="token number">1164</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token operator">:</span>\微服务\实用篇\资料\day04<span class="token operator">-</span><span class="token constant">MQ</span>\资料\mq<span class="token operator">-</span>demo\consumer\target\classes started by <span class="token class-name">Administrator</span> in <span class="token class-name">E</span><span class="token operator">:</span>\微服务\实用篇\资料\day04<span class="token operator">-</span><span class="token constant">MQ</span>\资料\mq<span class="token operator">-</span>demo<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">594</span>  <span class="token constant">INFO</span> <span class="token number">1164</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mq<span class="token punctuation">.</span></span>ConsumerApplication</span>         <span class="token operator">:</span> <span class="token class-name">No</span> active profile set<span class="token punctuation">,</span> falling back <span class="token keyword">to</span> <span class="token keyword">default</span> profiles<span class="token operator">:</span> <span class="token keyword">default</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">476</span>  <span class="token constant">INFO</span> <span class="token number">1164</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>a<span class="token punctuation">.</span>r<span class="token punctuation">.</span>c<span class="token punctuation">.</span></span>CachingConnectionFactory</span>       <span class="token operator">:</span> <span class="token class-name">Attempting</span> <span class="token keyword">to</span> <span class="token namespace">connect</span> <span class="token keyword">to</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">192.168</span><span class="token number">.249</span><span class="token number">.128</span><span class="token operator">:</span><span class="token number">5672</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">531</span>  <span class="token constant">INFO</span> <span class="token number">1164</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>a<span class="token punctuation">.</span>r<span class="token punctuation">.</span>c<span class="token punctuation">.</span></span>CachingConnectionFactory</span>       <span class="token operator">:</span> <span class="token class-name">Created</span> <span class="token keyword">new</span> connection<span class="token operator">:</span> rabbitConnectionFactory#<span class="token number">640d</span>c4c6<span class="token operator">:</span><span class="token number">0</span><span class="token operator">/</span><span class="token class-name">SimpleConnection</span><span class="token annotation punctuation">@7a0f244f</span> <span class="token punctuation">[</span>delegate<span class="token operator">=</span>amqp<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>itcast<span class="token annotation punctuation">@192.168.249.128</span><span class="token operator">:</span><span class="token number">5672</span><span class="token operator">/</span><span class="token punctuation">,</span> localPort<span class="token operator">=</span> <span class="token number">3380</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">610</span>  <span class="token constant">INFO</span> <span class="token number">1164</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mq<span class="token punctuation">.</span></span>ConsumerApplication</span>         <span class="token operator">:</span> <span class="token class-name">Started</span> <span class="token class-name">ConsumerApplication</span> in <span class="token number">2.755</span> seconds <span class="token punctuation">(</span><span class="token constant">JVM</span> running <span class="token keyword">for</span> <span class="token number">4.791</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>消费者接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span></pre></td></tr></table></figure><blockquote><p><strong>总结</strong>：</p><p>SPringAMQP 如何接收消息？</p><ul><li>引入 amqp 的 starter 依赖</li><li>配置 RabbitMQ 地址</li><li>定义类，添加 @Component 注解</li><li>类中声明方法，添加 @RabbitListener 注解，方法参数就是消息</li></ul></blockquote><h4 id="816-work-queue工作队列"><a class="anchor" href="#816-work-queue工作队列">#</a> 8.1.6、Work Queue 工作队列🌲</h4><p>它也具备消息发布和消费，但是不同的是它后面挂了两个消费者。两个消费者共同处理发布者的消息，</p><p>比如发布者发送 50 消息，consumer1 消费 25，consumer2 消费 25。被消费过的消息就会被删除不可能会再被其它消费者消费已经消费过的消息。</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310110943473.png" alt="image-20231011094302230"></p><h5 id="8161-模拟workqueue实现一个队列绑定多个消费者"><a class="anchor" href="#8161-模拟workqueue实现一个队列绑定多个消费者">#</a> 8.1.6.1、模拟 WorkQueue，实现一个队列绑定多个消费者🌴</h5><p><strong>基本思路如下</strong>：</p><p>1、在 publisher 服务中定义测试方法，每秒产生 50 条消息，发送到 simple.queue</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">workQueueTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>   <span class="token class-name">String</span> queueName <span class="token operator">=</span> <span class="token string">"simple.queue"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>   <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">"hello,Spring Amqp __ "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>         <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>         <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> message <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>2、在 consumer 服务中定义两个消息监听者，都监听 simple.queue 队列</p><p>2.1、消费者 1 每秒处理 50 条消息，消费者 2 每秒处理 10 条消息</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">"simple.queue"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenerSimpleQueue1</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"消费者1接收到simple.queue的消息为："</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>   <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>   <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">"simple.queue"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenerSimpleQueue2</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>   <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"消费者2......接收到simple.queue的消息为："</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>   <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>   <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">//-------------------- 打印结果 --------------------</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token punctuation">.</span>   ____          _            __ _ _</pre></td></tr><tr><td data-num="24"></td><td><pre> <span class="token operator">/</span>\\ <span class="token operator">/</span> ___'_ __ _ <span class="token function">_</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span>_ __  __ _ \ \ \ \</pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">(</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span>\___ <span class="token operator">|</span> <span class="token char">'_ | '</span>_<span class="token operator">|</span> <span class="token operator">|</span> '_ \<span class="token operator">/</span> _` <span class="token operator">|</span> \ \ \ \</pre></td></tr><tr><td data-num="26"></td><td><pre> \\<span class="token operator">/</span>  ___<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token operator">|</span>_<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">||</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span>  <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  '  <span class="token operator">|</span>____<span class="token operator">|</span> <span class="token punctuation">.</span>__<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_\__<span class="token punctuation">,</span> <span class="token operator">|</span> <span class="token operator">/</span> <span class="token operator">/</span> <span class="token operator">/</span> <span class="token operator">/</span></pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">|</span>_<span class="token operator">|=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">|</span>___<span class="token operator">/=</span><span class="token operator">/</span>_<span class="token operator">/</span>_<span class="token operator">/</span>_<span class="token operator">/</span></pre></td></tr><tr><td data-num="29"></td><td><pre> <span class="token operator">::</span> <span class="token class-name">Spring</span> <span class="token class-name">Boot</span> <span class="token operator">::</span>        <span class="token punctuation">(</span>v2<span class="token punctuation">.</span><span class="token number">3.9</span><span class="token punctuation">.</span><span class="token constant">RELEASE</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">1</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">47.564155</span></pre></td></tr><tr><td data-num="32"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">0</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">47.564155</span></pre></td></tr><tr><td data-num="33"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">3</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">47.602944400</span></pre></td></tr><tr><td data-num="34"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">5</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">47.634311</span></pre></td></tr><tr><td data-num="35"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">7</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">47.663563900</span></pre></td></tr><tr><td data-num="36"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">9</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">47.693902600</span></pre></td></tr><tr><td data-num="37"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">11</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">47.724277700</span></pre></td></tr><tr><td data-num="38"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">13</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">47.754720</span></pre></td></tr><tr><td data-num="39"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">2</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">47.784759800</span></pre></td></tr><tr><td data-num="40"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">15</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">47.784759800</span></pre></td></tr><tr><td data-num="41"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">17</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">47.814876500</span></pre></td></tr><tr><td data-num="42"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">19</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">47.845253300</span></pre></td></tr><tr><td data-num="43"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">21</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">47.876696200</span></pre></td></tr><tr><td data-num="44"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">23</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">47.907389600</span></pre></td></tr><tr><td data-num="45"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">25</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">47.938559800</span></pre></td></tr><tr><td data-num="46"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">27</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">47.968268500</span></pre></td></tr><tr><td data-num="47"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">29</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">47.998623300</span></pre></td></tr><tr><td data-num="48"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">4</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">47.998623300</span></pre></td></tr><tr><td data-num="49"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">31</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">48.028620600</span></pre></td></tr><tr><td data-num="50"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">33</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">48.058770700</span></pre></td></tr><tr><td data-num="51"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">35</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">48.089572100</span></pre></td></tr><tr><td data-num="52"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">37</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">48.119707200</span></pre></td></tr><tr><td data-num="53"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">39</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">48.149984400</span></pre></td></tr><tr><td data-num="54"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">41</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">48.179999600</span></pre></td></tr><tr><td data-num="55"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">6</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">48.210307400</span></pre></td></tr><tr><td data-num="56"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">43</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">48.210307400</span></pre></td></tr><tr><td data-num="57"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">45</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">48.240964800</span></pre></td></tr><tr><td data-num="58"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">47</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">48.270986500</span></pre></td></tr><tr><td data-num="59"></td><td><pre>消费者<span class="token number">1</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">49</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">48.301165400</span></pre></td></tr><tr><td data-num="60"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">8</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">48.423433300</span></pre></td></tr><tr><td data-num="61"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">10</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">48.636403400</span></pre></td></tr><tr><td data-num="62"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">12</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">48.848982300</span></pre></td></tr><tr><td data-num="63"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">14</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">49.060187200</span></pre></td></tr><tr><td data-num="64"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">16</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">49.273197100</span></pre></td></tr><tr><td data-num="65"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">18</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">49.484165800</span></pre></td></tr><tr><td data-num="66"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">20</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">49.696880900</span></pre></td></tr><tr><td data-num="67"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">22</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">49.908464300</span></pre></td></tr><tr><td data-num="68"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">24</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">50.121477600</span></pre></td></tr><tr><td data-num="69"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">26</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">50.333586300</span></pre></td></tr><tr><td data-num="70"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">28</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">50.548236400</span></pre></td></tr><tr><td data-num="71"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">30</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">50.759585700</span></pre></td></tr><tr><td data-num="72"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">32</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">50.973508400</span></pre></td></tr><tr><td data-num="73"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">34</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">51.185203800</span></pre></td></tr><tr><td data-num="74"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">36</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">51.399855600</span></pre></td></tr><tr><td data-num="75"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">38</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">51.610433700</span></pre></td></tr><tr><td data-num="76"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">40</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">51.823352100</span></pre></td></tr><tr><td data-num="77"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">42</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">52.035381900</span></pre></td></tr><tr><td data-num="78"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">44</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">52.248226300</span></pre></td></tr><tr><td data-num="79"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">46</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">52.462320400</span></pre></td></tr><tr><td data-num="80"></td><td><pre>消费者<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>接收到simple<span class="token punctuation">.</span>queue的消息为：hello<span class="token punctuation">,</span><span class="token class-name">Spring</span> <span class="token class-name">Amqp</span> __ <span class="token number">48</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">11</span><span class="token constant">T10</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">52.677121500</span></pre></td></tr></table></figure><p>消费者 1 很快就结束了，而消费者 2 却花了很长很长的时间。我们认为的快的多消费点，慢的少消费点而事实却是平均分配给了两个消费者，消费者 1 那拿的是所有的奇数，消费者 2 拿到的是所有的偶数。</p><p>这是因为 RabbitMQ 一个机制造成的，就是：消息预取机制</p><p>解释消息预取：</p><p>当有大量的消息到达队列时，队列中会把消息进行投递，consumer1 和 consumer2 会提前把消息拿过来这就是消息预取，不管能不能处理先拿过来再说</p><p>于是两个人就平均分配所有的消息一人分了 25 条，但是呢 consumer1 处理的快很快就搞定了，consumer2 处理的慢需要一段时间</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111024244.png" alt="image-20231011102418214"></p><h6 id="可以对消息预取进行配置限制"><a class="anchor" href="#可以对消息预取进行配置限制">#</a> 可以对消息预取进行配置限制🎋</h6><p>修改 application.yml 文件，设置 preFetch 这个值，可以控制预取消息的上限：</p><figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.249.128 <span class="token comment"># RabbitMQ 的 ip 地址</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span> <span class="token comment"># RabbitMQ 的端口号</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">username</span><span class="token punctuation">:</span> itcast <span class="token comment"># 用户名</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123321</span> <span class="token comment"># 密码</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> / <span class="token comment"># 虚拟主机</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token key atrule">listener</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token key atrule">simple</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token key atrule">prefetch</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># 每次只获取一条消息，处理完成才能获取下一个消息</span></pre></td></tr></table></figure><p>设置完成后再进行测试：</p><pre><code>消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 0---2023-10-11T10:30:40.386440300
消费者2......接收到simple.queue的消息为：hello,Spring Amqp __ 1---2023-10-11T10:30:40.398703100
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 2---2023-10-11T10:30:40.413527700
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 3---2023-10-11T10:30:40.444268700
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 4---2023-10-11T10:30:40.473866400
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 5---2023-10-11T10:30:40.504620300
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 6---2023-10-11T10:30:40.535400300
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 7---2023-10-11T10:30:40.566022200
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 8---2023-10-11T10:30:40.595970600
消费者2......接收到simple.queue的消息为：hello,Spring Amqp __ 9---2023-10-11T10:30:40.611076800
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 10---2023-10-11T10:30:40.626201300
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 11---2023-10-11T10:30:40.657505500
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 12---2023-10-11T10:30:40.688200
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 13---2023-10-11T10:30:40.717912700
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 14---2023-10-11T10:30:40.748533200
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 15---2023-10-11T10:30:40.778181500
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 16---2023-10-11T10:30:40.808905800
消费者2......接收到simple.queue的消息为：hello,Spring Amqp __ 17---2023-10-11T10:30:40.823251200
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 18---2023-10-11T10:30:40.837450100
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 19---2023-10-11T10:30:40.867629400
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 20---2023-10-11T10:30:40.897964100
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 21---2023-10-11T10:30:40.927968900
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 22---2023-10-11T10:30:40.959483800
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 23---2023-10-11T10:30:40.988862
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 24---2023-10-11T10:30:41.019388500
消费者2......接收到simple.queue的消息为：hello,Spring Amqp __ 25---2023-10-11T10:30:41.034540
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 26---2023-10-11T10:30:41.049536900
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 27---2023-10-11T10:30:41.079546800
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 28---2023-10-11T10:30:41.110340600
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 29---2023-10-11T10:30:41.141704800
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 30---2023-10-11T10:30:41.171164300
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 31---2023-10-11T10:30:41.201884700
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 32---2023-10-11T10:30:41.231497200
消费者2......接收到simple.queue的消息为：hello,Spring Amqp __ 33---2023-10-11T10:30:41.246620400
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 34---2023-10-11T10:30:41.262814300
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 35---2023-10-11T10:30:41.293344400
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 36---2023-10-11T10:30:41.322739
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 37---2023-10-11T10:30:41.352387700
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 38---2023-10-11T10:30:41.382386800
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 39---2023-10-11T10:30:41.412727200
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 40---2023-10-11T10:30:41.443659
消费者2......接收到simple.queue的消息为：hello,Spring Amqp __ 41---2023-10-11T10:30:41.458969
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 42---2023-10-11T10:30:41.475290100
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 43---2023-10-11T10:30:41.504816800
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 44---2023-10-11T10:30:41.535720400
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 45---2023-10-11T10:30:41.565967900
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 46---2023-10-11T10:30:41.596477300
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 47---2023-10-11T10:30:41.625940900
消费者1接收到simple.queue的消息为：hello,Spring Amqp __ 48---2023-10-11T10:30:41.658033
消费者2......接收到simple.queue的消息为：hello,Spring Amqp __ 49---2023-10-11T10:30:41.674047
</code></pre><p>这时消费者打印的消息特快就结束了，快的呢多消费，慢的呢就慢慢来消费。起到能者多劳的功能</p><blockquote><p><strong>总结</strong>：</p><ul><li>多个消费者绑定到一个队列，同一条消息只会被一个消费者处理</li><li>通过设置 prefetch 来控制消费者预取的消息数量</li></ul></blockquote><h4 id="817-发布publish订阅subscribe"><a class="anchor" href="#817-发布publish订阅subscribe">#</a> 8.1.7、发布 (publish)，订阅 (subscribe)🌲</h4><p>发布订阅模式与之前案例的区别就是允许将同一消息发送给多个消费者。实现方式是加入了 exchange (交换机)</p><blockquote><p>上面学习了 RabbitMQ 的两个案例一个是简单队列案例另一个是 WorkQueue 案例，这两个案例有一个共同的特点就是，所发出的消息只可能被一个消费者消费。因为一旦消费完就会从队列中删除而这一特点就无法满足一个需求比如以前说的 支付服务发布的消息要被，订单服务，仓储服务，短信服务。这三个服务各自去完成自己的业务，也就是说发布的这条用户支付成功的消息要被三个服务都接收到。</p><p>这时就需要用到这章的知识了</p></blockquote><p>&lt;center&gt; 模型结构 &lt;/center&gt;</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111042266.png" alt="image-20231011104256966"></p><p><strong>常见 exchange 类型包括</strong>：</p><ul><li>Fanout：广播</li><li>Direct：路由</li><li>Topic：话题</li></ul><p>&lt;font color='red'&gt; 注意 &lt;/font&gt;：exchange 负责消息路由，而不是存储，路由失败则消息丢失</p><h5 id="8171-发布订阅-fanout-exchange"><a class="anchor" href="#8171-发布订阅-fanout-exchange">#</a> 8.1.7.1、发布订阅 - Fanout Exchange🌴</h5><p>Fanout Exchange 会将接收到的消息路由到每一个跟其绑定的 queue</p><blockquote><p>就像混社会的社会人一样，后面两个 consumer 跟着 publisher 混，只要跟着 publisher 混那什么钱啊什么的都不用发愁</p></blockquote><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111051241.gif" alt="test"></p><h5 id="8172-利用springamqp演示fanoutexchange的使用"><a class="anchor" href="#8172-利用springamqp演示fanoutexchange的使用">#</a> 8.1.7.2、利用 SpringAMQP 演示 FanoutExchange 的使用🌴</h5><p>实现思路如下：</p><p>1、在 consumer 服务中，利用代码声明队列，交换机，并将两者绑定</p><p>2、在 consumer 服务中，编写两个消费者方法，分别监听 fanout.queue1 和 fanout.queue2</p><p>3、在 publisher 中编写测试方法，向 itcast.fanout 发送消息</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111110248.png" alt="image-20231011111040177"></p><p><strong>步骤</strong>：</p><p>1、在 consumer 服务声明 Exchange，Queue，Binding</p><p>SpringAMQP 提供了声明交换机，队列，绑定关系的 API，例如：</p><p>在 consumer 服务创建一个配置类，添加 @Configuration 注解，并声明 FanoutExchange，Queue 和绑定关系对象 Binding，代码如下：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Binding</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">BindingBuilder</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">FanoutExchange</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Queue</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="9"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num="10"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num="11"></td><td><pre> * @2023/10/1111:17</pre></td></tr><tr><td data-num="12"></td><td><pre> * @function</pre></td></tr><tr><td data-num="13"></td><td><pre> * @comment</pre></td></tr><tr><td data-num="14"></td><td><pre> */</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token annotation punctuation">@Configuration</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FanoutConfig</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment">// itcast.fanout</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">FanoutExchange</span> <span class="token function">fanoutExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FanoutExchange</span><span class="token punctuation">(</span><span class="token string">"itcast.fanout"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment">// fanout.queue1</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">fanoutQueue1</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">"fanout.queue1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token comment">// 绑定队列 1 到交换机</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">fanoutBinding</span><span class="token punctuation">(</span><span class="token class-name">Queue</span> fanoutQueue1<span class="token punctuation">,</span> <span class="token class-name">FanoutExchange</span> fanoutExchange<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>fanoutQueue1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>fanoutExchange<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token comment">// fanout.queue2</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">fanoutQueue2</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">"fanout.queue2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token comment">// 绑定队列 2 到交换机</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">fanoutBinding1</span><span class="token punctuation">(</span><span class="token class-name">Queue</span> fanoutQueue2<span class="token punctuation">,</span> <span class="token class-name">FanoutExchange</span> fanoutExchange<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>fanoutQueue2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>fanoutExchange<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>2、在 consumer 服务声明两个消费者</p><p>在 consumer 服务的 SpringRabbitListener 类中，添加两个方法，分别监听 fanout.queue1 和 fanout.queue2</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RabbitListener</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="5"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num="6"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num="7"></td><td><pre> * @2023/10/119:34</pre></td></tr><tr><td data-num="8"></td><td><pre> * @function</pre></td></tr><tr><td data-num="9"></td><td><pre> * @comment</pre></td></tr><tr><td data-num="10"></td><td><pre> */</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token annotation punctuation">@Component</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringRabbitListener</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">"fanout.queue1"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenerFanoutQueue1</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"消费者接收到fanout.queue1的消息为："</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">"fanout.queue2"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenerFanoutQueue2</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"消费者接收到fanout.queue2的消息为："</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>3、在 publisher 服务发送消息到 FanoutExchange</p><p>在 publisher 服务的 SpringAmqpTest 类中添加测试方法：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFanoutExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>   <span class="token comment">// 交换机名称</span></pre></td></tr><tr><td data-num="5"></td><td><pre>   <span class="token class-name">String</span> exchangeName <span class="token operator">=</span> <span class="token string">"itcast.fanout"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token comment">// 消息</span></pre></td></tr><tr><td data-num="7"></td><td><pre>   <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">"hello , every one"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>   <span class="token comment">// 发送消息，参数分别是：交互机名称，Routingkey (暂时为空)，消息</span></pre></td></tr><tr><td data-num="9"></td><td><pre>   rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>exchangeName<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>启动消费者的启动类，然后启动发布者的 test 函数进行测试</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111142286.png" alt="image-20231011114245056"></p><blockquote><p><strong>总结</strong>：</p><p>交换机的作用是什么？</p><ul><li>接收 publisher 发送的消息</li><li>将消息按照路由规则路由到与之绑定的队列</li><li>不能缓存消息，路由失败，消息丢失</li><li>FanoutExchange 的会将消息路由到每个绑定的队列</li></ul><p>声明队列，交换机，绑定关系的 Bean 是什么？</p><ul><li>Queue</li><li>FanoutExchange</li><li>Binding</li></ul></blockquote><h4 id="818-发布订阅-directexchange"><a class="anchor" href="#818-发布订阅-directexchange">#</a> 8.1.8、发布订阅 - DirectExchange🌲</h4><p>DirectExchange 会将接收的消息根据<mark>规则路由到指定的 Queue</mark>，因此称为路由模式 (routers)。</p><p><strong>规则</strong>：</p><ul><li>每一个 Queue 都与 Exchange 设置一个 BindingKey，将来利用暗号进行通信，可以有多个 Key</li><li>发布者发送消息时，指定消息的 RoutingKey</li><li>Exchange 将消息路由到 BindingKey 与消息 RoutingKey 一致的队列</li></ul><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111152624.png" alt="image-20231011115208085"></p><h5 id="8181-利用springamqp演示directexchange的使用"><a class="anchor" href="#8181-利用springamqp演示directexchange的使用">#</a> 8.1.8.1、利用 SpringAMQP 演示 DirectExchange 的使用🌴</h5><p><strong>实现思路如下</strong>：</p><p>1、利用 @RabbitListener 声明 Exchange，Queue，RoutingKey</p><p>2、在 consumer 服务中，编写两个消费者方法，分别监听 direct.queue1 和 direct.queue2</p><p>3、在 publisher 中编写测试方法，向 itcast.direct 发送消息</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111158674.png" alt="image-20231011115803693"></p><p>步骤：</p><p>1、利用 @RabbitListener 声明 Exchange，Queue，RoutingKey</p><p>2、在 consumer 服务中，编写两个消费者方法，分别监听 direct.queue1 和 direct.queue2</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="2"></td><td><pre>   <span class="token comment">// 声明队列</span></pre></td></tr><tr><td data-num="3"></td><td><pre>   value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"direct.queue1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>   <span class="token comment">// 声明交换机</span></pre></td></tr><tr><td data-num="5"></td><td><pre>   exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"itcast.direct"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">ExchangeTypes</span><span class="token punctuation">.</span><span class="token constant">DIRECT</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token comment">// 绑定 key</span></pre></td></tr><tr><td data-num="7"></td><td><pre>   key <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenDirectQueue1</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"消费者接收到direct.queue1的消息：["</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="15"></td><td><pre>   <span class="token comment">// 声明队列</span></pre></td></tr><tr><td data-num="16"></td><td><pre>   value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"direct.queue1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>   <span class="token comment">// 声明交换机</span></pre></td></tr><tr><td data-num="18"></td><td><pre>   exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"itcast.direct"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">ExchangeTypes</span><span class="token punctuation">.</span><span class="token constant">DIRECT</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>   <span class="token comment">// 绑定 key</span></pre></td></tr><tr><td data-num="20"></td><td><pre>   key <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenDirectQueue2</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"消费者接收到direct.queue2的消息：["</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>启动服务看下 rabbitmq-ui 管理页面</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111347685.png" alt="image-20231011134749247"></p><p>3、在 publisher 中编写测试方法，向 itcast.direct 发送消息</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDirectExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>   <span class="token comment">// 交换机名称</span></pre></td></tr><tr><td data-num="5"></td><td><pre>   <span class="token class-name">String</span> exchangeName <span class="token operator">=</span> <span class="token string">"itcast.direct"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token comment">// 消息</span></pre></td></tr><tr><td data-num="7"></td><td><pre>   <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">"hello , blue"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>   <span class="token comment">// 发送消息，将消息发送给 key 为 blue 的 Queue</span></pre></td></tr><tr><td data-num="9"></td><td><pre>   rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>exchangeName<span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">//------------------ 打印结果 ------------------</span></pre></td></tr><tr><td data-num="12"></td><td><pre>消费者接收到direct<span class="token punctuation">.</span>queue1的消息：<span class="token punctuation">[</span>hello <span class="token punctuation">,</span> blue<span class="token punctuation">]</span></pre></td></tr></table></figure><p>将绑定的 key 改为 yellow 呢，记得将发送消息改为 “hello yellow”</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 发送消息，将消息发送给 key 为 blue 的 Queue</span></pre></td></tr><tr><td data-num="2"></td><td><pre>rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>exchangeName<span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">//---------------- 打印结果 ----------------</span></pre></td></tr><tr><td data-num="4"></td><td><pre>消费者接收到direct<span class="token punctuation">.</span>queue2的消息：<span class="token punctuation">[</span>hello <span class="token punctuation">,</span> yellow<span class="token punctuation">]</span></pre></td></tr></table></figure><p>将绑定的 key 改为 red 呢，记得将发送消息改为 “hello red”</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 发送消息，将消息发送给 key 为 blue 的 Queue</span></pre></td></tr><tr><td data-num="2"></td><td><pre>rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>exchangeName<span class="token punctuation">,</span> <span class="token string">"red"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>消费者接收到direct<span class="token punctuation">.</span>queue2的消息：<span class="token punctuation">[</span>hello <span class="token punctuation">,</span> red<span class="token punctuation">]</span>消费者接收到direct<span class="token punctuation">.</span>queue1的消息：<span class="token punctuation">[</span>hello <span class="token punctuation">,</span> red<span class="token punctuation">]</span></pre></td></tr></table></figure><blockquote><p><strong>总结</strong>：</p><p>描述下 Direct 交换机与 Fanout 交换机的差异？</p><ul><li>Fanout 交换机将消息路由给每一个与之绑定的队列</li><li>Direct 交换机根据 RoutingKey 判断路由给哪个队列</li><li>如果多个队列具有相同的 RoutingKey，则与 Fanout 功能类似</li></ul><p>基于 @RabbitListener 注解声明队列和交换机有哪些常见注解？</p><ul><li>@Queue</li><li>Exchange</li></ul></blockquote><h4 id="819-发布订阅-topicexchange"><a class="anchor" href="#819-发布订阅-topicexchange">#</a> 8.1.9、发布订阅 - TopicExchange🌲</h4><p>TopicExchange 与 DirectExchange 类似，区别在于 routingKey 必须是多个单词的列表，并且以 。 分割。</p><p>Queue 与 Exchange 指定 BindingKey 时可以使用通配符：</p><p><code>#</code> ：代指 0 个或多个单词</p><p><code>*</code> ：代指一个单词</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111449230.png" alt="image-20231011144903570"></p><h5 id="8191-利用springamqp演示topicexchange的使用"><a class="anchor" href="#8191-利用springamqp演示topicexchange的使用">#</a> 8.1.9.1、利用 SpringAMQP 演示 TopicExchange 的使用🌴</h5><p>实现思路如下：</p><p>1、利用 @RabbitListener 声明 Exchange，Queue，RoutingKey</p><p>2、在 consumer 服务中，编写两个消费者方法，分别监听 topic.queue1 和 topic.queue2</p><p>3、在 publisher 中编写测试方法，向 itcast.topic 发送消息</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111452582.png" alt="image-20231011145232937"></p><p>步骤：</p><p>1、利用 @RabbitListener 声明 Exchange，Queue，RoutingKey</p><p>2、在 consumer 服务中，编写两个消费者方法，分别监听 topic.queue1 和 topic.queue2</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">ExchangeTypes</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Exchange</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Queue</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">QueueBinding</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RabbitListener</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="9"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num="10"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num="11"></td><td><pre> * @2023/10/119:34</pre></td></tr><tr><td data-num="12"></td><td><pre> * @function</pre></td></tr><tr><td data-num="13"></td><td><pre> * @comment</pre></td></tr><tr><td data-num="14"></td><td><pre> */</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token annotation punctuation">@Component</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringRabbitListener</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"topic.queue1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"itcast.topic"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">ExchangeTypes</span><span class="token punctuation">.</span><span class="token constant">TOPIC</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            key <span class="token operator">=</span> <span class="token string">"china.#"</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenTopicQueue1</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"消费者接收到topic.queue1的消息：["</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"topic.queue2"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"itcast.topic"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">ExchangeTypes</span><span class="token punctuation">.</span><span class="token constant">TOPIC</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            key <span class="token operator">=</span> <span class="token string">"#.news"</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenTopicQueue2</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"消费者接收到topic.queue2的消息：["</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>3、在 publisher 中编写测试方法，向 itcast.topic 发送消息</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSendTopicExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>   <span class="token class-name">String</span> exchangeName <span class="token operator">=</span> <span class="token string">"itcast.topic"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>   <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">"郭明然上市了不要888不要999只要9.9就能带回家"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>exchangeName<span class="token punctuation">,</span> <span class="token string">"china.news"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">//-------------------------- 打印结果 --------------------------</span></pre></td></tr><tr><td data-num="9"></td><td><pre>消费者接收到topic<span class="token punctuation">.</span>queue2的消息：<span class="token punctuation">[</span>郭明然上市了不要<span class="token number">888</span>不要<span class="token number">999</span>只要<span class="token number">9.9</span>就能带回家<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="10"></td><td><pre>消费者接收到topic<span class="token punctuation">.</span>queue1的消息：<span class="token punctuation">[</span>郭明然上市了不要<span class="token number">888</span>不要<span class="token number">999</span>只要<span class="token number">9.9</span>就能带回家<span class="token punctuation">]</span></pre></td></tr></table></figure><blockquote><p><strong>总结</strong>：</p><p>描述下 Direct 交换机与 Topic 交换机的差异？</p><ul><li>Topic 交换机支持通配符，不支持多个 key</li><li>bindingKey：通配符，routingkey：多个单词</li><li>#：0 个或多个</li><li>*：一个</li></ul></blockquote><h4 id="8110-测试发送object类型消息"><a class="anchor" href="#8110-测试发送object类型消息">#</a> 8.1.10、测试发送 Object 类型消息🌲</h4><p><strong>说明</strong>：在 SpringAMQP 的发送方法中，接收消息的类型是 Object，也就是说我们可以发送任意对象类型的消息，SpringAMQP 会帮我们序列化为字节后发送</p><p>可以看到函数参数都是 Object 类型的，那么就表示可以传递任意类型的 java 对象进去了吗？</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111554481.png" alt="image-20231011155439361"></p><p>创建一个队列</p><p>我们在 consumer 中利用 @Bean 声明一个队列：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Queue</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="6"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num="7"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num="8"></td><td><pre> * @2023/10/1111:17</pre></td></tr><tr><td data-num="9"></td><td><pre> * @function</pre></td></tr><tr><td data-num="10"></td><td><pre> * @comment</pre></td></tr><tr><td data-num="11"></td><td><pre> */</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token annotation punctuation">@Configuration</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FanoutConfig</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">objectQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">"object.queue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>查看 rabbitmq 的 ui 管理页面</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111602511.png" alt="image-20231011160243062"></p><p>在 publisher 中发送消息以测试：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSendObjectQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>   <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>   map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"刘桑"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>   rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">"object.queue"</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>查看消息发送的详细信息</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111611580.png" alt="image-20231011161154919"></p><h5 id="81101-消息转换器"><a class="anchor" href="#81101-消息转换器">#</a> 8.1.10.1、消息转换器🌴</h5><p>Spring 在对消息对象的处理是由 org.springframework.amqp.support.converter.MessageConverter 来处理的。而默认实现是 SimpleMessageConverter，基于 JDK 的 ObjectOutputStream 完成序列化。</p><p>如果要修改只需要定义一个 MessageConverter 类型的 Bean 即可。推荐用 JSON 方式序列化，步骤如下：</p><p>1、我们在 publisher 服务引入依赖</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jackson-databind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>2、我们在 publisher 服务启动类中声明 MessageConverter</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>support<span class="token punctuation">.</span>converter<span class="token punctuation">.</span></span><span class="token class-name">Jackson2JsonMessageConverter</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>support<span class="token punctuation">.</span>converter<span class="token punctuation">.</span></span><span class="token class-name">MessageConverter</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token annotation punctuation">@SpringBootApplication</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PublisherApplication</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">PublisherApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">MessageConverter</span> <span class="token function">messageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>清空之前的队列中的消息</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111643872.png" alt="image-20231011164323272"></p><p>再次运行测试函数，然后查看 RabbitMQ 中的消息详细情况</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111644952.png" alt="image-20231011164413896"></p><p>消息发送的时候把对象序列化为 JSON，接收时反过来反序列化为对象</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111644991.png" alt="image-20231011164436624"></p><p>3、消费者接受消息</p><p>我们需要再消费者里面也加上 MessageConverter 进行反序列化。否则取消息就会报错</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>support<span class="token punctuation">.</span>converter<span class="token punctuation">.</span></span><span class="token class-name">Jackson2JsonMessageConverter</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>support<span class="token punctuation">.</span>converter<span class="token punctuation">.</span></span><span class="token class-name">MessageConverter</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="7"></td><td><pre> * @author Dkx</pre></td></tr><tr><td data-num="8"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num="9"></td><td><pre> * @2023/10/1117:31</pre></td></tr><tr><td data-num="10"></td><td><pre> * @function</pre></td></tr><tr><td data-num="11"></td><td><pre> * @comment</pre></td></tr><tr><td data-num="12"></td><td><pre> */</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token annotation punctuation">@Configuration</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RabbitMQConfig</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">MessageConverter</span> <span class="token function">messageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>启动消费者启动类，启动生产者的测试函数查看结果：</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310111736739.png" alt="image-20231011173617788"></p><blockquote><p><strong>总结</strong>:</p><p>SpringAMQP 中消息的序列化和反序列化是怎么实现的？</p><ul><li>利用 MessageConverter 实现的，默认是 JDK 的序列化</li><li>注意发送与接收方必须使用相同的 MessageConverter</li></ul></blockquote><div class="tags"><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E7%A7%91/" rel="tag"><i class="ic i-tag"></i> 计算机学科</a> <a href="/tags/springcloud/" rel="tag"><i class="ic i-tag"></i> springcloud</a> <a href="/tags/RabbitMQ/" rel="tag"><i class="ic i-tag"></i> RabbitMQ</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-01-06 10:44:48" itemprop="dateModified" datetime="2024-01-06T10:44:48+08:00">2024-01-06</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Dkx 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Dkx 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="Dkx 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Dkx： </strong>Dkx <i class="ic i-at"><em>@</em></i>Dkx の Java 小窝</li><li class="link"><strong>本文链接：</strong> <a href="https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/RabbitMQ/springcloud-%E5%BC%82%E6%AD%A5%E9%80%9A%E8%AE%AF/" title="八、RabbitMQ 服务异步通讯">https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/RabbitMQ/springcloud-异步通讯/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/computer-science/java/spring/springcloud/RabbitMQ/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;img.timelessq.com&#x2F;images&#x2F;2022&#x2F;07&#x2F;26&#x2F;a8d0ac76b87f7593653e29559d61b32d.jpg" title="RabbitMQ部署指南-单击部署"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> RabbitMQ</span><h3>RabbitMQ部署指南-单击部署</h3></a></div><div class="item right"><a href="/computer-science/java/spring/springcloud/RabbitMQ/%E9%AB%98%E7%BA%A7/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;img.timelessq.com&#x2F;images&#x2F;2022&#x2F;07&#x2F;26&#x2F;666b3077b407f3c0ce9c10c00b861abe.jpg" title="RabbitMQ部署指南-集群部署"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 高级</span><h3>RabbitMQ部署指南-集群部署</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB-%E6%9C%8D%E5%8A%A1%E5%BC%82%E6%AD%A5%E9%80%9A%E8%AE%AF"><span class="toc-number">1.</span> <span class="toc-text">八、服务异步通讯🎄</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#81-%E5%88%9D%E5%A7%8Bmq"><span class="toc-number">1.1.</span> <span class="toc-text">8.1、初始 MQ🌳</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#811-%E5%90%8C%E6%AD%A5%E8%B0%83%E7%94%A8%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.1.</span> <span class="toc-text">8.1.1、同步调用的问题🌲</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#812-%E5%BC%82%E6%AD%A5%E8%B0%83%E7%94%A8%E6%96%B9%E6%A1%88"><span class="toc-number">1.1.2.</span> <span class="toc-text">8.1.2、异步调用方案🌲</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#813-%E4%BB%80%E4%B9%88%E6%98%AFmq"><span class="toc-number">1.1.3.</span> <span class="toc-text">8.1.3、什么是 MQ🌲</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#814-rabbitmq%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">1.1.4.</span> <span class="toc-text">8.1.4、RabbitMQ 快速入门🌲</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#8141-rabbitmq%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">8.1.4.1、RabbitMQ 概述🌴</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8142-%E5%B8%B8%E8%A7%81%E6%B6%88%E6%81%AF%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">8.1.4.2、常见消息模型🌴</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8143-helloworld%E6%A1%88%E4%BE%8B"><span class="toc-number">1.1.4.3.</span> <span class="toc-text">8.1.4.3、HelloWorld 案例🌴</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#815-springamqp"><span class="toc-number">1.1.5.</span> <span class="toc-text">8.1.5、SpringAMQP🌲</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#8151-%E4%BB%80%E4%B9%88%E6%98%AFspringamqp"><span class="toc-number">1.1.5.1.</span> <span class="toc-text">8.1.5.1、什么是 SpringAMQP🌴</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8152-%E6%A1%88%E4%BE%8B%E5%88%A9%E7%94%A8springamqp%E5%AE%9E%E7%8E%B0helloworld%E4%B8%AD%E7%9A%84%E5%9F%BA%E7%A1%80%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E5%8A%9F%E8%83%BD"><span class="toc-number">1.1.5.2.</span> <span class="toc-text">8.1.5.2、案例，利用 SpringAMQP 实现 HelloWorld 中的基础消息队列功能🌴</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#816-work-queue%E5%B7%A5%E4%BD%9C%E9%98%9F%E5%88%97"><span class="toc-number">1.1.6.</span> <span class="toc-text">8.1.6、Work Queue 工作队列🌲</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#8161-%E6%A8%A1%E6%8B%9Fworkqueue%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%98%9F%E5%88%97%E7%BB%91%E5%AE%9A%E5%A4%9A%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">1.1.6.1.</span> <span class="toc-text">8.1.6.1、模拟 WorkQueue，实现一个队列绑定多个消费者🌴</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%AF%E4%BB%A5%E5%AF%B9%E6%B6%88%E6%81%AF%E9%A2%84%E5%8F%96%E8%BF%9B%E8%A1%8C%E9%85%8D%E7%BD%AE%E9%99%90%E5%88%B6"><span class="toc-number">1.1.6.1.1.</span> <span class="toc-text">可以对消息预取进行配置限制🎋</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#817-%E5%8F%91%E5%B8%83publish%E8%AE%A2%E9%98%85subscribe"><span class="toc-number">1.1.7.</span> <span class="toc-text">8.1.7、发布 (publish)，订阅 (subscribe)🌲</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#8171-%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85-fanout-exchange"><span class="toc-number">1.1.7.1.</span> <span class="toc-text">8.1.7.1、发布订阅 - Fanout Exchange🌴</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8172-%E5%88%A9%E7%94%A8springamqp%E6%BC%94%E7%A4%BAfanoutexchange%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.1.7.2.</span> <span class="toc-text">8.1.7.2、利用 SpringAMQP 演示 FanoutExchange 的使用🌴</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#818-%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85-directexchange"><span class="toc-number">1.1.8.</span> <span class="toc-text">8.1.8、发布订阅 - DirectExchange🌲</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#8181-%E5%88%A9%E7%94%A8springamqp%E6%BC%94%E7%A4%BAdirectexchange%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.1.8.1.</span> <span class="toc-text">8.1.8.1、利用 SpringAMQP 演示 DirectExchange 的使用🌴</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#819-%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85-topicexchange"><span class="toc-number">1.1.9.</span> <span class="toc-text">8.1.9、发布订阅 - TopicExchange🌲</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#8191-%E5%88%A9%E7%94%A8springamqp%E6%BC%94%E7%A4%BAtopicexchange%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.1.9.1.</span> <span class="toc-text">8.1.9.1、利用 SpringAMQP 演示 TopicExchange 的使用🌴</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8110-%E6%B5%8B%E8%AF%95%E5%8F%91%E9%80%81object%E7%B1%BB%E5%9E%8B%E6%B6%88%E6%81%AF"><span class="toc-number">1.1.10.</span> <span class="toc-text">8.1.10、测试发送 Object 类型消息🌲</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#81101-%E6%B6%88%E6%81%AF%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="toc-number">1.1.10.1.</span> <span class="toc-text">8.1.10.1、消息转换器🌴</span></a></li></ol></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/computer-science/java/spring/springcloud/RabbitMQ/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/" rel="bookmark" title="RabbitMQ部署指南-单击部署">RabbitMQ部署指南-单击部署</a></li><li class="active"><a href="/computer-science/java/spring/springcloud/RabbitMQ/springcloud-%E5%BC%82%E6%AD%A5%E9%80%9A%E8%AE%AF/" rel="bookmark" title="八、RabbitMQ服务异步通讯">八、RabbitMQ服务异步通讯</a></li><li><a href="/computer-science/java/spring/springcloud/RabbitMQ/%E9%AB%98%E7%BA%A7/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/" rel="bookmark" title="RabbitMQ部署指南-集群部署">RabbitMQ部署指南-集群部署</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Dkx" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Dkx</p><div class="description" itemprop="description">欢迎来我的博客空间</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">189</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">69</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">117</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1BpZ1BpZ0xldHNHbw==" title="https:&#x2F;&#x2F;github.com&#x2F;PigPigLetsGo"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9Ea3gxMjE5" title="https:&#x2F;&#x2F;twitter.com&#x2F;Dkx1219"><i class="ic i-twitter"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS96dWktaG91LXllLWJlaS1sdWUtc2hh" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;zui-hou-ye-bei-lue-sha"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTU3NjUxMDQ1OQ==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;576510459"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93d3cud2VpYm8uY29tL3UvNTk5OTU0OTg0MQ==" title="https:&#x2F;&#x2F;www.weibo.com&#x2F;u&#x2F;5999549841"><i class="ic i-weibo"></i></span> <span class="exturl item facebook" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDA5NDA4Nzc0ODIwMQ==" title="https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100094087748201"><i class="ic i-facebook"></i></span> <span class="exturl item stackoverflow" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS91c2Vycy8xOTQwNjAyOS9kLWt4" title="https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;19406029&#x2F;d-kx"><i class="ic i-stack-overflow"></i></span> <span class="exturl item youtube" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vQERreC12djdsbQ==" title="https:&#x2F;&#x2F;www.youtube.com&#x2F;@Dkx-vv7lm"><i class="ic i-youtube"></i></span> <span class="exturl item instagram" data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS9kb3Vka3g/aWdzaD1PR1E1WkRjMk9EazJaQSUzRCUzRCZ1dG1fc291cmNlPXFy" title="https:&#x2F;&#x2F;www.instagram.com&#x2F;doudkx?igsh&#x3D;OGQ5ZDc2ODk2ZA%3D%3D&amp;utm_source&#x3D;qr"><i class="ic i-instagram"></i></span> <span class="exturl item telegram" data-url="aHR0cHM6Ly90Lm1lL2RvdTAxMDg=" title="https:&#x2F;&#x2F;t.me&#x2F;dou0108"><i class="ic i-twitter"></i></span> <span class="exturl item skype" data-url="aHR0cHM6Ly9qb2luLnNreXBlLmNvbS9UN25TSWhvbmMxcWQ=" title="https:&#x2F;&#x2F;join.skype.com&#x2F;T7nSIhonc1qd"><i class="ic i-skype"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>链接</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/computer-science/java/spring/springcloud/RabbitMQ/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/computer-science/java/spring/springcloud/RabbitMQ/%E9%AB%98%E7%BA%A7/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/programming-questions/" title="分类于 编程题">编程题</a></div><span><a href="/computer-science/java/programming-questions/%E6%95%B0%E6%8D%AE%E6%B5%81%E7%9A%84%E4%B8%AD%E4%BD%8D%E6%95%B01/" title="数据流的中位数1">数据流的中位数1</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/math/" title="分类于 math">math</a></div><span><a href="/math/%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E7%AE%97%E6%B3%95/" title="欧几里得算法">欧几里得算法</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/spring/" title="分类于 spring">spring</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/spring/springcloud/" title="分类于 springcloud">springcloud</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/spring/springcloud/Nacos/" title="分类于 Nacos">Nacos</a></div><span><a href="/computer-science/java/spring/springcloud/Nacos/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/" title="Nacos安装指南">Nacos安装指南</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/programming-questions/" title="分类于 编程题">编程题</a></div><span><a href="/computer-science/java/programming-questions/%E4%BA%8C%E5%8F%89%E6%A0%91%E6%9C%80%E5%A4%A7%E6%B7%B1%E5%BA%A6-%E4%BD%BF%E7%94%A8%E9%9D%9E%E9%80%92%E5%BD%92%E5%90%8E%E5%BA%8F%E9%81%8D%E5%8E%86%E5%AE%9E%E7%8E%B0/" title="二叉树最大深度-使用非递归后序遍历求解">二叉树最大深度-使用非递归后序遍历求解</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/web/" title="分类于 web">web</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/web/%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92/" title="分类于 前后端交互">前后端交互</a></div><span><a href="/computer-science/web/%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92/Fetch/" title="Fetch">Fetch</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/programming-questions/" title="分类于 编程题">编程题</a></div><span><a href="/computer-science/java/programming-questions/%E5%90%88%E5%B9%B6K%E4%B8%AA%E5%8D%87%E5%BA%8F%E9%93%BE%E8%A1%A8/" title="合并K个升序链表">合并K个升序链表</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/programming-questions/" title="分类于 编程题">编程题</a></div><span><a href="/computer-science/java/programming-questions/%E7%9B%9B%E6%9C%80%E5%A4%9A%E6%B0%B4%E7%9A%84%E5%AE%B9%E5%99%A8/" title="盛最多水的容器">盛最多水的容器</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/programming-questions/" title="分类于 编程题">编程题</a></div><span><a href="/computer-science/java/programming-questions/%E5%88%A0%E9%99%A4%E6%8E%92%E5%BA%8F%E9%93%BE%E8%A1%A8%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E5%85%83%E7%B4%A0-83/" title="删除排序链表中的重复元素-83">删除排序链表中的重复元素-83</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/databse/" title="分类于 database">database</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/databse/mongodb/" title="分类于 mongodb">mongodb</a></div><span><a href="/computer-science/database/mongodb/MongoDB%E9%9B%86%E7%BE%A4%E5%92%8C%E5%AE%89%E5%85%A8/" title="MongoDB集群和安全">MongoDB集群和安全</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/data-structures-and-algorithms/" title="分类于 数据结构与算法">数据结构与算法</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/data-structures-and-algorithms/%E5%A0%86/" title="分类于 堆">堆</a></div><span><a href="/computer-science/java/data-structures-and-algorithms/%E5%A0%86/%E5%A0%86-heapify1/" title="堆-heapify1">堆-heapify1</a></span></li></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Dkx @ Dou的个人博客</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">2.2m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">33:09</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"computer-science/java/spring/springcloud/RabbitMQ/springcloud-异步通讯/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="https://cdn.jsdelivr.net/gh/PigPigLetsGo/live2d-widget@latest/autoload.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>