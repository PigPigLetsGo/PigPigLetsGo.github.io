<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="D の Java" href="https://pigpigletsgo.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="D の Java" href="https://pigpigletsgo.github.io/atom.xml"><link rel="alternate" type="application/json" title="D の Java" href="https://pigpigletsgo.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="计算机学科,springcloud,Docker"><link rel="canonical" href="https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Docker/springcloud-docker/"><title>七、Docker - Docker - springcloud - spring - java - 计算机学科 | D & PersonalBlog = D の Java = 别怕路长梦远</title><meta name="generator" content="Hexo 5.4.2"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">七、Docker</h1><div class="meta"><span class="item" title="创建时间：2024-01-24 18:48:46"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2024-01-24T18:48:46+08:00">2024-01-24</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>39k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>36 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">D & PersonalBlog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/a8d0ac76b87f7593653e29559d61b32d.jpg"></li><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/6a834199cae04e75c335d444704c2060.jpg"></li><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/0a8c679b59d7b4a6f86d891282323a50.jpg"></li><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/46d0371c19c0586fb0629e97bac23133.jpg"></li><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/5bf6cc840c1eee492a78927590510321.jpg"></li><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/6edf0eae0c5c58dadd09198c6c3c9f6d.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/" itemprop="item" rel="index" title="分类于 计算机学科"><span itemprop="name">计算机学科</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/java/" itemprop="item" rel="index" title="分类于 java"><span itemprop="name">java</span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/java/spring/" itemprop="item" rel="index" title="分类于 spring"><span itemprop="name">spring</span></a><meta itemprop="position" content="3"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/java/spring/springcloud/" itemprop="item" rel="index" title="分类于 springcloud"><span itemprop="name">springcloud</span></a><meta itemprop="position" content="4"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/java/spring/springcloud/Docker/" itemprop="item" rel="index" title="分类于 Docker"><span itemprop="name">Docker</span></a><meta itemprop="position" content="5"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Docker/springcloud-docker/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="D"><meta itemprop="description" content="别怕路长梦远, 欢迎来我的博客空间"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="D の Java"></span><div class="body md" itemprop="articleBody"><h2 id="七-docker"><a class="anchor" href="#七-docker">#</a> 七、Docker🎄</h2><p>查看 docker 安装：<a href="./Docker/Centos7%E5%AE%89%E8%A3%85Docker.md">Docker 安装</a>.</p><ul><li>初始 Docker</li><li>Docker 的基本操作</li><li>Dockerfile 自定义镜像</li><li>Docker-Compose</li><li>Docker 镜像服务</li></ul><h3 id="71-初始docker"><a class="anchor" href="#71-初始docker">#</a> 7.1、初始 Docker🌳</h3><ul><li>什么是 Docker</li><li>Docker 和虚拟机的区别</li><li>Docker 架构</li><li>安装 Docker</li></ul><blockquote><p>项目部署的问题</p><ul><li>依赖关系复杂，容易出现兼容性问题</li><li>开发，测试，生产环境有差异</li></ul><p>大型项目组件较多，运行环境也较为复杂，部署时会碰到一些问题：</p><p>所有的应该都会部署到服务器上，而大多数服务都会采用 Linux 操作系统，在安装到 Linux 操作系统之前要做一些准备工作。因为这些应用都会有自己所需要的依赖和函数库。这时如此复杂的依赖关系很容易出现，兼容性问题，废了半天劲把这些问题都解决了你会发现这只是开始搞定了开发环境，还有测试环境，生产环境，预发环境等等。最可怕的是这些环境它们的 Linux 操作系统有可能不同</p></blockquote><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310080937247.png" alt="image-20231008093734523"></p><h4 id="711-docker如何解决依赖的兼容问题"><a class="anchor" href="#711-docker如何解决依赖的兼容问题">#</a> 7.1.1、Docker 如何解决依赖的兼容问题？🌲</h4><ul><li>将应用的 Libs (函数库)，Deps (依赖)，配置与应用一起打包</li><li>将每个应该放到一个隔离<strong>容器</strong>去运行，避免互相干扰</li></ul><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310080942590.png" alt="image-20231008094222259"></p><p>现在不用考虑依赖的问题了，但是这只是解决了混乱依赖的问题。有了 Docker 不用去管了应用程序随时可以运行但是仅限于同一个操作系统。因为在打包这个应用时肯定会基于某种操作系统打包吧，比如这个应该是 ubuntu 版本的那么它的函数库和依赖肯定也是 ubuntu 版本的。把这个打包好的程序放到 CentOs 上肯定不能运行，那么 Docker 是怎么解决这个问题的呢？</p><p>要想知道 Docker 如何跨系统运行，我们得先知道操作系统的结构</p><h4 id="712-基本了解操作系统结构"><a class="anchor" href="#712-基本了解操作系统结构">#</a> 7.1.2、基本了解操作系统结构🌲</h4><p>以 ubuntu 为例讲讲操作系统结构</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310080947687.png" alt="image-20231008094755054"></p><p>所有的 Linux 操作系统都可以分为两层：</p><p>一层是大家共享的内核 (Linux 内核)</p><p>而区别在于不同操作系统之间它们的上层系统应用不同</p><blockquote><p>那内核做什么的呢？</p><p>内核与硬件交互，提供操作硬件的指令</p></blockquote><blockquote><p>系统应用做什么的呢？</p><p>将内核的指令进行一个组装，再封装形成函数，区域多的函数变成函数库，程序员可以基于这些函数库进行开发。程序调用函数库，函数库调用内核指令，指令调用计算机硬件从而实现应用的执行</p></blockquote><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310080957223.png" alt="image-20231008095659859"></p><p>这就是 Linux 系统的基本结构以及应用的执行原理了</p><p>那么问题来了：为什么 Ubuntu 系统上的应用为什么不能在 CentOs 上运行呢？</p><p>Ubuntu 和 CentOS 都是基于 Linux 内核，只是系统应用不同，提供的函数库有差异</p><p>这时把 Ubuntu 上的应用比如说 mysql 给它迁移到 CentOS 上尝试去执行当它去调用一个函数库时，因为代码是写死的而发现这个函数库在 centos 上根本不存在或者名字不一样那么程序就会报错。这就是为什么 应用不能跨系统运行的原因</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310080958994.png" alt="image-20231008095848662"></p><p>那针对上面的问题 Docker 干了什么事儿呢？</p><ul><li>Docker 将用户程序与所需要调用的系统 (比如 Ubuntu) 函数库一起打包</li><li>Docker 运行到不同操作系统时，直接基于打包的库函数，借助于操作系统的 Linux 内核来运行。</li></ul><p>将当前系统的函数库与应用一起打包那么随便放到任何的 Linux 操作系统上只要是 Linux 内核，应用在执行的时候调用打包好的函数库，而这个函数库直接调用操作系统的内核而内核直接访问硬件这个调用就完成了。</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081059529.png" alt="image-20231008105934407"></p><p>至此，Docker 就解决了跨系统的问题了，可以理解为 Docker 打包好的应用可以运行在任何的 Linux 内核的操作系统上</p><blockquote><p><strong>Docker</strong>：</p><p>Docker 如何解决大型项目以来关系复杂，不同组件依赖的兼容性问题？</p><ul><li>Docker 允许开发中将应用，依赖，函数库，配置一起 &lt;font color='red'&gt; 打包 &lt;/font&gt;，形成可移植镜像</li><li>Docker 应用运行在容器中，使用沙箱机制，相互 &lt;font color='red'&gt; 隔离 &lt;/font&gt;.</li></ul><p>Docker 如何解决开发，测试，生产环境有差异的问题</p><ul><li>Docker 镜像中包含完整运行环境，包括系统函数库，仅依赖系统的 Linux 内核，因此可以在任意 Linux 操作系统上运行</li></ul></blockquote><blockquote><p>总结：</p><p>Docker 是一个快速交付应用，运行应用的技术：</p><ol><li>可以将程序及其依赖，运行环境一起打包为一个镜像，可以迁移到任意 Linux 操作系统</li><li>运行时利用沙箱机制形成隔离容器，各个应用互不干扰</li><li>启动，移除都可以通过一行命令完成，方便快捷</li></ol></blockquote><h3 id="72-docker与虚拟机"><a class="anchor" href="#72-docker与虚拟机">#</a> 7.2、Docker 与虚拟机🌳</h3><p>我们知道 Docker 可以实现一个应用可以在不同的 Linux 操作系统上运行和部署。而虚拟机也可以达到类似的效果，那它们两个的实现又有什么样的差别呢</p><p>首先回顾下 Docker 的实现原理，Docker 会把应用及其所需要的依赖，函数库，甚至于操作系统函数库也一起打包，这样 当应用运行时可以直接调用本地函数库而后与操作系统的内核进行交互。这样就不用关心操作系统是什么系统了，于是就能实现跨系统运行了</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081112122.png" alt="image-20231008111240399"></p><p>那虚拟机呢？</p><p>它怎么实现在一个系统里装了另一个系统呢。它是用了一个名为：Hyperisor 的技术，可以模拟出一个计算机的各种各样的硬件比如 CPU，内存等等，然后在这个模拟出的计算机上就可以去安装任意你想要的操作系统了，而操作系统又可以安装任意适合的依赖，函数库以及应用，那这样它不就实现跨系统的部署了吗</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081116627.png" alt="image-20231008111617105"></p><p>虚拟机是在一个系统里装了另外一个系统，所以当应用执行时，它会以为自己在一台真实的电脑上。因此它会先调用虚拟机内置的操作系统而它在与 Hypervisor 进行交互，然后再把信息传递给外部的操作系统，外部操作系统再去调用计算机硬件，于是应用执行就完成了。</p><p>可以看到虚拟机启动应用经过了层层传递所以性能是比较差的</p><p>&lt;center&gt; 两者之间的差异 &lt;/center&gt;</p><table><thead><tr><th>特性</th><th>Docker</th><th>虚拟机</th></tr></thead><tbody><tr><td>性能</td><td>接近原生</td><td>性能较差</td></tr><tr><td>硬盘占用</td><td>一般为 MB</td><td>一般为 GB</td></tr><tr><td>启动</td><td>秒级</td><td>分钟级</td></tr></tbody></table><blockquote><p><strong>总结</strong>：</p><p>Docker 和虚拟机的差异：</p><ul><li>Docker 是一个系统进程；虚拟机是在操作系统中的操作系统</li><li>Docker 体积小，启动速度快，性能好；虚拟机体积大，启动速度慢，性能一般</li></ul></blockquote><h3 id="72-镜像和容器"><a class="anchor" href="#72-镜像和容器">#</a> 7.2、镜像和容器🌳</h3><p><strong>镜像 (Image)</strong>：Docker 将应用程序及其所需的依赖，函数库，环境，配置等文件打包在一起，称为镜像。</p><p>简单可以理解为，镜像就是一个文件。</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081127213.png" alt="image-20231008112658929"></p><p><strong>容器 (Container)</strong>：镜像中的应用程序运行后形成的进程就是 &lt;font color='red'&gt; 容器 &lt;/font&gt;，只是 Docker 会给容器做隔离，对外不可见。</p><p>简单可以理解为，把这个 mysql 应用运行起来形成的这个进程就是容器，只不过在 Docker 里面容器还要做隔离</p><p>也就是说我们可以将容器看做是一个小盒子，这个盒子里面将来会利用 Linux 手段给它形成隔离空间。里面会有自己独立的 CPU 资源，内存资源，甚至于还有独立的文件系统。那么因此在这个容器内运行的这个进程，它就会以为自己是在这台计算机上的唯一进程了从而起到一种隔离的效果，将来 mysql 镜像不管是启动一个容器还是多个容器，它们之间都是相互隔离的，当容器运行的过程中必然会做数据读写的操作。比方说 mysql 要去存数据，存储到 data 目录中。但是不能将数据写到镜像的 data 目录中去。镜像都是只读的</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081248648.png" alt="image-20231008124821994"></p><h3 id="73-共享镜像"><a class="anchor" href="#73-共享镜像">#</a> 7.3、共享镜像🌳</h3><h4 id="731-docker和dockerhub"><a class="anchor" href="#731-docker和dockerhub">#</a> 7.3.1、Docker 和 DockerHub🌲</h4><ul><li>DockerHub：是一个 Docker 镜像的托管平台。这样的平台称为 Docker Registry。</li></ul><p>程序员可以利用 Docker 提供的一些命令去完成镜像的构建，构建出 mysql，redis 等等各种各样的镜像</p><p>然后把这些镜像上传到 DockerHub 服务器上</p><ul><li>国内也有类似于 DockerHub 的公开服务，比如 网易云镜像服务，阿里云镜像库等。</li><li>可以搭建私有的云服务</li></ul><p>这些都叫 Docker Registry</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081254620.png" alt="image-20231008125404165"></p><p>我们要怎么利用 Docker 完成镜像构建或者是从远端拉取镜像呢又该怎么去运行容器呢？</p><p>这就需要了解 Docker 的架构了</p><h3 id="74-docker架构"><a class="anchor" href="#74-docker架构">#</a> 7.4、Docker 架构🌳</h3><p>Docker 是一个 CS 架构的程序，由两部分组成：</p><ul><li><p>服务端 (server)：Docker 守护进程，负责处理 Docker 指令，管理镜像，容器等</p><p>负责接收用户指令完成镜像和容器的各种各样的操作，不管是构建镜像还是从远端拉取镜像还是运行容器都是由 server 端来完成的 ，那谁给 server 端下指令呢？自然就是 client 端了</p></li><li><p>客户端 (client)：通过命令或 RestAPI 向 Docker 服务端发送指令。可以在本地或远程向服务端发送指令。</p><p>这个要看在哪发送指令，如果是在 Docker 所在的机器上就直接用命令就可以了。如果是远程操作 Docker 就用 RestAPI 发</p></li></ul><p>比方说就是本地发通过命令：dokcer build 可以构建镜像，这个命令到达 docker server 后会被 docker 的守护进程 docker daemon 接收和处理。它会利用你提供的数据构建成一个镜像。除了这种方式获取镜像以外我们还可以去 docker registry 中拉取镜像，使用命令：docker pull 这个命令发送到 docker server 端后 docker daemon 就会去 docker registry 中拉取我们指定的镜像了。下面就是运行镜像创建容器了，使用命令：docker run 这个命令发送到 docker server 端后 docker daemon 就会去帮助我们完成容器的创建，然后部署就完成了。</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081307167.png" alt="image-20231008130700555"></p><blockquote><p><strong>总结</strong>：</p><p>镜像：</p><ul><li>将应用程序及其依赖，环境，配置打包在一起</li></ul><p>容器：</p><ul><li>镜像运行起来就是容器，一个镜像可以运行多个容器</li></ul><p>Docker 结构：</p><ul><li>服务端：接收命令或远程请求，操作镜像或容器</li><li>客户端：发送命令或者请求到 Docker 服务端</li></ul><p>DockerHub：</p><ul><li>一个镜像托管的服务器，类似的还有阿里云镜像服务，统称为 DockerRegistry</li></ul></blockquote><h3 id="75-docker基本操作"><a class="anchor" href="#75-docker基本操作">#</a> 7.5、Docker 基本操作🌳</h3><ul><li>镜像操作</li><li>容器操作</li><li>数据卷 (容器数据管理)</li></ul><h4 id="751-镜像相关命令"><a class="anchor" href="#751-镜像相关命令">#</a> 7.5.1、镜像相关命令🌲</h4><ul><li><p>镜像名称一般分两部分组成：[repository]:[tag]</p><p>tag 一般指 版本</p></li><li><p>在没有指定 tag 时，默认是 latest，代表最新版本的镜像</p></li></ul><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081604324.png" alt="image-20231008160421226"></p><h5 id="7511-镜像操作命令"><a class="anchor" href="#7511-镜像操作命令">#</a> 7.5.1.1、镜像操作命令🌴</h5><p>Docker 镜像的操作无非就是 CRUD，比如 local (本地) 就是本地的 Docker，我要在这个上面完成镜像的操作。比方说获取镜像，一般有两种获取方法。第一种为：本地获取，第二种为：远端获取。</p><p>本地获取：</p><p>需要一个名为 Dockerfile 文件，利用 docker build 命令把它构建成一个镜像，使用命令：docker pull 从 docker registry 的服务里拉取镜像，获取到镜像想查看下可以使用命令：docker images，删除镜像使用命令：docker rmi</p><p>分享镜像有两种方式：</p><p>方式一：</p><p>使用命令 docker push 将镜像推送到镜像服务器</p><p>方式二：</p><p>使用 docker save 将镜像打包为 zip 然后使用 u 盘拷贝给别人。使用 docker load 将 zip 加载为镜像</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081612068.png" alt="image-20231008161250665"></p><h4 id="752-案例从dockerhub中拉取一个nginx镜像并查看"><a class="anchor" href="#752-案例从dockerhub中拉取一个nginx镜像并查看">#</a> 7.5.2、案例，从 DockerHub 中拉取一个 nginx 镜像并查看🌲</h4><p><strong>需求</strong>：从 DockerHub 中拉取一个 nginx 镜像并查看</p><p>1、首先去镜像仓库搜索 nginx 镜像，比如<span class="exturl" data-url="aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS8="> DockerHub</span>:</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081618473.png" alt="image-20231008161836139"></p><p>nginx 后面的勋章表示这个是官网的正版镜像</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081621315.png" alt="image-20231008162135908"></p><p>点开后可复制命令，默认拉取的是最新版本的 nginx</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081624383.png" alt="image-20231008162412714"></p><p>2、根据查看到的镜像名称，拉取自己需要的镜像，通过命令：docker pull nginx</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081626723.png" alt="image-20231008162646280"></p><p>3、通过命令：docker images 查看拉取到的镜像</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081627490.png" alt="image-20231008162714111"></p><h4 id="753-案例利用docker-save将nginx镜像导出磁盘然后再通过load加载回来"><a class="anchor" href="#753-案例利用docker-save将nginx镜像导出磁盘然后再通过load加载回来">#</a> 7.5.3、案例，利用 docker save 将 nginx 镜像导出磁盘，然后再通过 load 加载回来🌲</h4><p><strong>步骤</strong>：</p><p>1、利用 <code>docker xx --help</code> 命令查看 docker save 和 docker load 的语法</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker save --help</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 命令示例：docker save [选项] 镜像名称</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Usage:  <span class="token function">docker</span> save <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> IMAGE <span class="token punctuation">[</span>IMAGE<span class="token punctuation">..</span>.<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 保存一个或多个镜像到一个 tar 文件中 (tar 压缩文件)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>Save one or <span class="token function">more</span> images to a <span class="token function">tar</span> archive <span class="token punctuation">(</span>streamed to STDOUT by default<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>Aliases:</pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token function">docker</span> image save, <span class="token function">docker</span> save</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 选项说明</span></pre></td></tr><tr><td data-num="10"></td><td><pre>Options:</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># -o 输出的意思，输出到一个指定的文件当中</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  -o, <span class="token parameter variable">--output</span> string   Write to a file, instead of STDOUT</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>docker save 导出镜像为压缩文件</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker images</span></pre></td></tr><tr><td data-num="2"></td><td><pre>REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</pre></td></tr><tr><td data-num="3"></td><td><pre>nginx        latest    61395b4c586d   <span class="token number">2</span> weeks ago   187MB</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker save -o nginx.tar nginx:latest</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ls -ahl</span></pre></td></tr><tr><td data-num="6"></td><td><pre>total 183M</pre></td></tr><tr><td data-num="7"></td><td><pre>dr-xr-x---.  <span class="token number">4</span> root root  <span class="token number">191</span> Oct  <span class="token number">8</span> 04:47 <span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="8"></td><td><pre>dr-xr-xr-x. <span class="token number">17</span> root root  <span class="token number">224</span> Jul <span class="token number">15</span> 05:11 <span class="token punctuation">..</span></pre></td></tr><tr><td data-num="9"></td><td><pre>-rw-------.  <span class="token number">1</span> root root <span class="token number">1</span>.4K Jul <span class="token number">15</span> 05:12 anaconda-ks.cfg</pre></td></tr><tr><td data-num="10"></td><td><pre>-rw-------.  <span class="token number">1</span> root root   <span class="token number">78</span> Jul <span class="token number">15</span> 05:20 .bash_history</pre></td></tr><tr><td data-num="11"></td><td><pre>-rw-r--r--.  <span class="token number">1</span> root root   <span class="token number">18</span> Dec <span class="token number">28</span>  <span class="token number">2013</span> .bash_logout</pre></td></tr><tr><td data-num="12"></td><td><pre>-rw-r--r--.  <span class="token number">1</span> root root  <span class="token number">176</span> Dec <span class="token number">28</span>  <span class="token number">2013</span> .bash_profile</pre></td></tr><tr><td data-num="13"></td><td><pre>-rw-r--r--.  <span class="token number">1</span> root root  <span class="token number">176</span> Dec <span class="token number">28</span>  <span class="token number">2013</span> .bashrc</pre></td></tr><tr><td data-num="14"></td><td><pre>-rw-r--r--.  <span class="token number">1</span> root root  <span class="token number">100</span> Dec <span class="token number">28</span>  <span class="token number">2013</span> .cshrc</pre></td></tr><tr><td data-num="15"></td><td><pre>drwxr-xr-x.  <span class="token number">3</span> root root   <span class="token number">20</span> Oct  <span class="token number">8</span> 03:52 etc</pre></td></tr><tr><td data-num="16"></td><td><pre>-rw-------.  <span class="token number">1</span> root root 183M Oct  <span class="token number">8</span> 04:47 nginx.tar</pre></td></tr><tr><td data-num="17"></td><td><pre>drwxr-----.  <span class="token number">3</span> root root   <span class="token number">19</span> Jul <span class="token number">15</span> 05:30 .pki</pre></td></tr><tr><td data-num="18"></td><td><pre>-rw-r--r--.  <span class="token number">1</span> root root  <span class="token number">129</span> Dec <span class="token number">28</span>  <span class="token number">2013</span> .tcshrc</pre></td></tr><tr><td data-num="19"></td><td><pre>-rw-------.  <span class="token number">1</span> root root  <span class="token number">841</span> Oct  <span class="token number">8</span> 03:56 .viminfo</pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>docker load 导入 压缩文件</p><p>先将 docker 中的镜像删除</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker rmi nginx:latest</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Untagged: nginx:latest</pre></td></tr><tr><td data-num="3"></td><td><pre>Untagged: nginx@sha256:32da30332506740a2f7c34d5dc70467b7f14ec67d912703568daff790ab3f755</pre></td></tr><tr><td data-num="4"></td><td><pre>Deleted: sha256:61395b4c586da2b9b3b7ca903ea6a448e6783dfdd7f768ff2c1a0f3360aaba99</pre></td></tr><tr><td data-num="5"></td><td><pre>Deleted: sha256:1c69f36a0d9b59b762eaba410fa9fd01b85140670a8d49199a7b37702cc956c0</pre></td></tr><tr><td data-num="6"></td><td><pre>Deleted: sha256:bac209bfab6997cccf20779ae98d5f77a66867734499ecf604a50a5826f6b8a4</pre></td></tr><tr><td data-num="7"></td><td><pre>Deleted: sha256:859676f4cd3004af025a02dade096ad6f9391d94d1b1a983fc6098debe435055</pre></td></tr><tr><td data-num="8"></td><td><pre>Deleted: sha256:cbbd97cee0d824e5e82f9a4b2e93c5eb3c66fd72a2624d5c1521dc3395bfd1e2</pre></td></tr><tr><td data-num="9"></td><td><pre>Deleted: sha256:0b41545d8c3de3b78778d591a8da3d9dfa5fa8807baef5edf21e5eb94ded792d</pre></td></tr><tr><td data-num="10"></td><td><pre>Deleted: sha256:7e87866b23143eb30086086a669b2e902368a5836446a885b2411d3feef18bef</pre></td></tr><tr><td data-num="11"></td><td><pre>Deleted: sha256:d310e774110ab038b30c6a5f7b7f7dd527dbe527854496bd30194b9ee6ea496e</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker images</span></pre></td></tr><tr><td data-num="14"></td><td><pre>REPOSITORY   TAG       IMAGE ID   CREATED   SIZE</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>使用 <code>docker load --help</code> 来查看命令的说明</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker load --help</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 命令示例：docker load [选项]</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Usage:  <span class="token function">docker</span> load <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 从 tar 存档或 STDIN 加载图像</span></pre></td></tr><tr><td data-num="5"></td><td><pre>Load an image from a <span class="token function">tar</span> archive or STDIN</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>Aliases:</pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token function">docker</span> image load, <span class="token function">docker</span> load</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># -i ：输入，指定读取哪一个文件</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># -q ：不会打印日志</span></pre></td></tr><tr><td data-num="11"></td><td><pre>Options:</pre></td></tr><tr><td data-num="12"></td><td><pre>  -i, <span class="token parameter variable">--input</span> string   Read from <span class="token function">tar</span> archive file, instead of STDIN</pre></td></tr><tr><td data-num="13"></td><td><pre>  -q, <span class="token parameter variable">--quiet</span>          Suppress the load output</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>使用 docker load 命令加载镜像</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker load -i nginx.tar</span></pre></td></tr><tr><td data-num="2"></td><td><pre>d310e774110a: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">77</span>.81MB/77.81MB</pre></td></tr><tr><td data-num="3"></td><td><pre>eb7e3384f0ab: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>    113MB/113MB</pre></td></tr><tr><td data-num="4"></td><td><pre>1dc45c680d0f: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">3</span>.584kB/3.584kB</pre></td></tr><tr><td data-num="5"></td><td><pre>ea43d4f82a03: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">4</span>.608kB/4.608kB</pre></td></tr><tr><td data-num="6"></td><td><pre>9c6261b5d198: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>   <span class="token number">2</span>.56kB/2.56kB</pre></td></tr><tr><td data-num="7"></td><td><pre>a7e2a768c198: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>   <span class="token number">5</span>.12kB/5.12kB</pre></td></tr><tr><td data-num="8"></td><td><pre>d26d4f0eb474: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">7</span>.168kB/7.168kB</pre></td></tr><tr><td data-num="9"></td><td><pre>Loaded image: nginx:latest</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker images</span></pre></td></tr><tr><td data-num="12"></td><td><pre>REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</pre></td></tr><tr><td data-num="13"></td><td><pre>nginx        latest    61395b4c586d   <span class="token number">2</span> weeks ago   187MB</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><blockquote><p><strong>总结</strong>：</p><p>镜像操作有哪些？</p><ul><li>docker images</li><li>docker rmi</li><li>docker pull</li><li>docker push</li><li>docker save</li><li>docker load</li></ul></blockquote><h4 id="754-自己练习去dockerhub搜索并拉取一个redis镜像"><a class="anchor" href="#754-自己练习去dockerhub搜索并拉取一个redis镜像">#</a> 7.5.4、(自己练习) 去 DockerHub 搜索并拉取一个 Redis 镜像🌲</h4><p>1、去 DockerHub 搜索 Redis 镜像</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081702255.png" alt="image-20231008170209077"></p><p>2、查看 Redis 镜像的名称和版本</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081702756.png" alt="image-20231008170243226"></p><p>3、利用 docker pull 命令拉取镜像，并使用 docker images 查看拉取的情况</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker pull redis</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Using default tag: latest</pre></td></tr><tr><td data-num="3"></td><td><pre>latest: Pulling from library/redis</pre></td></tr><tr><td data-num="4"></td><td><pre>a803e7c4b030: Already exists</pre></td></tr><tr><td data-num="5"></td><td><pre>57e05a1ddec3: Pull complete</pre></td></tr><tr><td data-num="6"></td><td><pre>4635c857038a: Pull complete</pre></td></tr><tr><td data-num="7"></td><td><pre>10001c6989b4: Pull complete</pre></td></tr><tr><td data-num="8"></td><td><pre>f93feb85ceb4: Pull complete</pre></td></tr><tr><td data-num="9"></td><td><pre>4f4fb700ef54: Pull complete</pre></td></tr><tr><td data-num="10"></td><td><pre>320349bd761d: Pull complete</pre></td></tr><tr><td data-num="11"></td><td><pre>Digest: sha256:b68c6efe2c5f2d7d7d14a2749f66d6d81645ec0cacb92572b2fb7d5c42c82031</pre></td></tr><tr><td data-num="12"></td><td><pre>Status: Downloaded newer image <span class="token keyword">for</span> redis:latest</pre></td></tr><tr><td data-num="13"></td><td><pre>docker.io/library/redis:latest</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker images</span></pre></td></tr><tr><td data-num="16"></td><td><pre>REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</pre></td></tr><tr><td data-num="17"></td><td><pre>nginx        latest    61395b4c586d   <span class="token number">2</span> weeks ago   187MB</pre></td></tr><tr><td data-num="18"></td><td><pre>redis        latest    7c4b517da47d   <span class="token number">4</span> weeks ago   153MB</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>4、利用 docker save 命令将 redis:latest 打包为一个 redis.tar 包</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker save -o redis.tar redis:latest</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ls</span></pre></td></tr><tr><td data-num="4"></td><td><pre>anaconda-ks.cfg  etc  redis.tar</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>5、利用 docker rmi 删除本地的 redis:latest</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker rmi redis:latest</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Untagged: redis:latest</pre></td></tr><tr><td data-num="3"></td><td><pre>Untagged: redis@sha256:b68c6efe2c5f2d7d7d14a2749f66d6d81645ec0cacb92572b2fb7d5c42c82031</pre></td></tr><tr><td data-num="4"></td><td><pre>Deleted: sha256:7c4b517da47d331a47827390b9e8eb1be7ee68133af9c332660001b4d447828d</pre></td></tr><tr><td data-num="5"></td><td><pre>Deleted: sha256:06dafc2b2808183db1be226fd99e9dd9d374db9ef86480ccdec56bcb644c821a</pre></td></tr><tr><td data-num="6"></td><td><pre>Deleted: sha256:d31af4bfba5cce8499ed4df2f666ef1cf911d0936156af46da79d4b510c7687a</pre></td></tr><tr><td data-num="7"></td><td><pre>Deleted: sha256:f14f2bfc00d1db007798b7b81d043df4130673ae33591960d0917c484eded7f0</pre></td></tr><tr><td data-num="8"></td><td><pre>Deleted: sha256:7778474585964f4869bd7b40e56a375312fc91284c26f7b84967efd383219a20</pre></td></tr><tr><td data-num="9"></td><td><pre>Deleted: sha256:8fbe6eb1ebe310862ce5ebf21c01744994203df7d3f53fecabf53db86c3f4578</pre></td></tr><tr><td data-num="10"></td><td><pre>Deleted: sha256:57489dc8f39be6c5bfe929829682b1dcd6c7497e2f5878f450557a381afacb52</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker images</span></pre></td></tr><tr><td data-num="13"></td><td><pre>REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</pre></td></tr><tr><td data-num="14"></td><td><pre>nginx        latest    61395b4c586d   <span class="token number">2</span> weeks ago   187MB</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>6、利用 docker load 重新加载 redis.tar 文件</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker load -i redis.tar</span></pre></td></tr><tr><td data-num="2"></td><td><pre>ae2dc73bba26: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">10</span>.75kB/10.75kB</pre></td></tr><tr><td data-num="3"></td><td><pre>7c13dd56eefc: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">4</span>.141MB/4.141MB</pre></td></tr><tr><td data-num="4"></td><td><pre>33409257a91d: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">75</span>.28MB/75.28MB</pre></td></tr><tr><td data-num="5"></td><td><pre>c0a7ac48293c: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">1</span>.536kB/1.536kB</pre></td></tr><tr><td data-num="6"></td><td><pre>5f70bf18a086: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">1</span>.024kB/1.024kB</pre></td></tr><tr><td data-num="7"></td><td><pre>e6642d3d7b17: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">4</span>.096kB/4.096kB</pre></td></tr><tr><td data-num="8"></td><td><pre>Loaded image: redis:latest</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker images</span></pre></td></tr><tr><td data-num="11"></td><td><pre>REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</pre></td></tr><tr><td data-num="12"></td><td><pre>nginx        latest    61395b4c586d   <span class="token number">2</span> weeks ago   187MB</pre></td></tr><tr><td data-num="13"></td><td><pre>redis        latest    7c4b517da47d   <span class="token number">4</span> weeks ago   153MB</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><h4 id="755-容器相关命令"><a class="anchor" href="#755-容器相关命令">#</a> 7.5.5、容器相关命令🌲</h4><p>创建比较常见的一个命令就是 docker run 了，这个命令不仅仅可以帮我们创建一个容器而且还可以让这个容器处于运行状态。容器除了运行状态还有，暂停，停止两个状态。只需要简单的命令就可以实现两个状态之间的切换了</p><p>docker puse 可以让容器从运行状态进入到暂停状态</p><p>docker unpuse 让容器从暂停状态恢复到运行状态</p><p>docker stop 可以让容器从运行状态进入停止状态</p><p>docker start 让容器从停止状态恢复到运行状态</p><p>docker stop $(docker ps -q) 停止全部运行中的容器</p><p>docker rm $(docker ps -aq) 删除全部容器 运行中的需要强制删除 -f</p><p><code>docker stop $(docker ps -q) &amp; docker rm $(docker ps -aq)</code> 先停止全部容器再删除全部容器</p><blockquote><p>那为什么暂停可以用 puse 和 unpause 而停止却是 stop 和 start 呢？为什么不是 unstop。</p><p><strong>原因</strong>：</p><p>它们在操作系统的处理方式不同，如果容器进入暂停状态，操作系统会将容器内的进程挂起，容器关联的内存暂存起来。CPU 不再执行这个进程，如果将它恢复那么内存空间恢复程序接着运行，那么容器就又进入运行状态了。</p><p>但是停止不同，停止直接把这个进程杀死，容器所占的内存回收。把保留下来的就仅剩容器的文件系统了也就是那些静态的东西，因此停止是没有办法进行恢复的因为进程已经被杀死了。</p><p>这就是暂停和停止的区别了。</p></blockquote><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081724327.png" alt="image-20231008172423860"></p><h5 id="7551-查看容器的状态"><a class="anchor" href="#7551-查看容器的状态">#</a> 7.5.5.1、查看容器的状态🌴</h5><p>Docker 提供了一个命令叫：docker ps 可以查看所有运行的容器以及状态，还有一个命令为：docker logs 查看容器运行的日志</p><p>如果想深入内部了解一下，Docker 还提供了一个命令：docker exec 可以进入容器的内部进行操作</p><p>docker rm 删除容器</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081728094.png" alt="image-20231008172804953"></p><h5 id="7552-创建运行一个nginx容器"><a class="anchor" href="#7552-创建运行一个nginx容器">#</a> 7.5.5.2、创建运行一个 Nginx 容器🌴</h5><p>1、去 docker hub 查看 Nginx 的容器运行命令</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081744053.png" alt="image-20231008174414666"></p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">docker</span> run <span class="token parameter variable">--name</span> some-nginx <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8080</span>:80 some-content-nginx</pre></td></tr></table></figure><p><strong>命令解读</strong>：</p><ul><li>docker run：创建并运行一个容器</li><li><code>--name</code> ：给容器起一个名字，比如叫做 mn</li><li>-p：将宿主机端口与容器端口映射，冒号左侧是宿主机端口，右则是容器端口</li><li>-d：后台运行容器</li><li>nginx：镜像名称，例如 nginx</li></ul><blockquote><p>将宿主机端口与容器端口映射是什么意思呢？</p><p>比方说有一台 centos 的服务器 ip 地址为：192.168.150.101 现在我们在这台服务器上部署了一台 Nginx 容器它的端口是 80，如果用户想要来访问 Nginx 容器不能直接访问，因为容器是对外隔离的。不能访问怎么办呢，所以我们要做一个端口映射</p><p><strong>端口映射的解释</strong>：</p><p>比如说宿主机有自己很多端口，其中一个端口为：80，让宿主机的 80 跟容器的 80 产生一个关联映射，那这样一来任何进入宿主机 80 的这个请求就都会被转发到容器的 80 端口去执行了。这样就等于是 nginx 处理了这个请求</p></blockquote><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081758073.png" alt="image-20231008175824602"></p><p>所以端口映射的作用是把一个本来完全隔离的容器对外暴漏让用户可以访问</p><p>2、执行命令创建容器并运行</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker run --name mn -p 80:80 -d nginx</span></pre></td></tr><tr><td data-num="2"></td><td><pre>9672ddfc088cdf53966332bf06da44b6daf7093427c12ed636818bcaae20e312</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>9672ddfc088cdf53966332bf06da44b6daf7093427c12ed636818bcaae20e312：容器的唯一 id</p><p>3、查看容器的状态</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span></pre></td></tr><tr><td data-num="2"></td><td><pre>CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                               NAMES</pre></td></tr><tr><td data-num="3"></td><td><pre>9672ddfc088c   nginx     <span class="token string">"/docker-entrypoint.…"</span>   <span class="token number">14</span> minutes ago   Up <span class="token number">14</span> minutes   <span class="token number">0.0</span>.0.0:80-<span class="token operator">></span><span class="token number">80</span>/tcp, :::80-<span class="token operator">></span><span class="token number">80</span>/tcp   mn</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>4、访问服务</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081821712.png" alt="image-20231008182123920"></p><p>可以访问说明容器部署成功。</p><p>5、查看访问 nginx 后的日志信息</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker logs mn</span></pre></td></tr><tr><td data-num="2"></td><td><pre>/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration</pre></td></tr><tr><td data-num="3"></td><td><pre>/docker-entrypoint.sh: Looking <span class="token keyword">for</span> shell scripts <span class="token keyword">in</span> /docker-entrypoint.d/</pre></td></tr><tr><td data-num="4"></td><td><pre>/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">10</span>-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">10</span>-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 <span class="token keyword">in</span> /etc/nginx/conf.d/default.conf</pre></td></tr><tr><td data-num="7"></td><td><pre>/docker-entrypoint.sh: Sourcing /docker-entrypoint.d/15-local-resolvers.envsh</pre></td></tr><tr><td data-num="8"></td><td><pre>/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</pre></td></tr><tr><td data-num="9"></td><td><pre>/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh</pre></td></tr><tr><td data-num="10"></td><td><pre>/docker-entrypoint.sh: Configuration complete<span class="token punctuation">;</span> ready <span class="token keyword">for</span> start up</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">2023</span>/10/08 <span class="token number">10</span>:04:30 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: using the "epoll" event method</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">2023</span>/10/08 <span class="token number">10</span>:04:30 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: nginx/1.25.2</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">2023</span>/10/08 <span class="token number">10</span>:04:30 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: built by gcc 12.2.0 (Debian 12.2.0-14)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">2023</span>/10/08 <span class="token number">10</span>:04:30 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: OS: Linux 3.10.0-1160.el7.x86_64</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">2023</span>/10/08 <span class="token number">10</span>:04:30 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token number">2023</span>/10/08 <span class="token number">10</span>:04:30 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker processes</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token number">2023</span>/10/08 <span class="token number">10</span>:04:30 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker process 29</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token number">2023</span>/10/08 <span class="token number">10</span>:04:30 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker process 30</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token number">2023</span>/10/08 <span class="token number">10</span>:04:30 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker process 31</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token number">2023</span>/10/08 <span class="token number">10</span>:04:30 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker process 32</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token number">192.168</span>.249.1 - - <span class="token punctuation">[</span>08/Oct/2023:10:21:11 +0000<span class="token punctuation">]</span> <span class="token string">"GET / HTTP/1.1"</span> <span class="token number">200</span> <span class="token number">615</span> <span class="token string">"-"</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36"</span> <span class="token string">"-"</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><h6 id="75521-持续输出日志"><a class="anchor" href="#75521-持续输出日志">#</a> 7.5.5.2.1、持续输出日志🎋</h6><p>每次请求都要执行指令才能查看日志很麻烦通过 <code>docker logs --help</code> 来查看有没有需要的帮助</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker logs --help</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>Usage:  <span class="token function">docker</span> logs <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> CONTAINER</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>Fetch the logs of a container</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>Aliases:</pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token function">docker</span> container logs, <span class="token function">docker</span> logs</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>Options:</pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token parameter variable">--details</span>        Show extra details provided to logs</pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token comment"># 持续输出日志    </span></pre></td></tr><tr><td data-num="13"></td><td><pre>  -f, <span class="token parameter variable">--follow</span>         Follow log output</pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token parameter variable">--since</span> string   Show logs since timestamp <span class="token punctuation">(</span>e.g. <span class="token string">"2013-01-02T13:23:37Z"</span><span class="token punctuation">)</span> or relative <span class="token punctuation">(</span>e.g. <span class="token string">"42m"</span> <span class="token keyword">for</span> <span class="token number">42</span> minutes<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  -n, <span class="token parameter variable">--tail</span> string    Number of lines to show from the end of the logs <span class="token punctuation">(</span>default <span class="token string">"all"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  -t, <span class="token parameter variable">--timestamps</span>     Show timestamps</pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token parameter variable">--until</span> string   Show logs before a timestamp <span class="token punctuation">(</span>e.g. <span class="token string">"2013-01-02T13:23:37Z"</span><span class="token punctuation">)</span> or relative <span class="token punctuation">(</span>e.g. <span class="token string">"42m"</span> <span class="token keyword">for</span> <span class="token number">42</span> minutes<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>我们可以看到选项中有一个持续输出日志的选项</p><blockquote><p><strong>总结</strong>：</p><p>docker run 命令的常见参数有哪些？</p><ul><li><code>--name</code> ：指定容器名称</li><li><code>-p</code> ：指定端口映射</li><li><code>-d</code> ：让容器后台运行</li></ul><p>查看容器日志的命令：</p><ul><li>docker logs</li><li>添加 - f 参数可以持续查看日志</li></ul><p>查看容器状态：</p><ul><li>docker ps</li></ul></blockquote><h5 id="7553-进入nginx容器修改html文件内容添加-传智教育欢迎您"><a class="anchor" href="#7553-进入nginx容器修改html文件内容添加-传智教育欢迎您">#</a> 7.5.5.3、进入 Nginx 容器，修改 HTML 文件内容，添加 “传智教育欢迎您”🌴</h5><p>1、进入容器。进入我们刚刚创建的 nginx 容器的命令为：</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> mn <span class="token function">bash</span></pre></td></tr></table></figure><p><strong>命令解读</strong>：</p><ul><li>docker exec：进入容器内部，执行一个命令</li><li>-it：给当前进入的容器创建一个标准输入，输出终端，允许我们与容器交互</li><li>mn：要进入的容器的名称</li><li>bash：进入容器后执行的命令，bash 是一个 linux 终端交互命令</li></ul><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it mn bash</span></pre></td></tr><tr><td data-num="2"></td><td><pre>root@9672ddfc088c:/<span class="token comment">#</span></pre></td></tr></table></figure><p>通过 ls 命令查看内部都有什么：</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre>root@9672ddfc088c:/<span class="token comment"># ls</span></pre></td></tr><tr><td data-num="2"></td><td><pre>bin   dev                  docker-entrypoint.sh  home  lib32  libx32  mnt  proc  run   srv  tmp  var</pre></td></tr><tr><td data-num="3"></td><td><pre>boot  docker-entrypoint.d  etc                   lib   lib64  media   opt  root  sbin  sys  usr</pre></td></tr><tr><td data-num="4"></td><td><pre>root@9672ddfc088c:/<span class="token comment">#</span></pre></td></tr></table></figure><p>这些我们常见的是 linux 根目录结构，但是这是阉割版的。容器的内部会有自己的一套文件系统，看起来和 linux 的系统目录一样，但是这里只有 nginx 运行它自己需要的文件</p><p>要想看 nginx 存放到哪里了我们需要去 Docker Hub 的 nginx 发布页面查看：</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081844719.png" alt="image-20231008184405334"></p><p>2、进入 nginx 的 HTML 所在目录 /user/share/nginx/html</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">cd</span> /user/share/nginx/html</pre></td></tr></table></figure><p>3、修改 index.html 的内容</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-e</span> <span class="token string">'s#Welcome to nginx#传智教育欢迎您#g'</span> <span class="token parameter variable">-e</span> <span class="token string">'s#&lt;head>#&lt;head>&lt;meta charset="utf-8">#g'</span> index.html</pre></td></tr></table></figure><p>再去访问 nginx 首页</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310081913648.png" alt="image-20231008191300720"></p><h4 id="756-查看停止的容器"><a class="anchor" href="#756-查看停止的容器">#</a> 7.5.6、查看停止的容器🌲</h4><p>先查看 docker 容器的运行状态</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span></pre></td></tr><tr><td data-num="2"></td><td><pre>CONTAINER ID   IMAGE     COMMAND                  CREATED             STATUS             PORTS                               NAMES</pre></td></tr><tr><td data-num="3"></td><td><pre>9672ddfc088c   nginx     <span class="token string">"/docker-entrypoint.…"</span>   About an hour ago   Up About an hour   <span class="token number">0.0</span>.0.0:80-<span class="token operator">></span><span class="token number">80</span>/tcp, :::80-<span class="token operator">></span><span class="token number">80</span>/tcp   mn</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>停止该容器</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker stop mn</span></pre></td></tr><tr><td data-num="2"></td><td><pre>mn</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span></pre></td></tr><tr><td data-num="4"></td><td><pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>可以看到停止后通过 docker ps 查看状态就看不到 nginx 容器了，我们可以使用 docker ps -a 来进行查看被杀死的容器</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span></pre></td></tr><tr><td data-num="2"></td><td><pre>CONTAINER ID   IMAGE     COMMAND                  CREATED             STATUS                          PORTS     NAMES</pre></td></tr><tr><td data-num="3"></td><td><pre>9672ddfc088c   nginx     <span class="token string">"/docker-entrypoint.…"</span>   About an hour ago   Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> About a minute ago             mn</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><blockquote><p>总结：</p><p>查看容器状态</p><ul><li>docker ps</li><li>添加 - a 参数查看所有状态的容器</li></ul><p>删除容器</p><ul><li>docker rm</li><li>不能删除运行中的容器，除非添加 - f 参数</li></ul><p>进入容器：</p><ul><li>命令是 <code>docker exec -it [容器名][要执行的命令]</code></li><li>exec 命令可以进入容器修改文件，但是在容器内修改文件时不推荐的</li></ul></blockquote><h4 id="757-数据卷"><a class="anchor" href="#757-数据卷">#</a> 7.5.7、数据卷🌲</h4><p>容器与数据耦合的问题</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310082044250.png" alt="image-20231008204446853"></p><p>上面的问题怎么解决呢，这就要学习 <mark>数据卷</mark> 来解决了</p><p>数据卷 (volume) 是一个虚拟目录，指向宿主机文件系统中的某个目录。</p><blockquote><p>比如说有一个 Docker 主机，那么在这个主机上就会由 Docker 去管理很多很多的数据卷。而所有的数据卷一定都会指向宿主机文件系统上的一个目录这个目录就是：var/lib/docker/volumes。</p></blockquote><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310082048323.png" alt="image-20231008204850370"></p><blockquote><p>比方说我们现在利用 Docker 创建了一个新的数据卷，这个数据卷的名字叫 html，那么 Docker 一定会在 /var/lib/docker/volumes 指定的宿主机文件系统下创建出一个 html 的目录</p></blockquote><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310082050696.png" alt="image-20231008205044637"></p><blockquote><p>比方说我又创建了一个新的数据卷 conf，它同样会在 docker 指定的 volumes 目录下再创建一个 conf 真是目录</p></blockquote><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310082051742.png" alt="image-20231008205151242"></p><blockquote><p>每一个数据卷都跟一个真是目录进行映射。所以可以认为数据卷是一个虚拟的并不真实存在的。只是一个概念，而真正指向的是 (宿主机) 硬盘上的真实文件夹</p></blockquote><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310082053614.png" alt="image-20231008205305336"></p><blockquote><p>容器创建后就可以使用这个数据卷，nginx 的内部目录与数据卷进行关联，当容器中 nginx 与数据卷进行关联时，它的本质其实是和宿主机文件系统上的 html 和 conf 目录进行关联的。这时 docker 就会去管理这个容器了，比方说在容器的 html 目录里写了点什么东西，这些东西会立即写入到宿主机文件系统里。而反过来如果在宿主机里对 html 目录里某一个文件进行了修改那么也会立即反应到容器内的 html 目录中</p><p>可以理解为 容器 与 宿主机 之间 的数据同步是通过数据卷这个中间桥梁完成的</p></blockquote><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310082056426.png" alt="image-20231008205636159"></p><blockquote><p>这时就再也不用进入容器内去做修改了直接在宿主机通过高级编辑工具进行修改</p></blockquote><h5 id="7571-数据共享"><a class="anchor" href="#7571-数据共享">#</a> 7.5.7.1、数据共享🌴</h5><p>将另一个容器挂载到数据卷的目录上也能访问操作里面的数据和配置的信息</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310082103306.png" alt="image-20231008210328135"></p><h5 id="7572-数据安全删除问题"><a class="anchor" href="#7572-数据安全删除问题">#</a> 7.5.7.2、数据安全删除问题🌴</h5><p>将容器删除，数据卷不会被删除，还可以将新的容器重新挂载到数据卷上里面的配置和数据都回来了</p><h5 id="7573-操作数据卷"><a class="anchor" href="#7573-操作数据卷">#</a> 7.5.7.3、操作数据卷🌴</h5><p>数据卷操作的基本语法如下：</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">docker</span> volume<span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span></pre></td></tr></table></figure><p>docker volume 命令是数据卷操作，根据命令后跟随的 command 来确定下一步的操作：</p><ul><li>create 创建一个 volume</li><li>inspect 显示一个或多个 volume 的信息</li><li>ls 列出所有的 volume</li><li>prune 删除未使用的 volume</li><li>rm 删除一个或多个指定的 volume</li></ul><h6 id="75731-案例创建一个数据卷并查看数据卷在宿主机的目录位置"><a class="anchor" href="#75731-案例创建一个数据卷并查看数据卷在宿主机的目录位置">#</a> 7.5.7.3.1、案例，创建一个数据卷，并查看数据卷在宿主机的目录位置🎋</h6><p>1、创建一个名为 html 的数据卷</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker volume create html</span></pre></td></tr><tr><td data-num="2"></td><td><pre>html</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>2、查看创建好的数据卷 使用命令列出所有的数据卷</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker volume ls</span></pre></td></tr><tr><td data-num="2"></td><td><pre>DRIVER    VOLUME NAME</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token builtin class-name">local</span>     2c26106500b13248f06d9d3d89e3f9cc4395f02bc013e4ad20ef405b504b1ca0</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token builtin class-name">local</span>     96f2fa7ba9c8131ae29e9e046d86d33c48ba9a14ad145b42837e281c0f8a0c00</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token builtin class-name">local</span>     356ef50e5c9ff24e07f8bcc1f9d581f41df05ce8688025f2294d2333fd86842b</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token builtin class-name">local</span>     d3c6bed2dc6b02bd7755c7e20a02a6679d5bc1bdc08e302adb0615f6d68b3b3a</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token builtin class-name">local</span>     html</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>3、查看 html 数据卷的所在目录</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker inspect html</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">"CreatedAt"</span><span class="token builtin class-name">:</span> <span class="token string">"2023-10-08T20:59:39-04:00"</span>,</pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>,</pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token string">"Labels"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token comment"># 存储目录，也就是挂载点</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token string">"Mountpoint"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/volumes/html/_data"</span>,</pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"html"</span>,</pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token string">"Options"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token string">"Scope"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>4、使用 prune 移除本地未使用的数据卷</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker volume prune</span></pre></td></tr><tr><td data-num="2"></td><td><pre>WARNING<span class="token operator">!</span> This will remove anonymous <span class="token builtin class-name">local</span> volumes not used by at least one container.</pre></td></tr><tr><td data-num="3"></td><td><pre>Are you sure you want to continue? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span> y</pre></td></tr><tr><td data-num="4"></td><td><pre>Deleted Volumes:</pre></td></tr><tr><td data-num="5"></td><td><pre>2c26106500b13248f06d9d3d89e3f9cc4395f02bc013e4ad20ef405b504b1ca0</pre></td></tr><tr><td data-num="6"></td><td><pre>96f2fa7ba9c8131ae29e9e046d86d33c48ba9a14ad145b42837e281c0f8a0c00</pre></td></tr><tr><td data-num="7"></td><td><pre>d3c6bed2dc6b02bd7755c7e20a02a6679d5bc1bdc08e302adb0615f6d68b3b3a</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>Total reclaimed space: 0B</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>5、使用 docker volume ls 列出所有的数据卷</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker volume ls</span></pre></td></tr><tr><td data-num="2"></td><td><pre>DRIVER    VOLUME NAME</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token builtin class-name">local</span>     356ef50e5c9ff24e07f8bcc1f9d581f41df05ce8688025f2294d2333fd86842b</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token builtin class-name">local</span>     html</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>少了一些数据卷那些被移除了</p><p>6、使用 rm 删除一个指定的数据卷，如果无法删除可以加上参数 -f 强制删除</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker volume rm html</span></pre></td></tr><tr><td data-num="2"></td><td><pre>html</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker volume ls</span></pre></td></tr><tr><td data-num="4"></td><td><pre>DRIVER    VOLUME NAME</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token builtin class-name">local</span>     356ef50e5c9ff24e07f8bcc1f9d581f41df05ce8688025f2294d2333fd86842b</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><blockquote><p>数据卷的作用：</p><ul><li>j 将容器与数据分离，解耦合，方便操作容器内数据，保证数据安全</li></ul><p>数据卷操作：</p><ul><li><code>docker volume create [名称]</code> 创建一个数据卷</li><li><code>docker volume ls</code> 列出所有存在的数据卷</li><li><code>docker volume inspect [名称]</code> 查看指定数据卷的详细信息或所在目录</li><li><code>docker volume rm [名称]</code> 删除指定的数据卷，可以删除一个或多个，可以强制删除</li><li><code>docker volume prune</code> 移除未使用的数据卷</li></ul></blockquote><h5 id="7574-挂载数据卷"><a class="anchor" href="#7574-挂载数据卷">#</a> 7.5.7.4、挂载数据卷🌴</h5><p>我们在创建容器时，可以通过 <code>-v</code> 参数来挂载一个数据卷到某个容器目录</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310090914664.png" alt="image-20231009091445924"></p><p>这里面唯一没见过的就是 <code>-v</code> 参数了，解释如下：</p><p>前半部分的 html 为数据卷：后半部分为容器内的目录。</p><p>这行命令的意思就是将名为 html 的数据卷挂载到容器内的 /root/html 目录下</p><h6 id="75741-案例创建一个nginx容器修改容器内的html目录内的indexhtml内容"><a class="anchor" href="#75741-案例创建一个nginx容器修改容器内的html目录内的indexhtml内容">#</a> 7.5.7.4.1、案例，创建一个 Nginx 容器，修改容器内的 html 目录内的 index.html 内容🎋</h6><blockquote><p><strong>需求说明</strong>：</p><p>上个案例中，我们进入 nginx 容器内部，已经知道 nginx 的 html 目录所在位置 /user/share/nginx/html ，我们需要把这个目录挂载到 html 这个数据卷上，方便操作其中的内容。</p></blockquote><p><strong>提示</strong>：运行容器时使用 <code>-v</code> 参数挂载数据卷</p><p><strong>步骤</strong>：</p><p>&lt;font color='red'&gt; 提醒 &lt;/font&gt;：如果数据卷不存在在创建容器的时候里面 <code>-v</code> 参数执行数据卷就会自动被创建</p><p>1、创建容器并挂载数据卷到容器内的 HTML 目录</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker run --name mn -p 80:80 -v html:/usr/share/nginx/html -d nginx</span></pre></td></tr><tr><td data-num="2"></td><td><pre>a4e6d36a4c1ccb8948d93990839244207cb1db9856a607680350871c13fc7458</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span></pre></td></tr><tr><td data-num="4"></td><td><pre>CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS        PORTS                               NAMES</pre></td></tr><tr><td data-num="5"></td><td><pre>a4e6d36a4c1c   nginx     <span class="token string">"/docker-entrypoint.…"</span>   <span class="token number">2</span> seconds ago   Up <span class="token number">1</span> second   <span class="token number">0.0</span>.0.0:80-<span class="token operator">></span><span class="token number">80</span>/tcp, :::80-<span class="token operator">></span><span class="token number">80</span>/tcp   mn</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>2、进入 html 数据卷所在位置，并修改 HTML 内容</p><p>2.1、首先看一下 html 数据卷的具体位置</p><p>2.2、进入到目录</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker volume inspect html</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">"CreatedAt"</span><span class="token builtin class-name">:</span> <span class="token string">"2023-10-08T21:26:51-04:00"</span>,</pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>,</pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token string">"Labels"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token string">"Mountpoint"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/volumes/html/_data"</span>,</pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"html"</span>,</pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token string">"Options"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token string">"Scope"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cd /var/lib/docker/volumes/html/_data</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span>root@localhost _data<span class="token punctuation">]</span><span class="token comment"># </span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span>root@localhost _data<span class="token punctuation">]</span><span class="token comment"># ls -ahl</span></pre></td></tr><tr><td data-num="16"></td><td><pre>total <span class="token number">8</span>.0K</pre></td></tr><tr><td data-num="17"></td><td><pre>drwxr-xr-x. <span class="token number">2</span> root root  <span class="token number">40</span> Oct  <span class="token number">9</span> 02:54 <span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="18"></td><td><pre>drwx-----x. <span class="token number">3</span> root root  <span class="token number">19</span> Oct  <span class="token number">8</span> <span class="token number">21</span>:26 <span class="token punctuation">..</span></pre></td></tr><tr><td data-num="19"></td><td><pre>-rw-r--r--. <span class="token number">1</span> root root <span class="token number">497</span> Aug <span class="token number">15</span> <span class="token number">13</span>:03 50x.html</pre></td></tr><tr><td data-num="20"></td><td><pre>-rw-r--r--. <span class="token number">1</span> root root <span class="token number">615</span> Aug <span class="token number">15</span> <span class="token number">13</span>:03 index.html</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">[</span>root@localhost _data<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091459700.png" alt="image-20231009145716659"></p><p>我们可以右键 index.html 直接在 windows 上进行修改然后保存那么 nginx 容器内的 index.html 也就被修改了</p><p>改完保存后这个工具会提示是否保存到 Linux 系统中 index 文件去还是很智能的</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091505065.png" alt="image-20231009150527902"></p><p>下面就是修改了内容成功了，但是乱码</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091505224.png" alt="image-20231009150556316"></p><blockquote><p><strong>总结</strong>：</p><p>数据卷挂载方式：</p><ul><li><code>-v volumeName: /targetContainerPath</code></li><li>如果容器运行时 volume 不存在，会自动被创建出来</li></ul></blockquote><p>通过案例演示宿主机直接与容器进行挂载</p><h6 id="75742-宿主机直接与容器进行挂载"><a class="anchor" href="#75742-宿主机直接与容器进行挂载">#</a> 7.5.7.4.2、宿主机直接与容器进行挂载🎋</h6><p>案例，创建并运行一个 MYSQL 容器，将宿主机目录直接挂载到容器</p><p>提示：目录挂载与数据卷挂载的语法是类似的：</p><ul><li><code>-v [宿主机目录]:[容器目录]</code></li><li><code>-v [宿主机文件]:[容器内文件]</code></li></ul><p>实现思路如下：</p><p>1、在将课前资料中的 mysql.tar 文件上传到虚拟机，通过 load 命令加载为镜像</p><p>操作：直接拖进去即可</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091539535.png" alt="image-20231009153911060"></p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost tmp<span class="token punctuation">]</span><span class="token comment"># docker load -i mysql.tar</span></pre></td></tr><tr><td data-num="2"></td><td><pre>5dacd731af1b: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">58</span>.45MB/58.45MB</pre></td></tr><tr><td data-num="3"></td><td><pre>f411d8bde01c: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">338</span>.4kB/338.4kB</pre></td></tr><tr><td data-num="4"></td><td><pre>0aa7d65147ef: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">10</span>.44MB/10.44MB</pre></td></tr><tr><td data-num="5"></td><td><pre>3437f67a712b: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">4</span>.472MB/4.472MB</pre></td></tr><tr><td data-num="6"></td><td><pre>ec41e34b35a0: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">1</span>.536kB/1.536kB</pre></td></tr><tr><td data-num="7"></td><td><pre>458d25c646d8: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">46</span>.15MB/46.15MB</pre></td></tr><tr><td data-num="8"></td><td><pre>97874ea0e7f9: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">31</span>.74kB/31.74kB</pre></td></tr><tr><td data-num="9"></td><td><pre>5075b9328698: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">3</span>.584kB/3.584kB</pre></td></tr><tr><td data-num="10"></td><td><pre>364557e875f1: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">257</span>.3MB/257.3MB</pre></td></tr><tr><td data-num="11"></td><td><pre>9209148debed: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">9</span>.728kB/9.728kB</pre></td></tr><tr><td data-num="12"></td><td><pre>82582edf9553: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">1</span>.536kB/1.536kB</pre></td></tr><tr><td data-num="13"></td><td><pre>Loaded image: mysql:5.7.25</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span>root@localhost tmp<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span>root@localhost tmp<span class="token punctuation">]</span><span class="token comment"># docker images</span></pre></td></tr><tr><td data-num="16"></td><td><pre>REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</pre></td></tr><tr><td data-num="17"></td><td><pre>nginx        latest    61395b4c586d   <span class="token number">2</span> weeks ago   187MB</pre></td></tr><tr><td data-num="18"></td><td><pre>redis        latest    7c4b517da47d   <span class="token number">4</span> weeks ago   153MB</pre></td></tr><tr><td data-num="19"></td><td><pre>mysql        <span class="token number">5.7</span>.25    98455b9624a9   <span class="token number">4</span> years ago   372MB</pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">[</span>root@localhost tmp<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>2、创建目录 /tem/mysql/data</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost tmp<span class="token punctuation">]</span><span class="token comment"># mkdir -p mysql/data</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@localhost tmp<span class="token punctuation">]</span><span class="token comment"># mkdir -p mysql/conf</span></pre></td></tr></table></figure><p>3、创建目录 /tmp/mysql/conf，将课前资料提供的 hmy.cnf 文件上传到 /tmp/mysql/conf</p><p>hmy.conf 配置文件内容：</p><pre><code>[mysqld]
skip-name-resolve
character_set_server=utf8
datadir=/var/lib/mysql
server-id=1000
</code></pre><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091545686.png" alt="image-20231009154459349"></p><p>4、去 DockerHub 查阅资料，创建并运行 MySQL 容器</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">docker</span> run <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token parameter variable">--name</span> some-mysql <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 环境变量 environment variables 设置 mysql 密码</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 设置宿主机与容器的端口都为 3306</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token parameter variable">-p</span> <span class="token number">3306</span>:3306</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 挂载配置文件目录，前面是宿主机目录后面是容器内的配置文件目录可以去官网查看</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token parameter variable">-v</span> /tmp/mysql/conf/hmy.cnf:/etc/mysql/conf.d/hmy.cnf <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 挂载数据目录</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token parameter variable">-v</span> /tmp/mysql/data:/var/lib/mysql <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token parameter variable">-d</span> mysql:5.7.25</pre></td></tr></table></figure><p>可复制如下：</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">docker</span> run <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token parameter variable">--name</span> some-mysql <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token parameter variable">-p</span> <span class="token number">3306</span>:3306 <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token parameter variable">-v</span> /tmp/mysql/conf/hmy.cnf:/etc/mysql/conf.d/hmy.cnf <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token parameter variable">-v</span> /tmp/mysql/data:/var/lib/mysql <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token parameter variable">-d</span> mysql:5.7.25</pre></td></tr></table></figure><p>my.conf 就是 mysql 的默认配置文件了但是并不建议去覆盖它，它里面东西很多，我们只是希望要简化的配置 下面文档说，my.conf 配置文件里包含了两个目录一个是 /etc/mysql/conf.d 或 /etc/mysql/mysql/conf.d 其中.d 后缀就是目录的意思，因此放到这两个包含的目录里面的一切文件都会被加载到一起作为合并配置</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091602833.png" alt="image-20231009160248603"></p><p>要求：</p><ol><li>挂载 /tmp/myql/data 到 mysql 容器内数据存储到目录</li><li>挂载 /tmp/myql/conf/hmy/cnf 到 mysql 容器的配置文件</li><li>设置 MySQL 密码</li></ol><p>打开链接 mysql 的工具进行连接，连接的是 Linux 中的 mysql</p><p>连接密码是上面创建容器的时候的密码也就是 123</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091640299.png" alt="image-20231009164005163"></p><p>连接成功！</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091640185.png" alt="image-20231009164040831"></p><p>查看宿主机的 data 目录可以看到里面的 mysql 数据就全都写进来了</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre>➜  /tmp <span class="token builtin class-name">cd</span> mysql/data</pre></td></tr><tr><td data-num="2"></td><td><pre>➜  data <span class="token function">ls</span></pre></td></tr><tr><td data-num="3"></td><td><pre>auto.cnf    ca.pem           client-key.pem  ibdata1      ib_logfile1  mysql               private_key.pem  server-cert.pem  sys</pre></td></tr><tr><td data-num="4"></td><td><pre>ca-key.pem  client-cert.pem  ib_buffer_pool  ib_logfile0  ibtmp1       performance_schema  public_key.pem   server-key.pem</pre></td></tr><tr><td data-num="5"></td><td><pre>➜  data</pre></td></tr></table></figure><h5 id="7575-数据卷挂载和目录直接挂载的区别"><a class="anchor" href="#7575-数据卷挂载和目录直接挂载的区别">#</a> 7.5.7.5、数据卷挂载和目录直接挂载的区别🌴</h5><p>当我们用数据卷时，Docker 会自动帮我们创建数据卷对应的目录，这样数据卷就指向了宿主机的 html 目录。而 Docker 挂载时只需要挂载到数据卷的 html 目录上就可以了。它不需要关系宿主机的 html 目录在哪里，这种方式等于全权交给了 Docker 去处理</p><p>这是数据卷挂载的优势，但是劣势呢？</p><p>劣势就是，目录不是我们创建的，到哪创建了我们也不知道目录结构也比较深想去找比较麻烦</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091651091.png" alt="image-20231009165142878"></p><p>而第二种方式直接挂载，宿主机目录是我们自己创建的，创建目录的时候挺麻烦的但是自己知道这个目录在哪，将来挂载的时候也没有人帮我做什么代理。我直接挂上去就行了。因此我想快速定位这个文件在哪就可以一目了然，这就是直接挂载的优势，劣势就是自己挂载</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091654555.png" alt="image-20231009165439938"></p><blockquote><p><strong>总结</strong>:</p><ol><li>docker run 的命令通过 -v 参数挂载文件或目录到容器中：<ol><li><code>-v volume [名称]</code> ：容器内目录</li><li><code>-v</code> 宿主机文件：容器内文件</li><li><code>-v</code> 宿主机目录：容器内目录</li></ol></li><li>数据卷挂载与目录直接挂载的区别：<ol><li>数据卷挂载耦合度低，由 docker 来管理目录，但是目录较深，不好找</li><li>目录直接挂载耦合度高，需要我们自己管理目录，不过目录容易找到</li></ol></li></ol></blockquote><h3 id="76-dockerfile自定义镜像"><a class="anchor" href="#76-dockerfile自定义镜像">#</a> 7.6、Dockerfile 自定义镜像🌳</h3><h4 id="自定义镜像"><a class="anchor" href="#自定义镜像">#</a> 自定义镜像</h4><h5 id="761-镜像结构"><a class="anchor" href="#761-镜像结构">#</a> 7.6.1、镜像结构🌴</h5><ul><li>镜像是将应用程序及其需要的系统函数库，环境，配置，依赖打包而成。</li></ul><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091711487.png" alt="image-20231009171118975"></p><p>如果要制作一个镜像，就一定要先了解它内部的构成</p><p>上面说到镜像就是系统函数库，环境，配置，依赖组成的，而且它们之间有相互之间的依赖关系或者顺序。镜像不仅仅是把一对东西组合在一起而且还要按照一定顺序去翻层</p><p>下面以 mysql 为例讲讲镜像结构，我们把 mysql 结构打散</p><p>下图中 mysql 镜像结构分成了 n 层，它就是按照上面的依赖顺序来分层的，要想构建一个镜像，最底层一定是它所在的系统函数库，而最下面就是用了 Ubuntu 操作系统，把 mysql 安装包拷贝下来然后在此基于上使用 rpm 进行安装 mysql，安装完了进行配置文件的配置等等，所有的安装配置完流程就完成的差不多了，还差一个入口 Entrypoint 通过这个入口启动程序的，这就是镜像的构成流程</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091724288.png" alt="image-20231009172404559"></p><blockquote><p><strong>总结</strong>：</p><p>镜像是分层结构，每一层称为一个 Layer</p><ul><li>BaseImage 层：包含基本的系统函数库，环境变量，文件系统</li><li>Entrypoint：入口，是镜像中应用启动的命令</li><li>其它：在 BaseImage 基础上添加依赖，安装程序，完成整个应用的安装和配置</li></ul></blockquote><h3 id="762-什么是dockerfile"><a class="anchor" href="#762-什么是dockerfile">#</a> 7.6.2、什么是 Dockerfile🌲</h3><p>Dockerfile 就是一个文本文件，其中包含一个个的指令 (Instruction) ，用指令来说明要执行什么操作来构建镜像。每一个指令都会形成一层 Layer</p><table><thead><tr><th>指令</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>FROM</td><td>指定基础镜像</td><td>FROM centos:6</td></tr><tr><td>ENV</td><td>设置环境变量，可在后面指令使用</td><td>ENV key value</td></tr><tr><td>COPY</td><td>拷贝本地文件到镜像的指定目录</td><td>COPY ./mysql-5.7.rpm /tmp</td></tr><tr><td>RUN</td><td>执行 Linux 的 shell 命令，一般是安装过程的命令</td><td>RUN yum install gcc</td></tr><tr><td>EXPOSE</td><td>指定容器运行时监听的端口，是给镜像使用者看的</td><td>EXPOSE 8080</td></tr><tr><td>ENTPYOINT</td><td>镜像中应用的启动命令，容器运行时调用</td><td>ENTPYPOINT java -jar x</td></tr></tbody></table><p>更新详细语法说明，请参考官网文档：<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVy">https://docs.docker.com/engine/reference/builder</span></p><h3 id="763-案例基于ubuntu镜像构建一个新镜像运行一个java项目"><a class="anchor" href="#763-案例基于ubuntu镜像构建一个新镜像运行一个java项目">#</a> 7.6.3、案例，基于 Ubuntu 镜像构建一个新镜像，运行一个 java 项目🌲</h3><p>步骤：</p><p>1、新建一个空文件夹 docker-demo</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre>➜  /tmp <span class="token function">mkdir</span> docker-demo</pre></td></tr><tr><td data-num="2"></td><td><pre>➜  /tmp <span class="token builtin class-name">cd</span> docker-demo</pre></td></tr><tr><td data-num="3"></td><td><pre>➜  docker-demo l</pre></td></tr><tr><td data-num="4"></td><td><pre>total <span class="token number">0</span></pre></td></tr><tr><td data-num="5"></td><td><pre>drwxrwxr-x.  <span class="token number">2</span> dkx  dkx    <span class="token number">6</span> Oct  <span class="token number">9</span> 05:52 <span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="6"></td><td><pre>drwxrwxrwt. <span class="token number">11</span> root root <span class="token number">228</span> Oct  <span class="token number">9</span> 05:52 <span class="token punctuation">..</span></pre></td></tr><tr><td data-num="7"></td><td><pre>➜  docker-demo</pre></td></tr></table></figure><p>2、拷贝 docker-demo.jar 文件到 docker-demo 这个目录中</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091756545.png" alt="image-20231009175606996"></p><p>3、拷贝 jdk8.tar.gz 文件到 docker-demo 这个目录</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091801025.png" alt="image-20231009180127529"></p><p>4、拷贝 Dockerfile 到 docker-demo 目录</p><p>Dockerfile 内容</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 指定基础镜像</span></pre></td></tr><tr><td data-num="2"></td><td><pre>FROM ubuntu:16.04</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 配置环境变量，JDK 的安装目录</span></pre></td></tr><tr><td data-num="4"></td><td><pre>ENV <span class="token assign-left variable">JAVA_DIR</span><span class="token operator">=</span>/usr/local</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 拷贝 jdk 和 java 项目的包</span></pre></td></tr><tr><td data-num="7"></td><td><pre>COPY ./jdk8.tar.gz <span class="token variable">$JAVA_DIR</span>/</pre></td></tr><tr><td data-num="8"></td><td><pre>COPY ./docker-demo.jar /tmp/app.jar</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># 安装 JDK</span></pre></td></tr><tr><td data-num="11"></td><td><pre>RUN <span class="token builtin class-name">cd</span> <span class="token variable">$JAVA_DIR</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token operator">&amp;&amp;</span> <span class="token function">tar</span> <span class="token parameter variable">-xf</span> ./jdk8.tar.gz <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> ./jdk1.8.0_144 ./java8</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># 配置环境变量</span></pre></td></tr><tr><td data-num="16"></td><td><pre>ENV <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span><span class="token variable">$JAVA_DIR</span>/java8</pre></td></tr><tr><td data-num="17"></td><td><pre>ENV <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment"># 暴露端口</span></pre></td></tr><tr><td data-num="20"></td><td><pre>EXPOSE <span class="token number">8090</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment"># 入口，java 项目的启动命令</span></pre></td></tr><tr><td data-num="22"></td><td><pre>ENTRYPOINT <span class="token function">java</span> <span class="token parameter variable">-jar</span> /tmp/app.jar</pre></td></tr></table></figure><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091802428.png" alt="image-20231009180246866"></p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre>➜  docker-demo ll</pre></td></tr><tr><td data-num="2"></td><td><pre>total 202M</pre></td></tr><tr><td data-num="3"></td><td><pre>-rw-r--r--. <span class="token number">1</span> dkx dkx  25M Oct  <span class="token number">9</span> 06:02 docker-demo.jar</pre></td></tr><tr><td data-num="4"></td><td><pre>-rw-r--r--. <span class="token number">1</span> dkx dkx  <span class="token number">494</span> Oct  <span class="token number">9</span> 06:02 Dockerfile</pre></td></tr><tr><td data-num="5"></td><td><pre>-rw-r--r--. <span class="token number">1</span> dkx dkx 177M Oct  <span class="token number">9</span> 06:02 jdk8.tar.gz</pre></td></tr><tr><td data-num="6"></td><td><pre>➜  docker-demo</pre></td></tr></table></figure><p>6、在 docker-demo 目录中运行命令： <code>docker build -t javaweb:1.0 .</code></p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre>➜  docker-demo <span class="token function">sudo</span> <span class="token function">docker</span> build <span class="token parameter variable">-t</span> javaweb:1.0 <span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> dkx:</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>+<span class="token punctuation">]</span> Building <span class="token number">46</span>.3s <span class="token punctuation">(</span><span class="token number">9</span>/9<span class="token punctuation">)</span> FINISHED                                                                                                          docker:default</pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load build definition from Dockerfile                                                                                                 <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> transferring dockerfile: 591B                                                                                                                 <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load .dockerignore                                                                                                                    <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> transferring context: 2B                                                                                                                      <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load metadata <span class="token keyword">for</span> docker.io/library/ubuntu:16.04                                                                                      <span class="token number">5</span>.6s</pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token number">1</span>/4<span class="token punctuation">]</span> FROM docker.io/library/ubuntu:16.04@sha256:1f1a2d56de1d604801a9671f301190704c25d604a416f59e03c04f5c6ffee0d6                               <span class="token number">30</span>.9s</pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> resolve docker.io/library/ubuntu:16.04@sha256:1f1a2d56de1d604801a9671f301190704c25d604a416f59e03c04f5c6ffee0d6                                <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> sha256:1f1a2d56de1d604801a9671f301190704c25d604a416f59e03c04f5c6ffee0d6 <span class="token number">1</span>.42kB / <span class="token number">1</span>.42kB                                                       <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> sha256:a3785f78ab8547ae2710c89e627783cfa7ee7824d3468cae6835c9f4eae23ff7 <span class="token number">1</span>.15kB / <span class="token number">1</span>.15kB                                                       <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> sha256:b6f50765242581c887ff1acc2511fa2d885c52d8fb3ac8c4bba131fd86567f2e <span class="token number">3</span>.36kB / <span class="token number">3</span>.36kB                                                       <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> sha256:58690f9b18fca6469a14da4e212c96849469f9b1be6661d2342a4bf01774aa50 <span class="token number">46</span>.50MB / <span class="token number">46</span>.50MB                                                    <span class="token number">27</span>.2s</pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> sha256:b51569e7c50720acf6860327847fe342a1afbe148d24c529fb81df105e3eed01 857B / 857B                                                           <span class="token number">0</span>.9s</pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> sha256:da8ef40b9ecabc2679fe2419957220c0272a965c5cf7e0269fa1aeeb8c56f2e1 528B / 528B                                                           <span class="token number">0</span>.8s</pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> sha256:fb15d46c38dcd1ea0b1990006c3366ecd10c79d374f341687eb2cb23a2c8672e 170B / 170B                                                           <span class="token number">1</span>.5s</pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> extracting sha256:58690f9b18fca6469a14da4e212c96849469f9b1be6661d2342a4bf01774aa50                                                            <span class="token number">3</span>.5s</pre></td></tr><tr><td data-num="19"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> extracting sha256:b51569e7c50720acf6860327847fe342a1afbe148d24c529fb81df105e3eed01                                                            <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="20"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> extracting sha256:da8ef40b9ecabc2679fe2419957220c0272a965c5cf7e0269fa1aeeb8c56f2e1                                                            <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> extracting sha256:fb15d46c38dcd1ea0b1990006c3366ecd10c79d374f341687eb2cb23a2c8672e                                                            <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load build context                                                                                                                    <span class="token number">1</span>.6s</pre></td></tr><tr><td data-num="23"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> transferring context: <span class="token number">211</span>.19MB                                                                                                                <span class="token number">1</span>.6s</pre></td></tr><tr><td data-num="24"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token number">2</span>/4<span class="token punctuation">]</span> COPY ./jdk8.tar.gz /usr/local/                                                                                                             <span class="token number">0</span>.7s</pre></td></tr><tr><td data-num="25"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token number">3</span>/4<span class="token punctuation">]</span> COPY ./docker-demo.jar /tmp/app.jar                                                                                                        <span class="token number">0</span>.1s</pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token number">4</span>/4<span class="token punctuation">]</span> RUN <span class="token builtin class-name">cd</span> /usr/local  <span class="token operator">&amp;&amp;</span> <span class="token function">tar</span> <span class="token parameter variable">-xf</span> ./jdk8.tar.gz  <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> ./jdk1.8.0_144 ./java8                                                                  <span class="token number">4</span>.8s</pre></td></tr><tr><td data-num="27"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> exporting to image                                                                                                                               <span class="token number">4</span>.0s</pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> exporting layers                                                                                                                              <span class="token number">3</span>.9s</pre></td></tr><tr><td data-num="29"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> writing image sha256:7163e4e0d2b830e1f411e6d50c40cb258e0110888af48e8ddce9642f72f564c1                                                         <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="30"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> naming to docker.io/library/javaweb:1.0                                                                                                       <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="31"></td><td><pre>➜  docker-demo</pre></td></tr></table></figure><p>可以看到镜像构建好了</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker images</span></pre></td></tr><tr><td data-num="2"></td><td><pre>REPOSITORY   TAG       IMAGE ID       CREATED              SIZE</pre></td></tr><tr><td data-num="3"></td><td><pre>javaweb      <span class="token number">1.0</span>       7163e4e0d2b8   About a minute ago   722MB</pre></td></tr><tr><td data-num="4"></td><td><pre>nginx        latest    61395b4c586d   <span class="token number">2</span> weeks ago          187MB</pre></td></tr><tr><td data-num="5"></td><td><pre>redis        latest    7c4b517da47d   <span class="token number">4</span> weeks ago          153MB</pre></td></tr><tr><td data-num="6"></td><td><pre>mysql        <span class="token number">5.7</span>.25    98455b9624a9   <span class="token number">4</span> years ago          372MB</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>创建容器并运行</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker run --name web -p 8090:8090 -d javaweb:1.0</span></pre></td></tr><tr><td data-num="2"></td><td><pre>de4fc104d20fd0c7a44fe227aa07bbba8fb5fd6c7ca04400e7b90c93375573a5</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span></pre></td></tr><tr><td data-num="4"></td><td><pre>CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS                                                  NAMES</pre></td></tr><tr><td data-num="5"></td><td><pre>de4fc104d20f   javaweb:1.0    <span class="token string">"/bin/sh -c 'java -j…"</span>   <span class="token number">4</span> seconds ago   Up <span class="token number">2</span> seconds   <span class="token number">0.0</span>.0.0:8090-<span class="token operator">></span><span class="token number">8090</span>/tcp, :::8090-<span class="token operator">></span><span class="token number">8090</span>/tcp              web</pre></td></tr><tr><td data-num="6"></td><td><pre>10d26568836c   mysql:5.7.25   <span class="token string">"docker-entrypoint.s…"</span>   <span class="token number">2</span> hours ago     Up <span class="token number">2</span> hours     <span class="token number">0.0</span>.0.0:3306-<span class="token operator">></span><span class="token number">3306</span>/tcp, :::3306-<span class="token operator">></span><span class="token number">3306</span>/tcp, <span class="token number">33060</span>/tcp   some-mysql</pre></td></tr><tr><td data-num="7"></td><td><pre>2ba6c6cf79f4   nginx          <span class="token string">"/docker-entrypoint.…"</span>   <span class="token number">4</span> hours ago     Up <span class="token number">4</span> hours     <span class="token number">0.0</span>.0.0:80-<span class="token operator">></span><span class="token number">80</span>/tcp, :::80-<span class="token operator">></span><span class="token number">80</span>/tcp                      mn</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>访问页面 uri：<span class="exturl" data-url="aHR0cDovLzE5Mi4xNjguMjQ5LjEyODo4MDkwL2hlbGxvL2NvdW50">http://192.168.249.128:8090/hello/count</span></p><p>访问成功</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091907846.png" alt="image-20231009190718545"></p><p>&lt;font color='red'&gt; 问题 &lt;/font&gt;：</p><p>如果每个微服务构建都要进行下面的流程会很麻烦</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 指定基础镜像</span></pre></td></tr><tr><td data-num="2"></td><td><pre>FROM ubuntu:16.04</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 配置环境变量，JDK 的安装目录</span></pre></td></tr><tr><td data-num="4"></td><td><pre>ENV <span class="token assign-left variable">JAVA_DIR</span><span class="token operator">=</span>/usr/local</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 拷贝 jdk 和 java 项目的包</span></pre></td></tr><tr><td data-num="7"></td><td><pre>COPY ./jdk8.tar.gz <span class="token variable">$JAVA_DIR</span>/</pre></td></tr><tr><td data-num="8"></td><td><pre>COPY ./docker-demo.jar /tmp/app.jar</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># 安装 JDK</span></pre></td></tr><tr><td data-num="11"></td><td><pre>RUN <span class="token builtin class-name">cd</span> <span class="token variable">$JAVA_DIR</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token operator">&amp;&amp;</span> <span class="token function">tar</span> <span class="token parameter variable">-xf</span> ./jdk8.tar.gz <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> ./jdk1.8.0_144 ./java8</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># 配置环境变量</span></pre></td></tr><tr><td data-num="16"></td><td><pre>ENV <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span><span class="token variable">$JAVA_DIR</span>/java8</pre></td></tr><tr><td data-num="17"></td><td><pre>ENV <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment"># 暴露端口</span></pre></td></tr><tr><td data-num="20"></td><td><pre>EXPOSE <span class="token number">8090</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment"># 入口，java 项目的启动命令</span></pre></td></tr><tr><td data-num="22"></td><td><pre>ENTRYPOINT <span class="token function">java</span> <span class="token parameter variable">-jar</span> /tmp/app.jar</pre></td></tr></table></figure><p>从配置环境前 n 层的内容不会变，我们可以对前 n 层提前构建好做一个镜像。以后就都在这个构建好的基础上去构建镜像是不是就方便多了。</p><p>但实际上已经有人帮我们做好了这件事儿了。</p><p>就是如下：</p><h3 id="764-基于java8-alpine镜像将一个java项目构建为镜像"><a class="anchor" href="#764-基于java8-alpine镜像将一个java项目构建为镜像">#</a> 7.6.4、基于 java:8-alpine 镜像，将一个 java 项目构建为镜像🌲</h3><p><strong>实现思路如下</strong>：</p><p>1、新建一个空的目录，然后在目录中新建一个文件，命名为 Dockerfile</p><p>2、拷贝 docker-demo.jar 到这个目录中</p><p>3、编写 Dockerfile 文件：</p><ol><li>基于 java:8-alpine 作为基础镜像</li><li>将 app.jar 拷贝到镜像中</li><li>暴漏端口</li><li>编写入口 ENTRYPOINT</li></ol><p>4、使用 docker build 命令构建镜像</p><p>5、使用 docker run 创建容器并运行</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 指定基础镜像</span></pre></td></tr><tr><td data-num="2"></td><td><pre>FROM java:8-alpine</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 暴露端口</span></pre></td></tr><tr><td data-num="5"></td><td><pre>EXPOSE <span class="token number">8090</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 入口，java 项目的启动命令</span></pre></td></tr><tr><td data-num="7"></td><td><pre>ENTRYPOINT <span class="token function">java</span> <span class="token parameter variable">-jar</span> /tmp/app.jar</pre></td></tr></table></figure><p>直接节省了大量的代码工作</p><p>修改完成保存后，覆盖 Linux，/tmp/docker-demo 中的 Dockerfile 文件</p><p>覆盖成功</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091923461.png" alt="image-20231009192320991"></p><p>使用 cat 命令查看下修改情况</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cat /tmp/docker-demo/Dockerfile</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 指定基础镜像</span></pre></td></tr><tr><td data-num="3"></td><td><pre>FROM java:8-alpine</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 暴露端口</span></pre></td></tr><tr><td data-num="6"></td><td><pre>EXPOSE <span class="token number">8090</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 入口，java 项目的启动命令</span></pre></td></tr><tr><td data-num="8"></td><td><pre>ENTRYPOINT <span class="token function">java</span> <span class="token parameter variable">-jar</span> /tmp/app.jar<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>再次进行构建镜像</p><p>如果构建遇到报错如下：</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre>➜  docker-demo <span class="token function">sudo</span> <span class="token function">docker</span> build <span class="token parameter variable">-t</span> javaweb:1.0 <span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>+<span class="token punctuation">]</span> Building <span class="token number">2</span>.7s <span class="token punctuation">(</span><span class="token number">3</span>/3<span class="token punctuation">)</span> FINISHED                                                                                                           docker:default</pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load .dockerignore                                                                                                                    <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> transferring context: 2B                                                                                                                      <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load build definition from Dockerfile                                                                                                 <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> transferring dockerfile: 245B                                                                                                                 <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> ERROR <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load metadata <span class="token keyword">for</span> docker.io/library/openjava:8-alpine                                                                           <span class="token number">2</span>.6s</pre></td></tr><tr><td data-num="8"></td><td><pre>------</pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load metadata <span class="token keyword">for</span> docker.io/library/openjava:8-alpine:</pre></td></tr><tr><td data-num="10"></td><td><pre>------</pre></td></tr><tr><td data-num="11"></td><td><pre>Dockerfile:2</pre></td></tr><tr><td data-num="12"></td><td><pre>--------------------</pre></td></tr><tr><td data-num="13"></td><td><pre>   <span class="token number">1</span> <span class="token operator">|</span>     <span class="token comment"># 指定基础镜像</span></pre></td></tr><tr><td data-num="14"></td><td><pre>   <span class="token number">2</span> <span class="token operator">|</span> <span class="token operator">>></span><span class="token operator">></span> FROM openjava:8-alpine</pre></td></tr><tr><td data-num="15"></td><td><pre>   <span class="token number">3</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="16"></td><td><pre>   <span class="token number">4</span> <span class="token operator">|</span>     <span class="token comment"># 暴露端口</span></pre></td></tr><tr><td data-num="17"></td><td><pre>--------------------</pre></td></tr><tr><td data-num="18"></td><td><pre>ERROR: failed to solve: openjava:8-alpine: pull access denied, repository does not exist or may require authorization: server message: insufficient_scope: authorization failed</pre></td></tr></table></figure><p>则需要将 Dockerfile 文件中的 java:8-alpine 改为 openjdk:8-alpine</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 指定基础镜像</span></pre></td></tr><tr><td data-num="2"></td><td><pre>FROM openjdk:8-alpine</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 暴露端口</span></pre></td></tr><tr><td data-num="5"></td><td><pre>EXPOSE <span class="token number">8090</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 入口，java 项目的启动命令</span></pre></td></tr><tr><td data-num="7"></td><td><pre>ENTRYPOINT <span class="token function">java</span> <span class="token parameter variable">-jar</span> /tmp/app.jar</pre></td></tr></table></figure><p>再次进行构建镜像</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre>➜  docker-demo <span class="token function">sudo</span> <span class="token function">docker</span> build <span class="token parameter variable">-t</span> javaweb:1.0 <span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>+<span class="token punctuation">]</span> Building <span class="token number">89</span>.8s <span class="token punctuation">(</span><span class="token number">5</span>/5<span class="token punctuation">)</span> FINISHED                                                                                                          docker:default</pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load .dockerignore                                                                                                                    <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> transferring context: 2B                                                                                                                      <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load build definition from Dockerfile                                                                                                 <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> transferring dockerfile: 244B                                                                                                                 <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load metadata <span class="token keyword">for</span> docker.io/library/openjdk:8-alpine                                                                                  <span class="token number">6</span>.1s</pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token number">1</span>/1<span class="token punctuation">]</span> FROM docker.io/library/openjdk:8-alpine@sha256:94792824df2df33402f201713f932b58cb9de94a0cd524164a0f2283343547b3                           <span class="token number">83</span>.6s</pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> resolve docker.io/library/openjdk:8-alpine@sha256:94792824df2df33402f201713f932b58cb9de94a0cd524164a0f2283343547b3                            <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> sha256:a3562aa0b991a80cfe8172847c8be6dbf6e46340b759c2b782f8b8be45342717 <span class="token number">3</span>.40kB / <span class="token number">3</span>.40kB                                                       <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> sha256:e7c96db7181be991f19a9fb6975cdbbd73c65f4a2681348e63a141a2192a5f10 <span class="token number">2</span>.76MB / <span class="token number">2</span>.76MB                                                      <span class="token number">10</span>.9s</pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> sha256:f910a506b6cb1dbec766725d70356f695ae2bf2bea6224dbe8c7c6ad4f3664a2 238B / 238B                                                           <span class="token number">0</span>.8s</pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> sha256:c2274a1a0e2786ee9101b08f76111f9ab8019e368dce1e325d3c284a0ca33397 <span class="token number">70</span>.73MB / <span class="token number">70</span>.73MB                                                    <span class="token number">80</span>.6s</pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> sha256:94792824df2df33402f201713f932b58cb9de94a0cd524164a0f2283343547b3 <span class="token number">1</span>.64kB / <span class="token number">1</span>.64kB                                                       <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> sha256:44b3cea369c947527e266275cee85c71a81f20fc5076f6ebb5a13f19015dce71 947B / 947B                                                           <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> extracting sha256:e7c96db7181be991f19a9fb6975cdbbd73c65f4a2681348e63a141a2192a5f10                                                            <span class="token number">0</span>.2s</pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> extracting sha256:f910a506b6cb1dbec766725d70356f695ae2bf2bea6224dbe8c7c6ad4f3664a2                                                            <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> extracting sha256:c2274a1a0e2786ee9101b08f76111f9ab8019e368dce1e325d3c284a0ca33397                                                            <span class="token number">2</span>.8s</pre></td></tr><tr><td data-num="19"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> exporting to image                                                                                                                               <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="20"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> exporting layers                                                                                                                              <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> writing image sha256:d92b26b799ba6c537e486f7619b96f16ae44e8d4fb296ab05cd80e9d764f5b30                                                         <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> naming to docker.io/library/javaweb:1.0                                                                                                       <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="23"></td><td><pre>➜  docker-demo</pre></td></tr></table></figure><p>构建完成！</p><p>再次进行访问页面 uri：<span class="exturl" data-url="aHR0cDovLzE5Mi4xNjguMjQ5LjEyODo4MDkwL2hlbGxvL2NvdW50">http://192.168.249.128:8090/hello/count</span></p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310091951847.png" alt="image-20231009194918244"></p><blockquote><p>总结:</p><ol><li>Dockerfile 的本质是一个文件，通过指令描述镜像的构建过程</li><li>Dockerfile 的第一行必须是 FROM，从一个基础镜像来构建</li><li>基础镜像可以是基本操作系统，如 Ubuntu。也可以是其它人制作好的镜像，例如：java:8-alpine 亦或者 openjdk:8-alpine</li></ol></blockquote><h3 id="765-dockercompose"><a class="anchor" href="#765-dockercompose">#</a> 7.6.5、DockerCompose🌲</h3><ul><li>初始 DockerCompose</li><li>部署微服务集群</li></ul><p>实际生产环境中微服务很多很多，数十上百甚至上千个微服务我们如果一个一个去构建这可得累死了。所以我们需要有一种集群部署的手段，那么这就是我们要学习的 DockerCompose 了</p><h4 id="7651-什么是dockercompose"><a class="anchor" href="#7651-什么是dockercompose">#</a> 7.6.5.1、什么是 DockerCompose🌴</h4><ul><li>DockerCompose 可以基于 Compose 文件帮我们快速的部署分布式应用，而无需手动一个一个创建和运行容器！</li><li>Compose 文件是一个文本文件， 通过指令定义集群中的每个容器如果运行。</li><li>Compose 文件是把 Docker run 命令集合进来的然后把语法转换了一下</li></ul><p>DockerCompose 文件就是把 Docker run 的各种参数转换成指令去定义了。</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310092019582.png" alt="image-20231009201930379"></p><ul><li>DockerCompose 的详细语法参考官网：<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vY29tcG9zZS9jb21wb3NlLWZpbGUv">https://docs.docker.com/compose/compose-file/</span></li></ul><p>上面了解后我们就进行安装 DockerCompose：<a href="./Docker/Centos7%E5%AE%89%E8%A3%85Docker.md">查看安装文章</a>.</p><blockquote><p><strong>总结</strong>：</p><p>DockerCompose 有什么用？</p><ul><li>帮助我们快速部署分布式应用，无需一个一个微服务去构建镜像和部署</li></ul></blockquote><h4 id="7652-dockercompose部署"><a class="anchor" href="#7652-dockercompose部署">#</a> 7.6.5.2、DockerCompose 部署🌴</h4><p><strong>案例，将之前学习的 cloud-demo 微服务集群利用 DockerCompose 部署</strong>.</p><p>实现思路如下：</p><p>1、创建与 cloud-demo 项目目录相同的几个文件夹</p><p>三个微服务需要依赖于 mysql 所以需要准备 mysql 的数据</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310092043951.png" alt="image-20231009204357169"></p><p>2、每个文件夹里面存放 Dockerfile 文件，内容如下：</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 基础镜像</span></pre></td></tr><tr><td data-num="2"></td><td><pre>FROM java:8-alpine</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 拷贝当前目录中的 app.jar 到 tem 目录中，将运行的 jar 包拷贝到镜像中</span></pre></td></tr><tr><td data-num="4"></td><td><pre>COPY ./app.jar /tmp/app.jar</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 启动脚本</span></pre></td></tr><tr><td data-num="6"></td><td><pre>ENTRYPOINT <span class="token function">java</span> <span class="token parameter variable">-jar</span> /tmp/app.jar</pre></td></tr></table></figure><p>除了 mysql 的目录中再创建两个目录</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310092047841.png" alt="image-20231009204740200"></p><p>conf 目录中存放 mysql 配置文件</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310092048636.png" alt="image-20231009204801023"></p><p>data 目录里面存放数据库的数据</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310092048062.png" alt="image-20231009204831646"></p><p>3、最外层创建一个 docker-compose.yml 文件</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310092049638.png" alt="image-20231009204929278"></p><p>内容为：</p><figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.2"</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">services</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">nacos</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> nacos/nacos<span class="token punctuation">-</span>server</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span> <span class="token comment"># 环境配置，启动参数</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token key atrule">MODE</span><span class="token punctuation">:</span> standalone</pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"8848:8848"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token key atrule">mysql</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span>5.7.25</pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> <span class="token number">123</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment"># 数据卷挂载</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span> <span class="token comment"># 使用 Linux 指令 pwd 获取当前目录位置然后从这个位置找对应的目录，不写硬编码</span></pre></td></tr><tr><td data-num="16"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"$PWD/mysql/data:/var/lib/mysql"</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"$PWD/mysql/conf:/etc/mysql/conf.d/"</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token key atrule">userservice</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token comment"># 服务构建基于 dockerfile 完成构建，在当前目录下的 user-service 目录下找到 dockerfile 进行构建镜像</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./user<span class="token punctuation">-</span>service</pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token comment"># 服务构建基于 dockerfile 完成构建，在当前目录下的 order-service 目录下找到 dockerfile 进行构建镜像</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token key atrule">orderservice</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./order<span class="token punctuation">-</span>service</pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token key atrule">gateway</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token comment"># 网关构建基于 dockerfile 完成构建，在当前目录下的 gateway 目录下找到 dockerfile 进行构建镜像</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./gateway</pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token comment"># 只有网关暴漏了端口，剩下上面的微服务都没有暴漏，因为网关才是入口而不应该将微服务暴漏出去</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"10010:10010"</span></pre></td></tr></table></figure><p>将来 DockerCompose 就会帮我们自动的去构建这三个微服务的镜像了，实现一次性部署</p><p>4、修改自己的 cloud-demo 项目，将数据库，nacos 地址都命名为 docker-compose 中的服务名</p><p>不能把 nacos，数据库之类的配置地址写死，因为微服务可能配置在不同的机器上</p><blockquote><p>用 DockerCompose 部署时所有的服务之间都可以用服务名称去互相访问，这是 DockerCompose 底层做了一些配置</p></blockquote><p>user-service 中的 nacos 配置</p><figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">application</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token key atrule">name</span><span class="token punctuation">:</span> userservice <span class="token comment"># 服务名称</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">profiles</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev <span class="token comment"># 环境</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token key atrule">nacos</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> nacos<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment"># nacos 地址</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token comment"># cluster-name: TJ</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token key atrule">config</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment"># 配置文件后缀名</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># 三要素：服务名称，环境，后缀名 而这三个决定了 DateId</span></pre></td></tr></table></figure><p>user-service 中的 mysql 配置</p><figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">datasource</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//mysql<span class="token punctuation">:</span>3306/cloud_user<span class="token punctuation">?</span>useSSL=false<span class="token important">&amp;characterEncoding=utf-8&amp;serverTimezone=UTC</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">username</span><span class="token punctuation">:</span> root</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">password</span><span class="token punctuation">:</span> dkx.</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver</pre></td></tr></table></figure><p>同样将 order-service 中的 mysql 和 nacos 地址配置改过来</p><figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">datasource</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//mysql<span class="token punctuation">:</span>3306/cloud_order<span class="token punctuation">?</span>useSSL=false<span class="token important">&amp;characterEncoding=utf-8&amp;serverTimezone=UTC</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">username</span><span class="token punctuation">:</span> root</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">password</span><span class="token punctuation">:</span> dkx.</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver</pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token key atrule">application</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token key atrule">name</span><span class="token punctuation">:</span> orderservice</pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token key atrule">nacos</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> nacos<span class="token punctuation">:</span><span class="token number">8848</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token comment"># cluster-name: HZ # 集群名称</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token comment"># namespace: ed32fa6f-e9e3-4483-b860-7bcd9731d0d9 # 命名空间，填 ID dev 环境</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token key atrule">ephemeral</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 设置是否为临时实例 设置为非临时实例</span></pre></td></tr></table></figure><p>修改网关服务的 nacos 地址配置</p><figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#=========== 这些配置让网关能够联系上 nacos 实现服务注册和发现 ====</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">server</span><span class="token punctuation">:</span>                                              <span class="token comment">#||</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10010</span> <span class="token comment"># 网关端口                              #||</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span>                                              <span class="token comment">#||</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token key atrule">application</span><span class="token punctuation">:</span>                                       <span class="token comment">#||</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway <span class="token comment"># 服务名称                           #||</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>                                              <span class="token comment">#||</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>                                            <span class="token comment">#||</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> nacos<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment"># nacos 地址          #||</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">#========================================================</span></pre></td></tr></table></figure><p>5、使用 maven 打包工具，将项目中的每个微服务都打包为 app.jar 文件</p><p>如果要让项目打包为 app.jar 名称则需要在 pom.xml 文件中配置如下：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>finalName</span><span class="token punctuation">></span></span>app<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>finalName</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>我们在所有需要打包的服务中的 pom 文件里面进行配置</p><p>先进行一下 clean 清空一个然后再进行 install 安装本地</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310092114297.png" alt="image-20231009211435849"></p><p>6、将打包好的 app.jar 拷贝到 cloud-demo 中的每一个对应的子目录中</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310092123149.png" alt="image-20231009212348796"></p><p>7、将 cloud-demo 上传至虚拟机，利用 docker-compose up -d 来部署</p><p>参数说明：up - 创建并执行容器</p><p>​ -d - 后台运行</p><p>其它参数 help 参见</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310092126664.png" alt="image-20231009212636444"></p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost tmp<span class="token punctuation">]</span><span class="token comment"># cd cloud-demo/</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@localhost cloud-demo<span class="token punctuation">]</span><span class="token comment"># ls</span></pre></td></tr><tr><td data-num="3"></td><td><pre>docker-compose.yml  gateway  mysql  order-service  user-service</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@localhost cloud-demo<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>使用命令进行部署</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost cloud-demo<span class="token punctuation">]</span><span class="token comment"># docker-compose up -d</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Building userservice</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>+<span class="token punctuation">]</span> Building <span class="token number">3</span>.5s <span class="token punctuation">(</span><span class="token number">7</span>/7<span class="token punctuation">)</span> FINISHED                                                                                                           docker:default</pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load build definition from Dockerfile                                                                                                 <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> transferring dockerfile: 182B                                                                                                                 <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load .dockerignore                                                                                                                    <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> transferring context: 2B                                                                                                                      <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load metadata <span class="token keyword">for</span> docker.io/library/openjdk:8-alpine                                                                                  <span class="token number">2</span>.7s</pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load build context                                                                                                                    <span class="token number">0</span>.3s</pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> transferring context: <span class="token number">39</span>.30MB                                                                                                                 <span class="token number">0</span>.3s</pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> CACHED <span class="token punctuation">[</span><span class="token number">1</span>/2<span class="token punctuation">]</span> FROM docker.io/library/openjdk:8-alpine@sha256:94792824df2df33402f201713f932b58cb9de94a0cd524164a0f2283343547b3                     <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token number">2</span>/2<span class="token punctuation">]</span> COPY ./app.jar /tmp/app.jar                                                                                                                <span class="token number">0</span>.2s</pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> exporting to image                                                                                                                               <span class="token number">0</span>.3s</pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> exporting layers                                                                                                                              <span class="token number">0</span>.2s</pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> writing image sha256:ab22b9b33217d7b1e7287dc7b16564ba7a683bcc390e961ffb7d6f77069ea697                                                         <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> naming to docker.io/library/cloud-demo_userservice                                                                                            <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="17"></td><td><pre>WARNING: Image <span class="token keyword">for</span> <span class="token function">service</span> userservice was built because it did not already exist. To rebuild this image you must use <span class="token variable"><span class="token variable">`</span><span class="token function">docker-compose</span> build<span class="token variable">`</span></span> or <span class="token variable"><span class="token variable">`</span><span class="token function">docker-compose</span> up <span class="token parameter variable">--build</span><span class="token variable">`</span></span><span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="18"></td><td><pre>Building orderservice</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">[</span>+<span class="token punctuation">]</span> Building <span class="token number">1</span>.4s <span class="token punctuation">(</span><span class="token number">7</span>/7<span class="token punctuation">)</span> FINISHED                                                                                                           docker:default</pre></td></tr><tr><td data-num="20"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load build definition from Dockerfile                                                                                                 <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> transferring dockerfile: 182B                                                                                                                 <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load .dockerignore                                                                                                                    <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="23"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> transferring context: 2B                                                                                                                      <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="24"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load metadata <span class="token keyword">for</span> docker.io/library/openjdk:8-alpine                                                                                  <span class="token number">0</span>.6s</pre></td></tr><tr><td data-num="25"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load build context                                                                                                                    <span class="token number">0</span>.3s</pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> transferring context: <span class="token number">41</span>.82MB                                                                                                                 <span class="token number">0</span>.3s</pre></td></tr><tr><td data-num="27"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> CACHED <span class="token punctuation">[</span><span class="token number">1</span>/2<span class="token punctuation">]</span> FROM docker.io/library/openjdk:8-alpine@sha256:94792824df2df33402f201713f932b58cb9de94a0cd524164a0f2283343547b3                     <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token number">2</span>/2<span class="token punctuation">]</span> COPY ./app.jar /tmp/app.jar                                                                                                                <span class="token number">0</span>.1s</pre></td></tr><tr><td data-num="29"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> exporting to image                                                                                                                               <span class="token number">0</span>.2s</pre></td></tr><tr><td data-num="30"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> exporting layers                                                                                                                              <span class="token number">0</span>.2s</pre></td></tr><tr><td data-num="31"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> writing image sha256:4fb619347bfb2d9aac0e824d4334973c18761b4ee64c1f9fddbd3b6041b8fad1                                                         <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="32"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> naming to docker.io/library/cloud-demo_orderservice                                                                                           <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="33"></td><td><pre>WARNING: Image <span class="token keyword">for</span> <span class="token function">service</span> orderservice was built because it did not already exist. To rebuild this image you must use <span class="token variable"><span class="token variable">`</span><span class="token function">docker-compose</span> build<span class="token variable">`</span></span> or <span class="token variable"><span class="token variable">`</span><span class="token function">docker-compose</span> up <span class="token parameter variable">--build</span><span class="token variable">`</span></span><span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="34"></td><td><pre>Building gateway</pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">[</span>+<span class="token punctuation">]</span> Building <span class="token number">1</span>.2s <span class="token punctuation">(</span><span class="token number">7</span>/7<span class="token punctuation">)</span> FINISHED                                                                                                           docker:default</pre></td></tr><tr><td data-num="36"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load build definition from Dockerfile                                                                                                 <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="37"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> transferring dockerfile: 182B                                                                                                                 <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="38"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load .dockerignore                                                                                                                    <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="39"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> transferring context: 2B                                                                                                                      <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="40"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load metadata <span class="token keyword">for</span> docker.io/library/openjdk:8-alpine                                                                                  <span class="token number">0</span>.6s</pre></td></tr><tr><td data-num="41"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load build context                                                                                                                    <span class="token number">0</span>.3s</pre></td></tr><tr><td data-num="42"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> transferring context: <span class="token number">39</span>.92MB                                                                                                                 <span class="token number">0</span>.3s</pre></td></tr><tr><td data-num="43"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> CACHED <span class="token punctuation">[</span><span class="token number">1</span>/2<span class="token punctuation">]</span> FROM docker.io/library/openjdk:8-alpine@sha256:94792824df2df33402f201713f932b58cb9de94a0cd524164a0f2283343547b3                     <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="44"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token number">2</span>/2<span class="token punctuation">]</span> COPY ./app.jar /tmp/app.jar                                                                                                                <span class="token number">0</span>.1s</pre></td></tr><tr><td data-num="45"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> exporting to image                                                                                                                               <span class="token number">0</span>.2s</pre></td></tr><tr><td data-num="46"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> exporting layers                                                                                                                              <span class="token number">0</span>.2s</pre></td></tr><tr><td data-num="47"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> writing image sha256:53993c010033dc8356f48ddd183ad1768544070ceb7e803ada30d20e9b3ae316                                                         <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="48"></td><td><pre> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> naming to docker.io/library/cloud-demo_gateway                                                                                                <span class="token number">0</span>.0s</pre></td></tr><tr><td data-num="49"></td><td><pre>WARNING: Image <span class="token keyword">for</span> <span class="token function">service</span> gateway was built because it did not already exist. To rebuild this image you must use <span class="token variable"><span class="token variable">`</span><span class="token function">docker-compose</span> build<span class="token variable">`</span></span> or <span class="token variable"><span class="token variable">`</span><span class="token function">docker-compose</span> up <span class="token parameter variable">--build</span><span class="token variable">`</span></span><span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="50"></td><td><pre>Creating cloud-demo_nacos_1        <span class="token punctuation">..</span>. <span class="token keyword">done</span></pre></td></tr><tr><td data-num="51"></td><td><pre>Creating cloud-demo_userservice_1  <span class="token punctuation">..</span>. <span class="token keyword">done</span></pre></td></tr><tr><td data-num="52"></td><td><pre>Creating cloud-demo_mysql_1        <span class="token punctuation">..</span>. <span class="token keyword">done</span></pre></td></tr><tr><td data-num="53"></td><td><pre>Creating cloud-demo_gateway_1      <span class="token punctuation">..</span>. <span class="token keyword">done</span></pre></td></tr><tr><td data-num="54"></td><td><pre>Creating cloud-demo_orderservice_1 <span class="token punctuation">..</span>. <span class="token keyword">done</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token punctuation">[</span>root@localhost cloud-demo<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>部署成功使用命令查看启动日志：docker-compose logs -f</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost cloud-demo<span class="token punctuation">]</span><span class="token comment"># docker-compose logs -f</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Attaching to cloud-demo_orderservice_1, cloud-demo_gateway_1, cloud-demo_userservice_1, cloud-demo_mysql_1, cloud-demo_nacos_1</pre></td></tr><tr><td data-num="3"></td><td><pre>gateway_1       <span class="token operator">|</span></pre></td></tr><tr><td data-num="4"></td><td><pre>gateway_1       <span class="token operator">|</span>   <span class="token builtin class-name">.</span>   ____          _            __ _ _</pre></td></tr><tr><td data-num="5"></td><td><pre>gateway_1       <span class="token operator">|</span>  /<span class="token punctuation">\</span><span class="token punctuation">\</span> / ___<span class="token string">'_ __ _ _(_)_ __  __ _ \ \ \ \</span></pre></td></tr><tr><td data-num="6"></td><td><pre>gateway_1       | ( ( )\___ | '_ <span class="token operator">|</span> <span class="token string">'_| | '</span>_ <span class="token punctuation">\</span>/ _` <span class="token operator">|</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="7"></td><td><pre>gateway_1       <span class="token operator">|</span>  <span class="token punctuation">\</span><span class="token punctuation">\</span>/  ___<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token operator">|</span>_<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">||</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span>  <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>gateway_1       <span class="token operator">|</span>   '  <span class="token operator">|</span>____<span class="token operator">|</span> .__<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token punctuation">\</span>__, <span class="token operator">|</span> / / / /</pre></td></tr><tr><td data-num="9"></td><td><pre>gateway_1       <span class="token operator">|</span>  <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">|</span>_<span class="token operator">|</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">|</span>___/<span class="token operator">=</span>/_/_/_/</pre></td></tr><tr><td data-num="10"></td><td><pre>gateway_1       <span class="token operator">|</span>  :: Spring Boot ::        <span class="token punctuation">(</span>v2.3.9.RELEASE<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>gateway_1       <span class="token operator">|</span></pre></td></tr><tr><td data-num="12"></td><td><pre>gateway_1       <span class="token operator">|</span> <span class="token number">10</span>-09 <span class="token number">13</span>:37:38:143  INFO <span class="token number">1</span> --- <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> cn.itcast.gateway.GatewayApplication     <span class="token builtin class-name">:</span> No active profile set, falling back to default profiles: default</pre></td></tr><tr><td data-num="13"></td><td><pre>gateway_1       <span class="token operator">|</span> <span class="token number">10</span>-09 <span class="token number">13</span>:37:41:667  INFO <span class="token number">1</span> --- <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> o.s.cloud.context.scope.GenericScope     <span class="token builtin class-name">:</span> BeanFactory <span class="token assign-left variable">id</span><span class="token operator">=</span>87ef38f0-5652-3427-832e-5397c91e63b6</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">..</span><span class="token punctuation">..</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">..</span><span class="token punctuation">..</span></pre></td></tr></table></figure><p>启动时 nacos 会报错因为它启动的比较慢我们需要先启动 nacos 执行命令： <code>docker-compose up -d nacos</code></p><p>等待 nacos 启动完成后可以访问 uri 测试一下：<span class="exturl" data-url="aHR0cDovLzE5Mi4xNjguMjQ5LjEyODo4ODQ4L25hY29z">http://192.168.249.128:8848/nacos</span></p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310101029911.png" alt="image-20231010102946333"></p><p>如果有报错信息可以使用命令重启服务 <code>docker-compose restart gateway userservice orderservice</code></p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost cloud-demo<span class="token punctuation">]</span><span class="token comment"># docker-compose restart gateway userservice orderservice</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Restarting cloud-demo_orderservice_1 <span class="token punctuation">..</span>. <span class="token keyword">done</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Restarting cloud-demo_gateway_1      <span class="token punctuation">..</span>. <span class="token keyword">done</span></pre></td></tr><tr><td data-num="4"></td><td><pre>Restarting cloud-demo_userservice_1  <span class="token punctuation">..</span>. <span class="token keyword">done</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>root@localhost cloud-demo<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><h3 id="766-docker镜像仓库"><a class="anchor" href="#766-docker镜像仓库">#</a> 7.6.6、Docker 镜像仓库🌲</h3><ul><li>搭建私有镜像仓库</li><li>向镜像仓库推送镜像</li><li>从镜像仓库拉取镜像</li></ul><h4 id="7661-常见镜像仓库服务"><a class="anchor" href="#7661-常见镜像仓库服务">#</a> 7.6.6.1、常见镜像仓库服务🌴</h4><p>镜像仓库 (Docker Registry) 有公共和私有的两种形式：</p><ul><li>公共仓库：例如 Docker 官方的 Docker Hub，国内也有一些服务商提供类似于 Docker Hub 的公开服务，比如 网易云镜像服务，DaoCloud 镜像服务，阿里云镜像服务等。</li><li>除了使用公开仓库外，用户还可以在本地搭建私有 Docker Registry。企业自己的镜像最好是采用私有 Docker Registry 来实现。</li></ul><h4 id="7662-创建私服镜像仓库查看文章"><a class="anchor" href="#7662-创建私服镜像仓库查看文章">#</a> 7.6.6.2、创建私服镜像仓库查看文章🌴</h4><p><a href="./Docker/Centos7%E5%AE%89%E8%A3%85Docker.md">查看 Docker 带有图形化镜像仓库</a>.</p><h4 id="7663-在私有镜像仓库推送或拉取镜像"><a class="anchor" href="#7663-在私有镜像仓库推送或拉取镜像">#</a> 7.6.6.3、在私有镜像仓库推送或拉取镜像🌴</h4><p>推送镜像到私有镜像服务必须先 tag，步骤如下：</p><p>1、重新 tag 本地镜像，名称前缀为私有仓库的地址：192.168.150.101:8080/</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">docker</span> tag nginx:latest <span class="token number">192.168</span>.150.101:8080/nginx:1.0</pre></td></tr></table></figure><p>使用 docker images 查看打包好的镜像</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202310101215960.png" alt="image-20231010121530321"></p><p>2、推送镜像</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">docker</span> push <span class="token number">192.168</span>.150.101:8080/nginx:1.0</pre></td></tr></table></figure><p>3、拉取镜像</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">docker</span> pull <span class="token number">192.168</span>.150.101:8080/nginx:1.0</pre></td></tr></table></figure><blockquote><p><strong>总结</strong>：</p><ol><li>推送本地镜像到仓库前都必须重命名 (docker tag) 镜像，以镜像仓库地址为前缀</li><li>镜像仓库推送前需要把仓库地址配置到 docker 服务的 daemon.json 文件中，被 docker 信任</li><li>推送使用 docker push 命令</li><li>拉取使用 docker pull 命令</li></ol></blockquote><div class="tags"><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E7%A7%91/" rel="tag"><i class="ic i-tag"></i> 计算机学科</a> <a href="/tags/springcloud/" rel="tag"><i class="ic i-tag"></i> springcloud</a> <a href="/tags/Docker/" rel="tag"><i class="ic i-tag"></i> Docker</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-01-06 10:29:42" itemprop="dateModified" datetime="2024-01-06T10:29:42+08:00">2024-01-06</time> </span><span id="computer-science/java/spring/springcloud/Docker/springcloud-docker/" class="item leancloud_visitors" data-flag-title="七、Docker" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="D 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="D 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="D 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Dkx： </strong>D <i class="ic i-at"><em>@</em></i>D の Java</li><li class="link"><strong>本文链接：</strong> <a href="https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Docker/springcloud-docker/" title="七、Docker">https://pigpigletsgo.github.io/computer-science/java/spring/springcloud/Docker/springcloud-docker/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/computer-science/java/spring/springcloud/Docker/Linux%E4%B8%ADDocker%E7%9A%84%E4%B8%8B%E8%BD%BD%E5%92%8C%E5%AE%89%E8%A3%85/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;img.timelessq.com&#x2F;images&#x2F;2022&#x2F;07&#x2F;26&#x2F;4c481240fd5e6e7b076ca8fe50da6e52.jpg" title="Linux中Docker的下载和安装"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Docker</span><h3>Linux中Docker的下载和安装</h3></a></div><div class="item right"><a href="/computer-science/java/spring/springcloud/Elasticsearch/springcloud-elasticsearch/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;img.timelessq.com&#x2F;images&#x2F;2022&#x2F;07&#x2F;26&#x2F;6a834199cae04e75c335d444704c2060.jpg" title="九、分布式搜索"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> Elasticsearch</span><h3>九、分布式搜索</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83-docker"><span class="toc-number">1.</span> <span class="toc-text">七、Docker🎄</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#71-%E5%88%9D%E5%A7%8Bdocker"><span class="toc-number">1.1.</span> <span class="toc-text">7.1、初始 Docker🌳</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#711-docker%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E4%BE%9D%E8%B5%96%E7%9A%84%E5%85%BC%E5%AE%B9%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.1.</span> <span class="toc-text">7.1.1、Docker 如何解决依赖的兼容问题？🌲</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#712-%E5%9F%BA%E6%9C%AC%E4%BA%86%E8%A7%A3%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.2.</span> <span class="toc-text">7.1.2、基本了解操作系统结构🌲</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#72-docker%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">1.2.</span> <span class="toc-text">7.2、Docker 与虚拟机🌳</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#72-%E9%95%9C%E5%83%8F%E5%92%8C%E5%AE%B9%E5%99%A8"><span class="toc-number">1.3.</span> <span class="toc-text">7.2、镜像和容器🌳</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#73-%E5%85%B1%E4%BA%AB%E9%95%9C%E5%83%8F"><span class="toc-number">1.4.</span> <span class="toc-text">7.3、共享镜像🌳</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#731-docker%E5%92%8Cdockerhub"><span class="toc-number">1.4.1.</span> <span class="toc-text">7.3.1、Docker 和 DockerHub🌲</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#74-docker%E6%9E%B6%E6%9E%84"><span class="toc-number">1.5.</span> <span class="toc-text">7.4、Docker 架构🌳</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#75-docker%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.</span> <span class="toc-text">7.5、Docker 基本操作🌳</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#751-%E9%95%9C%E5%83%8F%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">1.6.1.</span> <span class="toc-text">7.5.1、镜像相关命令🌲</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7511-%E9%95%9C%E5%83%8F%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">7.5.1.1、镜像操作命令🌴</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#752-%E6%A1%88%E4%BE%8B%E4%BB%8Edockerhub%E4%B8%AD%E6%8B%89%E5%8F%96%E4%B8%80%E4%B8%AAnginx%E9%95%9C%E5%83%8F%E5%B9%B6%E6%9F%A5%E7%9C%8B"><span class="toc-number">1.6.2.</span> <span class="toc-text">7.5.2、案例，从 DockerHub 中拉取一个 nginx 镜像并查看🌲</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#753-%E6%A1%88%E4%BE%8B%E5%88%A9%E7%94%A8docker-save%E5%B0%86nginx%E9%95%9C%E5%83%8F%E5%AF%BC%E5%87%BA%E7%A3%81%E7%9B%98%E7%84%B6%E5%90%8E%E5%86%8D%E9%80%9A%E8%BF%87load%E5%8A%A0%E8%BD%BD%E5%9B%9E%E6%9D%A5"><span class="toc-number">1.6.3.</span> <span class="toc-text">7.5.3、案例，利用 docker save 将 nginx 镜像导出磁盘，然后再通过 load 加载回来🌲</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#754-%E8%87%AA%E5%B7%B1%E7%BB%83%E4%B9%A0%E5%8E%BBdockerhub%E6%90%9C%E7%B4%A2%E5%B9%B6%E6%8B%89%E5%8F%96%E4%B8%80%E4%B8%AAredis%E9%95%9C%E5%83%8F"><span class="toc-number">1.6.4.</span> <span class="toc-text">7.5.4、(自己练习) 去 DockerHub 搜索并拉取一个 Redis 镜像🌲</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#755-%E5%AE%B9%E5%99%A8%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">1.6.5.</span> <span class="toc-text">7.5.5、容器相关命令🌲</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7551-%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E7%9A%84%E7%8A%B6%E6%80%81"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">7.5.5.1、查看容器的状态🌴</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7552-%E5%88%9B%E5%BB%BA%E8%BF%90%E8%A1%8C%E4%B8%80%E4%B8%AAnginx%E5%AE%B9%E5%99%A8"><span class="toc-number">1.6.5.2.</span> <span class="toc-text">7.5.5.2、创建运行一个 Nginx 容器🌴</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#75521-%E6%8C%81%E7%BB%AD%E8%BE%93%E5%87%BA%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.5.2.1.</span> <span class="toc-text">7.5.5.2.1、持续输出日志🎋</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7553-%E8%BF%9B%E5%85%A5nginx%E5%AE%B9%E5%99%A8%E4%BF%AE%E6%94%B9html%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E6%B7%BB%E5%8A%A0-%E4%BC%A0%E6%99%BA%E6%95%99%E8%82%B2%E6%AC%A2%E8%BF%8E%E6%82%A8"><span class="toc-number">1.6.5.3.</span> <span class="toc-text">7.5.5.3、进入 Nginx 容器，修改 HTML 文件内容，添加 “传智教育欢迎您”🌴</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#756-%E6%9F%A5%E7%9C%8B%E5%81%9C%E6%AD%A2%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="toc-number">1.6.6.</span> <span class="toc-text">7.5.6、查看停止的容器🌲</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#757-%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.6.7.</span> <span class="toc-text">7.5.7、数据卷🌲</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7571-%E6%95%B0%E6%8D%AE%E5%85%B1%E4%BA%AB"><span class="toc-number">1.6.7.1.</span> <span class="toc-text">7.5.7.1、数据共享🌴</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7572-%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E5%88%A0%E9%99%A4%E9%97%AE%E9%A2%98"><span class="toc-number">1.6.7.2.</span> <span class="toc-text">7.5.7.2、数据安全删除问题🌴</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7573-%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.6.7.3.</span> <span class="toc-text">7.5.7.3、操作数据卷🌴</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#75731-%E6%A1%88%E4%BE%8B%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%B9%B6%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%9C%A8%E5%AE%BF%E4%B8%BB%E6%9C%BA%E7%9A%84%E7%9B%AE%E5%BD%95%E4%BD%8D%E7%BD%AE"><span class="toc-number">1.6.7.3.1.</span> <span class="toc-text">7.5.7.3.1、案例，创建一个数据卷，并查看数据卷在宿主机的目录位置🎋</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7574-%E6%8C%82%E8%BD%BD%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.6.7.4.</span> <span class="toc-text">7.5.7.4、挂载数据卷🌴</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#75741-%E6%A1%88%E4%BE%8B%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAnginx%E5%AE%B9%E5%99%A8%E4%BF%AE%E6%94%B9%E5%AE%B9%E5%99%A8%E5%86%85%E7%9A%84html%E7%9B%AE%E5%BD%95%E5%86%85%E7%9A%84indexhtml%E5%86%85%E5%AE%B9"><span class="toc-number">1.6.7.4.1.</span> <span class="toc-text">7.5.7.4.1、案例，创建一个 Nginx 容器，修改容器内的 html 目录内的 index.html 内容🎋</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#75742-%E5%AE%BF%E4%B8%BB%E6%9C%BA%E7%9B%B4%E6%8E%A5%E4%B8%8E%E5%AE%B9%E5%99%A8%E8%BF%9B%E8%A1%8C%E6%8C%82%E8%BD%BD"><span class="toc-number">1.6.7.4.2.</span> <span class="toc-text">7.5.7.4.2、宿主机直接与容器进行挂载🎋</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7575-%E6%95%B0%E6%8D%AE%E5%8D%B7%E6%8C%82%E8%BD%BD%E5%92%8C%E7%9B%AE%E5%BD%95%E7%9B%B4%E6%8E%A5%E6%8C%82%E8%BD%BD%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.6.7.5.</span> <span class="toc-text">7.5.7.5、数据卷挂载和目录直接挂载的区别🌴</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#76-dockerfile%E8%87%AA%E5%AE%9A%E4%B9%89%E9%95%9C%E5%83%8F"><span class="toc-number">1.7.</span> <span class="toc-text">7.6、Dockerfile 自定义镜像🌳</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%95%9C%E5%83%8F"><span class="toc-number">1.7.1.</span> <span class="toc-text">自定义镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#761-%E9%95%9C%E5%83%8F%E7%BB%93%E6%9E%84"><span class="toc-number">1.7.1.1.</span> <span class="toc-text">7.6.1、镜像结构🌴</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#762-%E4%BB%80%E4%B9%88%E6%98%AFdockerfile"><span class="toc-number">1.8.</span> <span class="toc-text">7.6.2、什么是 Dockerfile🌲</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#763-%E6%A1%88%E4%BE%8B%E5%9F%BA%E4%BA%8Eubuntu%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E9%95%9C%E5%83%8F%E8%BF%90%E8%A1%8C%E4%B8%80%E4%B8%AAjava%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.9.</span> <span class="toc-text">7.6.3、案例，基于 Ubuntu 镜像构建一个新镜像，运行一个 java 项目🌲</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#764-%E5%9F%BA%E4%BA%8Ejava8-alpine%E9%95%9C%E5%83%8F%E5%B0%86%E4%B8%80%E4%B8%AAjava%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E4%B8%BA%E9%95%9C%E5%83%8F"><span class="toc-number">1.10.</span> <span class="toc-text">7.6.4、基于 java:8-alpine 镜像，将一个 java 项目构建为镜像🌲</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#765-dockercompose"><span class="toc-number">1.11.</span> <span class="toc-text">7.6.5、DockerCompose🌲</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7651-%E4%BB%80%E4%B9%88%E6%98%AFdockercompose"><span class="toc-number">1.11.1.</span> <span class="toc-text">7.6.5.1、什么是 DockerCompose🌴</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7652-dockercompose%E9%83%A8%E7%BD%B2"><span class="toc-number">1.11.2.</span> <span class="toc-text">7.6.5.2、DockerCompose 部署🌴</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#766-docker%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93"><span class="toc-number">1.12.</span> <span class="toc-text">7.6.6、Docker 镜像仓库🌲</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7661-%E5%B8%B8%E8%A7%81%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.12.1.</span> <span class="toc-text">7.6.6.1、常见镜像仓库服务🌴</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7662-%E5%88%9B%E5%BB%BA%E7%A7%81%E6%9C%8D%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E6%9F%A5%E7%9C%8B%E6%96%87%E7%AB%A0"><span class="toc-number">1.12.2.</span> <span class="toc-text">7.6.6.2、创建私服镜像仓库查看文章🌴</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7663-%E5%9C%A8%E7%A7%81%E6%9C%89%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E6%8E%A8%E9%80%81%E6%88%96%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F"><span class="toc-number">1.12.3.</span> <span class="toc-text">7.6.6.3、在私有镜像仓库推送或拉取镜像🌴</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/computer-science/java/spring/springcloud/Docker/Linux%E4%B8%ADDocker%E7%9A%84%E4%B8%8B%E8%BD%BD%E5%92%8C%E5%AE%89%E8%A3%85/" rel="bookmark" title="Linux中Docker的下载和安装">Linux中Docker的下载和安装</a></li><li class="active"><a href="/computer-science/java/spring/springcloud/Docker/springcloud-docker/" rel="bookmark" title="七、Docker">七、Docker</a></li><li><a href="/computer-science/java/spring/springcloud/Docker/%E8%87%AA%E5%8A%A8%E5%90%AF%E5%8A%A8docker%E7%9A%84%E6%9F%90%E4%BA%9B%E5%AE%B9%E5%99%A8/" rel="bookmark" title="自动启动docker里面的某些容器">自动启动docker里面的某些容器</a></li><li><a href="/computer-science/java/spring/springcloud/Docker/docker%E5%AE%B9%E5%99%A8%E4%B8%80%E9%94%AE%E5%90%AF%E5%8A%A8%E5%92%8C%E5%85%B3%E9%97%AD/" rel="bookmark" title="docker一键启动和关闭，删除所有镜像">docker一键启动和关闭，删除所有镜像</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="D" data-src="/images/avatar.jpg"><p class="name" itemprop="name">D</p><div class="description" itemprop="description">欢迎来我的博客空间</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">483</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">119</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">155</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1BpZ1BpZ0xldHNHbw==" title="https:&#x2F;&#x2F;github.com&#x2F;PigPigLetsGo"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9Ea3gxMjE5" title="https:&#x2F;&#x2F;twitter.com&#x2F;Dkx1219"><i class="ic i-twitter"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS96dWktaG91LXllLWJlaS1sdWUtc2hh" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;zui-hou-ye-bei-lue-sha"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTU3NjUxMDQ1OQ==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;576510459"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93d3cud2VpYm8uY29tL3UvNTk5OTU0OTg0MQ==" title="https:&#x2F;&#x2F;www.weibo.com&#x2F;u&#x2F;5999549841"><i class="ic i-weibo"></i></span> <span class="exturl item facebook" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDA5NDA4Nzc0ODIwMQ==" title="https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100094087748201"><i class="ic i-facebook"></i></span> <span class="exturl item stackoverflow" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS91c2Vycy8xOTQwNjAyOS9kLWt4" title="https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;19406029&#x2F;d-kx"><i class="ic i-stack-overflow"></i></span> <span class="exturl item youtube" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vQERreC12djdsbQ==" title="https:&#x2F;&#x2F;www.youtube.com&#x2F;@Dkx-vv7lm"><i class="ic i-youtube"></i></span> <span class="exturl item instagram" data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS9kb3Vka3g/aWdzaD1PR1E1WkRjMk9EazJaQSUzRCUzRCZ1dG1fc291cmNlPXFy" title="https:&#x2F;&#x2F;www.instagram.com&#x2F;doudkx?igsh&#x3D;OGQ5ZDc2ODk2ZA%3D%3D&amp;utm_source&#x3D;qr"><i class="ic i-instagram"></i></span> <span class="exturl item paper-plane" data-url="aHR0cHM6Ly90Lm1lL2RvdTAxMDg=" title="https:&#x2F;&#x2F;t.me&#x2F;dou0108"><i class="ic i-paper-plane"></i></span> <span class="exturl item skype" data-url="aHR0cHM6Ly9qb2luLnNreXBlLmNvbS9UN25TSWhvbmMxcWQ=" title="https:&#x2F;&#x2F;join.skype.com&#x2F;T7nSIhonc1qd"><i class="ic i-skype"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>链接</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/computer-science/java/spring/springcloud/Docker/Linux%E4%B8%ADDocker%E7%9A%84%E4%B8%8B%E8%BD%BD%E5%92%8C%E5%AE%89%E8%A3%85/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/computer-science/java/spring/springcloud/Elasticsearch/springcloud-elasticsearch/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/%E5%B7%A5%E5%85%B7%E7%B1%BB/" title="分类于 工具类">工具类</a></div><span><a href="/computer-science/java/%E5%B7%A5%E5%85%B7%E7%B1%BB/JDBC%E5%B7%A5%E5%85%B7%E7%B1%BB/" title="JDBC工具类">JDBC工具类</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="分类于 设计模式">设计模式</a></div><span><a href="/computer-science/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/" title="原型模式">原型模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/" title="分类于 第三方库">第三方库</a></div><span><a href="/computer-science/java/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/Thymeleaf/" title="Thymeleaf">Thymeleaf</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/web/" title="分类于 web">web</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/web/js/" title="分类于 js">js</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/web/js/%E5%AD%98%E5%82%A8/" title="分类于 存储">存储</a></div><span><a href="/computer-science/web/js/%E5%AD%98%E5%82%A8/localStorage/" title="初始localStorage">初始localStorage</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/%E6%A1%88%E4%BE%8BDemo/" title="分类于 案例 Demo">案例 Demo</a></div><span><a href="/computer-science/java/%E6%A1%88%E4%BE%8BDemo/TCP+JFrame%E5%AE%9E%E7%8E%B0%E8%81%8A%E5%A4%A9/" title="TCP+JFrame实现聊天">TCP+JFrame实现聊天</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/databse/" title="分类于 database">database</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/databse/mongodb/" title="分类于 mongodb">mongodb</a></div><span><a href="/computer-science/database/mongodb/MongoDB%E9%9B%86%E7%BE%A4%E5%92%8C%E5%AE%89%E5%85%A8/" title="MongoDB集群和安全">MongoDB集群和安全</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/" title="分类于 知识点">知识点</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/%E5%AF%B9%E8%B1%A1/" title="分类于 对象">对象</a></div><span><a href="/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/%E5%AF%B9%E8%B1%A1/this%E9%80%83%E9%80%B8/" title="This引用逃逸详解">This引用逃逸详解</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/data-structures-and-algorithms/" title="分类于 数据结构与算法">数据结构与算法</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/data-structures-and-algorithms/%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97/" title="分类于 阻塞队列">阻塞队列</a></div><span><a href="/computer-science/java/data-structures-and-algorithms/%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97/%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97-%E5%8F%8C%E9%94%81%E5%AE%9E%E7%8E%B01/" title="阻塞队列-双锁实现1">阻塞队列-双锁实现1</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/" title="分类于 知识点">知识点</a></div><span><a href="/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/Java%E5%80%BC%E4%BC%A0%E9%80%92%E5%92%8C%E5%BC%95%E7%94%A8%E4%BC%A0%E9%80%92/" title="Java值传递和引用传递的详解">Java值传递和引用传递的详解</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/spring/" title="分类于 spring">spring</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/spring/springmvc/" title="分类于 springmvc">springmvc</a></div><span><a href="/computer-science/java/spring/springmvc/REST%E9%A3%8E%E6%A0%BC/" title="REST风格">REST风格</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">D @ D & PersonalBlog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">3.3m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">50:01</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"computer-science/java/spring/springcloud/Docker/springcloud-docker/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="https://cdn.jsdelivr.net/gh/PigPigLetsGo/live2d-widget@latest/autoload.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>