<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="D の Java小窝" href="https://pigpigletsgo.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="D の Java小窝" href="https://pigpigletsgo.github.io/atom.xml"><link rel="alternate" type="application/json" title="D の Java小窝" href="https://pigpigletsgo.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="计算机学科,database,mongodb"><link rel="canonical" href="https://pigpigletsgo.github.io/computer-science/database/mongodb/MongoDB%E5%85%A5%E9%97%A8/"><title>MongoDB 入门 - mongodb - database - 计算机学科 | D 的个人博客 = D の Java 小窝 = 别怕路长梦远</title><meta name="generator" content="Hexo 5.4.2"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">MongoDB 入门</h1><div class="meta"><span class="item" title="创建时间：2024-01-24 18:48:45"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2024-01-24T18:48:45+08:00">2024-01-24</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>40k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>36 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">D 的个人博客</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/5da180f23a92b4141ea87338ac84c765.jpg"></li><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/560306a4274d1fc26eb475dd52237387.jpg"></li><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/560306a4274d1fc26eb475dd52237387.jpg"></li><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/560306a4274d1fc26eb475dd52237387.jpg"></li><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/666b3077b407f3c0ce9c10c00b861abe.jpg"></li><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/6c7f469735b99a6a04773240429dc7e0.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/" itemprop="item" rel="index" title="分类于 计算机学科"><span itemprop="name">计算机学科</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/databse/" itemprop="item" rel="index" title="分类于 database"><span itemprop="name">database</span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/databse/mongodb/" itemprop="item" rel="index" title="分类于 mongodb"><span itemprop="name">mongodb</span></a><meta itemprop="position" content="3"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://pigpigletsgo.github.io/computer-science/database/mongodb/MongoDB%E5%85%A5%E9%97%A8/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="D"><meta itemprop="description" content="别怕路长梦远, 欢迎来我的博客空间"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="D の Java 小窝"></span><div class="body md" itemprop="articleBody"><h2 id="mongodb相关概念"><a class="anchor" href="#mongodb相关概念">#</a> MongoDB 相关概念</h2><h3 id="业务应用场景"><a class="anchor" href="#业务应用场景">#</a> 业务应用场景</h3><p>传统的关系型数据库 (如 MySQL)，在数据库操作的 &quot;三高&quot; 需求以及应对 Web2.0 的网站需求，显得力不从心</p><p><strong>解释</strong>：&quot;三高&quot; <strong>需求</strong>：</p><ul><li>High performance - 对数据库高并发读写的需求。</li><li>Huge Storage - 对海量数据的高效率存储和访问的需求。</li><li>High Scalabillity &amp;&amp; High Availability - 对数据库的高可扩展性和高可用性的需求。</li></ul><p>而 MongoDB 可应对 &quot;三高&quot; 需求。</p><p><strong>具体的应用场景如</strong>：</p><ol><li>社交场景，使用 MongoDB 存储用户信息，以及用户发表的朋友圈信息，通过地理位置索引实现附近的人，地点等功能。</li><li>游戏场景，使用 MongoDB 存储游戏用户信息，用户的装备，积分等直接以内嵌文档的形式存储，方便查询，高效率存储和访问。</li><li>物流场景，使用 MongoDB 存储订单信息，订单状态在运送过程中会不断更新，以 MongoDB 内嵌数据的形式来存储，一次查询就能将订单所有的变更读取出来。</li><li>物联网场景，使用 MongoDB 存储所有接入的智能设备信息，以及设备汇报的日志信息，并对这些信息进行多维度的分析。</li><li>视频直播，使用 MongoDB 存储用户信息，点赞互动信息等。</li></ol><p>这些应用场景中，数据操作方面的共同特点是：</p><ol><li>数据量大</li><li>写入操作频繁 (读写很频繁)</li><li>价值较低的数据，对事物要求性不高</li></ol><p>对于这样的数据，我们更适合使用 MongoDB 来实现数据的存储</p><h3 id="什么时候选择mongodb"><a class="anchor" href="#什么时候选择mongodb">#</a> 什么时候选择 MongoDB</h3><p>在构架选型上，除了上述的三个特点外，如果你还犹豫是否选择它，可以考虑以下的一些问题：</p><p>应用不需要事务以及复杂 join 支持</p><p>新应用，需求会变，数据模型无法确定，想快速迭代开发</p><p>应用需要 2000~3000 以上的读写 QPS (更高也可以)</p><p>应用需要 TB 甚至 PB 级别数据存储</p><p>应用要求存储的数据不丢失</p><p>应用需要 99.999% 高可用</p><p>应用需要大量的地理位置查询，文本查询</p><p>如果上述有 1 个符合，可以考虑 MongoDB，2 个以及的符合，选择 MongoDB 绝不会后悔</p><p>思考：如果用 MySQL 呢？</p><p>答：相对 MySQL，可以以更低的成本解决问题 (包括学习，开发，运维等成本)</p><h3 id="mongodb简介"><a class="anchor" href="#mongodb简介">#</a> MongoDB 简介</h3><p>MongoDB 是一个开源，高性能，无模式的文档型数据库，当初的设计就是用于简化开发和方便扩展，是 NoSQL 数据库产品的一种，是最像关系型数据库 (MySQL) 的非关系型数据库。</p><p>它支持的数据结构非常松散，是一种类似于 JSON 的格式叫 BSON，所以它既可以存储比较复杂的数据类型，有相当灵活。</p><p>MongoDB 中的记录是一个文档，它是一个由字段和值对 (field:value) 组成的数据结构，MongoDB 文档类似于 JSON 对象，即一个文档认为就是一个对象，字段的数据类型是字符串，它的值除了使用基本的一些类型外，还可以包括其它文档，普通数组和文档数组。</p><h2 id="体系结构"><a class="anchor" href="#体系结构">#</a> 体系结构</h2><p>MySQL 和 MongoDB 对比</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031701137.png" alt="image-20230602204736615"></p><table><thead><tr><th>SQL 术语 / 概念</th><th>MongoDB 术语 / 概念</th><th>解释 / 说明</th></tr></thead><tbody><tr><td>database</td><td>databse</td><td>数据库</td></tr><tr><td>table</td><td>collection</td><td>数据库表 / 集合</td></tr><tr><td>row</td><td>document</td><td>数据记录行 / 文档</td></tr><tr><td>column</td><td>field</td><td>数据字段 (列)/ 域 (字段)</td></tr><tr><td>index</td><td>index</td><td>索引</td></tr><tr><td>table joins</td><td></td><td>表连接，MongoDB 不支持</td></tr><tr><td></td><td>嵌入文档</td><td>MongoDB 通过嵌入式文档来替代多表连接</td></tr><tr><td>primary key</td><td>primary key</td><td>主键，MongoDB 自动将_id 字段设置为主键</td></tr></tbody></table><h2 id="数据模型"><a class="anchor" href="#数据模型">#</a> 数据模型</h2><p>MongoDB 的最小存储单位就是文档 (document) 对象，文档 (document) 对象对应于关系型数据库的行，数据在 MongoDB 中以 BSON (Binary-JSON) 文档的格式存储在磁盘上。</p><p>BSON (Binary Serialized Document Format) 是一种类似 json 的一种二进制形式的存储格式，简称 Binary JSON。</p><p>BSON 和 JSON 一样，支持内嵌的文档对象和数组对象，但是 BSON 有 JSON 没有的一些数据类型，如 Date 和 BinData 类型。</p><p>BSON 采用了类似于 C 语言结构体的名称，对表示方法，支持内嵌的文档对象和数组对象，具有轻量性，可遍历性，高效性的三个特点，可以有效描述非结构化数据的结构化数据。这种格式的有点是灵活性高，但它的缺点是空间利用率不是很理想。</p><p>Bson 中，除了基本的 JSON 类型：string，integer，boolean，double，null，array 和 object，mongo 还是用了特殊的数据类型，这些类型包括 date，object，binary，data，regular，expression 和 code。每一个驱动都以特定语言的方式实现了这些类型，查看你的驱动的文档来获取详细信息。</p><p>BSON 数据类型参考列表：</p><table><thead><tr><th>数据类型</th><th>描述</th><th>举例</th></tr></thead><tbody><tr x:foobar=""><td>字符串</td><td>UTF-8 字符串都可以表示为字符串类型的数据</td><td></td></tr><tr x:objectid()=""><td>对象 id</td><td>对象 id 是文档的 12 字节的唯一 ID</td><td></td></tr><tr><td>布尔值</td><td>真或者假：true 或者 false</td><td>{&quot;x&quot;:true}+</td></tr><tr x:[a,b,c]=""><td>数组</td><td>值的集合或者列表可以表示成数组</td><td></td></tr><tr><td>32 位整数</td><td>类型不可用，JavaScript 仅支持 64 位浮点数，所以 32 位整数会被自动转换</td><td>shell 是不支持该类型的，shell 中默认会转换成 64 位浮点数</td></tr><tr x:3.14159,y:3=""><td>64 位浮点数</td><td>shell 中的数字就是一种类型</td><td></td></tr><tr x:null=""><td>null</td><td>表示空值或者未定义的对象</td><td></td></tr><tr x:undefined=""><td>undefined</td><td>文档中也可以使用未定义类型</td><td></td></tr><tr><td>符号</td><td>shell 不支持，shell 会将数据库中的符号类型的数据自动转换成字符串</td><td></td></tr><tr x:foobari=""><td>正则表达式</td><td>文档中可以包含正则表达式，采用 JavaScript 的正则表达式</td><td></td></tr><tr><td>代码</td><td>文档中还可以包含 JavaScript 代码</td><td>{&quot;x&quot;:function(){/* .... */}}</td></tr><tr><td>二进制数据</td><td>二进制数据可以由任意字节的串组成，不过 shell 中无法使用</td><td></td></tr><tr><td>最大值 / 最小值</td><td>BSON 包括一个特殊类型，表示可能的最大值 shell 中没有这个类型</td><td></td></tr></tbody></table><p>提示：</p><p>shell 默认使用 64 位浮点值。{&quot;x&quot;:3.14} 或 {&quot;x&quot;:3}。对于整型值，可以使用 NumberInt (4 个字节符号整数) 或 NumberLong (8 字节符号整数)，{&quot;x&quot;:NumberInt (&quot;3&quot;){&quot;x&quot;:NumberLong (&quot;3&quot;)}}</p><h2 id="mongodb的特点"><a class="anchor" href="#mongodb的特点">#</a> MongoDB 的特点</h2><p>MongoDB 主要有如下特点：</p><p>1. 高性能</p><p>MongoDB 提供高性能的数据持久性，特别是对嵌入式数据模型的支持减少了数据库系统上的 I/O 活动。</p><p>索引支持更快的查询，并且可以包含来自嵌入式文档和数组的键。(文本索引解决搜索的要求，TTL 索引解决历史数据自动过期的需求，地理位置索引可用于构建各种 O2O 应用)</p><p>mmapv1，wiredtiger，mongorocks (rocksdb)，in-memory 等多引擎支持满足各种场景需求。</p><p>Gridfs 解决文件存储的需求。</p><p>2. 高可用性</p><p>MongoDB 的复制工具成为副本集 (replica set)，它可提供自动故障转移和数据冗余。</p><p>3. 高扩展性</p><p>MongoDB 提供了水平可扩展性作为其核心功能的一部分。</p><p>分片将数据分布在一组集群的机器上。(海量数据存储，服务能力水平扩展)</p><p>从 3.4 开始，MongoDB 支持基于片创建数据区域，在一个平衡的集群中，MongoDB 将一个区域所覆盖的读写只定向到该区域内的那些片。</p><p>4. 丰富的查询支持</p><p>MongoDB 支持丰富的查询语言，支持读和写操作 (CRUD)，比如数据聚合，文本搜索和地理空间查询等。</p><p>5. 其它特点：如无模式 (动态模式)，灵活的文档模型</p><h2 id="基本常用命令"><a class="anchor" href="#基本常用命令">#</a> 基本常用命令</h2><h3 id="案例需求"><a class="anchor" href="#案例需求">#</a> 案例需求：</h3><p>存放文章评论的数据存放到 MongoDB 中，数据结构参考如下：</p><p>数据库：articledb</p><table><thead><tr><th>专栏文章评论</th><th>comment</th><th></th><th></th></tr></thead><tbody><tr><td>字段名称</td><td>字段含义</td><td>字段类型</td><td>备注</td></tr><tr><td>_id</td><td>ID</td><td>ObjectId 或 String</td><td>Mongo 的主键的字段</td></tr><tr><td>articleid</td><td>文章 ID</td><td>String</td><td></td></tr><tr><td>content</td><td>评论内容</td><td>String</td><td></td></tr><tr><td>userid</td><td>评论人 ID</td><td>String</td><td></td></tr><tr><td>nickname</td><td>评论人昵称</td><td>String</td><td></td></tr><tr><td>createdatetime</td><td>评论的日期时间</td><td>Date</td><td></td></tr><tr><td>likenum</td><td>点赞数</td><td>int32</td><td></td></tr><tr><td>replynum</td><td>回复数</td><td>int32</td><td></td></tr><tr><td>state</td><td>状态</td><td>String</td><td>0：不可见，1：可见</td></tr><tr><td>parentid</td><td>上级 ID</td><td>String</td><td>如果为 0 表示文章的顶级评论</td></tr></tbody></table><h2 id="数据库操作"><a class="anchor" href="#数据库操作">#</a> 数据库操作</h2><h3 id="选择和创建数据库"><a class="anchor" href="#选择和创建数据库">#</a> 选择和创建数据库</h3><p>选择和创建数据库的语法格式：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> use 数据库名称</pre></td></tr></table></figure><p>如果数据库不存在则自动创建，例如，以下语句创建 spitdb 数据库：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> use articledb</pre></td></tr></table></figure><p>查看有权限查看的所有数据库命令</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> show dbs</pre></td></tr><tr><td data-num="2"></td><td><pre>或</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span> show databases</pre></td></tr></table></figure><blockquote><p>注意：在 MongoDB 中，集合只有在内容插入后才会创建！就是说，创建集合 (数据表) 后要再插入一个文档 (记录)，集合才会真正创建。</p></blockquote><p>查看当前正在使用的数据库命令</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db</pre></td></tr></table></figure><p>MongoDB 中默认的数据库为 test，如果你没有选择数据库，集合将存放在 test 数据库中。</p><p>另外：</p><p>数据库名可以是满足以下条件的任意 UTF-8 字符串。</p><ul><li>不能是空字符串 (&quot;&quot;)</li><li>不得含有 ' '(空格)，.，$，/，\，和 \0 (空字符)</li><li>应全部小写</li><li>最多 64 字节</li></ul><p>有一些数据库名是保留的，可以直接访问这些有特殊作用的数据库</p><ul><li>admin：从权限的角度来看，这是 &quot;roor&quot; 数据库，要是将一个用户添加到这个数据库，这个用户自动继承所有数据库的权限，一些特定的服务器端命令也只能从这个数据库运行，比如列出所有的数据库或者关闭服务器</li><li>local：这个数据库的数据永远不会被复制，可以用来存储限于本地单台服务器的任意集合</li><li>config：当 Mongo 用于分片设置时，config 数据库在内部使用，用于保存分片的相关信息</li></ul><p>创建数据库：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> show dbs</pre></td></tr><tr><td data-num="2"></td><td><pre>admin   <span class="token number">0</span>.000GB</pre></td></tr><tr><td data-num="3"></td><td><pre>config  <span class="token number">0</span>.000GB</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token builtin class-name">local</span>   <span class="token number">0</span>.000GB</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">></span> use articledb</pre></td></tr><tr><td data-num="6"></td><td><pre>switched to db articledb</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">></span> show dbs</pre></td></tr><tr><td data-num="8"></td><td><pre>admin   <span class="token number">0</span>.000GB</pre></td></tr><tr><td data-num="9"></td><td><pre>config  <span class="token number">0</span>.000GB</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token builtin class-name">local</span>   <span class="token number">0</span>.000GB</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>可以看到检查数据库时并没有 articledb 这是为什么呢，看如下解释：</p><blockquote><p>MongoDB 的存储分为两部分：当使用 use articledb 创建数据库时存放到了内存中了，没有持久化到磁盘所以使用 show dbs 是看不到的，当 articledb 中有一个集合的时候，不是一个空的数据库的时候就会自动持久化到磁盘中</p></blockquote><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031701895.png" alt="image-20230603161134922"></p><p>查看当前所在的数据库：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db</pre></td></tr><tr><td data-num="2"></td><td><pre>articledb</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><h3 id="数据库的删除"><a class="anchor" href="#数据库的删除">#</a> 数据库的删除</h3><p>MongoDB 删除数据库的语法格式如下：在要删除的数据库中执行</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.dropDatabase<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>提示：主要用来删除已经持久化的数据库</p><h3 id="集合操作"><a class="anchor" href="#集合操作">#</a> 集合操作</h3><p>集合，类似关系型数据库中的表</p><p>可以显示的创建，也可以隐式的创建</p><h3 id="集合的显示创建"><a class="anchor" href="#集合的显示创建">#</a> 集合的显示创建</h3><p>基本语法格式：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.createCollection<span class="token punctuation">(</span>name<span class="token punctuation">)</span></pre></td></tr></table></figure><p>参数说明：</p><ul><li>name：要创建的集合名称</li></ul><p>例如：创建一个名为 mycollection 的普通集合</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.createCollection<span class="token punctuation">(</span><span class="token string">"mycollection"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>查看当前数据库中的表：show tables 命令</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> show collections</pre></td></tr><tr><td data-num="2"></td><td><pre>或</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span> show tables</pre></td></tr></table></figure><p>集合的命名规范：</p><ul><li>集合名不能是空字符串</li><li>集合名不能含有 \0 字符 (空字符)，这个字符表示集合名的结尾</li><li>集合名不能以 &quot;system.&quot; 开头，这是为系统集合保留的前缀</li><li>用户创建的集合名字不能含有保留字符，有些驱动程序的确支持在集合名里面包含，这是因为某些系统生成的集合中包含该字符，除非你要访问这种系统创建的集合，否则千万不要在名字里出现 $</li></ul><h3 id="集合的隐式创建"><a class="anchor" href="#集合的隐式创建">#</a> 集合的隐式创建</h3><p>当向一个集合插入一个文档的时候，如果集合不存在，则会自动创建集合。</p><p>详见文档的插入 章节。</p><p>提示：通常我们使用隐式创建文档即可。</p><h3 id="集合的删除"><a class="anchor" href="#集合的删除">#</a> 集合的删除</h3><p>集合的删除语法格式如下：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.collection.drop<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>或</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span> db.集合.drop<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><strong>返回值</strong></p><p>如果成功删除选定集合，则 drop () 方法返回 true，否则返回 false</p><p>例如：要删除 mycollection 集合</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.mycollection.drop<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> show tables</pre></td></tr><tr><td data-num="2"></td><td><pre>name</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span> db.name.drop<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token boolean">true</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">></span> show tables</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><h2 id="文档基本crud"><a class="anchor" href="#文档基本crud">#</a> 文档基本 CRUD</h2><p>文档 (document) 的数据结构和 JSON 基本一样。</p><p>所有存储在集合中的数据都是 BSON 格式</p><h3 id="文档的插入"><a class="anchor" href="#文档的插入">#</a> 文档的插入</h3><h4 id="1单个文档插入"><a class="anchor" href="#1单个文档插入">#</a> 1. 单个文档插入</h4><p>使用 insert () 或 save () 方法向集合中插入文档，语法格式如下：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.collection.insert<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token operator">&lt;</span>document or array of documents<span class="token operator">></span>,</pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>		writeConcern: <span class="token operator">&lt;</span>document<span class="token operator">></span>,</pre></td></tr><tr><td data-num="5"></td><td><pre>		ordered: <span class="token operator">&lt;</span>boolean<span class="token operator">></span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p>参数：</p><table><caption style="caption-side:bottom">示例</caption><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>document</td><td>document or array</td><td>要插入到集合中的文档或文档数组 (json 格式)</td></tr><tr><td>writeConcern</td><td>document</td><td>Optional.A document expressing the write concern.Omit to use the&lt;br&gt;default write concern.See write <span class="exturl" data-url="aHR0cDovL0NvbmNlcm4uRG8=">Concern.Do</span> not explicitly set the write&lt;br&gt;concerrn for the operation if run in a <span class="exturl" data-url="aHR0cDovL3RyYW5zYWN0aW9uLlRv">transaction.To</span> use write concern&lt;br&gt;with transactions,see Transactions and Write Concern</td></tr><tr><td>orrderd</td><td>boolean</td><td>可选，如果为真，则按顺序插入数组中的文档 ，如果其中一个文档出现错误，MongoDB 将返回而不处理数组中其余文档，如果为假，则执行无序插入，如果其中一个文档出现错误，则继续处理数组中的主文档，在版本 2.6 + 中默认为 true</td></tr></tbody></table><p>要向 comment 的集合 (表) 中插入一条测试数据：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.insert<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token punctuation">&#123;</span><span class="token string">"articleid"</span><span class="token builtin class-name">:</span><span class="token string">"10000"</span>,<span class="token string">"content"</span><span class="token builtin class-name">:</span><span class="token string">"今天天气真好"</span>,<span class="token string">"userid"</span><span class="token builtin class-name">:</span><span class="token string">"1001"</span>,<span class="token string">"nickname"</span><span class="token builtin class-name">:</span><span class="token string">"Rose"</span>,<span class="token string">"createdatetime"</span><span class="token builtin class-name">:</span><span class="token string">"now Date()"</span>,<span class="token string">"likenum"</span>:NumberInt<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>,<span class="token string">"state"</span>:null<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p>提示：</p><ol><li>comment 集合如果不存在，则会隐式创建</li><li>mongo 中的数字，默认情况下是 double 类型，如果要存储整型，必须使用函数 NumberInt (整型数字)，否则取出来就有问题了</li><li>插入当前日期使用 now Date ()</li><li>插入的数据没有指定_id，会自动生成主键值</li><li>如果某字段没有值，可以赋值为 null，或不写该字段</li></ol><p>执行后，如下，说明插入一个数据成功了。</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>WriteResult<span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token string">"nInserted"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>现在数据库中没有任何的集合：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> show tables</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>向一个不存在的集合插入数据：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.insert<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>uncaught exception: Error: no object passed to insert<span class="token operator">!</span> <span class="token builtin class-name">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>DBCollection.prototype.insert@src/mongo/shell/collection.js:275:15</pre></td></tr><tr><td data-num="4"></td><td><pre>@<span class="token punctuation">(</span>db.comment.insert<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"articleid"</span><span class="token builtin class-name">:</span><span class="token string">"1000"</span>,<span class="token string">"content"</span><span class="token builtin class-name">:</span><span class="token string">"今天天气真好"</span>,<span class="token string">"useid"</span><span class="token builtin class-name">:</span><span class="token string">"1001"</span>,<span class="token string">"inckname"</span><span class="token builtin class-name">:</span><span class="token string">"Rose"</span>,<span class="token string">"createdatetime"</span><span class="token builtin class-name">:</span><span class="token string">"now Date()"</span>,<span class="token string">"likenum"</span>:NumberInt<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>,<span class="token string">"state"</span>:null<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>001<span class="token string">","</span>incknam<span class="token string">"&#125;)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>WriteResult(&#123; "nInserted" <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">></span> show tables</pre></td></tr><tr><td data-num="7"></td><td><pre>comment</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>查看集合中插入的数据：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.<span class="token function-name function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">"647b250656447c36332f1c37"</span><span class="token punctuation">)</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1000"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"今天天气真好"</span>, <span class="token string">"useid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1001"</span>, <span class="token string">"inckname"</span> <span class="token builtin class-name">:</span> <span class="token string">"Rose"</span>, <span class="token string">"createdatetime"</span> <span class="token builtin class-name">:</span> <span class="token string">"now Date()"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">10</span>, <span class="token string">"state"</span> <span class="token builtin class-name">:</span> null <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>不存在的集合就被隐式的创建了。</p><p><mark>注意</mark>：</p><ol><li>文档中 的键 / 值对是有序的</li><li>文档中的值不仅可以是在双引号里面的字符串，还可以是其它几种数据类型 (甚至可以是整个嵌入的文档)</li><li>MongoDB 区分类型和大小写</li><li>MongoDB 的文档不能有重复的键</li><li>文档的键是字符串，除了少数例外情况，键可以使用任意 UTF-8 字符</li></ol><p>文档键命名规范：</p><ul><li>键不能含有 \0 (空字符)，这个字符用来表示键的结尾。</li><li>. 和 $ 有特别的意义，只有在特定环境下才能使用</li><li>以下划线 &quot;_&quot; 开头的键是保留的 (不是严格要求的)</li></ul><h4 id="2批量插入"><a class="anchor" href="#2批量插入">#</a> 2. 批量插入</h4><p>语法：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.collection.insertMany<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">&lt;</span>document <span class="token operator"><span class="token file-descriptor important">1</span>></span>,<span class="token operator">&lt;</span>document <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token punctuation">]</span>,<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	writeConcern: <span class="token operator">&lt;</span>document<span class="token operator">></span>,</pre></td></tr><tr><td data-num="3"></td><td><pre>	ordered: <span class="token operator">&lt;</span>boolean<span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>参数：</p><table><caption style="caption-side:bottom">示例</caption><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>document</td><td>document</td><td>要插入到集合中的文档或文档数组 (json 格式)</td></tr><tr><td>writeConcern</td><td>document</td><td>Optional.A document expressing the write concern.Omit to use the default write <span class="exturl" data-url="aHR0cDovL2NvbmNlcm4uRG8=">concern.Do</span> not explicitly set the write concern for the operation if run in a transaction. To use write concern with&lt;br&gt;transactions,see Transactions and write concern</td></tr><tr><td>ordered</td><td>boolean</td><td>可选，一个布尔值，指定 Mongod 示例执行有序插入还是无序插入，默认为 true</td></tr></tbody></table><p>批量插入多条文章评论：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.insertMany<span class="token punctuation">(</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token punctuation">&#123;</span><span class="token string">"_id"</span><span class="token builtin class-name">:</span><span class="token string">"1"</span>,<span class="token string">"articleid"</span><span class="token builtin class-name">:</span><span class="token string">"10001"</span>,<span class="token string">"contet"</span><span class="token builtin class-name">:</span><span class="token string">"我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我他"</span>,<span class="token string">"userid"</span><span class="token builtin class-name">:</span><span class="token string">"1002"</span>,<span class="token string">"nickname"</span><span class="token builtin class-name">:</span><span class="token string">"相忘于江湖"</span>,<span class="token string">"createdatatime"</span>:new Date<span class="token punctuation">(</span><span class="token string">"2019-08-05T22:08:15.522Z"</span>,<span class="token string">"likenum"</span>:NumberInt<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>,<span class="token string">"state"</span><span class="token builtin class-name">:</span><span class="token string">"1"</span><span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token punctuation">&#123;</span><span class="token string">"_id"</span><span class="token builtin class-name">:</span><span class="token string">"2"</span>,<span class="token string">"articleid"</span><span class="token builtin class-name">:</span><span class="token string">"10001"</span>,<span class="token string">"contet"</span><span class="token builtin class-name">:</span><span class="token string">"我夏天空腹喝凉开水，冬天喝温开水"</span>,<span class="token string">"userid"</span><span class="token builtin class-name">:</span><span class="token string">"1005"</span>,<span class="token string">"nickname"</span><span class="token builtin class-name">:</span><span class="token string">"伊人憔悴"</span>,<span class="token string">"createdatatime"</span>:new Date<span class="token punctuation">(</span><span class="token string">"2019-08-05T22:58:51.485Z"</span>,<span class="token string">"likenum"</span>:NumberInt<span class="token punctuation">(</span><span class="token number">888</span><span class="token punctuation">)</span>,<span class="token string">"state"</span><span class="token builtin class-name">:</span><span class="token string">"1"</span><span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token punctuation">&#123;</span><span class="token string">"_id"</span><span class="token builtin class-name">:</span><span class="token string">"3"</span>,<span class="token string">"articleid"</span><span class="token builtin class-name">:</span><span class="token string">"10001"</span>,<span class="token string">"contet"</span><span class="token builtin class-name">:</span><span class="token string">"我一直喝凉开水，冬天夏天都喝"</span>,<span class="token string">"userid"</span><span class="token builtin class-name">:</span><span class="token string">"1004"</span>,<span class="token string">"nickname"</span><span class="token builtin class-name">:</span><span class="token string">"杰克船长"</span>,<span class="token string">"createdatatime"</span>:new Date<span class="token punctuation">(</span><span class="token string">"2019-08-05T22:05:51.485Z"</span>,<span class="token string">"likenum"</span>:NumberInt<span class="token punctuation">(</span><span class="token number">888</span><span class="token punctuation">)</span>,<span class="token string">"state"</span><span class="token builtin class-name">:</span><span class="token string">"1"</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>提示：</p><p>插入时指定了_id，则主键就是该值</p><p>如果某条数据插入失败，将会终止插入，但已经插入成功的数据不会回滚掉</p><p>因为批量插入由于数据较多容易出现失败，因为，可以使用 try catch 进行异常捕获处理，测试的时候可以不处理，如 (了解)：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> try<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	db.comment.insertMany<span class="token punctuation">(</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token punctuation">&#123;</span><span class="token string">"_id"</span><span class="token builtin class-name">:</span><span class="token string">"1"</span>,<span class="token string">"articleid"</span><span class="token builtin class-name">:</span><span class="token string">"10001"</span>,<span class="token string">"contet"</span><span class="token builtin class-name">:</span><span class="token string">"我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我他"</span>,<span class="token string">"userid"</span><span class="token builtin class-name">:</span><span class="token string">"1002"</span>,<span class="token string">"nickname"</span><span class="token builtin class-name">:</span><span class="token string">"相忘于江湖"</span>,<span class="token string">"createdatatime"</span>:new Date<span class="token punctuation">(</span><span class="token string">"2019-08-05T22:08:15.522Z"</span>,<span class="token string">"likenum"</span>:NumberInt<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>,<span class="token string">"state"</span><span class="token builtin class-name">:</span><span class="token string">"1"</span><span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token punctuation">&#123;</span><span class="token string">"_id"</span><span class="token builtin class-name">:</span><span class="token string">"2"</span>,<span class="token string">"articleid"</span><span class="token builtin class-name">:</span><span class="token string">"10001"</span>,<span class="token string">"contet"</span><span class="token builtin class-name">:</span><span class="token string">"我夏天空腹喝凉开水，冬天喝温开水"</span>,<span class="token string">"userid"</span><span class="token builtin class-name">:</span><span class="token string">"1005"</span>,<span class="token string">"nickname"</span><span class="token builtin class-name">:</span><span class="token string">"伊人憔悴"</span>,<span class="token string">"createdatatime"</span>:new Date<span class="token punctuation">(</span><span class="token string">"2019-08-05T22:58:51.485Z"</span>,<span class="token string">"likenum"</span>:NumberInt<span class="token punctuation">(</span><span class="token number">888</span><span class="token punctuation">)</span>,<span class="token string">"state"</span><span class="token builtin class-name">:</span><span class="token string">"1"</span><span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token punctuation">&#123;</span><span class="token string">"_id"</span><span class="token builtin class-name">:</span><span class="token string">"3"</span>,<span class="token string">"articleid"</span><span class="token builtin class-name">:</span><span class="token string">"10001"</span>,<span class="token string">"contet"</span><span class="token builtin class-name">:</span><span class="token string">"我一直喝凉开水，冬天夏天都喝"</span>,<span class="token string">"userid"</span><span class="token builtin class-name">:</span><span class="token string">"1004"</span>,<span class="token string">"nickname"</span><span class="token builtin class-name">:</span><span class="token string">"杰克船长"</span>,<span class="token string">"createdatatime"</span>:new Date<span class="token punctuation">(</span><span class="token string">"2019-08-05T22:05:51.485Z"</span>,<span class="token string">"likenum"</span>:NumberInt<span class="token punctuation">(</span><span class="token number">888</span><span class="token punctuation">)</span>,<span class="token string">"state"</span><span class="token builtin class-name">:</span><span class="token string">"1"</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span>catch<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	print<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> try<span class="token punctuation">&#123;</span>db.comment.insertMany<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"_id"</span><span class="token builtin class-name">:</span><span class="token string">"1"</span>,<span class="token string">"articleid"</span><span class="token builtin class-name">:</span><span class="token string">"10001"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"_id"</span><span class="token builtin class-name">:</span><span class="token string">"2"</span>,<span class="token string">"articleid"</span><span class="token builtin class-name">:</span><span class="token string">"10001"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"_id"</span><span class="token builtin class-name">:</span><span class="token string">"3"</span>,<span class="token string">"articleid"</span><span class="token builtin class-name">:</span><span class="token string">"10001"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>catch<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>print<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"acknowledged"</span> <span class="token builtin class-name">:</span> true, <span class="token string">"insertedIds"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">"1"</span>, <span class="token string">"2"</span>, <span class="token string">"3"</span> <span class="token punctuation">]</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><ul><li>测试 - 嫌麻烦添加了比较少的数据</li></ul><h2 id="文档的基本查询"><a class="anchor" href="#文档的基本查询">#</a> 文档的基本查询</h2><p>查询数据的语法格式如下：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.collection.find<span class="token punctuation">(</span><span class="token operator">&lt;</span>query<span class="token operator">></span>,<span class="token punctuation">[</span>projection<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>参数：</p><table><caption style="caption-side:bottom">示例</caption><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>query</td><td>document</td><td>可选，使用查询运算符指定选择筛选器，若要返回集合中的所有文档，请省略此参数或传递空文档 ({})</td></tr><tr><td>projection</td><td>document</td><td>可选，指定要在与查询筛选器匹配的文档中返回的字段 (投影)，诺要返回匹配文档中的所有字段，请省略此参数</td></tr></tbody></table><h3 id="1查询所有"><a class="anchor" href="#1查询所有">#</a> 1. 查询所有</h3><p>如果我们要查询 spit 集合的所有文档，我们输入以下命令：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>db.comment.find<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>或</pre></td></tr><tr><td data-num="3"></td><td><pre>db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>这里你会发现每条文档会有一个叫_id 的字段，这个相当于我们原来关系型数据库中表的主键，当你在插入文档记录时没有 指定该字段，MongoDB 会自动创建，其类型是 ObjectID 类型</p><p>如果我们在插入文档记录时指定该字段也可以，其类型可以是 ObjectID 类型，也可以是 MongoDB 支持的任意类型</p><p>如果我想按一定条件来查询，比如我想查询 userid 为 1003 的记录，怎么办？很简单！只要在 find () 中添加参数即可，参数也是 json 格式，如下：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"articleid"</span><span class="token builtin class-name">:</span><span class="token string">"10001"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"3"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"articleid"</span><span class="token builtin class-name">:</span><span class="token string">"10001"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token number">2</span><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span> <span class="token punctuation">&#125;</span><span class="token number">3</span><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span> <span class="token punctuation">&#125;</span><span class="token number">4</span><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"3"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span> <span class="token punctuation">&#125;</span><span class="token operator"><span class="token file-descriptor important">5</span>></span>db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid:<span class="token string">'1003'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>如果你只需要返回符合条件的第一条数据，我们可以使用 findOne 命令来实现，语法和 find 一样。</p><p>如：查询用户编号是 1003 的记录，但只最多返回符合条件的第一条记录：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.findOne<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"articleid"</span><span class="token builtin class-name">:</span><span class="token string">"10001"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>2. 投影查询 (Projection Query)</p><p>如果要查询结果返回部分字段，则需要使用投影查询 (不显示所有字段，只显示指定的字段)</p><p>如：查询结果只显示 <code>_id，aticleid，nickname</code></p><pre><code>&gt; db.comment.find(&#123;aticleid:&quot;10001&quot;&#125;,&#123;aticleid:1,nickname:1&#125;)
&#123; &quot;_id&quot; : &quot;1&quot;, &quot;aticleid&quot; : &quot;10001&quot;, &quot;nickname&quot; : &quot;Rose&quot; &#125;
&gt;
</code></pre><p>默认 <code>_id</code> 会显示</p><p>如：查询结果只显示，aticleid，nickname，不显示 <code>_id</code> :</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>aticleid:<span class="token string">"10001"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span>aticleid:1,nickname:1,_id:0<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"aticleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"Rose"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>再例如：查询所有数据，但只显示_id，aticleid，nickname；</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span>aticleid:1,nickname:1<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"aticleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"Rose"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><h2 id="文档的更新"><a class="anchor" href="#文档的更新">#</a> 文档的更新</h2><p>更新文档的语法：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>db.collection.update<span class="token punctuation">(</span>query,update,options<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>或</pre></td></tr><tr><td data-num="3"></td><td><pre>db.collection.update<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token operator">&lt;</span>query<span class="token operator">></span>,</pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token operator">&lt;</span>update<span class="token operator">></span>,</pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>		upsert: <span class="token operator">&lt;</span>boolean<span class="token operator">></span>,</pre></td></tr><tr><td data-num="8"></td><td><pre>		multi: <span class="token operator">&lt;</span>boolean<span class="token operator">></span>,</pre></td></tr><tr><td data-num="9"></td><td><pre>		writeConcern: <span class="token operator">&lt;</span>document<span class="token operator">></span>,</pre></td></tr><tr><td data-num="10"></td><td><pre>		collation: <span class="token operator">&lt;</span>document<span class="token operator">></span>,</pre></td></tr><tr><td data-num="11"></td><td><pre>		arrayFilters: <span class="token punctuation">[</span><span class="token operator">&lt;</span>filterdocument<span class="token operator"><span class="token file-descriptor important">1</span>></span>,<span class="token punctuation">..</span>.<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="12"></td><td><pre>		hint: <span class="token operator">&lt;</span>document<span class="token operator">|</span>string<span class="token operator">></span> //Available starting <span class="token keyword">in</span> MongoDB <span class="token number">4.2</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p>参数：</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>query</td><td>document</td><td>更新的选择条件，可以使用与 find () 方法中相同的查询选择器，类似 sql update 查询内 where 后面的，在 3.0 版中进行了更改：当使用 upsert:true 执行 update () 时，如果查询使用点表示法存在_id 字段上指定条件，则 MongoDB 将拒绝插入新文档</td></tr><tr><td>update</td><td>document or pipeline</td><td>要应用的修改，该值可以是：包含更新运算符表达式的文档，或仅包含 &lt;field1&gt;: &lt;value &gt; 对的替换文档，或在 MongoDB4.2 中启动聚合管道，管道可以由以下阶段组成：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>d</mi><mi>d</mi><mi>F</mi><mi>I</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>s</mi><mtext>及其别名</mtext><mi mathvariant="normal">‘</mi></mrow><annotation encoding="application/x-tex">addFIelds及其别名`</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:.13889em">F</span><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:.01968em">l</span><span class="mord mathnormal">d</span><span class="mord mathnormal">s</span><span class="mord cjk_fallback">及</span><span class="mord cjk_fallback">其</span><span class="mord cjk_fallback">别</span><span class="mord cjk_fallback">名</span><span class="mord">‘</span></span></span></span> <code>set</code> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">‘</mi><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mtext>及其别名</mtext><mi mathvariant="normal">‘</mi></mrow><annotation encoding="application/x-tex">`project及其别名`</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="mord">‘</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:.05724em">j</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord cjk_fallback">及</span><span class="mord cjk_fallback">其</span><span class="mord cjk_fallback">别</span><span class="mord cjk_fallback">名</span><span class="mord">‘</span></span></span></span> <code>unset</code> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">‘</mi><mi>r</mi><mi>e</mi><mi>p</mi><mi>l</mi><mi>a</mi><mi>c</mi><mi>e</mi><mi>r</mi><mi>o</mi><mi>o</mi><mi>t</mi><mtext>及其别名</mtext><mi mathvariant="normal">‘</mi></mrow><annotation encoding="application/x-tex">`replaceroot及其别名`</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="mord">‘</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mord mathnormal">e</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:.01968em">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mord mathnormal">o</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord cjk_fallback">及</span><span class="mord cjk_fallback">其</span><span class="mord cjk_fallback">别</span><span class="mord cjk_fallback">名</span><span class="mord">‘</span></span></span></span> <code>replaceWith，换句话说：它是update的对象和一些更新的操作符(如</code> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">‘</mi><mo separator="true">,</mo><mi mathvariant="normal">‘</mi></mrow><annotation encoding="application/x-tex">`,`</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="mord">‘</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord">‘</span></span></span></span>`inc...) 等，也可以理解为 sql update 查询内 set 后面的值</td></tr><tr><td>upsert</td><td>boolean</td><td>可选，如果设置为 true，则在没有与查询条件匹配的文档时创建新文档，默认值为 false，如果找不到匹配项，则不会插入新文档</td></tr><tr><td>multi</td><td>boolean</td><td>可选，如果设置为 true，则更新符合查询条件的多个文档，如果设置为 false，则更新一个文档，默认值为 fasle</td></tr><tr><td>writeConcern</td><td>document</td><td>可选，表示写问题的文档，抛出异常的级别</td></tr><tr><td>collation</td><td>document</td><td>可选 &lt;br&gt; 指定要用于操作的校对规则 &lt; br &gt; 校对规则允许用户为字符串比较指定特定与语言的规则，例如字母大小写和重音标记的规则 &lt; br &gt; 校对规则选项具有以下语句：&lt;br &gt; 校对规则：{&lt;br &gt; 区域设置:&lt;string&gt;,&lt;br&gt;caseLevel:&lt;boolean&gt;,&lt;br&gt;caseFirst:&lt;string&gt;,&lt;br &gt; 强度:&lt;int&gt;,&lt;br&gt;numericordering:&lt;boolean&gt;,&lt;br &gt; 替代:&lt;string&gt;,&lt;br &gt; 最大变量:&lt;string&gt;,&lt;br &gt; 向后:&lt;boolean&gt;&lt;br&gt;}&lt;br &gt; 指定校对规则时，区域设置字段是必须得，所有其它校对规则字段都是可选的，有关字段的说明，请参阅校对规则文档 &lt; br &gt; 如果未指定校对规则，但集合具有默认校对规则 (请参见 db.createCollection ())，则该操作将使用为集合指定的校对规则。&lt;br &gt; 如果没有为集合或操作指定校对规则，MongoDB 将使用以前的版本中使用的简单二进制比较进行字符串比较，不能为一个操作指定多个校对规则，例如，不能为每个字段指定不同的校对规则，或者如果使用排序执行查找，则不能将一个校对规则用于查找，另一个校对规则用于排序 &lt; br&gt;3.4 版新增</td></tr><tr><td>arrayFilters</td><td>array</td><td>可选，一个筛选文档数组，用于确定要为数组字段上的更新操作修改那些数组元素，在更新文档中，使用 [ <code>$</code> <a href=""></a>{}] 筛选的位置运算符来定义标识符，然后咋子数组过滤器文档中应用，如果标识符未包含在更新文档中，则不能有标识符的数组筛选器文档，注意，&lt;identifier &gt; 必须以小写字母开头，并且只包含字母数字字符，您可以在更新文档中多次包含同一标识符：但是，对于 r 在更新文档中，每个不同的标识符 ( <code>$</code> [标识符]) 都必须指定一个对应的数组筛选器文档，也就是说，不能为同一个标识符指定多个数组筛选器文档，3.6 版 +</td></tr><tr><td>hint</td><td>Document or string</td><td>可选，指定用于支持查询谓词的索引的文档或字符串，该选项可以采用索引规范文档或索引名称字符串，如果指定的索引不存在，则说明操作错误，例如：版本 4 中的 未更新操作指定提示</td></tr></tbody></table><p>提示：</p><p>主要关注前四个参数即可</p><p>[示例]</p><h3 id="1覆盖的修改"><a class="anchor" href="#1覆盖的修改">#</a> 1. 覆盖的修改</h3><p>如果我们想修改_id 为 1 的记录，点赞量为 1001，输入以下语句</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.update<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>_id:<span class="token string">"1"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span>likenum:NumberInt<span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.update<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>_id:1<span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span>likenum:NumberInt<span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>WriteResult<span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token string">"nMatched"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">"nUpserted"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token string">"nModified"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">#注意这里的_id 为 1 的我不小心设置为了数据型的，而_id 为 2 设置为字符串型更改时也要对应数据类型才能找得到</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">1001</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">889</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>执行后，我们会发现，这条文档除了 likenum 字段其它字段都不见了</p><h3 id="2局部修改"><a class="anchor" href="#2局部修改">#</a> 2. 局部修改</h3><p>为了解决这个问题，我们需要使用修改器 <code>$</code> set 来实现，命令如下：</p><p>我们想修改_id 为 2 的记录，浏览量为 889，输入以下语句：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.update<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>_id:2<span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token variable">$set</span>:<span class="token punctuation">&#123;</span>likenum:NumberInt<span class="token punctuation">(</span><span class="token number">889</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.update<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>_id:<span class="token string">"2"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token variable">$set</span>:<span class="token punctuation">&#123;</span>likenum:NumberInt<span class="token punctuation">(</span><span class="token number">889</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>WriteResult<span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token string">"nMatched"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">"nUpserted"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token string">"nModified"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span> db.comment.<span class="token function-name function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"刘桑"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">889</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"小花"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>这样就 OK 了</p><h3 id="3批量的修改"><a class="anchor" href="#3批量的修改">#</a> 3. 批量的修改</h3><p>更新所有用户为 1003 的用户的昵称为 凯撒大帝</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#默认只修改第一条数据</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">></span> db.comment.update<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid:<span class="token string">"1003"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token variable">$set</span>:<span class="token punctuation">&#123;</span>nickname:<span class="token string">"凯撒2"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#修改所有符合条件的数据</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">></span> db.comment.update<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid:<span class="token string">"1003"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token variable">$set</span>:<span class="token punctuation">&#123;</span>nickname:<span class="token string">"凯撒大帝"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span>multi:true<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.update<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid:<span class="token string">"1003"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token variable">$set</span>:<span class="token punctuation">&#123;</span>nickname:<span class="token string">"凯撒大帝"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span>multi:true<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>WriteResult<span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token string">"nMatched"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token string">"nUpserted"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token string">"nModified"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span> db.comment.<span class="token function-name function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">889</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>提示：</p><p>如果不加后面的参数，则只更新符合条件的第一条记录</p><h3 id="3列值增长的修改"><a class="anchor" href="#3列值增长的修改">#</a> 3. 列值增长的修改</h3><p>如果我们想实现对某列值在原有值的基础上进行增加或减少，可以使用 <code>$</code> inc 运算符来实现。</p><p>需求：对 3 号数据的点赞数，每次递增 1</p><pre><code>&gt; db.comment.update(&#123;_id:1&#125;,&#123;$inc:&#123;likenum:NumberInt(1)&#125;&#125;)
</code></pre><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.update<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>_id:1<span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token variable">$inc</span>:<span class="token punctuation">&#123;</span>likenum:NumberInt<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>WriteResult<span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token string">"nMatched"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">"nUpserted"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token string">"nModified"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span> db.comment.<span class="token function-name function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">1002</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">889</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.update<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid:<span class="token string">"1003"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token variable">$inc</span>:<span class="token punctuation">&#123;</span><span class="token string">"likenum"</span>:NumberInt<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span>multi:true<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>WriteResult<span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token string">"nMatched"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token string">"nUpserted"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token string">"nModified"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span> db.comment.<span class="token function-name function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">1003</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10002"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">890</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><h2 id="删除文档"><a class="anchor" href="#删除文档">#</a> 删除文档</h2><p>删除文档的语法结构：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.集合名称.remove<span class="token punctuation">(</span>条件<span class="token punctuation">)</span></pre></td></tr></table></figure><p>以下语句可以将数据全部删除，请慎用</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.remove<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>如果删除_id=1 的记录，输入以下语句，删除条件有多个会删除多个</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.remove<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>_id:<span class="token string">"1"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.<span class="token function-name function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">1003</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10002"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">890</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">></span> db.comment.remove<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>_id:<span class="token string">"1"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>WriteResult<span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token string">"nRemoved"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">></span> db.comment.<span class="token function-name function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10002"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">890</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.<span class="token function-name function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10002"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">890</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">1003</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">></span> db.comment.remove<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid:<span class="token string">"1003"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>WriteResult<span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token string">"nRemoved"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><h2 id="文档的分页查询"><a class="anchor" href="#文档的分页查询">#</a> 文档的分页查询</h2><h3 id="统计查询"><a class="anchor" href="#统计查询">#</a> 统计查询</h3><p>统计查询使用 count () 方法，语法如下：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.collection.count<span class="token punctuation">(</span>query,options<span class="token punctuation">)</span></pre></td></tr></table></figure><p>参数：</p><table><caption style="caption-side:bottom">示例</caption><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>query</td><td>document</td><td>查询选择条件</td></tr><tr><td>options</td><td>document</td><td>可选，用于修改统计数的额外选项</td></tr></tbody></table><p>1. 统计所有记录数：</p><p>统计 comment 集合的所有的记录数：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.count<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">2</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>2. 按条件统计记录：</p><p>例如：统计 userid 为 1003 的记录条数</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.count<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid:<span class="token string">"1003"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">2</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">></span> db.comment.count<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>_id:<span class="token string">"1"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">1</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">></span> db.comment.count<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>_id:<span class="token string">"2"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">1</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>提示：</p><p>默认情况下 count () 方法返回符合条件的全部记录条数</p><h3 id="分页列表查询"><a class="anchor" href="#分页列表查询">#</a> 分页列表查询</h3><p>可以使用 limit () 方法来读取指定数量的数据，使用 skip () 方法来跳过指定数量的数据</p><p>基本语法格式如下：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.COLLECTION_NAME.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.limit<span class="token punctuation">(</span>NUMBER<span class="token punctuation">)</span>.skip<span class="token punctuation">(</span>NUMBER<span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.limit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>.skip<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10002"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">890</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.limit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>.skip<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.limit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>.skip<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">1003</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10002"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">890</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.limit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>.skip<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">1003</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>如果你想返回指定条数的记录，可以在 find 方法后调用 limit 来返回结果 (TopN)，默认值 20，例如：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.limit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.limit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">1003</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10002"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">890</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>skip 方法同样接受一个数字参数作为跳过的记录条数，(前 N 个不要)，默认值是 0</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.skip<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.skip<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.skip<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10002"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">890</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>分页查询：需求：每页 2 个，第二页开始：跳过前两条数据，接着值显示 3 和 4 条数据</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#第一页</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.skip<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>.limit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#第二页</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.skip<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>.limit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">#第三页</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.skip<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>.limit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="排序查询"><a class="anchor" href="#排序查询">#</a> 排序查询</h2><p>sort () 方法对数据进行排序，sort () 方法可以通过参数指定排序的字段，并使用 1 和 - 1 来指定排序方式，其中 1 为升序排列，而 - 1 是用于降序排列</p><p>语法如下所示：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment_name.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.sort<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>KEY:1<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>或</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span> db.集合名称.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.sort<span class="token punctuation">(</span>排序方式<span class="token punctuation">)</span></pre></td></tr></table></figure><p>例如：</p><p>对 userid 降序排列，并对访问量进行升序排列</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.sort<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid:1,likenum:1<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.sort<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid:-1,likenum:1<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10002"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">890</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">1003</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>提示：</p><p>skip ()，limit ()，sort () 三个放在一起执行的时候，执行的顺序是先 sort () 然后是 skip () 最后是显示的 limit () 和命令编写顺序无关</p><p>sort &gt; skip &gt; limit</p><h2 id="文档的更多查询"><a class="anchor" href="#文档的更多查询">#</a> 文档的更多查询</h2><h3 id="正则的复杂条件查询"><a class="anchor" href="#正则的复杂条件查询">#</a> 正则的复杂条件查询</h3><p>MongoDB 的模糊查询是通过正则表达式的方式实现的，格式为：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.collection.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>field:/正则表达式/<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>或</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span> db.集合名称.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>字段:/正则表达式/<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>提示：正则表达式是 js 的语法，直接量的写法</p><p>例如：我要查询评论内容包含 &quot;开水&quot; 的所有文档，代码如下：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>content:/开水/<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.<span class="token function-name function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">1003</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"开水"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10002"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">890</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"专家表明"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"3"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10003"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">100</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"123"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"开水"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>content:/开水/<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">1003</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"开水"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"3"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10003"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">100</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"123"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"开水"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>如果要查询评论的内容中以 &quot;专家&quot; 开头的，代码如下：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>content:/^专家/<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>content:/^专家/<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10002"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">890</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"专家表明"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><h2 id="比较查询"><a class="anchor" href="#比较查询">#</a> 比较查询</h2><p>&lt;，&lt;=，&gt;，&gt;= 这个操作符也是很常用的，格式如下：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#大于：field > vlaue</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">></span> db.集合名称.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"field"</span>:<span class="token punctuation">&#123;</span><span class="token variable">$gt</span>:value<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#小于：field &lt; value</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">></span> db.集合名称.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"field"</span>:<span class="token punctuation">&#123;</span><span class="token variable">$lt</span>:value<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">#大于等于：field >= value</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">></span> db.集合名称.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"field"</span>:<span class="token punctuation">&#123;</span><span class="token variable">$gte</span>:value<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">#小于等于：field &lt;= value</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">></span> db.集合名称.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"field"</span>:<span class="token punctuation">&#123;</span><span class="token variable">$lte</span>:value<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">#不等于：field != value</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">></span> db.集合名称.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"field"</span>:<span class="token punctuation">&#123;</span><span class="token variable">$ne</span>:value<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>示例：查询评论带你赞数量大于 700 的记录</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>likenum:<span class="token punctuation">&#123;</span><span class="token variable">$gt</span>:NumberInt<span class="token punctuation">(</span><span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>likenum:<span class="token punctuation">&#123;</span><span class="token variable">$gt</span>:NumberInt<span class="token punctuation">(</span><span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">1003</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"开水"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10002"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">890</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"专家表明"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><h2 id="包含查询"><a class="anchor" href="#包含查询">#</a> 包含查询</h2><p>包含使用 $in 操作符</p><p>示例：查询评论的集合中 userid 字段包含 1003 和 1004 的文档</p><pre><code class="language-shll">&gt; db.comment.find(&#123;userid:&#123;$in:[&quot;1003&quot;,&quot;1004&quot;]&#125;&#125;)
</code></pre><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid:<span class="token punctuation">&#123;</span><span class="token variable">$in</span>:<span class="token punctuation">[</span><span class="token string">"1003"</span>,<span class="token string">"1004"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">1003</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"开水"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10002"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">890</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"专家表明"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"3"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10003"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">100</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"开水"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><h2 id="条件连接查询"><a class="anchor" href="#条件连接查询">#</a> 条件连接查询</h2><p>我们如果需要查询同时满足两个以上条件，需要使用 $and 操作符将条件进行关联 (相当于 SQL 的 and)</p><p>格式为：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token variable">$and</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span></pre></td></tr></table></figure><p>示例：查询评论集合中 likenum 大于等于 700 并且小于 2000 的文档</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token variable">$and</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span>lienum:<span class="token punctuation">&#123;</span><span class="token variable">$gte</span>:NumberInt<span class="token punctuation">(</span><span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span>likenum:<span class="token punctuation">&#123;</span><span class="token variable">$lt</span>:NumberInt<span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token variable">$and</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span>likenum:<span class="token punctuation">&#123;</span><span class="token variable">$gte</span>:NumberInt<span class="token punctuation">(</span><span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span>likenum:<span class="token punctuation">&#123;</span><span class="token variable">$lt</span>:NumberInt<span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">1003</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"开水"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10002"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">890</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"专家表明"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>如果两个以上条件之间是或者的关系，我们使用操作符进行关联，与前面 and 的使用方式相同</p><p>格式为：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token variable">$or</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span></pre></td></tr></table></figure><p>示例：查询评论集合中 userid 为 1003，或者点赞数小于 1000 的文档记录</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token variable">$or</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span>userid:<span class="token string">"1003"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span>likenum:<span class="token punctuation">&#123;</span><span class="token variable">$lt</span>:1000<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token variable">$or</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span>userid:<span class="token string">"1003"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span>likenum:<span class="token punctuation">&#123;</span><span class="token variable">$lt</span>:1000<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">1003</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"开水"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10002"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">890</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"专家表明"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"3"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10003"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">100</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"开水"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token variable">$and</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span>userid:<span class="token string">"1003"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span>likenum:<span class="token punctuation">&#123;</span><span class="token variable">$lt</span>:1000<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10002"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">890</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒大帝"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"专家表明"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"3"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"10003"</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">100</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"开水"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><h2 id="常用命令小结"><a class="anchor" href="#常用命令小结">#</a> 常用命令小结</h2><p>选择切换数据库：use articledb</p><p>插入数据：db.comment.insert ({bson 数据})</p><p>查询所有数据：db.comment.find ()</p><p>条件查询数据：db.cmoment.find ({条件})</p><p>查询符合条件的第一条记录：db.comment.findOne ({条件})</p><p>查询符合条件的前几条记录：db.comment.find ({条件}).limit (条数)</p><p>查询符合条件的跳过的记录：db.comment.find ({条件}).skip (条数)</p><p>修改数据：db.comment.update ({条件},{修改后的数据}) 或 db.comment.update ({条件},{$set:{要修改部分的字段：数据}})</p><p>修改数据并自增某字段值：db.comment.update ({条件},{$inc:{自增的字段：步进值}})</p><p>删除数据：db.comment.remove ({条件})</p><p>统计查询：db.comment.count ({条件})</p><p>模糊查询：db.comment.find ({字段名:/ 正则表达式 /})</p><p>条件比较运算：db.comment.find ({字段名:{$gt: 值}})</p><p>包含查询：db.comment.find ({字段名:{ <code>$</code> in:[值 1, 值 2]}}) 或 db.comment.find ({字段名:{ <code>$</code> nin:[值 1, 值 2]}})</p><p>条件连接查询：db.comment.find ({ <code>$</code> and:[{条件 1},{条件 2}]}) 或 db.comment.find ({ <code>$</code> or:[{条件 1},{条件 2}])</p><h2 id="索引的类型"><a class="anchor" href="#索引的类型">#</a> 索引的类型</h2><h3 id="单字段索引"><a class="anchor" href="#单字段索引">#</a> 单字段索引</h3><p>MongoDB 支持在文档的单个字段上创建用户定义的升序 / 降序索引，称为单字段索引 (Single Field Index)</p><p>对于单个字段索引的排序操作，索引键的排序顺序 (即升序或降序) 并不重要，因为 MongoDB 可以在任何方向上遍历索引</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031702130.png" alt="image-20230604161713948"></p><h3 id="其它索引"><a class="anchor" href="#其它索引">#</a> 其它索引</h3><p>地理空间索引 (Geospatial Index)，文本索引 (Text Indexes)，哈希索引 (Hashed Indexes)</p><h4 id="地理空间索引geospatial-index"><a class="anchor" href="#地理空间索引geospatial-index">#</a> 地理空间索引 (Geospatial Index)</h4><p>为了支持对地理空间坐标数据的有效查询，MongoDB 提供了两种特殊的索引：返回结果是使用平面几何的二维索引和返回结果时使用球面几何的二维球面索引</p><h4 id="文本索引text-indexes"><a class="anchor" href="#文本索引text-indexes">#</a> 文本索引 (Text Indexes)</h4><p>MongoDB 提供了一种文本索引类型，支持在集合中搜索字符串内容，这些文本索引不存储特定于语言的停止词 (例如：&quot;the&quot;，&quot;a&quot;，&quot;or&quot;)，而将集合中的此作为词干，只存储跟词。</p><h4 id="哈希索引hashed-indexes"><a class="anchor" href="#哈希索引hashed-indexes">#</a> 哈希索引 (Hashed Indexes)</h4><p>为了支持基于散列的分片，MongoDB 提供了散列索引类型，它对字段值的散列进行索引，这些索引在其范围内的值分布更加随机，但只支持相等匹配，不支持基于范围的查询</p><h3 id="索引的管理操作"><a class="anchor" href="#索引的管理操作">#</a> 索引的管理操作</h3><h4 id="索引的查看"><a class="anchor" href="#索引的查看">#</a> 索引的查看</h4><p>说明：</p><p>返回一个集合中的所有索引的数组。</p><p>语法：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.collection.getIndexes<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>提示：该语法命令运行要求是 MongoDB 3.0+</p><p>[示例]</p><p>查看 comment 集合中所有的索引情况</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.getIndexes<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.getIndexes<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span> <span class="token punctuation">&#123;</span> <span class="token string">"v"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token string">"key"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span>, <span class="token string">"name"</span> <span class="token builtin class-name">:</span> <span class="token string">"_id_"</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>结果中显示的是默认_id 索引</p><p>默认_id 索引：</p><p>MongoDB 在创建集合的过程中，在_id 字段上创建一个唯一的索引，默认名字为 <code>_id_</code> ，该索引可防止客户端插入两个具有相同值的文档，您不能在 <code>_id</code> 字段上删除此索引</p><p>注意：该索引是唯一索引，因此值不能重复，即_id 值不能重复的，在分片集群中，通常使用 <code>_id</code> 作为片键</p><h3 id="索引的创建"><a class="anchor" href="#索引的创建">#</a> 索引的创建</h3><p>说明：</p><p>在集合上创建索引</p><p>语法：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.collection.createIndex<span class="token punctuation">(</span>keys.options<span class="token punctuation">)</span></pre></td></tr></table></figure><p>参数：</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>keys</td><td>document</td><td>包含字段和值对的文档，其中字段是索引键，值描述该字段的索引类型，对于字段上的升序索引，请指定值 1；对于降序索引，请指定值 - 1；比如：{字段：1 或 - 1}，其中 1 为指定按升序创建索引，如果你想按降序创建索引指定为 - 1 即可。另外 MongoDB 支持几种不同的索引类型，包括文本，地理空间和哈希索引</td></tr><tr><td>options</td><td>document</td><td>可选，包含一组控制索引创建的选项的文档，有关详细信息，请参见选项详情列表</td></tr></tbody></table><p>options (更多选项) 列表：</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>background</td><td>Boolean</td><td>键索引过程会阻塞其它数据库操作，background 可指定以后台方式创建索引，即增加 &quot;background&quot; 可选参数，&quot;background&quot; 默认值为 false</td></tr><tr><td>unique</td><td>Boolean</td><td>建立的索引是否唯一，指定为 true 创建唯一索引，默认值为 false</td></tr><tr><td>name</td><td>string</td><td>索引的名称，如果未指定，MongoDB 的通过连接索引的字段名和排序生成一个索引名称</td></tr><tr><td>dropDups</td><td>Boolean</td><td>3.0 + 版本已经废弃，在建立唯一索引时是否删除重复记录，指定 true 创建唯一索引，默认值为 false</td></tr><tr><td>sparse</td><td>Boolean</td><td>对文档中不存在的字段数据不启用索引；这个参数需要特别注意，如果设置为 true 的话，在索引字段中不会查询出不包含对应字段的文档，默认值为 false</td></tr><tr><td>expireAfterSeconds</td><td>integer</td><td>指定一个以秒为单位的数值，完成 TTL 设定，设定集合的生存时间</td></tr><tr><td>v</td><td>index&lt;br&gt;version</td><td>索引的版本号，默认的索引版本取决于 mongod 创建索引时运行的版本</td></tr><tr><td>weights</td><td>document</td><td>索引权重值，数值在 1 到 99.999 之间，表示该索引相对于其它索引字段得分权重</td></tr><tr><td>default_language</td><td>string</td><td>对于文本索引，该参数决定了停用词及词干和词器的规则的列表，默认为英语</td></tr></tbody></table><p>提示：</p><p>注意在 3.0.0 版本前创建索引方法为： <code>db.collection.ensureIndex()</code> ，之后的版本使用了 <code>db.collection.createIndex()</code> 方法， <code>ensureIndex()</code> 还能用，但只是 <code>createIndex()</code> 的别名</p><p>[示例]</p><p>1. 单字段索引示例：对 <code>userid</code> 字段建立索引</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.createIndex<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid:1<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.createIndex<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid:1<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token string">"numIndexesBefore"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,</pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">"numIndexesAfter"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,</pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token string">"createdCollectionAutomatically"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token string">"ok"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>参数 1：按升序创建索引</p><p>可以查看一下：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.getIndexes<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>                <span class="token string">"v"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,</pre></td></tr><tr><td data-num="5"></td><td><pre>                <span class="token string">"key"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                        <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="8"></td><td><pre>                <span class="token string">"name"</span> <span class="token builtin class-name">:</span> <span class="token string">"_id_"</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token string">"v"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,</pre></td></tr><tr><td data-num="12"></td><td><pre>                <span class="token string">"key"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                        <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="15"></td><td><pre>                <span class="token string">"name"</span> <span class="token builtin class-name">:</span> <span class="token string">"userid_1"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>索引名字为： <code>userid_1</code></p><p>compass 查看：</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031702245.png" alt="image-20230604171621927"></p><p>复合索引：对 <code>userid</code> 和 <code>nickname</code> 同时建立复合 (Compound) 索引：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.createIndex<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid:1,nickname:-1<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.createIndex<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid:1,nickname:-1<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token string">"numIndexesBefore"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,</pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">"numIndexesAfter"</span> <span class="token builtin class-name">:</span> <span class="token number">3</span>,</pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token string">"createdCollectionAutomatically"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token string">"ok"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>查看一下索引：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.getIndexes<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>                <span class="token string">"v"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,</pre></td></tr><tr><td data-num="5"></td><td><pre>                <span class="token string">"key"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                        <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="8"></td><td><pre>                <span class="token string">"name"</span> <span class="token builtin class-name">:</span> <span class="token string">"_id_"</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token string">"v"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,</pre></td></tr><tr><td data-num="12"></td><td><pre>                <span class="token string">"key"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                        <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="15"></td><td><pre>                <span class="token string">"name"</span> <span class="token builtin class-name">:</span> <span class="token string">"userid_1"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                <span class="token string">"v"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,</pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token string">"key"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                        <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,</pre></td></tr><tr><td data-num="21"></td><td><pre>                        <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token parameter variable">-1</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="23"></td><td><pre>                <span class="token string">"name"</span> <span class="token builtin class-name">:</span> <span class="token string">"userid_1_nickname_-1"</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><h3 id="索引的移除"><a class="anchor" href="#索引的移除">#</a> 索引的移除</h3><p>说明：可以移除指定的索引，或移除所有索引</p><h4 id="一指定索引的移除"><a class="anchor" href="#一指定索引的移除">#</a> 一，指定索引的移除</h4><p>语法：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.collection.dropIndex<span class="token punctuation">(</span>index<span class="token punctuation">)</span></pre></td></tr></table></figure><p>参数：</p><table><caption style="caption-side:bottom">示例</caption><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>index</td><td>string or document</td><td>指定要删除的索引，可以通过索引名称或索引规范文档指定索引，诺要删除文本索引，请指定索引名称</td></tr></tbody></table><p>删除 <code>comment</code> 集合中 <code>userid</code> 字段上的升序索引：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.dropIndex<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid:1<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>查看已经删除了</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.getIndexes<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>                <span class="token string">"v"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,</pre></td></tr><tr><td data-num="5"></td><td><pre>                <span class="token string">"key"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                        <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="8"></td><td><pre>                <span class="token string">"name"</span> <span class="token builtin class-name">:</span> <span class="token string">"_id_"</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token string">"v"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,</pre></td></tr><tr><td data-num="12"></td><td><pre>                <span class="token string">"key"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                        <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="15"></td><td><pre>                <span class="token string">"name"</span> <span class="token builtin class-name">:</span> <span class="token string">"userid_1"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                <span class="token string">"v"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,</pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token string">"key"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                        <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,</pre></td></tr><tr><td data-num="21"></td><td><pre>                        <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token parameter variable">-1</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="23"></td><td><pre>                <span class="token string">"name"</span> <span class="token builtin class-name">:</span> <span class="token string">"userid_1_nickname_-1"</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token operator">></span> db.comment.dropIndex<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid:1<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"nIndexesWas"</span> <span class="token builtin class-name">:</span> <span class="token number">3</span>, <span class="token string">"ok"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token operator">></span> db.comment.getIndexes<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                <span class="token string">"v"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,</pre></td></tr><tr><td data-num="32"></td><td><pre>                <span class="token string">"key"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                        <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="35"></td><td><pre>                <span class="token string">"name"</span> <span class="token builtin class-name">:</span> <span class="token string">"_id_"</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                <span class="token string">"v"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,</pre></td></tr><tr><td data-num="39"></td><td><pre>                <span class="token string">"key"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>                        <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,</pre></td></tr><tr><td data-num="41"></td><td><pre>                        <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token parameter variable">-1</span></pre></td></tr><tr><td data-num="42"></td><td><pre>                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="43"></td><td><pre>                <span class="token string">"name"</span> <span class="token builtin class-name">:</span> <span class="token string">"userid_1_nickname_-1"</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><h4 id="二所有索引的移除"><a class="anchor" href="#二所有索引的移除">#</a> 二，所有索引的移除</h4><p>语法：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.collection.dropIndexes<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>[示例]</p><p>删除 skip 集合中所有索引</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.<span class="token function-name function">dropIndexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token string">"nIndexesWas"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,</pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">"msg"</span> <span class="token builtin class-name">:</span> <span class="token string">"non-_id indexes dropped for collection"</span>,</pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token string">"ok"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>提示： <code>_id</code> 的字段的索引是无法删除的，只能删除非 <code>_id</code> 字段的索引</p><p>查看索引：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.getIndexes<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span> <span class="token punctuation">&#123;</span> <span class="token string">"v"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token string">"key"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span>, <span class="token string">"name"</span> <span class="token builtin class-name">:</span> <span class="token string">"_id_"</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><h3 id="索引的使用"><a class="anchor" href="#索引的使用">#</a> 索引的使用</h3><h4 id="执行计划"><a class="anchor" href="#执行计划">#</a> 执行计划</h4><p>分析查询性能 (Analyze Query Performance) 通常使用执行计划，(解释计划，Explin Plan) 来查看查询的情况，如查询耗费的时间，是否基于索引查询等</p><p>那么，通常，我们想知道，建立的索引是否有效，效果如何，都需要通过执行计划查看</p><p>语法：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.collection.find<span class="token punctuation">(</span>query,options<span class="token punctuation">)</span>.explain<span class="token punctuation">(</span>options<span class="token punctuation">)</span></pre></td></tr></table></figure><p>[示例]</p><p>查看根据 userid 查询数据的情况：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid:<span class="token string">"1003"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>.<span class="token function-name function">explain</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token string">"explainVersion"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>,</pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">"queryPlanner"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                <span class="token string">"namespace"</span> <span class="token builtin class-name">:</span> <span class="token string">"articledb.comment"</span>,</pre></td></tr><tr><td data-num="6"></td><td><pre>                <span class="token string">"indexFilterSet"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="7"></td><td><pre>                <span class="token string">"parsedQuery"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                        <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                                <span class="token string">"<span class="token variable">$eq</span>"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="12"></td><td><pre>                <span class="token string">"queryHash"</span> <span class="token builtin class-name">:</span> <span class="token string">"37A12FC3"</span>,</pre></td></tr><tr><td data-num="13"></td><td><pre>                <span class="token string">"planCacheKey"</span> <span class="token builtin class-name">:</span> <span class="token string">"4A7D843D"</span>,</pre></td></tr><tr><td data-num="14"></td><td><pre>                <span class="token string">"maxIndexedOrSolutionsReached"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="15"></td><td><pre>                <span class="token string">"maxIndexedAndSolutionsReached"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="16"></td><td><pre>                <span class="token string">"maxScansToExplodeReached"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="17"></td><td><pre>                <span class="token string">"winningPlan"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                        <span class="token string">"stage"</span> <span class="token builtin class-name">:</span> <span class="token string">"COLLSCAN"</span>,</pre></td></tr><tr><td data-num="19"></td><td><pre>                        <span class="token string">"filter"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                                <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                                        <span class="token string">"<span class="token variable">$eq</span>"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="24"></td><td><pre>                        <span class="token string">"direction"</span> <span class="token builtin class-name">:</span> <span class="token string">"forward"</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="26"></td><td><pre>                <span class="token string">"rejectedPlans"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token string">"command"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                <span class="token string">"find"</span> <span class="token builtin class-name">:</span> <span class="token string">"comment"</span>,</pre></td></tr><tr><td data-num="30"></td><td><pre>                <span class="token string">"filter"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                        <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="33"></td><td><pre>                <span class="token string">"<span class="token variable">$db</span>"</span> <span class="token builtin class-name">:</span> <span class="token string">"articledb"</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token string">"serverInfo"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                <span class="token string">"host"</span> <span class="token builtin class-name">:</span> <span class="token string">"localhost.localdomain"</span>,</pre></td></tr><tr><td data-num="37"></td><td><pre>                <span class="token string">"port"</span> <span class="token builtin class-name">:</span> <span class="token number">27017</span>,</pre></td></tr><tr><td data-num="38"></td><td><pre>                <span class="token string">"version"</span> <span class="token builtin class-name">:</span> <span class="token string">"5.0.18"</span>,</pre></td></tr><tr><td data-num="39"></td><td><pre>                <span class="token string">"gitVersion"</span> <span class="token builtin class-name">:</span> <span class="token string">"796abe56bfdbca6968ff570311bf72d93632825b"</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token string">"serverParameters"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>                <span class="token string">"internalQueryFacetBufferSizeBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span>,</pre></td></tr><tr><td data-num="43"></td><td><pre>                <span class="token string">"internalQueryFacetMaxOutputDocSizeBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span>,</pre></td></tr><tr><td data-num="44"></td><td><pre>                <span class="token string">"internalLookupStageIntermediateDocumentMaxSizeBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span>,</pre></td></tr><tr><td data-num="45"></td><td><pre>                <span class="token string">"internalDocumentSourceGroupMaxMemoryBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span>,</pre></td></tr><tr><td data-num="46"></td><td><pre>                <span class="token string">"internalQueryMaxBlockingSortMemoryUsageBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span>,</pre></td></tr><tr><td data-num="47"></td><td><pre>                <span class="token string">"internalQueryProhibitBlockingMergeOnMongoS"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="48"></td><td><pre>                <span class="token string">"internalQueryMaxAddToSetBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span>,</pre></td></tr><tr><td data-num="49"></td><td><pre>                <span class="token string">"internalDocumentSourceSetWindowFieldsMaxMemoryBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token string">"ok"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>查看出来的结果是文档的扫描是 5 条记录，数据是 5 条，扫描也是 5 条就代表全文档扫描</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031702609.png" alt="image-20230604214503129"></p><p>想用上索引就需要给数据 加上索引</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.createIndex<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid:1<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token string">"numIndexesBefore"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,</pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">"numIndexesAfter"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,</pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token string">"createdCollectionAutomatically"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token string">"ok"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid:<span class="token string">"1003"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>.<span class="token function-name function">explain</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token string">"explainVersion"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>,</pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">"queryPlanner"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                <span class="token string">"namespace"</span> <span class="token builtin class-name">:</span> <span class="token string">"articledb.comment"</span>,</pre></td></tr><tr><td data-num="6"></td><td><pre>                <span class="token string">"indexFilterSet"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="7"></td><td><pre>                <span class="token string">"parsedQuery"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                        <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                                <span class="token string">"<span class="token variable">$eq</span>"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="12"></td><td><pre>                <span class="token string">"queryHash"</span> <span class="token builtin class-name">:</span> <span class="token string">"37A12FC3"</span>,</pre></td></tr><tr><td data-num="13"></td><td><pre>                <span class="token string">"planCacheKey"</span> <span class="token builtin class-name">:</span> <span class="token string">"3B74CBDE"</span>,</pre></td></tr><tr><td data-num="14"></td><td><pre>                <span class="token string">"maxIndexedOrSolutionsReached"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="15"></td><td><pre>                <span class="token string">"maxIndexedAndSolutionsReached"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="16"></td><td><pre>                <span class="token string">"maxScansToExplodeReached"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="17"></td><td><pre>                <span class="token string">"winningPlan"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                        <span class="token string">"stage"</span> <span class="token builtin class-name">:</span> <span class="token string">"FETCH"</span>,</pre></td></tr><tr><td data-num="19"></td><td><pre>                        <span class="token string">"inputStage"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                                <span class="token string">"stage"</span> <span class="token builtin class-name">:</span> <span class="token string">"IXSCAN"</span>,</pre></td></tr><tr><td data-num="21"></td><td><pre>                                <span class="token string">"keyPattern"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                                        <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="24"></td><td><pre>                                <span class="token string">"indexName"</span> <span class="token builtin class-name">:</span> <span class="token string">"userid_1"</span>,</pre></td></tr><tr><td data-num="25"></td><td><pre>                                <span class="token string">"isMultiKey"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="26"></td><td><pre>                                <span class="token string">"multiKeyPaths"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                                        <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="29"></td><td><pre>                                <span class="token string">"isUnique"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="30"></td><td><pre>                                <span class="token string">"isSparse"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="31"></td><td><pre>                                <span class="token string">"isPartial"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="32"></td><td><pre>                                <span class="token string">"indexVersion"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,</pre></td></tr><tr><td data-num="33"></td><td><pre>                                <span class="token string">"direction"</span> <span class="token builtin class-name">:</span> <span class="token string">"forward"</span>,</pre></td></tr><tr><td data-num="34"></td><td><pre>                                <span class="token string">"indexBounds"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                                        <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                                                <span class="token string">"[<span class="token entity" title="\&quot;">\"</span>1003<span class="token entity" title="\&quot;">\"</span>, <span class="token entity" title="\&quot;">\"</span>1003<span class="token entity" title="\&quot;">\"</span>]"</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                                        <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>                        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="41"></td><td><pre>                <span class="token string">"rejectedPlans"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token string">"command"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>                <span class="token string">"find"</span> <span class="token builtin class-name">:</span> <span class="token string">"comment"</span>,</pre></td></tr><tr><td data-num="45"></td><td><pre>                <span class="token string">"filter"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>                        <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span></pre></td></tr><tr><td data-num="47"></td><td><pre>                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="48"></td><td><pre>                <span class="token string">"<span class="token variable">$db</span>"</span> <span class="token builtin class-name">:</span> <span class="token string">"articledb"</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token string">"serverInfo"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>                <span class="token string">"host"</span> <span class="token builtin class-name">:</span> <span class="token string">"localhost.localdomain"</span>,</pre></td></tr><tr><td data-num="52"></td><td><pre>                <span class="token string">"port"</span> <span class="token builtin class-name">:</span> <span class="token number">27017</span>,</pre></td></tr><tr><td data-num="53"></td><td><pre>                <span class="token string">"version"</span> <span class="token builtin class-name">:</span> <span class="token string">"5.0.18"</span>,</pre></td></tr><tr><td data-num="54"></td><td><pre>                <span class="token string">"gitVersion"</span> <span class="token builtin class-name">:</span> <span class="token string">"796abe56bfdbca6968ff570311bf72d93632825b"</span></pre></td></tr><tr><td data-num="55"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="56"></td><td><pre>        <span class="token string">"serverParameters"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>                <span class="token string">"internalQueryFacetBufferSizeBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span>,</pre></td></tr><tr><td data-num="58"></td><td><pre>                <span class="token string">"internalQueryFacetMaxOutputDocSizeBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span>,</pre></td></tr><tr><td data-num="59"></td><td><pre>                <span class="token string">"internalLookupStageIntermediateDocumentMaxSizeBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span>,</pre></td></tr><tr><td data-num="60"></td><td><pre>                <span class="token string">"internalDocumentSourceGroupMaxMemoryBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span>,</pre></td></tr><tr><td data-num="61"></td><td><pre>                <span class="token string">"internalQueryMaxBlockingSortMemoryUsageBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span>,</pre></td></tr><tr><td data-num="62"></td><td><pre>                <span class="token string">"internalQueryProhibitBlockingMergeOnMongoS"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="63"></td><td><pre>                <span class="token string">"internalQueryMaxAddToSetBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span>,</pre></td></tr><tr><td data-num="64"></td><td><pre>                <span class="token string">"internalDocumentSourceSetWindowFieldsMaxMemoryBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span></pre></td></tr><tr><td data-num="65"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="66"></td><td><pre>        <span class="token string">"ok"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>此时的 &quot;stage&quot; : &quot;FETCH&quot; 就变成了 FETCH</p><p>此时文档的扫描就是 2 条数据了</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031703658.png" alt="image-20230604215307694"></p><p>它是先通过 IXSCAN 查询索引里面的集合，索引也是一个小集合</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031703416.png" alt="image-20230604215400607"></p><p>再通过抓取，去抓取指定查回来的 2 条数据</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031703567.png" alt="image-20230604215440187"></p><h2 id="涵盖的查询"><a class="anchor" href="#涵盖的查询">#</a> 涵盖的查询</h2><p>Convered Queries</p><p>当查询条件和查询的投影仅包含索引字段时，MongoDB 直接从索引返回结果，而不扫描任何文档或将文档带入内存，这些覆盖的查询可以非常有效</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031703796.png" alt="image-20230604220253854"></p><p>如果查询的数据在索引中已经有了就不会再去文档中去找了，而是直接从索引中 取</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031703030.png" alt="image-20230604220509616"></p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.find<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid:<span class="token string">"1003"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span>userid:1,_id:0<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>.<span class="token function-name function">explain</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token string">"explainVersion"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>,</pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">"queryPlanner"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                <span class="token string">"namespace"</span> <span class="token builtin class-name">:</span> <span class="token string">"articledb.comment"</span>,</pre></td></tr><tr><td data-num="6"></td><td><pre>                <span class="token string">"indexFilterSet"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="7"></td><td><pre>                <span class="token string">"parsedQuery"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                        <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                                <span class="token string">"<span class="token variable">$eq</span>"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="12"></td><td><pre>                <span class="token string">"queryHash"</span> <span class="token builtin class-name">:</span> <span class="token string">"8177476D"</span>,</pre></td></tr><tr><td data-num="13"></td><td><pre>                <span class="token string">"planCacheKey"</span> <span class="token builtin class-name">:</span> <span class="token string">"F842FA57"</span>,</pre></td></tr><tr><td data-num="14"></td><td><pre>                <span class="token string">"maxIndexedOrSolutionsReached"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="15"></td><td><pre>                <span class="token string">"maxIndexedAndSolutionsReached"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="16"></td><td><pre>                <span class="token string">"maxScansToExplodeReached"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="17"></td><td><pre>                <span class="token string">"winningPlan"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                        <span class="token string">"stage"</span> <span class="token builtin class-name">:</span> <span class="token string">"PROJECTION_COVERED"</span>,</pre></td></tr><tr><td data-num="19"></td><td><pre>                        <span class="token string">"transformBy"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                                <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,</pre></td></tr><tr><td data-num="21"></td><td><pre>                                <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="23"></td><td><pre>                        <span class="token string">"inputStage"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                                <span class="token string">"stage"</span> <span class="token builtin class-name">:</span> <span class="token string">"IXSCAN"</span>,</pre></td></tr><tr><td data-num="25"></td><td><pre>                                <span class="token string">"keyPattern"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                                        <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="28"></td><td><pre>                                <span class="token string">"indexName"</span> <span class="token builtin class-name">:</span> <span class="token string">"userid_1"</span>,</pre></td></tr><tr><td data-num="29"></td><td><pre>                                <span class="token string">"isMultiKey"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="30"></td><td><pre>                                <span class="token string">"multiKeyPaths"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                                        <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="33"></td><td><pre>                                <span class="token string">"isUnique"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="34"></td><td><pre>                                <span class="token string">"isSparse"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="35"></td><td><pre>                                <span class="token string">"isPartial"</span> <span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="36"></td><td><pre>                                <span class="token string">"indexVersion"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,</pre></td></tr><tr><td data-num="37"></td><td><pre>                                <span class="token string">"direction"</span> <span class="token builtin class-name">:</span> <span class="token string">"forward"</span>,</pre></td></tr><tr><td data-num="38"></td><td><pre>                                <span class="token string">"indexBounds"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>                                        <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="40"></td><td><pre>                                                <span class="token string">"[<span class="token entity" title="\&quot;">\"</span>1003<span class="token entity" title="\&quot;">\"</span>, <span class="token entity" title="\&quot;">\"</span>1003<span class="token entity" title="\&quot;">\"</span>]"</span></pre></td></tr><tr><td data-num="41"></td><td><pre>                                        <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="42"></td><td><pre>                                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>                        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="45"></td><td><pre>                <span class="token string">"rejectedPlans"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="47"></td><td><pre>        <span class="token string">"command"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>                <span class="token string">"find"</span> <span class="token builtin class-name">:</span> <span class="token string">"comment"</span>,</pre></td></tr><tr><td data-num="49"></td><td><pre>                <span class="token string">"filter"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>                        <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span></pre></td></tr><tr><td data-num="51"></td><td><pre>                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="52"></td><td><pre>                <span class="token string">"projection"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>                        <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,</pre></td></tr><tr><td data-num="54"></td><td><pre>                        <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="55"></td><td><pre>                <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="56"></td><td><pre>                <span class="token string">"<span class="token variable">$db</span>"</span> <span class="token builtin class-name">:</span> <span class="token string">"articledb"</span></pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="58"></td><td><pre>        <span class="token string">"serverInfo"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>                <span class="token string">"host"</span> <span class="token builtin class-name">:</span> <span class="token string">"localhost.localdomain"</span>,</pre></td></tr><tr><td data-num="60"></td><td><pre>                <span class="token string">"port"</span> <span class="token builtin class-name">:</span> <span class="token number">27017</span>,</pre></td></tr><tr><td data-num="61"></td><td><pre>                <span class="token string">"version"</span> <span class="token builtin class-name">:</span> <span class="token string">"5.0.18"</span>,</pre></td></tr><tr><td data-num="62"></td><td><pre>                <span class="token string">"gitVersion"</span> <span class="token builtin class-name">:</span> <span class="token string">"796abe56bfdbca6968ff570311bf72d93632825b"</span></pre></td></tr><tr><td data-num="63"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="64"></td><td><pre>        <span class="token string">"serverParameters"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>                <span class="token string">"internalQueryFacetBufferSizeBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span>,</pre></td></tr><tr><td data-num="66"></td><td><pre>                <span class="token string">"internalQueryFacetMaxOutputDocSizeBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span>,</pre></td></tr><tr><td data-num="67"></td><td><pre>                <span class="token string">"internalLookupStageIntermediateDocumentMaxSizeBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span>,</pre></td></tr><tr><td data-num="68"></td><td><pre>                <span class="token string">"internalDocumentSourceGroupMaxMemoryBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span>,</pre></td></tr><tr><td data-num="69"></td><td><pre>                <span class="token string">"internalQueryMaxBlockingSortMemoryUsageBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span>,</pre></td></tr><tr><td data-num="70"></td><td><pre>                <span class="token string">"internalQueryProhibitBlockingMergeOnMongoS"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="71"></td><td><pre>                <span class="token string">"internalQueryMaxAddToSetBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span>,</pre></td></tr><tr><td data-num="72"></td><td><pre>                <span class="token string">"internalDocumentSourceSetWindowFieldsMaxMemoryBytes"</span> <span class="token builtin class-name">:</span> <span class="token number">104857600</span></pre></td></tr><tr><td data-num="73"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="74"></td><td><pre>        <span class="token string">"ok"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="75"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="76"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><h2 id="文章评论"><a class="anchor" href="#文章评论">#</a> 文章评论</h2><h3 id="需求分析"><a class="anchor" href="#需求分析">#</a> 需求分析</h3><p>某头条的文章评论业务如下：</p><p>需要实现以下功能：</p><ol><li>基本增删改查 API</li><li>根据文章 id 查询评论</li><li>评论点赞</li></ol><h3 id="表结构分析"><a class="anchor" href="#表结构分析">#</a> 表结构分析</h3><p>数据库：articledb</p><table><thead><tr><th>专栏文章评论</th><th>comment</th><th></th><th></th></tr></thead><tbody><tr><td>字段名称</td><td>字段含义</td><td>字段类型</td><td>备注</td></tr><tr><td>_id</td><td>ID</td><td>ObjectId 或 String</td><td>Mongo 的主键的字段</td></tr><tr><td>articleid</td><td>文章 ID</td><td>String</td><td></td></tr><tr><td>content</td><td>评论内容</td><td>String</td><td></td></tr><tr><td>userid</td><td>评论人 ID</td><td>String</td><td></td></tr><tr><td>nickname</td><td>评论人昵称</td><td>String</td><td></td></tr><tr><td>createdatetime</td><td>评论的日期时间</td><td>Date</td><td></td></tr><tr><td>likenum</td><td>点赞数</td><td>int32</td><td></td></tr><tr><td>replynum</td><td>回复数</td><td>int32</td><td></td></tr><tr><td>state</td><td>状态</td><td>String</td><td>0: 不可见；1: 可见；</td></tr><tr><td>parentid</td><td>上级 ID</td><td>String</td><td>如果为 0 表示文章的顶级评论</td></tr></tbody></table><h3 id="技术选型"><a class="anchor" href="#技术选型">#</a> 技术选型</h3><p>mongodb-driver</p><p>mongodb-driver 是 MongoDB 官方推出的 java 连接 mongoDB 的驱动包，相当于 JDBC 驱动，我们通过一个入门的案例来了解 mongodb-driver 的基本使用</p><p>官方驱动说明和下载：<span class="exturl" data-url="aHR0cHM6Ly9tb25nb2RiLmdpdGh1Yi5pby9tb25nby1qYXZhLWRyaXZlci8=">https://mongodb.github.io/mongo-java-driver/</span></p><p>官方驱动示例文档：<span class="exturl" data-url="aHR0cHM6Ly9tb25nb2RiLmdpdGh1Yi5pby9tb25nby1qYXZhLWRyaXZlci8zLjgvZHJpdmVyL2dldHRpbmctc3RhcnRlZC9xdWljay1zdGFydC8=">https://mongodb.github.io/mongo-java-driver/3.8/driver/getting-started/quick-start/</span></p><h3 id="springdatamongodb"><a class="anchor" href="#springdatamongodb">#</a> SpringDataMongoDB</h3><p>SpringData 家族成员之一，用于操作 MongoDB 的持久层框架，封装了底层的 MongoDB-Driver</p><p>官方主页：<span class="exturl" data-url="aHR0cHM6Ly9zcHJpbmcuaW8vcHJvamVjdHMvc3ByaW5nLWRhdGEtbW9uZ29kYi8=">https://spring.io/projects/spring-data-mongodb/</span></p><p>我们十次方项目的吐槽微服务就采用 SpringDataMongoDB 框架</p><p>1. 创建好 SpringBoot 的项目结构</p><p>2. 导入相关依赖</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-mongodb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>3. 配置 mongodb 连接配置</p><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">server</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token comment">#数据源配置</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token key atrule">data</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">mongodb</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token comment">#主机地址</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.244.142</pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token comment">#数据库</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token key atrule">database</span><span class="token punctuation">:</span> articledb</pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token comment">#端口号</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27017</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token comment">#也可以使用 uri 连接</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token comment">#uri: mongodb://192.168.244.142:27017/articledb</span></pre></td></tr></table></figure><p>4. 启动 SpringBoot 查看是否有报错</p><p><img data-src="https://raw.githubusercontent.com/PigPigLetsGo/imeages/master/202401031703699.png" alt="image-20230605084426815"></p><p>一切顺利</p><h3 id="文章评论实体类的编写"><a class="anchor" href="#文章评论实体类的编写">#</a> 文章评论实体类的编写</h3><p>创建实体类</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Getter</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Setter</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Id</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>core<span class="token punctuation">.</span>index<span class="token punctuation">.</span></span><span class="token class-name">CompoundIndex</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>core<span class="token punctuation">.</span>index<span class="token punctuation">.</span></span><span class="token class-name">Indexed</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>core<span class="token punctuation">.</span>mapping<span class="token punctuation">.</span></span><span class="token class-name">Document</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>core<span class="token punctuation">.</span>mapping<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token annotation punctuation">@Getter</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token annotation punctuation">@Setter</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">// 对应 collection 名</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token annotation punctuation">@Document</span><span class="token punctuation">(</span>collection <span class="token operator">=</span> <span class="token string">"comment"</span><span class="token punctuation">)</span><span class="token comment">// 可以省略，如果省略，则默认使用类名小写映射集合</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">// 复合索引</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token annotation punctuation">@CompoundIndex</span><span class="token punctuation">(</span>def <span class="token operator">=</span> <span class="token string">"&#123;'userid':1,'nickname':-1&#125;"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Comment</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">//    主键标识，该属性的值会自动对应 mongodb 的主键字段_id，如果该属性名就叫 id，则该注解可以省略，否则必须写</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token annotation punctuation">@Id</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span><span class="token comment">// 主键</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment">//    该属性对应 mongodb 的字段名字，如果一致，则无需该注解</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span><span class="token string">"content"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span><span class="token comment">// 吐槽内容</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Date</span> publishtime<span class="token punctuation">;</span><span class="token comment">// 发布日期</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment">//    添加了一个单字段的索引</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token annotation punctuation">@Indexed</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> userid<span class="token punctuation">;</span><span class="token comment">// 发布人 ID</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> nickname<span class="token punctuation">;</span><span class="token comment">// 昵称</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> createdatatime<span class="token punctuation">;</span><span class="token comment">// 评论的日期时间</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> likenum<span class="token punctuation">;</span><span class="token comment">// 点赞数</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> replynum<span class="token punctuation">;</span><span class="token comment">// 回复数</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> state<span class="token punctuation">;</span><span class="token comment">// 状态</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> parentid<span class="token punctuation">;</span><span class="token comment">// 上级 ID</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> articleid<span class="token punctuation">;</span><span class="token comment">// 文章 ID</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="文章评论的基本增删改查"><a class="anchor" href="#文章评论的基本增删改查">#</a> 文章评论的基本增删改查</h3><p>创建数据访问接口</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>dkx<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Comment</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">MongoRepository</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 评论的持久层接口</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CommentRepository</span> <span class="token keyword">extends</span> <span class="token class-name">MongoRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Comment</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>2. 创建业务逻辑类</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>dkx<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">CommentRepository</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>dkx<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Comment</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"all"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token annotation punctuation">@Service</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommentService</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token annotation punctuation">@Autowired</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">CommentRepository</span> commentRepository<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="15"></td><td><pre>     * 保存一个评论</pre></td></tr><tr><td data-num="16"></td><td><pre>     * @param comment</pre></td></tr><tr><td data-num="17"></td><td><pre>     */</pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">Comment</span> comment<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token comment">/**</span></pre></td></tr><tr><td data-num="20"></td><td><pre>         * 如果需要自定义主键，可以在这里指定主键；如果不指定主键，MongoDB 会自动生成主键</pre></td></tr><tr><td data-num="21"></td><td><pre>         * 设置一些默认初始值。。。</pre></td></tr><tr><td data-num="22"></td><td><pre>         * 调用 dao</pre></td></tr><tr><td data-num="23"></td><td><pre>         */</pre></td></tr><tr><td data-num="24"></td><td><pre>        commentRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>comment<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="28"></td><td><pre>     * 更新评论</pre></td></tr><tr><td data-num="29"></td><td><pre>     * @param comment</pre></td></tr><tr><td data-num="30"></td><td><pre>     */</pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateComment</span><span class="token punctuation">(</span><span class="token class-name">Comment</span> comment<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token comment">// 调用 dao</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        commentRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>comment<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="37"></td><td><pre>     * 根据 id 删除评论</pre></td></tr><tr><td data-num="38"></td><td><pre>     * @param id</pre></td></tr><tr><td data-num="39"></td><td><pre>     */</pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteCommentById</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token comment">// 调用 dao</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        commentRepository<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="46"></td><td><pre>     * 查询所有评论</pre></td></tr><tr><td data-num="47"></td><td><pre>     * @return</pre></td></tr><tr><td data-num="48"></td><td><pre>     */</pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Comment</span><span class="token punctuation">></span></span> <span class="token function">findCommentList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token keyword">return</span> commentRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="52"></td><td><pre></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="54"></td><td><pre>     * 根据 id 查询评论</pre></td></tr><tr><td data-num="55"></td><td><pre>     * @param id</pre></td></tr><tr><td data-num="56"></td><td><pre>     * @return</pre></td></tr><tr><td data-num="57"></td><td><pre>     */</pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Comment</span> <span class="token function">findCommentById</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>        <span class="token keyword">return</span> commentRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>测试代码：</p><p>获取全部数据</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>classes <span class="token operator">=</span> <span class="token class-name">App</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppTest</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token annotation punctuation">@Autowired</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">CommentService</span> commentService<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Comment</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> commentService<span class="token punctuation">.</span><span class="token function">findCommentList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Comment</span> i<span class="token operator">:</span>list<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token constant">RUN</span> <span class="token class-name">Result</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token class-name">Comment</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> content<span class="token operator">=</span>多喝凉水<span class="token punctuation">,</span> publishtime<span class="token operator">=</span><span class="token class-name">Sat</span> <span class="token class-name">Jan</span> <span class="token number">02</span> <span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token class-name">CST</span> <span class="token number">2021</span><span class="token punctuation">,</span> userid<span class="token operator">=</span><span class="token number">1003</span><span class="token punctuation">,</span> nickname<span class="token operator">=</span>山海经<span class="token punctuation">,</span> createdatatim<span class="token operator">=</span><span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span><span class="token constant">T08</span><span class="token operator">:</span><span class="token number">00</span><span class="token punctuation">,</span> likenum<span class="token operator">=</span><span class="token number">10001</span><span class="token punctuation">,</span> replynum<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> parentid<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> articleid<span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>添加一条数据</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token class-name">Comment</span> comment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Comment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        comment<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        comment<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span><span class="token string">"我天天喝"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        comment<span class="token punctuation">.</span><span class="token function">setPublishtime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        comment<span class="token punctuation">.</span><span class="token function">setUserid</span><span class="token punctuation">(</span><span class="token string">"1001"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        comment<span class="token punctuation">.</span><span class="token function">setNickname</span><span class="token punctuation">(</span><span class="token string">"凯撒"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        comment<span class="token punctuation">.</span><span class="token function">setCreatedatatim</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        comment<span class="token punctuation">.</span><span class="token function">setLikenum</span><span class="token punctuation">(</span><span class="token number">10003</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        comment<span class="token punctuation">.</span><span class="token function">setReplynum</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        comment<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        comment<span class="token punctuation">.</span><span class="token function">setParentid</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        comment<span class="token punctuation">.</span><span class="token function">setArticleid</span><span class="token punctuation">(</span><span class="token string">"1001"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        commentService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>comment<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token constant">RUN</span> <span class="token class-name">Result</span> <span class="token class-name">Check</span> <span class="token class-name">Terminal</span> <span class="token class-name">Mongo</span> <span class="token class-name">DataStatement</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token operator">></span> db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"articleid"</span> <span class="token operator">:</span> <span class="token string">"1001"</span><span class="token punctuation">,</span> <span class="token string">"content"</span> <span class="token operator">:</span> <span class="token string">"多喝凉水"</span><span class="token punctuation">,</span> <span class="token string">"userid"</span> <span class="token operator">:</span> <span class="token string">"1003"</span><span class="token punctuation">,</span> <span class="token string">"nickname"</span> <span class="token operator">:</span> <span class="token string">"山海经"</span><span class="token punctuation">,</span> <span class="token string">"createdatatim"</span> <span class="token operator">:</span> <span class="token class-name">ISODate</span><span class="token punctuation">(</span><span class="token string">"2021-01-02T00:00:00Z"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"likenum"</span> <span class="token operator">:</span> <span class="token string">"10001"</span><span class="token punctuation">,</span> <span class="token string">"replynum"</span> <span class="token operator">:</span> <span class="token string">"3"</span><span class="token punctuation">,</span> <span class="token string">"state"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"parentid"</span> <span class="token operator">:</span> <span class="token string">"0"</span><span class="token punctuation">,</span> <span class="token string">"publishtime"</span> <span class="token operator">:</span> <span class="token class-name">ISODate</span><span class="token punctuation">(</span><span class="token string">"2021-01-02T00:00:00Z"</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"content"</span> <span class="token operator">:</span> <span class="token string">"我天天喝"</span><span class="token punctuation">,</span> <span class="token string">"publishtime"</span> <span class="token operator">:</span> <span class="token class-name">ISODate</span><span class="token punctuation">(</span><span class="token string">"2023-06-05T02:26:15.397Z"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"userid"</span> <span class="token operator">:</span> <span class="token string">"1001"</span><span class="token punctuation">,</span> <span class="token string">"nickname"</span> <span class="token operator">:</span> <span class="token string">"凯撒"</span><span class="token punctuation">,</span> <span class="token string">"createdatatim"</span> <span class="token operator">:</span> <span class="token class-name">ISODate</span><span class="token punctuation">(</span><span class="token string">"2023-06-05T02:26:15.405Z"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"likenum"</span> <span class="token operator">:</span> <span class="token number">10003</span><span class="token punctuation">,</span> <span class="token string">"replynum"</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">"state"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"parentid"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"articleid"</span> <span class="token operator">:</span> <span class="token string">"1001"</span><span class="token punctuation">,</span> <span class="token string">"_class"</span> <span class="token operator">:</span> <span class="token string">"com.dkx.domain.Comment"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><h3 id="根据上级id查询文章评论的分页列表"><a class="anchor" href="#根据上级id查询文章评论的分页列表">#</a> 根据上级 ID 查询文章评论的分页列表</h3><p>1.CommentRepository 新增方法定义</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>dkx<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Comment</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Page</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Pageable</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">MongoRepository</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 评论的持久层接口</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"all"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CommentRepository</span> <span class="token keyword">extends</span> <span class="token class-name">MongoRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Comment</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">//    方法名必须是 findBy 语法 Parentid 对应集合的字段的不能写错或者乱写都是不行的</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Comment</span><span class="token punctuation">></span></span> <span class="token function">findByParentid</span><span class="token punctuation">(</span><span class="token class-name">String</span> parentid<span class="token punctuation">,</span><span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>2. 编写 service 代码</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre> * 分页查询上级 ID</pre></td></tr><tr><td data-num="3"></td><td><pre> * @param parentid</pre></td></tr><tr><td data-num="4"></td><td><pre> * @param page</pre></td></tr><tr><td data-num="5"></td><td><pre> * @param size</pre></td></tr><tr><td data-num="6"></td><td><pre> * @return</pre></td></tr><tr><td data-num="7"></td><td><pre> */</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">public</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Comment</span><span class="token punctuation">></span></span> <span class="token function">findCommentListByParentid</span><span class="token punctuation">(</span><span class="token class-name">String</span> parentid<span class="token punctuation">,</span><span class="token keyword">int</span> page<span class="token punctuation">,</span><span class="token keyword">int</span> size<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>   <span class="token keyword">return</span> commentRepository<span class="token punctuation">.</span><span class="token function">findByParentid</span><span class="token punctuation">(</span>parentid<span class="token punctuation">,</span> <span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>3. 测试代码：</p><p>先查看集合的数据</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> db.comment.<span class="token function-name function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1001"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"多喝凉水"</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1003"</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"山海经"</span>, <span class="token string">"createdatatim"</span> <span class="token builtin class-name">:</span> ISODate<span class="token punctuation">(</span><span class="token string">"2021-01-02T00:00:00Z"</span><span class="token punctuation">)</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token string">"10001"</span>, <span class="token string">"replynum"</span> <span class="token builtin class-name">:</span> <span class="token string">"3"</span>, <span class="token string">"state"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"parentid"</span> <span class="token builtin class-name">:</span> <span class="token string">"0"</span>, <span class="token string">"publishtime"</span> <span class="token builtin class-name">:</span> ISODate<span class="token punctuation">(</span><span class="token string">"2021-01-02T00:00:00Z"</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>, <span class="token string">"content"</span> <span class="token builtin class-name">:</span> <span class="token string">"我天天喝"</span>, <span class="token string">"publishtime"</span> <span class="token builtin class-name">:</span> ISODate<span class="token punctuation">(</span><span class="token string">"2023-06-05T02:26:15.397Z"</span><span class="token punctuation">)</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1001"</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"凯撒"</span>, <span class="token string">"createdatatim"</span> <span class="token builtin class-name">:</span> ISODate<span class="token punctuation">(</span><span class="token string">"2023-06-05T02:26:15.405Z"</span><span class="token punctuation">)</span>, <span class="token string">"likenum"</span> <span class="token builtin class-name">:</span> <span class="token number">10003</span>, <span class="token string">"replynum"</span> <span class="token builtin class-name">:</span> <span class="token number">4</span>, <span class="token string">"state"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"parentid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"articleid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1001"</span>, <span class="token string">"_class"</span> <span class="token builtin class-name">:</span> <span class="token string">"com.dkx.domain.Comment"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">"647d5340b50522086f5836bb"</span><span class="token punctuation">)</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1001"</span>, <span class="token string">"parentid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"刘桑"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">"647d5340b50522086f5836bc"</span><span class="token punctuation">)</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1002"</span>, <span class="token string">"parentid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"张三"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">"647d5340b50522086f5836bd"</span><span class="token punctuation">)</span>, <span class="token string">"userid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1004"</span>, <span class="token string">"parentid"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>, <span class="token string">"nickname"</span> <span class="token builtin class-name">:</span> <span class="token string">"李四"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">></span></pre></td></tr></table></figure><p>parentid 为 1 的数据有 4 条，测试代码中传入查询 2 条数据</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Comment</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> commentService<span class="token punctuation">.</span><span class="token function">findCommentListByParentid</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Comment</span> i<span class="token operator">:</span>list<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">RUN</span> <span class="token class-name">Result</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token class-name">Comment</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">647d</span><span class="token number">5340</span>b50522086f5836bb<span class="token punctuation">,</span> content<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">,</span> publishtime<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">,</span> userid<span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">,</span> nickname<span class="token operator">=</span>刘桑<span class="token punctuation">,</span> createdatatim<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">,</span> likenum<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">,</span> replynum<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">,</span> state<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">,</span> parentid<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> articleid<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="mongotemplate实现评论点赞"><a class="anchor" href="#mongotemplate实现评论点赞">#</a> MongoTemplate 实现评论点赞</h3><p>我们看一下以下点赞的临时示例代码：CommentService 新增 updateThumbup 方法</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre> * 点赞 - 效率低</pre></td></tr><tr><td data-num="3"></td><td><pre> * @Param id</pre></td></tr><tr><td data-num="4"></td><td><pre> */</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateCommentThumbupToIncrementingOld</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token class-name">Comment</span> comment <span class="token operator">=</span> <span class="token class-name">CommentRepository</span><span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>   comment<span class="token punctuation">.</span><span class="token function">setLikenum</span><span class="token punctuation">(</span>comment<span class="token punctuation">.</span><span class="token function">getLikenum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>   <span class="token class-name">CommentRepository</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>comment<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>以上方法虽然实现起来比较简单，但是执行效率并不高，因为我只需要将点赞数加 1 就可以了，没必要查询出所有字段修改后再更新所有字段 (蝴蝶效应)</p><p>我们可以使用 MongoTemplate 类来实现对某列的操作</p><p>1. 修改 CommentService</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Autowired</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">private</span> <span class="token class-name">MongoTemplate</span> mongoTemplate<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateCommentLikenum</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>   <span class="token comment">//        查询对象</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token class-name">Query</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"_id"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>   <span class="token comment">//        更新对象</span></pre></td></tr><tr><td data-num="8"></td><td><pre>   <span class="token class-name">Update</span> update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>   <span class="token comment">//        递增 $inc</span></pre></td></tr><tr><td data-num="10"></td><td><pre>   update<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token string">"likenum"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>   <span class="token comment">/**</span></pre></td></tr><tr><td data-num="12"></td><td><pre>         * 参数 1：查询对象 query</pre></td></tr><tr><td data-num="13"></td><td><pre>         * 参数 2：更新对象 update</pre></td></tr><tr><td data-num="14"></td><td><pre>         * 参数 3：集合的名字或实体类的类型 Comment.class</pre></td></tr><tr><td data-num="15"></td><td><pre>         */</pre></td></tr><tr><td data-num="16"></td><td><pre>   mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span>update<span class="token punctuation">,</span><span class="token string">"comment"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>2. 测试代码：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>   commentService<span class="token punctuation">.</span><span class="token function">updateCommentLikenum</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token constant">RUN</span> <span class="token class-name">Result</span> mongo <span class="token class-name">Terminal</span> statment<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></pre></td></tr><tr><td data-num="6"></td><td><pre>修改前</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"content"</span> <span class="token operator">:</span> <span class="token string">"我天天喝"</span><span class="token punctuation">,</span> <span class="token string">"publishtime"</span> <span class="token operator">:</span> <span class="token class-name">ISODate</span><span class="token punctuation">(</span><span class="token string">"2023-06-05T02:26:15.397Z"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"userid"</span> <span class="token operator">:</span> <span class="token string">"1001"</span><span class="token punctuation">,</span> <span class="token string">"nickname"</span> <span class="token operator">:</span> <span class="token string">"凯撒"</span><span class="token punctuation">,</span> <span class="token string">"createdatatim"</span> <span class="token operator">:</span> <span class="token class-name">ISODate</span><span class="token punctuation">(</span><span class="token string">"2023-06-05T02:26:15.405Z"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"likenum"</span> <span class="token operator">:</span> <span class="token number">10003</span><span class="token punctuation">,</span> <span class="token string">"replynum"</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">"state"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"parentid"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"articleid"</span> <span class="token operator">:</span> <span class="token string">"1001"</span><span class="token punctuation">,</span> <span class="token string">"_class"</span> <span class="token operator">:</span> <span class="token string">"com.dkx.domain.Comment"</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>修改后</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#123;</span> <span class="token string">"_id"</span> <span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"content"</span> <span class="token operator">:</span> <span class="token string">"我天天喝"</span><span class="token punctuation">,</span> <span class="token string">"publishtime"</span> <span class="token operator">:</span> <span class="token class-name">ISODate</span><span class="token punctuation">(</span><span class="token string">"2023-06-05T02:26:15.397Z"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"userid"</span> <span class="token operator">:</span> <span class="token string">"1001"</span><span class="token punctuation">,</span> <span class="token string">"nickname"</span> <span class="token operator">:</span> <span class="token string">"凯撒"</span><span class="token punctuation">,</span> <span class="token string">"createdatatim"</span> <span class="token operator">:</span> <span class="token class-name">ISODate</span><span class="token punctuation">(</span><span class="token string">"2023-06-05T02:26:15.405Z"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"likenum"</span> <span class="token operator">:</span> <span class="token class-name">NumberLong</span><span class="token punctuation">(</span><span class="token number">10004</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"replynum"</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">"state"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"parentid"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"articleid"</span> <span class="token operator">:</span> <span class="token string">"1001"</span><span class="token punctuation">,</span> <span class="token string">"_class"</span> <span class="token operator">:</span> <span class="token string">"com.dkx.domain.Comment"</span> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><div class="tags"><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E7%A7%91/" rel="tag"><i class="ic i-tag"></i> 计算机学科</a> <a href="/tags/database/" rel="tag"><i class="ic i-tag"></i> database</a> <a href="/tags/mongodb/" rel="tag"><i class="ic i-tag"></i> mongodb</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-01-07 08:35:46" itemprop="dateModified" datetime="2024-01-07T08:35:46+08:00">2024-01-07</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="D 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="D 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="D 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Dkx： </strong>D <i class="ic i-at"><em>@</em></i>D の Java 小窝</li><li class="link"><strong>本文链接：</strong> <a href="https://pigpigletsgo.github.io/computer-science/database/mongodb/MongoDB%E5%85%A5%E9%97%A8/" title="MongoDB 入门">https://pigpigletsgo.github.io/computer-science/database/mongodb/MongoDB入门/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/computer-science/database/JDBC/JDBC%E6%A8%A1%E5%BC%8F%E5%AE%9E%E7%8E%B0/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;img.timelessq.com&#x2F;images&#x2F;2022&#x2F;07&#x2F;26&#x2F;5da180f23a92b4141ea87338ac84c765.jpg" title="JDBC模式实现"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> JDBC</span><h3>JDBC模式实现</h3></a></div><div class="item right"><a href="/computer-science/database/mongodb/MongoDB%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E5%90%AF%E7%94%A8/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;img.timelessq.com&#x2F;images&#x2F;2022&#x2F;07&#x2F;26&#x2F;5651daf17bf5de77514e658264d7cccc.jpg" title="MongoDB的安装及启用"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> mongodb</span><h3>MongoDB的安装及启用</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#mongodb%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">MongoDB 相关概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.1.</span> <span class="toc-text">业务应用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E9%80%89%E6%8B%A9mongodb"><span class="toc-number">1.2.</span> <span class="toc-text">什么时候选择 MongoDB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mongodb%E7%AE%80%E4%BB%8B"><span class="toc-number">1.3.</span> <span class="toc-text">MongoDB 简介</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">体系结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text">数据模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mongodb%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">4.</span> <span class="toc-text">MongoDB 的特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">5.</span> <span class="toc-text">基本常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E9%9C%80%E6%B1%82"><span class="toc-number">5.1.</span> <span class="toc-text">案例需求：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">6.</span> <span class="toc-text">数据库操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E5%92%8C%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">6.1.</span> <span class="toc-text">选择和创建数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%88%A0%E9%99%A4"><span class="toc-number">6.2.</span> <span class="toc-text">数据库的删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E6%93%8D%E4%BD%9C"><span class="toc-number">6.3.</span> <span class="toc-text">集合操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E7%9A%84%E6%98%BE%E7%A4%BA%E5%88%9B%E5%BB%BA"><span class="toc-number">6.4.</span> <span class="toc-text">集合的显示创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E7%9A%84%E9%9A%90%E5%BC%8F%E5%88%9B%E5%BB%BA"><span class="toc-number">6.5.</span> <span class="toc-text">集合的隐式创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E7%9A%84%E5%88%A0%E9%99%A4"><span class="toc-number">6.6.</span> <span class="toc-text">集合的删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E5%9F%BA%E6%9C%ACcrud"><span class="toc-number">7.</span> <span class="toc-text">文档基本 CRUD</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E7%9A%84%E6%8F%92%E5%85%A5"><span class="toc-number">7.1.</span> <span class="toc-text">文档的插入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E5%8D%95%E4%B8%AA%E6%96%87%E6%A1%A3%E6%8F%92%E5%85%A5"><span class="toc-number">7.1.1.</span> <span class="toc-text">1. 单个文档插入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5"><span class="toc-number">7.1.2.</span> <span class="toc-text">2. 批量插入</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%9F%A5%E8%AF%A2"><span class="toc-number">8.</span> <span class="toc-text">文档的基本查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89"><span class="toc-number">8.1.</span> <span class="toc-text">1. 查询所有</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E7%9A%84%E6%9B%B4%E6%96%B0"><span class="toc-number">9.</span> <span class="toc-text">文档的更新</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E8%A6%86%E7%9B%96%E7%9A%84%E4%BF%AE%E6%94%B9"><span class="toc-number">9.1.</span> <span class="toc-text">1. 覆盖的修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E5%B1%80%E9%83%A8%E4%BF%AE%E6%94%B9"><span class="toc-number">9.2.</span> <span class="toc-text">2. 局部修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E6%89%B9%E9%87%8F%E7%9A%84%E4%BF%AE%E6%94%B9"><span class="toc-number">9.3.</span> <span class="toc-text">3. 批量的修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E5%88%97%E5%80%BC%E5%A2%9E%E9%95%BF%E7%9A%84%E4%BF%AE%E6%94%B9"><span class="toc-number">9.4.</span> <span class="toc-text">3. 列值增长的修改</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-number">10.</span> <span class="toc-text">删除文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E7%9A%84%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">11.</span> <span class="toc-text">文档的分页查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E6%9F%A5%E8%AF%A2"><span class="toc-number">11.1.</span> <span class="toc-text">统计查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E5%88%97%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">11.2.</span> <span class="toc-text">分页列表查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E6%9F%A5%E8%AF%A2"><span class="toc-number">12.</span> <span class="toc-text">排序查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E7%9A%84%E6%9B%B4%E5%A4%9A%E6%9F%A5%E8%AF%A2"><span class="toc-number">13.</span> <span class="toc-text">文档的更多查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E7%9A%84%E5%A4%8D%E6%9D%82%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">13.1.</span> <span class="toc-text">正则的复杂条件查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E6%9F%A5%E8%AF%A2"><span class="toc-number">14.</span> <span class="toc-text">比较查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%85%E5%90%AB%E6%9F%A5%E8%AF%A2"><span class="toc-number">15.</span> <span class="toc-text">包含查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="toc-number">16.</span> <span class="toc-text">条件连接查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%B0%8F%E7%BB%93"><span class="toc-number">17.</span> <span class="toc-text">常用命令小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">18.</span> <span class="toc-text">索引的类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E5%AD%97%E6%AE%B5%E7%B4%A2%E5%BC%95"><span class="toc-number">18.1.</span> <span class="toc-text">单字段索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E7%B4%A2%E5%BC%95"><span class="toc-number">18.2.</span> <span class="toc-text">其它索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%B0%E7%90%86%E7%A9%BA%E9%97%B4%E7%B4%A2%E5%BC%95geospatial-index"><span class="toc-number">18.2.1.</span> <span class="toc-text">地理空间索引 (Geospatial Index)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E7%B4%A2%E5%BC%95text-indexes"><span class="toc-number">18.2.2.</span> <span class="toc-text">文本索引 (Text Indexes)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E7%B4%A2%E5%BC%95hashed-indexes"><span class="toc-number">18.2.3.</span> <span class="toc-text">哈希索引 (Hashed Indexes)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E7%AE%A1%E7%90%86%E6%93%8D%E4%BD%9C"><span class="toc-number">18.3.</span> <span class="toc-text">索引的管理操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E6%9F%A5%E7%9C%8B"><span class="toc-number">18.3.1.</span> <span class="toc-text">索引的查看</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-number">18.4.</span> <span class="toc-text">索引的创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E7%A7%BB%E9%99%A4"><span class="toc-number">18.5.</span> <span class="toc-text">索引的移除</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E6%8C%87%E5%AE%9A%E7%B4%A2%E5%BC%95%E7%9A%84%E7%A7%BB%E9%99%A4"><span class="toc-number">18.5.1.</span> <span class="toc-text">一，指定索引的移除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E6%89%80%E6%9C%89%E7%B4%A2%E5%BC%95%E7%9A%84%E7%A7%BB%E9%99%A4"><span class="toc-number">18.5.2.</span> <span class="toc-text">二，所有索引的移除</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">18.6.</span> <span class="toc-text">索引的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92"><span class="toc-number">18.6.1.</span> <span class="toc-text">执行计划</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B6%B5%E7%9B%96%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">19.</span> <span class="toc-text">涵盖的查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA"><span class="toc-number">20.</span> <span class="toc-text">文章评论</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">20.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90"><span class="toc-number">20.2.</span> <span class="toc-text">表结构分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="toc-number">20.3.</span> <span class="toc-text">技术选型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#springdatamongodb"><span class="toc-number">20.4.</span> <span class="toc-text">SpringDataMongoDB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA%E5%AE%9E%E4%BD%93%E7%B1%BB%E7%9A%84%E7%BC%96%E5%86%99"><span class="toc-number">20.5.</span> <span class="toc-text">文章评论实体类的编写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="toc-number">20.6.</span> <span class="toc-text">文章评论的基本增删改查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E4%B8%8A%E7%BA%A7id%E6%9F%A5%E8%AF%A2%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA%E7%9A%84%E5%88%86%E9%A1%B5%E5%88%97%E8%A1%A8"><span class="toc-number">20.7.</span> <span class="toc-text">根据上级 ID 查询文章评论的分页列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mongotemplate%E5%AE%9E%E7%8E%B0%E8%AF%84%E8%AE%BA%E7%82%B9%E8%B5%9E"><span class="toc-number">20.8.</span> <span class="toc-text">MongoTemplate 实现评论点赞</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/computer-science/database/mongodb/MongoDB%E5%85%A5%E9%97%A8/" rel="bookmark" title="MongoDB入门">MongoDB入门</a></li><li><a href="/computer-science/database/mongodb/MongoDB%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E5%90%AF%E7%94%A8/" rel="bookmark" title="MongoDB的安装及启用">MongoDB的安装及启用</a></li><li><a href="/computer-science/database/mongodb/MongoDB%E9%9B%86%E7%BE%A4%E5%92%8C%E5%AE%89%E5%85%A8/" rel="bookmark" title="MongoDB集群和安全">MongoDB集群和安全</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="D" data-src="/images/avatar.jpg"><p class="name" itemprop="name">D</p><div class="description" itemprop="description">欢迎来我的博客空间</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">406</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">105</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">160</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1BpZ1BpZ0xldHNHbw==" title="https:&#x2F;&#x2F;github.com&#x2F;PigPigLetsGo"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9Ea3gxMjE5" title="https:&#x2F;&#x2F;twitter.com&#x2F;Dkx1219"><i class="ic i-twitter"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS96dWktaG91LXllLWJlaS1sdWUtc2hh" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;zui-hou-ye-bei-lue-sha"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTU3NjUxMDQ1OQ==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;576510459"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93d3cud2VpYm8uY29tL3UvNTk5OTU0OTg0MQ==" title="https:&#x2F;&#x2F;www.weibo.com&#x2F;u&#x2F;5999549841"><i class="ic i-weibo"></i></span> <span class="exturl item facebook" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDA5NDA4Nzc0ODIwMQ==" title="https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100094087748201"><i class="ic i-facebook"></i></span> <span class="exturl item stackoverflow" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS91c2Vycy8xOTQwNjAyOS9kLWt4" title="https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;19406029&#x2F;d-kx"><i class="ic i-stack-overflow"></i></span> <span class="exturl item youtube" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vQERreC12djdsbQ==" title="https:&#x2F;&#x2F;www.youtube.com&#x2F;@Dkx-vv7lm"><i class="ic i-youtube"></i></span> <span class="exturl item instagram" data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS9kb3Vka3g/aWdzaD1PR1E1WkRjMk9EazJaQSUzRCUzRCZ1dG1fc291cmNlPXFy" title="https:&#x2F;&#x2F;www.instagram.com&#x2F;doudkx?igsh&#x3D;OGQ5ZDc2ODk2ZA%3D%3D&amp;utm_source&#x3D;qr"><i class="ic i-instagram"></i></span> <span class="exturl item telegram" data-url="aHR0cHM6Ly90Lm1lL2RvdTAxMDg=" title="https:&#x2F;&#x2F;t.me&#x2F;dou0108"><i class="ic i-twitter"></i></span> <span class="exturl item skype" data-url="aHR0cHM6Ly9qb2luLnNreXBlLmNvbS9UN25TSWhvbmMxcWQ=" title="https:&#x2F;&#x2F;join.skype.com&#x2F;T7nSIhonc1qd"><i class="ic i-skype"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>链接</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/computer-science/database/JDBC/JDBC%E6%A8%A1%E5%BC%8F%E5%AE%9E%E7%8E%B0/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/computer-science/database/mongodb/MongoDB%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E5%90%AF%E7%94%A8/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/linux/" title="分类于 linux">linux</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/linux/shell%E7%BC%96%E7%A8%8B/" title="分类于 shell 编程">shell 编程</a></div><span><a href="/computer-science/linux/shell%E7%BC%96%E7%A8%8B/%E5%88%A4%E6%96%AD%E8%AF%AD%E5%8F%A5/" title="shell判断语句">shell判断语句</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/data-structures-and-algorithms/" title="分类于 数据结构与算法">数据结构与算法</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/data-structures-and-algorithms/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/" title="分类于 二叉搜索树">二叉搜索树</a></div><span><a href="/computer-science/java/data-structures-and-algorithms/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E7%9A%84%E6%A6%82%E8%BF%B0/" title="二叉搜索树的概述">二叉搜索树的概述</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/programming-questions/" title="分类于 编程题">编程题</a></div><span><a href="/computer-science/java/programming-questions/%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84-%E6%94%B9%E5%8A%A8%E7%89%88/" title="合并两个有序数组-改动">合并两个有序数组-改动</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/data-structures-and-algorithms/" title="分类于 数据结构与算法">数据结构与算法</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/data-structures-and-algorithms/%E5%A0%86/" title="分类于 堆">堆</a></div><span><a href="/computer-science/java/data-structures-and-algorithms/%E5%A0%86/%E5%A0%86-heapify1/" title="堆-heapify1">堆-heapify1</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/%E5%B7%A5%E5%85%B7%E7%B1%BB/" title="分类于 工具类">工具类</a></div><span><a href="/computer-science/java/%E5%B7%A5%E5%85%B7%E7%B1%BB/JDBC%E5%B7%A5%E5%85%B7%E7%B1%BB/" title="JDBC工具类">JDBC工具类</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/spring/" title="分类于 spring">spring</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/spring/%E4%BB%A3%E7%A0%81%E6%A1%88%E4%BE%8B/" title="分类于 代码案例">代码案例</a></div><span><a href="/computer-science/java/spring/%E4%BB%A3%E7%A0%81%E6%A1%88%E4%BE%8B/8/" title="管理第三方bean">管理第三方bean</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/bug/" title="分类于 问题总汇">问题总汇</a></div><span><a href="/bug/%E8%BF%90%E8%A1%8C%E6%8A%A5%E9%94%99java-package-org-apache-ibatis-io-does-not-exist/" title="MyBatis-运行报错java-package-org-apache-ibatis-io-does-not-exist">MyBatis-运行报错java-package-org-apache-ibatis-io-does-not-exist</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/spring/" title="分类于 spring">spring</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/spring/springboot/" title="分类于 springboot">springboot</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/spring/springboot/%E6%95%B4%E5%90%88jar%E5%8C%85/" title="分类于 整合 jar 包">整合 jar 包</a></div><span><a href="/computer-science/java/spring/springboot/%E6%95%B4%E5%90%88jar%E5%8C%85/Sprong-boot-devtools/" title="Sprong-boot-devtools">Sprong-boot-devtools</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/" title="分类于 知识点">知识点</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/String/" title="分类于 String">String</a></div><span><a href="/computer-science/java/%E7%9F%A5%E8%AF%86%E7%82%B9/String/%E5%85%A8%E8%A7%92%E4%B8%8E%E5%8D%8A%E8%A7%92%E5%8E%BB%E9%99%A4%E7%A9%BA%E6%A0%BC%E6%96%B9%E6%B3%95%E5%8C%BA%E5%88%AB/" title="Java中的strip()和trim()的区别">Java中的strip()和trim()的区别</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机学科">计算机学科</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/" title="分类于 java">java</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/maven/" title="分类于 maven">maven</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java/maven/%E8%BF%9B%E9%98%B6/" title="分类于 进阶">进阶</a></div><span><a href="/computer-science/java/maven/%E8%BF%9B%E9%98%B6/%E5%B1%9E%E6%80%A7/" title="maven-属性">maven-属性</a></span></li></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">D @ D 的个人博客</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">2.9m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">44:24</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"computer-science/database/mongodb/MongoDB入门/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="https://cdn.jsdelivr.net/gh/PigPigLetsGo/live2d-widget@latest/autoload.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>